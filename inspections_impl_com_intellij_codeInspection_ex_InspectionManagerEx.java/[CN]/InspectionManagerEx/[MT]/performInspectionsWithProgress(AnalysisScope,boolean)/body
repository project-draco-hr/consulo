{
  try {
    myProgressIndicator=ProgressManager.getInstance().getProgressIndicator();
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      public void run(){
        try {
          PsiManager.getInstance(myProject).startBatchFilesProcessingMode();
          ((RefManagerImpl)getRefManager()).inspectionReadActionStarted();
          EntryPointsManager.getInstance(getProject()).resolveEntryPoints(getRefManager());
          List<InspectionTool> needRepeatSearchRequest=new ArrayList<InspectionTool>();
          runTools(needRepeatSearchRequest,scope,runWithEditorSettings);
          performPostRunFindUsages(needRepeatSearchRequest);
        }
 catch (        ProcessCanceledException e) {
          cleanup();
          throw e;
        }
 finally {
          PsiManager.getInstance(myProject).finishBatchFilesProcessingMode();
        }
      }
    }
);
  }
  finally {
    if (myRefManager != null) {
      ((RefManagerImpl)getRefManager()).inspectionReadActionFinished();
    }
  }
}
