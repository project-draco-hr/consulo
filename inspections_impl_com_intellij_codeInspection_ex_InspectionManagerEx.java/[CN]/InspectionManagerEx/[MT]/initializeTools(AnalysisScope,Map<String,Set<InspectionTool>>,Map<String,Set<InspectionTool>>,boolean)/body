{
  myJobDescriptors=new ArrayList<JobDescriptor>();
  final InspectionProjectProfileManager profileManager=InspectionProjectProfileManager.getInstance(getProject());
  if (runWithEditorSettings) {
    final Set<String> profiles=scope.getActiveInspectionProfiles();
    final Map<VirtualFile,String> hectorAssignments=profileManager.getHectorAssignments();
    for (    VirtualFile vFile : hectorAssignments.keySet()) {
      if (scope.contains(vFile)) {
        profiles.add(hectorAssignments.get(vFile));
      }
    }
    for (    String profile : profiles) {
      final InspectionProfile inspectionProfile=((InspectionProfile)profileManager.getProfile(profile));
      processProfileTools(inspectionProfile,tools,localTools);
    }
  }
 else {
    InspectionProfile profile=(InspectionProfile)profileManager.getProfile(myCurrentProfileName);
    if (profile == null) {
      profile=(InspectionProfile)InspectionProfileManager.getInstance().getProfile(myCurrentProfileName);
    }
    processProfileTools(profile,tools,localTools);
  }
  BUILD_GRAPH.setTotalAmount(scope.getFileCount());
  LOCAL_ANALYSIS.setTotalAmount(scope.getFileCount());
}
