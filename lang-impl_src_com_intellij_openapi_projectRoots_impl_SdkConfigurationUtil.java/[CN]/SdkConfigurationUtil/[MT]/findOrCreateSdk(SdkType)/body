{
  final Project defaultProject=ProjectManager.getInstance().getDefaultProject();
  final Sdk sdk=ProjectRootManager.getInstance(defaultProject).getProjectJdk();
  if (sdk != null) {
    for (    SdkType type : sdkTypes) {
      if (sdk.getSdkType() == type) {
        return sdk;
      }
    }
  }
  for (  SdkType type : sdkTypes) {
    List<Sdk> sdks=ProjectJdkTable.getInstance().getSdksOfType(type);
    if (sdks.size() > 0) {
      return sdks.get(0);
    }
  }
  for (  SdkType sdkType : sdkTypes) {
    final String suggestedHomePath=sdkType.suggestHomePath();
    if (suggestedHomePath != null && sdkType.isValidSdkHome(suggestedHomePath)) {
      VirtualFile sdkHome=ApplicationManager.getApplication().runWriteAction(new Computable<VirtualFile>(){
        public VirtualFile compute(){
          return LocalFileSystem.getInstance().refreshAndFindFileByPath(suggestedHomePath);
        }
      }
);
      if (sdkHome != null) {
        return setupSdk(sdkHome,sdkType);
      }
    }
  }
  return null;
}
