{
  File directory=getKeymapDirectory(true);
  if (directory == null) {
    LOG.error("Keymap directory does not exist and cannot be created");
    return;
  }
  File[] files=getKeymapFiles();
  ArrayList<String> filePaths=new ArrayList<String>();
  ArrayList<Document> documents=new ArrayList<Document>();
  UniqueFileNamesProvider namesProvider=new UniqueFileNamesProvider();
  Iterator it=myKeymaps.iterator();
  while (it.hasNext()) {
    KeymapImpl keymap=(KeymapImpl)it.next();
    if (!keymap.canModify()) {
      continue;
    }
    Document document=new Document(keymap.writeExternal());
    String filePath=directory.getAbsolutePath() + File.separator + namesProvider.suggestName(keymap.getName())+ ".xml";
    filePaths.add(filePath);
    documents.add(document);
  }
  JDOMUtil.updateFileSet(files,filePaths.toArray(new String[filePaths.size()]),documents.toArray(new Document[documents.size()]),CodeStyleSettingsManager.getSettings(null).getLineSeparator());
}
