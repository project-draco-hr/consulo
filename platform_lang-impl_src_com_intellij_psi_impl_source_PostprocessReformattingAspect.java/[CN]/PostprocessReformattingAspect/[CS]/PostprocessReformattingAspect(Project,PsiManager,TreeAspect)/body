{
  myProject=project;
  myPsiManager=psiManager;
  myTreeAspect=treeAspect;
  PomManager.getModel(psiManager.getProject()).registerAspect(PostprocessReformattingAspect.class,this,Collections.singleton((PomModelAspect)treeAspect));
  ApplicationListener applicationListener=new ApplicationAdapter(){
    @Override public void writeActionStarted(    final Object action){
      final CommandProcessor processor=CommandProcessor.getInstance();
      if (processor != null) {
        final Project project=processor.getCurrentCommandProject();
        if (project == myProject) {
          myPostponedCounter++;
        }
      }
    }
    @Override public void writeActionFinished(    final Object action){
      final CommandProcessor processor=CommandProcessor.getInstance();
      if (processor != null) {
        final Project project=processor.getCurrentCommandProject();
        if (project == myProject) {
          decrementPostponedCounter();
        }
      }
    }
  }
;
  ApplicationManager.getApplication().addApplicationListener(applicationListener,project);
}
