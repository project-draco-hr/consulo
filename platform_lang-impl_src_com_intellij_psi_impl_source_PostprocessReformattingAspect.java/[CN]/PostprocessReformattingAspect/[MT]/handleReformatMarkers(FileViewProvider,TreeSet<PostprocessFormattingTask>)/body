{
  final Document document=key.getDocument();
  for (  final FileElement fileElement : ((SingleRootFileViewProvider)key).getKnownTreeRoots()) {
    fileElement.acceptTree(new RecursiveTreeElementWalkingVisitor(){
      protected void visitNode(      TreeElement element){
        if (CodeEditUtil.isMarkedToReformatBefore(element)) {
          CodeEditUtil.markToReformatBefore(element,false);
          rangesToProcess.add(new ReformatWithHeadingWhitespaceTask(document.createRangeMarker(element.getStartOffset(),element.getStartOffset())));
        }
        super.visitNode(element);
      }
    }
);
  }
}
