{
  final Document document=key.getDocument();
  for (  final FileElement fileElement : ((SingleRootFileViewProvider)key).getKnownTreeRoots()) {
    fileElement.acceptTree(new RecursiveTreeElementWalkingVisitor(){
      protected boolean visitNode(      TreeElement element){
        if (CodeEditUtil.isMarkedToReformatBefore(element)) {
          CodeEditUtil.markToReformatBefore(element,false);
          rangesToProcess.put(document.createRangeMarker(element.getStartOffset(),element.getStartOffset()),new ReformatWithHeadingWhitespaceAction());
        }
        return true;
      }
    }
);
  }
}
