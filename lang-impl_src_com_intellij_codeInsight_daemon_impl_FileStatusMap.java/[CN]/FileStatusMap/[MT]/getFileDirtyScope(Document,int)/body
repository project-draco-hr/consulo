{
synchronized (myDocumentToStatusMap) {
    FileStatus status=myDocumentToStatusMap.get(document);
    if (status == null) {
      PsiFile file=PsiDocumentManager.getInstance(myProject).getPsiFile(document);
      return file == null ? null : file.getTextRange();
    }
    if (status.defensivelyMarked) {
      PsiFile file=PsiDocumentManager.getInstance(myProject).getPsiFile(document);
      status.markWholeFile(file,document,myProject);
      status.defensivelyMarked=false;
    }
    LOG.assertTrue(status.dirtyScopes.containsKey(passId),"Unknown pass " + passId);
    RangeMarker marker=status.dirtyScopes.get(passId);
    return marker == null ? null : new TextRange(marker.getStartOffset(),marker.getEndOffset());
  }
}
