{
  if (scope == null)   return old;
  if (old == null) {
    return document.createRangeMarker(scope);
  }
  if (scope.getEndOffset() >= textLength) {
    ((DocumentEx)document).removeRangeMarker((RangeMarkerEx)old);
    return document.createRangeMarker(0,textLength);
  }
  TextRange oldRange=new TextRange(old.getStartOffset(),old.getEndOffset());
  TextRange union=scope.union(oldRange);
  if (union.equals(oldRange)) {
    return old;
  }
 else {
    ((DocumentEx)document).removeRangeMarker((RangeMarkerEx)old);
    return document.createRangeMarker(union);
  }
}
