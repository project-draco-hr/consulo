{
  FileChooserDescriptor descriptor=FileChooserDescriptorFactory.createSingleFolderDescriptor();
  descriptor.setTitle("Select Directory for META-INF/MANIFEST.MF file");
  final VirtualFile directory=suggestManifestFileDirectory(element,context,context.getArtifactType());
  final VirtualFile[] files=FileChooser.chooseFiles(context.getProject(),descriptor,directory);
  if (files.length != 1) {
    return null;
  }
  final Ref<IOException> exc=Ref.create(null);
  final VirtualFile file=new WriteAction<VirtualFile>(){
    protected void run(    final Result<VirtualFile> result){
      VirtualFile dir=files[0];
      try {
        if (!dir.getName().equals(MANIFEST_DIR_NAME)) {
          VirtualFile newDir=dir.findChild(MANIFEST_DIR_NAME);
          if (newDir == null) {
            newDir=dir.createChildDirectory(this,MANIFEST_DIR_NAME);
          }
          dir=newDir;
        }
        result.setResult(dir.createChildData(this,MANIFEST_FILE_NAME));
      }
 catch (      IOException e) {
        exc.set(e);
      }
    }
  }
.execute().getResultObject();
  final IOException exception=exc.get();
  if (exception != null) {
    LOG.info(exception);
    Messages.showErrorDialog(context.getProject(),exception.getMessage(),CommonBundle.getErrorTitle());
    return null;
  }
  return file;
}
