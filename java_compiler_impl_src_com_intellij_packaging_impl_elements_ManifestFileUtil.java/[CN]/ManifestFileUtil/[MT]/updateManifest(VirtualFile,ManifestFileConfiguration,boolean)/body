{
  final Manifest manifest=readManifest(file);
  final Attributes mainAttributes=manifest.getMainAttributes();
  final String mainClass=configuration.getMainClass();
  if (mainClass != null) {
    mainAttributes.put(Attributes.Name.MAIN_CLASS,mainClass);
  }
 else   if (replaceValues) {
    mainAttributes.remove(Attributes.Name.MAIN_CLASS);
  }
  final List<String> classpath=configuration.getClasspath();
  if (classpath != null && !classpath.isEmpty()) {
    List<String> updatedClasspath;
    if (replaceValues) {
      updatedClasspath=classpath;
    }
 else {
      updatedClasspath=new ArrayList<String>();
      final String oldClasspath=(String)mainAttributes.get(Attributes.Name.CLASS_PATH);
      if (!StringUtil.isEmpty(oldClasspath)) {
        updatedClasspath.addAll(StringUtil.split(oldClasspath," "));
      }
      for (      String path : classpath) {
        if (!updatedClasspath.contains(path)) {
          updatedClasspath.add(path);
        }
      }
    }
    mainAttributes.put(Attributes.Name.CLASS_PATH,StringUtil.join(updatedClasspath," "));
  }
 else   if (replaceValues) {
    mainAttributes.remove(Attributes.Name.CLASS_PATH);
  }
  ManifestBuilder.setVersionAttribute(mainAttributes);
  try {
    final OutputStream outputStream=file.getOutputStream(ManifestFileUtil.class);
    try {
      manifest.write(outputStream);
    }
  finally {
      outputStream.close();
    }
  }
 catch (  IOException e) {
    LOG.info(e);
  }
}
