{
  FileType fileType=file.getUserData(FILE_TYPE_KEY);
  if (fileType != null)   return fileType;
  if (file instanceof LightVirtualFile) {
    fileType=((LightVirtualFile)file).getAssignedFileType();
    if (fileType != null)     return fileType;
  }
  for (int i=0; i < mySpecialFileTypes.size(); i++) {
    FileTypeIdentifiableByVirtualFile type=mySpecialFileTypes.get(i);
    if (type.isMyFileType(file)) {
      return type;
    }
  }
  fileType=getFileTypeByFileName(file.getName());
  if (fileType != UnknownFileType.INSTANCE)   return fileType;
  fileType=cachedDetectedFromContent(file);
  if (fileType != null)   return fileType;
  return UnknownFileType.INSTANCE;
}
