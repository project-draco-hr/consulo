{
  FileType fileType=file.getUserData(FILE_TYPE_KEY);
  if (fileType != null)   return fileType;
  if (file instanceof LightVirtualFile) {
    fileType=((LightVirtualFile)file).getAssignedFileType();
    if (fileType != null)     return fileType;
  }
  for (int i=0; i < mySpecialFileTypes.size(); i++) {
    FileTypeIdentifiableByVirtualFile type=mySpecialFileTypes.get(i);
    if (type.isMyFileType(file)) {
      if (toLog()) {
        log("F: Special file type for " + file.getName() + "; type: "+ type.getName());
      }
      return type;
    }
  }
  fileType=getFileTypeByFileName(file.getNameSequence());
  if (fileType != UnknownFileType.INSTANCE) {
    if (toLog()) {
      log("F: By name file type for " + file.getName() + "; type: "+ fileType.getName());
    }
    return fileType;
  }
  if (!(file instanceof StubVirtualFile)) {
    fileType=getOrDetectFromContent(file);
  }
  return fileType;
}
