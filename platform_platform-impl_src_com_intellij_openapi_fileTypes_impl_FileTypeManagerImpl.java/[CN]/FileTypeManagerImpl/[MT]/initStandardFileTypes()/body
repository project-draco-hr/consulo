{
  FileTypeConsumer consumer=new FileTypeConsumer(){
    @Override public void consume(    @NotNull FileType fileType){
      register(fileType,parse(fileType.getDefaultExtension()));
    }
    @Override public void consume(    @NotNull final FileType fileType,    String extensions){
      register(fileType,parse(extensions));
    }
    @Override public void consume(    @NotNull final FileType fileType,    @NotNull final FileNameMatcher... matchers){
      register(fileType,new ArrayList<FileNameMatcher>(Arrays.asList(matchers)));
    }
    @Override public FileType getStandardFileTypeByName(    @NotNull final String name){
      final StandardFileType type=myStandardFileTypes.get(name);
      return type != null ? type.fileType : null;
    }
    private void register(    @NotNull FileType fileType,    @NotNull List<FileNameMatcher> fileNameMatchers){
      final StandardFileType type=myStandardFileTypes.get(fileType.getName());
      if (type != null) {
        type.matchers.addAll(fileNameMatchers);
      }
 else {
        myStandardFileTypes.put(fileType.getName(),new StandardFileType(fileType,fileNameMatchers));
      }
    }
  }
;
  for (  FileTypeFactory factory : FileTypeFactory.FILE_TYPE_FACTORY_EP.getExtensions()) {
    try {
      factory.createFileTypes(consumer);
    }
 catch (    Throwable e) {
      PluginManager.handleComponentError(e,factory.getClass().getName(),null);
    }
  }
  for (  StandardFileType pair : myStandardFileTypes.values()) {
    registerFileTypeWithoutNotification(pair.fileType,pair.matchers,true);
  }
  try {
    URL defaultFileTypesUrl=FileTypeManagerImpl.class.getResource("/defaultFileTypes.xml");
    if (defaultFileTypesUrl != null) {
      Element defaultFileTypesElement=JDOMUtil.load(URLUtil.openStream(defaultFileTypesUrl));
      for (      Element e : defaultFileTypesElement.getChildren()) {
        if ("filetypes".equals(e.getName())) {
          for (          Element element : e.getChildren(ELEMENT_FILETYPE)) {
            loadFileType(element,true);
          }
        }
 else         if (AbstractFileType.ELEMENT_EXTENSION_MAP.equals(e.getName())) {
          readGlobalMappings(e);
        }
      }
    }
  }
 catch (  Exception e) {
    LOG.error(e);
  }
}
