{
  boolean wasAutodetectedAsText=fileType == PlainTextFileType.INSTANCE;
  boolean wasAutodetectedAsBinary=fileType == UnknownFileType.INSTANCE;
  int flags=BitUtil.set(0,AUTO_DETECTED_AS_TEXT_MASK,wasAutodetectedAsText);
  flags=BitUtil.set(flags,AUTO_DETECTED_AS_BINARY_MASK,wasAutodetectedAsBinary);
  writeFlagsToCache(file,flags);
  if (file instanceof VirtualFileWithId) {
    int id=Math.abs(((VirtualFileWithId)file).getId());
    flags=BitUtil.set(flags,AUTO_DETECT_WAS_RUN_MASK,true);
    flags=BitUtil.set(flags,ATTRIBUTES_WERE_LOADED_MASK,true);
    packedFlags.set(id,flags);
    if (wasAutodetectedAsText || wasAutodetectedAsBinary) {
      file.putUserData(DETECTED_FROM_CONTENT_FILE_TYPE_KEY,null);
      if (toLog()) {
        log("F: cacheAutoDetectedFileType(" + file.getName() + ") "+ "cached to "+ fileType.getName()+ " flags = "+ readableFlags(flags)+ "; getUserData(DETECTED_FROM_CONTENT_FILE_TYPE_KEY): "+ file.getUserData(DETECTED_FROM_CONTENT_FILE_TYPE_KEY));
      }
      return;
    }
  }
  file.putUserData(DETECTED_FROM_CONTENT_FILE_TYPE_KEY,fileType);
  if (toLog()) {
    log("F: cacheAutoDetectedFileType(" + file.getName() + ") "+ "cached to "+ fileType.getName()+ " flags = "+ readableFlags(flags)+ "; getUserData(DETECTED_FROM_CONTENT_FILE_TYPE_KEY): "+ file.getUserData(DETECTED_FROM_CONTENT_FILE_TYPE_KEY));
  }
}
