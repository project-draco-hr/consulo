{
  FileType fileType=file.getFileType();
  Pair<VirtualFile,FileType> old=FILE_TYPE_FIXED_TEMPORARILY.get();
  FILE_TYPE_FIXED_TEMPORARILY.set(Pair.create(file,fileType));
  if (toLog()) {
    log("F: freezeFileTypeTemporarilyIn(" + file.getName() + ") to "+ fileType.getName()+ " in "+ Thread.currentThread());
  }
  try {
    runnable.run();
  }
  finally {
    if (old == null) {
      FILE_TYPE_FIXED_TEMPORARILY.remove();
    }
 else {
      FILE_TYPE_FIXED_TEMPORARILY.set(old);
    }
    if (toLog()) {
      log("F: unfreezeFileType(" + file.getName() + ") in "+ Thread.currentThread());
    }
  }
}
