{
  Pair<VirtualFile,FileType> fixedType=FILE_TYPE_FIXED_TEMPORARILY.get();
  if (fixedType != null && fixedType.getFirst().equals(file)) {
    FileType fileType=fixedType.getSecond();
    if (toLog()) {
      log("F: getOrDetectByFile(" + file.getName() + ") was frozen to "+ fileType.getName()+ " in "+ Thread.currentThread());
    }
    return fileType;
  }
  if (file instanceof LightVirtualFile) {
    FileType fileType=((LightVirtualFile)file).getAssignedFileType();
    if (fileType != null) {
      return fileType;
    }
  }
  for (  FileTypeIdentifiableByVirtualFile type : mySpecialFileTypes) {
    if (type.isMyFileType(file)) {
      if (toLog()) {
        log("F: getOrDetectByFile(" + file.getName() + "): Special file type: "+ type.getName());
      }
      return type;
    }
  }
  FileType fileType=getFileTypeByFileName(file.getNameSequence());
  if (fileType == UnknownFileType.INSTANCE) {
    fileType=null;
  }
  if (toLog()) {
    log("F: getOrDetectByFile(" + file.getName() + ") By name file type: "+ (fileType == null ? null : fileType.getName()));
  }
  return fileType;
}
