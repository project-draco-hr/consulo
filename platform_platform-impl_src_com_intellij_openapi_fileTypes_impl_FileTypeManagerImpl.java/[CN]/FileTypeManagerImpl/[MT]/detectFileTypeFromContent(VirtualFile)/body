{
  if (file.isDirectory() || !file.isValid() || file.is(VFileProperty.SPECIAL)) {
    return UnknownFileType.INSTANCE;
  }
  FileType fileType=cachedDetectedFromContent(file);
  if (fileType == null) {
    fileType=detectFromContent(file);
    if (file.getLength() != 0) {
      file.putUserData(DETECTED_FROM_CONTENT_FILE_TYPE_KEY,fileType);
    }
  }
  return fileType;
}
