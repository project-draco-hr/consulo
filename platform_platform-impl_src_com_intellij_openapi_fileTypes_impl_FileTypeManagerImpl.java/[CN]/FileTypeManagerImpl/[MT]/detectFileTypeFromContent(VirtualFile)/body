{
  if (file.isDirectory() || !file.isValid() || file.is(VFileProperty.SPECIAL)) {
    return UnknownFileType.INSTANCE;
  }
  FileType fileType=file.getUserData(DETECTED_FROM_CONTENT_FILE_TYPE_KEY);
  if (fileType == null) {
    fileType=detectFromContent(file);
    file.putUserData(DETECTED_FROM_CONTENT_FILE_TYPE_KEY,fileType);
  }
  return fileType;
}
