{
  DefaultActionGroup group=new DefaultActionGroup();
  group.add(new AnAction(ProjectBundle.message("add.new.global.library.text")){
    public void actionPerformed(    AnActionEvent e){
      final LibraryTableEditor editor=LibraryTableEditor.editLibraryTable(getGlobalLibrariesProvider(),myProject);
      editor.createAddLibraryAction(true,myWholePanel).actionPerformed(null);
      Disposer.dispose(editor);
    }
  }
);
  group.add(new AnAction(ProjectBundle.message("add.new.project.library.text")){
    public void actionPerformed(    AnActionEvent e){
      final LibraryTableEditor editor=LibraryTableEditor.editLibraryTable(getProjectLibrariesProvider(),myProject);
      editor.createAddLibraryAction(true,myWholePanel).actionPerformed(null);
      Disposer.dispose(editor);
    }
    public void update(    AnActionEvent e){
      e.getPresentation().setEnabled(!myProject.isDefault());
    }
  }
);
  group.add(new AnAction(ProjectBundle.message("add.new.application.server.library.text")){
    public void actionPerformed(    AnActionEvent e){
      final LibraryTableEditor editor=LibraryTableEditor.editLibraryTable(getApplicationServerLibrariesProvider(),myProject);
      editor.createAddLibraryAction(true,myWholePanel).actionPerformed(null);
      Disposer.dispose(editor);
    }
  }
);
  group.add(new AnAction(ProjectBundle.message("add.new.module.library.text")){
    public void actionPerformed(    AnActionEvent e){
      Module module=(Module)getSelectedObject();
      final LibraryTableModifiableModelProvider modifiableModelProvider=getModifiableModelProvider(myModulesConfigurator.getModuleEditor(module).getModifiableRootModelProxy());
      final LibraryTableEditor editor=LibraryTableEditor.editLibraryTable(modifiableModelProvider,myProject);
      editor.createAddLibraryAction(true,myWholePanel).actionPerformed(null);
      Disposer.dispose(editor);
    }
    public void update(    AnActionEvent e){
      e.getPresentation().setEnabled(getSelectedObject() instanceof Module);
    }
  }
);
  final JBPopupFactory popupFactory=JBPopupFactory.getInstance();
  final int defaultOptionIndex;
  final Object selectedObject=getSelectedObject();
  if (selectedObject instanceof String) {
    final String libraryTable=(String)selectedObject;
    defaultOptionIndex=Comparing.strEqual(libraryTable,LibraryTablesRegistrar.APPLICATION_LEVEL) ? 0 : Comparing.strEqual(libraryTable,LibraryTablesRegistrar.PROJECT_LEVEL) ? 1 : 2;
  }
 else {
    defaultOptionIndex=1;
  }
  return popupFactory.createActionsStep(group,e.getDataContext(),false,false,ProjectBundle.message("add.new.library.title"),myTree,true,defaultOptionIndex);
}
