{
  ArrayList<VirtualFile> list=new ArrayList<VirtualFile>();
  Module[] modules=ModuleManager.getInstance(myProject).getModules();
  for (int i=0; i < modules.length; i++) {
    Module module=modules[i];
    ModuleRootManager rootManager=ModuleRootManager.getInstance(module);
    ContentEntry[] contentEntries=rootManager.getContentEntries();
    for (int j=0; j < contentEntries.length; j++) {
      ContentEntry contentEntry=contentEntries[j];
      SourceFolder[] sourceFolders=contentEntry.getSourceFolders();
      for (int k=0; k < sourceFolders.length; k++) {
        SourceFolder sourceFolder=sourceFolders[k];
        VirtualFile sourceRoot=sourceFolder.getFile();
        if (sourceRoot != null) {
          findAndAddDirByPackageName(list,sourceRoot,packageName);
        }
      }
    }
    OrderEntry[] orderEntries=rootManager.getOrderEntries();
    for (int j=0; j < orderEntries.length; j++) {
      OrderEntry orderEntry=orderEntries[j];
      if (orderEntry instanceof LibraryOrderEntry || orderEntry instanceof JdkOrderEntry) {
        VirtualFile[] libRoots=orderEntry.getFiles(OrderRootType.CLASSES);
        for (int k=0; k < libRoots.length; k++) {
          findAndAddDirByPackageName(list,libRoots[k],packageName);
        }
        VirtualFile[] libSourceRoots=orderEntry.getFiles(OrderRootType.SOURCES);
        for (int k=0; k < libSourceRoots.length; k++) {
          findAndAddDirByPackageName(list,libSourceRoots[k],packageName);
        }
      }
    }
  }
  VirtualFile[] result=list.toArray(new VirtualFile[list.size()]);
  return result;
}
