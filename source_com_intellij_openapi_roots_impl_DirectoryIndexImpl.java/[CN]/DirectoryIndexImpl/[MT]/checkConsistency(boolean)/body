{
  Assert.assertTrue(myInitialized);
  Assert.assertTrue(!myDisposed);
  Map<VirtualFile,DirectoryInfo> oldDirToInfoMap=myDirToInfoMap;
  myDirToInfoMap=new HashMap<VirtualFile,DirectoryInfo>();
  Map<String,VirtualFile[]> oldPackageNameToDirsMap=myPackageNameToDirsMap;
  myPackageNameToDirsMap=new HashMap<String,VirtualFile[]>();
  _initialize(reverseAllSets,null);
  if (LAZY_MODE) {
    Map<VirtualFile,DirectoryInfo> newDirToInfoMap=myDirToInfoMap;
    Map<String,VirtualFile[]> newPackageNameToDirsMap=myPackageNameToDirsMap;
    myDirToInfoMap=oldDirToInfoMap;
    myPackageNameToDirsMap=oldPackageNameToDirsMap;
    Set<VirtualFile> allDirsSet=newDirToInfoMap.keySet();
    for (    VirtualFile dir : allDirsSet) {
      getInfoForDirectory(dir);
    }
    myDirToInfoMap=newDirToInfoMap;
    myPackageNameToDirsMap=newPackageNameToDirsMap;
  }
  Set<VirtualFile> keySet=myDirToInfoMap.keySet();
  Assert.assertEquals(keySet,oldDirToInfoMap.keySet());
  for (  VirtualFile file : keySet) {
    DirectoryInfo info1=myDirToInfoMap.get(file);
    DirectoryInfo info2=oldDirToInfoMap.get(file);
    Assert.assertEquals(info1,info2);
  }
  Assert.assertEquals(myPackageNameToDirsMap.keySet(),oldPackageNameToDirsMap.keySet());
  for (  Map.Entry<String,VirtualFile[]> entry : myPackageNameToDirsMap.entrySet()) {
    String packageName=entry.getKey();
    VirtualFile[] dirs=entry.getValue();
    VirtualFile[] dirs1=oldPackageNameToDirsMap.get(packageName);
    HashSet<VirtualFile> set1=new HashSet<VirtualFile>();
    set1.addAll(Arrays.asList(dirs));
    HashSet<VirtualFile> set2=new HashSet<VirtualFile>();
    set2.addAll(Arrays.asList(dirs1));
    Assert.assertEquals(set1,set2);
  }
}
