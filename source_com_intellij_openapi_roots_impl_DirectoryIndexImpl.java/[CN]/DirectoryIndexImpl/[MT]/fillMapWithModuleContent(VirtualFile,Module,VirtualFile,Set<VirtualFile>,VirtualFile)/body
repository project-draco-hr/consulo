{
  if (excludeRoots != null && excludeRoots.contains(dir))   return;
  if (FileTypeManager.getInstance().isFileIgnored(dir.getName()))   return;
  if (forDir != null) {
    if (!VfsUtil.isAncestor(dir,forDir,false))     return;
  }
  DirectoryInfo info=getOrCreateDirInfo(dir);
  if (info.module != null) {
    DirectoryInfo parentInfo=myDirToInfoMap.get(dir.getParent());
    if (parentInfo == null || !info.module.equals(parentInfo.module))     return;
  }
  VirtualFile[] children=dir.getChildren();
  for (int i=0; i < children.length; i++) {
    VirtualFile child=children[i];
    if (child.isDirectory()) {
      fillMapWithModuleContent(child,module,contentRoot,excludeRoots,forDir);
    }
  }
  info.module=module;
  info.contentRoot=contentRoot;
}
