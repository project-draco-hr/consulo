{
  if (FileTypeManager.getInstance().isFileIgnored(dir.getName()))   return;
  DirectoryInfo info=getOrCreateDirInfo(dir);
  if (info.isInLibrarySource) {
    if (info.packageName != null && info.packageName.length() == 0)     return;
  }
  info.isInModuleSource=false;
  info.isInLibrarySource=true;
  info.sourceRoot=sourceRoot;
  setPackageName(dir,info,packageName);
  VirtualFile[] children=dir.getChildren();
  for (int i=0; i < children.length; i++) {
    VirtualFile child=children[i];
    if (child.isDirectory()) {
      String childPackageName=getPackageNameForSubdir(packageName,child.getName());
      fillMapWithLibrarySources(child,childPackageName,sourceRoot,forDir);
    }
  }
}
