{
  if (getElement() == null)   return StructureViewTreeElement.EMPTY_ARRAY;
  if (!getElement().isValid())   return StructureViewTreeElement.EMPTY_ARRAY;
  List<StructureViewTreeElement> result=new ArrayList<StructureViewTreeElement>();
  Collection<StructureViewTreeElement> baseChildren=getChildrenBase();
  result.addAll(baseChildren);
  StructureViewFactoryEx structureViewFactory=StructureViewFactoryEx.getInstance(getElement().getProject());
  Class<? extends PsiElement> aClass=getElement().getClass();
  List<StructureViewExtension> allExtensions=structureViewFactory.getAllExtensions(aClass);
  for (  StructureViewExtension extension : allExtensions) {
    StructureViewTreeElement[] children=extension.getChildren(getElement());
    if (children != null) {
      result.addAll(Arrays.asList(children));
    }
  }
  return result.toArray(new StructureViewTreeElement[result.size()]);
}
