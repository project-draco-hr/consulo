{
  if (getElement() == null)   return new StructureViewTreeElement[0];
  if (!getElement().isValid())   return new StructureViewTreeElement[0];
  List<StructureViewTreeElement> result=new ArrayList<StructureViewTreeElement>();
  StructureViewTreeElement[] baseChildren=getChildrenBase();
  result.addAll(Arrays.asList(baseChildren));
  StructureViewFactoryEx structureViewFactory=StructureViewFactoryEx.getInstance(getElement().getProject());
  Class<? extends PsiElement> aClass=getElement().getClass();
  List<StructureViewExtension> allExtensions=structureViewFactory.getAllExtensions(aClass);
  for (Iterator<StructureViewExtension> iterator=allExtensions.iterator(); iterator.hasNext(); ) {
    StructureViewExtension extension=iterator.next();
    StructureViewTreeElement[] children=extension.getChildren(getElement());
    if (children != null) {
      result.addAll(Arrays.asList(children));
    }
  }
  return result.toArray(new StructureViewTreeElement[result.size()]);
}
