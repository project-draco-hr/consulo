{
  final BackgroundTaskByVfsChangeManager backgroundTaskManager=BackgroundTaskByVfsChangeManager.getInstance(project);
  final BackgroundTaskByVfsChangeTask task=backgroundTaskManager.getTask(virtualFile);
  final EditorNotificationPanel panel=new EditorNotificationPanel(){
    @Override public Color getBackground(){
      return JBColor.LIGHT_GRAY;
    }
  }
;
  panel.setText(IdeBundle.message("background.task.editor.header",changeProvider.getName()));
  panel.createActionLabel(IdeBundle.message("background.task.button.configure"),new Runnable(){
    @Override public void run(){
      if (task != null) {
        BackgroundTaskByVfsParametersImpl parameters=new BackgroundTaskByVfsParametersImpl(project);
        parameters.set(task.getParameters());
        BackgroundTaskByVfsChangeDialog dialog=new BackgroundTaskByVfsChangeDialog(project,parameters);
        if (dialog.showAndGet()) {
          task.getParameters().set(parameters);
          ((BackgroundTaskByVfsChangeTaskImpl)task).parameterUpdated();
          updateNotify(task);
        }
      }
 else {
        BackgroundTaskByVfsParametersImpl parameters=new BackgroundTaskByVfsParametersImpl(project);
        changeProvider.setDefaultParameters(project,virtualFile,parameters);
        BackgroundTaskByVfsChangeDialog dialog=new BackgroundTaskByVfsChangeDialog(project,parameters);
        boolean b=dialog.showAndGet();
        if (b) {
          updateNotify(backgroundTaskManager.registerTask(virtualFile,changeProvider,parameters));
        }
      }
    }
  }
);
  if (task != null) {
    panel.createActionLabel(IdeBundle.message("background.task.button.cancel"),new Runnable(){
      @Override public void run(){
        backgroundTaskManager.cancelTask(task);
        updateNotify(task);
      }
    }
);
  }
  return panel;
}
