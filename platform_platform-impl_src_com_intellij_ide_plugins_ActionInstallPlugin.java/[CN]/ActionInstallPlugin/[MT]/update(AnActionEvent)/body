{
  Presentation presentation=e.getPresentation();
  IdeaPluginDescriptor[] selection=getPluginTable().getSelectedObjects();
  boolean enabled=(selection != null);
  if (enabled) {
    for (    IdeaPluginDescriptor descr : selection) {
      presentation.setText(IdeBundle.message("action.download.and.install.plugin"));
      presentation.setDescription(IdeBundle.message("action.download.and.install.plugin"));
      if (descr instanceof PluginNode) {
        enabled&=!PluginManagerColumnInfo.isDownloaded((PluginNode)descr);
        if (((PluginNode)descr).getStatus() == PluginNode.STATUS_INSTALLED) {
          presentation.setText(updateMessage);
          presentation.setDescription(updateMessage);
          enabled&=InstalledPluginsTableModel.hasNewerVersion(descr.getPluginId());
        }
      }
 else       if (descr instanceof IdeaPluginDescriptorImpl) {
        presentation.setText(updateMessage);
        presentation.setDescription(updateMessage);
        PluginId id=descr.getPluginId();
        enabled=enabled && InstalledPluginsTableModel.hasNewerVersion(id);
      }
    }
  }
  presentation.setEnabled(enabled);
}
