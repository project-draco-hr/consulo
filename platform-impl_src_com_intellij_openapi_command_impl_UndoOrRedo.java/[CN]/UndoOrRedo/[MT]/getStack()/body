{
  final DocumentReference[] documents=myEditor == null ? null : myManager.getDocumentReferences(myEditor);
  if (documents == null || documents.length == 0) {
    return getStackHolder().getGlobalStack();
  }
 else {
    long recentDocumentTimeStamp=-1;
    LinkedList<UndoableGroup> result=null;
    for (    DocumentReference docRef : documents) {
      LinkedList<UndoableGroup> stack=getStackHolder().getStack(docRef);
      if (!stack.isEmpty()) {
        long modificationStamp;
        if (docRef instanceof DocumentReferenceByDocument) {
          DocumentReferenceByDocument doc=(DocumentReferenceByDocument)docRef;
          modificationStamp=doc.getDocument().getModificationStamp();
        }
 else {
          modificationStamp=docRef.getFile().getModificationStamp();
        }
        if (recentDocumentTimeStamp < modificationStamp) {
          result=stack;
          recentDocumentTimeStamp=modificationStamp;
        }
      }
    }
    if (result != null) {
      return result;
    }
 else {
      throw new NothingToUndoException();
    }
  }
}
