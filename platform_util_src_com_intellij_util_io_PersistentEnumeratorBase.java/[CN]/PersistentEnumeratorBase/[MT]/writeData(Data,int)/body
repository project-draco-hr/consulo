{
  try {
    markDirty(true);
    final int dataOff=myKeyStorage != null ? (int)myKeyStorage.length() : ((InlineKeyDescriptor<Data>)myDataDescriptor).toInt(value);
    byte[] buf=prepareEntryRecordBuf(hashCode,dataOff);
    if (myKeyStorage != null) {
      final BufferExposingByteArrayOutputStream bos=new BufferExposingByteArrayOutputStream();
      DataOutput out=new DataOutputStream(bos);
      myDataDescriptor.save(out,value);
      myKeyStorage.put(dataOff,bos.getInternalBuffer(),0,bos.size());
    }
    final int pos=recordWriteOffset(buf);
    myStorage.put(pos,buf,0,buf.length);
    return pos;
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
