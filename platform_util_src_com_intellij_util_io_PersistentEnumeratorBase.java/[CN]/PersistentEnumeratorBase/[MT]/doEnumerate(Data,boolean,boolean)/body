{
  if (!saveNewValue) {
synchronized (ourEnumerationCache) {
      final Integer cachedId=ourEnumerationCache.get(sharedKey(value,this));
      if (cachedId != null)       return cachedId.intValue();
    }
  }
  final int id;
  try {
    id=enumerateImpl(value,onlyCheckForExisting,saveNewValue);
  }
 catch (  IOException io) {
    markCorrupted();
    throw io;
  }
catch (  Throwable e) {
    markCorrupted();
    LOG.error(e);
    throw new RuntimeException(e);
  }
  if (id != NULL_ID) {
synchronized (ourEnumerationCache) {
      ourEnumerationCache.put(new CacheKey(value,this),id);
    }
  }
  return id;
}
