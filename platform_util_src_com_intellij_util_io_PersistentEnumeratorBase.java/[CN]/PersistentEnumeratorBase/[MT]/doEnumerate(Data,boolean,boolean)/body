{
  if (!saveNewValue) {
synchronized (ourEnumerationCache) {
      final Integer cachedId=ourEnumerationCache.get(sharedKey(value,this));
      if (cachedId != null)       return cachedId.intValue();
    }
  }
  final int id;
synchronized (this) {
synchronized (ourLock) {
      id=enumerateImpl(value,onlyCheckForExisting,saveNewValue);
    }
  }
  if (id != NULL_ID) {
synchronized (ourEnumerationCache) {
      ourEnumerationCache.put(new CacheKey(value,this),id);
    }
  }
  return id;
}
