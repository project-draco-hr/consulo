{
  final PsiElement element=usage.getElement();
  if (element == null || !element.isValid())   return true;
  if (usage.reference instanceof PsiReferenceExpression) {
    PsiReferenceExpression refExpr=(PsiReferenceExpression)usage.reference;
    PsiExpression qualifier=refExpr.getQualifierExpression();
    if (qualifier != null) {
      if (usage.qualifierClass != null && PsiTreeUtil.getParentOfType(refExpr,PsiSwitchLabelStatement.class) == null) {
        changeQualifier(refExpr,usage.qualifierClass,usage.member);
      }
 else {
        final PsiReferenceParameterList parameterList=refExpr.getParameterList();
        if (parameterList != null && parameterList.getTypeArguments().length == 0) {
          refExpr.setQualifierExpression(null);
        }
 else {
          final Project project=element.getProject();
          final PsiClass targetClass=JavaPsiFacade.getInstance(project).findClass(options.getTargetClassName(),GlobalSearchScope.projectScope(project));
          if (targetClass != null) {
            changeQualifier(refExpr,targetClass,usage.member);
          }
        }
      }
    }
 else {
      if (usage.qualifierClass != null && PsiTreeUtil.getParentOfType(refExpr,PsiSwitchLabelStatement.class) == null) {
        changeQualifier(refExpr,usage.qualifierClass,usage.member);
      }
    }
    return true;
  }
  return false;
}
