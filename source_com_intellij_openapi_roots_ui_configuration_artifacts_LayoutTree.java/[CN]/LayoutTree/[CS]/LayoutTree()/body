{
  setCellEditor(new DefaultCellEditor(new JTextField()){
    @Override public Component getTreeCellEditorComponent(    JTree tree,    Object value,    boolean isSelected,    boolean expanded,    boolean leaf,    int row){
      final JTextField field=(JTextField)super.getTreeCellEditorComponent(tree,value,isSelected,expanded,leaf,row);
      final Object node=((DefaultMutableTreeNode)value).getUserObject();
      final PackagingElement<?> element=((PackagingElementNode)node).getFirstElement();
      final String name=((CompositePackagingElement)element).getName();
      field.setText(name);
      int i=name.lastIndexOf('.');
      field.setSelectionStart(0);
      field.setSelectionEnd(i != -1 ? i : name.length());
      return field;
    }
    @Override public boolean stopCellEditing(){
      final String newValue=((JTextField)editorComponent).getText();
      final TreePath path=getEditingPath();
      final Object node=getNodeFor(path);
      CompositePackagingElement currentElement=null;
      if (node instanceof PackagingElementNode) {
        final PackagingElement<?> element=((PackagingElementNode)node).getFirstElement();
        if (element instanceof CompositePackagingElement) {
          currentElement=(CompositePackagingElement)element;
        }
      }
      final boolean stopped=super.stopCellEditing();
      if (stopped && currentElement != null) {
        currentElement.rename(newValue);
        addSubtreeToUpdate((DefaultMutableTreeNode)path.getLastPathComponent());
      }
      return stopped;
    }
  }
);
}
