{
  GroovyPsiElementFactory factory=GroovyPsiElementFactory.getInstance(myProject);
  PsiType initializerType=mySettings.getSelectedType();
  IntroduceParameterUtil.processUsages(usages,this);
  final GrMethod toReplaceIn=(GrMethod)myContext.toReplaceIn;
  final PsiMethod toSearchFor=(PsiMethod)myContext.toSearchFor;
  final boolean methodsToProcessAreDifferent=toReplaceIn != toSearchFor;
  if (mySettings.generateDelegate()) {
    GroovyIntroduceParameterUtil.generateDelegate(toReplaceIn,myParameterInitializer,myProject);
    if (methodsToProcessAreDifferent) {
      final GrMethod method=GroovyIntroduceParameterUtil.generateDelegate(toSearchFor,myParameterInitializer,myProject);
      final PsiClass containingClass=method.getContainingClass();
      if (containingClass != null && containingClass.isInterface()) {
        final GrOpenBlock block=method.getBlock();
        if (block != null) {
          block.delete();
        }
      }
    }
  }
  LOG.assertTrue(initializerType == null || initializerType.isValid());
  final FieldConflictsResolver fieldConflictsResolver=new FieldConflictsResolver(mySettings.getName(),toReplaceIn.getBlock());
  IntroduceParameterUtil.changeMethodSignatureAndResolveFieldConflicts(new UsageInfo(toReplaceIn),usages,this);
  if (methodsToProcessAreDifferent) {
    IntroduceParameterUtil.changeMethodSignatureAndResolveFieldConflicts(new UsageInfo(toSearchFor),usages,this);
  }
  if (myContext.var != null)   myContext.var.delete();
  for (  UsageInfo usage : usages) {
    if (usage instanceof ChangedMethodCallInfo) {
      PsiElement element=usage.getElement();
      GroovyIntroduceParameterUtil.processChangedMethodCall(element,mySettings,myProject);
    }
 else     if (usage instanceof InternalUsageInfo) {
      PsiElement element=usage.getElement();
      if (element == null)       continue;
      GrExpression newExpr=factory.createExpressionFromText(mySettings.getName());
      if (element instanceof GrExpression) {
        ((GrExpression)element).replaceWithExpression(newExpr,true);
      }
 else {
        element.replace(newExpr);
      }
    }
  }
  if (myContext.var != null && mySettings.removeLocalVariable()) {
    myContext.var.delete();
  }
  fieldConflictsResolver.fix();
}
