{
  ArrayList<UsageInfo> result=new ArrayList<UsageInfo>();
  final PsiMethod toSearchFor=((PsiMethod)mySettings.getToSearchFor());
  if (!mySettings.generateDelegate()) {
    Collection<PsiReference> refs=MethodReferencesSearch.search(toSearchFor,GlobalSearchScope.projectScope(myProject),true).findAll();
    for (    PsiReference ref1 : refs) {
      PsiElement ref=ref1.getElement();
      if (ref instanceof PsiMethod && ((PsiMethod)ref).isConstructor()) {
        DefaultConstructorImplicitUsageInfo implicitUsageInfo=new DefaultConstructorImplicitUsageInfo((PsiMethod)ref,((PsiMethod)ref).getContainingClass(),toSearchFor);
        result.add(implicitUsageInfo);
      }
 else       if (ref instanceof PsiClass) {
        if (ref instanceof GrAnonymousClassDefinition) {
          result.add(new ExternalUsageInfo(((GrAnonymousClassDefinition)ref).getBaseClassReferenceGroovy()));
        }
 else         if (ref instanceof PsiAnonymousClass) {
          result.add(new ExternalUsageInfo(((PsiAnonymousClass)ref).getBaseClassReference()));
        }
 else {
          result.add(new NoConstructorClassUsageInfo((PsiClass)ref));
        }
      }
 else       if (!PsiTreeUtil.isAncestor(mySettings.getToReplaceIn(),ref,false)) {
        result.add(new ExternalUsageInfo(ref));
      }
 else {
        result.add(new ChangedMethodCallInfo(ref));
      }
    }
  }
  if (mySettings.replaceAllOccurrences()) {
    PsiElement[] exprs=GroovyIntroduceParameterUtil.getOccurrences(mySettings);
    for (    PsiElement expr : exprs) {
      result.add(new InternalUsageInfo(expr));
    }
  }
 else {
    if (mySettings.getExpression() != null) {
      result.add(new InternalUsageInfo(mySettings.getExpression()));
    }
  }
  Collection<PsiMethod> overridingMethods=OverridingMethodsSearch.search(toSearchFor,true).findAll();
  for (  PsiMethod overridingMethod : overridingMethods) {
    result.add(new UsageInfo(overridingMethod));
  }
  final UsageInfo[] usageInfos=result.toArray(new UsageInfo[result.size()]);
  return UsageViewUtil.removeDuplicatedUsages(usageInfos);
}
