{
  LOG.assertTrue(elementToFold.isValid());
  TextRange range=getRangeToFold(elementToFold);
  if (range == null)   return false;
  LOG.assertTrue(range.getStartOffset() >= 0 && range.getEndOffset() <= elementToFold.getContainingFile().getTextRange().getEndOffset());
  if (!allowOneLiners) {
    int startLine=document.getLineNumber(range.getStartOffset());
    int endLine=document.getLineNumber(range.getEndOffset() - 1);
    if (startLine < endLine) {
      map.put(elementToFold,range);
      return true;
    }
 else {
      return false;
    }
  }
 else {
    if (range.getEndOffset() - range.getStartOffset() > getFoldingText(elementToFold).length()) {
      map.put(elementToFold,range);
      return true;
    }
 else {
      return false;
    }
  }
}
