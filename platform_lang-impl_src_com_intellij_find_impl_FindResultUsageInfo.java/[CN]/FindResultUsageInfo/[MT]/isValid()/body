{
  if (!super.isValid())   return false;
  Document document=PsiDocumentManager.getInstance(getProject()).getDocument(getPsiFile());
  if (document == null) {
    myCachedResult=null;
    return false;
  }
  if (document.getModificationStamp() == myTimestamp && myCachedResult != null) {
    return myCachedResult;
  }
 else {
    myTimestamp=document.getModificationStamp();
  }
  Segment segment=super.getSegment();
  if (segment == null)   return myCachedResult=false;
  VirtualFile file=getPsiFile().getVirtualFile();
  Segment searchOffset;
  if (myAnchor != null) {
    searchOffset=myAnchor.getRange();
    if (searchOffset == null)     return myCachedResult=false;
  }
 else {
    searchOffset=segment;
  }
  int offset=searchOffset.getStartOffset();
  FindResult result;
  Long data=myFindModel.getUserData(ourDocumentTimestampKey);
  if (data == null || data != myTimestamp) {
    data=myTimestamp;
    myFindModel.putUserData(FindManagerImpl.ourCommentsLiteralsSearchDataKey,null);
  }
  myFindModel.putUserData(ourDocumentTimestampKey,data);
  do {
    result=myFindManager.findString(document.getCharsSequence(),offset,myFindModel,file);
    offset=result.getEndOffset() == offset ? offset + 1 : result.getEndOffset();
    if (!result.isStringFound())     return myCachedResult=false;
  }
 while (result.getStartOffset() < segment.getStartOffset());
  return myCachedResult=(segment.getStartOffset() == result.getStartOffset() && segment.getEndOffset() == result.getEndOffset());
}
