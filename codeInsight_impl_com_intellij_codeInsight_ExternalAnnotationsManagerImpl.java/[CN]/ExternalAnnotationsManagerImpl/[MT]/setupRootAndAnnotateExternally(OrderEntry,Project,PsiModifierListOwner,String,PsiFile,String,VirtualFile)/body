{
  final FileChooserDescriptor descriptor=FileChooserDescriptorFactory.createSingleFolderDescriptor();
  descriptor.setTitle(ProjectBundle.message("external.annotations.root.chooser.title",entry.getPresentableName()));
  descriptor.setDescription(ProjectBundle.message("external.annotations.root.chooser.description"));
  final VirtualFile[] files=FileChooser.chooseFiles(project,descriptor);
  if (files.length > 0) {
    new WriteCommandAction(project){
      protected void run(      final Result result) throws Throwable {
        if (files[0] != null) {
          appendChosenAnnotationsRoot(entry,files[0]);
          final List<XmlFile> xmlFiles=findExternalAnnotationsFile(listOwner);
          if (xmlFiles != null) {
            if (ReadonlyStatusHandler.getInstance(project).ensureFilesWritable(xmlFiles.get(0).getVirtualFile()).hasReadonlyFiles()) {
              return;
            }
            annotateExternally(listOwner,annotationFQName,xmlFiles.get(0),fromFile);
          }
 else {
            final XmlFile annotationsXml=createAnnotationsXml(files[0],packageName);
            if (annotationsXml != null) {
              final List<XmlFile> createdFiles=new ArrayList<XmlFile>();
              createdFiles.add(annotationsXml);
              myExternalAnotations.put(virtualFile,createdFiles);
            }
            annotateExternally(listOwner,annotationFQName,annotationsXml,fromFile);
          }
        }
      }
    }
.execute();
  }
}
