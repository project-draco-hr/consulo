{
  if (!element.isPhysical())   return AnnotationPlace.IN_CODE;
  if (!element.getManager().isInProject(element))   return AnnotationPlace.EXTERNAL;
  final Project project=element.getProject();
  final VirtualFile virtualFile=element.getContainingFile().getVirtualFile();
  LOG.assertTrue(virtualFile != null);
  final List<OrderEntry> entries=ProjectRootManager.getInstance(project).getFileIndex().getOrderEntriesForFile(virtualFile);
  if (!entries.isEmpty()) {
    for (    OrderEntry entry : entries) {
      if (!(entry instanceof ModuleOrderEntry)) {
        if (entry.getUrls(OrderRootType.ANNOTATIONS).length > 0) {
          return AnnotationPlace.EXTERNAL;
        }
        break;
      }
    }
  }
  final MyExternalPromptDialog dialog=new MyExternalPromptDialog(project);
  if (dialog.isToBeShown()) {
    dialog.show();
    if (dialog.getExitCode() == 2) {
      return AnnotationPlace.EXTERNAL;
    }
 else     if (dialog.getExitCode() == 1) {
      return AnnotationPlace.NOWHERE;
    }
  }
  return AnnotationPlace.IN_CODE;
}
