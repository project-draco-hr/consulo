{
  final Project project=listOwner.getProject();
  final PsiManager psiManager=PsiManager.getInstance(project);
  final PsiFile containingFile=listOwner.getContainingFile();
  if (containingFile instanceof PsiJavaFile) {
    final PsiJavaFile javaFile=(PsiJavaFile)containingFile;
    final String packageName=javaFile.getPackageName();
    final PsiPackage psiPackage=psiManager.findPackage(packageName);
    if (psiPackage != null) {
      final Module module=ModuleUtil.findModuleForPsiElement(javaFile);
      final PsiDirectory[] dirsWithExternalAnnotations=module != null ? psiPackage.getDirectories(GlobalSearchScope.moduleScope(module)) : psiPackage.getDirectories();
      for (      final PsiDirectory directory : dirsWithExternalAnnotations) {
        final PsiFile psiFile=directory.findFile(ANNOTATIONS_XML);
        if (psiFile instanceof XmlFile) {
          return (XmlFile)psiFile;
        }
      }
    }
    final VirtualFile virtualFile=containingFile.getVirtualFile();
    if (virtualFile != null) {
      final List<OrderEntry> entries=ProjectRootManager.getInstance(project).getFileIndex().getOrderEntriesForFile(virtualFile);
      for (      OrderEntry entry : entries) {
        if (!(entry instanceof ModuleOrderEntry)) {
          final String[] externalUrls=entry.getUrls(OrderRootType.ANNOTATIONS);
          for (          String url : externalUrls) {
            final VirtualFile ext=LocalFileSystem.getInstance().findFileByPath(VfsUtil.urlToPath(url) + "/" + packageName.replace(".","/")+ "/"+ ANNOTATIONS_XML);
            if (ext != null) {
              final PsiFile psiFile=psiManager.findFile(ext);
              if (psiFile instanceof XmlFile) {
                return (XmlFile)psiFile;
              }
            }
          }
          break;
        }
      }
    }
  }
  return null;
}
