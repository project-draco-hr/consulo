{
  final Project project=listOwner.getProject();
  final PsiFile containingFile=listOwner.getContainingFile();
  if (containingFile instanceof PsiJavaFile) {
    final VirtualFile virtualFile=containingFile.getVirtualFile();
    if (myExternalAnotations.containsKey(virtualFile)) {
      final XmlFile xmlFile=myExternalAnotations.get(virtualFile);
      if (xmlFile != null && xmlFile.isValid()) {
        return xmlFile;
      }
    }
    final PsiJavaFile javaFile=(PsiJavaFile)containingFile;
    final String packageName=javaFile.getPackageName();
    final PsiPackage psiPackage=myPsiManager.findPackage(packageName);
    if (psiPackage != null) {
      final Module module=ModuleUtil.findModuleForPsiElement(javaFile);
      final PsiDirectory[] dirsWithExternalAnnotations=module != null ? psiPackage.getDirectories(GlobalSearchScope.moduleScope(module)) : psiPackage.getDirectories();
      for (      final PsiDirectory directory : dirsWithExternalAnnotations) {
        final PsiFile psiFile=directory.findFile(ANNOTATIONS_XML);
        if (psiFile instanceof XmlFile) {
          myExternalAnotations.put(virtualFile,(XmlFile)psiFile);
          return (XmlFile)psiFile;
        }
      }
    }
    if (virtualFile != null) {
      final List<OrderEntry> entries=ProjectRootManager.getInstance(project).getFileIndex().getOrderEntriesForFile(virtualFile);
      for (      OrderEntry entry : entries) {
        if (!(entry instanceof ModuleOrderEntry)) {
          final String[] externalUrls=entry.getUrls(OrderRootType.ANNOTATIONS);
          for (          String url : externalUrls) {
            final VirtualFile ext=LocalFileSystem.getInstance().findFileByPath(VfsUtil.urlToPath(url) + "/" + packageName.replace(".","/")+ "/"+ ANNOTATIONS_XML);
            if (ext != null) {
              final PsiFile psiFile=myPsiManager.findFile(ext);
              if (psiFile instanceof XmlFile) {
                myExternalAnotations.put(virtualFile,(XmlFile)psiFile);
                return (XmlFile)psiFile;
              }
            }
          }
          break;
        }
      }
      myExternalAnotations.put(virtualFile,null);
    }
  }
  return null;
}
