{
  if (fst.equals(snd))   return true;
  if (fst.isValid() && fst.isPhysical() || snd.isValid() && snd.isPhysical())   return false;
  if (fst.getTextLength() != snd.getTextLength())   return false;
  if (fst.getStartOffsetInParent() != snd.getStartOffsetInParent())   return false;
  final PsiElement parent1=fst.getParent();
  final PsiElement parent2=snd.getParent();
  if (parent1 == null || parent2 == null || !xmlElementsEqual(parent1,parent2)) {
    return false;
  }
  if (parent1 instanceof XmlElement && parent2 instanceof XmlElement && (fst.getUserData(XmlElement.INCLUDING_ELEMENT) != null || snd.getUserData(XmlElement.INCLUDING_ELEMENT) != null)) {
    return getChildIndex(fst,(XmlElement)parent1) == getChildIndex(snd,(XmlElement)parent2);
  }
  return true;
}
