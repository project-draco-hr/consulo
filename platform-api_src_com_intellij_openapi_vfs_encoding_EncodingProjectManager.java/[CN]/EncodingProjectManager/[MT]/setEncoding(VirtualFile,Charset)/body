{
  if (charset == null) {
    myMapping.remove(virtualFileOrDir);
  }
 else {
    myMapping.put(virtualFileOrDir,charset);
  }
  if (virtualFileOrDir != null && !virtualFileOrDir.isDirectory()) {
    virtualFileOrDir.setCharset(charset);
    virtualFileOrDir.setBOM(null);
    FileDocumentManager documentManager=FileDocumentManager.getInstance();
    if (documentManager.isFileModified(virtualFileOrDir)) {
      Document document=documentManager.getDocument(virtualFileOrDir);
      if (document != null) {
        documentManager.saveDocument(document);
      }
    }
 else {
      ((VirtualFileListener)documentManager).contentsChanged(new VirtualFileEvent(null,virtualFileOrDir,virtualFileOrDir.getName(),virtualFileOrDir.getParent()));
    }
  }
}
