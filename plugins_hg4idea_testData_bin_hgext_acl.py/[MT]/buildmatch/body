def buildmatch(ui, repo, user, key):
    'return tuple of (match function, list enabled).'
    if (not ui.has_section(key)):
        ui.debug(('acl: %s not enabled\n' % key))
        return None
    pats = [pat for (pat, users) in ui.configitems(key) if ((users == '*') or (user in users.replace(',', ' ').split()))]
    ui.debug(('acl: %s enabled, %d entries for user %s\n' % (key, len(pats), user)))
    if pats:
        return match.match(repo.root, '', pats)
    return match.exact(repo.root, '', [])
