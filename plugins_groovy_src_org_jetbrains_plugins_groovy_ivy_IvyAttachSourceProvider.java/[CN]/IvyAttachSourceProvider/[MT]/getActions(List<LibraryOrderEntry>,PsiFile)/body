{
  VirtualFile jar=getJarByPsiFile(psiFile);
  if (jar == null)   return Collections.emptyList();
  VirtualFile jarsDir=jar.getParent();
  if (jarsDir == null || !jarsDir.getName().equals("jars"))   return Collections.emptyList();
  String jarNameWithoutExt=jar.getNameWithoutExtension();
  final VirtualFile artifactDir=jarsDir.getParent();
  if (artifactDir == null)   return Collections.emptyList();
  String artifactName=artifactDir.getName();
  if (!jarNameWithoutExt.startsWith(artifactName) || !jarNameWithoutExt.substring(artifactName.length()).startsWith("-")) {
    return Collections.emptyList();
  }
  String version=jarNameWithoutExt.substring(artifactName.length() + 1);
  VirtualFile propertiesFile=artifactDir.findChild("ivydata-" + version + ".properties");
  if (propertiesFile == null)   return Collections.emptyList();
  final Library library=getLibraryFromOrderEntriesList(orderEntries);
  if (library == null)   return Collections.emptyList();
  final String sourceFileName=artifactName + '-' + version+ "-sources.jar";
  final VirtualFile sources=artifactDir.findChild("sources");
  if (sources != null) {
    VirtualFile srcFile=sources.findChild(sourceFileName);
    if (srcFile != null) {
      VirtualFile jarRoot=ArchiveVfsUtil.getJarRootForLocalFile(srcFile);
      if (jarRoot == null || ArrayUtil.contains(jarRoot,library.getFiles(OrderRootType.SOURCES))) {
        return Collections.emptyList();
      }
      return Collections.<AttachSourcesAction>singleton(new AttachExistingSourceAction(jarRoot,library,"Attache sources from Ivy repository"));
    }
  }
  PsiFile propertiesFileFile=psiFile.getManager().findFile(propertiesFile);
  if (!(propertiesFileFile instanceof PropertiesFile))   return Collections.emptyList();
  final String url=extractUrl((PropertiesFile)propertiesFileFile,artifactName);
  if (StringUtil.isEmptyOrSpaces(url))   return Collections.emptyList();
  return Collections.<AttachSourcesAction>singleton(new DownloadSourcesAction(psiFile.getProject(),"Downloading Ivy Sources",url){
    @Override protected void storeFile(    byte[] content){
      try {
        VirtualFile existingSourcesFolder=sources;
        if (existingSourcesFolder == null) {
          existingSourcesFolder=artifactDir.createChildDirectory(this,"sources");
        }
        VirtualFile srcFile=existingSourcesFolder.createChildData(this,sourceFileName);
        srcFile.setBinaryContent(content);
        addSourceFile(ArchiveVfsUtil.getJarRootForLocalFile(srcFile),library);
      }
 catch (      IOException e) {
        new Notification(myMessageGroupId,"IO Error","Failed to save " + artifactDir.getPath() + "/sources/"+ sourceFileName,NotificationType.ERROR).notify(myProject);
        LOG.warn(e);
      }
    }
  }
);
}
