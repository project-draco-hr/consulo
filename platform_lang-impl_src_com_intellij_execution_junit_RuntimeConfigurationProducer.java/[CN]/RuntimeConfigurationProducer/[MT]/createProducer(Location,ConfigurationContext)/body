{
  final RuntimeConfigurationProducer result=clone();
  result.myConfiguration=location != null ? result.createConfigurationByElement(location,context) : null;
  if (result.myConfiguration != null) {
    final PsiElement psiElement=result.getSourceElement();
    final Location<PsiElement> _location=PsiLocation.fromPsiElement(psiElement,location != null ? location.getModule() : null);
    if (_location != null) {
      final ConfigurationType type=result.myConfiguration.getType();
      if (type instanceof LocatableConfigurationType) {
        final RunManagerEx runManager=RunManagerEx.getInstanceEx(context.getProject());
        final RunnerAndConfigurationSettingsImpl[] configurations=runManager.getConfigurationSettings(type);
        for (        final RunnerAndConfigurationSettingsImpl configuration : configurations) {
          if (((LocatableConfigurationType)type).isConfigurationByLocation(configuration.getConfiguration(),_location)) {
            result.myConfiguration=configuration;
            break;
          }
        }
      }
    }
  }
  return result;
}
