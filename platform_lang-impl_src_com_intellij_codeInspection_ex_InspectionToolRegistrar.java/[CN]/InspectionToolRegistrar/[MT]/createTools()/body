{
  ensureInitialized();
  final List<InspectionTool> tools=Lists.newArrayListWithCapacity(myInspectionToolFactories.size());
  final Set<Factory<InspectionTool>> broken=Sets.newHashSet();
  for (  final Factory<InspectionTool> factory : myInspectionToolFactories) {
    ProgressManager.checkCanceled();
    final InspectionTool toolWrapper=factory.create();
    if (toolWrapper != null && checkTool(toolWrapper)) {
      tools.add(toolWrapper);
    }
 else {
      broken.add(factory);
    }
  }
  myInspectionToolFactories.removeAll(broken);
  buildInspectionIndex(tools);
  return tools;
}
