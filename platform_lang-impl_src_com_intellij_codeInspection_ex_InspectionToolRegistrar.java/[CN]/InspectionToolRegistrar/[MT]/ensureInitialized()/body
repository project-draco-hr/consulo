{
  if (!myInspectionComponentsLoaded.getAndSet(true)) {
    Set<InspectionToolProvider> providers=new THashSet<InspectionToolProvider>();
    ContainerUtil.addAll(providers,ApplicationManager.getApplication().getComponents(InspectionToolProvider.class));
    ContainerUtil.addAll(providers,Extensions.getExtensions(InspectionToolProvider.EXTENSION_POINT_NAME));
    registerTools(providers.toArray(new InspectionToolProvider[providers.size()]));
    for (    final LocalInspectionEP ep : Extensions.getExtensions(LocalInspectionEP.LOCAL_INSPECTION)) {
      myInspectionToolFactories.add(new Factory<InspectionToolWrapper>(){
        @Override public InspectionToolWrapper create(){
          return new LocalInspectionToolWrapper(ep);
        }
      }
);
    }
    for (    final InspectionEP ep : Extensions.getExtensions(InspectionEP.GLOBAL_INSPECTION)) {
      myInspectionToolFactories.add(new Factory<InspectionToolWrapper>(){
        @Override public InspectionToolWrapper create(){
          return new GlobalInspectionToolWrapper(ep);
        }
      }
);
    }
    for (    final InspectionEP ep : Extensions.getExtensions(SPECIAL_TOOL)) {
      myInspectionToolFactories.add(new Factory<InspectionToolWrapper>(){
        @Override public InspectionToolWrapper create(){
          return new CommonInspectionToolWrapper(ep);
        }
      }
);
    }
    for (    InspectionToolsFactory factory : Extensions.getExtensions(InspectionToolsFactory.EXTENSION_POINT_NAME)) {
      for (      final InspectionProfileEntry profileEntry : factory.createTools()) {
        myInspectionToolFactories.add(new Factory<InspectionToolWrapper>(){
          public InspectionToolWrapper create(){
            return wrapTool(profileEntry);
          }
        }
);
      }
    }
  }
}
