{
  String url="/projects/" + myProjectId + "/issues.xml?";
  final boolean hasKey=!StringUtil.isEmpty(myAPIKey) && !isUseHttpAuthentication();
  if (hasKey) {
    url+="key=" + myAPIKey;
  }
  if (hasKey)   url+="&";
  url+=encodeUrl("fields[]") + "=status_id&" + encodeUrl("operators[status_id]")+ "=o&"+ encodeUrl("values[status_id][]")+ "=1";
  final boolean hasQuery=!StringUtil.isEmpty(query);
  if (hasQuery) {
    url+="&" + encodeUrl("fields[]") + "=subject&"+ encodeUrl("operators[subject]")+ "="+ encodeUrl("~")+ "&"+ encodeUrl("values[subject][]")+ "="+ encodeUrl(query);
  }
  if (max >= 0) {
    url+="&per_page=" + encodeUrl(String.valueOf(max));
  }
  HttpMethod method=doREST(url,false);
  final String response=method.getResponseBodyAsString();
  final Reader stream=new StringReader(response);
  final InputSource source=new InputSource(stream);
  source.setEncoding("UTF-8");
  Element element;
  try {
    element=new SAXBuilder(false).build(source).getRootElement();
  }
 catch (  Throwable t) {
    LOG.error("Error fetching issues for: " + url + ", HTTP status code: "+ method.getStatusCode(),t,response);
    throw new Exception("Error fetching issues for: " + url + ", HTTP status code: "+ method.getStatusCode()+ "\n"+ response);
  }
  if (!"issues".equals(element.getName())) {
    LOG.warn("Error fetching issues for: " + url + ", HTTP status code: "+ method.getStatusCode());
    throw new Exception("Error fetching issues for: " + url + ", HTTP status code: "+ method.getStatusCode()+ "\n"+ element.getText());
  }
  return element.getChildren("issue");
}
