{
  final PsiLanguageInjectionHost host=findInjectionHost(editor,file);
  if (host == null)   return;
  if (defaultFunctionalityWorked(host,languageId))   return;
  final Language language=InjectedLanguage.findLanguageById(languageId);
  try {
    for (    LanguageInjectionSupport support : Extensions.getExtensions(LanguageInjectionSupport.EP_NAME)) {
      if (support.addInjectionInPlace(language,host))       return;
    }
    TemporaryPlacesRegistry.getInstance(project).addHostWithUndo(host,InjectedLanguage.create(languageId));
  }
  finally {
    FileContentUtil.reparseFiles(project,Collections.<VirtualFile>emptyList(),true);
  }
}
