{
  if (editor instanceof EditorWindow)   return null;
  final int offset=editor.getCaretModel().getOffset();
  final PsiLanguageInjectionHost host=PsiTreeUtil.getParentOfType(file.findElementAt(offset),PsiLanguageInjectionHost.class,false);
  if (host == null)   return null;
  return host.isValidHost() ? host : null;
}
