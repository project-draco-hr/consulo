{
  if (editor instanceof EditorWindow)   return null;
  final int offset=editor.getCaretModel().getOffset();
  final PsiLanguageInjectionHost host=PsiTreeUtil.getParentOfType(file.findElementAt(offset),PsiLanguageInjectionHost.class,false);
  if (host == null)   return null;
  final ElementManipulator<PsiLanguageInjectionHost> manipulator=ElementManipulators.getManipulator(host);
  if (manipulator == null)   return null;
  if (file.getFileType() != StdFileTypes.XML) {
    final TextRange textRange=manipulator.getRangeInElement(host);
    if (textRange.getStartOffset() == 0)     return null;
  }
  return host;
}
