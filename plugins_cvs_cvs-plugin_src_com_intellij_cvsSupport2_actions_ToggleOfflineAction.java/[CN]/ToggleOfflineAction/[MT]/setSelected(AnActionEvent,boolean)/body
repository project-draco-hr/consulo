{
  CvsContext cvsContext=CvsContextWrapper.createInstance(e);
  final CvsEntriesManager entriesManager=CvsEntriesManager.getInstance();
  final VirtualFile file=cvsContext.getSelectedFile();
  if (file == null)   return;
  final VirtualFile firstDirInChain=file.isDirectory() ? file : file.getParent();
  if (firstDirInChain == null)   return;
  CvsConnectionSettings settings=entriesManager.getCvsConnectionSettingsFor(firstDirInChain);
  if (!settings.isValid()) {
    entriesManager.clearCachedEntriesFor(firstDirInChain);
    settings=entriesManager.getCvsConnectionSettingsFor(firstDirInChain);
  }
  if ((settings != null) && settings.isValid() && (state != settings.isOffline())) {
    ChangesViewBalloonProblemNotifier.showMe(cvsContext.getProject(),state ? CvsBundle.message("set.offline.notification.text") : CvsBundle.message("set.online.notification.text"),state ? MessageType.WARNING : MessageType.INFO);
    settings.setOffline(state);
  }
}
