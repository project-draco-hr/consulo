{
  Icon icon=originalIcon;
  VirtualFile currentRoot=null;
  for (  ContentFolder contentFolder : entry.getFolders()) {
    final VirtualFile contentPath=contentFolder.getFile();
    if (file.equals(contentPath)) {
      icon=ContentFolderIconUtil.getRootIcon(contentFolder.getType());
    }
 else     if (contentPath != null && VfsUtilCore.isAncestor(contentPath,file,true)) {
      if (currentRoot != null && VfsUtilCore.isAncestor(contentPath,currentRoot,false)) {
        continue;
      }
switch (contentFolder.getType()) {
case EXCLUDED:
        icon=AllIcons.Modules.ExcludeRoot;
      break;
case PRODUCTION:
case PRODUCTION_RESOURCE:
case TEST:
case TEST_RESOURCE:
    for (    ModuleExtension moduleExtension : myTreeEditor.getContentEntryEditor().getModel().getExtensions()) {
      for (      PsiPackageSupportProvider supportProvider : PsiPackageSupportProvider.EP_NAME.getExtensions()) {
        if (supportProvider.getSupportedModuleExtensionClass().isAssignableFrom(moduleExtension.getClass())) {
          icon=ArrayUtil.contains(contentFolder.getType(),ContentFolderType.ONLY_TEST_ROOTS) ? AllIcons.Nodes.TestPackage : AllIcons.Nodes.Package;
        }
      }
    }
  break;
}
currentRoot=contentPath;
}
}
return icon;
}
