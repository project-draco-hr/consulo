{
  Icon icon=originalIcon;
  VirtualFile currentRoot=null;
  for (  ContentFolder contentFolder : entry.getFolders(ContentFolderScopes.all())) {
    final VirtualFile contentPath=contentFolder.getFile();
    if (file.equals(contentPath)) {
      icon=contentFolder.getType().getIcon(contentFolder.getProperties());
    }
 else     if (contentPath != null && VfsUtilCore.isAncestor(contentPath,file,true)) {
      if (currentRoot != null && VfsUtilCore.isAncestor(contentPath,currentRoot,false)) {
        continue;
      }
      boolean hasSupport=false;
      for (      ModuleExtension moduleExtension : myTreeEditor.getContentEntryEditor().getModel().getExtensions()) {
        for (        PsiPackageSupportProvider supportProvider : PsiPackageSupportProvider.EP_NAME.getExtensions()) {
          if (supportProvider.isSupported(moduleExtension)) {
            hasSupport=true;
            break;
          }
        }
      }
      icon=hasSupport ? contentFolder.getType().getChildDirectoryIcon(null) : AllIcons.Nodes.TreeOpen;
      currentRoot=contentPath;
    }
  }
  return icon;
}
