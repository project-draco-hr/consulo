{
  if (myInMemoryMode.get()) {
synchronized (myInMemoryKeys) {
      Collection<Key> keys=myInMemoryKeys.get(inputId);
      if (keys != null) {
        return keys;
      }
    }
  }
  if (myHasSnapshotMapping) {
    return null;
  }
  if (SharedIndicesData.ourFileSharedIndicesEnabled) {
    Collection<Key> keys=SharedIndicesData.recallFileData(inputId,myIndexId,mySnapshotIndexExternalizer);
    if (myInputsIndex != null) {
      Collection<Key> keysFromInputsIndex=myInputsIndex.get(inputId);
      if ((keys == null && keysFromInputsIndex != null) || !DebugAssertions.equals(keysFromInputsIndex,keys,myExtension.getKeyDescriptor())) {
        SharedIndicesData.associateFileData(inputId,myIndexId,keysFromInputsIndex,mySnapshotIndexExternalizer);
        if (keys != null) {
          DebugAssertions.error("Unexpected indexing diff " + myIndexId + ", file:"+ IndexInfrastructure.findFileById(PersistentFS.getInstance(),inputId)+ ","+ keysFromInputsIndex+ ","+ keys);
        }
        keys=keysFromInputsIndex;
      }
    }
    return keys;
  }
  return myInputsIndex.get(inputId);
}
