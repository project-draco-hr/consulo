{
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    task.run(new EmptyProgressIndicator());
    task.onSuccess();
  }
 else   if (task.isConditionalModal() && !task.shouldStartInBackground()) {
    ProgressManager.getInstance().run(task);
  }
 else {
    boolean hadActiveTask;
synchronized (myQueue) {
      hadActiveTask=myHasActiveTask;
      myQueue.offer(task);
      myHasActiveTask=true;
    }
    if (!hadActiveTask) {
      if (ApplicationManager.getApplication().isDispatchThread()) {
        ProgressManager.getInstance().run(myRunnerTask);
      }
 else {
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          public void run(){
            if (myProject == null || !myProject.isDisposed()) {
              ProgressManager.getInstance().run(myRunnerTask);
            }
          }
        }
);
      }
    }
  }
}
