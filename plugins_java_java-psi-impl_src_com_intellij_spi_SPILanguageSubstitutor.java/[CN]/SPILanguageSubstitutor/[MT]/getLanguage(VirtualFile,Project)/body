{
  final Module moduleForPsiElement=ModuleUtilCore.findModuleForFile(file,project);
  if (moduleForPsiElement == null) {
    return null;
  }
  final VirtualFile parent=file.getParent();
  if (parent != null && "services".equals(parent.getName())) {
    final VirtualFile gParent=parent.getParent();
    if (gParent != null && SpecialDirUtil.META_INF.equals(gParent.getName())) {
      final List<VirtualFile> virtualFiles=SpecialDirUtil.collectSpecialDirs(moduleForPsiElement,SpecialDirUtil.META_INF);
      if (!virtualFiles.contains(gParent)) {
        return null;
      }
      for (      Condition<VirtualFile> condition : VETO_EP_NAME.getExtensions()) {
        if (condition.value(file)) {
          return null;
        }
      }
      return SPILanguage.INSTANCE;
    }
  }
  return null;
}
