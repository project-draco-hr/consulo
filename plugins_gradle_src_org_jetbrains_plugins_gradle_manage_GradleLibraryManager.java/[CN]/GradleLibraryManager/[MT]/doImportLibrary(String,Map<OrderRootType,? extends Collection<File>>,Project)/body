{
  final LibraryTable libraryTable=myPlatformFacade.getProjectLibraryTable(project);
  final Ref<Library> result=new Ref<Library>();
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      final LibraryTable.ModifiableModel projectLibraryModel=libraryTable.getModifiableModel();
      final Library intellijLibrary;
      try {
        intellijLibrary=projectLibraryModel.createLibrary(libraryName);
        result.set(intellijLibrary);
      }
  finally {
        projectLibraryModel.commit();
      }
      final Library.ModifiableModel libraryModel=intellijLibrary.getModifiableModel();
      try {
        registerPaths(libraryFiles,libraryModel,libraryName);
      }
  finally {
        libraryModel.commit();
      }
    }
  }
);
  return result.get();
}
