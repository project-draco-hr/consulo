{
  final Set<PluginId> notInstalled=new HashSet<PluginId>();
  final Set<PluginId> disabledIds=new HashSet<PluginId>();
  final PluginId[] dependentPluginIds=pluginDescriptor.getDependentPluginIds();
  final PluginId[] optionalDependentPluginIds=pluginDescriptor.getOptionalDependentPluginIds();
  for (  PluginId id : dependentPluginIds) {
    if (Arrays.binarySearch(optionalDependentPluginIds,id) > -1)     continue;
    final boolean disabled=((InstalledPluginsTableModel)pluginsModel).isDisabled(id);
    final boolean enabled=((InstalledPluginsTableModel)pluginsModel).isEnabled(id);
    if (!enabled && !disabled && !PluginManager.isModuleDependency(id)) {
      notInstalled.add(id);
    }
 else     if (disabled) {
      disabledIds.add(id);
    }
  }
  if (!notInstalled.isEmpty()) {
    Messages.showErrorDialog("Plugin " + pluginDescriptor.getName() + " depends on unknown plugin"+ (notInstalled.size() > 1 ? "s " : " ")+ StringUtil.join(notInstalled,new Function<PluginId,String>(){
      @Override public String fun(      PluginId id){
        return id.toString();
      }
    }
,", "),CommonBundle.getWarningTitle());
  }
  if (!disabledIds.isEmpty()) {
    final Set<IdeaPluginDescriptor> dependencies=new HashSet<IdeaPluginDescriptor>();
    for (    IdeaPluginDescriptor ideaPluginDescriptor : pluginsModel.view) {
      if (disabledIds.contains(ideaPluginDescriptor.getPluginId())) {
        dependencies.add(ideaPluginDescriptor);
      }
    }
    final String disabledPluginsMessage="disabled plugin" + (dependencies.size() > 1 ? "s " : " ");
    String message="Plugin " + pluginDescriptor.getName() + " depends on "+ disabledPluginsMessage+ StringUtil.join(dependencies,new Function<IdeaPluginDescriptor,String>(){
      @Override public String fun(      IdeaPluginDescriptor ideaPluginDescriptor){
        return ideaPluginDescriptor.getName();
      }
    }
,", ")+ ". Enable "+ disabledPluginsMessage.trim()+ "?";
    if (Messages.showOkCancelDialog(myActionsPanel,message,CommonBundle.getWarningTitle(),Messages.getWarningIcon()) == DialogWrapper.OK_EXIT_CODE) {
      ((InstalledPluginsTableModel)pluginsModel).enableRows(dependencies.toArray(new IdeaPluginDescriptor[dependencies.size()]),Boolean.TRUE);
    }
  }
}
