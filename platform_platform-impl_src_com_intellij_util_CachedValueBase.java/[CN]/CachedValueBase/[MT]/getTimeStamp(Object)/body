{
  if (dependency instanceof ModificationTracker) {
    return ((ModificationTracker)dependency).getModificationCount();
  }
 else   if (dependency instanceof CachedValueBase) {
    Data data=((CachedValueBase)dependency).getData();
    return data == null || !isUpToDate(data) ? -1 : data.myTimestamp;
  }
 else   if (dependency instanceof Reference) {
    final Object original=((Reference)dependency).get();
    if (original == null)     return -1;
    return getTimeStamp(original);
  }
 else   if (dependency instanceof Ref) {
    final Object original=((Ref)dependency).get();
    if (original == null)     return -1;
    return getTimeStamp(original);
  }
 else   if (dependency instanceof Document) {
    return ((Document)dependency).getModificationStamp();
  }
 else {
    LOG.error("Wrong dependency type: " + dependency.getClass());
    return -1;
  }
}
