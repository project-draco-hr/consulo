{
  if (scope1 instanceof LocalSearchScope) {
    if (scope2 instanceof LocalSearchScope) {
      return ((LocalSearchScope)scope1).intersectWith((LocalSearchScope)scope2);
    }
 else {
      return intersection(scope2,scope1);
    }
  }
 else   if (scope2 instanceof LocalSearchScope) {
    LocalSearchScope _scope2=(LocalSearchScope)scope2;
    PsiElement[] elements2=_scope2.getScope();
    List<PsiElement> result=new ArrayList<PsiElement>();
    for (    final PsiElement element2 : elements2) {
      if (PsiSearchScopeUtil.isInScope(scope1,element2)) {
        result.add(element2);
      }
    }
    return new LocalSearchScope(result.toArray(new PsiElement[result.size()]),null,_scope2.isIgnoreInjectedPsi());
  }
 else {
    return ((GlobalSearchScope)scope1).intersectWith((GlobalSearchScope)scope2);
  }
}
