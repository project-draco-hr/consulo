{
  ProgressIndicator indicator=ProgressManager.getInstance().getProgressIndicator();
  if (indicator != null) {
    indicator.pushState();
    indicator.setText(IdeBundle.message("progress.scanning.files"));
  }
  List<List<VirtualFile>> updateSets=new ArrayList<List<VirtualFile>>();
  for (  CacheUpdater updater : myUpdaters) {
    try {
      List<VirtualFile> updaterFiles=Arrays.asList(updater.queryNeededFiles());
      updateSets.add(updaterFiles);
      myFilesToUpdate.addAll(updaterFiles);
    }
 catch (    ProcessCanceledException e) {
      throw e;
    }
catch (    Throwable e) {
      LOG.error(e);
    }
  }
  myContentSets=new CacheUpdateSets(updateSets);
  myIndexingSets=new CacheUpdateSets(updateSets);
  if (indicator != null) {
    indicator.popState();
  }
  if (myFilesToUpdate.isEmpty()) {
    updatingDone();
  }
  return myFilesToUpdate.size();
}
