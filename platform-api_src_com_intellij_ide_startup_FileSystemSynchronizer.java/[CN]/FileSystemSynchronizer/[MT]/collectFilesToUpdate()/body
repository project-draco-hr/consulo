{
  ProgressIndicator indicator=ProgressManager.getInstance().getProgressIndicator();
  if (indicator != null) {
    indicator.pushState();
    indicator.setText(IdeBundle.message("progress.scanning.files"));
  }
  myUpdateSets=new Collection[myUpdaters.size()];
  for (int i=0; i < myUpdaters.size(); i++) {
    CacheUpdater updater=myUpdaters.get(i);
    try {
      VirtualFile[] updaterFiles=updater.queryNeededFiles();
      Collection<VirtualFile> localSet=new LinkedHashSet<VirtualFile>(Arrays.asList(updaterFiles));
      myFilesToUpdate.addAll(localSet);
      myUpdateSets[i]=localSet;
    }
 catch (    ProcessCanceledException e) {
      throw e;
    }
catch (    Throwable e) {
      LOG.error(e);
      myUpdateSets[i]=new ArrayList();
    }
  }
  if (indicator != null) {
    indicator.popState();
  }
  if (myFilesToUpdate.isEmpty()) {
    updatingDone();
  }
  return myFilesToUpdate.size();
}
