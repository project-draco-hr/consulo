{
  final Map<GradleModule,Module> result=new HashMap<GradleModule,Module>();
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      Application application=ApplicationManager.getApplication();
      AccessToken writeLock=application.acquireWriteActionLock(getClass());
      try {
        try {
          Map<GradleModule,Module> moduleMappings=doImportModules(modules,model);
          result.putAll(moduleMappings);
          myAlarm.cancelAllRequests();
          myAlarm.addRequest(new SetupExternalLibrariesTask(moduleMappings,gradleProjectPath,intellijProject),PROJECT_INITIALISATION_DELAY_MS);
        }
  finally {
          model.commit();
        }
      }
  finally {
        writeLock.finish();
      }
    }
  }
);
  return result;
}
