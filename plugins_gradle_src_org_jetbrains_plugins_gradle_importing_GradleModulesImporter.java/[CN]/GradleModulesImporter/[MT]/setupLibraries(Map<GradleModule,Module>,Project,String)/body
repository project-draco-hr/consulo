{
  final GradleApiFacadeManager manager=ServiceManager.getService(GradleApiFacadeManager.class);
  Runnable edtAction=new Runnable(){
    @Override public void run(){
      final Ref<GradleProject> gradleProjectRef=new Ref<GradleProject>();
      ProgressManager.getInstance().run(new Task.Backgroundable(intellijProject,GradleBundle.message("gradle.library.resolve.progress.text"),false){
        @Override public void run(        @NotNull ProgressIndicator indicator){
          indicator.setIndeterminate(true);
          try {
            GradleProjectResolver resolver=manager.getFacade().getResolver();
            gradleProjectRef.set(resolver.resolveProjectInfo(gradleProjectPath,true));
          }
 catch (          Exception e) {
            GradleLog.LOG.warn("Can't resolve external dependencies of the target gradle project (" + gradleProjectPath + ")",e);
          }
        }
      }
);
      final GradleProject gradleProject=gradleProjectRef.get();
      if (gradleProject == null) {
        return;
      }
      Application application=ApplicationManager.getApplication();
      AccessToken writeLock=application.acquireWriteActionLock(getClass());
      try {
        doSetupLibraries(moduleMappings,gradleProject,intellijProject);
      }
  finally {
        writeLock.finish();
      }
    }
  }
;
  UIUtil.invokeLaterIfNeeded(edtAction);
}
