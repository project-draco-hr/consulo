{
  final Window foremostWindow=getForemostWindow(window);
  final Window documentRoot=getDocumentRootFromWindow(foremostWindow);
  final ID nativeFocusedWindow=MacUtil.findWindowFromJavaWindow(foremostWindow);
  paramsWrapper.setNativeWindow(nativeFocusedWindow);
  final ID paramsArray=paramsWrapper.getParamsAsID();
  foremostWindow.addWindowListener(new WindowAdapter(){
    @Override public void windowClosed(    WindowEvent e){
      super.windowClosed(e);
      queuesFromDocumentRoot.remove(documentRoot);
      if (blockedDocumentRoots.remove(documentRoot) != null) {
        throw new MacMessageException("Owner window has been removed");
      }
    }
  }
);
  final ID delegate=invoke(invoke(getObjcClass("NSAlertDelegate_"),"alloc"),"init");
  IdeFocusManager.getGlobalInstance().setTypeaheadEnabled(false);
  runOrPostponeForWindow(documentRoot,new Runnable(){
    @Override public void run(){
      invoke(delegate,"performSelectorOnMainThread:withObject:waitUntilDone:",createSelector(methodName),paramsArray,false);
    }
  }
);
  startModal(documentRoot,nativeFocusedWindow);
  IdeFocusManager.getGlobalInstance().setTypeaheadEnabled(true);
  return documentRoot;
}
