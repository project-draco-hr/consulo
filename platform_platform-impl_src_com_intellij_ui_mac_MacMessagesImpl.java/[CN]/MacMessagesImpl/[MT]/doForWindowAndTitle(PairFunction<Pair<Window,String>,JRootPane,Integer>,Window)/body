{
  LOG.assertTrue(SwingUtilities.isEventDispatchThread());
  JRootPane pane=null;
  String _windowTitle=null;
  Window _window=window == null ? KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusedWindow() : window;
  if (_window == null) {
    Component focusOwner=IdeFocusManager.findInstance().getFocusOwner();
    if (focusOwner != null) {
      _window=SwingUtilities.getWindowAncestor(focusOwner);
    }
    if (_window == null) {
      IdeFrame[] allFrames=WindowManager.getInstance().getAllFrames();
      if (allFrames.length > 0) {
        _window=SwingUtilities.getWindowAncestor(allFrames[0].getComponent());
      }
    }
  }
  LOG.assertTrue(_window != null);
  if (!_window.isShowing()) {
    Container parent=_window.getParent();
    if (parent != null && parent instanceof Window) {
      _window=(Window)parent;
    }
    if (!_window.isShowing()) {
      Component focusOwner=IdeFocusManager.findInstance().getFocusOwner();
      if (focusOwner != null) {
        _window=SwingUtilities.getWindowAncestor(focusOwner);
      }
    }
  }
  LOG.assertTrue(_window.isShowing(),"Window MUST BE showing in screen!");
  if (_window instanceof JFrame) {
    JFrame frame=(JFrame)_window;
    pane=frame.getRootPane();
    _windowTitle=frame.getTitle();
  }
 else   if (_window instanceof JDialog) {
    JDialog dialog=(JDialog)_window;
    pane=dialog.getRootPane();
    _windowTitle=dialog.getTitle();
  }
  if (_windowTitle == null) {
    _window=SwingUtilities.getWindowAncestor(_window);
    if (_window instanceof JFrame) {
      JFrame frame=(JFrame)_window;
      pane=frame.getRootPane();
      _windowTitle=frame.getTitle();
    }
 else     if (_window instanceof JDialog) {
      JDialog dialog=(JDialog)_window;
      pane=dialog.getRootPane();
      _windowTitle=dialog.getTitle();
    }
  }
  LOG.assertTrue(_windowTitle != null && _windowTitle.length() > 0 && pane != null,"Window MUST have a title and a root pane!");
  return fun.fun(Pair.create(_window,_windowTitle),pane);
}
