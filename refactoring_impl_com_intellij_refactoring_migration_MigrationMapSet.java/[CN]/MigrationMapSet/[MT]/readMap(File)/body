{
  if (!file.exists())   return null;
  Document document=JDOMUtil.loadDocument(file);
  Element root=document.getRootElement();
  if (root == null || !MIGRATION_MAP.equals(root.getName())) {
    throw new InvalidDataException();
  }
  MigrationMap map=new MigrationMap();
  for (Iterator i=root.getChildren().iterator(); i.hasNext(); ) {
    Element node=(Element)i.next();
    if (NAME.equals(node.getName())) {
      String name=node.getAttributeValue(VALUE);
      map.setName(name);
    }
    if (DESCRIPTION.equals(node.getName())) {
      String description=node.getAttributeValue(VALUE);
      map.setDescription(description);
    }
    if (ENTRY.equals(node.getName())) {
      MigrationMapEntry entry=new MigrationMapEntry();
      String oldName=node.getAttributeValue(OLD_NAME);
      if (oldName == null) {
        throw new InvalidDataException();
      }
      entry.setOldName(oldName);
      String newName=node.getAttributeValue(NEW_NAME);
      if (newName == null) {
        throw new InvalidDataException();
      }
      entry.setNewName(newName);
      String typeStr=node.getAttributeValue(TYPE);
      if (typeStr == null) {
        throw new InvalidDataException();
      }
      entry.setType(MigrationMapEntry.CLASS);
      if (typeStr.equals(PACKAGE_TYPE)) {
        entry.setType(MigrationMapEntry.PACKAGE);
        @NonNls String isRecursiveStr=node.getAttributeValue(RECURSIVE);
        if (isRecursiveStr != null && isRecursiveStr.equals("true")) {
          entry.setRecursive(true);
        }
 else {
          entry.setRecursive(false);
        }
      }
      map.addEntry(entry);
    }
  }
  return map;
}
