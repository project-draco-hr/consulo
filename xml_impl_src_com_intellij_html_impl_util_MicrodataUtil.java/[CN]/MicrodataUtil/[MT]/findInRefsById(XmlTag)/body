{
  XmlAttribute idAttr=tag.getAttribute("id");
  final XmlAttributeValue idValue=idAttr != null ? idAttr.getValueElement() : null;
  if (idValue == null) {
    return null;
  }
  final String idToFind=StringUtil.stripQuotesAroundValue(idValue.getText());
  XmlTag parentTag=tag.getParentTag();
  while (parentTag != null) {
    XmlTag scopeTag=ContainerUtil.find(parentTag.getSubTags(),new Condition<XmlTag>(){
      @Override public boolean value(      XmlTag tag){
        String refValue=tag.getAttributeValue(ITEM_REF);
        return refValue != null && refValue.contains(idToFind);
      }
    }
);
    if (scopeTag != null) {
      return scopeTag;
    }
    parentTag=parentTag.getParentTag();
  }
  return null;
}
