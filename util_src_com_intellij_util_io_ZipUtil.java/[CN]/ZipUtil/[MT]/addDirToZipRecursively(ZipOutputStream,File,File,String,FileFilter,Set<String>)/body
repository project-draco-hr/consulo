{
  if (FileUtil.isAncestor(dir,jarFile,false)) {
    return false;
  }
  if (!relativePath.equals("")) {
    addFileToZip(outputStream,dir,relativePath,writtenItemRelativePaths,fileFilter);
  }
  final File[] children=dir.listFiles();
  if (children != null) {
    for (int i=0; i < children.length; i++) {
      File child=children[i];
      final String childRelativePath=(relativePath.equals("") ? "" : relativePath + "/") + child.getName();
      addFileOrDirRecursively(outputStream,jarFile,child,childRelativePath,fileFilter,writtenItemRelativePaths);
    }
  }
  return true;
}
