{
  ArrayList<VirtualFile> filesToAdd=collectFilesToAdd(files);
  if (filesToAdd.isEmpty())   return CvsHandler.NULL;
  LOG.assertTrue(!filesToAdd.isEmpty());
  Collection<AddedFileInfo> roots=new CreateTreeOnFileList(filesToAdd,project,includeAllRoots).getRoots();
  if (roots.size() == 0) {
    LOG.assertTrue(false,filesToAdd);
  }
  if (showDialog) {
    AbstractAddOptionsDialog dialog=AbstractAddOptionsDialog.createDialog(project,roots,dialogOptions);
    dialog.show();
    if (!dialog.isOK())     return CvsHandler.NULL;
  }
  return CommandCvsHandler.createAddFilesHandler(project,roots);
}
