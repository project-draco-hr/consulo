{
  final ArrayList<VirtualFile> result=new ArrayList<VirtualFile>();
  for (  VirtualFile file : files) {
    final List<VirtualFile> parentsToAdd=new ArrayList<VirtualFile>();
    VirtualFile parent=file.getParent();
    do {
      if (parent == null || CvsUtil.fileExistsInCvs(parent) || result.contains(parent))       break;
      parentsToAdd.add(parent);
      parent=parent.getParent();
    }
 while (true);
    if (parent != null) {
      result.addAll(parentsToAdd);
    }
    addFilesToCollection(result,file);
  }
  Collections.sort(result,new Comparator<VirtualFile>(){
    public int compare(    final VirtualFile o1,    final VirtualFile o2){
      return o1.getPath().compareTo(o2.getPath());
    }
  }
);
  return result;
}
