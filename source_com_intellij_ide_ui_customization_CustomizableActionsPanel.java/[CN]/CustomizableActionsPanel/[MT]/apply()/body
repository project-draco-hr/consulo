{
  final ArrayList<TreePath> treePaths=TreeUtil.collectExpandedPaths(myActionsTree);
  if (mySelectedSchema != null) {
    CustomizationUtil.optimizeSchema(myActionsTree,mySelectedSchema);
  }
  final CustomizableActionsSchemas allSchemasComponent=CustomizableActionsSchemas.getInstance();
  allSchemasComponent.clear();
  Set<String> names=new HashSet<String>();
  for (int i=0; i < myCustomizationSchemas.getSize(); i++) {
    final CustomActionsSchema schema=(CustomActionsSchema)myCustomizationSchemas.getElementAt(i);
    final String name=schema.getName();
    if (names.contains(name)) {
      throw new ConfigurationException("Please, specify new name for schema \'" + name + "\'.");
    }
    names.add(name);
    if (schema.isModified()) {
      schema.resetMainActionGroups();
    }
    allSchemasComponent.addCustomActionsSchema(schema);
  }
  allSchemasComponent.setActiveSchema(mySelectedSchema);
  setCustomizationSchemaForCurrentProjects();
  fillSchemaList();
  restorePathsAfterTreeOptimization(treePaths);
}
