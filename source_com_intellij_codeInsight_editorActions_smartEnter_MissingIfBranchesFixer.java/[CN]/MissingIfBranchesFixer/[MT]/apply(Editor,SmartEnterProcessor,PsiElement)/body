{
  if (!(psiElement instanceof PsiIfStatement))   return;
  PsiIfStatement ifStatement=(PsiIfStatement)psiElement;
  final Document doc=editor.getDocument();
  final PsiStatement elseBranch=ifStatement.getElseBranch();
  if (ifStatement.getElseElement() != null && (elseBranch == null || !(elseBranch instanceof PsiBlockStatement) && startLine(doc,elseBranch) > startLine(doc,ifStatement.getElseElement()))) {
    doc.insertString(ifStatement.getElseElement().getTextRange().getEndOffset(),"{}");
  }
  PsiElement thenBranch=ifStatement.getThenBranch();
  if (thenBranch instanceof PsiBlockStatement)   return;
  if (thenBranch != null && startLine(doc,thenBranch) == startLine(doc,ifStatement))   return;
  if (ifStatement.getElseBranch() == null || ifStatement.getThenBranch() == null) {
    doc.insertString(ifStatement.getRParenth().getTextRange().getEndOffset(),"{}");
  }
 else {
    doc.insertString(ifStatement.getRParenth().getTextRange().getEndOffset(),"{");
    doc.insertString(ifStatement.getThenBranch().getTextRange().getEndOffset() + 1,"}");
  }
}
