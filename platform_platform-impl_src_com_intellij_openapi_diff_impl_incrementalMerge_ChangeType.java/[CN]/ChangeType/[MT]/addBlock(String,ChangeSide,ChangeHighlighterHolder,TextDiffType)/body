{
  EditorColorsScheme colorScheme=markup.getEditor().getColorsScheme();
  Color separatorColor=getSeparatorColor(diffType.getLegendColor(colorScheme));
  int length=text.length();
  int start=changeSide.getStart();
  int end=start + length;
  RangeHighlighter highlighter=markup.addRangeHighlighter(start,end,LAYER,diffType,HighlighterTargetArea.EXACT_RANGE,myApplied);
  if (highlighter != null) {
    highlighter.setLineSeparatorPlacement(SeparatorPlacement.TOP);
    highlighter.setLineSeparatorColor(separatorColor);
    highlighter.setLineSeparatorRenderer(myStandardLineSeparatorRenderer);
  }
  if (text.charAt(length - 1) == '\n') {
    end--;
  }
  highlighter=markup.addRangeHighlighter(start,end,LAYER,TextDiffType.NONE,HighlighterTargetArea.EXACT_RANGE,myApplied);
  if (highlighter != null) {
    highlighter.setLineSeparatorPlacement(SeparatorPlacement.BOTTOM);
    highlighter.setLineSeparatorColor(separatorColor);
    highlighter.setLineSeparatorRenderer(myStandardLineSeparatorRenderer);
  }
  return highlighter;
}
