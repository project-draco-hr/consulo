{
  final PackageElement value=getValue();
  final PsiPackage aPackage=value.getPackage();
  final String qName=aPackage.getQualifiedName();
  if (!getSettings().isFlattenPackages() && getSettings().isHideEmptyMiddlePackages() && PackageUtil.isPackageEmpty(aPackage,value.getModule(),true,isLibraryElement())) {
    setValue(null);
    return;
  }
  PsiPackage parentPackage;
  if (getParentValue() instanceof PackageElement) {
    parentPackage=((PackageElement)getParentValue()).getPackage();
  }
 else {
    parentPackage=null;
  }
  String name=PackageUtil.getNodeName(getSettings(),aPackage,parentPackage,qName,showFQName(aPackage));
  presentation.setPresentableText(name);
  presentation.setOpenIcon(Icons.PACKAGE_OPEN_ICON);
  presentation.setClosedIcon(Icons.PACKAGE_ICON);
  for (  ProjectViewNodeDecorator decorator : Extensions.getExtensions(ProjectViewNodeDecorator.EP_NAME,myProject)) {
    decorator.decorate(this,presentation);
  }
}
