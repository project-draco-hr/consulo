{
  PsiManager manager=psiMethod.getManager();
  final PsiSearchHelper searchHelper=manager.getSearchHelper();
  GlobalSearchScope projectScope=GlobalSearchScope.projectScope(manager.getProject());
  final PsiReference[] references=searchHelper.findReferences(psiMethod,projectScope,false);
  if (psiMethod.isConstructor()) {
    findConstructorUsages(psiMethod,references,usages);
    return;
  }
  final PsiMethod[] overridingMethods=removeDeletedMethods(searchHelper.findOverridingMethods(psiMethod,projectScope,true));
  boolean anyRefs=false;
  for (  PsiReference reference : references) {
    final PsiElement element=reference.getElement();
    if (!isInside(element,myElements) && !isInside(element,overridingMethods)) {
      usages.add(new SafeDeleteReferenceSimpleDeleteUsageInfo(element,psiMethod,false));
      anyRefs=true;
    }
  }
  final UsageInsideDeleted usageInsideDeleted;
  if (!anyRefs) {
    HashMap<PsiMethod,PsiReference[]> methodToReferences=new HashMap<PsiMethod,PsiReference[]>();
    for (    PsiMethod overridingMethod : overridingMethods) {
      final PsiReference[] overridingReferences=searchHelper.findReferences(overridingMethod,projectScope,false);
      methodToReferences.put(overridingMethod,overridingReferences);
    }
    final Set<PsiMethod> validOverriding=validateOverridingMethods(psiMethod,references,Arrays.asList(overridingMethods),methodToReferences,usages);
    usageInsideDeleted=new UsageInsideDeleted(){
      public boolean isInsideDeleted(      PsiElement usage){
        if (usage instanceof PsiFile)         return false;
        return isInside(usage,myElements) || isInside(usage,validOverriding);
      }
    }
;
  }
 else {
    usageInsideDeleted=myInsideDeletedElements;
  }
  addNonCodeUsages(psiMethod,usages,usageInsideDeleted);
}
