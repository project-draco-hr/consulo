{
  GrTypeElement typeElement=getReturnTypeElementGroovy();
  if (newReturnType == null) {
    if (typeElement != null)     typeElement.delete();
    return null;
  }
  GrTypeElement newTypeElement=GroovyPsiElementFactory.getInstance(getProject()).createTypeElement(newReturnType);
  if (typeElement == null) {
    PsiElement anchor=getTypeParameterList();
    if (anchor == null)     anchor=getModifierList();
    newTypeElement=(GrTypeElement)addAfter(newTypeElement,anchor);
  }
 else {
    newTypeElement=(GrTypeElement)typeElement.replace(newTypeElement);
  }
  newTypeElement.accept(new GroovyRecursiveElementVisitor(){
    @Override public void visitCodeReferenceElement(    GrCodeReferenceElement refElement){
      super.visitCodeReferenceElement(refElement);
      org.jetbrains.plugins.groovy.codeStyle.GrReferenceAdjuster.shortenReference(refElement);
    }
  }
);
  return newTypeElement;
}
