{
  VirtualFile virtualFile=e.getData(PlatformDataKeys.VIRTUAL_FILE);
  VirtualFile[] files=e.getData(PlatformDataKeys.VIRTUAL_FILE_ARRAY);
  if (files != null && files.length > 1) {
    virtualFile=null;
  }
  Project project=e.getData(PlatformDataKeys.PROJECT);
  if (virtualFile != null) {
    Navigatable navigatable=e.getData(PlatformDataKeys.NAVIGATABLE);
    if (navigatable instanceof OpenFileDescriptor) {
      virtualFile=((OpenFileDescriptor)navigatable).getFile();
    }
  }
  Pair<String,Boolean> result=update(virtualFile,project);
  e.getPresentation().setText(result.getFirst());
  e.getPresentation().setEnabled(result.getSecond());
}
