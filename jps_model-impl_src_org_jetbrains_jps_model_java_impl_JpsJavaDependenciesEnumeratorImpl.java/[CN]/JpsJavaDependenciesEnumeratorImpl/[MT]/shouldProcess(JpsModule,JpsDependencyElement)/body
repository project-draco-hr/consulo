{
  boolean exported=!(element instanceof JpsSdkDependency);
  JpsJavaDependencyExtension extension=JpsJavaExtensionService.getInstance().getDependencyExtension(element);
  if (extension != null) {
    exported=extension.isExported();
    JpsJavaDependencyScope scope=extension.getScope();
    boolean forTestCompile=scope.isIncludedIn(JpsJavaClasspathKind.TEST_COMPILE) || scope == JpsJavaDependencyScope.RUNTIME && shouldAddRuntimeDependenciesToTestCompilationClasspath();
    if (myCompileOnly && !scope.isIncludedIn(JpsJavaClasspathKind.PRODUCTION_COMPILE) && !forTestCompile || myRuntimeOnly && !scope.isIncludedIn(JpsJavaClasspathKind.PRODUCTION_RUNTIME) && !scope.isIncludedIn(JpsJavaClasspathKind.TEST_RUNTIME) || myClasspathKind != null && !scope.isIncludedIn(myClasspathKind) && !(myClasspathKind == JpsJavaClasspathKind.TEST_COMPILE && forTestCompile)) {
      return false;
    }
    if (myProductionOnly) {
      if (!scope.isIncludedIn(JpsJavaClasspathKind.PRODUCTION_COMPILE) && !scope.isIncludedIn(JpsJavaClasspathKind.PRODUCTION_RUNTIME) || myCompileOnly && !scope.isIncludedIn(JpsJavaClasspathKind.PRODUCTION_COMPILE) || myRuntimeOnly && !scope.isIncludedIn(JpsJavaClasspathKind.PRODUCTION_RUNTIME)) {
        return false;
      }
    }
  }
  if (!exported) {
    if (myExportedOnly)     return false;
    if (myRecursivelyExportedOnly && !isEnumerationRootModule(module))     return false;
  }
  return true;
}
