{
  final DataContext dataContext=event.getDataContext();
  final MethodHierarchyBrowser methodHierarchyBrowser=(MethodHierarchyBrowser)dataContext.getData(MethodHierarchyBrowser.METHOD_HIERARCHY_BROWSER_DATA_CONSTANT);
  if (methodHierarchyBrowser == null)   return;
  final Project project=DataKeys.PROJECT.getData(dataContext);
  if (project == null)   return;
  final String commandName=event.getPresentation().getText();
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      CommandProcessor.getInstance().executeCommand(project,new Runnable(){
        public void run(){
          try {
            final MethodHierarchyNodeDescriptor[] selectedDescriptors=methodHierarchyBrowser.getSelectedDescriptors();
            if (selectedDescriptors.length > 0) {
              final List<VirtualFile> files=new ArrayList<VirtualFile>(selectedDescriptors.length);
              for (int i=0; i < selectedDescriptors.length; i++) {
                final PsiFile containingFile=selectedDescriptors[i].getPsiClass().getContainingFile();
                if (containingFile != null) {
                  final VirtualFile vFile=containingFile.getVirtualFile();
                  if (vFile != null) {
                    files.add(vFile);
                  }
                }
              }
              final ReadonlyStatusHandler.OperationStatus status=ReadonlyStatusHandler.getInstance(project).ensureFilesWritable(files.toArray(new VirtualFile[files.size()]));
              if (!status.hasReadonlyFiles()) {
                for (int i=0; i < selectedDescriptors.length; i++) {
                  OverrideImplementUtil.overrideOrImplement(selectedDescriptors[i].getPsiClass(),methodHierarchyBrowser.getBaseMethod());
                }
                ToolWindowManager.getInstance(project).activateEditorComponent();
              }
 else {
                ApplicationManager.getApplication().invokeLater(new Runnable(){
                  public void run(){
                    Messages.showErrorDialog(project,status.getReadonlyFilesMessage(),commandName);
                  }
                }
);
              }
            }
          }
 catch (          IncorrectOperationException e) {
            LOG.error(e);
          }
        }
      }
,commandName,null);
    }
  }
);
}
