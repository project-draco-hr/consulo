{
  ZipInputStream in=new ZipInputStream(new FileInputStream(file));
  try {
    ZipEntry inEntry;
    Set<String> processed=new HashSet<String>();
    while ((inEntry=in.getNextEntry()) != null) {
      if (inEntry.isDirectory())       continue;
      if (processed.contains(inEntry.getName())) {
        throw new IOException("Duplicate entry '" + inEntry.getName() + "' in "+ file.getPath());
      }
      processor.process(inEntry,new BufferedInputStream(in));
      processed.add(inEntry.getName());
    }
  }
  finally {
    in.close();
  }
}
