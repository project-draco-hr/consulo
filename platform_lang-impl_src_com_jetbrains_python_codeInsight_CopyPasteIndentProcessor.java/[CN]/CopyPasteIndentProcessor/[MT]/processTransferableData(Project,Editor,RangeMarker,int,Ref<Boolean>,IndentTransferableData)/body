{
  if (value.getIndent() > 0) {
    final Document document=editor.getDocument();
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      @Override public void run(){
        int startLine=document.getLineNumber(bounds.getStartOffset());
        int endLine=document.getLineNumber(bounds.getEndOffset());
        int startLineStart=document.getLineStartOffset(startLine);
        final String textBeforeFirstLine=document.getText(new TextRange(startLineStart,bounds.getStartOffset()));
        if (textBeforeFirstLine.trim().length() == 0) {
          EditorActionUtil.indentLine(project,editor,startLine,-value.getFirstLineLeadingSpaces());
        }
        for (int i=startLine + 1; i <= endLine; i++) {
          EditorActionUtil.indentLine(project,editor,i,caretColumn - value.getIndent());
        }
        indented.set(Boolean.TRUE);
      }
    }
);
  }
}
