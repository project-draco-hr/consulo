{
  PsiSubstitutor substitutor=PsiResolveHelper.SERVICE.getInstance(method.getProject()).inferTypeArguments(typeParameters,types1,types2,languageLevel);
  for (  PsiTypeParameter typeParameter : PsiUtil.typeParametersIterable(method)) {
    ProgressManager.checkCanceled();
    LOG.assertTrue(typeParameter != null);
    if (!substitutor.getSubstitutionMap().containsKey(typeParameter)) {
      substitutor=substitutor.put(typeParameter,siteSubstitutor.substitute(typeParameter));
    }
  }
  return substitutor;
}
