{
  final Ref<VirtualFile> ref=new Ref<VirtualFile>();
  ApplicationManager.getApplication().invokeAndWait(new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          ref.set(LocalFileSystem.getInstance().refreshAndFindFileByPath(resPath.replace(File.separatorChar,'/')));
          if (dtdUrl != null) {
            ExternalResourceManager.getInstance().addResource(dtdUrl,resPath);
          }
        }
      }
);
    }
  }
,indicator.getModalityState());
  return ref.get();
}
