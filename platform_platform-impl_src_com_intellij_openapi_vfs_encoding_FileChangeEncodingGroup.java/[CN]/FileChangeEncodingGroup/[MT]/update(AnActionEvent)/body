{
  if (myUpdating) {
    return;
  }
  VirtualFile virtualFile=e.getData(PlatformDataKeys.VIRTUAL_FILE);
  VirtualFile[] files=e.getData(PlatformDataKeys.VIRTUAL_FILE_ARRAY);
  if (files != null && files.length > 1) {
    virtualFile=null;
  }
  if (virtualFile != null) {
    Navigatable navigatable=e.getData(PlatformDataKeys.NAVIGATABLE);
    if (navigatable instanceof OpenFileDescriptor) {
      virtualFile=((OpenFileDescriptor)navigatable).getFile();
    }
  }
  if (virtualFile != null && !virtualFile.isInLocalFileSystem()) {
    virtualFile=null;
  }
  boolean enabled=virtualFile != null && EncodingActionsPair.checkSomeActionEnabled(virtualFile) == null;
  removeAll();
  if (enabled) {
    addAll(encodingActionsPair.createActionGroup());
  }
  myUpdating=true;
  try {
    e.getPresentation().setText("File encoding");
    e.getPresentation().setEnabled(enabled);
  }
  finally {
    myUpdating=false;
  }
}
