{
  if (element instanceof GrReferenceExpression && ((GrReferenceExpression)element).getQualifierExpression() == null) {
    final PsiElement parent=element.getParent();
    if (parent instanceof GrAssignmentExpression) {
      final GrExpression initializer=((GrAssignmentExpression)parent).getRValue();
      if (initializer != null) {
        return new Computable<PsiType>(){
          @Nullable public PsiType compute(){
            return initializer.getType();
          }
        }
;
      }
      return null;
    }
    if (parent instanceof GrListOrMap) {
      GrListOrMap list=(GrListOrMap)parent;
      if (list.getParent() instanceof GrAssignmentExpression) {
        final GrExpression rValue=((GrAssignmentExpression)list.getParent()).getRValue();
        int idx=Arrays.asList(list.getInitializers()).indexOf(element);
        if (idx >= 0 && rValue != null) {
          return getMultipleAssignmentTypeComputation(rValue,idx);
        }
      }
    }
    return null;
  }
  if (element instanceof GrVariable) {
    return new Computable<PsiType>(){
      @Nullable public PsiType compute(){
        GrVariable variable=(GrVariable)element;
        if (!(variable instanceof GrParameter)) {
          final GrExpression initializer=variable.getInitializerGroovy();
          if (initializer != null) {
            return initializer.getType();
          }
        }
        return variable.getTypeGroovy();
      }
    }
;
  }
  return null;
}
