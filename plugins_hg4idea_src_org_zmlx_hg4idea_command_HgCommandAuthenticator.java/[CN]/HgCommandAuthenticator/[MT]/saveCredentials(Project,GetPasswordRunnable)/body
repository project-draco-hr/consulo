{
  final PasswordSafeImpl passwordSafe=(PasswordSafeImpl)PasswordSafe.getInstance();
  if (passwordSafe.getSettings().getProviderType().equals(PasswordSafeSettings.ProviderType.DO_NOT_STORE)) {
    return;
  }
  final String key=keyForUrlAndLogin(runnable.getURL(),runnable.getUserName());
  final PasswordSafeProvider provider=runnable.isRememberPassword() ? passwordSafe.getMasterKeyProvider() : passwordSafe.getMemoryProvider();
  try {
    provider.storePassword(project,HgCommandAuthenticator.class,key,runnable.getPassword());
    final HgVcs vcs=HgVcs.getInstance(project);
    if (vcs != null) {
      vcs.getGlobalSettings().addRememberedUrl(runnable.getURL(),runnable.getUserName());
    }
  }
 catch (  PasswordSafeException e) {
    LOG.info("Couldn't store the password for key [" + key + "]",e);
  }
}
