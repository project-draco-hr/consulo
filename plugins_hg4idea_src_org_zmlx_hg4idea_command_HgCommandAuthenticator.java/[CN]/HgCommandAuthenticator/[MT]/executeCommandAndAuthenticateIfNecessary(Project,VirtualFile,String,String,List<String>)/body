{
  HgCommandService service=HgCommandService.getInstance(project);
  HgCommandResult result=service.execute(localRepository,command,arguments);
  if (HgErrorUtil.isAbort(result) && HgErrorUtil.isAuthorizationRequiredAbort(result)) {
    try {
      HgUrl hgUrl=new HgUrl(remoteRepository);
      if (hgUrl.supportsAuthentication()) {
        GetPasswordRunnable runnable=new GetPasswordRunnable(project,hgUrl);
        if (!ApplicationManager.getApplication().isDispatchThread()) {
          ApplicationManager.getApplication().invokeAndWait(runnable,ModalityState.defaultModalityState());
        }
 else {
          runnable.run();
        }
        if (runnable.isOk()) {
          hgUrl.setUsername(runnable.getUserName());
          hgUrl.setPassword(String.valueOf(runnable.getPassword()));
          arguments.set(arguments.size() - 1,hgUrl.asString());
          result=service.execute(localRepository,command,arguments);
        }
      }
    }
 catch (    URISyntaxException e) {
      VcsUtil.showErrorMessage(project,"Invalid repository: " + remoteRepository,"Error");
    }
  }
  return result;
}
