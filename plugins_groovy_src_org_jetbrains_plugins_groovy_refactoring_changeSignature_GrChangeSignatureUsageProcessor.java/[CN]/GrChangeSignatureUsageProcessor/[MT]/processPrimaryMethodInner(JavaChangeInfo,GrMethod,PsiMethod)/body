{
  if (changeInfo.isNameChanged()) {
    String newName=baseMethod == null ? changeInfo.getNewName() : RefactoringUtil.suggestNewOverriderName(method.getName(),baseMethod.getName(),changeInfo.getNewName());
    if (newName != null && !newName.equals(method.getName())) {
      method.setName(changeInfo.getNewName());
    }
  }
  final GrModifierList modifierList=method.getModifierList();
  if (changeInfo.isVisibilityChanged()) {
    modifierList.setModifierProperty(changeInfo.getNewVisibility(),true);
  }
  PsiSubstitutor substitutor=baseMethod != null ? calculateSubstitutor(method,baseMethod) : PsiSubstitutor.EMPTY;
  final PsiMethod context=changeInfo.getMethod();
  GrTypeElement oldReturnTypeElement=method.getReturnTypeElementGroovy();
  if (changeInfo.isReturnTypeChanged()) {
    CanonicalTypes.Type newReturnType=changeInfo.getNewReturnType();
    if (newReturnType == null) {
      if (oldReturnTypeElement != null) {
        oldReturnTypeElement.delete();
        if (modifierList.getModifiers().length == 0) {
          modifierList.setModifierProperty(GrModifier.DEF,true);
        }
      }
    }
 else {
      PsiType type=newReturnType.getType(context,method.getManager());
      method.setReturnType(substitutor.substitute(type));
      if (oldReturnTypeElement == null) {
        modifierList.setModifierProperty(GrModifier.DEF,false);
      }
    }
  }
  JavaParameterInfo[] newParameters=changeInfo.getNewParameters();
  final GrParameterList parameterList=method.getParameterList();
  GrParameter[] oldParameters=parameterList.getParameters();
  final PsiParameter[] oldBaseParams=baseMethod != null ? baseMethod.getParameterList().getParameters() : null;
  Set<GrParameter> toRemove=new HashSet<GrParameter>(oldParameters.length);
  ContainerUtil.addAll(toRemove,oldParameters);
  GroovyPsiElementFactory factory=GroovyPsiElementFactory.getInstance(method.getProject());
  GrParameter anchor=null;
  final GrDocComment docComment=method.getDocComment();
  final GrDocTag[] tags=docComment == null ? null : docComment.getTags();
  for (  JavaParameterInfo newParameter : newParameters) {
    PsiType type;
    if (newParameter instanceof GrParameterInfo && ((GrParameterInfo)newParameter).hasNoType()) {
      type=null;
    }
 else {
      type=substitutor.substitute(newParameter.createType(context,method.getManager()));
    }
    final String newName;
    final int oldIndex=newParameter.getOldIndex();
    if (oldIndex >= 0 && oldBaseParams != null) {
      final String oldName=oldParameters[oldIndex].getName();
      if (oldName.equals(oldBaseParams[oldIndex].getName())) {
        newName=newParameter.getName();
      }
 else {
        newName=oldName;
      }
    }
 else {
      newName=newParameter.getName();
    }
    if (docComment != null) {
      if (oldIndex >= 0) {
        final GrParameter oldParameter=oldParameters[oldIndex];
        final String oldName=oldParameter.getName();
        for (        GrDocTag tag : tags) {
          if ("@param".equals(tag.getName())) {
            final GrDocParameterReference parameterReference=tag.getDocParameterReference();
            if (parameterReference != null && oldName.equals(parameterReference.getText())) {
              parameterReference.handleElementRename(newName);
            }
          }
        }
      }
    }
    GrParameter grParameter=factory.createParameter(newName,type == null ? null : type.getCanonicalText(),getInitializer(newParameter),parameterList);
    anchor=(GrParameter)parameterList.addAfter(grParameter,anchor);
  }
  for (  GrParameter oldParameter : toRemove) {
    oldParameter.delete();
  }
  GrReferenceAdjuster.shortenReferences(parameterList);
  CodeStyleManager.getInstance(parameterList.getProject()).reformat(parameterList);
  if (changeInfo.isExceptionSetOrOrderChanged()) {
    final ThrownExceptionInfo[] infos=changeInfo.getNewExceptions();
    PsiClassType[] exceptionTypes=new PsiClassType[infos.length];
    for (int i=0; i < infos.length; i++) {
      ThrownExceptionInfo info=infos[i];
      exceptionTypes[i]=(PsiClassType)info.createType(method,method.getManager());
    }
    PsiReferenceList thrownList=GroovyPsiElementFactory.getInstance(method.getProject()).createThrownList(exceptionTypes);
    thrownList=(PsiReferenceList)method.getThrowsList().replace(thrownList);
    GrReferenceAdjuster.shortenReferences(thrownList);
    CodeStyleManager.getInstance(method.getProject()).reformat(method.getThrowsList());
  }
  return true;
}
