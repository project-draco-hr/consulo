{
  if (map == null)   return;
  if (changeInfo.isNameChanged()) {
    if (element instanceof GrReferenceElement) {
      element=((GrReferenceElement)element).handleElementRename(changeInfo.getNewName());
    }
  }
  if (toChangeArguments) {
    JavaParameterInfo[] parameters=changeInfo.getNewParameters();
    GrArgumentList argumentList=PsiUtil.getArgumentsList(element);
    GroovyPsiElementFactory factory=GroovyPsiElementFactory.getInstance(element.getProject());
    if (argumentList == null) {
      if (element instanceof GrEnumConstant) {
        argumentList=factory.createArgumentList();
        argumentList=(GrArgumentList)element.add(argumentList);
      }
 else {
        return;
      }
    }
    Set<PsiElement> argsToDelete=new HashSet<PsiElement>(map.length * 2);
    for (    GrClosureSignatureUtil.ArgInfo<PsiElement> argInfo : map) {
      argsToDelete.addAll(argInfo.args);
    }
    for (    JavaParameterInfo parameter : parameters) {
      int index=parameter.getOldIndex();
      if (index >= 0) {
        argsToDelete.removeAll(map[index].args);
      }
    }
    for (    PsiElement arg : argsToDelete) {
      arg.delete();
    }
    boolean skipOptionals=false;
    PsiElement anchor=null;
    for (int i=0; i < parameters.length; i++) {
      JavaParameterInfo parameter=parameters[i];
      int index=parameter.getOldIndex();
      if (index >= 0) {
        GrClosureSignatureUtil.ArgInfo<PsiElement> argInfo=map[index];
        List<PsiElement> arguments=argInfo.args;
        if (argInfo.isMultiArg) {
          if ((i != 0 || !(arguments.size() > 0 && arguments.iterator().next() instanceof GrNamedArgument)) && (i != parameters.length - 1 || !parameter.isVarargType())) {
            StringBuilder argText=new StringBuilder();
            argText.append("[");
            for (            PsiElement argument : arguments) {
              argText.append(argument.getText()).append(", ");
              argument.delete();
            }
            argText.replace(argText.length() - 2,argText.length(),"]");
            PsiType type=parameter.createType(changeInfo.getMethod().getParameterList(),argumentList.getManager());
            if (type instanceof PsiArrayType) {
              type=substitutor.substitute(type);
              String typeText=type.getCanonicalText();
              if (type instanceof PsiEllipsisType) {
                typeText=typeText.replace("...","[]");
              }
              argText.append(" as ").append(typeText);
            }
            anchor=argumentList.addAfter(factory.createExpressionFromText(argText.toString()),anchor);
            PsiUtil.shortenReferences((GroovyPsiElement)anchor);
          }
        }
 else {
          if (arguments.size() == 1) {
            PsiElement arg=arguments.iterator().next();
            if (i == parameters.length - 1 && parameter.isVarargType()) {
              if (arg instanceof GrSafeCastExpression) {
                PsiElement expr=((GrSafeCastExpression)arg).getOperand();
                if (expr instanceof GrListOrMap && !((GrListOrMap)expr).isMap()) {
                  final PsiElement copy=expr.copy();
                  PsiElement[] newVarargs=((GrListOrMap)copy).getInitializers();
                  for (                  PsiElement vararg : newVarargs) {
                    anchor=argumentList.addAfter(vararg,anchor);
                  }
                  arg.delete();
                  continue;
                }
              }
            }
            PsiElement curArg=getNextOfType(argumentList,anchor,GrExpression.class);
            if (curArg == arg) {
              anchor=arg;
            }
 else {
              final PsiElement copy=arg.copy();
              anchor=argumentList.addAfter(copy,anchor);
              arg.delete();
            }
          }
 else {
            skipOptionals=true;
          }
        }
      }
 else {
        if (skipOptionals && isParameterOptional(parameter))         continue;
        GrExpression fromText=null;
        if (forceOptional(parameter)) {
          skipOptionals=true;
          continue;
        }
        try {
          fromText=factory.createExpressionFromText(parameter.getDefaultValue());
        }
 catch (        IncorrectOperationException e) {
          LOG.error(e.getMessage());
        }
        anchor=argumentList.addAfter(fromText,anchor);
      }
    }
    GrCall call=GroovyRefactoringUtil.getCallExpressionByMethodReference(element);
    if (argumentList.getText().trim().length() == 0 && (call == null || call.getClosureArguments().length == 0)) {
      argumentList=argumentList.replaceWithArgumentList(factory.createArgumentList());
    }
    CodeStyleManager.getInstance(argumentList.getProject()).reformat(argumentList);
  }
  if (toCatchExceptions) {
    final ThrownExceptionInfo[] exceptionInfos=changeInfo.getNewExceptions();
    PsiClassType[] exceptions=getExceptions(exceptionInfos,element,element.getManager());
    fixExceptions(element,exceptions);
  }
}
