{
  final boolean askBeforeHotswap=myAskBeforeHotswap;
  myAskBeforeHotswap=true;
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  final Runnable thread=new Runnable(){
    public void run(){
      final HashMap<DebuggerSession,HashMap<String,HotSwapFile>> modifiedClasses=getModifiedClasses(sessions);
      if (modifiedClasses.isEmpty()) {
        final Application application=ApplicationManager.getApplication();
        application.invokeLater(new Runnable(){
          public void run(){
            WindowManager.getInstance().getStatusBar(myProject).setInfo(DebuggerBundle.message("status.hotswap.uptodate"));
          }
        }
,application.getDefaultModalityState());
        return;
      }
      final HashMap<DebuggerSession,HashMap<String,HotSwapFile>> classesToReload=new HashMap<DebuggerSession,HashMap<String,HotSwapFile>>();
      if (askBeforeHotswap) {
        String runHotswap=DebuggerSettings.getInstance().RUN_HOTSWAP_AFTER_COMPILE;
        if (DebuggerSettings.RUN_HOTSWAP_ALWAYS.equals(runHotswap)) {
          classesToReload.putAll(modifiedClasses);
        }
 else         if (DebuggerSettings.RUN_HOTSWAP_NEVER.equals(runHotswap)) {
        }
 else {
          ApplicationManager.getApplication().invokeAndWait(new Runnable(){
            public void run(){
              RunHotswapDialog dialog=new RunHotswapDialog(myProject,sessions);
              dialog.show();
              if (dialog.isOK()) {
                for (                DebuggerSession debuggerSession : dialog.getSessionsToReload()) {
                  classesToReload.put(debuggerSession,modifiedClasses.get(debuggerSession));
                }
              }
            }
          }
,ApplicationManager.getApplication().getDefaultModalityState());
        }
      }
 else {
        classesToReload.putAll(modifiedClasses);
      }
      reloadModifiedClasses(classesToReload);
    }
  }
;
  ApplicationManager.getApplication().executeOnPooledThread(thread);
}
