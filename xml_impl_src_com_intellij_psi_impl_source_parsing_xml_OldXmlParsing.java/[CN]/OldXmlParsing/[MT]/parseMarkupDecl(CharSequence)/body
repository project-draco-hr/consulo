{
  CompositeElement root=ASTFactory.composite(XML_MARKUP_DECL);
  OldXmlLexer originalLexer=new OldXmlLexer();
  final Lexer lexer=new FilterLexer(originalLexer,new FilterLexer.SetFilter(XML_WHITE_SPACE_OR_COMMENT_BIT_SET));
  lexer.start(text,0,text.length(),_OldXmlLexer.DOCTYPE);
  parseMarkupContent(lexer,root);
  while (lexer.getTokenType() != null) {
    final TreeElement children;
    if (lexer.getTokenType() == XML_ENTITY_REF_TOKEN) {
      children=parseEntityRef(lexer);
    }
 else     if (lexer.getTokenType() == XML_ENTITY_DECL_START) {
      children=parseEntityDecl(lexer);
    }
 else {
      children=createTokenElement(lexer,myContext.getCharTable());
      lexer.advance();
    }
    root.rawAddChildren(children);
  }
  originalLexer.start(text,0,text.length(),_OldXmlLexer.DOCTYPE);
  insertMissingTokens(root,originalLexer,0,text.length(),_OldXmlLexer.DOCTYPE,WhiteSpaceAndCommentsProcessor.INSTANCE,myContext);
  return root;
}
