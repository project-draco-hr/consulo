{
  if (lexer.getTokenType() != XML_START_TAG_START) {
    return false;
  }
  CompositeElement tag=ASTFactory.composite(XML_TAG);
  TreeUtil.addChildren(parent,tag);
  addToken(tag,lexer);
  if (lexer.getTokenType() != XML_TAG_NAME) {
    return true;
  }
  final String openedName=lexer.getBufferSequence().subSequence(lexer.getTokenStart(),lexer.getTokenEnd()).toString();
  addToken(tag,lexer);
  parseAttributeList(tag,lexer);
  while (lexer.getTokenType() == XML_BAD_CHARACTER || lexer.getTokenType() == XML_NAME) {
    addToken(tag,lexer);
    parseAttributeList(tag,lexer);
  }
  TreeElement tagEnd;
  if (lexer.getTokenType() == XML_TAG_END) {
    tagEnd=addToken(tag,lexer);
    boolean setFlag=false;
    if (!names.contains(openedName)) {
      names.add(openedName);
      setFlag=true;
    }
    CompositeElement text=null;
    while (true) {
      if (parseProcessingInstruction(tag,lexer)) {
      }
 else       if (_parseTag(tag,lexer,names)) {
      }
 else       if (lexer.getTokenType() == XML_DATA_CHARACTERS) {
        if (text == null) {
          text=ASTFactory.composite(XML_TEXT);
          TreeUtil.addChildren(tag,text);
        }
        addToken(text,lexer);
      }
 else       if (lexer.getTokenType() == XML_CDATA_START) {
        addToken(tag,lexer);
      }
 else       if (lexer.getTokenType() == XML_CDATA_END) {
        addToken(tag,lexer);
      }
 else       if (lexer.getTokenType() == XML_CHAR_ENTITY_REF) {
        addToken(tag,lexer);
      }
 else       if (lexer.getTokenType() == XML_ENTITY_REF_TOKEN) {
        TreeUtil.addChildren(tag,parseEntityRef(lexer));
      }
 else {
        break;
      }
    }
    if (setFlag) {
      names.remove(openedName);
    }
    final LexerPosition pos=lexer.getCurrentPosition();
    if (lexer.getTokenType() != XML_END_TAG_START) {
      TreeUtil.insertAfter(tagEnd,Factory.createErrorElement(XmlErrorMessages.message("element.is.not.closed")));
      return false;
    }
    TreeElement endTagStart=createTokenElement(lexer,myContext.getCharTable());
    lexer.advance();
    if (lexer.getTokenType() != XML_TAG_NAME) {
      TreeUtil.addChildren(tag,endTagStart);
      return true;
    }
    final String closingName=lexer.getBufferSequence().subSequence(lexer.getTokenStart(),lexer.getTokenEnd()).toString();
    if (!closingName.equals(openedName) && names.contains(closingName)) {
      lexer.restore(pos);
      if (tagEnd != null) {
        final TreeElement start=tagEnd.getTreeNext();
        tagEnd.setTreeNext(null);
        if (start != null) {
          TreeUtil.addChildren(parent,start);
        }
      }
      TreeUtil.insertAfter(tagEnd,Factory.createErrorElement(XmlErrorMessages.message("element.is.not.closed")));
      return true;
    }
    TreeUtil.addChildren(tag,endTagStart);
    addToken(tag,lexer);
    if (lexer.getTokenType() != XML_TAG_END) {
      return true;
    }
    addToken(tag,lexer);
  }
 else   if (lexer.getTokenType() == XML_EMPTY_ELEMENT_END) {
    addToken(tag,lexer);
  }
 else {
    TreeUtil.insertAfter(tag.getLastChildNode(),Factory.createErrorElement(XmlErrorMessages.message("element.is.not.closed")));
  }
  return true;
}
