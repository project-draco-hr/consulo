{
  PushSupport<R,S,T> support=getPushSupportByRepository(repository);
  if (support == null)   return;
  T target=support.getDefaultTarget(repository);
  String repoName=getDisplayedRepoName(repository);
  S source=support.getSource(repository);
  final MyRepoModel<R,S,T> model=new MyRepoModel<R,S,T>(repository,support,mySingleRepoProject,source,target);
  if (target == null) {
    model.setError(VcsError.createEmptyTargetError(repoName));
  }
  final PushTargetPanel<T> pushTargetPanel=support.createTargetPanel(repository,target);
  final RepositoryWithBranchPanel<T> repoPanel=new RepositoryWithBranchPanel<T>(myProject,repoName,source.getPresentation(),pushTargetPanel);
  CheckBoxModel checkBoxModel=model.getCheckBoxModel();
  final RepositoryNode repoNode=mySingleRepoProject ? new SingleRepositoryNode(repoPanel,checkBoxModel) : new RepositoryNode(repoPanel,checkBoxModel,target != null);
  pushTargetPanel.setFireOnChangeAction(new Runnable(){
    @Override public void run(){
      repoPanel.fireOnChange();
      ((DefaultTreeModel)myPushLog.getTree().getModel()).nodeChanged(repoNode);
    }
  }
);
  myView2Model.put(repoNode,model);
  repoPanel.addRepoNodeListener(new RepositoryNodeListener<T>(){
    @Override public void onTargetChanged(    T newTarget){
      repoNode.setChecked(true);
      myExcludedRepositoryRoots.remove(model.getRepository().getRoot().getPath());
      if (!newTarget.equals(model.getTarget()) || model.hasError() || !model.hasCommitInfo()) {
        model.setTarget(newTarget);
        model.clearErrors();
        loadCommits(model,repoNode,false);
      }
    }
    @Override public void onSelectionChanged(    boolean isSelected){
      myDialog.updateOkActions();
      if (isSelected) {
        boolean forceLoad=myExcludedRepositoryRoots.remove(model.getRepository().getRoot().getPath());
        if (!model.hasCommitInfo() && (forceLoad || !model.getSupport().shouldRequestIncomingChangesForNotCheckedRepositories())) {
          loadCommits(model,repoNode,false);
        }
      }
 else {
        myExcludedRepositoryRoots.add(model.getRepository().getRoot().getPath());
      }
    }
  }
);
  rootNode.add(repoNode);
}
