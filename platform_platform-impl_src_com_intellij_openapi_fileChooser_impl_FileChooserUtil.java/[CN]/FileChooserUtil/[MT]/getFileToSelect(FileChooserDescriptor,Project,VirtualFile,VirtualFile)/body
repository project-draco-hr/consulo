{
  if (toSelect == null && lastPath == null) {
    if (project != null) {
      final VirtualFile baseDir=project.getBaseDir();
      if (baseDir != null) {
        return baseDir;
      }
    }
  }
 else   if (toSelect != null && lastPath != null) {
    if (Boolean.TRUE.equals(descriptor.getUserData(PathChooserDialog.PREFER_LAST_OVER_EXPLICIT))) {
      return lastPath;
    }
 else {
      return toSelect;
    }
  }
 else   if (toSelect == null) {
    return lastPath;
  }
 else {
    return toSelect;
  }
  return null;
}
