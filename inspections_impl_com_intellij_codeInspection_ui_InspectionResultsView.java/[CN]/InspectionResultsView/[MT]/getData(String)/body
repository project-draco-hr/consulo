{
  if (dataId.equals(DataConstants.HELP_ID))   return HELP_ID;
  if (dataId.equals(DataConstantsEx.INSPECTION_VIEW))   return this;
  TreePath[] paths=myTree.getSelectionPaths();
  if (paths == null)   return null;
  if (paths.length > 1) {
    if (DataConstantsEx.PSI_ELEMENT_ARRAY.equals(dataId)) {
      return collectPsiElements();
    }
 else {
      return null;
    }
  }
  TreePath path=paths[0];
  InspectionTreeNode selectedNode=(InspectionTreeNode)path.getLastPathComponent();
  if (selectedNode instanceof RefElementNode) {
    final RefElementNode refElementNode=(RefElementNode)selectedNode;
    RefElement refElement=refElementNode.getElement();
    final RefElement item;
    if (refElement instanceof RefImplicitConstructor) {
      item=((RefImplicitConstructor)refElement).getOwnerClass();
    }
 else {
      item=refElement;
    }
    if (!item.isValid())     return null;
    PsiElement psiElement=item.getElement();
    if (psiElement == null)     return null;
    final CommonProblemDescriptor problem=refElementNode.getProblem();
    if (problem != null) {
      if (problem instanceof ProblemDescriptor) {
        psiElement=((ProblemDescriptor)problem).getPsiElement();
        if (psiElement == null)         return null;
      }
 else {
        return null;
      }
    }
    if (DataConstants.NAVIGATABLE.equals(dataId)) {
      if (problem instanceof ProblemDescriptorImpl) {
        Navigatable navigatable=((ProblemDescriptorImpl)problem).getNavigatable();
        if (navigatable != null) {
          return navigatable;
        }
      }
      final VirtualFile virtualFile=psiElement.getContainingFile().getVirtualFile();
      if (virtualFile != null && virtualFile.isValid()) {
        return new OpenFileDescriptor(myProject,virtualFile,psiElement.getTextOffset());
      }
    }
 else     if (DataConstants.PSI_ELEMENT.equals(dataId)) {
      return psiElement;
    }
  }
 else   if (selectedNode instanceof ProblemDescriptionNode && DataConstants.NAVIGATABLE.equals(dataId)) {
    final CommonProblemDescriptor descriptor=((ProblemDescriptionNode)selectedNode).getDescriptor();
    if (descriptor instanceof ProblemDescriptorImpl) {
      Navigatable navigatable=((ProblemDescriptorImpl)descriptor).getNavigatable();
      if (navigatable != null) {
        return navigatable;
      }
    }
    PsiElement psiElement=descriptor instanceof ProblemDescriptor ? ((ProblemDescriptor)descriptor).getPsiElement() : null;
    if (psiElement == null || !psiElement.isValid())     return null;
    return new OpenFileDescriptor(myProject,psiElement.getContainingFile().getVirtualFile(),psiElement.getTextOffset());
  }
  return null;
}
