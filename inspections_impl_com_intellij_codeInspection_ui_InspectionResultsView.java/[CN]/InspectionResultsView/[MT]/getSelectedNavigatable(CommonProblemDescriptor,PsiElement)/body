{
  if (descriptor instanceof ProblemDescriptorImpl) {
    Navigatable navigatable=((ProblemDescriptorImpl)descriptor).getNavigatable();
    if (navigatable != null) {
      return navigatable;
    }
  }
  if (psiElement == null || !psiElement.isValid())   return null;
  final VirtualFile virtualFile=psiElement.getContainingFile().getVirtualFile();
  if (virtualFile != null) {
    int startOffset=0;
    if (descriptor instanceof ProblemDescriptorImpl) {
      TextRange range=((ProblemDescriptorImpl)descriptor).getTextRange();
      if (range != null) {
        startOffset=range.getStartOffset();
      }
    }
    return new OpenFileDescriptor(myProject,virtualFile,psiElement.getTextOffset() + startOffset);
  }
  return null;
}
