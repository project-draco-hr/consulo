{
  final ExcludeFolder[] excludeFolders=entry.getExcludeFolders();
  for (int idx=0; idx < excludeFolders.length; idx++) {
    ExcludeFolder excludeFolder=excludeFolders[idx];
    final VirtualFile f=excludeFolder.getFile();
    if (f == null) {
      continue;
    }
    if (VfsUtil.isAncestor(f,file,false)) {
      return IconSet.getExcludeIcon(expanded);
    }
  }
  final SourceFolder[] sourceFolders=entry.getSourceFolders();
  for (int idx=0; idx < sourceFolders.length; idx++) {
    SourceFolder sourceFolder=sourceFolders[idx];
    final VirtualFile f=sourceFolder.getFile();
    if (f == null) {
      continue;
    }
    if (f.equals(file)) {
      return IconSet.getSourceRootIcon(sourceFolder.isTestSource(),expanded);
    }
  }
  VirtualFile currentRoot=null;
  for (int idx=0; idx < sourceFolders.length; idx++) {
    SourceFolder sourceFolder=sourceFolders[idx];
    final VirtualFile f=sourceFolder.getFile();
    if (f == null) {
      continue;
    }
    if (VfsUtil.isAncestor(f,file,true)) {
      if (currentRoot != null && VfsUtil.isAncestor(f,currentRoot,false)) {
        continue;
      }
      originalIcon=IconSet.getSourceFolderIcon(sourceFolder.isTestSource(),expanded);
      currentRoot=f;
    }
  }
  return originalIcon;
}
