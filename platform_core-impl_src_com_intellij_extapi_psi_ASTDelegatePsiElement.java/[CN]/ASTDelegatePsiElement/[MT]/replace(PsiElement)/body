{
  CheckUtil.checkWritable(this);
  TreeElement elementCopy=ChangeUtil.copyToElement(newElement);
  if (getParent() instanceof ASTDelegatePsiElement) {
    final ASTDelegatePsiElement parentElement=(ASTDelegatePsiElement)getParent();
    parentElement.replaceChildInternal(this,elementCopy);
  }
 else {
    CodeEditUtil.replaceChild(getParent().getNode(),getNode(),elementCopy);
  }
  elementCopy=ChangeUtil.decodeInformation(elementCopy);
  return SourceTreeToPsiMap.treeElementToPsi(elementCopy);
}
