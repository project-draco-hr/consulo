{
  final String qualifierText;
  if (qualifier instanceof PsiMethodCallExpression) {
    final PsiMethodCallExpression callExpression=(PsiMethodCallExpression)qualifier;
    final PsiReferenceExpression methodExpression=callExpression.getMethodExpression();
    final String referenceName=methodExpression.getReferenceName();
    final PsiExpression qualifierExpression=methodExpression.getQualifierExpression();
    if (qualifierExpression == null) {
      return qualifier.getText();
    }
    final PsiType type=qualifierExpression.getType();
    if (HardcodedMethodConstants.TO_STRING.equals(referenceName) && type != null && (type.equalsToText("java.lang.StringBuffer") || type.equalsToText("java.lang.StringBuilder"))) {
      qualifierText=qualifierExpression.getText();
    }
 else {
      qualifierText=qualifier.getText();
    }
  }
 else {
    qualifierText=qualifier.getText();
  }
  return qualifierText;
}
