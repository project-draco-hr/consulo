{
  if (useIsEmpty || !(expression instanceof PsiMethodCallExpression)) {
    return expression.getText();
  }
  final PsiMethodCallExpression callExpression=(PsiMethodCallExpression)expression;
  final PsiReferenceExpression methodExpression=callExpression.getMethodExpression();
  final String referenceName=methodExpression.getReferenceName();
  final PsiExpression qualifierExpression=methodExpression.getQualifierExpression();
  if (qualifierExpression == null) {
    return expression.getText();
  }
  final PsiType type=qualifierExpression.getType();
  if (HardcodedMethodConstants.TO_STRING.equals(referenceName) && type != null && (type.equalsToText(CommonClassNames.JAVA_LANG_STRING_BUFFER) || type.equalsToText("java.lang.StringBuilder"))) {
    return qualifierExpression.getText();
  }
 else {
    return expression.getText();
  }
}
