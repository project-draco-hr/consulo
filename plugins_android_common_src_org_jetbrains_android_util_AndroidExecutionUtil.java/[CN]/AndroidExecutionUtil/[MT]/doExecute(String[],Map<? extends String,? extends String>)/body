{
  ProcessBuilder builder=new ProcessBuilder(argv);
  builder.environment().putAll(enviroment);
  ProcessResult result=readProcessOutput(builder.start());
  Map<AndroidCompilerMessageKind,List<String>> messages=result.getMessages();
  int code=result.getExitCode();
  List<String> errMessages=messages.get(AndroidCompilerMessageKind.ERROR);
  if (code != 0 && errMessages.isEmpty()) {
    throw new IOException("Command \"" + concat(argv) + "\" execution failed with exit code "+ code);
  }
 else {
    if (code == 0) {
      messages.get(AndroidCompilerMessageKind.WARNING).addAll(errMessages);
      errMessages.clear();
    }
    return messages;
  }
}
