{
  final Module[] modules=myModuleManager.getModules();
  final HashMap<VirtualFile,List<Facet>> map=new HashMap<VirtualFile,List<Facet>>();
  for (  Module module : modules) {
    final Collection<F> facets=FacetManager.getInstance(module).getFacetsByType(type);
    for (    F facet : facets) {
      for (      VirtualFile root : facet.getFacetRoots()) {
        List<Facet> list=map.get(root);
        if (list == null) {
          list=new SmartList<Facet>();
          map.put(root,list);
        }
        list.add(facet);
      }
    }
  }
  return map;
}
