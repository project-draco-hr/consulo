{
  PsiElement element=TargetElementUtil.findTargetElement(editor,ourFlagsForTargetElements);
  if (element == null && contextElement != null) {
    final PsiElement parent=contextElement.getParent();
    if (parent instanceof XmlText) {
      element=TargetElementUtil.findTargetElement(editor,ourFlagsForTargetElements,parent.getParent().getTextRange().getStartOffset() + 1);
    }
 else     if (parent instanceof XmlTag) {
      element=TargetElementUtil.findTargetElement(editor,ourFlagsForTargetElements,parent.getTextRange().getStartOffset() + 1);
    }
  }
  if (element == null && editor != null) {
    final PsiReference ref=TargetElementUtil.findReference(editor,editor.getCaretModel().getOffset());
    if (ref != null) {
      final PsiElement parent=ref.getElement().getParent();
      if (parent instanceof PsiMethodCallExpression) {
        element=parent;
      }
 else       if (ref instanceof PsiPolyVariantReference) {
        element=ref.getElement();
      }
    }
    final Lookup activeLookup=LookupManager.getInstance(file.getProject()).getActiveLookup();
    if (activeLookup != null) {
      LookupItem item=activeLookup.getCurrentItem();
      if (item == null)       return null;
      final DocumentationProvider documentationProvider=getProviderFromElement(file);
      if (documentationProvider != null) {
        element=documentationProvider.getDocumentationElementForLookupItem(file.getManager(),item.getObject(),ref != null ? ref.getElement() : contextElement);
      }
    }
  }
  storeOriginalElement(file.getProject(),contextElement,element);
  return element;
}
