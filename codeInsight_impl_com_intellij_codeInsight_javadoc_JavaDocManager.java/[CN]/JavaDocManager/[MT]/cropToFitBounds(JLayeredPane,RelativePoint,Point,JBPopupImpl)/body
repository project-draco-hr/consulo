{
  popup.setDimensionServiceKey(null);
  final Rectangle rectangle=new Rectangle(layeredPane.getX(),Math.max(startPoint.getScreenPoint().y,layeredPane.getY()),layeredPane.getWidth(),new RelativePoint(layeredPane,layeredPanePoint).getScreenPoint().y);
  final Dimension dimension=popup.getContent().getPreferredSize();
  final Rectangle bounds=new Rectangle(layeredPane.getX(),layeredPane.getY(),dimension.width,dimension.height);
  if (bounds.getMaxY() > rectangle.getMaxY()) {
    bounds.height=(int)rectangle.getMaxY() - bounds.y + 2;
  }
  popup.getContent().setPreferredSize(new Dimension(bounds.width,bounds.height));
}
