{
  SmartPsiElementPointer originalElementPointer=element != null ? element.getUserData(ORIGINAL_ELEMENT_KEY) : null;
  PsiElement originalElement=originalElementPointer != null ? originalElementPointer.getElement() : null;
  PsiFile containingFile=originalElement != null ? originalElement.getContainingFile() : element != null ? element.getContainingFile() : null;
  DocumentationProvider originalProvider=containingFile != null ? LanguageDocumentation.INSTANCE.forLanguage(containingFile.getLanguage()) : null;
  final Language elementLanguage=element != null ? element.getLanguage() : null;
  DocumentationProvider elementProvider=element == null ? null : LanguageDocumentation.INSTANCE.forLanguage(elementLanguage);
  if (elementProvider == null || (elementLanguage.getClass() == XMLLanguage.class && originalProvider != null)) {
    return originalProvider;
  }
  return elementProvider;
}
