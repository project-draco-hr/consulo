{
  component.startWait();
  if (cancelRequests) {
    myUpdateDocAlarm.cancelAllRequests();
  }
  SwingUtilities.invokeLater(new Runnable(){
    public void run(){
      if (component.isEmpty()) {
        component.setText(CodeInsightBundle.message("javadoc.fetching.progress"));
      }
    }
  }
);
  myUpdateDocAlarm.addRequest(new Runnable(){
    public void run(){
      final Exception[] ex=new Exception[1];
      final String text=ApplicationManager.getApplication().runReadAction(new Computable<String>(){
        @Nullable public String compute(){
          try {
            return provider.getJavaDoc();
          }
 catch (          Exception e) {
            ex[0]=e;
          }
          return null;
        }
      }
);
      if (ex[0] != null) {
        SwingUtilities.invokeLater(new Runnable(){
          public void run(){
            component.setText(CodeInsightBundle.message("javadoc.external.fetch.error.message",ex[0].getLocalizedMessage()),true);
          }
        }
);
        return;
      }
      final PsiElement element=provider.getElement();
      SwingUtilities.invokeLater(new Runnable(){
        public void run(){
          if (text == null) {
            component.setText(CodeInsightBundle.message("no.documentation.found"),true);
          }
 else           if (text.length() == 0) {
            component.setText(component.getText(),true);
          }
 else {
            component.setData(element,text);
          }
          final JBPopupImpl jbPopup=(JBPopupImpl)getDocInfoHint();
          if (jbPopup == null) {
            return;
          }
          jbPopup.setCaption(getTitle(element));
          final String dimensionServiceKey=jbPopup.getDimensionServiceKey();
          Dimension dimension=component.getPreferredSize();
          final Dimension storedSize=dimensionServiceKey != null ? DimensionService.getInstance().getSize(dimensionServiceKey,getProject(element)) : null;
          if (storedSize != null) {
            dimension=storedSize;
          }
          final Window window=SwingUtilities.getWindowAncestor(component);
          if (window != null) {
            window.setBounds(window.getX(),window.getY(),dimension.width,dimension.height);
            window.validate();
            window.repaint();
          }
        }
      }
);
    }
  }
,10);
}
