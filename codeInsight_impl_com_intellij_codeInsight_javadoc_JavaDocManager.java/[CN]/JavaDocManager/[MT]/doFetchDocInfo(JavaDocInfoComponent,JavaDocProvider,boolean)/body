{
  component.startWait();
  if (cancelRequests) {
    myUpdateDocAlarm.cancelAllRequests();
  }
  SwingUtilities.invokeLater(new Runnable(){
    public void run(){
      if (component.isEmpty()) {
        component.setText(CodeInsightBundle.message("javadoc.fetching.progress"));
      }
    }
  }
);
  myUpdateDocAlarm.addRequest(new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        public void run(){
          final String text;
          try {
            text=provider.getJavaDoc();
          }
 catch (          final Exception e) {
            SwingUtilities.invokeLater(new Runnable(){
              public void run(){
                component.setText(CodeInsightBundle.message("javadoc.external.fetch.error.message",e.getLocalizedMessage()),true);
              }
            }
);
            return;
          }
          SwingUtilities.invokeLater(new Runnable(){
            public void run(){
              if (text == null) {
                component.setText(CodeInsightBundle.message("no.documentation.found"),true);
              }
 else               if (text.length() == 0) {
                component.setText(component.getText(),true);
              }
 else {
                component.setData(provider.getElement(),text);
              }
              final JBPopupImpl hint=(JBPopupImpl)getDocInfoHint();
              if (hint == null) {
                return;
              }
              final String dimensionServiceKey=hint.getDimensionServiceKey();
              if (dimensionServiceKey == null) {
                return;
              }
              Dimension dimension=component.getPreferredSize();
              final Dimension storedSize=DimensionService.getInstance().getSize(dimensionServiceKey,getProject(provider.getElement()));
              if (storedSize != null) {
                dimension=storedSize;
              }
              final Window window=SwingUtilities.getWindowAncestor(component);
              if (window != null) {
                window.setBounds(window.getX(),window.getY(),dimension.width,dimension.height);
                window.validate();
                window.repaint();
              }
            }
          }
);
        }
      }
);
    }
  }
,10);
}
