{
  Set<VirtualFile> roots=getAllRoots();
  VcsLogFileFilter previousFilter=myFilterModel.getFilter();
  VcsLogRootFilter rootFilter=previousFilter != null ? previousFilter.getRootFilter() : null;
  Collection<VirtualFile> visibleRoots;
  if (rootFilter == null) {
    if (visible) {
      visibleRoots=roots;
    }
 else {
      visibleRoots=ContainerUtil.subtract(roots,Collections.singleton(root));
    }
  }
 else {
    if (visible) {
      visibleRoots=ContainerUtil.union(new HashSet<>(rootFilter.getRoots()),Collections.singleton(root));
    }
 else {
      visibleRoots=ContainerUtil.subtract(rootFilter.getRoots(),Collections.singleton(root));
    }
  }
  myFilterModel.setFilter(new VcsLogFileFilter(null,new VcsLogRootFilterImpl(visibleRoots)));
}
