{
  Set<VirtualFile> roots=getAllRoots();
  List<AnAction> rootActions=new ArrayList<>();
  if (myColorManager.isMultipleRoots()) {
    for (    VirtualFile root : ContainerUtil.sorted(roots,FILE_BY_NAME_COMPARATOR)) {
      rootActions.add(new SelectVisibleRootAction(root));
    }
  }
  List<AnAction> structureActions=new ArrayList<>();
  for (  VcsLogStructureFilter filter : myHistory) {
    structureActions.add(new SelectFromHistoryAction(filter));
  }
  if (roots.size() > 15) {
    return new DefaultActionGroup(createAllAction(),new SelectFoldersAction(),new AnSeparator("Recent"),new DefaultActionGroup(structureActions),new AnSeparator("Roots"),new DefaultActionGroup(rootActions));
  }
 else {
    return new DefaultActionGroup(createAllAction(),new SelectFoldersAction(),new AnSeparator("Roots"),new DefaultActionGroup(rootActions),new AnSeparator("Recent"),new DefaultActionGroup(structureActions));
  }
}
