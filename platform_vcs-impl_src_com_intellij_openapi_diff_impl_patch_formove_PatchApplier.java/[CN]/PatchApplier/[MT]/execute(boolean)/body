{
  myRemainingPatches.addAll(myPatches);
  final ApplyPatchStatus patchStatus=nonWriteActionPreCheck();
  if (ApplyPatchStatus.FAILURE.equals(patchStatus))   return patchStatus;
  final ApplyPatchStatus applyStatus=ApplicationManager.getApplication().runReadAction(new Computable<ApplyPatchStatus>(){
    public ApplyPatchStatus compute(){
      final Ref<ApplyPatchStatus> refStatus=new Ref<ApplyPatchStatus>(ApplyPatchStatus.FAILURE);
      CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
        public void run(){
          refStatus.set(executeWritable());
        }
      }
,VcsBundle.message("patch.apply.command"),null);
      return refStatus.get();
    }
  }
);
  final ApplyPatchStatus status=ApplyPatchStatus.SUCCESS.equals(patchStatus) ? applyStatus : ApplyPatchStatus.and(patchStatus,applyStatus);
  final TriggerAdditionOrDeletion trigger=new TriggerAdditionOrDeletion(myProject);
  addSkippedItems(trigger);
  trigger.process();
  if (showSuccessNotification || !ApplyPatchStatus.SUCCESS.equals(status)) {
    showApplyStatus(myProject,status);
  }
  refreshFiles(trigger.getAffected());
  return status;
}
