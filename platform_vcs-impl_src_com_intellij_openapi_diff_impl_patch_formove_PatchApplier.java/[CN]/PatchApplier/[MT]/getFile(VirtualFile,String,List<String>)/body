{
  VirtualFile child=baseDir;
  final String[] pieces=RelativePathCalculator.split(path);
  for (int i=0; i < pieces.length; i++) {
    final String piece=pieces[i];
    if (child == null) {
      return null;
    }
    if ("".equals(piece) || ".".equals(piece)) {
      continue;
    }
    if ("..".equals(piece)) {
      child=child.getParent();
      continue;
    }
    VirtualFile nextChild=child.findChild(piece);
    if (nextChild == null) {
      if (tail != null) {
        for (int j=i; j < pieces.length; j++) {
          final String pieceInner=pieces[j];
          tail.add(pieceInner);
        }
      }
      return child;
    }
    child=nextChild;
  }
  return child;
}
