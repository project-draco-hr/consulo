{
  try {
    DiffFragment[] woFormattingBlocks=DiffPolicy.LINES_WO_FORMATTING.buildFragments(beforeContent,afterContent);
    DiffFragment[] step1lineFragments=new DiffCorrection.TrueLineBlocks(ComparisonPolicy.IGNORE_SPACE).correctAndNormalize(woFormattingBlocks);
    return new DiffFragmentsProcessor().process(step1lineFragments);
  }
 catch (  FilesTooBigForDiffException e) {
    throw new VcsException("File " + fileName + " is too big and there are too many changes to build a diff",e);
  }
}
