{
  for (  Change change : changes) {
    ProgressManager.checkCanceled();
    if (change.getAfterRevision() == null)     continue;
    final VirtualFile afterFile=change.getAfterRevision().getFile().getVirtualFile();
    if (afterFile.isDirectory())     continue;
    myPsiFile=null;
    if (afterFile.isValid()) {
      myPsiFile=myPsiManager.findFile(afterFile);
    }
    if (myPsiFile == null) {
      mySkipped.add(new Pair<FilePath,String>(change.getAfterRevision().getFile(),ourInvalidFile));
      continue;
    }
    myNewTodoItems=new ArrayList<TodoItem>(Arrays.asList(mySearchHelper.findTodoItems(myPsiFile)));
    applyFilterAndRemoveDuplicates(myNewTodoItems,myTodoFilter);
    if (change.getBeforeRevision() == null) {
      if (myNewTodoItems.isEmpty())       continue;
      myAddedOrEditedTodos.addAll(myNewTodoItems);
    }
 else {
      myEditedFileProcessor.process(change,myNewTodoItems);
    }
  }
}
