{
  PsiAnnotationOwner owner=annotationToCheck.getOwner();
  if (owner == null)   return null;
  PsiJavaCodeReferenceElement element=annotationToCheck.getNameReferenceElement();
  if (element == null)   return null;
  PsiElement resolved=element.resolve();
  if (!(resolved instanceof PsiClass))   return null;
  for (  PsiAnnotation annotation : owner.getAnnotations()) {
    if (annotation == annotationToCheck)     continue;
    PsiJavaCodeReferenceElement nameRef=annotation.getNameReferenceElement();
    if (nameRef == null)     continue;
    PsiElement aClass=nameRef.resolve();
    if (!resolved.equals(aClass))     continue;
    if (!PsiUtil.isLanguageLevel8OrHigher(annotationToCheck)) {
      String description=JavaErrorMessages.message("annotation.duplicate.annotation");
      return HighlightInfo.newHighlightInfo(HighlightInfoType.ERROR).range(element).descriptionAndTooltip(description).create();
    }
    PsiClass annotationType=(PsiClass)resolved;
    PsiAnnotation metaAnno=PsiImplUtil.findAnnotation(annotationType.getModifierList(),CommonClassNames.JAVA_LANG_ANNOTATION_REPEATABLE);
    if (metaAnno == null) {
      String explanation=JavaErrorMessages.message("annotation.non.repeatable",annotationType.getQualifiedName());
      String description=JavaErrorMessages.message("annotation.duplicate.explained",explanation);
      return HighlightInfo.newHighlightInfo(HighlightInfoType.ERROR).range(element).descriptionAndTooltip(description).create();
    }
    String explanation=doCheckRepeatableAnnotation(metaAnno);
    if (explanation != null) {
      String description=JavaErrorMessages.message("annotation.duplicate.explained",explanation);
      return HighlightInfo.newHighlightInfo(HighlightInfoType.ERROR).range(element).descriptionAndTooltip(description).create();
    }
    PsiClass container=getRepeatableContainer(metaAnno);
    if (container != null) {
      String containerName=container.getQualifiedName();
      if (containerName != null) {
        PsiAnnotation containerAnno=owner.findAnnotation(containerName);
        if (containerAnno != null) {
          String description=JavaErrorMessages.message("annotation.container.wrong.place",containerName);
          return annotationError(containerAnno,description);
        }
      }
      PsiAnnotation.TargetType[] targets=PsiImplUtil.getTargetsForLocation(owner);
      PsiAnnotation.TargetType applicable=PsiImplUtil.findApplicableTarget(container,targets);
      if (applicable == null) {
        String target=JavaErrorMessages.message("annotation.target." + targets[0]);
        String message=JavaErrorMessages.message("annotation.container.not.applicable",containerName,target);
        return annotationError(annotation,message);
      }
    }
  }
  return null;
}
