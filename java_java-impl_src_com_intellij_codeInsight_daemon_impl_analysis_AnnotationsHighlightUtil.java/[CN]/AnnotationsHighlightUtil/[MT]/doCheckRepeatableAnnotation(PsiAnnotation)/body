{
  PsiAnnotationOwner owner=annotation.getOwner();
  if (!(owner instanceof PsiModifierList))   return null;
  PsiElement target=((PsiModifierList)owner).getParent();
  if (!(target instanceof PsiClass) || !((PsiClass)target).isAnnotationType())   return null;
  PsiClass collector=getRepeatableCollector(annotation);
  if (collector == null)   return null;
  PsiMethod[] methods=collector.findMethodsByName("value",false);
  if (methods.length == 0) {
    return JavaErrorMessages.message("annotation.container.no.value",collector.getQualifiedName());
  }
  if (methods.length == 1) {
    PsiType expected=new PsiImmediateClassType((PsiClass)target,PsiSubstitutor.EMPTY).createArrayType();
    if (!expected.equals(methods[0].getReturnType())) {
      return JavaErrorMessages.message("annotation.container.bad.type",collector.getQualifiedName(),HighlightUtil.formatType(expected));
    }
  }
  RetentionPolicy targetPolicy=getRetentionPolicy((PsiClass)target);
  if (targetPolicy != null) {
    RetentionPolicy collectorPolicy=getRetentionPolicy(collector);
    if (collectorPolicy != null && targetPolicy.compareTo(collectorPolicy) > 0) {
      return JavaErrorMessages.message("annotation.container.low.retention",collector.getQualifiedName(),collectorPolicy);
    }
  }
  return null;
}
