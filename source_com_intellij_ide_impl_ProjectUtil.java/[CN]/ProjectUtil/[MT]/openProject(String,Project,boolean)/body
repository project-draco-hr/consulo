{
  File file=new File(path);
  if (!file.exists()) {
    Messages.showMessageDialog(IdeBundle.message("error.project.file.does.not.exist",path),CommonBundle.getErrorTitle(),Messages.getErrorIcon());
    return null;
  }
  Project[] openProjects=ProjectManager.getInstance().getOpenProjects();
  for (  Project project : openProjects) {
    if (Comparing.equal(path,((ProjectImpl)project).getStateStore().getProjectFilePath())) {
      return project;
    }
  }
  if (!forceOpenInNewFrame && openProjects.length > 0) {
    int exitCode=Messages.showDialog(IdeBundle.message("prompt.open.project.in.new.frame"),IdeBundle.message("title.open.project"),new String[]{IdeBundle.message("button.yes"),IdeBundle.message("button.no"),CommonBundle.getCancelButtonText()},1,Messages.getQuestionIcon());
    if (exitCode == 1) {
      if (!closeProject(projectToClose != null ? projectToClose : openProjects[openProjects.length - 1]))       return null;
    }
 else     if (exitCode != 0) {
      return null;
    }
  }
  ProjectManagerEx projectManager=ProjectManagerEx.getInstanceEx();
  Project project=null;
  try {
    project=projectManager.loadAndOpenProject(path);
  }
 catch (  IOException e) {
    Messages.showMessageDialog(IdeBundle.message("error.cannot.load.project",e.getMessage()),IdeBundle.message("title.cannot.load.project"),Messages.getErrorIcon());
  }
catch (  JDOMException e) {
    Messages.showMessageDialog(IdeBundle.message("error.project.file.is.corrupted"),IdeBundle.message("title.cannot.load.project"),Messages.getErrorIcon());
  }
catch (  InvalidDataException e) {
    Messages.showMessageDialog(IdeBundle.message("error.project.file.is.corrupted"),IdeBundle.message("title.cannot.load.project"),Messages.getErrorIcon());
  }
  return project;
}
