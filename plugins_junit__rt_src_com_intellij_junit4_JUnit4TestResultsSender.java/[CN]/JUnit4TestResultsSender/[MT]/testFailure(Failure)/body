{
  final Description description=failure.getDescription();
  final Throwable throwable=failure.getException();
  final Throwable cause=throwable.getCause();
  if (isAssertionError(throwable.getClass()) || isAssertionError(cause != null ? cause.getClass() : null)) {
    doAddFailure(description,throwable);
  }
 else {
    prepareDefectPacket(description,throwable).send();
  }
}
