{
  if (assertion instanceof KnownException)   return ((KnownException)assertion).getPacketFactory();
  if (isComparisonFailure(assertion)) {
    return ComparisonDetailsExtractor.create(assertion);
  }
  final Throwable cause=assertion.getCause();
  if (isComparisonFailure(cause)) {
    try {
      return ComparisonDetailsExtractor.create(assertion,ComparisonDetailsExtractor.getExpected(cause),ComparisonDetailsExtractor.getActual(cause));
    }
 catch (    Throwable ignore) {
    }
  }
  final String message=assertion.getMessage();
  if (message != null) {
    PacketFactory notification=createExceptionNotification(assertion,message,"\nExpected: is \"(.*)\"\n\\s*got: \"(.*)\"\n");
    if (notification == null) {
      notification=createExceptionNotification(assertion,message,"\nExpected: (.*)\n\\s*got: (.*)");
    }
    if (notification == null) {
      notification=createExceptionNotification(assertion,message,"\\s*expected same:<(.*)> was not:<(.*)>");
    }
    if (notification == null) {
      notification=createExceptionNotification(assertion,message,"\\s*expected:<(.*)> but was:<(.*)>");
    }
    if (notification == null) {
      notification=createExceptionNotification(assertion,message,"\nExpected: \"(.*)\"\n\\s*but: was \"(.*)\"");
    }
    if (notification != null) {
      return notification;
    }
  }
  return new ExceptionPacketFactory(PoolOfTestStates.FAILED_INDEX,assertion);
}
