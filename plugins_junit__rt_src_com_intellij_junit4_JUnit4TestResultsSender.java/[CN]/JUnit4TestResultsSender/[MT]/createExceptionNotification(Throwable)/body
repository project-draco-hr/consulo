{
  if (assertion instanceof KnownException)   return ((KnownException)assertion).getPacketFactory();
  if (assertion instanceof ComparisonFailure || assertion instanceof org.junit.ComparisonFailure) {
    return ComparisonDetailsExtractor.create(assertion);
  }
  final Throwable cause=assertion.getCause();
  if (cause instanceof ComparisonFailure || cause instanceof org.junit.ComparisonFailure) {
    try {
      return ComparisonDetailsExtractor.create(assertion,ComparisonDetailsExtractor.getExpected(cause),ComparisonDetailsExtractor.getActual(cause));
    }
 catch (    Throwable ignore) {
    }
  }
  return new ExceptionPacketFactory(PoolOfTestStates.FAILED_INDEX,assertion);
}
