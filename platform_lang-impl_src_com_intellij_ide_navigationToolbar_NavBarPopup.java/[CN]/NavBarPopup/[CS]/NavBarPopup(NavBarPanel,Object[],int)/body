{
  super(createPopupContent(panel,siblings));
  myPanel=panel;
  myIndex=selectedIndex;
  setFocusRequestor(getComponent());
  setForceShowAsPopup(true);
  ListenerUtil.addMouseListener(getComponent(),new MouseAdapter(){
    public void mouseReleased(    final MouseEvent e){
      if (SystemInfo.isWindows) {
        click(e);
      }
    }
    public void mousePressed(    final MouseEvent e){
      if (!SystemInfo.isWindows) {
        click(e);
      }
    }
    private void click(    final MouseEvent e){
      if (e.getComponent() != getList())       return;
      if (!e.isConsumed() && e.isPopupTrigger()) {
        myPanel.getModel().setSelectedIndex(selectedIndex);
        IdeFocusManager.getInstance(myPanel.getProject()).requestFocus(myPanel,true);
        myPanel.rightClick(selectedIndex);
        e.consume();
      }
 else {
        final Object value=getList().getSelectedValue();
        if (value != null) {
          myPanel.navigateInsideBar(value);
        }
      }
    }
  }
);
}
