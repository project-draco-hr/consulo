{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      final ModifiableRootModel model=ModuleRootManager.getInstance(myModule).getModifiableModel();
      final LibraryTable libraryTable=model.getModuleLibraryTable();
      final Library library=libraryTable.createLibrary("test");
      final Library.ModifiableModel libraryModel=library.getModifiableModel();
      libraryModel.addRoot(VfsUtil.pathToUrl(myFixture.getTempDirPath() + "/lib"),OrderRootType.SOURCES);
      for (      String annotationsDir : annotationsDirs) {
        libraryModel.addRoot(VfsUtil.pathToUrl(myFixture.getTempDirPath() + annotationsDir),AnnotationOrderRootType.getInstance());
      }
      libraryModel.commit();
      model.commit();
    }
  }
);
}
