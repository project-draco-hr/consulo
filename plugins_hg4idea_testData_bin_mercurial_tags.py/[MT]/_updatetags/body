def _updatetags(filetags, tagtype, alltags, tagtypes):
    'Incorporate the tag info read from one file into the two\n    dictionaries, alltags and tagtypes, that contain all tag\n    info (global across all heads plus local).'
    for (name, nodehist) in filetags.iteritems():
        if (name not in alltags):
            alltags[name] = nodehist
            tagtypes[name] = tagtype
            continue
        (anode, ahist) = nodehist
        (bnode, bhist) = alltags[name]
        if ((bnode != anode) and (anode in bhist) and ((bnode not in ahist) or (len(bhist) > len(ahist)))):
            anode = bnode
        ahist.extend([n for n in bhist if (n not in ahist)])
        alltags[name] = (anode, ahist)
        tagtypes[name] = tagtype
