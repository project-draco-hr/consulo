{
  Editor editor=callback.getEditor();
  PsiElement element=callback.getContext();
  int line=editor.getCaretModel().getLogicalPosition().line;
  int lineStart=editor.getDocument().getLineStartOffset(line);
  int elementStart;
  do {
    elementStart=element.getTextRange().getStartOffset();
    int startOffset=elementStart > lineStart ? elementStart : lineStart;
    String key=computeKey(editor,startOffset);
    if (key != null) {
      while (key.length() > 0 && !ZenCodingTemplate.checkTemplateKey(key,callback,this)) {
        key=key.substring(1);
      }
      if (key.length() > 0) {
        return key;
      }
    }
    element=element.getParent();
  }
 while (element != null && elementStart > lineStart);
  return null;
}
