{
  myProject=project;
  constructUi();
  Disposer.register(myProject,this);
  myFileEditorManager=fileEditorManager;
  myConnection=project.getMessageBus().connect();
  myConnection.subscribe(ProjectTopics.PROJECT_ROOTS,new ModuleRootAdapter(){
    @Override public void rootsChanged(    ModuleRootEvent event){
      refresh();
    }
  }
);
  myAutoScrollFromSourceHandler=new MyAutoScrollFromSourceHandler();
  myDataProvider=new MyPanel();
  myDataProvider.add(myPanel,BorderLayout.CENTER);
  myCopyPasteDelegator=new CopyPasteDelegator(myProject,myPanel){
    @Override @NotNull protected PsiElement[] getSelectedElements(){
      final AbstractProjectViewPane viewPane=getCurrentProjectViewPane();
      return viewPane == null ? PsiElement.EMPTY_ARRAY : viewPane.getSelectedPSIElements();
    }
  }
;
  myAutoScrollToSourceHandler=new AutoScrollToSourceHandler(){
    @Override protected boolean isAutoScrollMode(){
      return isAutoscrollToSource(myCurrentViewId);
    }
    @Override protected void setAutoScrollMode(    boolean state){
      setAutoscrollToSource(state,myCurrentViewId);
    }
  }
;
  toolWindowManager.addToolWindowManagerListener(new ToolWindowManagerAdapter(){
    private boolean toolWindowVisible;
    @Override public void stateChanged(){
      ToolWindow window=toolWindowManager.getToolWindow(ToolWindowId.PROJECT_VIEW);
      if (window == null)       return;
      if (window.isVisible() && !toolWindowVisible) {
        String id=getCurrentViewId();
        if (isAutoscrollToSource(id)) {
          AbstractProjectViewPane currentProjectViewPane=getCurrentProjectViewPane();
          if (currentProjectViewPane != null) {
            myAutoScrollToSourceHandler.onMouseClicked(currentProjectViewPane.getTree());
          }
        }
        if (isAutoscrollFromSource(id)) {
          myAutoScrollFromSourceHandler.setAutoScrollEnabled(true);
        }
      }
      toolWindowVisible=window.isVisible();
    }
  }
);
}
