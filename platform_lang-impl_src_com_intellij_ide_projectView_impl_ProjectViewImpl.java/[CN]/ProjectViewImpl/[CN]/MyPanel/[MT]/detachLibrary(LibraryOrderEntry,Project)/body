{
  final Module module=orderEntry.getOwnerModule();
  String message=IdeBundle.message("detach.library.from.module",orderEntry.getPresentableName(),module.getName());
  String title=IdeBundle.message("detach.library");
  int ret=Messages.showOkCancelDialog(project,message,title,Messages.getQuestionIcon());
  if (ret != 0)   return;
  CommandProcessor.getInstance().executeCommand(module.getProject(),new Runnable(){
    @Override public void run(){
      final Runnable action=new Runnable(){
        @Override public void run(){
          ModuleRootManager rootManager=ModuleRootManager.getInstance(module);
          OrderEntry[] orderEntries=rootManager.getOrderEntries();
          ModifiableRootModel model=rootManager.getModifiableModel();
          OrderEntry[] modifiableEntries=model.getOrderEntries();
          for (int i=0; i < orderEntries.length; i++) {
            OrderEntry entry=orderEntries[i];
            if (entry instanceof LibraryOrderEntry && ((LibraryOrderEntry)entry).getLibrary() == orderEntry.getLibrary()) {
              model.removeOrderEntry(modifiableEntries[i]);
            }
          }
          model.commit();
        }
      }
;
      ApplicationManager.getApplication().runWriteAction(action);
    }
  }
,title,null);
}
