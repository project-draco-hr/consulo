{
  if (!CommonRefactoringUtil.checkReadOnlyStatus(project,field))   return;
  if (!field.hasModifierProperty(PsiModifier.FINAL)) {
    String message=RefactoringBundle.message("0.refactoring.is.supported.only.for.final.fields",REFACTORING_NAME);
    CommonRefactoringUtil.showErrorMessage(REFACTORING_NAME,message,HelpID.INLINE_FIELD,project);
    return;
  }
  if (!field.hasInitializer()) {
    String message=RefactoringBundle.message("no.initializer.present.for.the.field");
    CommonRefactoringUtil.showErrorMessage(REFACTORING_NAME,message,HelpID.INLINE_FIELD,project);
    return;
  }
  PsiSearchHelper searchHelper=PsiManager.getInstance(project).getSearchHelper();
  final PsiReference[] refs=searchHelper.findReferences(field,GlobalSearchScope.projectScope(project),false);
  if (refs.length == 0) {
    String message=RefactoringBundle.message("field.0.is.never.used",field.getName());
    CommonRefactoringUtil.showErrorMessage(REFACTORING_NAME,message,HelpID.INLINE_FIELD,project);
    return;
  }
  PsiReference reference=editor != null ? TargetElementUtil.findReference(editor,editor.getCaretModel().getOffset()) : null;
  if (reference != null && !field.equals(reference.resolve())) {
    reference=null;
  }
  final boolean invokedOnReference=(reference != null);
  if (!invokedOnReference) {
    if (!CommonRefactoringUtil.checkReadOnlyStatus(project,field))     return;
  }
  PsiReferenceExpression refExpression=reference != null ? (PsiReferenceExpression)reference.getElement() : null;
  InlineFieldDialog dialog=new InlineFieldDialog(project,field,refExpression);
  dialog.show();
}
