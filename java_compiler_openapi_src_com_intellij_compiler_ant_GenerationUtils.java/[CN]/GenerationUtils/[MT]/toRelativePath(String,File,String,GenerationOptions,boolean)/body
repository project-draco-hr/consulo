{
  path=normalizePath(path);
  final String substitutedPath=genOptions.subsitutePathWithMacros(path);
  if (!substitutedPath.equals(path)) {
    return substitutedPath;
  }
  if (baseDir != null) {
    File base;
    try {
      base=baseDir.getCanonicalFile();
    }
 catch (    IOException e) {
      base=baseDir;
    }
    final String relativepath=FileUtil.getRelativePath(base,new File(path));
    if (relativepath != null) {
      final boolean shouldUseAbsolutePath=useAbsolutePathsForOuterPaths && relativepath.indexOf("..") >= 0;
      if (!shouldUseAbsolutePath) {
        final String _relativePath=relativepath.replace(File.separatorChar,'/');
        final String root=BuildProperties.propertyRef(baseDirPropertyName);
        return ".".equals(_relativePath) ? root : root + "/" + _relativePath;
      }
    }
  }
  return substitutedPath;
}
