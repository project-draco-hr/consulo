{
  path=normalizePath(path);
  if (path.length() == 0) {
    return path;
  }
  final String substitutedPath=genOptions.subsitutePathWithMacros(path);
  if (!substitutedPath.equals(path)) {
    return substitutedPath;
  }
  if (baseDir != null) {
    File base;
    try {
      base=baseDir.getCanonicalFile();
    }
 catch (    IOException e) {
      base=baseDir;
    }
    final String relativepath=FileUtil.getRelativePath(base,new File(path));
    if (relativepath != null) {
      final String _relativePath=relativepath.replace(File.separatorChar,'/');
      final String root=BuildProperties.propertyRef(baseDirPropertyName);
      return ".".equals(_relativePath) ? root : root + "/" + _relativePath;
    }
  }
  return substitutedPath;
}
