{
  final PsiExpression expr=PsiTreeUtil.getParentOfType(position,PsiExpression.class);
  if (expr != null) {
    final Map<PsiExpression,PsiType> map=GuessManager.getInstance(position.getProject()).getDataFlowExpressionTypes(expr);
    for (    final PsiExpression expression : map.keySet()) {
      final PsiType castType=map.get(expression);
      final PsiType baseType=expression.getType();
      if (expectedType == null || (expectedType.isAssignableFrom(castType) && (baseType == null || !expectedType.isAssignableFrom(baseType)))) {
        consumer.consume(new CastingLookupElementDecorator(new ExpressionLookupItem(expression),castType));
      }
    }
  }
}
