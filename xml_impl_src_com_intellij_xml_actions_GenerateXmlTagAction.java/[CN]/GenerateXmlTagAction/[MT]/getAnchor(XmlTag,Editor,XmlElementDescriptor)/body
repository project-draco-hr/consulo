{
  XmlContentDFA contentDFA=XmlContentDFA.getContentDFA(contextTag);
  PsiElement anchor=null;
  int offset=editor.getCaretModel().getOffset();
  if (contentDFA != null) {
    for (    XmlTag subTag : contextTag.getSubTags()) {
      if (contentDFA.getPossibleElements().contains(selected)) {
        if (subTag.getTextOffset() > offset) {
          break;
        }
        anchor=subTag;
      }
      contentDFA.transition(subTag);
    }
  }
  if (anchor == null) {
    PsiElement[] children=contextTag.getChildren();
    for (    PsiElement child : children) {
      if (child.getTextOffset() > offset) {
        break;
      }
      anchor=child;
    }
  }
  return anchor;
}
