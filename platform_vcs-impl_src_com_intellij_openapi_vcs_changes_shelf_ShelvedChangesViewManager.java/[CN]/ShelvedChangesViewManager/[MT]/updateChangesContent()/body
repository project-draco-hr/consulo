{
  myUpdatePending=false;
  final List<ShelvedChangeList> changeLists=new ArrayList<ShelvedChangeList>(myShelveChangesManager.getShelvedChangeLists());
  changeLists.addAll(myShelveChangesManager.getRecycledShelvedChangeLists());
  if (changeLists.size() == 0) {
    if (myContent != null) {
      myContentManager.removeContent(myContent);
      myContentManager.selectContent("Local");
    }
    myContent=null;
  }
 else {
    if (myContent == null) {
      JScrollPane scrollPane=ScrollPaneFactory.createScrollPane(myTree);
      scrollPane.setBorder(null);
      myContent=ContentFactory.SERVICE.getInstance().createContent(scrollPane,VcsBundle.message("shelf.tab"),false);
      myContent.setCloseable(false);
      myContentManager.addContent(myContent);
    }
    TreeState state=TreeState.createOn(myTree);
    myTree.setModel(buildChangesModel());
    state.applyTo(myTree);
    if (myPostUpdateRunnable != null) {
      myPostUpdateRunnable.run();
    }
  }
  myPostUpdateRunnable=null;
}
