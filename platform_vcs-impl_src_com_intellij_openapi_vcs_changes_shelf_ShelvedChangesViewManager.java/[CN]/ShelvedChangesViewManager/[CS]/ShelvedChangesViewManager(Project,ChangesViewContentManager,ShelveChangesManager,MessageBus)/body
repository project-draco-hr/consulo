{
  myProject=project;
  myContentManager=contentManager;
  myShelveChangesManager=shelveChangesManager;
  bus.connect().subscribe(ShelveChangesManager.SHELF_TOPIC,new ChangeListener(){
    public void stateChanged(    ChangeEvent e){
      myUpdatePending=true;
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          updateChangesContent();
        }
      }
,ModalityState.NON_MODAL);
    }
  }
);
  myMoveRenameInfo=new HashMap<Pair<String,String>,String>();
  myTree.setRootVisible(false);
  myTree.setShowsRootHandles(true);
  myTree.setCellRenderer(new ShelfTreeCellRenderer(project,myMoveRenameInfo));
  new TreeLinkMouseListener(new ShelfTreeCellRenderer(project,myMoveRenameInfo)).install(myTree);
  final AnAction showDiffAction=ActionManager.getInstance().getAction("ShelvedChanges.Diff");
  showDiffAction.registerCustomShortcutSet(CommonShortcuts.getDiff(),myTree);
  PopupHandler.installPopupHandler(myTree,"ShelvedChangesPopupMenu",ActionPlaces.UNKNOWN);
  myTree.addMouseListener(new MouseAdapter(){
    public void mouseClicked(    final MouseEvent e){
      if (e.getClickCount() != 2)       return;
      DiffShelvedChangesAction.showShelvedChangesDiff(DataManager.getInstance().getDataContext(myTree));
    }
  }
);
}
