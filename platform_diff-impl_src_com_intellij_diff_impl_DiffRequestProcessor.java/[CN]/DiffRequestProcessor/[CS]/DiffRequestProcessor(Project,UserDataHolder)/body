{
  myProject=project;
  myContext=new MyDiffContext(context);
  myActiveRequest=new LoadingDiffRequest();
  mySettings=DiffSettingsHolder.getInstance().getSettings(myContext.getUserData(DiffUserDataKeysEx.PLACE));
  myAvailableTools=DiffManagerEx.getInstance().getDiffTools();
  myToolOrder=new LinkedList<DiffTool>(getToolOrderFromSettings(myAvailableTools));
  myPanel=new JPanel(new BorderLayout());
  myMainPanel=new MyPanel();
  myContentPanel=new Wrapper();
  myToolbarPanel=new Wrapper();
  myToolbarPanel.setFocusable(true);
  myToolbarStatusPanel=new Wrapper();
  myPanel.add(myMainPanel,BorderLayout.CENTER);
  JPanel topPanel=new JPanel(new BorderLayout());
  topPanel.add(myToolbarPanel,BorderLayout.CENTER);
  topPanel.add(myToolbarStatusPanel,BorderLayout.EAST);
  myMainPanel.add(topPanel,BorderLayout.NORTH);
  myMainPanel.add(myContentPanel,BorderLayout.CENTER);
  myMainPanel.setFocusTraversalPolicyProvider(true);
  myMainPanel.setFocusTraversalPolicy(new MyFocusTraversalPolicy());
  JComponent bottomPanel=myContext.getUserData(DiffUserDataKeysEx.BOTTOM_PANEL);
  if (bottomPanel != null)   myMainPanel.add(bottomPanel,BorderLayout.SOUTH);
  if (bottomPanel instanceof Disposable)   Disposer.register(this,(Disposable)bottomPanel);
  myState=new EmptyState();
  myContentPanel.setContent(DiffUtil.createMessagePanel(((LoadingDiffRequest)myActiveRequest).getMessage()));
  myOpenInEditorAction=new OpenInEditorAction(new Runnable(){
    @Override public void run(){
      onAfterNavigate();
    }
  }
);
}
