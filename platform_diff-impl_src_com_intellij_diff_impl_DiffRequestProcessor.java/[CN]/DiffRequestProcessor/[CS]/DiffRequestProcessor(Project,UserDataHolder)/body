{
  myProject=project;
  myContext=new MyDiffContext(context);
  myActiveRequest=new LoadingDiffRequest();
  mySettings=DiffSettingsHolder.getInstance().getSettings(myContext.getUserData(DiffUserDataKeys.PLACE));
  myAvailableTools=DiffManagerEx.getInstance().getDiffTools();
  myToolOrder=new LinkedList<DiffTool>(getToolOrderFromSettings(myAvailableTools));
  myMainPanel=new MyPanel();
  myContentPanel=new Wrapper();
  myToolbarPanel=new Wrapper();
  myToolbarPanel.setFocusable(true);
  myToolbarStatusPanel=new Wrapper();
  myProgressBar=new MyProgressBar();
  myPanel=JBUI.Panels.simplePanel(myMainPanel);
  JPanel statusPanel=JBUI.Panels.simplePanel(myToolbarStatusPanel).addToLeft(myProgressBar);
  JPanel topPanel=JBUI.Panels.simplePanel(myToolbarPanel).addToRight(statusPanel);
  myMainPanel.add(topPanel,BorderLayout.NORTH);
  myMainPanel.add(myContentPanel,BorderLayout.CENTER);
  myMainPanel.setFocusTraversalPolicyProvider(true);
  myMainPanel.setFocusTraversalPolicy(new MyFocusTraversalPolicy());
  JComponent bottomPanel=myContext.getUserData(DiffUserDataKeysEx.BOTTOM_PANEL);
  if (bottomPanel != null)   myMainPanel.add(bottomPanel,BorderLayout.SOUTH);
  if (bottomPanel instanceof Disposable)   Disposer.register(this,(Disposable)bottomPanel);
  myState=EmptyState.INSTANCE;
  myContentPanel.setContent(DiffUtil.createMessagePanel(((LoadingDiffRequest)myActiveRequest).getMessage()));
  myOpenInEditorAction=new OpenInEditorAction(new Runnable(){
    @Override public void run(){
      onAfterNavigate();
    }
  }
);
}
