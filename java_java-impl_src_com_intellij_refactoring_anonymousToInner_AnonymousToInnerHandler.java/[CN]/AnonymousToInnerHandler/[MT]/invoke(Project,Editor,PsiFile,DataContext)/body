{
  if (!CommonRefactoringUtil.checkReadOnlyStatus(project,file))   return;
  final int offset=editor.getCaretModel().getOffset();
  editor.getScrollingModel().scrollToCaret(ScrollType.MAKE_VISIBLE);
  final PsiAnonymousClass anonymousClass=findAnonymousClass(file,offset);
  if (anonymousClass == null) {
    showErrorMessage(editor,RefactoringBundle.getCannotRefactorMessage(RefactoringBundle.message("error.wrong.caret.position.anonymous")));
    return;
  }
  final PsiElement parent=anonymousClass.getParent();
  if (parent instanceof PsiEnumConstant) {
    showErrorMessage(editor,RefactoringBundle.getCannotRefactorMessage("Enum constant can't be converted to inner class"));
    return;
  }
  invoke(project,editor,anonymousClass);
}
