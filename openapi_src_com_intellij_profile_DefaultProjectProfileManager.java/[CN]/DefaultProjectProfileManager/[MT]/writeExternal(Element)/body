{
  DefaultJDOMExternalizer.writeExternal(this,element);
  if (!USE_PROJECT_LEVEL_SETTINGS)   return;
  final Map<NamedScope,String> usedProfiles=getProfilesUsedInProject();
  final HashSet<String> profilesSet=new HashSet<String>(usedProfiles.values());
  profilesSet.add(PROJECT_PROFILE);
  final List<String> sortedProfiles=new ArrayList<String>(profilesSet);
  Collections.sort(sortedProfiles);
  if (!sortedProfiles.isEmpty()) {
    final Element assignedScopes=new Element(SCOPES);
    List<NamedScope> scopes=new ArrayList<NamedScope>(usedProfiles.keySet());
    Collections.sort(scopes,new Comparator<NamedScope>(){
      public int compare(      final NamedScope o1,      final NamedScope o2){
        LOG.assertTrue(o1 != null);
        LOG.assertTrue(o2 != null);
        return o1.getName().compareTo(o2.getName());
      }
    }
);
    for (    NamedScope scope : scopes) {
      final Element scopeElement=new Element(SCOPE);
      scopeElement.setAttribute(PROFILE,usedProfiles.get(scope));
      scopeElement.setAttribute(NAME,scope.getName());
      assignedScopes.addContent(scopeElement);
    }
    element.addContent(assignedScopes);
    final Element profiles=new Element(PROFILES);
    for (    String profile : sortedProfiles) {
      final Profile projectProfile=myProfiles.get(profile);
      if (projectProfile != null) {
        final Element profileElement=new Element(PROFILE);
        projectProfile.writeExternal(profileElement);
        profiles.addContent(profileElement);
      }
    }
    element.addContent(profiles);
  }
}
