{
  PsiVariable variable=(PsiVariable)psiElement;
  List<FieldHidesOuterFieldUsageInfo> outerHides=new ArrayList<FieldHidesOuterFieldUsageInfo>();
  List<PsiElement> occurrencesToCheckForConflict=new ArrayList<PsiElement>();
  for (  UsageInfo usage : usages) {
    final PsiElement element=usage.getElement();
    if (element == null)     continue;
    if (usage instanceof LocalHidesFieldUsageInfo) {
      PsiJavaCodeReferenceElement collidingRef=(PsiJavaCodeReferenceElement)element;
      PsiElement resolved=collidingRef.resolve();
      if (resolved instanceof PsiField) {
        qualifyMember((PsiField)resolved,collidingRef,newName);
      }
 else {
      }
    }
 else     if (usage instanceof FieldHidesOuterFieldUsageInfo) {
      PsiJavaCodeReferenceElement collidingRef=(PsiJavaCodeReferenceElement)element;
      PsiField resolved=(PsiField)collidingRef.resolve();
      outerHides.add(new FieldHidesOuterFieldUsageInfo(element,resolved));
    }
 else {
      final PsiReference ref;
      if (usage instanceof MoveRenameUsageInfo) {
        ref=usage.getReference();
      }
 else {
        ref=element.getReference();
      }
      if (ref != null) {
        PsiElement newElem=ref.handleElementRename(newName);
        if (variable instanceof PsiField) {
          occurrencesToCheckForConflict.add(newElem);
        }
      }
    }
  }
  variable.setName(newName);
  listener.elementRenamed(variable);
  if (variable instanceof PsiField) {
    for (    PsiElement occurrence : occurrencesToCheckForConflict) {
      fixPossibleNameCollisionsForFieldRenaming((PsiField)variable,newName,occurrence);
    }
  }
  for (  FieldHidesOuterFieldUsageInfo usage : outerHides) {
    final PsiElement element=usage.getElement();
    PsiJavaCodeReferenceElement collidingRef=(PsiJavaCodeReferenceElement)element;
    PsiField field=(PsiField)usage.getReferencedElement();
    PsiReferenceExpression ref=createMemberReference(field,collidingRef);
    collidingRef.replace(ref);
  }
}
