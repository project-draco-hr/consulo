{
  String result;
  if (refEntity == null || refEntity instanceof RefElement && !((RefElement)refEntity).isValid())   return "invalid";
  if (refEntity instanceof RefPackage) {
    result=((RefPackage)refEntity).getQualifiedName();
  }
 else   if (refEntity.getOwner() == null) {
    result=refEntity.getName();
  }
 else   if (refEntity instanceof RefClass && ((RefClass)refEntity).isAnonymous()) {
    result=refEntity.getName() + " in " + getQualifiedName(refEntity.getOwner());
  }
 else   if (refEntity instanceof RefMethod && ((RefMethod)refEntity).getOwnerClass().isAnonymous()) {
    result="anonymous." + refEntity.getName();
  }
 else {
    result=refEntity.getName();
    RefEntity refParent=refEntity.getOwner();
    while (refParent != null && !(refParent instanceof RefProject) && !(refParent instanceof RefPackage)) {
      result=refParent.getName() + "." + result;
      refParent=refParent.getOwner();
    }
  }
  return result;
}
