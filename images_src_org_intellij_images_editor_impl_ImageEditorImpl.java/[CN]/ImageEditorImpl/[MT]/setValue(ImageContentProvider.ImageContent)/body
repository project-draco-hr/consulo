{
  ImageDocument document=editorUI.getImageComponent().getDocument();
  BufferedImage image=content.getImage();
  String format=content.getFormat();
  if (image != null && format != null) {
    BufferedImage previousImage=document.getValue();
    document.setFormat(format);
    document.setValue(image);
    ImageZoomModel zoomModel=getZoomModel();
    if (previousImage == null || !zoomModel.isZoomLevelChanged()) {
      Options options=OptionsManager.getInstance().getOptions();
      ZoomOptions zoomOptions=options.getEditorOptions().getZoomOptions();
      zoomModel.setZoomFactor(1.0d);
      if (zoomOptions.isSmartZooming()) {
        Dimension prefferedSize=zoomOptions.getPrefferedSize();
        if (prefferedSize.width > image.getWidth() && prefferedSize.height > image.getHeight()) {
          double factor=(prefferedSize.getWidth() / (double)image.getWidth() + prefferedSize.getHeight() / (double)image.getHeight()) / 2.0d;
          zoomModel.setZoomFactor(Math.ceil(factor));
        }
      }
    }
  }
 else {
    document.setValue(null);
    document.setFormat(null);
    VirtualFile file=contentProvider.getVirtualFile();
    if (file != null) {
      FileEditorManager editorManager=FileEditorManager.getInstance(project);
      editorManager.closeFile(file);
    }
  }
}
