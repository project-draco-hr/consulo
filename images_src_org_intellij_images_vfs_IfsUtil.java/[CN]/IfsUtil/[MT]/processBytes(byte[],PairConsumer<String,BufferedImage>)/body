{
  InputStream inputStream=new ByteArrayInputStream(content,0,content.length);
  ImageInputStream imageInputStream=ImageIO.createImageInputStream(inputStream);
  try {
    Iterator<ImageReader> imageReaders=ImageIO.getImageReaders(imageInputStream);
    if (imageReaders.hasNext()) {
      ImageReader imageReader=imageReaders.next();
      try {
        final String formatName=imageReader.getFormatName();
        ImageReadParam param=imageReader.getDefaultReadParam();
        imageReader.setInput(imageInputStream,true,true);
        int minIndex=imageReader.getMinIndex();
        BufferedImage image=imageReader.read(minIndex,param);
        consumer.consume(formatName,image);
        return true;
      }
  finally {
        imageReader.dispose();
      }
    }
  }
  finally {
    imageInputStream.close();
  }
  return false;
}
