{
  final LogicalRoot logicalRoot=LogicalRootsManager.getLogicalRootsManager(project).findLogicalRoot(file);
  if (logicalRoot != null) {
    return getRelativePath(file,logicalRoot.getVirtualFile());
  }
  ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  VirtualFile sourceRoot=fileIndex.getSourceRootForFile(file);
  if (sourceRoot != null) {
    return getRelativePath(file,sourceRoot);
  }
  VirtualFile root=fileIndex.getContentRootForFile(file);
  if (root != null) {
    return getRelativePath(file,root);
  }
  return file.getPath();
}
