{
  Long loadedTimeStamp=file.getUserData(TIMESTAMP_KEY);
  SoftReference<BufferedImage> imageRef=file.getUserData(BUFFERED_IMAGE_REF_KEY);
  if (loadedTimeStamp == null || loadedTimeStamp.longValue() != file.getTimeStamp() || imageRef == null || imageRef.get() == null) {
    try {
      final byte[] content=file.contentsToByteArray();
      final boolean loaded=processBytes(content,new PairConsumer<String,BufferedImage>(){
        public void consume(        final String formatName,        final BufferedImage image){
          file.putUserData(FORMAT_KEY,formatName);
          file.putUserData(BUFFERED_IMAGE_REF_KEY,new SoftReference<BufferedImage>(image));
        }
      }
);
      if (loaded)       return true;
    }
  finally {
      file.putUserData(TIMESTAMP_KEY,file.getTimeStamp());
    }
  }
  return false;
}
