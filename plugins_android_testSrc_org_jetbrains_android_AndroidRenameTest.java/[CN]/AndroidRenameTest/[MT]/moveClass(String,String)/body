{
  new WriteCommandAction.Simple(myFixture.getProject()){
    @Override protected void run() throws Throwable {
      PsiClass aClass=JavaPsiFacade.getInstance(getProject()).findClass(className,GlobalSearchScope.projectScope(getProject()));
      PsiPackage aPackage=JavaPsiFacade.getInstance(getProject()).findPackage(newPackageName);
      final PsiDirectory[] dirs=aPackage.getDirectories();
      assertEquals(dirs.length,1);
      new MoveClassesOrPackagesProcessor(getProject(),new PsiElement[]{aClass},new SingleSourceRootMoveDestination(PackageWrapper.create(JavaDirectoryService.getInstance().getPackage(dirs[0])),dirs[0]),true,true,null).run();
    }
  }
.execute().throwException();
}
