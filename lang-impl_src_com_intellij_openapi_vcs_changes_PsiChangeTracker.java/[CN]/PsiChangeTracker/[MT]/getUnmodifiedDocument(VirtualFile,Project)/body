{
  final Change change=ChangeListManager.getInstance(project).getChange(file);
  if (change != null) {
    final ContentRevision beforeRevision=change.getBeforeRevision();
    if (beforeRevision instanceof BinaryContentRevision) {
      return null;
    }
    if (beforeRevision != null) {
      String content;
      try {
        content=beforeRevision.getContent();
      }
 catch (      VcsException ex) {
        content=null;
      }
      return content == null ? null : StringUtil.convertLineSeparators(content);
    }
    return null;
  }
  final Document document=FileDocumentManager.getInstance().getCachedDocument(file);
  if (document != null && document.getModificationStamp() != file.getModificationStamp()) {
    return ApplicationManager.getApplication().runReadAction(new Computable<String>(){
      public String compute(){
        return LoadTextUtil.loadText(file).toString();
      }
    }
);
  }
  return null;
}
