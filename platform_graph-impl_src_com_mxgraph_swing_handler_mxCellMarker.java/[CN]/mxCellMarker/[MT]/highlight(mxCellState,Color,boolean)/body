{
  if (valid) {
    validState=state;
  }
 else {
    validState=null;
  }
  if (state != markedState || color != currentColor) {
    currentColor=color;
    if (state != null && currentColor != null) {
      markedState=state;
      mark();
    }
 else     if (markedState != null) {
      markedState=null;
      unmark();
    }
  }
}
