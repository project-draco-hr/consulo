{
  final Exception[] failReason=new Exception[]{null};
  CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          try {
            final String newFileNameWithExtension=newFileName.endsWith('.' + fileType.getDefaultExtension()) ? newFileName : newFileName + '.' + fileType.getDefaultExtension();
            final VirtualFile file=parentDirectory.createChildData(this,newFileNameWithExtension);
            FileContentUtil.setFileText(myProject,file,initialContent);
            updateTree();
            select(file,null);
          }
 catch (          IOException e) {
            failReason[0]=e;
          }
        }
      }
);
    }
  }
,UIBundle.message("file.chooser.create.new.file.command.name"),null);
  return failReason[0];
}
