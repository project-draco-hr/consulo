{
  final Exception[] failReason=new Exception[]{null};
  CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          try {
            VirtualFile folder=parentDirectory.createChildDirectory(this,newFolderName);
            updateTree();
            FileElement folderDesc=new FileElement(folder,folder.getName());
            myTreeBuilder.buildNodeForElement(folderDesc);
            DefaultMutableTreeNode folderNode=myTreeBuilder.getNodeForElement(folderDesc);
            if (folderNode != null) {
              TreePath treePath=new TreePath(folderNode.getPath());
              myTree.setSelectionPath(treePath);
              myTree.scrollPathToVisible(treePath);
              myTree.expandPath(treePath);
            }
          }
 catch (          IOException e) {
            failReason[0]=e;
          }
        }
      }
);
    }
  }
,"Create New Folder",null);
  return failReason[0];
}
