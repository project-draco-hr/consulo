{
  try {
    CipherEntry ce=getEntry(type);
    Class cc=Class.forName(ce.cipherClass);
    BlockCipher bc=(BlockCipher)cc.newInstance();
    if (type.endsWith("-cbc")) {
      bc.init(encrypt,key);
      return new CBCMode(bc,iv,encrypt);
    }
 else     if (type.endsWith("-ctr")) {
      bc.init(true,key);
      return new CTRMode(bc,iv,encrypt);
    }
    throw new IllegalArgumentException("Cannot instantiate " + type);
  }
 catch (  Exception e) {
    throw new IllegalArgumentException("Cannot instantiate " + type);
  }
}
