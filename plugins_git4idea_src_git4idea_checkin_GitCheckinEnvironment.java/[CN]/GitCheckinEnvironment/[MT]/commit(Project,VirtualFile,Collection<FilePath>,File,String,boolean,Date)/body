{
  boolean amend=nextCommitAmend;
  for (  List<String> paths : VcsFileUtil.chunkPaths(root,files)) {
    GitSimpleHandler handler=new GitSimpleHandler(project,root,GitCommand.COMMIT);
    if (amend) {
      handler.addParameters("--amend");
    }
 else {
      amend=true;
    }
    handler.addParameters("--only","-F",message.getAbsolutePath());
    if (nextCommitAuthor != null) {
      handler.addParameters("--author=" + nextCommitAuthor);
    }
    if (nextCommitAuthorDate != null) {
      handler.addParameters("--date",COMMIT_DATE_FORMAT.format(nextCommitAuthorDate));
    }
    handler.endOptions();
    handler.addParameters(paths);
    handler.run();
  }
  if (!project.isDisposed()) {
    GitRepositoryManager manager=GitUtil.getRepositoryManager(project);
    manager.updateRepository(root);
  }
}
