{
  boolean amend=nextCommitAmend;
  for (  List<String> paths : VcsFileUtil.chunkPaths(root,files)) {
    GitSimpleHandler handler=new GitSimpleHandler(project,root,GitCommand.COMMIT);
    handler.setNoSSH(true);
    if (amend) {
      handler.addParameters("--amend");
    }
 else {
      amend=true;
    }
    handler.addParameters("--only","-F",message.getAbsolutePath());
    if (nextCommitAuthor != null) {
      handler.addParameters("--author=" + nextCommitAuthor);
    }
    handler.endOptions();
    handler.addParameters(paths);
    handler.run();
  }
  if (!project.isDisposed()) {
    GitRepositoryManager manager=GitUtil.getRepositoryManager(project);
    if (manager != null) {
      manager.updateRepository(root,GitRepository.TrackedTopic.CURRENT_REVISION,GitRepository.TrackedTopic.STATE);
    }
  }
}
