{
  StringBuilder filteredMessage=new StringBuilder(message.length());
  for (StringTokenizer stk=new StringTokenizer(message,"\n"); stk.hasMoreTokens(); ) {
    String line=stk.nextToken();
    if (line.charAt(0) == '#') {
      continue;
    }
    filteredMessage.append(line).append('\n');
  }
  File file=File.createTempFile(GIT_COMIT_MSG_FILE_PREFIX,GIT_COMIT_MSG_FILE_EXT);
  file.deleteOnExit();
  Writer out=new OutputStreamWriter(new FileOutputStream(file),"UTF-8");
  try {
    out.write(filteredMessage.toString());
  }
  finally {
    out.close();
  }
  return file;
}
