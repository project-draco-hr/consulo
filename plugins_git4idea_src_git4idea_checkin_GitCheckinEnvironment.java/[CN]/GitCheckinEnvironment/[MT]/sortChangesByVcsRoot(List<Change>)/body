{
  Map<VirtualFile,List<Change>> result=new HashMap<VirtualFile,List<Change>>();
  for (  Change change : changes) {
    final ContentRevision afterRevision=change.getAfterRevision();
    final ContentRevision beforeRevision=change.getBeforeRevision();
    if (beforeRevision != null) {
      final FilePath filePath=afterRevision != null ? afterRevision.getFile() : beforeRevision.getFile();
      final VirtualFile vcsRoot=GitUtil.getVcsRoot(myProject,filePath);
      List<Change> changeList=result.get(vcsRoot);
      if (changeList == null) {
        changeList=new ArrayList<Change>();
        result.put(vcsRoot,changeList);
      }
      changeList.add(change);
    }
  }
  return result;
}
