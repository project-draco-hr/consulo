{
  ArrayList<VcsException> rc=new ArrayList<VcsException>();
  Map<VirtualFile,List<VirtualFile>> sortedFiles;
  try {
    sortedFiles=GitUtil.sortFilesByGitRoot(files);
  }
 catch (  VcsException e) {
    rc.add(e);
    return rc;
  }
  for (  Map.Entry<VirtualFile,List<VirtualFile>> e : sortedFiles.entrySet()) {
    try {
      final VirtualFile root=e.getKey();
      GitFileUtils.addFiles(myProject,root,e.getValue());
      markRootDirty(root);
    }
 catch (    VcsException ex) {
      rc.add(ex);
    }
  }
  return rc;
}
