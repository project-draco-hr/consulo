{
  if (getFileSystem() != newParent.getFileSystem()) {
    throw new IOException(VfsBundle.message("file.move.error",newParent.getPresentableUrl()));
  }
  EncodingRegistry.doActionAndRestoreEncoding(this,new ThrowableComputable<VirtualFile,IOException>(){
    @Override public VirtualFile compute() throws IOException {
      ourPersistence.moveFile(requestor,VirtualFileSystemEntry.this,newParent);
      return VirtualFileSystemEntry.this;
    }
  }
);
}
