{
  if (!(this instanceof SettingsAwareBlock)) {
    return EMPTY;
  }
  PsiElement psi=myNode.getPsi();
  if (psi == null) {
    return EMPTY;
  }
  PsiFile file=psi.getContainingFile();
  if (file == null) {
    return EMPTY;
  }
  if (InjectedLanguageUtil.areInjectionsProcessed(file) && InjectedLanguageUtil.getCachedInjectedDocuments(file).isEmpty()) {
    return EMPTY;
  }
  final Ref<PsiFile> injectedRef=new Ref<PsiFile>();
  InjectedLanguageUtil.enumerate(psi,file,true,new PsiLanguageInjectionHost.InjectedPsiVisitor(){
    @Override public void visit(    @NotNull PsiFile injectedPsi,    @NotNull List<PsiLanguageInjectionHost.Shred> places){
      if (injectedRef.get() == null) {
        injectedRef.set(injectedPsi);
      }
    }
  }
);
  PsiFile injected=injectedRef.get();
  if (injected != null && myNode.getTextLength() >= injected.getTextLength()) {
    List<Block> result=new ArrayList<Block>();
    DefaultInjectedLanguageBlockBuilder builder=new DefaultInjectedLanguageBlockBuilder(((SettingsAwareBlock)this).getSettings());
    builder.addInjectedBlocks(result,myNode,getWrap(),getAlignment(),getIndent());
    return result;
  }
  return EMPTY;
}
