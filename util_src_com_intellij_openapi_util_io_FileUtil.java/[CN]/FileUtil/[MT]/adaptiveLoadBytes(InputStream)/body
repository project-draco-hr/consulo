{
  byte[] bytes=new byte[4096];
  int count=0;
  while (true) {
    int n=stream.read(bytes,count,bytes.length - count);
    if (n <= 0)     break;
    count+=n;
    if (count == bytes.length) {
      bytes=ArrayUtil.realloc(bytes,bytes.length * 2);
    }
  }
  if (count < bytes.length) {
    bytes=ArrayUtil.realloc(bytes,count);
  }
  return bytes;
}
