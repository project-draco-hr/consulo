{
  toDir.mkdirs();
  if (isAncestor(fromDir,toDir,true)) {
    Logger.getInstance("#com.intellij.openapi.util.io.FileUtil").error(fromDir.getAbsolutePath() + " is ancestor of " + toDir+ ". Can't copy to itself.");
    return;
  }
  File[] files=fromDir.listFiles();
  if (!fromDir.canRead())   throw new IOException("Directory is not readable " + fromDir.getPath());
  if (files == null)   throw new IOException("Directory is invalid " + fromDir.getPath());
  for (  File file : files) {
    if (file.isDirectory()) {
      copyDir(file,new File(toDir,file.getName()));
    }
 else {
      copy(file,new File(toDir,file.getName()));
    }
  }
}
