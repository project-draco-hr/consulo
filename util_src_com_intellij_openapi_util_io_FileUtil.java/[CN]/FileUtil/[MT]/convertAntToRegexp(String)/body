{
  final StringBuilder buf=StringBuilderSpinAllocator.alloc();
  try {
    int cur=0;
    boolean isAfterAsterix=false;
    while (cur < pattern.length()) {
      char curChar=pattern.charAt(cur);
      if (curChar != '*' && isAfterAsterix) {
        buf.append("[^\\/]*");
        isAfterAsterix=false;
      }
      if (curChar == '*') {
        if (!isAfterAsterix) {
          isAfterAsterix=true;
        }
 else {
          buf.append(".*");
          isAfterAsterix=false;
        }
      }
 else {
        buf.append(curChar);
      }
      cur++;
    }
    if (isAfterAsterix) {
      buf.append("[^\\/]*");
    }
    return buf.toString();
  }
  finally {
    StringBuilderSpinAllocator.dispose(buf);
  }
}
