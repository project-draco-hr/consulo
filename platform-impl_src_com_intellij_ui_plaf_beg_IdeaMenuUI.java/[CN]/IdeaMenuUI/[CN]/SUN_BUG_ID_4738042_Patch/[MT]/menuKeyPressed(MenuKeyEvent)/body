{
  char keyChar=e.getKeyChar();
  if (!Character.isLetterOrDigit(keyChar))   return;
  MenuSelectionManager manager=e.getMenuSelectionManager();
  MenuElement selectedPath[]=manager.getSelectedPath();
  for (int i=selectedPath.length - 1; i >= 0; i--) {
    if (selectedPath[i] == menuItem) {
      JPopupMenu popupMenu=((JMenu)menuItem).getPopupMenu();
      MenuElement items[]=popupMenu.getSubElements();
      int index=-1;
      for (int j=0; j < items.length; j++) {
        int key=((JMenuItem)items[j]).getMnemonic();
        if (Character.toLowerCase((char)key) == Character.toLowerCase(keyChar)) {
          index=j;
          break;
        }
      }
      if (index != -1) {
        JMenuItem item=(JMenuItem)items[index];
        if (!(item instanceof JMenu)) {
          manager.clearSelectedPath();
          item.doClick();
        }
      }
      e.consume();
      return;
    }
  }
}
