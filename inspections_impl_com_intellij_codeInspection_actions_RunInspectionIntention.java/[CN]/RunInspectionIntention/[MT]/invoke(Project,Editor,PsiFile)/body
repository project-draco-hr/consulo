{
  final InspectionManagerEx managerEx=((InspectionManagerEx)InspectionManagerEx.getInstance(project));
  final InspectionProjectProfileManager profileManager=InspectionProjectProfileManager.getInstance(project);
  final Module module=ModuleUtil.findModuleForPsiElement(file);
  final BaseAnalysisActionDialog dlg=new BaseAnalysisActionDialog(AnalysisScopeBundle.message("specify.analysis.scope",InspectionsBundle.message("inspection.action.title")),AnalysisScopeBundle.message("analysis.scope.title",InspectionsBundle.message("inspection.action.noun")),project,new AnalysisScope(file),module != null ? module.getName() : null,true);
  AnalysisScope scope=new AnalysisScope(file);
  dlg.show();
  if (!dlg.isOK())   return;
  final UIOptions uiOptions=((InspectionManagerEx)InspectionManagerEx.getInstance(project)).getUIOptions();
  scope=dlg.getScope(uiOptions,scope,project,module);
  rerunInspection(managerEx,scope);
}
