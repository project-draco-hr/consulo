{
  if (aClass.getQualifiedName() == null)   return;
  PsiFile file=context.getFile();
  int newTail=JavaCompletionUtil.insertClassReference(aClass,file,context.getStartOffset(),context.getTailOffset());
  if (newTail > context.getDocument().getTextLength() || newTail < 0) {
    LOG.error(LogMessageEx.createEvent("Invalid offset after insertion ","offset=" + newTail + "\n"+ "document="+ context.getDocument()+ "\n"+ DebugUtil.currentStackTrace(),new Attachment(context.getFile().getViewProvider().getVirtualFile())));
  }
  context.setTailOffset(newTail);
  JavaCompletionUtil.shortenReference(file,context.getStartOffset());
  PostprocessReformattingAspect.getInstance(context.getProject()).doPostponedFormatting();
}
