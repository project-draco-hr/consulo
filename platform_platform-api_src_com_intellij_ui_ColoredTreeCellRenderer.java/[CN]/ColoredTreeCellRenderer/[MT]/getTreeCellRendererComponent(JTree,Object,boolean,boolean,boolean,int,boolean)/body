{
  myTree=tree;
  clear();
  mySelected=selected;
  myFocused=tree.hasFocus();
  if (UIUtil.isFullRowSelectionLAF()) {
    setBackground(selected ? UIUtil.getTreeSelectionBackground() : null);
  }
 else   if (UIUtil.isUnderAquaLookAndFeel() && tree.getUI() instanceof UIUtil.MacTreeUI && ((UIUtil.MacTreeUI)tree.getUI()).isWideSelection()) {
    setPaintFocusBorder(false);
  }
 else {
    if (selected) {
      setPaintFocusBorder(true);
      if (myFocused) {
        setBackground(UIUtil.getTreeSelectionBackground());
      }
 else {
        setBackground(null);
      }
    }
 else {
      setBackground(null);
    }
  }
  if (value instanceof LoadingNode) {
    setForeground(Color.gray);
    setIcon(LOADING_NODE_ICON);
  }
 else {
    setForeground(tree.getForeground());
    setIcon(null);
  }
  if (UIUtil.isUnderGTKLookAndFeel()) {
    super.setOpaque(false);
    super.setIconOpaque(false);
  }
 else   if (UIUtil.isUnderNimbusLookAndFeel() && selected && hasFocus) {
    super.setOpaque(false);
    super.setIconOpaque(false);
  }
 else   if (UIUtil.isUnderAquaLookAndFeel() && tree.getUI() instanceof UIUtil.MacTreeUI && ((UIUtil.MacTreeUI)tree.getUI()).isWideSelection()) {
    super.setOpaque(false);
    super.setIconOpaque(false);
  }
 else {
    super.setOpaque(myOpaque || selected && hasFocus || selected && tree.hasFocus());
  }
  customizeCellRenderer(tree,value,selected,expanded,leaf,row,hasFocus);
  if (tree.getUI() instanceof UIUtil.MacTreeUI) {
    setFont(UIUtil.isUnderAquaLookAndFeel() ? UIUtil.getLabelFont(UIUtil.FontSize.TREE) : getFont());
    setMyBorder(null);
    setIpad(new Insets(0,2,0,2));
  }
 else   if (getFont() == null) {
    setFont(tree.getFont());
  }
  return this;
}
