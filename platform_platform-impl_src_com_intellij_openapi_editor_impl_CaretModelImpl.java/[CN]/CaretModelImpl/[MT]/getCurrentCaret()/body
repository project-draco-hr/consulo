{
  CaretImpl currentCaret=myCurrentCaret;
  return ApplicationManager.getApplication().isDispatchThread() && currentCaret != null ? currentCaret : getPrimaryCaret();
}
