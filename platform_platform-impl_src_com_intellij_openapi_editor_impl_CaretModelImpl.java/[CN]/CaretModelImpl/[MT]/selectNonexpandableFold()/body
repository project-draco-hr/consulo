{
  final LogicalPosition pos=getLogicalPosition();
  if (prevPos == null) {
    prevPos=pos;
  }
 else {
    int columnShift=pos.line == prevPos.line ? pos.column - prevPos.column : 0;
    prevPos=pos;
    final FoldRegion collapsedUndeCaret=myEditor.getFoldingModel().getCollapsedRegionAtOffset(getOffset());
    if (collapsedUndeCaret != null && collapsedUndeCaret.shouldNeverExpand()) {
      if (columnShift > 0) {
        moveToOffset(collapsedUndeCaret.getEndOffset());
      }
 else       if (columnShift < 0) {
        moveToOffset(collapsedUndeCaret.getStartOffset());
      }
      myEditor.getSelectionModel().setSelection(collapsedUndeCaret.getStartOffset(),collapsedUndeCaret.getEndOffset());
    }
  }
}
