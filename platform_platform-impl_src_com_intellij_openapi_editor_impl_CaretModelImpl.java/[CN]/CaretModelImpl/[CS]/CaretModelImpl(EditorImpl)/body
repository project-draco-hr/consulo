{
  myEditor=editor;
  myCarets.add(new CaretImpl(myEditor));
  DocumentBulkUpdateListener bulkUpdateListener=new DocumentBulkUpdateListener(){
    @Override public void updateStarted(    @NotNull Document doc){
      for (      CaretImpl caret : myCarets) {
        caret.onBulkDocumentUpdateStarted(doc);
      }
    }
    @Override public void updateFinished(    @NotNull final Document doc){
      doWithCaretMerging(new Runnable(){
        @Override public void run(){
          for (          CaretImpl caret : myCarets) {
            caret.onBulkDocumentUpdateFinished(doc);
          }
        }
      }
);
    }
  }
;
  ApplicationManager.getApplication().getMessageBus().connect(this).subscribe(DocumentBulkUpdateListener.TOPIC,bulkUpdateListener);
}
