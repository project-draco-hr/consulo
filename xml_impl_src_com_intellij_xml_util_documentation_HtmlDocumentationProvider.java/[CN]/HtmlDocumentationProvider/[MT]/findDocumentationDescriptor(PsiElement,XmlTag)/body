{
  boolean isTag=true;
  PsiElement nameElement=null;
  String key=null;
  if (element instanceof XmlElementDecl) {
    nameElement=((XmlElementDecl)element).getNameElement();
  }
 else   if (element instanceof XmlAttributeDecl) {
    nameElement=((XmlAttributeDecl)element).getNameElement();
    isTag=false;
  }
 else   if (element instanceof XmlTag) {
    final XmlTag xmlTag=((XmlTag)element);
    final PsiMetaData metaData=xmlTag.getMetaData();
    key=(metaData != null) ? metaData.getName() : null;
    isTag=xmlTag.getLocalName().equals(ELEMENT_ELEMENT_NAME);
  }
 else   if (element.getParent() instanceof XmlAttributeValue) {
    isTag=false;
    key=((XmlAttribute)element.getParent().getParent()).getName();
  }
 else   if (element instanceof XmlAttributeValue) {
    isTag=false;
    final XmlAttribute xmlAttribute=(XmlAttribute)element.getParent();
    key=xmlAttribute.getName();
  }
 else   if (element instanceof XmlAttribute) {
    final XmlAttribute xmlAttribute=(XmlAttribute)element;
    isTag=false;
    key=xmlAttribute.getName();
  }
 else   if (element instanceof XmlElement) {
    nameElement=element;
    isTag=!(element.getParent() instanceof XmlAttribute);
  }
 else {
    nameElement=element;
    isTag=context != null && element.getText().startsWith(context.getName());
  }
  if (nameElement != null) {
    key=nameElement.getText();
  }
  key=(key != null) ? key.toLowerCase() : "";
  int dotIndex=key.indexOf('.');
  if (dotIndex > 0) {
    key=key.substring(0,dotIndex);
  }
  if (isTag) {
    return HtmlDescriptorsTable.getTagDescriptor(key);
  }
 else {
    return getDescriptor(key,context);
  }
}
