{
synchronized (documentsToCommit) {
    if (!changeCommitStage(document,start,CommitStage.QUEUED_TO_COMMIT,false))     return;
    Object[] documentTasks=documentsToCommit.toArray();
    for (    Object o : documentTasks) {
      CommitTask task=(CommitTask)o;
      if (task.document == document) {
        ProgressIndicator current=document.getUserData(COMMIT_PROGRESS);
        if (current == null) {
        }
 else {
          current.cancel();
        }
        return;
      }
    }
    ProgressIndicator indicator=new ProgressIndicatorBase();
    indicator.start();
    documentsToCommit.addLast(new CommitTask(document,project,indicator,reason,event));
    log("Queued",document,false,reason);
  }
}
