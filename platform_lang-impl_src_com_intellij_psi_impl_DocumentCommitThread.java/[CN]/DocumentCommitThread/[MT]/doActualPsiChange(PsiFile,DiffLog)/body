{
  file.getViewProvider().beforeContentsSynchronized();
  try {
    final Document document=file.getViewProvider().getDocument();
    PsiDocumentManagerImpl documentManager=(PsiDocumentManagerImpl)PsiDocumentManager.getInstance(file.getProject());
    PsiToDocumentSynchronizer.DocumentChangeTransaction transaction=documentManager.getSynchronizer().getTransaction(document);
    final PsiFileImpl fileImpl=(PsiFileImpl)file;
    if (transaction == null) {
      final PomModel model=PomManager.getModel(fileImpl.getProject());
      model.runTransaction(new PomTransactionBase(fileImpl,model.getModelAspect(TreeAspect.class)){
        public PomModelEvent runInner(){
          return new TreeAspectEvent(model,diffLog.performActualPsiChange(file));
        }
      }
);
    }
 else {
      diffLog.performActualPsiChange(file);
    }
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
}
