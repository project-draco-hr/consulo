{
  threadFinished=false;
  try {
    while (!isDisposed) {
      try {
        Document document;
synchronized (documentsToCommit) {
          int size=documentsToCommit.size();
          if (size == 0) {
            documentsToCommit.wait();
            continue;
          }
          document=documentsToCommit.get(size - 1);
        }
        if (document == THE_POISON_PILL)         break;
        boolean success=commit(myProject,document,null,recreateIndicator(),false);
synchronized (documentsToCommit) {
          if (success) {
            documentsToCommit.remove(document);
          }
          documentsToCommit.notifyAll();
        }
      }
 catch (      ProcessCanceledException ignored) {
      }
catch (      InterruptedException ignored) {
      }
catch (      Throwable e) {
        LOG.error(e);
      }
    }
  }
  finally {
    threadFinished=true;
  }
}
