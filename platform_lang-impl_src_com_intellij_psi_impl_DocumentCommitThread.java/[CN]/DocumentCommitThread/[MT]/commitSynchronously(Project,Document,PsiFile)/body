{
  ApplicationManager.getApplication().assertWriteAccessAllowed();
  cancelCommit(document);
  PsiDocumentManagerImpl.setCommitStage(document,PsiDocumentManagerImpl.CommitStage.QUEUED_TO_COMMIT);
  boolean success=commit(project,document,excludeFile,new DaemonProgressIndicator(),true);
  assert success;
  return success;
}
