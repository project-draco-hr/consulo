{
  if (project.isDisposed())   return;
  if (properties == null)   return;
  final String testRunDebugId=properties.isDebug() ? ToolWindowId.DEBUG : ToolWindowId.RUN;
  final ToolWindowManager toolWindowManager=ToolWindowManager.getInstance(project);
  String title;
  String text;
  String balloonText;
  MessageType type;
  if (root == null) {
    balloonText=title=ExecutionBundle.message("test.not.started.progress.text");
    text="";
    type=MessageType.WARNING;
  }
 else {
    List allTests=Filter.LEAF.select(root.getAllTests());
    final List<AbstractTestProxy> failed=Filter.DEFECTIVE_LEAF.select(allTests);
    int failedCount=failed.size();
    final List<AbstractTestProxy> notStarted=Filter.NOT_PASSED.select(allTests);
    notStarted.removeAll(failed);
    int notStartedCount=notStarted.size();
    int passedCount=allTests.size() - failedCount - notStartedCount;
    if (failedCount > 0) {
      title=ExecutionBundle.message("junit.runing.info.tests.failed.label");
      text=passedCount + " passed, " + failedCount+ " failed"+ (notStartedCount > 0 ? ", " + notStartedCount + " not started" : "");
      type=MessageType.ERROR;
    }
 else     if (notStartedCount > 0) {
      title=ExecutionBundle.message("junit.runing.info.failed.to.start.error.message");
      text=passedCount + " passed, " + notStartedCount+ " not started";
      type=MessageType.ERROR;
    }
 else {
      title=ExecutionBundle.message("junit.runing.info.tests.passed.label");
      text=passedCount + " passed";
      type=MessageType.INFO;
    }
    balloonText=title + ": " + text;
  }
  if (!Comparing.strEqual(toolWindowManager.getActiveToolWindowId(),testRunDebugId)) {
    toolWindowManager.notifyByBalloon(testRunDebugId,type,balloonText,null,null);
  }
  SystemNotifications.getInstance().notify("TestRunner",title,text);
}
