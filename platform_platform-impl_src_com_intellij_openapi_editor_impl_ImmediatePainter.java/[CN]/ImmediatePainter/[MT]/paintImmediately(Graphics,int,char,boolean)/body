{
  if (g == null)   return;
  TextAttributes attributes=((LexerEditorHighlighter)getHighlighter()).getAttributes((DocumentImpl)getDocument(),offset,c);
  int fontType=attributes.getFontType();
  FontInfo fontInfo=EditorUtil.fontForChar(c,attributes.getFontType(),myEditor);
  Font font=fontInfo.getFont();
  FontMetrics fontMetrics=myEditor.getFontMetrics(fontType);
  int charWidth=fontMetrics.charWidth(c);
  int delta=charWidth;
  if (!insert && offset < getDocument().getTextLength()) {
    delta-=fontMetrics.charWidth(getDocument().getCharsSequence().charAt(offset));
  }
  Rectangle tailArea=lineRectangleBetween(offset,getDocument().getLineEndOffset(myEditor.offsetToLogicalLine(offset)));
  if (tailArea.isEmpty()) {
    tailArea.width+=EditorUtil.getSpaceWidth(fontType,myEditor);
  }
  Color background=attributes.getBackgroundColor() == null ? getCaretRowBackground() : attributes.getBackgroundColor();
  Rectangle newArea=lineRectangleBetween(offset,offset);
  newArea.width+=charWidth;
  String newText=Character.toString(c);
  Point point=newArea.getLocation();
  int ascent=myEditor.getAscent();
  Color foreground=attributes.getForegroundColor() == null ? myEditor.getForegroundColor() : attributes.getForegroundColor();
  EditorUIUtil.setupAntialiasing(g);
  if (delta != 0) {
    shift(g,tailArea,delta);
  }
  fill(g,newArea,background);
  print(g,newText,point,ascent,font,foreground);
  Toolkit.getDefaultToolkit().sync();
  if (isZeroLatencyTypingDebugEnabled()) {
    pause();
  }
}
