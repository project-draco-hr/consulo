{
  if (!added.add(facet)) {
    return true;
  }
  FacetInfo2<Module> underlyingInfo=facet.getUnderlyingFacetInfo();
  if (underlyingInfo instanceof DetectedFacetInfo && !addFacetBean((DetectedFacetInfo<Module>)underlyingInfo,facetsBean,added)) {
    return false;
  }
  try {
    final Element configuration=FacetUtil.saveFacetConfiguration(facet.getConfiguration());
    final String underlyingId;
    if (underlyingInfo instanceof FacetInfoBackedByFacet) {
      underlyingId=FacetPointersManager.constructId(((FacetInfoBackedByFacet)underlyingInfo).getFacet());
    }
 else {
      underlyingId=underlyingInfo != null ? "/" + ((DetectedFacetInfo)underlyingInfo).getId() : null;
    }
    DetectedFacetBean facetBean=new DetectedFacetBean(facet.getId(),facet.getFacetName(),facet.getModule().getName(),configuration,facet.getFacetType().getStringId(),underlyingId,facet.getDetectorId());
    facetsBean.myFacets.add(facetBean);
    return true;
  }
 catch (  WriteExternalException e) {
    LOG.info(e);
    return false;
  }
}
