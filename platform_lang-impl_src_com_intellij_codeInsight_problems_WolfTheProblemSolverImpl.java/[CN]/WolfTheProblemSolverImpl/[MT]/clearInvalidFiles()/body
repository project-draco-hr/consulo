{
  VirtualFile[] files;
synchronized (myProblems) {
    files=myProblems.keySet().toArray(new VirtualFile[myProblems.size()]);
  }
  for (  VirtualFile problemFile : files) {
    if (!problemFile.isValid() || !isToBeHighlighted(problemFile)) {
      doRemove(problemFile);
    }
  }
}
