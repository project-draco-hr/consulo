{
  final TextRange range=curr.getTextRange();
  try {
    sb.append(document.getCharsSequence(),range.getStartOffset(),range.getEndOffset());
  }
 catch (  ArrayIndexOutOfBoundsException oob) {
    LOG.error("internal error attempting to append text to document");
    LOG.error("document.getCharsSequence.length=" + document.getCharsSequence().length());
    LOG.error("document.getCharsSequence.toString().length=" + document.getCharsSequence().toString().length());
    LOG.error("document...toCharArray.length=" + document.getCharsSequence().toString().toCharArray().length);
    LOG.error("current PSI element=" + curr.toString());
    LOG.error("current PSI element text=" + curr.getText());
    LOG.error("current PSI element text range, start offset=" + range.getStartOffset());
    LOG.error("current PSI element text range, end offset=" + range.getEndOffset());
    LOG.error("current PSI element text range, length=" + range.getLength());
    LOG.error(oob);
    throw oob;
  }
}
