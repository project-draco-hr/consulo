{
  try {
    sb.append(document.getCharsSequence().toString().toCharArray(),curr.getTextRange().getStartOffset(),curr.getTextRange().getEndOffset() - curr.getTextRange().getStartOffset());
  }
 catch (  ArrayIndexOutOfBoundsException oob) {
    LOG.error("internal error attempting to append text to document");
    LOG.error("document.getCharsSequence.length=" + document.getCharsSequence().length());
    LOG.error("document.getCharsSequence.toString().length=" + document.getCharsSequence().toString().length());
    LOG.error("document...toCharArray.length=" + document.getCharsSequence().toString().toCharArray().length);
    LOG.error("current PSI element=" + curr.toString());
    LOG.error("current PSI element text=" + curr.getText());
    LOG.error("current PSI element text range, start offset=" + curr.getTextRange().getStartOffset());
    LOG.error("current PSI element text range, end offset=" + curr.getTextRange().getEndOffset());
    LOG.error("current PSI element text range, length=" + curr.getTextRange().getLength());
    LOG.error(oob);
    throw oob;
  }
}
