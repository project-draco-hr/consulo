{
  final CompilerConfiguration compilerConfiguration=CompilerConfiguration.getInstance(myProject);
  final List<VirtualFile> compilableFiles=getCompilableFiles(compiler,snapshot,context);
  for (Iterator<VirtualFile> it=compilableFiles.iterator(); it.hasNext(); ) {
    final VirtualFile file=it.next();
    if (!forceCompile) {
      if (compilerConfiguration.isExcludedFromCompilation(file)) {
        continue;
      }
    }
    if (forceCompile || file.getTimeStamp() != cache.getSourceTimestamp(snapshot.getUrlByFile(file))) {
      if (LOG.isDebugEnabled()) {
        final String url=snapshot.getUrlByFile(file);
        LOG.debug("File is out-of-date: " + url + "; current timestamp = "+ file.getTimeStamp()+ "; stored timestamp = "+ cache.getSourceTimestamp(url));
      }
      toCompile.add(file);
    }
  }
}
