{
  try {
    if (isRebuild) {
      deleteAll(context);
      if (context.getMessageCount(CompilerMessageCategory.ERROR) > 0) {
        return ExitStatus.ERRORS;
      }
    }
    try {
      context.getProgressIndicator().pushState();
      if (!executeCompileTasks(context,true)) {
        return ExitStatus.CANCELLED;
      }
    }
  finally {
      context.getProgressIndicator().popState();
    }
    if (context.getMessageCount(CompilerMessageCategory.ERROR) > 0) {
      return ExitStatus.ERRORS;
    }
    boolean didSomething=false;
    final CompilerManager compilerManager=CompilerManager.getInstance(myProject);
    didSomething|=generateSources(compilerManager,context,forceCompile);
    if (myExitStatus != null) {
      return myExitStatus;
    }
    didSomething|=invokeFileProcessingCompilers(compilerManager,context,SourceInstrumentingCompiler.class,myProcessingCompilerAdapterFactory,forceCompile);
    if (myExitStatus != null) {
      return myExitStatus;
    }
    try {
      didSomething|=translate(context,compilerManager,forceCompile,isRebuild);
      if (myExitStatus != null) {
        return myExitStatus;
      }
      didSomething|=invokeFileProcessingCompilers(compilerManager,context,ClassInstrumentingCompiler.class,myProcessingCompilerAdapterFactory,forceCompile);
      if (myExitStatus != null) {
        return myExitStatus;
      }
      didSomething|=invokeFileProcessingCompilers(compilerManager,context,ClassPostProcessingCompiler.class,myProcessingCompilerAdapterFactory,forceCompile);
      if (myExitStatus != null) {
        return myExitStatus;
      }
      didSomething|=invokeFileProcessingCompilers(compilerManager,context,PackagingCompiler.class,myPackagingCompilerAdapterFactory,forceCompile);
      if (myExitStatus != null) {
        return myExitStatus;
      }
      didSomething|=invokeFileProcessingCompilers(compilerManager,context,Validator.class,myProcessingCompilerAdapterFactory,forceCompile);
      if (myExitStatus != null) {
        return myExitStatus;
      }
    }
  finally {
      context.getProgressIndicator().setText("Saving caches...");
      context.getDependencyCache().dispose();
    }
    try {
      context.getProgressIndicator().pushState();
      if (!executeCompileTasks(context,false)) {
        return ExitStatus.CANCELLED;
      }
    }
  finally {
      context.getProgressIndicator().popState();
    }
    if (context.getMessageCount(CompilerMessageCategory.ERROR) > 0) {
      return ExitStatus.ERRORS;
    }
    if (!didSomething) {
      return ExitStatus.UP_TO_DATE;
    }
    return ExitStatus.SUCCESS;
  }
 catch (  ProcessCanceledException e) {
    return ExitStatus.CANCELLED;
  }
}
