{
  if (expression == null) {
    return true;
  }
  if (PsiUtil.isConstantExpression(expression) || ExpressionUtils.isNullLiteral(expression)) {
    return true;
  }
  if (expression instanceof PsiNewExpression) {
    final PsiNewExpression newExpression=(PsiNewExpression)expression;
    final PsiExpression[] arrayDimensions=newExpression.getArrayDimensions();
    if (arrayDimensions.length > 0) {
      for (      PsiExpression arrayDimension : arrayDimensions) {
        if (!isMoveable(arrayDimension)) {
          return false;
        }
      }
      return true;
    }
    final PsiArrayInitializerExpression arrayInitializer=newExpression.getArrayInitializer();
    boolean result=true;
    if (arrayInitializer != null) {
      final PsiExpression[] initializers=arrayInitializer.getInitializers();
      for (      final PsiExpression initializerExpression : initializers) {
        result&=isMoveable(initializerExpression);
      }
    }
 else     if (!m_allowConstructorAsInitializer) {
      final PsiType type=newExpression.getType();
      if (!ClassUtils.isImmutable(type)) {
        return false;
      }
    }
    final PsiExpressionList argumentList=newExpression.getArgumentList();
    if (argumentList == null) {
      return result;
    }
    final PsiExpression[] expressions=argumentList.getExpressions();
    for (    final PsiExpression argumentExpression : expressions) {
      result&=isMoveable(argumentExpression);
    }
    return result;
  }
  if (expression instanceof PsiReferenceExpression) {
    final PsiReferenceExpression referenceExpression=(PsiReferenceExpression)expression;
    final PsiElement target=referenceExpression.resolve();
    if (!(target instanceof PsiField)) {
      return false;
    }
    final PsiField field=(PsiField)target;
    if (ExpressionUtils.isConstant(field)) {
      return true;
    }
  }
  return false;
}
