{
  ApplicationManagerEx.getApplicationEx().assertIsDispatchThread();
  final Project project=editor.getProject();
  if (project != null && (!project.equals(myProject) || !project.isOpen()))   return;
  Document document=editor.getDocument();
  PsiFile file=PsiDocumentManager.getInstance(myProject).getPsiFile(document);
  if (file == null || !file.getViewProvider().isPhysical() || !file.isValid())   return;
  PsiDocumentManager.getInstance(myProject).commitDocument(document);
  Editor[] otherEditors=EditorFactory.getInstance().getEditors(document,myProject);
  if (otherEditors.length == 0 && !editor.isDisposed()) {
    getDocumentFoldingInfo(document).loadFromEditor(editor);
  }
  EditorFoldingInfo.get(editor).dispose();
}
