{
  editor.getScrollingModel().scrollToCaret(ScrollType.MAKE_VISIBLE);
  final SelectionModel model=editor.getSelectionModel();
  if (model.hasSelection()) {
    invokeImpl(project,editor,file,model.getSelectionStart(),model.getSelectionEnd());
  }
 else {
    final List<GrExpression> expressions=GrIntroduceHandlerBase.collectExpressions(file,editor,editor.getCaretModel().getOffset(),true);
    final Pass<GrExpression> callback=new Callback(project,editor,file);
    if (expressions.size() == 1) {
      callback.pass(expressions.get(0));
    }
 else     if (expressions.isEmpty()) {
      model.selectLineAtCaret();
      invokeImpl(project,editor,file,model.getSelectionStart(),model.getSelectionEnd());
    }
 else {
      IntroduceTargetChooser.showChooser(editor,expressions,callback,GrIntroduceHandlerBase.GR_EXPRESSION_RENDERER);
    }
  }
}
