{
  final UpToDateLineNumberProvider provider=getProvider(vf,document);
  if (provider == null)   return range;
  return ApplicationManager.getApplication().runReadAction(new Computable<TextRange>(){
    @Override public TextRange compute(){
      return new TextRange(provider.getLineNumber(range.getStartOffset()),provider.getLineNumber(range.getEndOffset()));
    }
  }
);
}
