{
  final Object source=getSource();
  try {
    if (source instanceof PsiViewerExtension) {
      return ((PsiViewerExtension)source).createElement(myProject,text);
    }
    if (source instanceof FileType) {
      final FileType type=(FileType)source;
      String ext=type.getDefaultExtension();
      if (myExtensionComboBox.isVisible()) {
        ext=myExtensionComboBox.getSelectedItem().toString().toLowerCase();
      }
      if (type instanceof LanguageFileType) {
        final Language language=((LanguageFileType)type).getLanguage();
        final Language dialect=(Language)myDialectComboBox.getSelectedItem();
        return PsiFileFactory.getInstance(myProject).createFileFromText("Dummy." + ext,dialect == null ? language : dialect,text);
      }
      return PsiFileFactory.getInstance(myProject).createFileFromText("Dummy." + ext,text);
    }
  }
 catch (  IncorrectOperationException e) {
    Messages.showMessageDialog(myProject,e.getMessage(),"Error",Messages.getErrorIcon());
  }
  return null;
}
