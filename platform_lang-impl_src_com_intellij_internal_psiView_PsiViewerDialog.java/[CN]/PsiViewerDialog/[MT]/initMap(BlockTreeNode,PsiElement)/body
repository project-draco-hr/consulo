{
  PsiElement currentElem=null;
  if (rootBlockNode.getBlock() instanceof ASTBlock) {
    ASTNode node=((ASTBlock)rootBlockNode.getBlock()).getNode();
    if (node != null) {
      currentElem=node.getPsi();
    }
  }
  if (currentElem == null) {
    currentElem=InjectedLanguageFacadeImpl.findElementAtNoCommit(psiEl.getContainingFile(),rootBlockNode.getBlock().getTextRange().getStartOffset());
  }
  myPsiToBlockMap.put(currentElem,rootBlockNode);
  TextRange curTextRange=currentElem.getTextRange();
  PsiElement parentElem=currentElem.getParent();
  while (parentElem != null && parentElem.getTextRange().equals(curTextRange)) {
    myPsiToBlockMap.put(parentElem,rootBlockNode);
    parentElem=parentElem.getParent();
  }
  for (  BlockTreeNode block : rootBlockNode.getChildren()) {
    initMap(block,psiEl);
  }
}
