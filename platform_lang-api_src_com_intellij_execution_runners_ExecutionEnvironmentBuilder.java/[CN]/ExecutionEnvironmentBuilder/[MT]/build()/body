{
  if (myRunner == null) {
    if (myRunnerId == null) {
      myRunner=RunnerRegistry.getInstance().getRunner(myExecutor.getId(),myRunProfile);
    }
 else {
      myRunner=RunnerRegistry.getInstance().findRunnerById(myRunnerId);
    }
  }
  if (myRunner == null) {
    throw new IllegalStateException("Runner must be specified");
  }
  ExecutionEnvironment environment=new ExecutionEnvironment(myRunProfile,myExecutor,myTarget,myProject,myRunnerSettings,myConfigurationSettings,myContentToReuse,myRunnerAndConfigurationSettings,myRunner);
  if (myAssignNewId) {
    environment.assignNewExecutionId();
  }
  if (myDataContext != null) {
    environment.setDataContext(myDataContext);
  }
  return environment;
}
