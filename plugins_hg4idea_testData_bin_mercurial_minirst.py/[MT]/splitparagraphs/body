def splitparagraphs(blocks):
    'Split paragraphs into lists.'
    listtypes = [('bullet', _bulletre, True), ('option', _optionre, True), ('field', _fieldre, True), ('definition', _definitionre, False)]

    def match(lines, i, itemre, singleline):
        'Does itemre match an item at line i?\n\n        A list item can be followed by an idented line or another list\n        item (but only if singleline is True).\n        '
        line1 = lines[i]
        line2 = ((((i + 1) < len(lines)) and lines[(i + 1)]) or '')
        if (not itemre.match(line1)):
            return False
        if singleline:
            return ((line2 == '') or (line2[0] == ' ') or itemre.match(line2))
        else:
            return line2.startswith(' ')
    i = 0
    while (i < len(blocks)):
        if (blocks[i]['type'] == 'paragraph'):
            lines = blocks[i]['lines']
            for (type, itemre, singleline) in listtypes:
                if match(lines, 0, itemre, singleline):
                    items = []
                    for (j, line) in enumerate(lines):
                        if match(lines, j, itemre, singleline):
                            items.append(dict(type=type, lines=[], indent=blocks[i]['indent']))
                        items[(-1)]['lines'].append(line)
                    blocks[i:(i + 1)] = items
                    break
        i += 1
    return blocks
