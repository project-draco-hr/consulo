{
  final Project project=(Project)dataContext.getData(DataConstants.PROJECT);
  if (project == null)   return null;
  final Editor editor=(Editor)dataContext.getData(DataConstants.EDITOR);
  if (editor != null) {
    PsiFile psiFile=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
    if (psiFile != null)     return psiFile.getContainingDirectory();
  }
 else {
    PsiElement element=(PsiElement)dataContext.getData(DataConstants.PSI_ELEMENT);
    if (element != null) {
      if (element instanceof PsiDirectory)       return (PsiDirectory)element;
 else {
        PsiFile psiFile=element.getContainingFile();
        if (psiFile != null)         return psiFile.getContainingDirectory();
      }
    }
 else {
      VirtualFile virtualFile=(VirtualFile)dataContext.getData(DataConstants.VIRTUAL_FILE);
      if (virtualFile != null && virtualFile.isValid()) {
        PsiFile psiFile=PsiManager.getInstance(project).findFile(virtualFile);
        if (psiFile != null)         return psiFile.getContainingDirectory();
      }
    }
  }
  return null;
}
