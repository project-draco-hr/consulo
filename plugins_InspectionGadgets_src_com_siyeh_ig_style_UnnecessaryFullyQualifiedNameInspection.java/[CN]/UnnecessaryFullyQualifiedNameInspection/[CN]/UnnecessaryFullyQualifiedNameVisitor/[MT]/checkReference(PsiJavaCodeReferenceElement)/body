{
  if (!reference.isQualified()) {
    return;
  }
  final PsiElement parent=reference.getParent();
  if (parent instanceof PsiMethodCallExpression || parent instanceof PsiAssignmentExpression || parent instanceof PsiVariable) {
    return;
  }
  final PsiElement element=PsiTreeUtil.getParentOfType(reference,PsiImportStatementBase.class,PsiPackageStatement.class,JavaCodeFragment.class);
  if (element != null) {
    return;
  }
  if (m_ignoreJavadoc) {
    final PsiElement containingComment=PsiTreeUtil.getParentOfType(reference,PsiDocComment.class);
    if (containingComment != null) {
      return;
    }
  }
  final PsiFile containingFile=reference.getContainingFile();
  if (!(containingFile instanceof PsiJavaFile)) {
    return;
  }
  final PsiElement psiElement=reference.resolve();
  if (!(psiElement instanceof PsiClass)) {
    return;
  }
  PsiClass aClass=(PsiClass)psiElement;
  final Project project=aClass.getProject();
  final CodeStyleSettings styleSettings=CodeStyleSettingsManager.getSettings(project);
  if (!styleSettings.INSERT_INNER_CLASS_IMPORTS) {
    aClass=ClassUtils.getOutermostContainingClass(aClass);
  }
  final String fqName=aClass.getQualifiedName();
  if (fqName == null) {
    return;
  }
  final String referenceText=reference.getText();
  final String text=StringUtils.stripAngleBrackets(referenceText);
  if (!text.equals(fqName)) {
    return;
  }
  if (!ImportUtils.nameCanBeImported(fqName,reference)) {
    return;
  }
  final PsiJavaFile javaFile=(PsiJavaFile)containingFile;
  final String packageName=javaFile.getPackageName();
  final String elementPackageName=ClassUtil.extractPackageName(text);
  final boolean inSameFile=elementPackageName.equals(packageName);
  registerError(reference,Boolean.valueOf(inSameFile));
}
