{
  myScanner.processWords(new CharArrayCharSequence(chars,0,length),new Processor<WordOccurrence>(){
    public boolean process(    final WordOccurrence t){
      IdCacheUtil.addOccurrence(wordsTable,t.getText(),convertToMask(t.getKind()));
      if (t.getKind() == WordOccurrence.Kind.COMMENTS || t.getKind() == null) {
        if (todoCounts != null) {
          for (int index=0; index < todoPatterns.length; index++) {
            Pattern pattern=todoPatterns[index].getPattern();
            if (pattern != null) {
              CharSequence input=t.getText();
              Matcher matcher=pattern.matcher(input);
              while (matcher.find()) {
                if (matcher.start() != matcher.end()) {
                  todoCounts[index]++;
                }
              }
            }
          }
        }
      }
      return true;
    }
    private int convertToMask(    final WordOccurrence.Kind kind){
      if (kind == null)       return UsageSearchContext.ANY;
      if (kind == WordOccurrence.Kind.CODE)       return UsageSearchContext.IN_CODE;
      if (kind == WordOccurrence.Kind.COMMENTS)       return UsageSearchContext.IN_COMMENTS;
      if (kind == WordOccurrence.Kind.LITERALS)       return UsageSearchContext.IN_STRINGS;
      return 0;
    }
  }
);
}
