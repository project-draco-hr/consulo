{
  final CharArrayCharSequence text=new CharArrayCharSequence(chars,0,length);
  myScanner.processWords(text,new Processor<WordOccurrence>(){
    public boolean process(    final WordOccurrence t){
      IdCacheUtil.addOccurrence(wordsTable,t.getText(),convertToMask(t.getKind()));
      return true;
    }
    private int convertToMask(    final WordOccurrence.Kind kind){
      if (kind == null)       return UsageSearchContext.ANY;
      if (kind == WordOccurrence.Kind.CODE)       return UsageSearchContext.IN_CODE;
      if (kind == WordOccurrence.Kind.COMMENTS)       return UsageSearchContext.IN_COMMENTS;
      if (kind == WordOccurrence.Kind.LITERALS)       return UsageSearchContext.IN_STRINGS;
      if (kind == WordOccurrence.Kind.FOREIGN_LANGUAGE)       return UsageSearchContext.IN_FOREIGN_LANGUAGES;
      return 0;
    }
  }
);
  if (myHighlighter != null && myCommentTokens != null && todoCounts != null) {
    final LexerEditorHighlighter highlighter=HighlighterFactory.createHighlighter(manager.getProject(),myFile);
    highlighter.setText(text);
    final HighlighterIterator iterator=highlighter.createIterator(0);
    while (!iterator.atEnd()) {
      final IElementType token=iterator.getTokenType();
      if (IdCacheUtil.isInComments(token) || myCommentTokens.contains(token)) {
        BaseFilterLexer.advanceTodoItemsCount(text.subSequence(iterator.getStart(),iterator.getEnd()),todoCounts);
      }
      iterator.advance();
    }
  }
}
