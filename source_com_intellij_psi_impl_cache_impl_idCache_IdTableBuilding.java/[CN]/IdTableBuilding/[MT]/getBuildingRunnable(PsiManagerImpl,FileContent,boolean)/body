{
  if (LOG.isDebugEnabled()) {
    LOG.debug("enter: getBuildingRunnable(file='" + fileContent.getVirtualFile() + "' buildTodos='"+ buildTodos+ "' )");
  }
  final VirtualFile virtualFile=fileContent.getVirtualFile();
  LOG.assertTrue(virtualFile.isValid());
  if (virtualFile.getLength() > FILE_SIZE_LIMIT)   return null;
  final FileType fileType=FileTypeManager.getInstance().getFileTypeByFile(virtualFile);
  if (fileType.isBinary())   return null;
  if (StdFileTypes.CLASS.equals(fileType))   return null;
  final TIntIntHashMap wordsTable=new TIntIntHashMap();
  final int[] todoCounts;
  final TodoPattern[] todoPatterns=TodoConfiguration.getInstance().getTodoPatterns();
  if (buildTodos && CacheManagerImpl.canContainTodoItems(fileContent.getVirtualFile())) {
    int patternCount=todoPatterns.length;
    todoCounts=patternCount > 0 ? new int[patternCount] : null;
  }
 else {
    todoCounts=null;
  }
  final PsiFile psiFile=manager.getFile(fileContent);
  if (psiFile == null)   return null;
  final char[] chars=psiFile.textToCharArray();
  final int textLength=psiFile.getTextLength();
  final IdCacheBuilder cacheBuilder=getCacheBuilder(fileType);
  if (cacheBuilder == null)   return null;
  Runnable runnable=new Runnable(){
    public void run(){
synchronized (PsiLock.LOCK) {
        cacheBuilder.build(chars,textLength,wordsTable,todoPatterns,todoCounts,manager);
      }
    }
  }
;
  return new Result(runnable,wordsTable,todoCounts);
}
