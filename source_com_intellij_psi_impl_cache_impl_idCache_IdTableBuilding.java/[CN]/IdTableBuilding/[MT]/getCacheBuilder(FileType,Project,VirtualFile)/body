{
  final IdCacheBuilder idCacheBuilder=cacheBuilders.get(fileType);
  if (idCacheBuilder != null)   return idCacheBuilder;
  final WordsScanner customWordsScanner=CacheBuilderRegistry.getInstance().getCacheBuilder(fileType);
  if (customWordsScanner != null) {
    return new WordsScannerIdCacheBuilderAdapter(customWordsScanner,null,null,virtualFile);
  }
  final SyntaxHighlighter highlighter=fileType.getHighlighter(project,virtualFile);
  if (fileType instanceof LanguageFileType) {
    final Language lang=((LanguageFileType)fileType).getLanguage();
    final FindUsagesProvider findUsagesProvider=lang.getFindUsagesProvider();
    final WordsScanner scanner=findUsagesProvider == null ? null : findUsagesProvider.getWordsScanner();
    if (scanner != null) {
      final ParserDefinition parserDef=lang.getParserDefinition();
      final TokenSet commentTokens=parserDef != null ? parserDef.getCommentTokens() : null;
      return new WordsScannerIdCacheBuilderAdapter(scanner,highlighter,commentTokens,virtualFile);
    }
  }
  if (fileType instanceof CustomFileType) {
    final TokenSet commentTokens=TokenSet.create(CustomHighlighterTokenType.LINE_COMMENT,CustomHighlighterTokenType.MULTI_LINE_COMMENT);
    return new WordsScannerIdCacheBuilderAdapter(((CustomFileType)fileType).getWordsScanner(),highlighter,commentTokens,virtualFile);
  }
  return null;
}
