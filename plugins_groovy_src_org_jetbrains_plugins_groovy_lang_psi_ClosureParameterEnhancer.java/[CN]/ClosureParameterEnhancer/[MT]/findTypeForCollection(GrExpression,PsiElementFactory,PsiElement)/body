{
  PsiType iterType=qualifier.getType();
  if (iterType == null)   return null;
  if (iterType instanceof PsiArrayType) {
    return ((PsiArrayType)iterType).getComponentType();
  }
  if (iterType instanceof GrTupleType) {
    PsiType[] types=((GrTupleType)iterType).getParameters();
    return types.length == 1 ? types[0] : null;
  }
  if (factory.createTypeFromText("groovy.lang.IntRange",context).isAssignableFrom(iterType)) {
    return factory.createTypeFromText(CommonClassNames.JAVA_LANG_INTEGER,context);
  }
  if (factory.createTypeFromText("groovy.lang.ObjectRange",context).isAssignableFrom(iterType)) {
    PsiElement element=qualifier;
    element=removeBrackets(element);
    if (element instanceof GrReferenceExpression) {
      GrReferenceExpression ref=(GrReferenceExpression)element;
      element=removeBrackets(ref.resolve());
    }
    if (element instanceof GrRangeExpression) {
      return getRangeElementType((GrRangeExpression)element);
    }
    return null;
  }
  PsiType res=PsiUtil.extractIterableTypeParameter(iterType,true);
  if (res != null) {
    return res;
  }
  if (iterType.equalsToText(CommonClassNames.JAVA_LANG_STRING) || iterType.equalsToText("java.io.File")) {
    return factory.createTypeFromText(CommonClassNames.JAVA_LANG_STRING,context);
  }
  return null;
}
