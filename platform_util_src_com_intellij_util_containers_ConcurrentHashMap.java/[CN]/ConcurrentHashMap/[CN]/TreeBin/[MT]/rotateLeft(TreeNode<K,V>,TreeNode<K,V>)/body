{
  TreeNode<K,V> r;
  if (p != null && (r=p.right) != null) {
    TreeNode<K,V> rl;
    if ((rl=p.right=r.left) != null) {
      rl.parent=p;
    }
    TreeNode<K,V> pp;
    if ((pp=r.parent=p.parent) == null) {
      (root=r).red=false;
    }
 else     if (pp.left == p) {
      pp.left=r;
    }
 else {
      pp.right=r;
    }
    r.left=p;
    p.parent=r;
  }
  return root;
}
