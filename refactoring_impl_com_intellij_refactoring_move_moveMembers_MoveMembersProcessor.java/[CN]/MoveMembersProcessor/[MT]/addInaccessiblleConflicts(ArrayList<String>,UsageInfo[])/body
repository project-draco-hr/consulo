{
  Map<PsiMember,PsiModifierList> modifierListCopies=new HashMap<PsiMember,PsiModifierList>();
  for (  PsiMember member : myMembersToMove) {
    final PsiModifierList copy=(PsiModifierList)member.getModifierList().copy();
    if (myNewVisibility != null) {
      RefactoringUtil.setVisibility(copy,myNewVisibility);
    }
    modifierListCopies.put(member,copy);
  }
  for (  UsageInfo usage : usages) {
    if (usage instanceof MyUsageInfo) {
      final MyUsageInfo usageInfo=(MyUsageInfo)usage;
      PsiElement element=usage.getElement();
      if (element != null) {
        final PsiMember member=usageInfo.member;
        PsiMember accessObjectMember=null;
        if (element instanceof PsiReferenceExpression) {
          PsiExpression qualifier=((PsiReferenceExpression)element).getQualifierExpression();
          if (qualifier != null) {
            accessObjectMember=(PsiMember)PsiUtil.getAccessObjectMember(qualifier).getElement();
          }
          if (!ResolveUtil.isAccessible(member,myTargetClass,modifierListCopies.get(member),element,accessObjectMember,null)) {
            final String newVisibility=myNewVisibility == null ? VisibilityUtil.getVisibilityStringToDisplay(member) : myNewVisibility;
            String message=RefactoringBundle.message("0.with.1.visibility.is.not.accesible.from.2",ConflictsUtil.getDescription(member,true),newVisibility,ConflictsUtil.getDescription(ConflictsUtil.getContainer(element),true));
            conflicts.add(message);
          }
        }
      }
    }
  }
}
