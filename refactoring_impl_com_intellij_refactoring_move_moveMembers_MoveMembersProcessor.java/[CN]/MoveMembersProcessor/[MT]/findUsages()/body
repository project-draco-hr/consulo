{
  final PsiManager manager=PsiManager.getInstance(myProject);
  final PsiSearchHelper helper=manager.getSearchHelper();
  final List<UsageInfo> usagesList=new ArrayList<UsageInfo>();
  for (  PsiMember member : myMembersToMove) {
    for (    PsiReference psiReference : ReferencesSearch.search(member).findAll()) {
      PsiElement ref=psiReference.getElement();
      if (ref instanceof PsiReferenceExpression) {
        PsiReferenceExpression refExpr=(PsiReferenceExpression)ref;
        PsiExpression qualifier=refExpr.getQualifierExpression();
        if (RefactoringHierarchyUtil.willBeInTargetClass(refExpr,myMembersToMove,myTargetClass,true)) {
          if (!isInMovedElement(refExpr)) {
            if (qualifier != null) {
              usagesList.add(new MyUsageInfo(member,refExpr,null,qualifier,psiReference));
            }
          }
 else {
            if (qualifier instanceof PsiReferenceExpression && ((PsiReferenceExpression)qualifier).isReferenceTo(member.getContainingClass())) {
              usagesList.add(new MyUsageInfo(member,refExpr,null,qualifier,psiReference));
            }
          }
        }
 else {
          if (qualifier == null) {
            usagesList.add(new MyUsageInfo(member,refExpr,myTargetClass,refExpr,psiReference));
          }
 else {
            usagesList.add(new MyUsageInfo(member,refExpr,myTargetClass,qualifier,psiReference));
          }
        }
      }
 else {
        if (!isInMovedElement(ref)) {
          usagesList.add(new MyUsageInfo(member,ref,null,ref,psiReference));
        }
      }
    }
  }
  UsageInfo[] usageInfos=usagesList.toArray(new UsageInfo[usagesList.size()]);
  usageInfos=UsageViewUtil.removeDuplicatedUsages(usageInfos);
  return usageInfos;
}
