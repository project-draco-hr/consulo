{
  File dir=FileUtil.createTempDirectory("unitTest",null);
  filesToDelete.add(dir);
  VirtualFile vDir2=LocalFileSystem.getInstance().refreshAndFindFileByPath(dir.getCanonicalPath().replace(File.separatorChar,'/'));
  if (rootPath != null) {
    VirtualFile vDir1=LocalFileSystem.getInstance().findFileByPath(rootPath.replace(File.separatorChar,'/'));
    if (vDir1 == null) {
      throw new Exception(rootPath + " not found");
    }
    VfsUtil.copyDirectory(null,vDir1,vDir2,null);
  }
  VirtualFile vDir=vDir2;
  if (addProjectRoots) {
    addSourceContentToRoots(module,vDir);
  }
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  return vDir;
}
