{
  if (!isEditing()) {
    return;
  }
  myFocusManager.doWhenFocusSettlesDown(new Runnable(){
    @Override public void run(){
      if (!isEditing()) {
        return;
      }
      Component c=myFocusManager.getFocusOwner();
      while (c != null) {
        if (c instanceof JPopupMenu) {
          c=((JPopupMenu)c).getInvoker();
        }
        if (c == JBTable.this) {
          return;
        }
 else         if (c instanceof Window) {
          if (c == SwingUtilities.getWindowAncestor(JBTable.this)) {
            getCellEditor().stopCellEditing();
          }
          break;
        }
        c=c.getParent();
      }
    }
  }
);
}
