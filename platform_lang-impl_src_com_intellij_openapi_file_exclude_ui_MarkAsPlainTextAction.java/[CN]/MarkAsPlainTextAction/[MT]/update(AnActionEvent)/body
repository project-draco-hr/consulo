{
  DataContext dataContext=e.getDataContext();
  final VirtualFile[] selectedFiles=PlatformDataKeys.VIRTUAL_FILE_ARRAY.getData(dataContext);
  final Presentation presentation=e.getPresentation();
  final EnforcedPlainTextFileTypeManager typeManager=EnforcedPlainTextFileTypeManager.getInstance();
  presentation.setVisible(false);
  if (typeManager == null || selectedFiles == null || selectedFiles.length == 0) {
    return;
  }
  for (  VirtualFile file : selectedFiles) {
    if (!EnforcedPlainTextFileTypeManager.isApplicableFor(file) || typeManager.isMarkedAsPlainText(file)) {
      return;
    }
  }
  presentation.setVisible(true);
  presentation.setIcon(EnforcedPlainTextFileTypeFactory.ENFORCED_PLAIN_TEXT_ICON);
}
