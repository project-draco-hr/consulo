{
  DataContext dataContext=e.getDataContext();
  final VirtualFile file=PlatformDataKeys.VIRTUAL_FILE.getData(dataContext);
  final Presentation presentation=e.getPresentation();
  final EnforcedPlainTextFileTypeManager typeManager=EnforcedPlainTextFileTypeManager.getInstance();
  presentation.setVisible(false);
  if (typeManager == null || file == null) {
    return;
  }
  if (EnforcedPlainTextFileTypeManager.isApplicableFor(file) && !typeManager.isMarkedAsPlainText(file)) {
    presentation.setVisible(true);
    presentation.setIcon(EnforcedPlainTextFileTypeFactory.ENFORCED_PLAIN_TEXT_ICON);
  }
}
