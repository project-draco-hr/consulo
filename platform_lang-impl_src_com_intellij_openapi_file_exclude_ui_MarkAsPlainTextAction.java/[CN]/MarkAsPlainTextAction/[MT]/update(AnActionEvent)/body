{
  DataContext dataContext=e.getDataContext();
  final VirtualFile file=PlatformDataKeys.VIRTUAL_FILE.getData(dataContext);
  final Presentation presentation=e.getPresentation();
  final EnforcedPlainTextFileTypeManager typeManager=EnforcedPlainTextFileTypeManager.getInstance();
  presentation.setVisible(false);
  if (typeManager == null || file == null || file.isDirectory()) {
    return;
  }
  if (!typeManager.isMarkedAsPlainText(file)) {
    FileType originalType=FileTypeManager.getInstance().getFileTypeByFileName(file.getName());
    if (originalType.isBinary() || originalType == StdFileTypes.PLAIN_TEXT)     return;
    presentation.setVisible(true);
    presentation.setIcon(EnforcedPlainTextFileTypeFactory.ENFORCED_PLAIN_TEXT_ICON);
  }
}
