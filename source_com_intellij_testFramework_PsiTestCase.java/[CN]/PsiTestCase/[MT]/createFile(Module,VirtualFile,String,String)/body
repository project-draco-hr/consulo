{
  if (!ModuleRootManager.getInstance(module).getFileIndex().isInSourceContent(vDir)) {
    PsiTestUtil.addSourceContentToRoots(module,vDir);
  }
  final VirtualFile vFile=vDir.createChildData(vDir,fileName);
  final Writer out=new OutputStreamWriter(vFile.getOutputStream(myPsiManager));
  out.write(text.toCharArray());
  out.close();
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  assertNotNull(vFile);
  final PsiFile file=myPsiManager.findFile(vFile);
  assertNotNull(file);
  return file;
}
