{
  ProcessProxyImpl proxy=null;
  if (ProcessProxyImpl.useLauncher()) {
    try {
      proxy=new ProcessProxyImpl();
      final JavaParameters javaParameters=javaCmdLine.getJavaParameters();
      JavaSdkUtil.addRtJar(javaParameters.getClassPath());
      final ParametersList vmParametersList=javaParameters.getVMParametersList();
      vmParametersList.defineProperty(ProcessProxyImpl.PROPERTY_PORT_NUMBER,"" + proxy.getPortNumber());
      vmParametersList.defineProperty(ProcessProxyImpl.PROPERTY_BINPATH,PathManager.getBinPath());
      javaParameters.getProgramParametersList().prepend(javaParameters.getMainClass());
      javaParameters.setMainClass(ProcessProxyImpl.LAUNCH_MAIN_CLASS);
    }
 catch (    ProcessProxyImpl.NoMoreSocketsException e) {
      proxy=null;
    }
  }
  return proxy;
}
