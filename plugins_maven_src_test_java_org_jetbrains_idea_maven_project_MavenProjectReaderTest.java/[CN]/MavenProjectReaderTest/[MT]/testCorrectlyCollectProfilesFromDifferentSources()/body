{
  createProjectPom("<groupId>test</groupId>" + "<artifactId>parent</artifactId>" + "<version>1</version>"+ "<profiles>"+ "  <profile>"+ "    <id>profile</id>"+ "    <properties><prop>parent</prop></properties>"+ "  </profile>"+ "</profiles>");
  VirtualFile parentProfiles=createProfilesXml("<profile>" + "  <id>profile</id>" + "  <properties><prop>parentProfiles</prop></properties>"+ "</profile>");
  VirtualFile module=createModulePom("module","<groupId>test</groupId>" + "<artifactId>module</artifactId>" + "<version>1</version>"+ "<parent>"+ "  <groupId>test</groupId>"+ "  <artifactId>parent</artifactId>"+ "  <version>1</version>"+ "</parent>"+ "<profiles>"+ "  <profile>"+ "    <id>profile</id>"+ "    <properties><prop>pom</prop></properties>"+ "  </profile>"+ "</profiles>");
  updateSettingsXml("<profiles>" + "  <profile>" + "    <id>profile</id>"+ "    <properties><prop>settings</prop></properties>"+ "  </profile>"+ "</profiles>");
  VirtualFile profiles=createProfilesXml("module","<profile>" + "  <id>profile</id>" + "  <properties><prop>profiles</prop></properties>"+ "</profile>");
  org.apache.maven.project.MavenProject p=readProject(module);
  assertEquals(1,p.getModel().getProfiles().size());
  assertEquals("pom",p.getModel().getProfiles().get(0).getProperties().getProperty("prop"));
  assertEquals("pom",p.getModel().getProfiles().get(0).getSource());
  createModulePom("module","<groupId>test</groupId>" + "<artifactId>module</artifactId>" + "<version>1</version>"+ "<parent>"+ "  <groupId>test</groupId>"+ "  <artifactId>parent</artifactId>"+ "  <version>1</version>"+ "</parent>");
  p=readProject(module);
  assertEquals(1,p.getModel().getProfiles().size());
  assertEquals("profiles",p.getModel().getProfiles().get(0).getProperties().getProperty("prop"));
  assertEquals("profiles.xml",p.getModel().getProfiles().get(0).getSource());
  profiles.delete(this);
  p=readProject(module);
  assertEquals(1,p.getModel().getProfiles().size());
  assertEquals("parent",p.getModel().getProfiles().get(0).getProperties().getProperty("prop"));
  assertEquals("pom",p.getModel().getProfiles().get(0).getSource());
  createProjectPom("<groupId>test</groupId>" + "<artifactId>parent</artifactId>" + "<version>1</version>");
  p=readProject(module);
  assertEquals(1,p.getModel().getProfiles().size());
  assertEquals("parentProfiles",p.getModel().getProfiles().get(0).getProperties().getProperty("prop"));
  assertEquals("profiles.xml",p.getModel().getProfiles().get(0).getSource());
  parentProfiles.delete(null);
  p=readProject(module);
  assertEquals(1,p.getModel().getProfiles().size());
  assertEquals("settings",p.getModel().getProfiles().get(0).getProperties().getProperty("prop"));
  assertEquals("settings.xml",p.getModel().getProfiles().get(0).getSource());
}
