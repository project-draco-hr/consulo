{
  boolean highOrderBit=false;
  boolean validU8Char=true;
  int length=Math.min(buffer.length,guess_length);
  int i=0;
  while (i < length) {
    byte b0=buffer[i];
    byte b1=i + 1 >= length ? 0 : buffer[i + 1];
    byte b2=i + 2 >= length ? 0 : buffer[i + 2];
    byte b3=i + 3 >= length ? 0 : buffer[i + 3];
    byte b4=i + 4 >= length ? 0 : buffer[i + 4];
    byte b5=i + 5 >= length ? 0 : buffer[i + 5];
    if (b0 < 0) {
      highOrderBit=true;
      if (isTwoBytesSequence(b0)) {
        if (!isContinuationChar(b1)) {
          validU8Char=false;
        }
 else {
          i++;
        }
      }
 else       if (isThreeBytesSequence(b0)) {
        if (!(isContinuationChar(b1) && isContinuationChar(b2))) {
          validU8Char=false;
        }
 else {
          i+=2;
        }
      }
 else       if (isFourBytesSequence(b0)) {
        if (!(isContinuationChar(b1) && isContinuationChar(b2) && isContinuationChar(b3))) {
          validU8Char=false;
        }
 else {
          i+=3;
        }
      }
 else       if (isFiveBytesSequence(b0)) {
        if (!(isContinuationChar(b1) && isContinuationChar(b2) && isContinuationChar(b3)&& isContinuationChar(b4))) {
          validU8Char=false;
        }
 else {
          i+=4;
        }
      }
 else       if (isSixBytesSequence(b0)) {
        if (!(isContinuationChar(b1) && isContinuationChar(b2) && isContinuationChar(b3)&& isContinuationChar(b4)&& isContinuationChar(b5))) {
          validU8Char=false;
        }
 else {
          i+=5;
        }
      }
 else {
        validU8Char=false;
      }
    }
    if (!validU8Char)     break;
    i++;
  }
  if (!highOrderBit) {
    return GuessedEncoding.SEVEN_BIT;
  }
  if (validU8Char)   return GuessedEncoding.VALID_UTF8;
  return GuessedEncoding.INVALID_UTF8;
}
