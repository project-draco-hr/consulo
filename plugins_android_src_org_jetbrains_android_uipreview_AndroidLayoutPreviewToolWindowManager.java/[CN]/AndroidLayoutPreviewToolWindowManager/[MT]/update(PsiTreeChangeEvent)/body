{
  if (myToolWindowForm == null || !myToolWindowReady || myToolWindowDisposed) {
    return;
  }
  final PsiFile fileInPreview=myToolWindowForm.getFile();
  final PsiFile file=event.getFile();
  if (fileInPreview == null || file == null) {
    return;
  }
  if (fileInPreview == file) {
    render();
    return;
  }
  final AndroidFacet facet=AndroidFacet.getInstance(file);
  if (facet != null) {
    VirtualFile vFile=file.getVirtualFile();
    vFile=vFile != null ? vFile.getParent() : null;
    vFile=vFile != null ? vFile.getParent() : null;
    if (vFile != null) {
      final VirtualFile finalVFile=vFile;
      mySaveAndRenderQueue.queue(new Update("saveAndRender"){
        @Override public void run(){
          final VirtualFile[] resDirs=facet.getLocalResourceManager().getAllResourceDirs();
          if (ArrayUtil.find(resDirs,finalVFile) >= 0) {
            ApplicationManager.getApplication().saveAll();
            render();
          }
        }
      }
);
    }
  }
}
