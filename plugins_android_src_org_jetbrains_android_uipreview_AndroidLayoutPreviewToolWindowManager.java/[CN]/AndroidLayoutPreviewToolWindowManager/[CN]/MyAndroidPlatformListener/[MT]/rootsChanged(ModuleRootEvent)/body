{
  if (myToolWindowForm == null || !myToolWindowReady || myToolWindowDisposed) {
    return;
  }
  final PsiFile file=myToolWindowForm.getFile();
  if (file != null) {
    final Module module=ModuleUtil.findModuleForPsiElement(file);
    if (module != null) {
      final Sdk prevSdk=myModule2Sdk.get(module);
      final Sdk newSdk=ModuleRootManager.getInstance(module).getSdk();
      myModule2Sdk.put(module,newSdk);
      if (newSdk != null && (newSdk.getSdkType() instanceof AndroidSdkType || prevSdk.getSdkType() instanceof AndroidSdkType) && !newSdk.equals(prevSdk)) {
        final AndroidSdkAdditionalData additionalData=(AndroidSdkAdditionalData)newSdk.getSdkAdditionalData();
        final AndroidPlatform newPlatform=additionalData != null ? additionalData.getAndroidPlatform() : null;
        myToolWindowForm.updateDevicesAndTargets(newPlatform);
        myToolWindowForm.updateThemes();
        render();
      }
    }
  }
}
