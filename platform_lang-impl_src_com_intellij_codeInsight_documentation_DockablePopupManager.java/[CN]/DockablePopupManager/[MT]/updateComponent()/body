{
  if (myProject.isDisposed())   return;
  AsyncResult<DataContext> asyncResult=DataManager.getInstance().getDataContextFromFocus();
  DataContext dataContext=asyncResult.getResult();
  if (dataContext == null) {
    return;
  }
  if (PlatformDataKeys.PROJECT.getData(dataContext) != myProject) {
    return;
  }
  final Editor editor=PlatformDataKeys.EDITOR.getData(dataContext);
  if (editor == null) {
    PsiElement element=LangDataKeys.PSI_ELEMENT.getData(dataContext);
    if (element != null) {
      doUpdateComponent(element);
    }
    return;
  }
  final PsiFile file=PsiUtilBase.getPsiFileInEditor(editor,myProject);
  final Editor injectedEditor=InjectedLanguageUtil.getEditorForInjectedLanguageNoCommit(editor,file);
  if (injectedEditor != null) {
    final PsiFile psiFile=PsiUtilBase.getPsiFileInEditor(injectedEditor,myProject);
    if (psiFile != null) {
      doUpdateComponent(injectedEditor,psiFile);
      return;
    }
  }
  if (file != null) {
    doUpdateComponent(editor,file);
  }
}
