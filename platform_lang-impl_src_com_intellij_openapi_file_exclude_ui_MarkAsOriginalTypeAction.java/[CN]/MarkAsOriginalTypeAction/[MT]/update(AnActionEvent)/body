{
  DataContext dataContext=e.getDataContext();
  final VirtualFile[] selectedFiles=PlatformDataKeys.VIRTUAL_FILE_ARRAY.getData(dataContext);
  final Presentation presentation=e.getPresentation();
  final EnforcedPlainTextFileTypeManager typeManager=EnforcedPlainTextFileTypeManager.getInstance();
  presentation.setVisible(false);
  if (typeManager == null || selectedFiles == null || selectedFiles.length == 0) {
    return;
  }
  FileType originalType=null;
  for (  VirtualFile file : selectedFiles) {
    if (typeManager.isMarkedAsPlainText(file)) {
      FileType fileType=FileTypeManager.getInstance().getFileTypeByFileName(file.getName());
      if (originalType == null) {
        originalType=fileType;
      }
 else       if (fileType != originalType) {
        return;
      }
    }
 else {
      return;
    }
  }
  if (originalType == null)   return;
  presentation.setVisible(true);
  presentation.setText(ActionsBundle.actionText("MarkAsOriginalTypeAction") + " " + originalType.getName());
  presentation.setIcon(originalType.getIcon());
}
