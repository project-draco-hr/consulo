{
  DataContext dataContext=e.getDataContext();
  final VirtualFile file=PlatformDataKeys.VIRTUAL_FILE.getData(dataContext);
  final Presentation presentation=e.getPresentation();
  final EnforcedPlainTextFileTypeManager typeManager=EnforcedPlainTextFileTypeManager.getInstance();
  if (typeManager == null || file == null || file.isDirectory()) {
    presentation.setVisible(false);
    return;
  }
  if (typeManager.isMarkedAsPlainText(file)) {
    presentation.setVisible(true);
    FileType originalType=FileTypeManager.getInstance().getFileTypeByFileName(file.getName());
    presentation.setText(ActionsBundle.actionText("MarkAsOriginalTypeAction") + " " + originalType.getName());
    presentation.setIcon(originalType.getIcon());
  }
 else {
    presentation.setVisible(false);
  }
}
