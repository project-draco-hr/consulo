{
  buildStructure(myRoot,false);
  myCom.addChild("ibm").addChild("alphaworks");
  myCom.addChild("apple").addChild("cocoa");
  doAndWaitForBuilder(new Runnable(){
    @Override public void run(){
      getBuilder().getUi().activate(true);
    }
  }
);
  buildNode("/",false);
  assertTree("-/\n" + " +com\n" + " +jetbrains\n"+ " +org\n"+ " +xunit\n");
  myElementUpdateHook=new ElementUpdateHook(){
    @Override public void onElementAction(    String action,    Object element){
      if (new NodeElement("apple").equals(element) && "getChildren".equals(action)) {
        getBuilder().getUpdater().addSubtreeToUpdate(new TreeUpdatePass(findNode("ibm",false)).setUpdateStamp(1));
        getBuilder().getUpdater().addSubtreeToUpdate(new TreeUpdatePass(findNode("intellij",false)).setUpdateStamp(1));
      }
    }
  }
;
  doAndWaitForBuilder(new Runnable(){
    @Override public void run(){
      myTree.expandPath(getPath("com"));
    }
  }
);
  assertTree("-/\n" + " -com\n" + "  +apple\n"+ "  +ibm\n"+ "  +intellij\n"+ " +jetbrains\n"+ " +org\n"+ " +xunit\n");
}
