{
  if (elements == null || elements.length == 0) {
    return null;
  }
  final java.util.List<PsiElement> validElements=new ArrayList<PsiElement>(elements.length);
  for (int idx=0; idx < elements.length; idx++) {
    final PsiElement element=elements[idx];
    if (element.isValid()) {
      validElements.add(element);
    }
  }
  return (validElements.size() == elements.length) ? elements : validElements.toArray(new PsiElement[validElements.size()]);
}
