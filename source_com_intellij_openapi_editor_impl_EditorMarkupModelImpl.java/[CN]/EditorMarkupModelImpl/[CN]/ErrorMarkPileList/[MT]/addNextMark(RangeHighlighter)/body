{
  if (!mark.isValid() || mark.getErrorStripeMarkColor() == null)   return;
  int visStartLine=myEditor.logicalToVisualPosition(new LogicalPosition(mark.getDocument().getLineNumber(mark.getStartOffset()),0)).line;
  int visEndLine=myEditor.logicalToVisualPosition(new LogicalPosition(mark.getDocument().getLineNumber(mark.getEndOffset()),0)).line;
  int yStartPosition=visibleLineToYPosition(visStartLine,myScrollBarHeight);
  int yEndPosition=visibleLineToYPosition(visEndLine,myScrollBarHeight);
  final ErrorMarkPile prevPile=list.size() == 0 ? null : list.get(list.size() - 1);
  int prevPileStart=prevPile == null ? 0 : prevPile.yStart;
  if (prevPile != null && yStartPosition - prevPileStart < getMinHeight()) {
    prevPile.addMark(mark,yStartPosition,yEndPosition);
  }
 else {
    final ErrorMarkPile pile=new ErrorMarkPile(yStartPosition);
    pile.addMark(mark,yStartPosition,yEndPosition);
    list.add(pile);
  }
}
