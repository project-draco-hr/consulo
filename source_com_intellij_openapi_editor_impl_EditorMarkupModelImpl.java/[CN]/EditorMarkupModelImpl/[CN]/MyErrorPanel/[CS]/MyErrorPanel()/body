{
  addMouseListener(this);
  addMouseMotionListener(this);
  PopupHandler popupHandler=new PopupHandler(){
    public void invokePopup(    final Component comp,    final int x,    final int y){
      if (ApplicationManager.getApplication() == null)       return;
      final JPopupMenu popupMenu=new JPopupMenu();
      final JRadioButtonMenuItem errorsFirst=new JRadioButtonMenuItem("Go to errors first");
      errorsFirst.addActionListener(new ActionListener(){
        public void actionPerformed(        ActionEvent e){
          DaemonCodeAnalyzerSettings.getInstance().NEXT_ERROR_ACTION_GOES_TO_ERRORS_FIRST=errorsFirst.isSelected();
        }
      }
);
      popupMenu.add(errorsFirst);
      final JRadioButtonMenuItem next=new JRadioButtonMenuItem("Go to next error/warning");
      next.addActionListener(new ActionListener(){
        public void actionPerformed(        ActionEvent e){
          DaemonCodeAnalyzerSettings.getInstance().NEXT_ERROR_ACTION_GOES_TO_ERRORS_FIRST=!next.isSelected();
        }
      }
);
      popupMenu.add(next);
      ButtonGroup group=new ButtonGroup();
      group.add(errorsFirst);
      group.add(next);
      popupMenu.addSeparator();
      final JMenuItem hLevel=new JMenuItem("Customize Highlighting Level");
      popupMenu.add(hLevel);
      final boolean isErrorsFirst=DaemonCodeAnalyzerSettings.getInstance().NEXT_ERROR_ACTION_GOES_TO_ERRORS_FIRST;
      errorsFirst.setSelected(isErrorsFirst);
      next.setSelected(!isErrorsFirst);
      hLevel.addActionListener(new ActionListener(){
        public void actionPerformed(        ActionEvent e){
          final HectorComponent component=new HectorComponent((PsiFile)myEditor.getDataContext().getData(DataConstants.PSI_FILE));
          final Dimension dimension=component.getPreferredSize();
          Point point=new Point(x,y);
          point=SwingUtilities.convertPoint(comp,point,myEditor.getComponent().getRootPane().getLayeredPane());
          component.showComponent(myEditor,new Point(point.x - dimension.width,point.y));
        }
      }
);
      popupMenu.show(comp,x,y);
    }
  }
;
  addMouseListener(popupHandler);
}
