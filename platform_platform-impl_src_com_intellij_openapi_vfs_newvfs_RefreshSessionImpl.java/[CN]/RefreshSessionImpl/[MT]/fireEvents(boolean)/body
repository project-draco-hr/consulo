{
  AccessToken token=myStartTrace == null ? null : DumbServiceImpl.forceDumbModeStartTrace(myStartTrace);
  try {
    if (!iHaveEventsToFire || ApplicationManager.getApplication().isDisposed())     return;
    Runnable runnable=new Runnable(){
      public void run(){
        if (hasWriteAction) {
          fireEventsInWriteAction();
        }
 else {
          ApplicationManager.getApplication().runWriteAction(new Runnable(){
            @Override public void run(){
              fireEventsInWriteAction();
            }
          }
);
        }
      }
    }
;
    if (myDumbModePermission != null) {
      DumbService.allowStartingDumbModeInside(myDumbModePermission,runnable);
    }
 else {
      runnable.run();
    }
  }
  finally {
    if (token != null) {
      token.finish();
    }
    mySemaphore.up();
  }
}
