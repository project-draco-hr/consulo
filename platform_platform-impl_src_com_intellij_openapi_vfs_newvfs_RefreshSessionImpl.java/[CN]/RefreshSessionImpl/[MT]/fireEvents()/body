{
  if (!iHaveEventsToFire || ApplicationManager.getApplication().isDisposed()) {
    mySemaphore.up();
    return;
  }
  AccessToken dumb=null;
  AccessToken write=null;
  try {
    dumb=myStartTrace == null ? null : DumbServiceImpl.forceDumbModeStartTrace(myStartTrace);
    write=WriteAction.start();
    if (myDumbModePermission != null) {
      DumbService.allowStartingDumbModeInside(myDumbModePermission,new Runnable(){
        @Override public void run(){
          RefreshSessionImpl.this.fireEventsInWriteAction();
        }
      }
);
    }
 else {
      fireEventsInWriteAction();
    }
  }
  finally {
    if (dumb != null) {
      dumb.finish();
    }
    if (write != null) {
      write.finish();
    }
    mySemaphore.up();
  }
}
