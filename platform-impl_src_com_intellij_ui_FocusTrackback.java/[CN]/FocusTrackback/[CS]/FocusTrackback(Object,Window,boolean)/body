{
  myRequestorName=requestor.toString();
  myParentWindow=parent;
  myMustBeShown=mustBeShown;
  final Application app=ApplicationManager.getApplication();
  if (app == null || app.isUnitTestMode() || wrongOS())   return;
  register(parent);
  final List<FocusTrackback> stack=getStackForRoot(myRoot);
  if (stack.indexOf(this) == 0) {
    final KeyboardFocusManager manager=KeyboardFocusManager.getCurrentKeyboardFocusManager();
    setFocusOwner(manager.getPermanentFocusOwner());
    if (getFocusOwner() == null) {
      final Window window=manager.getActiveWindow();
      if (window instanceof Provider) {
        final FocusTrackback other=((Provider)window).getFocusTrackback();
        if (other != null) {
          setFocusOwner(other.getFocusOwner());
        }
      }
    }
  }
 else {
    setFocusOwner(stack.get(0).getFocusOwner());
  }
  if (stack.size() == 1 && getFocusOwner() == null) {
    setFocusOwner(getFocusFor(myRoot));
  }
 else   if (stack.indexOf(this) == 0 && getFocusOwner() != null) {
    setFocusFor(myRoot,getFocusOwner());
  }
}
