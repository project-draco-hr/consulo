{
  Document document=e.getDocument();
  if (UndoManagerImpl.isCopy(document))   return;
  if (allEditorsAreViewersFor(document))   return;
  if (!shouldRecordActions(document))   return;
  if (ApplicationManager.getApplication().isDisposeInProgress())   return;
  UndoManagerImpl undoManager=getUndoManager();
  if (!undoManager.isActive() || !isUndoable(document)) {
    registerNonUndoableAction(document);
    return;
  }
  registerUndoableAction(e);
}
