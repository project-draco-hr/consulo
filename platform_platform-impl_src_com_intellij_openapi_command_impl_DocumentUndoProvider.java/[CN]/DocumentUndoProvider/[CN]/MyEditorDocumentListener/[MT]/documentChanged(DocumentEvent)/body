{
  Document document=e.getDocument();
  if (UndoManagerImpl.isCopy(document))   return;
  if (allEditorsAreViewersFor(document))   return;
  if (!isToRecordActions(document))   return;
  UndoManagerImpl undoManager=getUndoManager();
  if (isExternalChange() || !undoManager.isActive()) {
    registerNonUndoableAction(document);
    return;
  }
  registerUndoableAction(e);
}
