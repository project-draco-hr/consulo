{
  Document document=e.getDocument();
  if (shouldBeIgnored(document))   return;
  UndoManagerImpl undoManager=getUndoManager();
  if (undoManager.isActive() && isUndoable(document) && (undoManager.isUndoInProgress() || undoManager.isRedoInProgress())&& document.getUserData(UNDOING_EDITOR_CHANGE) != Boolean.TRUE) {
    throw new IllegalStateException("Do not change documents during undo as it will break undo sequence.");
  }
}
