{
  StdArrangementSettings result=new StdArrangementSettings();
  Element groups=element.getChild(GROUPS_ELEMENT_NAME);
  if (groups != null) {
    for (    Object group : groups.getChildren(GROUP_ELEMENT_NAME)) {
      Element groupElement=(Element)group;
      String groupingTypeId=groupElement.getChildText(TYPE_ELEMENT_NAME);
      ArrangementSettingsToken groupingType=StdArrangementTokens.byId(groupingTypeId);
      if (groupingType == null) {
        groupingType=myMixin.deserializeToken(groupingTypeId);
      }
      if (groupingType == null) {
        LOG.warn(String.format("Can't deserialize grouping type token by id '%s'",groupingTypeId));
        continue;
      }
      String orderTypeId=groupElement.getChildText(ORDER_TYPE_ELEMENT_NAME);
      ArrangementSettingsToken orderType=StdArrangementTokens.byId(orderTypeId);
      if (orderType == null) {
        orderType=myMixin.deserializeToken(orderTypeId);
      }
      if (orderType == null) {
        LOG.warn(String.format("Can't deserialize grouping order type token by id '%s'",orderTypeId));
        continue;
      }
      result.addGrouping(new ArrangementGroupingRule(groupingType,orderType));
    }
  }
  Element rulesElement=element.getChild(RULES_ELEMENT_NAME);
  if (rulesElement != null) {
    for (    Object o : rulesElement.getChildren(RULE_ELEMENT_NAME)) {
      Element ruleElement=(Element)o;
      Element matcherElement=ruleElement.getChild(MATCHER_ELEMENT_NAME);
      if (matcherElement == null) {
        continue;
      }
      StdArrangementEntryMatcher matcher=null;
      for (      Object c : matcherElement.getChildren()) {
        matcher=myMatcherSerializer.deserialize((Element)c);
        if (matcher != null) {
          break;
        }
      }
      if (matcher == null) {
        return null;
      }
      Element orderTypeElement=ruleElement.getChild(ORDER_TYPE_ELEMENT_NAME);
      ArrangementSettingsToken orderType=null;
      if (orderTypeElement != null) {
        String orderTypeId=orderTypeElement.getText();
        orderType=StdArrangementTokens.byId(orderTypeId);
        if (orderType == null) {
          orderType=myMixin.deserializeToken(orderTypeId);
        }
        if (orderType == null) {
          LOG.warn(String.format("Can't deserialize matching rule order type for id '%s'. Falling back to default (%s)",orderTypeId,ArrangementMatchRule.DEFAULT_ORDER_TYPE.getId()));
        }
      }
      if (orderType == null) {
        orderType=ArrangementMatchRule.DEFAULT_ORDER_TYPE;
      }
      result.addRule(new StdArrangementMatchRule(matcher,orderType));
    }
  }
  return result;
}
