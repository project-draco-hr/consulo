{
  final Map<File,Set<File>> map=new LinkedHashMap<File,Set<File>>();
  final boolean compilingTests=context.isCompilingTests();
  for (  JpsModule module : chunk.getModules()) {
    final File outputDir=JpsJavaExtensionService.getInstance().getOutputDirectory(module,compilingTests);
    if (outputDir == null) {
      continue;
    }
    final Set<File> roots=new LinkedHashSet<File>();
    for (    RootDescriptor descriptor : context.getProjectDescriptor().rootsIndex.getModuleRoots(context,module)) {
      if (descriptor.isTestRoot == compilingTests) {
        roots.add(descriptor.root);
      }
    }
    map.put(outputDir,roots);
  }
  return map;
}
