{
  final Map<File,Set<File>> map=new LinkedHashMap<File,Set<File>>();
  final boolean compilingTests=context.isCompilingTests();
  for (  Module module : chunk.getModules()) {
    final String output=compilingTests ? module.getTestOutputPath() : module.getOutputPath();
    if (output == null) {
      continue;
    }
    final Set<File> roots=new LinkedHashSet<File>();
    for (    RootDescriptor descriptor : context.getProjectDescriptor().rootsIndex.getModuleRoots(context,module)) {
      if (descriptor.isTestRoot == compilingTests) {
        roots.add(descriptor.root);
      }
    }
    map.put(new File(output),roots);
  }
  return map;
}
