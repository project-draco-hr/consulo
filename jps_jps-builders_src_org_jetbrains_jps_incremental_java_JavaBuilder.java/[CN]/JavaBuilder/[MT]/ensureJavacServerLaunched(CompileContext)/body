{
  final ExternalJavacDescriptor descriptor=ExternalJavacDescriptor.KEY.get(context);
  if (descriptor != null) {
    return descriptor.client;
  }
  final String javaHome=System.getProperty("java.home");
  final String hostString="localhost";
  final int port=9999;
  final int heapSize=512;
  final BaseOSProcessHandler processHandler=JavacServerBootstrap.launchJavacServer(javaHome + "/bin/java",heapSize,port,Paths.getSystemRoot());
  final JavacServerClient client=new JavacServerClient();
  try {
    client.connect(hostString,port);
  }
 catch (  Throwable ex) {
    processHandler.destroyProcess();
    throw new Exception("Failed to connect to external javac process: ",ex);
  }
  ExternalJavacDescriptor.KEY.set(context,new ExternalJavacDescriptor(processHandler,client));
  return client;
}
