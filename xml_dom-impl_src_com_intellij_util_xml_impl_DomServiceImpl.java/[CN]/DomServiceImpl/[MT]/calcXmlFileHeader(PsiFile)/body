{
  if (file instanceof XmlFile && file.getNode().isParsed()) {
    final XmlDocument document=((XmlFile)file).getDocument();
    if (document != null) {
      String publicId=null;
      String systemId=null;
      final XmlProlog prolog=document.getProlog();
      if (prolog != null) {
        final XmlDoctype doctype=prolog.getDoctype();
        if (doctype != null) {
          publicId=doctype.getPublicId();
          systemId=doctype.getSystemId();
          if (systemId == null) {
            systemId=doctype.getDtdUri();
          }
        }
      }
      final XmlTag tag=document.getRootTag();
      if (tag != null) {
        String localName=tag.getLocalName();
        if (StringUtil.isNotEmpty(localName)) {
          if (tag.getPrevSibling() instanceof PsiErrorElement) {
            return XmlFileHeader.EMPTY;
          }
          String psiNs=tag.getNamespace();
          return new XmlFileHeader(localName,psiNs == XmlUtil.EMPTY_URI || Comparing.equal(psiNs,systemId) ? null : psiNs,publicId,systemId);
        }
      }
    }
    return XmlFileHeader.EMPTY;
  }
  if (!file.isValid())   return XmlFileHeader.EMPTY;
  return NanoXmlUtil.parseHeader(file);
}
