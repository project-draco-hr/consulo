{
  PsiManager manager=expr.getManager();
  PsiElementFactory factory=JavaPsiFacade.getInstance(manager.getProject()).getElementFactory();
  CodeStyleManager codeStyleManager=CodeStyleManager.getInstance(project);
  PsiPrefixExpression prefixExpr=(PsiPrefixExpression)factory.createExpressionFromText("!(a instanceof Type)",null);
  prefixExpr=(PsiPrefixExpression)codeStyleManager.reformat(prefixExpr);
  PsiParenthesizedExpression parenthExpr=(PsiParenthesizedExpression)prefixExpr.getOperand();
  PsiInstanceOfExpression instanceofExpr=(PsiInstanceOfExpression)parenthExpr.getExpression();
  instanceofExpr.getOperand().replace(expr);
  prefixExpr=(PsiPrefixExpression)expr.replace(prefixExpr);
  parenthExpr=(PsiParenthesizedExpression)prefixExpr.getOperand();
  instanceofExpr=(PsiInstanceOfExpression)parenthExpr.getExpression();
  instanceofExpr=CodeInsightUtilBase.forcePsiPostprocessAndRestoreElement(instanceofExpr);
  TextRange range=instanceofExpr.getCheckType().getTextRange();
  editor.getDocument().deleteString(range.getStartOffset(),range.getEndOffset());
  return new TextRange(range.getStartOffset(),range.getStartOffset());
}
