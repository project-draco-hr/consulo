{
  final FilePath nodePath=getPathForObject(change);
  ChangesBrowserNode oldNode=(nodePath == null) ? null : myFoldersCache.get(nodePath.getIOFile().getAbsolutePath());
  ChangesBrowserNode node=nodeCreator.compute();
  if (oldNode != null) {
    for (int i=oldNode.getChildCount() - 1; i >= 0; i--) {
      MutableTreeNode child=(MutableTreeNode)model.getChild(oldNode,i);
      model.removeNodeFromParent(child);
      model.insertNodeInto(child,node,model.getChildCount(node));
    }
    final MutableTreeNode parent=(MutableTreeNode)oldNode.getParent();
    int index=model.getIndexOfChild(parent,oldNode);
    model.removeNodeFromParent(oldNode);
    model.insertNodeInto(node,parent,index);
    myFoldersCache.put(nodePath.getIOFile().getAbsolutePath(),node);
  }
 else {
    ChangesBrowserNode parentNode=getParentNodeFor(node,policy,listNode);
    model.insertNodeInto(node,parentNode,model.getChildCount(parentNode));
    if (nodePath != null) {
      myFoldersCache.put(nodePath.getIOFile().getAbsolutePath(),node);
    }
  }
}
