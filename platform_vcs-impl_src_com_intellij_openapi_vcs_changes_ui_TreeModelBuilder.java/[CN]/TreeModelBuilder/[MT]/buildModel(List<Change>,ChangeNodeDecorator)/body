{
  final HashMap<String,ChangesBrowserNode> foldersCache=new HashMap<String,ChangesBrowserNode>();
  final ChangesGroupingPolicy policy=createGroupingPolicy();
  for (  final Change change : changes) {
    insertChangeNode(change,foldersCache,policy,root,new Computable<ChangesBrowserNode>(){
      public ChangesBrowserNode compute(){
        return new ChangesBrowserChangeNode(myProject,change,changeNodeDecorator);
      }
    }
);
  }
  collapseDirectories(model,root);
  sortNodes();
  return model;
}
