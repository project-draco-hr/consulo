{
  LOG.assertTrue(myMirror == null);
  myMirror=element;
  PsiElement mirrorFile=SourceTreeToPsiMap.treeElementToPsi(myMirror);
  if (mirrorFile instanceof PsiJavaFile) {
    PsiPackageStatement packageStatement=((PsiJavaFile)mirrorFile).getPackageStatement();
    if (packageStatement != null) {
      ((ClsElementImpl)getPackageStatement()).setMirror((TreeElement)SourceTreeToPsiMap.psiElementToTree(packageStatement));
    }
    PsiClass[] classes=getClasses();
    PsiClass[] mirrorClasses=((PsiJavaFile)mirrorFile).getClasses();
    LOG.assertTrue(classes.length == mirrorClasses.length);
    if (classes.length == mirrorClasses.length) {
      for (int i=0; i < classes.length; i++) {
        ((ClsElementImpl)classes[i]).setMirror((TreeElement)SourceTreeToPsiMap.psiElementToTree(mirrorClasses[i]));
      }
    }
  }
}
