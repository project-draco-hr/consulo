{
  final FileViewProvider provider=((PsiManagerEx)manager).getFileManager().findViewProvider(file);
  ClsFileImpl psiFile=null;
  if (provider != null) {
    final PsiFile psi=provider.getPsi(provider.getBaseLanguage());
    if (!(psi instanceof ClsFileImpl)) {
      return "Unable to decompile";
    }
    psiFile=(ClsFileImpl)psi;
  }
  if (psiFile == null) {
    psiFile=new ClsFileImpl((PsiManagerImpl)manager,new ClassFileViewProvider(manager,file),true);
  }
  StringBuffer buffer=new StringBuffer();
  psiFile.appendMirrorText(0,buffer);
  return buffer.toString();
}
