{
  if (!XsltRunSettingsEditor.ALLOW_CHOOSING_SDK) {
    return getDefaultSdk();
  }
  if (myJdkChoice == JdkChoice.JDK) {
    return myJdk != null ? ProjectJdkTable.getInstance().findJdk(myJdk) : null;
  }
  Sdk jdk=null;
  final Module module=getEffectiveModule();
  if (module != null) {
    jdk=ModuleRootManager.getInstance(module).getSdk();
  }
  if (jdk == null) {
    jdk=ProjectRootManager.getInstance(getProject()).getProjectSdk();
  }
  if (jdk == null || !(jdk.getSdkType() instanceof JavaSdkType)) {
    return getDefaultSdk();
  }
  return jdk;
}
