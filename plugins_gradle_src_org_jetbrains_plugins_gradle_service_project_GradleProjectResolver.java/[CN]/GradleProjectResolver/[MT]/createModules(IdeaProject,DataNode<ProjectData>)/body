{
  DomainObjectSet<? extends IdeaModule> gradleModules=gradleProject.getModules();
  if (gradleModules == null || gradleModules.isEmpty()) {
    throw new IllegalStateException("No modules found for the target project: " + gradleProject);
  }
  Map<String,Pair<DataNode<ModuleData>,IdeaModule>> result=ContainerUtilRt.newHashMap();
  for (  IdeaModule gradleModule : gradleModules) {
    if (gradleModule == null) {
      continue;
    }
    String moduleName=gradleModule.getName();
    if (moduleName == null) {
      throw new IllegalStateException("Module with undefined name detected: " + gradleModule);
    }
    ProjectData projectData=ideProject.getData();
    ModuleData ideModule=new ModuleData(GradleConstants.SYSTEM_ID,moduleName,projectData.getProjectFileDirectoryPath());
    Pair<DataNode<ModuleData>,IdeaModule> previouslyParsedModule=result.get(moduleName);
    if (previouslyParsedModule != null) {
      throw new IllegalStateException(String.format("Modules with duplicate name (%s) detected: '%s' and '%s'",moduleName,ideModule,previouslyParsedModule));
    }
    DataNode<ModuleData> moduleDataNode=ideProject.createChild(ProjectKeys.MODULE,ideModule);
    DataNode<ModuleData> moduleDataNode=ideProject.createChild(ExternalSystemProjectKeys.MODULE,ideModule);
    result.put(moduleName,new Pair<DataNode<ModuleData>,IdeaModule>(moduleDataNode,gradleModule));
  }
  return result;
}
