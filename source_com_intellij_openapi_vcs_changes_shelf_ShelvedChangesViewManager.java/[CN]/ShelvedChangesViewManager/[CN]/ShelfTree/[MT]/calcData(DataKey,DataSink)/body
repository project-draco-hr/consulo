{
  if (key == SHELVED_CHANGELIST_KEY) {
    final TreePath[] selections=getSelectionPaths();
    final Set<ShelvedChangeList> changeLists=new HashSet<ShelvedChangeList>();
    for (    TreePath path : selections) {
      if (path.getPathCount() >= 2) {
        DefaultMutableTreeNode node=(DefaultMutableTreeNode)path.getPathComponent(1);
        if (node.getUserObject() instanceof ShelvedChangeList) {
          changeLists.add((ShelvedChangeList)node.getUserObject());
        }
      }
    }
    if (changeLists.size() > 0) {
      sink.put(SHELVED_CHANGELIST_KEY,changeLists.toArray(new ShelvedChangeList[changeLists.size()]));
    }
  }
 else   if (key == SHELVED_CHANGE_KEY) {
    final List<ShelvedChange> list=TreeUtil.collectSelectedObjectsOfType(this,ShelvedChange.class);
    if (list != null) {
      sink.put(SHELVED_CHANGE_KEY,list);
    }
  }
 else   if (key == DataKeys.CHANGES) {
    List<ShelvedChange> shelvedChanges=TreeUtil.collectSelectedObjectsOfType(this,ShelvedChange.class);
    if (shelvedChanges.size() > 0) {
      Change[] changes=new Change[shelvedChanges.size()];
      for (int i=0; i < shelvedChanges.size(); i++) {
        changes[i]=shelvedChanges.get(i).getChange(myProject);
      }
      sink.put(DataKeys.CHANGES,changes);
    }
 else {
      final List<ShelvedChangeList> changeLists=TreeUtil.collectSelectedObjectsOfType(this,ShelvedChangeList.class);
      if (changeLists.size() > 0) {
        List<Change> changes=new ArrayList<Change>();
        for (        ShelvedChangeList changeList : changeLists) {
          shelvedChanges=changeList.getChanges();
          for (          ShelvedChange shelvedChange : shelvedChanges) {
            changes.add(shelvedChange.getChange(myProject));
          }
        }
        sink.put(DataKeys.CHANGES,changes.toArray(new Change[changes.size()]));
      }
    }
  }
 else   if (key == DataKeys.DELETE_ELEMENT_PROVIDER) {
    sink.put(DataKeys.DELETE_ELEMENT_PROVIDER,myDeleteProvider);
  }
}
