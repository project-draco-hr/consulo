{
  final String converted=StringUtil.convertLineSeparators(stringToReplace);
  CommandProcessor.getInstance().executeCommand(project,new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          document.replaceString(startOffset,endOffset,converted);
        }
      }
);
    }
  }
,null,document);
  return startOffset + converted.length();
}
