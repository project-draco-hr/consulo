{
  String selectedText=editor.getSelectionModel().getSelectedText();
  model.setReplaceState(replace);
  if (selectedText != null) {
    if (replace) {
      if (!StringUtil.isEmpty(selectedText)) {
        if (selectedText.indexOf('\n') >= 0) {
          model.setGlobal(false);
        }
 else {
          model.setStringToFind(selectedText);
          model.setGlobal(true);
        }
      }
 else {
        model.setGlobal(true);
      }
    }
 else {
      model.setStringToFind(selectedText);
      model.setGlobal(true);
    }
    if (model.isGlobal()) {
      model.setStringToFind(selectedText);
    }
  }
  model.setPromptOnReplace(false);
}
