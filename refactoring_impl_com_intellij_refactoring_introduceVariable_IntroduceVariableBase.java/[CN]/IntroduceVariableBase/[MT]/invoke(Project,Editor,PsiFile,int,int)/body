{
  FeatureUsageTracker.getInstance().triggerFeatureUsed("refactoring.introduceVariable");
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  PsiExpression tempExpr=CodeInsightUtil.findExpressionInRange(file,startOffset,endOffset);
  if (tempExpr == null) {
    PsiElement[] statements=CodeInsightUtil.findStatementsInRange(file,startOffset,endOffset);
    if (statements != null && statements.length == 1 && statements[0] instanceof PsiExpressionStatement) {
      tempExpr=((PsiExpressionStatement)statements[0]).getExpression();
    }
  }
  return invokeImpl(project,tempExpr,editor);
}
