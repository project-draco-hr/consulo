{
  final Collection<VirtualFile> result=new LinkedHashSet<VirtualFile>();
  myOrderEnumerator.forEach(new Processor<OrderEntry>(){
    @Override public boolean process(    OrderEntry orderEntry){
      if (orderEntry instanceof ModuleSourceOrderEntry) {
        collectModuleRoots(((ModuleSourceOrderEntry)orderEntry).getRootModel(),result);
      }
 else       if (orderEntry instanceof ModuleOrderEntry) {
        ModuleOrderEntry moduleOrderEntry=(ModuleOrderEntry)orderEntry;
        final Module module=moduleOrderEntry.getModule();
        if (module != null) {
          if (myRootType == OrderRootType.CLASSES && myOrderEnumerator.addCustomOutput(moduleOrderEntry,result)) {
            return true;
          }
          collectModuleRoots(myOrderEnumerator.getRootModel(module),result);
        }
      }
 else {
        Collections.addAll(result,myCustomRootProvider != null ? myCustomRootProvider.fun(orderEntry) : orderEntry.getFiles(myRootType));
      }
      return true;
    }
  }
);
  myOrderEnumerator.processRootModules(new Processor<Module>(){
    @Override public boolean process(    Module module){
      myOrderEnumerator.addAdditionalRoots(module,result);
      return true;
    }
  }
);
  return result;
}
