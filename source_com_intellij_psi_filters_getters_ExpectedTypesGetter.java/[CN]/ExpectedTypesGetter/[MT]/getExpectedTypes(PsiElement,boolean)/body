{
  ExpectedTypesProvider typesProvider=ExpectedTypesProvider.getInstance(context.getProject());
  PsiExpression expression=PsiTreeUtil.getContextOfType(context,PsiExpression.class,true);
  if (expression == null)   return PsiType.EMPTY_ARRAY;
  ExpectedTypeInfo[] infos=typesProvider.getExpectedTypes(expression,true);
  Set<PsiType> result=new THashSet<PsiType>(infos.length);
  for (  ExpectedTypeInfo info : infos) {
    final PsiType type=info.getType();
    result.add(type);
    final PsiType defaultType=info.getDefaultType();
    if (includeDefault && !defaultType.equals(type)) {
      result.add(defaultType);
    }
  }
  return result.toArray(new PsiType[result.size()]);
}
