{
  editor.getScrollingModel().scrollToCaret(ScrollType.MAKE_VISIBLE);
  PsiElement element=(PsiElement)dataContext.getData(DataConstants.PSI_ELEMENT);
  if (element instanceof PsiMethod) {
    PsiElement resolutionContext=file.findElementAt(editor.getCaretModel().getOffset());
    if (resolutionContext == null)     resolutionContext=element;
    resolutionContext=ChangeSignatureProcessor.normalizeResolutionContext(resolutionContext);
    invoke((PsiMethod)element,project,resolutionContext);
  }
 else   if (element instanceof PsiClass) {
    invoke((PsiClass)element);
  }
 else {
    String message="Cannot perform the refactoring.\n" + "The caret should be positioned at the name of the method to be refactored.";
    RefactoringMessageUtil.showErrorMessage(REFACTORING_NAME,message,HelpID.CHANGE_SIGNATURE,project);
  }
}
