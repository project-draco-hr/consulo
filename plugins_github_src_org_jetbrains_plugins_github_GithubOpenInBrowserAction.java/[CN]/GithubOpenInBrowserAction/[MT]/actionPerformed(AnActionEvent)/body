{
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  while (!checkCredentials(project)) {
    final GithubLoginDialog dialog=new GithubLoginDialog(project);
    dialog.show();
    if (!dialog.isOK()) {
      return;
    }
  }
  final VirtualFile root=project.getBaseDir();
  GitRepositoryManager manager=GitUtil.getRepositoryManager(project);
  if (manager == null) {
    return;
  }
  final GitRepository gitRepository=manager.getRepositoryForFile(root);
  final String githubRemoteUrl=findGithubRemoteUrl(gitRepository);
  final VirtualFile virtualFile=e.getData(PlatformDataKeys.VIRTUAL_FILE);
  final String rootPath=root.getPath();
  final String path=virtualFile.getPath();
  if (!path.startsWith(rootPath)) {
    Messages.showErrorDialog(project,"File is not under project root",CANNOT_OPEN_IN_BROWSER);
    return;
  }
  String branch=getBranchNameOnRemote(project,root);
  if (branch == null) {
    return;
  }
  String relativePath=path.substring(rootPath.length());
  String urlToOpen=makeUrlToOpen(e,relativePath,branch,githubRemoteUrl);
  BrowserUtil.launchBrowser(urlToOpen);
}
