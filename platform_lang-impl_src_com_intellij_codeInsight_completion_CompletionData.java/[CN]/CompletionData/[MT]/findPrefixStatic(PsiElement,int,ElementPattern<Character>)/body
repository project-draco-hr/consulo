{
  if (insertedElement == null)   return "";
  final String prefix=ApplicationManager.getApplication().runReadAction(new Computable<String>(){
    public String compute(){
      if (!insertedElement.isValid()) {
        return "";
      }
      return getReferencePrefix(insertedElement,offsetInFile);
    }
  }
);
  if (prefix != null)   return prefix;
  if (insertedElement instanceof PsiPlainText || insertedElement instanceof PsiComment) {
    return CompletionUtil.findJavaIdentifierPrefix(insertedElement,offsetInFile);
  }
  return findPrefixDefault(insertedElement,offsetInFile,prefixStartTrim);
}
