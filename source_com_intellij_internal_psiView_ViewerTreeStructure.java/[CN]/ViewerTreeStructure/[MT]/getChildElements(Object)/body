{
  if (myRootElement == element) {
    if (myRootPsiElement == null) {
      return ArrayUtil.EMPTY_OBJECT_ARRAY;
    }
    return myRootPsiElement instanceof PsiFile ? ((PsiFile)myRootPsiElement).getPsiRoots() : new Object[]{myRootPsiElement};
  }
  final Object[][] children=new Object[1][];
  children[0]=ArrayUtil.EMPTY_OBJECT_ARRAY;
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      PsiElement[] elementChildren=((PsiElement)element).getChildren();
      if (elementChildren.length > 0) {
        List<PsiElement> childrenList=new ArrayList<PsiElement>(elementChildren.length);
        for (int idx=0; idx < elementChildren.length; idx++) {
          PsiElement psiElement=elementChildren[idx];
          if (!myShowWhiteSpaces && psiElement instanceof PsiWhiteSpace) {
            continue;
          }
          childrenList.add(psiElement);
        }
        elementChildren=childrenList.toArray(new PsiElement[childrenList.size()]);
      }
      children[0]=elementChildren;
    }
  }
);
  return children[0];
}
