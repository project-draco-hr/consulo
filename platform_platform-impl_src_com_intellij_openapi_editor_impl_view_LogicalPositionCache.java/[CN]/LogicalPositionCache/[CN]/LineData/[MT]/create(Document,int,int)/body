{
  int start=document.getLineStartOffset(line);
  int end=document.getLineEndOffset(line);
  int cacheSize=(end - start) / CACHE_FREQUENCY;
  int[] cache=new int[cacheSize];
  CharSequence text=document.getImmutableCharSequence();
  int column=0;
  boolean hasTabs=false;
  for (int i=start; i < end; i++) {
    if (i > start && (i - start) % CACHE_FREQUENCY == 0) {
      cache[(i - start) / CACHE_FREQUENCY - 1]=column;
    }
    if (text.charAt(i) == '\t') {
      column=(column / tabSize + 1) * tabSize;
      hasTabs=true;
    }
 else {
      column++;
    }
  }
  return hasTabs ? new LineData(cache) : TRIVIAL;
}
