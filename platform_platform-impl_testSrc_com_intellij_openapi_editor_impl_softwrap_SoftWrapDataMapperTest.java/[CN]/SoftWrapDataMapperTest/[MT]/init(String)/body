{
  final Context context=new Context();
  for (int i=0; i < documentText.length(); i++) {
    if (isSoftWrapStart(documentText,i)) {
      context.onSoftWrapStart();
      i+=SOFT_WRAP_START_MARKER.length() - 1;
      continue;
    }
    if (isSoftWrapEnd(documentText,i)) {
      context.onSoftWrapEnd();
      i+=SOFT_WRAP_END_MARKER.length() - 1;
      continue;
    }
    if (isFoldingStart(documentText,i)) {
      context.onFoldingStart();
      i+=FOLDING_START_MARKER.length() - 1;
      continue;
    }
    if (isFoldingEnd(documentText,i)) {
      context.onFoldingEnd();
      i+=FOLDING_END_MARKER.length() - 1;
      continue;
    }
    char c=documentText.charAt(i);
    context.onNewSymbol(c);
  }
  myLineRanges.add(new TextRange(context.logicalLineStartOffset,context.document.length()));
  myMockery.checking(new Expectations(){
{
      allowing(myDocument).getCharsSequence();
      will(returnValue(context.document));
      allowing(myDocument).getTextLength();
      will(returnValue(context.document.length()));
    }
  }
);
}
