{
  addData();
  if (insideFolding) {
    myFoldedOffsets.add(offset);
    onNonSoftWrapSymbol(c);
    if (c == '\n') {
      foldedLines++;
      offset++;
      x=0;
    }
 else     if (c == '\t') {
      int tabWidthInColumns=myRepresentationHelper.toVisualColumnSymbolsNumber(c,x);
      x+=myRepresentationHelper.charWidth(c,x,Font.PLAIN);
      insideTab=true;
      for (int i=tabWidthInColumns - 1; i > 0; i--) {
        logicalColumn++;
        addData(false);
      }
      insideTab=false;
      logicalColumn++;
      offset++;
    }
 else {
      logicalColumn++;
      offset++;
      x+=myRepresentationHelper.charWidth(c,x,Font.PLAIN);
    }
    foldingColumnDiff=foldingStartVisualColumn - logicalColumn;
    return;
  }
  if (insideSoftWrap) {
    mySoftWrapBuffer.append(c);
    if (c == '\n') {
      visualColumn++;
      x+=SPACE_SIZE;
      addData(true);
      visualColumn++;
      x+=SPACE_SIZE;
      addData(true);
      visualLine++;
      x=0;
      softWrapLinesOnCurrentLogical++;
      visualColumn=1;
      softWrapSymbolsOnCurrentVisualLine=0;
    }
 else {
      visualColumn++;
      softWrapSymbolsOnCurrentVisualLine++;
      x+=myRepresentationHelper.charWidth(c,x,Font.PLAIN);
    }
    return;
  }
  onNonSoftWrapSymbol(c);
  if (c == '\n') {
    visualLine++;
    visualColumn=0;
    x=0;
    softWrapLinesBeforeCurrentLogical+=softWrapLinesOnCurrentLogical;
    softWrapLinesOnCurrentLogical=0;
    softWrapSymbolsOnCurrentVisualLine=0;
    foldingColumnDiff=0;
    offset++;
  }
 else   if (c == '\t') {
    int tabWidthInColumns=myRepresentationHelper.toVisualColumnSymbolsNumber(c,x);
    x+=myRepresentationHelper.charWidth(c,x,Font.PLAIN);
    insideTab=true;
    for (int i=tabWidthInColumns - 1; i > 0; i--) {
      visualColumn++;
      logicalColumn++;
      addData(false);
    }
    insideTab=false;
    visualColumn++;
    logicalColumn++;
    offset++;
  }
 else {
    visualColumn++;
    logicalColumn++;
    offset++;
    x+=myRepresentationHelper.charWidth(c,x,Font.PLAIN);
  }
}
