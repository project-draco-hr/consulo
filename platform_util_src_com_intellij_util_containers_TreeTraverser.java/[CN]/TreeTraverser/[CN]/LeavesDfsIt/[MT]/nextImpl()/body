{
  while (!stack.isEmpty()) {
    Pair<T,Iterator<? extends T>> top=stack.getLast();
    if (top.second != null && top.second.hasNext()) {
      T child=top.second.next();
      Iterator<? extends T> childrenIt=children(child).iterator();
      if (childrenIt.hasNext()) {
        stack.addLast(Pair.<T,Iterator<? extends T>>create(child,childrenIt));
      }
 else {
        return child;
      }
    }
 else {
      stack.removeLast();
      if (top.second == null)       return top.first;
    }
  }
  return stop();
}
