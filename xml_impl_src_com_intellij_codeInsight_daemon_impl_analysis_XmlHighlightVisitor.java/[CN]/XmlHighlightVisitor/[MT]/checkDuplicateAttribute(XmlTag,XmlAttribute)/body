{
  if (tag.getUserData(DO_NOT_VALIDATE_KEY) != null) {
    return;
  }
  final XmlAttribute[] attributes=tag.getAttributes();
  ProgressManager progressManager=ProgressManager.getInstance();
  final PsiFile containingFile=tag.getContainingFile();
  final XmlExtension extension=containingFile instanceof XmlFile ? XmlExtension.getExtension(containingFile) : XmlExtension.DEFAULT_EXTENSION;
  for (  XmlAttribute tagAttribute : attributes) {
    progressManager.checkCanceled();
    if (attribute != tagAttribute && Comparing.strEqual(attribute.getName(),tagAttribute.getName())) {
      final String localName=attribute.getLocalName();
      if (extension.canBeDuplicated(tagAttribute))       continue;
      HighlightInfo highlightInfo=HighlightInfo.createHighlightInfo(getTagProblemInfoType(tag),XmlChildRole.ATTRIBUTE_NAME_FINDER.findChild(SourceTreeToPsiMap.psiElementToTree(attribute)),XmlErrorMessages.message("duplicate.attribute",localName));
      addToResults(highlightInfo);
      IntentionAction intentionAction=new RemoveAttributeIntentionFix(localName,attribute);
      QuickFixAction.registerQuickFixAction(highlightInfo,intentionAction);
    }
  }
}
