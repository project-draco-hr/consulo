{
  final Template template=TemplateManager.getInstance(getProject()).createTemplate("foo","zzz");
  template.addTextSegment("FooFactory.createFoo()");
  final SmartCompletionContextType completionContextType=ContainerUtil.findInstance(TemplateContextType.EP_NAME.getExtensions(),SmartCompletionContextType.class);
  ((TemplateImpl)template).getTemplateContext().setEnabled(completionContextType,true);
  TemplateSettings.getInstance().addTemplate(template);
  try {
    doTest();
  }
  finally {
    TemplateSettings.getInstance().removeTemplate(template);
  }
}
