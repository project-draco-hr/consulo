{
  if (ApplicationManager.getApplication().isUnitTestMode())   return;
  if (!(newFile instanceof PsiJavaFile)) {
    LOG.info(".java is not assigned to java file type");
    return;
  }
  newFile=JavaCodeStyleManager.getInstance(myProject).shortenClassReferences(newFile);
  newFile=CodeStyleManager.getInstance(myProject).reformat(newFile);
  PsiClass[] inner=((PsiJavaFile)newFile).getClasses();
  for (  PsiClass psiClass : inner) {
    MoveClassToSeparateFileFix fix=new MoveClassToSeparateFileFix(psiClass);
    if (fix.isAvailable(myProject,null,(PsiFile)newFile)) {
      fix.invoke(myProject,null,(PsiFile)newFile);
    }
  }
}
