{
  for (  GroovyFile file : myFiles) {
    final PsiDirectory dir=file.getContainingDirectory();
    LOG.assertTrue(dir != null);
    final PsiFile[] files=dir.getFiles();
    Set<String> fileNames=new HashSet<String>();
    for (    PsiFile psiFile : files) {
      fileNames.add(psiFile.getName());
    }
    String prefix=FileUtil.getNameWithoutExtension(file.getName());
    String fileName=prefix + ".java";
    int index=1;
    while (fileNames.contains(fileName)) {
      fileName=prefix + index + ".java";
    }
    final Project project=file.getProject();
    GrTopStatement[] statements=file.getTopStatements();
    final StringBuilder builder=new StringBuilder();
    CodeBlockGenerator generator=new CodeBlockGenerator(builder,new ExpressionContext(project));
    for (    GrTopStatement statement : statements) {
      statement.accept(generator);
      builder.append("\n");
    }
    final PsiFile newFile=(PsiFile)file.setName(fileName);
    final Document document=PsiDocumentManager.getInstance(project).getDocument(newFile);
    document.setText(builder);
  }
}
