{
  final HashSet<VirtualFile> allToCompile=new HashSet<VirtualFile>();
  for (  GroovyFile file : myFiles) {
    allToCompile.add(file.getVirtualFile());
  }
  final GroovyToJavaGenerator fileGenerator=new GroovyToJavaGenerator(myProject,allToCompile,true);
  for (  GroovyFile file : myFiles) {
    final Map<String,CharSequence> map=fileGenerator.generateStubs(file);
    StringBuilder builder=new StringBuilder();
    for (    String s : map.keySet()) {
      builder.append(map.get(s)).append('\n');
    }
    String fileName=getNewFileName(file);
    final PsiFile newFile=(PsiFile)file.setName(fileName);
    final Document document=PsiDocumentManager.getInstance(myProject).getDocument(newFile);
    LOG.assertTrue(document != null);
    document.setText(builder);
  }
}
