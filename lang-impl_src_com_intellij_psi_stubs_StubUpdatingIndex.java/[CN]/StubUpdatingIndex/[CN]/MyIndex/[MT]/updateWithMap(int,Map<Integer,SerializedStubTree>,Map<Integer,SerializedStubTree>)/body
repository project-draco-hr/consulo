{
  final Map<StubIndexKey,Map<Object,TIntArrayList>> oldStubTree=getStubTree(oldData);
  final Map<StubIndexKey,Map<Object,TIntArrayList>> newStubTree=getStubTree(newData);
  final Lock lock=getWriteLock();
  lock.lock();
  try {
    super.updateWithMap(inputId,oldData,newData);
    updateAffectedStubIndices(inputId,oldStubTree,newStubTree);
  }
  finally {
    lock.unlock();
  }
}
