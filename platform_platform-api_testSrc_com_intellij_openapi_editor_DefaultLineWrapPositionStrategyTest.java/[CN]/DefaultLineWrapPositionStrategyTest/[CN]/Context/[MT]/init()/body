{
  wrapIndex=rawDocument.indexOf(WRAP_MARKER);
  preferredIndex=rawDocument.indexOf(MAX_PREFERRED_MARKER);
  if (wrapIndex >= 0 && preferredIndex >= 0) {
    if (wrapIndex < preferredIndex) {
      processWrap();
      processMaxPreferredIndex();
    }
 else {
      processMaxPreferredIndex();
      processWrap();
    }
  }
 else {
    if (wrapIndex >= 0) {
      processWrap();
    }
    if (preferredIndex >= 0) {
      processMaxPreferredIndex();
    }
  }
  buffer.append(rawDocument.substring(index));
  document=buffer.toString();
  if (preferredIndex <= 0) {
    preferredIndex=document.length();
  }
}
