{
  final PsiJavaToken sign=binaryExpression.getOperationSign();
  final IElementType tokenType=sign.getTokenType();
  final PsiType type=binaryExpression.getType();
  if (TypeUtils.isJavaLangString(type)) {
    expectedType=null;
  }
 else   if (isArithmeticOperation(tokenType)) {
    expectedType=type;
  }
 else   if (isShiftOperation(tokenType)) {
    final PsiExpression lhs=binaryExpression.getLOperand();
    if (wrappedExpression.equals(lhs)) {
      expectedType=unaryNumericPromotion(lhs.getType());
    }
 else {
      final PsiExpression rhs=binaryExpression.getROperand();
      if (rhs == null) {
        expectedType=null;
      }
 else {
        expectedType=unaryNumericPromotion(rhs.getType());
      }
    }
  }
 else   if (ComparisonUtils.isComparisonOperation(tokenType)) {
    final PsiExpression rhs=binaryExpression.getROperand();
    if (rhs == null) {
      expectedType=null;
      return;
    }
    final PsiExpression lhs=binaryExpression.getLOperand();
    PsiType lhsType=lhs.getType();
    if (lhsType == null) {
      expectedType=null;
      return;
    }
    PsiType rhsType=rhs.getType();
    if (rhsType == null) {
      expectedType=null;
      return;
    }
    if (!ClassUtils.isPrimitive(lhsType)) {
      lhsType=PsiPrimitiveType.getUnboxedType(lhsType);
      if (lhsType == null) {
        expectedType=null;
        return;
      }
    }
    if (!ClassUtils.isPrimitive(rhsType)) {
      rhsType=PsiPrimitiveType.getUnboxedType(rhsType);
      if (rhsType == null) {
        expectedType=null;
        return;
      }
    }
    if (PsiType.DOUBLE.equals(lhsType) || PsiType.DOUBLE.equals(rhsType)) {
      expectedType=PsiType.DOUBLE;
    }
 else     if (PsiType.FLOAT.equals(lhsType) || PsiType.FLOAT.equals(rhsType)) {
      expectedType=PsiType.FLOAT;
    }
 else     if (PsiType.LONG.equals(lhsType) || PsiType.LONG.equals(rhsType)) {
      expectedType=PsiType.LONG;
    }
 else {
      expectedType=PsiType.INT;
    }
  }
 else   if (isBooleanOperation(tokenType)) {
    expectedType=type;
  }
 else {
    expectedType=null;
  }
}
