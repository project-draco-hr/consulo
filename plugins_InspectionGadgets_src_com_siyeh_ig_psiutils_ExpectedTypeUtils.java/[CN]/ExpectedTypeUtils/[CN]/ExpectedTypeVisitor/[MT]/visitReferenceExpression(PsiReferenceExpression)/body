{
  final PsiManager manager=ref.getManager();
  final PsiElement element=ref.resolve();
  if (element instanceof PsiField) {
    final PsiField field=(PsiField)element;
    final PsiClass aClass=field.getContainingClass();
    final PsiElementFactory factory=manager.getElementFactory();
    expectedType=factory.createType(aClass);
  }
 else   if (element instanceof PsiMethod) {
    final PsiMethod method=(PsiMethod)element;
    final PsiMethod superMethod=method.findDeepestSuperMethod();
    final PsiClass aClass;
    if (superMethod != null) {
      aClass=superMethod.getContainingClass();
    }
 else {
      aClass=method.getContainingClass();
    }
    final PsiElementFactory factory=manager.getElementFactory();
    expectedType=factory.createType(aClass);
  }
 else {
    expectedType=null;
  }
}
