{
  final PsiManager manager=ref.getManager();
  final PsiElement parent=ref.getParent();
  if (parent instanceof PsiMethodCallExpression) {
    final PsiMethod psiMethod=((PsiCall)parent).resolveMethod();
    if (psiMethod == null) {
      expectedType=null;
      return;
    }
    final PsiClass aClass=psiMethod.getContainingClass();
    final PsiElementFactory factory=manager.getElementFactory();
    expectedType=factory.createType(aClass);
  }
 else   if (parent instanceof PsiReferenceExpression) {
    final PsiElement elt=((PsiReference)parent).resolve();
    if (elt instanceof PsiField) {
      final PsiClass aClass=((PsiMember)elt).getContainingClass();
      final PsiElementFactory factory=manager.getElementFactory();
      expectedType=factory.createType(aClass);
    }
 else {
      expectedType=null;
    }
  }
}
