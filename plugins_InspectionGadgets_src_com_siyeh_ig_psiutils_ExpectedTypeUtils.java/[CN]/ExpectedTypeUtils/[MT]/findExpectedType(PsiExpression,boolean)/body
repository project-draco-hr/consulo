{
  PsiElement context=expression.getParent();
  PsiExpression wrappedExpression=expression;
  while (context != null && context instanceof PsiParenthesizedExpression) {
    wrappedExpression=(PsiExpression)context;
    context=context.getParent();
  }
  if (context == null) {
    return null;
  }
  final ExpectedTypeVisitor visitor=new ExpectedTypeVisitor(wrappedExpression,calculateTypeForComplexReferences);
  context.accept(visitor);
  return visitor.getExpectedType();
}
