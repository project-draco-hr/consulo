{
  PsiElement context=exp.getParent();
  PsiExpression wrappedExp=exp;
  while (context != null && context instanceof PsiParenthesizedExpression) {
    wrappedExp=(PsiExpression)context;
    context=context.getParent();
  }
  if (context == null) {
    return null;
  }
  final ExpectedTypeVisitor visitor=new ExpectedTypeVisitor(wrappedExp,calculateTypeForComplexReferences);
  context.accept(visitor);
  return visitor.getExpectedType();
}
