{
  if (e == null)   return EMPTY_ARRAY;
  final Project project=PlatformDataKeys.PROJECT.getData(e.getDataContext());
  if (project == null) {
    return EMPTY_ARRAY;
  }
  final FavoritesManager favoritesManager=FavoritesManager.getInstance(project);
  final DataContext dataContext=e.getDataContext();
  FavoritesTreeNodeDescriptor[] roots=FavoritesTreeViewPanel.CONTEXT_FAVORITES_ROOTS_DATA_KEY.getData(dataContext);
  if (roots == null || roots.length == 0) {
    return EMPTY_ARRAY;
  }
  String listName=null;
  for (  FavoritesTreeNodeDescriptor root : roots) {
    final AbstractTreeNode element=root.getElement();
    if (element instanceof FavoritesListNode) {
      return EMPTY_ARRAY;
    }
    final NodeDescriptor parent=root.getParentDescriptor();
    if (!(parent instanceof FavoritesTreeNodeDescriptor)) {
      return EMPTY_ARRAY;
    }
    final Object parentElement=parent.getElement();
    if (parentElement instanceof FavoritesListNode) {
      String name=((FavoritesListNode)parentElement).getName();
      if (listName == null) {
        listName=name;
      }
      if (!StringUtil.equals(listName,name)) {
        return EMPTY_ARRAY;
      }
    }
  }
  final String[] allLists=favoritesManager.getAvailableFavoritesListNames();
  List<AnAction> actions=new ArrayList<AnAction>();
  for (  String list : allLists) {
    if (!list.equals(listName)) {
      actions.add(new SendToFavoritesAction(list));
    }
  }
  if (actions.size() != 0) {
    actions.add(Separator.getInstance());
  }
  actions.add(new SendToNewFavoritesListAction());
  return actions.toArray(new AnAction[actions.size()]);
}
