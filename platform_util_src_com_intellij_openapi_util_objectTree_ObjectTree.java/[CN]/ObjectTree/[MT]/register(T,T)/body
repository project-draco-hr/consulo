{
synchronized (treeLock) {
    ObjectNode<T> parentNode=getOrCreateNodeFor(parent,null);
    ObjectNode<T> childNode=getNode(child);
    if (childNode == null) {
      childNode=createNodeFor(child,parentNode,Disposer.isDebugMode() ? new Throwable() : null);
    }
 else {
      ObjectNode<T> oldParent=childNode.getParent();
      if (oldParent != null) {
        oldParent.removeChild(childNode);
      }
    }
    myRootObjects.remove(child);
    checkWasNotAddedAlready(childNode,child);
    parentNode.addChild(childNode);
    fireRegistered(childNode.getObject());
  }
}
