{
  super.visitReferenceExpression(refExpr);
  GroovyResolveResult resolveResult=refExpr.advancedResolve();
  PsiElement resolved=resolveResult.getElement();
  if (resolved != null) {
    if (isDeclarationAssignment(refExpr) || resolved instanceof PsiJavaPackage)     return;
  }
 else {
    GrExpression qualifier=refExpr.getQualifierExpression();
    if (qualifier == null && isDeclarationAssignment(refExpr))     return;
  }
  final PsiType refExprType=refExpr.getType();
  if (refExprType == null) {
    if (resolved != null) {
      registerError(refExpr);
    }
  }
 else   if (refExprType instanceof PsiClassType && ((PsiClassType)refExprType).resolve() == null) {
    registerError(refExpr);
  }
}
