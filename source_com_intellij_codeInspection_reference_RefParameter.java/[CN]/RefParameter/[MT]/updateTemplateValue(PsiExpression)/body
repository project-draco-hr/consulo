{
  if (myActualValueTemplate == null)   return;
  String newTemplate=null;
  if (expression instanceof PsiLiteralExpression) {
    PsiLiteralExpression psiLiteralExpression=(PsiLiteralExpression)expression;
    newTemplate=psiLiteralExpression.getText();
  }
 else   if (expression instanceof PsiReferenceExpression) {
    PsiReferenceExpression referenceExpression=(PsiReferenceExpression)expression;
    PsiElement resolved=referenceExpression.resolve();
    if (resolved instanceof PsiField) {
      PsiField psiField=(PsiField)resolved;
      if (psiField.hasModifierProperty(PsiModifier.STATIC) && psiField.hasModifierProperty(PsiModifier.FINAL)) {
        newTemplate=PsiFormatUtil.formatVariable(psiField,PsiFormatUtil.SHOW_NAME | PsiFormatUtil.SHOW_CONTAINING_CLASS | PsiFormatUtil.SHOW_FQ_NAME,PsiSubstitutor.EMPTY);
      }
    }
  }
  if (myActualValueTemplate == VALUE_UNDEFINED) {
    myActualValueTemplate=newTemplate;
  }
 else   if (!Comparing.equal(myActualValueTemplate,newTemplate)) {
    myActualValueTemplate=null;
  }
}
