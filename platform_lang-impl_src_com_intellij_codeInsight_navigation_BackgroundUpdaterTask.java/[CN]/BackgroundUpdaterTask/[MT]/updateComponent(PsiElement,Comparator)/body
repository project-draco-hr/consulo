{
  if (myCanceled)   return false;
  if (myPopup.isDisposed())   return false;
synchronized (lock) {
    if (myData.contains(element))     return true;
    myData.add(element);
  }
  myAlarm.addRequest(new Runnable(){
    @Override public void run(){
      myAlarm.cancelAllRequests();
      if (myCanceled)       return;
      if (myPopup.isDisposed())       return;
      ArrayList<PsiElement> data=new ArrayList<PsiElement>();
synchronized (lock) {
        if (comparator != null) {
          Collections.sort(myData,comparator);
        }
        data.addAll(myData);
      }
      replaceModel(data);
      myPopup.setCaption(getCaption(getCurrentSize()));
      myPopup.pack(true,true);
    }
  }
,200,ModalityState.stateForComponent(myPopup.getContent()));
  return true;
}
