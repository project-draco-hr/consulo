{
  CommandProcessor.getInstance().setCurrentCommandGroupId(EditorActionUtil.DELETE_COMMAND_GROUP);
  SelectionModel selectionModel=editor.getSelectionModel();
  if (selectionModel.hasSelection()) {
    Document document=editor.getDocument();
    int selectionStart=selectionModel.getSelectionStart();
    int selectionEnd=selectionModel.getSelectionEnd();
    selectionModel.removeSelection();
    int lineStartOffset=document.getLineStartOffset(document.getLineNumber(selectionStart));
    final int nextLine=document.getLineNumber(selectionEnd) + 1;
    int nextLineStartOffset=nextLine == document.getLineCount() ? document.getTextLength() : Math.min(document.getTextLength(),document.getLineStartOffset(nextLine));
    document.deleteString(lineStartOffset,nextLineStartOffset);
    return;
  }
  deleteLineAtCaret(editor);
}
