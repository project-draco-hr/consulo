{
  CommandProcessor.getInstance().setCurrentCommandGroupId(EditorActionUtil.DELETE_COMMAND_GROUP);
  SelectionModel selectionModel=editor.getSelectionModel();
  if (selectionModel.hasSelection()) {
    Document document=editor.getDocument();
    int selectionStart=selectionModel.getSelectionStart();
    int selectionEnd=selectionModel.getSelectionEnd();
    selectionModel.removeSelection();
    int lineStartOffset=document.getLineStartOffset(document.getLineNumber(selectionStart));
    int nextLine=document.getLineNumber(selectionEnd);
    if (document.getLineStartOffset(nextLine) != selectionEnd) {
      nextLine++;
    }
    int nextLineStartOffset=nextLine == document.getLineCount() ? document.getTextLength() : Math.min(document.getTextLength(),document.getLineStartOffset(nextLine));
    document.deleteString(lineStartOffset,nextLineStartOffset);
    return;
  }
  final VisualPosition position=editor.getCaretModel().getVisualPosition();
  editor.getSelectionModel().selectLineAtCaret();
  EditorModificationUtil.deleteSelectedText(editor);
  editor.getCaretModel().moveToVisualPosition(position);
}
