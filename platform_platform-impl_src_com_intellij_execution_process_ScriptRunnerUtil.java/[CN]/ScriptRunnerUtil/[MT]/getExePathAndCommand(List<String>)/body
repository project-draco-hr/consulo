{
  @NonNls String exePath="";
  @NonNls List<String> parameters=new ArrayList<String>();
  if (SystemInfo.isOS2) {
    exePath="cmd";
    parameters.add("/c");
  }
 else   if (SystemInfo.isWindows) {
    if (!SystemInfo.isWindows9x) {
      exePath="cmd";
    }
 else {
      exePath="command.com";
    }
    parameters.add("/c");
    boolean quoteWholeCommand=false;
    for (int i=1; i < commandToExecute.size(); i++) {
      quoteWholeCommand|=commandToExecute.get(i).contains(" ");
    }
    quoteWholeCommand&=commandToExecute.size() > 0 && commandToExecute.get(0).contains(" ");
    if (quoteWholeCommand) {
      StringBuilder builder=new StringBuilder();
      builder.append('"');
      for (int i=0; i < commandToExecute.size(); i++) {
        if (i > 0) {
          builder.append(' ');
        }
        builder.append(GeneralCommandLine.quote(commandToExecute.get(i)));
      }
      builder.append('"');
      parameters.add(builder.toString());
      return Pair.create(exePath,ArrayUtil.toStringArray(parameters));
    }
  }
  int firstParamIdx=0;
  if (SystemInfo.isUnix) {
    exePath=commandToExecute.get(0);
    firstParamIdx=1;
  }
  for (int i=firstParamIdx; i < commandToExecute.size(); i++) {
    parameters.add(commandToExecute.get(i));
  }
  return Pair.create(exePath,ArrayUtil.toStringArray(parameters));
}
