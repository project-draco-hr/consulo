{
  final PsiElement parent=value.getParent();
  if (!(parent instanceof XmlAttribute)) {
    checkReferences(value,QuickFixProvider.NULL);
    return;
  }
  XmlAttribute attribute=(XmlAttribute)parent;
  if (value.getUserData(DO_NOT_VALIDATE_KEY) != null) {
    return;
  }
  XmlTag tag=attribute.getParent();
  XmlElementDescriptor elementDescriptor=tag.getDescriptor();
  if (elementDescriptor == null)   return;
  XmlAttributeDescriptor attributeDescriptor=elementDescriptor.getAttributeDescriptor(attribute);
  if (attributeDescriptor == null)   return;
  String error=attributeDescriptor.validateValue(value,attribute.getValue());
  if (error != null) {
    addToResults(HighlightInfo.createHighlightInfo(getTagProblemInfoType(tag),value,error));
    return;
  }
  final RefCountHolder refCountHolder=myRefCountHolder;
  if (refCountHolder != null && attributeDescriptor.hasIdType() && tag.getParent().getUserData(DO_NOT_VALIDATE_KEY) == null) {
    final String unquotedValue=getUnquotedValue(value,tag);
    if (XmlUtil.isSimpleXmlAttributeValue(unquotedValue)) {
      final XmlAttribute attributeById=refCountHolder.getAttributeById(unquotedValue);
      if (attributeById == null || !attributeById.isValid() || attributeById == attribute) {
        refCountHolder.registerAttributeWithId(unquotedValue,attribute);
      }
 else {
        final XmlAttributeValue valueElement=attributeById.getValueElement();
        if (valueElement != null && getUnquotedValue(valueElement,tag).equals(unquotedValue)) {
          addToResults(HighlightInfo.createHighlightInfo(HighlightInfoType.WRONG_REF,value,XmlErrorMessages.message("duplicate.id.reference")));
          addToResults(HighlightInfo.createHighlightInfo(HighlightInfoType.WRONG_REF,valueElement,XmlErrorMessages.message("duplicate.id.reference")));
          return;
        }
 else {
          refCountHolder.registerAttributeWithId(unquotedValue,attribute);
        }
      }
    }
  }
  QuickFixProvider quickFixProvider=attributeDescriptor instanceof QuickFixProvider ? (QuickFixProvider)attributeDescriptor : QuickFixProvider.NULL;
  checkReferences(value,quickFixProvider);
}
