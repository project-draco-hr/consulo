{
  if (namespacePrefix.length() > 0 || (element instanceof XmlTag && element.getParent() instanceof XmlDocument)) {
    final String namespaceByPrefix=context.getNamespaceByPrefix(namespacePrefix);
    if (namespaceByPrefix.length() == 0) {
      final PsiFile containingFile=context.getContainingFile();
      if (!HighlightLevelUtil.shouldInspect(containingFile))       return;
      if (!XML.equals(namespacePrefix)) {
        boolean taglibDeclaration=containingFile.getFileType() == StdFileTypes.JSP;
        ProgressManager progressManager=ProgressManager.getInstance();
        if (taglibDeclaration) {
          final XmlTag[] directiveTags=PsiUtil.getJspFile(containingFile).getDirectiveTags(JspDirectiveKind.TAGLIB,false);
          for (          XmlTag t : directiveTags) {
            progressManager.checkCanceled();
            if (namespacePrefix.equals(t.getAttributeValue("prefix")))             return;
          }
        }
 else {
          @NonNls String nsDeclarationAttrName=null;
          for (XmlTag t=context; t != null; t=t.getParentTag()) {
            progressManager.checkCanceled();
            if (t.hasNamespaceDeclarations()) {
              if (nsDeclarationAttrName == null)               nsDeclarationAttrName="xmlns:" + namespacePrefix;
              if (t.getAttributeValue(nsDeclarationAttrName) != null)               return;
            }
          }
        }
        final String localizedMessage=XmlErrorMessages.message("unbound.namespace",namespacePrefix);
        if (namespacePrefix.length() == 0) {
          final XmlTag tag=(XmlTag)element;
          if (!XmlUtil.JSP_URI.equals(tag.getNamespace())) {
            addElementsForTag(tag,localizedMessage,HighlightInfoType.INFORMATION,new CreateNSDeclarationIntentionFix(context,namespacePrefix));
          }
          return;
        }
        final boolean error=containingFile.getFileType() == StdFileTypes.JSPX || containingFile.getFileType() == StdFileTypes.XHTML || containingFile.getFileType() == StdFileTypes.XML;
        final int messageLength=namespacePrefix.length();
        final HighlightInfoType infoType=error ? HighlightInfoType.ERROR : HighlightInfoType.WARNING;
        if (element instanceof XmlTag) {
          bindMessageToTag((XmlTag)element,infoType,messageLength,localizedMessage,null,new CreateNSDeclarationIntentionFix(context,namespacePrefix));
        }
 else {
          bindMessageToAstNode(element,infoType,0,messageLength,localizedMessage);
        }
      }
    }
  }
}
