{
  final XmlTag rootTag=((XmlFile)file).getDocument().getRootTag();
  final PsiElementFactory elementFactory=rootTag.getManager().getElementFactory();
  final String namespace=guessNamespace(file,project,myTaglibDeclaration || file instanceof JspFile,!(file instanceof JspFile) || file.getFileType() == StdFileTypes.JSPX);
  if (myTaglibDeclaration) {
    final XmlTag childTag=rootTag.createChildTag("directive.taglib",XmlUtil.JSP_URI,null,false);
    PsiElement element=childTag.add(elementFactory.createXmlAttribute("prefix",myNamespacePrefix));
    childTag.addAfter(elementFactory.createXmlAttribute("uri",namespace),element);
    element=rootTag.addBefore(childTag,rootTag.getFirstChild());
    CodeStyleManager.getInstance(project).reformat(element);
  }
 else {
    rootTag.add(elementFactory.createXmlAttribute("xmlns:" + myNamespacePrefix,namespace));
  }
}
