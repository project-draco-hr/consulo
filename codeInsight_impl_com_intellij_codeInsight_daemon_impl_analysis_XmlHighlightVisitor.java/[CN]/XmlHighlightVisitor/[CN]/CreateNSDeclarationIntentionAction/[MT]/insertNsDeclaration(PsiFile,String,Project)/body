{
  final XmlTag rootTag=((XmlFile)file).getDocument().getRootTag();
  final PsiElementFactory elementFactory=rootTag.getManager().getElementFactory();
  if (myTaglibDeclaration) {
    final XmlTag childTag=rootTag.createChildTag("directive.taglib",XmlUtil.JSP_URI,null,false);
    PsiElement element=childTag.add(elementFactory.createXmlAttribute("prefix",myNamespacePrefix));
    childTag.addAfter(elementFactory.createXmlAttribute(URI_ATTR_NAME,namespace),element);
    element=rootTag.addBefore(childTag,rootTag.getFirstChild());
    CodeStyleManager.getInstance(project).reformat(element);
    return ((XmlTag)element).getAttribute(URI_ATTR_NAME,null);
  }
 else {
    @NonNls final String name="xmlns:" + myNamespacePrefix;
    rootTag.add(elementFactory.createXmlAttribute(name,namespace));
    return rootTag.getAttribute(name,null);
  }
}
