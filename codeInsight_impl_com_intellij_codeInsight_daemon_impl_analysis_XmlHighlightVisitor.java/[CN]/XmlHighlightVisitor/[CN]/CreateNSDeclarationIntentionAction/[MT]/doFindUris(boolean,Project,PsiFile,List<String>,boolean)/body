{
  final ProgressIndicator pi=ProgressManager.getInstance().getProgressIndicator();
  if (acceptTaglib) {
    if (pi != null)     pi.setText(XmlErrorMessages.message("looking.in.tlds"));
    final JspManager instance=JspManager.getInstance(project);
    final JspFile jspFile=(JspFile)file;
    final String[] possibleTldUris=instance.getPossibleTldUris(jspFile);
    Arrays.sort(possibleTldUris);
    int i=0;
    for (    String uri : possibleTldUris) {
      if (pi != null) {
        pi.setFraction((double)i / possibleTldUris.length);
        pi.setText2(uri);
        ++i;
      }
      final XmlFile tldFileByUri=instance.getTldFileByUri(uri,jspFile);
      if (tldFileByUri == null)       continue;
      final PsiMetaData metaData=tldFileByUri.getDocument().getMetaData();
      if (metaData instanceof TldDescriptor) {
        if (((TldDescriptor)metaData).getElementDescriptor(myTag) != null) {
          possibleUris.add(uri);
        }
      }
    }
  }
  if (acceptXmlNs) {
    if (pi != null)     pi.setText(XmlErrorMessages.message("looking.in.schemas"));
    final ExternalResourceManagerEx instanceEx=ExternalResourceManagerEx.getInstanceEx();
    final String[] availableUrls=instanceEx.getResourceUrls(null,true);
    int i=0;
    for (    String url : availableUrls) {
      if (pi != null) {
        pi.setFraction(((double)i) / availableUrls.length);
        pi.setText2(url);
        ++i;
      }
      final XmlFile xmlFile=XmlUtil.findXmlFile(file,url);
      if (xmlFile != null) {
        final PsiMetaData metaData=xmlFile.getDocument().getMetaData();
        if (metaData instanceof XmlNSDescriptorImpl) {
          XmlElementDescriptor elementDescriptor=((XmlNSDescriptorImpl)metaData).getElementDescriptor(myTag.getLocalName(),url);
          if (elementDescriptor != null && !(elementDescriptor instanceof AnyXmlElementDescriptor)) {
            possibleUris.add(url);
          }
        }
      }
    }
  }
}
