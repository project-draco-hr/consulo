{
  Change currentChange=VcsDataKeys.CURRENT_CHANGE.getData(dataProvider);
  Change[] selectedChanges=VcsDataKeys.SELECTED_CHANGES.getData(dataProvider);
  if (selectedChanges != null) {
    int index=Math.max(ArrayUtil.indexOf(selectedChanges,currentChange),0);
    return new ChangesSelection(Arrays.asList(selectedChanges),index);
  }
  Change[] changes=VcsDataKeys.CHANGES.getData(dataProvider);
  if (changes != null) {
    int index=Math.max(ArrayUtil.indexOf(changes,currentChange),0);
    return new ChangesSelection(Arrays.asList(changes),index);
  }
  if (currentChange != null) {
    return new ChangesSelection(Collections.singletonList(currentChange),0);
  }
  return null;
}
