{
  final Runnable wrapped=new Runnable(){
    public void run(){
      if (myProject.isDisposed())       return;
      myTreeExpansionMonitor.freeze();
      request.run();
      myTreeExpansionMonitor.restore();
    }
  }
;
  if (updateImmediately && isTreeShowing()) {
    myUpdateQueue.run(new Update(request){
      public void run(){
        wrapped.run();
      }
    }
);
  }
 else {
    myUpdateQueue.queue(new Update(request){
      public void run(){
        wrapped.run();
      }
      public boolean isExpired(){
        return !isTreeShowing();
      }
    }
);
  }
}
