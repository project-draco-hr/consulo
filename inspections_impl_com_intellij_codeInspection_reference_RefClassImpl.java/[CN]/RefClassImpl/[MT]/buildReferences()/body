{
  PsiClass psiClass=getElement();
  if (psiClass != null) {
    for (    PsiClassInitializer classInitializer : psiClass.getInitializers()) {
      ((RefUtilImpl)RefUtil.getInstance()).addReferences(psiClass,this,classInitializer.getBody());
    }
    PsiField[] psiFields=psiClass.getFields();
    for (    PsiField psiField : psiFields) {
      ((RefManagerImpl)getRefManager()).getFieldReference(this,psiField);
      final PsiExpression initializer=psiField.getInitializer();
      if (initializer != null) {
        ((RefUtilImpl)RefUtil.getInstance()).addReferences(psiClass,this,initializer);
      }
    }
    PsiMethod[] psiMethods=psiClass.getMethods();
    for (    PsiMethod psiMethod : psiMethods) {
      ((RefManagerImpl)getRefManager()).getMethodReference(this,psiMethod);
    }
    EjbClassRole role=EjbHelper.getEjbHelper().getEjbRole(psiClass);
    if (role != null) {
      setEjb(true);
      if (role.getType() == EjbClassRoleEnum.EJB_CLASS_ROLE_HOME_INTERFACE || role.getType() == EjbClassRoleEnum.EJB_CLASS_ROLE_REMOTE_INTERFACE) {
        PsiClassType remoteExceptionType=psiClass.getManager().getElementFactory().createTypeByFQClassName("java.rmi.RemoteException",psiClass.getResolveScope());
        for (        PsiMethod psiMethod : psiClass.getAllMethods()) {
          if (!RefUtil.getInstance().belongsToScope(psiMethod,getRefManager()))           continue;
          RefMethodImpl refMethod=(RefMethodImpl)((RefManagerImpl)getRefManager()).getMethodReference(this,psiMethod);
          if (refMethod != null) {
            refMethod.updateThrowsList(remoteExceptionType);
          }
        }
      }
    }
    ((RefManagerImpl)getRefManager()).fireBuildReferences(this);
  }
}
