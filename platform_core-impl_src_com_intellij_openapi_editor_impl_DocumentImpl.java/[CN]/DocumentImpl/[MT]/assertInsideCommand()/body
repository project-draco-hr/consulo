{
  CommandProcessor commandProcessor=CommandProcessor.getInstance();
  if (!commandProcessor.isUndoTransparentActionInProgress() && commandProcessor.getCurrentCommand() == null && myAssertThreading) {
    throw new IncorrectOperationException("Must not change document outside command or undo-transparent action. See com.intellij.openapi.command.WriteCommandAction or com.intellij.openapi.command.CommandProcessor");
  }
}
