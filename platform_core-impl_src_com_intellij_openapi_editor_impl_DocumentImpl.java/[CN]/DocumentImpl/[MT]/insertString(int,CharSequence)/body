{
  if (offset < 0)   throw new IndexOutOfBoundsException("Wrong offset: " + offset);
  if (offset > getTextLength()) {
    throw new IndexOutOfBoundsException("Wrong offset: " + offset + "; documentLength: "+ getTextLength()+ "; "+ s.subSequence(Math.max(0,s.length() - 20),s.length()));
  }
  assertWriteAccess();
  assertValidSeparators(s);
  if (!isWritable())   throw new ReadOnlyModificationException(this);
  if (s.length() == 0)   return;
  RangeMarker marker=getRangeGuard(offset,offset);
  if (marker != null) {
    throwGuardedFragment(marker,offset,null,s.toString());
  }
  myText=myText.ensureChunked();
  ImmutableText newText=myText.insert(offset,ImmutableText.valueOf(s));
  updateText(newText,offset,null,newText.subtext(offset,offset + s.length()),false,LocalTimeCounter.currentTime());
  trimToSize();
}
