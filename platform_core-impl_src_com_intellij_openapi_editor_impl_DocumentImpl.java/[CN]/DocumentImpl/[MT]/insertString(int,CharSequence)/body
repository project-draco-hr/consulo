{
  if (offset < 0)   throw new IndexOutOfBoundsException("Wrong offset: " + offset);
  if (offset > getTextLength()) {
    throw new IndexOutOfBoundsException("Wrong offset: " + offset + "; documentLength: "+ getTextLength()+ "; "+ s.subSequence(Math.max(0,s.length() - 20),s.length()));
  }
  assertWriteAccess();
  assertValidSeparators(s);
  if (!isWritable())   throw new ReadOnlyModificationException(this);
  if (s.length() == 0)   return;
  RangeMarker marker=getRangeGuard(offset,offset);
  if (marker != null) {
    throwGuardedFragment(marker,offset,"",s);
  }
  ImmutableCharSequence newText=myText.insert(offset,s);
  ImmutableCharSequence newString=newText.subtext(offset,offset + s.length());
  updateText(newText,offset,"",newString,false,LocalTimeCounter.currentTime(),offset,0);
  trimToSize();
}
