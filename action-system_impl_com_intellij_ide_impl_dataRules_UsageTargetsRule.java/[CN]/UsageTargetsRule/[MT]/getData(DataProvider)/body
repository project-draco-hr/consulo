{
  List<UsageTarget> result=new ArrayList<UsageTarget>();
  final UsageTargetProvider[] providers=Extensions.getRootArea().getExtensionPoint(EP_NAME).getExtensions();
  for (  UsageTargetProvider provider : providers) {
    final UsageTarget[] targets=provider.getTargetsAtContext(dataProvider);
    if (targets != null) {
      result.addAll(Arrays.asList(targets));
    }
  }
  PsiElement psiElement=(PsiElement)dataProvider.getData(DataConstants.PSI_ELEMENT);
  if (psiElement instanceof PsiDirectory)   psiElement=JavaDirectoryService.getInstance().getPackage(((PsiDirectory)psiElement));
  if (psiElement instanceof NavigationItem) {
    if (FindManager.getInstance(psiElement.getProject()).canFindUsages(psiElement)) {
      result.add(new PsiElement2UsageTargetAdapter(psiElement));
    }
  }
  return result.isEmpty() ? null : result.toArray(new UsageTarget[result.size()]);
}
