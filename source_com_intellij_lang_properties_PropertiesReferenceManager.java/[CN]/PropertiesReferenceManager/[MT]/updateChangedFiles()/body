{
  while (true) {
    VirtualFile virtualFile;
synchronized (LOCK) {
      if (myChangedFiles.isEmpty())       break;
      virtualFile=myChangedFiles.remove(myChangedFiles.size() - 1);
    }
    if (!virtualFile.isValid())     continue;
    PsiFile psiFile=myPsiManager.findFile(virtualFile);
    if (!(psiFile instanceof PropertiesFile))     continue;
    Set<String> keys=((PropertiesFile)psiFile).getNamesMap().keySet();
synchronized (LOCK) {
      for (      String key : keys) {
        Collection<VirtualFile> containingFiles=myPropertiesMap.get(key);
        if (containingFiles == null) {
          containingFiles=new THashSet<VirtualFile>();
          myPropertiesMap.put(key,containingFiles);
        }
        containingFiles.add(virtualFile);
      }
    }
  }
}
