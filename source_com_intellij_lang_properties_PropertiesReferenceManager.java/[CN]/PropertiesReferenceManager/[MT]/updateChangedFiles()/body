{
  while (true) {
    VirtualFile virtualFile=myChangedFiles.poll();
    if (virtualFile == null)     break;
    if (!virtualFile.isValid())     continue;
    PsiFile psiFile=myPsiManager.findFile(virtualFile);
    if (!(psiFile instanceof PropertiesFile))     continue;
    Set<String> keys=((PropertiesFile)psiFile).getNamesMap().keySet();
    for (    String key : keys) {
      Collection<VirtualFile> containingFiles=myPropertiesMap.get(key);
      if (containingFiles == null) {
        containingFiles=new ConcurrentHashSet<VirtualFile>();
        containingFiles=ConcurrencyUtil.cacheOrGet(myPropertiesMap,key,containingFiles);
      }
      containingFiles.add(virtualFile);
    }
  }
}
