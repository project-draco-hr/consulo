{
  myProject=project;
  myPropertiesFilesManager=propertiesFilesManager;
  myPsiManager=psiManager;
  myConnection=project.getMessageBus().connect();
  myConnection.subscribe(AppTopics.FILE_TYPES,new FileTypeListener(){
    public void beforeFileTypesChanged(    FileTypeEvent event){
    }
    public void fileTypesChanged(    FileTypeEvent event){
      StartupManager.getInstance(myProject).runWhenProjectIsInitialized(new Runnable(){
        public void run(){
          refreshAllKnownPropertiesFiles();
        }
      }
);
    }
  }
);
  myPropertiesFileListener=new PropertiesFilesManager.PropertiesFileListener(){
    public void fileAdded(    final VirtualFile propertiesFile){
      if (myPsiManager.isDisposed())       return;
      PsiFile psi=myPsiManager.findFile(propertiesFile);
      if (psi instanceof PropertiesFile) {
        beforePropertiesFileChange((PropertiesFile)psi,null);
      }
    }
    public void fileRemoved(    final VirtualFile propertiesFile){
    }
    public void fileChanged(    final VirtualFile propertiesFile,    final VirtualFilePropertyEvent event){
    }
  }
;
  propertiesFilesManager.addPropertiesFileListener(myPropertiesFileListener);
}
