{
  try {
    boolean restored=false;
    for (    final String myDeletedFilesPath : myDeletedFilesPaths) {
      restored|=myDeletedStorage.restore((String)myDeletedFilesPath);
    }
    myDeletedStorage.purgeDirsWithNoEntries();
    final boolean showWarning=restored;
    if (CvsVcs2.getInstance(myProject).getRemoveConfirmation().getValue() != VcsShowConfirmationOption.Value.DO_NOTHING_SILENTLY) {
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          if (!myCvsStorageComponent.getIsActive())           return;
          removeFiles();
        }
      }
,ModalityState.NON_MODAL);
    }
    final int[] myRefreshedParents=new int[]{myDeletedFilesParents.size()};
    for (    final VirtualFile myDeletedFilesParent : myDeletedFilesParents) {
      myDeletedFilesParent.refresh(true,true,new Runnable(){
        public void run(){
          myRefreshedParents[0]++;
          if (myRefreshedParents[0] == myDeletedFilesParents.size()) {
            if (showWarning) {
              ApplicationManager.getApplication().invokeLater(new Runnable(){
                public void run(){
                  if (!myCvsStorageComponent.getIsActive())                   return;
                  if (CvsApplicationLevelConfiguration.getInstance().SHOW_RESTORE_DIRECTORIES_CONFIRMATION) {
                    new RestoreDirectoriesConfirmationDialog().show();
                  }
                }
              }
);
            }
          }
        }
      }
);
    }
  }
 catch (  final IOException e) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        Messages.showMessageDialog(CvsBundle.message("message.error.cannot.restore.cvs.admin.directories",e.getLocalizedMessage()),CvsBundle.message("message.error.cannot.restore.cvs.admin.directories.title"),Messages.getErrorIcon());
      }
    }
);
  }
}
