{
  final String moduleName=getModuleName();
  if (moduleName.length() == 0) {
    Messages.showErrorDialog(myNamePathComponent.getNameComponent(),IdeBundle.message("prompt.please.specify.module.name"),IdeBundle.message("title.module.name.not.specified"));
    return false;
  }
  if (isAlreadyExists(moduleName)) {
    Messages.showErrorDialog(IdeBundle.message("error.module.with.name.already.exists",moduleName),IdeBundle.message("title.module.already.exists"));
    return false;
  }
  final String moduleLocation=getModuleFileDirectory();
  if (moduleLocation.length() == 0) {
    Messages.showErrorDialog(myNamePathComponent.getPathComponent(),IdeBundle.message("error.please.specify.module.file.location"),IdeBundle.message("title.module.file.location.not.specified"));
    return false;
  }
  final String contentEntryPath=getContentEntryPath();
  if (contentEntryPath != null) {
    Module[] modules=myModulesProvider.getModules();
    for (    final Module module : modules) {
      ModuleRootModel rootModel=myModulesProvider.getRootModel(module);
      LOG.assertTrue(rootModel != null);
      final VirtualFile[] moduleContentRoots=rootModel.getContentRoots();
      final String moduleContentRoot=contentEntryPath.replace(File.separatorChar,'/');
      for (      final VirtualFile root : moduleContentRoots) {
        if (moduleContentRoot.equals(root.getPath())) {
          Messages.showErrorDialog(myNamePathComponent.getPathComponent(),IdeBundle.message("error.content.root.already.defined.for.module",contentEntryPath,module.getName()),IdeBundle.message("title.module.content.root.already.exists"));
          return false;
        }
      }
    }
    if (!ProjectWizardUtil.createDirectoryIfNotExists(IdeBundle.message("directory.module.content.root"),contentEntryPath,myNamePathComponent.isPathChangedByUser())) {
      return false;
    }
  }
  final String moduleFileDirectory=getModuleFileDirectory();
  return ProjectWizardUtil.createDirectoryIfNotExists(IdeBundle.message("directory.module.file"),moduleFileDirectory,myModuleFileDirectoryChangedByUser);
}
