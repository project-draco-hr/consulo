{
  final String projectId=getProjectId(project);
  final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  final List<String> projectIds=Collections.singletonList(projectId);
  for (  VirtualFile srcRoot : roots) {
    fileIndex.iterateContentUnderDirectory(srcRoot,new ContentIterator(){
      public boolean processFile(      final VirtualFile file){
        if (!file.isDirectory()) {
          if (!isMarkedForRecompilation(projectId,getFileId(file))) {
            final SourceFileInfo srcInfo=loadSourceInfo(file);
            if (srcInfo == null || (srcInfo.getTimestamp(projectId) != file.getTimeStamp())) {
              addSourceForRecompilation(projectIds,file,srcInfo);
            }
          }
        }
        return true;
      }
    }
);
  }
}
