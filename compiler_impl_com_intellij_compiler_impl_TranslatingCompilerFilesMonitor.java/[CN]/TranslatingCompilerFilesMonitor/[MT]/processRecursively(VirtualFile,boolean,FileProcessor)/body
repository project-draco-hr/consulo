{
  if (file.getFileSystem() instanceof LocalFileSystem) {
    if (file.isDirectory()) {
      if (dbOnly) {
        for (        VirtualFile child : ((NewVirtualFile)file).getInDbChildren()) {
          processRecursively(child,true,processor);
        }
      }
 else {
        for (        VirtualFile child : file.getChildren()) {
          processRecursively(child,false,processor);
        }
      }
    }
 else {
      processor.execute(file);
    }
  }
}
