{
  List<TabInfo> visibleInfos=getVisibleInfos();
  final boolean vertical=getTabsPosition() == JBTabsPosition.left || getTabsPosition() == JBTabsPosition.right;
  Insets insets=getTabsBorder().getEffectiveBorder();
  int maxOffset=0;
  int maxLength=0;
  for (int i=visibleInfos.size() - 1; i >= 0; i--) {
    TabInfo visibleInfo=visibleInfos.get(i);
    TabLabel tabLabel=myInfo2Label.get(visibleInfo);
    Rectangle r=tabLabel.getBounds();
    if (r.width == 0 || r.height == 0)     continue;
    maxOffset=vertical ? r.y + r.height : r.x + r.width;
    maxLength=vertical ? r.width : r.height;
    break;
  }
  maxOffset++;
  Rectangle r2=getBounds();
  Rectangle rectangle;
  if (vertical) {
    rectangle=new Rectangle(insets.left,maxOffset,getWidth(),r2.height - maxOffset - insets.top- insets.bottom);
  }
 else {
    int y=r2.y + insets.top;
    int height=maxLength - insets.top - insets.bottom;
    if (getTabsPosition() == JBTabsPosition.bottom) {
      y=r2.height - height - insets.top + getActiveTabUnderlineHeight();
    }
 else {
      height-=getActiveTabUnderlineHeight();
    }
    rectangle=new Rectangle(maxOffset,y,r2.width - maxOffset - insets.left- insets.right,height);
  }
  getPainter().doPaintBackground(g2d,clip,vertical,rectangle);
}
