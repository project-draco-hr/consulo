{
  FileDocumentManager.getInstance().saveAllDocuments();
  ExecutionResult executionResult;
  final boolean shouldAddDefaultActions;
  if (state instanceof JavaCommandLine) {
    patch(((JavaCommandLine)state).getJavaParameters(),state.getRunnerSettings(),true);
    final ProcessProxy proxy=ProcessProxyFactory.getInstance().createCommandLineProxy((JavaCommandLine)state);
    executionResult=state.execute(executor,this);
    if (proxy != null && executionResult != null) {
      proxy.attach(executionResult.getProcessHandler());
    }
    shouldAddDefaultActions=state instanceof JavaCommandLineState && ((JavaCommandLineState)state).shouldAddJavaProgramRunnerActions();
  }
 else {
    executionResult=state.execute(executor,this);
    shouldAddDefaultActions=true;
  }
  if (executionResult == null) {
    return null;
  }
  onProcessStarted(env.getRunnerSettings(),executionResult);
  final RunContentBuilder contentBuilder=new RunContentBuilder(project,this,executor);
  contentBuilder.setExecutionResult(executionResult);
  contentBuilder.setEnvironment(env);
  if (shouldAddDefaultActions) {
    addDefaultActions(contentBuilder);
  }
  RunContentDescriptor runContent=contentBuilder.showRunContent(contentToReuse);
  AnAction[] actions=createActions(contentBuilder.getExecutionResult());
  for (  AnAction action : actions) {
    contentBuilder.addAction(action);
  }
  return runContent;
}
