{
  final EditorColorsManager editorColorsManager=EditorColorsManager.getInstance();
  if (editorColorsManager.getGlobalScheme() instanceof DefaultColorsScheme) {
    final int res=Messages.showOkCancelDialog(myPanel,InspectionsBundle.message("highlight.severity.default.color.scheme.warning"),ApplicationBundle.message("title.cannot.modify.default.scheme"),Messages.getQuestionIcon());
    if (res == DialogWrapper.OK_EXIT_CODE) {
      ShowSettingsUtil.getInstance().editConfigurable(myPanel,ShowSettingsUtil.getInstance().findApplicationConfigurable(ColorAndFontOptions.class));
    }
 else {
      super.doCancelAction();
      return;
    }
  }
  processListValueChanged((MyHighlightInfoTypeWithAtrributesDescription)myOptionsList.getSelectedValue(),true);
  final Collection<HighlightInfoType.HighlightInfoTypeImpl> infoTypes=new HashSet<HighlightInfoType.HighlightInfoTypeImpl>(mySeverityRegistrar.getRegisteredHighlightingInfoTypes());
  Set<HighlightInfoType.HighlightInfoTypeImpl> currentTypes=new HashSet<HighlightInfoType.HighlightInfoTypeImpl>();
  final ListModel listModel=myOptionsList.getModel();
  final List<String> order=new ArrayList<String>();
  for (int i=0; i < listModel.getSize(); i++) {
    final MyHighlightInfoTypeWithAtrributesDescription info=(MyHighlightInfoTypeWithAtrributesDescription)listModel.getElementAt(i);
    order.add(info.getSeverity().myName);
    if (!isDefaultSetting(info.getHighlightInfoType())) {
      currentTypes.add(info.getHighlightInfoType());
      final Color stripeColor=info.getAttributes().getErrorStripeColor();
      mySeverityRegistrar.registerSeverity(info.getHighlightInfoType(),stripeColor != null ? stripeColor : LightColors.YELLOW);
    }
    editorColorsManager.getGlobalScheme().setAttributes(info.getHighlightInfoType().getAttributesKey(),info.getAttributes());
  }
  infoTypes.removeAll(currentTypes);
  for (  HighlightInfoType.HighlightInfoTypeImpl info : infoTypes) {
    mySeverityRegistrar.unregisterSeverity(info.getSeverity(null));
  }
  mySeverityRegistrar.setOrder(order);
  try {
    editorColorsManager.saveAllSchemes();
  }
 catch (  IOException e) {
    LOG.error(e);
  }
  super.doOKAction();
}
