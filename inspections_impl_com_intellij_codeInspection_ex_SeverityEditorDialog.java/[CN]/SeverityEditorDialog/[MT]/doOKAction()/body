{
  final EditorColorsManager editorColorsManager=EditorColorsManager.getInstance();
  final EditorColorsScheme colorsScheme=editorColorsManager.getGlobalScheme();
  if (colorsScheme instanceof DefaultColorsScheme) {
    final int res=Messages.showOkCancelDialog(myPanel,InspectionsBundle.message("highlight.severity.default.color.scheme.warning"),ApplicationBundle.message("title.cannot.modify.default.scheme"),Messages.getQuestionIcon());
    if (res == DialogWrapper.OK_EXIT_CODE) {
      ShowSettingsUtil.getInstance().editConfigurable(myPanel,ShowSettingsUtil.getInstance().findApplicationConfigurable(ColorAndFontOptions.class));
    }
 else {
      super.doOKAction();
      return;
    }
  }
  processListValueChanged((MyHighlightInfoTypeWithAtrributesDescription)myOptionsList.getSelectedValue(),true);
  final Collection<HighlightInfoType.HighlightInfoTypeImpl> infoTypes=new HashSet<HighlightInfoType.HighlightInfoTypeImpl>(SeverityRegistrar.getRegisteredHighlightingInfoTypes());
  Set<HighlightInfoType.HighlightInfoTypeImpl> currentTypes=new HashSet<HighlightInfoType.HighlightInfoTypeImpl>();
  final ListModel listModel=myOptionsList.getModel();
  for (int i=0; i < listModel.getSize(); i++) {
    final MyHighlightInfoTypeWithAtrributesDescription info=(MyHighlightInfoTypeWithAtrributesDescription)listModel.getElementAt(i);
    info.getSeverity().setVal((listModel.getSize() - i + 1) * 100);
    if (!isDefaultSetting(info.getHighlightInfoType())) {
      currentTypes.add(info.getHighlightInfoType());
      final Color stripeColor=info.getAttributes().getErrorStripeColor();
      SeverityRegistrar.registerSeverity(info.getHighlightInfoType(),stripeColor != null ? stripeColor : LightColors.YELLOW);
    }
    colorsScheme.setAttributes(info.getHighlightInfoType().getAttributesKey(),info.getAttributes());
  }
  infoTypes.removeAll(currentTypes);
  for (  HighlightInfoType.HighlightInfoTypeImpl info : infoTypes) {
    SeverityRegistrar.unregisterSeverity(info.getSeverity(null));
  }
  try {
    editorColorsManager.saveAllSchemes();
  }
 catch (  IOException e) {
    LOG.error(e);
  }
  super.doOKAction();
}
