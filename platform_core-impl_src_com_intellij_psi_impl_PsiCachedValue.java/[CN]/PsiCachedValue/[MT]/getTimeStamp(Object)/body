{
  if (dependency instanceof PsiDirectory) {
    return myManager.getModificationTracker().getOutOfCodeBlockModificationCount();
  }
  if (dependency instanceof PsiElement) {
    PsiElement element=(PsiElement)dependency;
    if (!element.isValid())     return -1;
    PsiFile containingFile=element.getContainingFile();
    if (containingFile == null)     return -1;
    return containingFile.getModificationStamp();
  }
  if (dependency == PsiModificationTracker.MODIFICATION_COUNT) {
    return myManager.getModificationTracker().getModificationCount();
  }
  if (dependency == PsiModificationTracker.OUT_OF_CODE_BLOCK_MODIFICATION_COUNT) {
    return myManager.getModificationTracker().getOutOfCodeBlockModificationCount();
  }
  if (dependency == PsiModificationTracker.JAVA_STRUCTURE_MODIFICATION_COUNT) {
    return myManager.getModificationTracker().getJavaStructureModificationCount();
  }
  return super.getTimeStamp(dependency);
}
