{
  final SubTree tree=new SubTree(myWorkingCopyDir);
  checkin();
  final String editedText="s1 edited";
  editFileInCommand(myProject,tree.myS1File,editedText);
  renameFileInCommand(myProject,tree.mySourceDir,"renamed");
  myDirtyScopeManager.markEverythingDirty();
  myChangeListManager.ensureUpToDate(false);
  final Change dirChange=assertRenamedChange(tree.mySourceDir);
  final Change s1Change=assertMovedChange(tree.myS1File);
  final Change s2Change=assertMovedChange(tree.myS2File);
  rollbackIMpl(Arrays.asList(dirChange,s1Change,s2Change),Collections.<Change>emptyList());
}
