{
  final List<VcsException> exceptions=new ArrayList<VcsException>();
  myVcs.createRollbackEnvironment().rollbackMissingFileDeletion(locally,exceptions,RollbackProgressListener.EMPTY);
  Assert.assertTrue(exceptions.isEmpty());
  myDirtyScopeManager.markEverythingDirty();
  myChangeListManager.ensureUpToDate(false);
  final List<LocallyDeletedChange> deletedFiles=((ChangeListManagerImpl)myChangeListManager).getDeletedFiles();
  if (allowed == null || allowed.isEmpty()) {
    Assert.assertTrue(deletedFiles == null || deletedFiles.isEmpty());
  }
  final ArrayList<FilePath> copy=new ArrayList<FilePath>(allowed);
  for (  LocallyDeletedChange file : deletedFiles) {
    copy.remove(file.getPath());
  }
  Assert.assertTrue(copy.isEmpty());
}
