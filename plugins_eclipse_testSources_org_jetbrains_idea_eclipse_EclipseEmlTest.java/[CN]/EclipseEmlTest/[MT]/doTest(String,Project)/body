{
  final String path=project.getBaseDir().getPath() + relativePath;
  final Module module=ApplicationManager.getApplication().runWriteAction(new Computable<Module>(){
    public Module compute(){
      return ModuleManager.getInstance(project).newModule(path + "/" + EclipseProjectFinder.findProjectName(path)+ IdeaXml.IML_EXT,StdModuleTypes.JAVA);
    }
  }
);
  replaceRoot(path,module.getName() + EclipseXml.IDEA_SETTINGS_POSTFIX,project);
  replaceRoot(path,EclipseXml.DOT_CLASSPATH_EXT,project);
  final EclipseClasspathStorageProvider.EclipseClasspathConverter converter=new EclipseClasspathStorageProvider.EclipseClasspathConverter(module);
  final ModifiableRootModel rootModel=ModuleRootManager.getInstance(module).getModifiableModel();
  final Element classpathElement=JDOMUtil.loadDocument(new String(FileUtil.loadFileText(new File(path,EclipseXml.DOT_CLASSPATH_EXT)))).getRootElement();
  converter.getClasspath(rootModel,classpathElement);
  final Element root=new Element("component");
  IdeaSpecificSettings.writeIDEASpecificClasspath(root,rootModel);
  rootModel.dispose();
  final String resulted=new String(JDOMUtil.printDocument(new Document(root),"\n"));
  final File emlFile=new File(path,module.getName() + EclipseXml.IDEA_SETTINGS_POSTFIX);
  Assert.assertTrue(resulted.replaceAll(StringUtil.escapeToRegexp(module.getProject().getBaseDir().getPath()),"\\$ROOT\\$"),JDOMUtil.areElementsEqual(root,JDOMUtil.loadDocument(new String(FileUtil.loadFileText(emlFile))).getRootElement()));
}
