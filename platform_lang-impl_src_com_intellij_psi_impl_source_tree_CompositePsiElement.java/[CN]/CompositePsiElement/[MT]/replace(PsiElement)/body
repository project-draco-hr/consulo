{
  LOG.assertTrue(getTreeParent() != null);
  CheckUtil.checkWritable(this);
  TreeElement elementCopy=ChangeUtil.copyToElement(newElement);
  getTreeParent().replaceChildInternal(this,elementCopy);
  elementCopy=ChangeUtil.decodeInformation(elementCopy);
  final PsiElement result=SourceTreeToPsiMap.treeElementToPsi(elementCopy);
  invalidate();
  return result;
}
