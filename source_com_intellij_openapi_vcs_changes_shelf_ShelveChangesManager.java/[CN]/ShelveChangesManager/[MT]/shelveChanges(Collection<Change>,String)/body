{
  File patchPath=getPatchPath(commitMessage);
  Writer writer=new OutputStreamWriter(new FileOutputStream(patchPath));
  try {
    PatchBuilder.buildPatch(changes,myProject.getProjectFile().getParent().getPresentableUrl(),writer);
  }
  finally {
    writer.close();
  }
  RollbackChangesDialog.doRollback(myProject,changes,true,false);
  myShelvedChangeListDatas.add(new ShelvedChangeListData(patchPath.toString(),commitMessage));
  notifyStateChanged();
}
