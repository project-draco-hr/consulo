{
  final boolean wasInModel;
  final boolean isInModel;
  final DomFileElementImpl oldElement;
  final DomFileElementImpl<DomElement> fileElement;
synchronized (PsiLock.LOCK) {
    final FileDescriptionCachedValueProvider<DomElement> provider=getOrCreateCachedValueProvider(file);
    oldElement=provider.getOldValue();
    wasInModel=oldElement != null && provider.isInModel();
    provider.changed();
    fileElement=getFileElement(file);
    isInModel=fileElement != null && provider.getFileDescription().getDomModelDependentFiles(changedRoot).contains(file);
    provider.setInModel(isInModel);
  }
  if (oldElement == null || fileElement == null)   return;
  if (!isInModel && wasInModel)   fireEvent(new ElementChangedEvent(oldElement),true);
  if (isInModel && !wasInModel)   fireEvent(new ElementChangedEvent(fileElement),true);
}
