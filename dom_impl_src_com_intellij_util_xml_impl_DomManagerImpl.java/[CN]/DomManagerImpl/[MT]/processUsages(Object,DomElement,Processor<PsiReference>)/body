{
  final Class elementClass=target.getClass();
  final boolean[] stopped=new boolean[]{false};
  scope.accept(new DomElementVisitor(){
    public void visitGenericDomValue(    GenericDomValue reference){
      final XmlElement xmlElement=reference.getXmlElement();
      if (xmlElement == null)       return;
      final Class parameter=DomUtil.getGenericValueParameter(reference.getDomElementType());
      if (parameter != null && ReflectionCache.isAssignable(parameter,elementClass) && target.equals(reference.getValue())) {
        for (        final PsiReference psiReference : myGenericValueReferenceProvider.createReferences(reference,xmlElement)) {
          if (!processor.process(psiReference)) {
            stopped[0]=true;
            break;
          }
        }
        return;
      }
      visitDomElement(reference);
    }
    public void visitDomElement(    DomElement element){
      if (!stopped[0] && element.getXmlElement() != null) {
        element.acceptChildren(this);
      }
    }
  }
);
}
