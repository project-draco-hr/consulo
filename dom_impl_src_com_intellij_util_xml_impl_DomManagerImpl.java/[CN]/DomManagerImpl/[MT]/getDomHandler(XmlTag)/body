{
  if (tag == null)   return null;
  DomInvocationHandler invocationHandler=getCachedHandler(tag);
  if (invocationHandler != null)   return invocationHandler;
  final XmlTag parentTag=tag.getParentTag();
  if (parentTag == null) {
    final PsiFile psiFile=tag.getContainingFile();
    if (psiFile instanceof XmlFile) {
      final DomRootInvocationHandler handler=getRootInvocationHandler((XmlFile)psiFile);
      return handler != null && handler.getXmlTag() == tag ? handler : null;
    }
    return null;
  }
  DomInvocationHandler parent=getDomHandler(parentTag);
  if (parent == null)   return null;
  final AbstractDomChildrenDescription childDescription=findChildrenDescription(tag,parent);
  if (childDescription == null)   return null;
  for (  DomElement element : childDescription.getValues(parent.getProxy())) {
    DomInvocationHandler handler=getDomInvocationHandler(element);
    if (handler != null && tag.equals(handler.getXmlTag())) {
      return handler;
    }
  }
  return null;
}
