{
  final PsiElement nameElement=descriptor.getPsiElement();
  final PsiElement parent=nameElement.getParent();
  final PsiField field;
  if (parent instanceof PsiField) {
    field=(PsiField)parent;
  }
 else   if (parent instanceof PsiReferenceExpression) {
    final PsiReferenceExpression referenceExpression=(PsiReferenceExpression)parent;
    final PsiElement target=referenceExpression.resolve();
    if (!(target instanceof PsiField)) {
      return;
    }
    field=(PsiField)target;
  }
 else {
    return;
  }
  final JavaRefactoringActionHandlerFactory factory=JavaRefactoringActionHandlerFactory.getInstance();
  final RefactoringActionHandler renameHandler=factory.createEncapsulateFieldsHandler();
  renameHandler.invoke(project,new PsiElement[]{field},null);
}
