{
  PsiElement completeExpression=expression;
  boolean found=false;
  while (true) {
    final PsiElement parent=completeExpression.getParent();
    if (!(parent instanceof PsiReferenceExpression)) {
      break;
    }
    final PsiReferenceExpression referenceExpression=(PsiReferenceExpression)parent;
    final String name=referenceExpression.getReferenceName();
    if (!"append".equals(name)) {
      if (!"toString".equals(name)) {
        return null;
      }
      found=true;
    }
    final PsiElement grandParent=parent.getParent();
    if (!(grandParent instanceof PsiMethodCallExpression)) {
      break;
    }
    completeExpression=grandParent;
    if (found) {
      return (PsiExpression)completeExpression;
    }
  }
  return null;
}
