{
  int offsetInElement=offset - insertedElement.getTextRange().getStartOffset();
  final PsiReference ref=insertedElement.getContainingFile().findReferenceAt(insertedElement.getTextRange().getStartOffset() + offsetInElement);
  if (ref instanceof PsiJavaCodeReferenceElement) {
    final PsiElement name=((PsiJavaCodeReferenceElement)ref).getReferenceNameElement();
    if (name != null) {
      offsetInElement=offset - name.getTextRange().getStartOffset();
      return name.getText().substring(0,offsetInElement);
    }
    return "";
  }
 else   if (ref != null) {
    offsetInElement=offset - ref.getElement().getTextRange().getStartOffset();
    String result=ref.getElement().getText().substring(ref.getRangeInElement().getStartOffset(),offsetInElement);
    if (result.indexOf('(') > 0) {
      result=result.substring(0,result.indexOf('('));
    }
    if (ref.getElement() instanceof PsiNameValuePair && StringUtil.startsWithChar(result,'{')) {
      result=result.substring(1);
    }
    return result;
  }
  return null;
}
