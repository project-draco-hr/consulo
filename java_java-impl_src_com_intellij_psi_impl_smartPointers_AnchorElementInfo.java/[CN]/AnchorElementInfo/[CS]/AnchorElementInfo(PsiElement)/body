{
  LOG.assertTrue(anchor.isPhysical());
  LOG.assertTrue(anchor.isValid());
  myFile=anchor.getContainingFile();
  myProject=myFile.getProject();
  TextRange range=anchor.getTextRange();
  final PsiDocumentManager documentManager=PsiDocumentManager.getInstance(myProject);
  Document document=documentManager.getDocument(myFile);
  LOG.assertTrue(!documentManager.isUncommited(document));
  if (myFile.getTextLength() != document.getTextLength()) {
    final String docText=document.getText();
    myFile.accept(new PsiRecursiveElementWalkingVisitor(){
      @Override public void visitElement(      PsiElement element){
        super.visitElement(element);
        TextRange elementRange=element.getTextRange();
        final String rangeText=docText.length() <= elementRange.getEndOffset() ? "(IOOBE: " + docText.length() + " is out of "+ elementRange+ ")" : elementRange.substring(docText);
        final String elemText=element.getText();
        if (!rangeText.equals(elemText)) {
          throw new AssertionError("PSI text doesn't equal to the document's one: element" + element + "\ndocText="+ rangeText+ "\npsiText"+ elemText);
        }
      }
    }
);
    LOG.error("File=" + myFile);
  }
  myMarker=document.createRangeMarker(range.getStartOffset(),range.getEndOffset(),true);
  mySyncStartOffset=range.getStartOffset();
  mySyncEndOffset=range.getEndOffset();
  mySyncMarkerIsValid=true;
}
