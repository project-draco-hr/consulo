{
  if (myAfterIteratingElements != null) {
    throw new RuntimeException("Nested iterations aren't supported");
  }
  try {
    myAfterIteratingElements=new ArrayList<T>();
    for (Iterator<T> iterator=myElements.iterator(); iterator.hasNext(); ) {
      T rangeMarker=iterator.next();
      if (rangeMarker == null)       continue;
      innerIterator.process(rangeMarker,iterator);
    }
  }
  finally {
synchronized (this) {
      for (Iterator<T> iterator=myAfterIteratingElements.iterator(); iterator.hasNext(); ) {
        T rangeMarker=iterator.next();
        myElements.add(rangeMarker);
      }
      myAfterIteratingElements=null;
    }
  }
}
