{
  new WriteCommandAction.Simple(getProject()){
    @Override protected void run() throws Throwable {
      VirtualFile newDir=myModule1Dir.getParent().createChildDirectory(DirectoryIndexTest.this,"newDir");
      newDir.createChildDirectory(DirectoryIndexTest.this,"subdir");
      myIndex.checkConsistency();
      PsiTestUtil.addContentRoot(myModule,newDir);
    }
  }
.execute().throwException();
  myIndex.checkConsistency();
}
