{
  final TextDiffTypeEnum diffTypeEnum=fragment.getType();
  if (diffTypeEnum == null)   return;
  TextDiffType type=TextDiffType.create(diffTypeEnum);
  if (type == null)   return;
  TextRange range=fragment.getRange(getSide());
  TextAttributes attributes=type.getTextAttributes(getEditor());
  if (!drawBorder && range.getLength() == 0)   return;
  RangeHighlighter rangeMarker;
  if (drawBorder && range.getLength() == 0) {
    TextAttributes textAttributes=new TextAttributes(null,null,attributes.getBackgroundColor(),EffectType.BOXED,Font.PLAIN);
    rangeMarker=getMarkupModel().addRangeHighlighter(range.getStartOffset(),range.getStartOffset(),LAYER,textAttributes,HighlighterTargetArea.EXACT_RANGE);
  }
 else {
    rangeMarker=getMarkupModel().addRangeHighlighter(range.getStartOffset(),range.getEndOffset(),LAYER,attributes,HighlighterTargetArea.EXACT_RANGE);
  }
  Color stripeBarColor=attributes.getErrorStripeColor();
  if (stripeBarColor != null)   rangeMarker.setErrorStripeMarkColor(stripeBarColor);
  saveHighlighter(rangeMarker);
}
