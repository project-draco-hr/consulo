{
  final Condition<AnAction> wrappedFilter=wrapFilter(filtered,keymap,ActionManager.getInstance());
  Group mainGroup=new Group(KeyMapBundle.message("all.actions.group.title"),null,null);
  mainGroup.addGroup(createEditorActionsGroup(wrappedFilter));
  mainGroup.addGroup(createMainMenuGroup(wrappedFilter));
  for (  KeymapExtension extension : Extensions.getExtensions(KeymapExtension.EXTENSION_POINT_NAME)) {
    final Group group=createExtensionGroup(wrappedFilter,project,extension);
    if (group != null) {
      mainGroup.addGroup(group);
    }
  }
  mainGroup.addGroup(createMacrosGroup(wrappedFilter));
  mainGroup.addGroup(createQuickListsGroup(wrappedFilter,filter,forceFiltering,quickLists));
  final Group otherGroup=createOtherGroup(wrappedFilter,mainGroup,keymap);
  mainGroup.addGroup(otherGroup);
  mainGroup.addGroup(createPluginsActionsGroup(wrappedFilter,otherGroup));
  if (!StringUtil.isEmpty(filter) || filtered != null) {
    final ArrayList list=mainGroup.getChildren();
    for (Iterator i=list.iterator(); i.hasNext(); ) {
      final Object o=i.next();
      if (o instanceof Group) {
        final Group group=(Group)o;
        if (group.getSize() == 0) {
          if (!SearchUtil.isComponentHighlighted(group.getName(),filter,forceFiltering,null)) {
            i.remove();
          }
        }
      }
    }
  }
  return mainGroup;
}
