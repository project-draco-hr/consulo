{
  final String name=action.getTemplatePresentation().getText();
  if (name != null && !name.isEmpty()) {
    return name;
  }
 else {
    final String id=action instanceof ActionStub ? ((ActionStub)action).getId() : ActionManager.getInstance().getId(action);
    if (id != null) {
      return id;
    }
    if (action instanceof DefaultActionGroup) {
      final DefaultActionGroup group=(DefaultActionGroup)action;
      if (group.getChildrenCount() == 0)       return "Empty group";
      final AnAction[] children=group.getChildActionsOrStubs();
      for (      AnAction child : children) {
        if (!(child instanceof AnSeparator)) {
          return "group." + getName(child);
        }
      }
      return "Empty unnamed group";
    }
    return action.getClass().getName();
  }
}
