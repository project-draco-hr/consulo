{
  Group pluginsGroup=new Group(KeyMapBundle.message("plugins.group.title"),null,null);
  final KeymapManagerEx keymapManager=KeymapManagerEx.getInstanceEx();
  ActionManagerEx managerEx=ActionManagerEx.getInstanceEx();
  final List<IdeaPluginDescriptor> plugins=new ArrayList<IdeaPluginDescriptor>();
  Collections.addAll(plugins,PluginManager.getPlugins());
  Collections.sort(plugins,new Comparator<IdeaPluginDescriptor>(){
    public int compare(    IdeaPluginDescriptor o1,    IdeaPluginDescriptor o2){
      return o1.getName().compareTo(o2.getName());
    }
  }
);
  List<PluginId> collected=new ArrayList<PluginId>();
  for (  IdeaPluginDescriptor plugin : plugins) {
    collected.add(plugin.getPluginId());
    Group pluginGroup;
    if (plugin.getName().equals("IDEA CORE")) {
      continue;
    }
 else {
      pluginGroup=new Group(plugin.getName(),null,null);
    }
    final String[] pluginActions=managerEx.getPluginActions(plugin.getPluginId());
    if (pluginActions == null || pluginActions.length == 0) {
      continue;
    }
    Arrays.sort(pluginActions,new Comparator<String>(){
      public int compare(      String o1,      String o2){
        return getTextToCompare(o1).compareTo(getTextToCompare(o2));
      }
    }
);
    for (    String pluginAction : pluginActions) {
      if (keymapManager.getBoundActions().contains(pluginAction))       continue;
      final AnAction anAction=managerEx.getActionOrStub(pluginAction);
      if (filtered == null || filtered.value(anAction)) {
        pluginGroup.addActionId(pluginAction);
      }
    }
    if (pluginGroup.getSize() > 0) {
      pluginsGroup.addGroup(pluginGroup);
    }
  }
  for (  PluginId pluginId : PluginId.getRegisteredIds().values()) {
    if (collected.contains(pluginId))     continue;
    Group pluginGroup=new Group(pluginId.getIdString(),null,null);
    final String[] pluginActions=managerEx.getPluginActions(pluginId);
    if (pluginActions == null || pluginActions.length == 0) {
      continue;
    }
    for (    String pluginAction : pluginActions) {
      if (keymapManager.getBoundActions().contains(pluginAction))       continue;
      final AnAction anAction=managerEx.getActionOrStub(pluginAction);
      if (filtered == null || filtered.value(anAction)) {
        pluginGroup.addActionId(pluginAction);
      }
    }
    if (pluginGroup.getSize() > 0) {
      pluginsGroup.addGroup(pluginGroup);
    }
  }
  return pluginsGroup;
}
