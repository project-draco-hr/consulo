{
  if (occurences.length == 0)   return null;
  PsiElement candidate;
  if (occurences.length == 1 || !replaceAllOccurences) {
    candidate=expr;
  }
 else {
    sortOccurrences(occurences);
    candidate=occurences[0];
  }
  while (candidate != null && !container.equals(candidate.getParent())) {
    candidate=candidate.getParent();
  }
  if (candidate == null) {
    return null;
  }
  if ((container instanceof GrWhileStatement) && candidate.equals(((GrWhileStatement)container).getCondition())) {
    return container;
  }
  if ((container instanceof GrIfStatement) && candidate.equals(((GrIfStatement)container).getCondition())) {
    return container;
  }
  if ((container instanceof GrForStatement) && candidate.equals(((GrForStatement)container).getClause())) {
    return container;
  }
  return candidate;
}
