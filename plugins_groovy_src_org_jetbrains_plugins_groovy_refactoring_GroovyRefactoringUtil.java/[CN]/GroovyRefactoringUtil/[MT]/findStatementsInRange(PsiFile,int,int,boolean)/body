{
  if (!(file instanceof GroovyFileBase))   return PsiElement.EMPTY_ARRAY;
  Language language=GroovyFileType.GROOVY_LANGUAGE;
  PsiElement element1=file.getViewProvider().findElementAt(startOffset,language);
  PsiElement element2=file.getViewProvider().findElementAt(endOffset - 1,language);
  if (element1 instanceof PsiWhiteSpace || isNewLine(element1)) {
    startOffset=element1.getTextRange().getEndOffset();
    element1=file.findElementAt(startOffset);
  }
  if (element2 instanceof PsiWhiteSpace || isNewLine(element2)) {
    endOffset=element2.getTextRange().getStartOffset();
    element2=file.findElementAt(endOffset - 1);
  }
  if (element1 == null || element2 == null)   return PsiElement.EMPTY_ARRAY;
  PsiElement parent=PsiTreeUtil.findCommonParent(element1,element2);
  if (parent == null)   return PsiElement.EMPTY_ARRAY;
  while (true) {
    if (parent instanceof GrCodeBlock)     break;
    if (parent instanceof GroovyFileBase)     break;
    if (parent instanceof GrCaseSection)     break;
    if (parent instanceof GrStatement) {
      parent=parent.getParent();
      break;
    }
    if (parent == null)     return PsiElement.EMPTY_ARRAY;
    final PsiElement prev=parent;
    parent=parent.getParent();
    if (parent instanceof GrCodeBlock && prev instanceof LeafPsiElement) {
      parent=parent.getParent();
    }
  }
  if (!parent.equals(element1)) {
    while (!parent.equals(element1.getParent())) {
      element1=element1.getParent();
    }
  }
  if (startOffset != element1.getTextRange().getStartOffset() && strict)   return PsiElement.EMPTY_ARRAY;
  if (!parent.equals(element2)) {
    while (!parent.equals(element2.getParent())) {
      element2=element2.getParent();
    }
  }
  if (endOffset != element2.getTextRange().getEndOffset() && strict)   return PsiElement.EMPTY_ARRAY;
  if (parent instanceof GrCodeBlock && parent.getParent() instanceof GrBlockStatement && element1 == ((GrCodeBlock)parent).getLBrace() && element2 == ((GrCodeBlock)parent).getRBrace()) {
    return new PsiElement[]{parent.getParent()};
  }
  PsiElement[] children=PsiElement.EMPTY_ARRAY;
  PsiElement psiChild=parent.getFirstChild();
  if (psiChild != null) {
    List<PsiElement> result=new ArrayList<PsiElement>();
    while (psiChild != null) {
      result.add(psiChild);
      psiChild=psiChild.getNextSibling();
    }
    children=PsiUtilCore.toPsiElementArray(result);
  }
  ArrayList<PsiElement> possibleStatements=new ArrayList<PsiElement>();
  boolean flag=false;
  for (  PsiElement child : children) {
    if (child == element1) {
      flag=true;
    }
    if (flag) {
      possibleStatements.add(child);
    }
    if (child == element2) {
      break;
    }
  }
  for (  PsiElement element : possibleStatements) {
    if (!(element instanceof GrStatement || element instanceof PsiWhiteSpace || element instanceof PsiComment|| TokenSets.SEPARATORS.contains(element.getNode().getElementType()))) {
      return PsiElement.EMPTY_ARRAY;
    }
  }
  return PsiUtilCore.toPsiElementArray(possibleStatements);
}
