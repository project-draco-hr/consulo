{
  final InspectionResultsView invoker=getInvoker(e);
  if (invoker == null)   return new RefElement[0];
  List<RefEntity> selection=new ArrayList<RefEntity>(Arrays.asList(invoker.getTree().getSelectedElements()));
  PsiDocumentManager.getInstance(invoker.getProject()).commitAllDocuments();
  Collections.sort(selection,new Comparator<RefEntity>(){
    @Override public int compare(    RefEntity o1,    RefEntity o2){
      if (o1 instanceof RefElement && o2 instanceof RefElement) {
        RefElement r1=(RefElement)o1;
        RefElement r2=(RefElement)o2;
        final PsiElement element1=r1.getElement();
        final PsiElement element2=r2.getElement();
        final PsiFile containingFile1=element1.getContainingFile();
        final PsiFile containingFile2=element2.getContainingFile();
        if (containingFile1 == containingFile2) {
          int i1=element1.getTextOffset();
          int i2=element2.getTextOffset();
          if (i1 < i2) {
            return 1;
          }
 else           if (i1 > i2) {
            return -1;
          }
          return 0;
        }
        return containingFile1.getName().compareTo(containingFile2.getName());
      }
      if (o1 instanceof RefElement) {
        return 1;
      }
      if (o2 instanceof RefElement) {
        return -1;
      }
      return o1.getName().compareTo(o2.getName());
    }
  }
);
  return selection.toArray(new RefElement[selection.size()]);
}
