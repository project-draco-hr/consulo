{
  final FormatProcessor processor=new FormatProcessor(model,block,settings,indentOptions,affectedRange);
  WhiteSpace whiteSpace=processor.getWhiteSpaceBefore(affectedRange.getStartOffset());
  if (!mayChangeLineFeeds) {
    whiteSpace.setLineFeedsAreReadOnly();
  }
  processor.setAllWhiteSpacesAreReadOnly();
  whiteSpace.setReadOnly(false);
  processor.formatWithoutRealModifications();
  return new IndentInfo(whiteSpace.getLineFeeds(),whiteSpace.getIndentOffset(),whiteSpace.getSpaces());
}
