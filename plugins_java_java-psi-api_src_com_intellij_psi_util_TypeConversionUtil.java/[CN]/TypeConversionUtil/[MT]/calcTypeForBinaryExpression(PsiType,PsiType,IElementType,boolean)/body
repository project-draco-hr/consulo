{
  if (sign == JavaTokenType.PLUS) {
    if (rType == null)     return null;
    if (rType.equalsToText("java.lang.String")) {
      return rType;
    }
    if (!accessLType)     return NULL_TYPE;
    if (lType == null)     return null;
    if (lType.equalsToText("java.lang.String")) {
      return lType;
    }
    return unboxAndBalanceTypes(lType,rType);
  }
  if (sign == JavaTokenType.MINUS || sign == JavaTokenType.ASTERISK || sign == JavaTokenType.DIV || sign == JavaTokenType.PERC) {
    if (rType == null)     return null;
    if (!accessLType)     return NULL_TYPE;
    if (lType == null)     return null;
    return unboxAndBalanceTypes(lType,rType);
  }
  if (sign == JavaTokenType.LTLT || sign == JavaTokenType.GTGT || sign == JavaTokenType.GTGTGT) {
    if (!accessLType)     return NULL_TYPE;
    if (PsiType.BYTE.equals(lType) || PsiType.CHAR.equals(lType) || PsiType.SHORT.equals(lType)) {
      return PsiType.INT;
    }
    if (lType instanceof PsiClassType)     lType=PsiPrimitiveType.getUnboxedType(lType);
    return lType;
  }
  if (sign == JavaTokenType.EQEQ || sign == JavaTokenType.NE || sign == JavaTokenType.LT || sign == JavaTokenType.GT || sign == JavaTokenType.LE || sign == JavaTokenType.GE || sign == JavaTokenType.OROR || sign == JavaTokenType.ANDAND) {
    return PsiType.BOOLEAN;
  }
  if (sign == JavaTokenType.OR || sign == JavaTokenType.XOR || sign == JavaTokenType.AND) {
    if (rType instanceof PsiClassType)     rType=PsiPrimitiveType.getUnboxedType(rType);
    if (lType instanceof PsiClassType)     lType=PsiPrimitiveType.getUnboxedType(lType);
    if (rType == null)     return null;
    if (PsiType.BOOLEAN.equals(rType))     return PsiType.BOOLEAN;
    if (!accessLType)     return NULL_TYPE;
    if (lType == null)     return null;
    if (PsiType.BOOLEAN.equals(lType))     return PsiType.BOOLEAN;
    if (PsiType.LONG.equals(lType) || PsiType.LONG.equals(rType))     return PsiType.LONG;
    return PsiType.INT;
  }
  LOG.error("Unknown token: " + sign);
  return null;
}
