{
  VirtualFile gitDir=repository.getGitDir();
  myWatchRequest=LocalFileSystem.getInstance().addRootToWatch(gitDir.getPath(),true);
  myRepositoryFiles=GitRepositoryFiles.getInstance(gitDir);
  visitGitDirVfs(gitDir);
  myHeadsDir=VcsUtil.getVirtualFile(myRepositoryFiles.getRefsHeadsPath());
  myRemotesDir=VcsUtil.getVirtualFile(myRepositoryFiles.getRefsRemotesPath());
  myUpdateQueue=new QueueProcessor<GitRepository.TrackedTopic>(new Updater(repository),repository.getProject().getDisposed());
  myMessageBusConnection=repository.getProject().getMessageBus().connect();
  myMessageBusConnection.subscribe(VirtualFileManager.VFS_CHANGES,this);
}
