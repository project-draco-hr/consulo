def _findtool(ui, tool):
    if (tool in _internal):
        return tool
    k = _toolstr(ui, tool, 'regkey')
    if k:
        p = util.lookup_reg(k, _toolstr(ui, tool, 'regname'))
        if p:
            p = util.find_exe((p + _toolstr(ui, tool, 'regappend')))
            if p:
                return p
    return util.find_exe(_toolstr(ui, tool, 'executable', tool))
