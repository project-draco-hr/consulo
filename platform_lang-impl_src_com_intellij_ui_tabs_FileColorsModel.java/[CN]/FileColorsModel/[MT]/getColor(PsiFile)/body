{
  if (!psiFile.isValid()) {
    return null;
  }
  final FileColorConfiguration configuration=findConfiguration(psiFile);
  if (configuration != null && configuration.isValid(psiFile.getProject())) {
    return configuration.getColorName();
  }
  if (FileColorManager.getInstance(myProject).isHighlightNonProjectFiles() && !isFileUnderProject(psiFile.getVirtualFile())) {
    return FileColorManager.OUT_OF_PROJECT_SCOPE_COLOR;
  }
  return null;
}
