{
  final EditorWithProviderComposite oldEditor=myCurrentSelectedEditor;
  final EditorWithProviderComposite newEditor=window != null ? window.getSelectedEditor() : null;
  try {
    getManager().fireSelectionChanged(oldEditor,newEditor);
  }
  finally {
    myCurrentWindow=window;
    myCurrentSelectedEditor=newEditor;
  }
  getManager().updateFileName(window == null ? null : window.getSelectedFile());
  if (window != null) {
    final EditorWithProviderComposite selectedEditor=myCurrentWindow.getSelectedEditor();
    if (selectedEditor != null) {
      final boolean focusEditor=ToolWindowManager.getInstance(myManager.myProject).isEditorComponentActive() && !window.getManager().isFocusingBlocked();
      if (focusEditor || requestFocus) {
        selectedEditor.getComponent().requestFocus();
      }
    }
  }
}
