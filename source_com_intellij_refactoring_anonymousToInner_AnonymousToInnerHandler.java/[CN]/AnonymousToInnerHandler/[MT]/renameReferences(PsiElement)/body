{
  PsiSearchHelper helper=myManager.getSearchHelper();
  PsiElementFactory factory=myManager.getElementFactory();
  for (  VariableInfo info : myVariableInfos) {
    PsiReference[] references=helper.findReferences(info.variable,new LocalSearchScope(scope),false);
    if (references.length > 0) {
      for (      PsiReference reference : references) {
        PsiElement ref=reference.getElement();
        PsiIdentifier identifier=(PsiIdentifier)((PsiJavaCodeReferenceElement)ref).getReferenceNameElement();
        boolean renameToFieldName=!isUsedInInitializer(ref);
        PsiIdentifier newNameIdentifier=factory.createIdentifier(renameToFieldName ? info.fieldName : info.parameterName);
        if (renameToFieldName) {
          identifier.replace(newNameIdentifier);
        }
 else {
          if (info.passAsParameter) {
            identifier.replace(newNameIdentifier);
          }
        }
      }
    }
  }
}
