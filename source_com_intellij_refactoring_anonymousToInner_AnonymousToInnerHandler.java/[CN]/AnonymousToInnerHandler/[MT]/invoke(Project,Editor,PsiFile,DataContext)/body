{
  if (!file.isWritable()) {
    RefactoringMessageUtil.showReadOnlyElementRefactoringMessage(project,file);
    return;
  }
  final int offset=editor.getCaretModel().getOffset();
  editor.getScrollingModel().scrollToCaret(ScrollType.MAKE_VISIBLE);
  final PsiAnonymousClass anonymousClass=findAnonymousClass(file,offset);
  if (anonymousClass == null) {
    RefactoringMessageUtil.showErrorMessage(REFACTORING_NAME,"Cannot perform the refactoring.\nThe caret should be positioned inside the anonymous class.",HelpID.ANONYMOUS_TO_INNER,project);
    return;
  }
  invoke(project,anonymousClass);
}
