{
  if (scope instanceof PsiReferenceExpression) {
    PsiReferenceExpression refExpr=(PsiReferenceExpression)scope;
    if (refExpr.getQualifierExpression() == null) {
      PsiElement refElement=refExpr.resolve();
      if (refElement instanceof PsiVariable) {
        PsiVariable var=(PsiVariable)refElement;
        PsiElement parent=var.getParent();
        while (true) {
          if (parent instanceof PsiFile)           break;
          if (myAnonClass.equals(parent))           break;
          if (myTargetClass.equals(parent.getParent())) {
            saveVariable(variableInfoMap,variableInfoVector,var,refExpr);
            break;
          }
          parent=parent.getParent();
        }
      }
    }
  }
  PsiElement[] children=scope.getChildren();
  for (int idx=0; idx < children.length; idx++) {
    collectUsedVariables(variableInfoMap,variableInfoVector,children[idx]);
  }
}
