{
  if (PROXY_AUTHENTICATION && KEEP_PROXY_PASSWORD) {
    return new PasswordAuthentication(PROXY_LOGIN,getPlainProxyPassword().toCharArray());
  }
  final PasswordAuthentication[] value=new PasswordAuthentication[1];
  final Runnable runnable=new Runnable(){
    public void run(){
      final AuthenticationDialog dlg=new AuthenticationDialog(host,prompt,"","",KEEP_PROXY_PASSWORD);
      dlg.show();
      if (dlg.getExitCode() == DialogWrapper.OK_EXIT_CODE) {
        final AuthenticationPanel panel=dlg.getPanel();
        KEEP_PROXY_PASSWORD=panel.isRememberPassword();
        PROXY_LOGIN=panel.getLogin();
        setPlainProxyPassword(String.valueOf(panel.getPassword()));
        value[0]=new PasswordAuthentication(panel.getLogin(),panel.getPassword());
      }
    }
  }
;
  WaitForProgressToShow.runOrInvokeAndWaitAboveProgress(runnable,ModalityState.any());
  return value[0];
}
