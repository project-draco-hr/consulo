{
  ProgressIndicator progressIndicator=ProgressManager.getInstance().getProgressIndicator();
  if (progressIndicator != null && progressIndicator.isModal()) {
    WaitForProgressToShow.runOrInvokeAndWaitAboveProgress(runnable);
  }
 else {
    Application app=ApplicationManager.getApplication();
    if (app.isDispatchThread()) {
      runnable.run();
    }
 else {
      app.invokeAndWait(runnable,ModalityState.any());
    }
  }
}
