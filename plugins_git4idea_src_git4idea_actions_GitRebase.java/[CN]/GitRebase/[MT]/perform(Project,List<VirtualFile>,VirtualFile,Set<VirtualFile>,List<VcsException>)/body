{
  GitRebaseDialog dialog=new GitRebaseDialog(project,gitRoots,defaultRoot);
  dialog.show();
  if (!dialog.isOK()) {
    return;
  }
  GitLineHandler h=dialog.handler();
  GitRebaseEditorService service=GitRebaseEditorService.getInstance();
  GitRebaseEditorHandler editor=service.getHandler(project,dialog.gitRoot());
  affectedRoots.add(dialog.gitRoot());
  try {
    String editorPath=service.getScriptPath().getPath();
    if (SystemInfo.isWindows) {
      editorPath=editorPath.replace('\\','/');
    }
    h.setenv(GitHandler.GIT_EDITOR_ENV,editorPath);
    h.setenv(GitRebaseEditorMain.IDEA_REBASE_HANDER_NO,Integer.toString(editor.getHandlerNo()));
    GitHandlerUtil.doSynchronously(h,GitBundle.getString("rebasing.title"),h.printableCommandLine());
  }
  finally {
    editor.close();
  }
}
