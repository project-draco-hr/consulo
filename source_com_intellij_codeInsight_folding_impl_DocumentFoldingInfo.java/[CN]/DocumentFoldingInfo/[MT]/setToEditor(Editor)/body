{
  for (int i=0; i < mySmartPointersOrRangeMarkers.size(); i++) {
    Object o=mySmartPointersOrRangeMarkers.get(i);
    if (o instanceof SmartPsiElementPointer) {
      SmartPsiElementPointer pointer=(SmartPsiElementPointer)o;
      PsiElement element=pointer.getElement();
      if (element == null || element.getManager().isDisposed())       continue;
      FoldRegion region=FoldingUtil.findFoldRegion(editor,element);
      if (region != null) {
        boolean state=myExpandedStates.get(i).booleanValue();
        region.setExpanded(state);
      }
    }
 else     if (o instanceof RangeMarker) {
      RangeMarker marker=(RangeMarker)o;
      if (!marker.isValid())       continue;
      FoldRegion region=FoldingUtil.findFoldRegion(editor,marker.getStartOffset(),marker.getEndOffset());
      if (region == null) {
        String placeHolderText=myPlaceholderTexts.get(marker);
        region=editor.getFoldingModel().addFoldRegion(marker.getStartOffset(),marker.getEndOffset(),placeHolderText);
      }
      if (region != null) {
        boolean state=myExpandedStates.get(i).booleanValue();
        region.setExpanded(state);
      }
    }
 else {
      LOG.error("o = " + o);
    }
  }
}
