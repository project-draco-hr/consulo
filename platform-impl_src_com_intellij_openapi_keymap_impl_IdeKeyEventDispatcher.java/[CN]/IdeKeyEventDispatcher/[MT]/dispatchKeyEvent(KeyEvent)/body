{
  if (myDisposed)   return false;
  if (e.isConsumed()) {
    return false;
  }
  if (e.getKeyCode() == KeyEvent.VK_CONTROL) {
    if (e.getID() == KeyEvent.KEY_PRESSED) {
      myLeftCtrlPressed=(e.getKeyLocation() == KeyEvent.KEY_LOCATION_LEFT);
    }
 else     if (e.getID() == KeyEvent.KEY_RELEASED) {
      myLeftCtrlPressed=false;
    }
  }
 else   if (e.getKeyCode() == KeyEvent.VK_ALT) {
    if (e.getID() == KeyEvent.KEY_PRESSED) {
      myRightAltPressed=(e.getKeyLocation() == KeyEvent.KEY_LOCATION_RIGHT);
    }
 else     if (e.getID() == KeyEvent.KEY_RELEASED) {
      myRightAltPressed=false;
    }
  }
  KeyboardFocusManager focusManager=KeyboardFocusManager.getCurrentKeyboardFocusManager();
  Component focusOwner=focusManager.getFocusOwner();
  if (focusOwner instanceof ShortcutTextField) {
    return false;
  }
  MenuSelectionManager menuSelectionManager=MenuSelectionManager.defaultManager();
  MenuElement[] selectedPath=menuSelectionManager.getSelectedPath();
  if (selectedPath.length > 0) {
    if (!(selectedPath[0] instanceof ComboPopup)) {
      myState=STATE_PROCESSED;
      myPressedWasProcessed=true;
      return false;
    }
  }
  Window focusedWindow=focusManager.getFocusedWindow();
  boolean isModalContext=focusedWindow != null && isModalContext(focusedWindow);
  final DataManager dataManager=DataManager.getInstance();
  if (dataManager == null)   return false;
  DataContext dataContext=dataManager.getDataContext();
  if (myState == STATE_INIT) {
    return inInitState(focusOwner,e,isModalContext,dataContext);
  }
 else   if (myState == STATE_PROCESSED) {
    return inProcessedState(focusOwner,e,isModalContext,dataContext);
  }
 else   if (myState == STATE_WAIT_FOR_SECOND_KEYSTROKE) {
    return inWaitForSecondStrokeState(e,isModalContext,dataContext);
  }
 else   if (myState == STATE_SECOND_STROKE_IN_PROGRESS) {
    return inSecondStrokeInProgressState(e,isModalContext,dataContext);
  }
 else {
    throw new IllegalStateException("state = " + myState);
  }
}
