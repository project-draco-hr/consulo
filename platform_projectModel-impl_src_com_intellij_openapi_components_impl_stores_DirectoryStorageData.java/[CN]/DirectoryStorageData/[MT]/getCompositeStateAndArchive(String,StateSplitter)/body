{
  StateMap fileToState=myStates.get(componentName);
  Element state=new Element(StorageData.COMPONENT);
  if (fileToState == null || fileToState.isEmpty()) {
    return state;
  }
  if (splitter instanceof StateSplitterEx) {
    StateSplitterEx splitterEx=(StateSplitterEx)splitter;
    for (    String fileName : fileToState.keys()) {
      Element subState=fileToState.getStateAndArchive(fileName);
      if (subState == null) {
        return null;
      }
      splitterEx.mergeStateInto(state,subState);
    }
  }
 else {
    List<Element> subElements=new SmartList<Element>();
    for (    String fileName : fileToState.keys()) {
      Element subState=fileToState.getStateAndArchive(fileName);
      if (subState == null) {
        return null;
      }
      subElements.add(subState);
    }
    if (!subElements.isEmpty()) {
      splitter.mergeStatesInto(state,subElements.toArray(new Element[subElements.size()]));
    }
  }
  return state;
}
