{
  myTrafficLightRenderer=(TrafficLightRenderer)((EditorMarkupModelImpl)editor.getMarkupModel()).getErrorStripeRenderer();
  myPanel=new TrafficProgressPanel(myTrafficLightRenderer,editor);
  LineTooltipRenderer.correctLocation(editor,myPanel,p,alignToRight,false,-1);
  LightweightHint hint=new LightweightHint(myPanel){
    @Override public void hide(){
      if (myPanel == null)       return;
      super.hide();
      myPanel=null;
      onHide.run();
    }
  }
;
  HintManagerImpl hintManager=(HintManagerImpl)HintManager.getInstance();
  hintManager.showEditorHint(hint,editor,p,HintManager.HIDE_BY_ANY_KEY | HintManager.HIDE_BY_TEXT_CHANGE | HintManager.HIDE_BY_OTHER_HINT| HintManager.HIDE_BY_SCROLLING,0,false);
  repaintTooltipWindow();
  return hint;
}
