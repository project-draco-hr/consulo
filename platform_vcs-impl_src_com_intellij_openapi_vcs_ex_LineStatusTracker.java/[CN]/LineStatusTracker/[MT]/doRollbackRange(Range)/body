{
  if (range.getType() == Range.MODIFIED) {
    TextRange currentTextRange=getCurrentTextRange(range);
    int offset1=currentTextRange.getStartOffset();
    int offset2=currentTextRange.getEndOffset();
    CharSequence vcsContent=getVcsContent(range);
    myDocument.replaceString(offset1,offset2,vcsContent);
  }
 else   if (range.getType() == Range.INSERTED) {
    TextRange currentTextRange=getCurrentTextRange(range);
    int offset1=currentTextRange.getStartOffset();
    int offset2=currentTextRange.getEndOffset();
    if (offset1 > 0) {
      offset1--;
    }
 else     if (offset2 < myDocument.getTextLength()) {
      offset2++;
    }
    myDocument.deleteString(offset1,offset2);
  }
 else   if (range.getType() == Range.DELETED) {
    CharSequence content=getVcsContent(range);
    if (range.getLine2() == getLineCount(myDocument)) {
      myDocument.insertString(myDocument.getTextLength(),"\n" + content);
    }
 else {
      myDocument.insertString(myDocument.getLineStartOffset(range.getLine2()),content + "\n");
    }
  }
 else {
    throw new IllegalArgumentException("Unknown range type: " + range.getType());
  }
}
