{
  myApplication.assertWriteAccessAllowed();
synchronized (myLock) {
    if (myReleased)     return;
    if (myBulkUpdate || myAnathemaThrown || BaseLoadState.LOADED != myBaseLoaded)     return;
    try {
      myFirstChangedLine=myDocument.getLineNumber(e.getOffset());
      myLastChangedLine=myDocument.getLineNumber(e.getOffset() + e.getOldLength());
      if (StringUtil.endsWithChar(e.getOldFragment(),'\n'))       myLastChangedLine++;
      myLinesBeforeChange=myDocument.getLineNumber(e.getOffset() + e.getOldLength()) - myDocument.getLineNumber(e.getOffset());
      Range firstChangedRange=getLastRangeBeforeLine(myFirstChangedLine);
      if (firstChangedRange == null) {
        myUpToDateFirstLine=myFirstChangedLine;
      }
 else       if (firstChangedRange.containsLine(myFirstChangedLine)) {
        myFirstChangedLine=firstChangedRange.getOffset1();
        myUpToDateFirstLine=firstChangedRange.getUOffset1();
      }
 else {
        myUpToDateFirstLine=firstChangedRange.getUOffset2() + myFirstChangedLine - firstChangedRange.getOffset2();
      }
      Range myLastChangedRange=getLastRangeBeforeLine(myLastChangedLine);
      if (myLastChangedRange == null) {
        myUpToDateLastLine=myLastChangedLine;
      }
 else       if (myLastChangedRange.containsLine(myLastChangedLine)) {
        myUpToDateLastLine=myLastChangedRange.getUOffset2();
        myLastChangedLine=myLastChangedRange.getOffset2();
      }
 else {
        myUpToDateLastLine=myLastChangedRange.getUOffset2() + myLastChangedLine - myLastChangedRange.getOffset2();
      }
    }
 catch (    ProcessCanceledException ignore) {
    }
  }
}
