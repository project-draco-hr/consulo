{
  final Map<Module,MyModuleData> moduleDataMap=new HashMap<Module,MyModuleData>();
  boolean success=true;
  for (  Module module : modules) {
    final AndroidFacet facet=AndroidJpsUtil.getFacet(module);
    if (facet == null) {
      continue;
    }
    final Sdk sdk=module.getSdk();
    if (!(sdk instanceof AndroidSdk)) {
      context.processMessage(new CompilerMessage(BUILDER_NAME,BuildMessage.Kind.ERROR,"Android SDK is not specified for module " + module.getName()));
      success=false;
      continue;
    }
    final AndroidSdk androidSdk=(AndroidSdk)sdk;
    final IAndroidTarget target=AndroidJpsUtil.parseAndroidTarget(androidSdk,context,BUILDER_NAME);
    if (target == null) {
      context.processMessage(new CompilerMessage(BUILDER_NAME,BuildMessage.Kind.ERROR,"Android SDK is invalid or not specified for module " + module.getName()));
      success=false;
      continue;
    }
    final File outputDir=context.getProjectPaths().getModuleOutputDir(module,false);
    if (outputDir == null) {
      context.processMessage(new CompilerMessage(BUILDER_NAME,BuildMessage.Kind.ERROR,"Cannot find output directory for module " + module.getName()));
      success=false;
      continue;
    }
    moduleDataMap.put(module,new MyModuleData(outputDir,androidSdk.getSdkPath(),target,facet));
  }
  return success ? moduleDataMap : null;
}
