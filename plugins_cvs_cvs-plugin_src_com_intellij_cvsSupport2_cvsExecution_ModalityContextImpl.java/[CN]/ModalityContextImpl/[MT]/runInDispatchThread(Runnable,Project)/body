{
  Application application=ApplicationManager.getApplication();
  if (application.isUnitTestMode() || application.isDispatchThread()) {
    action.run();
  }
 else {
    ModalityState modalityState=getCurrentModalityState();
    PeriodicalTasksCloser.getInstance().invokeAndWaitInterruptedWhenClosing(project,action,modalityState);
  }
}
