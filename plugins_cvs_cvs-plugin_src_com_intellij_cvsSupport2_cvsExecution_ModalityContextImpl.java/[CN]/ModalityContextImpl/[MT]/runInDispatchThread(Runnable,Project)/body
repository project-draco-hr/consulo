{
  Application application=ApplicationManager.getApplication();
  if (application.isUnitTestMode() || application.isDispatchThread()) {
    action.run();
  }
 else {
    ModalityState modalityState=getCurrentModalityState();
    WaitForProgressToShow.runOrInvokeLaterAboveProgress(action,modalityState,project);
  }
}
