{
  final String name=getTestName(false);
  final PsiBuilder builder=getJavaBuilder(text);
  final PsiBuilder.Marker root=builder.mark();
  parser.parse(builder);
  if (builder.getTokenType() != null) {
    final PsiBuilder.Marker unparsed=builder.mark();
    while (builder.getTokenType() != null)     builder.advanceLexer();
    unparsed.error("Unparsed tokens");
  }
  root.done(JavaElementType.JAVA_FILE);
  final String raw=DebugUtil.treeToString(builder.getTreeBuilt(),false);
  final String tree=raw.replaceFirst("com.intellij.psi.util.PsiUtilBase\\S+","PsiJavaFile:" + name + ".java");
  try {
    checkResult(name + ".txt",tree);
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
