{
  if (TEST_FILE_ELEMENT_TYPE == null) {
    TEST_FILE_ELEMENT_TYPE=new IFileElementType("test.java.file",StdLanguages.JAVA){
      @Override public ASTNode parseContents(      final ASTNode chameleon){
        final PsiBuilder builder=createBuilder(chameleon);
        final PsiBuilder.Marker root=builder.mark();
        TEST_PARSER.parse(builder);
        if (!builder.eof()) {
          final PsiBuilder.Marker unparsed=builder.mark();
          while (!builder.eof())           builder.advanceLexer();
          unparsed.error("Unparsed tokens");
        }
        root.done(this);
        final ASTNode rootNode=builder.getTreeBuilt();
        ParseUtil.bindComments(rootNode);
        return rootNode.getFirstChildNode();
      }
    }
;
  }
  TEST_PARSER=parser;
  final LightVirtualFile virtualFile=new LightVirtualFile(name + '.' + myFileExt,StdFileTypes.JAVA,text,-1);
  final FileViewProvider viewProvider=new SingleRootFileViewProvider(PsiManager.getInstance(getProject()),virtualFile,true);
  return new PsiJavaFileImpl(viewProvider){
    @Override protected FileElement createFileElement(    final CharSequence text){
      return new FileElement(TEST_FILE_ELEMENT_TYPE,text);
    }
  }
;
}
