{
  if (myNameField.getText().length() == 0) {
    Messages.showErrorDialog(myPanel,AndroidBundle.message("specify.avd.name.error"));
    return;
  }
 else   if (myTargetBox.getSelectedItem() == null) {
    Messages.showErrorDialog(myPanel,AndroidBundle.message("select.target.dialog.text"));
    return;
  }
  String avdName=myNameField.getText();
  AvdManager.AvdInfo info=myAvdManager.getAvd(avdName,false);
  if (info != null) {
    boolean replace=Messages.showYesNoDialog(myPanel,AndroidBundle.message("replace.avd.question",avdName),AndroidBundle.message("create.avd.dialog.title"),Messages.getQuestionIcon()) == 0;
    if (!replace)     return;
  }
  File avdFolder;
  try {
    avdFolder=new File(AndroidLocation.getFolder() + FOLDER_AVD,avdName + AvdManager.AVD_FOLDER_EXTENSION);
  }
 catch (  AndroidLocation.AndroidLocationException e) {
    Messages.showErrorDialog(myPanel,e.getMessage(),"Error");
    return;
  }
  super.doOKAction();
  IAndroidTarget selectedTarget=(IAndroidTarget)myTargetBox.getSelectedItem();
  String skin=(String)mySkinField.getSelectedItem();
  String sdCard=getSdCardParameter();
  MessageBuildingSdkLog log=new MessageBuildingSdkLog();
  myCreatedAvd=myAvdManager.createAvd(avdFolder,avdName,selectedTarget,skin,sdCard,null,true,log);
  if (log.getErrorMessage().length() > 0) {
    Messages.showErrorDialog(myProject,log.getErrorMessage(),AndroidBundle.message("android.avd.error.title"));
  }
}
