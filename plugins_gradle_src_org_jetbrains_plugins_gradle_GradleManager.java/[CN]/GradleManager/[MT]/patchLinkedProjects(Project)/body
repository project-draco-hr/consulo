{
  GradleSettings settings=GradleSettings.getInstance(project);
  Collection<GradleProjectSettings> correctedSettings=ContainerUtilRt.newArrayList();
  Map<String,String> adjustedPaths=ContainerUtilRt.newHashMap();
  for (  GradleProjectSettings projectSettings : settings.getLinkedProjectsSettings()) {
    String oldPath=projectSettings.getExternalProjectPath();
    if (!new File(oldPath).isDirectory()) {
      try {
        String newPath=new File(oldPath).getParentFile().getCanonicalPath();
        projectSettings.setExternalProjectPath(newPath);
        adjustedPaths.put(oldPath,newPath);
      }
 catch (      IOException e) {
        LOG.warn(String.format("Unexpected exception occurred on attempt to re-point linked gradle project path from build.gradle to its parent dir. Path: %s",oldPath),e);
      }
    }
    correctedSettings.add(projectSettings);
  }
  if (adjustedPaths.isEmpty()) {
    return null;
  }
  settings.setLinkedProjectsSettings(correctedSettings);
  return adjustedPaths;
}
