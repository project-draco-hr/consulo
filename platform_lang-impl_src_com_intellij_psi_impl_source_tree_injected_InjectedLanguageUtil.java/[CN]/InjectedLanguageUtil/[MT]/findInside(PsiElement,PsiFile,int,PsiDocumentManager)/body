{
  final Ref<PsiElement> out=new Ref<PsiElement>();
  enumerate(element,hostFile,new PsiLanguageInjectionHost.InjectedPsiVisitor(){
    public void visit(    @NotNull PsiFile injectedPsi,    @NotNull List<PsiLanguageInjectionHost.Shred> places){
      for (      PsiLanguageInjectionHost.Shred place : places) {
        TextRange hostRange=place.host.getTextRange();
        if (hostRange.cutOut(place.getRangeInsideHost()).grown(1).contains(hostOffset)) {
          DocumentWindowImpl document=(DocumentWindowImpl)documentManager.getCachedDocument(injectedPsi);
          if (document == null)           return;
          int injectedOffset=document.hostToInjected(hostOffset);
          PsiElement injElement=injectedPsi.findElementAt(injectedOffset);
          out.set(injElement == null ? injectedPsi : injElement);
        }
      }
    }
  }
,true);
  return out.get();
}
