{
  PsiFile containingFile=element.getContainingFile();
  if (containingFile == null)   return null;
  Document document=PsiDocumentManager.getInstance(element.getProject()).getCachedDocument(containingFile);
  if (document instanceof DocumentWindow) {
    PsiElement host=InjectedLanguageManager.getInstance(containingFile.getProject()).getInjectionHost(containingFile);
    if (host != null)     containingFile=host.getContainingFile();
  }
  return containingFile;
}
