{
  if (hostFile instanceof PsiCompiledElement)   return null;
  Project project=hostFile.getProject();
  if (InjectedLanguageManager.getInstance(project).isInjectedFragment(hostFile))   return null;
  final PsiDocumentManager documentManager=PsiDocumentManager.getInstance(project);
  FileViewProvider provider=hostFile.getViewProvider();
  for (  Language language : provider.getLanguages()) {
    PsiElement element=provider.findElementAt(offset,language);
    if (element != null) {
      PsiElement injected=findInside(element,hostFile,offset,documentManager);
      if (injected != null)       return injected;
    }
    if (offset != 0) {
      element=provider.findElementAt(offset - 1,language);
      if (element != null && element.getTextRange().getEndOffset() == offset) {
        PsiElement injected=findInside(element,hostFile,offset,documentManager);
        if (injected != null)         return injected;
      }
    }
  }
  return null;
}
