{
  if (dataId.equals(DataConstants.PROJECT)) {
    return !myProject.isDisposed() ? myProject : null;
  }
  if (dataId.equals(DataConstants.MODULE)) {
    final Module module=getSelectedElement(Module.class);
    if (module != null && !module.isDisposed())     return module;
    final PsiElement element=getSelectedElement(PsiElement.class);
    if (element != null) {
      return ModuleUtil.findModuleForPsiElement(element);
    }
    return null;
  }
  if (dataId.equals(DataConstants.MODULE_CONTEXT)) {
    final PsiDirectory directory=getSelectedElement(PsiDirectory.class);
    if (directory != null) {
      final VirtualFile dir=directory.getVirtualFile();
      if (ProjectRootsUtil.isModuleContentRoot(dir,myProject)) {
        return ModuleUtil.findModuleForPsiElement(directory);
      }
    }
    return null;
  }
  if (dataId.equals(DataConstants.PSI_ELEMENT)) {
    final PsiElement element=getSelectedElement(PsiElement.class);
    return element != null && element.isValid() ? element : null;
  }
  if (dataId.equals(DataConstants.PSI_ELEMENT_ARRAY)) {
    final PsiElement element=getSelectedElement(PsiElement.class);
    return element != null && element.isValid() ? new PsiElement[]{element} : null;
  }
  if (dataId.equals(DataConstants.VIRTUAL_FILE_ARRAY)) {
    PsiElement[] psiElements=(PsiElement[])getData(DataConstants.PSI_ELEMENT_ARRAY);
    if (psiElements == null)     return null;
    Set<VirtualFile> files=new LinkedHashSet<VirtualFile>();
    for (    PsiElement element : psiElements) {
      if (element instanceof PsiFileSystemItem) {
        files.add(((PsiFileSystemItem)element).getVirtualFile());
      }
    }
    return files.size() > 0 ? files.toArray(new VirtualFile[files.size()]) : null;
  }
  if (dataId.equals(DataConstants.CONTEXT_COMPONENT)) {
    return this;
  }
  if (DataConstants.CUT_PROVIDER.equals(dataId)) {
    return myCopyPasteDelegator.getCutProvider();
  }
  if (DataConstants.COPY_PROVIDER.equals(dataId)) {
    return myCopyPasteDelegator.getCopyProvider();
  }
  if (DataConstants.PASTE_PROVIDER.equals(dataId)) {
    return myCopyPasteDelegator.getPasteProvider();
  }
  if (DataConstants.DELETE_ELEMENT_PROVIDER.equals(dataId)) {
    return getSelectedElement(Module.class) != null ? myDeleteModuleProvider : new DeleteHandler.DefaultDeleteProvider();
  }
  if (DataConstants.IDE_VIEW.equals(dataId)) {
    return myIdeView;
  }
  return null;
}
