{
  final AsyncResult<RelativePoint> result=new AsyncResult<RelativePoint>();
  if (myHintContainer != null) {
    final Point p=AbstractPopup.getCenterOf(myHintContainer,this);
    p.y-=myHintContainer.getHeight() / 4;
    result.setDone(RelativePoint.fromScreen(p));
  }
 else {
    if (myContextComponent != null) {
      result.setDone(JBPopupFactory.getInstance().guessBestPopupLocation(DataManager.getInstance().getDataContext(myContextComponent)));
    }
 else {
      DataManager.getInstance().getDataContextFromFocus().doWhenDone(new AsyncResult.Handler<DataContext>(){
        @Override public void run(        DataContext dataContext){
          myContextComponent=PlatformDataKeys.CONTEXT_COMPONENT.getData(dataContext);
          result.setDone(JBPopupFactory.getInstance().guessBestPopupLocation(DataManager.getInstance().getDataContext(myContextComponent)));
        }
      }
);
    }
  }
  return result;
}
