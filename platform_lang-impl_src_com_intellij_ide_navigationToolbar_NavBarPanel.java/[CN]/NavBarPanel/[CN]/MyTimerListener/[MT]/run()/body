{
  if (!isShowing()) {
    return;
  }
  IdeFocusManager.getInstance(myProject).doWhenFocusSettlesDown(new Runnable(){
    @Override public void run(){
      Window wnd=SwingUtilities.windowForComponent(NavBarPanel.this);
      if (wnd == null)       return;
      Component focus=null;
      if (!wnd.isActive()) {
        IdeFrame frame=UIUtil.getParentOfType(IdeFrame.class,NavBarPanel.this);
        if (frame != null) {
          focus=IdeFocusManager.getInstance(myProject).getLastFocusedFor(frame);
        }
      }
 else {
        final Window window=KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusedWindow();
        if (window instanceof Dialog) {
          final Dialog dialog=(Dialog)window;
          if (dialog.isModal() && !SwingUtilities.isDescendingFrom(NavBarPanel.this,dialog)) {
            return;
          }
        }
      }
      if (focus != null && focus.isShowing()) {
        queueModelUpdate(DataManager.getInstance().getDataContext(focus));
      }
 else       if (wnd.isActive()) {
        queueModelUpdateFromFocus();
      }
    }
  }
);
}
