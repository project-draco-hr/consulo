{
  MavenWorkspaceSettings settings=project.getComponent(MavenWorkspaceSettingsComponent.class).getState();
  settings.generalSettings=getGeneralSettings();
  settings.importingSettings=getImportingSettings();
  settings.downloadingSettings=getDownloadingSettings();
  MavenProjectsManager manager=MavenProjectsManager.getInstance(project);
  List<VirtualFile> files=getParameters().myMavenProjectTree.getRootProjectsFiles();
  manager.addManagedFilesWithProfiles(files,getSelectedProfiles());
  manager.waitForReadingCompletion();
  boolean isFromUI=model != null;
  MavenProjectLibrariesProvider librariesProvider=isFromUI ? new MavenUIProjectLibrariesProvider(project) : new MavenDefaultProjectLibrariesProvider(project);
  MavenModuleModelsProvider modelsProvider=isFromUI ? new MavenUIModuleModelsProvider(model,modulesProvider) : new MavenDefaultModuleModelsProvider(project);
  return manager.importProjects(modelsProvider,librariesProvider);
}
