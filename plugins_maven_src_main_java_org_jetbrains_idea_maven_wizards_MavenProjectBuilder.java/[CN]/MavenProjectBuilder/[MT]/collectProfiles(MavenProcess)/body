{
  getParameters().myProfiles=new ArrayList<String>();
  MavenEmbedderWrapper e=MavenEmbedderFactory.createEmbedderForRead(getGeneralSettings(),new SoutMavenConsole(),process);
  try {
    for (    VirtualFile f : getParameters().myFiles) {
      MavenProjectHolder holder=MavenReader.readProject(e,f,new ArrayList<String>(),process);
      if (!holder.isValid)       continue;
      Set<String> profiles=new LinkedHashSet<String>();
      collectProfileIds(holder.mavenProject.getModel(),profiles);
      if (!profiles.isEmpty())       getParameters().myProfiles.addAll(profiles);
    }
  }
 catch (  MavenProcessCanceledException ignore) {
  }
 finally {
    e.release();
  }
}
