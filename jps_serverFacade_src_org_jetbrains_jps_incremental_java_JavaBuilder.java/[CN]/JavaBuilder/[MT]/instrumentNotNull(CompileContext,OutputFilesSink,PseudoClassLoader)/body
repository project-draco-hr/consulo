{
  for (  OutputFileObject fileObject : sink.getUnsavedFiles()) {
    final OutputFileObject.Content originalContent=fileObject.getContent();
    final ClassReader reader=new ClassReader(originalContent.getBuffer(),originalContent.getOffset(),originalContent.getLength());
    final int version=getClassFileVersion(reader);
    if (version >= Opcodes.V1_5) {
      final ClassWriter writer=new InstrumenterClassWriter(getAsmClassWriterFlags(version),loader);
      try {
        final NotNullVerifyingInstrumenter instrumenter=new NotNullVerifyingInstrumenter(writer);
        reader.accept(instrumenter,0);
        if (instrumenter.isModification()) {
          fileObject.updateContent(writer.toByteArray());
        }
      }
 catch (      Exception e) {
        final JavaFileObject source=fileObject.getSource();
        File sourceFile=null;
        if (source != null) {
          sourceFile=new File(source.toUri());
        }
        final StringBuilder msg=new StringBuilder();
        msg.append("@NotNull instrumentation failed ");
        if (sourceFile != null) {
          msg.append(" for ").append(sourceFile.getName());
        }
        msg.append(": ").append(e.getMessage());
        context.processMessage(new CompilerMessage(BUILDER_NAME,BuildMessage.Kind.ERROR,msg.toString(),sourceFile != null ? sourceFile.getPath() : null));
      }
    }
  }
}
