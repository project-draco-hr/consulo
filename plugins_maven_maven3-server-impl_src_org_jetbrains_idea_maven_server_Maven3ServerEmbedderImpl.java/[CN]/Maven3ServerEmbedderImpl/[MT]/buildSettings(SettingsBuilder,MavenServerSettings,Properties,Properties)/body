{
  SettingsBuildingRequest settingsRequest=new DefaultSettingsBuildingRequest();
  settingsRequest.setGlobalSettingsFile(settings.getGlobalSettingsFile());
  settingsRequest.setUserSettingsFile(settings.getUserSettingsFile());
  settingsRequest.setSystemProperties(systemProperties);
  settingsRequest.setUserProperties(userProperties);
  Settings result=new Settings();
  try {
    result=builder.build(settingsRequest).getEffectiveSettings();
  }
 catch (  SettingsBuildingException e) {
    Maven3ServerGlobals.getLogger().info(e);
  }
  if (settings.getLocalRepository() != null) {
    result.setLocalRepository(settings.getLocalRepository().getPath());
  }
  if (result.getLocalRepository() == null) {
    result.setLocalRepository(new File(SystemProperties.getUserHome(),".m2/repository").getPath());
  }
  return result;
}
