{
  final MavenExecutionRequest request=createRequest(file,activeProfiles,Collections.<String>emptyList(),Collections.<String>emptyList());
  final AtomicReference<MavenExecutionResult> ref=new AtomicReference<MavenExecutionResult>();
  executeWithMavenSession(request,new Runnable(){
    @Override public void run(){
      try {
        ProjectBuilder builder=getComponent(ProjectBuilder.class);
        ProjectBuildingResult buildingResult=builder.build(new File(file.getPath()),request.getProjectBuildingRequest());
        MavenProject project=buildingResult.getProject();
        project.setDependencyArtifacts(project.createArtifacts(getComponent(ArtifactFactory.class),null,null));
        ArtifactResolver resolver=getComponent(ArtifactResolver.class);
        ArtifactResolutionRequest resolutionRequest=new ArtifactResolutionRequest();
        resolutionRequest.setArtifactDependencies(project.getDependencyArtifacts());
        resolutionRequest.setArtifact(project.getArtifact());
        resolutionRequest.setManagedVersionMap(project.getManagedVersionMap());
        resolutionRequest.setLocalRepository(myLocalRepository);
        resolutionRequest.setRemoteRepositories(project.getRemoteArtifactRepositories());
        resolutionRequest.setListeners(listeners);
        resolutionRequest.setResolveRoot(false);
        resolutionRequest.setResolveTransitively(true);
        RepositorySystemSession repositorySession=getComponent(LegacySupport.class).getRepositorySession();
        if (repositorySession instanceof DefaultRepositorySystemSession) {
          ((DefaultRepositorySystemSession)repositorySession).setTransferListener(new TransferListenerAdapter(myCurrentIndicator));
        }
        ArtifactResolutionResult result=resolver.resolve(resolutionRequest);
        project.setArtifacts(result.getArtifacts());
        ref.set(new MavenExecutionResult(project,new ArrayList<Exception>()));
      }
 catch (      Exception e) {
        ref.set(handleException(e));
      }
    }
  }
);
  return ref.get();
}
