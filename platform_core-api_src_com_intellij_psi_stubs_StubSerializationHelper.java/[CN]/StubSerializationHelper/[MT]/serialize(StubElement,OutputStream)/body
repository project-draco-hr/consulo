{
  BufferExposingByteArrayOutputStream out=new BufferExposingByteArrayOutputStream();
  FileLocalStringEnumerator storage=new FileLocalStringEnumerator();
  StubOutputStream stubOutputStream=new StubOutputStream(out,storage);
  doSerialize(rootStub,stubOutputStream);
  DataOutputStream resultStream=new DataOutputStream(stream);
  DataInputOutputUtil.writeINT(resultStream,storage.myStrings.size());
  byte[] buffer=IOUtil.allocReadWriteUTFBuffer();
  for (  String s : storage.myStrings) {
    IOUtil.writeUTFFast(buffer,resultStream,s);
  }
  resultStream.write(out.getInternalBuffer(),0,out.size());
}
