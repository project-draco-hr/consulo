{
  if (isPreferredSizeSet()) {
    return super.getPreferredSize();
  }
  boolean toReleaseEditor=false;
  if (myEditor == null && myEnsureWillComputePreferredSize) {
    myEnsureWillComputePreferredSize=false;
    initEditor();
    toReleaseEditor=true;
  }
  Dimension size=new Dimension(100,20);
  if (myEditor != null) {
    final Dimension preferredSize=new Dimension(myEditor.getComponent().getPreferredSize());
    if (myPreferredWidth != -1) {
      preferredSize.width=myPreferredWidth;
    }
    JBInsets.addTo(preferredSize,getInsets());
    size=preferredSize;
  }
 else   if (myPassivePreferredSize != null) {
    size=myPassivePreferredSize;
  }
  if (toReleaseEditor) {
    releaseEditor(myEditor);
    myEditor=null;
    myPassivePreferredSize=size;
  }
  return size;
}
