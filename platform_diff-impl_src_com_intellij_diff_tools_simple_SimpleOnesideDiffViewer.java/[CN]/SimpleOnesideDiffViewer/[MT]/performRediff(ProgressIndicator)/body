{
  indicator.checkCanceled();
  return new Runnable(){
    @Override public void run(){
      clearDiffPresentation();
      boolean shouldHighlight=getTextSettings().getHighlightPolicy() != HighlightPolicy.DO_NOT_HIGHLIGHT;
      if (shouldHighlight) {
        final DocumentContent content=getContent();
        final Document document=content.getDocument();
        int start=0;
        int end=document.getTextLength();
        TextDiffType type=getSide().select(TextDiffType.DELETED,TextDiffType.INSERTED);
        myHighlighters.addAll(DiffDrawUtil.createHighlighter(getEditor(),start,end,type,false));
        int startLine=0;
        int endLine=getLineCount(document);
        if (startLine != endLine) {
          myHighlighters.addAll(DiffDrawUtil.createLineMarker(getEditor(),startLine,type,SeparatorPlacement.TOP));
          myHighlighters.addAll(DiffDrawUtil.createLineMarker(getEditor(),endLine - 1,type,SeparatorPlacement.BOTTOM));
        }
      }
      myInitialScrollHelper.onRediff();
    }
  }
;
}
