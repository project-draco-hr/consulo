{
  String sdkPath=System.getenv("ANDROID_HOME");
  String apiLevel=null;
  if (sdkPath != null) {
    Element sdkRoot=getConfig(project,"sdk");
    if (sdkRoot != null) {
      Element platform=sdkRoot.getChild("platform");
      if (platform != null) {
        apiLevel=platform.getValue();
      }
    }
    AndroidSdk sdk=AndroidSdk.parse(sdkPath,new EmptySdkLog());
    if (sdk != null) {
      IAndroidTarget target=apiLevel != null ? sdk.findTargetByApiLevel(apiLevel) : sdk.getNewerPlatformTarget();
      if (target != null) {
        Library library=AndroidUtils.findAppropriateAndroidPlatform(target,sdk);
        if (library == null) {
          final LibraryTable.ModifiableModel model=LibraryTablesRegistrar.getInstance().getLibraryTable().getModifiableModel();
          AndroidLibraryManager manager=new AndroidLibraryManager(model);
          library=manager.createNewAndroidPlatform(target,sdkPath);
          manager.apply();
          ApplicationManager.getApplication().runWriteAction(new Runnable(){
            public void run(){
              model.commit();
            }
          }
);
        }
        return library;
      }
    }
  }
  return null;
}
