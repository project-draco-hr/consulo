{
  String modulePath=facet.getModule().getModuleFilePath();
  String moduleDirPath=FileUtil.toSystemIndependentName(new File(modulePath).getParent());
  if (moduleDirPath != null) {
    AndroidFacetConfiguration configuration=facet.getConfiguration();
    String genSources=FileUtil.toSystemIndependentName(project.getGeneratedSourcesDirectory(false));
    if (VfsUtil.isAncestor(new File(moduleDirPath),new File(genSources),true)) {
      String genRelativePath=FileUtil.getRelativePath(moduleDirPath,genSources,'/');
      if (genRelativePath != null) {
        configuration.GEN_FOLDER_RELATIVE_PATH_APT='/' + genRelativePath + "/r";
        configuration.GEN_FOLDER_RELATIVE_PATH_AIDL='/' + genRelativePath + "/aidl";
        configuration.USE_CUSTOM_APK_RESOURCE_FOLDER=true;
        configuration.CUSTOM_APK_RESOURCE_FOLDER='/' + genRelativePath + "/combined-resources/"+ SdkConstants.FD_RES;
      }
    }
    configuration.COPY_RESOURCES_FROM_ARTIFACTS=true;
    configuration.ENABLE_AAPT_COMPILER=false;
    String resFolderRelPath=getPathFromConfig(project,moduleDirPath,"resourceDirectory");
    if (resFolderRelPath != null) {
      configuration.RES_FOLDER_RELATIVE_PATH='/' + resFolderRelPath;
    }
    Element resourceOverlayDirectories=getConfig(project,"resourceOverlayDirectories");
    if (resourceOverlayDirectories != null) {
      List<String> dirs=new ArrayList<String>();
      for (      Object child : resourceOverlayDirectories.getChildren()) {
        String dir=((Element)child).getTextTrim();
        if (dir != null && dir.length() > 0) {
          String relativePath=getRelativePath(moduleDirPath,makePath(project,dir));
          if (relativePath != null && relativePath.length() > 0) {
            dirs.add('/' + relativePath);
          }
        }
      }
      if (dirs.size() > 0) {
        configuration.RES_OVERLAY_FOLDERS=ArrayUtil.toStringArray(dirs);
      }
    }
 else {
      String resOverlayFolderRelPath=getPathFromConfig(project,moduleDirPath,"resourceOverlayDirectory");
      if (resOverlayFolderRelPath != null) {
        configuration.RES_OVERLAY_FOLDERS=new String[]{'/' + resOverlayFolderRelPath};
      }
    }
    String assetsFolderRelPath=getPathFromConfig(project,moduleDirPath,"assetsDirectory");
    if (assetsFolderRelPath != null) {
      configuration.ASSETS_FOLDER_RELATIVE_PATH='/' + assetsFolderRelPath;
    }
    String manifestFileRelPath=getPathFromConfig(project,moduleDirPath,"androidManifestFile");
    if (manifestFileRelPath != null) {
      configuration.MANIFEST_FILE_RELATIVE_PATH='/' + manifestFileRelPath;
    }
    String nativeLibsFolderRelPath=getPathFromConfig(project,moduleDirPath,"nativeLibrariesDirectory");
    if (nativeLibsFolderRelPath != null) {
      configuration.LIBS_FOLDER_RELATIVE_PATH='/' + nativeLibsFolderRelPath;
    }
  }
}
