{
  if (myChange == null) {
    ContentRevision beforeRevision=null;
    ContentRevision afterRevision=null;
    FilePath filePath=null;
    VirtualFile baseDir=project.getProjectFile().getParent();
    if (myFileStatus != FileStatus.ADDED) {
      VirtualFile changedFile=VfsUtil.findRelativeFile(myPatchedFilePath,baseDir);
      if (changedFile != null) {
        filePath=new FilePathImpl(changedFile);
        beforeRevision=new CurrentContentRevision(filePath);
      }
    }
    if (filePath == null) {
      VirtualFile changedDir=VfsUtil.findRelativeFile(getDirectory(),baseDir);
      filePath=new FilePathImpl(changedDir,getFileName(),false);
    }
    if (myFileStatus != FileStatus.DELETED) {
      afterRevision=new PatchedContentRevision(filePath);
    }
    myChange=new Change(beforeRevision,afterRevision,myFileStatus);
  }
  return myChange;
}
