{
  String rootBefore=getRoot() + "/before";
  PsiTestUtil.removeAllRoots(myModule,IdeaTestUtil.getMockJdk17());
  final VirtualFile rootDir=PsiTestUtil.createTestProjectStructure(myProject,myModule,rootBefore,myFilesToDelete);
  PsiClass aClass=myJavaFacade.findClass(className,ProjectScope.getAllScope(myProject));
  assertTrue(aClass != null);
  PsiElement element=aClass.findMethodsByName(methodName,false)[0];
  assertTrue(element instanceof PsiMethod);
  PsiMethod method=(PsiMethod)element;
  final boolean condition=InlineMethodProcessor.checkBadReturns(method) && !InlineUtil.allUsagesAreTailCalls(method);
  assertFalse("Bad returns found",condition);
  InlineOptions options=new MockInlineMethodOptions();
  final InlineMethodProcessor processor=new InlineMethodProcessor(getProject(),method,null,myEditor,options.isInlineThisOnly());
  processor.run();
  String rootAfter=getRoot() + "/after";
  VirtualFile rootDir2=LocalFileSystem.getInstance().findFileByPath(rootAfter.replace(File.separatorChar,'/'));
  myProject.getComponent(PostprocessReformattingAspect.class).doPostponedFormatting();
  IdeaTestUtil.assertDirectoriesEqual(rootDir2,rootDir,IdeaTestUtil.CVS_FILE_FILTER);
}
