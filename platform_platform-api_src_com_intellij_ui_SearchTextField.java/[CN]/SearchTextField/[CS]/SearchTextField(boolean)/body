{
  super(new BorderLayout());
  myModel=new MyModel();
  myTextField=new TextFieldWithProcessing(){
    @Override public void processKeyEvent(    final KeyEvent e){
      if (preprocessEventForTextField(e))       return;
      super.processKeyEvent(e);
    }
    @Override public void setBackground(    final Color bg){
      super.setBackground(bg);
      if (myClearFieldLabel != null) {
        myClearFieldLabel.setBackground(bg);
      }
      if (myToggleHistoryLabel != null) {
        myToggleHistoryLabel.setBackground(bg);
      }
    }
  }
;
  myTextField.setColumns(15);
  myTextField.addFocusListener(new FocusAdapter(){
    @Override public void focusLost(    FocusEvent e){
      onFocusLost();
      super.focusLost(e);
    }
  }
);
  add(myTextField,BorderLayout.CENTER);
  if (hasNativeLeopardSearchControl()) {
    myTextField.putClientProperty("JTextField.variant","search");
    myNativeSearchPopup=new JPopupMenu();
    myNoItems=new JMenuItem("No recent searches");
    myNoItems.setEnabled(false);
    updateMenu();
    if (historyEnabled) {
      myTextField.putClientProperty("JTextField.Search.FindPopup",myNativeSearchPopup);
    }
  }
 else {
    myToggleHistoryLabel=new JLabel(IconLoader.getIcon("/actions/search.png"));
    myToggleHistoryLabel.setOpaque(true);
    myToggleHistoryLabel.setBackground(myTextField.getBackground());
    myToggleHistoryLabel.addMouseListener(new MouseAdapter(){
      public void mousePressed(      MouseEvent e){
        togglePopup();
      }
    }
);
    if (historyEnabled) {
      add(myToggleHistoryLabel,BorderLayout.WEST);
    }
    myClearFieldLabel=new JLabel(IconLoader.getIcon("/actions/cleanLight.png"));
    myClearFieldLabel.setOpaque(true);
    myClearFieldLabel.setBackground(myTextField.getBackground());
    add(myClearFieldLabel,BorderLayout.EAST);
    myClearFieldLabel.addMouseListener(new MouseAdapter(){
      public void mousePressed(      MouseEvent e){
        myTextField.setText("");
        onFieldCleared();
      }
    }
);
    final Border originalBorder;
    if (SystemInfo.isMac) {
      originalBorder=BorderFactory.createLoweredBevelBorder();
    }
 else {
      originalBorder=myTextField.getBorder();
    }
    setBorder(new CompoundBorder(IdeBorderFactory.createEmptyBorder(4,0,4,0),originalBorder));
    myTextField.setOpaque(true);
    myTextField.setBorder(IdeBorderFactory.createEmptyBorder(0,5,0,5));
  }
  final ActionManager actionManager=ActionManager.getInstance();
  if (actionManager != null) {
    final AnAction clearTextAction=actionManager.getAction(IdeActions.ACTION_CLEAR_TEXT);
    if (clearTextAction.getShortcutSet().getShortcuts().length == 0) {
      clearTextAction.registerCustomShortcutSet(CommonShortcuts.ESCAPE,this);
    }
  }
}
