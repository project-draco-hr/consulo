{
  RecentsManager.getInstance(myProject).registerRecentEntry(RECENTS_KEY,myTargetPackageField.getText());
  String errorString=new WriteCommandAction<String>(myProject,CodeInsightBundle.message("create.directory.command")){
    protected void run(    Result<String> result) throws Throwable {
      try {
        myTargetDirectory=selectTargetDirectory();
        if (myTargetDirectory == null) {
          result.setResult("You have to choose a directory");
          return;
        }
        result.setResult(RefactoringMessageUtil.checkCanCreateClass(myTargetDirectory,getClassName()));
      }
 catch (      IncorrectOperationException e) {
        result.setResult(e.getMessage());
      }
    }
  }
.execute().getResultObject();
  if (errorString != null) {
    Messages.showMessageDialog(myProject,errorString,CommonBundle.getErrorTitle(),Messages.getErrorIcon());
    return;
  }
  super.doOKAction();
}
