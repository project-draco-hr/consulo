{
  LOG.assertTrue(rootFiles != null);
  Set<WatchRequest> result=new HashSet<WatchRequest>();
synchronized (LOCK) {
    for (    VirtualFile file : rootFiles) {
      LOG.assertTrue(file != null);
      if (file instanceof VirtualFileImpl) {
        boolean recWatch=toWatchRecursively;
        if (!file.isDirectory()) {
          file=file.getParent();
          recWatch=false;
        }
        final WatchRequestImpl request=new WatchRequestImpl(file,recWatch);
        result.add(request);
      }
    }
    myRootsToWatch.addAll(result);
    setUpFileWatcher();
  }
  return result;
}
