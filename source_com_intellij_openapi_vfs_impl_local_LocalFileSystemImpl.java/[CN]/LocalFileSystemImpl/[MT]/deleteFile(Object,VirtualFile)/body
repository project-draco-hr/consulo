{
  final VirtualFileImpl file=((VirtualFileImpl)vFile);
  PhysicalFile physicalFile=file.getPhysicalFile();
  VirtualFileImpl parent=file.getParent();
  if (parent == null) {
    throw new IOException(VfsBundle.message("file.delete.root.error",physicalFile.getPath()));
  }
  final String name=file.getName();
  final boolean handled=auxDelete(file);
  fireBeforeFileDeletion(requestor,file);
  boolean isDirectory=file.isDirectory();
  if (!handled) {
    delete(physicalFile);
  }
  parent.removeChild(file);
  fireFileDeleted(requestor,file,name,isDirectory,parent);
  if (handled && isDirectory && physicalFile.exists()) {
    VirtualFileImpl newMe=new VirtualFileImpl(parent,physicalFile,true);
    parent.addChild(newMe);
    fireFileCreated(requestor,newMe);
  }
}
