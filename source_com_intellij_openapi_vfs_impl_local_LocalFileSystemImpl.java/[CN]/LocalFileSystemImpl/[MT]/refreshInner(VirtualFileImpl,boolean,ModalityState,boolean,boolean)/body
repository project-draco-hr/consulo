{
  if (noWatcher || !FileWatcher.isAvailable() || !recursive && !asynchronous) {
    file.refreshInternal(recursive,modalityState,false,asynchronous,noWatcher);
  }
 else {
    Key status;
synchronized (myRefreshStatusMap) {
      status=myRefreshStatusMap.remove(file);
    }
    if (status == DELETED_STATUS) {
      if (file.getPhysicalFile().exists()) {
        file.refreshInternal(true,modalityState,false,asynchronous,noWatcher);
      }
    }
 else {
      if (status == DIRTY_STATUS) {
        file.refreshInternal(false,modalityState,false,asynchronous,noWatcher);
      }
      if (recursive && file.areChildrenCached()) {
        for (        VirtualFileImpl child : file.getChildren()) {
          if (status == DIRTY_STATUS && !child.getPhysicalFile().exists()) {
            continue;
          }
          refreshInner(child,recursive,modalityState,asynchronous,noWatcher);
        }
      }
    }
  }
}
