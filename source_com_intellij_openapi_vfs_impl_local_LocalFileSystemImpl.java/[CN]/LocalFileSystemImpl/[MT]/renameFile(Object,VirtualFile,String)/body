{
  final VirtualFileImpl file=((VirtualFileImpl)vFile);
  final boolean handled=auxRename(file,newName);
  String oldName=file.getName();
  if (Comparing.equal(oldName,newName))   return;
  fireBeforePropertyChange(requestor,file,VirtualFile.PROP_NAME,oldName,newName);
  if (!handled) {
    PhysicalFile physicalFile=file.getPhysicalFile();
    file.setName(newName);
    PhysicalFile newFile=file.getPhysicalFile();
    if (!physicalFile.renameTo(newFile)) {
      file.setName(physicalFile.getName());
      throw new IOException(VfsBundle.message("file.rename.error",physicalFile.getPath(),newFile.getPath()));
    }
  }
 else {
    file.setName(newName);
  }
  firePropertyChanged(requestor,file,VirtualFile.PROP_NAME,oldName,newName);
}
