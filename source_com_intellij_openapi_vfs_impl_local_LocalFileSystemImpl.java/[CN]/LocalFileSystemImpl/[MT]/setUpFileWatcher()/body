{
  if (FileWatcher.isAvailable()) {
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      public void run(){
synchronized (LOCK) {
          final WatchRequest[] watchRequests=normalizeRootsForRefresh();
          String[] dirPaths=new String[watchRequests.length];
          boolean[] toWatchRecursively=new boolean[watchRequests.length];
          int cnt=0;
          for (          WatchRequest root : watchRequests) {
            dirPaths[cnt]=root.getRoot().getPath();
            toWatchRecursively[cnt]=root.isToWatchRecursively();
            cnt++;
          }
          final Vector<String> watchManual=new Vector<String>();
          int numDir=FileWatcher.setup(dirPaths,toWatchRecursively,watchManual);
          if (numDir == 0) {
            try {
              FileWatcher.setup(new String[]{FileUtil.getTempDirectory()},new boolean[]{false},new Vector());
            }
 catch (            IOException e) {
              LOG.error(e);
            }
          }
          myFilesToWatchManual.clear();
          for (int i=0; i < watchManual.size(); i++) {
            String path=watchManual.elementAt(i);
            path=path.replace(File.separatorChar,'/');
            VirtualFile file=findFileByPath(path);
            if (file != null) {
              myFilesToWatchManual.add(file);
            }
          }
        }
      }
    }
);
  }
  myCachedNormalizedRequests=null;
}
