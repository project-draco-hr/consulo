{
  if (SystemInfo.isWindows || SystemInfo.isOS2) {
    if (path.endsWith(":/")) {
      path=Character.toUpperCase(path.charAt(0)) + path.substring(1);
    }
  }
synchronized (LOCK) {
    initRoots();
    for (    VirtualFile root : myRootsToPaths.keySet()) {
      String rootPath=root.getPath();
      if (!FileUtil.startsWith(path,rootPath))       continue;
      if (path.length() == rootPath.length())       return root;
      String tail;
      if (path.charAt(rootPath.length()) == '/') {
        tail=path.substring(rootPath.length() + 1);
      }
 else       if (StringUtil.endsWithChar(rootPath,'/')) {
        tail=path.substring(rootPath.length());
      }
 else {
        continue;
      }
      StringTokenizer tokenizer=new StringTokenizer(tail,"/");
      while (tokenizer.hasMoreTokens()) {
        final String name=tokenizer.nextToken();
        if (".".equals(name))         continue;
        if ("..".equals(name)) {
          root=root.getParent();
        }
 else {
          if (!createIfNoCache && !((VirtualFileImpl)root).areChildrenCached())           return null;
          if (!root.isDirectory())           return null;
          root=root.findChild(name);
        }
        if (root == null)         return null;
      }
      return root;
    }
    return null;
  }
}
