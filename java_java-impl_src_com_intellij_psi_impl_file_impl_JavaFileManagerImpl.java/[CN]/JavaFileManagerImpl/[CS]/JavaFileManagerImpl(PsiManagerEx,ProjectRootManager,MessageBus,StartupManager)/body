{
  myManager=manager;
  myProjectRootManager=projectRootManager;
  myFileManager=manager.getFileManager();
  myUseRepository=true;
  myManager.registerRunnableToRunOnChange(new Runnable(){
    @Override public void run(){
      myCachedObjectClassMap.clear();
    }
  }
);
  final MessageBusConnection connection=bus.connect();
  connection.subscribe(ProjectTopics.PROJECT_ROOTS,new ModuleRootListener(){
    @Override public void beforeRootsChange(    final ModuleRootEvent event){
    }
    @Override public void rootsChanged(    final ModuleRootEvent event){
      myNontrivialPackagePrefixes=null;
      clearNonRepositoryMaps();
    }
  }
);
  connection.subscribe(VirtualFileManager.VFS_CHANGES,new BulkFileListener(){
    @Override public void before(    @NotNull final List<? extends VFileEvent> events){
      clearNonRepositoryMaps();
    }
    @Override public void after(    @NotNull final List<? extends VFileEvent> events){
      clearNonRepositoryMaps();
    }
  }
);
  connection.subscribe(AppTopics.FILE_DOCUMENT_SYNC,new FileDocumentManagerAdapter(){
    @Override public void fileWithNoDocumentChanged(    @NotNull final VirtualFile file){
      clearNonRepositoryMaps();
    }
  }
);
  myPackageIndex=PackageIndex.getInstance(myManager.getProject());
  startupManager.registerStartupActivity(new Runnable(){
    @Override public void run(){
      initialize();
    }
  }
);
  Disposer.register(myManager.getProject(),this);
}
