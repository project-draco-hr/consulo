{
  final VirtualFile f=root.createChildData(null,"f.java");
  f.setBinaryContent(new byte[]{0});
  setDocumentTextFor(f,new byte[]{1});
  CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
    public void run(){
      LocalVcsAction a=getVcsComponent().startAction("action");
      setDocumentTextFor(f,new byte[]{2});
      a.finish();
    }
  }
,"command",null);
  List<Revision> rr=getVcsRevisionsFor(f);
  assertEquals(4,rr.size());
  assertEquals("command",rr.get(0).getCauseAction());
  assertEquals(2,contentOf(rr.get(0))[0]);
  assertEquals(1,contentOf(rr.get(1))[0]);
  assertEquals(0,contentOf(rr.get(2))[0]);
  assertTrue(contentOf(rr.get(3)).length == 0);
}
