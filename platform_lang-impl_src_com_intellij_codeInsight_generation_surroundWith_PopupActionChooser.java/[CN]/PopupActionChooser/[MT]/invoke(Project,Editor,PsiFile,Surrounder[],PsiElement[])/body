{
  final DefaultActionGroup applicable=new DefaultActionGroup();
  hasEnabledSurrounders=false;
  Set<Character> usedMnemonicsSet=new HashSet<Character>();
  int index=0;
  for (  Surrounder surrounder : surrounders) {
    if (surrounder.isApplicable(elements)) {
      char mnemonic;
      if (index < 9) {
        mnemonic=(char)('0' + index + 1);
      }
 else       if (index == 9) {
        mnemonic='0';
      }
 else {
        mnemonic=(char)('A' + index - 10);
      }
      index++;
      usedMnemonicsSet.add(Character.toUpperCase(mnemonic));
      applicable.add(new InvokeSurrounderAction(surrounder,project,editor,elements,mnemonic));
      hasEnabledSurrounders=true;
    }
  }
  List<CustomLiveTemplate> customTemplates=SurroundWithTemplateHandler.getApplicableCustomTemplates(editor,file);
  List<TemplateImpl> templates=SurroundWithTemplateHandler.getApplicableTemplates(editor,file,true);
  if (!templates.isEmpty() || !customTemplates.isEmpty()) {
    applicable.addSeparator("Live templates");
  }
  for (  TemplateImpl template : templates) {
    applicable.add(new InvokeTemplateAction(template,editor,project,usedMnemonicsSet));
    hasEnabledSurrounders=true;
  }
  for (  CustomLiveTemplate customTemplate : customTemplates) {
    applicable.add(new WrapWithCustomTemplateAction(customTemplate,editor,file,usedMnemonicsSet));
    hasEnabledSurrounders=true;
  }
  if (!templates.isEmpty() || !customTemplates.isEmpty()) {
    applicable.addSeparator();
    applicable.add(new ConfigureTemplatesAction());
  }
  if (hasEnabledSurrounders) {
    DataContext context=DataManager.getInstance().getDataContext(editor.getContentComponent());
    final ListPopup popup=JBPopupFactory.getInstance().createActionGroupPopup(myTitle,applicable,context,JBPopupFactory.ActionSelectionAid.MNEMONICS,true);
    popup.showInBestPositionFor(editor);
  }
}
