{
  NamedScope xScope=new NamedScope("xxx",new PatternPackageSet("x..*",PatternPackageSet.SCOPE_SOURCE,null));
  NamedScope utilScope=new NamedScope("util",new PatternPackageSet("java.util.*",PatternPackageSet.SCOPE_LIBRARY,null));
  NamedScopeManager scopeManager=NamedScopeManager.getInstance(getProject());
  scopeManager.addScope(xScope);
  scopeManager.addScope(utilScope);
  EditorColorsManager manager=EditorColorsManager.getInstance();
  EditorColorsScheme scheme=(EditorColorsScheme)manager.getGlobalScheme().clone();
  manager.addColorsScheme(scheme);
  EditorColorsManager.getInstance().setGlobalScheme(scheme);
  TextAttributesKey xKey=ColorAndFontOptions.getScopeTextAttributeKey(xScope.getName());
  TextAttributes xAttributes=new TextAttributes(Color.cyan,Color.darkGray,Color.blue,EffectType.BOXED,Font.ITALIC);
  scheme.setAttributes(xKey,xAttributes);
  TextAttributesKey utilKey=ColorAndFontOptions.getScopeTextAttributeKey(utilScope.getName());
  TextAttributes utilAttributes=new TextAttributes(Color.gray,Color.magenta,Color.orange,EffectType.STRIKEOUT,Font.BOLD);
  scheme.setAttributes(utilKey,utilAttributes);
  try {
    doTest(BASE_PATH + "/scopeBased/x/X.java",BASE_PATH + "/scopeBased",false,true);
  }
  finally {
    scopeManager.removeAllSets();
  }
}
