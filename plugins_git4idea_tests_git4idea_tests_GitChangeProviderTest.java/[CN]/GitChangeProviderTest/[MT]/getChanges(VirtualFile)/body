{
  for (  VirtualFile vf : changedFiles) {
    myDirtyScope.addDirtyFile(new FilePathImpl(vf));
  }
  MockChangelistBuilder builder=new MockChangelistBuilder();
  myChangeProvider.getChanges(myDirtyScope,builder,new EmptyProgressIndicator(),new MockChangeListManagerGate(ChangeListManager.getInstance(myProject)));
  List<Change> changes=builder.getChanges();
  Map<VirtualFile,Change> result=new HashMap<VirtualFile,Change>();
  for (  Change change : changes) {
    VirtualFile file=change.getVirtualFile();
    if (file == null) {
      String path=change.getBeforeRevision().getFile().getPath();
      for (      VirtualFile vf : changedFiles) {
        if (vf.getPath().equals(path)) {
          file=vf;
          break;
        }
      }
    }
    result.put(file,change);
  }
  return result;
}
