{
  LOG.info("save " + rootsToSave);
  final Map<VirtualFile,Collection<Change>> map=new LocalChangesUnderRoots(myProject).getChangesUnderRoots(rootsToSave);
  final Set<Change> changes=new HashSet<Change>();
  for (  Collection<Change> changeCollection : map.values()) {
    changes.addAll(changeCollection);
  }
  if (!changes.isEmpty()) {
    String oldProgressTitle=myProgressIndicator.getText();
    myProgressIndicator.setText(GitBundle.getString("update.shelving.changes"));
    List<VcsException> exceptions=new ArrayList<VcsException>(1);
    myShelvedChangeList=GitShelveUtils.shelveChanges(myProject,myShelveManager,changes,myStashMessage,exceptions,false);
    myProgressIndicator.setText(oldProgressTitle);
    if (!exceptions.isEmpty()) {
      LOG.info("save " + exceptions,exceptions.get(0));
      throw exceptions.get(0);
    }
 else {
      for (      VirtualFile root : rootsToSave) {
        GitRollbackEnvironment.resetHardLocal(myProject,root);
      }
    }
  }
}
