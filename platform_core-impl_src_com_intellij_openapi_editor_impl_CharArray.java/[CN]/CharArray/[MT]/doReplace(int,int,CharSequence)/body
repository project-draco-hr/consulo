{
  prepareForModification();
  if (isDeferredChangeMode()) {
    storeChange(new TextChangeImpl(newString,startOffset,endOffset));
    if (myDebug) {
      myDebugArray.doReplace(startOffset,endOffset,newString);
    }
  }
 else {
    int newLength=newString.length();
    int oldLength=endOffset - startOffset;
    CharArrayUtil.getChars(newString,myArray,startOffset,Math.min(newLength,oldLength));
    myStringRef=null;
    if (newLength > oldLength) {
      doInsert(newString.subSequence(oldLength,newLength),endOffset);
    }
 else     if (newLength < oldLength) {
      doRemove(startOffset + newLength,startOffset + oldLength);
    }
  }
}
