{
  List<MavenIndex> remainingWaiting=new ArrayList<MavenIndex>(indices);
  try {
    for (    MavenIndex each : indices) {
      if (indicator.isCanceled())       return;
      indicator.setText(IndicesBundle.message("maven.indices.updating.index",each.getRepositoryPathOrUrl()));
synchronized (myUpdatingIndicesLock) {
        remainingWaiting.remove(each);
        myWaitingIndices.remove(each);
        myUpdatingIndex=each;
      }
      try {
        myIndices.update(each,indicator);
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          public void run(){
            rehighlightAllPoms(p);
          }
        }
);
      }
  finally {
synchronized (myUpdatingIndicesLock) {
          myUpdatingIndex=null;
        }
      }
    }
  }
 catch (  ProcessCanceledException ignore) {
  }
 finally {
synchronized (myUpdatingIndicesLock) {
      myWaitingIndices.removeAll(remainingWaiting);
    }
  }
}
