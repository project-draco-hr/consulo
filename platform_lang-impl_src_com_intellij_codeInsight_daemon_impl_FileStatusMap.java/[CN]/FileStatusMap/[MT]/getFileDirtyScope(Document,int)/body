{
synchronized (myDocumentToStatusMap) {
    PsiFile file=PsiDocumentManager.getInstance(myProject).getPsiFile(document);
    if (!CollectHighlightsUtil.shouldHighlightFile(file))     return null;
    FileStatus status=myDocumentToStatusMap.get(document);
    if (status == null) {
      return file == null ? null : file.getTextRange();
    }
    if (status.defensivelyMarked) {
      status.markWholeFile(file,document,myProject);
      status.defensivelyMarked=false;
    }
    LOG.assertTrue(status.dirtyScopes.containsKey(passId),"Unknown pass " + passId);
    RangeMarker marker=status.dirtyScopes.get(passId);
    return marker == null ? null : marker.isValid() ? new TextRange(marker.getStartOffset(),marker.getEndOffset()) : new TextRange(0,document.getTextLength());
  }
}
