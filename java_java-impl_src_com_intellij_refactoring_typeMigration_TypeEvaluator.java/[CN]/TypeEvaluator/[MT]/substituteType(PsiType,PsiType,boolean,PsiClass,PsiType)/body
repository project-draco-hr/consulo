{
  if (originalClass != null) {
    if (((PsiClassType)originalType).hasParameters() && ((PsiClassType)migrationType).hasParameters()) {
      final PsiResolveHelper psiResolveHelper=JavaPsiFacade.getInstance(originalClass.getProject()).getResolveHelper();
      final PsiType rawOriginalType=JavaPsiFacade.getElementFactory(originalClass.getProject()).createType(originalClass,PsiSubstitutor.EMPTY);
      PsiSubstitutor substitutor=PsiSubstitutor.EMPTY;
      for (      PsiTypeParameter parameter : originalClass.getTypeParameters()) {
        final PsiType type=psiResolveHelper.getSubstitutionForTypeParameter(parameter,rawOriginalType,migrationType,false,PsiUtil.getLanguageLevel(originalClass));
        if (type != null) {
          substitutor=substitutor.put(parameter,captureWildcard && type instanceof PsiWildcardType ? ((PsiWildcardType)type).getExtendsBound() : type);
        }
 else {
          return null;
        }
      }
      return substitutor.substitute(rawTypeToReplace);
    }
 else {
      return originalType;
    }
  }
  return null;
}
