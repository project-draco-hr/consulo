{
  TaskManagerImpl taskManager=(TaskManagerImpl)TaskManager.getManager(myProject);
  Task task=getSelectedTask();
  if (myMarkAsInProgressBox.isVisible()) {
    myMarkAsInProgressBox.setEnabled(false);
    if (task != null) {
      TaskRepository repository=task.getRepository();
      if (repository != null && repository.getRepositoryType().getPossibleTaskStates().contains(TaskState.IN_PROGRESS)) {
        myMarkAsInProgressBox.setEnabled(true);
      }
    }
  }
  if (!taskManager.isVcsEnabled()) {
    myCreateChangelist.setEnabled(false);
    myCreateChangelist.setSelected(false);
  }
 else   if (task instanceof LocalTask && !((LocalTask)task).isClosedLocally()) {
    myCreateChangelist.setSelected(true);
    myCreateChangelist.setEnabled(false);
  }
 else {
    myCreateChangelist.setSelected(taskManager.getState().createChangelist);
    myCreateChangelist.setEnabled(true);
  }
  setOKActionEnabled(isOKActionEnabled());
}
