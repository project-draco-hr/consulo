{
  final Element element=data.save();
  if (myPathMacroSubstitutor != null) {
    Set<String> usedMacros=myPathMacroSubstitutor.getUsedMacros();
    try {
      myPathMacroSubstitutor.reset();
      myPathMacroSubstitutor.collapsePaths(element);
    }
  finally {
      myPathMacroSubstitutor.reset(usedMacros);
    }
  }
  return new Document(element);
}
