'hooks for integrating with the Bugzilla bug tracker\n\nThis hook extension adds comments on bugs in Bugzilla when changesets\nthat refer to bugs by Bugzilla ID are seen. The hook does not change\nbug status.\n\nThe hook updates the Bugzilla database directly. Only Bugzilla\ninstallations using MySQL are supported.\n\nThe hook relies on a Bugzilla script to send bug change notification\nemails. That script changes between Bugzilla versions; the\n\'processmail\' script used prior to 2.18 is replaced in 2.18 and\nsubsequent versions by \'config/sendbugmail.pl\'. Note that these will\nbe run by Mercurial as the user pushing the change; you will need to\nensure the Bugzilla install file permissions are set appropriately.\n\nThe extension is configured through three different configuration\nsections. These keys are recognized in the [bugzilla] section:\n\nhost\n  Hostname of the MySQL server holding the Bugzilla database.\n\ndb\n  Name of the Bugzilla database in MySQL. Default \'bugs\'.\n\nuser\n  Username to use to access MySQL server. Default \'bugs\'.\n\npassword\n  Password to use to access MySQL server.\n\ntimeout\n  Database connection timeout (seconds). Default 5.\n\nversion\n  Bugzilla version. Specify \'3.0\' for Bugzilla versions 3.0 and later,\n  \'2.18\' for Bugzilla versions from 2.18 and \'2.16\' for versions prior\n  to 2.18.\n\nbzuser\n  Fallback Bugzilla user name to record comments with, if changeset\n  committer cannot be found as a Bugzilla user.\n\nbzdir\n   Bugzilla install directory. Used by default notify. Default\n   \'/var/www/html/bugzilla\'.\n\nnotify\n  The command to run to get Bugzilla to send bug change notification\n  emails. Substitutes from a map with 3 keys, \'bzdir\', \'id\' (bug id)\n  and \'user\' (committer bugzilla email). Default depends on version;\n  from 2.18 it is "cd %(bzdir)s && perl -T contrib/sendbugmail.pl\n  %(id)s %(user)s".\n\nregexp\n  Regular expression to match bug IDs in changeset commit message.\n  Must contain one "()" group. The default expression matches \'Bug\n  1234\', \'Bug no. 1234\', \'Bug number 1234\', \'Bugs 1234,5678\', \'Bug\n  1234 and 5678\' and variations thereof. Matching is case insensitive.\n\nstyle\n  The style file to use when formatting comments.\n\ntemplate\n  Template to use when formatting comments. Overrides style if\n  specified. In addition to the usual Mercurial keywords, the\n  extension specifies::\n\n    {bug}       The Bugzilla bug ID.\n    {root}      The full pathname of the Mercurial repository.\n    {webroot}   Stripped pathname of the Mercurial repository.\n    {hgweb}     Base URL for browsing Mercurial repositories.\n\n  Default \'changeset {node|short} in repo {root} refers \'\n          \'to bug {bug}.\\ndetails:\\n\\t{desc|tabindent}\'\n\nstrip\n  The number of slashes to strip from the front of {root} to produce\n  {webroot}. Default 0.\n\nusermap\n  Path of file containing Mercurial committer ID to Bugzilla user ID\n  mappings. If specified, the file should contain one mapping per\n  line, "committer"="Bugzilla user". See also the [usermap] section.\n\nThe [usermap] section is used to specify mappings of Mercurial\ncommitter ID to Bugzilla user ID. See also [bugzilla].usermap.\n"committer"="Bugzilla user"\n\nFinally, the [web] section supports one entry:\n\nbaseurl\n  Base URL for browsing Mercurial repositories. Reference from\n  templates as {hgweb}.\n\nActivating the extension::\n\n    [extensions]\n    bugzilla =\n\n    [hooks]\n    # run bugzilla hook on every change pulled or pushed in here\n    incoming.bugzilla = python:hgext.bugzilla.hook\n\nExample configuration:\n\nThis example configuration is for a collection of Mercurial\nrepositories in /var/local/hg/repos/ used with a local Bugzilla 3.2\ninstallation in /opt/bugzilla-3.2. ::\n\n    [bugzilla]\n    host=localhost\n    password=XYZZY\n    version=3.0\n    bzuser=unknown@domain.com\n    bzdir=/opt/bugzilla-3.2\n    template=Changeset {node|short} in {root|basename}.\n             {hgweb}/{webroot}/rev/{node|short}\\n\n             {desc}\\n\n    strip=5\n\n    [web]\n    baseurl=http://dev.domain.com/hg\n\n    [usermap]\n    user@emaildomain.com=user.name@bugzilladomain.com\n\nCommits add a comment to the Bugzilla bug record of the form::\n\n    Changeset 3b16791d6642 in repository-name.\n    http://dev.domain.com/hg/repository-name/rev/3b16791d6642\n\n    Changeset commit comment. Bug 1234.\n'
from mercurial.i18n import _
from mercurial.node import short
from mercurial import cmdutil, templater, util
import re, time
MySQLdb = None
