def find_bug_ids(self, ctx):
    'find valid bug ids that are referred to in changeset\n        comments and that do not already have references to this\n        changeset.'
    if (bugzilla._bug_re is None):
        bugzilla._bug_re = re.compile(self.ui.config('bugzilla', 'regexp', bugzilla._default_bug_re), re.IGNORECASE)
        bugzilla._split_re = re.compile('\\D+')
    start = 0
    ids = set()
    while True:
        m = bugzilla._bug_re.search(ctx.description(), start)
        if (not m):
            break
        start = m.end()
        for id in bugzilla._split_re.split(m.group(1)):
            if (not id):
                continue
            ids.add(int(id))
    if ids:
        ids = self.filter_real_bug_ids(ids)
    if ids:
        ids = self.filter_unknown_bug_ids(ctx.node(), ids)
    return ids
