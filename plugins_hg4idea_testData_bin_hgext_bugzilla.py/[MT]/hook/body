def hook(ui, repo, hooktype, node=None, **kwargs):
    'add comment to bugzilla for each changeset that refers to a\n    bugzilla bug id. only add a comment once per bug, so same change\n    seen multiple times does not fill bug with duplicate data.'
    try:
        import MySQLdb as mysql
        global MySQLdb
        MySQLdb = mysql
    except ImportError as err:
        raise util.Abort((_('python mysql support not available: %s') % err))
    if (node is None):
        raise util.Abort((_('hook type %s does not pass a changeset id') % hooktype))
    try:
        bz = bugzilla(ui, repo)
        ctx = repo[node]
        ids = bz.find_bug_ids(ctx)
        if ids:
            for id in ids:
                bz.update(id, ctx)
            bz.notify(ids, util.email(ctx.user()))
    except MySQLdb.MySQLError as err:
        raise util.Abort((_('database error: %s') % err[1]))
