{
  final ArrayList<Block> result=new ArrayList<Block>(3);
  ASTNode child=node.getFirstChildNode();
  while (child != null) {
    if (child.getElementType() == XmlElementType.XML_ATTRIBUTE_VALUE_START_DELIMITER || child.getElementType() == XmlElementType.XML_ATTRIBUTE_VALUE_END_DELIMITER) {
      result.add(new XmlBlock(child,null,null,formattingPolicy,null,null,isPreserveSpace()));
    }
 else     if (!child.getPsi().getLanguage().isKindOf(XMLLanguage.INSTANCE) && containsOuterLanguageElement(child)) {
      createLeafBlocks(child,result);
    }
 else     if (child.getElementType() != TokenType.ERROR_ELEMENT || child.getFirstChildNode() != null) {
      result.add(new ReadOnlyBlock(child));
    }
    child=child.getTreeNext();
  }
  return result;
}
