{
  LOG.assertTrue(myContext == null || myContext.isValid());
  if (item == null) {
    item=createText("");
  }
  JavaCodeFragment codeFragment=myFactory.createPresentationCodeFragment(item,myContext,getProject());
  codeFragment.forceResolveScope(GlobalSearchScope.allScope(myProject));
  if (myContext != null) {
    final PsiClass contextClass=PsiTreeUtil.getNonStrictParentOfType(myContext,PsiClass.class);
    if (contextClass != null) {
      final PsiClassType contextType=JavaPsiFacade.getInstance(codeFragment.getProject()).getElementFactory().createType(contextClass);
      codeFragment.setThisType(contextType);
    }
  }
  if (myCurrentDocument != null) {
    for (    DocumentListener documentListener : myDocumentListeners) {
      myCurrentDocument.removeDocumentListener(documentListener);
    }
  }
  myCurrentDocument=PsiDocumentManager.getInstance(getProject()).getDocument(codeFragment);
  if (myCurrentDocument != null) {
    for (    DocumentListener documentListener : myDocumentListeners) {
      myCurrentDocument.addDocumentListener(documentListener);
    }
  }
  return myCurrentDocument;
}
