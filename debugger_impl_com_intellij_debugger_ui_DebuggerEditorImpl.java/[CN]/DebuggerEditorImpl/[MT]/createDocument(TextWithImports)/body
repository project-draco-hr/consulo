{
  LOG.assertTrue(myContext == null || myContext.isValid());
  if (item == null) {
    item=createText("");
  }
  PsiCodeFragment codeFragment=DefaultCodeFragmentFactory.getInstance().createCodeFragment(item,myContext,getProject());
  if (myContext != null) {
    final PsiClass contextClass=PsiTreeUtil.getNonStrictParentOfType(myContext,PsiClass.class);
    if (contextClass != null) {
      final PsiClassType contextType=codeFragment.getManager().getElementFactory().createType(contextClass);
      codeFragment.setThisType(contextType);
    }
  }
  if (myCurrentDocument != null) {
    for (    DocumentListener documentListener : myDocumentListeners) {
      myCurrentDocument.removeDocumentListener(documentListener);
    }
  }
  myCurrentDocument=PsiDocumentManager.getInstance(getProject()).getDocument(codeFragment);
  for (  DocumentListener documentListener : myDocumentListeners) {
    myCurrentDocument.addDocumentListener(documentListener);
  }
  return myCurrentDocument;
}
