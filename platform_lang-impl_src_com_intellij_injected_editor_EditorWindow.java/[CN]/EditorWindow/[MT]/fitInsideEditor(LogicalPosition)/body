{
  int lineCount=myDocumentWindow.getLineCount();
  if (pos.line >= lineCount) {
    pos=new LogicalPosition(lineCount - 1,pos.column);
  }
  int lineLength=myDocumentWindow.getLineEndOffset(pos.line) - myDocumentWindow.getLineStartOffset(pos.line);
  if (pos.column >= lineLength) {
    pos=new LogicalPosition(pos.line,Math.max(0,lineLength - 1));
  }
  return pos;
}
