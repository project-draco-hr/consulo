{
  LOG.assertTrue(dir.isValid());
  FileIndexFacade index=FileIndexFacade.getInstance(dir.getProject());
  VirtualFile virtualDir=dir.getVirtualFile();
  boolean onlyCompiled=index.isInLibraryClasses(virtualDir) && !index.isInSourceContent(virtualDir);
  List<PsiClass> classes=null;
  for (  PsiFile file : dir.getFiles()) {
    if (onlyCompiled && !(file instanceof ClsFileImpl)) {
      continue;
    }
    if (file instanceof PsiClassOwner && file.getViewProvider().getLanguages().size() == 1) {
      PsiClass[] psiClasses=((PsiClassOwner)file).getClasses();
      if (psiClasses.length == 0)       continue;
      if (classes == null)       classes=new ArrayList<PsiClass>();
      ContainerUtil.addAll(classes,psiClasses);
    }
  }
  return classes == null ? PsiClass.EMPTY_ARRAY : classes.toArray(new PsiClass[classes.size()]);
}
