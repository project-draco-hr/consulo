{
  GlobalSearchScope scope=null;
  Module[] modules=getConvertContextModules(this);
  if (modules.length != 0) {
    PsiFile file=getFile();
    file=file.getOriginalFile();
    VirtualFile virtualFile=file.getVirtualFile();
    if (virtualFile != null) {
      ProjectFileIndex fileIndex=ProjectRootManager.getInstance(file.getProject()).getFileIndex();
      boolean tests=fileIndex.isInTestSourceContent(virtualFile);
      for (      Module module : modules) {
        if (scope == null) {
          scope=module.getModuleRuntimeScope(tests);
        }
 else {
          scope=scope.union(module.getModuleRuntimeScope(tests));
        }
      }
    }
  }
  return scope;
}
