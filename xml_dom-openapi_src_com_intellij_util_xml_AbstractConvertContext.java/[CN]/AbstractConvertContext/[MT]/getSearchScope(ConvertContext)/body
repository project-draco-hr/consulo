{
  Module[] modules=getConvertContextModules(context);
  if (modules.length == 0)   return null;
  PsiFile file=context.getFile();
  file=file.getOriginalFile();
  VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile == null)   return null;
  ProjectFileIndex fileIndex=ProjectRootManager.getInstance(file.getProject()).getFileIndex();
  boolean tests=fileIndex.isInTestSourceContent(virtualFile);
  GlobalSearchScope scope=null;
  for (  Module module : modules) {
    if (scope == null) {
      scope=module.getModuleRuntimeScope(tests);
    }
 else {
      scope.union(module.getModuleRuntimeScope(tests));
    }
  }
  return scope;
}
