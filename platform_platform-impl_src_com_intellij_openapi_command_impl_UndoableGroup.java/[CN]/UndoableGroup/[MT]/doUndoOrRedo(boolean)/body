{
  Runnable runnable=new Runnable(){
    public void run(){
      try {
        for (        UndoableAction each : isUndo ? ContainerUtil.iterateBackward(myActions) : myActions) {
          if (isUndo) {
            each.undo();
          }
 else {
            each.redo();
          }
        }
      }
 catch (      UnexpectedUndoException e) {
        reportUndoProblem(e,isUndo);
      }
    }
  }
;
  if (myActions.size() > 50) {
    final Collection<DocumentEx> documents=new THashSet<DocumentEx>();
    for (    UndoableAction action : myActions) {
      DocumentReference[] affectedDocuments=action.getAffectedDocuments();
      if (affectedDocuments != null) {
        for (        DocumentReference affectedDocument : affectedDocuments) {
          documents.add((DocumentEx)affectedDocument.getDocument());
        }
      }
    }
    final Runnable oldRunnable=runnable;
    runnable=new Runnable(){
      @Override public void run(){
        doInBulkMode(oldRunnable,documents);
      }
    }
;
  }
  ApplicationManager.getApplication().runWriteAction(runnable);
  commitAllDocuments();
}
