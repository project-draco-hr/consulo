{
  DataContext dataContext=event.getDataContext();
  Project project=(Project)dataContext.getData(DataConstants.PROJECT);
  if (project == null)   return null;
  PsiElement method=null;
  Document document=null;
  if (ActionPlaces.PROJECT_VIEW_POPUP.equals(event.getPlace()) || ActionPlaces.STRUCTURE_VIEW_POPUP.equals(event.getPlace())) {
    final PsiElement psiElement=(PsiElement)dataContext.getData(DataConstants.PSI_ELEMENT);
    if (psiElement instanceof PsiMethod) {
      method=psiElement;
      document=PsiDocumentManager.getInstance(project).getDocument(method.getContainingFile());
    }
  }
 else {
    Editor editor=(Editor)dataContext.getData(DataConstants.EDITOR);
    if (editor == null) {
      editor=FileEditorManager.getInstance(project).getSelectedTextEditor();
    }
    if (editor != null) {
      document=editor.getDocument();
      PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(document);
      if (file != null) {
        FileTypeManager fileTypeManager=FileTypeManager.getInstance();
        FileType fileType=fileTypeManager.getFileTypeByFile(file.getVirtualFile());
        if (StdFileTypes.JAVA == fileType || StdFileTypes.CLASS == fileType) {
          method=findMethod(project,editor);
        }
      }
    }
  }
  if (method != null) {
    final PsiElement method1=method;
    final Document document1=document;
    return new PlaceInDocument(){
      public Document getDocument(){
        return document1;
      }
      public int getOffset(){
        return method1.getTextOffset();
      }
    }
;
  }
  return null;
}
