{
  ArrayList highlighters=new ArrayList();
  HighlightManager highlightManager=null;
  if (editor != null) {
    highlightManager=HighlightManager.getInstance(project);
    EditorColorsManager colorsManager=EditorColorsManager.getInstance();
    TextAttributes attributes=colorsManager.getGlobalScheme().getAttributes(EditorColors.SEARCH_RESULT_ATTRIBUTES);
    if (occurrences.length > 1) {
      highlightManager.addOccurrenceHighlights(editor,occurrences,attributes,true,highlighters);
    }
  }
  IntroduceVariableDialog dialog=new IntroduceVariableDialog(project,expr,occurrences.length,anyAssignmentLHS,declareFinalIfAll,typeSelectorManager,validator);
  dialog.show();
  if (!dialog.isOK()) {
    if (occurrences.length > 1) {
      WindowManager.getInstance().getStatusBar(project).setInfo("Press Escape to remove the highlighting");
    }
  }
 else {
    if (editor != null) {
      for (int i=0; i < highlighters.size(); i++) {
        RangeHighlighter highlighter=(RangeHighlighter)highlighters.get(i);
        highlightManager.removeSegmentHighlighter(editor,highlighter);
      }
    }
  }
  return dialog;
}
