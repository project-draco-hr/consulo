{
  if (project == null) {
    project=ProjectManager.getInstance().getDefaultProject();
  }
  if (fileType instanceof LanguageFileType) {
    final Language language=((LanguageFileType)fileType).getLanguage();
    final Language substitutedLanguage=LanguageSubstitutors.INSTANCE.substituteLanguage(language,file,project);
    if (substitutedLanguage != null) {
      return substitutedLanguage.getAssociatedFileType();
    }
  }
  return fileType;
}
