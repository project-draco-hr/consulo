{
  Object newPointer;
  if (treeElement == null) {
    newPointer=null;
  }
 else   if (isKeepTreeElementByHardReference()) {
    newPointer=treeElement;
  }
 else {
    newPointer=myManager.isBatchFilesProcessingMode() ? new PatchedWeakReference<ASTNode>(treeElement) : new PatchedSoftReference<ASTNode>(treeElement);
  }
synchronized (PsiLock.LOCK) {
    myTreeElementPointer=newPointer;
  }
}
