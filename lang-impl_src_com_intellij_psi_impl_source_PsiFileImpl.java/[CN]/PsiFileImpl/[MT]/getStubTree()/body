{
synchronized (myStubLock) {
    StubTree stubHolder=derefStub();
    if (stubHolder == null) {
      if (getTreeElementNoLock() == null) {
        final VirtualFile vFile=getVirtualFile();
        stubHolder=StubTree.readFromVFile(vFile,getProject());
        if (stubHolder != null) {
          myStub=new WeakReference<StubTree>(stubHolder);
          ((PsiFileStubImpl)stubHolder.getRoot()).setPsi(this);
        }
      }
    }
    return stubHolder;
  }
}
