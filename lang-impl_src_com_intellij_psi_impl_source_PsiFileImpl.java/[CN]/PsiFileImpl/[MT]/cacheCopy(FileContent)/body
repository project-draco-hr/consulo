{
  if (isContentsLoaded()) {
    return this;
  }
 else {
    CharSequence text;
    if (content == null) {
      Document document=FileDocumentManager.getInstance().getDocument(getVirtualFile());
      text=document.getCharsSequence();
    }
 else {
      text=CacheUtil.getContentText(content);
    }
    FileType fileType=getFileType();
    final String name=getName();
    PsiFile fileCopy=PsiFileFactory.getInstance(getProject()).createFileFromText(name,fileType,text,getModificationStamp(),false,false);
    fileCopy.putUserData(CacheUtil.CACHE_COPY_KEY,Boolean.TRUE);
    ((PsiFileImpl)fileCopy).setOriginalFile(this);
    return fileCopy;
  }
}
