{
  StubElement stub=myStub != null ? myStub.get() : null;
  if (stub == null) {
    if (getTreeElement() != null)     return null;
    final VirtualFile vFile=getVirtualFile();
    final int id=Math.abs(FileBasedIndex.getFileId(vFile));
    if (id > 0) {
      final List<SerializedStubContent> datas=FileBasedIndex.getInstance().getValues(StubIndex.INDEX_ID,id,getProject());
      if (datas.size() == 1) {
        final DataInputStream stream=new DataInputStream(new ByteArrayInputStream(datas.get(0).getBytes()));
        stub=SerializationManager.getInstance().deserialize(stream);
        ((PsiFileStubImpl)stub).setPsi(this);
        myStub=new WeakReference<StubElement>(stub);
      }
    }
  }
  return stub;
}
