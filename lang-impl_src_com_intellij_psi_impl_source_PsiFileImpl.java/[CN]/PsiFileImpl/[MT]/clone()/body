{
  FileViewProvider provider=getViewProvider().clone();
  final LanguageDialect dialect=getLanguageDialect();
  PsiFileImpl clone=(PsiFileImpl)provider.getPsi(getLanguage());
  if (clone == null && dialect != null) {
    clone=(PsiFileImpl)provider.getPsi(dialect);
  }
  copyCopyableDataTo(clone);
  if (getTreeElement() != null) {
    final FileElement treeClone=(FileElement)calcTreeElement().clone();
    clone.myTreeElementPointer=treeClone;
    treeClone.setPsiElement(clone);
  }
  if (getViewProvider().isEventSystemEnabled()) {
    clone.myOriginalFile=this;
  }
 else   if (myOriginalFile != null) {
    clone.myOriginalFile=myOriginalFile;
  }
  if (dialect != null) {
    clone.putUserData(PsiManagerImpl.LANGUAGE_DIALECT,dialect);
  }
  return clone;
}
