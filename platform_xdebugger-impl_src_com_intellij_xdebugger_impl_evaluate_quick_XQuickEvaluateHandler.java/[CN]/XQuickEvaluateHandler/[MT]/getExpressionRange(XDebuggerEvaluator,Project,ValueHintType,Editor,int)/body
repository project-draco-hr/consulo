{
  SelectionModel selectionModel=editor.getSelectionModel();
  int selectionStart=selectionModel.getSelectionStart();
  int selectionEnd=selectionModel.getSelectionEnd();
  if ((type == ValueHintType.MOUSE_CLICK_HINT || type == ValueHintType.MOUSE_ALT_OVER_HINT) && selectionModel.hasSelection() && selectionStart <= offset && offset <= selectionEnd) {
    return new TextRange(selectionStart,selectionEnd);
  }
  return evaluator.getExpressionRangeAtOffset(project,editor.getDocument(),offset);
}
