{
  int lastIndex=0;
  while (true) {
    lastIndex=text.indexOf(SHORTCUT_ENTITY,lastIndex);
    if (lastIndex < 0)     return;
    final int actionIdStart=lastIndex + SHORTCUT_ENTITY.length();
    int actionIdEnd=text.indexOf(";",actionIdStart);
    if (actionIdEnd < 0) {
      return;
    }
    final String actionId=text.substring(actionIdStart,actionIdEnd);
    final Shortcut[] shortcuts=KeymapManager.getInstance().getActiveKeymap().getShortcuts(actionId);
    String shortcutText="";
    for (int i=0; i < shortcuts.length; i++) {
      final Shortcut shortcut=shortcuts[i];
      if (shortcut instanceof KeyboardShortcut) {
        shortcutText=KeymapUtil.getShortcutText(shortcut);
      }
    }
    final String replacement=MessageFormat.format(SHORTCUT_HTML_TEMPLATE,new Object[]{shortcutText});
    text.replace(lastIndex,actionIdEnd + 1,replacement);
    lastIndex+=replacement.length();
  }
}
