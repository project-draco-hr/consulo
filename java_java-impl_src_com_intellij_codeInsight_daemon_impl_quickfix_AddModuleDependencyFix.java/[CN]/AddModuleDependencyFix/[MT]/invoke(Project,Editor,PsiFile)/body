{
  if (myModules.size() == 1) {
    addDependencyOnModule(project,editor,myModules.get(0));
  }
 else {
    final JBList list=new JBList(myModules);
    list.setCellRenderer(new ListCellRendererWrapper<Module>(){
      @Override public void customize(      JList list,      Module module,      int index,      boolean selected,      boolean hasFocus){
        if (module != null) {
          setIcon(ModuleType.get(module).getIcon());
          setText(module.getName());
        }
      }
    }
);
    final JBPopup popup=JBPopupFactory.getInstance().createListPopupBuilder(list).setTitle("Choose Module to Add Dependency on").setMovable(false).setResizable(false).setRequestFocus(true).setItemChoosenCallback(new Runnable(){
      @Override public void run(){
        final Object value=list.getSelectedValue();
        if (value instanceof Module) {
          addDependencyOnModule(project,editor,(Module)value);
        }
      }
    }
).createPopup();
    if (editor != null) {
      popup.showInBestPositionFor(editor);
    }
 else {
      popup.showCenteredInCurrentWindow(project);
    }
  }
}
