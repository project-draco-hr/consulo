{
  final StringBuffer buf=new StringBuffer();
  final HTMLComposerImpl htmlComposer=getPresentation(toolWrapper).getComposer();
  if (refEntity instanceof RefElement) {
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      @Override public void run(){
        htmlComposer.compose(buf,refEntity);
      }
    }
);
  }
 else {
    htmlComposer.compose(buf,refEntity);
  }
  uppercaseFirstLetter(buf);
  if (refEntity instanceof RefElement) {
    appendSuppressSection(buf);
  }
  insertHeaderFooter(buf);
  return buf.toString();
}
