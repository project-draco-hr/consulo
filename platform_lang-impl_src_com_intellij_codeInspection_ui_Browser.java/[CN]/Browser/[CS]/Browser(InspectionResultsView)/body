{
  super(new BorderLayout());
  myView=view;
  myClickListeners=new ArrayList<ClickListener>();
  myCurrentEntity=null;
  myCurrentDescriptor=null;
  myHTMLViewer=new JEditorPane(UIUtil.HTML_MIME,InspectionsBundle.message("inspection.offline.view.empty.browser.text"));
  myHTMLViewer.setEditable(false);
  myHyperLinkListener=new HyperlinkListener(){
    public void hyperlinkUpdate(    HyperlinkEvent e){
      if (e.getEventType() == HyperlinkEvent.EventType.ACTIVATED) {
        JEditorPane pane=(JEditorPane)e.getSource();
        if (e instanceof HTMLFrameHyperlinkEvent) {
          HTMLFrameHyperlinkEvent evt=(HTMLFrameHyperlinkEvent)e;
          HTMLDocument doc=(HTMLDocument)pane.getDocument();
          doc.processHTMLFrameHyperlinkEvent(evt);
        }
 else {
          try {
            URL url=e.getURL();
            @NonNls String ref=url.getRef();
            if (ref.startsWith("pos:")) {
              int delimeterPos=ref.indexOf(':',"pos:".length() + 1);
              String startPosition=ref.substring("pos:".length(),delimeterPos);
              String endPosition=ref.substring(delimeterPos + 1);
              Integer textStartOffset=new Integer(startPosition);
              Integer textEndOffset=new Integer(endPosition);
              String fileURL=url.toExternalForm();
              fileURL=fileURL.substring(0,fileURL.indexOf('#'));
              VirtualFile vFile=VirtualFileManager.getInstance().findFileByUrl(fileURL);
              if (vFile != null) {
                fireClickEvent(vFile,textStartOffset.intValue(),textEndOffset.intValue());
              }
            }
 else             if (ref.startsWith("descr:")) {
              if (myCurrentDescriptor instanceof ProblemDescriptor) {
                PsiElement psiElement=((ProblemDescriptor)myCurrentDescriptor).getPsiElement();
                if (psiElement == null)                 return;
                VirtualFile vFile=psiElement.getContainingFile().getVirtualFile();
                if (vFile != null) {
                  TextRange range=((ProblemDescriptorImpl)myCurrentDescriptor).getTextRange();
                  fireClickEvent(vFile,range.getStartOffset(),range.getEndOffset());
                }
              }
            }
 else             if (ref.startsWith("invoke:")) {
              int actionNumber=Integer.parseInt(ref.substring("invoke:".length()));
              getTool().getQuickFixes(new RefElement[]{(RefElement)myCurrentEntity})[actionNumber].doApplyFix(new RefElement[]{(RefElement)myCurrentEntity},myView);
            }
 else             if (ref.startsWith("invokelocal:")) {
              int actionNumber=Integer.parseInt(ref.substring("invokelocal:".length()));
              if (actionNumber > -1) {
                invokeLocalFix(actionNumber);
              }
            }
 else             if (ref.startsWith("suppress:")) {
              final SuppressActionWrapper.SuppressTreeAction[] suppressTreeActions=new SuppressActionWrapper(myView.getProject(),getTool(),myView.getTree().getSelectionPaths()).getChildren(null);
              final List<AnAction> activeActions=new ArrayList<AnAction>();
              for (              SuppressActionWrapper.SuppressTreeAction suppressTreeAction : suppressTreeActions) {
                if (suppressTreeAction.isAvailable())                 activeActions.add(suppressTreeAction);
              }
              if (!activeActions.isEmpty()) {
                int actionNumber=Integer.parseInt(ref.substring("suppress:".length()));
                if (actionNumber > -1 && activeActions.size() > actionNumber) {
                  activeActions.get(actionNumber).actionPerformed(null);
                }
              }
            }
 else {
              int offset=Integer.parseInt(ref);
              String fileURL=url.toExternalForm();
              fileURL=fileURL.substring(0,fileURL.indexOf('#'));
              VirtualFile vFile=VirtualFileManager.getInstance().findFileByUrl(fileURL);
              if (vFile == null) {
                vFile=VfsUtil.findFileByURL(url);
              }
              if (vFile != null) {
                fireClickEvent(vFile,offset,offset);
              }
            }
          }
 catch (          Throwable t) {
          }
        }
      }
    }
  }
;
  myHTMLViewer.addHyperlinkListener(myHyperLinkListener);
  add(new JScrollPane(myHTMLViewer),BorderLayout.CENTER);
}
