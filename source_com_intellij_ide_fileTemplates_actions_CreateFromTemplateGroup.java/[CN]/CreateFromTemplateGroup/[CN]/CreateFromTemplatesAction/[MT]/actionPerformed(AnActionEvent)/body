{
  DataContext dataContext=e.getDataContext();
  IdeView view=(IdeView)dataContext.getData(DataConstantsEx.IDE_VIEW);
  if (view == null) {
    return;
  }
  Project project=(Project)dataContext.getData(DataConstants.PROJECT);
  PsiDirectory dir=PackageUtil.getOrChooseDirectory(view);
  if (dir == null)   return;
  FileTemplate[] allTemplates=FileTemplateManager.getInstance().getAllTemplates();
  List<FileTemplate> available=new ArrayList<FileTemplate>();
  for (int i=0; i < allTemplates.length; i++) {
    FileTemplate template=allTemplates[i];
    if (canCreateFromTemplate(e,template)) {
      available.add(template);
    }
  }
  SelectTemplateDialog dialog=new SelectTemplateDialog(project,dir);
  dialog.show();
  FileTemplate selectedTemplate=dialog.getSelectedTemplate();
  if (selectedTemplate != null) {
    PsiElement createdElement=showCreateFromTemplateDialog(project,dir,selectedTemplate);
    if (createdElement != null) {
      view.selectElement(createdElement);
    }
  }
}
