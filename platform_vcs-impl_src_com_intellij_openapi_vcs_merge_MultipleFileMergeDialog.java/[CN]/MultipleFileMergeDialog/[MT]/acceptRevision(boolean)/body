{
  FileDocumentManager.getInstance().saveAllDocuments();
  final Collection<VirtualFile> files=myTable.getSelection();
  if (!beforeResolve(files)) {
    return;
  }
  for (  final VirtualFile file : files) {
    final Ref<Exception> ex=new Ref<Exception>();
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      @Override public void run(){
        CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
          @Override public void run(){
            try {
              if (!(myProvider instanceof MergeProvider2) || myMergeSession.canMerge(file)) {
                if (!DiffUtil.makeWritable(myProject,file)) {
                  throw new IOException("File is read-only: " + file.getPresentableName());
                }
                MergeData data=myProvider.loadRevisions(file);
                if (isCurrent) {
                  file.setBinaryContent(data.CURRENT);
                }
 else {
                  file.setBinaryContent(data.LAST);
                  checkMarkModifiedProject(file);
                }
              }
              markFileProcessed(file,isCurrent ? MergeSession.Resolution.AcceptedYours : MergeSession.Resolution.AcceptedTheirs);
            }
 catch (            Exception e) {
              ex.set(e);
            }
          }
        }
,"Accept " + (isCurrent ? "Yours" : "Theirs"),null);
      }
    }
);
    if (!ex.isNull()) {
      Messages.showErrorDialog(myRootPanel,"Error saving merged data: " + ex.get().getMessage());
      break;
    }
  }
  updateModelFromFiles();
}
