{
  Module module=e.getData(LangDataKeys.MODULE);
  VirtualFile[] vFiles=e.getData(PlatformDataKeys.VIRTUAL_FILE_ARRAY);
  if (module == null || vFiles == null) {
    return false;
  }
  final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(module.getProject()).getFileIndex();
  for (  VirtualFile vFile : vFiles) {
    if (!vFile.isDirectory()) {
      return false;
    }
    if (!fileIndex.isInContent(vFile)) {
      return false;
    }
    if (Comparing.equal(fileIndex.getSourceRootForFile(vFile),vFile)) {
      boolean isTestSourceRoot=fileIndex.isInTestSourceContent(vFile);
      if (acceptSourceRoot && !isTestSourceRoot) {
        if (rootType != null)         rootType.set(true);
        return true;
      }
      if (acceptTestSourceRoot && isTestSourceRoot) {
        if (rootType != null)         rootType.set(false);
        return true;
      }
    }
    if (fileIndex.isInSourceContent(vFile) && !acceptInSourceContent) {
      return false;
    }
  }
  return true;
}
