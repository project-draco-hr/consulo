{
  String vmName=System.getProperty("java.vm.name");
  if (vmName == null || !vmName.toLowerCase().contains("jrockit")) {
    return;
  }
  byte[] bytes;
  InputStream in=StartupUtil.class.getResourceAsStream("/org/xerial/snappy/SnappyNativeLoader.bytecode");
  try {
    bytes=FileUtil.loadBytes(in);
  }
  finally {
    in.close();
  }
  ClassLoader classLoader=StartupUtil.class.getClassLoader();
  Method defineClass=ClassLoader.class.getDeclaredMethod("defineClass",String.class,byte[].class,int.class,int.class);
  defineClass.setAccessible(true);
  Class<?> loaderClass=(Class<?>)defineClass.invoke(classLoader,"org.xerial.snappy.SnappyNativeLoader",bytes,0,bytes.length);
  loaderClass=classLoader.loadClass(loaderClass.getName());
  String[] classes={"org.xerial.snappy.SnappyNativeAPI","org.xerial.snappy.SnappyNative","org.xerial.snappy.SnappyErrorCode"};
  for (  String aClass : classes) {
    classLoader.loadClass(aClass);
  }
  Method loadNativeLibrary=SnappyLoader.class.getDeclaredMethod("loadNativeLibrary",Class.class);
  loadNativeLibrary.setAccessible(true);
  loadNativeLibrary.invoke(null,loaderClass);
}
