{
  if (!myInspectionComponentsLoaded.getAndSet(true)) {
    Set<InspectionToolProvider> providers=new THashSet<InspectionToolProvider>();
    providers.addAll(Arrays.asList(ApplicationManager.getApplication().getComponents(InspectionToolProvider.class)));
    providers.addAll(Arrays.asList(Extensions.getExtensions(InspectionToolProvider.EXTENSION_POINT_NAME)));
    registerTools(providers.toArray(new InspectionToolProvider[providers.size()]));
    for (    InspectionToolsFactory factory : Extensions.getExtensions(InspectionToolsFactory.EXTENSION_POINT_NAME)) {
      for (      final InspectionProfileEntry profileEntry : factory.createTools()) {
        myInspectionToolFactories.add(new Factory<InspectionTool>(){
          public InspectionTool create(){
            if (profileEntry instanceof LocalInspectionTool) {
              return new LocalInspectionToolWrapper((LocalInspectionTool)profileEntry);
            }
 else             if (profileEntry instanceof GlobalInspectionTool) {
              return new GlobalInspectionToolWrapper((GlobalInspectionTool)profileEntry);
            }
            return (InspectionTool)profileEntry;
          }
        }
);
      }
    }
  }
}
