{
  Query<VirtualFile> dirs=myDirectoryIndex.getDirectoriesByPackageName(qualifiedName,false);
  if (dirs.findFirst() == null) {
    return null;
  }
  PsiManager psiManager=PsiManager.getInstance(myProject);
  final Iterator<VirtualFile> iterator=dirs.iterator();
  while (iterator.hasNext()) {
    final VirtualFile next=iterator.next();
    final Module moduleForFile=ModuleUtil.findModuleForFile(next,myProject);
    if (moduleForFile == null) {
      continue;
    }
    ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(moduleForFile);
    final ModuleExtension extension=moduleRootManager.getExtension(extensionClass);
    if (extension == null) {
      continue;
    }
    for (    PsiPackageSupportProvider p : PsiPackageSupportProvider.EP_NAME.getExtensions()) {
      if (p.isSupported(extension)) {
        return p.createPackage(psiManager,this,extensionClass,qualifiedName);
      }
    }
  }
  return null;
}
