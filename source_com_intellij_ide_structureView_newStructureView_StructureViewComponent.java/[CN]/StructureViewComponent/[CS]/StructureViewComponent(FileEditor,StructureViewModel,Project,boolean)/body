{
  super(new BorderLayout());
  myProject=project;
  myFileEditor=editor;
  myTreeModel=structureViewModel;
  myShowRootNode=showRootNode;
  myTreeModelWrapper=new TreeModelWrapper(myTreeModel,this);
  SmartTreeStructure treeStructure=new SmartTreeStructure(project,myTreeModelWrapper){
    public void rebuildTree(){
      storeState();
      super.rebuildTree();
      restoreState();
    }
    protected TreeElementWrapper createTree(){
      return new StructureViewTreeElementWrapper(myProject,myModel.getRoot(),myModel);
    }
  }
;
  final DefaultTreeModel model=new DefaultTreeModel(new DefaultMutableTreeNode(treeStructure.getRootElement()));
  JTree tree=new Tree(model);
  tree.setRootVisible(myShowRootNode);
  myAbstractTreeBuilder=new StructureTreeBuilder(project,tree,(DefaultTreeModel)tree.getModel(),treeStructure,myTreeModelWrapper);
  myAbstractTreeBuilder.updateFromRoot();
  Disposer.register(this,myAbstractTreeBuilder);
  Disposer.register(myAbstractTreeBuilder,new Disposable(){
    public void dispose(){
      storeState();
    }
  }
);
  add(new JScrollPane(myAbstractTreeBuilder.getTree()),BorderLayout.CENTER);
  myAbstractTreeBuilder.getTree().setCellRenderer(new NodeRenderer());
  myAutoScrollToSourceHandler=new MyAutoScrollToSourceHandler();
  myAutoScrollFromSourceHandler=new MyAutoScrollFromSourceHandler(myProject);
  JComponent toolbarComponent=ActionManager.getInstance().createActionToolbar(ActionPlaces.STRUCTURE_VIEW_TOOLBAR,createActionGroup(),true).getComponent();
  add(toolbarComponent,BorderLayout.NORTH);
  installTree();
  myCopyPasteDelegator=new CopyPasteManagerEx.CopyPasteDelegator(myProject,getTree()){
    protected PsiElement[] getSelectedElements(){
      return StructureViewComponent.this.getSelectedPsiElements();
    }
  }
;
}
