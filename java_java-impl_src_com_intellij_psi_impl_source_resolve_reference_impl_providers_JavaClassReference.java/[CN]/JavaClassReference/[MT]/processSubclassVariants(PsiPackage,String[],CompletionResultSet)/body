{
  GlobalSearchScope packageScope=PackageScope.packageScope(context,true);
  GlobalSearchScope scope=myJavaClassReferenceSet.getProvider().getScope(getElement().getProject());
  if (scope != null) {
    packageScope=packageScope.intersectWith(scope);
  }
  final GlobalSearchScope allScope=ProjectScope.getAllScope(context.getProject());
  final boolean instantiatable=JavaClassReferenceProvider.INSTANTIATABLE.getBooleanValue(getOptions());
  final boolean notInterface=JavaClassReferenceProvider.NOT_INTERFACE.getBooleanValue(getOptions());
  final boolean notEnum=JavaClassReferenceProvider.NOT_ENUM.getBooleanValue(getOptions());
  final boolean concrete=JavaClassReferenceProvider.CONCRETE.getBooleanValue(getOptions());
  final ClassKind classKind=getClassKind();
  for (  String extendClassName : extendClasses) {
    final PsiClass extendClass=JavaPsiFacade.getInstance(context.getProject()).findClass(extendClassName,allScope);
    if (extendClass != null) {
      if (packageScope.contains(extendClass.getContainingFile().getVirtualFile())) {
        if (isClassAccepted(extendClass,classKind,instantiatable,concrete,notInterface,notEnum)) {
          result.addElement(createSubclassLookupValue(extendClass,extendClassName));
        }
      }
      for (      final PsiClass clazz : ClassInheritorsSearch.search(extendClass,packageScope,true)) {
        String qname=clazz.getQualifiedName();
        if (qname != null && isClassAccepted(clazz,classKind,instantiatable,concrete,notInterface,notEnum)) {
          result.addElement(createSubclassLookupValue(clazz,qname));
        }
      }
    }
  }
}
