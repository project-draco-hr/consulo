def addbranchrevs(lrepo, repo, branches, revs):
    if (not branches):
        return ((revs or None), ((revs and revs[0]) or None))
    revs = ((revs and list(revs)) or [])
    if (not repo.capable('branchmap')):
        revs.extend(branches)
        return (revs, revs[0])
    branchmap = repo.branchmap()
    for branch in branches:
        if (branch == '.'):
            if ((not lrepo) or (not lrepo.local())):
                raise util.Abort(_('dirstate branch not accessible'))
            revs.append(lrepo.dirstate.branch())
        else:
            butf8 = encoding.fromlocal(branch)
            if (butf8 in branchmap):
                revs.extend((node.hex(r) for r in reversed(branchmap[butf8])))
            else:
                revs.append(branch)
    return (revs, revs[0])
