{
  Collections.sort(changes,ChangeList.CHANGE_ORDER);
  ArrayList<Interval> intervals1=new ArrayList<Interval>();
  ArrayList<Interval> intervals2=new ArrayList<Interval>();
  ArrayList<TextDiffType> types=new ArrayList<TextDiffType>();
  for (  Change change : changes) {
    if (!change.isValid()) {
      continue;
    }
    int start1=change.getChangeSide(FragmentSide.SIDE1).getStartLine();
    int end1=change.getChangeSide(FragmentSide.SIDE1).getEndLine();
    intervals1.add(Interval.fromTo(start1,end1));
    int start2=change.getChangeSide(FragmentSide.SIDE2).getStartLine();
    int end2=change.getChangeSide(FragmentSide.SIDE2).getEndLine();
    intervals2.add(Interval.fromTo(start2,end2));
    types.add(change.getType().getTypeKey());
  }
  return create(intervals1.toArray(new Interval[intervals1.size()]),intervals2.toArray(new Interval[intervals2.size()]),types.toArray(new TextDiffType[types.size()]));
}
