{
  LOG.assertTrue(searchScope != null);
  if (aClass instanceof PsiAnonymousClass)   return true;
  if (aClass.hasModifierProperty(PsiModifier.FINAL))   return true;
  String name=aClass.getName();
  RepositoryManager repositoryManager=myManager.getRepositoryManager();
  RepositoryElementsManager repositoryElementsManager=myManager.getRepositoryElementsManager();
  if ("java.lang.Object".equals(aClass.getQualifiedName())) {
  }
  if (aClass instanceof PsiAspect) {
    PsiAspectManager aspectManager=aClass.getManager().getAspectManager();
    PsiAspect[] aspects=aspectManager.getAspects();
    for (    PsiAspect aspect : aspects) {
      if (!processInheritorCandidate(processor,aspect,aClass,searchScope,checkDeep,processed,checkInheritance)) {
        return false;
      }
    }
    return true;
  }
  final SearchScope searchScope1=searchScope.intersectWith(aClass.getUseScope());
  RepositoryIndex repositoryIndex=repositoryManager.getIndex();
  VirtualFileFilter rootFilter;
  if (!checkDeep && searchScope1 instanceof GlobalSearchScope) {
    rootFilter=repositoryIndex.rootFilterBySearchScope((GlobalSearchScope)searchScope1);
  }
 else {
    rootFilter=null;
  }
  PsiClass[] candidates;
synchronized (PsiLock.LOCK) {
    long[] candidateIds=repositoryIndex.getNameOccurrencesInExtendsLists(name,rootFilter);
    candidates=new PsiClass[candidateIds.length];
    for (int i=0; i < candidateIds.length; i++) {
      candidates[i]=(PsiClass)repositoryElementsManager.findOrCreatePsiElementById(candidateIds[i]);
    }
  }
  for (  PsiClass candidate : candidates) {
    LOG.assertTrue(candidate.isValid());
    if (!processInheritorCandidate(processor,candidate,aClass,searchScope,checkDeep,processed,checkInheritance)) {
      return false;
    }
  }
  final EjbClassRole classRole=J2EERolesUtil.getEjbRole(aClass);
  if (classRole != null && classRole.isDeclarationRole()) {
    final PsiClass[] implementations=classRole.findImplementations();
    for (    PsiClass candidate : implementations) {
      if (!processInheritorCandidate(processor,candidate,aClass,searchScope,checkDeep,processed,checkInheritance)) {
        return false;
      }
    }
  }
  return true;
}
