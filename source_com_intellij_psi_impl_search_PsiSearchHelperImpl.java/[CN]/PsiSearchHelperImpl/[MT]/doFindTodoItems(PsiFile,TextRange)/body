{
  final Collection<IndexPatternOccurrence> occurrences=IndexPatternSearch.search(file,TodoConfiguration.getInstance()).findAll();
  if (occurrences.isEmpty()) {
    return EMPTY_TODO_ITEMS;
  }
  List<TodoItem> items=new ArrayList<TodoItem>(occurrences.size());
  for (  IndexPatternOccurrence occurrence : occurrences) {
    if (!textRange.contains(occurrence.getTextRange()))     continue;
    items.add(new TodoItemImpl(occurrence.getFile(),occurrence.getTextRange().getStartOffset(),occurrence.getTextRange().getEndOffset(),mapPattern(occurrence.getPattern())));
  }
  return items.toArray(new TodoItem[items.size()]);
}
