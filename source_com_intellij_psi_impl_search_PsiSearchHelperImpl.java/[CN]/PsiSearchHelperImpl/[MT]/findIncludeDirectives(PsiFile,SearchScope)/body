{
  LOG.assertTrue(searchScope != null);
  if (!(file instanceof JspFile))   return XmlTag.EMPTY;
  String name=file.getVirtualFile().getName();
  final ArrayList<XmlTag> directives=new ArrayList<XmlTag>();
  PsiElementProcessorEx processor=new PsiElementProcessorEx(){
    public boolean execute(    PsiElement element,    int offsetInElement){
      ASTNode parent=(SourceTreeToPsiMap.psiElementToTree(element)).getTreeParent();
      if (parent.getElementType() == ElementType.JSP_FILE_REFERENCE) {
        ASTNode pparent=parent.getTreeParent();
        if (SourceTreeToPsiMap.treeElementToPsi(pparent) instanceof XmlAttribute) {
          XmlTag directive=(XmlTag)pparent.getTreeParent().getPsi();
          if (directive.getName().equals("include")) {
            XmlAttribute attribute=(XmlAttribute)SourceTreeToPsiMap.treeElementToPsi(pparent);
            if (attribute.getName().equals("file")) {
              PsiFile refFile=(PsiFile)((PsiJavaCodeReferenceElement)SourceTreeToPsiMap.treeElementToPsi(parent)).resolve();
              if (file.equals(refFile)) {
                directives.add(directive);
              }
            }
          }
        }
      }
      return true;
    }
  }
;
  processElementsWithWord(processor,searchScope,name,UsageSearchContext.IN_FOREIGN_LANGUAGES,true);
  return directives.toArray(new XmlTag[directives.size()]);
}
