{
  if (module == null)   return new Library[0];
  final ArrayList<Library> libraries=new ArrayList<Library>();
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      ModuleRootManager manager=ModuleRootManager.getInstance(module);
      ModifiableRootModel model=manager.getModifiableModel();
      for (      OrderEntry entry : model.getOrderEntries()) {
        if (entry instanceof LibraryOrderEntry) {
          LibraryOrderEntry libEntry=(LibraryOrderEntry)entry;
          Library library=libEntry.getLibrary();
          if (condition.value(library)) {
            libraries.add(library);
          }
        }
      }
    }
  }
);
  return libraries.toArray(new Library[libraries.size()]);
}
