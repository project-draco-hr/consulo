{
  myCurrentFold=null;
  myStartOffset=myEndOffset;
  FoldRegion range=myFoldingModel.fetchOutermost(myStartOffset);
  if (range != null) {
    myEndOffset=range.getEndOffset();
    myCurrentFold=range;
  }
 else {
    advanceSegmentHighlighters();
    myEndOffset=Math.min(getHighlighterEnd(myStartOffset),getSelectionEnd(myStartOffset));
    myEndOffset=Math.min(myEndOffset,getSegmentHighlightersEnd());
    myEndOffset=Math.min(myEndOffset,getFoldRangesEnd(myStartOffset));
    myEndOffset=Math.min(myEndOffset,getCaretEnd(myStartOffset));
    myEndOffset=Math.min(myEndOffset,getGuardedBlockEnd(myStartOffset));
  }
  reinit();
}
