{
  int end=myEnd;
  FoldRegion[] topLevelCollapsed=myFoldingModel.fetchTopLevel();
  if (topLevelCollapsed != null) {
    for (int i=myFoldingModel.getLastCollapsedRegionBefore(startOffset) + 1; i >= 0 && i < topLevelCollapsed.length; i++) {
      FoldRegion range=topLevelCollapsed[i];
      if (!range.isValid())       continue;
      int rangeEnd=range.getStartOffset();
      if (rangeEnd > startOffset) {
        if (rangeEnd < end) {
          end=rangeEnd;
        }
 else {
          break;
        }
      }
    }
  }
  return end;
}
