{
  final Set<AnAction> actions=new HashSet<AnAction>();
  final Set<Object> settings=new HashSet<Object>();
  final HashSet<AnAction> toolWindows=new HashSet<AnAction>();
  final MinusculeMatcher matcher=new MinusculeMatcher("*" + pattern,NameUtil.MatchingCaseSensitivity.NONE);
  List<MatchResult> matches=collectResults(pattern,myActions,myActionModel);
  for (  MatchResult o : matches) {
    Object[] objects=myActionModel.getElementsByName(o.elementName,true,pattern);
    for (    Object object : objects) {
      if (isSetting(object) && settings.size() < 7) {
        if (matcher.matches(getSettingText((OptionDescription)object))) {
          settings.add(object);
        }
      }
 else       if (isToolWindowAction(object) && toolWindows.size() < 10) {
        toolWindows.add((AnAction)((Map.Entry)object).getKey());
      }
 else       if (isActionValue(object) && actions.size() < 7) {
        actions.add((AnAction)((Map.Entry)object).getKey());
      }
    }
  }
  myProgressIndicator.checkCanceled();
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      if (myProgressIndicator.isCanceled())       return;
      if (toolWindows.size() > 0) {
        myTitleIndexes.toolWindows=myListModel.size();
        for (        Object toolWindow : toolWindows) {
          myListModel.addElement(toolWindow);
        }
      }
      if (actions.size() > 0) {
        myTitleIndexes.actions=myListModel.size();
        for (        Object action : actions) {
          myListModel.addElement(action);
        }
      }
      myMoreActionsIndex=actions.size() >= 7 ? myListModel.size() - 1 : -1;
      if (settings.size() > 0) {
        myTitleIndexes.settings=myListModel.size();
        for (        Object setting : settings) {
          myListModel.addElement(setting);
        }
      }
      myMoreSettingsIndex=settings.size() >= 7 ? myListModel.size() - 1 : -1;
    }
  }
);
}
