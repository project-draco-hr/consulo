{
  PsiManager manager=expr.getManager();
  PsiElementFactory factory=JavaPsiFacade.getInstance(manager.getProject()).getElementFactory();
  CodeStyleManager codeStyleManager=CodeStyleManager.getInstance(project);
  @NonNls String text="if(a != null){\nst;\n}";
  PsiIfStatement ifStatement=(PsiIfStatement)factory.createStatementFromText(text,null);
  ifStatement=(PsiIfStatement)codeStyleManager.reformat(ifStatement);
  ((PsiBinaryExpression)ifStatement.getCondition()).getLOperand().replace(expr);
  PsiExpressionStatement statement=PsiTreeUtil.getParentOfType(expr,PsiExpressionStatement.class);
  String oldText=statement.getText();
  ifStatement=(PsiIfStatement)statement.replace(ifStatement);
  PsiCodeBlock block=((PsiBlockStatement)ifStatement.getThenBranch()).getCodeBlock();
  block=CodeInsightUtilBase.forcePsiPostprocessAndRestoreElement(block);
  PsiElement replace=block.getStatements()[0].replace(factory.createStatementFromText(oldText,block));
  int offset=replace.getTextRange().getEndOffset();
  return new TextRange(offset,offset);
}
