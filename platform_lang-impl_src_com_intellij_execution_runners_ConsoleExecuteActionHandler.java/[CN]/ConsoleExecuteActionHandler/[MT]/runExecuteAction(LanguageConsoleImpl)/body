{
  final Document document=languageConsole.getCurrentEditor().getDocument();
  final String text=document.getText();
  final TextRange range=new TextRange(0,document.getTextLength());
  languageConsole.getCurrentEditor().getSelectionModel().setSelection(range.getStartOffset(),range.getEndOffset());
  if (myAddCurrentToHistory) {
    languageConsole.addCurrentToHistory(range,false,myPreserveMarkup);
  }
  languageConsole.setInputText("");
  final UndoManager manager=languageConsole.getProject() == null ? UndoManager.getGlobalInstance() : UndoManager.getInstance(languageConsole.getProject());
  ((UndoManagerImpl)manager).invalidateActionsFor(DocumentReferenceManager.getInstance().create(document));
  myConsoleHistoryModel.addToHistory(text);
  processLine(text);
}
