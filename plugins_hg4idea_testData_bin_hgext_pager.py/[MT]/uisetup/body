def uisetup(ui):

    def pagecmd(orig, ui, options, cmd, cmdfunc):
        p = ui.config('pager', 'pager', os.environ.get('PAGER'))
        if (p and sys.stdout.isatty() and ('--debugger' not in sys.argv)):
            attend = ui.configlist('pager', 'attend', attended)
            if ((cmd in attend) or ((cmd not in ui.configlist('pager', 'ignore')) and (not attend))):
                ui.setconfig('ui', 'interactive', False)
                sys.stderr = sys.stdout = util.popen(p, 'wb')
                if ui.configbool('pager', 'quiet'):
                    signal.signal(signal.SIGPIPE, signal.SIG_DFL)
        return orig(ui, options, cmd, cmdfunc)
    extensions.wrapfunction(dispatch, '_runcommand', pagecmd)
