def generate(ui, dag, displayer, showparents, edgefn):
    (seen, state) = ([], asciistate())
    for (rev, type, ctx, parents) in dag:
        char = (((ctx.node() in showparents) and '@') or 'o')
        displayer.show(ctx)
        lines = displayer.hunk.pop(rev).split('\n')[:(-1)]
        ascii(ui, state, type, char, lines, edgefn(seen, rev, parents))
