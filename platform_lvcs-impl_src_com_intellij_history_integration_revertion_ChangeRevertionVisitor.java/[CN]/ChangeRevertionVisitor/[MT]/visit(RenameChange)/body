{
  if (shouldRevert(c)) {
    Entry e=getAffectedEntry(c);
    VirtualFile f=myGateway.findOrCreateFileSafely(e.getPath(),e.isDirectory());
    c.revertOn(myRoot);
    String newName=getName(e);
    VirtualFile existing=f.getParent().findChild(newName);
    if (existing != null && existing != f) {
      existing.delete(this);
    }
    f.rename(this,newName);
  }
 else {
    c.revertOn(myRoot);
  }
  checkShouldStop(c);
}
