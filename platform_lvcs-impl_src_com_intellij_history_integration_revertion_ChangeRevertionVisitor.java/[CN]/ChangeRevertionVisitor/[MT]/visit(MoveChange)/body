{
  if (shouldRevert(c)) {
    Entry e=getAffectedEntry(c,1);
    VirtualFile f=myGateway.findOrCreateFileSafely(e.getPath(),e.isDirectory());
    c.revertOn(myRoot);
    String parentPath=getParentPath(getAffectedEntry(c));
    VirtualFile parent=myGateway.findOrCreateFileSafely(parentPath,true);
    VirtualFile existing=parent.findChild(e.getName());
    if (existing != null)     existing.delete(this);
    f.move(this,parent);
  }
 else {
    c.revertOn(myRoot);
  }
  checkShouldStop(c);
}
