{
  doTest(new PerformAction(){
    public void performAction(    VirtualFile rootDir,    VirtualFile rootAfter) throws Exception {
      PsiClass aClass=myJavaFacade.findClass("XX",GlobalSearchScope.allScope(getProject()));
      assertNotNull("Class XX not found",aClass);
      final RenameProcessor processor=new RenameProcessor(myProject,aClass,"Y",true,true){
        @Override protected boolean showAutomaticRenamingDialog(        AutomaticRenamer automaticVariableRenamer){
          for (          PsiNamedElement element : automaticVariableRenamer.getElements()) {
            automaticVariableRenamer.setRename(element,automaticVariableRenamer.getNewName(element));
          }
          return true;
        }
      }
;
      for (      AutomaticRenamerFactory factory : Extensions.getExtensions(AutomaticRenamerFactory.EP_NAME)) {
        processor.addRenamerFactory(factory);
      }
      processor.run();
      PsiDocumentManager.getInstance(myProject).commitAllDocuments();
      FileDocumentManager.getInstance().saveAllDocuments();
    }
  }
);
}
