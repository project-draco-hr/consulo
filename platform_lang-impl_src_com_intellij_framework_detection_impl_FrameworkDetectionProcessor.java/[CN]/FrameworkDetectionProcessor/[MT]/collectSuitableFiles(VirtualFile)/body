{
  if (myProgressIndicator.isCanceled() || !myProcessedFiles.add(file))   return;
  if (file.isDirectory()) {
    file.getChildren();
    file.refresh(false,false);
    VirtualFile[] children=file.getChildren();
    for (    VirtualFile child : children) {
      collectSuitableFiles(child);
    }
    return;
  }
  final FileType fileType=file.getFileType();
  if (!myDetectorsByFileType.containsKey(fileType)) {
    return;
  }
  myProgressIndicator.setText2(file.getPresentableUrl());
  try {
    FileContent fileContent=new FileContent(file,file.contentsToByteArray(false));
    for (    FrameworkDetectorData detector : myDetectorsByFileType.get(fileType)) {
      if (detector.myFilePattern.accepts(fileContent)) {
        detector.mySuitableFiles.add(file);
      }
    }
  }
 catch (  IOException e) {
    LOG.info(e);
  }
}
