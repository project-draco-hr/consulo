def _updatestatus(self, wfn, newstatus):
    "\n        Update the stored status of a file.\n\n        newstatus: - char in (statuskeys + 'ni'), new status to apply.\n                   - or None, to stop tracking wfn\n        "
    (root, fn) = split(wfn)
    d = self.tree.dir(root)
    oldstatus = d.files.get(fn)
    if (self.ui.debugflag and (oldstatus != newstatus)):
        self.ui.note((_('status: %r %s -> %s\n') % (wfn, oldstatus, newstatus)))
    if (oldstatus and (oldstatus in self.statuskeys) and (oldstatus != newstatus)):
        del self.statustrees[oldstatus].dir(root).files[fn]
    if (newstatus in (None, 'i')):
        d.files.pop(fn, None)
    elif (oldstatus != newstatus):
        d.files[fn] = newstatus
        if (newstatus != 'n'):
            self.statustrees[newstatus].dir(root).files[fn] = newstatus
