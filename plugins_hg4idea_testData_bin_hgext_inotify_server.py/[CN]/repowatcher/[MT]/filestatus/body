def filestatus(self, fn, st):
    try:
        (type_, mode, size, time) = self.dirstate._map[fn][:4]
    except KeyError:
        type_ = '?'
    if (type_ == 'n'):
        (st_mode, st_size, st_mtime) = st
        if (size == (-1)):
            return 'l'
        if (size and ((size != st_size) or ((mode ^ st_mode) & 64))):
            return 'm'
        if (time != int(st_mtime)):
            return 'l'
        return 'n'
    if ((type_ == '?') and self.dirstate._ignore(fn)):
        return 'i'
    return type_
