def __init__(self, ui, dirstate, root):
    self.ui = ui
    self.dirstate = dirstate
    self.wprefix = join(root, '')
    self.prefixlen = len(self.wprefix)
    self.tree = directory()
    self.statcache = {}
    self.statustrees = dict([(s, directory()) for s in self.statuskeys])
    self.ds_info = self.dirstate_info()
    self.last_event = None
