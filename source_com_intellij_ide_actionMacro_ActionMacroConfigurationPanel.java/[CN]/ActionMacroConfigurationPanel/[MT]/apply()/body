{
  final ActionMacroManager manager=ActionMacroManager.getInstance();
  ActionMacro[] macros=manager.getAllMacros();
  HashSet<String> removedIds=new HashSet<String>();
  for (int i=0; i < macros.length; i++) {
    removedIds.add(macros[i].getActionId());
  }
  manager.removeAllMacros();
  final Enumeration newMacros=myMacrosModel.elements();
  while (newMacros.hasMoreElements()) {
    ActionMacro macro=(ActionMacro)newMacros.nextElement();
    manager.addMacro(macro);
    removedIds.remove(macro.getActionId());
  }
  manager.registerActions();
  for (Iterator<String> iterator=removedIds.iterator(); iterator.hasNext(); ) {
    String id=iterator.next();
    Keymap[] allKeymaps=KeymapManagerEx.getInstanceEx().getAllKeymaps();
    for (int i=0; i < allKeymaps.length; i++) {
      Keymap keymap=allKeymaps[i];
      keymap.removeAllActionShortcuts(id);
    }
  }
}
