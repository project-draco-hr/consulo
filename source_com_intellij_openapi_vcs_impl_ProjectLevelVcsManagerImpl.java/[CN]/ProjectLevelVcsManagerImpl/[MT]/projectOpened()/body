{
  registerCheckinHandlerFactory(new CheckinHandlerFactory(){
    public @NotNull CheckinHandler createHandler(    final CheckinProjectPanel panel){
      return new StandardBeforeCheckinHandler(myProject);
    }
  }
);
  registerCheckinHandlerFactory(new CheckinHandlerFactory(){
    public @NotNull CheckinHandler createHandler(    final CheckinProjectPanel panel){
      return new CodeAnalysisBeforeCheckinHandler(myProject,panel);
    }
  }
);
  initialize();
  final StartupManager manager=StartupManager.getInstance(myProject);
  manager.registerStartupActivity(new Runnable(){
    public void run(){
      if (!myHaveLegacyVcsConfiguration && !myMappingsLoaded) {
        autoDetectVcsMappings();
      }
      updateActiveVcss();
    }
  }
);
  manager.registerPostStartupActivity(new Runnable(){
    public void run(){
      ToolWindowManager toolWindowManager=ToolWindowManager.getInstance(myProject);
      if (toolWindowManager != null) {
        ToolWindow toolWindow=toolWindowManager.registerToolWindow(ToolWindowId.VCS,true,ToolWindowAnchor.BOTTOM);
        myContentManager=toolWindow.getContentManager();
        toolWindow.setIcon(Icons.VCS_SMALL_TAB);
        toolWindow.installWatcher(myContentManager);
      }
 else {
        myContentManager=PeerFactory.getInstance().getContentFactory().createContentManager(true,myProject);
      }
      if (myMessageBus != null) {
        myMessageBus.connect().subscribe(ProjectTopics.MODULES,new ModuleAdapter(){
          public void moduleAdded(          final Project project,          final Module module){
            autoDetectModuleVcsMapping(module);
          }
          public void beforeModuleRemoved(          final Project project,          final Module module){
            checkRemoveVcsRoot(module);
          }
        }
);
      }
    }
  }
);
}
