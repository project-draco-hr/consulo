{
  if (!iterator.process(new FilePathImpl(root))) {
    return false;
  }
  if (root.isDirectory()) {
    final VirtualFile[] files=root.getChildren();
    for (    VirtualFile child : files) {
      if (child.isDirectory()) {
        if (filesToExclude != null && filesToExclude.contains(child)) {
          continue;
        }
        if (ProjectRootManager.getInstance(myProject).getFileIndex().isIgnored(child)) {
          continue;
        }
      }
      if (!iterateChildren(child,iterator,filesToExclude)) {
        return false;
      }
    }
  }
  return true;
}
