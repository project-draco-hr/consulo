{
  final PsiElement currentElement=file.findElementAt(offset);
  PsiElement element=PsiTreeUtil.getParentOfType(currentElement,XmlDoctype.class);
  if (element != null) {
    return ((XmlDoctype)element).getDtdUri();
  }
  final XmlAttribute attribute=PsiTreeUtil.getParentOfType(currentElement,XmlAttribute.class);
  if (attribute != null && attribute.isNamespaceDeclaration()) {
    final String uri=attribute.getValue();
    final PsiElement parent=attribute.getParent();
    if (uri != null && parent instanceof XmlTag && ((XmlTag)parent).getNSDescriptor(uri,true) == null) {
      return uri;
    }
  }
  return null;
}
