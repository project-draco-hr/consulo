{
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  if (!isValidBase())   return;
  final Object[] storedInfo=new Object[1];
  if (myCurrentViewName != null) {
    final HierarchyTreeBuilder builder=myBuilders.get(myCurrentViewName);
    storedInfo[0]=builder.storeExpandedAndSelectedInfo();
  }
  final PsiClass base=(PsiClass)mySmartPsiElementPointer.getElement();
  final String[] name=new String[]{myCurrentViewName};
  dispose();
  setHierarchyBase(base);
  validate();
  if (myIsInterface && TypeHierarchyTreeStructure.TYPE.equals(name)) {
    name[0]=SubtypesHierarchyTreeStructure.TYPE;
  }
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      changeView(name[0]);
      if (storedInfo != null) {
        final HierarchyTreeBuilder builder=myBuilders.get(myCurrentViewName);
        builder.restoreExpandedAndSelectedInfo(storedInfo[0]);
      }
    }
  }
);
}
