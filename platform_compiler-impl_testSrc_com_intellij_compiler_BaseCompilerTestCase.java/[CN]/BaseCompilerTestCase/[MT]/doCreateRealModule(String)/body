{
  if (useExternalCompiler()) {
    final VirtualFile baseDir=myProject.getBaseDir();
    Assert.assertNotNull(baseDir);
    final File moduleFile=new File(baseDir.getPath().replace('/',File.separatorChar),moduleName + ModuleFileType.DOT_DEFAULT_EXTENSION);
    PlatformTestCase.myFilesToDelete.add(moduleFile);
    return new WriteAction<Module>(){
      @Override protected void run(      Result<Module> result) throws Throwable {
        Module module=ModuleManager.getInstance(myProject).newModule(FileUtil.toSystemIndependentName(moduleFile.getAbsolutePath()),getModuleType().getId());
        module.getModuleFile();
        result.setResult(module);
      }
    }
.execute().getResultObject();
  }
  return super.doCreateRealModule(moduleName);
}
