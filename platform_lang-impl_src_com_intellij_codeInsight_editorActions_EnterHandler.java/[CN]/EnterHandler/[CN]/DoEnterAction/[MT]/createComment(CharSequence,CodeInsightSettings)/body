{
  myDocument.insertString(myOffset,buffer);
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
  CodeStyleManager.getInstance(getProject()).adjustLineIndent(myFile,myOffset + buffer.length() - 2);
  PsiComment comment=PsiTreeUtil.getNonStrictParentOfType(myFile.findElementAt(myOffset),PsiComment.class);
  comment=createJavaDocStub(settings,comment,getProject());
  if (comment == null) {
    return null;
  }
  CodeStyleManager codeStyleManager=CodeStyleManager.getInstance(getProject());
  CodeStyleSettings codeStyleSettings=CodeStyleSettingsManager.getSettings(getProject());
  boolean old=codeStyleSettings.ENABLE_JAVADOC_FORMATTING;
  codeStyleSettings.ENABLE_JAVADOC_FORMATTING=false;
  try {
    RangeMarker commentMarker=myDocument.createRangeMarker(comment.getTextRange().getStartOffset(),comment.getTextRange().getEndOffset());
    codeStyleManager.reformatNewlyAddedElement(comment.getNode().getTreeParent(),comment.getNode());
    comment=PsiTreeUtil.getNonStrictParentOfType(myFile.findElementAt(commentMarker.getStartOffset()),PsiComment.class);
    commentMarker.dispose();
  }
  finally {
    codeStyleSettings.ENABLE_JAVADOC_FORMATTING=old;
  }
  PsiElement next=comment.getNextSibling();
  if (next == null && comment.getParent().getClass() == comment.getClass()) {
    next=comment.getParent().getNextSibling();
  }
  if (next != null) {
    next=myFile.findElementAt(next.getTextRange().getStartOffset());
  }
  if (next != null && (!FormatterUtil.containsWhiteSpacesOnly(next.getNode()) || !next.getText().contains(LINE_SEPARATOR))) {
    int lineBreakOffset=comment.getTextRange().getEndOffset();
    myDocument.insertString(lineBreakOffset,LINE_SEPARATOR);
    PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
    codeStyleManager.adjustLineIndent(myFile,lineBreakOffset + 1);
    comment=PsiTreeUtil.getNonStrictParentOfType(myFile.findElementAt(myOffset),PsiComment.class);
  }
  return comment;
}
