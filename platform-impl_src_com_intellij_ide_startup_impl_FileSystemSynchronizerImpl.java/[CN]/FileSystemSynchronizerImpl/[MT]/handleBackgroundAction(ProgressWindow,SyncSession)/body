{
  boolean allBackgrounded=true;
  final CacheUpdater[] updaters=syncSession.getUpdaters();
  for (int i=0; i < updaters.length; i++) {
    CacheUpdater updater=updaters[i];
    if (updater instanceof BackgroundableCacheUpdater) {
      List<VirtualFile> remaining=syncSession.getRemainingFiles(i);
      if (remaining == null || remaining.isEmpty()) {
        continue;
      }
      final boolean backgrounded=((BackgroundableCacheUpdater)updater).canBeSentToBackground(remaining);
      if (backgrounded) {
        remaining=syncSession.backgrounded(i);
        if (remaining != null && !remaining.isEmpty()) {
          ((BackgroundableCacheUpdater)updater).backgrounded(remaining);
        }
      }
 else {
        allBackgrounded=false;
      }
    }
  }
  if (allBackgrounded) {
    progressWindow.setBackgroundHandler(null);
  }
}
