{
  if (myState.compareAndSet(State.CONNECTED,State.DISCONNECTING)) {
    try {
      final ChannelFuture future=myConnectFuture;
      if (future != null) {
        try {
          final ChannelFuture closeFuture=future.getChannel().close();
          closeFuture.awaitUninterruptibly();
        }
  finally {
          myChannelFactory.releaseExternalResources();
        }
      }
    }
  finally {
      myConnectFuture=null;
      myState.compareAndSet(State.DISCONNECTING,State.DISCONNECTED);
      try {
        onDisconnect();
      }
 catch (      Throwable e) {
        LOG.error(e);
      }
    }
  }
}
