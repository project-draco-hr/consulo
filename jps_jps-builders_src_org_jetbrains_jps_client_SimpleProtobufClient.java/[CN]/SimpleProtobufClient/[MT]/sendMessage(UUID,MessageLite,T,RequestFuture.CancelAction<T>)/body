{
  final RequestFuture<T> requestFuture=new RequestFuture<T>(responseHandler,messageId,cancelAction);
  myMessageHandler.registerFuture(messageId,requestFuture);
  final ChannelFuture channelFuture=Channels.write(myConnectFuture.getChannel(),message);
  channelFuture.addListener(new ChannelFutureListener(){
    public void operationComplete(    ChannelFuture future) throws Exception {
      if (!future.isSuccess()) {
        try {
          myMessageHandler.removeFuture(messageId);
          if (responseHandler != null) {
            responseHandler.sessionTerminated();
          }
        }
  finally {
          requestFuture.setDone();
        }
      }
    }
  }
);
  return requestFuture;
}
