{
  final Box box=Box.createVerticalBox();
  sourceMethodTextField.setEditable(false);
  final JPanel methodNamePanel=new JPanel(new BorderLayout());
  methodNamePanel.add(new JLabel(RefactorJBundle.message("method.to.wrap.returns.from.label")),BorderLayout.NORTH);
  methodNamePanel.add(sourceMethodTextField,BorderLayout.CENTER);
  box.add(methodNamePanel);
  createVerticalStrut(box,10);
  final JPanel existingClassPanel=new JPanel(new BorderLayout());
  final JLabel existingClassLabel=new JLabel();
  existingClassLabel.setLabelFor(classNameField);
  existingClassLabel.setDisplayedMnemonic('N');
  existingClassPanel.add(existingClassLabel,BorderLayout.WEST);
  existingClassPanel.add(existingClassField,BorderLayout.CENTER);
  existingClassPanel.add(existingClassChooserButton,BorderLayout.EAST);
  existingClassChooserButton.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      final Project project=sourceMethod.getProject();
      final GlobalSearchScope scope=GlobalSearchScope.allScope(project);
      final TreeClassChooserDialog chooser=new TreeClassChooserDialog(RefactorJBundle.message("select.wrapper.class"),project,scope,null,null);
      final String classText=existingClassField.getText();
      final PsiClass currentClass=JavaPsiFacade.getInstance(PsiManager.getInstance(project).getProject()).findClass(classText,GlobalSearchScope.allScope(project));
      if (currentClass != null) {
        chooser.selectClass(currentClass);
      }
      chooser.show();
      final PsiClass selectedClass=chooser.getSelectedClass();
      if (selectedClass != null) {
        final String className=selectedClass.getQualifiedName();
        existingClassField.setText(className);
      }
    }
  }
);
  createVerticalStrut(box,10);
  final JPanel classNamePanel=new JPanel(new GridBagLayout());
  final TitledBorder newClassBorder=IdeBorderFactory.createTitledBorder("Wrapper Class");
  classNamePanel.setBorder(newClassBorder);
  final Insets indent=new Insets(0,2,0,0);
  final GridBagConstraints gbConstraints=new GridBagConstraints();
  final Insets origInsets=gbConstraints.insets;
  gbConstraints.fill=GridBagConstraints.HORIZONTAL;
  gbConstraints.weightx=1.0;
  gbConstraints.weighty=0.0;
  gbConstraints.gridwidth=3;
  gbConstraints.gridx=0;
  gbConstraints.gridy=0;
  gbConstraints.gridwidth=3;
  useExistingClassButton.setMnemonic('U');
  classNamePanel.add(useExistingClassButton,gbConstraints);
  gbConstraints.gridy=1;
  gbConstraints.insets=indent;
  classNamePanel.add(existingClassPanel,gbConstraints);
  gbConstraints.insets=origInsets;
  gbConstraints.gridy=2;
  createNewClassButton.setMnemonic('C');
  classNamePanel.add(createNewClassButton,gbConstraints);
  gbConstraints.gridy=3;
  gbConstraints.gridwidth=0;
  classNameLabel.setLabelFor(classNameField);
  classNameLabel.setDisplayedMnemonic('N');
  gbConstraints.insets=indent;
  classNamePanel.add(classNameLabel,gbConstraints);
  gbConstraints.insets=origInsets;
  gbConstraints.gridx=1;
  gbConstraints.gridwidth=2;
  classNamePanel.add(classNameField,gbConstraints);
  packageChooserButton.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      final Project project=sourceMethod.getProject();
      final PackageChooserDialog chooser=new PackageChooserDialog(RefactorJBundle.message("choose.destination.package.label"),project);
      final String packageText=packageTextField.getText();
      chooser.selectPackage(packageText);
      chooser.show();
      final PsiPackage aPackage=chooser.getSelectedPackage();
      if (aPackage != null) {
        final String packageName=aPackage.getQualifiedName();
        packageTextField.setText(packageName);
      }
    }
  }
);
  packageLabel.setLabelFor(packageTextField);
  packageLabel.setDisplayedMnemonic('P');
  gbConstraints.gridx=0;
  gbConstraints.gridy=4;
  gbConstraints.gridwidth=1;
  gbConstraints.insets=indent;
  classNamePanel.add(packageLabel,gbConstraints);
  gbConstraints.insets=origInsets;
  gbConstraints.gridx=1;
  classNamePanel.add(packageTextField,gbConstraints);
  gbConstraints.gridx=2;
  gbConstraints.fill=GridBagConstraints.NONE;
  classNamePanel.add(packageChooserButton,gbConstraints);
  box.add(classNamePanel);
  createVerticalStrut(box,10);
  final JPanel panel=new JPanel(new BorderLayout());
  panel.add(box,BorderLayout.CENTER);
  return panel;
}
