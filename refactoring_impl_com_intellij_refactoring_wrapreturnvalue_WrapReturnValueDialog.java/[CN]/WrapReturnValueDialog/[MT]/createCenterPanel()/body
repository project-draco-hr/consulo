{
  sourceMethodTextField.setEditable(false);
  final DocumentListener docListener=new DocumentAdapter(){
    protected void textChanged(    final DocumentEvent e){
      validateButtons();
    }
  }
;
  existingClassField.getTextField().getDocument().addDocumentListener(docListener);
  packageTextField.getTextField().getDocument().addDocumentListener(docListener);
  classNameField.getDocument().addDocumentListener(docListener);
  myFieldsCombo.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      validateButtons();
    }
  }
);
  myInnerClassNameTextField.getDocument().addDocumentListener(docListener);
  final PsiFile file=sourceMethod.getContainingFile();
  if (file instanceof PsiJavaFile) {
    final String packageName=((PsiJavaFile)file).getPackageName();
    packageTextField.setText(packageName);
  }
  final PsiClass containingClass=sourceMethod.getContainingClass();
  final String containingClassName=containingClass.getName();
  final String sourceMethodName=sourceMethod.getName();
  sourceMethodTextField.setText(containingClassName + '.' + sourceMethodName);
  final ButtonGroup buttonGroup=new ButtonGroup();
  buttonGroup.add(useExistingClassButton);
  buttonGroup.add(createNewClassButton);
  buttonGroup.add(myCreateInnerClassButton);
  createNewClassButton.setSelected(true);
  final ActionListener enableListener=new ActionListener(){
    public void actionPerformed(    ActionEvent actionEvent){
      toggleRadioEnablement();
    }
  }
;
  useExistingClassButton.addActionListener(enableListener);
  createNewClassButton.addActionListener(enableListener);
  myCreateInnerClassButton.addActionListener(enableListener);
  toggleRadioEnablement();
  final DefaultComboBoxModel model=new DefaultComboBoxModel();
  myFieldsCombo.setModel(model);
  myFieldsCombo.setRenderer(new DefaultPsiElementCellRenderer());
  existingClassField.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      final Project project=sourceMethod.getProject();
      final GlobalSearchScope scope=GlobalSearchScope.allScope(project);
      final TreeClassChooserDialog chooser=new TreeClassChooserDialog(RefactorJBundle.message("select.wrapper.class"),project,scope,null,null);
      final String classText=existingClassField.getText();
      final PsiClass currentClass=JavaPsiFacade.getInstance(PsiManager.getInstance(project).getProject()).findClass(classText,GlobalSearchScope.allScope(project));
      if (currentClass != null) {
        chooser.selectClass(currentClass);
      }
      chooser.show();
      final PsiClass selectedClass=chooser.getSelectedClass();
      if (selectedClass != null) {
        final String className=selectedClass.getQualifiedName();
        existingClassField.setText(className);
        model.removeAllElements();
        for (        PsiField field : selectedClass.getFields()) {
          if (TypeConversionUtil.isAssignable(sourceMethod.getReturnType(),field.getType())) {
            model.addElement(field);
          }
        }
      }
    }
  }
);
  packageTextField.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      final Project project=sourceMethod.getProject();
      final PackageChooserDialog chooser=new PackageChooserDialog(RefactorJBundle.message("choose.destination.package.label"),project);
      final String packageText=packageTextField.getText();
      chooser.selectPackage(packageText);
      chooser.show();
      final PsiPackage aPackage=chooser.getSelectedPackage();
      if (aPackage != null) {
        final String packageName=aPackage.getQualifiedName();
        packageTextField.setText(packageName);
      }
    }
  }
);
  return myWholePanel;
}
