{
  final String fileName=psiFile.getVirtualFile().getPresentableUrl();
  DocumentEx doc=(DocumentEx)PsiDocumentManager.getInstance(psiFile.getProject()).getDocument(psiFile);
  if (doc == null)   return null;
  EditorHighlighter highlighter=HighlighterFactory.createHighlighter(psiFile.getProject(),psiFile.getVirtualFile());
  highlighter.setText(doc.getCharsSequence());
  return new TextPainter(doc,highlighter,fileName,psiFile,psiFile.getFileType(),editor);
}
