{
  if (!checkSelection(dataContext))   throw new DataAccessor.NoDataException(DiffBundle.message("diff.file.whith.editor.action.wrong.selection.error.message"));
  Project project=DataAccessors.PROJECT.getNotNull(dataContext);
  PsiElement element=PRIMARY_SOURCE.getNotNull(dataContext);
  PsiFile psiFile=element.getContainingFile();
  if (psiFile != null)   element=psiFile;
  Document document=EDITING_DOCUMENT.getNotNull(dataContext);
  if (isSameFile(document,element))   throw new DataAccessor.NoDataException(DiffBundle.message("diff.file.whith.editor.action.same.file.error.message"));
  DiffContent diffContent=DiffContentFactory.fromPsiElement(element);
  if (diffContent == null || diffContent.getDocument() == null)   throw new DataAccessor.NoDataException(DiffBundle.message("diff.file.whith.editor.action.no.content.error.message"));
  return new FileEditorContents(document,element,project);
}
