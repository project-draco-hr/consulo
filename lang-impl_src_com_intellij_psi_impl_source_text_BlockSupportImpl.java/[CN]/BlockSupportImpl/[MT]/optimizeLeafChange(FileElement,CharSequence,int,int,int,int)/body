{
  final LeafElement leafElement=treeFileElement.findLeafElementAt(startOffset);
  if (leafElement == null || hasErrorElementChild(leafElement.getTreeParent()) || hasErrorElementChild(leafElement.getTreeNext()) || hasErrorElementChild(leafElement.getTreePrev())) {
    return false;
  }
  if (!leafElement.getTextRange().containsRange(startOffset,endOffset))   return false;
  final LeafElement leafElementToChange=treeFileElement.findLeafElementAt(changedOffset);
  if (leafElementToChange == null)   return false;
  TextRange leafRangeToChange=leafElementToChange.getTextRange();
  LeafElement newElement=ASTFactory.leaf(leafElementToChange.getElementType(),newFileText,leafRangeToChange.getStartOffset(),leafRangeToChange.getEndOffset() + lengthDiff,treeFileElement.getCharTable());
  newElement.putUserData(CharTable.CHAR_TABLE_KEY,treeFileElement.getCharTable());
  leafElementToChange.getTreeParent().replaceChild(leafElementToChange,newElement);
  return true;
}
