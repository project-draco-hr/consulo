{
  final RepositoryManager repositoryManager=manager.getRepositoryManager();
  final int oldLength=fileElement.getTextLength();
  sendPsiBeforeEvent(fileImpl);
  if (repositoryManager != null)   repositoryManager.beforeChildAddedOrRemoved(fileImpl,fileElement);
  if (fileElement.getFirstChildNode() != null)   TreeUtil.removeRange(fileElement.getFirstChildNode(),null);
  final ASTNode firstChildNode=newFileElement.getFirstChildNode();
  if (firstChildNode != null)   TreeUtil.addChildren(fileElement,(TreeElement)firstChildNode);
  fileImpl.getTreeElement().setCharTable(newFileElement.getCharTable());
  if (repositoryManager != null)   repositoryManager.beforeChildAddedOrRemoved(fileImpl,fileElement);
  manager.invalidateFile(fileImpl);
  fileElement.subtreeChanged();
  sendPsiAfterEvent(fileImpl,oldLength);
}
