{
  List<VirtualFile> result=myMappings.getMappingsAsFilesUnderVcs(vcs);
  final AbstractVcs.RootsConvertor convertor=vcs.getCustomConvertor();
  if (convertor != null) {
    result=convertor.convertRoots(result);
  }
  Collections.sort(result,FilePathComparator.getInstance());
  if (!vcs.allowsNestedRoots()) {
    int i=1;
    while (i < result.size()) {
      final VirtualFile previous=result.get(i - 1);
      final VirtualFile current=result.get(i);
      if (ExcludedFileIndex.getInstance(myProject).isValidAncestor(previous,current) && vcs.isVersionedDirectory(previous)) {
        result.remove(i);
      }
 else {
        i++;
      }
    }
  }
  return VfsUtil.toVirtualFileArray(result);
}
