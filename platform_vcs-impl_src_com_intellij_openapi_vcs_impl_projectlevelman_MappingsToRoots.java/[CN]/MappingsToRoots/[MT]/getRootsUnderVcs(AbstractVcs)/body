{
  List<VirtualFile> result=myMappings.getMappingsAsFilesUnderVcs(vcs);
  final AbstractVcs.RootsConvertor convertor=vcs.getCustomConvertor();
  if (convertor != null) {
    result=convertor.convertRoots(result);
  }
  Collections.sort(result,FilePathComparator.getInstance());
  if (!vcs.allowsNestedRoots()) {
    final FileIndexFacade facade=PeriodicalTasksCloser.getInstance().safeGetService(myProject,FileIndexFacade.class);
    final List<VirtualFile> finalResult=result;
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      @Override public void run(){
        int i=1;
        while (i < finalResult.size()) {
          final VirtualFile previous=finalResult.get(i - 1);
          final VirtualFile current=finalResult.get(i);
          if (facade.isValidAncestor(previous,current)) {
            finalResult.remove(i);
          }
 else {
            i++;
          }
        }
      }
    }
);
  }
  return VfsUtil.toVirtualFileArray(result);
}
