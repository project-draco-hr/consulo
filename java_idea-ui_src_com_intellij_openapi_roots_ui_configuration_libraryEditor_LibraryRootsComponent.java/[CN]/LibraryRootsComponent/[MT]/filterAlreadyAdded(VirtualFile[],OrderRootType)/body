{
  if (files == null || files.length == 0) {
    return VirtualFile.EMPTY_ARRAY;
  }
  final Set<VirtualFile> chosenFilesSet=new HashSet<VirtualFile>(Arrays.asList(files));
  final Set<VirtualFile> alreadyAdded=new HashSet<VirtualFile>();
  final VirtualFile[] libraryFiles=getLibraryEditor().getFiles(rootType);
  ContainerUtil.addAll(alreadyAdded,libraryFiles);
  chosenFilesSet.removeAll(alreadyAdded);
  return VfsUtil.toVirtualFileArray(chosenFilesSet);
}
