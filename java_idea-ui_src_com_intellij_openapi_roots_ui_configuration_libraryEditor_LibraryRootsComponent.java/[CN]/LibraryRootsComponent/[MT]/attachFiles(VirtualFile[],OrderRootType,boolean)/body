{
  final VirtualFile[] filesToAttach=filterAlreadyAdded(files,rootType);
  if (filesToAttach.length > 0) {
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      public void run(){
        final LibraryEditor libraryEditor=getLibraryEditor();
        for (        VirtualFile file : filesToAttach) {
          if (isJarDirectories) {
            libraryEditor.addJarDirectory(file,false);
          }
 else {
            libraryEditor.addRoot(file,rootType);
          }
        }
      }
    }
);
    myTreeBuilder.updateFromRoot();
  }
  return filesToAttach;
}
