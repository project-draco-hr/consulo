{
  if (project.isDisposed())   return createLight(file,providers,states,selectedProvider);
  Disposable disposable=Disposer.newDisposable();
  VirtualFilePointer pointer=VirtualFilePointerManager.getInstance().create(file,disposable,null);
  HistoryEntry entry=new HistoryEntry(pointer,selectedProvider,disposable);
  for (int i=0; i < providers.length; i++) {
    FileEditorProvider provider=providers[i];
    FileEditorState state=states[i];
    if (provider != null && state != null) {
      entry.putState(provider,state);
    }
  }
  return entry;
}
