{
  final Project project=event.getProject();
  if (project == null)   return;
  if (myAddedFiles.size() > 0) {
    processAddedFiles(project);
  }
  if (myDeletedFiles.size() > 0) {
    processDeletedFiles(project);
  }
  processMovedFiles(project);
  final List<VcsException> exceptionList=myMoveExceptions.get(project);
  if ((exceptionList != null) && (!exceptionList.isEmpty())) {
    AbstractVcsHelper.getInstance(project).showErrors(exceptionList,SvnBundle.message("move.files.errors.title"));
  }
  if (myFilesToRefresh.size() > 0) {
    final List<VirtualFile> toRefresh=new ArrayList<VirtualFile>(myFilesToRefresh);
    final RefreshSession session=RefreshQueue.getInstance().createSession(true,true,new Runnable(){
      public void run(){
        if (project.isDisposed())         return;
        for (        VirtualFile f : toRefresh) {
          if (!f.isValid())           continue;
          if (f.isDirectory()) {
            VcsDirtyScopeManager.getInstance(project).dirDirtyRecursively(f);
          }
 else {
            VcsDirtyScopeManager.getInstance(project).fileDirty(f);
          }
        }
      }
    }
);
    session.addAllFiles(myFilesToRefresh);
    session.launch();
    myFilesToRefresh.clear();
  }
}
