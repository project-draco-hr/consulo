{
  final List<VirtualFile> toRefreshFiles=new ArrayList<VirtualFile>();
  final List<VirtualFile> toRefreshDirs=new ArrayList<VirtualFile>();
  for (  VirtualFile file : myFilesToRefresh) {
    if (file.isDirectory()) {
      toRefreshDirs.add(file);
    }
 else {
      toRefreshFiles.add(file);
    }
  }
  final RefreshSession session=RefreshQueue.getInstance().createSession(false,true,new Runnable(){
    public void run(){
      if (project.isDisposed())       return;
      filterOutInvalid(toRefreshFiles);
      filterOutInvalid(toRefreshDirs);
      final VcsDirtyScopeManager vcsDirtyScopeManager=VcsDirtyScopeManager.getInstance(project);
      final boolean markedDirty=vcsDirtyScopeManager.filesDirty(toRefreshFiles,toRefreshDirs);
      LOG.assertTrue(markedDirty,"One of changed files was not marked as dirty");
    }
  }
);
  session.addAllFiles(myFilesToRefresh);
  session.launch();
  myFilesToRefresh.clear();
}
