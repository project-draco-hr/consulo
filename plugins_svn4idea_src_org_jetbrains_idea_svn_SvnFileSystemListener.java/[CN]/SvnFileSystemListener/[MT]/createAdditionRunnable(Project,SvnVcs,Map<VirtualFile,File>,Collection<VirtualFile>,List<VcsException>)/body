{
  return new Runnable(){
    @Override public void run(){
      SVNWCClient wcClient=vcs.createWCClient();
      final SVNCopyClient copyClient=vcs.createCopyClient();
      for (      VirtualFile file : filesToProcess) {
        final File ioFile=new File(file.getPath());
        try {
          final File copyFrom=copyFromMap.get(file);
          if (copyFrom != null) {
            try {
              new ActionWithTempFile(ioFile){
                protected void executeInternal() throws VcsException {
                  try {
                    final SVNCopySource[] copySource={new SVNCopySource(SVNRevision.WORKING,SVNRevision.WORKING,copyFrom)};
                    copyClient.doCopy(copySource,ioFile,false,true,true);
                  }
 catch (                  SVNException e) {
                    throw new VcsException(e);
                  }
                }
              }
.execute();
            }
 catch (            VcsException e) {
              exceptions.add(e);
            }
          }
 else {
            wcClient.doAdd(ioFile,true,false,false,true);
          }
          VcsDirtyScopeManager.getInstance(project).fileDirty(file);
        }
 catch (        SVNException e) {
          exceptions.add(new VcsException(e));
        }
      }
    }
  }
;
}
