{
  SvnVcs vcs=getVCS(toDir);
  if (vcs == null) {
    vcs=getVCS(file);
  }
  if (vcs == null) {
    return null;
  }
  File srcFile=new File(file.getPath());
  File destFile=new File(new File(toDir.getPath()),copyName);
  final boolean dstDirUnderControl=SvnUtil.isSvnVersioned(vcs.getProject(),destFile.getParentFile());
  if (!dstDirUnderControl && !isPendingAdd(vcs.getProject(),toDir)) {
    return null;
  }
  if (!SvnUtil.isSvnVersioned(vcs.getProject(),srcFile.getParentFile())) {
    myAddedFiles.putValue(vcs.getProject(),new AddedFileInfo(toDir,copyName,null,false));
    return null;
  }
  final SVNStatus fileStatus=getFileStatus(vcs,srcFile);
  if (fileStatus != null && SvnVcs.svnStatusIs(fileStatus,SVNStatusType.STATUS_ADDED)) {
    myAddedFiles.putValue(vcs.getProject(),new AddedFileInfo(toDir,copyName,null,false));
    return null;
  }
  if (sameRoot(vcs,file.getParent(),toDir)) {
    myAddedFiles.putValue(vcs.getProject(),new AddedFileInfo(toDir,copyName,srcFile,false));
    return null;
  }
  myAddedFiles.putValue(vcs.getProject(),new AddedFileInfo(toDir,copyName,null,false));
  return null;
}
