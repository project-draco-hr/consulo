{
  SvnVcs vcs=getVCS(dir);
  if (vcs == null) {
    return false;
  }
  File ioDir=getIOFile(dir);
  if (!SVNWCUtil.isVersionedDirectory(ioDir)) {
    return false;
  }
  ISVNOptions options=vcs.getSvnOptions();
  SVNWCClient wcClient=new SVNWCClient(null,options);
  File targetFile=new File(ioDir,name);
  SVNStatus status=getFileStatus(targetFile);
  if (status == null || status.getContentsStatus() == SVNStatusType.STATUS_NONE) {
    if (confirmAdd(getVCS(dir))) {
      createNewFile(targetFile,directory);
      try {
        wcClient.doAdd(targetFile,false,false,false,false);
      }
 catch (      SVNException e) {
        SVNFileUtil.deleteAll(targetFile,true);
        return false;
      }
      return true;
    }
  }
 else   if (status.getContentsStatus() == SVNStatusType.STATUS_MISSING) {
    return false;
  }
 else   if (status.getContentsStatus() == SVNStatusType.STATUS_DELETED) {
    SVNNodeKind kind=status.getKind();
    if ((directory && kind != SVNNodeKind.DIR) || (!directory && kind != SVNNodeKind.FILE)) {
      return false;
    }
    try {
      if (isUndo(vcs)) {
        wcClient.doRevert(targetFile,false);
      }
 else       if (confirmAdd(getVCS(dir))) {
        createNewFile(targetFile,directory);
        wcClient.doAdd(targetFile,false,false,false,false);
      }
 else {
        return false;
      }
      return true;
    }
 catch (    SVNException e) {
      SVNFileUtil.deleteAll(targetFile,true);
      return false;
    }
  }
  return false;
}
