{
  final VirtualFile vFile=projectProperties.getVirtualFile();
  if (vFile == null) {
    return;
  }
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      for (      IProperty property : projectProperties.getProperties()) {
        final String name=property.getName();
        if (name != null && name.startsWith(AndroidUtils.ANDROID_LIBRARY_REFERENCE_PROPERTY_PREFIX)) {
          property.getPsiElement().delete();
        }
      }
      final VirtualFile baseDir=vFile.getParent();
      final String baseDirPath=baseDir.getPath();
      final Set<VirtualFile> localDependencies=localProperties != null ? ImportDependenciesUtil.getLibDirs(localProperties) : Collections.<VirtualFile>emptySet();
      int index=1;
      for (      VirtualFile dependency : dependencies) {
        if (!localDependencies.contains(dependency)) {
          final String relPath=FileUtil.getRelativePath(baseDirPath,dependency.getPath(),'/');
          final String value=relPath != null ? relPath : dependency.getPath();
          projectProperties.addProperty(AndroidUtils.ANDROID_LIBRARY_REFERENCE_PROPERTY_PREFIX + index,value);
          index++;
        }
      }
    }
  }
);
}
