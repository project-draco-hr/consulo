{
  Runnable runnableWithProgress=new Runnable(){
    public void run(){
      for (      final Module module : myModuleModel.myPathToModule.values()) {
        final Application app=ApplicationManager.getApplication();
        final Runnable swingRunnable=new Runnable(){
          public void run(){
            app.runWriteAction(new Runnable(){
              public void run(){
                ((ModuleImpl)module).moduleAdded();
                fireModuleAdded(module);
              }
            }
);
          }
        }
;
        if (app.isDispatchThread()) {
          swingRunnable.run();
        }
 else {
          app.invokeAndWait(swingRunnable,ModalityState.defaultModalityState());
        }
      }
    }
  }
;
  ProgressManager.getInstance().runProcessWithProgressSynchronously(runnableWithProgress,"Loading modules",false,myProject);
  myModuleModel.projectOpened();
}
