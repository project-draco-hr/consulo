{
  final Element modules=new Element("modules");
  final Collection<Module> collection=getModulesToWrite();
  ArrayList<SaveItem> sorted=new ArrayList<SaveItem>(collection.size() + myFailedModulePaths.size());
  for (  Module module : collection) {
    sorted.add(new ModuleSaveItem(module));
  }
  for (  ModulePath modulePath : myFailedModulePaths) {
    sorted.add(new ModulePathSaveItem(modulePath));
  }
  Collections.sort(sorted,new Comparator<SaveItem>(){
    public int compare(    SaveItem item1,    SaveItem item2){
      return item1.getModuleName().compareTo(item2.getModuleName());
    }
  }
);
  for (  SaveItem saveItem : sorted) {
    if (!saveItem.isDefaultModule()) {
      saveItem.writeExternal(modules);
    }
  }
  element.addContent(modules);
}
