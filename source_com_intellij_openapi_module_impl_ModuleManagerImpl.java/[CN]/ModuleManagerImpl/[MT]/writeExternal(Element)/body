{
  Element modules=new Element("modules");
  final Collection<Module> collection=getModulesToWrite();
  ArrayList<Module> sorted=new ArrayList<Module>(collection);
  Collections.sort(sorted,new Comparator<Module>(){
    public int compare(    Module module,    Module module1){
      return module.getName().compareTo(module1.getName());
    }
  }
);
  for (Iterator iterator=sorted.iterator(); iterator.hasNext(); ) {
    ModuleImpl module=(ModuleImpl)iterator.next();
    if (module.isDefault())     continue;
    Element moduleElement=new Element("module");
    final String moduleFilePath=module.getModuleFilePath().replace(File.separatorChar,'/');
    final String url=VirtualFileManager.constructUrl(LocalFileSystem.PROTOCOL,moduleFilePath);
    moduleElement.setAttribute("fileurl",url);
    moduleElement.setAttribute("filepath",moduleFilePath);
    String[] groupPath=getModuleGroupPath(module);
    if (groupPath != null) {
      final String groupPathString=StringUtil.concatenate(groupPath,MODULE_GROUP_SEPARATOR);
      moduleElement.setAttribute("group",groupPathString);
    }
    modules.addContent(moduleElement);
  }
  element.addContent(modules);
}
