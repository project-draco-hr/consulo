{
  final File moduleFile=new File(filePath);
  try {
    String canonicalPath=moduleFile.getCanonicalPath();
    if (canonicalPath != null) {
      filePath=canonicalPath;
    }
  }
 catch (  IOException e) {
  }
  final String name=moduleFile.getName();
  if (name.endsWith(".iml")) {
    final String moduleName=name.substring(0,name.length() - 4);
    final Module[] modules=getModules();
    for (int i=0; i < modules.length; i++) {
      Module module=modules[i];
      if (module.getName().equals(moduleName)) {
        throw new ModuleWithNameAlreadyExists(moduleName);
      }
    }
  }
  if (!moduleFile.exists()) {
    throw new IOException("File " + moduleFile.getPath() + " does not exist");
  }
  ModuleImpl module=getModuleByFilePath(filePath);
  if (module == null) {
    module=new ModuleImpl(filePath,myProject,myPomModel,PathMacros.getInstance());
    module.loadSavedConfiguration();
    module.loadModuleComponents();
    initModule(module,true);
  }
  return module;
}
