{
  try {
    final Pair<Class,Class[]> key=new Pair<Class,Class[]>(superClass,interfaces);
    Factory factory=ourFactories.get(key);
    if (factory != null) {
      return (T)factory.newInstance(factory.getClass().getConstructors()[0].getParameterTypes(),constructorArgs,new Callback[]{handler});
    }
    AdvancedEnhancer e=new AdvancedEnhancer();
    e.setSuperclass(superClass);
    e.setInterfaces(interfaces);
    e.setCallbackTypes(new Class[]{InvocationHandler.class});
    factory=(Factory)e.createClass().getConstructors()[0].newInstance(constructorArgs);
    factory.setCallback(0,handler);
    ourFactories.put(key,factory);
    return (T)factory;
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
