{
  if (stub == null) {
    return new StubParentStrategy(parent){
      @Override public DomInvocationHandler getParentHandler(){
        return parent.getHandler();
      }
      @Override public XmlElement getXmlElement(){
        return null;
      }
    }
;
  }
 else {
    return new StubParentStrategy(stub){
      @Override public XmlElement getXmlElement(){
        DomInvocationHandler parentHandler=getParentHandler();
        XmlTag tag=parentHandler.getXmlTag();
        if (tag == null) {
          throw new AssertionError("can't find tag for " + parentHandler);
        }
        return tag.getAttribute(myStub.getName());
      }
    }
;
  }
}
