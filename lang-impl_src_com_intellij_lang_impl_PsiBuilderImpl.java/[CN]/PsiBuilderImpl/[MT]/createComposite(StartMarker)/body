{
  final IElementType type=marker.myType;
  if (type == ElementType.ERROR_ELEMENT) {
    CompositeElement childNode=new PsiErrorElementImpl();
    if (marker.myDoneMarker instanceof DoneWithErrorMarker) {
      ((PsiErrorElementImpl)childNode).setErrorDescription(((DoneWithErrorMarker)marker.myDoneMarker).myMessage);
    }
    return childNode;
  }
 else   if (type instanceof IXmlElementType || type instanceof IJspElementType && !(type instanceof IELElementType)) {
    return Factory.createCompositeElement(type);
  }
  if (type == null) {
    throw new RuntimeException(UNBALANCED_MESSAGE);
  }
  return new CompositeElement(type);
}
