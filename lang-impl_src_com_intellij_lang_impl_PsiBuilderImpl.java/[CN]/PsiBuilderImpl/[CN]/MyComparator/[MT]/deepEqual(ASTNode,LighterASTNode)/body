{
  if (newNode instanceof Token) {
    if (oldNode instanceof ForeignLeafPsiElement) {
      final IElementType type=newNode.getTokenType();
      if (type instanceof ForeignLeafType) {
        return ((ForeignLeafType)type).getValue().equals(oldNode.getText()) ? ThreeState.YES : ThreeState.NO;
      }
      return ThreeState.NO;
    }
    if (oldNode instanceof LeafElement) {
      return ((LeafElement)oldNode).textMatches(myText,((Token)newNode).myTokenStart,((Token)newNode).myTokenEnd) ? ThreeState.YES : ThreeState.NO;
    }
    if (oldNode.getElementType() instanceof IChameleonElementType && newNode.getTokenType() instanceof IChameleonElementType || oldNode.getElementType() instanceof ILazyParseableElementType && newNode.getTokenType() instanceof ILazyParseableElementType) {
      return ((TreeElement)oldNode).textMatches(myText,((Token)newNode).myTokenStart,((Token)newNode).myTokenEnd) ? ThreeState.YES : ThreeState.NO;
    }
  }
  return ThreeState.UNSURE;
}
