{
  final PsiExpression[] dimensions=newExpression.getArrayDimensions();
  final String[] strippedDimensions=new String[dimensions.length];
  for (int i=0; i < dimensions.length; i++) {
    strippedDimensions[i]=removeParentheses(dimensions[i]);
  }
  final PsiExpression qualifier=newExpression.getQualifier();
  final PsiExpression arrayInitializer=newExpression.getArrayInitializer();
  String strippedInitializer=null;
  if (arrayInitializer != null) {
    strippedInitializer=removeParentheses(arrayInitializer);
  }
  final PsiExpressionList argumentList=newExpression.getArgumentList();
  String[] strippedArgs=null;
  if (argumentList != null) {
    final PsiExpression[] args=argumentList.getExpressions();
    strippedArgs=new String[args.length];
    for (int i=0; i < args.length; i++) {
      strippedArgs[i]=removeParentheses(args[i]);
    }
  }
  final String expressionText=newExpression.getText();
  if (qualifier != null) {
    return expressionText;
  }
  final PsiElement[] children=newExpression.getChildren();
  for (  final PsiElement child : children) {
    if (child instanceof PsiAnonymousClass) {
      return expressionText;
    }
  }
  final int length=expressionText.length();
  @NonNls final StringBuilder out=new StringBuilder(length);
  out.append(PsiKeyword.NEW + ' ');
  final PsiJavaCodeReferenceElement classReference=newExpression.getClassReference();
  final PsiType type=newExpression.getType();
  final String text;
  if (classReference == null) {
    if (type != null) {
      final PsiType componentType=type.getDeepComponentType();
      text=componentType.getCanonicalText();
    }
 else {
      text="";
    }
  }
 else {
    text=classReference.getText();
  }
  out.append(text);
  if (strippedArgs != null) {
    out.append('(');
    for (int i=0; i < strippedArgs.length; i++) {
      if (i != 0) {
        out.append(',');
      }
      out.append(strippedArgs[i]);
    }
    out.append(')');
  }
  if (strippedDimensions.length > 0) {
    for (    String strippedDimension : strippedDimensions) {
      out.append('[');
      out.append(strippedDimension);
      out.append(']');
    }
  }
 else   if (type != null) {
    final int dimensionCount=type.getArrayDimensions();
    for (int i=0; i < dimensionCount; i++) {
      out.append("[]");
    }
  }
  if (strippedInitializer != null) {
    out.append(strippedInitializer);
  }
  return out.toString();
}
