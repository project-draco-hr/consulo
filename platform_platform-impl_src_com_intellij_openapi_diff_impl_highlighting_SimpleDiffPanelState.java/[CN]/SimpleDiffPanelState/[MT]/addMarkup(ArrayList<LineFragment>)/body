{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      final FragmentHighlighterImpl fragmentHighlighter=new FragmentHighlighterImpl(myAppender1,myAppender2);
      for (Iterator<LineFragment> iterator=lines.iterator(); iterator.hasNext(); ) {
        LineFragment line=iterator.next();
        fragmentHighlighter.setIsLast(!iterator.hasNext());
        line.highlight(fragmentHighlighter);
      }
    }
  }
);
  ArrayList<LineFragment> allLineFragments=new ArrayList<LineFragment>();
  for (  LineFragment lineFragment : lines) {
    allLineFragments.add(lineFragment);
    lineFragment.addAllDescendantsTo(allLineFragments);
  }
  myFragmentList=FragmentListImpl.fromList(allLineFragments);
  return LineBlocks.fromLineFragments(allLineFragments);
}
