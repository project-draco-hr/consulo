{
  Document affectedDocument=extractDocumentFromCommand(event);
  if (isUnderIgnoredAction(null))   return;
  if (!worthBothering(affectedDocument,event.getProject()))   return;
  if (myEscPressed) {
    myEscPressed=false;
    if (affectedDocument != null) {
      if (!myDaemonCodeAnalyzer.getFileStatusMap().allDirtyScopesAreNull(affectedDocument)) {
        stopDaemon(true);
      }
    }
  }
 else   if (!myDaemonCodeAnalyzer.isRunning()) {
    stopDaemon(true);
  }
}
