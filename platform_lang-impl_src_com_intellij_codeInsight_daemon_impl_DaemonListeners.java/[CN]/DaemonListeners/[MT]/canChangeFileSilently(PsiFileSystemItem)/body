{
  if (cutOperationJustHappened)   return false;
  VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile == null)   return false;
  if (file instanceof PsiCodeFragment)   return true;
  Project project=file.getProject();
  if (!ModuleUtil.projectContainsFile(project,virtualFile,false))   return false;
  Result vcs=vcsThinksItChanged(virtualFile,project);
  if (vcs == Result.CHANGED)   return true;
  if (vcs == Result.UNCHANGED)   return false;
  return canUndo(virtualFile);
}
