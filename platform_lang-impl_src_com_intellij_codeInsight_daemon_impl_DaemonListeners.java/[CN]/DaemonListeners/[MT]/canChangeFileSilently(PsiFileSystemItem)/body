{
  if (cutOperationJustHappened)   return false;
  VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile == null)   return false;
  if (file instanceof PsiCodeFragment)   return true;
  if (!ModuleUtilCore.projectContainsFile(myProject,virtualFile,false))   return false;
  Result vcs=vcsThinksItChanged(virtualFile);
  if (vcs == Result.CHANGED)   return true;
  if (vcs == Result.UNCHANGED)   return false;
  return canUndo(virtualFile);
}
