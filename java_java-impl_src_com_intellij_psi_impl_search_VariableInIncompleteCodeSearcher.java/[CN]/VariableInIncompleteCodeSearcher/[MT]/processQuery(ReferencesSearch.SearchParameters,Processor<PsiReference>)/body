{
  final PsiElement refElement=p.getElementToSearch();
  if (!(refElement instanceof PsiLocalVariable || refElement instanceof PsiParameter))   return;
  final SearchScope scope=refElement.getUseScope();
  if (scope instanceof LocalSearchScope) {
    final PsiElement[] scopeElements=((LocalSearchScope)scope).getScope();
    if (scopeElements.length == 1) {
      final String name=((PsiVariable)refElement).getName();
      PsiTreeUtil.collectElements(scopeElements[0],new PsiElementFilter(){
        @Override public boolean isAccepted(        final PsiElement element){
          if (element instanceof PsiJavaCodeReferenceElement) {
            final PsiJavaCodeReferenceElement ref=(PsiJavaCodeReferenceElement)element;
            if (name.equals(ref.getCanonicalText()) && ref.resolve() == null && ref.advancedResolve(true).getElement() == refElement) {
              consumer.process(ref);
            }
          }
          return false;
        }
      }
);
    }
  }
}
