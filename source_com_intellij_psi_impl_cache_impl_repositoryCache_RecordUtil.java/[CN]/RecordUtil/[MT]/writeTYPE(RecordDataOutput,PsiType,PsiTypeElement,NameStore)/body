{
  if (typeElement == null) {
    record.writeByte(0x02);
    return;
  }
  final boolean isEllipsis=type instanceof PsiEllipsisType;
  int arrayCount=type.getArrayDimensions();
  type=type.getDeepComponentType();
  while (typeElement.getFirstChild() instanceof PsiTypeElement) {
    typeElement=(PsiTypeElement)typeElement.getFirstChild();
  }
  String text=typeElement instanceof PsiCompiledElement ? ((ClsTypeElementImpl)typeElement).getCanonicalText() : typeElement.getText();
  Integer frequentIndex=ourFrequentTypeIndex.get(text);
  LOG.assertTrue(frequentIndex == null || frequentIndex.intValue() < 16);
  int flags=(arrayCount == 0 ? 0 : 1);
  if (isEllipsis)   flags|=2;
  if (frequentIndex != null) {
    record.writeByte((flags << 6) | 0x01 | (frequentIndex.byteValue() << 2));
    if (arrayCount != 0) {
      record.writeByte(arrayCount);
    }
  }
 else {
    record.writeByte((flags << 6) | 0x00);
    if (arrayCount != 0) {
      record.writeByte(arrayCount);
    }
    writeNAME(record,text,nameStore);
  }
}
