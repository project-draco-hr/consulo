{
  return new Runnable(){
    public void run(){
      try {
        Document doc=PsiDocumentManager.getInstance(myProject).getDocument(file);
        doc.putUserData(CodeStyleManagerEx.USE_DOCUMENT_TO_REFORMAT,Boolean.TRUE);
        try {
          if (myRange == null) {
            CodeStyleManager.getInstance(myProject).reformat(file);
          }
 else {
            CodeStyleManager.getInstance(myProject).reformatRange(file,myRange.getStartOffset(),myRange.getEndOffset());
          }
        }
  finally {
          doc.putUserData(CodeStyleManagerEx.USE_DOCUMENT_TO_REFORMAT,null);
        }
      }
 catch (      IncorrectOperationException e) {
        LOG.error(e);
      }
    }
  }
;
}
