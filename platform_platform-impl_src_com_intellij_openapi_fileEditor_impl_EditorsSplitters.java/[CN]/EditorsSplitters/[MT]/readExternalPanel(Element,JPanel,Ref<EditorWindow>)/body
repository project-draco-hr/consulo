{
  final Element splitterElement=element.getChild("splitter");
  if (splitterElement != null) {
    return readSplitter(panel,splitterElement,currentWindow);
  }
  final Element leaf=element.getChild("leaf");
  if (leaf == null) {
    return null;
  }
  EditorWindow window=(panel == null) ? new EditorWindow(this) : findWindowWith(panel);
  LOG.assertTrue(window != null);
  @SuppressWarnings("unchecked") final List<Element> children=Lists.newArrayList(leaf.getChildren("file"));
  if (UISettings.getInstance().ACTIVATE_RIGHT_EDITOR_ON_CLOSE) {
    Collections.reverse(children);
  }
  VirtualFile currentFile=null;
  for (  final Element file : children) {
    try {
      final HistoryEntry entry=new HistoryEntry(getManager().getProject(),file.getChild(HistoryEntry.TAG),true);
      boolean isCurrent=Boolean.valueOf(file.getAttributeValue("current")).booleanValue();
      getManager().openFileImpl3(window,entry.myFile,false,entry,isCurrent);
      if (getManager().isFileOpen(entry.myFile)) {
        window.setFilePinned(entry.myFile,Boolean.valueOf(file.getAttributeValue("pinned")).booleanValue());
        if (Boolean.valueOf(file.getAttributeValue("current-in-tab")).booleanValue()) {
          currentFile=entry.myFile;
        }
      }
    }
 catch (    InvalidDataException e) {
    }
  }
  if (currentFile != null) {
    final EditorComposite editor=window.findFileComposite(currentFile);
    if (editor != null) {
      window.setSelectedEditor(editor,true);
    }
  }
  return window.myPanel;
}
