{
  if (expression instanceof PsiLiteralExpression) {
    final PsiLiteralExpression literalExpression=(PsiLiteralExpression)expression;
    final Object value=literalExpression.getValue();
    final String text=String.valueOf(value).replace("%","%%").replace("\\'","'");
    formatString.append(text);
  }
 else   if (expression instanceof PsiBinaryExpression) {
    final PsiType type=expression.getType();
    if (type != null && type.equalsToText("java.lang.String")) {
      final PsiBinaryExpression binaryExpression=(PsiBinaryExpression)expression;
      final PsiExpression lhs=binaryExpression.getLOperand();
      buildFormatString(lhs,formatString,formatParameters);
      final PsiExpression rhs=binaryExpression.getROperand();
      if (rhs != null) {
        buildFormatString(rhs,formatString,formatParameters);
      }
    }
 else {
      addFormatParameter(expression,formatString,formatParameters);
    }
  }
 else {
    addFormatParameter(expression,formatString,formatParameters);
  }
}
