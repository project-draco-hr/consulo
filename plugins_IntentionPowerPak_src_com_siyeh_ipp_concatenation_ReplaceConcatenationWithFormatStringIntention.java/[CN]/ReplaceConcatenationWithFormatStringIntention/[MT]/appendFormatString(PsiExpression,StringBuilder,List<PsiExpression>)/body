{
  if (lhs instanceof PsiLiteralExpression) {
    final String text=lhs.getText();
    final int length=text.length();
    final PsiType type=lhs.getType();
    if (type != null && (type.equalsToText("java.lang.String") || type.equalsToText("char"))) {
      if (length > 2) {
        formatString.append(text.substring(1,length - 1).replace("%","%%"));
      }
    }
 else {
      formatString.append(text);
    }
  }
 else   if (lhs instanceof PsiBinaryExpression) {
    final PsiBinaryExpression binaryExpression=(PsiBinaryExpression)lhs;
    buildFormatString(binaryExpression,formatString,formatParameters);
  }
 else {
    final PsiType type=lhs.getType();
    if (type != null && (type.equalsToText("long") || type.equalsToText("int") || type.equalsToText("java.lang.Long")|| type.equalsToText("java.lang.Integer"))) {
      formatString.append("%d");
    }
 else {
      formatString.append("%s");
    }
    formatParameters.add(lhs);
  }
}
