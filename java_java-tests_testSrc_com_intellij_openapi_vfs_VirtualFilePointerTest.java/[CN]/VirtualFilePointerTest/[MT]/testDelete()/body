{
  File tempDirectory=createTempDirectory();
  final File fileToDelete=new File(tempDirectory,"toDelete.txt");
  fileToDelete.createNewFile();
  final LoggingListener fileToDeleteListener=new LoggingListener();
  final VirtualFilePointer fileToDeletePointer=createPointerByFile(fileToDelete,fileToDeleteListener);
  assertTrue(fileToDeletePointer.isValid());
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      final VirtualFile virtualFile=getVirtualFile(fileToDelete);
      try {
        virtualFile.delete(null);
      }
 catch (      IOException e) {
        fail();
      }
    }
  }
);
  assertFalse(fileToDeletePointer.isValid());
  assertEquals("[before:true, after:false]",fileToDeleteListener.getLog().toString());
  myFilesToDelete.add(tempDirectory);
}
