{
  final VirtualFile[] vFile=new VirtualFile[1];
  final String url=VirtualFileManager.constructUrl(LocalFileSystem.PROTOCOL,file.getCanonicalPath().replace(File.separatorChar,'/'));
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      vFile[0]=VirtualFileManager.getInstance().refreshAndFindFileByUrl(url);
    }
  }
);
  final VirtualFilePointer fileToDeletePointer;
  if (vFile[0] == null) {
    fileToDeletePointer=myVirtualFilePointerManager.create(url,myProject,fileListener);
  }
 else {
    fileToDeletePointer=myVirtualFilePointerManager.create(vFile[0],myProject,fileListener);
  }
  return fileToDeletePointer;
}
