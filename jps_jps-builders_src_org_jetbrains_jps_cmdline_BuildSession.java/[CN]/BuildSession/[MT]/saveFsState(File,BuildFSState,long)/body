{
  final File file=new File(dataStorageRoot,FS_STATE_FILE);
  if (lastEventOrdinal < 0L) {
    FileUtil.delete(file);
    return;
  }
  BufferExposingByteArrayOutputStream bytes=new BufferExposingByteArrayOutputStream();
  try {
    final DataOutputStream out=new DataOutputStream(bytes);
    out.writeLong(lastEventOrdinal);
    try {
      state.save(out);
    }
  finally {
      out.close();
    }
  }
 catch (  IOException e) {
    LOG.error(e);
    return;
  }
  FileOutputStream fos=null;
  try {
    fos=new FileOutputStream(file);
  }
 catch (  FileNotFoundException e) {
    FileUtil.createIfDoesntExist(file);
  }
  try {
    if (fos == null) {
      fos=new FileOutputStream(file);
    }
    try {
      fos.write(bytes.getInternalBuffer(),0,bytes.size());
    }
  finally {
      fos.close();
    }
  }
 catch (  IOException e) {
    LOG.error(e);
    FileUtil.delete(file);
  }
}
