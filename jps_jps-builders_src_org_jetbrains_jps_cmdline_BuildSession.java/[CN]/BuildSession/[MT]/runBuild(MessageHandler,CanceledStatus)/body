{
  final File dataStorageRoot=Utils.getDataStorageRoot(myProjectPath);
  if (dataStorageRoot == null) {
    msgHandler.processMessage(new CompilerMessage("build",BuildMessage.Kind.ERROR,"Cannot determine build data storage root for project " + myProjectPath));
    return;
  }
  final BuildFSState fsState=new BuildFSState(false);
  try {
    final boolean shouldApplyEvent=loadFsState(fsState,dataStorageRoot,myInitialFSDelta);
    if (shouldApplyEvent && myBuildType == BuildType.MAKE && !containsChanges(myInitialFSDelta) && !fsState.hasWorkToDo()) {
      applyFSEvent(null,myInitialFSDelta);
      return;
    }
    if (!dataStorageRoot.exists()) {
      myBuildType=BuildType.PROJECT_REBUILD;
    }
    ProjectDescriptor pd=myBuildRunner.load(msgHandler,dataStorageRoot,fsState);
    myProjectDescriptor=pd;
    if (shouldApplyEvent) {
      applyFSEvent(myProjectDescriptor,myInitialFSDelta);
    }
    myInitialFSDelta=null;
    myEventsProcessor.startProcessing();
    myBuildRunner.runBuild(pd,cs,myConstantSearch,msgHandler,true,myBuildType);
  }
  finally {
    saveData(fsState,dataStorageRoot);
  }
}
