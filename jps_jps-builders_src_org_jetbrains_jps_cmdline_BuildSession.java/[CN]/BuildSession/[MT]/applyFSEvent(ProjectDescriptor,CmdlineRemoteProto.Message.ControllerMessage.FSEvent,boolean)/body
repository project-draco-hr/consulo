{
  if (event == null) {
    return;
  }
  final Timestamps timestamps=pd.timestamps.getStorage();
  boolean cacheCleared=false;
  for (  String deleted : event.getDeletedPathsList()) {
    final File file=new File(deleted);
    Collection<BuildRootDescriptor> descriptor=pd.getBuildRootIndex().findAllParentDescriptors(file,null,null);
    if (!descriptor.isEmpty()) {
      if (!cacheCleared) {
        pd.getFSCache().clear();
        cacheCleared=true;
      }
      if (Utils.IS_TEST_MODE) {
        LOG.info("Applying deleted path from fs event: " + file.getPath());
      }
      for (      BuildRootDescriptor rootDescriptor : descriptor) {
        pd.fsState.registerDeleted(rootDescriptor.getTarget(),file,timestamps);
      }
    }
 else     if (Utils.IS_TEST_MODE) {
      LOG.info("Skipping deleted path: " + file.getPath());
    }
  }
  for (  String changed : event.getChangedPathsList()) {
    final File file=new File(changed);
    Collection<BuildRootDescriptor> descriptors=pd.getBuildRootIndex().findAllParentDescriptors(file,null,null);
    if (!descriptors.isEmpty()) {
      if (Utils.IS_TEST_MODE) {
        LOG.info("Applying dirty path from fs event: " + file.getPath());
      }
      long fileStamp=-1L;
      for (      BuildRootDescriptor descriptor : descriptors) {
        if (!descriptor.isGenerated()) {
          if (fileStamp == -1L) {
            fileStamp=FileSystemUtil.lastModified(file);
          }
          long stamp=timestamps.getStamp(file,descriptor.getTarget());
          if (stamp != fileStamp) {
            if (!cacheCleared) {
              pd.getFSCache().clear();
              cacheCleared=true;
            }
            pd.fsState.markDirty(null,file,descriptor,timestamps,saveEventStamp);
          }
        }
      }
    }
 else     if (Utils.IS_TEST_MODE) {
      LOG.info("Skipping dirty path: " + file.getPath());
    }
  }
}
