{
  final File file=new File(dataStorageRoot,FS_STATE_FILE);
  try {
    final BufferExposingByteArrayOutputStream bytes=new BufferExposingByteArrayOutputStream();
    final DataOutputStream out=new DataOutputStream(bytes);
    try {
      out.writeInt(FSState.VERSION);
      out.writeLong(ordinal);
      out.writeBoolean(false);
      while (true) {
        final int b=original.read();
        if (b == -1) {
          break;
        }
        out.write(b);
      }
    }
  finally {
      out.close();
    }
    saveOnDisk(bytes,file);
  }
 catch (  Throwable e) {
    LOG.error(e);
    FileUtil.delete(file);
  }
}
