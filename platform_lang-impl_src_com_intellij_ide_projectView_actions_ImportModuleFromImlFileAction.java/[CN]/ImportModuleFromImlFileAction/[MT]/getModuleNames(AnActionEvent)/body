{
  final VirtualFile[] files=e.getData(PlatformDataKeys.VIRTUAL_FILE_ARRAY);
  final Project project=getEventProject(e);
  if (project == null || files == null || files.length == 0) {
    return Collections.emptyList();
  }
  List<VirtualFile> modulesFiles=new ArrayList<VirtualFile>();
  for (  VirtualFile file : files) {
    if (!file.getFileType().equals(StdFileTypes.IDEA_MODULE)) {
      return Collections.emptyList();
    }
    modulesFiles.add(file);
  }
  final ModuleManager moduleManager=ModuleManager.getInstance(project);
  for (  Module module : moduleManager.getModules()) {
    modulesFiles.remove(module.getModuleFile());
  }
  return modulesFiles;
}
