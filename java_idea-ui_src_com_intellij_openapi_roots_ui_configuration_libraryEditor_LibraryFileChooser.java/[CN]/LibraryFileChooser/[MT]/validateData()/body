{
  JComponent componentToFocus=null;
  try {
    final VirtualFile[] chosenFiles=getSelectedFiles();
    if (chosenFiles != null && chosenFiles.length > 0) {
      if (myInputName) {
        final String name=getName();
        if (name == null) {
          Messages.showErrorDialog(myNameField,ProjectBundle.message("library.name.not.specified.error"),ProjectBundle.message("library.name.not.specified.title"));
          componentToFocus=myNameField;
          return false;
        }
        if (myParentEditor.libraryAlreadyExists(name)) {
          Messages.showErrorDialog(myNameField,ProjectBundle.message("library.name.already.exists.error",name),ProjectBundle.message("library.name.already.exists.title"));
          componentToFocus=myNameField;
          return false;
        }
      }
    }
 else {
      Messages.showErrorDialog(ProjectBundle.message("library.files.not.selected.error"),ProjectBundle.message("library.files.not.selected.title"));
      componentToFocus=myFileSystemTree.getTree();
      return false;
    }
    return true;
  }
  finally {
    if (componentToFocus != null) {
      final JComponent _componentToFocus=componentToFocus;
      SwingUtilities.invokeLater(new Runnable(){
        public void run(){
          _componentToFocus.requestFocus();
        }
      }
);
    }
  }
}
