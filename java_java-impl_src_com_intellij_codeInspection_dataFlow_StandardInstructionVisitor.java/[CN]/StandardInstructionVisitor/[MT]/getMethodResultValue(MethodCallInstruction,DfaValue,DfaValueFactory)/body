{
  DfaValue precalculated=instruction.getPrecalculatedReturnValue();
  if (precalculated != null) {
    return precalculated;
  }
  final PsiType type=instruction.getResultType();
  final MethodCallInstruction.MethodType methodType=instruction.getMethodType();
  if (type != null && (type instanceof PsiClassType || type.getArrayDimensions() > 0)) {
    @Nullable final Boolean nullability=myReturnTypeNullability.get(instruction);
    return factory.createTypeValueWithNullability(type,nullability);
  }
  if (methodType == MethodCallInstruction.MethodType.UNBOXING) {
    return factory.getBoxedFactory().createUnboxed(qualifierValue);
  }
  if (methodType == MethodCallInstruction.MethodType.BOXING) {
    DfaValue boxed=factory.getBoxedFactory().createBoxed(qualifierValue);
    return boxed == null ? DfaUnknownValue.getInstance() : boxed;
  }
  if (methodType == MethodCallInstruction.MethodType.CAST) {
    if (qualifierValue instanceof DfaConstValue) {
      return factory.getConstFactory().createFromValue(castConstValue((DfaConstValue)qualifierValue),type);
    }
    return qualifierValue;
  }
  return DfaUnknownValue.getInstance();
}
