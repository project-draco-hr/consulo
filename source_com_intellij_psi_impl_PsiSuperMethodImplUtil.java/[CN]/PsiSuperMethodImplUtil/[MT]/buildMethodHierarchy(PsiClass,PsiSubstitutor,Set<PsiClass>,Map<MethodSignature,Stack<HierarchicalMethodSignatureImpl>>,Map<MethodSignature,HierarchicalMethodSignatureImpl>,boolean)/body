{
  if (visited.contains(aClass))   return;
  visited.add(aClass);
  final PsiMethod[] methods=aClass.getMethods();
  for (  PsiMethod method : methods) {
    if (!includePrivates && method.hasModifierProperty(PsiModifier.PRIVATE))     continue;
    final MethodSignatureBackedByPsiMethod signature=MethodSignatureBackedByPsiMethod.create(method,substitutor);
    final HierarchicalMethodSignatureImpl signatureHierarchical=new HierarchicalMethodSignatureImpl(signature);
    Stack<HierarchicalMethodSignatureImpl> stack=signatures.get(signature);
    if (stack != null) {
      boolean isNewSignature=true;
      for (      final HierarchicalMethodSignatureImpl existing : stack) {
        final PsiMethod hisMethod=existing.getMethod();
        final PsiClass hisClass=hisMethod.getContainingClass();
        if (!hisMethod.isConstructor() && !aClass.equals(hisClass) && !(hisClass.isInterface() && "java.lang.Object".equals(aClass.getQualifiedName()) && !method.hasModifierProperty(PsiModifier.PUBLIC))) {
          if (MethodSignatureUtil.isSubsignature(signature,existing)) {
            existing.addSuperSignature(signatureHierarchical);
            isNewSignature=false;
            break;
          }
        }
      }
      if (isNewSignature) {
        result.put(signature,signatureHierarchical);
      }
    }
 else {
      result.put(signature,signatureHierarchical);
      stack=new Stack<HierarchicalMethodSignatureImpl>();
      signatures.put(signature,stack);
    }
    stack.push(signatureHierarchical);
  }
  final PsiClassType[] superTypes=aClass.getSuperTypes();
  for (  final PsiClassType superType : superTypes) {
    final PsiClassType.ClassResolveResult superTypeResolveResult=superType.resolveGenerics();
    PsiClass superClass=superTypeResolveResult.getElement();
    if (superClass == null)     continue;
    PsiSubstitutor finalSubstitutor=obtainFinalSubstitutor(superClass,superTypeResolveResult.getSubstitutor(),substitutor);
    buildMethodHierarchy(superClass,finalSubstitutor,visited,signatures,result,false);
  }
}
