def b85encode(text, pad=False):
    'encode text in base85 format'
    l = len(text)
    r = (l % 4)
    if r:
        text += ('\x00' * (4 - r))
    longs = (len(text) >> 2)
    words = struct.unpack(('>%dL' % longs), text)
    out = ''.join((((_b85chars[((word // 52200625) % 85)] + _b85chars2[((word // 7225) % 7225)]) + _b85chars2[(word % 7225)]) for word in words))
    if pad:
        return out
    olen = (l % 4)
    if olen:
        olen += 1
    olen += ((l // 4) * 5)
    return out[:olen]
