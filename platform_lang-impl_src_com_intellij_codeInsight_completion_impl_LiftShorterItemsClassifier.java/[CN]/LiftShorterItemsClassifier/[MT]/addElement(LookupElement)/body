{
  final Set<LookupElement> toUpdate=new THashSet<LookupElement>(TObjectHashingStrategy.IDENTITY);
  toUpdate.add(element);
  final Set<String> strings=getAllLookupStrings(element);
  for (  String string : strings) {
    if (string.length() == 0)     continue;
    myElements.putValue(string,element);
    mySortedStrings.add(string);
    final NavigableSet<String> after=mySortedStrings.tailSet(string,false);
    for (    String s : after) {
      if (!s.startsWith(string)) {
        break;
      }
      myPrefixes.putValue(s,string);
      toUpdate.addAll(myElements.get(s));
    }
    for (int len=1; len < string.length(); len++) {
      String shorter=string.substring(0,len);
      if (myElements.containsKey(shorter)) {
        myPrefixes.putValue(string,shorter);
      }
    }
  }
  myNext.addElement(element);
  for (  LookupElement lookupElement : toUpdate) {
    recalculateToLift(lookupElement);
  }
}
