{
  final Set<LookupElement> forPreselection=new THashSet<LookupElement>(TObjectHashingStrategy.IDENTITY);
  final Set<LookupElement> forSorting=new THashSet<LookupElement>(TObjectHashingStrategy.IDENTITY);
  final List<String> prefixes=new SmartList<String>();
  for (  String string : getAllLookupStrings(element)) {
    prefixes.addAll(myPrefixes.get(string));
  }
  Collections.sort(prefixes);
  for (  String prefix : prefixes) {
    for (    LookupElement shorterElement : myElements.get(prefix)) {
      if (myCondition.shouldLift(shorterElement,element)) {
        forPreselection.add(shorterElement);
      }
 else {
        forSorting.add(shorterElement);
      }
    }
  }
  myToLiftForPreselection.remove(element);
  myToLiftForSorting.remove(element);
  if (!forPreselection.isEmpty()) {
    myToLiftForPreselection.put(element,forPreselection);
  }
  if (!forSorting.isEmpty()) {
    myToLiftForSorting.put(element,forSorting);
  }
}
