{
  final StringBuilder buf=new StringBuilder();
  String separator="";
  List<Caret> carets=editor.getCaretModel().getAllCarets();
  int[] startOffsets=new int[carets.size()];
  int[] endOffsets=new int[carets.size()];
  for (int i=0; i < carets.size(); i++) {
    buf.append(separator);
    String caretSelectedText=carets.get(i).getSelectedText();
    startOffsets[i]=buf.length();
    if (caretSelectedText != null) {
      buf.append(caretSelectedText);
    }
    endOffsets[i]=buf.length();
    separator="\n";
  }
  extraDataCollector.add(new CaretStateTransferableData(startOffsets,endOffsets));
  return buf.toString();
}
