def uisetup(ui):
    if ui.configbool('progress', 'disable'):
        return
    if ((sys.stderr.isatty() or ui.configbool('progress', 'assume-tty')) and (not ui.debugflag) and (not ui.quiet)):
        global sharedprog
        if (not sharedprog):
            sharedprog = progbar(ui)
        extensions.wrapfunction(ui, 'progress', sharedprog.progress)
        extensions.wrapfunction(ui, 'write', sharedprog.write)
        extensions.wrapfunction(ui, 'write_err', sharedprog.write)
