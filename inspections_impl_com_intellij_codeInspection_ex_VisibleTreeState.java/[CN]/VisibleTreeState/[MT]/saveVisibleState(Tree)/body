{
  myExpandedNodes.clear();
  final DefaultMutableTreeNode rootNode=(DefaultMutableTreeNode)tree.getModel().getRoot();
  Enumeration<TreePath> expanded=tree.getExpandedDescendants(new TreePath(rootNode.getPath()));
  if (expanded != null) {
    while (expanded.hasMoreElements()) {
      final TreePath treePath=expanded.nextElement();
      final DefaultMutableTreeNode node=(DefaultMutableTreeNode)treePath.getLastPathComponent();
      String expandedNode;
      if (node.getUserObject() instanceof Descriptor) {
        expandedNode=((Descriptor)node.getUserObject()).getKey().toString();
      }
 else {
        expandedNode=(String)node.getUserObject();
      }
      myExpandedNodes.add(expandedNode);
    }
  }
  mySelectedNodes.clear();
  final TreePath[] selectionPaths=tree.getSelectionPaths();
  for (int i=0; selectionPaths != null && i < selectionPaths.length; i++) {
    final DefaultMutableTreeNode node=(DefaultMutableTreeNode)selectionPaths[i].getLastPathComponent();
    String selectedNode;
    if (node.getUserObject() instanceof Descriptor) {
      selectedNode=((Descriptor)node.getUserObject()).getKey().toString();
    }
 else {
      selectedNode=(String)node.getUserObject();
    }
    mySelectedNodes.add(selectedNode);
  }
}
