{
synchronized (myStateLock) {
    HashMap<VirtualFile,String> currents=new HashMap<VirtualFile,String>();
    for (    VirtualFile root : myGitRoots) {
      GitBranch current=GitBranch.current(myProject,root);
      currents.put(root,current == null ? "" : current.getName());
    }
    if (myConfigurations.isEmpty()) {
      List<String> locals=detectConfigurations(true,myGitRoots);
      if (locals.isEmpty()) {
        locals.add("master");
      }
      for (      String localName : locals) {
        GitBranchConfiguration c=createConfiguration(localName);
        c.setAutoDetected(true);
        boolean currentsMatched=true;
        for (        VirtualFile root : myGitRoots) {
          c.setBranch(root.getPath(),localName);
          currentsMatched&=currents.get(root).equals(localName);
        }
        if (currentsMatched) {
          myCurrentConfiguration=c;
        }
      }
      if (myCurrentConfiguration == null) {
        String name="Unknown 1";
        GitBranchConfiguration c=createConfiguration(name);
        for (        VirtualFile root : myGitRoots) {
          c.setBranch(root.getPath(),describeRoot(root));
        }
      }
    }
    fireCurrentConfigurationChanged();
    fireConfigurationsChanged();
  }
}
