{
synchronized (myStateLock) {
    State rc=new State();
    rc.CURRENT=myCurrentConfiguration == null ? null : myCurrentConfiguration.getName();
    ArrayList<BranchConfiguration> cs=new ArrayList<BranchConfiguration>(myConfigurations.size());
    for (    GitBranchConfiguration ci : myConfigurations.values()) {
      BranchConfiguration c=new BranchConfiguration();
      c.NAME=ci.getName();
      Map<String,String> map=ci.getReferences();
      ArrayList<BranchInfo> bs=new ArrayList<BranchInfo>(map.size());
      for (      Map.Entry<String,String> m : map.entrySet()) {
        BranchInfo b=new BranchInfo();
        b.ROOT=m.getKey();
        b.REFERENCE=m.getValue();
        bs.add(b);
      }
      c.BRANCHES=bs.toArray(new BranchInfo[bs.size()]);
      Arrays.sort(c.BRANCHES,BRANCH_INFO_COMPARATOR);
      c.CHANGES=ci.getChanges();
      c.IS_AUTO_DETECTED=ci.isAutoDetected();
      cs.add(c);
    }
    rc.CONFIGURATIONS=cs.toArray(new BranchConfiguration[cs.size()]);
    Arrays.sort(rc.CONFIGURATIONS,CONFIGURATION_COMPARATOR);
    return rc;
  }
}
