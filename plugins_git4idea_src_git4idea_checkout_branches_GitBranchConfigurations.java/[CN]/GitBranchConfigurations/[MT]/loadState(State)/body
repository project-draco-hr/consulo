{
synchronized (myStateLock) {
    myConfigurations.clear();
    for (    BranchConfiguration bc : state.CONFIGURATIONS) {
      GitBranchConfiguration n=new GitBranchConfiguration(this,bc.NAME);
      myConfigurations.put(n.getName(),n);
      for (      BranchInfo bi : bc.BRANCHES) {
        n.setBranch(bi.ROOT,bi.REFERENCE);
      }
      myConfigurations.put(bc.NAME,n);
      n.setAutoDetected(bc.IS_AUTO_DETECTED);
    }
    if (myCurrentConfiguration == null) {
      myCurrentConfiguration=myConfigurations.get(state.CURRENT);
    }
 else {
      myCurrentConfiguration=myConfigurations.get(myCurrentConfiguration.getName());
      if (myCurrentConfiguration == null) {
        myCurrentConfiguration=myConfigurations.get(state.CURRENT);
      }
    }
    fireCurrentConfigurationChanged();
    fireConfigurationsChanged();
    if (state.IS_WIDGET_ENABLED != myWidgetEnabled) {
      myWidgetEnabled=state.IS_WIDGET_ENABLED;
      updateWidgetState();
    }
  }
}
