{
  final PsiVariable refVariable=findPreviousVariable();
  if (refVariable == null)   return;
  if (!CodeInsightUtil.preparePsiElementsForWrite(myVariable,refVariable))   return;
  final PsiExpression initializer=myVariable.getInitializer();
  if (initializer == null) {
    myVariable.delete();
    return;
  }
  PsiUtil.setModifierProperty(refVariable,PsiModifier.FINAL,false);
  final PsiElementFactory factory=JavaPsiFacade.getInstance(myVariable.getProject()).getElementFactory();
  final PsiElement replacement;
  final PsiElement parent=myVariable.getParent();
  if (parent instanceof PsiResource) {
    replacement=factory.createResourceFromText(myVariable.getName() + " = " + initializer.getText(),null);
  }
 else {
    replacement=factory.createStatementFromText(myVariable.getName() + " = " + initializer.getText()+ ";",null);
  }
  parent.replace(replacement);
}
