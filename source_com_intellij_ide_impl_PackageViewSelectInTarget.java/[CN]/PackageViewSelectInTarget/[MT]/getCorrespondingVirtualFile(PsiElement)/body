{
  final VirtualFile vFile;
  if (psiElement instanceof PsiFile) {
    vFile=((PsiFile)psiElement).getVirtualFile();
  }
 else {
    final PsiFile psiFile=psiElement.getContainingFile();
    if (psiFile == null) {
      vFile=null;
    }
 else {
      vFile=psiFile.getVirtualFile();
    }
  }
  if (vFile == null || !vFile.isValid()) {
    return null;
  }
  return vFile;
}
