{
  try {
    final ModuleEditor selectedEditor=getSelectedEditor();
    String question;
    if (myModuleEditors.size() == 1) {
      question="Are you sure you want to remove the only module from this project?\nNo files will be deleted on disk.";
    }
 else {
      question="Remove module \"" + selectedEditor.getModule().getName() + "\" from the project?\nNo files will be deleted on disk.";
    }
    int result=Messages.showYesNoDialog(myModuleEditorsList,question,"Remove Module",Messages.getQuestionIcon());
    if (result != 0) {
      return;
    }
    myModuleEditors.remove(selectedEditor);
    removeModuleEditorUIComponent(selectedEditor);
    final DefaultListModel listModel=(DefaultListModel)myModuleEditorsList.getModel();
    final int selectedIndex=myModuleEditorsList.getSelectedIndex();
    listModel.removeElementAt(selectedIndex);
    if (selectedIndex < listModel.getSize()) {
      myModuleEditorsList.setSelectedIndex(selectedIndex);
    }
 else     if (listModel.getSize() > 0) {
      myModuleEditorsList.setSelectedIndex(0);
    }
    final ModuleEditor newSelectedEditor=getSelectedEditor();
    final String selectedTabName=selectedEditor.getSelectedTabName();
    showModuleEditor(newSelectedEditor,selectedTabName);
    final Module moduleToRemove=selectedEditor.getModule();
    List<ModifiableRootModel> modifiableRootModels=new ArrayList<ModifiableRootModel>();
    for (Iterator it=myModuleEditors.iterator(); it.hasNext(); ) {
      final ModuleEditor moduleEditor=(ModuleEditor)it.next();
      if (moduleToRemove.equals(moduleEditor.getModule())) {
        continue;
      }
      final ModifiableRootModel modifiableRootModel=moduleEditor.getModifiableRootModelProxy();
      modifiableRootModels.add(modifiableRootModel);
    }
    final ModifiableRootModel model=selectedEditor.dispose();
    ModuleDeleteProvider.removeModule(moduleToRemove,model,modifiableRootModels,myModuleModel);
    myModuleEditorsList.revalidate();
    processModuleCountChanged(myModuleEditors.size() + 1,myModuleEditors.size());
  }
  finally {
    myModuleEditorsList.requestFocus();
  }
}
