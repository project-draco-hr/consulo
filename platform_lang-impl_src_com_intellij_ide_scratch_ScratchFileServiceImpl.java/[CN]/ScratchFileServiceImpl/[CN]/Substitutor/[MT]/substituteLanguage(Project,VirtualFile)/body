{
  RootType rootType=ScratchFileService.getInstance().getRootType(file);
  if (rootType == null)   return null;
  Language language=rootType.substituteLanguage(project,file);
  Language adjusted=language != null ? language : getLanguageByFileName(file);
  return adjusted != null && adjusted != ScratchFileType.INSTANCE.getLanguage() ? LanguageSubstitutors.INSTANCE.substituteLanguage(adjusted,file,project) : adjusted;
}
