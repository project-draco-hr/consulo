{
  if (myPopupShowing != null) {
    return null;
  }
  BreakpointMasterDetailPopupBuilder builder=new BreakpointMasterDetailPopupBuilder(myProject);
  builder.setInitialBreakpoint(initialBreakpoint != null ? initialBreakpoint : myBreakpoint);
  builder.setBreakpointsPanelProviders(XBreakpointUtil.collectPanelProviders());
  builder.setCallback(new BreakpointMasterDetailPopupBuilder.BreakpointChosenCallback(){
    @Override public void breakpointChosen(    Project project,    BreakpointItem breakpointItem,    JBPopup popup,    boolean withEnterOrDoubleClick){
      if (withEnterOrDoubleClick && breakpointItem.canNavigate()) {
        breakpointItem.navigate(true);
        popup.cancel();
      }
    }
  }
);
  myBreakpoint=null;
  final JBPopup popup=builder.createPopup();
  popup.addListener(new JBPopupListener(){
    @Override public void beforeShown(    LightweightWindowEvent event){
      if (myBalloonToHide != null) {
        if (!myBalloonToHide.isDisposed()) {
          myBalloonToHide.hide();
        }
        myBalloonToHide=null;
      }
      myPopupShowing=popup;
    }
    @Override public void onClosed(    LightweightWindowEvent event){
      for (      BreakpointPanelProvider provider : XBreakpointUtil.collectPanelProviders()) {
        provider.onDialogClosed(myProject);
      }
      myPopupShowing=null;
    }
  }
);
  return popup;
}
