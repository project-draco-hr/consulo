{
  BreakpointMasterDetailPopupBuilder builder=new BreakpointMasterDetailPopupBuilder(myProject);
  builder.setInitialBreakpoint(initialBreakpoint);
  builder.setBreakpointsPanelProviders(collectPanelProviders());
  builder.setCallback(new BreakpointMasterDetailPopupBuilder.BreakpointChosenCallback(){
    @Override public void breakpointChosen(    Project project,    BreakpointItem breakpointItem,    JBPopup popup){
      if (breakpointItem.navigate()) {
        popup.cancel();
      }
    }
  }
);
  final JBPopup popup=builder.createPopup();
  popup.addListener(new JBPopupListener(){
    @Override public void beforeShown(    LightweightWindowEvent event){
      if (myBalloonToHide != null)       myBalloonToHide.hide();
    }
    @Override public void onClosed(    LightweightWindowEvent event){
      for (      BreakpointPanelProvider provider : collectPanelProviders()) {
        provider.onDialogClosed(myProject);
      }
    }
  }
);
  return popup;
}
