{
  assertTrue(SystemInfo.isWindows || SystemInfo.isUnix);
  final File targetFile=new File(FileUtil.toSystemDependentName(target));
  final File linkFile=getFullLinkPath(link);
  final ProcessBuilder command;
  if (SystemInfo.isWindows) {
    command=targetFile.isDirectory() ? new ProcessBuilder("cmd","/C","mklink","/D",linkFile.getPath(),targetFile.getPath()) : new ProcessBuilder("cmd","/C","mklink",linkFile.getPath(),targetFile.getPath());
  }
 else {
    command=new ProcessBuilder("ln","-s",targetFile.getPath(),linkFile.getPath());
  }
  final int res=runCommand(command);
  assertEquals(command.command().toString(),0,res);
  final boolean shouldExist=targetFile.exists() || SystemInfo.isWindows && SystemInfo.JAVA_VERSION.startsWith("1.6");
  assertEquals("target=" + target + ", link="+ linkFile,shouldExist,linkFile.exists());
  return linkFile;
}
