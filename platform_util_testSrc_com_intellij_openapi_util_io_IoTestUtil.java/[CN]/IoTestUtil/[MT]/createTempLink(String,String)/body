{
  assertTrue(SystemInfo.isWindows || SystemInfo.isUnix);
  final File linkFile=getFullLinkPath(link);
  final ProcessBuilder command;
  if (SystemInfo.isWindows) {
    command=new File(target).isDirectory() ? new ProcessBuilder("cmd","/C","mklink","/D",linkFile.getAbsolutePath(),target) : new ProcessBuilder("cmd","/C","mklink",linkFile.getAbsolutePath(),target);
  }
 else {
    command=new ProcessBuilder("ln","-s",target,linkFile.getAbsolutePath());
  }
  final int res=runCommand(command);
  assertEquals(command.command().toString(),0,res);
  final File targetFile=new File(target);
  final boolean shouldExist=targetFile.exists() || SystemInfo.isWindows && SystemInfo.JAVA_VERSION.startsWith("1.6");
  assertEquals("target=" + target + ", link="+ linkFile,shouldExist,linkFile.exists());
  return linkFile;
}
