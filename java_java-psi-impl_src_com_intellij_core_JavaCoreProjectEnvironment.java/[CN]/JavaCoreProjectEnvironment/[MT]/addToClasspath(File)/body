{
  final VirtualFile root=path.isFile() ? getEnvironment().getJarFileSystem().findFileByPath(path + "!/") : getEnvironment().getLocalFileSystem().findFileByPath(path.getPath());
  if (root != null) {
    myFileManager.addToClasspath(path);
    myFileIndexFacade.addLibraryRoot(root);
  }
 else {
    throw new IllegalArgumentException("trying to add non-existing file to classpath: " + path);
  }
}
