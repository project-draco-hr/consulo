{
  (new VcsBackgroundTask<VirtualFile>(myProject,HgVcsMessages.message("hg4idea.add.progress"),VcsConfiguration.getInstance(myProject).getAddRemoveOption(),addedFiles){
    protected void process(    final VirtualFile file) throws VcsException {
      if (file.isDirectory()) {
        return;
      }
      final VirtualFile copyFrom=copyFromMap.get(file);
      if (copyFrom != null) {
        (new HgCopyCommand(myProject)).execute(new HgFile(myProject,copyFrom),new HgFile(myProject,file));
      }
 else {
        (new HgAddCommand(myProject)).execute(new HgFile(myProject,file));
      }
      dirtyScopeManager.fileDirty(file);
    }
  }
).queue();
}
