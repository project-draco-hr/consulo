{
  if (targetElement instanceof PsiDirectory) {
    final PsiElement[] adjustedElements=MoveClassesOrPackagesImpl.adjustForMove(project,sourceElements,targetElement);
    if (adjustedElements != null) {
      if (CommonRefactoringUtil.checkReadOnlyStatusRecursively(project,Arrays.asList(adjustedElements),true)) {
        final PsiPackage psiPackage=JavaDirectoryService.getInstance().getPackage((PsiDirectory)targetElement);
        if (psiPackage != null) {
          final Module module=ModuleUtil.findModuleForFile(((PsiDirectory)targetElement).getVirtualFile(),project);
          if (module != null) {
            if (psiPackage.getDirectories(GlobalSearchScope.moduleScope(module)).length > 1)             return false;
          }
        }
        new MoveClassesOrPackagesToNewDirectoryDialog((PsiDirectory)targetElement,adjustedElements,callback).show();
      }
    }
    return true;
  }
  return false;
}
