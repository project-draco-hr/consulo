{
  if (project.isDisposed() || !GradleUtil.isGradleAvailable(project)) {
    return GradleApiFacade.NULL_OBJECT;
  }
  Pair<GradleApiFacade,RemoteGradleProcessSettings> pair=myRemoteFacades.get(project.getName());
  if (pair != null && isValid(pair)) {
    return pair.first;
  }
  myLock.lock();
  try {
    pair=myRemoteFacades.get(project.getName());
    if (pair != null && isValid(pair)) {
      return pair.first;
    }
    if (pair != null) {
      mySupport.stopAll(true);
      myFacadeWrappers.clear();
      myRemoteFacades.clear();
    }
    return doCreateFacade(project);
  }
  finally {
    myLock.unlock();
  }
}
