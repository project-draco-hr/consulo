{
  ApplicationManager.getApplication().assertIsDispatchThread();
  if (Disposer.isDisposed(transaction.parentDisposable))   return;
  boolean wasWritingAllowed=myWritingAllowed;
  myWritingAllowed=true;
  myCurrentTransaction=new TransactionIdImpl(myCurrentTransaction);
  try {
    transaction.runnable.run();
  }
  finally {
    Queue<Transaction> queue=getQueue(myCurrentTransaction.myParent);
    queue.addAll(myCurrentTransaction.myQueue);
    if (!queue.isEmpty()) {
      pollQueueLater();
    }
    myWritingAllowed=wasWritingAllowed;
    myCurrentTransaction.myFinished=true;
    myCurrentTransaction=myCurrentTransaction.myParent;
  }
}
