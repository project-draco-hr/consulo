{
  PsiElement atLineStart=myFile.findElementAt(lineStart);
  if (atLineStart == null)   return false;
  if (atLineStart.getText().equals(DOC_COMMENT_ASTERISK_STRING) || atLineStart.getText().equals(DOC_COMMENT_PREFIX)) {
    PsiElement element=myFile.findElementAt(myOffset);
    if (element == null)     return false;
    PsiDocComment comment=null;
    if (element.getParent() instanceof PsiDocComment) {
      comment=(PsiDocComment)element.getParent();
    }
 else     if (element.getParent() instanceof PsiDocTag && element.getParent().getParent() instanceof PsiDocComment) {
      comment=(PsiDocComment)element.getParent().getParent();
    }
    if (comment != null) {
      int commentEnd=comment.getTextRange().getEndOffset();
      if (myOffset >= commentEnd) {
        docAsterisk=false;
      }
 else {
        removeTrailingSpaces(myDocument,myOffset);
        myDocument.insertString(myOffset,createDocCommentLine("",getProject()));
        PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
      }
    }
 else {
      docAsterisk=false;
    }
  }
 else   if (atLineStart instanceof PsiComment && ((PsiComment)atLineStart).getTokenType() == JavaTokenType.C_STYLE_COMMENT) {
    boolean usesAstersk=false;
    int commentLine=myDocument.getLineNumber(atLineStart.getTextRange().getStartOffset());
    if (commentLine < myDocument.getLineCount() - 1 && atLineStart.getTextRange().getEndOffset() >= myOffset) {
      int nextLineOffset=myDocument.getLineStartOffset(commentLine + 1);
      if (nextLineOffset < atLineStart.getTextRange().getEndOffset()) {
        final CharSequence chars=myDocument.getCharsSequence();
        nextLineOffset=CharArrayUtil.shiftForward(chars,nextLineOffset," \t");
        usesAstersk=chars.charAt(nextLineOffset) == '*';
      }
    }
    if (usesAstersk) {
      removeTrailingSpaces(myDocument,myOffset);
      myDocument.insertString(myOffset,"* ");
      PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
    }
    docAsterisk=usesAstersk;
  }
 else {
    docAsterisk=false;
  }
  return docAsterisk;
}
