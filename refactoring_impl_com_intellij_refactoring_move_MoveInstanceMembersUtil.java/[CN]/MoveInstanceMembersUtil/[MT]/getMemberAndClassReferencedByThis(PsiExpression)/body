{
  if (expression instanceof PsiReferenceExpression) {
    final PsiExpression qualifier=((PsiReferenceExpression)expression).getQualifierExpression();
    if (qualifier == null || qualifier instanceof PsiThisExpression) {
      final PsiElement resolved=((PsiReferenceExpression)expression).resolve();
      if (resolved instanceof PsiMember && !((PsiMember)resolved).hasModifierProperty(PsiModifier.STATIC)) {
        PsiClass referencedClass=getReferencedClass((PsiMember)resolved,qualifier,expression);
        return new Pair<PsiMember,PsiClass>((PsiMember)resolved,referencedClass);
      }
    }
  }
 else   if (expression instanceof PsiNewExpression) {
    final PsiNewExpression newExpression=(PsiNewExpression)expression;
    final PsiExpression qualifier=newExpression.getQualifier();
    if (qualifier == null || qualifier instanceof PsiThisExpression) {
      PsiJavaCodeReferenceElement classReference=newExpression.getClassOrAnonymousClassReference();
      if (classReference != null) {
        final PsiClass resolved=(PsiClass)classReference.resolve();
        if (resolved != null && !resolved.hasModifierProperty(PsiModifier.STATIC)) {
          PsiClass referencedClass=getReferencedClass(resolved,qualifier,expression);
          return new Pair<PsiMember,PsiClass>(resolved,referencedClass);
        }
      }
    }
  }
  return null;
}
