{
  PsiClass referencedClass=member.getContainingClass();
  if (exprQualifier != null) {
    final PsiType type=exprQualifier.getType();
    if (type instanceof PsiClassType) {
      referencedClass=((PsiClassType)type).resolve();
    }
  }
 else {
    final PsiClass parentClass=PsiTreeUtil.getParentOfType(expression,PsiClass.class);
    if (!PsiTreeUtil.isAncestor(referencedClass,parentClass,false)) {
      referencedClass=parentClass;
    }
  }
  return referencedClass;
}
