{
  PsiClass enclosingClass=PsiTreeUtil.getParentOfType(expression,PsiClass.class);
  if (enclosingClass == null)   return null;
  final PsiMember member=getMemberReferencedByThis(expression);
  if (member != null)   return member.getContainingClass();
  if (expression instanceof PsiThisExpression) {
    final PsiJavaCodeReferenceElement thisQualifier=((PsiThisExpression)expression).getQualifier();
    if (thisQualifier == null) {
      return enclosingClass;
    }
 else {
      return (PsiClass)thisQualifier.resolve();
    }
  }
  return null;
}
