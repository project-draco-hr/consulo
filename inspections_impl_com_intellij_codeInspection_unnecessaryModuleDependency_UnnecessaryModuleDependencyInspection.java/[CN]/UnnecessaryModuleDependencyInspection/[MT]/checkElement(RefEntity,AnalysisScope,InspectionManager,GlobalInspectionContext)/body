{
  if (refEntity instanceof RefModule) {
    final RefModule refModule=(RefModule)refEntity;
    final Module module=refModule.getModule();
    final Module[] declaredDependencies=ModuleRootManager.getInstance(module).getDependencies();
    if (declaredDependencies != null) {
      List<CommonProblemDescriptor> descriptors=new ArrayList<CommonProblemDescriptor>();
      final Set<Module> modules=refModule.getUserData(UnnessecaryModuleDependencyAnnotator.DEPENDENCIES);
      for (      Module dependency : declaredDependencies) {
        if (modules == null || !modules.contains(dependency)) {
          descriptors.add(manager.createProblemDescriptor(InspectionsBundle.message("unnecessary.module.dependency.problem.descriptor",module.getName(),dependency.getName()),null));
        }
      }
      return descriptors.isEmpty() ? null : descriptors.toArray(new CommonProblemDescriptor[descriptors.size()]);
    }
  }
  return null;
}
