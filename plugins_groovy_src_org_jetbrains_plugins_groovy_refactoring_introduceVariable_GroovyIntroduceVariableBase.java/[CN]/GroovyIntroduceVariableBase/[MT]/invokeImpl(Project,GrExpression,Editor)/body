{
  if (expr == null) {
    String message=RefactoringBundle.getCannotRefactorMessage(GroovyRefactoringBundle.message("selected.block.should.represent.an.expression"));
    showErrorMessage(message,project);
    return false;
  }
  final PsiFile file=expr.getContainingFile();
  LOG.assertTrue(file != null,"expr.getContainingFile() == null");
  final GroovyElementFactory factory=GroovyElementFactory.getInstance(project);
  if (expr.getType() == PsiType.VOID) {
    String message=RefactoringBundle.getCannotRefactorMessage(GroovyRefactoringBundle.message("selected.expression.has.void.type"));
    showErrorMessage(message,project);
    return false;
  }
  PsiElement tempContainer=GroovyRefactoringUtil.getEnclosingContainer(expr);
  if (tempContainer == null) {
    return tempContainerNotFound(project);
  }
  if (!isAppropriateContainer(tempContainer)) {
    String message=RefactoringBundle.getCannotRefactorMessage(GroovyRefactoringBundle.message("refactoring.is.not.supported.in.the.current.context",REFACTORING_NAME));
    showErrorMessage(message,project);
    return false;
  }
  if (!CommonRefactoringUtil.checkReadOnlyStatus(project,file))   return false;
  PsiElement[] occurences=GroovyRefactoringUtil.getExpressionOccurences(expr,tempContainer);
  GroovyIntroduceVariableSettings settings=getSettings(project,editor,expr,expr.getType(),occurences,false,null);
  if (!settings.isOK()) {
    return false;
  }
  return false;
}
