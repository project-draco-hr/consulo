{
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  if (!(file instanceof GroovyFileBase || file instanceof GspFile)) {
    String message=RefactoringBundle.getCannotRefactorMessage(GroovyRefactoringBundle.message("only.in.groovy.files"));
    showErrorMessage(message,project);
    return false;
  }
  GroovyFileBase fileBase=file instanceof GspFile ? ((GspFile)file).getGroovyLanguageRoot() : ((GroovyFileBase)file);
  GrExpression tempExpr=GroovyRefactoringUtil.findElementInRange(fileBase,startOffset,endOffset,GrExpression.class);
  return invokeImpl(project,tempExpr,editor);
}
