{
  GroovyElementFactory factory=GroovyElementFactory.getInstance(stmt.getProject());
  GrReferenceExpression refExpr=factory.createReferenceExpressionFromText(refText);
  if (!replaceAllOccurences) {
    expr.replaceWithExpression(refExpr);
  }
 else {
    PsiElement[] occurences=GroovyRefactoringUtil.getExpressionOccurences(expr,stmt);
    for (    PsiElement occurence : occurences) {
      if (occurence instanceof GrExpression) {
        GrExpression grExpression=(GrExpression)occurence;
        grExpression.replaceWithExpression(refExpr);
        refExpr=factory.createReferenceExpressionFromText(refText);
      }
 else {
        throw new IncorrectOperationException();
      }
    }
  }
}
