{
  GitCompoundResult checkoutResult=new GitCompoundResult(myProject);
  GitCompoundResult deleteResult=new GitCompoundResult(myProject);
  Collection<GitRepository> repositories=getSuccessfulRepositories();
  for (  GitRepository repository : repositories) {
    GitCommandResult result=myGit.checkout(repository,myPreviousBranch,null,true);
    checkoutResult.append(repository,result);
    if (result.success()) {
      deleteResult.append(repository,myGit.branchDelete(repository,myNewBranchName,false));
    }
    refresh(repository);
  }
  if (checkoutResult.totalSuccess() && deleteResult.totalSuccess()) {
    GitUIUtil.notify(GitVcs.NOTIFICATION_GROUP_ID,myProject,"Rollback successful",String.format("Checked out %s and deleted %s on %s %s",code(myPreviousBranch),code(myNewBranchName),StringUtil.pluralize("root",repositories.size()),successfulRepositoriesJoined()),NotificationType.INFORMATION,null);
  }
 else {
    StringBuilder message=new StringBuilder();
    if (!checkoutResult.totalSuccess()) {
      message.append("Errors during checkout: ");
      message.append(checkoutResult.getErrorOutputWithReposIndication());
    }
    if (!deleteResult.totalSuccess()) {
      message.append("Errors during deleting ").append(code(myNewBranchName));
      message.append(deleteResult.getErrorOutputWithReposIndication());
    }
    GitUIUtil.notify(GitVcs.IMPORTANT_ERROR_NOTIFICATION,myProject,"Error during rollback",message.toString(),NotificationType.ERROR,null);
  }
}
