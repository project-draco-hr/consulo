{
  boolean fatalErrorHappened=false;
  while (hasMoreRepositories() && !fatalErrorHappened) {
    final GitRepository repository=next();
    GitSimpleEventDetector unmergedDetector=new GitSimpleEventDetector(GitSimpleEventDetector.Event.UNMERGED_PREVENTING_CHECKOUT);
    GitCommandResult result=myGit.checkoutNewBranch(repository,myNewBranchName,unmergedDetector);
    if (result.success()) {
      refresh(repository);
      markSuccessful(repository);
    }
 else     if (unmergedDetector.hasHappened()) {
      fatalUnmergedFilesError();
      fatalErrorHappened=true;
    }
 else {
      fatalError("Couldn't create new branch " + myNewBranchName,result.getErrorOutputAsJoinedString());
      fatalErrorHappened=true;
    }
  }
  if (!fatalErrorHappened) {
    notifySuccess();
    updateRecentBranch();
  }
}
