{
  final List<PsiDirectory> directories=getWritableDirectoryListDefault(basePackage,scope,context.getManager());
  if (directories.isEmpty()) {
    return null;
  }
  final String redPart=basePackage == null ? qualifiedName : qualifiedName.substring(basePackage.getQualifiedName().length() + 1);
  final int dot=redPart.indexOf('.');
  final boolean fixPath=dot >= 0;
  final String firstRedName=fixPath ? redPart.substring(0,dot) : redPart;
  for (Iterator<PsiDirectory> i=directories.iterator(); i.hasNext(); ) {
    if (!checkCreateClassOrPackage(kind != null && !fixPath,i.next(),firstRedName)) {
      i.remove();
    }
  }
  return directories.isEmpty() ? null : new CreateClassOrPackageFix(directories,context,fixPath ? qualifiedName : redPart,redPart,kind,superClass,templateName);
}
