{
  String gantHome=GantUtils.getSDKInstallPath(module,configuration.getProject());
  final File[] groovyJars=GroovyUtils.getFilesInDirectoryByPattern(gantHome + "/lib/",GroovyConfigUtils.GROOVY_ALL_JAR_PATTERN);
  if (groovyJars.length > 0) {
    params.getClassPath().add(groovyJars[0].getAbsolutePath());
  }
 else   if (module != null) {
    final String groovyHome=LibrariesUtil.getGroovyHomePath(module);
    if (groovyHome != null) {
      for (      File groovyLibJar : GroovyUtils.getFilesInDirectoryByPattern(groovyHome + "/lib/",".*\\.jar")) {
        params.getClassPath().add(groovyLibJar);
      }
    }
  }
  setToolsJar(params);
  setGroovyHome(params,gantHome);
  final String confPath=getGantConfPath(gantHome);
  params.getVMParametersList().add("-Dgroovy.starter.conf=" + confPath);
  params.getVMParametersList().addParametersString(configuration.vmParams);
  params.setMainClass("org.codehaus.groovy.tools.GroovyStarter");
  params.getProgramParametersList().add("--conf");
  params.getProgramParametersList().add(confPath);
  if (gantHome.contains("grails")) {
    params.getClassPath().addAllFiles(GroovyUtils.getFilesInDirectoryByPattern(gantHome + "/lib",".*\\.jar"));
  }
  addClasspathFromRootModel(module,tests,params,false);
  String antHome=System.getenv("ANT_HOME");
  if (StringUtil.isEmpty(antHome)) {
    antHome=gantHome;
  }
  params.getVMParametersList().add("-Dant.home=" + antHome);
  params.getVMParametersList().add("-Dgant.home=" + gantHome);
  params.getProgramParametersList().add("--main");
  params.getProgramParametersList().add("gant.Gant");
  params.getProgramParametersList().add("--file");
  params.getProgramParametersList().add(FileUtil.toSystemDependentName(configuration.scriptPath));
  if (configuration.isDebugEnabled) {
    params.getProgramParametersList().add("--debug");
  }
  params.getProgramParametersList().addParametersString(configuration.scriptParams);
}
