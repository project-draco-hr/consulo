{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      FileDocumentManager.getInstance().saveAllDocuments();
      PsiClass psiClass=myJavaFacade.findClass("p.A");
      final VirtualFile vFile=psiClass.getContainingFile().getVirtualFile();
      File ioFile=VfsUtil.virtualToIoFile(vFile);
      ioFile.setLastModified(5);
      LocalFileSystem.getInstance().refresh(false);
      ModifiableRootModel rootModel=ModuleRootManager.getInstance(myModule).getModifiableModel();
      rootModel.setSdk(null);
      rootModel.commit();
      psiClass=myJavaFacade.findClass("p.A");
      assertNotNull(psiClass);
    }
  }
);
}
