{
  myWizardContext=new WizardContext(project);
  if (defaultPath != null) {
    myWizardContext.setProjectFileDirectory(defaultPath);
    myWizardContext.setProjectName(defaultPath.substring(FileUtil.toSystemIndependentName(defaultPath).lastIndexOf("/") + 1));
  }
  myWizardContext.addContextListener(new WizardContext.Listener(){
    public void buttonsUpdateRequested(){
      updateButtons();
    }
  }
);
  WizardMode selected=null;
  final ArrayList<WizardMode> modes=new ArrayList<WizardMode>();
  for (  WizardMode mode : Extensions.getExtensions(WizardMode.MODES)) {
    if (mode.isAvailable(myWizardContext)) {
      modes.add(mode);
      if (defaultPath != null) {
        if (mode instanceof CreateFromSourcesMode) {
          selected=mode;
        }
      }
 else       if (mode instanceof CreateFromScratchMode) {
        selected=mode;
      }
    }
  }
  myRootStep=new ProjectCreateModeStep(modes,selected,myWizardContext){
    protected void update(){
      updateButtons();
    }
  }
;
  addStep(myRootStep);
  for (  WizardMode mode : modes) {
    appendSteps(mode.getSteps(myWizardContext,modulesProvider));
  }
  init();
}
