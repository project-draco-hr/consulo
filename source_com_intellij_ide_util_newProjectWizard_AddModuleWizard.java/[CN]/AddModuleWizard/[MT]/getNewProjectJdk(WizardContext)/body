{
  if (context.getProjectJdk() != null) {
    return context.getProjectJdk();
  }
  final Project project=context.getProject() == null ? ProjectManager.getInstance().getDefaultProject() : context.getProject();
  final ProjectJdk projectJdk=ProjectRootManager.getInstance(project).getProjectJdk();
  if (projectJdk != null) {
    return projectJdk;
  }
  if (context.getProject() == null) {
    final ProjectJdk[] projectJdks=ProjectJdkTable.getInstance().getAllJdks();
    Arrays.sort(projectJdks,new Comparator<ProjectJdk>(){
      public int compare(      final ProjectJdk o1,      final ProjectJdk o2){
        final String version1=o1.getVersionString();
        final String version2=o2.getVersionString();
        return version1 != null && version2 != null ? version1.compareToIgnoreCase(version2) : 0;
      }
    }
);
    if (projectJdks.length > 0) {
      return projectJdks[projectJdks.length - 1];
    }
  }
  return null;
}
