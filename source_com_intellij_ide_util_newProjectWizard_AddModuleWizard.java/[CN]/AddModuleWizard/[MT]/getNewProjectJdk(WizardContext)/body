{
  if (context.getProjectJdk() != null) {
    return context.getProjectJdk();
  }
  final Project project=context.getProject() == null ? ProjectManager.getInstance().getDefaultProject() : context.getProject();
  final ProjectJdk projectJdk=ProjectRootManager.getInstance(project).getProjectJdk();
  if (projectJdk != null) {
    return projectJdk;
  }
  if (context.getProject() == null) {
    final ProjectJdk[] projectJdks=ProjectJdkTable.getInstance().getAllJdks();
    Arrays.sort(projectJdks,new Comparator<ProjectJdk>(){
      public int compare(      final ProjectJdk o1,      final ProjectJdk o2){
        return o1.getVersionString().compareToIgnoreCase(o2.getVersionString());
      }
    }
);
    if (projectJdks.length > 0) {
      return projectJdks[0];
    }
  }
  return null;
}
