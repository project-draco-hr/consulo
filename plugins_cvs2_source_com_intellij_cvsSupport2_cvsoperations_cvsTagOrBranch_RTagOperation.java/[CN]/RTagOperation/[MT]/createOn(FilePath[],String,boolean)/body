{
  Map<CvsEnvironment,List<File>> envToFiles=new HashMap<CvsEnvironment,List<File>>();
  for (int i=0; i < files.length; i++) {
    FilePath file=files[i];
    CvsConnectionSettings cvsConnectionSettings=CvsUtil.getCvsConnectionSettings(file);
    if (!envToFiles.containsKey(cvsConnectionSettings))     envToFiles.put(cvsConnectionSettings,new ArrayList<File>());
    envToFiles.get(cvsConnectionSettings).add(file.getIOFile());
  }
  ArrayList<RTagOperation> result=new ArrayList<RTagOperation>();
  for (Iterator iterator=envToFiles.keySet().iterator(); iterator.hasNext(); ) {
    CvsEnvironment cvsEnvironment=(CvsEnvironment)iterator.next();
    RTagOperation rTagOperation=new RTagOperation(cvsEnvironment,tagName,overrideExisting);
    result.add(rTagOperation);
    List<File> iofiles=envToFiles.get(cvsEnvironment);
    for (Iterator eachIOFile=iofiles.iterator(); eachIOFile.hasNext(); ) {
      File file=(File)eachIOFile.next();
      rTagOperation.addFile(file);
    }
  }
  return result.toArray(new RTagOperation[result.size()]);
}
