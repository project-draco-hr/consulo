{
  final String referenceName=referenceExpression.getReferenceName();
  final PsiElement parent=referenceExpression.getParent();
  if (!(parent instanceof PsiExpressionList)) {
    return getUntypedCollectionsMethodCallText(referenceName);
  }
  final PsiType type=ExpectedTypeUtils.findExpectedType(referenceExpression,false);
  if (!(type instanceof PsiClassType)) {
    return getUntypedCollectionsMethodCallText(referenceName);
  }
  final PsiClassType classType=(PsiClassType)type;
  final PsiType[] parameterTypes=classType.getParameters();
  boolean useTypeParameter=false;
  final String[] canonicalTexts=new String[parameterTypes.length];
  for (int i=0, parameterTypesLength=parameterTypes.length; i < parameterTypesLength; i++) {
    final PsiType parameterType=parameterTypes[i];
    if (!parameterType.equalsToText(CommonClassNames.JAVA_LANG_OBJECT)) {
      useTypeParameter=true;
    }
    canonicalTexts[i]=parameterType.getCanonicalText();
  }
  if (useTypeParameter) {
    return "Collections.<" + StringUtil.join(canonicalTexts,",") + '>'+ getCollectionsMethodCallText(referenceName);
  }
 else {
    return getUntypedCollectionsMethodCallText(referenceName);
  }
}
