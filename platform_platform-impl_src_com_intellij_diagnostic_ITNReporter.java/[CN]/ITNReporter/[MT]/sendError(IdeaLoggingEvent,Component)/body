{
  String newBuild=ErrorReportSender.checkNewBuild();
  if (newBuild != null) {
    Messages.showMessageDialog(parentComponent,DiagnosticBundle.message("error.report.new.eap.build.message",newBuild),CommonBundle.getWarningTitle(),Messages.getWarningIcon());
    return new SubmittedReportInfo(null,"0",SubmittedReportInfo.SubmissionStatus.FAILED);
  }
  ErrorBean errorBean=new ErrorBean(event.getThrowable(),IdeaLogger.ourLastActionId);
  int threadId=0;
  SubmittedReportInfo.SubmissionStatus submissionStatus=SubmittedReportInfo.SubmissionStatus.FAILED;
  final DataContext dataContext=DataManager.getInstance().getDataContext(parentComponent);
  Project project=PlatformDataKeys.PROJECT.getData(dataContext);
  String description="";
  do {
    try {
      EAPSendErrorDialog dlg=new EAPSendErrorDialog();
      dlg.setErrorDescription(description);
      dlg.show();
      @NonNls String login=ErrorReportConfigurable.getInstance().ITN_LOGIN;
      @NonNls String password=ErrorReportConfigurable.getInstance().getPlainItnPassword();
      if (login.trim().length() == 0 && password.trim().length() == 0) {
        login="idea_anonymous";
        password="guest";
      }
      description=dlg.getErrorDescription();
      @NonNls StringBuilder descBuilder=buildDescription(event,description);
      errorBean.setDescription(descBuilder.toString());
      if (dlg.isShouldSend()) {
        threadId=ErrorReportSender.sendError(project,login,password,errorBean);
        previousExceptionThreadId=threadId;
        wasException=true;
        submissionStatus=SubmittedReportInfo.SubmissionStatus.NEW_ISSUE;
        Messages.showInfoMessage(parentComponent,DiagnosticBundle.message("error.report.confirmation"),ReportMessages.ERROR_REPORT);
        break;
      }
 else {
        break;
      }
    }
 catch (    NoSuchEAPUserException e) {
      if (Messages.showYesNoDialog(parentComponent,DiagnosticBundle.message("error.report.authentication.failed"),ReportMessages.ERROR_REPORT,Messages.getErrorIcon()) != 0) {
        break;
      }
    }
catch (    InternalEAPException e) {
      if (Messages.showYesNoDialog(parentComponent,DiagnosticBundle.message("error.report.posting.failed",e.getMessage()),ReportMessages.ERROR_REPORT,Messages.getErrorIcon()) != 0) {
        break;
      }
    }
catch (    IOException e) {
      if (!IOExceptionDialog.showErrorDialog(DiagnosticBundle.message("error.report.exception.title"),DiagnosticBundle.message("error.report.failure.message"))) {
        break;
      }
    }
catch (    Exception e) {
      if (Messages.showYesNoDialog(JOptionPane.getRootFrame(),DiagnosticBundle.message("error.report.sending.failure"),ReportMessages.ERROR_REPORT,Messages.getErrorIcon()) != 0) {
        break;
      }
    }
  }
 while (true);
  return new SubmittedReportInfo(submissionStatus != SubmittedReportInfo.SubmissionStatus.FAILED ? URL_HEADER + threadId : null,String.valueOf(threadId),submissionStatus);
}
