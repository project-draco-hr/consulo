{
  if (!myProject.isDisposed()) {
    final Object o=((FileEditorManagerImpl)FileEditorManager.getInstance(myProject)).getData(dataId,myEditor);
    if (o != null)     return o;
  }
  if (dataId.equals(DataConstants.EDITOR)) {
    return myEditor;
  }
  if (dataId.equals(AnActionEvent.injectedId(DataConstants.EDITOR))) {
    return InjectedLanguageUtil.getEditorForInjectedLanguage(myEditor,getPsiFile());
  }
  if (dataId.equals(AnActionEvent.injectedId(DataConstants.PSI_ELEMENT))) {
    return getPsiElementIn((Editor)getData(AnActionEvent.injectedId(DataConstants.EDITOR)));
  }
  if (DataConstants.PSI_ELEMENT.equals(dataId)) {
    return getPsiElementIn(myEditor);
  }
  if (dataId.equals(AnActionEvent.injectedId(DataConstants.LANGUAGE))) {
    PsiFile psiFile=(PsiFile)getData(AnActionEvent.injectedId(DataConstants.PSI_FILE));
    Editor editor=(Editor)getData(AnActionEvent.injectedId(DataConstants.EDITOR));
    if (psiFile == null || editor == null)     return null;
    return getLanguageAtCurrentPositionInEditor(editor,psiFile);
  }
  if (DataConstants.LANGUAGE.equals(dataId)) {
    final Editor editor=myEditor;
    final PsiFile psiFile=getPsiFile();
    if (psiFile == null)     return null;
    return getLanguageAtCurrentPositionInEditor(editor,psiFile);
  }
  if (dataId.equals(AnActionEvent.injectedId(DataConstants.VIRTUAL_FILE))) {
    PsiFile psiFile=(PsiFile)getData(AnActionEvent.injectedId(DataConstants.PSI_FILE));
    if (psiFile == null)     return null;
    return psiFile.getVirtualFile();
  }
  if (dataId.equals(DataConstants.VIRTUAL_FILE)) {
    return myFile.isValid() ? myFile : null;
  }
  if (dataId.equals(AnActionEvent.injectedId(DataConstants.PSI_FILE))) {
    Editor editor=(Editor)getData(AnActionEvent.injectedId(DataConstants.EDITOR));
    if (editor == null)     return null;
    return PsiDocumentManager.getInstance(myProject).getPsiFile(editor.getDocument());
  }
  if (dataId.equals(DataConstants.PSI_FILE)) {
    return getPsiFile();
  }
  if (DataConstantsEx.TARGET_PSI_ELEMENT.equals(dataId)) {
    return null;
  }
  return null;
}
