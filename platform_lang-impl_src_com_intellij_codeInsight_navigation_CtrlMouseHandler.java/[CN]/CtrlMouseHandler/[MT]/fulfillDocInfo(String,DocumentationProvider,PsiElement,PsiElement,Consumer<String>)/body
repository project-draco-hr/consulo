{
  myDocAlarm.cancelAllRequests();
  myDocAlarm.addRequest(new Runnable(){
    @Override public void run(){
      final Ref<String> fullTextRef=new Ref<String>();
      final Ref<String> qualifiedNameRef=new Ref<String>();
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        @Override public void run(){
          fullTextRef.set(provider.generateDoc(anchorElement,originalElement));
          if (anchorElement instanceof PsiQualifiedNamedElement) {
            qualifiedNameRef.set(((PsiQualifiedNamedElement)anchorElement).getQualifiedName());
          }
        }
      }
);
      String fullText=fullTextRef.get();
      if (fullText == null) {
        return;
      }
      final String updatedText=DocPreviewUtil.buildPreview(header,qualifiedNameRef.get(),fullText);
      UIUtil.invokeLaterIfNeeded(new Runnable(){
        @Override public void run(){
          newTextConsumer.consume(updatedText);
        }
      }
);
    }
  }
,0);
}
