{
  myDocAlarm.cancelAllRequests();
  myDocAlarm.addRequest(new Runnable(){
    @Override public void run(){
      final Ref<String> fullTextRef=new Ref<String>();
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        @Override public void run(){
          fullTextRef.set(provider.generateDoc(anchorElement,originalElement));
        }
      }
);
      String fullText=fullTextRef.get();
      if (fullText == null) {
        return;
      }
      String qName=anchorElement instanceof PsiQualifiedNamedElement ? ((PsiQualifiedNamedElement)anchorElement).getQualifiedName() : null;
      final String updatedText=DocPreviewUtil.buildPreview(header,qName,fullText);
      UIUtil.invokeLaterIfNeeded(new Runnable(){
        @Override public void run(){
          newTextConsumer.consume(updatedText);
        }
      }
);
    }
  }
,0);
}
