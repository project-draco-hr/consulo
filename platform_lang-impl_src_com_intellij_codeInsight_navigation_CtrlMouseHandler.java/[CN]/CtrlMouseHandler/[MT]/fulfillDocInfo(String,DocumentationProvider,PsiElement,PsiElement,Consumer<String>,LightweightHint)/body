{
  myDocAlarm.cancelAllRequests();
  myDocAlarm.addRequest(new Runnable(){
    @Override public void run(){
      final Ref<String> fullTextRef=new Ref<String>();
      final Ref<String> qualifiedNameRef=new Ref<String>();
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        @Override public void run(){
          try {
            fullTextRef.set(provider.generateDoc(anchorElement,originalElement));
          }
 catch (          IndexNotReadyException e) {
            fullTextRef.set("Documentation is not available while indexing is in progress");
          }
          if (anchorElement instanceof PsiQualifiedNamedElement) {
            qualifiedNameRef.set(((PsiQualifiedNamedElement)anchorElement).getQualifiedName());
          }
        }
      }
);
      String fullText=fullTextRef.get();
      if (fullText == null) {
        return;
      }
      String updatedText=DocPreviewUtil.buildPreview(header,qualifiedNameRef.get(),fullText);
      final String newHtml=HintUtil.prepareHintText(updatedText,HintUtil.getInformationHint());
      UIUtil.invokeLaterIfNeeded(new Runnable(){
        @Override public void run(){
          Dimension oldSize=hint.getComponent().getPreferredSize();
          newTextConsumer.consume(newHtml);
          if (oldSize == null) {
            return;
          }
          Dimension newSize=hint.getComponent().getPreferredSize();
          if (newSize.width == oldSize.width) {
            return;
          }
          if (hint.isRealPopup()) {
            TooltipProvider tooltipProvider=myTooltipProvider;
            if (tooltipProvider != null) {
              hint.hide();
              tooltipProvider.showHint(new LightweightHint(hint.getComponent()));
            }
 else {
              hint.getComponent().setPreferredSize(new Dimension(newSize.width,oldSize.height));
              hint.pack();
            }
            return;
          }
          Container topLevelLayeredPaneChild=null;
          boolean adjustBounds=false;
          for (Container current=hint.getComponent().getParent(); current != null; current=current.getParent()) {
            if (current instanceof JLayeredPane) {
              adjustBounds=true;
              break;
            }
 else {
              topLevelLayeredPaneChild=current;
            }
          }
          if (adjustBounds && topLevelLayeredPaneChild != null) {
            Rectangle bounds=topLevelLayeredPaneChild.getBounds();
            topLevelLayeredPaneChild.setBounds(bounds.x,bounds.y,bounds.width + newSize.width - oldSize.width,bounds.height);
          }
        }
      }
);
    }
  }
,0);
}
