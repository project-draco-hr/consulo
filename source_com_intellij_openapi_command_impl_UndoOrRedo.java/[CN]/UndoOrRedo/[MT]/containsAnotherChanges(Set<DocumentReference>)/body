{
  boolean otherDocsHaveSomethingOnTheirStacks=false;
  for (  LinkedList<UndoableGroup> linkedList : getStacks()) {
    if (linkedList.isEmpty())     continue;
    final UndoableGroup last=linkedList.getLast();
    if (!last.equals(myUndoableGroup)) {
      otherDocsHaveSomethingOnTheirStacks=true;
      affected.addAll(last.getAffectedDocuments());
    }
  }
  if (otherDocsHaveSomethingOnTheirStacks)   return true;
  if (myUndoableGroup.isComplex()) {
    final UndoableGroup lastGlobal=getStackHolder().getGlobalStack().getLast();
    if (!lastGlobal.equals(myUndoableGroup)) {
      affected.addAll(lastGlobal.getAffectedDocuments());
      return true;
    }
  }
  return false;
}
