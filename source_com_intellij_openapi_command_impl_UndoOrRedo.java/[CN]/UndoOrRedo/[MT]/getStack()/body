{
  final Document[] documents=myEditor == null ? null : TextEditorProvider.getDocuments(myEditor);
  if (documents == null || documents.length == 0) {
    return getStackHolder().getGlobalStack();
  }
 else {
    long recentDocumentTimeStamp=-1;
    LinkedList<UndoableGroup> result=null;
    for (    Document document : documents) {
      LinkedList<UndoableGroup> stack=getStackHolder().getStack(document);
      if (!stack.isEmpty()) {
        long modificationStamp=document.getModificationStamp();
        if (recentDocumentTimeStamp < modificationStamp) {
          result=stack;
          recentDocumentTimeStamp=modificationStamp;
        }
      }
    }
    if (result != null) {
      return result;
    }
 else {
      throw new NothingToUndoException();
    }
  }
}
