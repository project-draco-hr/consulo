{
  final Ref<T> refT=new Ref<T>();
  refT.set(calculate());
  if ((!myWasCanceled) && (!refT.isNull())) {
    processResult(refT.get());
    return;
  }
  ProgressManager.getInstance().run(new Task.Backgroundable(myProject,myTaskTitle,true,BackgroundFromStartOption.getInstance()){
    public void run(    @NotNull ProgressIndicator indicator){
      refT.set(calculateLong());
    }
    @Override public void onSuccess(){
      if (!myWasCanceled) {
        processResult(refT.get());
      }
    }
  }
);
}
