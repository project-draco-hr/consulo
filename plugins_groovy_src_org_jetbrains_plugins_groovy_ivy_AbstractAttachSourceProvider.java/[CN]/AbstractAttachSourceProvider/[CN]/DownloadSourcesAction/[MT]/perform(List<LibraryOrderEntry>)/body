{
  final ActionCallback callback=new ActionCallback();
  Task task=new Task.Backgroundable(myProject,"Downloading sources...",true){
    @Override public void run(    @NotNull ProgressIndicator indicator){
      final ByteArrayOutputStream out;
      try {
        LOG.info("Downloading sources jar: " + myUrl);
        HttpConfigurable.getInstance().prepareURL(myUrl);
        indicator.checkCanceled();
        HttpURLConnection urlConnection=(HttpURLConnection)new URL(myUrl).openConnection();
        int contentLength=urlConnection.getContentLength();
        out=new ByteArrayOutputStream(contentLength > 0 ? contentLength : 100 * 1024);
        InputStream in=urlConnection.getInputStream();
        try {
          NetUtils.copyStreamContent(indicator,in,out,contentLength);
        }
  finally {
          in.close();
        }
      }
 catch (      IOException e) {
        LOG.warn(e);
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          @Override public void run(){
            new Notification(myMessageGroupId,"Downloading failed","Failed to download sources: " + myUrl,NotificationType.ERROR).notify(getProject());
            callback.setDone();
          }
        }
);
        return;
      }
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        @Override public void run(){
          AccessToken accessToken=WriteAction.start();
          try {
            storeFile(out.toByteArray());
          }
  finally {
            accessToken.finish();
            callback.setDone();
          }
        }
      }
);
    }
    @Override public void onCancel(){
      callback.setRejected();
    }
  }
;
  task.queue();
  return callback;
}
