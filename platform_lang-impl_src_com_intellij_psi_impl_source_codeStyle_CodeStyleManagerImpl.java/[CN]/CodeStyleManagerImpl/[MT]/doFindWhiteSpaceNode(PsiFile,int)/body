{
  ASTNode astNode=SourceTreeToPsiMap.psiElementToTree(file);
  if (!(astNode instanceof FileElement)) {
    return new Pair<ASTNode,CharTable>(null,null);
  }
  final CharTable charTable=((FileElement)astNode).getCharTable();
  PsiElement elementAt=findElementInTreeWithFormatterEnabled(file,offset);
  if (elementAt == null) {
    return new Pair<ASTNode,CharTable>(null,charTable);
  }
  return new Pair<ASTNode,CharTable>(SourceTreeToPsiMap.psiElementToTree(elementAt),charTable);
}
