{
  CheckUtil.checkWritable(file);
  ASTNode astNode=SourceTreeToPsiMap.psiElementToTree(file);
  if (!(astNode instanceof FileElement)) {
    return null;
  }
  final CharTable charTable=((FileElement)astNode).getCharTable();
  PsiElement elementAt=findElementInTreeWithFormatterEnabled(file,offset);
  if (elementAt == null) {
    return null;
  }
  ASTNode element=SourceTreeToPsiMap.psiElementToTree(elementAt);
  if (element == null) {
    return null;
  }
  ASTNode parent=element.getTreeParent();
  int elementStart=element.getTextRange().getStartOffset();
  if (element.getElementType() != TokenType.WHITE_SPACE) {
    return null;
  }
  if (offset == element.getTextRange().getStartOffset()) {
    for (ASTNode prev=TreeUtil.prevLeaf(element); ; prev=TreeUtil.prevLeaf(prev)) {
      if (prev == null) {
        return null;
      }
      if (prev.getTextRange().isEmpty()) {
        continue;
      }
      if (prev.getElementType() != TokenType.WHITE_SPACE) {
        return null;
      }
    }
  }
  ASTNode space1=splitSpaceElement((TreeElement)element,offset - elementStart,charTable);
  ASTNode marker=Factory.createSingleLeafElement(TokenType.NEW_LINE_INDENT,DUMMY_IDENTIFIER,charTable,file.getManager());
  setSequentialProcessingAllowed(false);
  parent.addChild(marker,space1.getTreeNext());
  PsiElement psiElement=SourceTreeToPsiMap.treeElementToPsi(marker);
  return psiElement == null ? null : psiElement.getTextRange();
}
