{
  return PostprocessReformattingAspect.getInstance(getProject()).disablePostprocessFormattingInside(new Computable<Integer>(){
    public Integer compute(){
      final PsiDocumentManager documentManager=PsiDocumentManager.getInstance(myProject);
      documentManager.commitDocument(document);
      PsiFile file=documentManager.getPsiFile(document);
      if (file == null)       return offset;
      return doAdjustLineIndentByOffset(document,file,offset);
    }
  }
);
}
