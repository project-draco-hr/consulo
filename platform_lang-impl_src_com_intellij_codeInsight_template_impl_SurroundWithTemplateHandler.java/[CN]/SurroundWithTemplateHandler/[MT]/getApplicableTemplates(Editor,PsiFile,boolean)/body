{
  int offset=editor.getCaretModel().getOffset();
  int startOffset=offset;
  if (selection && editor.getSelectionModel().hasSelection()) {
    final int selStart=editor.getSelectionModel().getSelectionStart();
    final int selEnd=editor.getSelectionModel().getSelectionEnd();
    startOffset=(offset == selStart) ? selEnd : selStart;
  }
  ArrayList<TemplateImpl> list=new ArrayList<TemplateImpl>();
  for (  TemplateImpl template : TemplateSettings.getInstance().getTemplates()) {
    if (!template.isDeactivated() && template.isSelectionTemplate() == selection && (TemplateManagerImpl.isApplicable(file,offset,template) || (selection && TemplateManagerImpl.isApplicable(file,startOffset,template)))) {
      list.add(template);
    }
  }
  return list;
}
