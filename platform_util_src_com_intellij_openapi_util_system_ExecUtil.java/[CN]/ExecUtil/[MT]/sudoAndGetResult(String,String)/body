{
  if (SystemInfo.isMac) {
    final ScriptEngine engine=new ScriptEngineManager(null).getEngineByName("AppleScript");
    if (engine == null) {
      throw new IOException("Could not find AppleScript engine");
    }
    engine.eval("do shell script \"" + scriptPath + "\" with administrator privileges");
    return 0;
  }
 else   if (SystemInfo.isKDE) {
    return execAndGetResult("kdesudo","--comment",prompt,scriptPath);
  }
 else   if (SystemInfo.isGnome) {
    return execAndGetResult("gksudo","--message",prompt,scriptPath);
  }
 else   if (SystemInfo.isUnix) {
    final File sudo=createTempExecutableScript("sudo",".sh","#!/bin/sh\n" + "echo \"" + prompt + "\"\n"+ "echo\n"+ "sudo \""+ scriptPath+ "\"\n"+ "STATUS=$?"+ "echo\n"+ "read -p \"Press Enter to close this window...\" TEMP\n"+ "exit $STATUS\n");
    return execAndGetResult("xterm","-T","Install","-e",sudo.getAbsolutePath());
  }
 else {
    throw new UnsupportedOperationException("Unsupported OS/desktop: " + System.getProperty("os.name") + '/'+ SystemInfo.SUN_DESKTOP);
  }
}
