{
  final InputStream stream=loader.getResourceAsStream(templateName);
  if (stream == null) {
    throw new IOException("Template '" + templateName + "' not found by "+ loader);
  }
  final StringBuilder template=new StringBuilder(FileUtil.loadTextAndClose(stream));
  if (variables != null) {
    for (    Map.Entry<String,String> var : variables.entrySet()) {
      final String name=var.getKey();
      final int pos=template.indexOf(name);
      if (pos >= 0) {
        template.replace(pos,pos + name.length(),var.getValue());
      }
    }
  }
  return template.toString();
}
