{
  final XmlElement valueElement=DomUtil.getValueElement(element);
  if (valueElement != null && !isSoftReference(element)) {
    final SmartList<DomElementProblemDescriptor> list=new SmartList<DomElementProblemDescriptor>();
    final PsiReference[] psiReferences=myProvider.getReferencesByElement(valueElement);
    GenericDomValueReference domReference=null;
    for (    final PsiReference reference : psiReferences) {
      if (reference instanceof GenericDomValueReference) {
        domReference=(GenericDomValueReference)reference;
        break;
      }
    }
    final boolean domReferenceResolveOK=domReference != null && !hasBadResolve(element,domReference);
    boolean hasBadResolve=false;
    if (!domReferenceResolveOK) {
      for (      final PsiReference reference : psiReferences) {
        if (reference != domReference && hasBadResolve(element,reference)) {
          hasBadResolve=true;
          list.add(holder.createResolveProblem(element,reference));
        }
      }
      final boolean isResolvingConverter=element.getConverter() instanceof ResolvingConverter;
      if (!hasBadResolve && (domReference != null || isResolvingConverter && hasBadResolve(element,domReference=new GenericDomValueReference(element)))) {
        hasBadResolve=true;
        list.add(holder.createResolveProblem(element,domReference));
      }
    }
    if (!hasBadResolve && psiReferences.length == 0 && element.getValue() == null) {
      final Converter converter=element.getConverter();
      final String errorMessage=converter.getErrorMessage(element.getStringValue(),new ConvertContextImpl(DomManagerImpl.getDomInvocationHandler(element)));
      if (errorMessage != null) {
        list.add(holder.createProblem(element,errorMessage));
      }
    }
    return list;
  }
  return Collections.emptyList();
}
