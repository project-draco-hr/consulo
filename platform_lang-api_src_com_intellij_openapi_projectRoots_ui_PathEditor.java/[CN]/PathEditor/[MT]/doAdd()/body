{
  VirtualFile baseDir=myAddBaseDir;
  if (baseDir == null) {
    Project project=PlatformDataKeys.PROJECT.getData(DataManager.getInstance().getDataContext(myPanel));
    if (project != null) {
      baseDir=project.getBaseDir();
    }
  }
  VirtualFile[] files=FileChooser.chooseFiles(myPanel,myDescriptor,baseDir);
  files=adjustAddedFileSet(myPanel,files);
  List<VirtualFile> added=new ArrayList<VirtualFile>(files.length);
  for (  VirtualFile vFile : files) {
    if (addElement(vFile)) {
      added.add(vFile);
    }
  }
  return VfsUtil.toVirtualFileArray(added);
}
