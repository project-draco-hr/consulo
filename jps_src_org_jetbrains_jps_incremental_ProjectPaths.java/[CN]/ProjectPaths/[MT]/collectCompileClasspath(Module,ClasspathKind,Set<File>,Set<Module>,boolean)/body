{
  if (!processed.contains(module)) {
    processed.add(module);
    for (    ClasspathItem it : module.getClasspath(kind)) {
      final boolean shouldAdd=!exportedOnly || isExported(it);
      if (it instanceof Module) {
        if (shouldAdd) {
          if (kind.isTestsIncluded()) {
            classpath.add(getModuleOutput(module,true));
          }
          classpath.add(getModuleOutput(module,false));
        }
        collectCompileClasspath((Module)it,kind,classpath,processed,true);
      }
 else {
        if (shouldAdd) {
          for (          String root : it.getClasspathRoots(kind)) {
            classpath.add(new File(root));
          }
        }
      }
    }
  }
}
