{
  if (myReference != null) {
    final PsiElement element=myReference.getElement();
    if (element != null && !(element instanceof PsiFile) && element.isValid())     return myReference;
  }
  if (myReferenceRangeMarker == null)   return null;
  final PsiElement element=getElement();
  if (element == null)   return null;
  final int start=myReferenceRangeMarker.getStartOffset() - element.getTextRange().getStartOffset();
  final int end=myReferenceRangeMarker.getEndOffset() - element.getTextRange().getStartOffset();
  final PsiReference reference=element.findReferenceAt(start);
  if (reference == null)   return null;
  final TextRange rangeInElement=reference.getRangeInElement();
  if (rangeInElement.getStartOffset() != start || rangeInElement.getEndOffset() != end)   return null;
  return reference;
}
