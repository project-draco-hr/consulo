{
  ChangeListManager.getInstance(myProject).addChangeListListener(myListener);
  if (ApplicationManager.getApplication().isHeadlessEnvironment())   return;
  StartupManager.getInstance(myProject).registerPostStartupActivity(new Runnable(){
    public void run(){
      final ToolWindowManager toolWindowManager=ToolWindowManager.getInstance(myProject);
      if (toolWindowManager != null) {
        myToolWindow=toolWindowManager.registerToolWindow(TOOLWINDOW_ID,createChangeViewComponent(),ToolWindowAnchor.BOTTOM);
        myToolWindow.setIcon(IconLoader.getIcon("/general/toolWindowChanges.png"));
        updateToolWindowAvailability();
        ProjectLevelVcsManager.getInstance(myProject).addVcsListener(myVcsListener);
        ModuleManager.getInstance(myProject).addModuleListener(myModuleListener);
        SelectInManager.getInstance(myProject).addTarget(new SelectInChangesViewTarget(myProject));
      }
    }
  }
);
}
