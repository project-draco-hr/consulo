{
  final LookupElement delegate=getDelegate();
  final TailType tailType=computeTailType(context);
  final LookupItem lookupItem=delegate.as(LookupItem.CLASS_CONDITION_KEY);
  if (lookupItem != null && tailType != null) {
    lookupItem.setTailType(TailType.UNKNOWN);
  }
  delegate.handleInsert(context);
  if (tailType != null && tailType.isApplicable(context)) {
    PostprocessReformattingAspect.getInstance(context.getProject()).doPostponedFormatting();
    tailType.processTail(context.getEditor(),context.getTailOffset());
  }
}
