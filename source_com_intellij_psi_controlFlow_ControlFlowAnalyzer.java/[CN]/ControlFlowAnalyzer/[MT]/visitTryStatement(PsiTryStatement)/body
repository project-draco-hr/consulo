{
  startElement(statement);
  PsiCodeBlock[] catchBlocks=statement.getCatchBlocks();
  PsiParameter[] catchBlockParameters=statement.getCatchBlockParameters();
  int catchNum=Math.min(catchBlocks.length,catchBlockParameters.length);
  myUnhandledExceptionCatchBlocks.add(null);
  for (int i=catchNum - 1; i >= 0; i--) {
    myCatchParameters.add(catchBlockParameters[i]);
    myCatchBlocks.add(catchBlocks[i]);
    final PsiType type=catchBlockParameters[i].getType();
    if (type instanceof PsiClassType && ExceptionUtil.isUncheckedExceptionOrSuperclass((PsiClassType)type)) {
      myUnhandledExceptionCatchBlocks.add(catchBlocks[i]);
    }
  }
  PsiCodeBlock finallyBlock=statement.getFinallyBlock();
  if (finallyBlock != null) {
    myFinallyBlocks.add(finallyBlock);
  }
  PsiCodeBlock tryBlock=statement.getTryBlock();
  if (tryBlock != null) {
    generateCheckedExceptionJumps(tryBlock);
    tryBlock.accept(this);
  }
  while (myUnhandledExceptionCatchBlocks.remove(myUnhandledExceptionCatchBlocks.size() - 1) != null)   ;
  myCurrentFlow.addInstruction(new GoToInstruction(finallyBlock == null ? 0 : -6));
  if (finallyBlock == null) {
    addElementOffsetLater(statement,false);
  }
 else {
    addElementOffsetLater(finallyBlock,true);
  }
  for (int i=0; i < catchNum; i++) {
    myCatchParameters.remove(myCatchParameters.size() - 1);
    myCatchBlocks.remove(myCatchBlocks.size() - 1);
  }
  for (int i=catchNum - 1; i >= 0; i--) {
    if (myPolicy.isParameterAccepted(catchBlockParameters[i])) {
      generateWriteInstruction(catchBlockParameters[i]);
    }
    catchBlocks[i].accept(this);
    myCurrentFlow.addInstruction(new GoToInstruction(finallyBlock == null ? 0 : -6));
    if (finallyBlock == null) {
      addElementOffsetLater(statement,false);
    }
 else {
      addElementOffsetLater(finallyBlock,true);
    }
  }
  if (finallyBlock != null) {
    myFinallyBlocks.remove(myFinallyBlocks.size() - 1);
  }
  if (finallyBlock != null) {
    myCurrentFlow.addInstruction(new CallInstruction(0,0,myCurrentFlow.myStack));
    addElementOffsetLater(finallyBlock,true);
    myCurrentFlow.addInstruction(new GoToInstruction(0));
    addElementOffsetLater(statement,false);
    myCurrentFlow.addInstruction(new CallInstruction(0,0,myCurrentFlow.myStack));
    addElementOffsetLater(finallyBlock,true);
    addReturnInstruction(statement);
    myCurrentFlow.addInstruction(new CallInstruction(0,0,myCurrentFlow.myStack));
    addElementOffsetLater(finallyBlock,true);
    final GoToInstruction gotoUncheckedRethrow=new GoToInstruction(0);
    myCurrentFlow.addInstruction(gotoUncheckedRethrow);
    addElementOffsetLater(finallyBlock,false);
    finallyBlock.accept(this);
    final int procStart=myCurrentFlow.getStartOffset(finallyBlock);
    final int procEnd=myCurrentFlow.getEndOffset(finallyBlock);
    int offset=procStart - 6;
    final Instruction[] instructions=myCurrentFlow.getInstructions();
    CallInstruction callInstruction=(CallInstruction)instructions[offset];
    callInstruction.procBegin=procStart;
    callInstruction.procEnd=procEnd;
    offset+=2;
    callInstruction=(CallInstruction)instructions[offset];
    callInstruction.procBegin=procStart;
    callInstruction.procEnd=procEnd;
    offset+=2;
    callInstruction=(CallInstruction)instructions[offset];
    callInstruction.procBegin=procStart;
    callInstruction.procEnd=procEnd;
    myCurrentFlow.addInstruction(new ReturnInstruction(0,myCurrentFlow.myStack,callInstruction));
    myCurrentFlow.addInstruction(new ReturnInstruction(procStart - 3,myCurrentFlow.myStack,callInstruction));
    myCurrentFlow.addInstruction(new ReturnInstruction(procStart - 1,myCurrentFlow.myStack,callInstruction));
    final List<PsiElement> unhandledExceptionCatchBlocks=finallyBlockToUnhandledExceptions.remove(finallyBlock);
    for (int i=0; unhandledExceptionCatchBlocks != null && i < unhandledExceptionCatchBlocks.size(); i++) {
      PsiElement catchBlock=unhandledExceptionCatchBlocks.get(i);
      final ReturnInstruction returnInstruction=new ReturnInstruction(0,myCurrentFlow.myStack,callInstruction);
      myCurrentFlow.addInstruction(returnInstruction);
      if (catchBlock == null) {
        returnInstruction.offset=procStart - 1;
      }
 else {
        addElementOffsetLater(catchBlock,true);
      }
    }
    gotoUncheckedRethrow.offset=myCurrentFlow.getSize();
    generateUncheckedExceptionJumps(statement,false);
    myCurrentFlow.addInstruction(new ThrowToInstruction(0));
    addElementOffsetLater(myCodeFragment,false);
  }
  finishElement(statement);
}
