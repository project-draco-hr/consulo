{
  fragments=transformHeadInsert(fragments,FragmentSide.SIDE1);
  fragments=transformHeadInsert(fragments,FragmentSide.SIDE2);
  int nullCount=0;
  for (int sideIndex=0; sideIndex < 2; sideIndex++) {
    FragmentSide side=FragmentSide.fromIndex(sideIndex);
    for (int i=0; i < fragments.length; i++) {
      DiffFragment fragment=fragments[i];
      if (fragment == null)       continue;
      DiffString text=side.getText(fragment);
      if (text == null || text.isEmpty())       continue;
      text=text.length() > 1 ? text.substring(1) : null;
      DiffString otherText=side.getOtherText(fragment);
      if (otherText == null && text == null) {
        fragments[i]=null;
        nullCount++;
      }
 else       fragments[i]=side.createFragment(text,otherText,fragment.isModified());
      break;
    }
  }
  if (nullCount == 0)   return fragments;
  DiffFragment[] result=new DiffFragment[fragments.length - nullCount];
  int dstIndex=0;
  for (int i=0; i < fragments.length; i++) {
    DiffFragment fragment=fragments[i];
    if (fragment == null)     continue;
    result[dstIndex]=fragment;
    dstIndex++;
  }
  return result;
}
