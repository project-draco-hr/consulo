{
  MyChange startChange=new MyChange(0,0,0,0);
  MyChange lastChange=startChange;
  MyChange prevChange=null;
  while (change != null) {
    if (prevChange == null || (change.inserted > 0 && change.deleted > 0)) {
      prevChange=lastChange;
      lastChange=lastChange.copyNext(change);
    }
 else {
      MyChange newChange=null;
      if (change.deleted == 0 && lastChange.deleted == 0 && change.line1 == lastChange.getEnd2()) {
        newChange=new MyChange(lastChange.line0,lastChange.line1,0,lastChange.inserted + change.inserted);
      }
 else       if (change.inserted == 0 && lastChange.inserted == 0 && change.line0 == lastChange.getEnd1()) {
        newChange=new MyChange(lastChange.line0,lastChange.line1,lastChange.deleted + change.deleted,0);
      }
      if (newChange != null) {
        prevChange.setNext(newChange);
        lastChange=newChange;
      }
 else {
        prevChange=lastChange;
        lastChange=lastChange.copyNext(change);
      }
    }
    change=change.link;
  }
  return startChange.link;
}
