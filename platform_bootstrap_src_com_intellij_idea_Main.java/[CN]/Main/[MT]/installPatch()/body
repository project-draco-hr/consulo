{
  String platform=System.getProperty("idea.platform.prefix","idea");
  String patchFileName=("jetbrains.patch.jar." + platform).toLowerCase();
  File originalPatchFile=new File(System.getProperty("java.io.tmpdir"),patchFileName);
  File copyPatchFile=new File(System.getProperty("java.io.tmpdir"),patchFileName + "_copy");
  if (!FileUtil.delete(copyPatchFile))   throw new IOException("Cannot create temporary patch file");
  if (!originalPatchFile.exists())   return;
  if (!originalPatchFile.renameTo(copyPatchFile) || !FileUtil.delete(originalPatchFile)) {
    throw new IOException("Cannot create temporary patch file");
  }
  List<String> args=new ArrayList<String>();
  if (SystemInfo.isWindows) {
    args.add(Restarter.createTempExecutable(new File(PathManager.getBinPath(),"vistalauncher.exe")).getPath());
  }
  Collections.addAll(args,System.getProperty("java.home") + "/bin/java","-classpath",copyPatchFile.getPath(),"com.intellij.updater.Runner","install",PathManager.getHomePath());
  System.exit(Restarter.scheduleRestart(args.toArray(new String[args.size()])));
}
