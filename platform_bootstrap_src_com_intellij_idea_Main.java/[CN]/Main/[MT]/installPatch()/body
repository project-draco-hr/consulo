{
  File originalPatchFile=new File(System.getProperty("java.io.tmpdir"),SharedConstants.PATCH_FILE_NAME);
  File copyPatchFile=new File(System.getProperty("java.io.tmpdir"),SharedConstants.PATCH_FILE_NAME + "_copy");
  if (!FileUtilRt.delete(copyPatchFile)) {
    throw new IOException("Cannot create temporary patch file");
  }
  if (!originalPatchFile.exists()) {
    return;
  }
  if (!originalPatchFile.renameTo(copyPatchFile) || !FileUtilRt.delete(originalPatchFile)) {
    throw new IOException("Cannot create temporary patch file");
  }
  int status=0;
  if (Restarter.isSupported()) {
    List<String> args=new ArrayList<String>();
    if (SystemInfoRt.isWindows) {
      File launcher=new File(PathManager.getBinPath(),"VistaLauncher.exe");
      args.add(Restarter.createTempExecutable(launcher).getPath());
    }
    Collections.addAll(args,System.getProperty("java.home") + "/bin/java","-Xmx500m","-classpath",copyPatchFile.getPath(),"com.intellij.updater.Runner","install",PathManager.getHomePath());
    status=Restarter.scheduleRestart(ArrayUtilRt.toStringArray(args));
  }
 else {
    String message="Patch update is not supported - please do it manually";
    showMessage("Update Error",message,true);
  }
  System.exit(status);
}
