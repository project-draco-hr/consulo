{
  Document _d=null;
  if (myElement != null) {
    myElement.detach();
    _d=new Document(myElement);
  }
  final ComponentManager componentManager=getComponentManager();
  final PathMacroManager pathMacroManager=PathMacroManager.getInstance(componentManager);
  final Document document=_d;
  final XmlElementStorage storage=new XmlElementStorage(pathMacroManager.createTrackingSubstitutor(),componentManager,ROOT_TAG_NAME,null,"",ComponentRoamingManager.getInstance(),ComponentVersionProvider.EMPTY){
    @Override @Nullable protected Document loadDocument() throws StateStorageException {
      return document;
    }
    @Override protected MySaveSession createSaveSession(    final MyExternalizationSession externalizationSession){
      return new DefaultSaveSession(externalizationSession);
    }
    @Override @NotNull protected StorageData createStorageData(){
      return new BaseStorageData(ROOT_TAG_NAME);
    }
class DefaultSaveSession extends MySaveSession {
      public DefaultSaveSession(      MyExternalizationSession externalizationSession){
        super(externalizationSession);
      }
      @Override protected void doSave() throws StateStorageException {
        myProjectManager.setDefaultProjectRootElement(getDocumentToSave().getRootElement());
      }
      @NotNull @Override public Collection<IFile> getStorageFilesToSave() throws StateStorageException {
        return Collections.emptyList();
      }
      @NotNull @Override public List<IFile> getAllStorageFiles(){
        return Collections.emptyList();
      }
    }
  }
;
  return new StateStorageManager(){
    @Override public void addMacro(    String macro,    String expansion){
      throw new UnsupportedOperationException("Method addMacro not implemented in " + getClass());
    }
    @Override @Nullable public TrackingPathMacroSubstitutor getMacroSubstitutor(){
      return null;
    }
    @Override @Nullable public StateStorage getStateStorage(    @NotNull Storage storageSpec) throws StateStorageException {
      return storage;
    }
    @Override @Nullable public StateStorage getFileStateStorage(    @NotNull String fileSpec){
      return storage;
    }
    @Override public void clearStateStorage(    @NotNull String file){
    }
    @NotNull @Override public ExternalizationSession startExternalization(){
      return new MyExternalizationSession(storage);
    }
    @NotNull @Override public SaveSession startSave(    @NotNull final ExternalizationSession externalizationSession){
      return new MySaveSession(storage,externalizationSession);
    }
    @Override public void finishSave(    @NotNull SaveSession saveSession){
      storage.finishSave(((MySaveSession)saveSession).saveSession);
    }
    @Override public String expandMacros(    final String file){
      throw new UnsupportedOperationException("Method expandMacroses not implemented in " + getClass());
    }
    @Override @Nullable public StateStorage getOldStorage(    Object component,    final String componentName,    final StateStorageOperation operation) throws StateStorageException {
      return storage;
    }
    @Override public void setStreamProvider(    @Nullable com.intellij.openapi.components.impl.stores.StreamProvider streamProvider){
      throw new UnsupportedOperationException("Method setStreamProvider not implemented in " + getClass());
    }
    @Nullable @Override public com.intellij.openapi.components.impl.stores.StreamProvider getStreamProvider(){
      throw new UnsupportedOperationException("Method getStreamProviders not implemented in " + getClass());
    }
    @Override public Collection<String> getStorageFileNames(){
      throw new UnsupportedOperationException("Method getStorageFileNames not implemented in " + getClass());
    }
    @Override public void reset(){
    }
  }
;
}
