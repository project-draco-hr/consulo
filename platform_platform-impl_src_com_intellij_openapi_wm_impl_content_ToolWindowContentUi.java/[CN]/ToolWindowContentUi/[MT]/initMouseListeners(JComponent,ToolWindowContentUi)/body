{
  if (c.getClientProperty(ui) != null)   return;
  final Point[] myLastPoint=new Point[1];
  c.addMouseMotionListener(new MouseMotionAdapter(){
    public void mouseDragged(    final MouseEvent e){
      if (myLastPoint[0] == null)       return;
      final Window window=SwingUtilities.windowForComponent(c);
      if (window instanceof IdeFrame)       return;
      final Rectangle oldBounds=window.getBounds();
      final Point newPoint=e.getPoint();
      SwingUtilities.convertPointToScreen(newPoint,c);
      final Point offset=new Point(newPoint.x - myLastPoint[0].x,newPoint.y - myLastPoint[0].y);
      window.setLocation(oldBounds.x + offset.x,oldBounds.y + offset.y);
      myLastPoint[0]=newPoint;
    }
  }
);
  c.addMouseListener(new MouseAdapter(){
    public void mousePressed(    final MouseEvent e){
      myLastPoint[0]=e.getPoint();
      SwingUtilities.convertPointToScreen(myLastPoint[0],c);
      if (!e.isPopupTrigger()) {
        if (UIUtil.isCloseClick(e)) {
          ui.processHide(e);
        }
 else {
          ui.myWindow.fireActivated();
        }
      }
    }
  }
);
  final DefaultActionGroup contentGroup=new DefaultActionGroup();
  if (c instanceof BaseLabel) {
    final Content content=((BaseLabel)c).getContent();
    if (content != null) {
      contentGroup.add(ui.myShowContent);
      contentGroup.addSeparator();
      contentGroup.add(new TabbedContentAction.CloseAction(content));
      contentGroup.add(ui.myCloseAllAction);
      contentGroup.add(new TabbedContentAction.CloseAllButThisAction(content));
      contentGroup.addSeparator();
      if (content.isPinnable()) {
        contentGroup.add(PinToolwindowTabAction.getPinAction());
        contentGroup.addSeparator();
      }
      contentGroup.add(ui.myNextTabAction);
      contentGroup.add(ui.myPreviousTabAction);
      contentGroup.addSeparator();
    }
  }
  c.addMouseListener(new PopupHandler(){
    public void invokePopup(    final Component comp,    final int x,    final int y){
      DefaultActionGroup group=new DefaultActionGroup();
      group.addAll(contentGroup);
      final ActionGroup windowPopup=ui.myWindow.getPopupGroup();
      if (windowPopup != null) {
        group.addAll(windowPopup);
      }
      final ActionPopupMenu popupMenu=ActionManager.getInstance().createActionPopupMenu(POPUP_PLACE,group);
      popupMenu.getComponent().show(comp,x,y);
    }
  }
);
  c.putClientProperty(ui,Boolean.TRUE);
}
