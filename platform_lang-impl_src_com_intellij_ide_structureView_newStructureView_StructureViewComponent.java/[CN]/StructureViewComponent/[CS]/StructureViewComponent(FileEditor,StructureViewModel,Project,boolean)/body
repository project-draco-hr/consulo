{
  super(true,true);
  myProject=project;
  myFileEditor=editor;
  myTreeModel=structureViewModel;
  myTreeModelWrapper=new TreeModelWrapper(myTreeModel,this);
  SmartTreeStructure treeStructure=new SmartTreeStructure(project,myTreeModelWrapper){
    public void rebuildTree(){
      if (!isDisposed()) {
        super.rebuildTree();
      }
    }
    public boolean isToBuildChildrenInBackground(    final Object element){
      return getRootElement() == element;
    }
    protected TreeElementWrapper createTree(){
      return new StructureViewTreeElementWrapper(myProject,myModel.getRoot(),myModel);
    }
    @Override public String toString(){
      return "structure view tree structure(model=" + myTreeModel + ")";
    }
  }
;
  final DefaultTreeModel model=new DefaultTreeModel(new DefaultMutableTreeNode(treeStructure.getRootElement()));
  myTree=new Tree(model);
  myTree.setRootVisible(showRootNode);
  myTree.setShowsRootHandles(true);
  myAbstractTreeBuilder=new StructureTreeBuilder(project,myTree,(DefaultTreeModel)myTree.getModel(),treeStructure,myTreeModelWrapper){
    @Override protected boolean validateNode(    Object child){
      return isValid(child);
    }
  }
;
  Disposer.register(this,myAbstractTreeBuilder);
  Disposer.register(myAbstractTreeBuilder,new Disposable(){
    public void dispose(){
      storeState();
    }
  }
);
  setContent(ScrollPaneFactory.createScrollPane(myAbstractTreeBuilder.getTree()));
  myAbstractTreeBuilder.getTree().setCellRenderer(new NodeRenderer());
  myAutoScrollToSourceHandler=new MyAutoScrollToSourceHandler();
  myAutoScrollFromSourceHandler=new MyAutoScrollFromSourceHandler(myProject,this);
  installTree();
  myCopyPasteDelegator=new CopyPasteDelegator(myProject,getTree()){
    @NotNull protected PsiElement[] getSelectedElements(){
      return getSelectedPsiElements();
    }
  }
;
}
