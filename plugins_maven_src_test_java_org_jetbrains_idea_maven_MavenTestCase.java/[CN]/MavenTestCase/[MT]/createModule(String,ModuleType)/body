{
  return new WriteCommandAction<Module>(myProject){
    @Override protected void run(    Result<Module> moduleResult) throws Throwable {
      VirtualFile f=createProjectSubFile(name + "/" + name+ ".iml");
      Module module=ModuleManager.getInstance(myProject).newModule(f.getPath(),type.getId());
      ModifiableRootModel model=ModuleRootManager.getInstance(module).getModifiableModel();
      model.addContentEntry(f.getParent());
      model.commit();
      moduleResult.setResult(module);
    }
  }
.execute().getResultObject();
}
