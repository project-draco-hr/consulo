{
  VirtualFile fileToDelete=event.getFile();
  Module moduleForFile=ModuleUtilCore.findModuleForFile(fileToDelete,myProject);
  if (moduleForFile == null || moduleForFile.getModuleDirUrl() != null) {
    return;
  }
  ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(moduleForFile);
  final ModifiableRootModel modifiableModel=moduleRootManager.getModifiableModel();
  boolean processed=false;
  for (  ModuleRootLayer moduleRootLayer : modifiableModel.getLayers().values()) {
    ModifiableModuleRootLayer modifiableModuleRootLayer=(ModifiableModuleRootLayer)moduleRootLayer;
    ContentEntry toRemove=null;
    for (    ContentEntry contentEntry : modifiableModuleRootLayer.getContentEntries()) {
      VirtualFile contentEntryFile=contentEntry.getFile();
      if (fileToDelete.equals(contentEntryFile)) {
        toRemove=contentEntry;
        break;
      }
    }
    if (toRemove != null) {
      processed=true;
      modifiableModuleRootLayer.removeContentEntry(toRemove);
    }
  }
  if (processed) {
    commitViaDumbService(modifiableModel);
  }
 else {
    modifiableModel.dispose();
  }
}
