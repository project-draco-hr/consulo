{
  try {
    final Application appManager=ApplicationManager.getApplication();
    appManager.runReadAction(new Runnable(){
      public void run(){
        markCommittingDocuments();
      }
    }
);
    processor.callSelf();
    appManager.runReadAction(new Runnable(){
      public void run(){
        unmarkCommittingDocuments();
      }
    }
);
    processor.doBeforeRefresh();
    AbstractVcsHelper.getInstanceChecked(myProject).showErrors(processor.getVcsExceptions(),myActionName);
  }
  finally {
    commitCompleted(processor.getVcsExceptions(),processor);
    processor.customRefresh();
    VirtualFileManager.getInstance().refresh(true,processor.postRefresh());
  }
}
