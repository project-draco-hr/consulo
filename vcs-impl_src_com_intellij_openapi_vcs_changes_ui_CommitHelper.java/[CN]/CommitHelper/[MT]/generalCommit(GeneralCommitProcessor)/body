{
  try {
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      public void run(){
        markCommittingDocuments();
      }
    }
);
    processor.callSelf();
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      public void run(){
        unmarkCommittingDocuments();
      }
    }
);
    processor.doBeforeRefresh();
    VirtualFileManager.getInstance().refresh(true,processor.postRefresh());
    AbstractVcsHelper.getInstance(myProject).showErrors(processor.getVcsExceptions(),myActionName);
  }
  finally {
    commitCompleted(processor.getVcsExceptions(),processor);
  }
}
