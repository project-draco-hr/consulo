{
  final ChangeListManager changeListManager=ChangeListManager.getInstance(myProject);
  final ChangeList list=myChangeList;
  final List<Change> includedChanges=myIncludedChanges;
  if (list instanceof LocalChangeList) {
    final LocalChangeList localList=(LocalChangeList)list;
    if (includedChanges.containsAll(list.getChanges()) && !localList.isDefault() && !localList.isReadOnly()) {
      if (!myKeepChangeListAfterCommit) {
        changeListManager.removeChangeList(localList);
      }
    }
 else     if (myConfiguration.OFFER_MOVE_TO_ANOTHER_CHANGELIST_ON_PARTIAL_COMMIT && !includedChanges.containsAll(list.getChanges()) && localList.isDefault()&& myAllOfDefaultChangeListChangesIncluded) {
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          ChangelistMoveOfferDialog dialog=new ChangelistMoveOfferDialog(myConfiguration);
          dialog.show();
          if (dialog.isOK()) {
            final Collection<Change> changes=changeListManager.getDefaultChangeList().getChanges();
            MoveChangesToAnotherListAction.askAndMove(myProject,changes.toArray(new Change[changes.size()]),null);
          }
        }
      }
,ModalityState.NON_MODAL);
    }
  }
}
