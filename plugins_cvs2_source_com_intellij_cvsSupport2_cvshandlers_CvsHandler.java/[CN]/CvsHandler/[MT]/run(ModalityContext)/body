{
  initializeListeners();
  try {
    if (runInReadThread()) {
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        public void run(){
          internalRun(executor);
        }
      }
);
    }
 else {
      internalRun(executor);
    }
  }
  finally {
    deinitializeListeners();
  }
  if (isCanceled())   throw new ProcessCanceledException();
  ProgressIndicator progress=getProgress();
  if (progress != null) {
    if (progress.isCanceled())     throw new ProcessCanceledException();
  }
}
