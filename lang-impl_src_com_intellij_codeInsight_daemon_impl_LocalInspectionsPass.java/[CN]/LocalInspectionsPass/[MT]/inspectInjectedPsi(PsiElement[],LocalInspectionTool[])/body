{
  myInjectedPsiInspectionResults=new CopyOnWriteArrayList<InjectedPsiInspectionResult>();
  final Set<PsiFile> injected=new THashSet<PsiFile>();
  for (  PsiElement element : elements) {
    InjectedLanguageUtil.enumerate(element,myFile,new PsiLanguageInjectionHost.InjectedPsiVisitor(){
      public void visit(      @NotNull PsiFile injectedPsi,      @NotNull List<PsiLanguageInjectionHost.Shred> places){
        injected.add(injectedPsi);
      }
    }
,false);
  }
  JobUtil.invokeConcurrentlyForAll(injected,new Processor<PsiFile>(){
    public boolean process(    final PsiFile injectedPsi){
      inspectInjectedPsi(injectedPsi,myInjectedPsiInspectionResults,tools);
      return true;
    }
  }
,"Inspect injected fragments");
}
