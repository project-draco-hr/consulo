{
  final FileViewProvider viewProvider=file.getViewProvider();
  final Set<PsiElement> result=new LinkedHashSet<PsiElement>();
  for (  Language language : viewProvider.getLanguages()) {
    final PsiFile psiRoot=viewProvider.getPsi(language);
    if (HighlightLevelUtil.shouldInspect(psiRoot)) {
      result.addAll(CollectHighlightsUtil.getElementsInRange(psiRoot,startOffset,endOffset,true));
    }
  }
  return result.toArray(new PsiElement[result.size()]);
}
