{
  final VirtualFile virtualFile=getVirtualFile();
  if (virtualFile != null) {
    final int line=getLine() - 1;
    final Document document=FileDocumentManager.getInstance().getDocument(virtualFile);
    if (document != null && line >= 0 && line < document.getLineCount()) {
      final int offset;
      if (getColumn() > 0) {
        final int lineStart=document.getLineStartOffset(line);
        final int lineEnd=document.getLineEndOffset(line);
        final CharSequence chText=document.getCharsSequence().subSequence(lineStart,lineEnd);
        final int tabSize=CodeStyleSettingsManager.getSettings(myProject).getTabSize(FileTypeManager.getInstance().getFileTypeByFile(virtualFile));
        offset=lineStart + EditorUtil.calcOffset(null,chText,0,chText.length(),getColumn(),tabSize) - 1;
      }
 else {
        offset=document.getLineStartOffset(line);
      }
      if (offset >= 0 && offset < document.getTextLength()) {
        return new OpenFileDescriptor(myProject,virtualFile,offset);
      }
    }
  }
  return null;
}
