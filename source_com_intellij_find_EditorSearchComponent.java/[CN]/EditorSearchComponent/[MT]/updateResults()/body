{
  removeCurrentHighlights();
  myMatchInfoLabel.setFont(myMatchInfoLabel.getFont().deriveFont(Font.PLAIN));
  String text=mySearchField.getText();
  if (text.length() == 0) {
    mySearchField.setBackground(myDefaultBackground);
    myMatchInfoLabel.setText("");
  }
 else {
    FindManager findManager=FindManager.getInstance(myProject);
    FindModel model=new FindModel();
    model.setCaseSensitive(isCaseSensitive());
    model.setWholeWordsOnly(isWholeWords());
    model.setFromCursor(false);
    model.setStringToFind(text);
    model.setSearchHighlighters(true);
    int offset=0;
    ArrayList<FindResult> results=new ArrayList<FindResult>();
    while (true) {
      FindResult result=findManager.findString(myEditor.getDocument().getCharsSequence(),offset,model);
      if (!result.isStringFound())       break;
      offset=result.getEndOffset();
      results.add(result);
      if (results.size() > 100)       break;
    }
    int currentOffset=myEditor.getCaretModel().getOffset();
    if (myEditor.getSelectionModel().hasSelection()) {
      currentOffset=Math.min(currentOffset,myEditor.getSelectionModel().getSelectionStart());
    }
    if (!findAndSelectFirstUsage(findManager,model,currentOffset)) {
      findAndSelectFirstUsage(findManager,model,0);
    }
    final int count=results.size();
    if (count <= 100) {
      highlightResults(text,results);
      if (count > 0) {
        mySearchField.setBackground(myDefaultBackground);
        if (count > 1) {
          myMatchInfoLabel.setText("" + count + " matches");
        }
 else {
          myMatchInfoLabel.setText("1 match");
        }
      }
 else {
        mySearchField.setBackground(LightColors.RED);
        myMatchInfoLabel.setText("No matches");
      }
    }
 else {
      mySearchField.setBackground(myDefaultBackground);
      myMatchInfoLabel.setText("More than 100 matches");
      myMatchInfoLabel.setFont(myMatchInfoLabel.getFont().deriveFont(Font.BOLD));
    }
    findManager.setFindWasPerformed();
    findManager.setFindNextModel(model);
  }
}
