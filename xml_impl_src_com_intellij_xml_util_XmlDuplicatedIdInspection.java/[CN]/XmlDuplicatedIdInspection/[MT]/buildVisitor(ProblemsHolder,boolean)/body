{
  return new XmlElementVisitor(){
    private XmlRefCountHolder myRefCountHolder;
    public void visitXmlAttributeValue(    final XmlAttributeValue value){
      if (myRefCountHolder == null) {
        final PsiFile psiFile=value.getContainingFile();
        if (psiFile instanceof XmlFile) {
          processFile((XmlFile)psiFile);
        }
      }
      if (myRefCountHolder != null) {
        checkIdRefAttrValue(value,myRefCountHolder,holder);
      }
    }
    private void processFile(    final XmlFile file){
      myRefCountHolder=XmlRefCountHolder.getInstance(file);
      for (Iterator<Map.Entry<PsiElement,Boolean>> iterator=myRefCountHolder.getPossiblyDuplicateElementsMap().entrySet().iterator(); iterator.hasNext(); ) {
        Map.Entry<PsiElement,Boolean> entry=iterator.next();
        final XmlAttributeValue value=(XmlAttributeValue)entry.getKey();
        if (value.isValid()) {
          processAttributeValue(value,entry.getValue().booleanValue(),myRefCountHolder,holder);
        }
 else {
          iterator.remove();
        }
      }
    }
  }
;
}
