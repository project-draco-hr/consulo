{
  Presentation presentation=event.getPresentation();
  DataContext dataContext=event.getDataContext();
  FileEditor editor=PlatformDataKeys.FILE_EDITOR.getData(dataContext);
  if (editor == null) {
    final Boolean isModalContext=PlatformDataKeys.IS_MODAL_CONTEXT.getData(dataContext);
    if (isModalContext != null && isModalContext) {
      presentation.setEnabled(false);
      return;
    }
  }
  UndoManager undoManager=getUndoManager(editor,dataContext);
  boolean available=isAvailable(editor,undoManager);
  presentation.setEnabled(available);
  String actionName=available ? formatAction(editor,undoManager) : null;
  if (actionName == null)   actionName="";
  String shortActionName=StringUtil.first(actionName,30,true);
  if (actionName.length() == 0)   actionName=ActionsBundle.message(getActionDescriptionEmptyMessageKey());
  presentation.setText(ActionsBundle.message(getActionMessageKey(),shortActionName).trim());
  presentation.setDescription(ActionsBundle.message(getActionDescriptionMessageKey(),actionName).trim());
}
