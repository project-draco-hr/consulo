{
  final Module module=facet.getModule();
  final Project project=module.getProject();
  ImportDependenciesUtil.importDependencies(module,true);
  StartupManager.getInstance(project).runWhenProjectIsInitialized(new Runnable(){
    public void run(){
      final Module module=facet.getModule();
      AndroidSdkUtils.setupAndroidPlatformInNeccessary(module);
      if (model != null && !model.isDisposed() && model.isWritable()) {
        model.setSdk(ModuleRootManager.getInstance(module).getSdk());
      }
      final Pair<String,VirtualFile> manifestMergerProp=AndroidRootUtil.getProjectPropertyValue(module,AndroidCommonUtils.ANDROID_MANIFEST_MERGER_PROPERTY);
      if (manifestMergerProp != null && Boolean.parseBoolean(manifestMergerProp.getFirst())) {
        Notifications.Bus.notify(new Notification("Android","Error importing module " + module.getName(),AndroidBundle.message("android.manifest.merger.not.supported.error"),NotificationType.ERROR));
      }
      final Pair<String,VirtualFile> androidLibraryProp=AndroidRootUtil.getProjectPropertyValue(module,AndroidUtils.ANDROID_LIBRARY_PROPERTY);
      if (androidLibraryProp != null && Boolean.parseBoolean(androidLibraryProp.getFirst())) {
        facet.getConfiguration().LIBRARY_PROJECT=true;
      }
 else {
        Manifest manifest=facet.getManifest();
        if (manifest != null) {
          if (AndroidUtils.getDefaultActivityName(manifest) != null) {
            AndroidUtils.addRunConfiguration(facet,null,false,null,null);
          }
        }
      }
      ApplicationManager.getApplication().saveAll();
    }
  }
);
}
