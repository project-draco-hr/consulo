{
  final Module module=facet.getModule();
  final Project project=module.getProject();
  ImportDependenciesUtil.importDependencies(module,true);
  StartupManager.getInstance(project).runWhenProjectIsInitialized(new Runnable(){
    public void run(){
      final Module module=facet.getModule();
      AndroidSdkUtils.setupAndroidPlatformInNeccessary(module);
      if (model != null && !model.isDisposed() && model.isWritable()) {
        model.setSdk(ModuleRootManager.getInstance(module).getSdk());
      }
      final String androidLibraryPropValue=AndroidRootUtil.getProjectPropertyValue(module,AndroidUtils.ANDROID_LIBRARY_PROPERTY);
      if (androidLibraryPropValue != null && androidLibraryPropValue.equals("true")) {
        facet.getConfiguration().LIBRARY_PROJECT=true;
      }
 else {
        Manifest manifest=facet.getManifest();
        if (manifest != null) {
          if (AndroidUtils.getDefaultActivityName(manifest) != null) {
            AndroidUtils.addRunConfiguration(facet,null,false,null,null);
          }
        }
      }
      ApplicationManager.getApplication().saveAll();
    }
  }
);
}
