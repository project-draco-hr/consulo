{
  final ID window=findWindowForTitle(frame.getTitle());
  if (window == null)   return;
  if (CURRENT_SETTER == null) {
    CURRENT_SETTER=navBar ? NAVBAR_SETTER : TOOLBAR_SETTER;
    CURRENT_GETTER=navBar ? NAVBAR_GETTER : TOOLBAR_GETTER;
    SHOWN=CURRENT_GETTER.fun(null);
  }
  UISettings.getInstance().addUISettingsListener(this,this);
  final ID pool=invoke("NSAutoreleasePool","new");
  try {
    myClassName="IdeaToolbar" + UNIQUE_COUNTER.incrementAndGet();
    final ID ownToolbar=Foundation.registerObjcClass(Foundation.getClass("NSToolbar"),myClassName);
    Foundation.registerObjcClassPair(ownToolbar);
    ID toolbar=invoke(invoke(myClassName,"alloc"),"initWithIdentifier:",Foundation.cfString(myClassName));
    Foundation.cfRetain(toolbar);
    invoke(toolbar,"setVisible:",0);
    Foundation.addMethod(ownToolbar,Foundation.createSelector("setVisible:"),SET_VISIBLE_CALLBACK,"v*");
    Foundation.addMethod(ownToolbar,Foundation.createSelector("isVisible"),IS_VISIBLE,"B*");
    invoke(window,"setToolbar:",toolbar);
    invoke(window,"setShowsToolbarButton:",1);
  }
  finally {
    invoke(pool,"release");
  }
}
