{
  if (parameters.getCompletionType() != CompletionType.BASIC)   return;
  final PsiFile file=parameters.getOriginalFile();
  final boolean isJava=file.getLanguage() == StdLanguages.JAVA;
  if (!isJava && !(file.getLanguage() instanceof XMLLanguage))   return;
  final PsiElement position=parameters.getPosition();
  if (isJava) {
    if (!(position.getParent() instanceof PsiJavaCodeReferenceElement))     return;
    if (((PsiJavaCodeReferenceElement)position.getParent()).getQualifier() != null)     return;
  }
  final String s=result.getPrefixMatcher().getPrefix();
  if (StringUtil.isEmpty(s) || !Character.isUpperCase(s.charAt(0)))   return;
  final Ref<Boolean> empty=Ref.create(true);
  result.runRemainingContributors(parameters,new Consumer<LookupElement>(){
    public void consume(    final LookupElement lookupElement){
      empty.set(false);
      result.addElement(lookupElement);
    }
  }
);
  final CompletionParameters classParams;
  final int invocationCount=parameters.getInvocationCount();
  final int offset=parameters.getOffset();
  if (empty.get().booleanValue()) {
    classParams=new CompletionParameters(position,file,CompletionType.CLASS_NAME,offset,invocationCount);
  }
 else   if (invocationCount > 1) {
    classParams=new CompletionParameters(position,file,CompletionType.CLASS_NAME,offset,invocationCount - 1);
  }
 else {
    return;
  }
  CompletionService.getCompletionService().getVariantsFromContributors(classParams,null,new Consumer<LookupElement>(){
    public void consume(    final LookupElement lookupElement){
      if (lookupElement instanceof JavaPsiClassReferenceElement) {
        ((JavaPsiClassReferenceElement)lookupElement).setAutoCompletionPolicy(AutoCompletionPolicy.NEVER_AUTOCOMPLETE);
      }
      lookupElement.putUserData(XmlCompletionContributor.WORD_COMPLETION_COMPATIBLE,Boolean.TRUE);
      result.addElement(lookupElement);
    }
  }
);
}
