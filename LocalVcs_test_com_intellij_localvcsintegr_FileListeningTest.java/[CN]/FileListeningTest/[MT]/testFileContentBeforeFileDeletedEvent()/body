{
  final VirtualFile f=root.createChildData(null,"file.java");
  f.setBinaryContent("content".getBytes());
  final String[] contents=new String[2];
  VirtualFileListener l=new VirtualFileAdapter(){
    @Override public void beforeFileDeletion(    VirtualFileEvent e){
      logContent(0);
    }
    @Override public void fileDeleted(    VirtualFileEvent e){
      logContent(1);
    }
    private void logContent(    int index){
      try {
        contents[index]=new String(f.contentsToByteArray());
      }
 catch (      IOException ex) {
        contents[index]="exception";
      }
    }
  }
;
  addFileListenerDuring(l,new Callable(){
    public Object call() throws Exception {
      f.delete(null);
      return null;
    }
  }
);
  assertEquals("content",contents[0]);
  assertEquals("exception",contents[1]);
}
