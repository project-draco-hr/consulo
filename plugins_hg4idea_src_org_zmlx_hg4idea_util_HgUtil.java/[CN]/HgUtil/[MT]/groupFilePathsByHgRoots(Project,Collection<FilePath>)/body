{
  Map<VirtualFile,Collection<FilePath>> sorted=new HashMap<VirtualFile,Collection<FilePath>>();
  for (  FilePath file : files) {
    VirtualFile repo=VcsUtil.getVcsRootFor(project,file);
    if (repo == null) {
      continue;
    }
    Collection<FilePath> filesForRoot=sorted.get(repo);
    if (filesForRoot == null) {
      filesForRoot=new HashSet<FilePath>();
      sorted.put(repo,filesForRoot);
    }
    filesForRoot.add(file);
  }
  return sorted;
}
