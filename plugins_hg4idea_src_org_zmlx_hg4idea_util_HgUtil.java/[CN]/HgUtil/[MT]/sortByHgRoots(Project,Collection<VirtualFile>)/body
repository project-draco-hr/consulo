{
  Map<VirtualFile,Collection<VirtualFile>> sorted=new HashMap<VirtualFile,Collection<VirtualFile>>();
  for (  VirtualFile file : files) {
    VirtualFile repo=VcsUtil.getVcsRootFor(project,file);
    if (repo == null) {
      continue;
    }
    Collection<VirtualFile> filesForRoot=sorted.get(repo);
    if (filesForRoot == null) {
      filesForRoot=new HashSet<VirtualFile>();
      sorted.put(repo,filesForRoot);
    }
    filesForRoot.add(file);
  }
  return sorted;
}
