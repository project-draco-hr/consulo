{
  String key=myKeyField.getText().trim();
  if (!isAllowedTemplateAbbreviation(key)) {
    Messages.showMessageDialog(getContentPane(),CodeInsightBundle.message("dialog.edit.template.error.malformed.abbreviation"),CodeInsightBundle.message("dialog.edit.template.error.title"),Messages.getErrorIcon());
    return;
  }
  for (  TemplateImpl template : myTemplates) {
    if (template.getKey().equals(key) && myTemplate != template) {
      Messages.showMessageDialog(getContentPane(),CodeInsightBundle.message("dialog.edit.template.error.already.exists",key,template.getGroupName()),CodeInsightBundle.message("dialog.edit.template.error.title"),Messages.getErrorIcon());
      return;
    }
  }
  if (!TemplateImplUtil.validateTemplateText(myTemplateEditor.getDocument().getText())) {
    Messages.showMessageDialog(getContentPane(),CodeInsightBundle.message("dialog.edit.template.error.malformed.template"),CodeInsightBundle.message("dialog.edit.template.error.title"),Messages.getErrorIcon());
    return;
  }
  super.doOKAction();
}
