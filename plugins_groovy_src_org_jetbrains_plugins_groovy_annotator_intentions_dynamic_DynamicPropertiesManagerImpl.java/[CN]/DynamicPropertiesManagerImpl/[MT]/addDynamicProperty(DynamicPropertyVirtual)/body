{
  final String moduleName=dynamicPropertyVirtual.getModuleName();
  Document document=loadModuleDynXML(moduleName);
  Element rootElement=document.getRootElement();
  final Element propertyElement=findConcreateDynamicProperty(rootElement,dynamicPropertyVirtual.getContainingClassQualifiedName(),dynamicPropertyVirtual.getPropertyName());
  if (propertyElement == null) {
    final Element dynPropertyTypeElement=findDynamicPropertyClassElement(rootElement,dynamicPropertyVirtual.getContainingClassQualifiedName());
    if (dynPropertyTypeElement == null) {
      rootElement.addContent(new DPContainingClassElement(dynamicPropertyVirtual));
    }
 else {
      dynPropertyTypeElement.addContent(new DPPropertyElement(dynamicPropertyVirtual));
    }
  }
  FileWriter writer=null;
  final File filePath=myPathsToXmls.get(ModuleManager.getInstance(getProject()).findModuleByName(moduleName));
  try {
    writer=new FileWriter(filePath);
    JDOMUtil.writeElement(rootElement,writer,"\n");
  }
 catch (  IOException e) {
    LOG.error("File " + filePath + " cannot be written.");
  }
 finally {
    try {
      if (writer != null) {
        writer.flush();
        writer.close();
      }
    }
 catch (    IOException e) {
      LOG.error("FileWriter for file " + filePath + " cannot be close.");
    }
  }
  fireChange();
  return dynamicPropertyVirtual;
}
