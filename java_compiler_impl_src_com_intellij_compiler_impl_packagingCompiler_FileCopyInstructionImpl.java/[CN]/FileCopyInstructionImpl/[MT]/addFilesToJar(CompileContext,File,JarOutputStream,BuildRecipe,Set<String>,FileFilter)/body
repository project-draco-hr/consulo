{
  final String outputRelativePath=getOutputRelativePath();
  File file=getFile();
  if (isExternalDependencyInstruction()) {
    final File toFile=DeploymentUtil.canonicalRelativePath(jarFile,outputRelativePath);
    DeploymentUtil.getInstance().copyFile(file,toFile,context,null,fileFilter);
    dependencies.addInstruction(this);
  }
 else {
    boolean ok=ZipUtil.addFileOrDirRecursively(outputStream,jarFile,file,outputRelativePath,fileFilter,writtenRelativePaths);
    if (!ok) {
      DeploymentUtil.reportRecursiveCopying(context,file.getPath(),jarFile.getPath(),"",CompilerBundle.message("message.text.setup.jar.outside.directory.path",file.getPath()));
    }
  }
}
