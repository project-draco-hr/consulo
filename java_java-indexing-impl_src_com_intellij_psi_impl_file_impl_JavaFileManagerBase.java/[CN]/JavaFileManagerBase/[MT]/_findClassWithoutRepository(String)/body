{
  VirtualFile[] sourcePath=myProjectRootManager.orderEntries().sources().usingCache().getRoots();
  VirtualFile[] classPath=myProjectRootManager.orderEntries().withoutModuleSourceEntries().classes().usingCache().getRoots();
  int index=0;
  while (index < qName.length()) {
    int index1=qName.indexOf('.',index);
    if (index1 < 0) {
      index1=qName.length();
    }
    String name=qName.substring(index,index1);
    final int sourceType=0;
    for (int type=0; type < 2; type++) {
      VirtualFile[] vDirs=type == sourceType ? sourcePath : classPath;
      for (      VirtualFile vDir : vDirs) {
        if (vDir != null) {
          VirtualFile vChild=type == sourceType ? vDir.findChild(name + JAVA_EXTENSION) : vDir.findChild(name + CLASS_EXTENSION);
          if (vChild != null) {
            PsiFile file=myFileManager.findFile(vChild);
            if (file instanceof PsiJavaFile) {
              PsiClass aClass=findClassByName((PsiJavaFile)file,name);
              if (aClass != null) {
                index=index1 + 1;
                while (index < qName.length()) {
                  index1=qName.indexOf('.',index);
                  if (index1 < 0) {
                    index1=qName.length();
                  }
                  name=qName.substring(index,index1);
                  aClass=findClassByName(aClass,name);
                  if (aClass == null)                   return null;
                  index=index1 + 1;
                }
                return aClass;
              }
            }
          }
        }
      }
    }
    boolean existsDir=false;
    for (int type=0; type < 2; type++) {
      VirtualFile[] vDirs=type == sourceType ? sourcePath : classPath;
      for (int i=0; i < vDirs.length; i++) {
        if (vDirs[i] != null) {
          VirtualFile vDirChild=vDirs[i].findChild(name);
          if (vDirChild != null) {
            PsiDirectory dir=myFileManager.findDirectory(vDirChild);
            if (dir != null) {
              vDirs[i]=vDirChild;
              existsDir=true;
              continue;
            }
          }
          vDirs[i]=null;
        }
      }
    }
    if (!existsDir)     return null;
    index=index1 + 1;
  }
  return null;
}
