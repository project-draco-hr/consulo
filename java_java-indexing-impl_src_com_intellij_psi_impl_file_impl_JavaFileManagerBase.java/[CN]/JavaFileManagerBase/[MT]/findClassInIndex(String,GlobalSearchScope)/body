{
  VirtualFile bestFile=null;
  PsiClass bestClass=null;
  final Collection<? extends PsiElement> classes=JavaFullClassNameIndex.getInstance().get(qName.hashCode(),myManager.getProject(),scope);
  for (  PsiElement found : classes) {
    if (notClass(found))     continue;
    PsiClass aClass=(PsiClass)found;
    PsiFile file=aClass.getContainingFile();
    if (file == null) {
      LOG.error("aClass=" + aClass);
      continue;
    }
    final boolean valid=aClass.isValid();
    VirtualFile vFile=file.getVirtualFile();
    if (!valid) {
      LOG.error("Invalid class " + aClass + "; "+ file+ (file.isValid() ? "" : " (invalid)")+ "; virtualFile:"+ vFile+ (vFile != null && !vFile.isValid() ? " (invalid)" : "")+ "; id="+ (vFile == null ? 0 : ((VirtualFileWithId)vFile).getId()),new PsiInvalidElementAccessException(aClass));
      continue;
    }
    final String qualifiedName=aClass.getQualifiedName();
    if (qualifiedName == null || !qualifiedName.equals(qName))     continue;
    if (!hasAcceptablePackage(vFile))     continue;
    if (bestFile == null || scope.compare(vFile,bestFile) > 0) {
      bestFile=vFile;
      bestClass=aClass;
    }
  }
  return bestClass;
}
