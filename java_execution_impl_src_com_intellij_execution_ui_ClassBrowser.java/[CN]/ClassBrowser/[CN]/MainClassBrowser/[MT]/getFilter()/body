{
  final Module module=myModuleSelector.getModule();
  final GlobalSearchScope scope;
  if (module == null)   scope=GlobalSearchScope.allScope(myProject);
 else   scope=GlobalSearchScope.moduleWithDependenciesAndLibrariesScope(module);
  final TreeClassChooser.ClassFilter filter=createFilter(module);
  return new TreeClassChooser.ClassFilterWithScope(){
    public GlobalSearchScope getScope(){
      return scope;
    }
    public boolean isAccepted(    final PsiClass aClass){
      return filter == null || filter.isAccepted(aClass);
    }
  }
;
}
