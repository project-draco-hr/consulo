{
  final JTextField field=new JTextField(30);
  final String[] gotoString=new String[1];
  final JBPopup[] popup=new JBPopup[1];
  field.addKeyListener(new KeyAdapter(){
    @Override public void keyPressed(    KeyEvent e){
      if (KeyEvent.VK_ENTER == e.getKeyCode()) {
        gotoString[0]=field.getText();
        if (gotoString[0] != null) {
          tryFind(gotoString[0]);
        }
        if (popup[0] != null) {
          popup[0].cancel();
        }
      }
    }
  }
);
  final JPanel panel=new JPanel(new BorderLayout());
  panel.add(field,BorderLayout.CENTER);
  final ComponentPopupBuilder builder=JBPopupFactory.getInstance().createComponentPopupBuilder(panel,field);
  popup[0]=builder.setTitle("Goto").setResizable(true).setFocusable(true).setMovable(true).setModalContext(true).setAdText("Commit hash, or reference, or regexp for commit message").setDimensionServiceKey(myProject,"Git.Log.Tree.Goto",true).setCancelOnClickOutside(true).addListener(new JBPopupListener(){
    public void beforeShown(    LightweightWindowEvent event){
      IdeFocusManager.findInstanceByContext(e.getDataContext()).requestFocus(field,true);
    }
    public void onClosed(    LightweightWindowEvent event){
    }
  }
).createPopup();
  UIUtil.installPopupMenuColorAndFonts(popup[0].getContent());
  UIUtil.installPopupMenuBorder(popup[0].getContent());
  popup[0].showInBestPositionFor(e.getDataContext());
}
