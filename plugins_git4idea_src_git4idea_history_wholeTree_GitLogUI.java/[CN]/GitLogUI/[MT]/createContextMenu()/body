{
  if (myContextMenu == null) {
    final DefaultActionGroup group=new DefaultActionGroup();
    final Point location=MouseInfo.getPointerInfo().getLocation();
    SwingUtilities.convertPointFromScreen(location,myJBTable);
    final int row=myJBTable.rowAtPoint(location);
    if (row >= 0) {
      final GitCommit commit=getCommitAtRow(row);
      if (commit != null) {
        myUsersFilterAction.setPreselectedUser(commit.getCommitter());
      }
    }
    group.add(myCherryPickAction);
    group.add(ActionManager.getInstance().getAction("ChangesView.CreatePatchFromChanges"));
    group.add(new MyCheckoutRevisionAction());
    group.add(new MyCheckoutNewBranchAction());
    group.add(new MyCreateNewTagAction());
    group.add(new Separator());
    group.add(myCopyHashAction);
    group.add(myMyShowTreeAction);
    group.add(myMyGotoCommitAction);
    final CustomShortcutSet shortcutSet=new CustomShortcutSet(KeyStroke.getKeyStroke(KeyEvent.VK_G,KeyEvent.ALT_DOWN_MASK | KeyEvent.CTRL_DOWN_MASK));
    myMyGotoCommitAction.registerCustomShortcutSet(shortcutSet,myJBTable);
    myMyGotoCommitAction.registerCustomShortcutSet(shortcutSet,myGraphGutter.getComponent());
    final MyHighlightCurrent myHighlightCurrent=new MyHighlightCurrent();
    final CustomShortcutSet customShortcutSet=new CustomShortcutSet(KeyStroke.getKeyStroke(KeyEvent.VK_W,SystemInfo.isMac ? KeyEvent.META_DOWN_MASK : KeyEvent.CTRL_DOWN_MASK));
    myHighlightCurrent.registerCustomShortcutSet(customShortcutSet,myJBTable);
    myHighlightCurrent.registerCustomShortcutSet(customShortcutSet,myGraphGutter.getComponent());
    group.add(myHighlightCurrent);
    group.add(new MyHighlightActionGroup());
    final MyToggleCommitMark toggleCommitMark=new MyToggleCommitMark();
    toggleCommitMark.registerCustomShortcutSet(new CustomShortcutSet(KeyStroke.getKeyStroke(KeyEvent.VK_SPACE,0)),myJBTable);
    toggleCommitMark.registerCustomShortcutSet(new CustomShortcutSet(KeyStroke.getKeyStroke(KeyEvent.VK_SPACE,0)),myGraphGutter.getComponent());
    group.add(toggleCommitMark);
    group.add(new Separator());
    group.add(myBranchSelectorAction.asTextAction());
    group.add(myUsersFilterAction.asTextAction());
    group.add(myStructureFilterAction.asTextAction());
    group.add(new Separator());
    group.add(myRefreshAction);
    group.addAll(getCustomActions());
    final CustomShortcutSet refreshShortcut=new CustomShortcutSet(KeyStroke.getKeyStroke(KeyEvent.VK_R,SystemInfo.isMac ? KeyEvent.META_DOWN_MASK : KeyEvent.CTRL_DOWN_MASK));
    myRefreshAction.registerCustomShortcutSet(refreshShortcut,myJBTable);
    myRefreshAction.registerCustomShortcutSet(refreshShortcut,myGraphGutter.getComponent());
    myContextMenu=ActionManager.getInstance().createActionPopupMenu(GIT_LOG_TABLE_PLACE,group);
  }
}
