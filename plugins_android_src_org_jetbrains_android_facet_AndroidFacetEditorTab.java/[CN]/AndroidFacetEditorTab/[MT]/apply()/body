{
  if (!isModified())   return;
  String absGenPathR=myRGenPathField.getText().trim();
  String absGenPathAidl=myAidlGenPathField.getText().trim();
  boolean runApt=false;
  boolean runIdl=false;
  if (absGenPathR == null || absGenPathR.length() == 0 || absGenPathAidl == null || absGenPathAidl.length() == 0) {
    throw new ConfigurationException("Please specify source root for autogenerated files");
  }
 else {
    String relativeGenPathR=getAndCheckRelativePath(absGenPathR,false);
    String newAptDestDir='/' + relativeGenPathR;
    if (!newAptDestDir.equals(myConfiguration.GEN_FOLDER_RELATIVE_PATH_APT)) {
      runApt=true;
    }
    myConfiguration.GEN_FOLDER_RELATIVE_PATH_APT=newAptDestDir;
    String relativeGenPathAidl=getAndCheckRelativePath(absGenPathAidl,false);
    String newIdlDestDir='/' + relativeGenPathAidl;
    if (!newIdlDestDir.equals(myConfiguration.GEN_FOLDER_RELATIVE_PATH_AIDL)) {
      runIdl=true;
    }
    myConfiguration.GEN_FOLDER_RELATIVE_PATH_AIDL=newIdlDestDir;
  }
  String absManifestPath=myManifestFileField.getText().trim();
  if (absManifestPath.length() == 0) {
    throw new ConfigurationException("Manifest file not specified");
  }
  String manifestRelPath=getAndCheckRelativePath(absManifestPath,true);
  if (!SdkConstants.FN_ANDROID_MANIFEST_XML.equals(AndroidUtils.getSimpleNameByRelativePath(manifestRelPath))) {
    throw new ConfigurationException("Manifest file must have name AndroidManifest.xml");
  }
  myConfiguration.MANIFEST_FILE_RELATIVE_PATH='/' + manifestRelPath;
  String absResPath=myResFolderField.getText().trim();
  if (absResPath.length() == 0) {
    throw new ConfigurationException("Resources folder not specified");
  }
  myConfiguration.RES_FOLDER_RELATIVE_PATH='/' + getAndCheckRelativePath(absResPath,false);
  String absAssetsPath=myAssetsFolderField.getText().trim();
  if (absResPath.length() == 0) {
    throw new ConfigurationException("Assets folder not specified");
  }
  myConfiguration.ASSETS_FOLDER_RELATIVE_PATH='/' + getAndCheckRelativePath(absAssetsPath,false);
  String absApkPath=(String)myApkPathCombo.getComboBox().getEditor().getItem();
  if (absApkPath.length() == 0) {
    myConfiguration.APK_PATH="";
  }
 else {
    myConfiguration.APK_PATH='/' + getAndCheckRelativePath(absApkPath,false);
  }
  String absLibsPath=myNativeLibsFolder.getText().trim();
  if (absLibsPath.length() == 0) {
    throw new ConfigurationException("Native libs folder not specified");
  }
  myConfiguration.LIBS_FOLDER_RELATIVE_PATH='/' + getAndCheckRelativePath(absLibsPath,false);
  if (myConfiguration.LIBRARY_PROJECT != myIsLibraryProjectCheckbox.isSelected()) {
    runApt=true;
  }
  myConfiguration.LIBRARY_PROJECT=myIsLibraryProjectCheckbox.isSelected();
  myConfiguration.RUN_PROCESS_RESOURCES_MAVEN_TASK=myRunProcessResourcesRadio.isSelected();
  myConfiguration.GENERATE_UNSIGNED_APK=myGenerateUnsignedApk.isSelected();
  ListModel model=myResOverlayList.getModel();
  String[] newResOverlayValue=new String[model.getSize()];
  for (int i=0; i < model.getSize(); i++) {
    String element=(String)model.getElementAt(i);
    newResOverlayValue[i]='/' + getAndCheckRelativePath(element,false);
  }
  myConfiguration.RES_OVERLAY_FOLDERS=newResOverlayValue;
  boolean useCustomAptSrc=myUseCustomSourceDirectoryRadio.isSelected();
  if (myConfiguration.USE_CUSTOM_APK_RESOURCE_FOLDER != useCustomAptSrc) {
    runApt=true;
  }
  myConfiguration.USE_CUSTOM_APK_RESOURCE_FOLDER=useCustomAptSrc;
  if (myConfiguration.REGENERATE_R_JAVA != myGenerateRJavaWhenChanged.isSelected()) {
    runApt=true;
  }
  myConfiguration.REGENERATE_R_JAVA=myGenerateRJavaWhenChanged.isSelected();
  if (myConfiguration.REGENERATE_JAVA_BY_AIDL != myGenerateIdlWhenChanged.isSelected()) {
    runIdl=true;
  }
  myConfiguration.REGENERATE_JAVA_BY_AIDL=myGenerateIdlWhenChanged.isSelected();
  String absAptSourcePath=myCustomAptSourceDirField.getText().trim();
  if (useCustomAptSrc) {
    if (absAptSourcePath.length() == 0) {
      throw new ConfigurationException("Resources folder not specified");
    }
    String newCustomAptSourceFolder='/' + getAndCheckRelativePath(absAptSourcePath,false);
    if (!newCustomAptSourceFolder.equals(myConfiguration.CUSTOM_APK_RESOURCE_FOLDER)) {
      runApt=true;
    }
    myConfiguration.CUSTOM_APK_RESOURCE_FOLDER=newCustomAptSourceFolder;
  }
 else {
    String relPath=toRelativePath(absAptSourcePath);
    myConfiguration.CUSTOM_APK_RESOURCE_FOLDER=relPath != null ? '/' + relPath : "";
  }
  runApt=runApt && myConfiguration.REGENERATE_R_JAVA && AndroidAptCompiler.isToCompileModule(myContext.getModule(),myConfiguration);
  runIdl=runIdl && myConfiguration.REGENERATE_JAVA_BY_AIDL;
  if (runApt || runIdl) {
    final boolean finalRunApt=runApt;
    final boolean finalRunIdl=runIdl;
    ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
      @Override public void run(){
        Module module=myContext.getModule();
        Project project=module.getProject();
        if (finalRunApt) {
          AndroidCompileUtil.generate(module,new AndroidAptCompiler(),true);
        }
        if (finalRunIdl) {
          AndroidCompileUtil.generate(module,new AndroidIdlCompiler(project));
        }
      }
    }
);
  }
}
