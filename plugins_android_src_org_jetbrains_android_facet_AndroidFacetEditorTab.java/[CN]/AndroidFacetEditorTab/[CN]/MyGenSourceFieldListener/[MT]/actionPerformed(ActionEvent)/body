{
  VirtualFile initialFile=null;
  String path=myTextField.getText().trim();
  if (path.length() == 0) {
    path=myDefaultPath;
  }
  if (path != null) {
    initialFile=LocalFileSystem.getInstance().findFileByPath(path);
  }
  if (initialFile == null) {
    Module module=myContext.getModule();
    ModuleRootManager manager=ModuleRootManager.getInstance(module);
    VirtualFile[] sourceRoots=manager.getSourceRoots();
    if (sourceRoots.length > 0) {
      initialFile=sourceRoots[0];
    }
 else {
      initialFile=module.getModuleFile();
      if (initialFile == null) {
        String p=AndroidRootUtil.getModuleDirPath(myContext.getModule());
        if (p != null) {
          initialFile=LocalFileSystem.getInstance().findFileByPath(p);
        }
      }
    }
  }
  final FileChooserDescriptor descriptor=FileChooserDescriptorFactory.createSingleFolderDescriptor();
  VirtualFile file=FileChooser.chooseFile(descriptor,myContentPanel,myContext.getProject(),initialFile);
  if (file != null) {
    myTextField.setText(FileUtil.toSystemDependentName(file.getPath()));
  }
}
