{
  vcs.createFile("f1",cf("old"),-1);
  fireRefreshStarted();
  fireContentChanged(new TestVirtualFile("f1","new",-1));
  fireCreated(new TestVirtualFile("f2","",-1));
  d.afterRefreshFinish(false);
  assertEquals(c("old"),vcs.getEntry("f1").getContent());
  assertFalse(vcs.hasEntry("f2"));
  CacheUpdaterHelper.performUpdate(d);
  assertEquals(c("new"),vcs.getEntry("f1").getContent());
  assertTrue(vcs.hasEntry("f2"));
}
