{
  if (isCompletelyBroken)   return;
  TIntHashSet recursionGuard=new TIntHashSet(1000);
  try {
    int firstObsoleteId=findFirstObsoleteBlock(period,intervalBetweenActivities,recursionGuard);
    if (firstObsoleteId == 0)     return;
    int eachBlockId=firstObsoleteId;
    while (eachBlockId != 0) {
      processor.consume(doReadBlock(eachBlockId).changeSet);
      Pair<Long,Integer> os=myStorage.getOffsetAndSize(eachBlockId);
      LocalHistoryLog.LOG.info("Block was deleted: " + eachBlockId + " offset: "+ os.first+ " size: "+ os.second);
      eachBlockId=doReadPrevSafely(eachBlockId,recursionGuard);
    }
    myStorage.deleteRecordsUpTo(firstObsoleteId);
    myStorage.force();
  }
 catch (  IOException e) {
    handleError(e,null);
  }
}
