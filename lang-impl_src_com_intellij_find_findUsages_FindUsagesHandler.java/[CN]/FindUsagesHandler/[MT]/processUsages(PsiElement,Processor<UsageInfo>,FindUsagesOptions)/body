{
  String stringToSearch=getStringToSearch(element);
  if (stringToSearch != null) {
    final TextRange elementTextRange=ApplicationManager.getApplication().runReadAction(new Computable<TextRange>(){
      public TextRange compute(){
        if (!element.isValid())         return null;
        return element.getTextRange();
      }
    }
);
    TextOccurrencesUtil.UsageInfoFactory factory=new TextOccurrencesUtil.UsageInfoFactory(){
      public UsageInfo createUsageInfo(      @NotNull PsiElement usage,      int startOffset,      int endOffset){
        if (elementTextRange != null && usage.getContainingFile() == element.getContainingFile() && elementTextRange.contains(startOffset) && elementTextRange.contains(endOffset)) {
          return null;
        }
        return new UsageInfo(usage,startOffset,endOffset,true);
      }
    }
;
    TextOccurrencesUtil.processTextOccurences(element,stringToSearch,(GlobalSearchScope)options.searchScope,processor,factory);
  }
}
