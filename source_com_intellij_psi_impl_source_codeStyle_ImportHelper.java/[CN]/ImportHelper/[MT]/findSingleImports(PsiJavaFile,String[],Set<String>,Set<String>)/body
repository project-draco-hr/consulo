{
  final GlobalSearchScope resolveScope=file.getResolveScope();
  HashSet<String> namesToUseSingle=new HashSet<String>();
  final String thisPackageName=file.getPackageName();
  final Set<String> implicitlyImportedPackages=new HashSet<String>(Arrays.asList(file.getImplicitlyImportedPackages()));
  final PsiManager manager=file.getManager();
  for (int i=0; i < names.length; i++) {
    String name=names[i];
    String prefix=getPackageOrClassName(name);
    if (prefix.length() == 0)     continue;
    final boolean isImplicitlyImported=implicitlyImportedPackages.contains(prefix);
    if (!onDemandImports.contains(prefix) && !isImplicitlyImported)     continue;
    String shortName=PsiNameHelper.getShortClassName(name);
    String thisPackageClass=thisPackageName.length() > 0 ? thisPackageName + "." + shortName : shortName;
    if (manager.findClass(thisPackageClass,resolveScope) != null) {
      namesToUseSingle.add(name);
      continue;
    }
    if (!isImplicitlyImported) {
      String langPackageClass="java.lang." + shortName;
      if (manager.findClass(langPackageClass,resolveScope) != null) {
        namesToUseSingle.add(name);
        continue;
      }
    }
    for (Iterator<String> iterator=onDemandImports.iterator(); iterator.hasNext(); ) {
      String onDemandName=iterator.next();
      if (prefix.equals(onDemandName))       continue;
      if (namesToImportStaticly.contains(name)) {
        PsiClass aClass=manager.findClass(onDemandName,resolveScope);
        if (aClass != null) {
          PsiField field=aClass.findFieldByName(shortName,true);
          if (field != null && field.hasModifierProperty(PsiModifier.STATIC)) {
            namesToUseSingle.add(name);
          }
 else {
            PsiClass inner=aClass.findInnerClassByName(shortName,true);
            if (inner != null && inner.hasModifierProperty(PsiModifier.STATIC)) {
              namesToUseSingle.add(name);
            }
 else {
              PsiMethod[] methods=aClass.findMethodsByName(shortName,true);
              for (int j=0; j < methods.length; j++) {
                PsiMethod method=methods[j];
                if (method.hasModifierProperty(PsiModifier.STATIC)) {
                  namesToUseSingle.add(name);
                }
              }
            }
          }
        }
      }
 else {
        PsiClass aClass=manager.findClass(onDemandName + "." + shortName,resolveScope);
        if (aClass != null) {
          namesToUseSingle.add(name);
        }
      }
    }
  }
  return namesToUseSingle;
}
