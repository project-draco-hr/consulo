{
  if (scope instanceof PsiImportList)   return;
  final PsiElement[] children=scope.getChildren();
  for (  PsiElement child : children) {
    addNamesToImport(names,child,thisPackageName,namesToImportStaticly);
    if (child instanceof PsiJavaCodeReferenceElement) {
      final PsiJavaCodeReferenceElement referenceElement=(PsiJavaCodeReferenceElement)child;
      if (referenceElement.getQualifier() != null) {
        continue;
      }
      if (child instanceof PsiJavaCodeReferenceElementImpl && ((PsiJavaCodeReferenceElementImpl)child).getKind() == PsiJavaCodeReferenceElementImpl.CLASS_IN_QUALIFIED_NEW_KIND) {
        continue;
      }
      JavaResolveResult resolveResult=referenceElement.advancedResolve(true);
      PsiElement refElement=resolveResult.getElement();
      if (refElement == null) {
        refElement=ResolveClassUtil.resolveClass(referenceElement);
      }
      if (refElement != null) {
        if (refElement instanceof PsiClass) {
          PsiClass refClass=(PsiClass)refElement;
          PsiElement parent=refClass.getParent();
          if (parent instanceof PsiClass) {
            if (isInnerVisibleByShortName(refClass,referenceElement))             continue;
          }
 else           if (!(parent instanceof PsiFile))           continue;
          String qName=refClass.getQualifiedName();
          if (hasPackage(qName,thisPackageName))           continue;
          names.add(qName);
        }
 else {
          PsiElement currentFileResolveScope=resolveResult.getCurrentFileResolveScope();
          if (currentFileResolveScope instanceof PsiImportStaticStatement) {
            PsiImportStaticStatement importStaticStatement=(PsiImportStaticStatement)currentFileResolveScope;
            String name=importStaticStatement.getImportReference().getCanonicalText();
            if (importStaticStatement.isOnDemand()) {
              String refName=referenceElement.getReferenceName();
              if (refName != null)               name=name + "." + refName;
            }
            names.add(name);
            namesToImportStaticly.add(name);
          }
        }
      }
    }
  }
}
