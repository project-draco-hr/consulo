{
  ModelWithValidity modelWithValidity=myRawModelsAndValidityCache.get(file);
  if (modelWithValidity == null) {
    modelWithValidity=doReadProjectModel(file,generalSettings);
    myRawModelsAndValidityCache.put(file,modelWithValidity);
  }
  Model model=modelWithValidity.model;
  List<Profile> activatedProfiles=applyProfiles(model,getBaseDir(file),activeProfiles);
  repairModelHeader(model);
  if (!resolveInheritance(generalSettings,model,file,activeProfiles,recursionGuard,locator)) {
    modelWithValidity.validity=false;
  }
  repairModelBody(model);
  return Pair.create(modelWithValidity,activatedProfiles);
}
