{
  ModelWithProblems modelWithValidity=myRawModelsAndProblemsCache.get(file);
  if (modelWithValidity == null) {
    modelWithValidity=doReadProjectModel(file,generalSettings);
    myRawModelsAndProblemsCache.put(file,modelWithValidity);
  }
  Model model=modelWithValidity.model;
  List<Profile> activatedProfiles=applyProfiles(model,getBaseDir(file),activeProfiles);
  repairModelHeader(model);
  resolveInheritance(generalSettings,model,file,activeProfiles,recursionGuard,locator,modelWithValidity.problems);
  repairModelBody(model);
  return Pair.create(modelWithValidity,activatedProfiles);
}
