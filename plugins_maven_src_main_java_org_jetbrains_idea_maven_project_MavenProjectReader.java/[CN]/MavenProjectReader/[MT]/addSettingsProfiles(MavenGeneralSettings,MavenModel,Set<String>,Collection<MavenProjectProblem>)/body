{
  if (mySettingsProfilesCache == null) {
    List<MavenProfile> settingsProfiles=new ArrayList<MavenProfile>();
    Collection<MavenProjectProblem> settingsProblems=MavenProjectProblem.createProblemsList();
    Set<String> settingsAlwaysOnProfiles=new THashSet<String>();
    for (    VirtualFile each : generalSettings.getEffectiveSettingsFiles()) {
      collectProfilesFromSettingsXmlOrProfilesXml(each,"settings",false,MavenConstants.PROFILE_FROM_SETTINGS_XML,settingsProfiles,settingsAlwaysOnProfiles,settingsProblems);
    }
    mySettingsProfilesCache=new SettingsProfilesCache(settingsProfiles,settingsAlwaysOnProfiles,settingsProblems);
  }
  List<MavenProfile> modelProfiles=model.getProfiles();
  for (  MavenProfile each : mySettingsProfilesCache.profiles) {
    addProfileIfDoesNotExist(each,modelProfiles);
  }
  problems.addAll(mySettingsProfilesCache.problems);
  alwaysOnProfiles.addAll(mySettingsProfilesCache.alwaysOnProfiles);
}
