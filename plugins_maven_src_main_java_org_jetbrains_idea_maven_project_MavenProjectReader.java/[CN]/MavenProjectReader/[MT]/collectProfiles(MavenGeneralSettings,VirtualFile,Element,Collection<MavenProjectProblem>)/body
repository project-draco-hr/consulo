{
  List<Profile> result=new ArrayList<Profile>();
  collectProfiles(findChildrenByPath(xmlProject,"profiles","profile"),result);
  VirtualFile profilesFile=MavenUtil.findProfilesXmlFile(projectFile);
  if (profilesFile != null) {
    Element profilesFileElement=readXml(profilesFile,problems,MavenProjectProblem.ProblemType.SETTINGS_OR_PROFILES);
    Element rootElement=findChildByPath(profilesFileElement,"profiles");
    if (rootElement == null)     rootElement=findChildByPath(profilesFileElement,"profilesXml.profiles");
    List<Element> xmlProfiles=collectChildren(rootElement,"profile");
    collectProfiles(xmlProfiles,result);
  }
  for (  VirtualFile each : generalSettings.getEffectiveSettingsFiles()) {
    collectProfilesFromSettingsFile(each,result,problems);
  }
  return result;
}
