{
  List<Profile> activated=new ArrayList<Profile>();
  List<Profile> activeByDefault=new ArrayList<Profile>();
  ProfileActivationContext context=new DefaultProfileActivationContext(System.getProperties(),true);
  for (  Profile eachProfile : (Iterable<? extends Profile>)model.getProfiles()) {
    if (profiles.contains(eachProfile.getId())) {
      activated.add(eachProfile);
    }
    Activation activation=eachProfile.getActivation();
    if (activation == null)     continue;
    if (activation.isActiveByDefault()) {
      activeByDefault.add(eachProfile);
    }
    ProfileActivator[] activators=new ProfileActivator[]{new FileProfileActivator(),new SystemPropertyProfileActivator(),new JdkPrefixProfileActivator(),new OperatingSystemProfileActivator()};
    for (    ProfileActivator eachActivator : activators) {
      try {
        if (eachActivator.canDetermineActivation(eachProfile,context) && eachActivator.isActive(eachProfile,context)) {
          activated.add(eachProfile);
        }
      }
 catch (      ProfileActivationException e) {
        MavenLog.LOG.warn(e);
      }
    }
  }
  List<Profile> result=activated.isEmpty() ? activeByDefault : activated;
  for (  Profile each : result) {
    new DefaultProfileInjector().inject(each,model);
  }
  return result;
}
