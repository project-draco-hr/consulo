{
  List<Profile> result=new ArrayList<Profile>();
  collectProfiles(findChildrenByPath(xmlProject,"profiles","profile"),result);
  VirtualFile profilesFile=MavenUtil.findProfilesXmlFile(file);
  if (profilesFile != null) {
    Pair<Element,Boolean> readResult=readXml(profilesFile);
    Element profilesFileElement=readResult.first;
    if (!readResult.second)     validity.set(false);
    Element rootElement=findChildByPath(profilesFileElement,"profiles");
    if (rootElement == null)     rootElement=findChildByPath(profilesFileElement,"profilesXml.profiles");
    List<Element> xmlProfiles=collectChildren(rootElement,"profile");
    collectProfiles(xmlProfiles,result);
  }
  for (  VirtualFile each : generalSettings.getEffectiveSettingsFiles()) {
    collectProfilesFromSettingsFile(each,result,validity);
  }
  return result;
}
