{
  List<Profile> result=new ArrayList<Profile>();
  collectProfiles(findChildrenByPath(xmlProject,"profiles","profile"),result);
  VirtualFile profilesFile=file.getParent().findChild(MavenConstants.PROFILES_XML);
  if (profilesFile != null) {
    Element profilesFileElement=readXml(profilesFile);
    Element rootElement=findChildByPath(profilesFileElement,"profiles");
    if (rootElement == null)     rootElement=findChildByPath(profilesFileElement,"profilesXml.profiles");
    List<Element> xmlProfiles=collectChildren(rootElement,"profile");
    collectProfiles(xmlProfiles,result);
  }
  File userSettings=MavenEmbedderFactory.resolveUserSettingsFile(generalSettings.getMavenSettingsFile());
  collectProfilesFromSettingsFile(userSettings,result);
  File globalSettings=MavenEmbedderFactory.resolveGlobalSettingsFile(generalSettings.getMavenHome());
  collectProfilesFromSettingsFile(globalSettings,result);
  return result;
}
