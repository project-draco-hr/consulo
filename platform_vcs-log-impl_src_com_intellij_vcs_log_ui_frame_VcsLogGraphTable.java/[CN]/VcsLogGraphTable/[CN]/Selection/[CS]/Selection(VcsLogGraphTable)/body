{
  myTable=table;
  List<Integer> selectedRows=ContainerUtil.sorted(Ints.asList(myTable.getSelectedRows()));
  Couple<Integer> visibleRows=ScrollingUtil.getVisibleRows(myTable);
  myIsOnTop=visibleRows.first - 1 == 0;
  VisibleGraph<Integer> graph=myTable.getVisibleGraph();
  mySelectedCommits=new TIntHashSet();
  Integer visibleSelectedCommit=null;
  Integer delta=null;
  for (  int row : selectedRows) {
    if (row < graph.getVisibleCommitCount()) {
      Integer commit=graph.getRowInfo(row).getCommit();
      mySelectedCommits.add(commit);
      if (visibleRows.first - 1 <= row && row <= visibleRows.second && visibleSelectedCommit == null) {
        visibleSelectedCommit=commit;
        delta=myTable.getCellRect(row,0,false).y - myTable.getVisibleRect().y;
      }
    }
  }
  if (visibleSelectedCommit == null && visibleRows.first - 1 >= 0) {
    visibleSelectedCommit=graph.getRowInfo(visibleRows.first - 1).getCommit();
    delta=myTable.getCellRect(visibleRows.first - 1,0,false).y - myTable.getVisibleRect().y;
  }
  myVisibleSelectedCommit=visibleSelectedCommit;
  myDelta=delta;
}
