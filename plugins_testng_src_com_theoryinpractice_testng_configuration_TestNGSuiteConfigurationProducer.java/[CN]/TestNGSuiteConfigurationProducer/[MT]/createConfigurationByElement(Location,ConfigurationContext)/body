{
  final PsiElement element=location.getPsiElement();
  final PsiFile containingFile=element.getContainingFile();
  if (containingFile == null)   return null;
  final VirtualFile virtualFile=containingFile.getVirtualFile();
  if (virtualFile == null || !virtualFile.isValid())   return null;
  if (!TestNGUtil.isTestngXML(virtualFile))   return null;
  myPsiElement=containingFile;
  final Project project=location.getProject();
  RunnerAndConfigurationSettings settings=cloneTemplateConfiguration(project,context);
  final TestNGConfiguration configuration=(TestNGConfiguration)settings.getConfiguration();
  setupConfigurationModule(context,configuration);
  final Module originalModule=configuration.getConfigurationModule().getModule();
  configuration.getPersistantData().SUITE_NAME=virtualFile.getPath();
  configuration.getPersistantData().TEST_OBJECT=TestType.SUITE.getType();
  configuration.restoreOriginalModule(originalModule);
  settings.setName(configuration.getName());
  copyStepsBeforeRun(project,configuration);
  RunConfigurationExtension.patchCreatedConfiguration(configuration);
  return (RunnerAndConfigurationSettingsImpl)settings;
}
