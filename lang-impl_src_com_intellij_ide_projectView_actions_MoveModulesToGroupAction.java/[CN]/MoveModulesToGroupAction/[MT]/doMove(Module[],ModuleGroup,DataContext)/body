{
  Project project=modules[0].getProject();
  for (  final Module module : modules) {
    ModifiableModuleModel model=(ModifiableModuleModel)dataContext.getData(DataConstantsEx.MODIFIABLE_MODULE_MODEL);
    if (model != null) {
      model.setModuleGroupPath(module,group == null ? null : group.getGroupPath());
    }
 else {
      ModuleManagerImpl.getInstanceImpl(project).setModuleGroupPath(module,group == null ? null : group.getGroupPath());
    }
  }
  AbstractProjectViewPane pane=ProjectView.getInstance(project).getCurrentProjectViewPane();
  if (pane != null) {
    pane.updateFromRoot(true);
  }
  final ModuleStructureConfigurable rootConfigurable=ModuleStructureConfigurable.getInstance(project);
  if (rootConfigurable.updateProjectTree(modules,group)) {
    if (group != null) {
      rootConfigurable.selectNodeInTree(group.toString());
    }
 else {
      rootConfigurable.selectNodeInTree(modules[0].getName());
    }
  }
 else   if (pane != null) {
    if (group != null) {
      pane.selectModuleGroup(group,true);
    }
 else {
      pane.selectModule(modules[0],true);
    }
  }
}
