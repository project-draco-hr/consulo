{
  final List<PsiJavaCodeReferenceElement> selfReferences=new ArrayList<PsiJavaCodeReferenceElement>();
  newClass.accept(new JavaRecursiveElementWalkingVisitor(){
    @Override public void visitReferenceElement(    final PsiJavaCodeReferenceElement reference){
      super.visitReferenceElement(reference);
      final PsiElement target=reference.resolve();
      if (target == null)       return;
      if (target == oldClass || target.getNavigationElement() == oldClass) {
        selfReferences.add(reference);
      }
    }
  }
);
  for (  PsiJavaCodeReferenceElement selfReference : selfReferences) {
    selfReference.bindToElement(newClass);
  }
}
