{
  if (text != null) {
    text=text.trim();
    text=StringUtil.replace(text,"&nbsp;"," ");
    text=StringUtil.replace(text,"\n"," ");
    StringBuilder builder=new StringBuilder();
    int length=text.length();
    boolean whitespace=false;
    for (int i=0; i < length; i++) {
      char ch=text.charAt(i);
      if (ch == ' ') {
        if (!whitespace) {
          whitespace=true;
          builder.append(ch);
        }
      }
 else {
        whitespace=false;
        builder.append(ch);
      }
    }
    text=builder.toString();
  }
  return text;
}
