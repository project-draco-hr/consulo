{
  ArrayList<VirtualFile[]> result=new ArrayList<VirtualFile[]>();
  getFilesRecursively(file,compileTimeOnly,result);
switch (result.size()) {
case 0:
    return VirtualFile.EMPTY_ARRAY;
case 1:
  return result.get(0);
default :
int size=0;
for (VirtualFile[] files : result) {
size+=files.length;
}
VirtualFile[] files=new VirtualFile[size];
int pos=0;
for (VirtualFile[] virtualFiles : result) {
System.arraycopy(virtualFiles,0,files,pos,virtualFiles.length);
pos+=virtualFiles.length;
}
return files;
}
}
