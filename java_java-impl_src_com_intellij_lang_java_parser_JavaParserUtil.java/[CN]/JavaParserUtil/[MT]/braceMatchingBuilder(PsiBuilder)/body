{
  return new PsiBuilderAdapter(builder){
    private int braceCount=1;
    private int lastOffset=-1;
    @Override public IElementType getTokenType(){
      final IElementType tokenType=super.getTokenType();
      if (getCurrentOffset() != lastOffset) {
        if (tokenType == JavaTokenType.LBRACE) {
          braceCount++;
        }
 else         if (tokenType == JavaTokenType.RBRACE) {
          braceCount--;
        }
        lastOffset=getCurrentOffset();
      }
      return (braceCount == 0 ? null : tokenType);
    }
    @Override public boolean eof(){
      return braceCount == 0 || super.eof();
    }
  }
;
}
