{
  final ProjectStructureHelper projectStructureHelper=ServiceManager.getService(ideProject,ProjectStructureHelper.class);
  for (  ModuleData gradleModule : externalProject.getModules()) {
    final Module ideModule=projectStructureHelper.findIdeModule(gradleModule);
    if (ideModule == null) {
      continue;
    }
    ExternalEntityVisitor visitor=new ExternalEntityVisitorAdapter(){
      @Override public void visit(      @NotNull LibraryDependencyData gradleDependency){
        LibraryDependencyId id=EntityIdMapper.mapEntityToId(gradleDependency);
        LibraryOrderEntry ideDependency=projectStructureHelper.findIdeModuleLocalLibraryDependency(id.getOwnerModuleName(),id.getDependencyName());
        if (ideDependency == null) {
          return;
        }
        myDependencyManager.removeDependency(ideDependency,true);
        ideDependency=projectStructureHelper.findIdeLibraryDependency(id);
        if (ideDependency == null) {
          myDependencyManager.importDependency(gradleDependency,ideModule,true);
        }
        LibraryData gradleLibrary=gradleDependency.getTarget();
        Library ideLibrary=projectStructureHelper.findIdeLibrary(gradleLibrary);
        if (ideLibrary == null) {
          myLibraryManager.importLibrary(gradleLibrary,ideProject,true);
        }
 else {
          myLibraryManager.syncPaths(gradleLibrary,ideLibrary,ideProject,true);
        }
      }
    }
;
    for (    DependencyData dependency : gradleModule.getDependencies()) {
      dependency.invite(visitor);
    }
  }
  return externalProject;
}
