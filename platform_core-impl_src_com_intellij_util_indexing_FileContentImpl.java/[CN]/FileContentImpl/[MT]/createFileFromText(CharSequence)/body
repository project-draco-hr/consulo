{
  Project project=getProject();
  if (project == null) {
    project=DefaultProjectFactory.getInstance().getDefaultProject();
  }
  final Language language=((LanguageFileType)getFileTypeWithoutSubstitution()).getLanguage();
  final Language substitutedLanguage=LanguageSubstitutors.INSTANCE.substituteLanguage(language,getFile(),project);
  return PsiFileFactory.getInstance(project).createFileFromText(getFileName(),substitutedLanguage,text,false,false,true);
}
