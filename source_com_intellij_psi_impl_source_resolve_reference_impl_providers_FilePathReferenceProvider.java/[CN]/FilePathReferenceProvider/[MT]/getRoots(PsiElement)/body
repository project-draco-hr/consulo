{
  Module thisModule=ModuleUtil.findModuleForPsiElement(element);
  if (thisModule == null)   return Collections.EMPTY_LIST;
  List<Module> modules=new ArrayList<Module>();
  modules.add(thisModule);
  ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(thisModule);
  modules.addAll(Arrays.asList(moduleRootManager.getDependencies()));
  List<PsiElement> result=new ArrayList<PsiElement>();
  String[] libraryUrls=moduleRootManager.getUrls(OrderRootType.CLASSES);
  for (  String libraryUrl : libraryUrls) {
    VirtualFile libFile=VirtualFileManager.getInstance().findFileByUrl(libraryUrl);
    if (libFile != null) {
      PsiDirectory directory=element.getManager().findDirectory(libFile);
      if (directory != null) {
        result.add(directory);
      }
    }
  }
  for (  Module module : modules) {
    moduleRootManager=ModuleRootManager.getInstance(module);
    VirtualFile[] sourceRoots=moduleRootManager.getSourceRoots();
    for (    VirtualFile root : sourceRoots) {
      PsiDirectory directory=element.getManager().findDirectory(root);
      if (directory != null) {
        result.add(directory);
      }
    }
  }
  return result;
}
