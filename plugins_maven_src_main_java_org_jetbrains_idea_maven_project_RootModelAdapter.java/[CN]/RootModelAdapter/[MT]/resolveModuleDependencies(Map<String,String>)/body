{
  OrderEntry[] entries=myRootModel.getOrderEntries();
  boolean dirty=false;
  for (int i=0; i != entries.length; i++) {
    if (entries[i] instanceof LibraryOrderEntry) {
      final LibraryOrderEntry libraryOrderEntry=(LibraryOrderEntry)entries[i];
      if (libraryOrderEntry.isModuleLevel()) {
        final String moduleName=libraryNameToModule.get(libraryOrderEntry.getLibraryName());
        if (moduleName != null) {
          dirty=true;
          myRootModel.removeOrderEntry(libraryOrderEntry);
          entries[i]=myRootModel.addInvalidModuleEntry(moduleName);
        }
      }
    }
  }
  if (dirty) {
    myRootModel.rearrangeOrderEntries(entries);
  }
}
