{
  OrderEntry[] entries=modifiableRootModel.getOrderEntries();
  boolean dirty=false;
  for (int i=0; i != entries.length; i++) {
    if (entries[i] instanceof LibraryOrderEntry) {
      final LibraryOrderEntry libraryOrderEntry=(LibraryOrderEntry)entries[i];
      if (libraryOrderEntry.isModuleLevel()) {
        final String moduleName=libraryNameToModule.get(libraryOrderEntry.getLibraryName());
        if (moduleName != null) {
          dirty=true;
          modifiableRootModel.removeOrderEntry(libraryOrderEntry);
          entries[i]=modifiableRootModel.addInvalidModuleEntry(moduleName);
        }
      }
    }
  }
  if (dirty) {
    modifiableRootModel.rearrangeOrderEntries(entries);
  }
}
