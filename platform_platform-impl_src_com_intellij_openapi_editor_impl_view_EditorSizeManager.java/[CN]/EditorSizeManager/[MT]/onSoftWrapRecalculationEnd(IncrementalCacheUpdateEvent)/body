{
  if (myDocument.isInBulkUpdate())   return;
  boolean invalidate=true;
  if (myEditor.getFoldingModel().isInBatchFoldingOperation()) {
    myFoldingChangeStartOffset=Math.min(myFoldingChangeStartOffset,event.getStartOffset());
    myFoldingChangeEndOffset=Math.max(myFoldingChangeEndOffset,event.getActualEndOffset());
    invalidate=false;
  }
  if (myDocument.isInEventsHandling()) {
    myDocumentChangeStartOffset=Math.min(myDocumentChangeStartOffset,event.getStartOffset());
    myDocumentChangeEndOffset=Math.max(myDocumentChangeEndOffset,event.getActualEndOffset());
    invalidate=false;
  }
  if (invalidate) {
    doInvalidateRange(event.getStartOffset(),event.getActualEndOffset());
  }
}
