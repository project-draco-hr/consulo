{
  if (psiClass == null)   return null;
  String qName=getQualifiedName(psiClass);
  if (qName == null)   return null;
  DomElement domElement=context.getInvocationElement();
  Manifest manifest=domElement.getParentOfType(Manifest.class,true);
  final String packageName=manifest == null ? null : manifest.getPackage().getValue();
  PsiFile file=psiClass.getContainingFile();
  if (file instanceof PsiClassOwner) {
    PsiClassOwner psiFile=(PsiClassOwner)file;
    if (Comparing.equal(psiFile.getPackageName(),packageName)) {
      String name=getName(psiClass);
      if (name != null) {
        return '.' + name;
      }
    }
 else     if (packageName != null && qName.startsWith(packageName)) {
      return qName.substring(packageName.length());
    }
  }
  return qName;
}
