{
  final Map<AntBuildFile,KeymapGroup> buildFileToGroup=new HashMap<AntBuildFile,KeymapGroup>();
  final KeymapGroup result=KeymapGroupFactory.getInstance().createGroup(KeyMapBundle.message("ant.targets.group.title"),ANT_ICON,ANT_OPEN_ICON);
  final ActionManagerEx actionManager=ActionManagerEx.getInstanceEx();
  final String[] ids=actionManager.getActionIds(project != null ? AntConfiguration.getActionIdPrefix(project) : AntConfiguration.ACTION_ID_PREFIX);
  Arrays.sort(ids);
  if (project != null) {
    final AntConfiguration antConfiguration=AntConfiguration.getInstance(project);
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      public void run(){
        for (        final String id : ids) {
          if (filtered != null && !filtered.value(actionManager.getActionOrStub(id))) {
            continue;
          }
          final AntBuildFile buildFile=antConfiguration.findBuildFileByActionId(id);
          if (buildFile != null) {
            KeymapGroup subGroup=buildFileToGroup.get(buildFile);
            if (subGroup == null) {
              subGroup=KeymapGroupFactory.getInstance().createGroup(buildFile.getPresentableName());
              buildFileToGroup.put(buildFile,subGroup);
              result.addGroup(subGroup);
            }
            subGroup.addActionId(id);
          }
 else {
            LOG.info("no buildfile found for actionId=" + id);
          }
        }
      }
    }
);
  }
  return result;
}
