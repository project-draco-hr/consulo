{
  final Map<Object,List<String>> buildFileToGroup=new HashMap<Object,List<String>>();
  final ActionManagerEx actionManager=ActionManagerEx.getInstanceEx();
  String[] ids=actionManager.getActionIds(project != null ? AntConfiguration.getActionIdPrefix(project) : AntConfiguration.ACTION_ID_PREFIX);
  Arrays.sort(ids);
  if (project != null) {
    final AntConfiguration antConfiguration=AntConfiguration.getInstance(project);
    if (antConfiguration != null) {
      for (      final String id : ids) {
        if (filtered != null && !filtered.value(actionManager.getActionOrStub(id)))         continue;
        final AntBuildFile buildFile=antConfiguration.findBuildFileByActionId(id);
        if (buildFile == null) {
          LOG.info("no buildfile found for actionId=" + id);
          continue;
        }
        List<String> subGroup=buildFileToGroup.get(buildFile);
        if (subGroup == null) {
          subGroup=new ArrayList<String>();
          buildFileToGroup.put(buildFile,subGroup);
        }
        subGroup.add(id);
      }
    }
  }
  return buildFileToGroup;
}
