{
  final Map<AntBuildFile,KeymapGroup> buildFileToGroup=new HashMap<AntBuildFile,KeymapGroup>();
  final List<KeymapGroup> result=new ArrayList<KeymapGroup>();
  final ActionManagerEx actionManager=ActionManagerEx.getInstanceEx();
  String[] ids=actionManager.getActionIds(project != null ? AntConfiguration.getActionIdPrefix(project) : AntConfiguration.ACTION_ID_PREFIX);
  Arrays.sort(ids);
  if (project != null) {
    final AntConfiguration antConfiguration=AntConfiguration.getInstance(project);
    if (antConfiguration != null) {
      for (      final String id : ids) {
        if (filtered != null && !filtered.value(actionManager.getActionOrStub(id)))         continue;
        final AntBuildFile buildFile=antConfiguration.findBuildFileByActionId(id);
        if (buildFile == null) {
          LOG.info("no buildfile found for actionId=" + id);
          continue;
        }
        KeymapGroup subGroup=buildFileToGroup.get(buildFile);
        if (subGroup == null) {
          subGroup=KeymapGroupFactory.getInstance().createGroup(buildFile.getPresentableName());
          buildFileToGroup.put(buildFile,subGroup);
          result.add(subGroup);
        }
        subGroup.addActionId(id);
      }
    }
  }
  return result;
}
