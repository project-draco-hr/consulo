{
  if (isPopupShowing())   return;
  myPopupToolbar=new ActionToolbarImpl(myPlace,myActionGroup,true,myDataManager,myActionManager,myKeymapManager){
    public void actionPerformed(    final ActionButton button){
      hidePopup();
    }
    public void mouseExited(    final MouseEvent e){
      if (isPopupShowing()) {
        final Point mouse=new RelativePoint(e).getScreenPoint();
        final Point toolbar=myPopupToolbar.getLocationOnScreen();
        if (!new Rectangle(toolbar,myPopupToolbar.getSize()).contains(mouse)) {
          hidePopup();
        }
      }
    }
  }
;
  myPopupToolbar.setLayoutPolicy(ActionToolbar.NOWRAP_LAYOUT_POLICY);
  final Point location=getLocationOnScreen();
  final ComponentPopupBuilder builder=JBPopupFactory.getInstance().createComponentPopupBuilder(myPopupToolbar,null);
  builder.setResizable(false).setRequestFocus(false).setTitle(null).setCancelOnClickOutside(true).setCancelCallback(new Computable<Boolean>(){
    public Boolean compute(){
      try {
        myCancellingNow=true;
        hidePopup();
        return Boolean.TRUE;
      }
  finally {
        myCancellingNow=false;
      }
    }
  }
);
  myPopup=builder.createPopup();
  myPopup.showInScreenCoordinates(this,location);
}
