{
  if (calculateByDefaultIfNotLaidOutYet())   return;
  final int componentCount=getComponentCount();
  LOG.assertTrue(componentCount <= myComponentBounds.size());
  if (myAdjustTheSameSize) {
    if (myOrientation == SwingConstants.HORIZONTAL) {
      final int maxWidth=getMaxButtonWidth();
      final int maxHeight=getMaxButtonHeight();
      int xOffset=0;
      int yOffset=0;
      final int maxRowWidth=Math.max(getWidth(),componentCount * maxWidth / 3);
      for (int i=0; i < componentCount; i++) {
        if (xOffset + maxWidth > maxRowWidth) {
          xOffset=0;
          yOffset+=maxHeight;
        }
        final Rectangle bounds=myComponentBounds.get(i);
        bounds.setBounds(xOffset,maxWidth,yOffset,maxHeight);
        xOffset+=maxWidth;
      }
    }
 else {
      final int maxWidth=getMaxButtonWidth();
      final int maxHeight=getMaxButtonHeight();
      int xOffset=0;
      int yOffset=0;
      final int maxRowHeight=Math.max(getHeight(),componentCount * myMinimumButtonSize.height / 3);
      for (int i=0; i < componentCount; i++) {
        if (yOffset + maxHeight > maxRowHeight) {
          yOffset=0;
          xOffset+=maxWidth;
        }
        final Rectangle bounds=myComponentBounds.get(i);
        bounds.setBounds(xOffset,maxWidth,yOffset,maxHeight);
        yOffset+=maxHeight;
      }
    }
  }
 else {
    if (myOrientation == SwingConstants.HORIZONTAL) {
      int rowHeight=0;
      final Dimension[] dims=new Dimension[componentCount];
      for (int i=0; i < componentCount; i++) {
        dims[i]=getComponent(i).getPreferredSize();
        final int height=dims[i].height;
        rowHeight=Math.max(rowHeight,height);
      }
      int xOffset=0;
      int yOffset=0;
      final int maxRowWidth=Math.max(getWidth(),componentCount * myMinimumButtonSize.width / 3);
      for (int i=0; i < componentCount; i++) {
        final Dimension d=dims[i];
        if (xOffset + d.width > maxRowWidth) {
          xOffset=0;
          yOffset+=rowHeight;
        }
        final Rectangle bounds=myComponentBounds.get(i);
        bounds.setBounds(xOffset,yOffset + (rowHeight - d.height) / 2,d.width,d.height);
        xOffset+=d.width;
      }
    }
 else {
      int rowWidth=0;
      final Dimension[] dims=new Dimension[componentCount];
      for (int i=0; i < componentCount; i++) {
        dims[i]=getComponent(i).getPreferredSize();
        final int width=dims[i].width;
        rowWidth=Math.max(rowWidth,width);
      }
      int xOffset=0;
      int yOffset=0;
      final int maxRowHeight=Math.max(getHeight(),componentCount * myMinimumButtonSize.height / 3);
      for (int i=0; i < componentCount; i++) {
        final Dimension d=dims[i];
        if (yOffset + d.height > maxRowHeight) {
          yOffset=0;
          xOffset+=rowWidth;
        }
        final Rectangle bounds=myComponentBounds.get(i);
        bounds.setBounds(xOffset + (rowWidth - d.width) / 2,yOffset,d.width,d.height);
        yOffset+=d.height;
      }
    }
  }
}
