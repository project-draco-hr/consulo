{
  if (calculateByDefaultIfNotLaidOutYet())   return;
  final int componentCount=getComponentCount();
  LOG.assertTrue(componentCount <= myComponentBounds.size());
  myAutoPopupRec=null;
  final int maxWidth=getMaxButtonWidth();
  final int maxHeight=getMaxButtonHeight();
  final Dimension size=getSize();
  int autoButtonSize=myAutoPopupIcon.getIconWidth();
  boolean full=false;
  if (myAdjustTheSameSize) {
  }
 else {
    if (myOrientation == SwingConstants.HORIZONTAL) {
      int eachX=0;
      int eachY=0;
      for (int i=0; i < componentCount; i++) {
        final Rectangle eachBound=new Rectangle(getComponent(i).getPreferredSize());
        if (!full) {
          boolean outside;
          if (i < componentCount - 1) {
            outside=eachX + eachBound.width + autoButtonSize < size.width;
          }
 else {
            outside=eachX + eachBound.width < size.width;
          }
          if (outside) {
            eachBound.x=eachX;
            eachBound.y=eachY;
            eachX+=eachBound.width;
          }
 else {
            full=true;
          }
        }
        if (full) {
          if (myAutoPopupRec == null) {
            myAutoPopupRec=new Rectangle(eachX,eachY,size.width - eachX - 1,size.height - 1);
            myFirstOusideIndex=i;
          }
          eachBound.x=-1;
          eachBound.y=-1;
          eachBound.width=0;
          eachBound.height=0;
        }
        myComponentBounds.get(i).setBounds(eachBound);
      }
    }
 else {
      int eachX=0;
      int eachY=0;
      for (int i=0; i < componentCount; i++) {
        final Rectangle eachBound=new Rectangle(getComponent(i).getPreferredSize());
        if (!full) {
          boolean outside;
          if (i < componentCount - 1) {
            outside=eachY + eachBound.height + autoButtonSize < size.height;
          }
 else {
            outside=eachY + eachBound.height < size.height;
          }
          if (outside) {
            eachBound.x=eachX;
            eachBound.y=eachY;
            eachY+=eachBound.height;
          }
 else {
            full=true;
          }
        }
        if (full) {
          if (myAutoPopupRec == null) {
            myAutoPopupRec=new Rectangle(eachX,eachY,size.width - 1,size.height - eachY - 1);
            myFirstOusideIndex=i;
          }
          eachBound.x=-1;
          eachBound.y=-1;
          eachBound.width=0;
          eachBound.height=0;
        }
        myComponentBounds.get(i).setBounds(eachBound);
      }
    }
  }
}
