{
  createReadChangesCache();
  final Collection<Change> result=new ArrayList<Change>();
  myChangesBeforeUpdate=new OpenTHashSet<Change>(myChanges);
  final FileIndexFacade fileIndex=PeriodicalTasksCloser.getInstance().safeGetService(project,FileIndexFacade.class);
  for (  Change oldBoy : myChangesBeforeUpdate) {
    final ContentRevision before=oldBoy.getBeforeRevision();
    final ContentRevision after=oldBoy.getAfterRevision();
    if (scope == null || before != null && scope.belongsTo(before.getFile()) || after != null && scope.belongsTo(after.getFile()) || isIgnoredChange(oldBoy,fileIndex)) {
      result.add(oldBoy);
      if (ChangeListManagerImpl.DEBUG) {
        System.out.println("LocalChangeListImpl.startProcessingChanges, remove old change: this = " + this + ", change = "+ oldBoy);
      }
      myChanges.remove(oldBoy);
      myReadChangesCache=null;
    }
  }
  return result;
}
