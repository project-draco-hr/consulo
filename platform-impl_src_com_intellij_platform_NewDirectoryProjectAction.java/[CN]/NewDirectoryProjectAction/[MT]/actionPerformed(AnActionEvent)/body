{
  Project project=e.getData(PlatformDataKeys.PROJECT);
  NewDirectoryProjectDialog dlg=new NewDirectoryProjectDialog(project);
  dlg.show();
  if (dlg.getExitCode() != DialogWrapper.OK_EXIT_CODE)   return;
  final File location=new File(dlg.getNewProjectLocation());
  if (!location.exists() && !location.mkdirs()) {
    Messages.showErrorDialog(project,"Cannot create directory '" + location + "'","Create Project");
    return;
  }
  GeneralSettings.getInstance().setLastProjectLocation(location.getParent());
  VirtualFile f=ApplicationManager.getApplication().runWriteAction(new Computable<VirtualFile>(){
    public VirtualFile compute(){
      return LocalFileSystem.getInstance().refreshAndFindFileByIoFile(location);
    }
  }
);
  PlatformProjectOpenProcessor.getInstance().doOpenProject(f,null,false);
}
