{
  final VirtualFile file=descriptor.getFile();
  Editor editor=myVirtualFile2Editor.get(file);
  if (debug) {
    System.err.println("Got " + editor + " as editor from cache for "+ file);
  }
  if (editor == null) {
    PsiFile psiFile=PsiManager.getInstance(myProject).findFile(file);
    LOG.assertTrue(psiFile != null,file);
    Document document=PsiDocumentManager.getInstance(myProject).getDocument(psiFile);
    LOG.assertTrue(document != null,psiFile);
    editor=EditorFactory.getInstance().createEditor(document,myProject);
    final EditorHighlighter highlighter=HighlighterFactory.createHighlighter(myProject,file);
    if (debug) {
      System.err.println("highlighter " + highlighter);
    }
    ((EditorEx)editor).setHighlighter(highlighter);
    ((EditorEx)editor).setFile(file);
    myVirtualFile2Editor.put(file,editor);
  }
  if (descriptor.getOffset() >= 0) {
    editor.getCaretModel().moveToOffset(descriptor.getOffset());
  }
 else   if (descriptor.getLine() >= 0 && descriptor.getColumn() >= 0) {
    editor.getCaretModel().moveToLogicalPosition(new LogicalPosition(descriptor.getLine(),descriptor.getColumn()));
  }
  editor.getSelectionModel().removeSelection();
  myActiveFile=file;
  return editor;
}
