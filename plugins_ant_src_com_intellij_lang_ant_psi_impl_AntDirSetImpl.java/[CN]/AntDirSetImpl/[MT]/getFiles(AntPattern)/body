{
  final File singleFile=getCanonicalFile(computeAttributeValue(getSourceElement().getAttributeValue("file")));
  if (singleFile == null || pattern.hasIncludePatterns()) {
    final File root=getCanonicalFile(computeAttributeValue(getSourceElement().getAttributeValue("dir")));
    if (root != null) {
      final ArrayList<File> files=new ArrayList<File>();
      if (singleFile != null && singleFile.isDirectory()) {
        files.add(singleFile);
      }
      new FilesCollector().collectFiles(files,root,"",pattern);
      return files;
    }
  }
  if (singleFile != null && singleFile.isDirectory()) {
    Collections.singletonList(singleFile);
  }
  return Collections.emptyList();
}
