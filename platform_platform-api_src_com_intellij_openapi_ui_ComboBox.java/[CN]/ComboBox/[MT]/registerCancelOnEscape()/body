{
  registerKeyboardAction(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      final DialogWrapper dialogWrapper=DialogWrapper.findInstance(ComboBox.this);
      if (isPopupVisible()) {
        setPopupVisible(false);
      }
 else {
        final Object clientProperty=getClientProperty("tableCellEditor");
        if (clientProperty instanceof CellEditor) {
          ((CellEditor)clientProperty).cancelCellEditing();
        }
 else         if (dialogWrapper != null) {
          dialogWrapper.doCancelAction();
        }
      }
    }
  }
,KeyStroke.getKeyStroke(KeyEvent.VK_ESCAPE,0),WHEN_ANCESTOR_OF_FOCUSED_COMPONENT);
}
