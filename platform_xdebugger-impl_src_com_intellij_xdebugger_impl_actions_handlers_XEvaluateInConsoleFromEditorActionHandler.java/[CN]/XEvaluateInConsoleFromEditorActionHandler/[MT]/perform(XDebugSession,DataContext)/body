{
  Editor editor=CommonDataKeys.EDITOR.getData(dataContext);
  if (editor == null || !(editor instanceof EditorEx)) {
    return;
  }
  int selectionStart=editor.getSelectionModel().getSelectionStart();
  int selectionEnd=editor.getSelectionModel().getSelectionEnd();
  String text;
  TextRange range;
  if (selectionStart != selectionEnd) {
    range=new TextRange(selectionStart,selectionEnd);
    text=editor.getDocument().getText(range);
  }
 else {
    XDebuggerEvaluator evaluator=session.getDebugProcess().getEvaluator();
    if (evaluator != null) {
      ExpressionInfo expressionInfo=evaluator.getExpressionInfoAtOffset(session.getProject(),editor.getDocument(),selectionStart,true);
      if (expressionInfo == null) {
        return;
      }
      range=expressionInfo.getTextRange();
      text=XDebuggerEvaluateActionHandler.getExpressionText(expressionInfo,editor.getDocument());
    }
 else {
      return;
    }
  }
  if (StringUtil.isEmptyOrSpaces(text)) {
    return;
  }
  ConsoleExecuteAction action=getConsoleExecuteAction(session);
  if (action != null) {
    action.execute(range,text,(EditorEx)editor);
  }
}
