{
  Presentation presentation=getPresentation(action);
  AnActionEvent event=new AnActionEvent(null,myDataContext,ActionPlaces.UNKNOWN,presentation,ActionManager.getInstance(),0);
  ActionUtil.performDumbAwareUpdate(action,event,true);
  if ((myShowDisabled || presentation.isEnabled()) && presentation.isVisible()) {
    String text=presentation.getText();
    if (myShowNumbers) {
      if (myCurrentNumber < 9) {
        text="&" + (myCurrentNumber + 1) + ". "+ text;
      }
 else       if (myCurrentNumber == 9) {
        text="&" + 0 + ". "+ text;
      }
 else       if (myUseAlphaAsNumbers) {
        text="&" + (char)('A' + myCurrentNumber - 10) + ". "+ text;
      }
      myCurrentNumber++;
    }
 else     if (myHonorActionMnemonics) {
      text=Presentation.restoreTextWithMnemonic(text,action.getTemplatePresentation().getMnemonic());
    }
    Icon icon=presentation.getIcon();
    if (icon == null) {
      @NonNls final String actionId=ActionManager.getInstance().getId(action);
      icon=actionId != null && actionId.startsWith("QuickList.") ? QUICK_LIST_ICON : myEmptyIcon;
    }
    boolean prependSeparator=!myListModel.isEmpty() && myPrependWithSeparator;
    myListModel.add(new ActionItem(action,text,presentation.isEnabled(),icon,prependSeparator,mySeparatorText));
    myPrependWithSeparator=false;
    mySeparatorText=null;
  }
}
