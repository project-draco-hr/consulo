{
  if (!JavaPsiFacade.getInstance(myManager.getProject()).getNameHelper().isIdentifier(name)) {
    throw new IncorrectOperationException("\"" + name + "\" is not an identifier.");
  }
  if (PsiType.NULL.equals(type)) {
    throw new IncorrectOperationException("Cannot create variable with type \"null\".");
  }
  final StringBuilder builder=StringBuilderSpinAllocator.alloc();
  builder.append("X ").append(name);
  if (initializer != null) {
    builder.append(" = x");
  }
  builder.append(';');
  final String text=builder.toString();
  StringBuilderSpinAllocator.dispose(builder);
  final PsiDeclarationStatement statement=(PsiDeclarationStatement)createStatementFromText(text,null);
  final PsiVariable variable=(PsiVariable)statement.getDeclaredElements()[0];
  replace(variable.getTypeElement(),createTypeElement(type),text);
  PsiUtil.setModifierProperty(variable,PsiModifier.FINAL,JavaCodeStyleSettingsFacade.getInstance(myManager.getProject()).isGenerateFinalLocals());
  if (initializer != null) {
    replace(variable.getInitializer(),initializer,text);
  }
  GeneratedMarkerVisitor.markGenerated(statement);
  return statement;
}
