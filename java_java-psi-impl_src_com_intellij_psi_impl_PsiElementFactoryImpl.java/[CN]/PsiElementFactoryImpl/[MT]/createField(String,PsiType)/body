{
  PsiUtil.checkIsIdentifier(myManager,name);
  if (PsiType.NULL.equals(type)) {
    throw new IncorrectOperationException("Cannot create field with type \"null\".");
  }
  final String text="class _Dummy_ { private " + type.getCanonicalText() + " "+ name+ "; }";
  final PsiJavaFile aFile=createDummyJavaFile(text);
  final PsiClass[] classes=aFile.getClasses();
  if (classes.length < 1) {
    throw new IncorrectOperationException("Class was not created " + text);
  }
  final PsiClass psiClass=classes[0];
  final PsiField[] fields=psiClass.getFields();
  if (fields.length < 1) {
    throw new IncorrectOperationException("Field was not created " + text);
  }
  PsiField field=fields[0];
  field=(PsiField)JavaCodeStyleManager.getInstance(myManager.getProject()).shortenClassReferences(field);
  return (PsiField)CodeStyleManager.getInstance(myManager.getProject()).reformat(field);
}
