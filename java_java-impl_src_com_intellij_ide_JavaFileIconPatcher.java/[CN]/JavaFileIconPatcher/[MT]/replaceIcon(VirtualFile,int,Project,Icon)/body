{
  FileType fileType=FileTypeManager.getInstance().getFileTypeByFile(file);
  if (fileType == StdFileTypes.JAVA && !FileIndexUtil.isJavaSourceFile(project,file)) {
    return Icons.JAVA_OUTSIDE_SOURCE_ICON;
  }
  PsiFile psiFile=PsiManager.getInstance(project).findFile(file);
  if (psiFile instanceof PsiClassOwner) {
    PsiClass[] classes=((PsiClassOwner)psiFile).getClasses();
    if (classes.length > 0) {
      final String fileName=file.getNameWithoutExtension();
      for (      PsiClass aClass : classes) {
        if (Comparing.strEqual(aClass.getName(),fileName)) {
          return aClass.getIcon(flags);
        }
      }
      final PsiClass lastClass=classes[classes.length - 1];
      if (!(lastClass instanceof SyntheticElement)) {
        return lastClass.getIcon(flags);
      }
    }
  }
  return baseIcon;
}
