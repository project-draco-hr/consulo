{
  Runnable proceedRunnable=new Runnable(){
    public void run(){
      FileDocumentManager.getInstance().saveAllDocuments();
      for (      CheckinHandler handler : myHandlers) {
        final CheckinHandler.ReturnResult result=handler.beforeCheckin(executor);
        if (result == CheckinHandler.ReturnResult.COMMIT)         continue;
        if (result == CheckinHandler.ReturnResult.CANCEL)         return;
        if (result == CheckinHandler.ReturnResult.CLOSE_WINDOW) {
          final ChangeList changeList=myBrowser.getSelectedChangeList();
          CommitHelper.moveToFailedList(changeList,getCommitMessage(),getIncludedChanges(),VcsBundle.message("commit.dialog.rejected.commit.template",changeList.getName()),myProject);
          doCancelAction();
          return;
        }
      }
      okAction.run();
    }
  }
;
  AbstractVcsHelper.getInstance(myProject).optimizeImportsAndReformatCode(getVirtualFiles(),VcsConfiguration.getInstance(myProject),proceedRunnable,true);
}
