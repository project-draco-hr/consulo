{
  myNewVisibleActions.clear();
  final DataContext dataContext=((DataManagerImpl)myDataManager).getDataContextTest(this);
  expandActionGroup(dataContext,myNewVisibleActions,myActionManager);
  if (!myNewVisibleActions.equals(myVisibleActions)) {
    final boolean changeBarVisibility=myNewVisibleActions.size() == 0 || myVisibleActions.size() == 0;
    final ArrayList temp=myVisibleActions;
    myVisibleActions=myNewVisibleActions;
    myNewVisibleActions=temp;
    removeAll();
    Color background=null;
    for (int i=0; i < myVisibleActions.size(); i++) {
      final AnAction action=(AnAction)myVisibleActions.get(i);
      final ActionMenu menu=new ActionMenu(null,ActionPlaces.MAIN_MENU,(ActionGroup)action,myPresentationFactory);
      add(menu);
      background=menu.getBackground();
    }
    if (background != null) {
      setBackground(background);
    }
    updateMnemonicsVisibility();
    validate();
    if (changeBarVisibility) {
      invalidate();
      final JFrame frame=(JFrame)SwingUtilities.getAncestorOfClass(JFrame.class,this);
      if (frame != null) {
        frame.validate();
      }
    }
  }
}
