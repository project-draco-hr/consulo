def _exthook(ui, repo, name, cmd, args, throw):
    ui.note((_('running hook %s: %s\n') % (name, cmd)))
    env = {}
    for (k, v) in args.iteritems():
        if hasattr(v, '__call__'):
            v = v()
        env[('HG_' + k.upper())] = v
    if repo:
        cwd = repo.root
    else:
        cwd = os.getcwd()
    r = util.system(cmd, environ=env, cwd=cwd)
    if r:
        (desc, r) = util.explain_exit(r)
        if throw:
            raise util.Abort((_('%s hook %s') % (name, desc)))
        ui.warn((_('warning: %s hook %s\n') % (name, desc)))
    return r
