{
  insideGettingRoots=true;
  final Set<VirtualFile> roots=new THashSet<VirtualFile>();
  final Module[] modules=ModuleManager.getInstance(project).getModules();
  for (  Module module : modules) {
    final ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(module);
    final OrderEntry[] orderEntries=moduleRootManager.getOrderEntries();
    for (    OrderEntry entry : orderEntries) {
      ContainerUtil.addAll(roots,entry.getFiles(OrderRootType.CLASSES));
      ContainerUtil.addAll(roots,entry.getFiles(OrderRootType.SOURCES));
      ContainerUtil.addAll(roots,entry.getFiles(OrderRootType.CLASSES_AND_OUTPUT));
    }
  }
  insideGettingRoots=false;
  return VfsUtil.toVirtualFileArray(roots);
}
