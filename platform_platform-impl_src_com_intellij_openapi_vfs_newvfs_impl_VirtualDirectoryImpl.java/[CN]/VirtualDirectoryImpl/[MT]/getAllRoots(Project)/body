{
  insideGettingRoots=true;
  Set<VirtualFile> roots=new THashSet<VirtualFile>();
  final Module[] modules=ModuleManager.getInstance(project).getModules();
  for (  Module module : modules) {
    final ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(module);
    final OrderEntry[] orderEntries=moduleRootManager.getOrderEntries();
    for (    OrderEntry entry : orderEntries) {
      VirtualFile[] files=entry.getFiles(OrderRootType.CLASSES);
      ContainerUtil.addAll(roots,files);
      files=entry.getFiles(OrderRootType.SOURCES);
      ContainerUtil.addAll(roots,files);
      files=entry.getFiles(OrderRootType.CLASSES_AND_OUTPUT);
      ContainerUtil.addAll(roots,files);
    }
  }
  insideGettingRoots=false;
  return VfsUtil.toVirtualFileArray(roots);
}
