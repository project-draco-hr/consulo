{
  final VirtualFileSystemEntry child;
  final NewVirtualFileSystem fs=getFileSystem();
  final int attributes=ourPersistence.getFileAttributes(id);
  if (PersistentFS.isDirectory(attributes)) {
    child=new VirtualDirectoryImpl(name,this,fs,id,attributes);
  }
 else {
    child=new VirtualFileImpl(name,this,id,attributes);
    assertAccessInTests(child);
  }
  if (fs.markNewFilesAsDirty()) {
    child.markDirty();
  }
  return child;
}
