{
  if (myChildren instanceof VirtualFileSystemEntry[]) {
    return (VirtualFileSystemEntry[])myChildren;
  }
  Pair<String[],int[]> pair=PersistentFS.listAll(this);
  final int[] childrenIds=pair.second;
  VirtualFileSystemEntry[] children;
  if (childrenIds.length == 0) {
    children=EMPTY_ARRAY;
  }
 else {
    children=new VirtualFileSystemEntry[childrenIds.length];
    String[] names=pair.first;
    final Map<String,VirtualFileSystemEntry> map=asMap();
    for (int i=0; i < children.length; i++) {
      final int childId=childrenIds[i];
      final String name=names[i];
      VirtualFileSystemEntry child=map != null ? map.get(name) : null;
      children[i]=child != null && child != NULL_VIRTUAL_FILE ? child : createChild(name,childId);
    }
  }
  if (getId() > 0) {
    myChildren=children;
  }
  return children;
}
