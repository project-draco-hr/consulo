{
  VirtualFileSystemEntry result=doFindChild(name,ensureCanonicalName,delegate);
  if (result == NULL_VIRTUAL_FILE) {
    return doRefresh ? createAndFindChildWithEventFire(name) : null;
  }
  if (result == null) {
synchronized (this) {
      Map<String,VirtualFileSystemEntry> map=asMap();
      if (map != null) {
        map.put(name,NULL_VIRTUAL_FILE);
      }
    }
  }
 else   if (doRefresh && delegate.isDirectory(result) != result.isDirectory()) {
    final RefreshSession session=RefreshQueue.getInstance().createSession(false,false,null);
    session.addFile(result);
    session.launch();
    result=doFindChild(name,ensureCanonicalName,delegate);
    if (result == NULL_VIRTUAL_FILE) {
      result=createAndFindChildWithEventFire(name);
    }
  }
  return result;
}
