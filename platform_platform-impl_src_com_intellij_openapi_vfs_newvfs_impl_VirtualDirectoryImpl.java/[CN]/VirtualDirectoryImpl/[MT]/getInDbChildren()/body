{
  VirtualFileSystemEntry[] children=asArray();
  if (children != null) {
    return Arrays.asList((VirtualFile[])children);
  }
  if (!ourPersistence.wereChildrenAccessed(this)) {
    return Collections.emptyList();
  }
  if (ourPersistence.areChildrenLoaded(this)) {
    return Arrays.asList(getChildren());
  }
  final String[] names=PersistentFS.listPersisted(this);
  NewVirtualFileSystem delegate=PersistentFS.replaceWithNativeFS(getFileSystem());
  for (  String name : names) {
    findChild(name,false,false,delegate);
  }
  return new ArrayList<VirtualFile>(ensureAsMap().values());
}
