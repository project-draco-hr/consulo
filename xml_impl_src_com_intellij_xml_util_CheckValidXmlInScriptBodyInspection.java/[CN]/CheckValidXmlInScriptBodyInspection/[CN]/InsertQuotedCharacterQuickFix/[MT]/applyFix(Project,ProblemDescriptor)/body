{
  if (!FileModificationService.getInstance().prepareFileForWrite(psiFile))   return;
  final TextRange range=psiElement.getTextRange();
  OpenFileDescriptor descriptor=new OpenFileDescriptor(project,psiFile.getVirtualFile(),range.getStartOffset() + startInElement);
  final Editor editor=FileEditorManager.getInstance(project).openTextEditor(descriptor,true);
  if (editor == null)   return;
  final String xmlCharacter=getXmlCharacter();
  String replacement=xmlCharacter.equals("&") ? AMP_ENTITY_REFERENCE : LT_ENTITY_REFERENCE;
  replacement=psiElement.getText().replace(xmlCharacter,replacement);
  editor.getDocument().replaceString(range.getStartOffset(),range.getEndOffset(),replacement);
}
