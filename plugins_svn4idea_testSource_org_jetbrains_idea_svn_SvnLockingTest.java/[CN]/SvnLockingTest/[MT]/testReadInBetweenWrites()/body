{
  final HangInWrite operation1=new HangInWrite("one1");
  final HangInWrite operation2=new HangInWrite("two1");
  final HangInRead read=new HangInRead("READ");
  final Thread thread1=new Thread(operation1);
  final Thread threadRead=new Thread(read);
  final Thread thread2=new Thread(operation2);
  try {
    thread1.start();
    waitForRunning(operation1);
    Assert.assertTrue(operation1.isRunning());
    threadRead.start();
    waitForRunning(read);
    Assert.assertFalse(read.isRunning());
    operation1.go();
    waitForRunning(read,20);
    Assert.assertTrue(read.isRunning());
    thread2.start();
    waitForRunning(operation2);
    Assert.assertFalse(operation2.isRunning());
    read.go();
    waitForRunning(operation2);
    Assert.assertTrue(operation2.isRunning());
    Thread.sleep(100);
  }
  finally {
    myLocks.dispose();
    operation1.stop();
    operation2.stop();
    Thread.sleep(100);
    thread1.interrupt();
    thread2.interrupt();
    threadRead.interrupt();
  }
}
