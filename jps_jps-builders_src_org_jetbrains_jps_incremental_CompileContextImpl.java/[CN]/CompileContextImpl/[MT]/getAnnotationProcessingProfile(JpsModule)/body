{
  final CompilerConfiguration compilerConfig=getProjectDescriptor().project.getCompilerConfiguration();
  Map<JpsModule,AnnotationProcessingProfile> map=myAnnotationProcessingProfileMap;
  if (map == null) {
    map=new HashMap<JpsModule,AnnotationProcessingProfile>();
    final Map<String,JpsModule> namesMap=new HashMap<String,JpsModule>();
    for (    JpsModule m : getProjectDescriptor().jpsProject.getModules()) {
      namesMap.put(m.getName(),m);
    }
    if (!namesMap.isEmpty()) {
      for (      AnnotationProcessingProfile profile : compilerConfig.getModuleAnnotationProcessingProfiles()) {
        for (        String name : profile.getProcessModule()) {
          final JpsModule mod=namesMap.get(name);
          if (mod != null) {
            map.put(mod,profile);
          }
        }
      }
    }
    myAnnotationProcessingProfileMap=map;
  }
  final AnnotationProcessingProfile profile=map.get(module);
  return profile != null ? profile : compilerConfig.getDefaultAnnotationProcessingProfile();
}
