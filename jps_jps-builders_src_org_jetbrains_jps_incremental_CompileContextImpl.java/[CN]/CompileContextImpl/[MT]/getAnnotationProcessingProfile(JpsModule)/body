{
  final JpsJavaCompilerConfiguration compilerConfig=JpsJavaExtensionService.getInstance().getOrCreateCompilerConfiguration(getProjectDescriptor().getProject());
  Map<JpsModule,ProcessorConfigProfile> map=myAnnotationProcessingProfileMap;
  if (map == null) {
    map=new HashMap<JpsModule,ProcessorConfigProfile>();
    final Map<String,JpsModule> namesMap=new HashMap<String,JpsModule>();
    for (    JpsModule m : getProjectDescriptor().getProject().getModules()) {
      namesMap.put(m.getName(),m);
    }
    if (!namesMap.isEmpty()) {
      for (      ProcessorConfigProfile profile : compilerConfig.getAnnotationProcessingConfigurations()) {
        for (        String name : profile.getModuleNames()) {
          final JpsModule mod=namesMap.get(name);
          if (mod != null) {
            map.put(mod,profile);
          }
        }
      }
    }
    myAnnotationProcessingProfileMap=map;
  }
  final ProcessorConfigProfile profile=map.get(module);
  return profile != null ? profile : compilerConfig.getDefaultAnnotationProcessingConfiguration();
}
