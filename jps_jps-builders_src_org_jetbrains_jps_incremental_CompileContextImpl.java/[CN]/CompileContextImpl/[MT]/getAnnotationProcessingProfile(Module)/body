{
  final CompilerConfiguration compilerConfig=getProjectDescriptor().project.getCompilerConfiguration();
  Map<Module,AnnotationProcessingProfile> map=myAnnotationProcessingProfileMap;
  if (map == null) {
    map=new HashMap<Module,AnnotationProcessingProfile>();
    final Map<String,Module> namesMap=new HashMap<String,Module>();
    for (    Module m : getProjectDescriptor().project.getModules().values()) {
      namesMap.put(m.getName(),m);
    }
    if (!namesMap.isEmpty()) {
      for (      AnnotationProcessingProfile profile : compilerConfig.getModuleAnnotationProcessingProfiles()) {
        for (        String name : profile.getProcessModule()) {
          final Module mod=namesMap.get(name);
          if (mod != null) {
            map.put(mod,profile);
          }
        }
      }
    }
    myAnnotationProcessingProfileMap=map;
  }
  final AnnotationProcessingProfile profile=map.get(module);
  return profile != null ? profile : compilerConfig.getDefaultAnnotationProcessingProfile();
}
