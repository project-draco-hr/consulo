{
  if (converter instanceof PsiReferenceConverter) {
    return ((PsiReferenceConverter)converter).createReferences(psiElement,true);
  }
  final boolean isResolvingConverter=converter instanceof ResolvingConverter;
  final DomInvocationHandler invocationHandler=getInvocationHandler(domValue);
  final Class clazz=DomUtil.getGenericValueParameter(invocationHandler.getDomElementType());
  if (clazz == null)   return PsiReference.EMPTY_ARRAY;
  if (ReflectionCache.isAssignable(PsiType.class,clazz)) {
    return new PsiReference[]{new PsiTypeReference((GenericDomValue<PsiType>)domValue)};
  }
  if (ReflectionCache.isAssignable(PsiClass.class,clazz)) {
    ExtendClass extendClass=invocationHandler.getAnnotation(ExtendClass.class);
    JavaClassReferenceProvider provider;
    if (extendClass == null) {
      provider=new JavaClassReferenceProvider();
    }
 else {
      provider=new JavaClassReferenceProvider(extendClass.value(),extendClass.instantiatable());
    }
    provider.setSoft(true);
    final PsiReference[] references=provider.getReferencesByElement(psiElement);
    return isResolvingConverter ? ArrayUtil.append(references,new GenericDomValueReference(domValue),PsiReference.class) : references;
  }
  if (!isResolvingConverter && ReflectionCache.isAssignable(Integer.class,clazz)) {
    return new PsiReference[]{new GenericDomValueReference<Integer>((GenericDomValue<Integer>)domValue){
      public Object[] getVariants(){
        return new Object[]{"0"};
      }
    }
};
  }
  if (!isResolvingConverter && ReflectionCache.isAssignable(String.class,clazz)) {
    return PsiReference.EMPTY_ARRAY;
  }
  PsiReferenceFactory provider=myProviders.get(clazz);
  if (provider != null) {
    return provider.getReferencesByElement(psiElement);
  }
  return new PsiReference[]{new GenericDomValueReference(domValue)};
}
