{
  if (!(psiElement instanceof XmlTag || psiElement instanceof XmlAttributeValue)) {
    return PsiReference.EMPTY_ARRAY;
  }
  PsiElement originalElement=psiElement.getUserData(PsiUtil.ORIGINAL_KEY);
  if (originalElement != null) {
    psiElement=originalElement;
  }
  final XmlTag tag=PsiTreeUtil.getParentOfType(psiElement,XmlTag.class,false);
  DomElement domElement=DomManager.getDomManager(psiElement.getManager().getProject()).getDomElement(tag);
  if (domElement == null) {
    return PsiReference.EMPTY_ARRAY;
  }
  if (psiElement instanceof XmlAttributeValue) {
    final XmlAttribute parent=(XmlAttribute)psiElement.getParent();
    final String name=parent.getLocalName();
    final DomAttributeChildDescription childDescription=domElement.getGenericInfo().getAttributeChildDescription(name);
    if (childDescription != null) {
      domElement=childDescription.getValues(domElement).get(0);
    }
  }
  if (!(domElement instanceof GenericDomValue)) {
    return PsiReference.EMPTY_ARRAY;
  }
  GenericDomValue domValue=(GenericDomValue)domElement;
  PsiReference[] references=createReference(domValue,psiElement);
  DomElement parent=domElement.getParent();
  GenericDomValue nameElement=parent.getGenericInfo().getNameDomElement(parent);
  if (nameElement != null && nameElement.getValue() instanceof String) {
    final XmlElement valueElement=DomUtil.getValueElement(nameElement);
    if (valueElement == psiElement || nameElement.getXmlTag() == psiElement) {
      PsiReference selfReference=XmlReference.createSelfReference((XmlElement)psiElement,valueElement);
      references=ArrayUtil.append(references,selfReference);
    }
  }
  return references;
}
