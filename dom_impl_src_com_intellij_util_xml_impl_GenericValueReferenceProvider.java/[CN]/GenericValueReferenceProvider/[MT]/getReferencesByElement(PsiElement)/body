{
  if (!(psiElement instanceof XmlTag || psiElement instanceof XmlAttributeValue)) {
    return PsiReference.EMPTY_ARRAY;
  }
  PsiElement originalElement=psiElement.getUserData(PsiUtil.ORIGINAL_KEY);
  if (originalElement != null) {
    psiElement=originalElement;
  }
  final XmlTag tag=PsiTreeUtil.getParentOfType(psiElement,XmlTag.class,false);
  DomElement domElement=DomManager.getDomManager(psiElement.getManager().getProject()).getDomElement(tag);
  if (domElement == null) {
    return PsiReference.EMPTY_ARRAY;
  }
  if (psiElement instanceof XmlAttributeValue) {
    final PsiElement parent=psiElement.getParent();
    if (parent instanceof XmlAttribute) {
      final XmlAttribute attribute=(XmlAttribute)parent;
      final String name=attribute.getLocalName();
      final DomAttributeChildDescription childDescription=domElement.getGenericInfo().getAttributeChildDescription(name);
      if (childDescription != null) {
        domElement=childDescription.getDomAttributeValue(domElement);
      }
    }
  }
  if (!(domElement instanceof GenericDomValue)) {
    return PsiReference.EMPTY_ARRAY;
  }
  GenericDomValue domValue=(GenericDomValue)domElement;
  final Converter converter=domValue.getConverter();
  PsiReference[] references=createReferences(domValue,(XmlElement)psiElement,converter);
  DomElement parent=domElement.getParent();
  if (references.length == 0) {
    final NameValue nameValue=domElement.getAnnotation(NameValue.class);
    if (nameValue != null && nameValue.referencable()) {
      references=ArrayUtil.append(references,PsiReferenceBase.createSelfReference(psiElement,parent.getXmlElement()),PsiReference.class);
    }
  }
  return references;
}
