{
  if (!(psiElement instanceof XmlTag || psiElement instanceof XmlAttributeValue))   return GenericReference.EMPTY_ARRAY;
  PsiElement originalElement=psiElement.getUserData(PsiUtil.ORIGINAL_KEY);
  if (originalElement != null) {
    psiElement=originalElement;
  }
  final XmlTag tag=PsiTreeUtil.getParentOfType(psiElement,XmlTag.class,false);
  final DomElement domElement=DomManager.getDomManager(psiElement.getManager().getProject()).getDomElement(tag);
  if (domElement == null)   return GenericReference.EMPTY_ARRAY;
  PsiReference[] reference=PsiReference.EMPTY_ARRAY;
  if (psiElement instanceof XmlAttributeValue) {
    final XmlAttributeValue value=(XmlAttributeValue)psiElement;
    final PsiElement parent=value.getParent();
    if (parent instanceof XmlAttribute) {
      final String name=((XmlAttribute)parent).getLocalName();
      final DomAttributeChildDescription childDescription=domElement.getGenericInfo().getAttributeChildDescription(name);
      if (childDescription != null) {
        reference=createReference(childDescription.getValues(domElement).get(0));
      }
    }
  }
 else {
    reference=createReference(domElement);
  }
  DomElement parent=(domElement instanceof GenericDomValue) ? domElement.getParent() : domElement;
  GenericDomValue nameElement=parent.getGenericInfo().getNameDomElement(parent);
  if (nameElement != null && nameElement.getValue() instanceof String) {
    final XmlElement valueElement=DomUtil.getValueElement(nameElement);
    if (valueElement == psiElement || nameElement.getXmlTag() == psiElement) {
      PsiReference selfReference=XmlReference.createSelfReference((XmlElement)psiElement,valueElement);
      reference=ArrayUtil.append(reference,selfReference);
    }
  }
  return reference;
}
