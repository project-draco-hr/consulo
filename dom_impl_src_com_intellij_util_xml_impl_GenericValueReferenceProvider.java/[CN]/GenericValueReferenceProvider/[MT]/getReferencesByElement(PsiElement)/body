{
  if (!(psiElement instanceof XmlTag || psiElement instanceof XmlAttributeValue))   return GenericReference.EMPTY_ARRAY;
  PsiElement originalElement=psiElement.getUserData(PsiUtil.ORIGINAL_KEY);
  if (originalElement != null) {
    psiElement=originalElement;
  }
  final XmlTag tag=PsiTreeUtil.getParentOfType(psiElement,XmlTag.class,false);
  final DomElement domElement=DomManager.getDomManager(psiElement.getManager().getProject()).getDomElement(tag);
  if (domElement == null)   return GenericReference.EMPTY_ARRAY;
  if (psiElement == domElement.getGenericInfo().getNameElement(domElement)) {
    return new PsiReference[]{XmlReference.createSelfReference((XmlElement)psiElement)};
  }
  if (psiElement instanceof XmlAttributeValue) {
    final XmlAttributeValue value=(XmlAttributeValue)psiElement;
    final PsiElement parent=value.getParent();
    if (parent instanceof XmlAttribute) {
      final String name=((XmlAttribute)parent).getLocalName();
      final DomAttributeChildDescription childDescription=domElement.getGenericInfo().getAttributeChildDescription(name);
      if (childDescription != null) {
        final PsiReference[] reference=createReference(childDescription.getValues(domElement).get(0));
        if (reference != null) {
          return reference;
        }
      }
    }
  }
 else {
    final PsiReference[] reference=createReference(domElement);
    if (reference != null) {
      return reference;
    }
  }
  return GenericReference.EMPTY_ARRAY;
}
