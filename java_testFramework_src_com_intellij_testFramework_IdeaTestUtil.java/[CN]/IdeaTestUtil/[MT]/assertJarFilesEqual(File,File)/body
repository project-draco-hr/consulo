{
  final JarFile jarFile1;
  final JarFile jarFile2;
  try {
    jarFile1=new JarFile(file1);
    jarFile2=new JarFile(file2);
  }
 catch (  IOException e) {
    String textAfter=String.valueOf(FileUtil.loadFileText(file1));
    String textBefore=String.valueOf(FileUtil.loadFileText(file2));
    textAfter=StringUtil.convertLineSeparators(textAfter);
    textBefore=StringUtil.convertLineSeparators(textBefore);
    Assert.assertEquals(textAfter,textBefore);
    return;
  }
  final File tempDirectory1=IdeaTestCase.createTempDir("tmp1");
  final File tempDirectory2=IdeaTestCase.createTempDir("tmp2");
  ZipUtil.extract(jarFile1,tempDirectory1,CVS_FILE_FILTER);
  ZipUtil.extract(jarFile2,tempDirectory2,CVS_FILE_FILTER);
  jarFile1.close();
  jarFile2.close();
  final VirtualFile dirAfter=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(tempDirectory1);
  final VirtualFile dirBefore=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(tempDirectory2);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      dirAfter.refresh(false,true);
      dirBefore.refresh(false,true);
    }
  }
);
  assertDirectoriesEqual(dirAfter,dirBefore,CVS_FILE_FILTER);
}
