{
  final Ref<Boolean> toContinue=Ref.create(true);
  final Processor<Result> wrapper=new Processor<Result>(){
    @Override public boolean process(    Result result){
      if (!toContinue.get()) {
        return false;
      }
      final boolean wantMore=consumer.process(result);
      toContinue.set(wantMore);
      return wantMore;
    }
  }
;
  final Runnable search=new Runnable(){
    public void run(){
      processQuery(queryParameters,wrapper);
    }
  }
;
  if (myRequireReadAction) {
    ApplicationManager.getApplication().runReadAction(search);
  }
 else {
    search.run();
  }
  return toContinue.get();
}
