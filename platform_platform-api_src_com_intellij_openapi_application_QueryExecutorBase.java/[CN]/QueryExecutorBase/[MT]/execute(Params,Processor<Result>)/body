{
  final AtomicBoolean toContinue=new AtomicBoolean(true);
  final Processor<Result> wrapper=new Processor<Result>(){
    @Override public boolean process(    Result result){
      if (!toContinue.get()) {
        return false;
      }
      if (!consumer.process(result)) {
        toContinue.set(false);
        return false;
      }
      return true;
    }
  }
;
  if (myRequireReadAction) {
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      public void run(){
        processQuery(queryParameters,wrapper);
      }
    }
);
  }
 else {
    processQuery(queryParameters,wrapper);
  }
  return toContinue.get();
}
