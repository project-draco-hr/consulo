{
  final AtomicBoolean toContinue=new AtomicBoolean(true);
  final Processor<Result> wrapper=new Processor<Result>(){
    @Override public boolean process(    Result result){
      if (!toContinue.get()) {
        return false;
      }
      if (!consumer.process(result)) {
        toContinue.set(false);
        return false;
      }
      return true;
    }
  }
;
  final Runnable search=new Runnable(){
    public void run(){
      processQuery(queryParameters,wrapper);
    }
  }
;
  if (myRequireReadAction) {
    ApplicationManager.getApplication().runReadAction(search);
  }
 else {
    search.run();
  }
  return toContinue.get();
}
