{
  validateRecentProjects();
  final Set<String> openedPaths=ContainerUtil.newHashSet();
  for (  Project openProject : ProjectManager.getInstance().getOpenProjects()) {
    ContainerUtil.addIfNotNull(openedPaths,getProjectPath(openProject));
  }
  final LinkedHashSet<String> paths;
synchronized (myState) {
    paths=ContainerUtil.newLinkedHashSet(myState.recentPaths);
  }
  paths.remove(null);
  paths.removeAll(openedPaths);
  ArrayList<AnAction> actions=new ArrayList<AnAction>();
  Set<String> duplicates=getDuplicateProjectNames(openedPaths,paths);
  for (  final String path : paths) {
    final String projectName=getProjectName(path);
    String displayName=myState.names.get(path);
    if (StringUtil.isEmptyOrSpaces(displayName)) {
      displayName=duplicates.contains(path) ? path : projectName;
    }
    actions.add(new ReopenProjectAction(path,projectName,displayName));
  }
  if (actions.isEmpty()) {
    return AnAction.EMPTY_ARRAY;
  }
  ArrayList<AnAction> list=new ArrayList<AnAction>();
  for (  AnAction action : actions) {
    list.add(action);
  }
  if (addClearListItem) {
    AnAction clearListAction=new AnAction(IdeBundle.message("action.clear.list")){
      public void actionPerformed(      AnActionEvent e){
        final int rc=Messages.showOkCancelDialog(e.getData(CommonDataKeys.PROJECT),"Would you like to clear the list of recent projects?","Clear Recent Projects List",Messages.getQuestionIcon());
        if (rc == 0) {
synchronized (myState) {
            myState.recentPaths.clear();
          }
          WelcomeFrame.clearRecents();
        }
      }
    }
;
    list.add(AnSeparator.getInstance());
    list.add(clearListAction);
  }
  return list.toArray(new AnAction[list.size()]);
}
