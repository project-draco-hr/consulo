{
  myProject=project;
  myVirtualFile=virtualFile;
  myErrorLabel.setIcon(ERROR_ICON);
  myUrlTextField.setText(virtualFile.getUrl());
  myProgressUpdatesQueue=new MergingUpdateQueue("downloading progress updates",300,false,myMainPanel);
  initToolbar(project);
  final RemoteFileInfo remoteFileInfo=virtualFile.getFileInfo();
  myDownloadingListener=new MyDownloadingListener();
  remoteFileInfo.addDownloadingListener(myDownloadingListener);
  myCancelButton.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      remoteFileInfo.cancelDownloading();
    }
  }
);
  myTryAgainButton.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      showCard(DOWNLOADING_CARD);
      remoteFileInfo.restartDownloading();
    }
  }
);
  myChangeProxySettingsButton.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      new HTTPProxySettingsDialog().show();
    }
  }
);
  showCard(DOWNLOADING_CARD);
  remoteFileInfo.startDownloading();
  if (remoteFileInfo.getState() == RemoteFileState.DOWNLOADED) {
    switchEditor();
  }
 else {
    String errorMessage=remoteFileInfo.getErrorMessage();
    if (errorMessage != null) {
      myDownloadingListener.errorOccurred(errorMessage);
    }
  }
}
