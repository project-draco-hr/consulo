{
  final CompositeBlockWrapper info=new CompositeBlockWrapper(rootBlock,myCurrentWhiteSpace,parent,textRange);
  if (index == 0) {
    info.arrangeParentTextRange();
  }
  myResult.put(rootBlock,info);
  Block previous=null;
  List<AbstractBlockWrapper> list=new ArrayList<AbstractBlockWrapper>();
  for (int i=0; i < subBlocks.size(); i++) {
    final Block block=subBlocks.get(i);
    if (previous != null) {
      myCurrentSpaceProperty=(SpacingImpl)rootBlock.getSpacing(previous,block);
    }
    final TextRange blockRange=block.getTextRange();
    if (i == subBlocks.size() - 1 && myRightBlocks.contains(rootBlock)) {
      myRightBlocks.add(subBlocks.get(subBlocks.size() - 1));
    }
    final AbstractBlockWrapper wrapper=buildFrom(block,i,info,currentWrapParent,blockRange);
    list.add(wrapper);
    final IndentImpl indent=(IndentImpl)block.getIndent();
    wrapper.setIndent(indent);
    previous=block;
  }
  setDefaultIndents(list);
  return info;
}
