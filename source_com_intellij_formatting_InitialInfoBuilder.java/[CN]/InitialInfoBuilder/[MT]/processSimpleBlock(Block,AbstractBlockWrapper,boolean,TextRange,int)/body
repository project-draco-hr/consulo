{
  final LeafBlockWrapper info=new LeafBlockWrapper(rootBlock,parent,myCurrentWhiteSpace,myModel,myPreviousBlock,readOnly,textRange);
  if (index == 0) {
    info.arrangeParentTextRange();
  }
  myResult.put(rootBlock,info);
  if (textRange.getLength() == 0) {
    assertInvalidRanges(textRange.getStartOffset(),textRange.getEndOffset(),myModel);
  }
  if (myPreviousBlock != null) {
    myPreviousBlock.setNextBlock(info);
  }
  if (myFirstTokenBlock == null) {
    myFirstTokenBlock=info;
  }
  myLastTokenBlock=info;
  if (currentWhiteSpaceIsRreadOnly()) {
    myCurrentWhiteSpace.setReadOnly(true);
  }
  if (myCurrentSpaceProperty != null) {
    myCurrentWhiteSpace.setIsSafe(myCurrentSpaceProperty.isSafe());
    myCurrentWhiteSpace.setKeepFirstColumn(myCurrentSpaceProperty.shouldKeepFirstColumn());
  }
  info.setSpaceProperty(myCurrentSpaceProperty);
  myCurrentWhiteSpace=new WhiteSpace(textRange.getEndOffset(),false);
  myPreviousBlock=info;
  return info;
}
