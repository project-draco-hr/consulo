{
  for (  GrTopStatement statement : getFile().getTopStatements()) {
    if (statement instanceof GrImportStatement) {
      getFile().addImportsFromString(importToString((GrImportStatement)statement));
    }
 else     if (statement instanceof GrMethod) {
      getFile().addVariable(((GrMethod)statement).getName(),generateClosure((GrMethod)statement));
    }
 else     if (statement instanceof GrAssignmentExpression) {
      GrAssignmentExpression assignment=(GrAssignmentExpression)statement;
      GrExpression left=assignment.getLValue();
      if (left instanceof GrReferenceExpression && !((GrReferenceExpression)left).isQualified()) {
        getFile().addVariable(((GrReferenceExpression)left).getReferenceName(),assignment.getRValue());
      }
    }
 else     if (statement instanceof GrTypeDefinition) {
      getFile().addTypeDefinition(prepareTypeDefinition((GrTypeDefinition)statement));
    }
  }
  PsiType scriptType=getFile().getInferredScriptReturnType();
  if (scriptType != null) {
    getFile().addVariable("_",scriptType);
  }
}
