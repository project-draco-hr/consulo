{
  String name=getTestName(false);
  try {
    String text=loadFile(name + "." + myExtension);
    myFile=createPsiFile(name,text);
    ensureParsed(myFile);
    FileViewProvider viewProvider=myFile.getViewProvider();
    VirtualFile virtualFile=viewProvider.getVirtualFile();
    if (virtualFile instanceof LightVirtualFile) {
      assertEquals("light virtual file text mismatch",text,((LightVirtualFile)virtualFile).getContent());
    }
    assertEquals("virtual file text mismatch",text,LoadTextUtil.loadText(virtualFile));
    assertEquals("doc text mismatch",text,viewProvider.getDocument().getText());
    assertEquals("psi text mismatch",text,myFile.getText());
    if (checkResult) {
      checkResult(name,myFile);
    }
 else {
      toParseTreeText(myFile,skipSpaces(),includeRanges());
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
