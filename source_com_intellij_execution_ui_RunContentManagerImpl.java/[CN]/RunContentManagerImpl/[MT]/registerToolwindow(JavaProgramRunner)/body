{
  final String toolWindowId=runner.getInfo().getToolWindowId();
  final ToolWindowManager toolWindowManager=ToolWindowManager.getInstance(myProject);
  if (toolWindowManager.getToolWindow(toolWindowId) != null) {
    return;
  }
  final ContentManager contentManager=PeerFactory.getInstance().getContentFactory().createContentManager(new TabbedPaneContentUI(),true,myProject);
class MyDataProvider extends JPanel implements DataProvider {
    private int myInsideGetData=0;
    MyDataProvider(){
      super(new BorderLayout());
      add(contentManager.getComponent());
    }
    public Object getData(    String dataId){
      myInsideGetData++;
      try {
        if (DataConstants.HELP_ID.equals(dataId)) {
          return runner.getInfo().getHelpId();
        }
 else {
          return myInsideGetData == 1 ? DataManager.getInstance().getDataContext(contentManager.getComponent()).getData(dataId) : null;
        }
      }
  finally {
        myInsideGetData--;
      }
    }
  }
  final ToolWindow toolWindow=toolWindowManager.registerToolWindow(toolWindowId,new MyDataProvider(),ToolWindowAnchor.BOTTOM);
  toolWindow.setIcon(runner.getInfo().getToolWindowIcon());
  new ContentManagerWatcher(toolWindow,contentManager);
  contentManager.addContentManagerListener(new ContentManagerAdapter(){
    public void selectionChanged(    final ContentManagerEvent event){
      final Content content=event.getContent();
      final RunContentDescriptor descriptor=content != null ? getRunContentDescriptorByContent(content) : null;
      myEventDispatcher.getMulticaster().contentSelected(descriptor,toolWindowId);
    }
  }
);
  ((ToolWindowManagerImpl)ToolWindowManager.getInstance(myProject)).addToolWindowManagerListener(new ToolWindowManagerAdapter(){
    public void stateChanged(){
    }
  }
);
  ListenerUtil.addFocusListener(contentManager.getComponent(),new FocusAdapter(){
    public void focusGained(    final FocusEvent e){
    }
  }
);
  myToolwindowIdToContentManagerMap.put(toolWindowId,contentManager);
  myToolwindowIdZbuffer.addLast(toolWindowId);
}
