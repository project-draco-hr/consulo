{
  CheckboxTree tree=new CheckboxTree(new CheckboxTree.CheckboxTreeCellRenderer(true){
    public void customizeRenderer(    JTree tree,    Object value,    boolean selected,    boolean expanded,    boolean leaf,    int row,    boolean hasFocus){
      if (!(value instanceof VirtualFileCheckedTreeNode))       return;
      VirtualFileCheckedTreeNode node=(VirtualFileCheckedTreeNode)value;
      VirtualFile file=node.getFile();
      String text;
      SimpleTextAttributes attributes;
      Icon icon;
      boolean isValid=true;
      if (leaf) {
        VirtualFile ancestor=((VirtualFileCheckedTreeNode)node.getParent()).getFile();
        if (ancestor != null) {
          text=VfsUtilCore.getRelativePath(file,ancestor,File.separatorChar);
        }
 else {
          text=file.getPresentableUrl();
        }
        if (text == null) {
          isValid=false;
          text=file.getPresentableUrl();
        }
        attributes=SimpleTextAttributes.REGULAR_ATTRIBUTES;
        icon=PlatformIcons.DIRECTORY_CLOSED_ICON;
      }
 else {
        text=file.getPresentableUrl();
        if (text == null) {
          isValid=false;
        }
        attributes=SimpleTextAttributes.REGULAR_BOLD_ATTRIBUTES;
        icon=expanded ? PlatformIcons.DIRECTORY_OPEN_ICON : PlatformIcons.DIRECTORY_CLOSED_ICON;
      }
      final ColoredTreeCellRenderer textRenderer=getTextRenderer();
      textRenderer.setIcon(icon);
      if (!isValid) {
        textRenderer.append("[INVALID] ",SimpleTextAttributes.ERROR_ATTRIBUTES);
      }
      if (text != null) {
        textRenderer.append(text,attributes);
      }
      final String rootType=node.getRootType();
      if (rootType != null) {
        textRenderer.append(" [" + rootType + "]",SimpleTextAttributes.GRAY_ATTRIBUTES);
      }
    }
  }
,myRootNode);
  tree.setRootVisible(false);
  TreeUtil.expandAll(tree);
  return tree;
}
