{
  PsiFile baseRootFile=getBaseRootFile(element);
  if (baseRootFile == null)   return null;
  PsiElement current=element;
  while (current != null) {
    if (current instanceof PsiFileSystemItem) {
      break;
    }
    if (isTopLevelClass(current,baseRootFile)) {
      break;
    }
    current=current.getParent();
  }
  if (current instanceof PsiClassOwner) {
    PsiClass[] classes=((PsiClassOwner)current).getClasses();
    if (classes.length > 0 && isTopLevelClass(classes[0],baseRootFile)) {
      current=classes[0];
    }
  }
  return current instanceof PsiClass ? current : baseRootFile;
}
