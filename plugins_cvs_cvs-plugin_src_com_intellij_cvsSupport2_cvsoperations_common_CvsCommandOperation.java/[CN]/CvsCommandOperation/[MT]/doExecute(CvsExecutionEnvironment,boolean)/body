{
  final VcsException[] exc=new VcsException[1];
  final Runnable action=new Runnable(){
    @Override public void run(){
      try {
        ReadWriteStatistics statistics=executionEnvironment.getReadWriteStatistics();
        Collection<CvsRootProvider> allCvsRoots;
        try {
          allCvsRoots=getAllCvsRoots();
        }
 catch (        CannotFindCvsRootException e) {
          throw createVcsExceptionOn(e,null);
        }
        for (        CvsRootProvider cvsRootProvider : allCvsRoots) {
          try {
            myLastProcessedCvsRoot=cvsRootProvider.getCvsRootAsString();
            execute(cvsRootProvider,executionEnvironment,statistics,executionEnvironment.getExecutor());
          }
 catch (          IOCommandException e) {
            LOG.info(e);
            throw createVcsExceptionOn(e.getIOException(),cvsRootProvider.getCvsRootAsString());
          }
catch (          CommandException e) {
            LOG.info(e);
            Exception underlyingException=e.getUnderlyingException();
            if (underlyingException != null) {
              LOG.info(underlyingException);
            }
            throw createVcsExceptionOn(underlyingException == null ? e : underlyingException,cvsRootProvider.getCvsRootAsString());
          }
        }
      }
 catch (      VcsException e) {
        exc[0]=e;
      }
    }
  }
;
  if (underReadAction) {
    ApplicationManager.getApplication().runReadAction(action);
  }
 else {
    action.run();
  }
  if (exc[0] != null)   throw exc[0];
}
