{
  HashMap<AbstractVcs,Collection<FilePath>> result=new HashMap<AbstractVcs,Collection<FilePath>>();
  for (  FilePath file : roots) {
    AbstractVcs vcs=VcsUtil.getVcsFor(project,file);
    if (vcs != null) {
      UpdateEnvironment updateEnvironment=myActionInfo.getEnvironment(vcs);
      if (updateEnvironment != null) {
        if (!result.containsKey(vcs))         result.put(vcs,new HashSet<FilePath>());
        result.get(vcs).add(file);
      }
    }
  }
  for (  final Collection<FilePath> filePaths : result.values()) {
    filterSubDirectories(filePaths);
  }
  return result;
}
