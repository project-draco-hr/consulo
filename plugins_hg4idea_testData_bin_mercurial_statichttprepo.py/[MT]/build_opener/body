def build_opener(ui, authinfo):
    urlopener = url.opener(ui, authinfo)
    urlopener.add_handler(byterange.HTTPRangeHandler())

    def opener(base):
        'return a function that opens files over http'
        p = base

        def o(path, mode='r', atomictemp=None):
            if (('a' in mode) or ('w' in mode)):
                raise IOError('Permission denied')
            f = '/'.join((p, urllib.quote(path)))
            return httprangereader(f, urlopener)
        return o
    return opener
