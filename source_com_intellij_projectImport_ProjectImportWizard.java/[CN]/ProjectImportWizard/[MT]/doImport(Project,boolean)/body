{
  final String title=getTitle();
  final String[] options=new String[]{IdeBundle.message("project.import.into.new.project"),IdeBundle.message("project.import.into.existing.project"),CommonBundle.getCancelButtonText()};
  int ret=currentProject == null ? 0 : Messages.showDialog(IdeBundle.message("project.import.destination"),title,options,0,Messages.getQuestionIcon());
  if (ret == 2 || ret == -1) {
    return;
  }
  final boolean updateCurrent=ret != 0;
  try {
    initImport(currentProject,updateCurrent);
    final AddModuleWizard dialog=new AddModuleWizard(title,getStepsFactory(currentProject,updateCurrent),!updateCurrent);
    dialog.show();
    if (!dialog.isOK()) {
      return;
    }
    myNewProjectFilePath=dialog.getNewProjectFilePath();
    myNewProjectJdk=dialog.getNewProjectJdk();
    myNewCompileOutput=dialog.getNewCompileOutput();
    final Project projectToUpdate=performImport(currentProject,updateCurrent,forceOpenInNewFrame);
    if (projectToUpdate == null) {
      return;
    }
    if (isOpenProjectSettingsAfter()) {
      SwingUtilities.invokeLater(new Runnable(){
        public void run(){
          ModulesConfigurator.showDialog(projectToUpdate,null,null,false);
        }
      }
);
    }
  }
  finally {
    cleanup();
  }
}
