{
  final String title=getTitle();
  final String[] options=new String[]{IdeBundle.message("project.import.into.new.project"),IdeBundle.message("project.import.into.existing.project"),CommonBundle.getCancelButtonText()};
  int ret=currentProject == null ? 0 : Messages.showDialog(IdeBundle.message("project.import.destination"),title,options,0,Messages.getQuestionIcon());
  if (ret == 2 || ret == -1) {
    return;
  }
  final boolean updateCurrent=ret != 0;
  final AddModuleWizard dialog=new AddModuleWizard(title,getStepsFactory(currentProject,updateCurrent),!updateCurrent);
  dialog.show();
  if (!dialog.isOK()) {
    return;
  }
  final Project projectToUpdate=updateCurrent ? currentProject : ProjectManagerEx.getInstanceEx().newProject(dialog.getNewProjectFilePath(),true,false);
  if (!initImport(currentProject,projectToUpdate)) {
    return;
  }
  if (!updateCurrent) {
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      public void run(){
        setProjectParameters(projectToUpdate,dialog.getNewProjectJdk(),dialog.getNewCompileOutput());
      }
    }
);
    ProjectUtil.closePreviousProject(currentProject);
    ProjectUtil.updateLastProjectLocation(dialog.getNewProjectFilePath());
    ProjectManagerEx.getInstanceEx().openProject(projectToUpdate);
  }
  commitImport(projectToUpdate);
}
