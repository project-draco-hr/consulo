{
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    return new TestConsoleAdapter();
  }
  final ConsoleView consoleView=createConsoleView();
  return new ConsoleAdapterImpl(consoleView,coreSettings.getOutputLevel(),coreSettings.isPrintErrorStackTraces()){
    private boolean isConsoleOpened=false;
    @Override protected void beforePrint(){
      if (!isConsoleOpened) {
        attachToToolWindow(consoleView);
        isConsoleOpened=true;
      }
    }
  }
;
}
