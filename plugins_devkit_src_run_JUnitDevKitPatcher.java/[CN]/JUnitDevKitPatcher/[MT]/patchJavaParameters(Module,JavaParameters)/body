{
  ProjectJdk jdk=javaParameters.getJdk();
  jdk=IdeaJdk.findIdeaJdk(jdk);
  if (jdk == null)   return;
  @NonNls String libPath=jdk.getHomePath() + File.separator + "lib";
  final ParametersList vm=javaParameters.getVMParametersList();
  vm.add("-Xbootclasspath/p:" + libPath + File.separator+ "boot.jar");
  if (!vm.hasProperty("idea.load.plugins.id") && PluginModuleType.isOfType(module)) {
    final String id=DescriptorUtil.getPluginId(module);
    if (id != null) {
      vm.defineProperty("idea.load.plugins.id",id);
    }
  }
  final String sandboxHome=getSandboxPath(jdk);
  if (sandboxHome != null) {
    if (!vm.hasProperty("idea.home.path")) {
      vm.defineProperty("idea.home.path",sandboxHome + File.separator + "test");
    }
    if (!vm.hasProperty("idea.plugins.path")) {
      vm.defineProperty("idea.plugins.path",sandboxHome + File.separator + "plugins");
    }
  }
  javaParameters.getClassPath().addFirst(libPath + File.separator + "idea.jar");
  javaParameters.getClassPath().addFirst(libPath + File.separator + "resources.jar");
  javaParameters.getClassPath().addFirst(jdk.getToolsPath());
}
