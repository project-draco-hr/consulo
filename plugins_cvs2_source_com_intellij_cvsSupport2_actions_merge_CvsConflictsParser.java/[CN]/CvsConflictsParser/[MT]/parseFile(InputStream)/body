{
  final InputStreamReader isr=new InputStreamReader(merged);
  final BufferedReader br=new BufferedReader(isr);
  try {
    String line;
    while ((line=br.readLine()) != null) {
      String cutLine=findMarkerAndWriteTail(line,RIGHT);
      if (cutLine != null) {
        processRightMarker(cutLine);
        continue;
      }
      cutLine=findMarkerAndWriteTail(line,LEFT);
      if (cutLine != null) {
        processLeftMarker(cutLine);
        continue;
      }
      cutLine=findMarkerAndWriteTail(line,END);
      if (cutLine != null) {
        processEndMarker(cutLine);
        continue;
      }
      appendToMainOrCurrent(line);
    }
  }
  finally {
    br.close();
  }
}
