{
  if (myContentManager == null) {
    if (!ApplicationManager.getApplication().isHeadlessEnvironment()) {
      ToolWindowManager toolWindowManager=ToolWindowManager.getInstance(myProject);
      ToolWindow toolWindow=toolWindowManager.registerToolWindow(ToolWindowId.INSPECTION,true,ToolWindowAnchor.BOTTOM,myProject);
      myContentManager=toolWindow.getContentManager();
      toolWindow.setIcon(IconLoader.getIcon("/general/toolWindowInspection.png"));
      new ContentManagerWatcher(toolWindow,myContentManager);
    }
 else {
      myContentManager=ContentFactory.SERVICE.getInstance().createContentManager(new TabbedPaneContentUI(),true,myProject);
    }
  }
  if (reuse) {
    if (myGlobalInspectionContext == null) {
      myGlobalInspectionContext=new GlobalInspectionContextImpl(myProject,myContentManager);
    }
    myRunningContexts.add(myGlobalInspectionContext);
    return myGlobalInspectionContext;
  }
  final GlobalInspectionContextImpl inspectionContext=new GlobalInspectionContextImpl(myProject,myContentManager);
  myRunningContexts.add(inspectionContext);
  return inspectionContext;
}
