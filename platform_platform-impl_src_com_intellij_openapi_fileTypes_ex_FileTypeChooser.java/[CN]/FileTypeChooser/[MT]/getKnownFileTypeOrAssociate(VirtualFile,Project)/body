{
  if (project != null && !(file instanceof FakeVirtualFile)) {
    ((PsiManagerEx)PsiManager.getInstance(project)).getFileManager().findFile(file);
  }
  FileType type=file.getFileType();
  if (type == UnknownFileType.INSTANCE) {
    type=getKnownFileTypeOrAssociate(file.getName());
  }
  return type;
}
