{
  final RequestManagerImpl requestManager=debugProcess.getRequestsManager();
  if (Comparing.equal(thread,requestManager.getFilterThread())) {
    return;
  }
  requestManager.setFilterThread(thread);
  if (thread == null) {
    final List<Breakpoint> breakpoints=getBreakpoints();
    for (    Breakpoint breakpoint : breakpoints) {
      if (LineBreakpoint.CATEGORY.equals(breakpoint.getCategory()) || MethodBreakpoint.CATEGORY.equals(breakpoint.getCategory())) {
        requestManager.deleteRequest(breakpoint);
        breakpoint.createRequest(debugProcess);
      }
    }
  }
 else {
abstract class FilterSetter<T extends EventRequest> {
      void applyFilter(      final List<T> requests,      final ThreadReference thread){
        for (        T request : requests) {
          try {
            final boolean wasEnabled=request.isEnabled();
            if (wasEnabled) {
              request.disable();
            }
            addFilter(request,thread);
            if (wasEnabled) {
              request.enable();
            }
          }
 catch (          InternalException e) {
            LOG.info(e);
          }
        }
      }
      protected abstract void addFilter(      final T request,      final ThreadReference thread);
    }
    final EventRequestManager eventRequestManager=requestManager.getVMRequestManager();
    new FilterSetter<BreakpointRequest>(){
      protected void addFilter(      final BreakpointRequest request,      final ThreadReference thread){
        request.addThreadFilter(thread);
      }
    }
.applyFilter(eventRequestManager.breakpointRequests(),thread);
    new FilterSetter<MethodEntryRequest>(){
      protected void addFilter(      final MethodEntryRequest request,      final ThreadReference thread){
        request.addThreadFilter(thread);
      }
    }
.applyFilter(eventRequestManager.methodEntryRequests(),thread);
    new FilterSetter<MethodExitRequest>(){
      protected void addFilter(      final MethodExitRequest request,      final ThreadReference thread){
        request.addThreadFilter(thread);
      }
    }
.applyFilter(eventRequestManager.methodExitRequests(),thread);
  }
}
