{
  WriteExternalException ex=ApplicationManager.getApplication().runReadAction(new Computable<WriteExternalException>(){
    @Override @Nullable public WriteExternalException compute(){
      try {
        removeInvalidBreakpoints();
        final Map<Key<? extends Breakpoint>,Element> categoryToElementMap=new java.util.HashMap<Key<? extends Breakpoint>,Element>();
        for (        Key<? extends Breakpoint> category : myDefaultSuspendPolicies.keySet()) {
          final Element group=getCategoryGroupElement(categoryToElementMap,category,parentNode);
          group.setAttribute(DEFAULT_SUSPEND_POLICY_ATTRIBUTE_NAME,String.valueOf(getDefaultSuspendPolicy(category)));
        }
        for (        final Breakpoint breakpoint : getBreakpoints()) {
          final Key<? extends Breakpoint> category=breakpoint.getCategory();
          final Element group=getCategoryGroupElement(categoryToElementMap,category,parentNode);
          if (breakpoint.isValid()) {
            writeBreakpoint(group,breakpoint);
          }
        }
        final AnyExceptionBreakpoint anyExceptionBreakpoint=getAnyExceptionBreakpoint();
        final Element group=getCategoryGroupElement(categoryToElementMap,anyExceptionBreakpoint.getCategory(),parentNode);
        writeBreakpoint(group,anyExceptionBreakpoint);
        final Element rules=new Element(RULES_GROUP_NAME);
        parentNode.addContent(rules);
        for (        final EnableBreakpointRule myBreakpointRule : myBreakpointRules) {
          writeRule(myBreakpointRule,rules);
        }
        return null;
      }
 catch (      WriteExternalException e) {
        return e;
      }
    }
  }
);
  if (ex != null) {
    throw ex;
  }
  final Element props=new Element("ui_properties");
  parentNode.addContent(props);
  for (  final String name : myUIProperties.keySet()) {
    final String value=myUIProperties.get(name);
    final Element property=new Element("property");
    props.addContent(property);
    property.setAttribute("name",name);
    property.setAttribute("value",value);
  }
}
