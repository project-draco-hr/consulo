{
  progress.setText2("Updating caches...");
  Set<String> groupIds=new HashSet<String>();
  Map<String,Set<String>> artifactIds=new HashMap<String,Set<String>>();
  Map<String,Set<String>> versions=new HashMap<String,Set<String>>();
  doUpdateIndexData(context,project,groupIds,artifactIds,versions,progress);
  IndexData oldData;
  String oldDataDir;
synchronized (this) {
    oldData=myData;
    oldDataDir=myDataDir;
  }
  String newDataDir=findAvailableDataDir();
  IndexData newData=openData(newDataDir);
  progress.setText2("Saving caches...");
  for (  String each : groupIds) {
    newData.groupIds.enumerate(each);
  }
  for (  Map.Entry<String,Set<String>> each : artifactIds.entrySet()) {
    newData.artifactIds.put(each.getKey(),each.getValue());
  }
  for (  Map.Entry<String,Set<String>> each : versions.entrySet()) {
    newData.versions.put(each.getKey(),each.getValue());
  }
  newData.flush();
synchronized (this) {
    myData=newData;
    myDataDir=newDataDir;
    oldData.close();
    FileUtil.delete(getDataDir(oldDataDir));
  }
}
