{
  final AnnotateOperation operation=AnnotateOperation.createForFile(new File(file.getPath()));
  final CvsOperationExecutor executor=new CvsOperationExecutor(true,myProject,ModalityState.defaultModalityState());
  executor.performActionSync(new CommandCvsHandler(CvsBundle.getAnnotateOperationName(),operation),CvsOperationExecutorCallback.EMPTY);
  if (executor.getResult().hasNoErrors()) {
    final CvsVcs2 cvsVcs2=CvsVcs2.getInstance(myProject);
    final CvsHistoryProvider historyProvider=(CvsHistoryProvider)cvsVcs2.getVcsHistoryProvider();
    final FilePath filePath=VcsContextFactory.SERVICE.getInstance().createFilePathOn(file);
    final List<VcsFileRevision> revisions=historyProvider.createRevisions(filePath);
    final Annotation[] lineAnnotations=operation.getLineAnnotations();
    CvsVcs2.adjustAnnotation(revisions,lineAnnotations);
    return new CvsFileAnnotation(operation.getContent(),lineAnnotations,revisions,file);
  }
 else {
    throw executor.getFirstError();
  }
}
