{
  Application application=ApplicationManager.getApplication();
  if (application == null)   return null;
  CharsetSettings settings=CharsetSettings.getInstance();
  if (settings == null)   return null;
  String charsetName=settings.getCharsetName();
  if (CharsetSettings.SYSTEM_DEFAULT_CHARSET_NAME.equals(charsetName))   return getDefaultSystemCharset();
  if (!Charset.isSupported(charsetName))   return getDefaultSystemCharset();
  Charset charset=forName(charsetName);
  return charset == null ? getDefaultSystemCharset() : charset;
}
