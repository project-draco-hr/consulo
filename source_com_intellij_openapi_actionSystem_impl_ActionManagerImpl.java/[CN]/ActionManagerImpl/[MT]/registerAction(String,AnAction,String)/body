{
  if (LOG.isDebugEnabled()) {
    LOG.debug("enter: registerAction(" + action + ")");
  }
  if (action == null) {
    LOG.error("action cannot be null");
    return;
  }
  if (actionId == null) {
    LOG.error("action's id cannot be null");
    return;
  }
synchronized (myLock) {
    if (myId2Action.containsKey(actionId)) {
      LOG.error("action with the ID \"" + actionId + "\" was already registered. Registered action is "+ myId2Action.get(actionId));
      return;
    }
    if (myAction2Id.containsKey(action)) {
      LOG.error("action was already registered for another ID. ID is " + myAction2Id.get(action));
      return;
    }
    myId2Action.put(actionId,action);
    myId2Index.put(actionId,myRegisteredActionsCount++);
    myAction2Id.put(action,actionId);
    if (pluginName != null && !(action instanceof ActionGroup)) {
      THashSet<String> pluginActionIds=myPlugin2Id.get(pluginName);
      if (pluginActionIds == null) {
        pluginActionIds=new THashSet<String>();
        myPlugin2Id.put(pluginName,pluginActionIds);
      }
      pluginActionIds.add(actionId);
    }
    action.registerCustomShortcutSet(new ProxyShortcutSet(actionId,myKeymapManager),null);
  }
}
