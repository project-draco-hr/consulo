{
  if (LOG.isDebugEnabled()) {
    LOG.debug("enter: processReferenceElement(" + element.getName() + ")");
  }
  if (!"reference".equals(element.getName())) {
    LOG.error("unexpected name of element \"" + element.getName() + "\"");
    return null;
  }
  String ref=element.getAttributeValue("ref");
  if (ref == null) {
    ref=element.getAttributeValue("id");
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("ref=\"" + ref + "\"");
  }
  if (ref == null || ref.length() == 0) {
    LOG.error("ID of reference element should be defined");
    return null;
  }
  AnAction action=getActionImpl(ref,true);
  if (action == null) {
    if (!myNotRegisteredInternalActionIds.contains(ref)) {
      LOG.error("action specified by reference isn't registered (ID=" + ref + ")");
    }
    return null;
  }
  LOG.assertTrue((action instanceof ActionGroup) || (action instanceof ActionStub));
  return action;
}
