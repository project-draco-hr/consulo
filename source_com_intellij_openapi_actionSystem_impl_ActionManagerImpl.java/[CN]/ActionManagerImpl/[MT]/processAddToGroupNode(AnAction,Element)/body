{
  if (LOG.isDebugEnabled()) {
    LOG.debug("enter: processAddToGroupNode(" + action + ","+ element.getName()+ ")");
  }
  LOG.assertTrue((action instanceof ActionGroup) || (action instanceof ActionStub) || (action instanceof Separator));
  if (!"add-to-group".equals(element.getName())) {
    LOG.error("unexpected name of element \"" + element.getName() + "\"");
    return;
  }
  String groupId=element.getAttributeValue("group-id");
  if (groupId == null || groupId.length() == 0) {
    LOG.error("attribute \"group-id\" should be defined");
    return;
  }
  AnAction parentGroup=getActionImpl(groupId,true);
  if (parentGroup == null) {
    LOG.error("action with id \"" + groupId + "\" isn't registered; action will be added to the \"Other\" group");
    parentGroup=getActionImpl(IdeActions.GROUP_OTHER_MENU,true);
  }
  if (!(parentGroup instanceof DefaultActionGroup)) {
    LOG.error("action with id \"" + groupId + "\" should be instance of "+ DefaultActionGroup.class.getName());
    return;
  }
  String anchorStr=element.getAttributeValue("anchor");
  if (anchorStr == null || groupId.length() == 0) {
    LOG.error("attribute \"anchor\" should be defined");
    return;
  }
  Anchor anchor;
  if ("first".equalsIgnoreCase(anchorStr)) {
    anchor=Anchor.FIRST;
  }
 else   if ("last".equalsIgnoreCase(anchorStr)) {
    anchor=Anchor.LAST;
  }
 else   if ("before".equalsIgnoreCase(anchorStr)) {
    anchor=Anchor.BEFORE;
  }
 else   if ("after".equalsIgnoreCase(anchorStr)) {
    anchor=Anchor.AFTER;
  }
 else {
    LOG.error("anchor should be one of the following constants: \"first\", \"last\", \"before\" or \"after\"");
    return;
  }
  String relativeToActionId=element.getAttributeValue("relative-to-action");
  if ((Anchor.BEFORE == anchor || Anchor.AFTER == anchor) && relativeToActionId == null) {
    LOG.error("\"relative-to-action\" cannot be null if anchor is \"after\" or \"before\"");
    return;
  }
  ((DefaultActionGroup)parentGroup).add(action,new Constraints(anchor,relativeToActionId));
}
