{
  final File topDir=FileUtil.createTempDirectory("top.",null);
  final File watchedFile=FileUtil.createTempFile(topDir,"test.",".txt",true,false);
  final File subDir=FileUtil.createTempDirectory(topDir,"sub.",null);
  final File unwatchedFile=FileUtil.createTempFile(subDir,"test.",".txt",true,false);
  refresh(topDir);
  final LocalFileSystem.WatchRequest request=watch(topDir,false);
  try {
    myAccept=true;
    FileUtil.writeToFile(watchedFile,"new content");
    assertEvent(VFileContentChangeEvent.class,watchedFile.getAbsolutePath());
    myAccept=true;
    try {
      myTimeout=10 * INTER_RESPONSE_DELAY;
      FileUtil.writeToFile(unwatchedFile,"new content");
      assertEvent(VFileEvent.class);
    }
  finally {
      myTimeout=NATIVE_PROCESS_DELAY;
    }
  }
  finally {
    unwatch(request);
    delete(topDir);
  }
}
