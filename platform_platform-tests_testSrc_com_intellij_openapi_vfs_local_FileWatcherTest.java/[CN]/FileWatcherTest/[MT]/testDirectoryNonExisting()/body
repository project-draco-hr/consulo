{
  final File topDir=FileUtil.createTempDirectory("top.",null);
  final File subDir=new File(topDir,"subDir");
  final File file=new File(subDir,"file.txt");
  refresh(topDir);
  final LocalFileSystem.WatchRequest request=watch(subDir);
  try {
    assertTrue(subDir.toString(),subDir.mkdir());
    assertEvent(VFileCreateEvent.class,subDir.getAbsolutePath());
    refresh(subDir);
    FileUtil.writeToFile(file,"new content");
    assertEvent(VFileCreateEvent.class,file.getAbsolutePath());
  }
  finally {
    myFileSystem.removeWatchedRoot(request);
    FileUtil.delete(topDir);
  }
}
