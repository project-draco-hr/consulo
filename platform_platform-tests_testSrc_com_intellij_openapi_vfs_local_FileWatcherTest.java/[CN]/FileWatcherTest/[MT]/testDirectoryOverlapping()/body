{
  final File topDir=FileUtil.createTempDirectory("top.",null);
  final File fileInTopDir=new File(topDir,"file1.txt");
  FileUtil.createIfNotExists(fileInTopDir);
  final File subDir=new File(topDir,"sub");
  FileUtil.createDirectory(subDir);
  final File fileInSubDir=new File(subDir,"file2.txt");
  FileUtil.createIfNotExists(fileInSubDir);
  final File sideDir=FileUtil.createTempDirectory("side.",null);
  final File fileInSideDir=new File(sideDir,"file3.txt");
  FileUtil.createIfNotExists(fileInSideDir);
  refresh(topDir);
  refresh(sideDir);
  final LocalFileSystem.WatchRequest requestForSubDir=watch(subDir);
  final LocalFileSystem.WatchRequest requestForSideDir=watch(sideDir);
  try {
    myAccept=true;
    FileUtil.writeToFile(fileInTopDir,"new content");
    FileUtil.writeToFile(fileInSubDir,"new content");
    FileUtil.writeToFile(fileInSideDir,"new content");
    assertEvent(VFileContentChangeEvent.class,fileInSubDir.getAbsolutePath(),fileInSideDir.getAbsolutePath());
    final LocalFileSystem.WatchRequest requestForTopDir=watch(topDir);
    try {
      myAccept=true;
      FileUtil.writeToFile(fileInTopDir,"newer content");
      FileUtil.writeToFile(fileInSubDir,"newer content");
      FileUtil.writeToFile(fileInSideDir,"newer content");
      assertEvent(VFileContentChangeEvent.class,fileInTopDir.getAbsolutePath(),fileInSubDir.getAbsolutePath(),fileInSideDir.getAbsolutePath());
    }
  finally {
      unwatch(requestForTopDir);
    }
    myAccept=true;
    FileUtil.writeToFile(fileInTopDir,"newest content");
    FileUtil.writeToFile(fileInSubDir,"newest content");
    FileUtil.writeToFile(fileInSideDir,"newest content");
    assertEvent(VFileContentChangeEvent.class,fileInSubDir.getAbsolutePath(),fileInSideDir.getAbsolutePath());
    myAccept=true;
    FileUtil.delete(fileInTopDir);
    FileUtil.delete(fileInSubDir);
    FileUtil.delete(fileInSideDir);
    assertEvent(VFileDeleteEvent.class,fileInTopDir.getAbsolutePath(),fileInSubDir.getAbsolutePath(),fileInSideDir.getAbsolutePath());
  }
  finally {
    unwatch(requestForSubDir,requestForSideDir);
    delete(topDir);
  }
}
