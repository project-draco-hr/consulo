{
  File topDir=createTestDir("top");
  File fileInTopDir=createTestFile(topDir,"file1.txt");
  File subDir=createTestDir(topDir,"sub");
  File fileInSubDir=createTestFile(subDir,"file2.txt");
  File sideDir=createTestDir("side");
  File fileInSideDir=createTestFile(sideDir,"file3.txt");
  refresh(topDir);
  refresh(sideDir);
  LocalFileSystem.WatchRequest requestForSubDir=watch(subDir);
  LocalFileSystem.WatchRequest requestForSideDir=watch(sideDir);
  try {
    myAccept=true;
    FileUtil.writeToFile(fileInTopDir,"new content");
    FileUtil.writeToFile(fileInSubDir,"new content");
    FileUtil.writeToFile(fileInSideDir,"new content");
    assertEvent(VFileContentChangeEvent.class,fileInSubDir.getPath(),fileInSideDir.getPath());
    LocalFileSystem.WatchRequest requestForTopDir=watch(topDir);
    try {
      myAccept=true;
      FileUtil.writeToFile(fileInTopDir,"newer content");
      FileUtil.writeToFile(fileInSubDir,"newer content");
      FileUtil.writeToFile(fileInSideDir,"newer content");
      assertEvent(VFileContentChangeEvent.class,fileInTopDir.getPath(),fileInSubDir.getPath(),fileInSideDir.getPath());
    }
  finally {
      unwatch(requestForTopDir);
    }
    myAccept=true;
    FileUtil.writeToFile(fileInTopDir,"newest content");
    FileUtil.writeToFile(fileInSubDir,"newest content");
    FileUtil.writeToFile(fileInSideDir,"newest content");
    assertEvent(VFileContentChangeEvent.class,fileInSubDir.getPath(),fileInSideDir.getPath());
    myAccept=true;
    FileUtil.delete(fileInTopDir);
    FileUtil.delete(fileInSubDir);
    FileUtil.delete(fileInSideDir);
    assertEvent(VFileDeleteEvent.class,fileInTopDir.getPath(),fileInSubDir.getPath(),fileInSideDir.getPath());
  }
  finally {
    unwatch(requestForSubDir,requestForSideDir);
    delete(topDir);
  }
}
