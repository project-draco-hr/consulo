{
  final File topDir=FileUtil.createTempDirectory("top.",null);
  final File fileInTopDir=FileUtil.createTempFile(topDir,"file1.",".txt",true,false);
  final File subDir=FileUtil.createTempDirectory(topDir,"sub.",null);
  final File fileInSubDir=FileUtil.createTempFile(subDir,"file2.",".txt",true,false);
  final File sideDir=FileUtil.createTempDirectory("side.",null);
  final File fileInSideDir=FileUtil.createTempFile(sideDir,"file3.",".txt",true,false);
  refresh(topDir);
  refresh(sideDir);
  final LocalFileSystem.WatchRequest requestForSubDir=watch(subDir);
  final LocalFileSystem.WatchRequest requestForSideDir=watch(sideDir);
  try {
    myAccept=true;
    writeToFile(fileInTopDir,"new content");
    writeToFile(fileInSubDir,"new content");
    writeToFile(fileInSideDir,"new content");
    assertEvent(VFileContentChangeEvent.class,fileInSubDir.getAbsolutePath(),fileInSideDir.getAbsolutePath());
    final LocalFileSystem.WatchRequest requestForTopDir=watch(topDir);
    try {
      myAccept=true;
      writeToFile(fileInTopDir,"newer content");
      writeToFile(fileInSubDir,"newer content");
      writeToFile(fileInSideDir,"newer content");
      assertEvent(VFileContentChangeEvent.class,fileInTopDir.getAbsolutePath(),fileInSubDir.getAbsolutePath(),fileInSideDir.getAbsolutePath());
    }
  finally {
      unwatch(requestForTopDir);
    }
    myAccept=true;
    writeToFile(fileInTopDir,"newest content");
    writeToFile(fileInSubDir,"newest content");
    writeToFile(fileInSideDir,"newest content");
    assertEvent(VFileContentChangeEvent.class,fileInSubDir.getAbsolutePath(),fileInSideDir.getAbsolutePath());
    myAccept=true;
    FileUtil.delete(fileInTopDir);
    FileUtil.delete(fileInSubDir);
    FileUtil.delete(fileInSideDir);
    assertEvent(VFileDeleteEvent.class,fileInTopDir.getAbsolutePath(),fileInSubDir.getAbsolutePath(),fileInSideDir.getAbsolutePath());
  }
  finally {
    unwatch(requestForSubDir,requestForSideDir);
    delete(topDir);
  }
}
