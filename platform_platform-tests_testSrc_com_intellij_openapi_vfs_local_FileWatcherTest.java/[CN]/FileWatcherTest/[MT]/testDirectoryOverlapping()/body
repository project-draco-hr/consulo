{
  final File topDir=FileUtil.createTempDirectory("top.",null);
  final File file1=FileUtil.createTempFile(topDir,"file1.",".txt",true,false);
  final File subDir=FileUtil.createTempDirectory(topDir,"sub.",null);
  final File file2=FileUtil.createTempFile(subDir,"file2.",".txt",true,false);
  final File sideDir=FileUtil.createTempDirectory("side.",null);
  final File file3=FileUtil.createTempFile(sideDir,"file3.",".txt",true,false);
  refresh(topDir);
  refresh(sideDir);
  final LocalFileSystem.WatchRequest request1=watch(subDir);
  final LocalFileSystem.WatchRequest request2=watch(sideDir);
  try {
    FileUtil.writeToFile(file1,"new content");
    FileUtil.writeToFile(file2,"new content");
    FileUtil.writeToFile(file3,"new content");
    assertEvent(VFileContentChangeEvent.class,file2.getAbsolutePath(),file3.getAbsolutePath());
    final LocalFileSystem.WatchRequest request3=watch(topDir);
    try {
      FileUtil.writeToFile(file1,"newer content");
      FileUtil.writeToFile(file2,"newer content");
      FileUtil.writeToFile(file3,"newer content");
      assertEvent(VFileContentChangeEvent.class,file1.getAbsolutePath(),file2.getAbsolutePath(),file3.getAbsolutePath());
    }
  finally {
      unwatch(request3);
    }
    FileUtil.writeToFile(file1,"newest content");
    FileUtil.writeToFile(file2,"newest content");
    FileUtil.writeToFile(file3,"newest content");
    assertEvent(VFileContentChangeEvent.class,file2.getAbsolutePath(),file3.getAbsolutePath());
    FileUtil.delete(file1);
    FileUtil.delete(file2);
    FileUtil.delete(file3);
    assertEvent(VFileDeleteEvent.class,file1.getAbsolutePath(),file2.getAbsolutePath(),file3.getAbsolutePath());
  }
  finally {
    myFileSystem.removeWatchedRoots(Arrays.asList(request1,request2));
    FileUtil.delete(topDir);
  }
}
