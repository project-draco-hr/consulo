{
  File topDir=createTestDir("top");
  File rootDir=createTestDir(topDir,"root");
  File rootDir2=new File(topDir,"_" + rootDir.getName());
  refresh(topDir);
  LocalFileSystem.WatchRequest request=watch(rootDir);
  try {
    myAccept=true;
    assertTrue(rootDir.renameTo(rootDir2));
    assertEvent(VFileEvent.class,rootDir.getPath(),rootDir2.getPath());
    myAccept=true;
    assertTrue(rootDir2.renameTo(rootDir));
    assertEvent(VFileEvent.class,rootDir.getPath(),rootDir2.getPath());
    myAccept=true;
    assertTrue(FileUtil.delete(rootDir));
    assertEvent(VFileDeleteEvent.class,rootDir.getPath());
    myAccept=true;
    assertTrue(rootDir.mkdirs());
    assertEvent(VFileCreateEvent.class,rootDir.getPath());
    myAccept=true;
    assertTrue(FileUtil.delete(topDir));
    assertEvent(VFileDeleteEvent.class,topDir.getPath());
    myAccept=true;
    assertTrue(rootDir.mkdirs());
    assertEvent(VFileCreateEvent.class);
  }
  finally {
    unwatch(request);
    delete(topDir);
  }
}
