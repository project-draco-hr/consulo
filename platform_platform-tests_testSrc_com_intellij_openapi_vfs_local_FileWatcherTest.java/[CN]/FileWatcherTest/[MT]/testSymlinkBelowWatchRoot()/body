{
  final File targetDir=FileUtil.createTempDirectory("top.",null);
  final File file=FileUtil.createTempFile(targetDir,"test.",".txt",true,false);
  final File linkDir=FileUtil.createTempDirectory("link.",null);
  final File link=new File(linkDir,"link");
  SymlinkHandlingTest.createTempLink(targetDir.getAbsolutePath(),link.getAbsolutePath());
  final File fileLink=new File(link,file.getName());
  refresh(targetDir);
  refresh(linkDir);
  final LocalFileSystem.WatchRequest request=watch(linkDir);
  try {
    FileUtil.writeToFile(file,"new content");
    assertEvent(VFileContentChangeEvent.class,fileLink.getAbsolutePath());
    FileUtil.delete(file);
    assertEvent(VFileDeleteEvent.class,fileLink.getAbsolutePath());
    FileUtil.writeToFile(file,"re-creation");
    assertEvent(VFileCreateEvent.class,fileLink.getAbsolutePath());
  }
  finally {
    myFileSystem.removeWatchedRoot(request);
    FileUtil.delete(linkDir);
    FileUtil.delete(targetDir);
  }
}
