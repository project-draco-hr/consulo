{
  final File topDir=FileUtil.createTempDirectory("top.",null);
  final File watchedFile1=FileUtil.createTempFile(topDir,"test.",".txt",true,false);
  final File sub1Dir=FileUtil.createTempDirectory(topDir,"sub1.",null);
  final File unwatchedFile=FileUtil.createTempFile(sub1Dir,"test.",".txt",true,false);
  final File sub2Dir=FileUtil.createTempDirectory(topDir,"sub2.",null);
  final File sub2subDir=FileUtil.createTempDirectory(sub2Dir,"sub2.",null);
  final File watchedFile2=FileUtil.createTempFile(sub2subDir,"test.",".txt",true,false);
  refresh(topDir);
  final LocalFileSystem.WatchRequest topRequest=watch(topDir,false);
  final LocalFileSystem.WatchRequest subRequest=watch(sub2Dir);
  try {
    FileUtil.writeToFile(watchedFile1,"new content");
    FileUtil.writeToFile(watchedFile2,"new content");
    FileUtil.writeToFile(unwatchedFile,"new content");
    assertEvent(VFileContentChangeEvent.class,watchedFile1.getAbsolutePath(),watchedFile2.getAbsolutePath());
  }
  finally {
    unwatch(subRequest,topRequest);
    delete(topDir);
  }
}
