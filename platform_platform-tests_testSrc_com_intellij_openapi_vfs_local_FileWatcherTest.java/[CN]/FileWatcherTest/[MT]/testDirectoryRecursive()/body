{
  final File topDir=FileUtil.createTempDirectory("top.",null);
  refresh(topDir);
  final LocalFileSystem.WatchRequest request=watch(topDir);
  try {
    final File subDir=FileUtil.createTempDirectory(topDir,"sub.",null);
    assertEvent(VFileCreateEvent.class,subDir.getAbsolutePath());
    refresh(subDir);
    final File file=FileUtil.createTempFile(subDir,"test.",".txt",true,false);
    assertEvent(VFileCreateEvent.class,file.getAbsolutePath());
    FileUtil.writeToFile(file,"new content");
    assertEvent(VFileContentChangeEvent.class,file.getAbsolutePath());
    FileUtil.delete(file);
    assertEvent(VFileDeleteEvent.class,file.getAbsolutePath());
    FileUtil.writeToFile(file,"re-creation");
    assertEvent(VFileCreateEvent.class,file.getAbsolutePath());
  }
  finally {
    myFileSystem.removeWatchedRoot(request);
    delete(topDir);
  }
}
