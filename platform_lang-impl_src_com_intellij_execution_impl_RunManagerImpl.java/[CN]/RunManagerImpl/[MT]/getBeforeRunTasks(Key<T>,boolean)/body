{
  final List<T> tasks=new ArrayList<T>();
  if (includeOnlyActiveTasks) {
    final List<RunnerAndConfigurationSettings> checkedTemplates=new ArrayList<RunnerAndConfigurationSettings>();
    for (    RunnerAndConfigurationSettings settings : myConfigurations.values()) {
      final List<BeforeRunTask> runTasks=getBeforeRunTasks(settings.getConfiguration());
      for (      BeforeRunTask task : runTasks) {
        if (task != null && task.isEnabled() && task.getProviderId() == taskProviderID) {
          tasks.add((T)task);
        }
 else {
          final RunnerAndConfigurationSettings template=getConfigurationTemplate(settings.getFactory());
          if (!checkedTemplates.contains(template)) {
            checkedTemplates.add(template);
            final List<BeforeRunTask> templateTasks=getBeforeRunTasks(template.getConfiguration());
            for (            BeforeRunTask templateTask : templateTasks) {
              if (templateTask != null && templateTask.isEnabled() && templateTask.getProviderId() == taskProviderID) {
                tasks.add((T)templateTask);
              }
            }
          }
        }
      }
    }
  }
 else {
    for (    RunnerAndConfigurationSettings settings : myTemplateConfigurationsMap.values()) {
      final List<BeforeRunTask> tasks_=getBeforeRunTasks(settings.getConfiguration());
      for (      BeforeRunTask task : tasks_) {
        if (task != null && task.getProviderId() == taskProviderID)         tasks.add((T)task);
      }
    }
    for (    RunnerAndConfigurationSettings settings : myConfigurations.values()) {
      final List<BeforeRunTask> tasks_=getBeforeRunTasks(settings.getConfiguration());
      for (      BeforeRunTask task : tasks_) {
        if (task != null && task.getProviderId() == taskProviderID)         tasks.add((T)task);
      }
    }
  }
  return tasks;
}
