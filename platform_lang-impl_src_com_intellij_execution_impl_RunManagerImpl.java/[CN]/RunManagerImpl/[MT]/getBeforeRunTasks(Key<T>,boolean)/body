{
  final Collection<T> tasks=new ArrayList<T>();
  if (includeOnlyActiveTasks) {
    final Set<RunnerAndConfigurationSettings> checkedTemplates=new HashSet<RunnerAndConfigurationSettings>();
    for (    RunnerAndConfigurationSettings settings : myConfigurations.values()) {
      final BeforeRunTask runTask=getBeforeRunTask(settings.getConfiguration(),taskProviderID);
      if (runTask != null && runTask.isEnabled()) {
        tasks.add((T)runTask);
      }
 else {
        final RunnerAndConfigurationSettings template=getConfigurationTemplate(settings.getFactory());
        if (!checkedTemplates.contains(template)) {
          checkedTemplates.add(template);
          final BeforeRunTask templateTask=getBeforeRunTask(template.getConfiguration(),taskProviderID);
          if (templateTask != null && templateTask.isEnabled()) {
            tasks.add((T)templateTask);
          }
        }
      }
    }
  }
 else {
    for (    RunnerAndConfigurationSettings settings : myTemplateConfigurationsMap.values()) {
      final T task=getBeforeRunTask(settings.getConfiguration(),taskProviderID);
      if (task != null) {
        tasks.add(task);
      }
    }
    for (    RunnerAndConfigurationSettings settings : myConfigurations.values()) {
      final T task=getBeforeRunTask(settings.getConfiguration(),taskProviderID);
      if (task != null) {
        tasks.add(task);
      }
    }
  }
  return tasks;
}
