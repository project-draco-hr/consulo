{
  Element configurationElement=new Element(elementType);
  parentNode.addContent(configurationElement);
  try {
    ((RunnerAndConfigurationSettingsImpl)settings).writeExternal(configurationElement);
  }
 catch (  WriteExternalException e) {
    throw new RuntimeException(e);
  }
  if (settings.getConfiguration() instanceof UnknownRunConfiguration) {
    return;
  }
  List<BeforeRunTask> tasks=new ArrayList<>(getBeforeRunTasks(settings.getConfiguration()));
  Map<Key<BeforeRunTask>,BeforeRunTask> templateTasks=new THashMap<>();
  List<BeforeRunTask> beforeRunTasks=settings.isTemplate() ? getHardcodedBeforeRunTasks(settings.getConfiguration()) : getBeforeRunTasks(getConfigurationTemplate(settings.getFactory()).getConfiguration());
  for (  BeforeRunTask templateTask : beforeRunTasks) {
    templateTasks.put(templateTask.getProviderId(),templateTask);
    if (templateTask.isEnabled()) {
      boolean found=false;
      for (      BeforeRunTask realTask : tasks) {
        if (realTask.getProviderId() == templateTask.getProviderId()) {
          found=true;
          break;
        }
      }
      if (!found) {
        BeforeRunTask clone=templateTask.clone();
        clone.setEnabled(false);
        tasks.add(0,clone);
      }
    }
  }
  Element methodsElement=new Element(METHOD);
  for (int i=0, size=tasks.size(); i < size; i++) {
    BeforeRunTask task=tasks.get(i);
    int j=0;
    BeforeRunTask templateTask=null;
    for (    Map.Entry<Key<BeforeRunTask>,BeforeRunTask> entry : templateTasks.entrySet()) {
      if (entry.getKey() == task.getProviderId()) {
        templateTask=entry.getValue();
        break;
      }
      j++;
    }
    if (task.equals(templateTask) && i == j) {
      continue;
    }
    Element child=new Element(OPTION);
    child.setAttribute(NAME_ATTR,task.getProviderId().toString());
    task.writeExternal(child);
    methodsElement.addContent(child);
  }
  configurationElement.addContent(methodsElement);
}
