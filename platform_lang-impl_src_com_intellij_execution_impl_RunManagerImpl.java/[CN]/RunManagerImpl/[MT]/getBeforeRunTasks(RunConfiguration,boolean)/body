{
  final List<BeforeRunTask> tasks=myConfigurationToBeforeTasksMap.get(settings);
  if (tasks != null) {
    return getCopies(tasks,includeOnlyActiveTasks);
  }
  final RunnerAndConfigurationSettings template=getConfigurationTemplate(settings.getFactory());
  final List<BeforeRunTask> templateTasks=myConfigurationToBeforeTasksMap.get(template.getConfiguration());
  if (templateTasks != null) {
    return getCopies(templateTasks,includeOnlyActiveTasks);
  }
  final List<BeforeRunTask> _tasks=new ArrayList<BeforeRunTask>();
  for (  BeforeRunTaskProvider<? extends BeforeRunTask> provider : Extensions.getExtensions(BeforeRunTaskProvider.EXTENSION_POINT_NAME,myProject)) {
    BeforeRunTask task=provider.createTask(settings);
    if (task != null) {
      if (includeOnlyActiveTasks && !task.isEnabled())       continue;
      Key<? extends BeforeRunTask> providerID=provider.getId();
      _tasks.add(task);
      settings.getFactory().configureBeforeRunTaskDefaults(providerID,task);
    }
  }
  return _tasks;
}
