{
  GuiUtils.runOrInvokeAndWait(new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          final VirtualFile dir=myRepo.getVFRootDir().findChild("dir");
          myDirtyScope.addDirtyDirRecursively(new FilePathImpl(dir));
          FileUtil.delete(VfsUtil.virtualToIoFile(dir));
        }
      }
);
    }
  }
);
  assertChanges(new VirtualFile[]{myFiles.get("dir/c.txt"),myFiles.get("dir/subdir/d.txt")},new FileStatus[]{DELETED,DELETED});
}
