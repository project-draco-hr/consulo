{
  final PsiType castType=expression.getType();
  final PsiExpression operand=expression.getOperand();
  if (!(operand instanceof PsiReferenceExpression)) {
    return false;
  }
  final PsiReferenceExpression referenceExpression=(PsiReferenceExpression)operand;
  final InstanceofChecker checker=new InstanceofChecker(referenceExpression,castType,false);
  PsiElement parent=PsiTreeUtil.getParentOfType(expression,PsiIfStatement.class,PsiConditionalExpression.class,PsiPolyadicExpression.class);
  while (parent != null) {
    parent.accept(checker);
    if (checker.hasAgreeingInstanceof()) {
      return true;
    }
    parent=PsiTreeUtil.getParentOfType(parent,PsiIfStatement.class,PsiConditionalExpression.class,PsiPolyadicExpression.class);
  }
  return false;
}
