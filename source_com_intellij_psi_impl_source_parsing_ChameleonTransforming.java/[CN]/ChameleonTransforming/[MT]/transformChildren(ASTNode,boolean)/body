{
synchronized (PsiLock.LOCK) {
    ASTNode child=element.getFirstChildNode();
    while (child != null) {
      if (child instanceof ChameleonElement) {
        ASTNode next=child.getTreeNext();
        child=transform((ChameleonElement)child);
        if (child == null) {
          child=next;
        }
        continue;
      }
      if (recursive && child instanceof CompositeElement) {
        transformChildren(child,recursive);
      }
      child=child.getTreeNext();
    }
  }
}
