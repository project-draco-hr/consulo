{
  if (ApplicationManager.getApplication().isUnitTestMode())   return;
  final ContentManager contentManager=getContentManagerForRunner(executor);
  RunContentDescriptor oldDescriptor=chooseReuseContentForDescriptor(contentManager,descriptor);
  final Content content;
  if (oldDescriptor != null) {
    content=oldDescriptor.getAttachedContent();
    getSyncPublisher().contentRemoved(oldDescriptor,executor);
    oldDescriptor.dispose();
  }
 else   if (descriptor.getAttachedContent() == null || !descriptor.getAttachedContent().isValid()) {
    content=createNewContent(contentManager,descriptor,executor);
    final Icon icon=descriptor.getIcon();
    content.setIcon(icon == null ? executor.getToolWindowIcon() : icon);
  }
 else {
    content=descriptor.getAttachedContent();
  }
  content.setComponent(descriptor.getComponent());
  content.putUserData(DESCRIPTOR_KEY,descriptor);
  final ProcessHandler processHandler=descriptor.getProcessHandler();
  if (processHandler != null) {
    final ProcessAdapter processAdapter=new ProcessAdapter(){
      public void startNotified(      final ProcessEvent event){
        LaterInvocator.invokeLater(new Runnable(){
          public void run(){
            final Icon icon=descriptor.getIcon();
            content.setIcon(icon == null ? executor.getToolWindowIcon() : icon);
          }
        }
);
      }
      public void processTerminated(      final ProcessEvent event){
        LaterInvocator.invokeLater(new Runnable(){
          public void run(){
            final Icon icon=descriptor.getIcon();
            content.setIcon(icon == null ? executor.getDisabledIcon() : IconLoader.getTransparentIcon(icon));
          }
        }
);
      }
    }
;
    processHandler.addProcessListener(processAdapter);
    final Disposable disposer=content.getDisposer();
    if (disposer != null) {
      Disposer.register(disposer,new Disposable(){
        public void dispose(){
          processHandler.removeProcessListener(processAdapter);
        }
      }
);
    }
  }
  content.setDisplayName(descriptor.getDisplayName());
  descriptor.setAttachedContent(content);
  content.getManager().setSelectedContent(content);
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      if (myProject.isDisposed())       return;
      ToolWindow window=ToolWindowManager.getInstance(myProject).getToolWindow(executor.getToolWindowId());
      window.activate(null,false,false);
    }
  }
);
}
