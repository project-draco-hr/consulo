{
  final String toolWindowId=executor.getToolWindowId();
  final ToolWindowManager toolWindowManager=ToolWindowManager.getInstance(myProject);
  if (toolWindowManager == null)   return;
  if (toolWindowManager.getToolWindow(toolWindowId) != null) {
    return;
  }
  final ToolWindow toolWindow=toolWindowManager.registerToolWindow(toolWindowId,true,ToolWindowAnchor.BOTTOM,this,true);
  final ContentManager contentManager=toolWindow.getContentManager();
class MyDataProvider implements DataProvider {
    private int myInsideGetData=0;
    public Object getData(    String dataId){
      myInsideGetData++;
      try {
        if (PlatformDataKeys.HELP_ID.is(dataId)) {
          return executor.getHelpId();
        }
 else {
          return myInsideGetData == 1 ? DataManager.getInstance().getDataContext(contentManager.getComponent()).getData(dataId) : null;
        }
      }
  finally {
        myInsideGetData--;
      }
    }
  }
  contentManager.addDataProvider(new MyDataProvider());
  toolWindow.setIcon(executor.getToolWindowIcon());
  new ContentManagerWatcher(toolWindow,contentManager);
  contentManager.addContentManagerListener(new ContentManagerAdapter(){
    public void selectionChanged(    final ContentManagerEvent event){
      final Content content=event.getContent();
      final RunContentDescriptor descriptor=content != null ? getRunContentDescriptorByContent(content) : null;
      myEventDispatcher.getMulticaster().contentSelected(descriptor,toolWindowId);
    }
  }
);
  myToolwindowIdToContentManagerMap.put(toolWindowId,contentManager);
  Disposer.register(contentManager,new Disposable(){
    public void dispose(){
      unregisterToolwindow(toolWindowId);
    }
  }
);
  myToolwindowIdZbuffer.addLast(toolWindowId);
}
