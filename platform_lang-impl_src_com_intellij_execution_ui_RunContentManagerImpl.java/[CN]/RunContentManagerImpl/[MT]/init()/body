{
  final Executor[] executors=ExecutorRegistry.getInstance().getRegisteredExecutors();
  for (  Executor executor : executors) {
    registerToolwindow(executor);
  }
  if (ToolWindowManager.getInstance(myProject) == null)   return;
  SwingUtilities.invokeLater(new Runnable(){
    @Override public void run(){
      if (myProject.isDisposed())       return;
      ((ToolWindowManagerEx)ToolWindowManager.getInstance(myProject)).addToolWindowManagerListener(new ToolWindowManagerAdapter(){
        @Override public void stateChanged(){
          if (myProject.isDisposed())           return;
          ToolWindowManager toolWindowManager=ToolWindowManager.getInstance(myProject);
          Set<String> currentWindows=new HashSet<String>();
          String[] toolWindowIds=toolWindowManager.getToolWindowIds();
          ContainerUtil.addAll(currentWindows,toolWindowIds);
          myToolwindowIdZbuffer.retainAll(currentWindows);
          final String activeToolWindowId=toolWindowManager.getActiveToolWindowId();
          if (activeToolWindowId != null) {
            if (myToolwindowIdZbuffer.remove(activeToolWindowId)) {
              myToolwindowIdZbuffer.addFirst(activeToolWindowId);
            }
          }
        }
      }
);
    }
  }
);
}
