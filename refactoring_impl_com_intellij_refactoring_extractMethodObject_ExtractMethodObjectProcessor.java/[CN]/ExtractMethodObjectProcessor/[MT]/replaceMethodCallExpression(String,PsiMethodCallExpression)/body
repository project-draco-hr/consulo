{
  @NonNls String staticqualifier=null;
  if (getMethod().getModifierList().hasModifierProperty(PsiModifier.STATIC)) {
    final int packageNameLength=((PsiClassOwner)getMethod().getContainingFile()).getPackageName().length();
    final String fqinnerClassName=getMethod().getContainingClass().getQualifiedName() + "." + getInnerClassName();
    staticqualifier=packageNameLength > 0 ? fqinnerClassName.substring(packageNameLength + 1) : fqinnerClassName;
  }
  @NonNls String newReplacement;
  final PsiReferenceExpression methodExpression=methodCallExpression.getMethodExpression();
  final PsiExpressionList argumentList=methodCallExpression.getArgumentList();
  if (staticqualifier != null) {
    newReplacement=argumentList.getExpressions().length > 0 ? "new " + staticqualifier + inferredTypeArguments+ argumentList.getText()+ "." : staticqualifier + ".";
  }
 else {
    final PsiExpression qualifierExpression=methodExpression.getQualifierExpression();
    final String qualifier=qualifierExpression != null ? qualifierExpression.getText() + "." : "";
    newReplacement=qualifier + "new " + getInnerClassName()+ inferredTypeArguments+ argumentList.getText()+ ".";
  }
  return (PsiMethodCallExpression)methodCallExpression.replace(myElementFactory.createExpressionFromText(newReplacement + "invoke()",null));
}
