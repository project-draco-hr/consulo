{
  final VirtualFile baseDir=myProject.getBaseDir();
  final Module[] modules=myModuleManager.getModules();
  final StorageScheme storageScheme=((ProjectEx)myProject).getStateStore().getStorageScheme();
  if (StorageScheme.DIRECTORY_BASED.equals(storageScheme)) {
    builder.addDirtyDirRecursively(new FilePathImpl(new File(PathUtil.toPresentableUrl(baseDir.getPath()),Project.DIRECTORY_STORE_FOLDER),true));
  }
  for (  Module module : modules) {
    final VirtualFile[] files=ModuleRootManager.getInstanceChecked(module).getContentRoots();
    for (    VirtualFile file : files) {
      builder.addDirtyDirRecursively(new FilePathImpl(file));
    }
  }
  final ProjectLevelVcsManager plVcsManager=ProjectLevelVcsManager.getInstance(myProject);
  final String defaultMapping=((ProjectLevelVcsManagerEx)plVcsManager).haveDefaultMapping();
  final boolean haveDefaultMapping=(defaultMapping != null) && (defaultMapping.length() > 0);
  if (haveDefaultMapping) {
    builder.addDirtyFile(new VcsRoot(plVcsManager.findVcsByName(defaultMapping),baseDir));
  }
  final VcsRoot[] vcsRoots=plVcsManager.getAllVcsRoots();
  for (  VcsRoot root : vcsRoots) {
    if (!root.path.equals(baseDir)) {
      builder.addDirtyDirRecursively(root);
    }
  }
}
