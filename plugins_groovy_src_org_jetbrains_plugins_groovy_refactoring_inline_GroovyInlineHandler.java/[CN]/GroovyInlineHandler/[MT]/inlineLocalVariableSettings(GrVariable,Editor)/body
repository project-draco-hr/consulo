{
  final String localName=variable.getNameIdentifierGroovy().getText();
  final Project project=variable.getProject();
  final Collection<PsiReference> refs=ReferencesSearch.search(variable,GlobalSearchScope.projectScope(variable.getProject()),false).findAll();
  ArrayList<PsiElement> exprs=new ArrayList<PsiElement>();
  for (  PsiReference ref : refs) {
    exprs.add(ref.getElement());
  }
  GroovyRefactoringUtil.highlightOccurrences(project,editor,exprs.toArray(PsiElement.EMPTY_ARRAY));
  if (variable.getInitializerGroovy() == null) {
    String message=GroovyRefactoringBundle.message("cannot.find.a.single.definition.to.inline.local.var");
    CommonRefactoringUtil.showErrorMessage(REFACTORING_NAME,message,HelpID.INLINE_VARIABLE,variable.getProject());
    return null;
  }
  if (refs.isEmpty()) {
    String message=GroovyRefactoringBundle.message("variable.is.never.used.0",variable);
    CommonRefactoringUtil.showErrorMessage(REFACTORING_NAME,message,HelpID.INLINE_VARIABLE,variable.getProject());
    return null;
  }
  final String question=GroovyRefactoringBundle.message("inline.local.variable.prompt.0.1",localName,refs.size());
  RefactoringMessageDialog dialog=new RefactoringMessageDialog(REFACTORING_NAME,question,HelpID.INLINE_VARIABLE,"OptionPane.questionIcon",true,project);
  dialog.show();
  if (!dialog.isOK()) {
    WindowManager.getInstance().getStatusBar(project).setInfo(GroovyRefactoringBundle.message("press.escape.to.remove.the.highlighting"));
    return null;
  }
  return new Settings(){
    public boolean isOnlyOneReferenceToInline(){
      return false;
    }
  }
;
}
