{
  if (file.isDirectory()) {
    if (!myFileIndex.getProjectFileIndex().isInContent(file)) {
      return;
    }
    final Collection<VirtualFile> children=create ? Arrays.asList(file.getChildren()) : ((NewVirtualFile)file).getCachedChildren();
    for (    VirtualFile child : children) {
      handleCreateDeleteFile(child,fromRefresh,create);
    }
    return;
  }
  if (myFileIndex.belongs(file)) {
    if (fromRefresh) {
      if (create) {
        myChangedFiles.add(file);
      }
 else {
        myRemovedFiles.add(file);
      }
    }
 else {
      if (create) {
        myFileIndex.updateIndexEntry(file);
      }
 else {
        myFileIndex.removeIndexEntry(file);
      }
    }
  }
}
