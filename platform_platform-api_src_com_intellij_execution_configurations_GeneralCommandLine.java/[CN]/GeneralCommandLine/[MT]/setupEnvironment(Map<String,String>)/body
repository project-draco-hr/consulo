{
  environment.clear();
  if (myParentEnvironmentType != ParentEnvironmentType.NONE) {
    environment.putAll(getParentEnvironment());
  }
  if (SystemInfo.isUnix) {
    File workDirectory=getWorkDirectory();
    if (workDirectory != null) {
      environment.put("PWD",FileUtil.toSystemDependentName(workDirectory.getAbsolutePath()));
    }
  }
  if (!myEnvParams.isEmpty()) {
    if (SystemInfo.isWindows) {
      THashMap<String,String> envVars=new THashMap<>(CaseInsensitiveStringHashingStrategy.INSTANCE);
      envVars.putAll(environment);
      envVars.putAll(myEnvParams);
      environment.clear();
      environment.putAll(envVars);
    }
 else {
      environment.putAll(myEnvParams);
    }
  }
}
