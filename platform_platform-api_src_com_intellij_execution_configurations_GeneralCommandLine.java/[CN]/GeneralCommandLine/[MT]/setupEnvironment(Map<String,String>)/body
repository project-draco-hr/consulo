{
  if (!myPassParentEnvironment) {
    environment.clear();
  }
 else   if (SystemInfo.isMac) {
    String pathEnvVarValue=PathEnvironmentVariableUtil.getFixedPathEnvVarValueOnMac();
    if (pathEnvVarValue != null) {
      environment.put(PathEnvironmentVariableUtil.PATH_ENV_VAR_NAME,pathEnvVarValue);
    }
  }
  if (myEnvParams != null) {
    if (SystemInfo.isWindows) {
      THashMap<String,String> envVars=new THashMap<String,String>(CaseInsensitiveStringHashingStrategy.INSTANCE);
      envVars.putAll(environment);
      envVars.putAll(myEnvParams);
      environment.clear();
      environment.putAll(envVars);
    }
 else {
      environment.putAll(myEnvParams);
    }
  }
}
