{
  final String filePath=getTestFilePath();
  configureByFile(filePath);
  final PsiElement targetElement=TargetElementUtilBase.findTargetElement(getEditor(),TargetElementUtilBase.ELEMENT_NAME_ACCEPTED);
  assertTrue("<caret> is not on method name",targetElement instanceof PsiMethod);
  final PsiMethod psiMethod=(PsiMethod)targetElement;
  try {
    MethodDuplicatesHandler.invokeOnScope(getProject(),psiMethod,new AnalysisScope(getFile()));
  }
 catch (  RuntimeException e) {
    if (shouldSucceed) {
      fail("duplicates were not found");
    }
    return;
  }
  UIUtil.dispatchAllInvocationEvents();
  if (shouldSucceed) {
    checkResultByFile(filePath + ".after");
  }
 else {
    fail("duplicates found");
  }
}
