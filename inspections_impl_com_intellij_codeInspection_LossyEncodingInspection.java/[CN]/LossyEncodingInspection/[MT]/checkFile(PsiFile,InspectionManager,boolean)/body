{
  VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile == null)   return null;
  String text=file.getText();
  Charset charset=LoadTextUtil.getCharsetForWriting(file.getProject(),virtualFile,text);
  for (int i=0; i < text.length(); i++) {
    char c=text.charAt(i);
    String str=Character.toString(c);
    ByteBuffer out=charset.encode(str);
    CharBuffer buffer=charset.decode(out);
    if (!str.equals(buffer.toString())) {
      ProblemDescriptor descriptor=manager.createProblemDescriptor(file,new TextRange(i,i + 1),InspectionsBundle.message("unsupported.character.for.the.charset.0",charset),ProblemHighlightType.GENERIC_ERROR_OR_WARNING);
      return new ProblemDescriptor[]{descriptor};
    }
  }
  return null;
}
