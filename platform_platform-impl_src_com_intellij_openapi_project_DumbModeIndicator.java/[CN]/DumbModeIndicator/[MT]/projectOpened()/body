{
  myProject.getMessageBus().connect().subscribe(DumbService.DUMB_MODE,new DumbService.DumbModeListener(){
    boolean myFirstNotification=true;
    boolean myLogged;
    BalloonHandler myHandler;
    public void enteredDumbMode(){
      final boolean first=myFirstNotification;
      myFirstNotification=false;
      myAlarm.addRequest(new Runnable(){
        @Override public void run(){
          Notifications.Bus.logEvent(DUMB_MODE_MESSAGE,NotificationType.INFORMATION,myProject);
          myLogged=true;
        }
      }
,100);
      myAlarm.addRequest(new Runnable(){
        public void run(){
          if (!NotificationsManagerImpl.isEventLogVisible(myProject)) {
            myHandler=DumbService.getInstance(myProject).showDumbModeNotification(DUMB_MODE_MESSAGE);
          }
        }
      }
,first ? 10000 : 1000);
    }
    public void exitDumbMode(){
      myAlarm.cancelAllRequests();
      if (myHandler != null)       myHandler.hide();
      if (myLogged) {
        Notifications.Bus.logEvent("Indexing finished",NotificationType.INFORMATION,myProject);
      }
      myLogged=false;
      myHandler=null;
      FileEditorManagerEx.getInstanceEx(myProject).refreshIcons();
    }
  }
);
}
