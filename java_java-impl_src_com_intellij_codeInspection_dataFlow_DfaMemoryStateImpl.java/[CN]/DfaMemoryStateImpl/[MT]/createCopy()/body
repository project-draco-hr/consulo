{
  DfaMemoryStateImpl newState=createNew();
  newState.myStack=(Stack<DfaValue>)myStack.clone();
  newState.myDistinctClasses=new TLongHashSet(myDistinctClasses.toArray());
  newState.myEqClasses=new ArrayList<SortedIntSet>();
  newState.myStateSize=myStateSize;
  newState.myVariableStates=new THashMap<DfaVariableValue,DfaVariableState>();
  newState.myOffsetStack=new TIntStack(myOffsetStack);
  newState.myHasDirtyFields=myHasDirtyFields;
  for (int i=0; i < myEqClasses.size(); i++) {
    SortedIntSet aClass=myEqClasses.get(i);
    newState.myEqClasses.add(aClass != null ? new SortedIntSet(aClass.toNativeArray()) : null);
  }
  try {
    for (    Object o : myVariableStates.keySet()) {
      DfaVariableValue dfaVariableValue=(DfaVariableValue)o;
      DfaVariableState clone=(DfaVariableState)myVariableStates.get(dfaVariableValue).clone();
      newState.myVariableStates.put(dfaVariableValue,clone);
    }
  }
 catch (  CloneNotSupportedException e) {
    LOG.error(e);
  }
  return newState;
}
