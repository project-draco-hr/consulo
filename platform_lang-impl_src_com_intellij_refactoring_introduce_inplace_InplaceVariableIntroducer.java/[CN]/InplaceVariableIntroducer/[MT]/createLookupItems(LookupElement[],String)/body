{
  TemplateState templateState=TemplateManagerImpl.getTemplateState(myEditor);
  final PsiNamedElement psiVariable=getVariable();
  if (psiVariable != null) {
    final TextResult insertedValue=templateState != null ? templateState.getVariableValue(PRIMARY_VARIABLE_NAME) : null;
    if (insertedValue != null) {
      final String text=insertedValue.getText();
      if (!text.isEmpty() && !Comparing.strEqual(text,name)) {
        final LinkedHashSet<String> names=new LinkedHashSet<String>();
        names.add(text);
        for (        NameSuggestionProvider provider : Extensions.getExtensions(NameSuggestionProvider.EP_NAME)) {
          final SuggestedNameInfo suggestedNameInfo=provider.getSuggestedNames(psiVariable,psiVariable,names);
          if (suggestedNameInfo != null && provider instanceof PreferrableNameSuggestionProvider && !((PreferrableNameSuggestionProvider)provider).shouldCheckOthers())           break;
        }
        final LookupElement[] items=new LookupElement[names.size()];
        final Iterator<String> iterator=names.iterator();
        for (int i=0; i < items.length; i++) {
          items[i]=LookupElementBuilder.create(iterator.next());
        }
        return items;
      }
    }
  }
  return lookupItems;
}
