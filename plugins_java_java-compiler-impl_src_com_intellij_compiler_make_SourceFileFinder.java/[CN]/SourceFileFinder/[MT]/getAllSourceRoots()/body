{
  if (myProjectSourceRoots == null) {
    myProjectSourceRoots=new HashMap<VirtualFile,String>();
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      public void run(){
        final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(myProject).getFileIndex();
        final Module[] allModules=ModuleManager.getInstance(myProject).getModules();
        for (        Module allModule : allModules) {
          final VirtualFile[] sourceRoots=myCompileContext.getSourceRoots(allModule);
          for (          final VirtualFile sourceRoot : sourceRoots) {
            String packageName=fileIndex.getPackageNameByDirectory(sourceRoot);
            myProjectSourceRoots.put(sourceRoot,packageName == null || packageName.length() == 0 ? "" : "/" + packageName.replace('.','/') + "/");
          }
        }
      }
    }
);
  }
  return myProjectSourceRoots;
}
