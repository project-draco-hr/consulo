{
  final JpsArtifact artifact=element.getArtifactReference().resolve();
  if (artifact == null)   return;
  final String outputPath=artifact.getOutputPath();
  if (StringUtil.isEmpty(outputPath)) {
    try {
      if (builderContext.enterArtifact(artifact)) {
        generateSubstitutionInstructions(element,instructionCreator,builderContext);
      }
    }
  finally {
      builderContext.leaveArtifact(artifact);
    }
    return;
  }
  final JpsPackagingElement rootElement=artifact.getRootElement();
  final File outputDir=new File(FileUtil.toSystemDependentName(outputPath));
  if (rootElement instanceof JpsArchivePackagingElement) {
    final String fileName=((JpsArchivePackagingElement)rootElement).getArchiveName();
    instructionCreator.addFileCopyInstruction(new File(outputDir,fileName),fileName);
  }
 else {
    instructionCreator.addDirectoryCopyInstructions(outputDir);
  }
}
