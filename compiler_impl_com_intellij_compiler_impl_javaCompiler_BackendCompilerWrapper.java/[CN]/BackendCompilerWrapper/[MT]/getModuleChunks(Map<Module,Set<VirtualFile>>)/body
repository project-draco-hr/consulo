{
  final List<Module> modules=new ArrayList<Module>(moduleToFilesMap.keySet());
  final List<Chunk<Module>> chunks=ApplicationManager.getApplication().runReadAction(new Computable<List<Chunk<Module>>>(){
    public List<Chunk<Module>> compute(){
      return ModuleCompilerUtil.getSortedModuleChunks(myProject,modules.toArray(new Module[modules.size()]));
    }
  }
);
  final List<ModuleChunk> moduleChunks=new ArrayList<ModuleChunk>(chunks.size());
  for (Iterator<Chunk<Module>> it=chunks.iterator(); it.hasNext(); ) {
    moduleChunks.add(new ModuleChunk(myCompileContext,it.next(),moduleToFilesMap));
  }
  return moduleChunks;
}
