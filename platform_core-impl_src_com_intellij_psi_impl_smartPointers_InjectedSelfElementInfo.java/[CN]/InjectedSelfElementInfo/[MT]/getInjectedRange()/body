{
  PsiFile hostFile=myHostContext.getContainingFile();
  if (hostFile == null || !hostFile.isValid())   return null;
  PsiElement hostContext=myHostContext.getElement();
  if (hostContext == null)   return null;
  Segment hostElementRange=myInjectedFileRangeInHostFile.getRange();
  if (hostElementRange == null)   return null;
  PsiFile injectedFile=restoreFile();
  if (injectedFile == null)   return null;
  VirtualFile virtualFile=injectedFile.getVirtualFile();
  DocumentWindow documentWindow=virtualFile instanceof VirtualFileWindow ? ((VirtualFileWindow)virtualFile).getDocumentWindow() : null;
  if (documentWindow == null)   return null;
  int start=documentWindow.hostToInjected(hostElementRange.getStartOffset());
  int end=documentWindow.hostToInjected(hostElementRange.getEndOffset());
  return ProperTextRange.create(start,end);
}
