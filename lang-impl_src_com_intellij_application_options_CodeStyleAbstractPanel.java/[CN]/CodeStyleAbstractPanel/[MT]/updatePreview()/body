{
  if (!myShouldUpdatePreview || !myEditor.getComponent().isShowing()) {
    return;
  }
  if (myLastDocumentModificationStamp != myEditor.getDocument().getModificationStamp()) {
    myTextToReformat=myEditor.getDocument().getText();
  }
  Project project=PlatformDataKeys.PROJECT.getData(DataManager.getInstance().getDataContext());
  if (project == null) {
    project=ProjectManager.getInstance().getDefaultProject();
  }
  final Project finalProject=project;
  CommandProcessor.getInstance().executeCommand(finalProject,new Runnable(){
    public void run(){
      replaceText(finalProject);
    }
  }
,null,null);
  myEditor.getSettings().setRightMargin(getRightMargin());
  myLastDocumentModificationStamp=myEditor.getDocument().getModificationStamp();
}
