{
  final PsiWhileStatement whileStatement=(PsiWhileStatement)element.getParent();
  if (whileStatement == null) {
    return;
  }
  final PsiExpression condition=whileStatement.getCondition();
  if (condition == null) {
    return;
  }
  final String conditionText=condition.getText();
  final PsiManager manager=whileStatement.getManager();
  final PsiElementFactory factory=manager.getElementFactory();
  final PsiExpression newCondition=factory.createExpressionFromText("true",whileStatement);
  condition.replace(newCondition);
  final PsiStatement body=whileStatement.getBody();
  final String ifStatementText="if (!(" + conditionText + ")) break;";
  final PsiStatement ifStatement=factory.createStatementFromText(ifStatementText,whileStatement);
  final PsiElement newElement;
  if (body instanceof PsiBlockStatement) {
    final PsiBlockStatement blockStatement=(PsiBlockStatement)body;
    final PsiCodeBlock codeBlock=blockStatement.getCodeBlock();
    final PsiElement bodyElement=codeBlock.getFirstBodyElement();
    newElement=codeBlock.addBefore(ifStatement,bodyElement);
  }
 else   if (body != null) {
    final PsiBlockStatement blockStatement=(PsiBlockStatement)factory.createStatementFromText("{}",whileStatement);
    final PsiCodeBlock codeBlock=blockStatement.getCodeBlock();
    codeBlock.add(ifStatement);
    if (!(body instanceof PsiEmptyStatement)) {
      codeBlock.add(body);
    }
    newElement=body.replace(blockStatement);
  }
 else {
    return;
  }
  final CodeStyleManager codeStyleManager=manager.getCodeStyleManager();
  codeStyleManager.reformat(newElement);
}
