{
  if (element == null)   return PsiElement.EMPTY_ARRAY;
  final PsiElement[][] result=new PsiElement[1][];
  if (!ProgressManager.getInstance().runProcessWithProgressSynchronously(new Runnable(){
    public void run(){
      result[0]=DefinitionsSearch.search(element).toArray(PsiElement.EMPTY_ARRAY);
    }
  }
,CodeInsightBundle.message("searching.for.implementations"),true,element.getProject())) {
    return PsiElement.EMPTY_ARRAY;
  }
  if (result[0] != null && result[0].length > 0) {
    if (!includeSelfAlways)     return filterElements(editor,file,element,result[0]);
    PsiElement[] all=new PsiElement[result[0].length + 1];
    all[0]=element;
    System.arraycopy(result[0],0,all,1,result[0].length);
    return filterElements(editor,file,element,all);
  }
  return includeSelfAlways || includeSelfIfNoOthers ? new PsiElement[]{element} : PsiElement.EMPTY_ARRAY;
}
