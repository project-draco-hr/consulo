{
  if (element == null)   return PsiElement.EMPTY_ARRAY;
  final PsiElement[] elements=searchDefinitions(element);
  if (elements.length > 0) {
    if (!includeSelfAlways)     return filterElements(editor,file,element,elements,offset);
    PsiElement[] all=new PsiElement[elements.length + 1];
    all[0]=element;
    System.arraycopy(elements,0,all,1,elements.length);
    return filterElements(editor,file,element,all,offset);
  }
  return includeSelfAlways || includeSelfIfNoOthers ? new PsiElement[]{element} : PsiElement.EMPTY_ARRAY;
}
