{
  final Module module=ModuleUtilCore.findModuleForFile(file,project);
  if (module != null) {
    return collapse2eclipsePathRelative2Module(file,module);
  }
 else {
    final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
    if (fileIndex.isIgnored(file) || fileIndex.isInLibraryClasses(file)) {
      for (      Module aModule : ModuleManager.getInstance(project).getModules()) {
        final String path=collapse2eclipsePathRelative2Module(file,aModule);
        if (path != null) {
          return path;
        }
      }
    }
  }
  return null;
}
