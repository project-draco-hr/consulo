{
  final VirtualFile[] virtualFiles=libraryOrderEntry.getFiles(OrderRootType.CLASSES);
  if (virtualFiles.length > 0) {
    VirtualFile jarFile=virtualFiles[0];
    if (jarFile.getFileSystem() instanceof JarFileSystem) {
      jarFile=JarFileSystem.getInstance().getVirtualFileForJar(jarFile);
    }
    if (jarFile == null) {
      return null;
    }
    final Project project=libraryOrderEntry.getOwnerModule().getProject();
    final VirtualFile baseDir=project.getBaseDir();
    if (baseDir != null && !VfsUtil.isAncestor(baseDir,jarFile,false)) {
      final String ideaCollapsed=PathMacroManager.getInstance(project).collapsePath(jarFile.getPath());
      if (ideaCollapsed.contains(".."))       return null;
      return ideaCollapsed.substring(ideaCollapsed.indexOf('$')).replace("$","");
    }
  }
  return null;
}
