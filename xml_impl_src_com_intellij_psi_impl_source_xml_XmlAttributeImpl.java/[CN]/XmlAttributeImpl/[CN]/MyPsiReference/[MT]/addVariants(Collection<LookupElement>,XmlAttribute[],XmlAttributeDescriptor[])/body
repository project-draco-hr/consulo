{
  final XmlTag tag=getParent();
  final XmlExtension extension=XmlExtension.getExtension(tag.getContainingFile());
  final String prefix=getName().contains(":") && getRealLocalName().length() > 0 ? getNamespacePrefix() + ":" : null;
  CompletionData completionData=CompletionUtil.getCompletionDataByElement(XmlAttributeImpl.this,getContainingFile().getOriginalFile());
  boolean caseSensitive=!(completionData instanceof HtmlCompletionData) || ((HtmlCompletionData)completionData).isCaseSensitive();
  for (  XmlAttributeDescriptor descriptor : descriptors) {
    if (isValidVariant(descriptor,attributes,extension)) {
      String name=descriptor.getName(tag);
      if (prefix == null || name.startsWith(prefix)) {
        if (prefix != null && name.length() > prefix.length()) {
          name=descriptor.getName(tag).substring(prefix.length());
        }
        LookupElementBuilder element=LookupElementBuilder.create(name);
        if (descriptor instanceof PsiPresentableMetaData) {
          element=element.withIcon(((PsiPresentableMetaData)descriptor).getIcon());
        }
        final int separator=name.indexOf(':');
        if (separator > 0) {
          element=element.withLookupString(name.substring(separator + 1));
        }
        variants.add(element.withCaseSensitivity(caseSensitive).withInsertHandler(XmlAttributeInsertHandler.INSTANCE));
      }
    }
  }
}
