{
  final XmlTag tag=getParent();
  final XmlExtension extension=XmlExtension.getExtension(tag.getContainingFile());
  final String prefix=getName().contains(":") && getRealLocalName().length() > 0 ? getNamespacePrefix() + ":" : null;
  for (  XmlAttributeDescriptor descriptor : descriptors) {
    if (isValidVariant(descriptor,attributes,extension)) {
      String name=descriptor.getName(tag);
      if (prefix == null || name.startsWith(prefix)) {
        if (prefix != null && name.length() > prefix.length()) {
          name=descriptor.getName(tag).substring(prefix.length());
        }
        final MutableLookupElement<String> element=LookupElementFactory.getInstance().createLookupElement(name);
        if (descriptor instanceof PsiPresentableMetaData) {
          element.setIcon(((PsiPresentableMetaData)descriptor).getIcon());
        }
        final int separator=name.indexOf(':');
        if (separator > 0) {
          element.addLookupStrings(name.substring(separator + 1));
        }
        element.setInsertHandler(XmlAttributeInsertHandler.INSTANCE);
        variants.add(element);
      }
    }
  }
}
