{
  final List<LookupElement<String>> variants=new ArrayList<LookupElement<String>>();
  final XmlElementDescriptor parentDescriptor=getParent().getDescriptor();
  if (parentDescriptor != null) {
    final XmlTag declarationTag=getParent();
    final XmlAttribute[] attributes=declarationTag.getAttributes();
    XmlAttributeDescriptor[] descriptors=parentDescriptor.getAttributesDescriptors(declarationTag);
    descriptors=HtmlUtil.appendHtmlSpecificAttributeCompletions(declarationTag,descriptors,XmlAttributeImpl.this);
    addVariants(variants,attributes,descriptors);
    XmlTag tag=declarationTag;
    final Set<String> processed=new THashSet<String>();
    while (tag != null) {
      if (tag instanceof XmlTagImpl) {
        final Map<String,CachedValue<XmlNSDescriptor>> map=((XmlTagImpl)tag).initNSDescriptorsMap();
        for (        final String s : map.keySet()) {
          if (!processed.contains(s)) {
            processed.add(s);
            final XmlNSDescriptor descriptor=map.get(s).getValue();
            if (descriptor instanceof XmlNSDescriptorEx) {
              addVariants(variants,attributes,((XmlNSDescriptorEx)descriptor).getAttributeDescriptors(declarationTag));
            }
          }
        }
      }
      tag=tag.getParentTag();
    }
  }
  return variants.toArray();
}
