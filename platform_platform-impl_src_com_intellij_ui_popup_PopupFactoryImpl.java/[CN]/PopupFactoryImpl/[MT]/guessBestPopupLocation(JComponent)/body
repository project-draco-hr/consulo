{
  Point popupMenuPoint=null;
  final Rectangle visibleRect=component.getVisibleRect();
  if (component instanceof JList) {
    JList list=(JList)component;
    int firstVisibleIndex=list.getFirstVisibleIndex();
    int lastVisibleIndex=list.getLastVisibleIndex();
    int[] selectedIndices=list.getSelectedIndices();
    for (    int index : selectedIndices) {
      if (firstVisibleIndex <= index && index <= lastVisibleIndex) {
        Rectangle cellBounds=list.getCellBounds(index,index);
        popupMenuPoint=new Point(visibleRect.x + visibleRect.width / 4,cellBounds.y + cellBounds.height);
        break;
      }
    }
  }
 else   if (component instanceof JTree) {
    JTree tree=(JTree)component;
    int[] selectionRows=tree.getSelectionRows();
    for (int i=0; selectionRows != null && i < selectionRows.length; i++) {
      int row=selectionRows[i];
      Rectangle rowBounds=tree.getRowBounds(row);
      if (visibleRect.y <= rowBounds.y && rowBounds.y <= visibleRect.y + visibleRect.height) {
        popupMenuPoint=new Point(visibleRect.x + visibleRect.width / 4,rowBounds.y + rowBounds.height);
        break;
      }
    }
  }
 else   if (component instanceof PopupOwner) {
    popupMenuPoint=((PopupOwner)component).getBestPopupPosition();
  }
  if (popupMenuPoint == null) {
    popupMenuPoint=new Point(visibleRect.x + visibleRect.width / 2,visibleRect.y + visibleRect.height / 2);
  }
  return new RelativePoint(component,popupMenuPoint);
}
