{
  Component component=PlatformDataKeys.CONTEXT_COMPONENT.getData(dataContext);
  JComponent focusOwner=component instanceof JComponent ? (JComponent)component : null;
  if (focusOwner == null) {
    Project project=CommonDataKeys.PROJECT.getData(dataContext);
    IdeFrameImpl frame=project == null ? null : ((WindowManagerEx)WindowManager.getInstance()).getFrame(project);
    focusOwner=frame == null ? null : frame.getRootPane();
    if (focusOwner == null) {
      throw new IllegalArgumentException("focusOwner cannot be null");
    }
  }
  final Point point=PlatformDataKeys.CONTEXT_MENU_POINT.getData(dataContext);
  if (point != null) {
    return new RelativePoint(focusOwner,point);
  }
  Editor editor=CommonDataKeys.EDITOR.getData(dataContext);
  if (editor != null && focusOwner == editor.getContentComponent()) {
    return guessBestPopupLocation(editor);
  }
 else {
    return guessBestPopupLocation(focusOwner);
  }
}
