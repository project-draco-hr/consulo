{
  if (!actionChoice.isEnabled())   return FINAL_CHOICE;
  final AnAction action=actionChoice.getAction();
  final DataContext dataContext=DataManager.getInstance().getDataContext(myContext);
  if (action instanceof ActionGroup && (!finalChoice || !((ActionGroup)action).canBePerformed())) {
    return JBPopupFactory.getInstance().createActionsStep((ActionGroup)action,dataContext,myEnableMnemonics,false,null,myContext,false);
  }
 else {
    myFinalRunnable=new Runnable(){
      public void run(){
        action.actionPerformed(new AnActionEvent(null,dataContext,ActionPlaces.UNKNOWN,(Presentation)action.getTemplatePresentation().clone(),ActionManager.getInstance(),0));
      }
    }
;
    return FINAL_CHOICE;
  }
}
