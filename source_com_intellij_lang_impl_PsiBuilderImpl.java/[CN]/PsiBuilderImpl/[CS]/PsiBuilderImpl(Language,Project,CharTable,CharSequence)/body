{
  myText=text;
  ParserDefinition parserDefinition=lang.getParserDefinition(project);
  myLexer=parserDefinition.createLexer();
  myWhitespaces=parserDefinition.getWhitespaceTokens() != null ? parserDefinition.getWhitespaceTokens() : TokenSet.EMPTY;
  myComments=parserDefinition.getCommentTokens() != null ? parserDefinition.getCommentTokens() : TokenSet.EMPTY;
  myCharTable=charTable;
  myFileLevelParsing=myCharTable == null;
  char[] chars=CharArrayUtil.fromSequence(text);
  myLexer.start(chars,0,text.length());
}
