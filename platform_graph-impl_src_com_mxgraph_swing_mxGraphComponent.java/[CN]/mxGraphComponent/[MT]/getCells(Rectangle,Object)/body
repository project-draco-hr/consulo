{
  Collection<Object> result=new ArrayList<Object>();
  if (rect.width > 0 || rect.height > 0) {
    if (parent == null) {
      parent=graph.getDefaultParent();
    }
    if (parent != null) {
      Point previousTranslate=canvas.getTranslate();
      double previousScale=canvas.getScale();
      try {
        canvas.setScale(graph.getView().getScale());
        canvas.setTranslate(0,0);
        mxIGraphModel model=graph.getModel();
        mxGraphView view=graph.getView();
        int childCount=model.getChildCount(parent);
        for (int i=0; i < childCount; i++) {
          Object cell=model.getChildAt(parent,i);
          mxCellState state=view.getState(cell);
          if (graph.isCellVisible(cell) && state != null) {
            if (canvas.contains(this,rect,state)) {
              result.add(cell);
            }
 else {
              result.addAll(Arrays.asList(getCells(rect,cell)));
            }
          }
        }
      }
  finally {
        canvas.setScale(previousScale);
        canvas.setTranslate(previousTranslate.x,previousTranslate.y);
      }
    }
  }
  return result.toArray();
}
