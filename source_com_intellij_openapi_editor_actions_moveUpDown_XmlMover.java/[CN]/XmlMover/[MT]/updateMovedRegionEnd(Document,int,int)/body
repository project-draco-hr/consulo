{
  final int line=document.getLineNumber(valueStart);
  int delta=line - toMove.endLine;
  toMove=new LineRange(toMove.startLine,Math.max(line,toMove.endLine));
  if (delta > 0 && isDown) {
    toMove2=new LineRange(toMove2.startLine + delta,Math.min(toMove2.endLine + delta,document.getLineCount() - 1));
    movedLineStart=document.getLineStartOffset(toMove.startLine);
  }
  return movedLineStart;
}
