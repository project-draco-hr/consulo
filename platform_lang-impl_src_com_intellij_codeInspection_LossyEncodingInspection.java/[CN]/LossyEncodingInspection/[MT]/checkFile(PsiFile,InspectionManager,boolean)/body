{
  if (InjectedLanguageManager.getInstance(file.getProject()).isInjectedFragment(file))   return null;
  if (ArrayUtil.find(file.getPsiRoots(),file) != 0)   return null;
  VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile == null)   return null;
  String text=file.getText();
  Charset charset=LoadTextUtil.extractCharsetFromFileContent(file.getProject(),virtualFile,text);
  if (charset instanceof Native2AsciiCharset)   return null;
  List<ProblemDescriptor> descriptors=new SmartList<ProblemDescriptor>();
  checkIfCharactersWillBeLostAfterSave(file,manager,isOnTheFly,text,charset,descriptors);
  checkForFileLoadedInWrongEncoding(file,manager,isOnTheFly,virtualFile,charset,descriptors);
  return descriptors.toArray(new ProblemDescriptor[descriptors.size()]);
}
