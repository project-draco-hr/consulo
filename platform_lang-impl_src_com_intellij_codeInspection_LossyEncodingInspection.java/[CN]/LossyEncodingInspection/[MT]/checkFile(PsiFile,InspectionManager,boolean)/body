{
  if (InjectedLanguageManager.getInstance(file.getProject()).isInjectedFragment(file))   return null;
  if (!file.isPhysical())   return null;
  FileViewProvider viewProvider=file.getViewProvider();
  if (viewProvider.getBaseLanguage() != file.getLanguage())   return null;
  VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile == null)   return null;
  if (!virtualFile.isInLocalFileSystem())   return null;
  CharSequence text=viewProvider.getContents();
  Charset charset=LoadTextUtil.extractCharsetFromFileContent(file.getProject(),virtualFile,text);
  if (charset instanceof Native2AsciiCharset)   return null;
  List<ProblemDescriptor> descriptors=new SmartList<ProblemDescriptor>();
  boolean ok=checkFileLoadedInWrongEncoding(file,manager,isOnTheFly,virtualFile,charset,descriptors);
  if (ok) {
    checkIfCharactersWillBeLostAfterSave(file,manager,isOnTheFly,text,charset,descriptors);
  }
  return descriptors.toArray(new ProblemDescriptor[descriptors.size()]);
}
