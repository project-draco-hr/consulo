{
  FileDocumentManager documentManager=FileDocumentManager.getInstance();
  Document document=documentManager.getDocument(virtualFile);
  if (document == null)   return true;
  byte[] loadedBytes;
  byte[] bytesToSave;
  try {
    loadedBytes=virtualFile.contentsToByteArray();
    bytesToSave=new String(loadedBytes,charset).getBytes(charset);
  }
 catch (  Exception e) {
    return true;
  }
  byte[] bom=virtualFile.getBOM();
  if (bom != null && !ArrayUtil.startsWith(bytesToSave,bom)) {
    bytesToSave=ArrayUtil.mergeArrays(bom,bytesToSave);
  }
  boolean equals=Arrays.equals(bytesToSave,loadedBytes);
  if (!equals && LOG.isDebugEnabled()) {
    try {
      FileUtil.writeToFile(new File("C:\\temp\\bytesToSave"),bytesToSave);
      FileUtil.writeToFile(new File("C:\\temp\\loadedBytes"),loadedBytes);
    }
 catch (    IOException e) {
      throw new RuntimeException(e);
    }
  }
  return equals;
}
