{
  if (FileDocumentManager.getInstance().isFileModified(virtualFile) || EncodingUtil.checkCanReload(virtualFile).second != null) {
    return true;
  }
  if (!isGoodCharset(virtualFile,text,charset,file.getProject())) {
    descriptors.add(manager.createProblemDescriptor(file,"File was loaded in the wrong encoding: '" + charset + "'",RELOAD_ENCODING_FIX,ProblemHighlightType.GENERIC_ERROR,isOnTheFly));
    return false;
  }
  return true;
}
