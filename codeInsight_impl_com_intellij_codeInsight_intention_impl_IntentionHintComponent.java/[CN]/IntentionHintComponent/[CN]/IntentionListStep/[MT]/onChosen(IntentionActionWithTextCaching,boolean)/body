{
  if (finalChoice && !(action.getAction() instanceof EmptyIntentionAction)) {
    applyAction(action.getAction());
    return PopupStep.FINAL_CHOICE;
  }
  if (hasSubstep(action)) {
    return getSubStep(action);
  }
  return FINAL_CHOICE;
}
