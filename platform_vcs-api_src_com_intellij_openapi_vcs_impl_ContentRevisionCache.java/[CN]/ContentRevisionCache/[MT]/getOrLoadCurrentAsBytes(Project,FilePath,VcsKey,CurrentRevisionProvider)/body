{
  ContentRevisionCache cache=ProjectLevelVcsManager.getInstance(project).getContentRevisionCache();
  VcsRevisionNumber currentRevision;
  Pair<VcsRevisionNumber,byte[]> loaded;
  while (true) {
    currentRevision=putIntoCurrentCache(cache,path,vcsKey,loader);
    final byte[] cachedCurrent=cache.getBytes(path,currentRevision,vcsKey,UniqueType.REPOSITORY_CONTENT);
    if (cachedCurrent != null) {
      return new Pair<VcsRevisionNumber,byte[]>(currentRevision,cachedCurrent);
    }
    loaded=loader.get();
    if (loaded.getFirst().equals(currentRevision))     break;
  }
  cache.put(path,currentRevision,vcsKey,UniqueType.REPOSITORY_CONTENT,loaded.getSecond());
  return loaded;
}
