{
  Annotated annotated=check(method,holder,method.getReturnType());
  PsiParameter[] parameters=method.getParameterList().getParameters();
  List<MethodSignatureBackedByPsiMethod> superMethodSignatures=method.findSuperMethodSignaturesIncludingStatic(true);
  boolean reported_not_annotated_method_overrides_notnull=false;
  boolean reported_nullable_method_overrides_notnull=false;
  boolean[] reported_notnull_parameter_overrides_nullable=new boolean[parameters.length];
  boolean[] reported_not_annotated_parameter_overrides_notnull=new boolean[parameters.length];
  for (  MethodSignatureBackedByPsiMethod superMethodSignature : superMethodSignatures) {
    PsiMethod superMethod=superMethodSignature.getMethod();
    if (!reported_nullable_method_overrides_notnull && REPORT_NULLABLE_METHOD_OVERRIDES_NOTNULL && annotated.isDeclaredNullable&& AnnotationUtil.isNotNull(superMethod)) {
      reported_nullable_method_overrides_notnull=true;
      holder.registerProblem(method.getNameIdentifier(),InspectionsBundle.message("inspection.nullable.problems.Nullable.method.overrides.NotNull"),ProblemHighlightType.GENERIC_ERROR_OR_WARNING);
    }
    if (!reported_not_annotated_method_overrides_notnull && REPORT_NOT_ANNOTATED_METHOD_OVERRIDES_NOTNULL && !annotated.isDeclaredNullable&& !annotated.isDeclaredNotNull&& AnnotationUtil.isNotNull(superMethod)) {
      reported_not_annotated_method_overrides_notnull=true;
      holder.registerProblem(method.getNameIdentifier(),InspectionsBundle.message("inspection.nullable.problems.method.overrides.NotNull"),ProblemHighlightType.GENERIC_ERROR_OR_WARNING,new AnnotateMethodFix(AnnotationUtil.NOT_NULL){
        public int annotateBaseMethod(        final PsiMethod method,        final PsiMethod superMethod,        final Project project){
          return NullableStuffInspection.this.annotateBaseMethod(method,superMethod,project);
        }
      }
);
    }
    if (REPORT_NOTNULL_PARAMETER_OVERRIDES_NULLABLE || REPORT_NOT_ANNOTATED_PARAMETER_OVERRIDES_NOTNULL) {
      PsiParameter[] superParameters=superMethod.getParameterList().getParameters();
      if (superParameters.length != parameters.length) {
        continue;
      }
      for (int i=0; i < parameters.length; i++) {
        PsiParameter parameter=parameters[i];
        PsiParameter superParameter=superParameters[i];
        if (!reported_notnull_parameter_overrides_nullable[i] && REPORT_NOTNULL_PARAMETER_OVERRIDES_NULLABLE && AnnotationUtil.isAnnotated(parameter,AnnotationUtil.NOT_NULL,false)&& AnnotationUtil.isAnnotated(superParameter,AnnotationUtil.NULLABLE,false)) {
          reported_notnull_parameter_overrides_nullable[i]=true;
          holder.registerProblem(parameter.getNameIdentifier(),InspectionsBundle.message("inspection.nullable.problems.NotNull.parameter.overrides.Nullable"),ProblemHighlightType.GENERIC_ERROR_OR_WARNING);
        }
        if (!reported_not_annotated_parameter_overrides_notnull[i] && REPORT_NOT_ANNOTATED_PARAMETER_OVERRIDES_NOTNULL && !AnnotationUtil.isAnnotated(parameter,AnnotationUtil.NOT_NULL,false)&& !AnnotationUtil.isAnnotated(parameter,AnnotationUtil.NULLABLE,false)&& AnnotationUtil.isAnnotated(superParameter,AnnotationUtil.NOT_NULL,false)) {
          reported_not_annotated_parameter_overrides_notnull[i]=true;
          holder.registerProblem(parameter.getNameIdentifier(),InspectionsBundle.message("inspection.nullable.problems.parameter.overrides.NotNull"),ProblemHighlightType.GENERIC_ERROR_OR_WARNING,new AddAnnotationFix(AnnotationUtil.NOT_NULL,parameter));
        }
      }
    }
  }
  if (REPORT_ANNOTATION_NOT_PROPAGATED_TO_OVERRIDERS) {
    boolean[] parameterAnnotated=new boolean[parameters.length];
    boolean[] parameterQuickFixSuggested=new boolean[parameters.length];
    boolean hasAnnotatedParameter=false;
    for (int i=0; i < parameters.length; i++) {
      PsiParameter parameter=parameters[i];
      parameterAnnotated[i]=AnnotationUtil.isAnnotated(parameter,AnnotationUtil.NOT_NULL,false);
      hasAnnotatedParameter|=parameterAnnotated[i];
    }
    if (hasAnnotatedParameter || annotated.isDeclaredNotNull) {
      PsiManager manager=method.getManager();
      PsiMethod[] overridings=manager.getSearchHelper().findOverridingMethods(method,GlobalSearchScope.allScope(manager.getProject()),true);
      boolean methodQuickFixSuggested=false;
      for (      PsiMethod overriding : overridings) {
        if (!manager.isInProject(overriding))         continue;
        if (!methodQuickFixSuggested && annotated.isDeclaredNotNull && !AnnotationUtil.isAnnotated(overriding,AnnotationUtil.NOT_NULL,false)) {
          PsiAnnotation annotation=AnnotationUtil.findAnnotation(method,AnnotationUtil.NOT_NULL);
          holder.registerProblem(annotation,InspectionsBundle.message("nullable.stuff.problems.overridden.methods.are.not.annotated"),ProblemHighlightType.GENERIC_ERROR_OR_WARNING,ANNOTATE_OVERRIDDEN_METHODS_FIX);
          methodQuickFixSuggested=true;
        }
        if (hasAnnotatedParameter) {
          PsiParameter[] psiParameters=overriding.getParameterList().getParameters();
          for (int i=0; i < psiParameters.length; i++) {
            if (parameterQuickFixSuggested[i])             continue;
            PsiParameter parameter=psiParameters[i];
            if (parameterAnnotated[i] && !AnnotationUtil.isAnnotated(parameter,AnnotationUtil.NOT_NULL,false)) {
              PsiAnnotation annotation=AnnotationUtil.findAnnotation(parameters[i],AnnotationUtil.NOT_NULL);
              holder.registerProblem(annotation,InspectionsBundle.message("nullable.stuff.problems.overridden.method.parameters.are.not.annotated"),ProblemHighlightType.GENERIC_ERROR_OR_WARNING,ANNOTATE_OVERRIDDEN_METHODS_PARAMS_FIX);
              parameterQuickFixSuggested[i]=true;
            }
          }
        }
      }
    }
  }
}
