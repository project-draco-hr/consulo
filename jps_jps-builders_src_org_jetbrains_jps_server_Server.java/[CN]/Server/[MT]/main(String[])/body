{
  try {
    int port=DEFAULT_SERVER_PORT;
    File systemDir=null;
    if (args.length > 0) {
      try {
        port=Integer.parseInt(args[0]);
      }
 catch (      NumberFormatException e) {
        System.err.println("Error parsing port: " + e.getMessage());
        System.exit(-1);
      }
      systemDir=new File(args[1]);
    }
    final Server server=new Server(systemDir);
    Runtime.getRuntime().addShutdownHook(new Thread("Shutdown hook thread"){
      public void run(){
        try {
          server.myMessageHandler.cancelAllBuildsAndClearState();
        }
  finally {
          server.stop();
        }
      }
    }
);
    initLoggers();
    server.start(port);
    ServerState.getInstance().setKeepTempCachesInMemory(System.getProperty(GlobalOptions.USE_MEMORY_TEMP_CACHE_OPTION) != null);
    System.out.println("Server classpath: " + System.getProperty("java.class.path"));
    System.err.println(SERVER_SUCCESS_START_MESSAGE + port);
  }
 catch (  Throwable e) {
    System.err.println(SERVER_ERROR_START_MESSAGE + e.getMessage());
    e.printStackTrace(System.err);
    System.exit(-1);
  }
}
