{
  Presentation presentation=event.getPresentation();
  String s=IdeBundle.message("action.toggle.bookmark");
  DataContext dataContext=event.getDataContext();
  Project project=(Project)dataContext.getData(DataConstants.PROJECT);
  if (project == null) {
    presentation.setEnabled(false);
    presentation.setText(s);
    return;
  }
  if (ToolWindowManager.getInstance(project).isEditorComponentActive()) {
    presentation.setEnabled(dataContext.getData(DataConstants.EDITOR) != null);
    presentation.setText(s);
    return;
  }
  ProjectView projectView=ProjectView.getInstance(project);
  presentation.setText(IdeBundle.message("action.set.bookmark"));
  String id=ToolWindowManager.getInstance(project).getActiveToolWindowId();
  if (ToolWindowId.PROJECT_VIEW.equals(id)) {
    presentation.setEnabled(projectView.getParentOfCurrentSelection() != null);
  }
 else   if (ToolWindowId.COMMANDER.equals(id)) {
    final AbstractTreeNode parentNode=Commander.getInstance(project).getActivePanel().getBuilder().getParentNode();
    final Object parentElement=parentNode != null ? parentNode.getValue() : null;
    presentation.setEnabled(parentElement instanceof PsiElement);
  }
 else {
    presentation.setEnabled(false);
  }
}
