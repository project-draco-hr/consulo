{
  DataContext dataContext=e.getDataContext();
  Project project=(Project)dataContext.getData(DataConstants.PROJECT);
  if (project == null)   return;
  BookmarkManager bookmarkManager=BookmarkManager.getInstance(project);
  if (ToolWindowManager.getInstance(project).isEditorComponentActive()) {
    Editor editor=(Editor)dataContext.getData(DataConstants.EDITOR);
    if (editor != null) {
      EditorBookmark bookmark=bookmarkManager.findEditorBookmark(editor.getDocument(),editor.getCaretModel().getLogicalPosition().line);
      if (bookmark == null) {
        bookmarkManager.addEditorBookmark(editor,editor.getCaretModel().getLogicalPosition().line,EditorBookmark.NOT_NUMBERED);
      }
 else {
        bookmarkManager.removeBookmark(bookmark);
      }
    }
    return;
  }
  String id=ToolWindowManager.getInstance(project).getActiveToolWindowId();
  if (ToolWindowId.PROJECT_VIEW.equals(id)) {
    PsiElement element=ProjectView.getInstance(project).getParentOfCurrentSelection();
    if (element != null) {
      bookmarkManager.addCommanderBookmark(element);
    }
    return;
  }
  BookmarkContainer container=e.getData(BookmarkContainer.KEY);
  if (container != null) {
    container.toggleBookmark();
  }
}
