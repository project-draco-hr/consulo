{
  final VirtualFile vFile=LocalFileSystem.getInstance().findFileByPath(fullPath.replace(File.separatorChar,'/'));
  TestCase.assertNotNull("Cannot find file " + fullPath,vFile);
  String fileText=null;
  try {
    fileText=StringUtil.convertLineSeparators(VfsUtil.loadText(vFile),"\n");
  }
 catch (  IOException e) {
    TestCase.fail("Cannot load " + vFile);
  }
  Document document=EditorFactory.getInstance().createDocument(fileText);
  int caretIndex=fileText.indexOf(CARET_MARKER);
  int selStartIndex=fileText.indexOf(SELECTION_START_MARKER);
  int selEndIndex=fileText.indexOf(SELECTION_END_MARKER);
  caretMarker=caretIndex >= 0 ? document.createRangeMarker(caretIndex,caretIndex) : null;
  selStartMarker=selStartIndex >= 0 ? document.createRangeMarker(selStartIndex,selStartIndex) : null;
  selEndMarker=selEndIndex >= 0 ? document.createRangeMarker(selEndIndex,selEndIndex) : null;
  if (caretMarker != null) {
    document.deleteString(caretMarker.getStartOffset(),caretMarker.getStartOffset() + CARET_MARKER.length());
  }
  if (selStartMarker != null) {
    document.deleteString(selStartMarker.getStartOffset(),selStartMarker.getStartOffset() + SELECTION_START_MARKER.length());
  }
  if (selEndMarker != null) {
    document.deleteString(selEndMarker.getStartOffset(),selEndMarker.getStartOffset() + SELECTION_END_MARKER.length());
  }
  newFileText=document.getText();
}
