{
  new WriteCommandAction.Simple(myProjectFixture.getProject()){
    protected void run() throws Throwable {
      configureByFiles(fileBefore);
      final Ref<LookupItem[]> myItems=Ref.create(null);
      new CodeCompletionHandler(){
        protected Lookup showLookup(        Project project,        Editor editor,        LookupItem[] items,        String prefix,        LookupData data,        PsiFile file){
          myItems.set(items);
          return null;
        }
      }
.invoke(getProject(),myEditor,myFile);
      final LookupItem[] items1=myItems.get();
      UsefulTestCase.assertNotNull(items1);
      UsefulTestCase.assertSameElements(ContainerUtil.map(items1,new Function<LookupItem,String>(){
        public String fun(        final LookupItem lookupItem){
          return lookupItem.getLookupString();
        }
      }
),items);
    }
  }
.execute().throwException();
}
