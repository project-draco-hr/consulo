{
  final Project project=myProjectFixture.getProject();
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  return ApplicationManager.getApplication().runReadAction(new Computable<Collection<HighlightInfo>>(){
    public Collection<HighlightInfo> compute(){
      List<TextEditorHighlightingPass> passes=TextEditorHighlightingPassRegistrarEx.getInstanceEx(getProject()).instantiatePasses(getFile(),getEditor(),ArrayUtil.EMPTY_INT_ARRAY);
      MockProgressIndicator progress=new MockProgressIndicator();
      for (      TextEditorHighlightingPass pass : passes) {
        pass.collectInformation(progress);
      }
      for (      TextEditorHighlightingPass pass : passes) {
        pass.applyInformationToEditor();
      }
      List<HighlightInfo> infos=DaemonCodeAnalyzerImpl.getHighlights(getEditor().getDocument(),getProject());
      return infos == null ? Collections.<HighlightInfo>emptyList() : new ArrayList<HighlightInfo>(infos);
    }
  }
);
}
