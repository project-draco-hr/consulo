{
  VirtualFile copy=myTempDirFixture.copyFile(file);
  SelectionAndCaretMarkupLoader loader=new SelectionAndCaretMarkupLoader(copy.getPath());
  try {
    final OutputStream outputStream=copy.getOutputStream(null,0,0);
    outputStream.write(loader.newFileText.getBytes());
    outputStream.close();
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
  if (myFile == null)   myFile=myPsiManager.findFile(copy);
  if (myEditor == null) {
    myEditor=createEditor(copy);
    if (loader.caretMarker != null)     myEditor.getCaretModel().moveToOffset(loader.caretMarker.getStartOffset());
    if (loader.selStartMarker != null && loader.selEndMarker != null) {
      myEditor.getSelectionModel().setSelection(loader.selStartMarker.getStartOffset(),loader.selEndMarker.getStartOffset());
    }
  }
}
