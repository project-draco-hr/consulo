{
  ExpectedHighlightingData data=new ExpectedHighlightingData(myEditor.getDocument(),checkWarnings,checkWeakWarnings,checkInfos);
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
  ((PsiFileImpl)myFile).calcTreeElement();
  myPsiManager.getCacheManager().getFilesWithWord("XXX",UsageSearchContext.IN_COMMENTS,GlobalSearchScope.allScope(getProject()),true);
  VirtualFileFilter javaFilesFilter=new VirtualFileFilter(){
    public boolean accept(    VirtualFile file){
      FileType fileType=FileTypeManager.getInstance().getFileTypeByFile(file);
      return fileType == StdFileTypes.JAVA || fileType == StdFileTypes.CLASS;
    }
  }
;
  myPsiManager.setAssertOnFileLoadingFilter(javaFilesFilter);
  Collection<HighlightInfo> infos=doHighlighting();
  myPsiManager.setAssertOnFileLoadingFilter(VirtualFileFilter.NONE);
  data.checkResult(infos,myEditor.getDocument().getText());
  return infos;
}
