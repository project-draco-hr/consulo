{
  if (!(editor instanceof EditorWindow) || hostCaret instanceof InjectedCaret) {
    return hostCaret;
  }
  for (  Caret caret : editor.getCaretModel().getAllCarets()) {
    if (((InjectedCaret)caret).getDelegate() == hostCaret) {
      return caret;
    }
  }
  throw new IllegalArgumentException("Cannot find injected caret corresponding to " + hostCaret);
}
