{
  if (element instanceof PsiDirectory) {
    final PsiDirectory psiDirectory=(PsiDirectory)element;
    final VirtualFile vFile=psiDirectory.getVirtualFile();
    final Project project=psiDirectory.getProject();
    boolean isArhiveSystem=vFile.getParent() == null && vFile.getFileSystem() instanceof ArchiveFileSystem;
    boolean isContentRoot=ProjectRootsUtil.isModuleContentRoot(vFile,project);
    ContentFolder contentFolder=ProjectRootsUtil.findContentRoot(vFile,project);
    Icon symbolIcon;
    if (isArhiveSystem) {
      symbolIcon=AllIcons.Nodes.PpJar;
    }
 else     if (isContentRoot) {
      symbolIcon=AllIcons.Nodes.Module;
    }
 else     if (contentFolder != null) {
      symbolIcon=ContentFolderIconUtil.getRootIcon(contentFolder.getType());
    }
 else     if (PsiPackageManager.getInstance(project).findAnyPackage(psiDirectory) != null) {
      symbolIcon=ProjectRootsUtil.isInTestSource(psiDirectory) ? AllIcons.Nodes.TestPackage : AllIcons.Nodes.Package;
    }
 else {
      symbolIcon=AllIcons.Nodes.TreeClosed;
    }
    iconDescriptor.setMainIcon(symbolIcon);
  }
 else   if (element instanceof PsiFile && iconDescriptor.getMainIcon() == null) {
    final VirtualFile virtualFile=((PsiFile)element).getVirtualFile();
    if (virtualFile != null) {
      iconDescriptor.setMainIcon(NativeFileIconUtil.INSTANCE.getIcon(virtualFile));
    }
    if (iconDescriptor.getMainIcon() == null) {
      final FileType fileType=((PsiFile)element).getFileType();
      iconDescriptor.setMainIcon(fileType.getIcon());
    }
  }
}
