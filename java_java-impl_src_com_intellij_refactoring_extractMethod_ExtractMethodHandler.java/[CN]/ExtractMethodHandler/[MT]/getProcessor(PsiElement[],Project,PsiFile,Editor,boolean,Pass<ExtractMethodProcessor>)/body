{
  if (elements == null || elements.length == 0) {
    if (showErrorMessages) {
      String message=RefactoringBundle.getCannotRefactorMessage(RefactoringBundle.message("selected.block.should.represent.a.set.of.statements.or.an.expression"));
      CommonRefactoringUtil.showErrorHint(project,editor,message,REFACTORING_NAME,HelpID.EXTRACT_METHOD);
    }
    return null;
  }
  for (  PsiElement element : elements) {
    if (element instanceof PsiStatement && RefactoringUtil.isSuperOrThisCall((PsiStatement)element,true,true)) {
      if (showErrorMessages) {
        String message=RefactoringBundle.getCannotRefactorMessage(RefactoringBundle.message("selected.block.contains.invocation.of.another.class.constructor"));
        CommonRefactoringUtil.showErrorHint(project,editor,message,REFACTORING_NAME,HelpID.EXTRACT_METHOD);
      }
      return null;
    }
  }
  final ExtractMethodProcessor processor=new ExtractMethodProcessor(project,editor,elements,null,REFACTORING_NAME,"",HelpID.EXTRACT_METHOD);
  processor.setShowErrorDialogs(showErrorMessages);
  try {
    if (!processor.prepare(pass))     return null;
  }
 catch (  PrepareFailedException e) {
    if (showErrorMessages) {
      CommonRefactoringUtil.showErrorHint(project,editor,e.getMessage(),REFACTORING_NAME,HelpID.EXTRACT_METHOD);
      highlightPrepareError(e,file,editor,project);
    }
    return null;
  }
  return processor;
}
