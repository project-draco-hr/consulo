{
  final DocumentChangeTransaction documentChangeTransaction=myTransactionsMap.get(document);
  if (documentChangeTransaction != null) {
    documentChangeTransaction.replace(startOffset,endOffset - startOffset,s);
  }
 else {
    DocumentEx ex=(DocumentEx)document;
    ex.suppressGuardedExceptions();
    try {
      boolean isReadOnly=!document.isWritable();
      ex.setReadOnly(false);
      ex.replaceString(startOffset,endOffset,s);
      ex.setReadOnly(isReadOnly);
    }
  finally {
      ex.unSuppressGuardedExceptions();
    }
  }
}
