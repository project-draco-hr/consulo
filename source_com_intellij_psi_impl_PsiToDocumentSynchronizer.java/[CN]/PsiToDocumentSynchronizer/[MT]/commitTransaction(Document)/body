{
  final DocumentChangeTransaction documentChangeTransaction=myTransactionsMap.get(document);
  myTransactionsMap.remove(document);
  if (documentChangeTransaction == null)   return;
  if (documentChangeTransaction.getAffectedFragments().size() == 0)   return;
  final PsiElement changeScope=documentChangeTransaction.getChangeScope();
  final PsiTreeChangeEventImpl fakeEvent=new PsiTreeChangeEventImpl(changeScope.getManager());
  fakeEvent.setParent(changeScope);
  fakeEvent.setFile(changeScope.getContainingFile());
  doSync(fakeEvent,new DocSyncAction(){
    public void syncDocument(    Document document,    PsiTreeChangeEventImpl event){
      doCommitTransaction(document,documentChangeTransaction);
    }
  }
);
}
