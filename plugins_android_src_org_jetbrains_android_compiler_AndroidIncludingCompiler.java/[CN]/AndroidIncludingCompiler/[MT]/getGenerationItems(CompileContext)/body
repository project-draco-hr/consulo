{
  return ApplicationManager.getApplication().runReadAction(new Computable<GenerationItem[]>(){
    @Override public GenerationItem[] compute(){
      Map<String,MyItem> result=new HashMap<String,MyItem>();
      for (      Module module : context.getProjectCompileScope().getAffectedModules()) {
        AndroidFacet facet=AndroidFacet.getInstance(module);
        if (facet != null && !facet.getConfiguration().LIBRARY_PROJECT) {
          for (          AndroidFacet depFacet : AndroidUtils.getAllAndroidDependencies(module,true)) {
            String genSrcRootPath=depFacet.getAptGenSourceRootPath();
            VirtualFile genSrcRoot=genSrcRootPath != null ? LocalFileSystem.getInstance().findFileByPath(genSrcRootPath) : null;
            VirtualFile[] srcRoots=ModuleRootManager.getInstance(depFacet.getModule()).getSourceRoots();
            for (            VirtualFile depSourceRoot : srcRoots) {
              if (depSourceRoot != genSrcRoot) {
                collectCompilableFiles(module,context,depSourceRoot,result);
              }
            }
          }
        }
      }
      Collection<MyItem> items=result.values();
      return items.toArray(new MyItem[items.size()]);
    }
  }
);
}
