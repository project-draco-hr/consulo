{
  return ApplicationManager.getApplication().runReadAction(new Computable<GenerationItem[]>(){
    @Override public GenerationItem[] compute(){
      List<MyItem> result=new ArrayList<MyItem>();
      for (      Module module : context.getProjectCompileScope().getAffectedModules()) {
        Map<String,MyItem> qName2Item=new HashMap<String,MyItem>();
        AndroidFacet facet=AndroidFacet.getInstance(module);
        if (facet == null || !facet.getConfiguration().LIBRARY_PROJECT) {
          for (          AndroidFacet depFacet : AndroidUtils.getAllAndroidDependencies(module,true)) {
            final String aptGenSrcRootPath=depFacet.getAptGenSourceRootPath();
            final VirtualFile aptGenSrcRoot=aptGenSrcRootPath != null ? LocalFileSystem.getInstance().findFileByPath(aptGenSrcRootPath) : null;
            final String aidlGenSrcRootPath=depFacet.getAidlGenSourceRootPath();
            final VirtualFile aidlGenSrcRoot=aidlGenSrcRootPath != null ? LocalFileSystem.getInstance().findFileByPath(aidlGenSrcRootPath) : null;
            VirtualFile[] srcRoots=ModuleRootManager.getInstance(depFacet.getModule()).getSourceRoots();
            for (            VirtualFile depSourceRoot : srcRoots) {
              if (depSourceRoot != aptGenSrcRoot && depSourceRoot != aidlGenSrcRoot) {
                collectCompilableFiles(module,depFacet.getModule(),context,depSourceRoot,qName2Item);
              }
            }
          }
        }
        result.addAll(qName2Item.values());
      }
      return result.toArray(new MyItem[result.size()]);
    }
  }
);
}
