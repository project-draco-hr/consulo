{
  final MavenProjectsManager mavenProjectManager=MavenProjectsManager.getInstance(myProject);
  if (!mavenProjectManager.isMavenizedProject())   return ProcessingItem.EMPTY_ARRAY;
  return new ReadAction<ProcessingItem[]>(){
    protected void run(    Result<ProcessingItem[]> resultObject) throws Throwable {
      List<ProcessingItem> itemsToProcess=new ArrayList<ProcessingItem>();
      List<String> filesToDelete=new ArrayList<String>();
      for (      Module eachModule : context.getCompileScope().getAffectedModules()) {
        MavenProjectModel mavenProject=mavenProjectManager.findProject(eachModule);
        if (mavenProject == null)         continue;
        Properties properties=loadFilters(context,mavenProject);
        long propertiesHashCode=calculateHashCode(properties);
        collectProcessingItems(eachModule,mavenProject,context,properties,propertiesHashCode,false,itemsToProcess);
        collectProcessingItems(eachModule,mavenProject,context,properties,propertiesHashCode,true,itemsToProcess);
        collectItemsToDelete(eachModule,itemsToProcess,filesToDelete);
      }
      if (!filesToDelete.isEmpty()) {
        itemsToProcess.add(new FakeProcessingItem());
      }
      context.putUserData(FILES_TO_DELETE_KEY,filesToDelete);
      resultObject.setResult(itemsToProcess.toArray(new ProcessingItem[itemsToProcess.size()]));
      removeObsoleteModulesFromCache();
    }
  }
.execute().getResultObject();
}
