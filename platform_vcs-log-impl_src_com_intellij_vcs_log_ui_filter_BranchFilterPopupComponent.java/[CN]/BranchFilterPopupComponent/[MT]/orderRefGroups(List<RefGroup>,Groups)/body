{
  for (  final RefGroup group : groups) {
    if (group.getRefs().size() == 1) {
      String name=group.getRefs().iterator().next().getName();
      if (!filteredGroups.singletonGroups.contains(name)) {
        filteredGroups.singletonGroups.add(name);
      }
    }
 else     if (group.isExpanded()) {
      addToGroup(group,filteredGroups.expandedGroups);
    }
 else {
      addToGroup(group,filteredGroups.collapsedGroups);
    }
  }
}
