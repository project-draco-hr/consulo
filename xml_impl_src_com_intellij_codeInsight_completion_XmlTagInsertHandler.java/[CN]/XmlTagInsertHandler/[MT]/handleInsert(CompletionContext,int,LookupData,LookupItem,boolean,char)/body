{
  super.handleInsert(context,startOffset,data,item,signatureSelected,completionChar);
  Project project=context.project;
  Editor editor=context.editor;
  final int offset=editor.getCaretModel().getOffset();
  editor.getDocument().insertString(offset," ");
  PsiDocumentManager.getInstance(project).commitDocument(editor.getDocument());
  PsiElement current=context.file.findElementAt(context.startOffset);
  editor.getDocument().deleteString(offset,offset + 1);
  final XmlTag tag=PsiTreeUtil.getContextOfType(current,XmlTag.class,true);
  if (tag == null || tag instanceof JspXmlRootTag)   return;
  final XmlElementDescriptor descriptor=tag.getDescriptor();
  if (XmlUtil.getTokenOfType(tag,XmlTokenType.XML_TAG_END) == null && XmlUtil.getTokenOfType(tag,XmlTokenType.XML_EMPTY_ELEMENT_END) == null) {
    Template t=TemplateManager.getInstance(project).getActiveTemplate(editor);
    if (t == null && descriptor != null) {
      insertIncompleteTag(completionChar,editor,project,descriptor,tag);
    }
  }
 else   if (completionChar == Lookup.REPLACE_SELECT_CHAR) {
    PsiDocumentManager.getInstance(project).commitAllDocuments();
    int caretOffset=editor.getCaretModel().getOffset();
    PsiElement otherTag=PsiTreeUtil.getParentOfType(context.file.findElementAt(caretOffset),XmlTag.class);
    PsiElement endTagStart=XmlUtil.getTokenOfType(otherTag,XmlTokenType.XML_END_TAG_START);
    if (endTagStart != null) {
      PsiElement sibling=endTagStart.getNextSibling();
      if (sibling.getNode().getElementType() == XmlTokenType.XML_NAME) {
        int sOffset=sibling.getTextRange().getStartOffset();
        int eOffset=sibling.getTextRange().getEndOffset();
        editor.getDocument().deleteString(sOffset,eOffset);
        editor.getDocument().insertString(sOffset,((XmlTag)otherTag).getName());
      }
    }
    editor.getCaretModel().moveToOffset(caretOffset + 1);
    editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
    editor.getSelectionModel().removeSelection();
  }
  current=context.file.findElementAt(context.startOffset);
  if (current != null && current.getPrevSibling() instanceof XmlToken) {
    if (!isClosed(current) && ((XmlToken)current.getPrevSibling()).getTokenType() == XmlTokenType.XML_END_TAG_START) {
      editor.getDocument().insertString(current.getTextRange().getEndOffset(),">");
      editor.getCaretModel().moveToOffset(editor.getCaretModel().getOffset() + 1);
    }
  }
}
