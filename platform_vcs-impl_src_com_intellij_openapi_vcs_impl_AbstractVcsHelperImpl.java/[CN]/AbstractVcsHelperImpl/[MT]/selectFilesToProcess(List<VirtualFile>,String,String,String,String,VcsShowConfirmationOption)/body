{
  if (files == null || files.isEmpty()) {
    return null;
  }
  if (files.size() == 1 && singleFilePromptTemplate != null) {
    String filePrompt=MessageFormat.format(singleFilePromptTemplate,files.get(0).getPresentableUrl());
    if (ConfirmationDialog.requestForConfirmation(confirmationOption,myProject,filePrompt,singleFileTitle,Messages.getQuestionIcon())) {
      return files;
    }
    return null;
  }
  SelectFilesDialog dlg=SelectFilesDialog.init(myProject,files,prompt,confirmationOption,true,true,false);
  dlg.setTitle(title);
  if (!confirmationOption.isPersistent()) {
    dlg.setDoNotAskOption(null);
  }
  if (dlg.showAndGet()) {
    final Collection<VirtualFile> selection=dlg.getSelectedFiles();
    final List<VirtualFile> result=new ArrayList<>();
    for (    VirtualFile file : files) {
      if (selection.contains(file)) {
        result.add(file);
      }
    }
    return result;
  }
  return null;
}
