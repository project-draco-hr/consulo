def write(self, fp):
    delta = (len(self.before) + len(self.after))
    if (self.after and (self.after[(-1)] == '\\ No newline at end of file\n')):
        delta -= 1
    fromlen = (delta + self.removed)
    tolen = (delta + self.added)
    fp.write(('@@ -%d,%d +%d,%d @@%s\n' % (self.fromline, fromlen, self.toline, tolen, (self.proc and (' ' + self.proc)))))
    fp.write(''.join(((self.before + self.hunk) + self.after)))
