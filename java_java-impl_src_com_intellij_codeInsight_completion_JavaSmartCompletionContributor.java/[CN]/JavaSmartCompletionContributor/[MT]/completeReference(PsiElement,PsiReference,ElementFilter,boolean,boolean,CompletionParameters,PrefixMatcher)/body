{
  if (reference instanceof PsiMultiReference) {
    reference=ContainerUtil.findInstance(((PsiMultiReference)reference).getReferences(),PsiJavaReference.class);
  }
  if (reference instanceof PsiJavaReference) {
    final PsiJavaReference javaReference=(PsiJavaReference)reference;
    return JavaCompletionUtil.processJavaReference(element,javaReference,new ElementFilter(){
      public boolean isAcceptable(      Object element,      PsiElement context){
        return filter.isAcceptable(element,context);
      }
      public boolean isClassAcceptable(      Class hintClass){
        if (ReflectionCache.isAssignable(PsiClass.class,hintClass)) {
          return acceptClasses;
        }
        if (ReflectionCache.isAssignable(PsiVariable.class,hintClass) || ReflectionCache.isAssignable(PsiMethod.class,hintClass) || ReflectionCache.isAssignable(CandidateInfo.class,hintClass)) {
          return acceptMembers;
        }
        return false;
      }
    }
,true,parameters.getInvocationCount() <= 1,matcher,parameters);
  }
  return Collections.emptySet();
}
