{
  final AntStructuredElement element=myUndefinedElement;
  final AntProject antProject=(myFile == null) ? element.getAntProject() : myFile.getAntProject();
  final AntElement anchor=(myFile == null) ? AntPsiUtil.getSubProjectElement(element) : PsiTreeUtil.getChildOfType(antProject,AntStructuredElement.class);
  final XmlTag se=element.getSourceElement();
  final XmlTag projectTag=antProject.getSourceElement();
  XmlTag macrodefTag=projectTag.createChildTag("macrodef",projectTag.getNamespace(),null,false);
  macrodefTag.setAttribute("name",se.getName());
  for (  XmlAttribute attr : se.getAttributes()) {
    XmlTag attrTag=macrodefTag.createChildTag("attribute",macrodefTag.getNamespace(),null,false);
    attrTag.setAttribute("name",attr.getName());
    macrodefTag.add(attrTag);
  }
  for (  XmlTag subtag : se.getSubTags()) {
    XmlTag elementTag=macrodefTag.createChildTag("element",macrodefTag.getNamespace(),null,false);
    elementTag.setAttribute("name",subtag.getName());
    macrodefTag.add(elementTag);
  }
  macrodefTag=(XmlTag)((anchor == null) ? projectTag.add(macrodefTag) : projectTag.addBefore(macrodefTag,anchor.getSourceElement()));
  ((Navigatable)macrodefTag).navigate(true);
}
