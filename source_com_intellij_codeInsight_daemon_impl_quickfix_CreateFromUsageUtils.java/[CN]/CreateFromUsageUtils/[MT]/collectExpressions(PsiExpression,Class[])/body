{
  PsiElement parent=PsiTreeUtil.getParentOfType(expression,scopes);
  final List<PsiReferenceExpression> result=new ArrayList<PsiReferenceExpression>();
  PsiRecursiveElementVisitor visitor=new PsiRecursiveElementVisitor(){
    public List getResult(){
      return result;
    }
    public void visitReferenceExpression(    PsiReferenceExpression expr){
      if (expression instanceof PsiReferenceExpression) {
        if (!isValidReference(expr) && expr.textMatches(expression)) {
          result.add(expr);
        }
      }
      visitElement(expr);
    }
    public void visitMethodCallExpression(    PsiMethodCallExpression expr){
      if (expression instanceof PsiMethodCallExpression) {
        PsiReferenceExpression methodExpression=expr.getMethodExpression();
        if (!isValidMethodReference(methodExpression,expr) && methodExpression.textMatches(((PsiMethodCallExpression)expression).getMethodExpression())) {
          result.add(expr.getMethodExpression());
        }
      }
      visitElement(expr);
    }
  }
;
  parent.accept(visitor);
  return result.toArray(new PsiReferenceExpression[result.size()]);
}
