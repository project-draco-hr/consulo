{
  final boolean isStaticImport=context instanceof PsiImportStaticStatement && !((PsiImportStaticStatement)context).isOnDemand();
  final boolean mayHaveDiamonds=context instanceof PsiNewExpression && PsiUtil.getLanguageLevel(context).isAtLeast(LanguageLevel.JDK_1_7);
  final JavaParserUtil.ParserWrapper wrapper=isStaticImport ? STATIC_IMPORT_REF : mayHaveDiamonds ? DIAMOND_REF : REFERENCE;
  final DummyHolder holder=DummyHolderFactory.createHolder(myManager,new JavaDummyElement(text,wrapper,level(context)),context);
  final PsiElement element=SourceTreeToPsiMap.treeElementToPsi(holder.getTreeElement().getFirstChildNode());
  if (!(element instanceof PsiJavaCodeReferenceElement)) {
    throw new IncorrectOperationException("Incorrect reference \"" + text + "\".");
  }
  return (PsiJavaCodeReferenceElement)element;
}
