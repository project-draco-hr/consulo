{
  String currentText=getText();
  if (myOriginalText.equals(myDocument.getText()) && myCharset == null) {
    return myOriginalBytes;
  }
 else   if (myCharset != null) {
    final ByteBuffer buffer=myCharset.encode(currentText).compact();
    int bomLength=myBOM != null ? myBOM.length : 0;
    final int encodedLength=buffer.position();
    byte[] result=new byte[encodedLength + bomLength];
    if (bomLength > 0) {
      System.arraycopy(myBOM,0,result,0,bomLength);
    }
    buffer.position(0);
    buffer.get(result,bomLength,encodedLength);
    return result;
  }
 else {
    return currentText.getBytes();
  }
}
