{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      Project project;
      RadViewComponent root=null;
      XmlFile xmlFile=null;
      if (!checkTag(parentTag) && component.getParent() == component.getRoot()) {
        root=(RadViewComponent)component.getParent();
        xmlFile=root.getClientProperty(XML_FILE_KEY);
        project=xmlFile.getProject();
      }
 else {
        project=parentTag.getProject();
      }
      Language language=StdFileTypes.XML.getLanguage();
      XmlTag xmlTag=XmlElementFactory.getInstance(project).createTagFromText("\n" + tagBuilder.compute(),language);
      if (checkTag(parentTag)) {
        String namespacePrefix=parentTag.getPrefixByNamespace(SdkConstants.NS_RESOURCES);
        if (!"android".equals(namespacePrefix)) {
          convertNamespacePrefix(xmlTag,namespacePrefix);
        }
        if (nextTag == null) {
          xmlTag=parentTag.addSubTag(xmlTag,false);
        }
 else {
          xmlTag=(XmlTag)parentTag.addBefore(xmlTag,nextTag);
        }
      }
 else {
        xmlTag.setAttribute("xmlns:android",SdkConstants.NS_RESOURCES);
        xmlTag=(XmlTag)xmlFile.getDocument().add(xmlTag);
        XmlUtil.expandTag(xmlTag);
        root.setTag(xmlFile.getDocument().getRootTag());
      }
      component.setTag(xmlTag);
    }
  }
);
}
