{
  String shortenedName=name;
  Rectangle2D r=font.getStringBounds(name,new FontRenderContext(new AffineTransform(),isAntiAliased,false));
  if (r.getWidth() > maxWidth) {
    String substring_1;
    String substring_2;
    int maxIdxPerLine=(int)(maxWidth / r.getWidth() * name.length());
    for (int i=maxIdxPerLine; i > 0; i--) {
      if (name.charAt(i) == ' ') {
        substring_1=name.substring(0,i) + "<br>";
        if ((name.length() - substring_1.length()) <= maxIdxPerLine) {
          substring_2=name.substring(i + 1,name.length());
        }
 else {
          maxIdxPerLine=i + maxIdxPerLine - 2;
          substring_2=name.substring(i + 1,maxIdxPerLine) + "...";
        }
        shortenedName=substring_1 + substring_2;
        break;
      }
    }
    if (shortenedName.equals(name) && shortenedName.length() > maxIdxPerLine) {
      shortenedName=name.substring(0,maxIdxPerLine - 2) + "...";
    }
  }
  return "<html>" + shortenedName + "</html>";
}
