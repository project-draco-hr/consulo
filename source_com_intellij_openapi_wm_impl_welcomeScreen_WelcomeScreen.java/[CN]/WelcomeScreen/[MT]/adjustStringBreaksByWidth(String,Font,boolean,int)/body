{
  String shortenedString=string;
  Rectangle2D r=font.getStringBounds(string,new FontRenderContext(new AffineTransform(),isAntiAliased,false));
  if (r.getWidth() > maxWidth) {
    String substring_1;
    String substring_2;
    int maxIdxPerLine=(int)(maxWidth / r.getWidth() * string.length());
    for (int i=maxIdxPerLine; i > 0; i--) {
      if (string.charAt(i) == ' ') {
        substring_1=string.substring(0,i) + "<br>";
        if ((string.length() - substring_1.length()) <= maxIdxPerLine) {
          substring_2=string.substring(i + 1,string.length());
        }
 else {
          maxIdxPerLine=i + maxIdxPerLine - 2;
          substring_2=string.substring(i + 1,maxIdxPerLine) + "...";
        }
        shortenedString=substring_1 + substring_2;
        break;
      }
    }
    if (shortenedString.equals(string) && shortenedString.length() > maxIdxPerLine) {
      shortenedString=string.substring(0,maxIdxPerLine - 2) + "...";
    }
  }
  return "<html>" + shortenedString + "</html>";
}
