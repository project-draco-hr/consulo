{
  extend(CompletionType.SMART,JavaSmartCompletionContributor.INSIDE_EXPRESSION,new ExpectedTypeBasedCompletionProvider(false){
    protected void addCompletions(    final CompletionParameters parameters,    final CompletionResultSet result,    final Collection<ExpectedTypeInfo> infos){
      final Ref<Boolean> empty=Ref.create(true);
      CompletionService.getCompletionService().getVariantsFromContributors(EP_NAME,parameters,NullSmartCompletionContributor.this,new Consumer<LookupElement>(){
        public void consume(        final LookupElement lookupElement){
          empty.set(false);
          result.addElement(lookupElement);
        }
      }
);
      @NonNls final String prefix=result.getPrefixMatcher().getPrefix();
      if (empty.get().booleanValue() && prefix.startsWith("n")) {
        for (        final ExpectedTypeInfo info : infos) {
          if (!(info.getType() instanceof PsiPrimitiveType)) {
            final LookupItem item=BasicExpressionCompletionContributor.createKeywordLookupItem(parameters.getPosition(),PsiKeyword.NULL);
            item.setAttribute(LookupItem.TYPE,PsiType.NULL);
            result.addElement(item);
            return;
          }
        }
      }
    }
  }
);
}
