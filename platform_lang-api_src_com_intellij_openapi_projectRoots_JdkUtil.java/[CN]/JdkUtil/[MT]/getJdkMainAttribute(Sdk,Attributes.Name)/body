{
  final VirtualFile homeDirectory=jdk.getHomeDirectory();
  if (homeDirectory == null) {
    return null;
  }
  VirtualFile rtJar=homeDirectory.findFileByRelativePath("jre/lib/rt.jar");
  if (rtJar == null) {
    rtJar=homeDirectory.findFileByRelativePath("lib/rt.jar");
  }
  if (rtJar == null) {
    rtJar=homeDirectory.findFileByRelativePath("jre/lib/vm.jar");
  }
  if (rtJar == null) {
    rtJar=homeDirectory.findFileByRelativePath("../Classes/classes.jar");
  }
  if (rtJar == null) {
    String versionString=jdk.getVersionString();
    if (versionString != null) {
      final int start=versionString.indexOf("\"");
      final int end=versionString.lastIndexOf("\"");
      versionString=start >= 0 && (end > start) ? versionString.substring(start + 1,end) : null;
    }
    return versionString;
  }
  VirtualFile archiveRootForLocalFile=ArchiveVfsUtil.getArchiveRootForLocalFile(rtJar);
  if (archiveRootForLocalFile == null) {
    return null;
  }
  try {
    VirtualFile manifestArchiveFile=archiveRootForLocalFile.findFileByRelativePath(JarFile.MANIFEST_NAME);
    if (manifestArchiveFile == null) {
      return null;
    }
    InputStream is=manifestArchiveFile.getInputStream();
    Manifest manifest=new Manifest(is);
    is.close();
    Attributes attributes=manifest.getMainAttributes();
    return attributes.getValue(attributeName);
  }
 catch (  IOException e) {
  }
  return null;
}
