{
  File projectFile=new File(projectPath);
  if (!projectFile.isFile()) {
    throw new IllegalArgumentException(GradleBundle.message("gradle.import.text.error.invalid.path",projectPath));
  }
  File projectDir=projectFile.getParentFile();
  GradleConnector connector=GradleConnector.newConnector();
  RemoteGradleProcessSettings settings=mySettings.get();
  if (settings != null) {
    connector.useInstallation(new File(settings.getGradleHome()));
    if (settings.isVerboseApi() && connector instanceof DefaultGradleConnector) {
      ((DefaultGradleConnector)connector).setVerboseLogging(true);
    }
  }
  connector.forProjectDirectory(projectDir);
  ProjectConnection connection=connector.connect();
  if (connection == null) {
    throw new IllegalStateException(String.format("Can't create connection to the target project via gradle tooling api. Project path: '%s'",projectPath));
  }
  myConnections.add(connection);
  myCurrentConnection.set(connection);
  return connection;
}
