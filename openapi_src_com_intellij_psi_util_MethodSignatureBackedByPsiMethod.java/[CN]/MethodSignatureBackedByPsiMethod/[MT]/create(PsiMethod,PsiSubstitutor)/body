{
  final boolean isRaw=PsiUtil.isRawSubstitutor(method,substitutor);
  final PsiTypeParameterList typeParameterList=method.getTypeParameterList();
  PsiTypeParameter[] methodTypeParameters=typeParameterList != null ? typeParameterList.getTypeParameters() : PsiTypeParameter.EMPTY_ARRAY;
  final PsiParameter[] parameters=method.getParameterList().getParameters();
  PsiType[] parameterTypes=new PsiType[parameters.length];
  for (int i=0; i < parameterTypes.length; i++) {
    parameterTypes[i]=parameters[i].getType();
  }
  boolean isInGenericContext=false;
  if (isRaw) {
    for (    PsiTypeParameter typeParameter : methodTypeParameters) {
      substitutor=substitutor.put(typeParameter,null);
    }
    methodTypeParameters=PsiTypeParameter.EMPTY_ARRAY;
    for (int i=0; i < parameterTypes.length; i++) {
      parameterTypes[i]=TypeConversionUtil.erasure(parameterTypes[i]);
    }
    isInGenericContext=false;
  }
 else {
    final PsiClass containingClass=method.getContainingClass();
    if (containingClass != null) {
      final Iterator<PsiTypeParameter> iterator=PsiUtil.typeParametersIterator(containingClass);
      while (iterator.hasNext()) {
        if (substitutor.substitute(iterator.next()) != null) {
          isInGenericContext=true;
          break;
        }
      }
    }
  }
  return new MethodSignatureBackedByPsiMethod(method,substitutor,isRaw,isInGenericContext,parameterTypes,methodTypeParameters);
}
