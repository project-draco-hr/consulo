{
  PsiTypeParameter[] methodTypeParameters=method.getTypeParameters();
  final PsiParameter[] parameters=method.getParameterList().getParameters();
  PsiType[] parameterTypes=new PsiType[parameters.length];
  for (int i=0; i < parameterTypes.length; i++) {
    parameterTypes[i]=parameters[i].getType();
  }
  if (isRaw) {
    for (    PsiTypeParameter typeParameter : methodTypeParameters) {
      substitutor=substitutor.put(typeParameter,null);
    }
    methodTypeParameters=PsiTypeParameter.EMPTY_ARRAY;
    for (int i=0; i < parameterTypes.length; i++) {
      parameterTypes[i]=TypeConversionUtil.erasure(substitutor.substitute(parameterTypes[i]));
    }
  }
 else {
    final PsiClass containingClass=method.getContainingClass();
    if (containingClass != null) {
      final Iterator<PsiTypeParameter> iterator=PsiUtil.typeParametersIterator(containingClass);
      while (iterator.hasNext()) {
        if (substitutor.substitute(iterator.next()) != null) {
          break;
        }
      }
    }
  }
  return new MethodSignatureBackedByPsiMethod(method,substitutor,isRaw,parameterTypes,methodTypeParameters);
}
