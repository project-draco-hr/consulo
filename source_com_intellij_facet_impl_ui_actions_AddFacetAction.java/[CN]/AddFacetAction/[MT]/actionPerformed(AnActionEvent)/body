{
  if (!myEditor.isProjectVersionSupportsFacetAddition(myType)) {
    return;
  }
  FacetInfo parent=myEditor.getSelectedFacetInfo();
  final Collection<FacetInfo> facetInfos=myEditor.getFacetsByType(myType);
  String facetName=myType.getPresentableName();
  int i=2;
  while (facetExists(facetName,facetInfos)) {
    facetName=myType.getPresentableName() + i;
    i++;
  }
  final FacetTypeId underlyingFacetType=myType.getUnderlyingFacetType();
  if (parent == null && underlyingFacetType == null || parent != null && parent.getFacetType().getId() == underlyingFacetType) {
    myEditor.createFacet(parent,myType,facetName);
  }
 else {
    LOG.assertTrue(parent != null);
    final FacetInfo grandParent=myEditor.getParent(parent);
    LOG.assertTrue(grandParent == null && underlyingFacetType == null || grandParent != null && grandParent.getFacetType().getId() == underlyingFacetType);
    myEditor.createFacet(grandParent,myType,facetName);
  }
}
