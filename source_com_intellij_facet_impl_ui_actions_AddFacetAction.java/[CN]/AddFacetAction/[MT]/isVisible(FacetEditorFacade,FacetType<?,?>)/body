{
  final ModuleType moduleType=editor.getSelectedModuleType();
  if (moduleType == null || !type.isSuitableModuleType(moduleType)) {
    return false;
  }
  final FacetInfo selectedFacet=editor.getSelectedFacetInfo();
  if (!canAddFacet(selectedFacet,type,editor)) {
    return false;
  }
  final FacetTypeId underlyingTypeId=type.getUnderlyingFacetType();
  if (selectedFacet == null) {
    return underlyingTypeId == null;
  }
  return underlyingTypeId != null && selectedFacet.getFacetType().getId() == underlyingTypeId;
}
