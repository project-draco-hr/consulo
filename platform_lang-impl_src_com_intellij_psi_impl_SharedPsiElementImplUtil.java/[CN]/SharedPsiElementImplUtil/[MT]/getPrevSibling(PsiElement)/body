{
  if (element instanceof PsiFile) {
    final FileViewProvider viewProvider=((PsiFile)element).getViewProvider();
    element=viewProvider.getPsi(viewProvider.getBaseLanguage());
  }
  PsiElement parent=element.getParent();
  if (parent == null)   return null;
  PsiElement[] children=parent.getChildren();
  for (int i=0; i < children.length; i++) {
    PsiElement child=children[i];
    if (child == element) {
      return i > 0 ? children[i - 1] : null;
    }
  }
  LOG.assertTrue(false);
  return null;
}
