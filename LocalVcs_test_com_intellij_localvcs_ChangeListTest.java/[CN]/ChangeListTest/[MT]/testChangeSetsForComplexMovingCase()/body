{
  cl.applyChangeSetOn(r,cs(new CreateDirectoryChange(1,p("d1")),new CreateFileChange(2,p("d1/file"),null),new CreateDirectoryChange(3,p("d1/d11")),new CreateDirectoryChange(4,p("d1/d12")),new CreateDirectoryChange(5,p("d2"))));
  cl.applyChangeSetOn(r,cs(new MoveChange(p("d1/file"),p("d1/d11"))));
  cl.applyChangeSetOn(r,cs(new MoveChange(p("d1/d11/file"),p("d1/d12"))));
  assertEquals(3,getChangeSetsFor("d1").size());
  assertEquals(3,getChangeSetsFor("d1/d12/file").size());
  assertEquals(3,getChangeSetsFor("d1/d11").size());
  assertEquals(2,getChangeSetsFor("d1/d12").size());
  assertEquals(1,getChangeSetsFor("d2").size());
  cl.applyChangeSetOn(r,cs(new MoveChange(p("d1/d12"),p("d2"))));
  assertEquals(4,getChangeSetsFor("d1").size());
  assertEquals(3,getChangeSetsFor("d2/d12/file").size());
  assertEquals(2,getChangeSetsFor("d2").size());
  assertEquals(3,getChangeSetsFor("d2/d12").size());
}
