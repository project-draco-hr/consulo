{
  final InspectionProfileEntry[] profileEntries=InspectionProfileImpl.getDefaultProfile().getInspectionTools(null);
  final Map<String,Set<InspectionProfileEntry>> map=new HashMap<String,Set<InspectionProfileEntry>>();
  for (  InspectionProfileEntry entry : profileEntries) {
    final String groupName=entry.getGroupDisplayName();
    Set<InspectionProfileEntry> groupInspections=map.get(groupName);
    if (groupInspections == null) {
      groupInspections=new HashSet<InspectionProfileEntry>();
      map.put(groupName,groupInspections);
    }
    groupInspections.add(entry);
  }
  FileWriter fw=new FileWriter(myOutputPath);
  try {
    @NonNls final PrettyPrintWriter xmlWriter=new PrettyPrintWriter(fw);
    xmlWriter.startNode(INSPECTIONS_NODE);
    if (name != null) {
      xmlWriter.addAttribute(PROFILE,name);
    }
    for (    String groupName : map.keySet()) {
      xmlWriter.startNode("group");
      xmlWriter.addAttribute("name",groupName);
      final Set<InspectionProfileEntry> entries=map.get(groupName);
      for (      InspectionProfileEntry entry : entries) {
        xmlWriter.startNode("inspection");
        xmlWriter.addAttribute("shortName",entry.getShortName());
        xmlWriter.addAttribute("displayName",entry.getDisplayName());
        final String description=entry.loadDescription();
        if (description != null) {
          xmlWriter.setValue(description);
        }
 else {
          LOG.error(entry.getShortName() + " descriptionUrl==" + entry.getDescriptionUrl());
        }
        xmlWriter.endNode();
      }
      xmlWriter.endNode();
    }
    xmlWriter.endNode();
  }
  finally {
    fw.close();
  }
}
