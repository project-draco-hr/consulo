{
  fillTreeData(null,true);
  final InspectionsConfigTreeRenderer renderer=new InspectionsConfigTreeRenderer(){
    protected String getFilter(){
      return myProfileFilter != null ? myProfileFilter.getFilter() : null;
    }
  }
;
  myTree=new CheckboxTree(renderer,myRoot){
    public Dimension getPreferredScrollableViewportSize(){
      Dimension size=super.getPreferredScrollableViewportSize();
      size=new Dimension(size.width + 10,size.height);
      return size;
    }
    public int getToggleClickCount(){
      return -1;
    }
    @Override protected void onNodeStateChanged(    final CheckedTreeNode node){
      toggleToolNode((InspectionConfigTreeNode)node);
    }
  }
;
  myTree.setCellRenderer(renderer);
  myTree.setRootVisible(false);
  myTree.setShowsRootHandles(true);
  UIUtil.setLineStyleAngled(myTree);
  TreeUtil.installActions(myTree);
  myTree.addTreeSelectionListener(new TreeSelectionListener(){
    public void valueChanged(    TreeSelectionEvent e){
      if (myTree.getSelectionPaths() != null && myTree.getSelectionPaths().length == 1) {
        updateOptionsAndDescriptionPanel(myTree.getSelectionPaths()[0]);
      }
 else {
        initOptionsAndDescriptionPanel();
      }
      if (!myIsInRestore) {
        InspectionProfileImpl selected=mySelectedProfile;
        if (selected != null) {
          InspectionProfileImpl baseProfile=(InspectionProfileImpl)selected.getParentProfile();
          if (baseProfile != null) {
            baseProfile.getExpandedNodes().setSelectionPaths(myTree.getSelectionPaths());
          }
          selected.getExpandedNodes().setSelectionPaths(myTree.getSelectionPaths());
        }
      }
    }
  }
);
  myTree.addMouseListener(new PopupHandler(){
    public void invokePopup(    Component comp,    int x,    int y){
      final int[] selectionRows=myTree.getSelectionRows();
      if (selectionRows != null && myTree.getPathForLocation(x,y) != null && Arrays.binarySearch(selectionRows,myTree.getRowForLocation(x,y)) > -1) {
        compoundPopup().show(comp,x,y);
      }
    }
  }
);
  new TreeSpeedSearch(myTree,new Convertor<TreePath,String>(){
    public String convert(    TreePath o){
      final InspectionConfigTreeNode node=(InspectionConfigTreeNode)o.getLastPathComponent();
      final Descriptor descriptor=node.getDesriptor();
      return descriptor != null ? InspectionsConfigTreeComparator.getDisplayTextToSort(descriptor.getText()) : InspectionsConfigTreeComparator.getDisplayTextToSort(node.getGroupName());
    }
  }
);
  myTree.setSelectionModel(new DefaultTreeSelectionModel());
  final JBScrollPane scrollPane=ScrollPaneFactory.createScrollPane(myTree);
  scrollPane.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_AS_NEEDED);
  TreeUtil.collapseAll(myTree,1);
  final Dimension preferredSize=new Dimension(myTree.getPreferredSize().width + 20,scrollPane.getPreferredSize().height);
  scrollPane.setPreferredSize(preferredSize);
  scrollPane.setMinimumSize(preferredSize);
  myTree.addTreeExpansionListener(new TreeExpansionListener(){
    private String getExpandedString(    TreePath treePath){
      final InspectionConfigTreeNode node=(InspectionConfigTreeNode)treePath.getLastPathComponent();
      final Descriptor descriptor=node.getDesriptor();
      if (descriptor != null) {
        return descriptor.getText();
      }
 else {
        return node.getGroupName();
      }
    }
    public void treeCollapsed(    TreeExpansionEvent event){
      InspectionProfileImpl selected=mySelectedProfile;
      String nodeTitle=getExpandedString(event.getPath());
      final InspectionProfileImpl parentProfile=(InspectionProfileImpl)selected.getParentProfile();
      if (parentProfile != null) {
        parentProfile.getExpandedNodes().collapseNode(nodeTitle);
      }
      selected.getExpandedNodes().collapseNode(nodeTitle);
    }
    public void treeExpanded(    TreeExpansionEvent event){
      InspectionProfileImpl selected=mySelectedProfile;
      String nodeTitle=getExpandedString(event.getPath());
      final InspectionProfileImpl parentProfile=(InspectionProfileImpl)selected.getParentProfile();
      if (parentProfile != null) {
        parentProfile.getExpandedNodes().expandNode(nodeTitle);
      }
      selected.getExpandedNodes().expandNode(nodeTitle);
    }
  }
);
  myTreeExpander=new DefaultTreeExpander(myTree);
  myProfileFilter=new MyFilterComponent();
  return scrollPane;
}
