{
  final Project project=(Project)DataManager.getInstance().getDataContext(this).getData(DataConstants.PROJECT);
  if (project == null) {
    return;
  }
  final FileEditorManager editorManager=FileEditorManager.getInstance(project);
  final VirtualFile[] files=editorManager.getSelectedFiles();
  if (files.length == 0 || !(files[0].getFileSystem() instanceof LocalFileSystem)) {
    return;
  }
  FileDocumentManager.getInstance().saveAllDocuments();
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      try {
        ReadOnlyAttributeUtil.setReadOnlyAttribute(files[0],files[0].isWritable());
      }
 catch (      IOException e) {
        Messages.showMessageDialog(project,e.getMessage(),"Error",Messages.getErrorIcon());
      }
    }
  }
);
}
