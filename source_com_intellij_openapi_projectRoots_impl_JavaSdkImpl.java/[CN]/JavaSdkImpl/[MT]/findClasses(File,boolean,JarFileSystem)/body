{
  FileFilter jarFileFilter=new FileFilter(){
    public boolean accept(    File f){
      if (f.isDirectory())       return false;
      if (f.getName().endsWith(".jar"))       return true;
      return false;
    }
  }
;
  File[] jarDirs;
  if (SystemInfo.isMac && !ApplicationManager.getApplication().isUnitTestMode()) {
    File libFile=new File(file,"lib");
    File classesFile=new File(file,"../Classes");
    File libExtFile=new File(libFile,"ext");
    jarDirs=new File[]{libFile,classesFile,libExtFile};
  }
 else {
    File jreLibFile=isJre ? new File(file,"lib") : new File(new File(file,"jre"),"lib");
    File jreLibExtFile=new File(jreLibFile,"ext");
    jarDirs=new File[]{jreLibFile,jreLibExtFile};
  }
  ArrayList childrenList=new ArrayList();
  for (int i=0; i < jarDirs.length; i++) {
    File jarDir=jarDirs[i];
    if ((jarDir != null) && jarDir.isDirectory()) {
      File[] files=jarDir.listFiles(jarFileFilter);
      for (int j=0; j < files.length; j++) {
        childrenList.add(files[j]);
      }
    }
  }
  ArrayList result=new ArrayList();
  for (int i=0; i < childrenList.size(); i++) {
    File child=(File)childrenList.get(i);
    String path=child.getAbsolutePath().replace(File.separatorChar,'/') + JarFileSystem.JAR_SEPARATOR;
    ((JarFileSystemEx)jarFileSystem).setNoCopyJarForPath(path);
    VirtualFile vFile=jarFileSystem.findFileByPath(path);
    if (vFile != null) {
      result.add(vFile);
    }
  }
  File classesZipFile=new File(new File(file,"lib"),"classes.zip");
  if ((!classesZipFile.isDirectory()) && classesZipFile.exists()) {
    String path=classesZipFile.getAbsolutePath().replace(File.separatorChar,'/') + JarFileSystem.JAR_SEPARATOR;
    ((JarFileSystemEx)jarFileSystem).setNoCopyJarForPath(path);
    VirtualFile vFile=jarFileSystem.findFileByPath(path);
    if (vFile != null) {
      result.add(vFile);
    }
  }
  return (VirtualFile[])result.toArray(new VirtualFile[result.size()]);
}
