{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      final SelectionModel selectionModel=editor.getSelectionModel();
      int changedLines=0;
      if (selectionModel.hasSelection()) {
        changedLines=performAction(editor,new TextRange(selectionModel.getSelectionStart(),selectionModel.getSelectionEnd()));
      }
 else       if (selectionModel.hasBlockSelection()) {
        final int[] starts=selectionModel.getBlockSelectionStarts();
        final int[] ends=selectionModel.getBlockSelectionEnds();
        for (int i=0; i < starts.length; i++) {
          changedLines+=performAction(editor,new TextRange(starts[i],ends[i]));
        }
      }
 else {
        changedLines+=performAction(editor,new TextRange(0,editor.getDocument().getTextLength()));
      }
      if (changedLines == 0) {
        HintManager.getInstance().showInformationHint(editor,"All lines already have requested indentation");
      }
 else {
        HintManager.getInstance().showInformationHint(editor,"Changed indentation in " + changedLines + (changedLines == 1 ? " line" : " lines"));
      }
    }
  }
);
}
