{
  final FileElement fileElement=TreeUtil.getFileElement((TreeElement)SourceTreeToPsiMap.psiElementToTree(element));
  LOG.assertTrue(fileElement != null,"File element should not be null for " + element);
  CommonCodeStyleSettings javaSettings=settings.getCommonSettings(JavaLanguage.INSTANCE);
  Block block=AbstractJavaBlock.createJavaBlock(fileElement,javaSettings);
  FormattingDocumentModelImpl model=FormattingDocumentModelImpl.createOn(element.getContainingFile());
  return new PsiBasedFormatterModelWithShiftIndentInside(element.getContainingFile(),block,model);
}
