{
  final FileElement fileElement=TreeUtil.getFileElement((TreeElement)SourceTreeToPsiMap.psiElementToTree(element));
  LOG.assertTrue(fileElement != null,"File element should not be null for " + element);
  Block block=AbstractJavaBlock.createJavaBlock(fileElement,settings);
  FormattingDocumentModelImpl model=FormattingDocumentModelImpl.createOn(element.getContainingFile());
  return new PsiBasedFormatterModelWithShiftIndentInside(element.getContainingFile(),block,model);
}
