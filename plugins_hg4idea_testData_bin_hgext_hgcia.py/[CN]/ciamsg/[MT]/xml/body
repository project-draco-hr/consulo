def xml(self):
    n = short(self.ctx.node())
    src = self.sourceelem(self.cia.project, module=self.cia.module, branch=self.ctx.branch())
    dt = self.ctx.date()
    timestamp = dt[0]
    author = saxutils.escape(self.ctx.user())
    rev = ('%d:%s' % (self.ctx.rev(), n))
    log = saxutils.escape(self.logmsg())
    url = ((self.url and ('<url>%s/rev/%s</url>' % (saxutils.escape(self.url), n))) or '')
    msg = ('\n<message>\n  <generator>\n    <name>Mercurial (hgcia)</name>\n    <version>%s</version>\n    <url>%s</url>\n    <user>%s</user>\n  </generator>\n  %s\n  <body>\n    <commit>\n      <author>%s</author>\n      <version>%s</version>\n      <log>%s</log>\n      %s\n      <files>%s</files>\n    </commit>\n  </body>\n  <timestamp>%d</timestamp>\n</message>\n' % (HGCIA_VERSION, saxutils.escape(HGCIA_URL), saxutils.escape(self.cia.user), src, author, rev, log, url, self.fileelems(), timestamp))
    return msg
