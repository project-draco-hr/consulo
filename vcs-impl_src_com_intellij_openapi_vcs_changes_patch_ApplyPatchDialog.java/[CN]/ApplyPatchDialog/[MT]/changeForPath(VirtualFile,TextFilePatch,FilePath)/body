{
  final FilePathImpl filePath=new FilePathImpl(fileToPatch);
  final CurrentContentRevision currentRevision=new CurrentContentRevision(filePath);
  final Document doc=FileDocumentManager.getInstance().getDocument(fileToPatch);
  String baseContent=doc.getText();
  StringBuilder newText=new StringBuilder();
  patch.applyModifications(baseContent,newText);
  ContentRevision revision=new SimpleContentRevision(newText.toString(),(newFilePath == null) ? filePath : newFilePath,patch.getAfterVersionId());
  return new Change(currentRevision,revision);
}
