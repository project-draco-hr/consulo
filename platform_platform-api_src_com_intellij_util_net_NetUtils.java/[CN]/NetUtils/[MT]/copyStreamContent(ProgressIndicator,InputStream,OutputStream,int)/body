{
  if (indicator != null) {
    indicator.checkCanceled();
    if (expectedContentSize < 0)     indicator.setIndeterminate(true);
  }
  final byte[] buffer=new byte[4 * 1024];
  int count;
  int total=0;
  while ((count=inputStream.read(buffer)) > 0) {
    outputStream.write(buffer,0,count);
    total+=count;
    if (indicator != null) {
      indicator.checkCanceled();
      if (expectedContentSize > 0) {
        indicator.setFraction((double)total / expectedContentSize);
      }
    }
  }
  if (indicator != null) {
    indicator.checkCanceled();
  }
  return total;
}
