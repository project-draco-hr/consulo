{
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  DiffRequest diffRequest=e.getData(DIFF_REQUEST);
  if (diffRequest == null) {
    final VirtualFile[] virtualFiles=e.getData(PlatformDataKeys.VIRTUAL_FILE_ARRAY);
    if (virtualFiles == null || virtualFiles.length != 2) {
      return false;
    }
    diffRequest=getDiffRequest(project,virtualFiles);
  }
  if (diffRequest == null) {
    return false;
  }
  return !diffRequest.isSafeToCallFromUpdate() || DiffManager.getInstance().getDiffTool().canShow(diffRequest);
}
