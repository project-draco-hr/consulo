{
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      Presentation presentation=e.getPresentation();
      DataContext dataContext=e.getDataContext();
      Project project=getProject(dataContext);
      if (project != null) {
        Editor editor=getEditor(dataContext);
        if (editor != null) {
          PsiFile file=PsiUtilBase.getPsiFileInEditor(editor,project);
          if (file != null) {
            AndroidFacet facet=AndroidFacet.getInstance(file);
            if (facet != null) {
              int offset=TargetElementUtilBase.adjustOffset(file,editor.getDocument(),editor.getCaretModel().getOffset());
              PsiElement element=file.findElementAt(offset);
              boolean enabled=false;
              if (element != null) {
                PsiField field=PsiTreeUtil.getParentOfType(element,PsiField.class);
                if (field != null) {
                  if (isRJavaField(file,field)) {
                    enabled=true;
                  }
                }
                while (!enabled && element != null) {
                  element=PsiTreeUtil.getParentOfType(element,PsiReferenceExpression.class);
                  if (element != null) {
                    PsiElement targetElement=((PsiReferenceExpression)element).resolve();
                    if (targetElement instanceof PsiField) {
                      if (isRJavaField(targetElement.getContainingFile(),(PsiField)targetElement)) {
                        enabled=true;
                      }
                    }
                  }
                }
              }
              presentation.setEnabled(enabled || AndroidResourceUtil.isInResourceSubdirectory(file,null));
              return;
            }
          }
        }
 else         if (PlatformDataKeys.FILE_EDITOR.getData(dataContext) != null) {
          PsiFile psiFile=getPsiFileByVirtualFileKey(project,dataContext);
          if (psiFile != null) {
            boolean enabled=AndroidFacet.getInstance(psiFile) != null && AndroidResourceUtil.isInResourceSubdirectory(psiFile,null);
            presentation.setEnabled(enabled);
            return;
          }
        }
      }
      presentation.setEnabled(false);
    }
  }
);
}
