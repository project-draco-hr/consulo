{
  final List<ModuleChunk> allChunks=chunks.getChunkList();
  final Map<JpsModule,Set<JpsModule>> depsMap=new HashMap<JpsModule,Set<JpsModule>>();
  final boolean compilingTests=context.isCompilingTests();
  for (  JpsModule module : context.getProjectDescriptor().jpsProject.getModules()) {
    Set<JpsModule> dependent=depsMap.get(module);
    if (dependent == null) {
      dependent=ProjectPaths.getModulesWithDependentsRecursively(module,compilingTests);
      dependent.remove(module);
      depsMap.put(module,dependent);
    }
  }
  final List<ChunkGroup> groups=new ArrayList<ChunkGroup>();
  ChunkGroup currentGroup=new ChunkGroup();
  groups.add(currentGroup);
  for (  ModuleChunk chunk : allChunks) {
    if (dependsOnGroup(chunk,currentGroup,depsMap)) {
      currentGroup=new ChunkGroup();
      groups.add(currentGroup);
    }
    currentGroup.addChunk(chunk);
  }
  return groups;
}
