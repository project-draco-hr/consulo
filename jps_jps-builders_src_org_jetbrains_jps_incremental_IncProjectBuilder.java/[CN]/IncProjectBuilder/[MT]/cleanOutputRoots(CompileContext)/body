{
  ProjectDescriptor projectDescriptor=context.getProjectDescriptor();
  JpsJavaCompilerConfiguration configuration=JpsJavaExtensionService.getInstance().getOrCreateCompilerConfiguration(projectDescriptor.getProject());
  final boolean shouldClear=configuration.isClearOutputDirectoryOnRebuild();
  try {
    if (shouldClear) {
      clearOutputs(context);
    }
 else {
      for (      BuildTarget<?> target : projectDescriptor.getBuildTargetIndex().getAllTargets()) {
        clearOutputFiles(context,target);
      }
    }
  }
 catch (  IOException e) {
    throw new ProjectBuildException("Error cleaning output files",e);
  }
  try {
    projectDescriptor.timestamps.getStorage().clean();
  }
 catch (  IOException e) {
    throw new ProjectBuildException("Error cleaning timestamps storage",e);
  }
  try {
    projectDescriptor.dataManager.clean();
  }
 catch (  IOException e) {
    throw new ProjectBuildException("Error cleaning compiler storages",e);
  }
  myProjectDescriptor.fsState.clearAll();
}
