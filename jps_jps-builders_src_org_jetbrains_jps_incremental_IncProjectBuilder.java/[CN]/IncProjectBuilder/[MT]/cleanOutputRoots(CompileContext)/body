{
  final boolean shouldClear=JpsJavaExtensionService.getInstance().getOrCreateCompilerConfiguration(context.getProjectDescriptor().getProject()).isClearOutputDirectoryOnRebuild();
  try {
    if (shouldClear) {
      clearOutputs(context);
    }
 else {
      for (      BuildTarget<?> target : context.getProjectDescriptor().getBuildTargetIndex().getAllTargets()) {
        clearOutputFiles(context,target);
      }
    }
  }
 catch (  IOException e) {
    throw new ProjectBuildException("Error cleaning output files",e);
  }
  try {
    context.getProjectDescriptor().timestamps.getStorage().clean();
  }
 catch (  IOException e) {
    throw new ProjectBuildException("Error cleaning timestamps storage",e);
  }
  try {
    context.getProjectDescriptor().dataManager.clean();
  }
 catch (  IOException e) {
    throw new ProjectBuildException("Error cleaning compiler storages",e);
  }
  myProjectDescriptor.fsState.clearAll();
}
