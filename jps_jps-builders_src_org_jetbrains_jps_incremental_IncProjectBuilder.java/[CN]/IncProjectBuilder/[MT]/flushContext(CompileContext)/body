{
  if (context != null) {
    context.getTimestampStorage().force();
    context.getDataManager().flush(false);
  }
  final ExternalJavacDescriptor descriptor=ExternalJavacDescriptor.KEY.get(context);
  if (descriptor != null) {
    try {
      final RequestFuture future=descriptor.client.sendShutdownRequest();
      future.waitFor(500L,TimeUnit.MILLISECONDS);
    }
  finally {
      descriptor.process.destroyProcess();
    }
    ExternalJavacDescriptor.KEY.set(context,null);
  }
  if (context == null || context.getBuilderParameter(GlobalOptions.USE_EXTERNAL_JAVAC_OPTION) == null) {
    cleanupJavacNameTable();
  }
}
