{
  final List<BuildTargetChunk> allChunks=index.getSortedTargetChunks();
  final Map<BuildTarget<?>,Set<BuildTarget<?>>> depsMap=new HashMap<BuildTarget<?>,Set<BuildTarget<?>>>();
  for (  BuildTarget target : index.getAllTargets()) {
    depsMap.put(target,index.getDependenciesRecursively(target));
  }
  final List<ChunkGroup> groups=new ArrayList<ChunkGroup>();
  ChunkGroup currentGroup=new ChunkGroup();
  groups.add(currentGroup);
  for (  BuildTargetChunk chunk : allChunks) {
    if (dependsOnGroup(chunk,currentGroup,depsMap)) {
      currentGroup=new ChunkGroup();
      groups.add(currentGroup);
    }
    currentGroup.addChunk(chunk);
  }
  return groups;
}
