{
  final ProjectDescriptor pd=context.getProjectDescriptor();
  final BuildFSState fsState=pd.fsState;
  fsState.clearContextRoundData(context);
  fsState.clearContextChunk(context);
  if (!Utils.errorsDetected(context) && !context.getCancelStatus().isCanceled()) {
    boolean marked=false;
    for (    ModuleBuildTarget target : chunk.getTargets()) {
      if (context.isMake()) {
        context.clearNonIncrementalMark(target);
      }
      if (context.isProjectRebuild()) {
        fsState.markInitialScanPerformed(target);
      }
      final Timestamps timestamps=pd.timestamps.getStorage();
      final List<RootDescriptor> roots=pd.rootsIndex.getModuleRoots(context,target.getModuleName());
      for (      RootDescriptor rd : roots) {
        if (target.isTests() ? rd.isTestRoot : !rd.isTestRoot) {
          marked|=fsState.markAllUpToDate(context.getScope(),rd,timestamps,context.getCompilationStartStamp());
        }
      }
    }
    if (marked) {
      context.processMessage(UptoDateFilesSavedEvent.INSTANCE);
    }
  }
}
