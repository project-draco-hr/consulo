{
  try {
    final Map<ModuleBuildTarget,Collection<String>> removedSources=new HashMap<ModuleBuildTarget,Collection<String>>();
    for (    ModuleBuildTarget target : chunk.getTargets()) {
      final Collection<String> deletedPaths=myProjectDescriptor.fsState.getAndClearDeletedPaths(target);
      if (deletedPaths.isEmpty()) {
        continue;
      }
      removedSources.put(target,deletedPaths);
      final SourceToOutputMapping sourceToOutputStorage=context.getProjectDescriptor().dataManager.getSourceToOutputMap(target.getModuleName(),context.isCompilingTests());
      for (      String deletedSource : deletedPaths) {
        final Collection<String> outputs=sourceToOutputStorage.getState(deletedSource);
        if (outputs != null && !outputs.isEmpty()) {
          final JavaBuilderLogger logger=context.getLoggingManager().getJavaBuilderLogger();
          if (logger.isEnabled()) {
            final String[] buffer=new String[outputs.size()];
            int i=0;
            for (            final String o : outputs) {
              buffer[i++]=o;
            }
            Arrays.sort(buffer);
            logger.log("Cleaning output files:");
            for (            final String o : buffer) {
              logger.log(o);
            }
            logger.log("End of files");
          }
          for (          String output : outputs) {
            new File(output).delete();
          }
          context.processMessage(new FileDeletedEvent(outputs));
        }
        final SourceToFormMapping sourceToFormMap=context.getProjectDescriptor().dataManager.getSourceToFormMap();
        final String formPath=sourceToFormMap.getState(deletedSource);
        if (formPath != null) {
          final File formFile=new File(formPath);
          if (formFile.exists()) {
            FSOperations.markDirty(context,formFile);
          }
          sourceToFormMap.remove(deletedSource);
        }
      }
    }
    if (!removedSources.isEmpty()) {
      final Map<ModuleBuildTarget,Collection<String>> existing=Utils.REMOVED_SOURCES_KEY.get(context);
      if (existing != null) {
        for (        Map.Entry<ModuleBuildTarget,Collection<String>> entry : existing.entrySet()) {
          final Collection<String> paths=removedSources.get(entry.getKey());
          if (paths != null) {
            paths.addAll(entry.getValue());
          }
 else {
            removedSources.put(entry.getKey(),entry.getValue());
          }
        }
      }
      Utils.REMOVED_SOURCES_KEY.set(context,removedSources);
    }
  }
 catch (  IOException e) {
    throw new ProjectBuildException(e);
  }
}
