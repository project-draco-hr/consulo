{
  CompileContext context=null;
  try {
    try {
      context=createContext(scope,isMake,isProjectRebuild);
      runBuild(context);
    }
 catch (    ProjectBuildException e) {
      if (e.getCause() instanceof PersistentEnumerator.CorruptedException) {
        myMessageDispatcher.processMessage(new CompilerMessage(COMPILE_SERVER_NAME,BuildMessage.Kind.INFO,"Internal caches are corrupted or have outdated format, forcing project rebuild: " + e.getMessage()));
        flushContext(context);
        context=createContext(new AllProjectScope(scope.getProject(),true),false,true);
        runBuild(context);
      }
 else {
        throw e;
      }
    }
  }
 catch (  ProjectBuildException e) {
    final Throwable cause=e.getCause();
    if (cause == null) {
      final BuildMessage msg=e.isError() ? new CompilerMessage("",BuildMessage.Kind.ERROR,e.getMessage()) : new ProgressMessage(e.getMessage());
      myMessageDispatcher.processMessage(msg);
    }
 else {
      myMessageDispatcher.processMessage(new CompilerMessage(COMPILE_SERVER_NAME,cause));
    }
  }
 finally {
    flushContext(context);
  }
}
