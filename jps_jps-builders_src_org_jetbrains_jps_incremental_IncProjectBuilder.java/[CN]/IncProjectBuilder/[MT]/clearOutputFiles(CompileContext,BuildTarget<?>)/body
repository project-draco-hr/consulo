{
  final SourceToOutputMapping map=context.getProjectDescriptor().dataManager.getSourceToOutputMap(target);
  final THashSet<File> dirsToDelete=target instanceof ModuleBasedTarget ? new THashSet<File>(FileUtil.FILE_HASHING_STRATEGY) : null;
  for (  String srcPath : map.getSources()) {
    final Collection<String> outs=map.getOutputs(srcPath);
    if (outs != null && !outs.isEmpty()) {
      for (      String out : outs) {
        final File outFile=new File(out);
        final boolean deleted=outFile.delete();
        if (deleted && dirsToDelete != null) {
          final File parent=outFile.getParentFile();
          if (parent != null) {
            dirsToDelete.add(parent);
          }
        }
      }
      context.processMessage(new FileDeletedEvent(outs));
    }
  }
  registerTargetsWithClearedOutput(context,Collections.singletonList(target));
  if (dirsToDelete != null) {
    FSOperations.pruneEmptyDirs(context,dirsToDelete);
  }
}
