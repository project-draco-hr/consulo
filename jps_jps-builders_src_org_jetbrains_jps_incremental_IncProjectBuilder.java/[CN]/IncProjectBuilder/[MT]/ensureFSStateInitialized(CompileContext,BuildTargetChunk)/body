{
  final ProjectDescriptor pd=context.getProjectDescriptor();
  final Timestamps timestamps=pd.timestamps.getStorage();
  for (  BuildTarget<?> target : chunk.getTargets()) {
    final BuildTargetConfiguration configuration=pd.getTargetsState().getTargetConfiguration(target);
    if (target instanceof ModuleBuildTarget) {
      ensureFSStateInitialized(context,pd,timestamps,configuration,(ModuleBuildTarget)target);
    }
 else {
      if (context.isProjectRebuild() || configuration.isTargetDirty() || context.getScope().isRecompilationForced(target)) {
        clearOutputFiles(context,target);
        FSOperations.markDirtyFiles(context,target,timestamps,true,null);
        configuration.save();
      }
 else       if (pd.fsState.markInitialScanPerformed(target)) {
        if (target instanceof ModuleBasedTarget) {
          initTargetFSState(context,target,false);
        }
 else {
          FSOperations.markDirtyFiles(context,target,timestamps,false,null);
        }
      }
    }
  }
}
