{
  Project project=(Project)e.getDataContext().getData(DataConstants.PROJECT);
  Change[] changes=(Change[])e.getDataContext().getData(DataConstants.CHANGES);
  if (project == null || changes == null)   return;
  Change change=changes[0];
  final DiffTool tool=DiffManager.getInstance().getDiffTool();
  final ContentRevision bRev=change.getBeforeRevision();
  final ContentRevision aRev=change.getAfterRevision();
  if (bRev != null && bRev.getFile().getFileType().isBinary() || aRev != null && aRev.getFile().getFileType().isBinary()) {
    return;
  }
  String title=bRev != null ? bRev.getFile().getPath() : aRev != null ? aRev.getFile().getPath() : "Unknown diff";
  final SimpleDiffRequest diffReq=new SimpleDiffRequest(project,title);
  diffReq.setContents(createContent(project,bRev),createContent(project,aRev));
  diffReq.setContentTitles("Base version","Your version");
  tool.show(diffReq);
}
