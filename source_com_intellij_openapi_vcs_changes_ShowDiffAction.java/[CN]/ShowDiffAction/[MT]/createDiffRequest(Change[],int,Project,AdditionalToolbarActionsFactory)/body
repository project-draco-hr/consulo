{
  final Change change=changes[index];
  final ContentRevision bRev=change.getBeforeRevision();
  final ContentRevision aRev=change.getAfterRevision();
  if (bRev != null && bRev.getFile().getFileType().isBinary() || aRev != null && aRev.getFile().getFileType().isBinary()) {
    return null;
  }
  String title=bRev != null ? bRev.getFile().getPath() : aRev != null ? aRev.getFile().getPath() : "Unknown diff";
  final SimpleDiffRequest diffReq=new SimpleDiffRequest(project,title);
  if (changes.length > 1) {
    diffReq.setToolbarAddons(new DiffRequest.ToolbarAddons(){
      public void customize(      DiffToolbar toolbar){
        toolbar.addSeparator();
        toolbar.addAction(new ShowPrevChangeAction(changes,index,project,actionsFactory));
        toolbar.addAction(new ShowNextChangeAction(changes,index,project,actionsFactory));
        toolbar.addSeparator();
        for (        AnAction action : actionsFactory.createActions(change)) {
          toolbar.addAction(action);
        }
      }
    }
);
  }
  diffReq.setContents(createContent(project,bRev),createContent(project,aRev));
  diffReq.setContentTitles("Base version","Your version");
  return diffReq;
}
