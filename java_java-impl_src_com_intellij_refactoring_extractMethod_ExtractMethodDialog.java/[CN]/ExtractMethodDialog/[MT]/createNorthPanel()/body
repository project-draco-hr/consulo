{
  JPanel panel=new JPanel(new VerticalFlowLayout(VerticalFlowLayout.TOP));
  panel.setBorder(IdeBorderFactory.createTitledBorder(RefactoringBundle.message("extract.method.method.panel.border")));
  JLabel nameLabel=new JLabel();
  nameLabel.setText(RefactoringBundle.message("name.prompt"));
  panel.add(nameLabel);
  panel.add(myNameField);
  nameLabel.setLabelFor(myNameField);
  myNameField.getDocument().addDocumentListener(new DocumentAdapter(){
    public void documentChanged(    DocumentEvent e){
      update();
    }
  }
);
  setOKActionEnabled(false);
  panel.add(myCbMakeStatic);
  if (myStaticFlag || myCanBeStatic) {
    myCbMakeStatic.setEnabled(!myStaticFlag);
    myCbMakeStatic.setSelected(myStaticFlag);
    myCbMakeStatic.addItemListener(new ItemListener(){
      public void itemStateChanged(      ItemEvent e){
        updateSignature();
      }
    }
);
  }
 else {
    myCbMakeStatic.setSelected(false);
    myCbMakeStatic.setEnabled(false);
  }
  myFoldCb.setSelected(myVariableData.isFoldingSelectedByDefault());
  myFoldCb.setVisible(myVariableData.isFoldable());
  myVariableData.setFoldingAvailable(myFoldCb.isSelected());
  myInputVariables=myVariableData.getInputVariables().toArray(new ParameterTablePanel.VariableData[myVariableData.getInputVariables().size()]);
  myFoldCb.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      myVariableData.setFoldingAvailable(myFoldCb.isSelected());
      myInputVariables=myVariableData.getInputVariables().toArray(new ParameterTablePanel.VariableData[myVariableData.getInputVariables().size()]);
      updateVarargsEnabled();
      createParametersPanel();
      updateSignature();
    }
  }
);
  panel.add(myFoldCb);
  boolean canBeVarargs=false;
  for (  ParameterTablePanel.VariableData data : myInputVariables) {
    canBeVarargs|=data.type instanceof PsiArrayType;
  }
  if (myVariableData.isFoldable()) {
    canBeVarargs|=myVariableData.isFoldingSelectedByDefault();
  }
  if (canBeVarargs) {
    myCbMakeVarargs=new NonFocusableCheckBox(RefactoringBundle.message("declare.varargs.checkbox"));
    updateVarargsEnabled();
    myCbMakeVarargs.setSelected(false);
    panel.add(myCbMakeVarargs);
  }
  if (myCbChainedConstructor != null) {
    panel.add(myCbChainedConstructor);
    myCbChainedConstructor.addItemListener(new ItemListener(){
      public void itemStateChanged(      final ItemEvent e){
        if (myDefaultVisibility) {
          myChangingVisibility=true;
          try {
            if (isChainedConstructor()) {
              myVisibilityPanel.setVisibility(VisibilityUtil.getVisibilityModifier(myTargetClass.getModifierList()));
            }
 else {
              myVisibilityPanel.setVisibility(PsiModifier.PRIVATE);
            }
          }
  finally {
            myChangingVisibility=false;
          }
        }
        update();
      }
    }
);
  }
  setOKActionEnabled(JavaPsiFacade.getInstance(myProject).getNameHelper().isIdentifier(myNameField.getText()));
  return panel;
}
