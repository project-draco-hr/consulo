{
  final FileElement fileElement=TreeUtil.getFileElement(first);
  if (fileElement != null) {
    prepareAndRunChangeAction(new ChangeAction(){
      public void makeChange(      TreeChangeEvent destinationTreeChange){
        destinationTreeChange.addElementaryChange(first.getTreeParent(),ChangeInfoImpl.create(ChangeInfo.CONTENTS_CHANGED,first.getTreeParent()));
        TreeUtil.removeRange(first,last);
        repairRemovedElement(fileElement,oldCharTab,first);
        final FileElement treeElement=new DummyHolder(fileElement.getManager(),oldCharTab,false).getTreeElement();
        TreeUtil.addChildren(treeElement,first);
      }
    }
,first.getTreeParent());
  }
 else {
    TreeUtil.removeRange(first,last);
  }
}
