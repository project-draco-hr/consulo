{
  if (!storageSpec.storageClass().equals(StorageAnnotationsDefaultValues.NullStateStorage.class)) {
    String key=UUID.randomUUID().toString();
    ((MutablePicoContainer)myPicoContainer).registerComponentImplementation(key,storageSpec.storageClass());
    return (StateStorage)myPicoContainer.getComponentInstance(key);
  }
  if (!storageSpec.stateSplitter().equals(StorageAnnotationsDefaultValues.NullStateSplitter.class)) {
    return createDirectoryStateStorage(storageSpec.file(),storageSpec.stateSplitter());
  }
  return createFileStateStorage(storageSpec.file());
}
