{
  String expandedFile=expandMacroses(fileSpec);
  if (expandedFile == null) {
    myStorages.put(fileSpec,null);
    return null;
  }
  final String extension=FileUtil.getExtension(new File(expandedFile).getName());
  if (!ourHeadlessEnvironment && extension.length() == 0) {
    throw new IllegalArgumentException("Extension is missing for storage file: " + expandedFile);
  }
  return createFileStateStorage(fileSpec,expandedFile,myRootTagName,myPicoContainer);
}
