{
  myStorageLock.lock();
  try {
    StateStorage stateStorage=myStorages.get(fileSpec);
    if (stateStorage == null) {
      stateStorage=createFileStateStorage(fileSpec,roamingType);
      putStorageToMap(fileSpec,stateStorage);
    }
    return stateStorage;
  }
  finally {
    myStorageLock.unlock();
  }
}
