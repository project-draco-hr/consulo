{
  final String normalizedPath=vfs.normalize(path);
  if (normalizedPath == null)   return null;
  final String basePath=vfs.extractRootPath(normalizedPath);
  NewVirtualFile file=ManagingFS.getInstance().findRoot(basePath,vfs);
  if (file == null || !file.exists())   return null;
  for (  String pathElement : StringUtil.tokenize(normalizedPath.substring(basePath.length()),FILE_SEPARATORS)) {
    if (pathElement.isEmpty() || ".".equals(pathElement))     continue;
    if ("..".equals(pathElement)) {
      if (file.isSymLink()) {
        final String canonicalPath=file.getCanonicalPath();
        final NewVirtualFile canonicalFile=canonicalPath != null ? findFileByPathIfCached(vfs,canonicalPath) : null;
        file=canonicalFile != null ? canonicalFile.getParent() : null;
      }
 else {
        file=file.getParent();
      }
    }
 else {
      file=file.findChildIfCached(pathElement);
    }
    if (file == null)     return null;
  }
  return file;
}
