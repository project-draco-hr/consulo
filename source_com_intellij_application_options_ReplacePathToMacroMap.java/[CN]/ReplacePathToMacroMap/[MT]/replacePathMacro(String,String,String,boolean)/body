{
  if (text.length() < path.length()) {
    return text;
  }
  StringBuilder newText=null;
  int i=0;
  while (i < text.length()) {
    int i1=caseSensitive ? text.indexOf(path,i) : StringUtil.indexOfIgnoreCase(text,path,i);
    if (i1 >= 0) {
      int endOfOccurence=i1 + path.length();
      if (endOfOccurence < text.length() && text.charAt(endOfOccurence) != '/') {
        i=endOfOccurence;
        continue;
      }
    }
    if (i1 < 0) {
      if (newText == null) {
        return text;
      }
      newText.append(text.substring(i));
      break;
    }
 else {
      if (macro == null) {
        return null;
      }
      if (newText == null) {
        newText=new StringBuilder();
      }
      newText.append(text.substring(i,i1));
      newText.append(macro);
      logUsage(macro);
      i=i1 + path.length();
    }
  }
  return newText != null ? newText.toString() : "";
}
