{
  HgUtil.executeOnPooledThreadIfNeeded(new Runnable(){
    public void run(){
      final List<VirtualFile> repositories=HgUtil.getHgRepositories(myProject);
      if (repositories.isEmpty()) {
        VcsBalloonProblemNotifier.showOverChangesView(myProject,"No Mercurial repositories in the project",MessageType.ERROR);
      }
      VirtualFile firstRepo=repositories.get(0);
      final String defaultPushPath=getDefaultPushPath(myProject,firstRepo);
      final List<HgTagBranch> branches=getBranches(myProject,firstRepo);
      final AtomicReference<HgPushCommand> pushCommand=new AtomicReference<HgPushCommand>();
      UIUtil.invokeAndWaitIfNeeded(new Runnable(){
        @Override public void run(){
          final HgPushDialog dialog=new HgPushDialog(myProject,repositories,defaultPushPath,branches);
          dialog.show();
          if (dialog.isOK()) {
            pushCommand.set(preparePushCommand(myProject,dialog));
          }
        }
      }
);
      if (pushCommand.get() != null) {
        push(myProject,pushCommand.get());
      }
    }
  }
);
}
