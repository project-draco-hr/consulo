{
  Project p=e.getData(DataKeys.PROJECT);
  SVNURL root;
  RepositoryTreeNode node=getRepositoryBrowser().getSelectedNode();
  while (node.getSVNDirEntry() != null) {
    node=(RepositoryTreeNode)node.getParent();
  }
  root=node.getURL();
  SVNURL sourceURL=getRepositoryBrowser().getSelectedNode().getURL();
  DiffOptionsDialog dialog=new DiffOptionsDialog(p,root,sourceURL);
  dialog.show();
  if (dialog.isOK()) {
    SVNURL targetURL=dialog.getTargetURL();
    if (dialog.isReverseDiff()) {
      targetURL=sourceURL;
      sourceURL=dialog.getTargetURL();
    }
    final SVNURL sURL=sourceURL;
    final SVNURL tURL=targetURL;
    Runnable command;
    if (dialog.isUnifiedDiff()) {
      final File targetFile=dialog.getTargetFile();
      command=new Runnable(){
        public void run(){
          targetFile.getParentFile().mkdirs();
          doUnifiedDiff(targetFile,sURL,tURL);
        }
      }
;
    }
 else {
      command=new Runnable(){
        public void run(){
          try {
            doGraphicalDiff(sURL,tURL);
          }
 catch (          SVNException e1) {
            Messages.showErrorDialog(myProject,e1.getErrorMessage().getFullMessage(),"Error");
          }
        }
      }
;
    }
    ProgressManager.getInstance().runProcessWithProgressSynchronously(command,"Computing Difference",false,myProject);
  }
}
