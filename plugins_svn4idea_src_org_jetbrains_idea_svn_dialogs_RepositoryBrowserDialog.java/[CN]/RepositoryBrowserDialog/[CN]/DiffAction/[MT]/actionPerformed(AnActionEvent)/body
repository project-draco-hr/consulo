{
  Project p=(Project)e.getDataContext().getData(DataConstants.PROJECT);
  SVNURL root;
  RepositoryTreeNode node=getRepositoryBrowser().getSelectedNode();
  while (node.getSVNDirEntry() != null) {
    node=(RepositoryTreeNode)node.getParent();
  }
  root=node.getURL();
  SVNURL sourceURL=getRepositoryBrowser().getSelectedNode().getURL();
  DiffOptionsDialog dialog=new DiffOptionsDialog(p,root,sourceURL);
  dialog.show();
  if (dialog.isOK()) {
    SVNURL targetURL=dialog.getTargetURL();
    if (dialog.isReverseDiff()) {
      targetURL=sourceURL;
      sourceURL=dialog.getTargetURL();
    }
    if (dialog.isUnifiedDiff()) {
      File targetFile=dialog.getTargetFile();
      targetFile.getParentFile().mkdirs();
      doUnifiedDiff(targetFile,sourceURL,targetURL);
    }
 else {
      try {
        doGraphicalDiff(sourceURL,targetURL);
      }
 catch (      SVNException e1) {
      }
    }
  }
}
