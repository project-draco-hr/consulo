{
  final RepositoryTreeNode selectedNode=getSelectedNode();
  if (selectedNode == null) {
    return;
  }
  SVNURL url=selectedNode.getURL();
  SVNDirEntry dirEntry=selectedNode.getSVNDirEntry();
  if (dirEntry == null) {
    return;
  }
  File dir=selectFile("Destination directory","Select checkout destination directory");
  if (dir == null) {
    return;
  }
  final String relativePath;
  if (dirEntry.getRepositoryRoot() != null) {
    relativePath=SVNPathUtil.getRelativePath(dirEntry.getRepositoryRoot().toString(),url.toString());
  }
 else {
    relativePath=dirEntry.getRelativePath();
  }
  Project p=myProject;
  CheckoutOptionsDialog dialog=new CheckoutOptionsDialog(p,url,dir,SvnUtil.getVirtualFile(dir.getAbsolutePath()),relativePath);
  dialog.show();
  dir=dialog.getTarget();
  if (dialog.isOK() && dir != null) {
    final SVNRevision revision;
    try {
      revision=dialog.getRevision();
    }
 catch (    ConfigurationException e) {
      Messages.showErrorDialog(SvnBundle.message("message.text.cannot.checkout",e.getMessage()),SvnBundle.message("message.title.check.out"));
      return;
    }
    SvnCheckoutProvider.doCheckout(myProject,dir,url.toString(),revision,dialog.getDepth(),dialog.isIgnoreExternals(),listener);
  }
}
