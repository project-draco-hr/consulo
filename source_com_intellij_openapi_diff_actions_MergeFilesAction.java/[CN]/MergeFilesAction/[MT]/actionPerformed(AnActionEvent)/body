{
  DataContext context=e.getDataContext();
  VirtualFile[] files=(VirtualFile[])context.getData(DataConstants.VIRTUAL_FILE_ARRAY);
  if (files == null || files.length != 3) {
    return;
  }
  DiffRequestFactory diffRequestFactory=PeerFactory.getInstance().getDiffRequestFactory();
  VirtualFile file=files[1];
  try {
    String originalText=createValidContent(new String(file.contentsToCharArray()));
    String leftText=new String(files[0].contentsToCharArray());
    String rightText=new String(files[2].contentsToCharArray());
    Project project=(Project)context.getData(DataConstants.PROJECT);
    final MergeRequest diffData=diffRequestFactory.createMergeRequest(leftText,rightText,originalText,file,project,ActionButtonPresentation.createApplyButton());
    diffData.setVersionTitles(new String[]{files[0].getPresentableUrl(),files[1].getPresentableUrl(),files[2].getPresentableUrl()});
    diffData.setWindowTitle(DiffBundle.message("merge.files.dialog.title"));
    diffData.setHelpId("cvs.merge");
    DiffManager.getInstance().getDiffTool().show(diffData);
  }
 catch (  IOException e1) {
    Messages.showErrorDialog(DiffBundle.message("merge.dialog.cannot.load.file.error.message",e1.getLocalizedMessage()),DiffBundle.message("merge.files.dialog.title"));
  }
}
