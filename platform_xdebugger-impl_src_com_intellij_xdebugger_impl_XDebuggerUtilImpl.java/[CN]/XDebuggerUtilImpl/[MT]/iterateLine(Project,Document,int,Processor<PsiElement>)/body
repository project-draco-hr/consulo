{
  PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(document);
  if (file == null)   return;
  int lineStart;
  int lineEnd;
  try {
    lineStart=document.getLineStartOffset(line);
    lineEnd=document.getLineEndOffset(line);
  }
 catch (  IndexOutOfBoundsException e) {
    return;
  }
  PsiElement element;
  int off=lineStart;
  while (off < lineEnd) {
    element=file.findElementAt(off);
    if (element != null) {
      if (!processor.process(element)) {
        return;
      }
 else {
        off=element.getTextRange().getEndOffset();
      }
    }
 else {
      off++;
    }
  }
}
