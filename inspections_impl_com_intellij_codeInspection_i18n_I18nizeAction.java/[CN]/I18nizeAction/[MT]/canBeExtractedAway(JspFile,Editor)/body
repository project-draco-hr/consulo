{
  final TextRange selectedRange=getSelectedRange(editor,jspFile);
  final Ref<Boolean> result=new Ref<Boolean>(Boolean.TRUE);
  PsiFile root=jspFile.getBaseLanguageRoot();
  root.accept(new PsiRecursiveElementVisitor(){
    @Override public void visitElement(    PsiElement element){
      if (!result.get().booleanValue())       return;
      TextRange elementRange=element.getTextRange();
      if (elementRange.intersectsStrict(selectedRange)) {
        if (jspFile.getLanguage() != StdLanguages.JSPX && element instanceof OuterLanguageElement || element instanceof XmlTag && !selectedRange.contains(elementRange) && (!elementRange.contains(selectedRange) || !((XmlTag)element).getValue().getTextRange().contains(selectedRange))) {
          result.set(Boolean.FALSE);
          return;
        }
      }
      super.visitElement(element);
    }
  }
);
  return result.get().booleanValue();
}
