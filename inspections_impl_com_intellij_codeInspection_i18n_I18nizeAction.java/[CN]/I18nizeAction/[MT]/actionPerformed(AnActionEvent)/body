{
  final Editor editor=getEditor(e);
  final Project project=editor.getProject();
  final PsiFile psiFile=DataKeys.PSI_FILE.getData(e.getDataContext());
  if (psiFile == null)   return;
  final I18nQuickFixHandler handler=getHandler(e);
  if (handler == null)   return;
  try {
    handler.checkApplicability(psiFile,editor);
  }
 catch (  IncorrectOperationException ex) {
    JOptionPane.showMessageDialog(null,ex.getMessage(),CodeInsightBundle.message("i18nize.error.title"),JOptionPane.ERROR_MESSAGE);
    return;
  }
  final I18nizeQuickFixDialog dialog=handler.createDialog(project,editor,psiFile);
  if (dialog == null)   return;
  dialog.show();
  if (!dialog.isOK())   return;
  if (!CodeInsightUtil.prepareFileForWrite(psiFile))   return;
  final Collection<PropertiesFile> propertiesFiles=dialog.getAllPropertiesFiles();
  for (  PropertiesFile file : propertiesFiles) {
    if (!CodeInsightUtil.prepareFileForWrite(file))     return;
  }
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      CommandProcessor.getInstance().executeCommand(project,new Runnable(){
        public void run(){
          try {
            handler.performI18nization(psiFile,editor,dialog.getLiteralExpression(),propertiesFiles,dialog.getKey(),dialog.getValue(),dialog.getI18nizedText(),dialog.getParameters(),dialog.getPropertyCreationHandler());
          }
 catch (          IncorrectOperationException e) {
            LOG.error(e);
          }
        }
      }
,CodeInsightBundle.message("quickfix.i18n.command.name"),project);
    }
  }
);
}
