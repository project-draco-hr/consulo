{
  Editor result=null;
  FileEditorManagerEx instanceEx=FileEditorManagerEx.getInstanceEx(myLivePreview.getProject());
  if (instanceEx != null) {
    VirtualFile currentFile=instanceEx.getCurrentFile();
    if (currentFile != null) {
      FileEditor[] editors=instanceEx.getEditors(currentFile);
      if (editors.length > 0) {
        FileEditor fileEditor=editors[0];
        boolean focusedFound=false;
        for (        FileEditor e : editors) {
          if (e instanceof TextEditor && ((TextEditor)e).getEditor().getContentComponent().hasFocus()) {
            fileEditor=e;
            focusedFound=true;
          }
        }
        needToUpdate.set(true);
        if (!focusedFound) {
          for (          FileEditor e : editors) {
            if (e instanceof TextEditor && ((TextEditor)e).getEditor() == myLivePreview.getEditor()) {
              needToUpdate.set(false);
            }
          }
        }
        if (needToUpdate.get() && fileEditor instanceof TextEditor) {
          result=((TextEditor)fileEditor).getEditor();
        }
      }
    }
  }
  return result;
}
