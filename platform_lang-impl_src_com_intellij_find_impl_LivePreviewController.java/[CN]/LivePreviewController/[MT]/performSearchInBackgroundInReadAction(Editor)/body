{
  ArrayList<LiveOccurrence> occurrences=new ArrayList<LiveOccurrence>();
  FindModel currentModel=myFindDialog.getCurrentModel();
  if (currentModel != null) {
    int offset=0;
    VirtualFile virtualFile=FileDocumentManager.getInstance().getFile(editor.getDocument());
    ArrayList<FindResult> results=new ArrayList<FindResult>();
    while (true) {
      FindManager findManager=FindManager.getInstance(editor.getProject());
      FindResult result=findManager.findString(editor.getDocument().getCharsSequence(),offset,currentModel,virtualFile);
      if (!result.isStringFound())       break;
      int newOffset=result.getEndOffset();
      if (offset == newOffset)       break;
      offset=newOffset;
      results.add(result);
      if (results.size() > myMatchesLimit)       break;
    }
    if (results.size() < myMatchesLimit) {
      findResultsToOccurrences(results,occurrences);
    }
  }
  return occurrences;
}
