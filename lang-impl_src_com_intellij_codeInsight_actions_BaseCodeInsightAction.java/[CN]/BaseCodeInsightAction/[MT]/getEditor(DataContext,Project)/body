{
  Editor editor=getBaseEditor(dataContext,project);
  if (!myLookForInjectedEditor)   return editor;
  Editor injectedEditor=editor;
  if (editor != null) {
    PsiDocumentManager documentManager=PsiDocumentManager.getInstance(project);
    PsiFile psiFile=documentManager.getCachedPsiFile(editor.getDocument());
    if (psiFile != null) {
      documentManager.commitAllDocuments();
      injectedEditor=InjectedLanguageUtil.getEditorForInjectedLanguageNoCommit(editor,psiFile);
    }
  }
  return injectedEditor;
}
