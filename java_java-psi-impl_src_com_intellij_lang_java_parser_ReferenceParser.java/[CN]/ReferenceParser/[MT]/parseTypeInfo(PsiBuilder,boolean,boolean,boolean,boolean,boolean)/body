{
  if (builder.getTokenType() == null)   return null;
  final TypeInfo typeInfo=new TypeInfo();
  final boolean annotationsSupported=areTypeAnnotationsSupported(builder);
  PsiBuilder.Marker type=builder.mark();
  if (annotationsSupported) {
    myDeclarationParser.parseAnnotations(builder);
  }
  final IElementType tokenType=builder.getTokenType();
  if (expect(builder,ElementType.PRIMITIVE_TYPE_BIT_SET)) {
    typeInfo.isPrimitive=true;
  }
 else   if (tokenType == JavaTokenType.IDENTIFIER) {
    parseJavaCodeReference(builder,eatLastDot,true,annotationsSupported,false,false,false,diamonds,typeInfo);
  }
 else   if ((wildcard || badWildcard) && tokenType == JavaTokenType.QUEST) {
    type.drop();
    typeInfo.marker=parseWildcardType(builder,wildcard);
    return typeInfo.marker != null ? typeInfo : null;
  }
 else   if (diamonds && tokenType == JavaTokenType.GT) {
    emptyElement(builder,JavaElementType.DIAMOND_TYPE);
    type.done(JavaElementType.TYPE);
    typeInfo.marker=type;
    return typeInfo;
  }
 else {
    type.drop();
    return null;
  }
  while (true) {
    type.done(JavaElementType.TYPE);
    if (annotationsSupported) {
      myDeclarationParser.parseAnnotations(builder);
    }
    final PsiBuilder.Marker bracket=builder.mark();
    if (!expect(builder,JavaTokenType.LBRACKET)) {
      bracket.drop();
      break;
    }
    if (!expect(builder,JavaTokenType.RBRACKET)) {
      bracket.rollbackTo();
      break;
    }
    bracket.drop();
    typeInfo.isArray=true;
    type=type.precede();
  }
  if (ellipsis && builder.getTokenType() == JavaTokenType.ELLIPSIS) {
    type=type.precede();
    builder.advanceLexer();
    type.done(JavaElementType.TYPE);
    typeInfo.isVarArg=true;
  }
  typeInfo.marker=type;
  return typeInfo;
}
