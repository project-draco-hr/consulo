{
  if (shouldNotProcess(e))   return;
  if (isUndoable(e)) {
    if (nonUndoableDeletion(e))     return;
    VirtualFile file=e.getFile();
    file.putUserData(DELETION_WAS_UNDOABLE,createDocumentReference(e));
    LocalHistoryComponent.getComponentInstance(myProject).registerUnsavedDocuments(file);
  }
 else {
    registerNonUndoableAction(e);
  }
}
