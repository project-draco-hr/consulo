{
  LOG.assertTrue(element.isValid());
  element=element.getNavigationElement();
  SmartPointerManager smartPointerManager=SmartPointerManager.getInstance(element.getProject());
  if (startOffset == -1 && endOffset == -1) {
    TextRange range=element.getTextRange();
    if (range == null) {
      LOG.error("text range null for " + element + "; "+ element.getClass());
    }
    startOffset=element.getTextOffset() - range.getStartOffset();
    endOffset=range.getEndOffset() - range.getStartOffset();
  }
  LOG.assertTrue(startOffset >= 0,startOffset);
  LOG.assertTrue(endOffset >= startOffset,endOffset - startOffset);
  if (element instanceof PsiFile) {
    PsiFile file=(PsiFile)element;
    mySmartPointer=smartPointerManager.createSmartPsiFileRangePointer(file,TextRange.create(startOffset,endOffset));
    this.startOffset=-1;
    this.endOffset=-1;
  }
 else {
    this.startOffset=startOffset;
    this.endOffset=endOffset;
    mySmartPointer=smartPointerManager.createSmartPsiElementPointer(element);
  }
  this.isNonCodeUsage=isNonCodeUsage;
}
