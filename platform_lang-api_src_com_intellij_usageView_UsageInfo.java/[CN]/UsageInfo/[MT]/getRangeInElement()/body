{
  PsiElement element=getElement();
  if (element == null)   return null;
  TextRange elementRange=element.getTextRange();
  if (myPsiFileRange == null) {
    int startOffset=element.getTextOffset();
    return TextRange.create(startOffset,elementRange.getEndOffset()).shiftRight(-elementRange.getStartOffset());
  }
 else {
    Segment rangeInFile=myPsiFileRange.getRange();
    if (rangeInFile == null)     return null;
    return TextRange.create(rangeInFile).shiftRight(-elementRange.getStartOffset());
  }
}
