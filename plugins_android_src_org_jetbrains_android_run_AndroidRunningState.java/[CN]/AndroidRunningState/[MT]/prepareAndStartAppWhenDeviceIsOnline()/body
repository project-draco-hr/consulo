{
  if (myTargetDevices.length > 0) {
    for (    IDevice targetDevice : myTargetDevices) {
      if (targetDevice.isOnline()) {
        if (!prepareAndStartApp(targetDevice) && !myStopped) {
          myStopped=true;
          getProcessHandler().destroyProcess();
          break;
        }
      }
    }
    if (!myDebugMode && !myStopped) {
      getProcessHandler().destroyProcess();
    }
    return null;
  }
  final AndroidDebugBridge.IDeviceChangeListener deviceListener=new AndroidDebugBridge.IDeviceChangeListener(){
    boolean installed=false;
    public void deviceConnected(    IDevice device){
      if (device.getAvdName() == null || isMyDevice(device)) {
        message("Device connected: " + device.getSerialNumber(),STDOUT);
      }
    }
    public void deviceDisconnected(    IDevice device){
      if (isMyDevice(device)) {
        message("Device disconnected: " + device.getSerialNumber(),STDOUT);
      }
    }
    public void deviceChanged(    final IDevice device,    int changeMask){
      ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
        public void run(){
          if (!installed && isMyDevice(device) && device.isOnline()) {
            if (myTargetDevices.length == 0) {
              myTargetDevices=new IDevice[]{device};
            }
            message("Device is online: " + device.getSerialNumber(),STDOUT);
            installed=true;
            if ((!prepareAndStartApp(device) || !myDebugMode) && !myStopped) {
              getProcessHandler().destroyProcess();
            }
          }
        }
      }
);
    }
  }
;
  AndroidDebugBridge.addDeviceChangeListener(deviceListener);
  return deviceListener;
}
