{
  message("Waiting for device.",STDOUT);
  if (myTargetDevices.length == 0) {
    if (!chooseOrLaunchDevice()) {
      return;
    }
  }
  if (myDebugMode) {
    AndroidDebugBridge.addClientChangeListener(this);
  }
  final AndroidDebugBridge.IDeviceChangeListener[] deviceListener={null};
  getProcessHandler().addProcessListener(new ProcessAdapter(){
    @Override public void processWillTerminate(    ProcessEvent event,    boolean willBeDestroyed){
      if (myDebugMode) {
        AndroidDebugBridge.removeClientChangeListener(AndroidRunningState.this);
      }
      if (deviceListener[0] != null) {
        AndroidDebugBridge.removeDeviceChangeListener(deviceListener[0]);
      }
      myStopped=true;
synchronized (myLock) {
        myLock.notifyAll();
      }
    }
  }
);
  deviceListener[0]=prepareAndStartAppWhenDeviceIsOnline();
}
