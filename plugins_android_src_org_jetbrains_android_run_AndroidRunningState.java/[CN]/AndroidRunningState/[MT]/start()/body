{
  message("Waiting for device.",STDOUT);
  if (myTargetDevices.length == 0) {
    chooseOrLaunchDevice();
  }
  if (myDebugMode) {
    AdbManager.run(new Runnable(){
      public void run(){
        AndroidDebugBridge.addClientChangeListener(AndroidRunningState.this);
      }
    }
,false);
  }
  final AndroidDebugBridge.IDeviceChangeListener[] deviceListener={null};
  getProcessHandler().addProcessListener(new ProcessAdapter(){
    @Override public void processWillTerminate(    ProcessEvent event,    boolean willBeDestroyed){
      try {
        AdbManager.run(new Runnable(){
          public void run(){
            if (myDebugMode) {
              AndroidDebugBridge.removeClientChangeListener(AndroidRunningState.this);
            }
            if (deviceListener[0] != null) {
              AndroidDebugBridge.removeDeviceChangeListener(deviceListener[0]);
            }
          }
        }
,false);
      }
 catch (      AdbNotRespondingException e) {
        LOG.info(e);
      }
      myStopped=true;
synchronized (myLock) {
        myLock.notifyAll();
      }
    }
  }
);
  deviceListener[0]=prepareAndStartAppWhenDeviceIsOnline();
}
