{
  final List<IDevice> compatibleDevices=getAllCompatibleDevices();
  if (compatibleDevices.size() == 0) {
    return EMPTY_DEVICE_ARRAY;
  }
 else   if (compatibleDevices.size() == 1) {
    return new IDevice[]{compatibleDevices.get(0)};
  }
 else {
    final IDevice[][] devicesWrapper={null};
    ApplicationManager.getApplication().invokeAndWait(new Runnable(){
      @Override public void run(){
        devicesWrapper[0]=chooseDevicesManually(new Condition<IDevice>(){
          @Override public boolean value(          IDevice device){
            return isCompatibleDevice(device) != Boolean.FALSE;
          }
        }
);
      }
    }
,ModalityState.defaultModalityState());
    return devicesWrapper[0].length > 0 ? devicesWrapper[0] : null;
  }
}
