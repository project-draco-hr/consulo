{
  myProcessHandler=new DefaultDebugProcessHandler();
  ConsoleView console;
  if (isDebugMode()) {
    Project project=myFacet.getModule().getProject();
    final TextConsoleBuilder builder=TextConsoleBuilderFactory.getInstance().createBuilder(project);
    console=builder.getConsole();
    if (console != null) {
      console.attachToProcess(myProcessHandler);
    }
  }
 else {
    console=attachConsole();
  }
  myConsole=console;
  if (myTargetChooser instanceof ManualTargetChooser) {
    final ExtendedDeviceChooserDialog chooser=new ExtendedDeviceChooserDialog(myFacet,mySupportMultipleDevices);
    chooser.show();
    if (chooser.getExitCode() != DialogWrapper.OK_EXIT_CODE) {
      return null;
    }
    if (chooser.isToLaunchEmulator()) {
      final String selectedAvd=chooser.getSelectedAvd();
      if (selectedAvd == null) {
        return null;
      }
      myTargetChooser=new EmulatorTargetChooser(selectedAvd);
    }
 else {
      final IDevice[] selectedDevices=chooser.getSelectedDevices();
      if (selectedDevices.length == 0) {
        return null;
      }
      myTargetDevices=selectedDevices;
    }
  }
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    public void run(){
      start();
    }
  }
);
  return new DefaultExecutionResult(console,myProcessHandler);
}
