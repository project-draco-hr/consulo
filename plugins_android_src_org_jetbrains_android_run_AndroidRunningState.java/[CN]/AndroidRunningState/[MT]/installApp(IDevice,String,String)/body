{
  getProcessHandler().notifyTextAvailable("Installing " + packageName + ".\n",STDOUT);
  MyReceiver receiver=new MyReceiver();
  while (true) {
    if (myStopped)     return false;
    boolean deviceNotResponding=false;
    try {
      executeDeviceCommandAndWriteToConsole(device,"pm install -r \"" + remotePath + "\"",receiver);
    }
 catch (    ShellCommandUnresponsiveException e) {
      LOG.info(e);
      deviceNotResponding=true;
    }
    if (!deviceNotResponding && receiver.errorType != 1 && receiver.errorType != UNTYPED_ERROR) {
      break;
    }
    getProcessHandler().notifyTextAvailable("Device is not ready. Waiting for " + WAITING_TIME + " sec.\n",STDOUT);
synchronized (myLock) {
      try {
        myLock.wait(WAITING_TIME * 1000);
      }
 catch (      InterruptedException e) {
        LOG.info(e);
      }
    }
    receiver=new MyReceiver();
  }
  if (!isSuccess(receiver)) {
    getProcessHandler().notifyTextAvailable("Can't reinstall application. Installing from scratch.\n",STDOUT);
    executeDeviceCommandAndWriteToConsole(device,"pm uninstall \"" + remotePath + '\"',receiver);
    if (myStopped)     return false;
    executeDeviceCommandAndWriteToConsole(device,"pm install \"" + remotePath + '\"',receiver);
    if (myStopped)     return false;
  }
  boolean success=isSuccess(receiver);
  getProcessHandler().notifyTextAvailable(receiver.output.toString(),success ? STDOUT : STDERR);
  return success;
}
