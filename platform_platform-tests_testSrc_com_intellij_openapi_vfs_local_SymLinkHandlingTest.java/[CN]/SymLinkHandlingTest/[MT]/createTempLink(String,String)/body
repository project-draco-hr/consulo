{
  final File linkFile=new File(FileUtil.getTempDirectory(),link);
  assertTrue(link,!linkFile.exists() || linkFile.delete());
  final File parentDir=linkFile.getParentFile();
  assertTrue("link=" + link + ", parent="+ parentDir,parentDir != null && (parentDir.isDirectory() || parentDir.mkdirs()));
  final GeneralCommandLine commandLine;
  if (SystemInfo.isWindows) {
    commandLine=new File(target).isDirectory() ? new GeneralCommandLine("cmd","/C","mklink","/D",linkFile.getAbsolutePath(),target) : new GeneralCommandLine("cmd","/C","mklink",linkFile.getAbsolutePath(),target);
  }
 else {
    commandLine=new GeneralCommandLine("ln","-s",target,linkFile.getAbsolutePath());
  }
  final Process process=commandLine.createProcess();
  final int res=process.waitFor();
  assertTrue(commandLine.getCommandLineString() + ": " + res,res == 0);
  final File targetFile=new File(target);
  assertEquals("target=" + target + ", link="+ linkFile,targetFile.exists(),linkFile.exists());
  return linkFile;
}
