{
  if (myProject.isDisposed())   return;
  for (  VirtualFile root : myAffectedContentRoots) {
    THashSet<FilePath> dirsByRoot=myDirtyDirectoriesRecursively.get(root);
    if (dirsByRoot != null) {
      for (      FilePath dir : dirsByRoot) {
        final VirtualFile vFile=dir.getVirtualFile();
        if (vFile != null && vFile.isValid()) {
          myVcsManager.iterateVcsRoot(vFile,iterator);
        }
      }
    }
  }
  for (  FilePath file : myDirtyFiles) {
    iterator.process(file);
    final VirtualFile vFile=file.getVirtualFile();
    if (vFile != null && vFile.isValid() && vFile.isDirectory()) {
      for (      VirtualFile child : vFile.getChildren()) {
        iterator.process(new FilePathImpl(child));
      }
    }
  }
}
