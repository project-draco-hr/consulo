{
  final long oldMoment=System.currentTimeMillis() - EMPTY_CONNECTION_ALLOWED_FOR;
  IConnection result=null;
synchronized (myLock) {
    SshLogger.debug("shared connection: queue size " + myQueue.size());
    for (Iterator<Cell> iterator=myQueue.iterator(); iterator.hasNext(); ) {
      final Cell cell=iterator.next();
      if (result == null) {
        result=cell.allocate();
      }
 else {
        if (cell.isEmptyAndOlderThen(oldMoment)) {
          SshLogger.debug("empty and older");
          cell.closeSelf();
          iterator.remove();
        }
      }
    }
    if (result != null)     return result;
    SshLogger.debug("new cell");
    final Cell newCell=new Cell(myConnectionFactory,myRepository);
    myQueue.add(newCell);
    return newCell.allocate();
  }
}
