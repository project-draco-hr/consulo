{
  if (!statement.isValid()) {
    LOG.assertTrue(false);
  }
  if (!checkRangeContainsElement(blockCandidate))   return;
  final PsiManager manager=statement.getManager();
  LOG.assertTrue(manager != null);
  GroovyPsiElementFactory factory=GroovyPsiElementFactory.getInstance(manager.getProject());
  String oldText=blockCandidate.getText();
  int lastLineFeedIndex=oldText.lastIndexOf("\n");
  lastLineFeedIndex=Math.max(0,lastLineFeedIndex);
  int lastLineCommentIndex=oldText.indexOf("//",lastLineFeedIndex);
  StringBuilder buf=new StringBuilder(oldText.length() + 5);
  buf.append("{ ").append(oldText);
  if (lastLineCommentIndex >= 0) {
    buf.append("\n");
  }
  buf.append(" }");
  final int oldTextLength=statement.getTextLength();
  try {
    CodeEditUtil.replaceChild(SourceTreeToPsiMap.psiElementToTree(statement),SourceTreeToPsiMap.psiElementToTree(blockCandidate),SourceTreeToPsiMap.psiElementToTree(factory.createBlockStatementFromText(buf.toString(),null)));
    CodeStyleManager.getInstance(statement.getProject()).reformat(statement,true);
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
 finally {
    updateResultRange(oldTextLength,statement.getTextLength());
  }
}
