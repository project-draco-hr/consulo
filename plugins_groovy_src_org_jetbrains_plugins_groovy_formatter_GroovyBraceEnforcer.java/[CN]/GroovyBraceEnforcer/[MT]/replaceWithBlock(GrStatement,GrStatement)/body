{
  if (!statement.isValid()) {
    LOG.assertTrue(false);
  }
  if (!checkRangeContainsElement(blockCandidate))   return;
  final PsiManager manager=statement.getManager();
  LOG.assertTrue(manager != null);
  GroovyPsiElementFactory factory=GroovyPsiElementFactory.getInstance(manager.getProject());
  String oldText=blockCandidate.getText();
  StringBuilder buf=new StringBuilder(oldText.length() + 5);
  buf.append("{\n").append(oldText);
  buf.append("\n}");
  final int oldTextLength=statement.getTextLength();
  try {
    ASTNode newChild=SourceTreeToPsiMap.psiElementToTree(factory.createBlockStatementFromText(buf.toString(),null));
    ASTNode parent=SourceTreeToPsiMap.psiElementToTree(statement);
    ASTNode childToReplace=SourceTreeToPsiMap.psiElementToTree(blockCandidate);
    CodeEditUtil.replaceChild(parent,childToReplace,newChild);
    removeTailSemicolon(newChild,parent);
    CodeStyleManager.getInstance(statement.getProject()).reformat(statement,true);
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
 finally {
    updateResultRange(oldTextLength,statement.getTextLength());
  }
}
