{
  if ((ourMode & CHECK_MEMORY) == 0)   return true;
  boolean possibleOutOfMemoryError=possibleOutOfMemory(neededMemory);
  if (possibleOutOfMemoryError) {
    tryGc(5);
    possibleOutOfMemoryError=possibleOutOfMemory(neededMemory);
    if (possibleOutOfMemoryError) {
      System.out.println("OutOfMemoryError: dumping memory");
      Runtime runtime=Runtime.getRuntime();
      long total=runtime.totalMemory();
      long free=runtime.freeMemory();
      String errorMessage="Too much memory used. Total: " + total + " free: "+ free+ " used: "+ (total - free)+ "\n";
      String message=ProfilingUtil.forceCaptureMemorySnapshot();
      if (message != null)       errorMessage+=message;
      addErrorMessage(testResult,errorMessage);
    }
  }
  return !possibleOutOfMemoryError;
}
