{
  final PsiElement element=(PsiElement)this;
  if (!element.isValid())   return null;
  RowIcon baseIcon;
  final boolean isLocked=(flags & ICON_FLAG_READ_STATUS) != 0 && !element.isWritable();
  int elementFlags=isLocked ? FLAGS_LOCKED : 0;
  if (element instanceof ItemPresentation && ((ItemPresentation)element).getIcon(false) != null) {
    baseIcon=createLayeredIcon(this,((ItemPresentation)element).getIcon(false),elementFlags);
  }
 else   if (element instanceof PsiFile) {
    PsiFile file=(PsiFile)element;
    VirtualFile virtualFile=file.getVirtualFile();
    final Icon fileTypeIcon;
    if (virtualFile == null) {
      fileTypeIcon=file.getFileType().getIcon();
    }
 else {
      fileTypeIcon=IconUtil.getIcon(virtualFile,flags & ~ICON_FLAG_READ_STATUS,file.getProject());
    }
    return createLayeredIcon(this,fileTypeIcon,elementFlags);
  }
 else {
    return null;
  }
  return baseIcon;
}
