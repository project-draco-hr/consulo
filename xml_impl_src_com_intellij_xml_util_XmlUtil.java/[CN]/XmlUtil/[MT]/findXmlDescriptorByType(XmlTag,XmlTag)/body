{
  String type=xmlTag.getAttributeValue("type",XML_SCHEMA_INSTANCE_URI);
  if (type == null) {
    String ns=xmlTag.getNamespace();
    if (XmlUtil.ourSchemaUrisList.indexOf(ns) >= 0) {
      type=xmlTag.getAttributeValue("type",null);
    }
  }
  XmlElementDescriptor elementDescriptor=null;
  if (type != null) {
    final String namespaceByPrefix=findNamespaceByPrefix(findPrefixByQualifiedName(type),xmlTag);
    XmlNSDescriptor typeDecr=xmlTag.getNSDescriptor(namespaceByPrefix,true);
    if (typeDecr == null && namespaceByPrefix.length() == 0) {
      if (context != null)       typeDecr=context.getNSDescriptor("",true);
      if (typeDecr == null) {
        final PsiFile containingFile=xmlTag.getContainingFile();
        if (containingFile instanceof XmlFile) {
          final XmlDocument document=((XmlFile)containingFile).getDocument();
          if (document != null)           typeDecr=(XmlNSDescriptor)document.getMetaData();
        }
      }
    }
    if (typeDecr instanceof XmlNSDescriptorImpl) {
      final XmlNSDescriptorImpl schemaDescriptor=(XmlNSDescriptorImpl)typeDecr;
      elementDescriptor=schemaDescriptor.getDescriptorByType(type,xmlTag);
    }
  }
  return elementDescriptor;
}
