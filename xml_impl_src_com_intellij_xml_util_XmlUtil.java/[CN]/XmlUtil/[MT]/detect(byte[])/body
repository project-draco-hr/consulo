{
  int index=0;
  if (CharsetToolkit.hasUTF8Bom(bytes)) {
    index=CharsetToolkit.UTF8_BOM.length;
  }
  index=skipWhiteSpace(index,bytes);
  if (!ArrayUtil.startsWith(bytes,index,XML_PROLOG_START_BYTES))   return null;
  index+=XML_PROLOG_START_BYTES.length;
  while (index < bytes.length) {
    index=skipWhiteSpace(index,bytes);
    if (ArrayUtil.startsWith(bytes,index,XML_PROLOG_END_BYTES))     return null;
    if (ArrayUtil.startsWith(bytes,index,ENCODING_BYTES)) {
      index+=ENCODING_BYTES.length;
      index=skipWhiteSpace(index,bytes);
      if (index >= bytes.length || bytes[index] != '=')       continue;
      index++;
      index=skipWhiteSpace(index,bytes);
      if (index >= bytes.length || bytes[index] != '\'' && bytes[index] != '\"')       continue;
      byte quote=bytes[index];
      index++;
      StringBuilder encoding=new StringBuilder();
      while (index < bytes.length) {
        if (bytes[index] == quote)         return encoding.toString();
        encoding.append((char)bytes[index++]);
      }
    }
    index++;
  }
  return null;
}
