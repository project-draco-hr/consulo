{
  try {
    final Collection<URL> urls=getClassLoaderUrls();
    final String platformPrefix=System.getProperty(PlatformUtils.PLATFORM_PREFIX_KEY);
    int i=0;
    for (    URL url : urls) {
      i++;
      final String protocol=url.getProtocol();
      if ("file".equals(protocol)) {
        final File file=new File(URLDecoder.decode(url.getFile()));
        IdeaPluginDescriptorImpl platformPluginDescriptor=null;
        if (platformPrefix != null) {
          platformPluginDescriptor=loadDescriptor(file,platformPrefix + "Plugin.xml");
          if (platformPluginDescriptor != null && !result.contains(platformPluginDescriptor)) {
            platformPluginDescriptor.setUseCoreClassLoader(true);
            result.add(platformPluginDescriptor);
          }
        }
        IdeaPluginDescriptorImpl pluginDescriptor=loadDescriptor(file,PLUGIN_XML);
        if (platformPrefix != null && pluginDescriptor != null && pluginDescriptor.getName().equals(SPECIAL_IDEA_PLUGIN)) {
          continue;
        }
        if (pluginDescriptor != null && !result.contains(pluginDescriptor)) {
          if (platformPluginDescriptor != null) {
            pluginDescriptor.setUseCoreClassLoader(true);
          }
          result.add(pluginDescriptor);
          if (progress != null) {
            progress.showProgress("Plugin loaded: " + pluginDescriptor.getName(),PLUGINS_PROGRESS_MAX_VALUE * ((float)i / urls.size()));
          }
        }
      }
    }
  }
 catch (  Exception e) {
    System.err.println("Error loading plugins from classpath:");
    e.printStackTrace();
  }
}
