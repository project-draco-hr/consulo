{
  if (flow.getEndOffset(ifStatement) == flow.getEndOffset(thenBranch)) {
    final PsiLoopStatement loopStmt=PsiTreeUtil.getParentOfType(ifStatement,PsiLoopStatement.class);
    if (loopStmt != null) {
      final PsiStatement body=loopStmt.getBody();
      if (body instanceof PsiBlockStatement) {
        final PsiStatement[] statements=((PsiBlockStatement)body).getCodeBlock().getStatements();
        if (statements.length > 0 && !PsiTreeUtil.isAncestor(statements[statements.length - 1],ifStatement,false) && ArrayUtilRt.find(statements,ifStatement) < 0) {
          ifStatement.setElseBranch(thenBranch);
          return;
        }
      }
    }
    if (thenBranch instanceof PsiContinueStatement) {
      PsiStatement elseBranch=ifStatement.getElseBranch();
      if (elseBranch != null) {
        elseBranch.delete();
      }
      return;
    }
 else     if (thenBranch instanceof PsiBlockStatement) {
      PsiStatement[] statements=((PsiBlockStatement)thenBranch).getCodeBlock().getStatements();
      if (statements.length > 0 && statements[statements.length - 1] instanceof PsiContinueStatement) {
        statements[statements.length - 1].delete();
      }
    }
  }
  ifStatement.setElseBranch(thenBranch);
}
