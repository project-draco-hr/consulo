{
  if (project == null) {
    project=ProjectManager.getInstance().getDefaultProject();
  }
  if (fileType instanceof LanguageFileType) {
    final Language language=((LanguageFileType)fileType).getLanguage();
    final Language substitutedLanguage=LanguageSubstitutors.INSTANCE.substituteLanguage(language,file,project);
    if (substitutedLanguage != null && !substitutedLanguage.equals(language)) {
      return new SubstitutedFileType(fileType,substitutedLanguage.getAssociatedFileType());
    }
  }
  return fileType;
}
