{
  if (!myUpdating.get())   myUpdating.set(true);
  final JBLoadingPanel loadingPanel=getLoadingPanel();
  if (!loadingPanel.isLoading()) {
    loadingPanel.startLoading();
    if (updater == null) {
      updater=new Updater(loadingPanel,100);
      updater.start();
    }
  }
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    public void run(){
      myTree.updateVisibility(mySettings);
      final ArrayList<DirDiffElement> elements=new ArrayList<DirDiffElement>();
      fillElements(myTree,elements);
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          clear();
          myElements.addAll(elements);
          myUpdating.set(false);
          fireTableDataChanged();
          selectFirstRow();
          DirDiffTableModel.this.text.set("");
          if (loadingPanel.isLoading()) {
            loadingPanel.stopLoading();
          }
        }
      }
);
    }
  }
);
}
