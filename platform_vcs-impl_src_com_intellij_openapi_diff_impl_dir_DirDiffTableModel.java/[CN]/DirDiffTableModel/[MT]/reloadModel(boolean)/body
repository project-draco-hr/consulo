{
  myUpdating.set(true);
  final JBLoadingPanel loadingPanel=getLoadingPanel();
  loadingPanel.startLoading();
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    public void run(){
      try {
        updater=new Updater(loadingPanel,100);
        updater.start();
        myTree=new DTree(null,"",true);
        mySrc.refresh(userForcedRefresh);
        myTrg.refresh(userForcedRefresh);
        scan(mySrc,myTree,true);
        scan(myTrg,myTree,false);
        myTree.setSource(mySrc);
        myTree.setTarget(myTrg);
        myTree.update(mySettings);
        applySettings();
      }
 catch (      final IOException e) {
        LOG.warn(e);
        if (loadingPanel.isLoading()) {
          loadingPanel.stopLoading();
        }
        reportException(VcsBundle.message("refresh.failed.message",StringUtil.decapitalize(e.getLocalizedMessage())));
      }
    }
  }
);
}
