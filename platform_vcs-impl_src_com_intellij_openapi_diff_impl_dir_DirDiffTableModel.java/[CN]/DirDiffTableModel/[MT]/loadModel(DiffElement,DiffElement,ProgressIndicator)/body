{
  mySrc=src;
  myTrg=trg;
  scan("",src,mySrcPaths,indicator,true);
  scan("",trg,myTrgPaths,indicator,true);
  final HashSet<String> files=new HashSet<String>();
  files.addAll(mySrcPaths.keySet());
  files.addAll(myTrgPaths.keySet());
  final ArrayList<String> pathes=new ArrayList<String>(files);
  Collections.sort(pathes,new Comparator<String>(){
    @Override public int compare(    String o1,    String o2){
      final boolean b1=o1.endsWith("/");
      final boolean b2=o2.endsWith("/");
      final String[] dirs1=o1.split("/");
      final String[] dirs2=o2.split("/");
      final int len1=dirs1.length;
      final int len2=dirs2.length;
      if ((!b1 && len1 == 1) || (!b2 && len2 == 1)) {
        if ((!b1 && len1 == 1) && (!b2 && len2 == 1)) {
          return dirs1[0].toLowerCase().compareTo(dirs2[0].toLowerCase());
        }
 else {
          return len1 == 1 ? -1 : 1;
        }
      }
      for (int i=0; i < Math.min(len1,len2); i++) {
        final int cmp=dirs1[i].toLowerCase().compareTo(dirs2[i].toLowerCase());
        if (cmp != 0)         return cmp;
      }
      return len1 - len2;
    }
  }
);
  for (  String path : pathes) {
    final DiffElement srcFile=mySrcPaths.get(path);
    final DiffElement trgFile=myTrgPaths.get(path);
    if (srcFile == null && trgFile != null) {
      myElements.add(DirDiffElement.createTargetOnly(trgFile));
    }
 else     if (srcFile != null && trgFile == null) {
      myElements.add(DirDiffElement.createSourceOnly(srcFile));
    }
 else     if (srcFile != null && trgFile != null) {
      indicator.setText2("Comparing " + path);
      if (srcFile.isContainer() && trgFile.isContainer()) {
        myElements.add(DirDiffElement.createDirElement(srcFile,trgFile,path));
      }
 else       if (srcFile.isContainer() && !trgFile.isContainer()) {
        myElements.add(DirDiffElement.createDirElement(srcFile,null,path));
        myElements.add(DirDiffElement.createTargetOnly(trgFile));
      }
 else       if (!srcFile.isContainer() && trgFile.isContainer()) {
        myElements.add(DirDiffElement.createDirElement(null,trgFile,path));
        myElements.add(DirDiffElement.createSourceOnly(srcFile));
      }
 else       if (!isEqual(srcFile,trgFile)) {
        myElements.add(DirDiffElement.createChange(srcFile,trgFile));
      }
    }
  }
  removeEmptyDirs(myElements);
}
