{
  final VirtualFile virtualFile=e.getData(PlatformDataKeys.VIRTUAL_FILE);
  LOG.assertTrue(virtualFile != null);
  final String path=virtualFile.getPath();
  final JavaFxSettings settings=JavaFxSettings.getInstance();
  String pathToSceneBuilder=settings.getPathToSceneBuilder();
  if (StringUtil.isEmptyOrSpaces(settings.getPathToSceneBuilder())) {
    final VirtualFile sceneBuilderFile=FileChooser.chooseFile(JavaFxSettingsConfigurable.createSceneBuilderDescriptor(),e.getProject(),null);
    if (sceneBuilderFile == null)     return;
    pathToSceneBuilder=sceneBuilderFile.getPath();
    settings.setPathToSceneBuilder(FileUtil.toSystemIndependentName(pathToSceneBuilder));
  }
  final Project project=getEventProject(e);
  if (project != null) {
    final Module module=ModuleUtilCore.findModuleForFile(virtualFile,project);
    if (module != null) {
      try {
        final JavaParameters javaParameters=new JavaParameters();
        javaParameters.configureByModule(module,JavaParameters.JDK_AND_CLASSES);
        final File sceneBuilderLibsFile;
        if (SystemInfo.isMac) {
          sceneBuilderLibsFile=new File(new File(pathToSceneBuilder,"Contents"),"Java");
        }
 else {
          File sceneBuilderRoot=new File(pathToSceneBuilder);
          sceneBuilderRoot=sceneBuilderRoot.getParentFile().getParentFile();
          sceneBuilderLibsFile=new File(sceneBuilderRoot,"lib");
        }
        final File[] sceneBuilderLibs=sceneBuilderLibsFile.listFiles();
        if (sceneBuilderLibs != null) {
          for (          File jarFile : sceneBuilderLibs) {
            javaParameters.getClassPath().add(jarFile.getPath());
          }
        }
        javaParameters.setMainClass("com.oracle.javafx.authoring.Main");
        javaParameters.getProgramParametersList().add(path);
        final OSProcessHandler processHandler=javaParameters.createOSProcessHandler();
        final String commandLine=processHandler.getCommandLine();
        LOG.info("scene builder command line: " + commandLine);
        processHandler.startNotify();
        return;
      }
 catch (      Exception ignore) {
      }
    }
  }
  if (SystemInfo.isMac) {
    pathToSceneBuilder+="/Contents/MacOS/JavaAppLauncher";
  }
  final GeneralCommandLine commandLine=new GeneralCommandLine();
  try {
    commandLine.setExePath(FileUtil.toSystemDependentName(pathToSceneBuilder));
    commandLine.addParameter(path);
    commandLine.createProcess();
  }
 catch (  ExecutionException ex) {
    Messages.showErrorDialog("Failed to start SceneBuilder: " + commandLine.getCommandLineString(),CommonBundle.getErrorTitle());
  }
}
