def _sendmail(ui, sender, recipients, msg):
    'send mail using sendmail.'
    program = ui.config('email', 'method')
    cmdline = ('%s -f %s %s' % (program, util.email(sender), ' '.join(map(util.email, recipients))))
    ui.note((_('sending mail: %s\n') % cmdline))
    fp = util.popen(cmdline, 'w')
    fp.write(msg)
    ret = fp.close()
    if ret:
        raise util.Abort(('%s %s' % (os.path.basename(program.split(None, 1)[0]), util.explain_exit(ret)[0])))
