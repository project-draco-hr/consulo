def mimetextpatch(s, subtype='plain', display=False):
    'If patch in utf-8 transfer-encode it.'
    enc = None
    for line in s.splitlines():
        if (len(line) > 950):
            s = quopri.encodestring(s)
            enc = 'quoted-printable'
            break
    cs = 'us-ascii'
    if (not display):
        try:
            s.decode('us-ascii')
        except UnicodeDecodeError:
            try:
                s.decode('utf-8')
                cs = 'utf-8'
            except UnicodeDecodeError:
                pass
    msg = email.MIMEText.MIMEText(s, subtype, cs)
    if enc:
        del msg['Content-Transfer-Encoding']
        msg['Content-Transfer-Encoding'] = enc
    return msg
