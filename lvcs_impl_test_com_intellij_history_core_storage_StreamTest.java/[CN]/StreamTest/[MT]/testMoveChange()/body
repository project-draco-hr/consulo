{
  Entry root=new RootEntry();
  createDirectory(root,1,"dir1");
  createDirectory(root,2,"dir2");
  createFile(root,3,"dir1/file",null,-1);
  Change c=new MoveChange("dir1/file","dir2");
  c.applyTo(root);
  os.writeChange(c);
  Change read=is.readChange();
  assertEquals(MoveChange.class,read.getClass());
  MoveChange result=((MoveChange)read);
  assertEquals(list(idp(-1,1,3),idp(-1,2,3)),result.getAffectedIdPaths());
}
