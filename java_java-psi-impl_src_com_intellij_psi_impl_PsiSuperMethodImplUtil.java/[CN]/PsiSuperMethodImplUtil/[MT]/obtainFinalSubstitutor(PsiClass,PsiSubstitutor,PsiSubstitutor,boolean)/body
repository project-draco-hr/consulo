{
  if (inRawContext) {
    superSubstitutor=JavaPsiFacadeEx.getElementFactory(superClass.getProject()).createRawSubstitutor(derivedSubstitutor,superSubstitutor.getSubstitutionMap().keySet().toArray(PsiTypeParameter.EMPTY_ARRAY));
  }
  Map<PsiTypeParameter,PsiType> map=null;
  for (  PsiTypeParameter typeParameter : PsiUtil.typeParametersIterable(superClass)) {
    PsiType type=superSubstitutor.substitute(typeParameter);
    final PsiType t=derivedSubstitutor.substitute(type);
    if (map == null) {
      map=new THashMap<PsiTypeParameter,PsiType>();
    }
    map.put(typeParameter,t);
  }
  return map == null ? PsiSubstitutor.EMPTY : JavaPsiFacade.getInstance(superClass.getProject()).getElementFactory().createSubstitutor(map);
}
