{
  final Set<File> excludes;
  if (target instanceof ModuleBuildTarget) {
    excludes=new THashSet<File>(FileUtil.FILE_HASHING_STRATEGY);
    final ModuleExcludeIndex index=context.getProjectDescriptor().getModuleExcludeIndex();
    excludes.addAll(index.getModuleExcludes(((ModuleBuildTarget)target).getModule()));
  }
 else {
    excludes=Collections.emptySet();
  }
  for (  BuildRootDescriptor rd : context.getProjectDescriptor().getBuildRootIndex().getTargetRoots(target,context)) {
    if (!rd.getRootFile().exists() || (rd instanceof JavaSourceRootDescriptor && ((JavaSourceRootDescriptor)rd).isTemp)) {
      continue;
    }
    context.getProjectDescriptor().fsState.clearRecompile(rd);
    traverseRecursively(context,rd,rd.getRootFile(),excludes,timestamps,forceMarkDirty,currentFiles);
  }
}
