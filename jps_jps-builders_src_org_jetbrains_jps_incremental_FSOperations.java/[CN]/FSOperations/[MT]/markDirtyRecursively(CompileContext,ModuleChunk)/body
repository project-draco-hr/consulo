{
  Set<JpsModule> modules=chunk.getModules();
  Set<RealModuleBuildTarget> targets=chunk.getTargets();
  final Set<RealModuleBuildTarget> dirtyTargets=new HashSet<RealModuleBuildTarget>(targets);
  final JpsJavaClasspathKind classpathKind=JpsJavaClasspathKind.compile(context.isCompilingTests());
  final ProjectChunks chunks=context.isCompilingTests() ? context.getTestChunks() : context.getProductionChunks();
  boolean found=false;
  for (  ModuleChunk moduleChunk : chunks.getChunkList()) {
    if (!found) {
      if (moduleChunk.equals(chunk)) {
        found=true;
      }
    }
 else {
      for (      final JpsModule module : moduleChunk.getModules()) {
        final Set<JpsModule> deps=getDependentModulesRecursively(module,classpathKind);
        if (Utils.intersects(deps,modules)) {
          dirtyTargets.addAll(moduleChunk.getTargets());
          break;
        }
      }
    }
  }
  final Timestamps timestamps=context.getProjectDescriptor().timestamps.getStorage();
  for (  RealModuleBuildTarget target : dirtyTargets) {
    markDirtyFiles(context,target,timestamps,true,context.isCompilingTests() ? DirtyMarkScope.TESTS : DirtyMarkScope.BOTH,null);
  }
  if (context.isMake()) {
    for (    RealModuleBuildTarget target : targets) {
      context.markNonIncremental(target);
    }
  }
}
