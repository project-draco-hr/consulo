{
  if (vcses.isEmpty())   return;
  final MultiMap<String,String> copy=new MultiMap<String,String>();
  copy.putAllValues(vcses);
  if (!checkForInMemory(copy))   return;
  final HashSet<String> vcsNamesSet=new HashSet<String>(vcses.keySet());
  for (Iterator<String> iterator=vcsNamesSet.iterator(); iterator.hasNext(); ) {
    final String key=iterator.next();
    if (myKnownRepositoryLocations.exists(key)) {
      iterator.remove();
    }
  }
  if (!vcsNamesSet.isEmpty()) {
    ensureVcsAreInDB(vcsNamesSet);
  }
  final Set<Long> rootIdsToCheck=ensurePathsAreInDB(copy);
  if (!rootIdsToCheck.isEmpty()) {
    updateLastRevisions(rootIdsToCheck);
  }
}
