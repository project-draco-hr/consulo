{
  Object o=item.getObject();
  String text=null;
  if (o instanceof PsiElement) {
    if (showSignature(item)) {
      PsiType typeAttr=(PsiType)item.getAttribute(LookupItem.TYPE_ATTR);
      if (typeAttr != null) {
        text=typeAttr.getPresentableText();
      }
 else {
        final PsiElement element=(PsiElement)o;
        if (element.isValid()) {
          if (element instanceof PsiMethod) {
            PsiMethod method=(PsiMethod)element;
            PsiType returnType=method.getReturnType();
            if (returnType != null) {
              final PsiSubstitutor substitutor=(PsiSubstitutor)item.getAttribute(LookupItem.SUBSTITUTOR);
              if (substitutor != null) {
                text=substitutor.substitute(returnType).getPresentableText();
              }
 else {
                text=returnType.getPresentableText();
              }
            }
          }
 else           if (element instanceof PsiVariable) {
            PsiVariable variable=(PsiVariable)element;
            text=variable.getType().getPresentableText();
          }
 else           if (element instanceof PsiExpression) {
            PsiExpression expression=(PsiExpression)element;
            PsiType type=expression.getType();
            if (type != null) {
              text=type.getPresentableText();
            }
          }
        }
      }
    }
  }
 else   if (o instanceof LookupValueWithUIHint) {
    text=((LookupValueWithUIHint)o).getTypeHint();
  }
 else {
    text=(String)item.getAttribute(LookupItem.TYPE_TEXT_ATTR);
  }
  return text;
}
