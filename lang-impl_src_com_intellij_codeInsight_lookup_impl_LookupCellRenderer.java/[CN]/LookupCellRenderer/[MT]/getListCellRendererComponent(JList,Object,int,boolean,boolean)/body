{
  final LookupElement item=(LookupElement)value;
  Color background=isSelected ? SELECTED_BACKGROUND_COLOR : BACKGROUND_COLOR;
  final Color foreground=isSelected ? SELECTED_FOREGROUND_COLOR : FOREGROUND_COLOR;
  final int preferredCount=myLookup.getPreferredItemsCount();
  if (index <= preferredCount - 1 && preferredCount < list.getModel().getSize() - 1) {
    background=isSelected ? SELECTED_BACKGROUND_COLOR : PREFERRED_BACKGROUND_COLOR;
  }
  myLookupElementPresentation.setContext(item,background,foreground,list,isSelected);
  myNameComponent.clear();
  myTailComponent.clear();
  myTypeLabel.setText(null);
  myArrowLabel.setIcon(myLookup.getActionsFor(item).isEmpty() ? PopupIcons.EMPTY_ICON : PopupIcons.HAS_NEXT_ICON_GRAYED);
  myArrowLabel.setBackground(background);
  myArrowLabel.setForeground(foreground);
  myNameComponent.setIcon(myEmptyIcon);
  item.renderElement(myLookupElementPresentation);
  return myPanel;
}
