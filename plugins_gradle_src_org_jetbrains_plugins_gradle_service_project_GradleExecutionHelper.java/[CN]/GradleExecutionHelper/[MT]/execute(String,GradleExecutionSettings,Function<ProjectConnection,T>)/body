{
  String userDir=null;
  try {
    userDir=System.getProperty("user.dir");
    System.setProperty("user.dir",projectPath);
  }
 catch (  Exception e) {
  }
  ProjectConnection connection=getConnection(projectPath,settings);
  try {
    return f.fun(connection);
  }
 catch (  Throwable e) {
    throw new ExternalSystemException(e);
  }
 finally {
    try {
      connection.close();
      if (userDir != null) {
        System.setProperty("user.dir",userDir);
      }
    }
 catch (    Throwable e) {
    }
  }
}
