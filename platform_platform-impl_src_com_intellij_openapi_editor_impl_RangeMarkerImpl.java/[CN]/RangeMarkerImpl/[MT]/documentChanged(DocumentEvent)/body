{
  int modCount=this.modCount++;
  int oldStart=myStart;
  int oldEnd=myEnd;
  int docLength=myDocument.getTextLength();
  if (!isValid) {
    LOG.error("Invalid range marker " + (isExpandToLeft ? "[" : "(") + oldStart+ ", "+ oldEnd+ (isExpandToRight ? "]" : ")")+ ". Event = "+ e+ ". Doc length="+ docLength+ "; "+ getClass());
    return;
  }
  if (myStart > myEnd || myStart < 0 || myEnd > docLength - e.getNewLength() + e.getOldLength()) {
    LOG.error("RangeMarker" + (isExpandToLeft ? "[" : "(") + oldStart+ ", "+ oldEnd+ (isExpandToRight ? "]" : ")")+ " is invalid before update. Event = "+ e+ ". Doc length="+ docLength+ "; "+ getClass());
    isValid=false;
    return;
  }
  changedUpdateImpl(e);
  if (isValid && (myStart > myEnd || myStart < 0 || myEnd > docLength)) {
    LOG.error("RangeMarker" + (isExpandToLeft ? "[" : "(") + oldStart+ ", "+ oldEnd+ (isExpandToRight ? "]" : ")")+ " update failed. Event = "+ e+ ". Result["+ myStart+ ", "+ myEnd+ "], "+ "old doc length="+ docLength+ "; real doc length = "+ myDocument.getTextLength()+ "; old mod count="+ modCount+ "; mod count="+ this.modCount+ "; "+ getClass());
    isValid=false;
  }
}
