{
  if (myModulePaths != null && myModulePaths.length > 0) {
    final Application app=ApplicationManager.getApplication();
    final Runnable swingRunnable=new Runnable(){
      public void run(){
        myFailedModulePaths.clear();
        myFailedModulePaths.addAll(Arrays.asList(myModulePaths));
        final List<Module> modulesWithUnknownTypes=new ArrayList<Module>();
        List<ModuleLoadingErrorDescription> errors=new ArrayList<ModuleLoadingErrorDescription>();
        for (        final ModulePath modulePath : myModulePaths) {
          try {
            final Module module=myModuleModel.loadModuleInternal(modulePath.getPath());
            if (module.getModuleType() instanceof UnknownModuleType) {
              modulesWithUnknownTypes.add(module);
            }
            final String groupPathString=modulePath.getModuleGroup();
            if (groupPathString != null) {
              final String[] groupPath=groupPathString.split(MODULE_GROUP_SEPARATOR);
              myModuleModel.setModuleGroupPath(module,groupPath);
            }
            myFailedModulePaths.remove(modulePath);
          }
 catch (          final IOException e) {
            errors.add(new ModuleLoadingErrorDescription(ProjectBundle.message("module.cannot.load.error",modulePath.getPath(),e.getMessage()),modulePath));
          }
catch (          JDOMException e) {
            errors.add(new ModuleLoadingErrorDescription(ProjectBundle.message("module.corrupted.file.error",modulePath.getPath(),e.getMessage()),modulePath));
          }
catch (          InvalidDataException e) {
            errors.add(new ModuleLoadingErrorDescription(ProjectBundle.message("module.corrupted.data.error",modulePath.getPath()),modulePath));
          }
catch (          final ModuleWithNameAlreadyExists moduleWithNameAlreadyExists) {
            errors.add(new ModuleLoadingErrorDescription(moduleWithNameAlreadyExists.getMessage(),modulePath));
          }
catch (          StateStorage.StateStorageException e) {
            errors.add(new ModuleLoadingErrorDescription(ProjectBundle.message("module.cannot.load.error",modulePath.getPath(),e.getMessage()),modulePath));
          }
        }
        fireErrors(errors);
        if (!app.isHeadlessEnvironment() && !modulesWithUnknownTypes.isEmpty()) {
          String message;
          if (modulesWithUnknownTypes.size() == 1) {
            message=ProjectBundle.message("module.unknown.type.single.error",modulesWithUnknownTypes.get(0).getName());
          }
 else {
            StringBuilder modulesBuilder=new StringBuilder();
            for (            final Module module : modulesWithUnknownTypes) {
              modulesBuilder.append("\n\"");
              modulesBuilder.append(module.getName());
              modulesBuilder.append("\"");
            }
            message=ProjectBundle.message("module.unknown.type.multiple.error",modulesBuilder.toString());
          }
          Messages.showWarningDialog(myProject,message,ProjectBundle.message("module.unknown.type.title"));
        }
      }
    }
;
    if (app.isDispatchThread() || app.isHeadlessEnvironment()) {
      swingRunnable.run();
    }
 else {
      app.invokeAndWait(swingRunnable,ModalityState.defaultModalityState());
    }
  }
}
