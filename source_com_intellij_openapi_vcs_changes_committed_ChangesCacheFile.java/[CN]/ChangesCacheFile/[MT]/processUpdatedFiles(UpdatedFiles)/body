{
  boolean haveUnaccountedUpdatedFiles=false;
  openStreams();
  try {
    final List<IncomingChangeListData> incomingData=loadIncomingChangeListData();
    for (    FileGroup group : updatedFiles.getTopLevelGroups()) {
      haveUnaccountedUpdatedFiles|=processGroup(group,incomingData);
    }
    if (!haveUnaccountedUpdatedFiles) {
      for (      IncomingChangeListData data : incomingData) {
        writePartial(data);
        if (data.accountedChanges.size() == data.changeList.getChanges().size()) {
          myIndexStream.seek(data.indexOffset);
          writeIndexEntry(data.indexEntry.number,data.indexEntry.date,data.indexEntry.offset,true);
          myIncomingCount--;
        }
      }
      writeHeader();
    }
  }
  finally {
    closeStreams();
  }
  return haveUnaccountedUpdatedFiles;
}
