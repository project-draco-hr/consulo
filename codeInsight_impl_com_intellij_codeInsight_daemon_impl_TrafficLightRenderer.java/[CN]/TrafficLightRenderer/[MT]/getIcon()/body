{
  DaemonCodeAnalyzerStatus status=getDaemonCodeAnalyzerStatus();
  if (status == null) {
    return NO_ICON;
  }
  if (status.noHighlightingRoots != null && status.noHighlightingRoots.length == status.rootsNumber) {
    return NO_ANALYSIS_ICON;
  }
  Icon inProgressMask=null;
  boolean atLeastOnePassFinished=status.errorAnalyzingFinished;
  for (  DaemonCodeAnalyzerStatus.PassStatus passStatus : status.passStati) {
    atLeastOnePassFinished|=passStatus.finished;
    if (!passStatus.finished) {
      Icon progressIcon=passStatus.inProgressIcon;
      if (progressIcon != null) {
        inProgressMask=inProgressMask == null ? progressIcon : LayeredIcon.create(inProgressMask,progressIcon);
      }
    }
  }
  Icon icon=status.errorAnalyzingFinished ? HighlightDisplayLevel.DO_NOT_SHOW.getIcon() : IN_PROGRESS_ICON;
  if (atLeastOnePassFinished) {
    for (int i=status.errorCount.length - 1; i >= 0; i--) {
      if (status.errorCount[i] != 0) {
        icon=SeverityRegistrar.getInstance(myProject).getRendererIconByIndex(i);
        break;
      }
    }
  }
  if (inProgressMask != null) {
    icon=LayeredIcon.create(icon,inProgressMask);
  }
  return icon;
}
