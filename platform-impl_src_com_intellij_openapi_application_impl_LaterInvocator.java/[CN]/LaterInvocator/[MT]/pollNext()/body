{
synchronized (LOCK) {
    if (!ourForcedFlushQueue.isEmpty()) {
      final RunnableInfo toRun=ourForcedFlushQueue.get(0);
      ourForcedFlushQueue.remove(0);
      if (!toRun.expired.value(null)) {
        return toRun;
      }
 else {
        toRun.callback.setDone();
      }
    }
    ModalityStateEx currentModality=(ModalityStateEx)(ourModalEntities.isEmpty() ? ApplicationManager.getApplication().getNoneModalityState() : new ModalityStateEx(ourModalEntities.toArray()));
    while (ourQueueSkipCount < ourQueue.size()) {
      RunnableInfo info=ourQueue.get(ourQueueSkipCount);
      if (info.expired.value(null)) {
        ourQueue.remove(ourQueueSkipCount);
        info.callback.setDone();
        continue;
      }
      if (!currentModality.dominates(info.modalityState)) {
        ourQueue.remove(ourQueueSkipCount);
        return info;
      }
      ourQueueSkipCount++;
    }
    return null;
  }
}
