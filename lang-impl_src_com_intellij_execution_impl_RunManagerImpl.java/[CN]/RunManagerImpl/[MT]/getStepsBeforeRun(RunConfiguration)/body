{
  Map<String,Boolean> stepsBeforeRun=myStepsBeforeRun.get(getUniqueName(settings));
  if (stepsBeforeRun == null) {
    final RunnerAndConfigurationSettingsImpl template=getConfigurationTemplate(settings.getFactory());
    stepsBeforeRun=myStepsBeforeRun.get(getUniqueName(template.getConfiguration()));
  }
  if (stepsBeforeRun == null) {
    stepsBeforeRun=new HashMap<String,Boolean>();
    for (    StepsBeforeRunProvider provider : Extensions.getExtensions(StepsBeforeRunProvider.EXTENSION_POINT_NAME,myProject)) {
      if (provider.isEnabledByDefault()) {
        stepsBeforeRun.put(provider.getStepName(),Boolean.TRUE);
      }
    }
  }
  return new HashMap<String,Boolean>(stepsBeforeRun);
}
