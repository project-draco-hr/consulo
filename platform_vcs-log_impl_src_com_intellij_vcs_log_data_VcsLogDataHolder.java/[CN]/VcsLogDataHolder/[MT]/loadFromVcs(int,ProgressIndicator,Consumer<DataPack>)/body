{
  StopWatch methodSW=StopWatch.start("loadFromVcs");
  Map<VirtualFile,List<? extends TimedVcsCommit>> logsToBuild=ContainerUtil.newHashMap();
  Map<VirtualFile,Collection<VcsRef>> refsByRoot=ContainerUtil.newHashMap();
  for (  Map.Entry<VirtualFile,RecentCommitsInfo> entry : collectInfoFromVcs(true,commitCount)) {
    VirtualFile root=entry.getKey();
    RecentCommitsInfo info=entry.getValue();
    logsToBuild.put(root,info.firstBlockCommits);
    refsByRoot.put(root,info.newRefs);
  }
  StopWatch sw=StopWatch.start("multi-repo join");
  List<? extends TimedVcsCommit> compoundLog=myMultiRepoJoiner.join(logsToBuild.values());
  sw.report();
  sw=StopWatch.start("DataPack.build");
  DataPack dataPack=DataPack.build(convertToGraphCommits(compoundLog),collectAllRefs(refsByRoot),indicator,myIndexGetter,myHashGetter,myLogProviders);
  sw.report();
  if (myLogData != null && myLogData.isFullLogReady()) {
    myLogData=new LogData(myLogData.getLogs(),myLogData.getRefs(),compoundLog,dataPack,true);
  }
 else {
    myLogData=new LogData(logsToBuild,refsByRoot,compoundLog,dataPack,false);
  }
  myContainingBranchesGetter.clearCache();
  handleOnSuccessInEdt(onSuccess,dataPack);
  methodSW.report();
}
