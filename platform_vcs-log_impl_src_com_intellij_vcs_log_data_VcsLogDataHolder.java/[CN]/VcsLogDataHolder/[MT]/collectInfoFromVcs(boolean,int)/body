{
  Map<VirtualFile,RecentCommitsInfo> infoByRoot=ContainerUtil.newHashMap();
  for (  Map.Entry<VirtualFile,VcsLogProvider> entry : myLogProviders.entrySet()) {
    VirtualFile root=entry.getKey();
    VcsLogProvider logProvider=entry.getValue();
    List<? extends VcsFullCommitDetails> firstBlockDetails=logProvider.readFirstBlock(root,ordered,commitsCount);
    Collection<VcsRef> newRefs=logProvider.readAllRefs(root);
    storeTopCommitsDetailsInCache(firstBlockDetails);
    storeUsers(firstBlockDetails);
    List<TimedVcsCommit> firstBlockCommits=getCommitsFromDetails(firstBlockDetails);
    infoByRoot.put(root,new RecentCommitsInfo(firstBlockCommits,newRefs));
  }
  return infoByRoot.entrySet();
}
