{
  runInBackground(new ThrowableConsumer<ProgressIndicator,VcsException>(){
    @Override public void consume(    ProgressIndicator indicator) throws VcsException {
      StopWatch methodLog=StopWatch.start("loadAllLog");
      try {
        Consumer<VcsUser> userRegistry=new Consumer<VcsUser>(){
          @Override public void consume(          VcsUser user){
            myUserRegistry.addUser(user);
          }
        }
;
        Map<VirtualFile,List<? extends TimedVcsCommit>> logs=ContainerUtil.newHashMap();
        Map<VirtualFile,Collection<VcsRef>> refs=ContainerUtil.newHashMap();
        for (        Map.Entry<VirtualFile,VcsLogProvider> entry : myLogProviders.entrySet()) {
          VirtualFile root=entry.getKey();
          VcsLogProvider logProvider=entry.getValue();
          StopWatch sw=StopWatch.start("readAllHashes for " + root.getName());
          List<TimedVcsCommit> allCommits=logProvider.readAllHashes(root,userRegistry);
          sw.report();
          logs.put(root,compactHashes(allCommits));
          refs.put(root,logProvider.readAllRefs(root));
        }
        DataPack existingDataPack=myLogData.getDataPack();
        myLogData=new LogData(logs,refs,myLogData.getTopCommits(),existingDataPack,true);
        methodLog.report();
      }
  finally {
        myEntireLogLoadWaiter.countDown();
      }
    }
  }
,"Loading log structure...");
}
