{
  ApplicationManager.getApplication().assertIsDispatchThread();
synchronized (LOCK) {
    if (myOutputPaused)     return;
    if (myDeferredOutput.length() == 0)     return;
  }
  if (myEditor != null) {
    final String text=myDeferredOutput.substring(0,myDeferredOutput.length());
    myDeferredOutput.setLength(0);
    final Document document=myEditor.getDocument();
    final int oldLineCount=document.getLineCount();
    final boolean isAtEndOfDocument=myEditor.getCaretModel().getOffset() == myEditor.getDocument().getTextLength();
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      public void run(){
        CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
          public void run(){
            document.insertString(document.getTextLength(),text);
          }
        }
,null,null);
      }
    }
);
    final int newLineCount=document.getLineCount();
    if (oldLineCount < newLineCount) {
      myPsiDisposedCheck.performCheck();
      highlightHyperlinks(oldLineCount - 1,newLineCount - 2);
    }
    if (isAtEndOfDocument) {
      myEditor.getCaretModel().moveToOffset(myEditor.getDocument().getTextLength());
      myEditor.getSelectionModel().removeSelection();
      myEditor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
    }
  }
}
