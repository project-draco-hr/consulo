{
  if (myMessageFilter != null) {
    LOG.assertTrue(ApplicationManager.getApplication().isDispatchThread());
    PsiDocumentManager.getInstance(myProject).commitAllDocuments();
    final Document document=myEditor.getDocument();
    final CharSequence chars=document.getCharsSequence();
    for (int line=line1; line <= line2; line++) {
      if (line < 0)       continue;
      final int startOffset=document.getLineStartOffset(line);
      int endOffset=document.getLineEndOffset(line);
      if (endOffset < document.getTextLength()) {
        endOffset++;
      }
      final String text=chars.subSequence(startOffset,endOffset).toString();
      final Filter.Result result=myMessageFilter.applyFilter(text,endOffset);
      if (result != null) {
        final int highlightStartOffset=result.highlightStartOffset;
        final int highlightEndOffset=result.highlightEndOffset;
        final HyperlinkInfo hyperlinkInfo=result.hyperlinkInfo;
        addHyperlink(highlightStartOffset,highlightEndOffset,hyperlinkInfo);
      }
    }
  }
}
