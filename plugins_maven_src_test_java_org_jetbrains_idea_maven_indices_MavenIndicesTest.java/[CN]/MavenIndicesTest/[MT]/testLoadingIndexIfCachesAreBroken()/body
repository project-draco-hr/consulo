{
  MavenIndex i1=myIndices.add("id",myRepositoryHelper.getTestDataPath("local1"),MavenIndex.Kind.LOCAL);
  MavenIndex i2=myIndices.add("id",myRepositoryHelper.getTestDataPath("local2"),MavenIndex.Kind.LOCAL);
  myIndices.updateOrRepair(i1,true,getMavenGeneralSettings(),EMPTY_MAVEN_PROCESS);
  myIndices.updateOrRepair(i2,true,getMavenGeneralSettings(),EMPTY_MAVEN_PROCESS);
  assertUnorderedElementsAreEqual(i1.getGroupIds(),"junit");
  assertUnorderedElementsAreEqual(i2.getGroupIds(),"jmock");
  shutdownIndices();
  damageFile(i1,"artifactIds-map.dat",true);
  initIndices();
  assertEquals(2,myIndices.getIndices().size());
  assertTrue(myIndices.getIndices().get(0).getGroupIds().isEmpty());
  assertUnorderedElementsAreEqual(myIndices.getIndices().get(1).getGroupIds(),"jmock");
  myIndices.updateOrRepair(myIndices.getIndices().get(0),false,getMavenGeneralSettings(),EMPTY_MAVEN_PROCESS);
  assertUnorderedElementsAreEqual(myIndices.getIndices().get(0).getGroupIds(),"junit");
}
