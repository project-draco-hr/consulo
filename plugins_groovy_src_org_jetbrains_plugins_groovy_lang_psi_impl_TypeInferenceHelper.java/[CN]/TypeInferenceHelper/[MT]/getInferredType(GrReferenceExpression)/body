{
  if (isInferenceInProgress()) {
    return getTypeBinding(refExpr);
  }
  GrControlFlowOwner scope=PsiTreeUtil.getParentOfType(refExpr,GrControlFlowOwner.class);
  if (scope != null) {
    Map<GrReferenceExpression,PsiType> map=myCalculatedTypeInferences.get(scope);
    if (map == null) {
      map=inferTypes(scope);
      myCalculatedTypeInferences.put(scope,map);
    }
    return map.get(refExpr);
  }
  return null;
}
