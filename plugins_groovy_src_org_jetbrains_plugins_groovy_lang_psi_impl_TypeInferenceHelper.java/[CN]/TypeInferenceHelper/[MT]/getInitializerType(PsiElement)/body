{
  if (element instanceof GrReferenceExpression && ((GrReferenceExpression)element).getQualifierExpression() == null) {
    final PsiElement parent=element.getParent();
    if (parent instanceof GrAssignmentExpression) {
      return ((GrAssignmentExpression)parent).getType();
    }
    if (parent instanceof GrTupleExpression) {
      GrTupleExpression list=(GrTupleExpression)parent;
      if (list.getParent() instanceof GrAssignmentExpression) {
        final GrExpression rValue=((GrAssignmentExpression)list.getParent()).getRValue();
        int idx=list.indexOf(element);
        if (idx >= 0 && rValue != null) {
          PsiType rType=rValue.getType();
          if (rType instanceof GrTupleType) {
            PsiType[] componentTypes=((GrTupleType)rType).getComponentTypes();
            if (idx < componentTypes.length)             return componentTypes[idx];
            return null;
          }
          return PsiUtil.extractIterableTypeParameter(rType,false);
        }
      }
    }
    if (parent instanceof GrUnaryExpression && TokenSets.POSTFIX_UNARY_OP_SET.contains(((GrUnaryExpression)parent).getOperationTokenType())) {
      return ((GrUnaryExpression)parent).getType();
    }
    return null;
  }
  if (element instanceof GrVariable) {
    GrVariable variable=(GrVariable)element;
    if (!(variable instanceof GrParameter)) {
      final GrExpression initializer=variable.getInitializerGroovy();
      if (initializer != null) {
        return initializer.getType();
      }
    }
    return variable.getTypeGroovy();
  }
  return null;
}
