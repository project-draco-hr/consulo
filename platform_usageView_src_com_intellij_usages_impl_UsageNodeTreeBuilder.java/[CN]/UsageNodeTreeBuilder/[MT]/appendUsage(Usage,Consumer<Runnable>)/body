{
  if (!isVisible(usage))   return null;
  final boolean dumb=DumbService.isDumb(myProject);
  GroupNode lastGroupNode=myRoot;
  for (int i=0; i < myGroupingRules.length; i++) {
    final UsageGroupingRule rule=myGroupingRules[i];
    if (dumb && !DumbService.isDumbAware(rule))     continue;
    final UsageGroup group;
    if (rule instanceof UsageGroupingRuleEx) {
      group=((UsageGroupingRuleEx)rule).groupUsage(usage,myTargets);
    }
 else {
      group=rule.groupUsage(usage);
    }
    if (group != null) {
      lastGroupNode=lastGroupNode.addGroup(group,i,edtQueue);
    }
  }
  return lastGroupNode.addUsage(usage,edtQueue);
}
