{
  final Editor editor=context.getEditor();
  if (editor == null)   return null;
  PsiElement psiElement=TargetElementUtilBase.findTargetElement(editor,TargetElementUtilBase.ELEMENT_NAME_ACCEPTED);
  if (psiElement == null || !psiElement.isValid()) {
    return null;
  }
  final String actionName;
  if (psiElement instanceof XmlTag) {
    actionName=VcsBundle.message("action.name.show.history.for.tag");
  }
 else   if (psiElement instanceof XmlText) {
    actionName=VcsBundle.message("action.name.show.history.for.text");
  }
 else {
    return null;
  }
  TextRange textRange=psiElement.getTextRange();
  if (textRange == null) {
    return null;
  }
  VirtualFile virtualFile=psiElement.getContainingFile().getVirtualFile();
  if (virtualFile == null) {
    return null;
  }
  if (!virtualFile.isValid()) {
    return null;
  }
  Document document=FileDocumentManager.getInstance().getDocument(virtualFile);
  return new VcsSelection(document,textRange,actionName);
}
