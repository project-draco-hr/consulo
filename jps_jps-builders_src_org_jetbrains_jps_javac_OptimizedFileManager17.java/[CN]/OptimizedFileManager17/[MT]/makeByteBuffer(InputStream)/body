{
  int limit=in.available();
  if (limit < 1024) {
    limit=1024;
  }
  ByteBuffer result=myByteBufferCache.get(limit);
  int position=0;
  while (in.available() != 0) {
    if (position >= limit) {
      result=ByteBuffer.allocate(limit<<=1).put((ByteBuffer)result.flip());
    }
    final int count=in.read(result.array(),position,limit - position);
    if (count < 0) {
      break;
    }
    result.position(position+=count);
  }
  return (ByteBuffer)result.flip();
}
