{
  File d=subdirectory.getFile(directory);
  File[] files=d.listFiles();
  if (files == null) {
    return;
  }
  if (sortFiles != null) {
    Arrays.sort(files,sortFiles);
  }
  for (  File f : files) {
    String fileName=f.getName();
    if (f.isDirectory()) {
      if (recurse && SourceVersion.isIdentifier(fileName)) {
        listDirectory(directory,new RelativePath.RelativeDirectory(subdirectory,fileName),fileKinds,recurse,resultList);
      }
    }
 else {
      if (isValidFile(fileName,fileKinds)) {
        JavaFileObject fe=getRegularFile(f);
        resultList.append(fe);
      }
    }
  }
}
