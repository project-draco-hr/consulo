{
  final Project project=defaultTargetDirectory.getProject();
  final Boolean showDirsChooser=defaultTargetDirectory.getCopyableUserData(CopyPasteDelegator.SHOW_CHOOSER_KEY);
  if (showDirsChooser != null && showDirsChooser.booleanValue()) {
    final PsiDirectoryContainer directoryContainer=PsiDirectoryFactory.getInstance(project).getDirectoryContainer(defaultTargetDirectory);
    if (directoryContainer == null) {
      return defaultTargetDirectory;
    }
    return MoveFilesOrDirectoriesUtil.resolveToDirectory(project,directoryContainer);
  }
  return defaultTargetDirectory;
}
