{
  final int offset=editor.getCaretModel().getOffset();
  final PsiElement element=file.findElementAt(offset);
  final PsiMethod method=PsiTreeUtil.getParentOfType(element,PsiMethod.class);
  if (method == null) {
    String message=RefactoringBundle.getCannotRefactorMessage(RefactoringBundle.message("locate.caret.inside.a.method"));
    showErrorMessage(message,project);
    return;
  }
  if (method.isConstructor()) {
    String message=RefactoringBundle.getCannotRefactorMessage("Replace method with method object doesn't work on constructors");
    showErrorMessage(message,project);
  }
  final PsiCodeBlock body=method.getBody();
  if (body == null) {
    String message=RefactoringBundle.getCannotRefactorMessage(RefactoringBundle.message("method.does.not.have.a.body",method.getName()));
    showErrorMessage(message,project);
    return;
  }
  new ReplaceMethodWithMethodObjectDialog(method).show();
}
