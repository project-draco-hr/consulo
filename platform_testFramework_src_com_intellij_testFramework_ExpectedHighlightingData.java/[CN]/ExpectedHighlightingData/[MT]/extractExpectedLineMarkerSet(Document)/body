{
  String text=document.getText();
  @NonNls String pat=".*?((<" + LINE_MARKER + ")(?: descr=\"((?:[^\"\\\\]|\\\\\")*)\")?>)(.*)";
  final Pattern p=Pattern.compile(pat,Pattern.DOTALL);
  final Pattern pat2=Pattern.compile("(.*?)(</" + LINE_MARKER + ">)(.*)",Pattern.DOTALL);
  for (; ; ) {
    Matcher m=p.matcher(text);
    if (!m.matches())     break;
    int startOffset=m.start(1);
    final String descr=m.group(3) != null ? m.group(3) : ANY_TEXT;
    String rest=m.group(4);
    document.replaceString(startOffset,m.end(1),"");
    final Matcher matcher2=pat2.matcher(rest);
    LOG.assertTrue(matcher2.matches(),"Cannot find closing </" + LINE_MARKER + ">");
    String content=matcher2.group(1);
    int endOffset=startOffset + matcher2.start(3);
    String endTag=matcher2.group(2);
    document.replaceString(startOffset,endOffset,content);
    endOffset-=endTag.length();
    LineMarkerInfo markerInfo=new LineMarkerInfo<PsiElement>(myFile,new TextRange(startOffset,endOffset),null,Pass.LINE_MARKERS,new Function<PsiElement,String>(){
      public String fun(      PsiElement psiElement){
        return descr;
      }
    }
,null,GutterIconRenderer.Alignment.RIGHT);
    lineMarkerInfos.put(document.createRangeMarker(startOffset,endOffset),markerInfo);
    text=document.getText();
  }
}
