{
  final DocumentReference[] documents=myEditor == null ? null : myManager.getDocumentReferences(myEditor);
  if (documents == null || documents.length == 0) {
    return getStackHolder().getGlobalStack().getLast();
  }
 else {
    long recentDocumentTimeStamp=-1;
    UndoableGroup result=null;
    for (    DocumentReference docRef : documents) {
      UndoableGroup action=getStackHolder().getLastAction(docRef);
      if (action != null) {
        long modificationStamp;
        Document doc=docRef.getDocument();
        modificationStamp=doc != null ? doc.getModificationStamp() : docRef.getFile().getTimeStamp();
        if (recentDocumentTimeStamp < modificationStamp) {
          result=action;
          recentDocumentTimeStamp=modificationStamp;
        }
      }
    }
    if (result != null) {
      return result;
    }
 else {
      throw new NothingToUndoException();
    }
  }
}
