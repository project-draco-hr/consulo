{
  Set<DocumentReference> refs=myEditor == null ? Collections.EMPTY_SET : myManager.getDocumentReferences(myEditor);
  if (refs.isEmpty()) {
    return getStackHolder().getGlobalStack().getLast();
  }
  long recentDocumentTimeStamp=-1;
  UndoableGroup result=null;
  for (  DocumentReference docRef : refs) {
    UndoableGroup action=getStackHolder().getLastAction(docRef);
    if (action != null) {
      long modificationStamp;
      Document doc=docRef.getDocument();
      modificationStamp=doc != null ? doc.getModificationStamp() : docRef.getFile().getTimeStamp();
      if (recentDocumentTimeStamp < modificationStamp) {
        result=action;
        recentDocumentTimeStamp=modificationStamp;
      }
    }
  }
  if (result != null) {
    return result;
  }
 else {
    throw new NothingToUndoException();
  }
}
