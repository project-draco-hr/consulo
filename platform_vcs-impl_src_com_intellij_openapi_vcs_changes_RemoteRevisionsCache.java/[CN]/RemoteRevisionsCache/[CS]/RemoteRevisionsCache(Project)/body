{
  myProject=project;
  myLock=new Object();
  myRemoteRevisionsNumbersCache=new RemoteRevisionsNumbersCache(myProject);
  myRemoteRevisionsStateCache=new RemoteRevisionsStateCache(myProject);
  myChangeDecorator=new RemoteStatusChangeNodeDecorator(this);
  myVcsManager=ProjectLevelVcsManager.getInstance(project);
  MessageBusConnection connection=myProject.getMessageBus().connect();
  connection.subscribe(ProjectLevelVcsManager.VCS_CONFIGURATION_CHANGED,this);
  connection.subscribe(ProjectLevelVcsManager.VCS_CONFIGURATION_CHANGED_IN_PLUGIN,this);
  myKinds=new HashMap<String,RemoteDifferenceStrategy>();
  final VcsConfiguration vcsConfiguration=VcsConfiguration.getInstance(myProject);
  myControlledCycle=new ControlledCycle(project,new Getter<Boolean>(){
    @Override public Boolean get(){
      final boolean shouldBeDone=vcsConfiguration.isChangedOnServerEnabled() && myVcsManager.hasActiveVcss();
      if (shouldBeDone) {
        boolean somethingChanged=myRemoteRevisionsNumbersCache.updateStep();
        somethingChanged|=myRemoteRevisionsStateCache.updateStep();
        if (somethingChanged) {
          ApplicationManager.getApplication().runReadAction(new Runnable(){
            @Override public void run(){
              if (!myProject.isDisposed()) {
                myProject.getMessageBus().syncPublisher(REMOTE_VERSION_CHANGED).run();
              }
            }
          }
);
        }
      }
      return shouldBeDone;
    }
  }
,"Finishing \"changed on server\" update",DEFAULT_REFRESH_INTERVAL);
  updateRoots();
  if ((!myProject.isDefault()) && vcsConfiguration.isChangedOnServerEnabled()) {
    ((ProjectLevelVcsManagerImpl)myVcsManager).addInitializationRequest(VcsInitObject.REMOTE_REVISIONS_CACHE,new Runnable(){
      @Override public void run(){
        if (!myVcsManager.hasActiveVcss() || !vcsConfiguration.isChangedOnServerEnabled())         return;
        myControlledCycle.startIfNotStarted(-1);
      }
    }
);
  }
}
