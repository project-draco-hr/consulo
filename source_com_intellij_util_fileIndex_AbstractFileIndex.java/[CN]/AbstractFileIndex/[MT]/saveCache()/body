{
  final File cacheFile=getCacheLocation(getCachesDirName());
  FileUtil.createParentDirs(cacheFile);
  DataOutputStream output=null;
  try {
    cacheFile.createNewFile();
    output=new DataOutputStream(new BufferedOutputStream(new FileOutputStream(cacheFile)));
    output.writeByte(getCurrentVersion());
    writeHeader(output);
synchronized (myIndexLock) {
      output.writeInt(myFileUrl2IndexEntry.size());
      for (      final Map.Entry<String,IndexEntry> entry : myFileUrl2IndexEntry.entrySet()) {
        output.writeUTF(entry.getKey());
        entry.getValue().write(output);
      }
    }
    output.close();
  }
 catch (  IOException e) {
    LOG.debug(e);
    if (output != null) {
      try {
        output.close();
        output=null;
      }
 catch (      IOException e1) {
      }
    }
    cacheFile.delete();
  }
 finally {
    if (output != null) {
      try {
        output.close();
      }
 catch (      IOException e1) {
      }
    }
  }
}
