{
  PsiElement[] psiElements=(PsiElement[])dataProvider.getData(DataConstants.PSI_ELEMENT_ARRAY);
  if (psiElements != null) {
    for (    PsiElement elem : psiElements) {
      VirtualFile virtualFile=PsiUtil.getVirtualFile(elem);
      if (virtualFile != null)       return virtualFile;
    }
  }
  VirtualFile[] virtualFiles=(VirtualFile[])dataProvider.getData(DataConstants.VIRTUAL_FILE_ARRAY);
  if (virtualFiles != null && virtualFiles.length == 1) {
    return virtualFiles[0];
  }
  PsiFile psiFile=(PsiFile)dataProvider.getData(DataConstants.PSI_FILE);
  if (psiFile != null) {
    return psiFile.getVirtualFile();
  }
  PsiElement elem=(PsiElement)dataProvider.getData(DataConstants.PSI_ELEMENT);
  if (elem == null) {
    return null;
  }
  return PsiUtil.getVirtualFile(elem);
}
