{
  getLogger().assertTrue(newFilePaths.length == newFileDocuments.length);
  ArrayList writtenFilesPaths=new ArrayList();
  for (int i=0; i < newFilePaths.length; i++) {
    String newFilePath=newFilePaths[i];
    File file=new File(newFilePath);
    if (file.exists() && !file.canWrite()) {
      throw new IOException("File \"" + newFilePath + "\" is not writeable");
    }
  }
  for (int i=0; i < oldFiles.length; i++) {
    File file=oldFiles[i];
    if (file.exists() && !file.canWrite()) {
      throw new IOException("File \"" + file.getAbsolutePath() + "\" is not writeable");
    }
  }
  for (int i=0; i < newFilePaths.length; i++) {
    String newFilePath=newFilePaths[i];
    JDOMUtil.writeDocument(newFileDocuments[i],newFilePath,lineSeparator);
    writtenFilesPaths.add(newFilePath);
  }
  outer:   for (int i=0; i < oldFiles.length; i++) {
    File oldFile=oldFiles[i];
    String oldFilePath=oldFile.getAbsolutePath();
    for (Iterator iterator=writtenFilesPaths.iterator(); iterator.hasNext(); ) {
      if (oldFilePath.equals(iterator.next())) {
        continue outer;
      }
    }
    boolean result=oldFile.delete();
    if (!result) {
      throw new IOException("File \"" + oldFilePath + "\" was not deleted");
    }
  }
}
