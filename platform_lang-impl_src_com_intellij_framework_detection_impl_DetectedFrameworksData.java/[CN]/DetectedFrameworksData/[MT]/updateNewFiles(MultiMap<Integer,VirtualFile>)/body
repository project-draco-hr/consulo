{
  final Set<Integer> affectedDetectors=new HashSet<Integer>();
  for (  Integer detectorId : files.keySet()) {
    TIntHashSet oldSet=myNewFiles.get(detectorId);
    final Collection<VirtualFile> newFiles=files.get(detectorId);
    if (oldSet == null) {
      if (newFiles.isEmpty())       continue;
    }
    TIntHashSet newSet=new TIntHashSet();
    for (    VirtualFile file : newFiles) {
      newSet.add(FileBasedIndex.getFileId(file));
    }
    if (newSet.equals(oldSet))     continue;
    myNewFiles.put(detectorId,newSet);
    affectedDetectors.add(detectorId);
  }
  return affectedDetectors;
}
