{
  TIntHashSet oldSet=myNewFiles.get(detectorId);
  if (oldSet == null) {
    oldSet=new TIntHashSet();
    myNewFiles.put(detectorId,oldSet);
  }
  TIntHashSet existentFilesSet=null;
  try {
    existentFilesSet=myExistentFrameworkFiles.get(detectorId);
  }
 catch (  IOException e) {
    LOG.info(e);
  }
  final ArrayList<VirtualFile> newFiles=new ArrayList<VirtualFile>();
  TIntHashSet newSet=new TIntHashSet();
  for (  VirtualFile file : files) {
    final int fileId=FileBasedIndex.getFileId(file);
    if (existentFilesSet == null || !existentFilesSet.contains(fileId)) {
      newFiles.add(file);
      newSet.add(fileId);
    }
  }
  if (newSet.equals(oldSet)) {
    return Collections.emptyList();
  }
  myNewFiles.put(detectorId,newSet);
  return newFiles;
}
