{
  myProject=project;
  myIsHorizontal=horizontal;
  myOptions=new DiffPanelOptions(this);
  myPanel=new DiffPanelOuterComponent(TextDiffType.DIFF_TYPES,TOOL_BAR);
  myPanel.disableToolbar(!enableToolbar);
  if (enableToolbar)   myPanel.resetToolbar();
  myOwnerWindow=owner;
  myIsSyncScroll=true;
  myLeftSide=new DiffSideView("",this);
  myRightSide=new DiffSideView("",this);
  myLeftSide.becomeMaster();
  myDiffUpdater=new Rediffers(this);
  myData=createDiffPanelState(this);
  if (horizontal) {
    mySplitter=new DiffSplitter(myLeftSide.getComponent(),myRightSide.getComponent(),new DiffDividerPaint(this,FragmentSide.SIDE1),myData);
  }
 else {
    mySplitter=new HorizontalDiffSplitter(myLeftSide.getComponent(),myRightSide.getComponent());
  }
  myPanel.insertDiffComponent(mySplitter.getComponent(),new MyScrollingPanel());
  myDataProvider=new MyGenericDataProvider(this);
  myPanel.setDataProvider(myDataProvider);
  final ComparisonPolicy comparisonPolicy=getComparisonPolicy();
  final ComparisonPolicy defaultComparisonPolicy=DiffManagerImpl.getInstanceEx().getComparisonPolicy();
  if (defaultComparisonPolicy != null && comparisonPolicy != defaultComparisonPolicy) {
    setComparisonPolicy(defaultComparisonPolicy);
  }
  myVisibleAreaListener=new VisibleAreaListener(){
    @Override public void visibleAreaChanged(    VisibleAreaEvent e){
      Editor editor1=getEditor1();
      if (editor1 != null) {
        editor1.getComponent().repaint();
      }
      Editor editor2=getEditor2();
      if (editor2 != null) {
        editor2.getComponent().repaint();
      }
    }
  }
;
  new EditSourceAction().registerCustomShortcutSet(CommonShortcuts.getEditSource(),myPanel,this);
}
