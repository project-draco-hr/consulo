{
  if (!(psiClass instanceof GrTypeDefinition))   return null;
  PsiClass enclosing=PsiTreeUtil.getParentOfType(psiClass,PsiClass.class,true);
  while (enclosing != null) {
    psiClass=enclosing;
    enclosing=PsiTreeUtil.getParentOfType(enclosing,PsiClass.class,true);
  }
  if (psiClass instanceof PsiAnonymousClass) {
    final PsiFile file=psiClass.getContainingFile();
    if (file instanceof GroovyFile) {
      return ((GroovyFile)file).getScriptClass();
    }
  }
  return psiClass;
}
