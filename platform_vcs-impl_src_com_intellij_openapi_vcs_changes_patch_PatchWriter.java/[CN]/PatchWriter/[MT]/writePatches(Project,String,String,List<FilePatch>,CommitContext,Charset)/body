{
  Writer writer=new OutputStreamWriter(new FileOutputStream(fileName),charset);
  try {
    final String lineSeparator=CodeStyleFacade.getInstance(project).getLineSeparator();
    UnifiedDiffWriter.write(project,basePath,patches,writer,lineSeparator,Extensions.getExtensions(PatchEP.EP_NAME,project),commitContext);
  }
  finally {
    writer.close();
  }
}
