{
  final PropertiesReferenceManager manager=PropertiesReferenceManager.getInstance(module.getProject());
  final PropertiesFile propFile=manager.findPropertiesFile(module,descriptor.getDottedBundleName(),locale);
  if (propFile != null) {
    final Property propertyByKey=propFile.findPropertyByKey(descriptor.getKey());
    if (propertyByKey != null && !editedValue.equals(propertyByKey.getValue())) {
      final Collection<PsiReference> references=findPropertyReferences(propertyByKey,module);
      String newKeyName=null;
      if (references.size() > 1) {
        final int rc=Messages.showDialog(module.getProject(),UIDesignerBundle.message("edit.text.multiple.usages",propertyByKey.getUnescapedKey(),references.size()),UIDesignerBundle.message("edit.text.multiple.usages.title"),new String[]{UIDesignerBundle.message("edit.text.change.all"),UIDesignerBundle.message("edit.text.make.unique"),CommonBundle.getCancelButtonText()},0,Messages.getWarningIcon());
        if (rc == 2) {
          return null;
        }
        if (rc == 1) {
          newKeyName=promptNewKeyName(module.getProject(),propFile,descriptor.getKey());
          if (newKeyName == null)           return null;
        }
      }
      final ReadonlyStatusHandler.OperationStatus operationStatus=ReadonlyStatusHandler.getInstance(module.getProject()).ensureFilesWritable(propFile.getVirtualFile());
      if (operationStatus.hasReadonlyFiles()) {
        return null;
      }
      final String newKeyName1=newKeyName;
      CommandProcessor.getInstance().executeCommand(module.getProject(),new Runnable(){
        public void run(){
          UndoManager.getInstance(module.getProject()).markDocumentForUndo(formFile);
          ApplicationManager.getApplication().runWriteAction(new Runnable(){
            public void run(){
              PsiDocumentManager.getInstance(module.getProject()).commitAllDocuments();
              try {
                if (newKeyName1 != null) {
                  propFile.addProperty(PropertiesElementFactory.createProperty(module.getProject(),newKeyName1,editedValue));
                }
 else {
                  final Property propertyByKey=propFile.findPropertyByKey(descriptor.getKey());
                  if (propertyByKey != null) {
                    propertyByKey.setValue(editedValue);
                  }
                }
              }
 catch (              IncorrectOperationException e) {
                LOG.error(e);
              }
            }
          }
);
        }
      }
,UIDesignerBundle.message("command.update.property"),null);
      return newKeyName;
    }
  }
  return null;
}
