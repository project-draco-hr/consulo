{
  DataContext caretContext=context == null ? null : new CaretSpecificDataContext(context,hostCaret);
  if (myWorksInInjected && caretContext != null) {
    DataContext injectedCaretContext=AnActionEvent.getInjectedDataContext(caretContext);
    Caret injectedCaret=CommonDataKeys.CARET.getData(injectedCaretContext);
    if (injectedCaret != null && injectedCaret != hostCaret && isEnabledForCaret(injectedCaret.getEditor(),injectedCaret,injectedCaretContext)) {
      task.perform(injectedCaret,injectedCaretContext);
      return;
    }
  }
  if (isEnabledForCaret(hostCaret.getEditor(),hostCaret,caretContext)) {
    task.perform(hostCaret,caretContext);
  }
}
