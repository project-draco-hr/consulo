{
  if (inCheck) {
    return true;
  }
  inCheck=true;
  try {
    if (editor == null) {
      return false;
    }
    Editor hostEditor=dataContext == null ? null : CommonDataKeys.HOST_EDITOR.getData(dataContext);
    if (hostEditor == null) {
      hostEditor=editor;
    }
    final boolean[] result=new boolean[1];
    final CaretTask check=new CaretTask(){
      @Override public void perform(      @NotNull Caret caret,      @Nullable DataContext dataContext){
        result[0]=true;
      }
    }
;
    if (myRunForEachCaret) {
      hostEditor.getCaretModel().runForEachCaret(new CaretAction(){
        @Override public void perform(        Caret caret){
          doIfEnabled(caret,dataContext,check);
        }
      }
);
    }
 else {
      doIfEnabled(hostEditor.getCaretModel().getCurrentCaret(),dataContext,check);
    }
    return result[0];
  }
  finally {
    inCheck=false;
  }
}
