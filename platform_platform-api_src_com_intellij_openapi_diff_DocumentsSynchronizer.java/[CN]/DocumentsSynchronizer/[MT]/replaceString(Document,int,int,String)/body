{
  LOG.assertTrue(!myDuringModification);
  try {
    myDuringModification=true;
    CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
      @Override public void run(){
        LOG.assertTrue(endOffset <= document.getTextLength());
        ApplicationManager.getApplication().runWriteAction(new Runnable(){
          @Override public void run(){
            document.replaceString(startOffset,endOffset,newText);
          }
        }
);
      }
    }
,DiffBundle.message("save.merge.result.command.name"),document);
  }
  finally {
    myDuringModification=false;
  }
}
