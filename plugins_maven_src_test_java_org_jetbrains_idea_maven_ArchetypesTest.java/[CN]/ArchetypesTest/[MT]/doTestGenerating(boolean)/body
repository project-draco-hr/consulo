{
  File dir=new File(myDir.getPath(),"generated");
  dir.mkdirs();
  MavenRunnerParameters params=new MavenRunnerParameters(false,dir.getPath(),Arrays.asList("archetype:create"),Collections.<String>emptyList());
  MavenRunnerSettings settings=new MavenRunnerSettings();
  Map<String,String> props=new HashMap<String,String>();
  props.put("archetypeGroupId","org.apache.maven.archetypes");
  props.put("archetypeArtifactId","maven-archetype-quickstart");
  props.put("archetypeVersion","1.0");
  props.put("groupId","foo");
  props.put("artifactId","bar");
  settings.setMavenProperties(props);
  MavenExecutor exec;
  if (useEmbedder) {
    exec=new MavenEmbeddedExecutor(params,getMavenGeneralSettings(),settings,NULL_MAVEN_CONSOLE);
  }
 else {
    settings.setJreName(MavenRunnerSettings.USE_INTERNAL_JAVA);
    exec=new MavenExternalExecutor(params,getMavenGeneralSettings(),settings,NULL_MAVEN_CONSOLE);
  }
  exec.execute(new EmptyProgressIndicator());
  assertTrue(new File(dir,"bar/pom.xml").exists());
}
