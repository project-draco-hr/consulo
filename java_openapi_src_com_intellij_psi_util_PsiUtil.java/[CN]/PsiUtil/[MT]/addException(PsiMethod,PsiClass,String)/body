{
  PsiReferenceList throwsList=method.getThrowsList();
  PsiJavaCodeReferenceElement[] refs=throwsList.getReferenceElements();
  for (  PsiJavaCodeReferenceElement ref : refs) {
    if (ref.isReferenceTo(exceptionClass))     return;
    PsiClass aClass=(PsiClass)ref.resolve();
    if (exceptionClass != null && aClass != null) {
      if (aClass.isInheritor(exceptionClass,true)) {
        PsiElementFactory factory=JavaPsiFacade.getInstance(method.getProject()).getElementFactory();
        PsiJavaCodeReferenceElement ref1;
        if (exceptionName != null) {
          ref1=factory.createReferenceElementByFQClassName(exceptionName,method.getResolveScope());
        }
 else {
          PsiClassType type=factory.createType(exceptionClass);
          ref1=factory.createReferenceElementByType(type);
        }
        ref.replace(ref1);
        return;
      }
 else       if (exceptionClass.isInheritor(aClass,true)) {
        return;
      }
    }
  }
  PsiElementFactory factory=JavaPsiFacade.getInstance(method.getProject()).getElementFactory();
  PsiJavaCodeReferenceElement ref;
  if (exceptionName != null) {
    ref=factory.createReferenceElementByFQClassName(exceptionName,method.getResolveScope());
  }
 else {
    PsiClassType type=factory.createType(exceptionClass);
    ref=factory.createReferenceElementByType(type);
  }
  throwsList.add(ref);
}
