{
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    return;
  }
  final Project project=getProject();
  DebuggerInvocationUtil.swingInvokeLater(project,new Runnable(){
    @Override public void run(){
      if (!isValid()) {
        return;
      }
      DebuggerContextImpl context=DebuggerManagerEx.getInstanceEx(project).getContext();
      final DebugProcessImpl debugProcess=context.getDebugProcess();
      if (debugProcess == null || !debugProcess.isAttached()) {
        updateCaches(null);
        updateGutter();
        afterUpdate.run();
      }
 else {
        debugProcess.getManagerThread().invoke(new DebuggerCommandImpl(){
          @Override protected void action() throws Exception {
            ApplicationManager.getApplication().runReadAction(new Runnable(){
              @Override public void run(){
                updateCaches(debugProcess);
              }
            }
);
            DebuggerInvocationUtil.swingInvokeLater(project,new Runnable(){
              @Override public void run(){
                updateGutter();
                afterUpdate.run();
              }
            }
);
          }
        }
);
      }
    }
  }
);
}
