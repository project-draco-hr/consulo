{
  final PsiManager psiManager=PsiManager.getInstance(getProject());
  psiManager.startBatchFilesProcessingMode();
  final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(getProject()).getFileIndex();
  try {
    getScope().accept(new PsiRecursiveElementVisitor(){
      @Override public void visitFile(      final PsiFile file){
        visit(file,fileIndex,psiManager,0);
      }
    }
);
  }
  finally {
    psiManager.finishBatchFilesProcessingMode();
  }
}
