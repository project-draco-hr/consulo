{
  connectIfNeeded(new ConnectionCallbackBase<D>(){
    @Override public void connected(    @NotNull ServerRuntimeInstance<D> instance){
      DeploymentSource source=task.getSource();
      String deploymentName=instance.getDeploymentName(source);
      DeploymentImpl deployment;
synchronized (myLocalDeployments) {
        deployment=new DeploymentImpl(deploymentName,DeploymentStatus.DEPLOYING,null,null,task);
        myLocalDeployments.put(deploymentName,deployment);
      }
      DeploymentLogManagerImpl logManager=new DeploymentLogManagerImpl(task.getProject(),new Runnable(){
        @Override public void run(){
          myEventDispatcher.queueDeploymentsChanged(ServerConnectionImpl.this);
        }
      }
);
      LoggingHandlerImpl handler=logManager.getMainLoggingHandler();
      myLogManagers.put(deploymentName,logManager);
      handler.printlnSystemMessage("Deploying '" + deploymentName + "'...");
      onDeploymentStarted.run(deploymentName);
      instance.deploy(task,logManager,new DeploymentOperationCallbackImpl(deploymentName,(DeploymentTaskImpl<D>)task,handler,deployment));
    }
  }
);
}
