{
  final VirtualFile vcsRoot=(isRoot) ? file : ProjectLevelVcsManager.getInstance(project).getVcsRootFor(file);
  if (vcsRoot == null) {
    return;
  }
  final VirtualFile directory=SvnUtil.correctRoot(project,file);
  if (directory == null) {
    return;
  }
  Pair<String,RootUrlInfo> rootUrlInfoPair=SvnVcs.getInstance(project).getSvnFileUrlMapping().getWcRootForFilePath(new File(directory.getPath()));
  if (rootUrlInfoPair == null) {
    return;
  }
  final String rootUrl=rootUrlInfoPair.getSecond().getRepositoryUrl();
  if (rootUrl == null) {
    Messages.showErrorDialog(project,SvnBundle.message("configure.branches.error.no.connection.title"),SvnBundle.message("configure.branches.title"));
    return;
  }
  SvnBranchConfiguration configuration;
  try {
    configuration=SvnBranchConfigurationManager.getInstance(project).get(vcsRoot);
  }
 catch (  VcsException ex) {
    Messages.showErrorDialog(project,"Error loading branch configuration: " + ex.getMessage(),SvnBundle.message("configure.branches.title"));
    return;
  }
  final SvnBranchConfiguration clonedConfiguration=configuration.copy();
  BranchConfigurationDialog dlg=new BranchConfigurationDialog(project,clonedConfiguration,rootUrl);
  dlg.show();
  if (dlg.isOK()) {
    SvnBranchConfigurationManager.getInstance(project).setConfiguration(vcsRoot,clonedConfiguration,true);
  }
}
