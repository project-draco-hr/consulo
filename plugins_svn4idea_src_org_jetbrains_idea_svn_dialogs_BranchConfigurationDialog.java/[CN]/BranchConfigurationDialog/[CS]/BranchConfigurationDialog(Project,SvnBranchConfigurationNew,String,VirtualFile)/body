{
  super(project,true);
  myRoot=root;
  init();
  setTitle(SvnBundle.message("configure.branches.title"));
  if (configuration.getTrunkUrl() == null) {
    configuration.setTrunkUrl(rootUrl);
  }
  mySvnBranchConfigManager=SvnBranchConfigurationManager.getInstance(project).getSvnBranchConfigManager();
  myTrunkLocationTextField.setText(configuration.getTrunkUrl());
  myTrunkLocationTextField.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      final String selectedUrl=SelectLocationDialog.selectLocation(project,myTrunkLocationTextField.getText());
      if (selectedUrl != null) {
        myTrunkLocationTextField.setText(selectedUrl);
      }
    }
  }
);
  final TrunkUrlValidator trunkUrlValidator=new TrunkUrlValidator(rootUrl,configuration);
  myTrunkLocationTextField.getTextField().getDocument().addDocumentListener(trunkUrlValidator);
  trunkUrlValidator.textChanged(null);
  final MyListModel listModel=new MyListModel(configuration);
  myLocationList.setModel(listModel);
  myAddButton.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      final String selectedUrl=SelectLocationDialog.selectLocation(project,rootUrl);
      if (selectedUrl != null) {
        if (!configuration.getBranchUrls().contains(selectedUrl)) {
          configuration.addBranches(selectedUrl,new InfoStorage<List<SvnBranchItem>>(new ArrayList<SvnBranchItem>(),InfoReliability.empty));
          mySvnBranchConfigManager.reloadBranches(myRoot,selectedUrl,null);
          listModel.fireItemAdded();
          myLocationList.setSelectedIndex(listModel.getSize() - 1);
        }
      }
    }
  }
);
  myRemoveButton.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      int selIndex=myLocationList.getSelectedIndex();
      Object[] selection=myLocationList.getSelectedValues();
      for (      Object urlObj : selection) {
        String url=(String)urlObj;
        int index=configuration.getBranchUrls().indexOf(url);
        configuration.removeBranch(url);
        listModel.fireItemRemoved(index);
      }
      if (listModel.getSize() > 0) {
        if (selIndex >= listModel.getSize())         selIndex=listModel.getSize() - 1;
        myLocationList.setSelectedIndex(selIndex);
      }
    }
  }
);
}
