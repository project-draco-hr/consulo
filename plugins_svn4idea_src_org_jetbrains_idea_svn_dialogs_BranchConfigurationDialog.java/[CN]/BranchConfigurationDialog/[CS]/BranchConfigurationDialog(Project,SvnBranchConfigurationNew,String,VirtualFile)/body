{
  super(project,true);
  myRoot=root;
  init();
  setTitle(SvnBundle.message("configure.branches.title"));
  if (configuration.getTrunkUrl() == null) {
    configuration.setTrunkUrl(rootUrl);
  }
  mySvnBranchConfigManager=SvnBranchConfigurationManager.getInstance(project).getSvnBranchConfigManager();
  myTrunkLocationTextField.setText(configuration.getTrunkUrl());
  myTrunkLocationTextField.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      try {
        SelectLocationDialog dlg=new SelectLocationDialog(project,myTrunkLocationTextField.getText());
        dlg.show();
        if (dlg.isOK()) {
          myTrunkLocationTextField.setText(dlg.getSelectedURL());
        }
      }
 catch (      SVNException e1) {
      }
    }
  }
);
  final TrunkUrlValidator trunkUrlValidator=new TrunkUrlValidator(rootUrl,configuration);
  myTrunkLocationTextField.getTextField().getDocument().addDocumentListener(trunkUrlValidator);
  trunkUrlValidator.textChanged(null);
  final MyListModel listModel=new MyListModel(configuration);
  myLocationList.setModel(listModel);
  myAddButton.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      try {
        SelectLocationDialog dlg=new SelectLocationDialog(project,rootUrl);
        dlg.show();
        if (dlg.isOK()) {
          if (!configuration.getBranchUrls().contains(dlg.getSelectedURL())) {
            final String url=dlg.getSelectedURL();
            configuration.addBranches(url,new InfoStorage<List<SvnBranchItem>>(new ArrayList<SvnBranchItem>(),InfoReliability.empty));
            mySvnBranchConfigManager.reloadBranches(myRoot,url,null);
            listModel.fireItemAdded();
            myLocationList.setSelectedIndex(listModel.getSize() - 1);
          }
        }
      }
 catch (      SVNException e1) {
        Messages.showErrorDialog(project,SvnBundle.message("select.location.invalid.url.message",rootUrl),SvnBundle.message("dialog.title.select.repository.location"));
      }
    }
  }
);
  myRemoveButton.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      int selIndex=myLocationList.getSelectedIndex();
      Object[] selection=myLocationList.getSelectedValues();
      for (      Object urlObj : selection) {
        String url=(String)urlObj;
        int index=configuration.getBranchUrls().indexOf(url);
        configuration.removeBranch(url);
        listModel.fireItemRemoved(index);
      }
      if (listModel.getSize() > 0) {
        if (selIndex >= listModel.getSize())         selIndex=listModel.getSize() - 1;
        myLocationList.setSelectedIndex(selIndex);
      }
    }
  }
);
}
