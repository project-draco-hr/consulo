{
  final Project project=CommonDataKeys.PROJECT.getData(DataManager.getInstance().getDataContext(editor.getComponent()));
  if (!editor.isOneLineMode()) {
    EditorSearchSession search=EditorSearchSession.get(editor);
    if (search != null) {
      IdeFocusManager.getInstance(project).requestFocus(search.getComponent(),true);
      FindUtil.configureFindModel(myReplace,editor,search.getFindModel(),false);
    }
 else {
      FindManager findManager=FindManager.getInstance(project);
      FindModel model;
      if (myReplace) {
        model=findManager.createReplaceInFileModel();
      }
 else {
        model=new FindModel();
        model.copyFrom(findManager.getFindInFileModel());
      }
      FindUtil.configureFindModel(myReplace,editor,model,true);
      EditorSearchSession.start(editor,model,project).getComponent().requestFocus();
    }
  }
}
