{
  final Project project=CommonDataKeys.PROJECT.getData(DataManager.getInstance().getDataContext(editor.getComponent()));
  if (!editor.isOneLineMode()) {
    EditorSearchSession search=EditorSearchSession.get(editor);
    if (search != null) {
      search.getComponent().requestFocusInTheSearchFieldAndSelectContent(project);
      FindUtil.configureFindModel(myReplace,editor,search.getFindModel(),false);
    }
 else {
      FindManager findManager=FindManager.getInstance(project);
      FindModel model;
      if (myReplace) {
        model=findManager.createReplaceInFileModel();
      }
 else {
        model=new FindModel();
        model.copyFrom(findManager.getFindInFileModel());
      }
      boolean consoleViewEditor=ConsoleViewUtil.isConsoleViewEditor(editor);
      FindUtil.configureFindModel(myReplace,editor,model,consoleViewEditor);
      EditorSearchSession.start(editor,model,project).getComponent().requestFocusInTheSearchFieldAndSelectContent(project);
      if (!consoleViewEditor && editor.getSelectionModel().hasSelection()) {
        FindUtil.updateFindInFileModel(project,model,true);
      }
    }
  }
}
