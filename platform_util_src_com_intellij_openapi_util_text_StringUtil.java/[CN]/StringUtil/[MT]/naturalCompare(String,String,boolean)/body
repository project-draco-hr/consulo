{
  final int string1Length=string1.length();
  final int string2Length=string2.length();
  for (int i=0, j=0; i < string1Length && j < string2Length; i++, j++) {
    final char ch1=string1.charAt(i);
    final char ch2=string2.charAt(j);
    if (isDigit(ch1) && isDigit(ch2)) {
      int startNum1=i;
      int startNum2=j;
      i++;
      j++;
      while (i < string1Length && isDigit(string1.charAt(i)))       i++;
      while (j < string2Length && isDigit(string2.charAt(j)))       j++;
      final int difference=Integer.parseInt(string1.substring(startNum1,i)) - Integer.parseInt(string2.substring(startNum2,j));
      if (difference != 0) {
        return difference;
      }
    }
 else {
      if (caseSensitive) {
        return ch1 - ch2;
      }
 else {
        final int diff1=Character.toUpperCase(ch1) - Character.toUpperCase(ch2);
        if (diff1 != 0) {
          final int diff2=Character.toLowerCase(ch1) - Character.toLowerCase(ch2);
          if (diff2 != 0) {
            return diff1;
          }
        }
      }
    }
  }
  if (!caseSensitive && string1Length == string2Length) {
    return naturalCompare(string1,string2,true);
  }
  return string1Length - string2Length;
}
