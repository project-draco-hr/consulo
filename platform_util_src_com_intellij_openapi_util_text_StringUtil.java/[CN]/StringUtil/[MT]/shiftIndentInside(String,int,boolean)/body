{
  StringBuilder result=new StringBuilder(initial.length());
  LineReader reader=new LineReader(new ByteArrayInputStream(initial.getBytes()));
  boolean first=true;
  for (  byte[] line : reader.readLines()) {
    try {
      if (!first)       result.append('\n');
      if (line.length > 0 || shiftEmptyLines) {
        result.append(repeatSymbol(' ',i));
      }
      result.append(new String(line));
    }
  finally {
      first=false;
    }
  }
  return result.toString();
}
