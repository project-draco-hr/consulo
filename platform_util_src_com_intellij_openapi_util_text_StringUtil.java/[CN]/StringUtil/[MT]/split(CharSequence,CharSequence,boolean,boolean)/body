{
  if (separator.length() == 0) {
    return Collections.singletonList(s);
  }
  List<CharSequence> result=new ArrayList<CharSequence>();
  int pos=0;
  while (true) {
    int index=indexOf(s,separator,pos);
    if (index == -1)     break;
    final int nextPos=index + separator.length();
    CharSequence token=s.subSequence(pos,excludeSeparator ? index : nextPos);
    if (token.length() != 0 || !excludeEmptyStrings) {
      result.add(token);
    }
    pos=nextPos;
  }
  if (pos < s.length() || !excludeEmptyStrings && pos == s.length()) {
    result.add(s.subSequence(pos,s.length()));
  }
  return result;
}
