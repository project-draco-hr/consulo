{
  myInjectedPsiInspectionResults=ContainerUtil.createEmptyCOWList();
  final Set<PsiFile> injected=new THashSet<PsiFile>();
  for (  PsiElement element : elements) {
    InjectedLanguageUtil.enumerate(element,myFile,new PsiLanguageInjectionHost.InjectedPsiVisitor(){
      public void visit(      @NotNull PsiFile injectedPsi,      @NotNull List<PsiLanguageInjectionHost.Shred> places){
        injected.add(injectedPsi);
      }
    }
,false);
  }
  if (!JobUtil.invokeConcurrentlyUnderMyProgress(new ArrayList<PsiFile>(injected),new Processor<PsiFile>(){
    public boolean process(    final PsiFile injectedPsi){
      inspectInjectedPsi(injectedPsi,myInjectedPsiInspectionResults,tools);
      return true;
    }
  }
,myFailFastOnAcquireReadAction))   throw new ProcessCanceledException();
}
