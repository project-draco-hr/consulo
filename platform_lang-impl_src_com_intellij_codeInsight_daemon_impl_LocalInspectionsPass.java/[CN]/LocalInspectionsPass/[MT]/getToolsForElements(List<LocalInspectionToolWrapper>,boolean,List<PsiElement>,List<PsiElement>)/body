{
  Set<Language> languages=new HashSet<Language>();
  for (  PsiElement element : inside) {
    languages.add(element.getLanguage());
  }
  for (  PsiElement element : outside) {
    languages.add(element.getLanguage());
  }
  Map<String,Language> langIds=new HashMap<String,Language>();
  for (  Language language : languages) {
    langIds.put(language.getID(),language);
  }
  Set<String> dialects=new HashSet<String>();
  for (  Language language : languages) {
    for (    Language dialect : language.getDialects()) {
      dialects.add(dialect.getID());
    }
  }
  MultiMap<LocalInspectionTool,String> map=new MultiMap<LocalInspectionTool,String>(){
    @Override protected Collection<String> createCollection(){
      return new HashSet<String>();
    }
    @Override protected Collection<String> createEmptyCollection(){
      return Collections.emptySet();
    }
  }
;
  for (  LocalInspectionToolWrapper wrapper : toolWrappers) {
    String language=wrapper.getLanguage();
    if (language == null) {
      LocalInspectionTool tool=wrapper.getTool();
      if (!checkDumbAwareness || tool instanceof DumbAware) {
        map.put(tool,null);
      }
      continue;
    }
    Language lang=langIds.get(language);
    if (lang != null) {
      LocalInspectionTool tool=wrapper.getTool();
      if (!checkDumbAwareness || tool instanceof DumbAware) {
        map.putValue(tool,language);
        if (wrapper.applyToDialects()) {
          for (          Language dialect : lang.getDialects()) {
            map.putValue(tool,dialect.getID());
          }
        }
      }
    }
 else     if (wrapper.applyToDialects() && dialects.contains(language)) {
      LocalInspectionTool tool=wrapper.getTool();
      if (!checkDumbAwareness || tool instanceof DumbAware) {
        map.putValue(tool,language);
      }
    }
  }
  return map;
}
