{
  final Set<PsiFile> injected=new THashSet<PsiFile>();
  for (  PsiElement element : elements) {
    InjectedLanguageUtil.enumerate(element,getFile(),false,new PsiLanguageInjectionHost.InjectedPsiVisitor(){
      @Override public void visit(      @NotNull PsiFile injectedPsi,      @NotNull List<PsiLanguageInjectionHost.Shred> places){
        injected.add(injectedPsi);
      }
    }
);
  }
  if (injected.isEmpty())   return;
  Processor<PsiFile> processor=new Processor<PsiFile>(){
    @Override public boolean process(    final PsiFile injectedPsi){
      doInspectInjectedPsi(injectedPsi,onTheFly,indicator,iManager,inVisibleRange,wrappers);
      return true;
    }
  }
;
  if (!JobLauncher.getInstance().invokeConcurrentlyUnderProgress(new ArrayList<PsiFile>(injected),indicator,myFailFastOnAcquireReadAction,processor)) {
    throw new ProcessCanceledException();
  }
}
