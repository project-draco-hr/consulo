{
  myFailFastOnAcquireReadAction=failFastOnAcquireReadAction;
  if (toolWrappers.isEmpty())   return;
  List<PsiElement> inside=new ArrayList<PsiElement>();
  List<PsiElement> outside=new ArrayList<PsiElement>();
  Divider.divideInsideAndOutside(getFile(),myRestrictRange.getStartOffset(),myRestrictRange.getEndOffset(),myPriorityRange,inside,new ArrayList<ProperTextRange>(),outside,new ArrayList<ProperTextRange>(),true,FILE_FILTER);
  Set<String> elementDialectIds=InspectionEngine.calcElementDialectIds(inside,outside);
  Map<LocalInspectionToolWrapper,Set<String>> toolToSpecifiedLanguageIds=InspectionEngine.getToolsToSpecifiedLanguages(toolWrappers);
  setProgressLimit(toolToSpecifiedLanguageIds.size() * 2L);
  final LocalInspectionToolSession session=new LocalInspectionToolSession(getFile(),myRestrictRange.getStartOffset(),myRestrictRange.getEndOffset());
  List<InspectionContext> init=visitPriorityElementsAndInit(toolToSpecifiedLanguageIds,iManager,isOnTheFly,progress,inside,session,toolWrappers,elementDialectIds);
  visitRestElementsAndCleanup(progress,outside,session,init,elementDialectIds);
  inspectInjectedPsi(outside,isOnTheFly,progress,iManager,false,toolWrappers);
  progress.checkCanceled();
  myInfos=new ArrayList<HighlightInfo>();
  addHighlightsFromResults(myInfos,progress);
}
