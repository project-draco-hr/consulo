{
  if (index < parameters.length) {
    final PsiType type=parameters[index].getType();
    if (argTypes.length == parameters.length && type instanceof PsiEllipsisType && !(argTypes[argTypes.length - 1] instanceof PsiArrayType)) {
      return ((PsiEllipsisType)type).getComponentType();
    }
    return type;
  }
  if (parameters.length > 0) {
    final PsiType lastParameterType=parameters[parameters.length - 1].getType();
    if (argTypes.length > parameters.length && lastParameterType instanceof PsiEllipsisType) {
      return ((PsiEllipsisType)lastParameterType).getComponentType();
    }
    return lastParameterType;
  }
  return PsiType.NULL;
}
