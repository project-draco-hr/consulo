{
  if (!executor.getId().equals(DefaultDebugExecutor.EXECUTOR_ID)) {
    return;
  }
  if (!GroovyDebuggerSettings.getInstance().ENABLE_GROOVY_HOTSWAP) {
    return;
  }
  if (hasSpringLoadedReloader(javaParameters)) {
    return;
  }
  if (!(configuration instanceof RunConfiguration)) {
    return;
  }
  final Project project=((RunConfiguration)configuration).getProject();
  if (project == null) {
    return;
  }
  if (configuration instanceof ModuleRunProfile) {
    Module[] modulesInConfiguration=((ModuleRunProfile)configuration).getModules();
    final Module module=modulesInConfiguration.length == 0 ? null : modulesInConfiguration[0];
    if (module != null) {
      final JavaModuleExtension extension=ModuleUtilCore.getExtension(module,JavaModuleExtension.class);
      final LanguageLevel level=extension == null ? null : extension.getLanguageLevel();
      if (level != null && !level.isAtLeast(LanguageLevel.JDK_1_5)) {
        return;
      }
      if (ModuleUtilCore.getExtension(module,GroovyModuleExtension.class) == null) {
        return;
      }
    }
  }
  Sdk jdk=javaParameters.getJdk();
  if (jdk != null) {
    String vendor=JdkUtil.getJdkMainAttribute(jdk,Attributes.Name.IMPLEMENTATION_VENDOR);
    if (vendor != null && vendor.contains("IBM")) {
      LOG.info("Due to IBM JDK pecularities (IDEA-59070) we don't add groovy agent when running applications under it");
      return;
    }
  }
  if (!project.isDefault() && containsGroovyClasses(project)) {
    final String agentPath=handleSpacesInPath(getAgentJarPath());
    if (agentPath != null) {
      javaParameters.getVMParametersList().add("-javaagent:" + agentPath);
    }
  }
}
