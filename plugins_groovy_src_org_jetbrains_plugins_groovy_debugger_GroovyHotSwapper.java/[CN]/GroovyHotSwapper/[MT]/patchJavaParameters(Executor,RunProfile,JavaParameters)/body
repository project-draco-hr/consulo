{
  if (!executor.getId().equals(DefaultDebugExecutor.EXECUTOR_ID)) {
    return;
  }
  if (!Registry.is("enable.groovy.hotswap")) {
    return;
  }
  if (!(configuration instanceof RunConfiguration)) {
    return;
  }
  final Project project=((RunConfiguration)configuration).getProject();
  if (project == null) {
    return;
  }
  if (!LanguageLevelProjectExtension.getInstance(project).getLanguageLevel().isAtLeast(LanguageLevel.JDK_1_5)) {
    return;
  }
  if (configuration instanceof ModuleBasedConfiguration) {
    final Module module=((ModuleBasedConfiguration)configuration).getConfigurationModule().getModule();
    if (module != null) {
      final LanguageLevel level=LanguageLevelModuleExtension.getInstance(module).getLanguageLevel();
      if (level != null && !level.isAtLeast(LanguageLevel.JDK_1_5)) {
        return;
      }
    }
  }
  Sdk jdk=javaParameters.getJdk();
  if (jdk != null) {
    String vendor=JdkUtil.getJdkMainAttribute(jdk,Attributes.Name.IMPLEMENTATION_VENDOR);
    if (vendor != null && vendor.contains("IBM")) {
      LOG.info("Due to IBM JDK pecularities (IDEA-59070) we don't add groovy agent when running applications under it");
      return;
    }
  }
  if (containsGroovyClasses(project)) {
    final String agentPath=handleSpacesInPath(getAgentJarPath());
    if (agentPath != null) {
      javaParameters.getVMParametersList().add("-javaagent:" + agentPath);
    }
  }
}
