{
  if (!SystemInfo.areSymLinksSupported)   return;
  final File targetFile=FileUtil.createTempFile("target","");
  final File linkFile=createTempLink(targetFile.getAbsolutePath(),"link");
  final VirtualFile linkVFile=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(linkFile);
  assertTrue("link=" + linkFile + ", vLink="+ linkVFile,linkVFile != null && !linkVFile.isDirectory() && linkVFile.isSymLink());
  assertTrue(targetFile.getAbsolutePath(),targetFile.setWritable(true,false) && targetFile.canWrite());
  linkVFile.refresh(false,false);
  assertTrue(linkVFile.getPath(),linkVFile.isWritable());
  assertTrue(targetFile.getAbsolutePath(),targetFile.setWritable(false,false) && !targetFile.canWrite());
  linkVFile.refresh(false,false);
  assertFalse(linkVFile.getPath(),linkVFile.isWritable());
  final File targetDir=FileUtil.createTempDirectory("targetDir","");
  final File linkDir=createTempLink(targetDir.getAbsolutePath(),"linkDir");
  final VirtualFile linkVDir=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(linkDir);
  assertTrue("link=" + linkDir + ", vLink="+ linkVDir,linkVDir != null && linkVDir.isDirectory() && linkVDir.isSymLink());
  if (!SystemInfo.isWindows) {
    assertTrue(targetDir.getAbsolutePath(),targetDir.setWritable(true,false) && targetDir.canWrite());
    linkVDir.refresh(false,true);
    assertTrue(linkVDir.getPath(),linkVDir.isWritable());
    assertTrue(targetDir.getAbsolutePath(),targetDir.setWritable(false,false) && !targetDir.canWrite());
    linkVDir.refresh(false,true);
    assertFalse(linkVDir.getPath(),linkVDir.isWritable());
  }
 else {
    assertEquals(linkVDir.getPath(),targetDir.canWrite(),linkVDir.isWritable());
  }
}
