{
  final File linkFile=new File(FileUtil.getTempDirectory(),link);
  assertTrue(link,!linkFile.exists() || linkFile.delete());
  final File parentDir=linkFile.getParentFile();
  assertTrue("link=" + link + ", parent="+ parentDir,parentDir != null && (parentDir.isDirectory() || parentDir.mkdirs()));
  final ProcessBuilder builder;
  if (SystemInfo.isWindows) {
    builder=new File(target).isDirectory() ? new ProcessBuilder("cmd","/C","mklink","/D",linkFile.getAbsolutePath(),target) : new ProcessBuilder("cmd","/C","mklink",linkFile.getAbsolutePath(),target);
  }
 else {
    builder=new ProcessBuilder("ln","-s",target,linkFile.getAbsolutePath());
  }
  final Process process=builder.start();
  final int res=process.waitFor();
  assertTrue(builder.command() + ": " + res,res == 0);
  final File targetFile=new File(target);
  assertEquals("target=" + target + ", link="+ linkFile,targetFile.exists(),linkFile.exists());
  return linkFile;
}
