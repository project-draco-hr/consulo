{
  XmlTag tag=PsiTreeUtil.getParentOfType(insertedElement,XmlTag.class,false);
  String prefix=null;
  if (isScriptTag(tag) && ourScriptCompletionData != null && !(insertedElement.getParent() instanceof XmlAttributeValue)) {
    prefix=ourScriptCompletionData.findPrefix(insertedElement,offset);
  }
 else   if (isStyleTag(tag) && ourStyleCompletionData != null) {
    prefix=ourStyleCompletionData.findPrefix(insertedElement,offset);
  }
  if (prefix == null) {
    prefix=super.findPrefix(insertedElement,offset);
    boolean searchForEntities=insertedElement instanceof XmlToken && (((XmlToken)insertedElement).getTokenType() == XmlTokenType.XML_DATA_CHARACTERS || ((XmlToken)insertedElement).getTokenType() == XmlTokenType.XML_ATTRIBUTE_VALUE_TOKEN);
    if (searchForEntities && prefix != null) {
      if (prefix.startsWith("&")) {
        prefix=prefix.substring(1);
      }
 else       if (prefix.contains("&")) {
        prefix=prefix.substring(prefix.indexOf("&") + 1);
      }
    }
  }
  return prefix;
}
