{
  final Set<Usage> selectedUsages=replaceContext.getUsageView().getSelectedUsages();
  if (selectedUsages == null) {
    return;
  }
  if (FindInProjectUtil.hasReadOnlyUsages(selectedUsages)) {
    int result=Messages.showOkCancelDialog(replaceContext.getUsageView().getComponent(),"Occurrences found in read-only files.\n" + "The operation will not affect them.\n" + "Continue anyway?","Read-only Files Found",Messages.getWarningIcon());
    if (result != 0) {
      return;
    }
  }
  CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
    public void run(){
      doReplace(replaceContext,selectedUsages);
      for (Iterator<Usage> i=selectedUsages.iterator(); i.hasNext(); ) {
        replaceContext.getUsageView().removeUsage(i.next());
      }
      if (replaceContext.getUsageView().getUsages().size() == 0) {
        replaceContext.getUsageView().close();
        return;
      }
      replaceContext.getUsageView().getComponent().requestFocus();
    }
  }
,"Replace",null);
}
