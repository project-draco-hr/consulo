{
  if (psiBlock.getParent() instanceof PsiMethod) {
    final PsiClass containingClass=((PsiMethod)psiBlock.getParent()).getContainingClass();
    if (containingClass instanceof PsiAnonymousClass) {
      final PsiElement newExpression=containingClass.getParent();
      final PsiCodeBlock block=DfaUtil.getTopmostBlockInSameClass(newExpression);
      if (newExpression instanceof PsiNewExpression && block != null) {
        final EnvironmentalInstructionVisitor envVisitor=new EnvironmentalInstructionVisitor(visitor,(PsiNewExpression)newExpression);
        final RunnerResult result=analyzeMethod(block,envVisitor);
        if (result == RunnerResult.OK) {
          final Collection<DfaMemoryState> closureStates=envVisitor.getClosureStates();
          if (!closureStates.isEmpty()) {
            return closureStates;
          }
        }
        return null;
      }
    }
  }
  return Arrays.asList(createMemoryState());
}
