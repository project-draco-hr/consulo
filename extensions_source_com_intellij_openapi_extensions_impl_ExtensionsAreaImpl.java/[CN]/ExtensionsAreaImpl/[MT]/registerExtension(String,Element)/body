{
  String epName=extractEPName(extensionElement);
  ExtensionComponentAdapter adapter;
  String implClass=null;
  Class extensionClass=getExtensionPoint(epName).getExtensionClass();
  implClass=extensionElement.getAttributeValue("implementation");
  if (extensionClass.isInterface() || Modifier.isAbstract(extensionClass.getModifiers())) {
    if (implClass == null) {
      throw new RuntimeException("Expected implementation for extension declaration (ep = " + epName + ")");
    }
  }
  if (implClass != null) {
    try {
      Class implementationClass=Class.forName(implClass);
      adapter=new ExtensionComponentAdapter(implementationClass,extensionElement,getPluginContainer(pluginName),pluginName);
    }
 catch (    ClassNotFoundException e) {
      myLogger.warn("Extension implementation class not found: " + implClass);
      myExtensionElement2extension.put(extensionElement,null);
      return;
    }
  }
 else {
    final ExtensionPoint extensionPoint=getExtensionPoint(epName);
    adapter=new ExtensionComponentAdapter(extensionPoint.getExtensionClass(),extensionElement,getPluginContainer(pluginName),pluginName);
  }
  myExtensionElement2extension.put(extensionElement,adapter);
  internalGetPluginContainer(pluginName).registerComponent(adapter);
  getExtensionPointImpl(epName).registerExtensionAdapter(adapter);
}
