{
  PsiPackage aPackage=JavaDirectoryService.getInstance().getPackage(directory);
  PsiPackage parentPackage;
  if (!ProjectRootsUtil.isSourceRoot(directory) && aPackage != null && aPackage.getQualifiedName().length() > 0 && parentValue instanceof PsiDirectory) {
    parentPackage=JavaDirectoryService.getInstance().getPackage(((PsiDirectory)parentValue));
  }
 else   if (ProjectRootsUtil.isSourceRoot(directory) && aPackage != null) {
    aPackage=null;
    parentPackage=null;
  }
 else {
    parentPackage=null;
  }
  return PackageUtil.getNodeName(settings,aPackage,parentPackage,directory.getName(),isShowFQName(settings,parentValue,directory));
}
