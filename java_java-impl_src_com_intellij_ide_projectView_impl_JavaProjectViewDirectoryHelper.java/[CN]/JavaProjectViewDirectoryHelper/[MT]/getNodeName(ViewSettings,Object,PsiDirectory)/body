{
  PsiPackage aPackage=JavaDirectoryService.getInstance().getPackage(directory);
  if (aPackage != null && !ProjectRootsUtil.isSourceRoot(directory) && !settings.isFlattenPackages() && settings.isHideEmptyMiddlePackages() && !ProjectRootsUtil.isLibraryRoot(directory.getVirtualFile(),getProject()) && TreeViewUtil.isEmptyMiddlePackage(directory,true)) {
    return null;
  }
  PsiPackage parentPackage;
  if (!ProjectRootsUtil.isSourceRoot(directory) && aPackage != null && aPackage.getQualifiedName().length() > 0 && parentValue instanceof PsiDirectory) {
    parentPackage=JavaDirectoryService.getInstance().getPackage(((PsiDirectory)parentValue));
  }
 else {
    parentPackage=null;
  }
  return PackageUtil.getNodeName(settings,aPackage,parentPackage,directory.getName(),isShowFQName(settings,parentValue,directory));
}
