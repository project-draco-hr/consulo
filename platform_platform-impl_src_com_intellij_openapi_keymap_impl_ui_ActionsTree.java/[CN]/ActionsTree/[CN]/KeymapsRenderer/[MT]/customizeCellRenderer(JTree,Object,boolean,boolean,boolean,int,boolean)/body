{
  final boolean showIcons=UISettings.getInstance().SHOW_ICONS_IN_MENUS;
  Keymap originalKeymap=myKeymap != null ? myKeymap.getParent() : null;
  Icon icon=null;
  String text;
  boolean bound=false;
  if (value instanceof DefaultMutableTreeNode) {
    Object userObject=((DefaultMutableTreeNode)value).getUserObject();
    boolean changed;
    if (userObject instanceof Group) {
      Group group=(Group)userObject;
      text=group.getName();
      changed=originalKeymap != null && isGroupChanged(group,originalKeymap,myKeymap);
      icon=expanded ? group.getOpenIcon() : group.getIcon();
      if (icon == null) {
        icon=expanded ? OPEN_ICON : CLOSE_ICON;
      }
    }
 else     if (userObject instanceof String) {
      String actionId=(String)userObject;
      bound=myShowBoundActions && ((KeymapImpl)myKeymap).isActionBound(actionId);
      AnAction action=ActionManager.getInstance().getActionOrStub(actionId);
      if (action != null) {
        text=action.getTemplatePresentation().getText();
        if (text == null || text.length() == 0) {
          text=actionId;
        }
        Icon actionIcon=action.getTemplatePresentation().getIcon();
        if (actionIcon != null) {
          icon=actionIcon;
        }
      }
 else {
        text=actionId;
      }
      changed=originalKeymap != null && isActionChanged(actionId,originalKeymap,myKeymap);
    }
 else     if (userObject instanceof QuickList) {
      QuickList list=(QuickList)userObject;
      icon=QUICK_LIST_ICON;
      text=list.getDisplayName();
      changed=originalKeymap != null && isActionChanged(list.getActionId(),originalKeymap,myKeymap);
    }
 else     if (userObject instanceof Separator) {
      changed=false;
      text="-------------";
    }
 else {
      throw new IllegalArgumentException("unknown userObject: " + userObject);
    }
    if (showIcons) {
      setIcon(ActionsTree.getEvenIcon(icon));
    }
    Color foreground;
    if (selected) {
      foreground=UIUtil.getTreeSelectionForeground();
    }
 else {
      if (changed) {
        foreground=Color.BLUE;
      }
 else {
        foreground=UIUtil.getTreeForeground();
      }
      if (bound) {
        foreground=Color.MAGENTA;
      }
    }
    SearchUtil.appendFragments(myFilter,text,Font.PLAIN,foreground,selected ? UIUtil.getTreeSelectionBackground() : UIUtil.getTreeTextBackground(),this);
  }
}
