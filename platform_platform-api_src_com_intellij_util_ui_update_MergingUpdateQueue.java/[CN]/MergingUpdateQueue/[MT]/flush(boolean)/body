{
  if (myFlushing) {
    return;
  }
  if (!isModalityStateCorrect()) {
    return;
  }
  myFlushing=true;
  final Runnable toRun=new Runnable(){
    @Override public void run(){
      try {
        final Update[] all;
synchronized (myScheduledUpdates) {
          all=myScheduledUpdates.keySet().toArray(new Update[myScheduledUpdates.size()]);
          myScheduledUpdates.clear();
        }
        for (        Update each : all) {
          each.setProcessed();
        }
        execute(all);
      }
  finally {
        myFlushing=false;
        if (isEmpty()) {
          finishActivity();
        }
      }
    }
  }
;
  if (myExecuteInDispatchThread && invokeLaterIfNotDispatch) {
    UIUtil.invokeLaterIfNeeded(toRun);
  }
 else {
    toRun.run();
  }
}
