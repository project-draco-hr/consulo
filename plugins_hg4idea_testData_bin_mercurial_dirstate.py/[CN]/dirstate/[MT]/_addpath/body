def _addpath(self, f, check=False):
    oldstate = self[f]
    if (check or (oldstate == 'r')):
        if (('\r' in f) or ('\n' in f)):
            raise util.Abort((_("'\\n' and '\\r' disallowed in filenames: %r") % f))
        if (f in self._dirs):
            raise util.Abort((_('directory %r already in dirstate') % f))
        for d in _finddirs(f):
            if (d in self._dirs):
                break
            if ((d in self._map) and (self[d] != 'r')):
                raise util.Abort((_('file %r in dirstate clashes with %r') % (d, f)))
    if ((oldstate in '?r') and ('_dirs' in self.__dict__)):
        _incdirs(self._dirs, f)
