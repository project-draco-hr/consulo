{
  if (document.getUserData(UndoManager.DONT_RECORD_UNDO) == Boolean.TRUE)   return false;
  final VirtualFile vFile=FileDocumentManager.getInstance().getFile(document);
  if (vFile != null && vFile.getUserData(UndoManager.DONT_RECORD_UNDO) == Boolean.TRUE) {
    return false;
  }
  return true;
}
