{
  myProject=project;
  myEventPublisher=messageBus.syncPublisher(CompilerTopics.COMPILATION_STATUS);
  for (  Compiler compiler : Compiler.EP_NAME.getExtensions(project)) {
    compiler.init(this);
    myCompilers.add(compiler);
    if (compiler instanceof TranslatingCompiler) {
      final TranslatingCompiler translatingCompiler=(TranslatingCompiler)compiler;
      myTranslatingCompilerInputFileTypes.put(translatingCompiler,Arrays.asList(translatingCompiler.getInputFileTypes()));
      myTranslatingCompilerOutputFileTypes.put(translatingCompiler,Arrays.asList(translatingCompiler.getOutputFileTypes()));
    }
  }
  final File projectGeneratedSrcRoot=CompilerPaths.getGeneratedDataDirectory(project);
  projectGeneratedSrcRoot.mkdirs();
  final LocalFileSystem lfs=LocalFileSystem.getInstance();
  myWatchRoots=lfs.addRootsToWatch(Collections.singletonList(FileUtil.toCanonicalPath(projectGeneratedSrcRoot.getPath())),true);
  Disposer.register(project,new Disposable(){
    @Override public void dispose(){
      lfs.removeWatchedRoots(myWatchRoots);
      if (ApplicationManager.getApplication().isUnitTestMode()) {
        FileUtil.delete(CompilerPaths.getCompilerSystemDirectory(project));
      }
    }
  }
);
}
