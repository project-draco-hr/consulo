{
  myProject=project;
  myEventPublisher=messageBus.syncPublisher(CompilerTopics.COMPILATION_STATUS);
  final CompilerProvider[] extensions=CompilerProvider.EP_NAME.getExtensions();
  for (  CompilerProvider extension : extensions) {
    final CompilerSettings settings=extension.createSettings(project);
    myCompilers.put(extension.createCompiler(project),settings == null ? CompilerSettings.EMPTY : settings);
  }
  final File projectGeneratedSrcRoot=CompilerPaths.getGeneratedDataDirectory(project);
  projectGeneratedSrcRoot.mkdirs();
  final LocalFileSystem lfs=LocalFileSystem.getInstance();
  myWatchRoots=lfs.addRootsToWatch(Collections.singletonList(FileUtil.toCanonicalPath(projectGeneratedSrcRoot.getPath())),true);
  Disposer.register(project,new Disposable(){
    @Override public void dispose(){
      lfs.removeWatchedRoots(myWatchRoots);
      if (ApplicationManager.getApplication().isUnitTestMode()) {
        FileUtil.delete(CompilerPaths.getCompilerSystemDirectory(project));
      }
    }
  }
);
}
