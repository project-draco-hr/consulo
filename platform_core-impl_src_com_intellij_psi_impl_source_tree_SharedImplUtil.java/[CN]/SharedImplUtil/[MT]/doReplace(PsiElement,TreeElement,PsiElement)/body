{
  CompositeElement treeParent=treeElement.getTreeParent();
  LOG.assertTrue(treeParent != null);
  CheckUtil.checkWritable(psiElement);
  TreeElement elementCopy=ChangeUtil.copyToElement(newElement);
  treeParent.replaceChildInternal(treeElement,elementCopy);
  elementCopy=ChangeUtil.decodeInformation(elementCopy);
  final PsiElement result=SourceTreeToPsiMap.treeElementToPsi(elementCopy);
  treeElement.invalidate();
  return result;
}
