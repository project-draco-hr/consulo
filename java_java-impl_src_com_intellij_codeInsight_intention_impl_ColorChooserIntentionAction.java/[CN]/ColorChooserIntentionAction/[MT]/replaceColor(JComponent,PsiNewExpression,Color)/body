{
  final Color color=ColorChooser.chooseColor(editorComponent,getText(),oldColor);
  if (color != null) {
    final PsiManager manager=expression.getManager();
    final PsiElementFactory factory=JavaPsiFacade.getInstance(manager.getProject()).getElementFactory();
    final PsiExpression newCall=factory.createExpressionFromText("new " + JAVA_AWT_COLOR + "("+ color.getRed()+ ", "+ color.getGreen()+ ", "+ color.getBlue()+ (oldColor.getAlpha() < 255 ? ", " + oldColor.getAlpha() : "")+ ")",expression);
    final PsiElement insertedElement=expression.replace(newCall);
    final CodeStyleManager codeStyleManager=manager.getCodeStyleManager();
    codeStyleManager.reformat(insertedElement);
  }
}
