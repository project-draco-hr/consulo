{
  if (skipWhiteSpaces && root.getElementType() == TokenType.WHITE_SPACE)   return;
  StringUtil.repeatSymbol(buffer,' ',indent);
  if (root instanceof CompositeElement) {
    if (usePsi) {
      final PsiElement psiElement=root.getPsi();
      if (psiElement != null) {
        buffer.append(psiElement.toString());
      }
 else {
        buffer.append(root.getElementType().toString());
      }
    }
 else {
      buffer.append(root.toString());
    }
  }
 else {
    String text=root.getText();
    text=StringUtil.replace(text,"\n","\\n");
    text=StringUtil.replace(text,"\r","\\r");
    text=StringUtil.replace(text,"\t","\\t");
    buffer.append(root.toString()).append("('").append(text).append("')");
  }
  if (showRanges)   buffer.append(root.getTextRange());
  buffer.append("\n");
  if (root instanceof CompositeElement) {
    ASTNode child=root.getFirstChildNode();
    if (child == null) {
      StringUtil.repeatSymbol(buffer,' ',indent + 2);
      buffer.append("<empty list>\n");
    }
 else {
      while (child != null) {
        treeToBuffer(buffer,child,indent + 2,skipWhiteSpaces,showChildrenRanges,showChildrenRanges,usePsi);
        child=child.getTreeNext();
      }
    }
  }
}
