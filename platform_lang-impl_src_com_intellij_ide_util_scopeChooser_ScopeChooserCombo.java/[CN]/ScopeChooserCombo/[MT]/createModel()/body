{
  final DefaultComboBoxModel model=new DefaultComboBoxModel();
  createPredefinedScopeDescriptors(model);
  final List<NamedScope> changeLists=ChangeListsScopesProvider.getInstance(myProject).getCustomScopes();
  if (!changeLists.isEmpty()) {
    model.addElement(new ScopeSeparator("VCS Scopes"));
    for (    NamedScope changeListScope : changeLists) {
      final GlobalSearchScope scope=GlobalSearchScopesCore.filterScope(myProject,changeListScope);
      addScopeDescriptor(model,new ScopeDescriptor(scope));
    }
  }
  final List<ScopeDescriptor> customScopes=new ArrayList<ScopeDescriptor>();
  final NamedScopesHolder[] holders=NamedScopesHolder.getAllNamedScopeHolders(myProject);
  for (  NamedScopesHolder holder : holders) {
    final NamedScope[] scopes=holder.getEditableScopes();
    for (    NamedScope scope : scopes) {
      final GlobalSearchScope searchScope=GlobalSearchScopesCore.filterScope(myProject,scope);
      customScopes.add(new ScopeDescriptor(searchScope));
    }
  }
  if (!customScopes.isEmpty()) {
    model.addElement(new ScopeSeparator("Custom Scopes"));
    for (    ScopeDescriptor scope : customScopes) {
      addScopeDescriptor(model,scope);
    }
  }
  return model;
}
