{
  final Project project=myContext.getCompileContext().getProject();
  final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  final VirtualFile[] children=directory.getChildren();
  if (children != null) {
    for (    VirtualFile child : children) {
      if (!fileIndex.isIgnored(child) && (filter == null || filter.accept(child,myContext.getCompileContext()))) {
        if (!child.isDirectory()) {
          addFileCopyInstruction(child,child.getName());
        }
 else {
          subFolder(child.getName()).addDirectoryCopyInstructions(child,filter);
        }
      }
    }
  }
}
