{
  final VirtualFile[] children=directory.getChildren();
  if (children != null) {
    final FileTypeManager fileTypeManager=FileTypeManager.getInstance();
    for (    VirtualFile child : children) {
      if (!fileTypeManager.isFileIgnored(child.getName()) && (filter == null || filter.accept(child,myContext.getCompileContext()))) {
        if (!child.isDirectory()) {
          addFileCopyInstruction(child,child.getName());
        }
 else {
          subFolder(child.getName()).addDirectoryCopyInstructions(child,filter);
        }
      }
    }
  }
}
