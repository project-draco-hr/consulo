{
  if (myOldProblemElements == null)   return null;
  final com.intellij.util.containers.HashMap<String,Set<RefEntity>> oldContents=new com.intellij.util.containers.HashMap<String,Set<RefEntity>>();
  final Set<RefEntity> elements=myOldProblemElements.keySet();
  for (  RefEntity element : elements) {
    String groupName=element instanceof RefElement ? element.getRefManager().getGroupName((RefElement)element) : element.getName();
    final Set<RefEntity> collection=myContents.get(groupName);
    if (collection != null) {
      final Set<RefEntity> currentElements=new HashSet<RefEntity>(collection);
      if (RefUtil.contains(element,currentElements))       continue;
    }
    Set<RefEntity> oldContent=oldContents.get(groupName);
    if (oldContent == null) {
      oldContent=new HashSet<RefEntity>();
      oldContents.put(groupName,oldContent);
    }
    oldContent.add(element);
  }
  return oldContents;
}
