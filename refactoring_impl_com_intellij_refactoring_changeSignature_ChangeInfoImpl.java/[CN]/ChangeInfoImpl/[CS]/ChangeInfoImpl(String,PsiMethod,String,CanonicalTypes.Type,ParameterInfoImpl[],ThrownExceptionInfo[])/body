{
  this.newVisibility=newVisibility;
  this.method=method;
  this.newName=newName;
  newReturnType=newType;
  this.newParms=newParms;
  wasVararg=method.isVarArgs();
  oldName=method.getName();
  final PsiManager manager=method.getManager();
  if (!method.isConstructor()) {
    oldType=JavaPsiFacade.getInstance(manager.getProject()).getElementFactory().createTypeElement(method.getReturnType()).getText();
  }
 else {
    oldType=null;
  }
  PsiParameter[] parameters=method.getParameterList().getParameters();
  oldParameterNames=new String[parameters.length];
  oldParameterTypes=new String[parameters.length];
  for (int i=0; i < parameters.length; i++) {
    PsiParameter parameter=parameters[i];
    oldParameterNames[i]=parameter.getName();
    oldParameterTypes[i]=JavaPsiFacade.getInstance(parameter.getProject()).getElementFactory().createTypeElement(parameter.getType()).getText();
  }
  isVisibilityChanged=!method.hasModifierProperty(newVisibility);
  isNameChanged=!newName.equals(oldName);
  if (!method.isConstructor()) {
    try {
      isReturnTypeChanged=!newReturnType.getType(this.method,manager).equals(this.method.getReturnType());
    }
 catch (    IncorrectOperationException e) {
      isReturnTypeChanged=true;
    }
  }
  if (parameters.length != newParms.length) {
    isParameterSetOrOrderChanged=true;
  }
 else {
    for (int i=0; i < newParms.length; i++) {
      ParameterInfoImpl parmInfo=newParms[i];
      PsiParameter parameter=parameters[i];
      if (i != parmInfo.oldParameterIndex) {
        isParameterSetOrOrderChanged=true;
        break;
      }
      if (!parmInfo.getName().equals(parameter.getName())) {
        isParameterNamesChanged=true;
      }
      try {
        if (!parmInfo.createType(method,manager).equals(parameter.getType())) {
          isParameterTypesChanged=true;
        }
      }
 catch (      IncorrectOperationException e) {
        isParameterTypesChanged=true;
      }
    }
  }
  setupPropagationEnabled(parameters,newParms);
  setupExceptions(newExceptions,method);
  toRemoveParm=new boolean[parameters.length];
  Arrays.fill(toRemoveParm,true);
  for (  ParameterInfoImpl info : newParms) {
    if (info.oldParameterIndex < 0)     continue;
    toRemoveParm[info.oldParameterIndex]=false;
  }
  PsiElementFactory factory=JavaPsiFacade.getInstance(manager.getProject()).getElementFactory();
  defaultValues=new PsiExpression[newParms.length];
  for (int i=0; i < newParms.length; i++) {
    ParameterInfoImpl info=newParms[i];
    if (info.oldParameterIndex < 0 && !info.isVarargType()) {
      if (info.defaultValue == null)       continue;
      try {
        defaultValues[i]=factory.createExpressionFromText(info.defaultValue,method);
      }
 catch (      IncorrectOperationException e) {
        LOG.error(e);
      }
    }
  }
  if (this.newParms.length == 0) {
    retainsVarargs=false;
    obtainsVarags=false;
    arrayToVarargs=false;
  }
 else {
    final ParameterInfoImpl lastNewParm=this.newParms[this.newParms.length - 1];
    obtainsVarags=lastNewParm.isVarargType();
    retainsVarargs=lastNewParm.oldParameterIndex >= 0 && obtainsVarags;
    if (retainsVarargs) {
      final PsiType oldTypeForVararg=parameters[lastNewParm.oldParameterIndex].getType();
      arrayToVarargs=(oldTypeForVararg instanceof PsiArrayType && !(oldTypeForVararg instanceof PsiEllipsisType));
    }
 else {
      arrayToVarargs=false;
    }
  }
}
