{
  PsiFile psiFile=highlightingSession.getPsiFile();
  final Project project=psiFile.getProject();
  final Document document=PsiDocumentManager.getInstance(project).getDocument(psiFile);
  if (document == null)   return;
  final long modificationStamp=document.getModificationStamp();
  UIUtil.invokeLaterIfNeeded(new Runnable(){
    @Override public void run(){
      if (project.isDisposed() || modificationStamp != document.getModificationStamp())       return;
      Editor editor=highlightingSession.getEditor();
      EditorColorsScheme scheme=editor == null ? null : editor.getColorsScheme();
      UpdateHighlightersUtil.setHighlightersOutsideRange(project,document,infos,scheme,restrictedRange.getStartOffset(),restrictedRange.getEndOffset(),ProperTextRange.create(priorityRange),highlightingSession.getPassId());
      if (editor != null) {
        DaemonListeners.repaintErrorStripeRenderer(editor,project);
      }
    }
  }
);
}
