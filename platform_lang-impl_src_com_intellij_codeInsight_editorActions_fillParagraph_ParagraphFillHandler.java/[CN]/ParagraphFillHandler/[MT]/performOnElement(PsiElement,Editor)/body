{
  final Document document=editor.getDocument();
  final TextRange textRange=getTextRange(element,editor);
  final String text=textRange.substring(element.getContainingFile().getText());
  final List<String> subStrings=StringUtil.split(text,"\n",true);
  final StringBuilder stringBuilder=new StringBuilder();
  for (  String string : subStrings) {
    stringBuilder.append(StringUtil.trimStart(string.trim(),getPrefix(element))).append(" ");
  }
  final String replacementText=stringBuilder.toString();
  CommandProcessor.getInstance().executeCommand(element.getProject(),new Runnable(){
    public void run(){
      document.replaceString(textRange.getStartOffset(),textRange.getEndOffset(),getPrefix(element) + replacementText);
      final CodeFormatterFacade codeFormatter=new CodeFormatterFacade(CodeStyleSettingsManager.getSettings(element.getProject()));
      codeFormatter.doWrapLongLinesIfNecessary(editor,element.getProject(),document,textRange.getStartOffset(),textRange.getStartOffset() + replacementText.length() + 1);
    }
  }
,null,document);
}
