{
  if (!CodeInsightUtil.prepareFileForWrite(myCatchParameter.getContainingFile()))   return;
  try {
    PsiTryStatement tryStatement=((PsiCatchSection)myCatchParameter.getDeclarationScope()).getTryStatement();
    PsiElement tryParent=tryStatement.getParent();
    if (tryStatement.getCatchBlocks().length == 1 && tryStatement.getFinallyBlock() == null) {
      PsiCodeBlock tryBlock=tryStatement.getTryBlock();
      PsiElement reformatRangeStart=tryStatement.getPrevSibling();
      PsiElement reformatRangeEnd=tryStatement.getNextSibling();
      while ((reformatRangeEnd=reformatRangeEnd.getNextSibling()) instanceof PsiWhiteSpace)       ;
      if (reformatRangeEnd == null)       reformatRangeEnd=tryParent;
      PsiElement firstElement=tryBlock.getFirstBodyElement();
      PsiElement lastAddedStatement=null;
      if (firstElement != null) {
        PsiElement endElement=tryBlock.getLastBodyElement();
        reformatRangeStart=tryParent.addRangeBefore(firstElement,endElement,tryStatement).getPrevSibling();
        lastAddedStatement=tryStatement.getPrevSibling();
        while (lastAddedStatement instanceof PsiWhiteSpace) {
          lastAddedStatement=lastAddedStatement.getPrevSibling();
        }
      }
      tryStatement.delete();
      if (lastAddedStatement != null) {
        editor.getCaretModel().moveToOffset(lastAddedStatement.getTextRange().getEndOffset());
      }
      CodeStyleManager styleManager=CodeStyleManager.getInstance(project);
      styleManager.reformatRange(tryParent,reformatRangeStart.getTextRange().getEndOffset(),reformatRangeEnd.getTextRange().getStartOffset());
      return;
    }
    LOG.assertTrue(myCatchParameter.getParent() instanceof PsiCatchSection);
    final PsiElement catchSection=myCatchParameter.getParent();
    PsiElement previousElement=catchSection.getPrevSibling();
    while (previousElement != null && previousElement instanceof PsiWhiteSpace) {
      previousElement=previousElement.getPrevSibling();
    }
    catchSection.delete();
    if (previousElement != null) {
      editor.getCaretModel().moveToOffset(previousElement.getTextRange().getEndOffset());
    }
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
}
