def username(self):
    'Return default username to be used in commits.\n\n        Searched in this order: $HGUSER, [ui] section of hgrcs, $EMAIL\n        and stop searching if one of these is set.\n        If not found and ui.askusername is True, ask the user, else use\n        ($LOGNAME or $USER or $LNAME or $USERNAME) + "@full.hostname".\n        '
    user = os.environ.get('HGUSER')
    if (user is None):
        user = self.config('ui', 'username')
    if (user is None):
        user = os.environ.get('EMAIL')
    if ((user is None) and self.configbool('ui', 'askusername')):
        user = self.prompt(_('enter a commit username:'), default=None)
    if ((user is None) and (not self.interactive())):
        try:
            user = ('%s@%s' % (util.getuser(), socket.getfqdn()))
            self.warn((_("No username found, using '%s' instead\n") % user))
        except KeyError:
            pass
    if (not user):
        raise util.Abort(_('no username supplied (see "hg help config")'))
    if ('\n' in user):
        raise util.Abort((_('username %s contains a newline\n') % repr(user)))
    return user
