{
  assertDispatchThread();
  runChange(new FileEditorManagerChange(){
    public void run(    EditorsSplitters splitters){
      final List<EditorWindow> windows=splitters.findWindows(file);
      if (!windows.isEmpty()) {
        final VirtualFile nextFile=splitters.findNextFile(file);
        for (        final EditorWindow window : windows) {
          LOG.assertTrue(window.getSelectedEditor() != null);
          window.closeFile(file,false,moveFocus);
          if (window.getTabCount() == 0 && nextFile != null) {
            EditorWithProviderComposite newComposite=newEditorComposite(nextFile);
            window.setEditor(newComposite,moveFocus);
          }
        }
        for (        final EditorWindow window : windows) {
          if (window.isDisposed()) {
            continue;
          }
          if (window.getTabCount() == 0) {
            window.unsplit(false);
          }
        }
      }
    }
  }
,closeAllCopies ? null : getActiveSplitters(true).getResult());
}
