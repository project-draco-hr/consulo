{
  List<Pair<VirtualFile,EditorWindow>> copy=new ArrayList<Pair<VirtualFile,EditorWindow>>();
  for (  Pair<VirtualFile,EditorWindow> pair : mySelectionHistory) {
    if (pair.second.getFiles().length == 0) {
      final EditorWindow[] windows=pair.second.getOwner().getWindows();
      if (windows.length > 0 && windows[0] != null && windows[0].getFiles().length > 0) {
        final Pair<VirtualFile,EditorWindow> p=Pair.create(pair.first,windows[0]);
        if (!copy.contains(p)) {
          copy.add(p);
        }
      }
    }
 else {
      if (!copy.contains(pair)) {
        copy.add(pair);
      }
    }
  }
  mySelectionHistory.clear();
  mySelectionHistory.addAll(copy);
  return mySelectionHistory;
}
