{
  FileEditorState state=null;
  if (entry != null) {
    state=entry.getState(provider);
  }
  if (state == null && newEditor) {
    state=myEditorHistoryManager.getState(file,provider);
  }
  if (state != null) {
    if (!isDumbAware(editor)) {
      final FileEditorState finalState=state;
      DumbService.getInstance(getProject()).runWhenSmart(new Runnable(){
        @Override public void run(){
          editor.setState(finalState);
        }
      }
);
    }
 else {
      editor.setState(state);
    }
  }
}
