{
  final CheckinEnvironment environment=vcs.getCheckinEnvironment();
  if (environment != null) {
    Collection<FilePath> paths=ChangesUtil.getPaths(items);
    myPathsToRefresh.addAll(paths);
    if (environment.keepChangeListAfterCommit(myChangeList)) {
      myKeepChangeListAfterCommit=true;
    }
    final Object addData=(myAdditionalData == null) ? null : myAdditionalData.get(vcs.getName());
    final List<VcsException> exceptions=environment.commit(items,myCommitMessage,addData);
    if (exceptions != null && exceptions.size() > 0) {
      myVcsExceptions.addAll(exceptions);
      myChangesFailedToCommit.addAll(items);
    }
  }
}
