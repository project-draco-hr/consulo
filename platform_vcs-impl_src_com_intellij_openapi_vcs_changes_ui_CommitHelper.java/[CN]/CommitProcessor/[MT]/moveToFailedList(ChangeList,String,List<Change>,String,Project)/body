{
  if (failedChanges.containsAll(changeList.getChanges()))   return;
  final VcsConfiguration configuration=VcsConfiguration.getInstance(project);
  if (configuration.MOVE_TO_FAILED_COMMIT_CHANGELIST != VcsShowConfirmationOption.Value.DO_ACTION_SILENTLY) {
    final VcsShowConfirmationOption option=new VcsShowConfirmationOption(){
      public Value getValue(){
        return configuration.MOVE_TO_FAILED_COMMIT_CHANGELIST;
      }
      public void setValue(      final Value value){
        configuration.MOVE_TO_FAILED_COMMIT_CHANGELIST=value;
      }
    }
;
    boolean result=ConfirmationDialog.requestForConfirmation(option,project,VcsBundle.message("commit.failed.confirm.prompt"),VcsBundle.message("commit.failed.confirm.title"),Messages.getQuestionIcon());
    if (!result)     return;
  }
  final ChangeListManager changeListManager=ChangeListManager.getInstance(project);
  int index=1;
  String failedListName=newChangelistName;
  while (changeListManager.findChangeList(failedListName) != null) {
    index++;
    failedListName=newChangelistName + " (" + index+ ")";
  }
  final LocalChangeList failedList=changeListManager.addChangeList(failedListName,commitMessage);
  changeListManager.moveChangesTo(failedList,failedChanges.toArray(new Change[failedChanges.size()]));
}
