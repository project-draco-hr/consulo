{
  Runnable runnableWithProgress=new Runnable(){
    public void run(){
      for (      final Module module : myModuleModel.myPathToModule.values()) {
        final Application app=ApplicationManager.getApplication();
        final Runnable swingRunnable=new Runnable(){
          public void run(){
            app.runWriteAction(new Runnable(){
              public void run(){
                ((ModuleImpl)module).moduleAdded();
                fireModuleAdded(module);
              }
            }
);
          }
        }
;
        if (app.isDispatchThread() || app.isHeadlessEnvironment()) {
          swingRunnable.run();
        }
 else {
          ProgressIndicator pi=ProgressManager.getInstance().getProgressIndicator();
          pi.setText("Loading " + module.getName());
          app.invokeAndWait(swingRunnable,pi.getModalityState());
        }
      }
    }
  }
;
  myProgressManager.runProcessWithProgressSynchronously(runnableWithProgress,"Loading modules",false,myProject);
  myModuleModel.projectOpened();
}
