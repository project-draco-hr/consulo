{
  if (editor.isViewer())   return;
  if (dataContext != null) {
    Project project=CommonDataKeys.PROJECT.getData(dataContext);
    if (project != null && !FileDocumentManager.getInstance().requestWriting(editor.getDocument(),project))     return;
  }
  ApplicationManager.getApplication().runWriteAction(new DocumentRunnable(editor.getDocument(),editor.getProject()){
    @Override public void run(){
      final Document doc=editor.getDocument();
      doc.startGuardedBlockChecking();
      try {
        executeWriteAction(editor,caret,dataContext);
      }
 catch (      ReadOnlyFragmentModificationException e) {
        EditorActionManager.getInstance().getReadonlyFragmentModificationHandler(doc).handle(e);
      }
 finally {
        doc.stopGuardedBlockChecking();
      }
    }
  }
);
}
