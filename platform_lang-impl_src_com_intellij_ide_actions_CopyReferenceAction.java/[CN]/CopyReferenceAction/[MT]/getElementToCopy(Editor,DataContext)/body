{
  PsiElement element=null;
  if (editor != null) {
    PsiReference reference=TargetElementUtilBase.findReference(editor);
    if (reference != null) {
      element=reference.getElement();
    }
  }
  if (element == null) {
    element=LangDataKeys.PSI_ELEMENT.getData(dataContext);
  }
  if (element == null && editor == null) {
    VirtualFile virtualFile=PlatformDataKeys.VIRTUAL_FILE.getData(dataContext);
    Project project=CommonDataKeys.PROJECT.getData(dataContext);
    if (virtualFile != null && project != null) {
      element=PsiManager.getInstance(project).findFile(virtualFile);
    }
  }
  if (element instanceof PsiFile && !((PsiFile)element).getViewProvider().isPhysical()) {
    return null;
  }
  for (  QualifiedNameProvider provider : Extensions.getExtensions(QualifiedNameProvider.EP_NAME)) {
    PsiElement adjustedElement=provider.adjustElementToCopy(element);
    if (adjustedElement != null)     return adjustedElement;
  }
  return element;
}
