{
  final VirtualFile[] sourceRoots=ProjectRootManager.getInstance(project).getContentSourceRoots();
  List<PsiDirectory> sourceRootDirectories=new ArrayList<PsiDirectory>();
  sourceRoots:   for (  final VirtualFile sourceRoot : sourceRoots) {
    PsiDirectory sourceRootDirectory=PsiManager.getInstance(project).findDirectory(sourceRoot);
    if (sourceRootDirectory == null)     continue;
    final PsiPackage aPackage=JavaDirectoryService.getInstance().getPackage(sourceRootDirectory);
    if (aPackage == null)     continue;
    final String packagePrefix=aPackage.getQualifiedName();
    for (    final PsiDirectory directory : directories) {
      String qualifiedName=JavaDirectoryService.getInstance().getPackage(directory).getQualifiedName();
      if (!qualifiedName.startsWith(packagePrefix)) {
        continue sourceRoots;
      }
    }
    sourceRootDirectories.add(sourceRootDirectory);
  }
  return sourceRootDirectories;
}
