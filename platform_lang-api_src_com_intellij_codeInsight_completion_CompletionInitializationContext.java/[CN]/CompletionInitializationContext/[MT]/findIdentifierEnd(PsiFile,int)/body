{
  try {
    final PsiReference reference=file.findReferenceAt(selectionEndOffset);
    if (reference != null) {
      return reference.getElement().getTextRange().getStartOffset() + reference.getRangeInElement().getEndOffset();
    }
  }
 catch (  IndexNotReadyException ignored) {
  }
  final String text=file.getText();
  int idEnd=selectionEndOffset;
  while (idEnd < text.length() && Character.isJavaIdentifierPart(text.charAt(idEnd))) {
    idEnd++;
  }
  return idEnd;
}
