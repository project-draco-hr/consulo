{
  myEditor=editor;
  myFile=file;
  myCompletionType=completionType;
  myOffsetMap=new OffsetMap(editor.getDocument());
  final int caretOffset=editor.getCaretModel().getOffset();
  final SelectionModel selectionModel=editor.getSelectionModel();
  myOffsetMap.addOffset(START_OFFSET,selectionModel.hasSelection() ? selectionModel.getSelectionStart() : caretOffset);
  final int selectionEndOffset=selectionModel.hasSelection() ? selectionModel.getSelectionEnd() : caretOffset;
  myOffsetMap.addOffset(SELECTION_END_OFFSET,selectionEndOffset);
  myOffsetMap.addOffset(IDENTIFIER_END_OFFSET,calcDefaultIdentifierEnd(editor,selectionEndOffset));
}
