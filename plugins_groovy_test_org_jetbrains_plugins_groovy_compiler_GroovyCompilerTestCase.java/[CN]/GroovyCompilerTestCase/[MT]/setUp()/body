{
  myMainOutput=new TempDirTestFixtureImpl();
  myMainOutput.setUp();
  super.setUp();
  getProject().getComponent(GroovyCompilerLoader.class).projectOpened();
  CompilerManagerImpl.testSetup();
  new WriteCommandAction(getProject()){
    @Override protected void run(    Result result) throws Throwable {
      CompilerProjectExtension.getInstance(getProject()).setCompilerOutputUrl(myMainOutput.findOrCreateDir("out").getUrl());
      if (useJps()) {
        ApplicationManagerEx.getApplicationEx().doNotSave(false);
        CompilerWorkspaceConfiguration.getInstance(getProject()).USE_COMPILE_SERVER=true;
        JavaAwareProjectJdkTableImpl jdkTable=JavaAwareProjectJdkTableImpl.getInstanceEx();
        Sdk internalJdk=jdkTable.getInternalJdk();
        jdkTable.addJdk(internalJdk);
        final ModifiableRootModel modifiableModel=ModuleRootManager.getInstance(myModule).getModifiableModel();
        modifiableModel.setSdk(internalJdk);
        modifiableModel.commit();
      }
    }
  }
.execute();
}
