{
  myMainOutput=new TempDirTestFixtureImpl();
  myMainOutput.setUp();
  super.setUp();
  getProject().getComponent(GroovyCompilerLoader.class).projectOpened();
  CompilerManagerImpl.testSetup();
  new WriteCommandAction(getProject()){
    @Override protected void run(    Result result) throws Throwable {
      CompilerProjectExtension.getInstance(getProject()).setCompilerOutputUrl(myMainOutput.findOrCreateDir("out").getUrl());
      if (useJps()) {
        CompilerTestUtil.enableExternalCompiler(getProject());
        ModuleRootModificationUtil.setModuleSdk(myModule,JavaAwareProjectJdkTableImpl.getInstanceEx().getInternalJdk());
      }
 else {
        CompilerTestUtil.disableExternalCompiler(getProject());
      }
    }
  }
.execute();
}
