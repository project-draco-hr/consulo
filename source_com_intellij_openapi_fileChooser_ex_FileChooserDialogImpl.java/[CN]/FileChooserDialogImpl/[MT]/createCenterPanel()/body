{
  JPanel panel=new MyPanel();
  myUiUpdater=new MergingUpdateQueue("FileChooserUpdater",200,false,panel);
  Disposer.register(myDisposable,myUiUpdater);
  new UiNotifyConnector(panel,myUiUpdater);
  myFileLocator.start();
  Disposer.register(myDisposable,new Disposable(){
    public void dispose(){
      myFileLocator.dispose(true);
    }
  }
);
  panel.setBorder(BorderFactory.createEmptyBorder(0,0,0,0));
  createTree();
  final DefaultActionGroup group=createActionGroup();
  ActionToolbar toolBar=ActionManager.getInstance().createActionToolbar(ActionPlaces.UNKNOWN,group,true);
  final JPanel toolbarPanel=new JPanel(new BorderLayout());
  toolbarPanel.add(toolBar.getComponent(),BorderLayout.CENTER);
  myTextFieldAction=new TextFieldAction();
  toolbarPanel.add(myTextFieldAction,BorderLayout.EAST);
  myPathTextFieldWrapper=new JPanel(new BorderLayout());
  myPathTextFieldWrapper.setBorder(new EmptyBorder(0,0,2,0));
  myPathTextField=new FileTextField.Vfs(myChooserDescriptor,myFileSystemTree.areHiddensShown(),myUiUpdater,myFileLocator){
    protected void onTextChanged(    final String newValue){
      updateTreeFromPath(newValue);
    }
  }
;
  myPathTextFieldWrapper.add(myPathTextField.getField(),BorderLayout.CENTER);
  myNorthPanel=new JPanel(new BorderLayout());
  myNorthPanel.add(toolbarPanel,BorderLayout.NORTH);
  updateTextFieldShowing();
  panel.add(myNorthPanel,BorderLayout.NORTH);
  registerMouseListener(group);
  JScrollPane scrollPane=new JScrollPane(myFileSystemTree.getTree());
  scrollPane.setBorder(BorderFactory.createLineBorder(new Color(148,154,156)));
  panel.add(scrollPane,BorderLayout.CENTER);
  panel.setPreferredSize(new Dimension(400,400));
  return panel;
}
