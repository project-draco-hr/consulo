{
  if (!ourTextFieldShown)   return false;
  final KeyStroke stroke=KeyStroke.getKeyStroke(e.getKeyCode(),e.getModifiers());
  final Object action=((InputMap)UIManager.get("ComboBox.ancestorInputMap")).get(stroke);
  if ("selectNext".equals(action)) {
    if (!isPopupShowing()) {
      suggestCompletion();
    }
    return true;
  }
 else   if ("selectPrevious".equals(action)) {
    if (isPopupShowing()) {
      closePopup();
    }
    return true;
  }
 else   if ("togglePopup".equals(action)) {
    if (isPopupShowing()) {
      closePopup();
    }
 else {
      suggestCompletion();
    }
    return true;
  }
 else {
    if (!isPopupShowing()) {
      final Keymap active=KeymapManager.getInstance().getActiveKeymap();
      final String[] ids=active.getActionIds(stroke);
      if (ids.length > 0 && "CodeCompletion".equals(ids[0])) {
        suggestCompletion();
      }
    }
  }
  return false;
}
