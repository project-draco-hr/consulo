{
  if (!exists()) {
    throw new IOException("File to move does not exist: " + getPath());
  }
  if (!newParent.exists()) {
    throw new IOException("Destination folder does not exist: " + newParent.getPath());
  }
  if (!newParent.isDirectory()) {
    throw new IOException("Destination is not a folder: " + newParent.getPath());
  }
  final VirtualFile child=newParent.findChild(getName());
  if (child != null) {
    throw new IOException("Destination already exists: " + newParent.getPath() + "/"+ getName());
  }
  Charset charsetBefore=EncodingManager.getInstance().getEncoding(this,true);
  getFileSystem().moveFile(requestor,this,newParent);
  EncodingManager.getInstance().restoreEncoding(this,charsetBefore);
}
