{
  final Pair<String,Boolean> inspectionProfilePair=HighlightingSettingsPerFile.getInstance(psiElement.getProject()).getInspectionProfile(psiElement);
  if (inspectionProfilePair != null && inspectionProfilePair.second) {
    Profile inspectionProfile=InspectionProjectProfileManager.getInstance(myProject).getProfile(inspectionProfilePair.first);
    if (inspectionProfile != null) {
      return (InspectionProfileImpl)inspectionProfile;
    }
  }
  final PsiFile psiFile=psiElement.getContainingFile();
  LOG.assertTrue(psiFile != null);
  final String profile=super.getProfile(psiFile);
  if (profile != null)   return (InspectionProfileImpl)getProfile(profile);
  return (InspectionProfileImpl)myApplicationProfileManager.getRootProfile();
}
