{
  TextWithImports text=getText();
  myContext=context;
  List<CodeFragmentFactory> factories=getAllFactories();
  if (myInitialFactory || !factories.contains(myFactory)) {
    setFactory(factories.get(0));
  }
  myChooseFactory.setVisible(factories.size() > 1);
  myInitialFactory=false;
  setText(new TextWithImportsImpl(text.getKind(),text.getText(),text.getImports(),myFactory.getFileType()));
}
