{
  String propertyName=event.getPropertyName();
  PsiElement element=event.getElement();
  DefaultMutableTreeNode rootNode=getRootNode();
  AbstractTreeUpdater updater=getUpdater();
  if (propertyName.equals(PsiTreeChangeEvent.PROP_ROOTS)) {
    updater.addSubtreeToUpdate(rootNode);
  }
 else   if (propertyName.equals(PsiTreeChangeEvent.PROP_WRITABLE)) {
    if (!updater.addSubtreeToUpdateByElement(element) && element instanceof PsiFile && ((PsiFile)element).getFileType() == StdFileTypes.JAVA) {
      updater.addSubtreeToUpdateByElement(((PsiFile)element).getContainingDirectory());
    }
  }
 else   if (propertyName.equals(PsiTreeChangeEvent.PROP_FILE_NAME) || propertyName.equals(PsiTreeChangeEvent.PROP_DIRECTORY_NAME)) {
    if (element instanceof PsiDirectory && isFlattenPackages()) {
      updater.addSubtreeToUpdate(rootNode);
      return;
    }
    updater.addSubtreeToUpdateByElement(element);
  }
 else   if (propertyName.equals(PsiTreeChangeEvent.PROP_FILE_TYPES)) {
    updater.addSubtreeToUpdate(rootNode);
  }
}
