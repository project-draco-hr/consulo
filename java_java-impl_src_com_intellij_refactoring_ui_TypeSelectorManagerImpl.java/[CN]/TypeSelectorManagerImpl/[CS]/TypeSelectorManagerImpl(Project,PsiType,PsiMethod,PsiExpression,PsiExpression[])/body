{
  myFactory=JavaPsiFacade.getInstance(project).getElementFactory();
  mySmartTypePointerManager=SmartTypePointerManager.getInstance(project);
  setDefaultType(type);
  myMainOccurence=mainOccurence;
  myOccurrences=occurrences;
  myExpectedTypesProvider=ExpectedTypesProvider.getInstance(project);
  myOccurrenceClassProvider=createOccurrenceClassProvider();
  myTypesForMain=getTypesForMain();
  myTypesForAll=getTypesForAll(true);
  if (containingMethod != null) {
    if (PsiUtil.resolveClassInType(type) != null) {
      setDefaultType(checkIfTypeAccessible(type,project,containingMethod));
    }
  }
  myIsOneSuggestion=myTypesForMain.length == 1 && myTypesForAll.length == 1 && myTypesForAll[0].equals(myTypesForMain[0]);
  if (myIsOneSuggestion) {
    myTypeSelector=new TypeSelector(myTypesForAll[0]);
  }
 else {
    myTypeSelector=new TypeSelector();
  }
}
