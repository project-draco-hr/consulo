{
  String name=libraryElement.getAttributeValue("name");
  String typeId=libraryElement.getAttributeValue("type");
  JpsLibrary library=JpsElementFactory.getInstance().createLibrary(name,getLibraryType(typeId));
  MultiMap<JpsOrderRootType,String> jarDirectories=new MultiMap<JpsOrderRootType,String>();
  MultiMap<JpsOrderRootType,String> recursiveJarDirectories=new MultiMap<JpsOrderRootType,String>();
  for (  Element jarDirectory : JDOMUtil.getChildren(libraryElement,"jarDirectory")) {
    String url=jarDirectory.getAttributeValue("url");
    String rootType=jarDirectory.getAttributeValue("type");
    boolean recursive=Boolean.parseBoolean(jarDirectory.getAttributeValue("recursive"));
    jarDirectories.putValue(getRootType(rootType),url);
    if (recursive) {
      recursiveJarDirectories.putValue(getRootType(rootType),url);
    }
  }
  for (  Element rootsElement : JDOMUtil.getChildren(libraryElement)) {
    final String rootTypeId=rootsElement.getName();
    if (!rootTypeId.equals("jarDirectory")) {
      final JpsOrderRootType rootType=getRootType(rootTypeId);
      for (      Element rootElement : JDOMUtil.getChildren(rootsElement,"root")) {
        String url=rootElement.getAttributeValue("url");
        final boolean jarDirectory=jarDirectories.get(rootType).contains(url);
        final boolean recursive=recursiveJarDirectories.get(rootType).contains(url);
        library.addUrl(url,new JpsLibraryRootType(rootType,jarDirectory,recursive));
      }
    }
  }
  return library;
}
