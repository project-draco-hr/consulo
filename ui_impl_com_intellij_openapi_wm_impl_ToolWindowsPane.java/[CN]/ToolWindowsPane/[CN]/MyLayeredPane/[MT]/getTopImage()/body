{
  LOG.assertTrue(UISettings.getInstance().ANIMATE_WINDOWS);
  BufferedImage image=(BufferedImage)myTopImageRef.get();
  if (image == null || image.getWidth(null) < getWidth() || image.getHeight(null) < getHeight()) {
    final int width=Math.max(Math.max(1,getWidth()),myFrame.getWidth());
    final int height=Math.max(Math.max(1,getHeight()),myFrame.getHeight());
    if (SystemInfo.isWindows || SystemInfo.isMac) {
      image=myFrame.getGraphicsConfiguration().createCompatibleImage(width,height);
    }
 else {
      image=new BufferedImage(width,height,BufferedImage.TYPE_INT_RGB);
    }
    myTopImageRef=new SoftReference(image);
  }
  return image;
}
