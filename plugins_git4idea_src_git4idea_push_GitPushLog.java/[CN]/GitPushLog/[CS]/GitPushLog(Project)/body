{
  myProject=project;
  for (  GitRepository repository : GitRepositoryManager.getInstance(project).getRepositories()) {
    mySelectedRepositories.put(repository,true);
  }
  myRootNode=new DefaultMutableTreeNode();
  myTreeModel=new DefaultTreeModel(myRootNode);
  myTree=new Tree(myTreeModel);
  myTree.setRootVisible(false);
  myTree.setCellRenderer(new MyTreeCellRenderer());
  TreeUtil.expandAll(myTree);
  myTree.getSelectionModel().setSelectionMode(TreeSelectionModel.SINGLE_TREE_SELECTION);
  myTree.addTreeSelectionListener(new TreeSelectionListener(){
    @Override public void valueChanged(    TreeSelectionEvent e){
      DefaultMutableTreeNode node=(DefaultMutableTreeNode)myTree.getLastSelectedPathComponent();
      if (node != null) {
        Object nodeInfo=node.getUserObject();
        if (nodeInfo instanceof GitCommit) {
          myChangesBrowser.setChangesToDisplay(((GitCommit)nodeInfo).getChanges());
          return;
        }
      }
      myChangesBrowser.setChangesToDisplay(Collections.<Change>emptyList());
    }
  }
);
  myChangesBrowser=new ChangesBrowser(myProject,null,Collections.<Change>emptyList(),null,false,true,null,ChangesBrowser.MyUseCase.LOCAL_CHANGES,null);
  myChangesBrowser.getDiffAction().registerCustomShortcutSet(CommonShortcuts.getDiff(),myTree);
  Splitter splitter=new Splitter(false,0.7f);
  splitter.setFirstComponent(ScrollPaneFactory.createScrollPane(myTree));
  splitter.setSecondComponent(myChangesBrowser);
  setLayout(new BorderLayout());
  add(splitter);
}
