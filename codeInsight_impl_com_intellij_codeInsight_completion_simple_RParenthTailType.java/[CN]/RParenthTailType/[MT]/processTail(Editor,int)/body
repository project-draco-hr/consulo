{
  CodeStyleSettings styleSettings=CodeStyleSettingsManager.getSettings(editor.getProject());
  int existingRParenthOffset=getExistingRParenthOffset(editor,tailOffset);
  boolean spaceWithinParens=isSpaceWithinParentheses(styleSettings,editor,tailOffset);
  if (existingRParenthOffset < 0) {
    if (spaceWithinParens) {
      tailOffset=insertChar(editor,tailOffset,' ');
    }
    editor.getDocument().insertString(tailOffset,")");
    return moveCaret(editor,tailOffset,1);
  }
  if (spaceWithinParens && tailOffset == existingRParenthOffset) {
    insertChar(editor,tailOffset,' ');
  }
  return moveCaret(editor,existingRParenthOffset,1);
}
