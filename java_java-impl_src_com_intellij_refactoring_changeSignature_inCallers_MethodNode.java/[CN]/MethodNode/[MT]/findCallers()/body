{
  if (myMethod == null)   return PsiMethod.EMPTY_ARRAY;
  final Project project=myMethod.getProject();
  final List<PsiMethod> callers=new ArrayList<PsiMethod>();
  if (!ProgressManager.getInstance().runProcessWithProgressSynchronously(new Runnable(){
    public void run(){
      final PsiReference[] refs=MethodReferencesSearch.search(myMethod,GlobalSearchScope.allScope(project),true).toArray(PsiReference.EMPTY_ARRAY);
      for (      PsiReference ref : refs) {
        final PsiElement element=ref.getElement();
        if (!(element instanceof PsiReferenceExpression) || !(((PsiReferenceExpression)element).getQualifierExpression() instanceof PsiSuperExpression)) {
          final PsiElement enclosingContext=PsiTreeUtil.getParentOfType(element,PsiMethod.class,PsiClass.class);
          if (enclosingContext instanceof PsiMethod && !myMethod.equals(enclosingContext) && !myCalled.contains(myMethod)) {
            callers.add((PsiMethod)enclosingContext);
          }
 else           if (element instanceof PsiClass) {
            final PsiClass aClass=(PsiClass)element;
            callers.add(JavaPsiFacade.getElementFactory(project).createMethodFromText(aClass.getName() + "(){}",aClass));
          }
        }
      }
    }
  }
,RefactoringBundle.message("caller.chooser.looking.for.callers"),true,project)) {
    myCancelCallback.run();
    return PsiMethod.EMPTY_ARRAY;
  }
  return callers.toArray(new PsiMethod[callers.size()]);
}
