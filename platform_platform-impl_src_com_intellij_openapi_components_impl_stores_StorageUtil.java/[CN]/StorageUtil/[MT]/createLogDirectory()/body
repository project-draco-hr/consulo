{
  UniqueFileNamesProvider namesProvider=new UniqueFileNamesProvider();
  File statesDir=new File(PathManager.getSystemPath(),"log/componentStates");
  File[] children=statesDir.listFiles();
  if (children != null) {
    if (children.length > 10) {
      File childToDelete=null;
      for (      File child : children) {
        if (childToDelete == null || childToDelete.lastModified() > child.lastModified()) {
          childToDelete=child;
        }
      }
      if (childToDelete != null) {
        FileUtil.delete(childToDelete);
      }
    }
    for (    File child : children) {
      namesProvider.reserveFileName(child.getName());
    }
  }
  String name="state-" + LOG_DIR_FORMAT.format(new Date()) + "-"+ ApplicationInfo.getInstance().getBuild().asString();
  return new File(statesDir,namesProvider.suggestName(name));
}
