{
  try {
    VirtualFile vFile=LocalFileSystem.getInstance().findFileByIoFile(file);
    Pair<String,String> pair=loadFile(vFile);
    String text=JDOMUtil.writeParent(element,pair.second);
    if (file.exists()) {
      if (text.equals(pair.first)) {
        return null;
      }
    }
 else {
      file.createParentDirs();
    }
    AccessToken token=ApplicationManager.getApplication().acquireWriteActionLock(DocumentRunnable.IgnoreDocumentRunnable.class);
    try {
      VirtualFile virtualFile=getOrCreateVirtualFile(requestor,file);
      byte[] bytes=text.getBytes(CharsetToolkit.UTF8);
      virtualFile.setBinaryContent(bytes,-1,-1,requestor);
      return virtualFile;
    }
  finally {
      token.finish();
    }
  }
 catch (  IOException e) {
    throw new StateStorageException(e);
  }
}
