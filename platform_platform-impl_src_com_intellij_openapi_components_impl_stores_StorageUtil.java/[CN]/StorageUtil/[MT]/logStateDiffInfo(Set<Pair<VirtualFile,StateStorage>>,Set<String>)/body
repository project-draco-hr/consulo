{
  if (componentNames.isEmpty() || !(DUMP_COMPONENT_STATES || ApplicationManager.getApplication().isInternal())) {
    return;
  }
  try {
    File logDirectory=createLogDirectory();
    if (!logDirectory.mkdirs()) {
      throw new IOException("Cannot create " + logDirectory);
    }
    for (    Pair<VirtualFile,StateStorage> pair : changedFiles) {
      File file=new File(pair.first.getPath());
      StateStorage storage=pair.second;
      if (storage instanceof XmlElementStorage) {
        Element state=((XmlElementStorage)storage).logComponents();
        if (state != null) {
          JDOMUtil.writeParent(state,new File(logDirectory,"prev_" + file.getName()),"\n");
        }
      }
      if (file.exists()) {
        File logFile=new File(logDirectory,"new_" + file.getName());
        FileUtil.copy(file,logFile);
      }
    }
    File logFile=new File(logDirectory,"components.txt");
    FileUtil.writeToFile(logFile,componentNames.toString() + "\n");
  }
 catch (  Throwable e) {
    LOG.info(e);
  }
}
