{
  VirtualFile file=event.getFile();
  final int[] list=file.getUserData(FILES_TO_RELEASE_KEY);
  if (list == null)   return;
  IndexState copy=null;
  for (  int id : list) {
    if (myState.getInfo(id) != null) {
      if (copy == null)       copy=myState.copy(new TIntProcedure(){
        @Override public boolean execute(        int fid){
          return ArrayUtil.indexOf(list,fid) == -1;
        }
      }
);
      copy.myDirToInfoMap.remove(id);
      copy.setPackageName(id,null);
    }
  }
  if (copy != null) {
    myState=copy;
  }
  myState.assertAncestorsConsistent();
}
