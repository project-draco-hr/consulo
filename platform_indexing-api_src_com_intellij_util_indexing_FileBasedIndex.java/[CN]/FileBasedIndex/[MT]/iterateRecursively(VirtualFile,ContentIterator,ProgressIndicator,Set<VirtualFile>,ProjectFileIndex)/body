{
  if (root == null) {
    return;
  }
  VfsUtilCore.visitChildrenRecursively(root,new VirtualFileVisitor(){
    @Override public boolean visitFile(    @NotNull VirtualFile file){
      if (visitedRoots != null && !root.equals(file) && file.isDirectory() && !visitedRoots.add(file)) {
        return false;
      }
      if (projectFileIndex != null && projectFileIndex.isExcluded(file)) {
        return false;
      }
      if (indicator != null)       indicator.checkCanceled();
      processor.processFile(file);
      return true;
    }
  }
);
}
