{
  if (selection.size() != 1) {
    return;
  }
  AbstractComboBoxAction<Pair<Boolean,Gravity>> action=new AbstractComboBoxAction<Pair<Boolean,Gravity>>(){
    private Pair<Gravity,Gravity> myGravity;
    @Override protected boolean addSeparator(    DefaultActionGroup actionGroup,    Pair<Boolean,Gravity> item){
      if (item == null) {
        actionGroup.addSeparator();
        return true;
      }
      return false;
    }
    @NotNull @Override protected DefaultActionGroup createPopupActionGroup(    JComponent button){
      myGravity=gravity(selection.get(0));
      return super.createPopupActionGroup(button);
    }
    @Override protected void update(    Pair<Boolean,Gravity> item,    Presentation presentation,    boolean popup){
      if (popup) {
        Gravity selection=item.first ? myGravity.first : myGravity.second;
        presentation.setIcon(selection == item.second ? CHECKED : null);
        presentation.setText(item.second.name());
      }
    }
    @Override protected boolean selectionChanged(    Pair<Boolean,Gravity> item){
      Gravity oldSelection=item.first ? myGravity.first : myGravity.second;
      if (oldSelection != item.second) {
        final String gravity=item.first ? Gravity.getValue(item.second,myGravity.second) : Gravity.getValue(myGravity.first,item.second);
        designer.getToolProvider().execute(new ThrowableRunnable<Exception>(){
          @Override public void run() throws Exception {
            ApplicationManager.getApplication().runWriteAction(new Runnable(){
              @Override public void run(){
                ((RadViewComponent)selection.get(0)).getTag().setAttribute("android:layout_gravity",gravity);
              }
            }
);
          }
        }
,"Change attribute 'gravity'",true);
      }
      return false;
    }
    @Override public void setSelection(    Pair<Boolean,Gravity> selection){
    }
  }
;
  Presentation presentation=action.getTemplatePresentation();
  presentation.setDescription("Gravity");
  presentation.setIcon(IconLoader.getIcon("/com/intellij/android/designer/icons/gravity.png"));
  action.setItems(ITEMS,null);
  actionGroup.add(action);
}
