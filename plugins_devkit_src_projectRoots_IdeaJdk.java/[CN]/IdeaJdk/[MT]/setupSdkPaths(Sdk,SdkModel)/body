{
  final Sandbox additionalData=(Sandbox)sdk.getSdkAdditionalData();
  if (additionalData != null) {
    additionalData.cleanupWatchedRoots();
  }
  final SdkModificator sdkModificator=sdk.getSdkModificator();
  final List<String> javaSdks=new ArrayList<String>();
  final Sdk[] sdks=sdkModel.getSdks();
  for (  Sdk jdk : sdks) {
    if (jdk.getSdkType() instanceof JavaSdk) {
      javaSdks.add(jdk.getName());
    }
  }
  if (javaSdks.isEmpty()) {
    Messages.showErrorDialog("Please, configure Java SDK to be used as IDEA internal platform","No Java SDK found");
    return false;
  }
  final int choice=Messages.showChooseDialog("Select Java SDK to be used as IDEA internal platform","Select internal Java platform",javaSdks.toArray(new String[javaSdks.size()]),javaSdks.get(0),Messages.getQuestionIcon());
  if (choice != -1) {
    final String name=javaSdks.get(choice);
    final Sdk jdk=sdkModel.findSdk(name);
    LOG.assertTrue(jdk != null);
    setupSdkPaths(sdkModificator,sdk.getHomePath(),jdk);
    sdkModificator.setSdkAdditionalData(new Sandbox(getDefaultSandbox(),jdk));
    sdkModificator.setVersionString(jdk.getVersionString());
    sdkModificator.commitChanges();
    return true;
  }
  return false;
}
