{
  if (myInternalJdk == null) {
    String toolsPath=null;
    String jreHome;
    if (SystemInfo.isLinux || SystemInfo.isWindows) {
      jreHome=sdkHome + File.separator + "jre";
      if (!new File(jreHome).exists()) {
        jreHome=System.getProperty("java.home");
        final File tools=new File(new File(jreHome,"lib"),"tools.jar");
        if (tools.exists()) {
          toolsPath=tools.getPath();
          jreHome=jreHome + File.separator + "jre";
        }
 else {
          toolsPath=new File(jreHome).getParent() + File.separator + "lib"+ File.separator+ "tools.jar";
        }
      }
    }
 else {
      jreHome=System.getProperty("java.home");
    }
    myInternalJdk=JavaSdk.getInstance().createJdk("",jreHome);
    toolsPath=toolsPath != null ? toolsPath : myInternalJdk.getToolsPath();
    final VirtualFile tools=LocalFileSystem.getInstance().findFileByPath(toolsPath.replace(File.separatorChar,'/'));
    if (tools != null) {
      final SdkModificator sdkModificator=myInternalJdk.getSdkModificator();
      sdkModificator.addRoot(tools,ProjectRootType.CLASS);
      sdkModificator.commitChanges();
    }
  }
  return myInternalJdk;
}
