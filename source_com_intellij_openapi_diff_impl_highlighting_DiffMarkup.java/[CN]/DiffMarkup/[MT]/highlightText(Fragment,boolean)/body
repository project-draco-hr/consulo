{
  TextDiffType type=fragment.getType();
  if (type == null)   return;
  TextRange range=fragment.getRange(getSide());
  TextAttributes attributes=type.getTextAttributes(getEditor());
  RangeHighlighter rangeMarker;
  if (!drawBorder && range.getLength() == 0)   return;
  if (drawBorder && range.getLength() == 0) {
    rangeMarker=getMarkupModel().addRangeHighlighter(range.getStartOffset(),range.getStartOffset(),LAYER,new TextAttributes(null,null,attributes.getBackgroundColor(),EffectType.BOXED,0),HighlighterTargetArea.EXACT_RANGE);
  }
 else {
    rangeMarker=getMarkupModel().addRangeHighlighter(range.getStartOffset(),range.getEndOffset(),LAYER,attributes,HighlighterTargetArea.EXACT_RANGE);
  }
  Color stripeBarColor=attributes.getErrorStripeColor();
  if (stripeBarColor != null)   rangeMarker.setErrorStripeMarkColor(stripeBarColor);
  saveHighlighter(rangeMarker);
}
