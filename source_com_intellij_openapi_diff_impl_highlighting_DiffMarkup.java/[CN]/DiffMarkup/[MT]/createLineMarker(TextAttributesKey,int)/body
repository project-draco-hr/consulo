{
  RangeHighlighter marker;
  Color color=getLineSeparatorColorForType(type);
  RangeHighlighter lastHighlighter=getLastHighlighter();
  if (lastHighlighter != null && lastHighlighter.getTargetArea() == HighlighterTargetArea.LINES_IN_RANGE && SeparatorPlacement.BOTTOM == lastHighlighter.getLineSeparatorPlacement()) {
    int lastLine=getDocument().getLineNumber(lastHighlighter.getStartOffset());
    LOG.assertTrue(lastLine <= line);
    if (lastLine == line) {
      Color lastLineColor=lastHighlighter.getLineSeparatorColor();
      if (color == Color.GRAY || lastLineColor != Color.GRAY) {
        return null;
      }
 else {
        removeHighlighter(lastHighlighter);
      }
    }
  }
  marker=getMarkupModel().addLineHighlighter(line,LAYER,null);
  marker.setLineSeparatorColor(color);
  marker.setLineSeparatorPlacement(SeparatorPlacement.BOTTOM);
  if (type == DiffColors.DIFF_DELETED)   marker.setErrorStripeMarkColor(color);
  return marker;
}
