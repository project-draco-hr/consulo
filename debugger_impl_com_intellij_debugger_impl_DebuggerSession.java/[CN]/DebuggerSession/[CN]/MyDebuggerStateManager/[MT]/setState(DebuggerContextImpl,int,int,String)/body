{
  ApplicationManager.getApplication().assertIsDispatchThread();
  LOG.assertTrue(context.getDebuggerSession() == DebuggerSession.this || context.getDebuggerSession() == null);
  final Runnable setStateRunnable=new Runnable(){
    public void run(){
      LOG.assertTrue(myDebuggerContext.isInitialised());
      myDebuggerContext=context;
      if (LOG.isDebugEnabled()) {
        LOG.debug("DebuggerSession state = " + state + ", event = "+ event);
      }
      myIsEvaluating=false;
      myState=new DebuggerSessionState(state,description);
      fireStateChanged(context,event);
    }
  }
;
  if (context.getSuspendContext() == null) {
    setStateRunnable.run();
  }
 else {
    getProcess().getManagerThread().invokeLater(new SuspendContextCommandImpl(context.getSuspendContext()){
      public void contextAction() throws Exception {
        context.initCaches();
        DebuggerInvocationUtil.invokeLater(getProject(),setStateRunnable);
      }
    }
);
  }
}
