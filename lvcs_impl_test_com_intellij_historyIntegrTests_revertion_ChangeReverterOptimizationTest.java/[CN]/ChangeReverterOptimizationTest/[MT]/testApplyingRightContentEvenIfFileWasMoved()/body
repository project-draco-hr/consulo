{
  VirtualFile dir=root.createChildDirectory(null,"dir");
  VirtualFile f=root.createChildData(null,"f.java");
  f.setBinaryContent(new byte[]{1});
  f.setBinaryContent(new byte[]{2});
  f.move(null,dir);
  f.setBinaryContent(new byte[]{3});
  LoggingVirtualFileAdapter a=new LoggingVirtualFileAdapter();
  addFileListenerDuring(a,new RunnableAdapter(){
    @Override public void doRun() throws IOException {
      revertChange(root,2);
    }
  }
);
  assertEquals("fileMoved contentChanged ",a.getLog());
  assertEquals(1,f.contentsToByteArray()[0]);
}
