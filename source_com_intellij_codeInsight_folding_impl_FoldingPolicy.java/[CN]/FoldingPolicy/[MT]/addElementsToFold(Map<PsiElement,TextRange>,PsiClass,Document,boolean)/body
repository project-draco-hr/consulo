{
  if (!(aClass.getParent() instanceof PsiJavaFile) || ((PsiJavaFile)aClass.getParent()).getClasses().length > 1) {
    addToFold(map,aClass,document,true);
  }
  PsiDocComment docComment;
  if (foldJavaDocs) {
    docComment=aClass.getDocComment();
    if (docComment != null) {
      addToFold(map,docComment,document,true);
    }
  }
  PsiElement[] children=aClass.getChildren();
  for (int j=0; j < children.length; j++) {
    ProgressManager.getInstance().checkCanceled();
    PsiElement child=children[j];
    if (child instanceof PsiMethod) {
      PsiMethod method=(PsiMethod)child;
      addToFold(map,method,document,true);
      if (!CodeGenerator.SETUP_METHOD_NAME.equals(method.getName())) {
        if (foldJavaDocs) {
          docComment=method.getDocComment();
          if (docComment != null) {
            addToFold(map,docComment,document,true);
          }
        }
        PsiCodeBlock body=method.getBody();
        if (body != null) {
          findClasses(body,map,document);
        }
      }
    }
 else     if (child instanceof PsiField) {
      PsiField field=(PsiField)child;
      if (foldJavaDocs) {
        docComment=field.getDocComment();
        if (docComment != null) {
          addToFold(map,docComment,document,true);
        }
      }
      PsiExpression initializer=field.getInitializer();
      if (initializer != null) {
        findClasses(initializer,map,document);
      }
    }
 else     if (child instanceof PsiClassInitializer) {
      PsiClassInitializer initializer=(PsiClassInitializer)child;
      addToFold(map,initializer,document,true);
      findClasses(initializer,map,document);
    }
 else     if (child instanceof PsiClass) {
      addElementsToFold(map,(PsiClass)child,document,true);
    }
  }
}
