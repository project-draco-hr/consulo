{
  final Presentation presentation=e.getPresentation();
  final boolean enabled;
  final DataContext dataContext=e.getDataContext();
  if (CommonDataKeys.PROJECT.getData(dataContext) == null) {
    enabled=false;
  }
 else {
    final AbstractTestProxy test=AbstractTestProxy.DATA_KEY.getData(dataContext);
    if (test != null) {
      if (test.isLeaf()) {
        enabled=test.getDiffViewerProvider() != null;
      }
 else       if (test.isDefect()) {
        enabled=true;
      }
 else {
        enabled=false;
      }
    }
 else {
      enabled=false;
    }
  }
  presentation.setEnabled(enabled);
  presentation.setVisible(enabled);
}
