{
  final DataContext dataContext=e.getDataContext();
  final Project project=(Project)dataContext.getData(DataConstantsEx.PROJECT);
  Module[] allModules=ModuleManager.getInstance(project).getModules();
  Set<String> topLevelGroupNames=new HashSet<String>();
  for (int i=0; i < allModules.length; i++) {
    final Module child=allModules[i];
    String[] group=ModuleManager.getInstance(project).getModuleGroupPath(child);
    if (group != null) {
      topLevelGroupNames.add(group[0]);
    }
  }
  List<AnAction> result=new ArrayList<AnAction>();
  result.add(new MoveModulesOutsideGroupAction());
  result.add(new MoveModulesToSubGroupAction(null));
  result.add(Separator.getInstance());
  for (Iterator iterator=topLevelGroupNames.iterator(); iterator.hasNext(); ) {
    String name=(String)iterator.next();
    result.add(new MoveModuleToGroup(new ModuleGroup(new String[]{name})));
  }
  return result.toArray(new AnAction[result.size()]);
}
