{
  final VirtualFile virtualFile=handler.getFile().getVirtualFile();
  if (virtualFile != null && !virtualFile.isWritable()) {
    throw new ReadOnlyDeploymentDescriptorModificationException(virtualFile);
  }
  final Type type=myClassGetter.fun(args);
  final DomElement domElement=handler.addChild(myTagName,type,myIndexGetter.fun(args));
  final boolean b=handler.getManager().setChanging(true);
  try {
    ClassChooserManager.getClassChooser(myType).distinguishTag(domElement.getXmlTag(),DomUtil.getRawType(type));
  }
  finally {
    handler.getManager().setChanging(b);
  }
  return domElement;
}
