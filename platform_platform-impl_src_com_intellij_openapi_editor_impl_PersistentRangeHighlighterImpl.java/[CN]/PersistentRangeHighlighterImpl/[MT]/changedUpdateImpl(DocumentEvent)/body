{
  DocumentEventImpl event=(DocumentEventImpl)e;
  if (PersistentRangeMarkerUtil.shouldTranslateViaDiff(event,this)) {
    setLine(event.translateLineViaDiff(getLine()));
    if (getLine() < 0 || getLine() >= getDocument().getLineCount()) {
      invalidate(e);
    }
 else {
      DocumentEx document=getDocument();
      setIntervalStart(document.getLineStartOffset(getLine()));
      setIntervalEnd(document.getLineEndOffset(getLine()));
    }
  }
 else {
    super.changedUpdateImpl(e);
    if (isValid()) {
      setLine(getDocument().getLineNumber(getStartOffset()));
      int endLine=getDocument().getLineNumber(getEndOffset());
      if (endLine != getLine()) {
        setIntervalEnd(getDocument().getLineEndOffset(getLine()));
      }
    }
  }
}
