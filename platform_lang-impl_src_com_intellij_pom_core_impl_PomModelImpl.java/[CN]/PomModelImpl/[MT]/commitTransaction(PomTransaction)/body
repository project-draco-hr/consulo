{
  final ProgressIndicator progressIndicator=ProgressManager.getInstance().getProgressIndicator();
  final PsiDocumentManagerImpl manager=(PsiDocumentManagerImpl)PsiDocumentManager.getInstance(myProject);
  final PsiToDocumentSynchronizer synchronizer=manager.getSynchronizer();
  final PsiFile containingFileByTree=getContainingFileByTree(transaction.getChangeScope());
  Document document=containingFileByTree != null ? manager.getCachedDocument(containingFileByTree) : null;
  if (document != null) {
    final int oldLength=containingFileByTree.getTextLength();
    boolean success=synchronizer.commitTransaction(document);
    if (success) {
      BlockSupportImpl.sendAfterChildrenChangedEvent((PsiManagerImpl)PsiManager.getInstance(myProject),(PsiFileImpl)containingFileByTree,oldLength);
    }
  }
  if (progressIndicator != null)   progressIndicator.finishNonCancelableSection();
}
