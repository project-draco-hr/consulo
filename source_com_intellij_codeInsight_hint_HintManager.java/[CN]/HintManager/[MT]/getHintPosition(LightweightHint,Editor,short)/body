{
  LogicalPosition pos=editor.getCaretModel().getLogicalPosition();
  Project project=editor.getProject();
  Lookup lookup=project == null ? null : LookupManager.getInstance(project).getActiveLookup();
  if (lookup == null) {
    return getHintPosition(hint,editor,pos,constraint);
  }
 else {
    Rectangle cellBounds=lookup.getCurrentItemBounds();
    if (cellBounds == null) {
      return getHintPosition(hint,editor,pos,constraint);
    }
    Rectangle lookupBounds=lookup.getBounds();
    Dimension hintSize=hint.getComponent().getPreferredSize();
    JComponent editorComponent=editor.getComponent();
    JLayeredPane layeredPane=editorComponent.getRootPane().getLayeredPane();
    int layeredPaneHeight=layeredPane.getHeight();
switch (constraint) {
case LEFT:
{
        int y=cellBounds.y + (cellBounds.height - hintSize.height) / 2;
        if (y < 0) {
          y=0;
        }
 else         if (y + hintSize.height >= layeredPaneHeight) {
          y=layeredPaneHeight - hintSize.height;
        }
        return new Point(lookupBounds.x - hintSize.width,y);
      }
case RIGHT:
{
      int y=cellBounds.y + (cellBounds.height - hintSize.height) / 2;
      if (y < 0) {
        y=0;
      }
 else       if (y + hintSize.height >= layeredPaneHeight) {
        y=layeredPaneHeight - hintSize.height;
      }
      return new Point(lookupBounds.x + lookupBounds.width,y);
    }
case ABOVE:
  Point posAboveCaret=getHintPosition(hint,editor,pos,ABOVE);
return new Point(lookupBounds.x,Math.min(posAboveCaret.y,lookupBounds.y - hintSize.height));
case UNDER:
Point posUnderCaret=getHintPosition(hint,editor,pos,UNDER);
return new Point(lookupBounds.x,Math.max(posUnderCaret.y,lookupBounds.y + lookupBounds.height));
default :
LOG.assertTrue(false);
return null;
}
}
}
