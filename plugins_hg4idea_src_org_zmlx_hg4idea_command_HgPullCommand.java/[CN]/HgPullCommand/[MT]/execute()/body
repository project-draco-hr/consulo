{
  List<String> arguments=new LinkedList<String>();
  if (update) {
    arguments.add("--update");
  }
 else   if (rebase) {
    arguments.add("--rebase");
  }
  if (StringUtils.isNotBlank(revision)) {
    arguments.add("--rev");
    arguments.add(revision);
  }
  arguments.add(source);
  HgCommandResult result=HgCommandService.getInstance(project).execute(repo,"pull",arguments);
  if (HgErrorUtil.isAbort(result) && HgErrorUtil.isAuthorizationRequiredAbort(result)) {
    try {
      HgUrl hgUrl=new HgUrl(source);
      if (hgUrl.supportsAuthentication()) {
        HgUsernamePasswordDialog dialog=new HgUsernamePasswordDialog(project);
        dialog.setUsername(hgUrl.getUsername());
        dialog.show();
        if (dialog.isOK()) {
          hgUrl.setUsername(dialog.getUsername());
          hgUrl.setPassword(String.valueOf(dialog.getPassword()));
          arguments.set(arguments.size() - 1,hgUrl.asString());
          result=HgCommandService.getInstance(project).execute(repo,"pull",arguments);
        }
      }
    }
 catch (    URISyntaxException e) {
      VcsUtil.showErrorMessage(project,"Invalid source: " + source,"Error");
    }
  }
  project.getMessageBus().syncPublisher(HgVcs.INCOMING_TOPIC).update(project);
  return result;
}
