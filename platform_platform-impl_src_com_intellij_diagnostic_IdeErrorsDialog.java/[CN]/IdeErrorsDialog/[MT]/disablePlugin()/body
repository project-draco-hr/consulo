{
  final PluginId pluginId=findPluginId(getSelectedMessage().getThrowable());
  if (pluginId == null) {
    return;
  }
  IdeaPluginDescriptor plugin=PluginManager.getPlugin(pluginId);
  final Ref<Boolean> hasDependants=new Ref<Boolean>(false);
  PluginManager.checkDependants(plugin,new Function<PluginId,IdeaPluginDescriptor>(){
    @Override public IdeaPluginDescriptor fun(    PluginId pluginId){
      return PluginManager.getPlugin(pluginId);
    }
  }
,new Condition<PluginId>(){
    @Override public boolean value(    PluginId pluginId){
      if (PluginManager.CORE_PLUGIN_ID.equals(pluginId.getIdString())) {
        return true;
      }
      hasDependants.set(true);
      return false;
    }
  }
);
  Application app=ApplicationManager.getApplication();
  DisablePluginWarningDialog d=new DisablePluginWarningDialog(getRootPane(),plugin.getName(),hasDependants.get(),app.isRestartCapable());
  d.show();
switch (d.getExitCode()) {
case CANCEL_EXIT_CODE:
    return;
case DisablePluginWarningDialog.DISABLE_EXIT_CODE:
  PluginManager.disablePlugin(pluginId.getIdString());
break;
case DisablePluginWarningDialog.DISABLE_AND_RESTART_EXIT_CODE:
PluginManager.disablePlugin(pluginId.getIdString());
app.restart();
break;
}
}
