{
  PluginId pluginId=getSelectedPluginId();
  if (pluginId != null) {
    PluginManager.disablePlugin(pluginId.toString());
    final Application app=ApplicationManager.getApplication();
    final String pluginName=app.getPlugin(pluginId).getName();
    final String productName=ApplicationNamesInfo.getInstance().getFullProductName();
    if (app.isRestartCapable()) {
      int rc=Messages.showYesNoDialog(getRootPane(),pluginName + " has been disabled. Would you like to restart " + productName+ " so that the changes would take effect?","Disable Plugin",Messages.getInformationIcon());
      if (rc == 0) {
        app.restart();
      }
    }
 else {
      Messages.showMessageDialog(getRootPane(),pluginName + " has been disabled. You'll need to restart " + productName+ " for the changes to take effect.","Disable Plugin",Messages.getInformationIcon());
    }
  }
}
