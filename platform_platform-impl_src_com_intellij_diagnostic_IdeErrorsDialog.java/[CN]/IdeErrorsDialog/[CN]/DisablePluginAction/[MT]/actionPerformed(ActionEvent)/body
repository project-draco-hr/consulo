{
  PluginId pluginId=getSelectedPluginId();
  if (pluginId != null) {
    PluginManager.disablePlugin(pluginId.toString());
    final Application app=ApplicationManager.getApplication();
    final String pluginName=PluginsFacade.INSTANCE.getPlugin(pluginId).getName();
    int rc=Messages.showYesNoDialog(getRootPane(),"Are you sure you would like to disable the plugin " + pluginName + "? The features provided by the plugin will no longer be available.","Disable Plugin",Messages.getQuestionIcon());
    if (rc != 0)     return;
    final String productName=ApplicationNamesInfo.getInstance().getFullProductName();
    if (app.isRestartCapable()) {
      rc=Messages.showYesNoDialog(getRootPane(),pluginName + " has been disabled. Would you like to restart " + productName+ " so that the changes would take effect?","Disable Plugin",Messages.getInformationIcon());
      if (rc == 0) {
        app.restart();
      }
    }
 else {
      Messages.showMessageDialog(getRootPane(),pluginName + " has been disabled. You'll need to restart " + productName+ " for the changes to take effect.","Disable Plugin",Messages.getInformationIcon());
    }
  }
}
