{
  Presentation presentation=e.getPresentation();
  PsiElement[] elements;
  try {
    elements=ELEMENTS_TO_COMPARE.getNotNull(e.getDataContext());
  }
 catch (  DataAccessor.NoDataException e1) {
    presentation.setVisible(false);
    return;
  }
  DiffRequest diffRequest=getDiffRequest(elements);
  if (diffRequest == null) {
    presentation.setVisible(false);
    return;
  }
  ElementPresentation presentation1=ElementPresentation.forElement(elements[0]);
  ElementPresentation presentation2=ElementPresentation.forElement(elements[1]);
  ElementPresentation.Noun firstKind=presentation1.getKind();
  ElementPresentation.Noun secondKind=presentation2.getKind();
  if (firstKind.equals(secondKind)) {
    presentation.setText(DiffBundle.message("compare.two.element.type.acton.name",firstKind.getTypeNum()));
  }
 else   presentation.setText(DiffBundle.message("compare.element.type.with.element.type.action.name",firstKind.getTypeNum(),secondKind.getTypeNum()));
  final boolean canShow=DiffManager.getInstance().getDiffTool().canShow(diffRequest);
  if (ActionPlaces.isPopupPlace(e.getPlace())) {
    presentation.setVisible(canShow);
  }
 else {
    presentation.setVisible(true);
    presentation.setEnabled(canShow);
  }
}
