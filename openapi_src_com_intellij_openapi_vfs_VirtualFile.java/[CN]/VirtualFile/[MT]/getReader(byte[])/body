{
  final Reader reader;
  if (CharsetSettings.getInstance().isUseUTFGuessing()) {
    SmartEncodingInputStream seis=new SmartEncodingInputStream(null,bytes,CharsetToolkit.getIDEOptionsCharset(),true);
    reader=seis.getReader();
  }
 else {
    InputStream stream=new ByteArrayInputStream(bytes);
    Charset charset=CharsetToolkit.getIDEOptionsCharset();
    if (charset != null) {
      reader=new InputStreamReader(stream,charset);
    }
 else {
      reader=new InputStreamReader(stream);
    }
  }
  return reader;
}
