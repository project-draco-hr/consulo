{
  location=JavaExecutionUtil.stepIntoSingleClass(location);
  final Project project=location.getProject();
  myTestClass=JUnitUtil.getTestClass(location);
  if (myTestClass == null)   return null;
  RunnerAndConfigurationSettingsImpl settings=cloneTemplateConfiguration(project,context);
  final JUnitConfiguration configuration=(JUnitConfiguration)settings.getConfiguration();
  setupConfigurationModule(context,configuration);
  final Module originalModule=configuration.getConfigurationModule().getModule();
  configuration.beClassConfiguration(myTestClass);
  configuration.restoreOriginalModule(originalModule);
  RunConfigurationExtension.patchCreatedConfiguration(configuration);
  copyStepsBeforeRun(project,configuration);
  return settings;
}
