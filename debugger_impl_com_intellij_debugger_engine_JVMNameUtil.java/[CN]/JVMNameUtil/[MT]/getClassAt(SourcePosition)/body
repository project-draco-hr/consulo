{
  final int offset=position.getOffset();
  if (offset < 0) {
    return null;
  }
  final PsiFile psiFile=position.getFile();
  final PsiElement element;
  if (psiFile instanceof PsiCompiledElement) {
    element=psiFile.findElementAt(offset);
  }
 else {
    final FileViewProvider viewProvider=psiFile.getViewProvider();
    element=viewProvider.findElementAt(offset,StdLanguages.JAVA);
  }
  return PsiTreeUtil.getParentOfType(element,PsiClass.class,false);
}
