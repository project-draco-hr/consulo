{
  final PsiFile positionFile=position.getFile();
  if (positionFile instanceof JspFile) {
    final PsiDirectory dir=positionFile.getContainingDirectory();
    return dir != null ? dir.getVirtualFile().getPresentableUrl() : null;
  }
  final PsiClass psiClass=getClassAt(position);
  if (psiClass != null) {
    final PsiFile containingFile=psiClass.getContainingFile();
    if (containingFile instanceof PsiJavaFile) {
      return ((PsiJavaFile)containingFile).getPackageName();
    }
  }
  if (debugProcess != null && debugProcess.isAttached()) {
    List<ReferenceType> allClasses=debugProcess.getPositionManager().getAllClasses(position);
    if (allClasses.size() > 0) {
      final String className=allClasses.get(0).name();
      int dotIndex=className.lastIndexOf('.');
      if (dotIndex >= 0) {
        return className.substring(0,dotIndex);
      }
    }
  }
  return "";
}
