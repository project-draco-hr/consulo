{
  myEditor=InjectedLanguageUtil.getTopLevelEditor(editor);
  myElementToRename=elementToRename;
  myProject=project;
  myOldName=oldName;
  if (myElementToRename != null) {
    myInitialName=initialName;
    final PsiFile containingFile=myElementToRename.getContainingFile();
    if (!notSameFile(getTopLevelVirtualFile(containingFile.getViewProvider()),containingFile)) {
      myRenameOffset=myElementToRename != null && myElementToRename.getTextRange() != null ? myEditor.getDocument().createRangeMarker(myElementToRename.getTextRange()) : null;
    }
  }
}
