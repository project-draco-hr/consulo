{
  Runnable runnable=new Runnable(){
    public void run(){
      myEditor.getCaretModel().moveToOffset(restoreCaretOffset(offset));
      restoreSelection();
    }
  }
;
  final LookupImpl lookup=(LookupImpl)LookupManager.getActiveLookup(myEditor);
  if (lookup != null && lookup.getLookupStart() <= (restoreCaretOffset(offset))) {
    lookup.setFocused(false);
    lookup.performGuardedChange(runnable);
  }
 else {
    runnable.run();
  }
}
