{
  final PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(oldDocument);
  if (file != null) {
    final VirtualFile virtualFile=file.getVirtualFile();
    if (virtualFile != null) {
      final FileEditor[] editors=FileEditorManager.getInstance(project).getEditors(virtualFile);
      for (      FileEditor editor : editors) {
        if (editor instanceof TextEditor) {
          final Editor textEditor=((TextEditor)editor).getEditor();
          final TemplateState templateState=TemplateManagerImpl.getTemplateState(textEditor);
          if (templateState != null) {
            if (exitCode == DialogWrapper.OK_EXIT_CODE) {
              final TextRange range=templateState.getVariableRange(PRIMARY_VARIABLE_NAME);
              if (range != null) {
                new OpenFileDescriptor(project,virtualFile,range.getStartOffset()).navigate(true);
                return;
              }
            }
 else             if (exitCode > 0) {
              templateState.gotoEnd();
              return;
            }
          }
        }
      }
    }
  }
}
