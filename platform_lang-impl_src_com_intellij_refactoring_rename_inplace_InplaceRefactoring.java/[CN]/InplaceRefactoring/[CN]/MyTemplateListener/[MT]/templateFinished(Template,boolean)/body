{
  boolean bind=false;
  try {
    super.templateFinished(template,brokenOff);
    if (!brokenOff) {
      bind=performRefactoring();
    }
    moveOffsetAfter(!brokenOff);
  }
  finally {
    if (!bind) {
      FinishMarkAction.finish(myProject,myEditor,myMarkAction);
      if (myBeforeRevert != null) {
        myBeforeRevert.dispose();
      }
    }
  }
}
