{
  try {
    final TextResult value=templateState.getVariableValue(PRIMARY_VARIABLE_NAME);
    myInsertedName=value != null ? value.toString() : null;
    final int currentOffset=myEditor.getCaretModel().getOffset();
    myBeforeRevert=myRenameOffset != null && myRenameOffset.getEndOffset() >= currentOffset && myRenameOffset.getStartOffset() <= currentOffset ? myEditor.getDocument().createRangeMarker(myRenameOffset.getStartOffset(),currentOffset) : null;
    if (myBeforeRevert != null) {
      myBeforeRevert.setGreedyToRight(true);
    }
    finish(true);
  }
  finally {
    restoreDaemonUpdateState();
  }
}
