{
  if (isUnitTestMode())   return new ClassLoader[0];
  final List<ClassLoader> classLoaders=new ArrayList<ClassLoader>();
  for (  final PluginId id : pluginIds) {
    IdeaPluginDescriptor pluginDescriptor=idToDescriptorMap.get(id);
    if (pluginDescriptor == null) {
      continue;
    }
    final ClassLoader loader=pluginDescriptor.getPluginClassLoader();
    if (loader == null) {
      getLogger().error("Plugin class loader should be initialized for plugin " + id);
    }
    classLoaders.add(loader);
  }
  return classLoaders.toArray(new ClassLoader[classLoaders.size()]);
}
