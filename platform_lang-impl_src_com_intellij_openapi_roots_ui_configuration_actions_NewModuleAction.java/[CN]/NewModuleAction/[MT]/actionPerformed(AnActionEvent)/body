{
  final Project project=getEventProject(e);
  if (project == null) {
    return;
  }
  Object dataFromContext=prepareDataFromContext(e);
  final VirtualFile virtualFile=e.getData(CommonDataKeys.VIRTUAL_FILE);
  Module newModule=null;
  boolean eapState=EarlyAccessProgramManager.is(NewProjectOrModuleDialogWithSetup.EapDescriptor.class);
  if (eapState) {
    VirtualFile moduleDir=selectModuleDirectory(project,virtualFile);
    if (moduleDir == null) {
      return;
    }
    NewProjectOrModuleDialogWithSetup dialog=new NewProjectOrModuleDialogWithSetup(project,moduleDir);
    newModule=dialog.showAndGet() ? dialog.doCreate(project,moduleDir) : null;
  }
 else {
    newModule=createModuleBySimpleWay(project,virtualFile);
  }
  if (newModule != null) {
    processCreatedModule(newModule,dataFromContext);
  }
}
