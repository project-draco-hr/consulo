{
  final Project project=getEventProject(e);
  if (project == null) {
    return;
  }
  Object dataFromContext=prepareDataFromContext(e);
  final VirtualFile virtualFile=e.getData(CommonDataKeys.VIRTUAL_FILE);
  Module newModule=null;
  VirtualFile moduleDir=selectModuleDirectory(project,virtualFile);
  if (moduleDir == null) {
    return;
  }
  NewProjectOrModuleDialog dialog=new NewProjectOrModuleDialog(project,moduleDir);
  newModule=dialog.showAndGet() ? dialog.doCreate(project,moduleDir) : null;
  if (newModule != null) {
    processCreatedModule(newModule,dataFromContext);
  }
}
