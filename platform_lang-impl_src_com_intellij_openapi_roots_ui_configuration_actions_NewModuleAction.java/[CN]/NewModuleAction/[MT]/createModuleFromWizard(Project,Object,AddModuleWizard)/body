{
  final ProjectBuilder builder=wizard.getProjectBuilder();
  if (builder instanceof ModuleBuilder) {
    final ModuleBuilder moduleBuilder=(ModuleBuilder)builder;
    if (moduleBuilder.getName() == null) {
      moduleBuilder.setName(wizard.getProjectName());
    }
    if (moduleBuilder.getModuleDirPath() == null) {
      moduleBuilder.setModuleDirPath(wizard.getModuleFilePath());
    }
  }
  if (!builder.validate(project,project)) {
    return null;
  }
  Module module;
  if (builder instanceof ModuleBuilder) {
    module=((ModuleBuilder)builder).commitModule(project,null);
    if (module != null) {
      processCreatedModule(module,dataFromContext);
    }
    return module;
  }
 else {
    List<Module> modules=builder.commit(project,null,new DefaultModulesProvider(project));
    if (builder.isOpenProjectSettingsAfter()) {
      ModulesConfigurator.showDialog(project,null,null);
    }
    module=modules == null || modules.isEmpty() ? null : modules.get(0);
  }
  project.save();
  return module;
}
