{
  DocumentEventImpl event=(DocumentEventImpl)e;
  if (PersistentRangeMarkerUtil.shouldTranslateViaDiff(event,this)) {
    myLine=event.translateLineViaDiff(myLine);
    if (myLine < 0 || myLine >= getDocument().getLineCount()) {
      invalidate();
    }
 else {
      DocumentEx document=getDocument();
      myStart=document.getLineStartOffset(myLine);
      myEnd=document.getLineEndOffset(myLine);
    }
  }
 else {
    super.changedUpdateImpl(e);
    if (isValid()) {
      myLine=getDocument().getLineNumber(myStart);
      int endLine=getDocument().getLineNumber(myEnd);
      if (endLine != myLine) {
        myEnd=getDocument().getLineEndOffset(myLine);
      }
    }
  }
}
