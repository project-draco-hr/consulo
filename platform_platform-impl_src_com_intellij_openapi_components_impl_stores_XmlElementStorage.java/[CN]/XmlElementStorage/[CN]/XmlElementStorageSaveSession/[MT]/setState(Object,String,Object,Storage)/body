{
  Element element;
  try {
    element=DefaultStateSerializer.serializeState(state,storageSpec);
  }
 catch (  WriteExternalException e) {
    LOG.debug(e);
    return;
  }
catch (  Throwable e) {
    LOG.error("Unable to serialize " + componentName + " state",e);
    return;
  }
  if (myCopiedStorageData == null) {
    myCopiedStorageData=StorageData.setStateAndCloneIfNeed(componentName,element,myOriginalStorageData,myNewLiveStates);
    if (myCopiedStorageData != null) {
      myLocalVersionProvider.changeVersion(componentName,System.currentTimeMillis());
    }
  }
 else   if (myCopiedStorageData.setState(componentName,element,myNewLiveStates) != null) {
    myLocalVersionProvider.changeVersion(componentName,System.currentTimeMillis());
  }
}
