{
  PsiFile sourceFile=PsiFileFactory.getInstance(directory.getProject()).createFileFromText(newName + ".java",createClassBody(newName,myRecentGenerateOK,myRecentGenerateCancel,myRecentGenerateMain));
  sourceFile=(PsiFile)directory.add(sourceFile);
  JavaCodeStyleManager.getInstance(directory.getProject()).shortenClassReferences(sourceFile);
  CodeStyleManager.getInstance(directory.getProject()).reformat(sourceFile);
  final PsiJavaPackage aPackage=JavaDirectoryService.getInstance().getPackage(directory);
  final String packageName=aPackage.getQualifiedName();
  final String fqClassName=packageName.length() == 0 ? newName : packageName + "." + newName;
  final String formBody=createFormBody(fqClassName,"/com/intellij/uiDesigner/NewDialog.xml",GuiDesignerConfiguration.getInstance(directory.getProject()).DEFAULT_LAYOUT_MANAGER);
  final PsiFile formFile=PsiFileFactory.getInstance(directory.getProject()).createFileFromText(newName + ".form",formBody);
  PsiElement createdFile=directory.add(formFile);
  PsiClass[] classes=((PsiJavaFile)sourceFile).getClasses();
  return new PsiElement[]{createdFile,classes[0]};
}
