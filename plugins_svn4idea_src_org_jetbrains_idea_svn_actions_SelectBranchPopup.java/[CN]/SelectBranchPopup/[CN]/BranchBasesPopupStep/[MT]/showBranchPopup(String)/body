{
  List<SvnBranchItem> branches=myConfiguration.getBranches(selectedValue);
  if (branches == null) {
    return;
  }
  final Object[] items=new Object[branches.size() + 1];
  System.arraycopy(branches.toArray(),0,items,0,branches.size());
  items[items.length - 1]=REFRESH_MESSAGE;
  final JList branchList=new JBList(items);
  branchList.setCellRenderer(new BranchRenderer());
  final JBPopup popup=JBPopupFactory.getInstance().createListPopupBuilder(branchList).setTitle(SVNPathUtil.tail(selectedValue)).setResizable(true).setItemChoosenCallback(new Runnable(){
    public void run(){
      if (REFRESH_MESSAGE.equals(branchList.getSelectedValue())) {
        SwingUtilities.invokeLater(new Runnable(){
          @Override public void run(){
            loadBranches(selectedValue,new Runnable(){
              @Override public void run(){
                showBranchPopup(selectedValue);
              }
            }
);
          }
        }
);
        return;
      }
      SvnBranchItem item=(SvnBranchItem)branchList.getSelectedValue();
      if (item != null) {
        myCallback.branchSelected(myProject,myConfiguration,item.getUrl(),item.getRevision());
      }
    }
  }
).createPopup();
  showPopupAt(popup);
}
