{
  final ChangeListManagerGate gate=dataHolder.getChangeListWorker().createSelfGate();
  final UpdatingChangeListBuilder builder=new UpdatingChangeListBuilder(dataHolder.getChangeListWorker(),dataHolder.getComposite(),myUpdater.getIsStoppedGetter(),myIgnoredIdeaLevel,gate);
  for (  final VcsDirtyScope scope : scopes) {
    myUpdateChangesProgressIndicator.checkCanceled();
    final AbstractVcs vcs=scope.getVcs();
    if (vcs == null)     continue;
    final VcsModifiableDirtyScope adjustedScope=vcs.adjustDirtyScope((VcsModifiableDirtyScope)scope);
    myChangesViewManager.updateProgressText(VcsBundle.message("changes.update.progress.message",vcs.getDisplayName()),false);
    dataHolder.notifyStartProcessingChanges(adjustedScope);
    actualUpdate(builder,adjustedScope,vcs,dataHolder,gate);
    if (myUpdateException != null)     break;
  }
synchronized (myDataLock) {
    myAdditionalInfo.addAll(builder.getAdditionalInfo());
  }
}
