{
  for (  DirectoryIndexExcludePolicy policy : DirectoryIndexExcludePolicy.EP_NAME.getExtensions(myProject)) {
    for (    VirtualFile file : policy.getExcludeRootsForProject()) {
      addDirectoryToIgnoreImplicitly(file.getPath());
    }
  }
  ProjectFileIndex fileIndex=ProjectFileIndex.SERVICE.getInstance(myProject);
  VirtualFileManager virtualFileManager=VirtualFileManager.getInstance();
  for (  Module module : ModuleManager.getInstance(myProject).getModules()) {
    for (    String url : ModuleRootManager.getInstance(module).getExcludeRootUrls()) {
      VirtualFile file=virtualFileManager.findFileByUrl(url);
      if (file != null && !fileIndex.isExcluded(file)) {
        continue;
      }
      addDirectoryToIgnoreImplicitly(VfsUtilCore.urlToPath(url));
    }
  }
}
