{
  final ChangeListManagerGate gate=dataHolder.getChangeListWorker().createSelfGate();
  final UpdatingChangeListBuilder builder=new UpdatingChangeListBuilder(dataHolder.getChangeListWorker(),dataHolder.getComposite(),myUpdater.getIsStoppedGetter(),myIgnoredIdeaLevel,gate);
  for (  final VcsDirtyScope scope : scopes) {
    if (DEBUG) {
      System.out.println("ChangeListManagerImpl.iterateScopes: scope = " + scope);
    }
    myUpdateChangesProgressIndicator.checkCanceled();
    final AbstractVcs vcs=scope.getVcs();
    if (vcs == null)     continue;
    scope.setWasEverythingDirty(wasEverythingDirty);
    final VcsModifiableDirtyScope adjustedScope=vcs.adjustDirtyScope((VcsModifiableDirtyScope)scope);
    myChangesViewManager.updateProgressText(VcsBundle.message("changes.update.progress.message",vcs.getDisplayName()),false);
    dataHolder.notifyStartProcessingChanges(adjustedScope);
    actualUpdate(builder,adjustedScope,vcs,dataHolder,gate);
    if (myUpdateException != null)     break;
  }
synchronized (myDataLock) {
    if (myAdditionalInfo == null) {
      myAdditionalInfo=builder.getAdditionalInfo();
    }
  }
}
