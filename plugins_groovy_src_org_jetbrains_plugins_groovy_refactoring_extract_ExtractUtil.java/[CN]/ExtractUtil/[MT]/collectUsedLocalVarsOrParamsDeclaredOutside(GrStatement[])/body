{
  final Collection<GrVariable> result=new HashSet<GrVariable>();
  final int start=statements[0].getTextRange().getStartOffset();
  final int end=statements[statements.length - 1].getTextRange().getEndOffset();
  final GroovyRecursiveElementVisitor visitor=new GroovyRecursiveElementVisitor(){
    @Override public void visitReferenceExpression(    GrReferenceExpression ref){
      final PsiElement resolved=ref.resolve();
      if ((resolved instanceof GrParameter || GroovyRefactoringUtil.isLocalVariable(resolved)) && resolved.isPhysical()) {
        final int offset=resolved.getTextRange().getStartOffset();
        if (offset < start || end <= offset) {
          result.add((GrVariable)resolved);
        }
      }
    }
  }
;
  for (  GrStatement statement : statements) {
    statement.accept(visitor);
  }
  return result;
}
