{
  ProgressManager.getInstance().checkCanceled();
  if (revision == null)   return new SimpleContent("");
  if (revision instanceof CurrentContentRevision) {
    final CurrentContentRevision current=(CurrentContentRevision)revision;
    final VirtualFile vFile=current.getVirtualFile();
    return vFile != null ? new FileContent(myProject,vFile) : new SimpleContent("");
  }
  String revisionContent;
  try {
    revisionContent=revision.getContent();
  }
 catch (  VcsException ex) {
    revisionContent=null;
  }
  SimpleContent content=revisionContent == null ? new SimpleContent("") : new SimpleContent(revisionContent,revision.getFile().getFileType());
  VirtualFile vFile=revision.getFile().getVirtualFile();
  if (vFile != null) {
    content.setCharset(vFile.getCharset());
    content.setBOM(vFile.getBOM());
  }
  content.setReadOnly(true);
  return content;
}
