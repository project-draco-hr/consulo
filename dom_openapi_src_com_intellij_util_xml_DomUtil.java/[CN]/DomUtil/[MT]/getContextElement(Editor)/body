{
  if (editor == null)   return null;
  final PsiFile file=PsiDocumentManager.getInstance(editor.getProject()).getPsiFile(editor.getDocument());
  if (!(file instanceof XmlFile)) {
    return null;
  }
  int offset=editor.getCaretModel().getOffset();
  PsiElement element=file.findElementAt(offset);
  if (element == null)   return null;
  XmlTag tag=PsiTreeUtil.getParentOfType(element,XmlTag.class);
  while (tag != null) {
    final DomElement domElement=DomManager.getDomManager(file.getProject()).getDomElement(tag);
    if (domElement != null)     return domElement;
    tag=PsiTreeUtil.getParentOfType(tag,XmlTag.class,true);
  }
  return null;
}
