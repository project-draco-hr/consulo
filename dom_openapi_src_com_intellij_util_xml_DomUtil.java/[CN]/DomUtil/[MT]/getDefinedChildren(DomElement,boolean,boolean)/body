{
  if (parent instanceof MergedObject) {
    final SmartList<DomElement> result=new SmartList<DomElement>();
    parent.acceptChildren(new DomElementVisitor(){
      public void visitDomElement(      final DomElement element){
        if (element.getXmlElement() != null) {
          result.add(element);
        }
      }
    }
);
    return result;
  }
  ProgressManager.getInstance().checkCanceled();
  if (parent instanceof GenericAttributeValue)   return Collections.emptyList();
  if (parent instanceof DomFileElement) {
    final DomFileElement element=(DomFileElement)parent;
    return tags ? Arrays.asList(element.getRootElement()) : Collections.<DomElement>emptyList();
  }
  final XmlElement xmlElement=parent.getXmlElement();
  if (xmlElement instanceof XmlTag) {
    XmlTag tag=(XmlTag)xmlElement;
    final DomManager domManager=parent.getManager();
    final SmartList<DomElement> result=new SmartList<DomElement>();
    if (attributes) {
      for (      final XmlAttribute attribute : tag.getAttributes()) {
        ContainerUtil.addIfNotNull(domManager.getDomElement(attribute),result);
      }
    }
    if (tags) {
      for (      final XmlTag subTag : tag.getSubTags()) {
        ContainerUtil.addIfNotNull(domManager.getDomElement(subTag),result);
      }
    }
    return result;
  }
  return Collections.emptyList();
}
