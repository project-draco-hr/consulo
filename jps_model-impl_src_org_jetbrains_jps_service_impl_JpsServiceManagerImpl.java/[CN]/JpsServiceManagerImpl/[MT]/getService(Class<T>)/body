{
  T service=(T)myServices.get(serviceClass);
  if (service == null) {
    final Iterator<T> iterator=ServiceLoader.load(serviceClass,serviceClass.getClassLoader()).iterator();
    if (!iterator.hasNext()) {
      throw new ServiceConfigurationError("Implementation for " + serviceClass + " not found");
    }
    service=iterator.next();
    if (iterator.hasNext()) {
      throw new ServiceConfigurationError("More than one implementation for " + serviceClass + " found: "+ service.getClass()+ " and "+ iterator.next().getClass());
    }
    myServices.putIfAbsent(serviceClass,service);
    service=(T)myServices.get(serviceClass);
  }
  return service;
}
