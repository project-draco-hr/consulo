{
  while (expr.getParent() instanceof PsiArrayAccessExpression) {
    PsiArrayAccessExpression arrayAccess=(PsiArrayAccessExpression)expr.getParent();
    Object value=evalHelper.computeConstantExpression(arrayAccess.getIndexExpression());
    if (value instanceof Integer) {
      int intValue=((Integer)value).intValue();
      if (initializer1 instanceof PsiNewExpression) {
        PsiExpression[] arrayInitializers=((PsiNewExpression)initializer1).getArrayInitializer().getInitializers();
        if (0 <= intValue && intValue < arrayInitializers.length) {
          expr=(PsiExpression)expr.getParent();
          initializer1=normalize(arrayInitializers[intValue]);
          continue;
        }
      }
    }
    break;
  }
  if (initializer1 instanceof PsiArrayInitializerExpression) {
    final PsiType type=expr.getType();
    if (type != null) {
      initializer1=(PsiExpression)initializer1.replace((PsiNewExpression)JavaPsiFacade.getInstance(expr.getProject()).getElementFactory().createExpressionFromText("new " + type.getCanonicalText() + initializer1.getText(),initializer1));
    }
  }
  myField.normalizeDeclaration();
  ChangeContextUtil.encodeContextInfo(initializer1,true);
  if (expr instanceof PsiReferenceExpression) {
    PsiExpression qExpression=((PsiReferenceExpression)expr).getQualifierExpression();
    if (qExpression != null) {
      if (initializer1 instanceof PsiMethodCallExpression) {
        ((PsiMethodCallExpression)initializer1).getMethodExpression().setQualifierExpression(qExpression);
      }
 else       if (initializer1 instanceof PsiReferenceExpression) {
        ((PsiReferenceExpression)initializer1).setQualifierExpression(qExpression);
      }
    }
  }
  PsiElement element=expr.replace(initializer1);
  ChangeContextUtil.decodeContextInfo(element,null,null);
}
