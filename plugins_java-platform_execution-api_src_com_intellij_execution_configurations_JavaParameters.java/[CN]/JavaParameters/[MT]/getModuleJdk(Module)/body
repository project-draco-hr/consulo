{
  final JavaModuleExtension extension=ModuleRootManager.getInstance(module).getExtension(JavaModuleExtension.class);
  final Sdk jdk=extension == null ? null : extension.getSdk();
  if (jdk == null) {
    throw CantRunException.noJdkForModule(module);
  }
  final VirtualFile homeDirectory=jdk.getHomeDirectory();
  if (homeDirectory == null || !homeDirectory.isValid()) {
    throw CantRunException.jdkMisconfigured(jdk,module);
  }
  return jdk;
}
