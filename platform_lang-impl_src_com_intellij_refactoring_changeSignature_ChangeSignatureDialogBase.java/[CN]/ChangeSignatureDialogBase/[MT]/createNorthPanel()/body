{
  JPanel panel=new JPanel(new VerticalFlowLayout(VerticalFlowLayout.TOP,-4,0,true,false));
  final JPanel methodPanel=new JPanel(new BorderLayout());
  final JPanel typePanel=new JPanel(new VerticalFlowLayout(VerticalFlowLayout.TOP,4,2,true,false));
  myNamePanel=new JPanel(new VerticalFlowLayout(VerticalFlowLayout.TOP,4,2,true,false));
  final JLabel nameLabel=new JLabel(RefactoringBundle.message("changeSignature.name.prompt"));
  myNameField=new EditorTextField(myMethod.getName());
  nameLabel.setLabelFor(myNameField);
  myNamePanel.add(nameLabel);
  myNamePanel.add(myNameField);
  myNameField.setEnabled(myMethod.canChangeName());
  if (myMethod.canChangeName()) {
    myNameField.addDocumentListener(mySignatureUpdater);
  }
  createVisibilityPanel();
  if (myMethod.canChangeReturnType() != MethodDescriptor.ReadWriteOption.None) {
    final JLabel typeLabel=new JLabel(RefactoringBundle.message("changeSignature.return.type.prompt"));
    typePanel.add(typeLabel);
    myReturnTypeCodeFragment=createReturnTypeCodeFragment();
    final Document document=PsiDocumentManager.getInstance(myProject).getDocument(myReturnTypeCodeFragment);
    myReturnTypeField=createReturnTypeTextField(document);
    typeLabel.setLabelFor(myReturnTypeField);
    typePanel.add(myReturnTypeField);
    if (myMethod.canChangeReturnType() == MethodDescriptor.ReadWriteOption.ReadWrite) {
      myReturnTypeField.setPreferredWidth(200);
      myReturnTypeField.addDocumentListener(mySignatureUpdater);
    }
 else {
      myReturnTypeField.setEnabled(false);
    }
  }
  final JPanel p=new JPanel(new BorderLayout());
  if (myMethod.canChangeVisibility() && myVisibilityPanel instanceof ComboBoxVisibilityPanel) {
    p.add(myVisibilityPanel,BorderLayout.WEST);
    ((ComboBoxVisibilityPanel)myVisibilityPanel).registerUpDownActionsFor(myNameField);
  }
  p.add(typePanel,BorderLayout.EAST);
  methodPanel.add(p,BorderLayout.WEST);
  methodPanel.add(myNamePanel,BorderLayout.CENTER);
  panel.add(methodPanel);
  return panel;
}
