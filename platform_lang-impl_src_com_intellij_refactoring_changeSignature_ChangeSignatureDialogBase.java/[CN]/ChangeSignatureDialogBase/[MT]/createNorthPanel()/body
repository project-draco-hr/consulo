{
  JPanel panel=new JPanel(new VerticalFlowLayout(VerticalFlowLayout.TOP));
  JPanel top=new JPanel(new BorderLayout());
  if (myAllowDelegation) {
    myDelegationPanel=createDelegationPanel();
    top.add(myDelegationPanel,BorderLayout.WEST);
  }
  myPropagateParamChangesButton=new JButton(RefactoringBundle.message("changeSignature.propagate.parameters.title"));
  myPropagateParamChangesButton.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      final Ref<CallerChooserBase<M>> chooser=new Ref<CallerChooserBase<M>>();
      Consumer<Set<M>> callback=new Consumer<Set<M>>(){
        @Override public void consume(        Set<M> callers){
          myMethodsToPropagateParameters=callers;
          myParameterPropagationTreeToReuse=chooser.get().getTree();
        }
      }
;
      try {
        chooser.set(createCallerChooser(RefactoringBundle.message("changeSignature.parameter.caller.chooser"),myParameterPropagationTreeToReuse,callback));
      }
 catch (      ProcessCanceledException ex) {
        return;
      }
      chooser.get().show();
    }
  }
);
  myPropagatePanel=new JPanel();
  myPropagatePanel.add(myPropagateParamChangesButton);
  top.add(myPropagatePanel,BorderLayout.EAST);
  panel.add(top);
  final DocumentListener documentListener=new DocumentAdapter(){
    public void documentChanged(    DocumentEvent event){
      updateSignature();
    }
  }
;
  if (myMethod.canChangeName()) {
    JLabel namePrompt=new JLabel();
    myNameField=new EditorTextField(myMethod.getName());
    namePrompt.setText(RefactoringBundle.message("name.prompt"));
    namePrompt.setLabelFor(myNameField);
    panel.add(namePrompt);
    panel.add(myNameField);
    myNameField.addDocumentListener(documentListener);
  }
  if (myMethod.canChangeReturnType() != MethodDescriptor.ReadWriteOption.None) {
    JLabel typePrompt=new JLabel();
    panel.add(typePrompt);
    myReturnTypeCodeFragment=createReturnTypeCodeFragment();
    final Document document=PsiDocumentManager.getInstance(myProject).getDocument(myReturnTypeCodeFragment);
    myReturnTypeField=createReturnTypeTextField(document);
    typePrompt.setText(RefactoringBundle.message("changeSignature.return.type.prompt"));
    typePrompt.setLabelFor(myReturnTypeField);
    panel.add(myReturnTypeField);
    if (myMethod.canChangeReturnType() == MethodDescriptor.ReadWriteOption.ReadWrite) {
      myReturnTypeField.addDocumentListener(documentListener);
    }
 else {
      myReturnTypeField.setEnabled(false);
    }
  }
  return panel;
}
