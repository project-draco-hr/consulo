{
  return new TestNGRunnableState(env,myConfiguration){
    protected void fillTestObjects(    final Map<PsiClass,Collection<PsiMethod>> classes,    final Project project) throws CantRunException {
      for (      AbstractTestProxy proxy : myFailed) {
        final Location location=proxy.getLocation(project);
        if (location != null) {
          final PsiElement element=location.getPsiElement();
          if (element instanceof PsiMethod && element.isValid()) {
            final PsiMethod psiMethod=(PsiMethod)element;
            final PsiClass psiClass=psiMethod.getContainingClass();
            Collection<PsiMethod> psiMethods=classes.get(psiClass);
            if (psiMethods == null) {
              psiMethods=new ArrayList<PsiMethod>();
              classes.put(psiClass,psiMethods);
            }
            psiMethods.add(psiMethod);
          }
        }
      }
    }
  }
;
}
