{
  if (myProject.isDisposed())   return;
  ContentIterator iteratorAdapter=new ContentIterator(){
    public boolean processFile(    VirtualFile fileOrDir){
      return iterator.process(new FilePathImpl(fileOrDir));
    }
  }
;
  for (  VirtualFile root : myAffectedContentRoots) {
    final Module module=VfsUtil.getModuleForFile(myProject,root);
    if (module == null)     continue;
    final ModuleFileIndex index=ModuleRootManager.getInstance(module).getFileIndex();
    for (    FilePath dir : myDirtyDirectoriesRecursively) {
      final VirtualFile vFile=dir.getVirtualFile();
      if (vFile != null && vFile.isValid()) {
        if (VfsUtil.isAncestor(root,vFile,false)) {
          index.iterateContentUnderDirectory(vFile,iteratorAdapter);
        }
 else         if (VfsUtil.isAncestor(vFile,root,false)) {
          index.iterateContentUnderDirectory(root,iteratorAdapter);
        }
      }
    }
  }
  for (  FilePath file : myDirtyFiles) {
    iterator.process(file);
    final VirtualFile vFile=file.getVirtualFile();
    if (vFile != null && vFile.isValid() && vFile.isDirectory()) {
      for (      VirtualFile child : vFile.getChildren()) {
        iterator.process(new FilePathImpl(child));
      }
    }
  }
}
