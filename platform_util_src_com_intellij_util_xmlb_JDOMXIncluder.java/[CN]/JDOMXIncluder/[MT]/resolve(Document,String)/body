{
  if (original == null) {
    throw new NullPointerException("Document must not be null");
  }
  Document result=(Document)original.clone();
  Element root=result.getRootElement();
  List resolved=resolve(root,base);
  Element newRoot=null;
  Iterator iterator=resolved.iterator();
  while (iterator.hasNext()) {
    Object o=iterator.next();
    if (o instanceof Element) {
      if (newRoot != null) {
        throw new XIncludeException("Tried to include multiple roots");
      }
      newRoot=(Element)o;
    }
 else     if (o instanceof Comment || o instanceof ProcessingInstruction) {
    }
 else     if (o instanceof Text || o instanceof String) {
      throw new XIncludeException("Tried to include text node outside of root element");
    }
 else     if (o instanceof EntityRef) {
      throw new XIncludeException("Tried to include a general entity reference outside of root element");
    }
 else {
      throw new XIncludeException("Unexpected type " + o.getClass());
    }
  }
  if (newRoot == null) {
    throw new XIncludeException("No root element");
  }
  List<Object> newContent=result.getContent();
  iterator=resolved.iterator();
  int rootPosition=newContent.indexOf(result.getRootElement());
  while (iterator.hasNext()) {
    Object o=iterator.next();
    if (o instanceof Comment || o instanceof ProcessingInstruction) {
      newContent.add(rootPosition,o);
      rootPosition++;
    }
 else     if (o instanceof Element) {
      break;
    }
 else {
    }
  }
  result.setRootElement(newRoot);
  int addPosition=rootPosition + 1;
  while (iterator.hasNext()) {
    Object o=iterator.next();
    if (o instanceof Comment || o instanceof ProcessingInstruction) {
      newContent.add(addPosition,o);
      addPosition++;
    }
 else {
    }
  }
  return result;
}
