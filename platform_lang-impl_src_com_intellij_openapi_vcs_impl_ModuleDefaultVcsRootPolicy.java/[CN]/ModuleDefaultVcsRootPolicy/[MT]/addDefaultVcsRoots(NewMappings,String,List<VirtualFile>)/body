{
  final ProjectLevelVcsManager vcsManager=ProjectLevelVcsManager.getInstance(myProject);
  if (myBaseDir != null && vcsName.equals(mappingList.getVcsFor(myBaseDir))) {
    final AbstractVcs vcsFor=vcsManager.getVcsFor(myBaseDir);
    if (vcsFor != null && vcsName.equals(vcsFor.getName())) {
      result.add(myBaseDir);
    }
  }
  final StorageScheme storageScheme=((ProjectEx)myProject).getStateStore().getStorageScheme();
  if (StorageScheme.DIRECTORY_BASED.equals(storageScheme) && (myBaseDir != null)) {
    final VirtualFile ideaDir=myBaseDir.findChild(Project.DIRECTORY_STORE_FOLDER);
    if (ideaDir != null && ideaDir.isValid() && ideaDir.isDirectory()) {
      final AbstractVcs vcsFor=vcsManager.getVcsFor(ideaDir);
      if (vcsFor != null && vcsName.equals(vcsFor.getName())) {
        result.add(ideaDir);
      }
    }
  }
  final Module[] modules=ApplicationManager.getApplication().runReadAction(new Computable<Module[]>(){
    @Override public Module[] compute(){
      return myModuleManager.getModules();
    }
  }
);
  for (  Module module : modules) {
    final VirtualFile[] files=ModuleRootManager.getInstance(module).getContentRoots();
    for (    VirtualFile file : files) {
      VcsDirectoryMapping mapping=mappingList.getMappingFor(file,module);
      final String mappingVcs=mapping != null ? mapping.getVcs() : null;
      if (vcsName.equals(mappingVcs) && !result.contains(file)) {
        result.add(file);
      }
    }
  }
}
