{
  final T descriptor=key.createDescriptor(myProject);
  final T oldDescriptor=findDescriptor(parent,descriptor,key);
  if (oldDescriptor != null && oldDescriptor.getClass() == descriptor.getClass()) {
    descriptor.setAncestor(oldDescriptor);
  }
 else {
    T displayDescriptor=findDisplayDescriptor(parent,descriptor,key.getDisplayKey());
    if (displayDescriptor != null) {
      descriptor.displayAs(displayDescriptor);
    }
  }
  myCurrentHistoryTree.addChild(parent,descriptor);
  return descriptor;
}
