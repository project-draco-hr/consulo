{
  final JavaCommandLineState state=new JavaCommandLineState(runnerSettings,configurationSettings){
    private AppletHtmlFile myHtmlURL=null;
    protected JavaParameters createJavaParameters() throws ExecutionException {
      final JavaParameters params=new JavaParameters();
      myHtmlURL=getHtmlURL();
      if (myHtmlURL != null) {
        final int classPathType=myHtmlURL.isHttp() ? JavaParameters.JDK_ONLY : JavaParameters.JDK_AND_CLASSES;
        final RunConfigurationModule runConfigurationModule=getConfigurationModule();
        JavaParametersUtil.configureModule(runConfigurationModule,params,classPathType,ALTERNATIVE_JRE_PATH_ENABLED ? ALTERNATIVE_JRE_PATH : null);
        final String policyFileParameter=getPolicyFileParameter();
        if (policyFileParameter != null) {
          params.getVMParametersList().add(policyFileParameter);
        }
        params.getVMParametersList().addParametersString(VM_PARAMETERS);
        params.setMainClass("sun.applet.AppletViewer");
        params.getProgramParametersList().add(myHtmlURL.getUrl());
      }
      return params;
    }
    protected OSProcessHandler startProcess() throws ExecutionException {
      final OSProcessHandler handler=super.startProcess();
      final AppletHtmlFile htmlUrl=myHtmlURL;
      if (htmlUrl != null) {
        handler.addProcessListener(new ProcessAdapter(){
          public void processTerminated(          ProcessEvent event){
            htmlUrl.deleteFile();
          }
        }
);
      }
      return handler;
    }
  }
;
  state.setConsoleBuilder(TextConsoleBuilderFactory.getInstance().createBuilder(getProject()));
  state.setModulesToCompile(getModules());
  return state;
}
