{
  final Runnable callback=new Runnable(){
    @Override public void run(){
      String selectedValue=(String)list.getSelectedValue();
      if (selectedValue != null) {
        textField.setText(selectedValue);
      }
    }
  }
;
  final PopupChooserBuilder builder=JBPopupFactory.getInstance().createListPopupBuilder(list);
  if (title != null) {
    builder.setTitle(title);
  }
  final JBPopup popup=builder.setMovable(false).setResizable(false).setRequestFocus(true).setItemChoosenCallback(callback).createPopup();
  if (ad != null) {
    popup.setAdText(ad,SwingConstants.LEFT);
  }
  if (toolbarComponent != null) {
    popup.showUnderneathOf(toolbarComponent);
  }
 else {
    popup.showUnderneathOf(textField);
  }
}
