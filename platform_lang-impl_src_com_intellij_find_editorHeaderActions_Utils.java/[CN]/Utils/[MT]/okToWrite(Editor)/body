{
  final PsiFile psiFile=PsiDocumentManager.getInstance(e.getProject()).getPsiFile(e.getDocument());
  boolean okWritable;
  if (psiFile != null) {
    final VirtualFile virtualFile=psiFile.getVirtualFile();
    if (virtualFile != null) {
      okWritable=ReadonlyStatusHandler.ensureFilesWritable(e.getProject(),virtualFile);
    }
 else {
      okWritable=psiFile.isWritable();
    }
  }
 else {
    okWritable=e.getDocument().isWritable();
  }
  return okWritable;
}
