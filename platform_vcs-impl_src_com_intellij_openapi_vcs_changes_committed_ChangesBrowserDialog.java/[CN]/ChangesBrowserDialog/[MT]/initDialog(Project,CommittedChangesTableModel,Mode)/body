{
  myProject=project;
  myChanges=changes;
  myMode=mode;
  setTitle(VcsBundle.message("dialog.title.changes.browser"));
  setCancelButtonText(CommonBundle.getCloseButtonText());
  final ModalityState currentState=ModalityState.current();
  if ((mode != Mode.Choose) && (ModalityState.NON_MODAL.equals(currentState))) {
    setModal(false);
  }
  myAppender=new AsynchConsumer<List<CommittedChangeList>>(){
    public void finished(){
      new AbstractCalledLater(myProject,ModalityState.stateForComponent(myCommittedChangesBrowser)){
        public void run(){
          myCommittedChangesBrowser.stopLoading();
        }
      }
.callMe();
    }
    public void consume(    final List<CommittedChangeList> committedChangeLists){
      new AbstractCalledLater(myProject,ModalityState.stateForComponent(myCommittedChangesBrowser)){
        public void run(){
          final boolean selectFirst=(myChanges.getRowCount() == 0) && (!committedChangeLists.isEmpty());
          myChanges.addRows(committedChangeLists);
          if (selectFirst) {
            myCommittedChangesBrowser.selectFirstIfAny();
          }
 else {
            myCommittedChangesBrowser.resortKeepSelection();
          }
        }
      }
.callMe();
    }
  }
;
  init();
}
