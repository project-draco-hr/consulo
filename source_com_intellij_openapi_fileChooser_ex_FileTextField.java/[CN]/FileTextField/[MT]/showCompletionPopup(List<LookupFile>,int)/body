{
  if (myList == null) {
    myList=new JList();
    myList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
    myList.setCellRenderer(new ColoredListCellRenderer(){
      protected void customizeCellRenderer(      final JList list,      final Object value,      final int index,      final boolean selected,      final boolean hasFocus){
        clear();
        append(((LookupFile)value).getName(),new SimpleTextAttributes(list.getFont().getStyle(),list.getForeground()));
      }
    }
);
  }
  if (myCurrentPopup != null) {
    closePopup();
  }
  myCurrentCompletion=toComplete;
  myCurrentCompletionsPos=position;
  if (myCurrentCompletion.size() == 0)   return;
  final Object selected=myList.getSelectedIndex() < myList.getModel().getSize() ? myList.getSelectedValue() : null;
  myList.setModel(new AbstractListModel(){
    public int getSize(){
      return myCurrentCompletion.size();
    }
    public Object getElementAt(    final int index){
      return myCurrentCompletion.get(index);
    }
  }
);
  if (selected != null) {
    myList.setSelectedValue(selected,true);
  }
  final PopupChooserBuilder builder=JBPopupFactory.getInstance().createListPopupBuilder(myList);
  myCurrentPopup=builder.setRequestFocus(false).setResizable(false).setCancelCalllback(new Computable<Boolean>(){
    public Boolean compute(){
      SwingUtilities.invokeLater(new Runnable(){
        public void run(){
          getField().requestFocus();
        }
      }
);
      return Boolean.TRUE;
    }
  }
).createPopup();
  myCurrentPopup.showInScreenCoordinates(getField(),getLocationForCaret());
}
