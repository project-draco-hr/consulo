{
  VirtualFile file=event.getFile();
  file.putUserData(FILE_MODULE,VfsUtil.getModuleForFile(myProject,file));
  if (!CvsUtil.fileIsUnderCvs(file))   return;
  if (!shouldProcessEvent(event,false))   return;
  LOG.assertTrue(myCommandLevel > 0);
  VirtualFile directory=file;
  LOG.info("Preserving CVS info from " + directory);
  try {
    if (event.getRequestor() != myDeletedStorage) {
      if (myDeleteHandler == null) {
        myDeleteHandler=myDeletedStorage.createDeleteHandler(myProject,this);
      }
      myDeleteHandler.addDeletedRoot(directory);
      myDeletedStorage.saveCVSInfo(VfsUtil.virtualToIoFile(directory));
    }
  }
 catch (  final IOException e) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        Messages.showMessageDialog("Cannot restore CVS admin directories: " + e.getLocalizedMessage(),"Restoring CVS Admin Directories ",Messages.getErrorIcon());
      }
    }
);
  }
}
