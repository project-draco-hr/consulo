{
  VirtualFile file=event.getFile();
  file.putUserData(FILE_VCS,ProjectLevelVcsManager.getInstance(myProject).getVcsFor(file));
  if (!CvsUtil.fileIsUnderCvs(file))   return;
  if (!shouldProcessEvent(event,false))   return;
  LOG.info("Preserving CVS info from " + file);
  try {
    if (event.getRequestor() != myDeletedStorage) {
      if (myDeleteHandler == null) {
        myDeleteHandler=myDeletedStorage.createDeleteHandler(myProject,this);
      }
      myDeleteHandler.addDeletedRoot(file);
      myDeletedStorage.saveCVSInfo(VfsUtil.virtualToIoFile(file));
    }
  }
 catch (  final IOException e) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        Messages.showMessageDialog(CvsBundle.message("message.error.cannot.restore.cvs.admin.directories",e.getLocalizedMessage()),CvsBundle.message("message.error.cannot.restore.cvs.admin.directories.title"),Messages.getErrorIcon());
      }
    }
);
  }
}
