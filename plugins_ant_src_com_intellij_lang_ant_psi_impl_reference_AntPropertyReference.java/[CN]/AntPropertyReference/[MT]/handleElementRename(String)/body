{
  final AntElement element=getElement();
  final String oldName=getCanonicalText();
  if (!oldName.equals(newElementName)) {
    final XmlAttribute attr=getAttribute();
    final XmlAttributeValue attrValue=attr.getValueElement();
    if (attrValue != null) {
      final int valueStartOffset=attrValue.getTextRange().getStartOffset() - element.getTextRange().getStartOffset() + 1;
      final String value=attr.getValue();
      final StringBuilder builder=StringBuilderSpinAllocator.alloc();
      try {
        final int startOffset=getRangeInElement().getStartOffset();
        final int endOffset=getRangeInElement().getEndOffset();
        if (valueStartOffset < startOffset) {
          builder.append(value.substring(0,startOffset - valueStartOffset));
        }
        builder.append(newElementName);
        if (endOffset < valueStartOffset + value.length()) {
          builder.append(value.substring(endOffset - valueStartOffset));
        }
        attr.setValue(builder.toString());
      }
  finally {
        StringBuilderSpinAllocator.dispose(builder);
      }
    }
  }
  return element;
}
