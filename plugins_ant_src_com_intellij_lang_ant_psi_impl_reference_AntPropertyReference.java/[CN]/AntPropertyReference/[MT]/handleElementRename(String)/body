{
  final AntElement element=getElement();
  final String oldName=getCanonicalText();
  final XmlAttribute attr=getAttribute();
  final XmlAttributeValue attrValue=attr.getValueElement();
  if (attrValue != null) {
    final int valueStartOffset=attrValue.getTextRange().getStartOffset() - element.getTextRange().getStartOffset() + 1;
    final String value=attr.getValue();
    final StringBuilder builder=StringBuilderSpinAllocator.alloc();
    try {
      final AntFile antFile=element.getAntFile();
      final AntProperty resolved=antFile != null ? antFile.getProperty(oldName) : null;
      final String prefix=resolved != null ? resolved.getPrefix() : null;
      final int startOffset=getRangeInElement().getStartOffset();
      final int endOffset=getRangeInElement().getEndOffset();
      if (valueStartOffset < startOffset) {
        builder.append(value.substring(0,startOffset - valueStartOffset));
      }
      if (prefix != null) {
        builder.append(prefix).append(".");
      }
      builder.append(newElementName);
      if (endOffset < valueStartOffset + value.length()) {
        builder.append(value.substring(endOffset - valueStartOffset));
      }
      attr.setValue(builder.toString());
    }
  finally {
      StringBuilderSpinAllocator.dispose(builder);
    }
  }
  return element;
}
