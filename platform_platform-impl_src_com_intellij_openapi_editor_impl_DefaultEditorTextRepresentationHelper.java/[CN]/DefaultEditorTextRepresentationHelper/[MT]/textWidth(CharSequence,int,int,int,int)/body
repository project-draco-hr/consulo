{
  int startToUse=start;
  int lastLineFeedIndex=StringUtil.lastIndexOf(text,'\n',start,end);
  if (lastLineFeedIndex > 0) {
    startToUse=lastLineFeedIndex + 1;
  }
  int result=0;
  mySharedKey.fontName=myColorsScheme.getEditorFontName();
  mySharedKey.fontSize=myColorsScheme.getEditorFontSize();
  mySharedKey.fontType=fontType;
  for (int i=startToUse; i < end; i++) {
    char c=text.charAt(i);
    if (c != '\t') {
      result+=charWidth(c);
      continue;
    }
    result+=EditorUtil.nextTabStop(x + result,myEditor) - result - x;
  }
  return result;
}
