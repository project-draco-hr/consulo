{
  Instruction instruction=instructionState.getInstruction();
  if (instruction instanceof MethodCallInstruction) {
    PsiCallExpression anchor=((MethodCallInstruction)instruction).getCallExpression();
    if (anchor instanceof PsiNewExpression) {
      PsiAnonymousClass anonymousClass=((PsiNewExpression)anchor).getAnonymousClass();
      if (anonymousClass != null) {
        registerNestedClosures(instructionState,anonymousClass);
      }
    }
  }
 else   if (instruction instanceof EmptyInstruction) {
    PsiElement anchor=((EmptyInstruction)instruction).getAnchor();
    if (anchor instanceof PsiDeclarationStatement) {
      for (      PsiElement element : ((PsiDeclarationStatement)anchor).getDeclaredElements()) {
        if (element instanceof PsiClass) {
          registerNestedClosures(instructionState,(PsiClass)element);
        }
      }
    }
  }
  return instruction.accept(this,instructionState.getMemoryState(),visitor);
}
