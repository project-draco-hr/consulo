{
  final PsiElement elementAtSelectionStart=file.findElementAt(selectionStart);
  if (!(elementAtSelectionStart instanceof PsiJavaToken)) {
    return null;
  }
  final IElementType tokenType=((PsiJavaToken)elementAtSelectionStart).getTokenType();
  if ((tokenType != JavaTokenType.STRING_LITERAL && tokenType != JavaTokenType.CHARACTER_LITERAL)) {
    return null;
  }
  if (elementAtSelectionStart.getTextRange().getEndOffset() < selectionEnd) {
    final PsiElement elementAtSelectionEnd=file.findElementAt(selectionEnd);
    if (!(elementAtSelectionEnd instanceof PsiJavaToken)) {
      return null;
    }
    PsiJavaToken tokenAtSelectionEnd=(PsiJavaToken)elementAtSelectionEnd;
    if (tokenAtSelectionEnd.getTokenType() == tokenType && tokenAtSelectionEnd.getTextRange().getStartOffset() < selectionEnd) {
      return tokenType;
    }
  }
  final TextRange textRange=elementAtSelectionStart.getTextRange();
  if (selectionStart <= textRange.getStartOffset() || selectionEnd >= textRange.getEndOffset()) {
    return null;
  }
  return tokenType;
}
