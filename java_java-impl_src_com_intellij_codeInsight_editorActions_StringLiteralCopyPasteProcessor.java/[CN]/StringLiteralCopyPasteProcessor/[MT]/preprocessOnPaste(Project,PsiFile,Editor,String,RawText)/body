{
  final Document document=editor.getDocument();
  PsiDocumentManager.getInstance(project).commitDocument(document);
  final SelectionModel selectionModel=editor.getSelectionModel();
  final int selectionStart=selectionModel.getSelectionStart();
  final int selectionEnd=selectionModel.getSelectionEnd();
  IElementType tokenType=findLiteralTokenType(file,selectionStart,selectionEnd);
  if (tokenType == JavaTokenType.STRING_LITERAL) {
    if (rawText != null && rawText.rawText != null)     return rawText.rawText;
    StringBuilder buffer=new StringBuilder(text.length());
    CodeStyleSettings codeStyleSettings=CodeStyleSettingsManager.getSettings(project);
    @NonNls String breaker=codeStyleSettings.BINARY_OPERATION_SIGN_ON_NEXT_LINE ? "\\n\"\n+ \"" : "\\n\" +\n\"";
    final String[] lines=LineTokenizer.tokenize(text.toCharArray(),false,true);
    for (int i=0; i < lines.length; i++) {
      String line=lines[i];
      buffer.append(StringUtil.escapeStringCharacters(line));
      if (i != lines.length - 1)       buffer.append(breaker);
    }
    text=buffer.toString();
  }
 else   if (tokenType == JavaTokenType.CHARACTER_LITERAL) {
    if (rawText != null && rawText.rawText != null)     return rawText.rawText;
    return escapeCharCharacters(text);
  }
 else {
    text=escapePastedLiteral(text);
  }
  return text;
}
