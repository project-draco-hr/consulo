{
  StringBuilder buffer=new StringBuilder();
  int literalStart=-1;
  int literalEnd=0;
  for (int i=0; i < s.length(); i++) {
    char c=s.charAt(i);
switch (c) {
case '\\':
      i++;
    break;
case '"':
  if (literalStart < 0) {
    literalStart=i + 1;
    buffer.append(s,literalEnd,literalStart);
  }
 else {
    literalEnd=i;
    buffer.append(StringUtil.escapeStringCharacters(s.substring(literalStart,literalEnd)));
    literalStart=-1;
  }
}
}
if (literalEnd < s.length()) {
buffer.append(s.substring(Math.max(literalStart,literalEnd)));
}
return buffer.toString();
}
