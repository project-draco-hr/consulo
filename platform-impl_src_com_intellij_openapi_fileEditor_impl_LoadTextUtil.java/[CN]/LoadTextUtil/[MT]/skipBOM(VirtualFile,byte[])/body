{
  if (Patches.SUN_BUG_ID_4508058) {
    if (virtualFile.getCharset() != null && virtualFile.getCharset().name().contains(CharsetToolkit.UTF8) && CharsetToolkit.hasUTF8Bom(content)) {
      virtualFile.setBOM(CharsetToolkit.UTF8_BOM);
      return CharsetToolkit.UTF8_BOM.length;
    }
  }
  if (CharsetToolkit.hasUTF16LEBom(content)) {
    virtualFile.setBOM(CharsetToolkit.UTF16LE_BOM);
    return CharsetToolkit.UTF16LE_BOM.length;
  }
  if (CharsetToolkit.hasUTF16BEBom(content)) {
    virtualFile.setBOM(CharsetToolkit.UTF16BE_BOM);
    return CharsetToolkit.UTF16BE_BOM.length;
  }
  return 0;
}
