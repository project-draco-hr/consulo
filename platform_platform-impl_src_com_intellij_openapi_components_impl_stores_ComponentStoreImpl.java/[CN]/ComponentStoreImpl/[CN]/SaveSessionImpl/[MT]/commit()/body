{
  final StateStorageManager storageManager=getStateStorageManager();
  final StateStorageManager.ExternalizationSession session=storageManager.startExternalization();
  String[] names=ArrayUtil.toStringArray(myComponents.keySet());
  Arrays.sort(names);
  for (  String name : names) {
    Object component=myComponents.get(name);
    if (component instanceof PersistentStateComponent) {
      commitPersistentComponent((PersistentStateComponent<?>)component,session);
    }
 else     if (component instanceof JDOMExternalizable) {
      session.setStateInOldStorage(component,ComponentManagerImpl.getComponentName(component),component);
    }
  }
  myStorageManagerSaveSession=storageManager.startSave(session);
}
