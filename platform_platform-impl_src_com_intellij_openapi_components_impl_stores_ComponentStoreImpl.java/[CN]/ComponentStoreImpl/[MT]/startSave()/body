{
  ExternalizationSession externalizationSession=myComponents.isEmpty() ? null : getStateStorageManager().startExternalization();
  if (externalizationSession != null) {
    String[] names=ArrayUtilRt.toStringArray(myComponents.keySet());
    Arrays.sort(names);
    for (    String name : names) {
      Object component=myComponents.get(name);
      if (component instanceof PersistentStateComponent) {
        commitPersistentComponent((PersistentStateComponent<?>)component,externalizationSession);
      }
 else       if (component instanceof JDOMExternalizable) {
        externalizationSession.setStateInOldStorage(component,ComponentManagerImpl.getComponentName(component),component);
      }
    }
  }
  return createSaveSession(externalizationSession == null ? null : externalizationSession.createSaveSession());
}
