{
  final String componentName=ComponentManagerImpl.getComponentName(component);
  doAddComponent(componentName,component);
  if (optimizeTestLoading())   return componentName;
  loadJdomDefaults(component,componentName);
  StateStorage stateStorage=getOldStorage(component,componentName,StateStorageOperation.READ);
  if (stateStorage == null)   return null;
  Element element=getJdomState(component,componentName,stateStorage);
  if (element == null)   return null;
  try {
    if (LOG.isDebugEnabled()) {
      LOG.debug("Loading configuration for " + component.getClass());
    }
    component.readExternal(element);
  }
 catch (  InvalidDataException e) {
    throw new InvalidComponentDataException(e);
  }
  validateUnusedMacros(componentName,true);
  return componentName;
}
