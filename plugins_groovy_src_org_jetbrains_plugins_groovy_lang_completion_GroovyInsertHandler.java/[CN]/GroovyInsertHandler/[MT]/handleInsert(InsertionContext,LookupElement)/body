{
  @NonNls Object obj=((MutableLookupElement)item).getObject();
  if (obj instanceof PsiMethod) {
    PsiMethod method=(PsiMethod)obj;
    PsiParameter[] parameters=method.getParameterList().getParameters();
    Editor editor=context.getEditor();
    Document document=editor.getDocument();
    if (context.getCompletionChar() == Lookup.REPLACE_SELECT_CHAR) {
      handleOverwrite(editor.getCaretModel().getOffset(),document);
    }
    CaretModel caretModel=editor.getCaretModel();
    int offset=context.getStartOffset() + method.getName().length();
    PsiFile file=PsiDocumentManager.getInstance(method.getProject()).getPsiFile(document);
    PsiElement elementAt=file.findElementAt(context.getStartOffset());
    PsiElement parent=elementAt != null ? elementAt.getParent() : null;
    if (parent instanceof GrReferenceExpression && ((GrReferenceExpression)parent).getDotTokenType() == GroovyElementTypes.mMEMBER_POINTER)     return;
    if (parent instanceof GrAnnotationNameValuePair || parent.getParent() instanceof GrAnnotationNameValuePair) {
      document.insertString(offset," = ");
      caretModel.moveToOffset(offset + 3);
      return;
    }
    if (PsiTreeUtil.getParentOfType(elementAt,GrImportStatement.class) != null)     return;
    if (parameters.length == 0) {
      if (offset == document.getTextLength() || document.getCharsSequence().charAt(offset) != '(') {
        document.insertString(offset,"()");
      }
      caretModel.moveToOffset(offset + 2);
    }
 else {
      if (parameters.length == 1 && CLOSURE_CLASS.equals(parameters[0].getType().getCanonicalText())) {
        document.insertString(offset," {}");
        caretModel.moveToOffset(offset + 2);
      }
 else {
        PsiDocumentManager docManager=PsiDocumentManager.getInstance(method.getProject());
        docManager.commitDocument(document);
        PsiFile psiFile=docManager.getPsiFile(document);
        if (isExpressionStatement(psiFile,context.getStartOffset()) && PsiType.VOID.equals(method.getReturnType())) {
          document.insertString(offset," ");
        }
 else         if (!document.getText().substring(offset).trim().startsWith("(")) {
          document.insertString(offset,"()");
          caretModel.moveToOffset(offset + 1);
        }
      }
    }
    return;
  }
 else   if (obj instanceof String && !"assert".equals(obj)) {
    Editor editor=context.getEditor();
    Document document=editor.getDocument();
    if (context.getCompletionChar() == Lookup.REPLACE_SELECT_CHAR) {
      handleOverwrite(editor.getCaretModel().getOffset(),document);
    }
  }
  addTailType((MutableLookupElement)item);
  super.handleInsert(context,item);
}
