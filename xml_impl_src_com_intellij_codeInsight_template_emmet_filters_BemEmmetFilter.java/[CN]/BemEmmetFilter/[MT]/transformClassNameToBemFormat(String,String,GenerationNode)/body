{
  Pair<String,Integer> cleanStringAndDepth=getCleanStringAndDepth(className,separator);
  Integer depth=cleanStringAndDepth.second;
  if (depth > 0) {
    GenerationNode donor=node;
    while (donor.getParent() != null && depth > 0) {
      donor=donor.getParent();
      depth--;
    }
    String prefix=donor.getUserData(BEM_BLOCK);
    if (!isNullOrEmpty(prefix)) {
      String element=donor.getUserData(BEM_ELEMENT);
      if (MODIFIER_SEPARATOR.equals(separator) && !isNullOrEmpty(element)) {
        prefix=prefix + separator + element;
      }
      return prefix + separator + cleanStringAndDepth.first;
    }
  }
  return className;
}
