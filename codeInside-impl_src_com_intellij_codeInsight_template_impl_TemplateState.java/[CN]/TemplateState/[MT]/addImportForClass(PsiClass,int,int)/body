{
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  if (!aClass.isValid() || aClass.getQualifiedName() == null)   return;
  PsiManager manager=PsiManager.getInstance(myProject);
  PsiResolveHelper helper=manager.getResolveHelper();
  final PsiFile file=PsiDocumentManager.getInstance(myProject).getPsiFile(myDocument);
  CharSequence chars=myDocument.getCharsSequence();
  PsiElement element=file.findElementAt(startOffset);
  String refText=chars.subSequence(startOffset,endOffset).toString();
  PsiClass refClass=helper.resolveReferencedClass(refText,element);
  if (aClass.equals(refClass))   return;
  if (element instanceof PsiIdentifier) {
    PsiElement parent=element.getParent();
    while (parent != null) {
      PsiElement tmp=parent.getParent();
      if (!(tmp instanceof PsiJavaCodeReferenceElement) || tmp.getTextRange().getEndOffset() > endOffset)       break;
      parent=tmp;
    }
    if (parent instanceof PsiJavaCodeReferenceElement && !((PsiJavaCodeReferenceElement)parent).isQualified()) {
      final PsiJavaCodeReferenceElement ref=(PsiJavaCodeReferenceElement)parent;
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          try {
            ref.bindToElement(aClass);
          }
 catch (          IncorrectOperationException e) {
            LOG.error(e);
          }
        }
      }
);
    }
  }
}
