{
  String oldText=myDocument.getCharsSequence().subSequence(start,end).toString();
  if (!oldText.equals(newValue)) {
    myDocument.replaceString(start,end,newValue);
    PsiDocumentManager.getInstance(myProject).commitDocument(myDocument);
    mySegments.replaceSegmentAt(segmentNumber,start,start + newValue.length());
  }
}
