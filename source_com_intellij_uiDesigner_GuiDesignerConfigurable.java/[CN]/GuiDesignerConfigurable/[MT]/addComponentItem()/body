{
  final TreePath path=myPaletteUI.myTree.getSelectionPath();
  final DefaultMutableTreeNode lastPathComponent=(DefaultMutableTreeNode)path.getLastPathComponent();
  LOG.assertTrue(lastPathComponent != null);
  final DefaultMutableTreeNode groupNode;
  if (lastPathComponent.getUserObject() instanceof GroupItem) {
    groupNode=lastPathComponent;
  }
 else {
    final Object userObject=lastPathComponent.getUserObject();
    if (userObject instanceof ComponentItem) {
      groupNode=(DefaultMutableTreeNode)lastPathComponent.getParent();
    }
 else {
      throw new RuntimeException("unknown user object: " + lastPathComponent.getUserObject());
    }
  }
  LOG.assertTrue(groupNode != null);
  final ComponentItem itemToBeAdded=new ComponentItem("",null,null,new GridConstraints(),new HashMap<String,StringDescriptor>(),true);
  final ComponentItemDialog dialog=new ComponentItemDialog(myProject,myPaletteUI.myPanel,itemToBeAdded);
  dialog.setTitle("Add Component");
  dialog.show();
  if (!dialog.isOK()) {
    return;
  }
  final GroupItem groupItem=(GroupItem)groupNode.getUserObject();
  if (groupItem.containsItem(itemToBeAdded)) {
    return;
  }
  groupItem.addItem(itemToBeAdded);
  final DefaultMutableTreeNode itemNode=new DefaultMutableTreeNode(itemToBeAdded);
  groupNode.add(itemNode);
  final DefaultTreeModel model=(DefaultTreeModel)myPaletteUI.myTree.getModel();
  model.nodeStructureChanged(groupNode);
  TreeUtil.selectNode(myPaletteUI.myTree,itemNode);
}
