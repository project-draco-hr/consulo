{
  final int componentCount=getComponentCount();
  LOG.assertTrue(componentCount <= bounds.size());
  final boolean actualLayout=bounds == myComponentBounds;
  if (actualLayout) {
    myAutoPopupRec=null;
  }
  int autoButtonSize=myAutoPopupIcon.getIconWidth();
  boolean full=false;
  if (myOrientation == SwingConstants.HORIZONTAL) {
    int eachX=0;
    int eachY=0;
    for (int i=0; i < componentCount; i++) {
      final Rectangle eachBound=new Rectangle(getComponent(i).getPreferredSize());
      if (!full) {
        boolean outside;
        if (i < componentCount - 1) {
          outside=eachX + eachBound.width + autoButtonSize <= sizeToFit.width;
        }
 else {
          outside=eachX + eachBound.width <= sizeToFit.width;
        }
        if (outside) {
          eachBound.x=eachX;
          eachBound.y=eachY;
          eachX+=eachBound.width;
        }
 else {
          full=true;
        }
      }
      if (full) {
        if (myAutoPopupRec == null) {
          myAutoPopupRec=new Rectangle(eachX,eachY,sizeToFit.width - eachX - 1,sizeToFit.height - 1);
          myFirstOusideIndex=i;
        }
        eachBound.x=Integer.MAX_VALUE;
        eachBound.y=Integer.MAX_VALUE;
      }
      bounds.get(i).setBounds(eachBound);
    }
  }
 else {
    int eachX=0;
    int eachY=0;
    for (int i=0; i < componentCount; i++) {
      final Rectangle eachBound=new Rectangle(getComponent(i).getPreferredSize());
      if (!full) {
        boolean outside;
        if (i < componentCount - 1) {
          outside=eachY + eachBound.height + autoButtonSize < sizeToFit.height;
        }
 else {
          outside=eachY + eachBound.height < sizeToFit.height;
        }
        if (outside) {
          eachBound.x=eachX;
          eachBound.y=eachY;
          eachY+=eachBound.height;
        }
 else {
          full=true;
        }
      }
      if (full) {
        if (myAutoPopupRec == null) {
          myAutoPopupRec=new Rectangle(eachX,eachY,sizeToFit.width - 1,sizeToFit.height - eachY - 1);
          myFirstOusideIndex=i;
        }
        eachBound.x=Integer.MAX_VALUE;
        eachBound.y=Integer.MAX_VALUE;
      }
      bounds.get(i).setBounds(eachBound);
    }
  }
}
