{
  ApplicationManager.getApplication().assertIsDispatchThread();
  myNewVisibleActions.clear();
  final DataContext dataContext=getDataContext();
  Utils.expandActionGroup(myActionGroup,myNewVisibleActions,myPresentationFactory,dataContext,myPlace,myActionManager);
  if (!myNewVisibleActions.equals(myVisibleActions)) {
    final boolean changeBarVisibility=myNewVisibleActions.isEmpty() || myVisibleActions.isEmpty();
    final ArrayList<AnAction> temp=myVisibleActions;
    myVisibleActions=myNewVisibleActions;
    myNewVisibleActions=temp;
    removeAll();
    fillToolBar(myVisibleActions);
    if (changeBarVisibility) {
      revalidate();
    }
 else {
      final Container parent=getParent();
      if (parent != null) {
        parent.invalidate();
        parent.validate();
      }
    }
    repaint();
  }
}
