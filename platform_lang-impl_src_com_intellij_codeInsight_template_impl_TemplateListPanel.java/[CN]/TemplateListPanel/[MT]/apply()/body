{
  List<TemplateGroup> templateGroups=getTemplateGroups();
  for (  TemplateGroup templateGroup : templateGroups) {
    Set<String> names=Sets.newHashSet();
    for (    TemplateImpl template : templateGroup.getElements()) {
      if (StringUtil.isEmptyOrSpaces(template.getKey())) {
        throw new ConfigurationException("A live template with an empty key has been found in " + templateGroup.getName() + " group, such live templates cannot be invoked");
      }
      if (StringUtil.isEmptyOrSpaces(template.getString())) {
        throw new ConfigurationException("A live template with an empty text has been found in " + templateGroup.getName() + " group, such live templates cannot be invoked");
      }
      if (!names.add(template.getKey())) {
        throw new ConfigurationException("Duplicate " + template.getKey() + " live templates in "+ templateGroup.getName()+ " group");
      }
      if (!TemplateImplUtil.validateTemplateText(template.getString())) {
        throw new ConfigurationException("Malformed " + template.getKey() + " live template in "+ templateGroup.getName()+ " group");
      }
    }
  }
  for (  TemplateGroup templateGroup : templateGroups) {
    for (    TemplateImpl template : templateGroup.getElements()) {
      template.applyOptions(getOptions(template));
      template.applyContext(getContext(template));
    }
  }
  TemplateSettings templateSettings=TemplateSettings.getInstance();
  templateSettings.setTemplates(templateGroups);
  templateSettings.setDefaultShortcutChar(getDefaultShortcutChar());
  reset();
}
