{
  List<TreePath> toSelect=new ArrayList<TreePath>();
  for (  TemplateImpl template : map.keySet()) {
    DefaultMutableTreeNode oldTemplateNode=map.get(template);
    TemplateGroup oldGroup=getTemplateGroup(template.getGroupName());
    if (oldGroup != null) {
      oldGroup.removeElement(template);
    }
    template.setGroupName(newGroupName);
    DefaultMutableTreeNode parent=(DefaultMutableTreeNode)oldTemplateNode.getParent();
    removeNodeFromParent(oldTemplateNode);
    if (parent.getChildCount() == 0)     removeNodeFromParent(parent);
    toSelect.add(new TreePath(registerTemplate(template).getPath()));
  }
  myTree.getSelectionModel().clearSelection();
  for (  TreePath path : toSelect) {
    myTree.expandPath(path.getParentPath());
    myTree.addSelectionPath(path);
    myTree.scrollRowToVisible(myTree.getRowForPath(path));
  }
}
