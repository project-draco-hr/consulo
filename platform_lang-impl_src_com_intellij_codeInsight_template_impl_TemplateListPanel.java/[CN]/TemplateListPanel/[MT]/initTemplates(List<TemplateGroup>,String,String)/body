{
  myTreeRoot.removeAllChildren();
  myTemplateGroups.clear();
  for (  TemplateGroup group : groups) {
    myTemplateGroups.add((TemplateGroup)group.copy());
  }
  for (  TemplateGroup group : myTemplateGroups) {
    CheckedTreeNode groupNode=new CheckedTreeNode(group);
    addTemplateNodes(group,groupNode);
    myTreeRoot.add(groupNode);
  }
  fireStructureChange();
  for (int i=0; i < myTree.getRowCount(); i++) {
    TemplateGroup group=getGroup(i);
    TemplateImpl template=getTemplate(i);
    if (template != null && Comparing.equal(lastSelectedKey,template.getKey()) || group != null && Comparing.equal(lastSelectedGroup,group.getName())) {
      TreePath path=myTree.getPathForRow(i);
      myTree.expandPath(path);
      int rowToSelect=myTree.getRowForPath(path);
      myTree.setSelectionRow(rowToSelect);
      myTree.scrollRowToVisible(rowToSelect);
      return;
    }
  }
}
