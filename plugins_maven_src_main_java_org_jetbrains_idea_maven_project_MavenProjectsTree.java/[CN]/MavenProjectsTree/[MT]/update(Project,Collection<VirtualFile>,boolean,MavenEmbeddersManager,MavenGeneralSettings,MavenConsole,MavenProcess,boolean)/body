{
  if (files.isEmpty())   return;
  MavenEmbedderWrapper embedder=embeddersManager.getEmbedder();
  embedder.customizeForRead(this,console,process);
  Map<VirtualFile,MavenProject> readProjects=new LinkedHashMap<VirtualFile,MavenProject>();
  try {
    Stack<MavenProject> updateStack=new Stack<MavenProject>();
    for (    VirtualFile each : files) {
      MavenProject mavenProject=findProject(each);
      if (mavenProject == null) {
        doAdd(project,each,quickUpdate,embedder,readProjects,updateStack,generalSettings,process,recursive);
      }
 else {
        doUpdate(project,findAggregator(mavenProject),mavenProject,quickUpdate,embedder,false,readProjects,updateStack,generalSettings,process,recursive);
      }
    }
  }
  finally {
    embeddersManager.release(embedder);
  }
  if (quickUpdate) {
    fireProjectsRead(new ArrayList<MavenProject>(readProjects.values()));
  }
}
