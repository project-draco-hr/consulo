{
  MavenEmbedderWrapper e=MavenEmbedderFactory.createEmbedderForRead(mavenSettings,null,this);
  try {
    Set<VirtualFile> readFiles=new HashSet<VirtualFile>();
    Stack<MavenProjectModel> updateStack=new Stack<MavenProjectModel>();
    for (    VirtualFile each : files) {
      MavenProjectModel project=findProject(each);
      if (project == null) {
        doAdd(each,e,readFiles,updateStack,p,force);
      }
 else {
        doUpdate(findAggregator(project),project,e,false,readFiles,updateStack,p,force);
      }
    }
  }
  finally {
    e.release();
  }
}
