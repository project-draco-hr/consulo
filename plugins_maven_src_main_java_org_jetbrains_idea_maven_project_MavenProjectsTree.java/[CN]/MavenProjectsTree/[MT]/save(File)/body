{
synchronized (myStateLock) {
    readLock();
    try {
      file.getParentFile().mkdirs();
      DataOutputStream out=new DataOutputStream(new BufferedOutputStream(new FileOutputStream(file)));
      try {
        out.writeUTF(STORAGE_VERSION);
        writeCollection(out,myManagedFilesPaths);
        writeCollection(out,myIgnoredFilesPaths);
        writeCollection(out,myIgnoredFilesPatterns);
        writeCollection(out,myExplicitProfiles);
        writeProjectsRecursively(out,myRootProjects);
      }
  finally {
        out.close();
      }
    }
  finally {
      readUnlock();
    }
  }
}
