{
synchronized (myStateLock) {
    readLock();
    try {
      file.getParentFile().mkdirs();
      FileOutputStream fs=new FileOutputStream(file);
      DataOutputStream out=new DataOutputStream(fs);
      try {
        out.writeUTF(STORAGE_VERSION);
        writeCollection(out,myManagedFilesPaths);
        writeCollection(out,myIgnoredFilesPaths);
        writeCollection(out,myIgnoredFilesPatterns);
        writeCollection(out,myExplicitProfiles);
        writeProjectsRecursively(out,myRootProjects);
      }
  finally {
        out.close();
        fs.close();
      }
    }
  finally {
      readUnlock();
    }
  }
}
