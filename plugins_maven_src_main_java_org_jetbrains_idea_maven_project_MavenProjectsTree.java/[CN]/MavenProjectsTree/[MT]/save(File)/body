{
  readLock();
  try {
    file.getParentFile().mkdirs();
    FileOutputStream fs=new FileOutputStream(file);
    DataOutputStream out=new DataOutputStream(fs);
    try {
      out.writeUTF(STORAGE_VERSION);
      writeList(out,myManagedFilesPaths);
      writeList(out,myIgnoredFilesPaths);
      writeList(out,myIgnoredFilesPatterns);
      writeList(out,myActiveProfiles);
      writeProjectsRecursively(out,myRootProjects);
    }
  finally {
      out.close();
      fs.close();
    }
  }
  finally {
    readUnlock();
  }
}
