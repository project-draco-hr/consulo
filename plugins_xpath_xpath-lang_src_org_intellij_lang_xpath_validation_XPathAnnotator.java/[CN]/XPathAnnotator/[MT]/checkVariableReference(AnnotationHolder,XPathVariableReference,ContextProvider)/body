{
  if (reference.resolve() == null) {
    final VariableContext variableResolver=contextProvider.getVariableContext();
    if (variableResolver == null)     return;
    if (!variableResolver.canResolve()) {
      final Object[] variablesInScope=variableResolver.getVariablesInScope(reference);
      if (variablesInScope instanceof String[]) {
        final Set<String> variables=new HashSet<String>(Arrays.asList((String[])variablesInScope));
        if (!variables.contains(reference.getReferencedName())) {
          markUnresolvedVariable(reference,holder);
        }
      }
 else       if (variablesInScope instanceof QName[]) {
        final Set<QName> variables=new HashSet<QName>(Arrays.asList((QName[])variablesInScope));
        if (!variables.contains(contextProvider.getQName(reference))) {
          markUnresolvedVariable(reference,holder);
        }
      }
    }
 else {
      markUnresolvedVariable(reference,holder);
    }
  }
}
