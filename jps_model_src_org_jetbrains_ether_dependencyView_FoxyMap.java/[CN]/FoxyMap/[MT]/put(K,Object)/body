{
  final Object c=get(key);
  if (c == null) {
    map.put(key,value);
  }
 else {
    if (c instanceof Collection) {
      if (value instanceof Collection) {
        ((Collection)c).addAll((Collection)value);
      }
 else {
        ((Collection)c).add(value);
      }
    }
 else {
      final Collection d=constr.create();
      d.add(c);
      if (value instanceof Collection) {
        d.addAll((Collection)value);
      }
 else {
        d.add(value);
      }
      map.put(key,d);
    }
  }
  return c;
}
