{
  myFinished=true;
  final TemplateState templateState=TemplateManagerImpl.getTemplateState(myEditor);
  if (templateState != null) {
    myEditor.putUserData(ACTIVE_INTRODUCE,null);
  }
  if (myDocumentAdapter != null) {
    myEditor.getDocument().removeDocumentListener(myDocumentAdapter);
  }
  if (myBalloon == null) {
    releaseIfNotRestart();
  }
  super.finish();
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  final V variable=getVariable();
  if (variable == null) {
    return;
  }
  restoreState(variable);
}
