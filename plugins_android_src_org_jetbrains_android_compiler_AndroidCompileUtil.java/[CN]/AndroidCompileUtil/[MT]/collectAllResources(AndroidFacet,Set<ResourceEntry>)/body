{
  final LocalResourceManager manager=facet.getLocalResourceManager();
  final Project project=facet.getModule().getProject();
  for (  final ResourceType resType : AndroidResourceUtil.VALUE_RESOURCE_TYPES) {
    for (    final ResourceElement element : manager.getValueResources(resType.getName())) {
      waitForSmartMode(project);
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        @Override public void run(){
          if (!element.isValid() || facet.getModule().isDisposed() || project.isDisposed()) {
            return;
          }
          final String name=element.getName().getValue();
          if (name != null) {
            resourceSet.add(new ResourceEntry(resType.getName(),name));
          }
        }
      }
);
    }
  }
  for (  final Pair<Resources,VirtualFile> pair : manager.getResourceElements()) {
    final Resources resources=pair.getFirst();
    waitForSmartMode(project);
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      @Override public void run(){
        if (!resources.isValid() || facet.getModule().isDisposed() || project.isDisposed()) {
          return;
        }
        for (        final Attr attr : resources.getAttrs()) {
          final String name=attr.getName().getValue();
          if (name != null) {
            resourceSet.add(new ResourceEntry(ResourceType.ATTR.getName(),name));
          }
        }
        for (        final DeclareStyleable styleable : resources.getDeclareStyleables()) {
          final String name=styleable.getName().getValue();
          if (name != null) {
            resourceSet.add(new ResourceEntry(ResourceType.DECLARE_STYLEABLE.getName(),name));
          }
        }
      }
    }
);
  }
  waitForSmartMode(project);
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    @Override public void run(){
      if (facet.getModule().isDisposed() || project.isDisposed()) {
        return;
      }
      for (      String id : manager.getIds()) {
        resourceSet.add(new ResourceEntry(ResourceType.ID.getName(),id));
      }
    }
  }
);
  final HashSet<VirtualFile> visited=new HashSet<VirtualFile>();
  for (  VirtualFile subdir : manager.getResourceSubdirs(null)) {
    final HashSet<VirtualFile> resourceFiles=new HashSet<VirtualFile>();
    AndroidUtils.collectFiles(subdir,visited,resourceFiles);
    for (    VirtualFile file : resourceFiles) {
      final String subdirName=subdir.getName();
      final int index=subdirName.indexOf('-');
      final String type=index >= 0 ? subdirName.substring(0,index) : subdirName;
      resourceSet.add(new ResourceEntry(type,FileUtil.getNameWithoutExtension(file.getName())));
    }
  }
}
