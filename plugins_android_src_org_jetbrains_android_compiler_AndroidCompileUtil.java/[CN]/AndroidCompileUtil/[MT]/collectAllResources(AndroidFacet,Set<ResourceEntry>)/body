{
  final LocalResourceManager manager=facet.getLocalResourceManager();
  final Project project=facet.getModule().getProject();
  final DumbService dumbService=DumbService.getInstance(project);
  for (  final String resType : ResourceType.getNames()) {
    for (    final ResourceElement element : manager.getValueResources(resType)) {
      dumbService.waitForSmartMode();
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        @Override public void run(){
          if (!element.isValid() || facet.getModule().isDisposed() || project.isDisposed()) {
            return;
          }
          final String name=element.getName().getValue();
          if (name != null) {
            resourceSet.add(new ResourceEntry(resType,name));
          }
        }
      }
);
    }
  }
  for (  final Resources resources : manager.getResourceElements()) {
    dumbService.waitForSmartMode();
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      @Override public void run(){
        if (!resources.isValid() || facet.getModule().isDisposed() || project.isDisposed()) {
          return;
        }
        for (        final Attr attr : resources.getAttrs()) {
          final String name=attr.getName().getValue();
          if (name != null) {
            resourceSet.add(new ResourceEntry(ResourceType.ATTR.getName(),name));
          }
        }
        for (        final DeclareStyleable styleable : resources.getDeclareStyleables()) {
          final String name=styleable.getName().getValue();
          if (name != null) {
            resourceSet.add(new ResourceEntry(ResourceType.DECLARE_STYLEABLE.getName(),name));
          }
        }
      }
    }
);
  }
  dumbService.waitForSmartMode();
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    @Override public void run(){
      if (facet.getModule().isDisposed() || project.isDisposed()) {
        return;
      }
      for (      String id : manager.getIds()) {
        resourceSet.add(new ResourceEntry(ResourceType.ID.getName(),id));
      }
    }
  }
);
  final HashSet<VirtualFile> visited=new HashSet<VirtualFile>();
  for (  VirtualFile subdir : manager.getResourceSubdirs(null)) {
    final HashSet<VirtualFile> resourceFiles=new HashSet<VirtualFile>();
    AndroidUtils.collectFiles(subdir,visited,resourceFiles);
    for (    VirtualFile file : resourceFiles) {
      resourceSet.add(new ResourceEntry(subdir.getName(),file.getName()));
    }
  }
}
