{
  detectCharset(virtualFile,bytes);
  final Pair<Integer,Charset> offsetAndCharset=detectAndSetBOM(virtualFile,bytes);
  final Pair<CharSequence,String> result=convertBytes(bytes,offsetAndCharset.second,offsetAndCharset.first);
  if (rememberDetectedSeparators) {
    virtualFile.putUserData(DETECTED_LINE_SEPARATOR_KEY,result.getSecond());
  }
  return result.getFirst();
}
