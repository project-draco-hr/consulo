{
  myProject=project;
  project.getMessageBus().connect().subscribe(ProjectTopics.MODIFICATION_TRACKER,new PsiModificationTracker.Listener(){
    public void modificationCountChanged(){
      if (!isInsideAtomicChange()) {
        clearCache();
      }
    }
  }
);
  ((PsiManagerEx)psiManager).registerRunnableToRunOnChange(new Runnable(){
    public void run(){
      if (!isInsideAtomicChange()) {
        clearCache();
      }
    }
  }
);
  myProducers=collectProducers();
  myInheritors=cacheKeyHierarchy(myProducers.keySet());
  final LowMemoryWatcher watcher=LowMemoryWatcher.register(new LowMemoryWatcher.ForceableAdapter(){
    public void force(){
      myCache.clear();
    }
  }
);
  ProjectManager.getInstance().addProjectManagerListener(project,new ProjectManagerAdapter(){
    public void projectClosing(    Project project){
      watcher.stop();
    }
  }
);
}
