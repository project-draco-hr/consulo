{
  if (psiElement instanceof PsiFile) {
    final PsiFile movedFile=(PsiFile)psiElement;
    FileReferenceContextUtil.encodeFileReferences(psiElement);
    MoveFileHandler.forElement(movedFile).prepareMovedFile(movedFile,movedFile.getParent(),oldToNewMap);
    movedFiles.add(movedFile);
  }
 else   if (psiElement instanceof PsiDirectory) {
    for (    PsiElement element : psiElement.getChildren()) {
      processDirectoryFiles(movedFiles,oldToNewMap,element);
    }
  }
}
