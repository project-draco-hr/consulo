{
  GraphicsConfiguration targetGC=null;
  final GraphicsEnvironment env=GraphicsEnvironment.getLocalGraphicsEnvironment();
  final GraphicsDevice[] devices=env.getScreenDevices();
  double distance=-1;
  GraphicsConfiguration bestConfig=null;
  for (  GraphicsDevice device : devices) {
    final GraphicsConfiguration config=device.getDefaultConfiguration();
    final Rectangle rect=config.getBounds();
    final Insets insets=Toolkit.getDefaultToolkit().getScreenInsets(config);
    if (insets != null) {
      rect.x+=insets.left;
      rect.width-=(insets.left + insets.right);
      rect.y+=insets.top;
      rect.height-=(insets.top + insets.bottom);
    }
    if (rect.contains(p)) {
      targetGC=config;
      break;
    }
 else {
      final double d=findNearestPointOnBorder(rect,p).distance(p.x,p.y);
      if (bestConfig == null || distance > d) {
        distance=d;
        bestConfig=config;
      }
    }
  }
  if (targetGC == null && devices.length > 0 && bestConfig != null) {
    targetGC=bestConfig;
  }
  if (targetGC == null) {
    throw new IllegalStateException("It's impossible to determine target graphics environment for point (" + p.x + ","+ p.y+ ")");
  }
  final Insets insets=Toolkit.getDefaultToolkit().getScreenInsets(targetGC);
  Rectangle targetRect=targetGC.getBounds();
  targetRect.x+=insets.left;
  targetRect.y+=insets.top;
  targetRect.width-=insets.left + insets.right;
  targetRect.height-=insets.top + insets.bottom;
  return targetRect;
}
