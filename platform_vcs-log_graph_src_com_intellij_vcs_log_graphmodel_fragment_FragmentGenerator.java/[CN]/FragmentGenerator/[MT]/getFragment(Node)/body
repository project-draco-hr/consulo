{
  int countTry=SEARCH_LIMIT;
  GraphFragment downFragment=null;
  while (countTry > 0 && ((downFragment=getMaximumDownFragment(node)) == null)) {
    countTry--;
    if (node.getUpEdges().isEmpty()) {
      return null;
    }
 else {
      node=node.getUpEdges().get(0).getUpNode();
    }
  }
  if (downFragment == null) {
    return null;
  }
  GraphFragment upFragment=getMaximumUpFragment(node);
  if (upFragment == null) {
    return downFragment;
  }
 else {
    Set<Node> intermediateNodes=new HashSet<Node>(downFragment.getIntermediateNodes());
    intermediateNodes.addAll(upFragment.getIntermediateNodes());
    intermediateNodes.add(node);
    return new SimpleGraphFragment(upFragment.getUpNode(),downFragment.getDownNode(),intermediateNodes);
  }
}
