{
  if (myDetectedRoots == null) {
    myDetectedRoots=new GitRootDetector(myProject,myPlatformFacade).detect().getRoots();
  }
  ArrayList<VirtualFile> roots=new ArrayList<VirtualFile>();
  if (hasProjectMapping()) {
    roots.addAll(myDetectedRoots);
  }
  HashSet<VirtualFile> listed=new HashSet<VirtualFile>();
  for (  VirtualFile f : result) {
    VirtualFile r=GitUtil.gitRootOrNull(f);
    if (r != null && listed.add(r)) {
      if (!roots.contains(r)) {
        roots.add(r);
      }
    }
  }
  return roots;
}
