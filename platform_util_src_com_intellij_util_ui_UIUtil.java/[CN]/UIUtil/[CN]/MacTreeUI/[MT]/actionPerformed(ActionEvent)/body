{
  final Object source=e.getSource();
  if (source instanceof JTree) {
    JTree tree=(JTree)source;
    int selectionRow=tree.getLeadSelectionRow();
    if (selectionRow == -1)     return;
    TreePath selectionPath=tree.getPathForRow(selectionRow);
    if (selectionPath == null)     return;
    if (tree.getModel().isLeaf(selectionPath.getLastPathComponent()) || tree.isCollapsed(selectionRow)) {
      final TreePath parentPath=tree.getPathForRow(selectionRow).getParentPath();
      if (parentPath != null) {
        if (parentPath.getParentPath() != null || tree.isRootVisible()) {
          final int parentRow=tree.getRowForPath(parentPath);
          tree.scrollRowToVisible(parentRow);
          tree.setSelectionInterval(parentRow,parentRow);
        }
      }
    }
 else {
      tree.collapseRow(selectionRow);
    }
  }
}
