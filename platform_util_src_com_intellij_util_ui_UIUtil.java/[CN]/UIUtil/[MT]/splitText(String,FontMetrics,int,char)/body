{
  ArrayList<String> lines=new ArrayList<String>();
  String currentLine="";
  StringBuilder currentAtom=new StringBuilder();
  for (int i=0; i < text.length(); i++) {
    char ch=text.charAt(i);
    currentAtom.append(ch);
    if (ch == separator) {
      currentLine+=currentAtom.toString();
      currentAtom.setLength(0);
    }
    String s=currentLine + currentAtom.toString();
    int width=fontMetrics.stringWidth(s);
    if (width >= widthLimit - fontMetrics.charWidth('w')) {
      if (!currentLine.isEmpty()) {
        lines.add(currentLine);
        currentLine="";
      }
 else {
        lines.add(currentAtom.toString());
        currentAtom.setLength(0);
      }
    }
  }
  String s=currentLine + currentAtom.toString();
  if (!s.isEmpty()) {
    lines.add(s);
  }
  return ArrayUtil.toStringArray(lines);
}
