{
synchronized (ourRetina) {
    if (ourRetina.isNull()) {
      ourRetina.set(false);
      if (SystemInfo.isJavaVersionAtLeast("1.6.0_33") && SystemInfo.isAppleJvm) {
        if (!"false".equals(System.getProperty("ide.mac.retina"))) {
          ourRetina.set(IsRetina.isRetina());
          return ourRetina.get();
        }
      }
 else       if (SystemInfo.isJavaVersionAtLeast("1.7.0_40") && SystemInfo.isOracleJvm) {
        GraphicsEnvironment env=GraphicsEnvironment.getLocalGraphicsEnvironment();
        final GraphicsDevice device=env.getDefaultScreenDevice();
        try {
          Field field=device.getClass().getDeclaredField("scale");
          if (field != null) {
            field.setAccessible(true);
            Object scale=field.get(device);
            if (scale instanceof Integer && ((Integer)scale).intValue() == 2) {
              ourRetina.set(true);
              return true;
            }
          }
        }
 catch (        Exception ignore) {
        }
      }
      ourRetina.set(false);
    }
    return ourRetina.get();
  }
}
