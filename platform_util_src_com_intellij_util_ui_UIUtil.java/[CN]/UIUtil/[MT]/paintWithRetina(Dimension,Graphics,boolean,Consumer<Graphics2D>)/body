{
  if (!useRetinaCondition || !isRetina() || Registry.is("ide.mac.disableRetinaDrawingFix",false)) {
    paintRoutine.consume((Graphics2D)g);
  }
 else {
    Rectangle rect=g.getClipBounds();
    if (rect == null)     rect=new Rectangle(size);
    Image image=((Graphics2D)g).getDeviceConfiguration().createCompatibleImage(rect.width * 2,rect.height * 2);
    Graphics2D imageGraphics=(Graphics2D)image.getGraphics();
    imageGraphics.scale(2,2);
    imageGraphics.translate(-rect.x,-rect.y);
    imageGraphics.setClip(rect.x,rect.y,rect.width,rect.height);
    paintRoutine.consume(imageGraphics);
    image.flush();
    imageGraphics.dispose();
    ((Graphics2D)g).scale(0.5,0.5);
    g.drawImage(image,rect.x * 2,rect.y * 2,null);
  }
}
