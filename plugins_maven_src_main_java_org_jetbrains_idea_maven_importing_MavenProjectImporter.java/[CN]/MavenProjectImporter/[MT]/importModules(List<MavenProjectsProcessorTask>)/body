{
  final Set<MavenProject> projects=myProjectsToImport;
  Set<MavenProject> projectsWithNewlyCreatedModules=new THashSet<MavenProject>();
  for (  MavenProject each : projects) {
    if (ensureModuleCreated(each)) {
      projectsWithNewlyCreatedModules.add(each);
    }
  }
  final Map<Module,MavenModuleImporter> moduleImporters=new THashMap<Module,MavenModuleImporter>();
  for (  MavenProject each : projects) {
    Module module=myMavenProjectToModule.get(each);
    MavenModuleImporter importer=createModuleImporter(module,each);
    moduleImporters.put(module,importer);
    importer.config(projectsWithNewlyCreatedModules.contains(each));
  }
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      for (      MavenProject each : projects) {
        moduleImporters.get(myMavenProjectToModule.get(each)).preConfigFacets();
      }
      for (      MavenProject each : projects) {
        moduleImporters.get(myMavenProjectToModule.get(each)).configFacets(postTasks);
      }
    }
  }
);
  ArrayList<Module> modules=new ArrayList<Module>(moduleImporters.keySet());
  MavenProjectsManager.getInstance(myProject).setMavenizedModules(modules,true);
}
