{
  Set<Library> allLibraries=new THashSet<Library>();
  Collections.addAll(allLibraries,myLibrariesProvider.getAllLibraries());
  Set<Library> usedLibraries=new THashSet<Library>();
  for (  ModuleRootModel eachModel : collectModuleModels()) {
    for (    OrderEntry eachEntry : eachModel.getOrderEntries()) {
      if (eachEntry instanceof LibraryOrderEntry) {
        Library lib=((LibraryOrderEntry)eachEntry).getLibrary();
        if (MavenRootModelAdapter.isMavenLibrary(lib))         usedLibraries.add(lib);
      }
    }
  }
  Set<Library> unusedLibraries=new THashSet<Library>(allLibraries);
  unusedLibraries.removeAll(usedLibraries);
  for (  Library each : unusedLibraries) {
    if (!MavenRootModelAdapter.isChangedByUser(each)) {
      myLibrariesProvider.removeLibrary(each);
    }
  }
}
