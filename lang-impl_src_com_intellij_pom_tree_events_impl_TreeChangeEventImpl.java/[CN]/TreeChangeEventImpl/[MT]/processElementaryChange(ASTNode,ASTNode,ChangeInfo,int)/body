{
  TreeChange treeChange=myChangedElements.get(parent);
  if (treeChange == null) {
    treeChange=new TreeChangeImpl(parent);
    myChangedElements.put(parent,treeChange);
    insertAtList(parent);
    final int index=depth >= 0 ? depth : getDepth(parent);
    addToEqualsDepthList(index,parent);
  }
  treeChange.addChange(element,change);
  if (change.getChangeType() == ChangeInfo.REMOVED) {
    element.putUserData(CharTable.CHAR_TABLE_KEY,myFileElement.getCharTable());
  }
  if (treeChange.isEmpty())   removeAssociatedChanges(parent,depth);
}
