{
  myProject=project;
  Document document=editor.getDocument();
  if (!PsiDocumentManager.getInstance(myProject).isUncommited(document)) {
    PsiFile psiFile=PsiDocumentManager.getInstance(project).getPsiFile(document);
    editor=InjectedLanguageUtil.getEditorForInjectedLanguage(editor,psiFile);
  }
  myEditor=editor;
  myAlarm=alarm;
  myDocument=(DocumentEx)myEditor.getDocument();
  myPsiFile=PsiDocumentManager.getInstance(project).getPsiFile(myDocument);
  myCodeInsightSettings=CodeInsightSettings.getInstance();
  if (myPsiFile != null) {
    myFileType=myPsiFile.getFileType();
  }
}
