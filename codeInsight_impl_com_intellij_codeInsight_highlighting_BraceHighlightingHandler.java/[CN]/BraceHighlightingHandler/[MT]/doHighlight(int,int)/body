{
  if (myEditor.getFoldingModel().isOffsetCollapsed(offset))   return;
  HighlighterIterator iterator=getEditorHighlighter().createIterator(offset);
  final CharSequence chars=myDocument.getCharsSequence();
  if (BraceMatchingUtil.isLBraceToken(iterator,chars,myFileType)) {
    IElementType tokenType=iterator.getTokenType();
    iterator.advance();
    if (!iterator.atEnd() && BraceMatchingUtil.isRBraceToken(iterator,chars,myFileType)) {
      if (BraceMatchingUtil.isPairBraces(tokenType,iterator.getTokenType(),myFileType) && originalOffset == iterator.getStart())       return;
    }
    iterator.retreat();
    highlightLeftBrace(iterator,false);
    if (offset > 0) {
      iterator=getEditorHighlighter().createIterator(offset - 1);
      if (BraceMatchingUtil.isRBraceToken(iterator,chars,myFileType)) {
        highlightRightBrace(iterator);
      }
    }
  }
 else   if (BraceMatchingUtil.isRBraceToken(iterator,chars,myFileType)) {
    highlightRightBrace(iterator);
  }
}
