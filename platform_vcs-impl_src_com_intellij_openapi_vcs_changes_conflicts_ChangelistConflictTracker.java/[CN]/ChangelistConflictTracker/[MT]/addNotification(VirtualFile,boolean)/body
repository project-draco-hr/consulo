{
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      FileEditor[] editors=myFileEditorManager.getEditors(file);
      for (      FileEditor editor : editors) {
        EditorNotificationPanel panel=editor.getUserData(KEY);
        if (add && panel == null) {
          panel=new EditorNotificationPanel(){
{
              myLabel.setText("File from non-active changelist is modified");
            }
            @Override protected void executeAction(            String actionId){
              if (actionId.equals("move")) {
                Change change=myChangeListManager.getChange(file);
                ChangeList changeList=myChangeListManager.getChangeList(change);
                MoveChangesDialog dialog=new MoveChangesDialog(myProject,Collections.singletonList(change),Collections.singletonList(changeList),"Move changes");
                dialog.show();
                if (dialog.isOK()) {
                  ChangelistConflictResolution.MOVE.resolveConflict(myProject,dialog.getSelectedChanges());
                }
              }
 else               if (actionId.equals("switch")) {
              }
 else               if (actionId.equals("ignore")) {
                ignoreConflict(file,true);
              }
            }
          }
;
          panel.createActionLabel("Move changes","move");
          panel.createActionLabel("Switch changelist","switch");
          panel.createActionLabel("Ignore","ignore");
          myFileEditorManager.addTopComponent(editor,panel);
          editor.putUserData(KEY,panel);
        }
 else         if (panel != null) {
          myFileEditorManager.removeTopComponent(editor,panel);
          editor.putUserData(KEY,null);
        }
      }
    }
  }
);
}
