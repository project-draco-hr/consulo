{
synchronized (PsiLock.LOCK) {
    final Map<String,CachedValue<XmlNSDescriptor>> defaultDescriptorsCache;
    if (strict)     defaultDescriptorsCache=myDefaultDescriptorsCacheStrict;
 else     defaultDescriptorsCache=myDefaultDescriptorsCacheNotStrict;
    if (defaultDescriptorsCache.containsKey(namespace)) {
      final CachedValue<XmlNSDescriptor> cachedValue=defaultDescriptorsCache.get(namespace);
      if (cachedValue != null)       return cachedValue.getValue();
 else       return null;
    }
    final XmlNSDescriptor defaultNSDescriptor;
    try {
      defaultDescriptorsCache.put(namespace,null);
      final CachedValueImpl<XmlNSDescriptor> value=new CachedValueImpl<XmlNSDescriptor>(getManager(),new CachedValueProvider<XmlNSDescriptor>(){
        public Result<XmlNSDescriptor> compute(){
          final XmlNSDescriptor defaultNSDescriptorInner=getDefaultNSDescriptorInner(namespace,strict);
          if (isGeneratedFromDtd(defaultNSDescriptorInner)) {
            return new Result<XmlNSDescriptor>(defaultNSDescriptorInner,XmlDocumentImpl.this);
          }
          return new Result<XmlNSDescriptor>(defaultNSDescriptorInner,defaultNSDescriptorInner != null ? defaultNSDescriptorInner.getDependences() : ArrayUtil.EMPTY_OBJECT_ARRAY);
        }
      }
,false);
      defaultNSDescriptor=value.getValue();
      defaultDescriptorsCache.put(namespace,value);
    }
 catch (    ProcessCanceledException ex) {
      defaultDescriptorsCache.remove(namespace);
      throw ex;
    }
    return defaultNSDescriptor;
  }
}
