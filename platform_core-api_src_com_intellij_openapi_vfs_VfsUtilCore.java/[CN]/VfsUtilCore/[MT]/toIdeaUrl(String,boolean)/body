{
  int index=url.indexOf(":/");
  if (index < 0 || (index + 2) >= url.length()) {
    return url;
  }
  if (url.charAt(index + 2) != '/') {
    String prefix=url.substring(0,index);
    String suffix=url.substring(index + 2);
    if (SystemInfoRt.isWindows) {
      return prefix + "://" + suffix;
    }
 else     if (removeLocalhostPrefix && prefix.equals(StandardFileSystems.FILE_PROTOCOL) && suffix.startsWith(LOCALHOST_URI_PATH_PREFIX)) {
      return prefix + ":///" + suffix.substring(LOCALHOST_URI_PATH_PREFIX.length());
    }
 else {
      return prefix + ":///" + suffix;
    }
  }
 else   if (url.charAt(index + 3) == '/' && SystemInfoRt.isWindows && url.regionMatches(0,StandardFileSystems.FILE_PROTOCOL_PREFIX,0,StandardFileSystems.FILE_PROTOCOL_PREFIX.length())) {
    for (int i=index + 4; i < url.length(); i++) {
      char c=url.charAt(i);
      if (c == '/') {
        break;
      }
 else       if (c == ':') {
        return StandardFileSystems.FILE_PROTOCOL_PREFIX + url.substring(index + 4);
      }
    }
    return url;
  }
  return url;
}
