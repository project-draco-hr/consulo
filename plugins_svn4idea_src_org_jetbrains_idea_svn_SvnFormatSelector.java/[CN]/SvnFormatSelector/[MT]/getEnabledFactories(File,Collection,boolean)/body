{
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    return factories;
  }
  Project project=findProject(path);
  if (project == null) {
    String newMode=SvnWorkingCopyFormatHolder.getPresetFormat();
    newMode=(newMode == null) ? SvnWorkingCopyFormatHolder.getRecentlySelected() : newMode;
    while (newMode == null) {
      newMode=showUpgradeDialog(path,null,true,null);
      SvnWorkingCopyFormatHolder.setRecentlySelected(newMode);
    }
    if (SvnConfiguration.UPGRADE_NONE.equals(newMode)) {
      return factoriesFor13(factories);
    }
 else     if (SvnConfiguration.UPGRADE_AUTO.equals(newMode)) {
      return factoriesFor14(factories);
    }
    return factories;
  }
  SvnConfiguration configuration=SvnConfiguration.getInstance(project);
  String upgradeMode=configuration.getUpgradeMode();
  return getFactories(upgradeMode,path,factories,project,configuration);
}
