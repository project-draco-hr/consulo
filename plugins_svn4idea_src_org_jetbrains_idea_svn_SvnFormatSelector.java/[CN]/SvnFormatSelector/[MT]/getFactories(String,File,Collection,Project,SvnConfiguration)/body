{
  final WorkingCopyFormat format=getWorkingCopyFormat(path);
  if (WorkingCopyFormat.ONE_DOT_FIVE.equals(format)) {
    SvnWorkingCopyFormatHolder.setRecentlySelected(SvnConfiguration.UPGRADE_AUTO_15);
    return factories;
  }
  if (SvnConfiguration.UPGRADE_NONE.equals(upgradeMode)) {
    if (WorkingCopyFormat.ONE_DOT_FOUR.equals(format)) {
      SvnWorkingCopyFormatHolder.setRecentlySelected(SvnConfiguration.UPGRADE_AUTO);
      return factoriesFor14(factories);
    }
    SvnWorkingCopyFormatHolder.setRecentlySelected(SvnConfiguration.UPGRADE_NONE);
    return factoriesFor13(factories);
  }
 else   if (SvnConfiguration.UPGRADE_AUTO_15.equals(upgradeMode)) {
    SvnWorkingCopyFormatHolder.setRecentlySelected(SvnConfiguration.UPGRADE_AUTO_15);
    return factories;
  }
 else   if (SvnConfiguration.UPGRADE_AUTO.equals(upgradeMode)) {
    SvnWorkingCopyFormatHolder.setRecentlySelected(SvnConfiguration.UPGRADE_AUTO);
    return factoriesFor14(factories);
  }
 else   if (upgradeMode == null) {
    final boolean display13format=WorkingCopyFormat.ONE_DOT_THREE.equals(format);
    final String newMode=showUpgradeDialog(path,project,display13format,null);
    config.setUpgradeMode(newMode);
    SvnWorkingCopyFormatHolder.setRecentlySelected(newMode);
    return getFactories(newMode,path,factories,project,config);
  }
  SvnWorkingCopyFormatHolder.setRecentlySelected(SvnConfiguration.UPGRADE_AUTO_15);
  return factories;
}
