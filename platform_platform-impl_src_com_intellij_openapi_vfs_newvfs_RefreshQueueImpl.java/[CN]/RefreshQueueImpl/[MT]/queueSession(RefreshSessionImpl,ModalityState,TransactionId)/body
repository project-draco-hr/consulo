{
  myQueue.submit(new Runnable(){
    @Override public void run(){
      myRefreshIndicator.start();
      AccessToken ignored=null;
      try {
        ignored=HeavyProcessLatch.INSTANCE.processStarted("Doing file refresh. " + session);
        doScan(session);
      }
  finally {
        if (ignored != null) {
          ignored.finish();
        }
        myRefreshIndicator.stop();
        final Application app=ApplicationManager.getApplication();
        app.invokeLater(new Runnable(){
          @Override public void run(){
            TransactionGuard.getInstance().submitTransaction(app,transaction,new Runnable(){
              @Override public void run(){
                session.fireEvents();
              }
            }
);
          }
        }
,modality);
      }
    }
  }
);
  myEventCounter.eventHappened(session);
}
