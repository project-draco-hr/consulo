{
  myQueue.submit(new Runnable(){
    @Override public void run(){
      try {
        myRefreshIndicator.start();
        AccessToken token=HeavyProcessLatch.INSTANCE.processStarted("Doing file refresh. " + session.toString());
        try {
          doScan(session);
        }
  finally {
          token.finish();
          myRefreshIndicator.stop();
        }
      }
  finally {
        ApplicationManager.getApplication().invokeLater(new DumbAwareRunnable(){
          @Override public void run(){
            session.fireEvents(false);
          }
        }
,modality);
      }
    }
  }
);
  myEventCounter.eventHappened();
}
