{
  File moduleDirFile=new File(moduleFilePath).getParentFile();
  if (moduleDirFile == null)   return null;
  final VirtualFile baseDir=myModule.getProject().getBaseDir();
  if (baseDir != null) {
    File moduleDirParent=moduleDirFile.getParentFile();
    if (moduleDirParent != null && moduleDirFile.getName().equals(".idea") && moduleDirParent.getPath().equals(FileUtil.toSystemDependentName(baseDir.getPath()))) {
      moduleDirFile=moduleDirParent;
    }
  }
  String moduleDir=moduleDirFile.getPath();
  moduleDir=moduleDir.replace(File.separatorChar,'/');
  if (moduleDir.endsWith(":/")) {
    moduleDir=moduleDir.substring(0,moduleDir.length() - 1);
  }
  return moduleDir;
}
