{
  Map<PsiTypeParameter,PsiType> map=substitutor.getSubstitutionMap();
  Map<PsiTypeParameter,PsiType> newMap=new THashMap<PsiTypeParameter,PsiType>();
  for (  Map.Entry<PsiTypeParameter,PsiType> entry : map.entrySet()) {
    PsiTypeParameter typeParameter=entry.getKey();
    PsiType type=entry.getValue();
    PsiClass resolved=PsiUtil.resolveClassInType(type);
    if (resolved instanceof PsiTypeParameter) {
      PsiTypeParameter res=(PsiTypeParameter)resolved;
      PsiImmediateClassType revType=new PsiImmediateClassType(typeParameter,substitutor);
      newMap.put(res,revType);
    }
  }
  return PsiSubstitutorImpl.createSubstitutor(newMap);
}
