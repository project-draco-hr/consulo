{
  final String orderTxtPath=args[0];
  final String jarsPath=args[1];
  final String destinationHomePath=args[2];
  final String libPath=args[3];
  try {
    final Map<String,List<String>> toReorder=getOrder(new File(orderTxtPath));
    final Set<String> ignoredJars=loadIgnoredJars(libPath);
    for (    String jarUrl : toReorder.keySet()) {
      if (ignoredJars.contains(StringUtil.trimStart(jarUrl,"/lib/")))       continue;
      if (jarUrl.startsWith("/lib/ant"))       continue;
      final File jarFile=new File(jarsPath,jarUrl);
      if (!jarFile.isFile())       continue;
      final JBZipFile zipFile=new JBZipFile(jarFile);
      final List<JBZipEntry> entries=zipFile.getEntries();
      final List<String> orderedEntries=toReorder.get(jarUrl);
      Collections.sort(entries,new Comparator<JBZipEntry>(){
        public int compare(        JBZipEntry o1,        JBZipEntry o2){
          if (orderedEntries.contains(o1.getName())) {
            return orderedEntries.contains(o2.getName()) ? orderedEntries.indexOf(o1.getName()) - orderedEntries.indexOf(o2.getName()) : -1;
          }
          if (orderedEntries.contains(o2.getName()))           return 1;
          return 0;
        }
      }
);
      final File newJarFile=new File(destinationHomePath,jarUrl);
      newJarFile.getParentFile().mkdirs();
      final JBZipFile file=new JBZipFile(newJarFile);
      for (      JBZipEntry entry : entries) {
        final JBZipEntry zipEntry=file.getOrCreateEntry(entry.getName());
        zipEntry.setData(entry.getData());
      }
      file.close();
    }
    System.exit(0);
  }
 catch (  IOException e) {
    e.printStackTrace();
  }
}
