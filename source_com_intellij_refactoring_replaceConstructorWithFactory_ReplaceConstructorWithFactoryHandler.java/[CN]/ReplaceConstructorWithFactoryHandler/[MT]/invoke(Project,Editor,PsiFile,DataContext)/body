{
  int offset=editor.getCaretModel().getOffset();
  editor.getScrollingModel().scrollToCaret(ScrollType.MAKE_VISIBLE);
  PsiElement element=file.findElementAt(offset);
  while (true) {
    if (element == null || element instanceof PsiFile) {
      String message="Cannot perform the refactoring.\n" + "The caret should be positioned inside the constructor to be refactored.";
      RefactoringMessageUtil.showErrorMessage(REFACTORING_NAME,message,null,project);
      return;
    }
    if (element instanceof PsiClass && !(element instanceof PsiAnonymousClass) && ((PsiClass)element).getConstructors().length == 0) {
      invoke(project,new PsiElement[]{element},dataContext);
      return;
    }
    if (element instanceof PsiMethod && ((PsiMethod)element).isConstructor()) {
      invoke(project,new PsiElement[]{element},dataContext);
      return;
    }
    element=element.getParent();
  }
}
