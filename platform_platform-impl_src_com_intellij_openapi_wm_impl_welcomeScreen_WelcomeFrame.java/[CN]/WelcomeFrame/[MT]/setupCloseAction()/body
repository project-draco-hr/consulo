{
  setDefaultCloseOperation(WindowConstants.DO_NOTHING_ON_CLOSE);
  addWindowListener(new WindowAdapter(){
    public void windowClosing(    final WindowEvent e){
      dispose();
      final Application app=ApplicationManager.getApplication();
      app.invokeLater(new DumbAwareRunnable(){
        public void run(){
          if (app.isDisposed()) {
            ApplicationManagerEx.getApplicationEx().exit();
            return;
          }
          final Project[] openProjects=ProjectManager.getInstance().getOpenProjects();
          if (openProjects.length == 0) {
            ApplicationManagerEx.getApplicationEx().exit();
          }
        }
      }
,ModalityState.NON_MODAL);
    }
  }
);
}
