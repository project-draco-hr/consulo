{
  if (stack.isEmpty())   return offset;
  for (HighlightInfo cur=stack.peekLast(); cur != null && cur.getEndOffset() <= endOffset; cur=stack.peekLast()) {
    stack.removeLast();
    if (offset <= cur.getEndOffset()) {
      sb.append(sequence.subSequence(offset,cur.getEndOffset()));
    }
 else {
    }
    offset=cur.getEndOffset();
    sb.append(cur.severity == HighlightSeverity.WARNING ? "</warning>" : "</error>");
  }
  return offset;
}
