{
  Sdk sdk=ProjectJdkTable.getInstance().createSdk("android_test_sdk",AndroidSdkType.getInstance());
  SdkModificator sdkModificator=sdk.getSdkModificator();
  sdkModificator.setHomePath(sdkPath);
  String androidJarPath=sdkPath + "/../android.jar!/";
  VirtualFile androidJar=JarFileSystem.getInstance().findFileByPath(androidJarPath);
  sdkModificator.addRoot(androidJar,OrderRootType.CLASSES);
  VirtualFile resFolder=LocalFileSystem.getInstance().findFileByPath(sdkPath + "/platforms/android-1.5/data/res");
  sdkModificator.addRoot(resFolder,OrderRootType.CLASSES);
  AndroidSdkAdditionalData data=new AndroidSdkAdditionalData(sdk);
  AndroidSdk sdkObject=AndroidSdk.parse(sdkPath,new EmptySdkLog());
  data.setBuildTarget(sdkObject.findTargetByName("Android 1.5"));
  sdkModificator.setSdkAdditionalData(data);
  sdkModificator.commitChanges();
  return sdk;
}
