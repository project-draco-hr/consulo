{
  super.setUp();
  final TestFixtureBuilder<IdeaProjectTestFixture> projectBuilder=IdeaTestFixtureFactory.getFixtureFactory().createFixtureBuilder(getName());
  myFixture=JavaTestFixtureFactory.getFixtureFactory().createCodeInsightFixture(projectBuilder.getFixture());
  final JavaModuleFixtureBuilder moduleFixtureBuilder=projectBuilder.addModule(JavaModuleFixtureBuilder.class);
  tuneModule(moduleFixtureBuilder,myFixture.getTempDirPath());
  final ArrayList<MyAdditionalModuleData> modules=new ArrayList<MyAdditionalModuleData>();
  configureAdditionalModules(projectBuilder,modules);
  myFixture.setUp();
  myFixture.setTestDataPath(getTestDataPath());
  myModule=moduleFixtureBuilder.getFixture().getModule();
  myFacet=addAndroidFacet(myModule,getTestSdkPath());
  myFixture.copyDirectoryToProject(getResDir(),"res");
  if (myCreateManifest) {
    createManifest();
  }
  myAdditionalModules=new ArrayList<Module>();
  for (  MyAdditionalModuleData data : modules) {
    final Module additionalModule=data.myModuleFixtureBuilder.getFixture().getModule();
    myAdditionalModules.add(additionalModule);
    final AndroidFacet facet=addAndroidFacet(additionalModule,getTestSdkPath());
    facet.getConfiguration().LIBRARY_PROJECT=data.myLibrary;
    final String rootPath=getContentRootPath(data.myDirName);
    myFixture.copyDirectoryToProject("res",rootPath + "/res");
    myFixture.copyFileToProject(SdkConstants.FN_ANDROID_MANIFEST_XML,rootPath + '/' + SdkConstants.FN_ANDROID_MANIFEST_XML);
    ModuleRootModificationUtil.addDependency(myModule,additionalModule);
  }
}
