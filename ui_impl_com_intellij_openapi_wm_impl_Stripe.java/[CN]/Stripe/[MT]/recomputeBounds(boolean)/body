{
  final LayoutData data=new LayoutData();
  data.eachY=0;
  data.size=new Dimension();
  data.gap=1;
  data.horizontal=isHorizontal();
  data.dragInsertPosition=-1;
  if (data.horizontal) {
    final JComponent template=myManager.getToolWindowsPane().getTemplateButton();
    final Insets insets=template.getInsets();
    data.eachX=template.getPreferredSize().height - (insets == null ? 0 : insets.top);
  }
 else {
    data.eachX=0;
  }
  data.max=new Dimension();
  int sensivity=20;
  final Rectangle stripeSensetiveRec=new Rectangle(-sensivity,-sensivity,getWidth() + sensivity * 2,getHeight() + sensivity * 2);
  boolean processDrop=isDroppingButton() && stripeSensetiveRec.intersects(myDropRectangle);
  for (  StripeButton eachButton : myButtons) {
    final Dimension eachSize=eachButton.getPreferredSize();
    data.max.width=Math.max(eachSize.width,data.max.width);
    data.max.height=Math.max(eachSize.height,data.max.height);
  }
  int insertOrder=-1;
  for (  StripeButton eachButton : myButtons) {
    insertOrder=eachButton.getDecorator().getWindowInfo().getOrder();
    if (!isConsideredInLayout(eachButton))     continue;
    final Dimension eachSize=eachButton.getPreferredSize();
    if (processDrop && data.dragInsertPosition == -1) {
      if (data.horizontal) {
        int distance=myDropRectangle.x - data.eachX;
        if (distance < eachSize.width / 2 || (myDropRectangle.x + myDropRectangle.width) < eachSize.width / 2) {
          layoutButton(data,myDragButtonImage,false);
          data.dragInsertPosition=insertOrder;
        }
      }
 else {
        int distance=myDropRectangle.y - data.eachY;
        if (distance < eachSize.height / 2 || (myDropRectangle.y + myDropRectangle.height) < eachSize.height / 2) {
          layoutButton(data,myDragButtonImage,false);
          data.dragInsertPosition=insertOrder;
        }
      }
    }
    layoutButton(data,eachButton,setBounds);
  }
  return data;
}
