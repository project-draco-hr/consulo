{
  VirtualFile file=FileDocumentManager.getInstance().getFile(document);
  FilePointersList pointers=file == null ? null : getPointers(file);
  ConcurrentMap<ProperTextRange,ManualRangeMarker> cache=pointers == null ? null : pointers.getMarkerCache();
  ManualRangeMarker marker=cache == null ? null : cache.get(range);
  if (marker != null) {
    return marker;
  }
  FrozenDocument frozen=((PsiDocumentManagerBase)PsiDocumentManager.getInstance(myProject)).getLastCommittedDocument(document);
  marker=new ManualRangeMarker(frozen,range,false,false,true);
  if (cache != null) {
    marker=ConcurrencyUtil.cacheOrGet(cache,range,marker);
  }
  return marker;
}
