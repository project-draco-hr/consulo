{
  VirtualFile file=FileDocumentManager.getInstance().getFile(document);
  FilePointersList pointers=file == null ? null : getPointers(file);
  if (pointers == null)   return;
  pointers.markerCache=null;
  List<SelfElementInfo> infos=ContainerUtil.mapNotNull(pointers.getAlivePointers(),new Function<SmartPsiElementPointerImpl,SelfElementInfo>(){
    @Override public SelfElementInfo fun(    SmartPsiElementPointerImpl pointer){
      final SmartPointerElementInfo info=pointer.getElementInfo();
      return info instanceof SelfElementInfo ? (SelfElementInfo)info : null;
    }
  }
);
  for (  DocumentEvent event : events) {
    THashSet<ManualRangeMarker> processedMarkers=ContainerUtil.newIdentityTroveSet();
    frozen=frozen.applyEvent(event,0);
    final DocumentEvent corrected=SelfElementInfo.withFrozen(frozen,event);
    for (    SelfElementInfo info : infos) {
      info.updateRange(corrected,processedMarkers);
    }
  }
}
