{
  if (containingFile != null && !containingFile.isValid() || containingFile == null && !element.isValid()) {
    PsiUtilCore.ensureValid(element);
    LOG.error("Invalid element:" + element);
  }
  processQueue();
  SmartPsiElementPointerImpl<E> pointer=getCachedPointer(element);
  if (pointer != null && pointer.incrementAndGetReferenceCount(1) > 0) {
    return pointer;
  }
  pointer=new SmartPsiElementPointerImpl<E>(myProject,element,containingFile);
  if (containingFile != null) {
    trackPointer(pointer,containingFile.getViewProvider().getVirtualFile());
  }
  element.putUserData(CACHED_SMART_POINTER_KEY,new SoftReference<SmartPsiElementPointerImpl>(pointer));
  return pointer;
}
