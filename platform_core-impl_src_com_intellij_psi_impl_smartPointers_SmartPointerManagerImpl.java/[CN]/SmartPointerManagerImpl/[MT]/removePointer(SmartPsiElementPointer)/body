{
  if (!(pointer instanceof SmartPsiElementPointerImpl) || myProject.isDisposed()) {
    return;
  }
  PsiFile containingFile=pointer.getContainingFile();
  int refCount=((SmartPsiElementPointerImpl)pointer).incrementAndGetReferenceCount(-1);
  if (refCount == 0) {
    PsiElement element=((SmartPointerEx)pointer).getCachedElement();
    if (element != null) {
      element.putUserData(CACHED_SMART_POINTER_KEY,null);
    }
    SmartPointerElementInfo info=((SmartPsiElementPointerImpl)pointer).getElementInfo();
    info.cleanup();
    if (containingFile == null)     return;
    VirtualFile vFile=containingFile.getViewProvider().getVirtualFile();
    FilePointersList pointers=getPointers(vFile);
    if (pointers == null)     return;
    pointers.remove(pointer);
  }
}
