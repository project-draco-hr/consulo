{
  super.setUp();
  final File root=File.createTempFile(getName(),"");
  root.delete();
  root.mkdir();
  myFilesToDelete.add(root);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      try {
        VirtualFile rootVFile=LocalFileSystem.getInstance().refreshAndFindFileByPath(root.getAbsolutePath().replace(File.separatorChar,'/'));
        myDir=rootVFile.createChildDirectory(null,"contentAndLibrary");
        VirtualFile file1=myDir.createChildData(null,"A.java");
        VfsUtil.saveText(file1,"package p; public class A{ public void foo(); }");
        VfsUtil.copyFile(null,getClassFile(),myDir);
        final ModifiableRootModel rootModel=ModuleRootManager.getInstance(myModule).getModifiableModel();
        final ContentEntry contentEntry1=rootModel.addContentEntry(myDir);
        contentEntry1.addSourceFolder(myDir,false);
        final Library jarLibrary=rootModel.getModuleLibraryTable().createLibrary();
        final Library.ModifiableModel libraryModel=jarLibrary.getModifiableModel();
        libraryModel.addRoot(myDir,OrderRootType.CLASSES);
        libraryModel.commit();
        rootModel.commit();
      }
 catch (      IOException e) {
        LOG.error(e);
      }
    }
  }
);
}
