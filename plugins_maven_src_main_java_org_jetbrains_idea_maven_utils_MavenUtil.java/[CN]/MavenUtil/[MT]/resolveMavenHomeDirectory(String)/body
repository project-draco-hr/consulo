{
  if (!isEmptyOrSpaces(overrideMavenHome)) {
    return new File(overrideMavenHome);
  }
  String m2home=System.getenv(ENV_M2_HOME);
  if (!isEmptyOrSpaces(m2home)) {
    final File homeFromEnv=new File(m2home);
    if (isValidMavenHome(homeFromEnv)) {
      return homeFromEnv;
    }
  }
  String userHome=SystemProperties.getUserHome();
  if (!isEmptyOrSpaces(userHome)) {
    final File underUserHome=new File(userHome,M2_DIR);
    if (isValidMavenHome(underUserHome)) {
      return underUserHome;
    }
  }
  if (SystemInfo.isMac) {
    File home=fromBrew();
    if (home != null) {
      return home;
    }
    if ((home=fromMacSystemJavaTools()) != null) {
      return home;
    }
  }
 else   if (SystemInfo.isLinux) {
    File home=new File("/usr/share/maven2");
    if (isValidMavenHome(home)) {
      return home;
    }
  }
  return null;
}
