{
  FileTemplateManager manager=FileTemplateManager.getInstance();
  FileTemplate fileTemplate=manager.getJ2eeTemplate(templateName);
  Properties allProperties=manager.getDefaultProperties();
  if (!interactive) {
    allProperties.putAll(properties);
  }
  String text=fileTemplate.getText(allProperties);
  Pattern pattern=Pattern.compile("\\$\\{(.*)\\}");
  Matcher matcher=pattern.matcher(text);
  StringBuffer builder=new StringBuffer();
  while (matcher.find()) {
    matcher.appendReplacement(builder,"\\$" + matcher.group(1).toUpperCase() + "\\$");
  }
  matcher.appendTail(builder);
  text=builder.toString();
  OpenFileDescriptor descriptor=new OpenFileDescriptor(project,file);
  Editor editor=FileEditorManager.getInstance(project).openTextEditor(descriptor,true);
  TemplateImpl template=(TemplateImpl)TemplateManager.getInstance(project).createTemplate("","",text);
  for (int i=0; i < template.getSegmentsCount(); i++) {
    if (i == template.getEndSegmentNumber())     continue;
    String name=template.getSegmentName(i);
    String value="\"" + properties.getProperty(name,"") + "\"";
    template.addVariable(name,value,value,interactive);
  }
  TemplateManager.getInstance(project).startTemplate(editor,template);
}
