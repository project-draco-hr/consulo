{
  if (ApplicationManager.getApplication().isUnitTestMode() || ApplicationManager.getApplication().isDispatchThread()) {
    r.run();
  }
 else {
    ApplicationManager.getApplication().invokeAndWait(new Runnable(){
      public void run(){
        if (p.isDisposed())         return;
        r.run();
      }
    }
,state);
  }
}
