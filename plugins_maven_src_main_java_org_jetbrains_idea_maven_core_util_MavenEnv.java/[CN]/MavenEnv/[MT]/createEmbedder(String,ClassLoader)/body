{
  Configuration configuration=new DefaultConfiguration();
  configuration.setUserSettingsFile(new File(userSettings)).setGlobalSettingsFile(new File(getDefaultSettingsFile())).setClassLoader(classLoader);
  ConfigurationValidationResult validationResult=MavenEmbedder.validateConfiguration(configuration);
  if (!validationResult.isValid()) {
    throw new MavenEmbedderException(toString(validationResult));
  }
  return new MavenEmbedder(configuration);
}
