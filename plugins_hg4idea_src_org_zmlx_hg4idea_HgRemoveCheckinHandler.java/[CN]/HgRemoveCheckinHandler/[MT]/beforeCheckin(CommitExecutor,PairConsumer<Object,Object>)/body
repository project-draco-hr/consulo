{
  final List<Change> missingChanges=new LinkedList<Change>();
  for (  Change c : myCheckinPanel.getSelectedChanges()) {
    if (c.getFileStatus() == FileStatus.DELETED_FROM_FS) {
      missingChanges.add(c);
    }
  }
  if (missingChanges.isEmpty()) {
    return ReturnResult.COMMIT;
  }
  final Collection<Change> changesToRemove=new THashSet<Change>();
  VcsShowConfirmationOption confirmation=ProjectLevelVcsManager.getInstance(myProject).getStandardConfirmation(VcsConfiguration.StandardConfirmation.REMOVE,HgVcs.getInstance(myProject));
  if (missingChanges.size() == 1) {
    if (ConfirmationDialog.requestForConfirmation(confirmation,myProject,HgVcsMessages.message("hg4idea.remove.commit.single.body",missingChanges.get(0).getBeforeRevision().getFile().getPresentableUrl()),HgVcsMessages.message("hg4idea.remove.single.title"),Messages.getQuestionIcon())) {
      changesToRemove.add(missingChanges.get(0));
    }
  }
 else {
    final SelectMissingChangesDialog dialog=new SelectMissingChangesDialog(myProject,missingChanges,confirmation);
    dialog.show();
    if (dialog.isOK()) {
      changesToRemove.addAll(dialog.getSelectedChanges());
    }
 else {
      return ReturnResult.CANCEL;
    }
  }
  if (!changesToRemove.isEmpty()) {
    removeChangesAndUpdateCommitted(changesToRemove,additionalDataConsumer);
  }
  return ReturnResult.COMMIT;
}
