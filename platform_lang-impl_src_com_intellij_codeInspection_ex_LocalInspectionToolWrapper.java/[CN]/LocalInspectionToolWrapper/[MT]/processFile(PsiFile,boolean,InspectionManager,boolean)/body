{
  final ProblemsHolder holder=new ProblemsHolder(manager,file,isOnTheFly);
  LocalInspectionToolSession session=new LocalInspectionToolSession(file,0,file.getTextLength());
  final PsiElementVisitor customVisitor=getTool().buildVisitor(holder,isOnTheFly,session);
  LOG.assertTrue(!(customVisitor instanceof PsiRecursiveElementVisitor),"The visitor returned from LocalInspectionTool.buildVisitor() must not be recursive");
  getTool().inspectionStarted(session,isOnTheFly);
  file.accept(new PsiRecursiveElementWalkingVisitor(){
    @Override public void visitElement(    PsiElement element){
      element.accept(customVisitor);
      super.visitElement(element);
    }
  }
);
  getTool().inspectionFinished(session,holder);
  addProblemDescriptors(holder.getResults(),filterSuppressed);
}
