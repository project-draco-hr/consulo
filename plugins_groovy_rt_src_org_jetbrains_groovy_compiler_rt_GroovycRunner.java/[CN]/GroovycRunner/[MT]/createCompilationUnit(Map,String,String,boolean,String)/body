{
  CompilerConfiguration compilerConfiguration=new CompilerConfiguration();
  compilerConfiguration.setOutput(new PrintWriter(System.err));
  compilerConfiguration.setWarningLevel(WarningMessage.PARANOIA);
  if (encoding != null) {
    compilerConfiguration.setSourceEncoding(encoding);
  }
  compilerConfiguration.setClasspath(classpath);
  compilerConfiguration.setTargetDirectory(outputPath);
  CompilationUnit compilationUnit=new CompilationUnit(compilerConfiguration,null,buildClassLoaderFor(compilerConfiguration));
  if (isGrailsModule) {
    PhaseOperationUtil.addGrailsAwareInjectionOperation(class2File,compilationUnit,compilerConfiguration);
  }
  return compilationUnit;
}
