{
  config.setClasspath("");
  final GroovyClassLoader classLoader=buildClassLoaderFor(config);
  try {
    if (forStubs) {
      return createStubGenerator(config,classLoader);
    }
  }
 catch (  NoClassDefFoundError ignore) {
  }
  final GroovyClassLoader transformLoader=new GroovyClassLoader(classLoader){
    public Enumeration<URL> getResources(    String name) throws IOException {
      if (name.endsWith("org.codehaus.groovy.transform.ASTTransformation")) {
        final Enumeration<URL> resources=super.getResources(name);
        final ArrayList<URL> list=Collections.list(resources);
        for (Iterator iterator=list.iterator(); iterator.hasNext(); ) {
          final URL url=(URL)iterator.next();
          try {
            final String file=new File(new URI(url.toString())).getCanonicalPath();
            if (file.startsWith(finalOutput) || file.startsWith("/" + finalOutput)) {
              iterator.remove();
            }
          }
 catch (          Exception ignored) {
            System.out.println("Invalid URI syntax: " + url.toString());
          }
        }
        return Collections.enumeration(list);
      }
      return super.getResources(name);
    }
  }
;
  CompilationUnit unit;
  try {
    unit=new CompilationUnit(config,null,classLoader,transformLoader){
      public void gotoPhase(      int phase) throws CompilationFailedException {
        super.gotoPhase(phase);
        if (phase <= Phases.ALL) {
          System.out.println(PRESENTABLE_MESSAGE + "Groovyc: " + getPhaseDescription());
        }
      }
    }
;
  }
 catch (  NoSuchMethodError e) {
    unit=new CompilationUnit(config,null,classLoader){
      public void gotoPhase(      int phase) throws CompilationFailedException {
        super.gotoPhase(phase);
        if (phase <= Phases.ALL) {
          System.out.println(PRESENTABLE_MESSAGE + "Groovyc: " + getPhaseDescription());
        }
      }
    }
;
  }
  return unit;
}
