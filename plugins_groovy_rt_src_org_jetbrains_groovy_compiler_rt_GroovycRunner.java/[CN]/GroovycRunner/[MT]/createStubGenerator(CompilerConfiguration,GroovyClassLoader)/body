{
  JavaAwareCompilationUnit unit=new JavaAwareCompilationUnit(config,classLoader){
    private boolean annoRemovedAdded;
    @Override public void addPhaseOperation(    PrimaryClassNodeOperation op,    int phase){
      if (!annoRemovedAdded && phase == Phases.CONVERSION && op.getClass().getName().startsWith("org.codehaus.groovy.tools.javac.JavaAwareCompilationUnit$")) {
        annoRemovedAdded=true;
        super.addPhaseOperation(new PrimaryClassNodeOperation(){
          @Override public void call(          final SourceUnit source,          GeneratorContext context,          ClassNode classNode) throws CompilationFailedException {
            final ClassCodeVisitorSupport annoRemover=new ClassCodeVisitorSupport(){
              @Override protected SourceUnit getSourceUnit(){
                return source;
              }
              public void visitClass(              ClassNode node){
                if (node.isEnum()) {
                  node.setModifiers(node.getModifiers() & ~Opcodes.ACC_FINAL);
                }
                super.visitClass(node);
              }
              @Override public void visitField(              FieldNode fieldNode){
                Expression valueExpr=fieldNode.getInitialValueExpression();
                if (valueExpr instanceof ConstantExpression && ClassHelper.STRING_TYPE.equals(valueExpr.getType())) {
                  fieldNode.setInitialValueExpression(new MethodCallExpression(valueExpr,"toString",new ListExpression()));
                }
                super.visitField(fieldNode);
              }
              @Override public void visitAnnotations(              AnnotatedNode node){
                List<AnnotationNode> annotations=node.getAnnotations();
                if (!annotations.isEmpty()) {
                  annotations.clear();
                }
                super.visitAnnotations(node);
              }
            }
;
            annoRemover.visitClass(classNode);
          }
        }
,phase);
      }
      super.addPhaseOperation(op,phase);
    }
    public void gotoPhase(    int phase) throws CompilationFailedException {
      if (phase == Phases.SEMANTIC_ANALYSIS) {
        System.out.println(GroovyRtConstants.PRESENTABLE_MESSAGE + "Generating Groovy stubs...");
        try {
          Field field=JavaAwareCompilationUnit.class.getDeclaredField("javaSources");
          field.setAccessible(true);
          LinkedList javaSources=(LinkedList)field.get(this);
          javaSources.clear();
        }
 catch (        Exception e) {
          e.printStackTrace();
        }
      }
 else       if (phase <= Phases.ALL) {
        System.out.println(GroovyRtConstants.PRESENTABLE_MESSAGE + "Groovy stub generator: " + getPhaseDescription());
      }
      super.gotoPhase(phase);
    }
  }
;
  unit.addSources(new String[]{"SomeClass.java"});
  return unit;
}
