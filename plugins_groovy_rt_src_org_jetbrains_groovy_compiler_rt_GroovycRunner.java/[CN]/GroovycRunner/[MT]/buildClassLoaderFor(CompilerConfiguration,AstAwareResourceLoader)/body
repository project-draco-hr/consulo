{
  GroovyClassLoader classLoader=AccessController.doPrivileged(new PrivilegedAction<GroovyClassLoader>(){
    public GroovyClassLoader run(){
      return new GroovyClassLoader(getClass().getClassLoader(),compilerConfiguration){
        public Class loadClass(        String name,        boolean lookupScriptFiles,        boolean preferClassOverScript) throws ClassNotFoundException, CompilationFailedException {
          Class aClass;
          try {
            aClass=super.loadClass(name,lookupScriptFiles,preferClassOverScript);
          }
 catch (          NoClassDefFoundError e) {
            throw new ClassNotFoundException(name);
          }
catch (          LinkageError e) {
            throw new RuntimeException("Problem loading class " + name,e);
          }
          if (resourceLoader.getSourceFile(name) != null) {
            try {
              for (              Method method : aClass.getDeclaredMethods()) {
                method.getGenericReturnType();
                method.getGenericExceptionTypes();
                method.getGenericParameterTypes();
              }
              for (              Field field : aClass.getDeclaredFields()) {
                field.getGenericType();
              }
              aClass.getDeclaredClasses();
              aClass.getDeclaredAnnotations();
            }
 catch (            LinkageError e) {
              throw new ClassNotFoundException(name);
            }
catch (            TypeNotPresentException e) {
              throw new ClassNotFoundException(name);
            }
          }
          return aClass;
        }
      }
;
    }
  }
);
  classLoader.setResourceLoader(resourceLoader);
  return classLoader;
}
