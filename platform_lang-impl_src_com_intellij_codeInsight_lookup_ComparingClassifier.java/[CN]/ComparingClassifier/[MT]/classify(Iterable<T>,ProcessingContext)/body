{
  List<T> nulls=null;
  TreeMap<Comparable,List<T>> map=new TreeMap<Comparable,List<T>>();
  int count=0;
  for (  T t : myNext.classify(source,context)) {
    count++;
    final Comparable weight=getWeight(t);
    if (weight == null) {
      if (nulls == null)       nulls=new SmartList<T>();
      nulls.add(t);
    }
 else {
      List<T> list=map.get(weight);
      if (list == null) {
        map.put(weight,list=new SmartList<T>());
      }
      list.add(t);
    }
  }
  ArrayList<T> result=new ArrayList<T>(count);
  Collection<List<T>> values=myNegated ? map.descendingMap().values() : map.values();
  for (  List<T> value : values) {
    result.addAll(value);
  }
  if (nulls != null) {
    result.addAll(nulls);
  }
  return result;
}
