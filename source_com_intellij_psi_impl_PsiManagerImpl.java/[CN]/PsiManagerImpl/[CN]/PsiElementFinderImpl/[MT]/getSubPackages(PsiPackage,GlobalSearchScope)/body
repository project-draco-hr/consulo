{
  final Map<String,PsiPackage> packagesMap=new HashMap<String,PsiPackage>();
  final PsiDirectory[] dirs=psiPackage.getDirectories(scope);
  for (int i=0; i < dirs.length; i++) {
    PsiDirectory[] subdirs=dirs[i].getSubdirectories();
    for (int j=0; j < subdirs.length; j++) {
      final PsiPackage aPackage=subdirs[j].getPackage();
      if (aPackage != null && !packagesMap.containsKey(aPackage.getQualifiedName())) {
        packagesMap.put(aPackage.getQualifiedName(),aPackage);
      }
    }
  }
  return packagesMap.values().toArray(new PsiPackage[packagesMap.size()]);
}
