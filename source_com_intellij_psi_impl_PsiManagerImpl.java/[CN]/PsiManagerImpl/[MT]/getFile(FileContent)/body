{
  PsiFile psiFile=content.getUserData(CACHED_PSI_FILE_COPY_IN_FILECONTENT);
  if (psiFile == null) {
    final VirtualFile vFile=content.getVirtualFile();
    psiFile=myFileManager.getCachedPsiFile(vFile);
    if (psiFile == null) {
      psiFile=findFile(vFile);
      if (psiFile == null)       return null;
      psiFile=CacheUtil.createFileCopy(content,psiFile);
    }
    content.putUserData(CACHED_PSI_FILE_COPY_IN_FILECONTENT,psiFile);
  }
  LOG.assertTrue(psiFile instanceof PsiCompiledElement || psiFile.isValid());
  return psiFile;
}
