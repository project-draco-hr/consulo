def __init__(self, ui, path, create=0):
    self._url = path
    self.ui = ui
    m = re.match('^ssh://(([^@]+)@)?([^:/]+)(:(\\d+))?(/(.*))?$', path)
    if (not m):
        self.abort(error.RepoError((_("couldn't parse location %s") % path)))
    self.user = m.group(2)
    self.host = m.group(3)
    self.port = m.group(5)
    self.path = (m.group(7) or '.')
    sshcmd = self.ui.config('ui', 'ssh', 'ssh')
    remotecmd = self.ui.config('ui', 'remotecmd', 'hg')
    args = util.sshargs(sshcmd, self.host, self.user, self.port)
    if create:
        cmd = '%s %s "%s init %s"'
        cmd = (cmd % (sshcmd, args, remotecmd, self.path))
        ui.note((_('running %s\n') % cmd))
        res = util.system(cmd)
        if (res != 0):
            self.abort(error.RepoError(_('could not create remote repo')))
    self.validate_repo(ui, sshcmd, args, remotecmd)
