def do_cmd(self, cmd, **args):
    self.ui.debug(('sending %s command\n' % cmd))
    self.pipeo.write(('%s\n' % cmd))
    for (k, v) in args.iteritems():
        self.pipeo.write(('%s %d\n' % (k, len(v))))
        self.pipeo.write(v)
    self.pipeo.flush()
    return self.pipei
