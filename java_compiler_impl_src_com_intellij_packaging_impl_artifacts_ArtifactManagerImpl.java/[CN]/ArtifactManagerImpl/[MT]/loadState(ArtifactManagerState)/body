{
  final List<ArtifactImpl> artifacts=new ArrayList<ArtifactImpl>();
  for (  ArtifactState state : managerState.getArtifacts()) {
    final Element element=state.getRootElement();
    ArtifactType type=ArtifactType.findById(state.getArtifactType());
    if (type == null) {
      LOG.info("Unknown artifact type: " + state.getArtifactType());
      continue;
    }
    final String artifactName=state.getName();
    final CompositePackagingElement<?> rootElement;
    if (element != null) {
      rootElement=(CompositePackagingElement<?>)deserializeElement(element);
    }
 else {
      rootElement=type.createRootElement(artifactName);
    }
    final ArtifactImpl artifact=new ArtifactImpl(artifactName,type,state.isBuildOnMake(),rootElement,state.getOutputPath());
    final List<ArtifactPropertiesState> propertiesList=state.getPropertiesList();
    for (    ArtifactPropertiesState propertiesState : propertiesList) {
      final ArtifactPropertiesProvider provider=ArtifactPropertiesProvider.findById(propertiesState.getId());
      if (provider != null) {
        deserializeProperties(artifact.getProperties(provider),propertiesState);
      }
    }
    artifacts.add(artifact);
  }
  if (myLoaded) {
    final ArtifactModelImpl model=new ArtifactModelImpl(this);
    model.addArtifacts(artifacts);
    doCommit(model);
  }
 else {
    myModel.setArtifactsList(artifacts);
    myLoaded=true;
  }
}
