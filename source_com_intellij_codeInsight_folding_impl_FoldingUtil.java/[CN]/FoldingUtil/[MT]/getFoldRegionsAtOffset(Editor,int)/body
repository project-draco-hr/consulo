{
  ArrayList<FoldRegion> list=new ArrayList<FoldRegion>();
  FoldRegion[] allRegions=editor.getFoldingModel().getAllFoldRegions();
  for (int i=0; i < allRegions.length; i++) {
    FoldRegion region=allRegions[i];
    if (region.getStartOffset() <= offset && offset <= region.getEndOffset()) {
      list.add(region);
    }
  }
  FoldRegion[] regions=list.toArray(new FoldRegion[list.size()]);
  Arrays.sort(regions,new Comparator(){
    public int compare(    Object o1,    Object o2){
      FoldRegion region1=(FoldRegion)o1;
      FoldRegion region2=(FoldRegion)o2;
      return region2.getStartOffset() - region1.getStartOffset();
    }
  }
);
  return regions;
}
