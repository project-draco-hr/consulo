{
  final Application app=ApplicationManager.getApplication();
  if (app.isDispatchThread()) {
    runnable.run();
    return;
  }
  final Semaphore semaphore=new Semaphore();
  semaphore.down();
  SwingUtilities.invokeLater(new Runnable(){
    @Override public void run(){
      TransactionGuard.getInstance().submitTransaction(app,myDumbStartTransaction,new Runnable(){
        @Override public void run(){
          try {
            runnable.run();
          }
  finally {
            semaphore.up();
          }
        }
      }
);
    }
  }
);
  try {
    semaphore.waitFor();
  }
 catch (  ProcessCanceledException ignore) {
  }
}
