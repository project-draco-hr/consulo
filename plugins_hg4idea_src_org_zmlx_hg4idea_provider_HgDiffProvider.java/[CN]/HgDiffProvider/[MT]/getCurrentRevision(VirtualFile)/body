{
  VirtualFile vcsRoot=VcsUtil.getVcsRootFor(project,file);
  if (vcsRoot == null) {
    return null;
  }
  HgWorkingCopyRevisionsCommand command=new HgWorkingCopyRevisionsCommand(project);
  HgRevisionNumber currentRevision=command.identify(vcsRoot);
  if (currentRevision == null) {
    return null;
  }
  if (currentRevision.isWorkingVersion()) {
    return command.parent(vcsRoot);
  }
  return currentRevision;
}
