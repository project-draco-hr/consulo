{
  Connection c=new Connection(myHost.getHostName(),myHost.getPort());
  try {
    configureKnownHosts(c);
    c.connect(new HostKeyVerifier());
    authenticate(c);
    final Session s=c.openSession();
    try {
      s.execCommand(myCommand);
      forward("stdin",s.getStdin(),System.in,false);
      forward("stdout",System.out,s.getStdout(),true);
      forward("stderr",System.err,s.getStderr(),true);
      myForwardCompleted.acquire(2);
      s.waitForCondition(ChannelCondition.EXIT_STATUS,Long.MAX_VALUE);
      Integer exitStatus=s.getExitStatus();
      if (exitStatus == null) {
        exitStatus=1;
      }
      System.exit(exitStatus.intValue() == 0 ? myExitCode : exitStatus.intValue());
    }
  finally {
      s.close();
    }
  }
  finally {
    c.close();
  }
}
