{
  final boolean indexProblems=performDumbAwareUpdate(action,e,true);
  if (!indexProblems) {
    if (!e.getPresentation().isEnabled()) {
      return false;
    }
    if (visibilityMatters && !e.getPresentation().isVisible()) {
      return false;
    }
  }
  if (DumbService.getInstance().isDumb() && !(action instanceof DumbAware)) {
    showDumbModeWarning(e);
    return false;
  }
  return true;
}
