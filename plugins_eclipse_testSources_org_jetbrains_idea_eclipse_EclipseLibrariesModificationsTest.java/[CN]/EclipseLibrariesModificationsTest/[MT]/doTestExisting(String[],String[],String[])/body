{
  final Project project=getProject();
  final String path=project.getBaseDir().getPath() + "/test";
  final Module module=EclipseClasspathTest.setUpModule(path,project);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      final ModifiableRootModel model=ModuleRootManager.getInstance(module).getModifiableModel();
      final String parentUrl=VirtualFileManager.constructUrl(JarFileSystem.PROTOCOL,model.getContentRoots()[0].getParent().getPath());
      final Library library=model.getModuleLibraryTable().getLibraryByName("test.jar");
      final Library.ModifiableModel libModifiableModel=library.getModifiableModel();
      final String[] oldClsRoots=libModifiableModel.getUrls(OrderRootType.CLASSES);
      for (      String oldClsRoot : oldClsRoots) {
        libModifiableModel.removeRoot(oldClsRoot,OrderRootType.CLASSES);
      }
      final String[] oldSrcRoots=libModifiableModel.getUrls(OrderRootType.SOURCES);
      for (      String oldSrcRoot : oldSrcRoots) {
        libModifiableModel.removeRoot(oldSrcRoot,OrderRootType.SOURCES);
      }
      final String[] oldJdcRoots=libModifiableModel.getUrls(JavadocOrderRootType.getInstance());
      for (      String oldJavadocRoot : oldJdcRoots) {
        libModifiableModel.removeRoot(oldJavadocRoot,JavadocOrderRootType.getInstance());
      }
      for (      String classRoot : classRoots) {
        libModifiableModel.addRoot(parentUrl + classRoot,OrderRootType.CLASSES);
      }
      for (      String sourceRoot : sourceRoots) {
        libModifiableModel.addRoot(parentUrl + sourceRoot,OrderRootType.SOURCES);
      }
      for (      String javadocRoot : javadocs) {
        libModifiableModel.addRoot(parentUrl + javadocRoot,JavadocOrderRootType.getInstance());
      }
      libModifiableModel.commit();
      model.commit();
    }
  }
);
  EclipseClasspathTest.checkModule(project.getBaseDir().getPath() + "/expected",module);
  EclipseEmlTest.checkModule(project.getBaseDir().getPath() + "/expected",module);
}
