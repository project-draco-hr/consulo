{
  final Project project=getProject();
  final String path=project.getBaseDir().getPath() + "/test";
  final Module module=EclipseClasspathTest.setUpModule(path,project);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      final ModifiableRootModel model=ModuleRootManager.getInstance(module).getModifiableModel();
      final String parentUrl=VirtualFileManager.constructUrl(JarFileSystem.PROTOCOL,model.getContentRoots()[0].getParent().getPath());
      final Library library=model.getModuleLibraryTable().createLibrary("created");
      final Library.ModifiableModel libModifiableModel=library.getModifiableModel();
      for (      String classRoot : classRoots) {
        libModifiableModel.addRoot(parentUrl + classRoot,OrderRootType.CLASSES);
      }
      for (      String sourceRoot : sourceRoots) {
        libModifiableModel.addRoot(parentUrl + sourceRoot,OrderRootType.SOURCES);
      }
      libModifiableModel.commit();
      model.commit();
    }
  }
);
  EclipseClasspathTest.checkModule(project.getBaseDir().getPath() + "/expected",module);
}
