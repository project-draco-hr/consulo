{
  try {
    final ContentRevision fileRevision=diffProvider.createFileContent(revisionNumber,selectedFile);
    if (fileRevision != null) {
      final Ref<VcsException> ex=new Ref<VcsException>();
      ProgressManager.getInstance().runProcessWithProgressSynchronously(new Runnable(){
        public void run(){
          try {
            fileRevision.getContent();
          }
 catch (          VcsException e) {
            ex.set(e);
          }
        }
      }
,"Loading content...",true,project);
      if (!ex.isNull()) {
        AbstractVcsHelper.getInstance(project).showError(ex.get(),VcsBundle.message("message.title.diff"));
        return;
      }
      if (fileRevision instanceof BinaryContentRevision) {
        if (Arrays.equals(selectedFile.contentsToByteArray(),((BinaryContentRevision)fileRevision).getBinaryContent())) {
          Messages.showInfoMessage(VcsBundle.message("message.text.binary.versions.are.identical"),VcsBundle.message("message.title.diff"));
        }
 else {
          Messages.showInfoMessage(VcsBundle.message("message.text.binary.versions.are.different"),VcsBundle.message("message.title.diff"));
        }
        return;
      }
      final SimpleDiffRequest request=new SimpleDiffRequest(project,selectedFile.getPresentableUrl());
      final SimpleContent content1=new SimpleContent(fileRevision.getContent(),selectedFile.getFileType());
      final DocumentContent content2=new DocumentContent(project,FileDocumentManager.getInstance().getDocument(selectedFile));
      final VcsRevisionNumber currentRevision=diffProvider.getCurrentRevision(selectedFile);
      if (revisionNumber.compareTo(currentRevision) > 0) {
        request.setContents(content2,content1);
        request.setContentTitles(VcsBundle.message("diff.title.local"),revisionNumber.asString());
      }
 else {
        request.setContents(content1,content2);
        request.setContentTitles(revisionNumber.asString(),VcsBundle.message("diff.title.local"));
      }
      request.addHint(DiffTool.HINT_SHOW_FRAME);
      DiffManager.getInstance().getDiffTool().show(request);
    }
  }
 catch (  ProcessCanceledException e) {
  }
catch (  VcsException e) {
    AbstractVcsHelper.getInstance(project).showError(e,VcsBundle.message("message.title.diff"));
  }
catch (  IOException e) {
    AbstractVcsHelper.getInstance(project).showError(new VcsException(e),VcsBundle.message("message.title.diff"));
  }
}
