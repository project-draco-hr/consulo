{
  if (cellRenderer == null || list == null) {
    cellRenderer=new ThumbnailListCellRenderer();
    ImageComponent imageComponent=cellRenderer.getImageComponent();
    VirtualFileManager.getInstance().addVirtualFileListener(vfsListener);
    Options options=OptionsManager.getInstance().getOptions();
    EditorOptions editorOptions=options.getEditorOptions();
    TransparencyChessboardOptions chessboardOptions=editorOptions.getTransparencyChessboardOptions();
    imageComponent.setTransparencyChessboardVisible(chessboardOptions.isShowDefault());
    imageComponent.setTransparencyChessboardCellSize(chessboardOptions.getCellSize());
    imageComponent.setTransparencyChessboardWhiteColor(chessboardOptions.getWhiteColor());
    imageComponent.setTransparencyChessboardBlankColor(chessboardOptions.getBlackColor());
    options.addPropertyChangeListener(optionsListener);
    list=new JList();
    list.setModel(new DefaultListModel());
    list.setLayoutOrientation(JList.HORIZONTAL_WRAP);
    list.setVisibleRowCount(-1);
    list.setCellRenderer(cellRenderer);
    list.addMouseListener(new ThumbnailsMouseAdapter());
    ThumbnailComponentUI ui=(ThumbnailComponentUI)UIManager.getUI(cellRenderer);
    Dimension preferredSize=ui.getPreferredSize(cellRenderer);
    list.setFixedCellWidth(preferredSize.width);
    list.setFixedCellHeight(preferredSize.height);
    JScrollPane scrollPane=new JScrollPane(list,JScrollPane.VERTICAL_SCROLLBAR_AS_NEEDED,JScrollPane.HORIZONTAL_SCROLLBAR_NEVER);
    JPanel toolBar=new JPanel();
    toolBar.setLayout(new BorderLayout());
    add(toolBar,BorderLayout.NORTH);
    add(scrollPane,BorderLayout.CENTER);
    ActionManager actionManager=ActionManager.getInstance();
    ActionGroup actionGroup=(ActionGroup)actionManager.getAction(ThumbnailsActions.GROUP_TOOLBAR);
    ActionToolbar actionToolbar=actionManager.createActionToolbar(ThumbnailsActions.GROUP_TOOLBAR,actionGroup,true);
    toolBar.add(actionToolbar.getComponent(),BorderLayout.WEST);
    refresh();
  }
}
