{
  SelectionModel selectionModel=editor.getSelectionModel();
  if (selectionModel.hasBlockSelection())   deleteBlockSelection(editor);
  if (!selectionModel.hasSelection())   return;
  int selectionStart=selectionModel.getSelectionStart();
  int selectionEnd=selectionModel.getSelectionEnd();
  final CaretModel caretModel=editor.getCaretModel();
  final int caretOffset=caretModel.getOffset();
  boolean restorePosition=caretOffset > selectionStart && caretOffset < selectionEnd;
  final VisualPosition position=caretModel.getVisualPosition();
  caretModel.moveToOffset(selectionStart);
  selectionModel.removeSelection();
  editor.getDocument().deleteString(selectionStart,selectionEnd);
  if (restorePosition) {
    caretModel.moveToVisualPosition(position);
  }
  editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
}
