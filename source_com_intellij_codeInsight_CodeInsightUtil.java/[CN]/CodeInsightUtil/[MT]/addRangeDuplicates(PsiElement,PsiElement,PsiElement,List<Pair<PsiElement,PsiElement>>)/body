{
  final PsiElement[] children=getFilteredChildren(scope);
  for (int i=0; i < children.length; ) {
    PsiElement child=children[i];
    int j=i;
    PsiElement next=first;
    do {
      if (!areElementsEquivalent(children[j],next))       break;
      j++;
      if (next == last)       break;
      next=PsiTreeUtil.skipSiblingsForward(next,new Class[]{PsiWhiteSpace.class});
    }
 while (true);
    if (next == last && j > i) {
      if (child != first) {
        result.add(new Pair<PsiElement,PsiElement>(child,children[j - 1]));
      }
      i=j + 1;
      continue;
    }
 else     if (i == j) {
      addRangeDuplicates(child,first,last,result);
    }
    i++;
  }
}
