{
  PsiElement element1=file.findElementAt(startOffset);
  PsiElement element2=file.findElementAt(endOffset - 1);
  if (element1 instanceof PsiWhiteSpace) {
    startOffset=element1.getTextRange().getEndOffset();
    element1=file.findElementAt(startOffset);
  }
  if (element2 instanceof PsiWhiteSpace) {
    endOffset=element2.getTextRange().getStartOffset();
    element2=file.findElementAt(endOffset - 1);
  }
  if (element1 == null || element2 == null)   return null;
  PsiElement parent=PsiTreeUtil.findCommonParent(element1,element2);
  while (true) {
    if (parent instanceof PsiStatement) {
      parent=parent.getParent();
      break;
    }
    if (parent instanceof PsiCodeBlock)     break;
    if (parent instanceof JspFile)     break;
    if (parent instanceof PsiFile)     return null;
    parent=parent.getParent();
  }
  while (!element1.getParent().equals(parent)) {
    element1=element1.getParent();
  }
  if (startOffset != element1.getTextRange().getStartOffset())   return null;
  while (!element2.getParent().equals(parent)) {
    element2=element2.getParent();
  }
  if (endOffset != element2.getTextRange().getEndOffset())   return null;
  if (parent instanceof PsiCodeBlock && parent.getParent() instanceof PsiBlockStatement && element1 == ((PsiCodeBlock)parent).getLBrace() && element2 == ((PsiCodeBlock)parent).getRBrace()) {
    return new PsiElement[]{parent.getParent()};
  }
  PsiElement[] children=parent.getChildren();
  ArrayList<PsiElement> array=new ArrayList<PsiElement>();
  boolean flag=false;
  for (int i=0; i < children.length; i++) {
    PsiElement child=children[i];
    if (child.equals(element1)) {
      flag=true;
    }
    if (flag && !(child instanceof PsiWhiteSpace)) {
      array.add(child);
    }
    if (child.equals(element2)) {
      break;
    }
  }
  for (int i=0; i < array.size(); i++) {
    PsiElement element=array.get(i);
    if (!(element instanceof PsiStatement || element instanceof PsiWhiteSpace || element instanceof PsiComment)) {
      return null;
    }
  }
  return array.toArray(new PsiElement[array.size()]);
}
