{
  if (!compileRequest.hasProjectId()) {
    return ProtoUtil.createCommandRejectedResponse("No project specified");
  }
  final String projectId=compileRequest.getProjectId();
  final JpsRemoteProto.Message.Request.CompilationRequest.Type commandType=compileRequest.getCommandType();
  if (commandType == JpsRemoteProto.Message.Request.CompilationRequest.Type.CLEAN || commandType == JpsRemoteProto.Message.Request.CompilationRequest.Type.MAKE || commandType == JpsRemoteProto.Message.Request.CompilationRequest.Type.REBUILD) {
    if (myBuildsInProgress.putIfAbsent(projectId,"") != null) {
      return ProtoUtil.createCommandRejectedResponse("Project is being compiled already");
    }
    myBuildsExecutorService.submit(new CompilationTask(sessionId,channelContext,commandType,projectId,compileRequest.getModuleNameList()));
    return null;
  }
  if (commandType == JpsRemoteProto.Message.Request.CompilationRequest.Type.CANCEL) {
    final String projectInProgress=myBuildsInProgress.remove(projectId);
    if (projectInProgress == null) {
      return ProtoUtil.createCommandRejectedResponse("Build for requested project is not running");
    }
    return ProtoUtil.createBuildCanceledResponse(projectId);
  }
  return ProtoUtil.createCommandRejectedResponse("Unsupported command: '" + commandType + "'");
}
