{
  final PsiElement parent=e.getParent();
  if (!(e instanceof PsiErrorElement)) {
    final FileViewProvider viewProvider=e.getContainingFile().getViewProvider();
    if (viewProvider.getBaseLanguage() != e.getLanguage()) {
      final PsiFile baseRoot=viewProvider.getPsi(viewProvider.getBaseLanguage());
      if (parent.getTextLength() == baseRoot.getTextLength()) {
        final ASTNode node=baseRoot.getNode();
        if (node == null)         return parent;
        final ASTNode leafElementAt=node.findLeafElementAt(e.getTextRange().getStartOffset());
        return leafElementAt != null ? leafElementAt.getPsi() : parent;
      }
    }
  }
  return parent;
}
