{
  myFragments=new Fragment[text.length()];
  for (int i=0; i < text.length(); i++) {
    char c=text.charAt(i);
    String labelText=mapChar(c);
    Fragment fragment=new Fragment();
    final int startOffset=i;
    if (c == ' ' || c == '\t') {
      for (int k=startOffset + 1; k < text.length(); k++) {
        char nextChar=text.charAt(k);
        if (nextChar == c) {
          labelText+=mapChar(nextChar);
          i++;
        }
 else {
          break;
        }
      }
    }
    int endOffset=i + 1;
    fragment.range=new GwtTextRange(startOffset,endOffset);
    fragment.widget=new InlineHTML(labelText.isEmpty() ? "&#8205;" : labelText);
    fragment.widget.setStyleName(null);
    fragment.widget.getElement().setPropertyObject("range",fragment.range);
    fragment.widget.getElement().setPropertyObject("widget",fragment.widget);
    fragment.lineWrap=labelText.isEmpty();
    if (fragment.lineWrap) {
      myLineCount++;
    }
    for (int k=startOffset; k < endOffset; k++) {
      myFragments[k]=fragment;
    }
  }
}
