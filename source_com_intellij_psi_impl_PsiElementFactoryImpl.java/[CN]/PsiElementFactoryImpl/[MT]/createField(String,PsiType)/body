{
  PsiUtil.checkIsIdentifier(myManager,name);
  if (PsiType.NULL.equals(type)) {
    throw new IncorrectOperationException("Cannot create field with type \"<null_type>\".");
  }
  TreeElement typeCopy=ChangeUtil.copyToElement(createTypeElement(type));
  typeCopy.acceptTree(new GeneratedMarkerVisitor());
  @NonNls String text="class _Dummy_ {private int " + name + ";}";
  PsiJavaFile aFile=createDummyJavaFile(text);
  PsiClass aClass=aFile.getClasses()[0];
  PsiField field=aClass.getFields()[0];
  SourceTreeToPsiMap.psiElementToTree(field).replaceChild(SourceTreeToPsiMap.psiElementToTree(field.getTypeElement()),typeCopy);
  ChangeUtil.decodeInformation((TreeElement)SourceTreeToPsiMap.psiElementToTree(field));
  return (PsiField)CodeStyleManager.getInstance(myManager.getProject()).reformat(field);
}
