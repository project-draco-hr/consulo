{
  if (!myManager.getNameHelper().isIdentifier(name)) {
    throw new IncorrectOperationException("\"" + name + "\" is not an identifier.");
  }
  if (type == PsiType.NULL) {
    throw new IncorrectOperationException("Cannot create field with type \"<null_type>\".");
  }
  @NonNls StringBuilder buffer=new StringBuilder();
  buffer.append("X ");
  buffer.append(name);
  if (initializer != null) {
    buffer.append("=x");
  }
  buffer.append(";");
  PsiDeclarationStatement statement=(PsiDeclarationStatement)createStatementFromText(buffer.toString(),null);
  PsiVariable variable=(PsiVariable)statement.getDeclaredElements()[0];
  variable.getTypeElement().replace(createTypeElement(type));
  variable.getModifierList().setModifierProperty(PsiModifier.FINAL,CodeStyleSettingsManager.getSettings(myManager.getProject()).GENERATE_FINAL_LOCALS);
  if (initializer != null) {
    variable.getInitializer().replace(initializer);
  }
  markGenerated(statement);
  return statement;
}
