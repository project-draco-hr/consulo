{
  if (xmlElement == null) {
    return;
  }
  Set<PsiReference> processed=null;
  for (  final PsiReference ref : xmlElement.getReferences()) {
    if (!(ref instanceof AntDomReference)) {
      continue;
    }
    final AntDomReference antDomRef=(AntDomReference)ref;
    if (antDomRef.shouldBeSkippedByAnnotator()) {
      continue;
    }
    if (processed != null && processed.contains(ref)) {
      continue;
    }
    if (ref.resolve() == null) {
      final TextRange absoluteRange=ref.getRangeInElement().shiftRight(ref.getElement().getTextRange().getStartOffset());
      final Annotation annotation=holder.createErrorAnnotation(absoluteRange,antDomRef.getUnresolvedMessagePattern());
      annotation.setHighlightType(ProblemHighlightType.LIKE_UNKNOWN_SYMBOL);
      if (ref instanceof AntDomFileReference) {
        if (processed == null) {
          processed=new HashSet<PsiReference>();
        }
        ContainerUtil.addAll(processed,((AntDomFileReference)ref).getFileReferenceSet().getAllReferences());
      }
    }
  }
}
