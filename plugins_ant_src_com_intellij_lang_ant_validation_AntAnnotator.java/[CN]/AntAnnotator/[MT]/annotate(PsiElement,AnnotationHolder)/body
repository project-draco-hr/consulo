{
  AntElement element=(AntElement)psiElement;
  if (element instanceof AntTask) {
    final AntTask task=(AntTask)element;
    AntTaskDefinition def=task.getTaskDefinition();
    if (def == null) {
      holder.createErrorAnnotation(task,AntBundle.getMessage("undefined.task",task.getName()));
    }
 else {
      checkValidAttributes(task,def,holder);
      final AntElement parent=task.getAntParent();
      if (parent instanceof AntTask) {
        final AntTask parentTask=(AntTask)parent;
        final AntTaskDefinition parentDef=parentTask.getTaskDefinition();
        if (parentDef != null && parentDef.getTaskDefinition(def.getClassName()) == null) {
          final TextRange textRange=new TextRange(0,task.getName().length()).shiftRight(task.getSourceElement().getTextOffset());
          holder.createErrorAnnotation(textRange,AntBundle.getMessage("nested.element.is.not.allowed.for.the.task"));
        }
      }
    }
  }
  checkReferences(element,holder);
}
