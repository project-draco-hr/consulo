{
  final CompositePackagingElement<?> oldParent=getParent();
  CompositePackagingElement<?> parent=(CompositePackagingElement<?>)ensureRootIsWritable().fun(oldParent);
  if (parent == null) {
    return;
  }
  if (parentType != null) {
    final CompositePackagingElement<?> element=parentType.createComposite(myContext,parent);
    if (element == null)     return;
    parent.addChild(element);
    parent=element;
  }
  final List<? extends PackagingElement<?>> children=type.createWithDialog(myContext,getArtifact(),parent);
  for (  PackagingElement<?> child : children) {
    parent.addChild(child);
  }
  myArtifactsEditor.rebuildTries();
  final PackagingElementNode node=findNode(parent);
  if (node != null) {
    myTree.expandPath(TreeUtil.getPathFromRoot(node));
  }
  selectElements(children);
}
