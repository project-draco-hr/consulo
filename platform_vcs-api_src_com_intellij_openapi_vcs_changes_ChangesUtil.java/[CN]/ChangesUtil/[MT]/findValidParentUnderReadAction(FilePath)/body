{
  if (file.getVirtualFile() != null)   return file.getVirtualFile();
  final Computable<VirtualFile> computable=new Computable<VirtualFile>(){
    @Override public VirtualFile compute(){
      return findValidParent(file);
    }
  }
;
  final Application application=ApplicationManager.getApplication();
  if (application.isReadAccessAllowed()) {
    return computable.compute();
  }
 else {
    return application.runReadAction(computable);
  }
}
