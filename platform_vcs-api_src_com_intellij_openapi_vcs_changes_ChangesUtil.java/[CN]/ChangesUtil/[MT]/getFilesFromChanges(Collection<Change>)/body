{
  ArrayList<VirtualFile> files=new ArrayList<VirtualFile>();
  for (  Change change : changes) {
    final ContentRevision afterRevision=change.getAfterRevision();
    if (afterRevision != null) {
      VirtualFile file=afterRevision.getFile().getVirtualFile();
      if (file != null && file.isValid()) {
        files.add(file);
      }
 else {
        afterRevision.getFile().hardRefresh();
        file=afterRevision.getFile().getVirtualFile();
        if (file != null && file.isValid()) {
          files.add(file);
        }
      }
    }
  }
  return VfsUtil.toVirtualFileArray(files);
}
