{
  final PsiElementFactory factory=PsiManager.getInstance(myProject).getElementFactory();
  if (myExceptionClasses.length == 1) {
    ArrayList<PsiReference> refs=new ArrayList<PsiReference>();
    findExceptionThrownPlaces(refs,factory.createType(myExceptionClasses[0]),myHighlightInPlace,myTypeFilter);
    new DoHighlightRunnable(refs.toArray(new PsiReference[refs.size()]),myProject,myTarget,myEditor,myFile).run();
  }
 else   if (myExceptionClasses.length > 0) {
    PsiClassListCellRenderer renderer=new PsiClassListCellRenderer();
    Arrays.sort(myExceptionClasses,renderer.getComparator());
    Vector<Object> model=new Vector<Object>(Arrays.asList(myExceptionClasses));
    model.insertElementAt(CodeInsightBundle.message("highlight.thrown.exceptions.chooser.all.entry"),0);
    myList=new JList(model);
    myList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
    myList.setCellRenderer(renderer);
    renderer.installSpeedSearch(myList);
    final Runnable callback=new Runnable(){
      public void run(){
        int idx=myList.getSelectedIndex();
        if (idx < 0)         return;
        ArrayList<PsiReference> refs=new ArrayList<PsiReference>();
        if (idx > 0) {
          findExceptionThrownPlaces(refs,factory.createType(myExceptionClasses[idx - 1]),myHighlightInPlace,myTypeFilter);
        }
 else {
          for (          PsiClass exceptionClass : myExceptionClasses) {
            findExceptionThrownPlaces(refs,factory.createType(exceptionClass),myHighlightInPlace,myTypeFilter);
          }
        }
        new DoHighlightRunnable(refs.toArray(new PsiReference[refs.size()]),myProject,myTarget,myEditor,myFile).run();
      }
    }
;
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        JBPopupFactory.getInstance().createListPopupBuilder().setList(myList).setTitle(CodeInsightBundle.message("highlight.exceptions.thrown.chooser.title")).setItemChoosenCallback(callback).createPopup().showInBestPositionFor(myEditor);
      }
    }
);
  }
}
