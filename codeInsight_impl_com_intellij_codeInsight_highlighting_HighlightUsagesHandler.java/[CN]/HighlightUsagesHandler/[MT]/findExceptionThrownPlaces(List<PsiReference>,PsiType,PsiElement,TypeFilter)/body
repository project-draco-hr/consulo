{
  if (type instanceof PsiClassType) {
    block.accept(new PsiRecursiveElementVisitor(){
      public void visitReferenceExpression(      PsiReferenceExpression expression){
        visitElement(expression);
      }
      public void visitThrowStatement(      PsiThrowStatement statement){
        super.visitThrowStatement(statement);
        PsiClassType[] exceptionTypes=ExceptionUtil.getUnhandledExceptions(statement,block);
        for (        final PsiClassType actualType : exceptionTypes) {
          if (type.isAssignableFrom(actualType) && typeFilter.accept(actualType)) {
            PsiExpression psiExpression=statement.getException();
            if (psiExpression instanceof PsiReferenceExpression) {
              PsiReferenceExpression referenceExpression=(PsiReferenceExpression)psiExpression;
              if (!refs.contains(referenceExpression))               refs.add(referenceExpression);
            }
 else             if (!(psiExpression instanceof PsiNewExpression)) {
              PsiJavaCodeReferenceElement ref=((PsiNewExpression)psiExpression).getClassReference();
              if (!refs.contains(ref))               refs.add(ref);
            }
          }
        }
      }
      public void visitMethodCallExpression(      PsiMethodCallExpression expression){
        super.visitMethodCallExpression(expression);
        if (refs.contains(expression.getMethodExpression().getReference()))         return;
        PsiClassType[] exceptionTypes=ExceptionUtil.getUnhandledExceptions(expression,block);
        for (        final PsiClassType actualType : exceptionTypes) {
          if (type.isAssignableFrom(actualType) && typeFilter.accept(actualType)) {
            refs.add(expression.getMethodExpression().getReference());
          }
        }
      }
      public void visitNewExpression(      PsiNewExpression expression){
        super.visitNewExpression(expression);
        if (refs.contains(expression.getClassReference()))         return;
        PsiClassType[] exceptionTypes=ExceptionUtil.getUnhandledExceptions(expression,block);
        for (        PsiClassType actualType : exceptionTypes) {
          if (type.isAssignableFrom(actualType) && typeFilter.accept(actualType)) {
            refs.add(expression.getClassReference());
          }
        }
      }
    }
);
  }
}
