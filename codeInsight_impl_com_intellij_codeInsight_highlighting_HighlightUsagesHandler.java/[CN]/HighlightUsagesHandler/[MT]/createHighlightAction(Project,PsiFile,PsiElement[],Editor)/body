{
  if (file instanceof PsiCompiledElement)   file=(PsiFile)((PsiCompiledElement)file).getMirror();
  PsiElement target=targets[0];
  HighlightManager highlightManager=HighlightManager.getInstance(project);
  boolean clearHighlights=isClearHighlights(editor,highlightManager);
  if (target instanceof PsiKeyword) {
    Runnable runnable=highlightKeyword((PsiKeyword)target,editor,file,clearHighlights);
    if (runnable != null) {
      return runnable;
    }
  }
  PsiElement context=InjectedLanguageUtil.getTopLevelFile(file);
  SearchScope searchScope=new LocalSearchScope(context);
  Collection<PsiReference> refs;
  if (target instanceof PsiMethod) {
    refs=MethodReferencesSearch.search((PsiMethod)target,searchScope,true).findAll();
  }
 else {
    refs=ReferencesSearch.search(target,searchScope,false).findAll();
  }
  return new DoHighlightRunnable(new ArrayList<PsiReference>(refs),project,target,editor,file,clearHighlights);
}
