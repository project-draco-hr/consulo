{
  List<TextRange> textRanges=new ArrayList<TextRange>(refs.size());
  for (  PsiReference ref : refs) {
    PsiElement element=ref.getElement();
    TextRange rangeInElement=ref.getRangeInElement();
    TextRange range=element.getTextRange().cutOut(rangeInElement);
    textRanges.add(range);
  }
  if (clearHighlights) {
    clearHighlights(editor,highlightManager,textRanges,attributes);
    return;
  }
  ArrayList<RangeHighlighter> outHighlighters=new ArrayList<RangeHighlighter>();
  Document document=editor.getDocument();
  PsiReference[] refArray=refs.toArray(new PsiReference[refs.size()]);
  highlightManager.addOccurrenceHighlights(editor,refArray,attributes,false,outHighlighters);
  for (int idx=0; idx < outHighlighters.size(); idx++) {
    RangeHighlighter highlighter=outHighlighters.get(idx);
    int offset=refArray[idx].getElement().getTextRange().getStartOffset() + refArray[idx].getRangeInElement().getStartOffset();
    setLineTextErrorStripeTooltip(document,offset,highlighter);
  }
}
