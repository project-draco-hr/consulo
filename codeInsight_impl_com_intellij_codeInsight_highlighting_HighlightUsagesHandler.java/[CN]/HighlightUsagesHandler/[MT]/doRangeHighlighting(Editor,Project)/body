{
  if (!editor.getSelectionModel().hasSelection())   return;
  String text=editor.getSelectionModel().getSelectedText();
  FindManager findManager=FindManager.getInstance(project);
  FindModel model=new FindModel();
  model.setCaseSensitive(true);
  model.setFromCursor(false);
  model.setStringToFind(text);
  model.setSearchHighlighters(true);
  int offset=0;
  FindResult result;
  HighlightManager highlightManager=HighlightManager.getInstance(project);
  EditorColorsManager colorManager=EditorColorsManager.getInstance();
  TextAttributes attributes=colorManager.getGlobalScheme().getAttributes(EditorColors.TEXT_SEARCH_RESULT_ATTRIBUTES);
  int count=0;
  ArrayList<RangeHighlighter> highlighters=new ArrayList<RangeHighlighter>();
  while (true) {
    result=findManager.findString(editor.getDocument().getCharsSequence(),offset,model);
    if (!result.isStringFound())     break;
    highlightManager.addRangeHighlight(editor,result.getStartOffset(),result.getEndOffset(),attributes,false,highlighters);
    offset=result.getEndOffset();
    count++;
  }
  for (  RangeHighlighter highlighter : highlighters) {
    highlighter.setErrorStripeTooltip(text);
  }
  findManager.setFindWasPerformed();
  findManager.setFindNextModel(model);
  WindowManager.getInstance().getStatusBar(project).setInfo(CodeInsightBundle.message("status.bar.highlighted.occurences.message",count,model.getStringToFind()));
}
