{
  if (type == null)   return null;
  return type.accept(new PsiTypeVisitor<PsiType>(){
    @Override public PsiType visitClassType(    PsiClassType classType){
      final PsiClass aClass=classType.resolve();
      if (aClass instanceof PsiTypeParameter) {
        return typeParameterErasure((PsiTypeParameter)aClass,beforeSubstitutor);
      }
 else {
        return classType.rawType();
      }
    }
    @Override public PsiType visitWildcardType(    PsiWildcardType wildcardType){
      return wildcardType.getExtendsBound().accept(this);
    }
    @Override public PsiType visitPrimitiveType(    PsiPrimitiveType primitiveType){
      return primitiveType;
    }
    @Override public PsiType visitEllipsisType(    PsiEllipsisType ellipsisType){
      final PsiType componentType=ellipsisType.getComponentType();
      final PsiType newComponentType=componentType.accept(this);
      if (newComponentType == componentType)       return ellipsisType;
      return newComponentType != null ? newComponentType.createArrayType() : null;
    }
    @Override public PsiType visitArrayType(    PsiArrayType arrayType){
      final PsiType componentType=arrayType.getComponentType();
      final PsiType newComponentType=componentType.accept(this);
      if (newComponentType == componentType)       return arrayType;
      return newComponentType != null ? newComponentType.createArrayType() : null;
    }
    @Override public PsiType visitDisjunctionType(    PsiDisjunctionType disjunctionType){
      final PsiClassType lub=PsiTypesUtil.getLowestUpperBoundClassType(disjunctionType);
      return lub != null ? erasure(lub,beforeSubstitutor) : disjunctionType;
    }
  }
);
}
