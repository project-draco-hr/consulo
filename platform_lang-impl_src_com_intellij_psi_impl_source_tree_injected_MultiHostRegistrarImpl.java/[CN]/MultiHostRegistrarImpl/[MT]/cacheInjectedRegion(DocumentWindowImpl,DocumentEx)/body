{
  List<RangeMarker> injectedRegions=InjectedLanguageUtil.getCachedInjectedRegions(hostDocument);
  RangeMarker newMarker=documentWindow.getHostRanges()[0];
  TextRange newRange=InjectedLanguageUtil.toTextRange(newMarker);
  for (int i=0; i < injectedRegions.size(); i++) {
    RangeMarker stored=injectedRegions.get(i);
    if (!stored.isValid())     continue;
    TextRange storedRange=InjectedLanguageUtil.toTextRange(stored);
    if (storedRange.intersects(newRange)) {
      injectedRegions.set(i,newMarker);
      break;
    }
    if (storedRange.getStartOffset() > newRange.getEndOffset()) {
      injectedRegions.add(i,newMarker);
      break;
    }
  }
  if (injectedRegions.isEmpty() || newRange.getStartOffset() > injectedRegions.get(injectedRegions.size() - 1).getEndOffset()) {
    injectedRegions.add(newMarker);
  }
}
