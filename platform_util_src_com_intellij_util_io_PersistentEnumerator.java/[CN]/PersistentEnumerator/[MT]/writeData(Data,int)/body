{
  try {
    markDirty(true);
    final int dataOff=myKeyStorage != null ? (int)myKeyStorage.length() : ((InlineKeyDescriptor<Data>)myDataDescriptor).toInt(value);
    byte[] buf=prepareEntryRecordBuf(hashCode,dataOff);
    if (myKeyStorage != null) {
      final ByteArrayOutputStream bos=new ByteArrayOutputStream();
      DataOutput out=new DataOutputStream(bos);
      myDataDescriptor.save(out,value);
      myKeyStorage.put(dataOff,bos.toByteArray(),0,bos.size());
    }
    final ResizeableMappedFile storage=myStorage;
    final int pos=(int)storage.length();
    storage.put(pos,buf,0,buf.length);
    return pos;
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
