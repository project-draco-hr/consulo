{
  final RefactorJ plugin=RefactorJ.getInstance();
  final ScrollingModel scrollingModel=editor.getScrollingModel();
  scrollingModel.scrollToCaret(ScrollType.MAKE_VISIBLE);
  final CaretModel caretModel=editor.getCaretModel();
  final int position=caretModel.getOffset();
  final PsiElement element=file.findElementAt(position);
  final PsiClass containingClass=PsiTreeUtil.getParentOfType(element,PsiClass.class,false);
  final PsiMember selectedMember=PsiTreeUtil.getParentOfType(element,PsiMember.class,false);
  if (containingClass == null) {
    showErrorMessage(RefactorJBundle.message("cannot.perform.the.refactoring") + RefactorJBundle.message("the.caret.should.be.positioned.within.a.class.to.be.refactored"),project);
    return;
  }
  if (containingClass.isInterface()) {
    showErrorMessage(RefactorJBundle.message("cannot.perform.the.refactoring") + RefactorJBundle.message("the.selected.class.is.an.interface"),project);
    return;
  }
  if (containingClass.isEnum()) {
    showErrorMessage(RefactorJBundle.message("cannot.perform.the.refactoring") + RefactorJBundle.message("the.selected.class.is.an.enumeration"),project);
    return;
  }
  if (containingClass.isAnnotationType()) {
    showErrorMessage(RefactorJBundle.message("cannot.perform.the.refactoring") + RefactorJBundle.message("the.selected.class.is.an.annotation.type"),project);
    return;
  }
  if (classIsInner(containingClass) && !containingClass.hasModifierProperty(PsiModifier.STATIC)) {
    showErrorMessage(RefactorJBundle.message("cannot.perform.the.refactoring") + RefactorJBundle.message("the.refactoring.is.not.supported.on.non.static.inner.classes"),project);
    return;
  }
  if (classIsTrivial(containingClass)) {
    showErrorMessage(RefactorJBundle.message("cannot.perform.the.refactoring") + RefactorJBundle.message("the.selected.class.has.no.members.to.extract"),project);
    return;
  }
  doExtractClass(containingClass,project,selectedMember);
}
