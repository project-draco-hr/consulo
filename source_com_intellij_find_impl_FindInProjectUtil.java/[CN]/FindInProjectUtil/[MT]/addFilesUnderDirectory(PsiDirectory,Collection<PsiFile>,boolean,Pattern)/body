{
  final PsiElement[] children=directory.getChildren();
  for (  PsiElement child : children) {
    if (child instanceof PsiFile && (fileMaskRegExp == null || fileMaskRegExp.matcher(((PsiFile)child).getName()).matches())) {
      PsiFile file=(PsiFile)child;
      PsiFile sourceFile=(PsiFile)file.getNavigationElement();
      if (sourceFile != null)       file=sourceFile;
      fileList.add(file);
    }
 else     if (isRecursive && child instanceof PsiDirectory) {
      addFilesUnderDirectory((PsiDirectory)child,fileList,isRecursive,fileMaskRegExp);
    }
  }
}
