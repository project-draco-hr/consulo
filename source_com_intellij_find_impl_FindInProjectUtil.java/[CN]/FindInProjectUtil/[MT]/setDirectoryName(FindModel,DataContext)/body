{
  PsiElement psiElement=(PsiElement)dataContext.getData(DataConstants.PSI_ELEMENT);
  String directoryName=null;
  if (psiElement instanceof PsiDirectory) {
    directoryName=((PsiDirectory)psiElement).getVirtualFile().getPresentableUrl();
  }
 else {
    final PsiFile psiFile=(PsiFile)dataContext.getData(DataConstants.PSI_FILE);
    if (psiFile != null) {
      PsiDirectory psiDirectory=psiFile.getContainingDirectory();
      if (psiDirectory != null) {
        directoryName=psiDirectory.getVirtualFile().getPresentableUrl();
      }
    }
  }
  if (directoryName == null && psiElement instanceof PsiPackage) {
    final PsiDirectory[] directories=((PsiPackage)psiElement).getDirectories();
    directoryName=directories.length == 1 ? directories[0].getVirtualFile().getPresentableUrl() : null;
  }
  Module module=(Module)dataContext.getData(DataConstants.MODULE_CONTEXT);
  if (module != null) {
    model.setModuleName(module.getName());
  }
  if (model.getModuleName() == null || dataContext.getData(DataConstants.EDITOR) == null) {
    model.setDirectoryName(directoryName);
    model.setProjectScope(directoryName == null && module == null && model.getCustomScopeName() == null || dataContext.getData(DataConstants.EDITOR) != null);
  }
}
