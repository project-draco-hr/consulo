{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      for (      Project project : ProjectManager.getInstance().getOpenProjects()) {
        ProjectRootManagerEx.getInstanceEx(project).makeRootsChange(EmptyRunnable.getInstance(),false,true);
        ProjectPlainTextFileTypeManager projectPlainTextFileTypeManager=ProjectPlainTextFileTypeManager.getInstance(project);
        for (        VirtualFile file : files) {
          if (projectPlainTextFileTypeManager.hasProjectContaining(file)) {
            if (isAdded) {
              projectPlainTextFileTypeManager.addFile(file);
            }
 else {
              projectPlainTextFileTypeManager.removeFile(file);
            }
          }
        }
      }
    }
  }
);
}
