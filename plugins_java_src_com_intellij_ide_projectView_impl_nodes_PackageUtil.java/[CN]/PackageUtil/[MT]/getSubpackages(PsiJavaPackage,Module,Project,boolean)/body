{
  final PsiDirectory[] dirs=getDirectories(aPackage,project,module,searchInLibraries);
  final Set<PsiJavaPackage> subpackages=new HashSet<PsiJavaPackage>();
  for (  PsiDirectory dir : dirs) {
    final PsiDirectory[] subdirectories=dir.getSubdirectories();
    for (    PsiDirectory subdirectory : subdirectories) {
      final PsiJavaPackage psiPackage=JavaDirectoryService.getInstance().getPackage(subdirectory);
      if (psiPackage != null) {
        final String name=psiPackage.getName();
        if (name != null && !name.isEmpty()) {
          subpackages.add(psiPackage);
        }
      }
    }
  }
  return subpackages.toArray(new PsiJavaPackage[subpackages.size()]);
}
