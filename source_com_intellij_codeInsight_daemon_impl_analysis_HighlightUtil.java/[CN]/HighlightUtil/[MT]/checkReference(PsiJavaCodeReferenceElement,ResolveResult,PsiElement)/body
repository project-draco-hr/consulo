{
  PsiElement refName=ref.getReferenceNameElement();
  if (!(refName instanceof PsiIdentifier) && !(refName instanceof JspToken) && !(refName instanceof PsiKeyword))   return null;
  HighlightInfo highlightInfo=checkMemberReferencedBeforeConstructorCalled(ref);
  if (highlightInfo != null)   return highlightInfo;
  final PsiElement refParent=ref.getParent();
  if (!(refParent instanceof PsiMethodCallExpression)) {
    if (resolved == null) {
      if (isInsidePackageStatement(refName))       return null;
      if (result.isPackagePrefixPackageReference())       return null;
      String description=refName instanceof JspToken ? "Broken link" : MessageFormat.format(HighlightVisitorImpl.UNKNOWN_SYMBOL,new Object[]{refName.getText()});
      HighlightInfoType type=HighlightInfoType.WRONG_REF;
      if (PsiTreeUtil.getParentOfType(refName,PsiDocComment.class) != null) {
        if (!DaemonCodeAnalyzerSettings.getInstance().getInspectionProfile().isToolEnabled(HighlightDisplayKey.JAVADOC_ERROR)) {
          return null;
        }
        type=HighlightInfoType.JAVADOC_WRONG_REF;
      }
      PsiElement parent=PsiTreeUtil.getParentOfType(ref,new Class[]{PsiNewExpression.class,PsiMethod.class});
      final HighlightInfo info=HighlightInfo.createHighlightInfo(type,refName,description);
      QuickFixAction.registerQuickFixAction(info,new ImportClassAction(ref));
      QuickFixAction.registerQuickFixAction(info,SetupJDKFix.getInstnace());
      if (ref instanceof PsiReferenceExpression) {
        TextRange fixRange=HighlightMethodUtil.getFixRange(ref);
        PsiReferenceExpression refExpr=(PsiReferenceExpression)ref;
        QuickFixAction.registerQuickFixAction(info,fixRange,new CreateConstantFieldFromUsageAction(refExpr));
        QuickFixAction.registerQuickFixAction(info,fixRange,new CreateFieldFromUsageAction(refExpr));
        QuickFixAction.registerQuickFixAction(info,fixRange,new CreateLocalFromUsageAction(refExpr));
        QuickFixAction.registerQuickFixAction(info,fixRange,new BringVariableIntoScopeAction(refExpr));
        QuickFixAction.registerQuickFixAction(info,fixRange,new CreateParameterFromUsageAction(refExpr));
        QuickFixAction.registerQuickFixAction(info,new RenameWrongRefAction(refExpr));
      }
      QuickFixAction.registerQuickFixAction(info,new CreateClassFromUsageAction(ref,true));
      QuickFixAction.registerQuickFixAction(info,new CreateClassFromUsageAction(ref,false));
      if (parent instanceof PsiNewExpression) {
        TextRange fixRange=HighlightMethodUtil.getFixRange(parent);
        QuickFixAction.registerQuickFixAction(info,fixRange,new CreateClassFromNewAction((PsiNewExpression)parent));
      }
      QuickFixAction.registerQuickFixAction(HighlightInfo.createHighlightInfo(type,refName,description),new SwitchOffToolAction(HighlightDisplayKey.JAVADOC_ERROR));
      return info;
    }
    if (!result.isValidResult()) {
      if (!result.isAccessible()) {
        String description=buildProblemWithAccessDescription(resolved,ref,result);
        final HighlightInfo info=HighlightInfo.createHighlightInfo(HighlightInfoType.WRONG_REF,ref.getReferenceNameElement(),description);
        if (result.isStaticsScopeCorrect()) {
          registerAccessQuickFixAction((PsiMember)resolved,ref,info);
        }
        return info;
      }
      if (!result.isStaticsScopeCorrect()) {
        String description=buildProblemWithStaticDescription(resolved);
        final HighlightInfo info=HighlightInfo.createHighlightInfo(HighlightInfoType.WRONG_REF,ref.getReferenceNameElement(),description);
        registerStaticProblemQuickFixAction(resolved,info,ref);
        return info;
      }
    }
    if ((resolved instanceof PsiLocalVariable || resolved instanceof PsiParameter) && !(resolved instanceof ImplicitVariable)) {
      highlightInfo=HighlightControlFlowUtil.checkVariableMustBeFinal((PsiVariable)resolved,ref);
      if (highlightInfo != null)       return highlightInfo;
    }
  }
  return highlightInfo;
}
