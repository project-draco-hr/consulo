{
  final PsiElement lResolved=lRef.resolve();
  final PsiElement rResolved=rRef.resolve();
  if (!manager.areElementsEquivalent(lResolved,rResolved))   return false;
  final PsiExpression lQualifier=lRef.getQualifierExpression();
  final PsiExpression rQualifier=rRef.getQualifierExpression();
  if (lQualifier instanceof PsiReferenceExpression && rQualifier instanceof PsiReferenceExpression) {
    return sameInstanceReferences((PsiReferenceExpression)lQualifier,(PsiReferenceExpression)rQualifier,manager);
  }
  if (Comparing.equal(lQualifier,rQualifier))   return true;
  final boolean lThis=lQualifier == null || lQualifier instanceof PsiThisExpression;
  final boolean rThis=rQualifier == null || rQualifier instanceof PsiThisExpression;
  if (lThis && rThis) {
    PsiJavaCodeReferenceElement lThisQualifier=((PsiThisExpression)lQualifier).getQualifier();
    PsiJavaCodeReferenceElement rThisQualifier=((PsiThisExpression)rQualifier).getQualifier();
    if (lThisQualifier == null && rThisQualifier == null)     return true;
    if (lThisQualifier == null || rThisQualifier == null)     return false;
    return Comparing.equal(lThisQualifier.resolve(),rThisQualifier.resolve());
  }
  return false;
}
