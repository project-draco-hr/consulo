{
  boolean isIncorrect=false;
  PsiIdentifier identifier=variable.getNameIdentifier();
  String name=identifier.getText();
  if (variable instanceof PsiLocalVariable || variable instanceof PsiParameter && ((PsiParameter)variable).getDeclarationScope() instanceof PsiCatchSection || variable instanceof PsiParameter && ((PsiParameter)variable).getDeclarationScope() instanceof PsiForeachStatement) {
    PsiElement scope=PsiTreeUtil.getParentOfType(variable,PsiFile.class,PsiMethod.class,PsiClassInitializer.class);
    VariablesNotProcessor proc=new VariablesNotProcessor(variable,false);
    PsiScopesUtil.treeWalkUp(proc,identifier,scope);
    if (proc.size() > 0) {
      isIncorrect=true;
    }
  }
 else {
    PsiElement scope=variable.getParent();
    PsiElement[] children=scope.getChildren();
    for (    PsiElement child : children) {
      if (child instanceof PsiVariable) {
        if (child.equals(variable))         continue;
        if (name.equals(((PsiVariable)child).getName())) {
          isIncorrect=true;
          break;
        }
      }
    }
  }
  if (isIncorrect) {
    String description=MessageFormat.format(VARIABLE_ALREADY_DEFINED,new Object[]{name});
    HighlightInfo highlightInfo=HighlightInfo.createHighlightInfo(HighlightInfoType.ERROR,identifier,description);
    QuickFixAction.registerQuickFixAction(highlightInfo,new ReuseVariableDeclarationFix(variable,identifier),null);
    return highlightInfo;
  }
  return null;
}
