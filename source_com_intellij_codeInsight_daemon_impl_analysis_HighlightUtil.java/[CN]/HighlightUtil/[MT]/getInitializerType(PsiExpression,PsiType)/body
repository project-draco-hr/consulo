{
  if (expression instanceof PsiArrayInitializerExpression) {
    final PsiExpression[] initializers=((PsiArrayInitializerExpression)expression).getInitializers();
    final PsiType compType;
    if (initializers.length == 0) {
      compType=compTypeForEmptyInitializer;
    }
 else {
      final PsiType componentType=compTypeForEmptyInitializer instanceof PsiArrayType ? ((PsiArrayType)compTypeForEmptyInitializer).getComponentType() : null;
      compType=getInitializerType(initializers[0],componentType);
    }
    return compType == null ? null : compType.createArrayType();
  }
  return expression.getType();
}
