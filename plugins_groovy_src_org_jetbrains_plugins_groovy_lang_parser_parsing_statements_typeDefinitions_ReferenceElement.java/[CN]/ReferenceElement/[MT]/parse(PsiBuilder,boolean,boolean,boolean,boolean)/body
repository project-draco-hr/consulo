{
  PsiBuilder.Marker internalTypeMarker=builder.mark();
  char firstChar;
  if (builder.getTokenText() != null)   firstChar=builder.getTokenText().charAt(0);
 else   return WRONGWAY;
  if (checkUpperCase && !Character.isUpperCase(firstChar)) {
    internalTypeMarker.rollbackTo();
    return WRONGWAY;
  }
  if (!ParserUtils.getToken(builder,mIDENT)) {
    internalTypeMarker.rollbackTo();
    return WRONGWAY;
  }
  if (parseTypeArgs)   TypeArguments.parse(builder);
  internalTypeMarker.done(REFERENCE_ELEMENT);
  internalTypeMarker=internalTypeMarker.precede();
  while (mDOT.equals(builder.getTokenType())) {
    if ((ParserUtils.lookAhead(builder,mDOT,mSTAR) || ParserUtils.lookAhead(builder,mDOT,mNLS,mSTAR)) && forImport) {
      internalTypeMarker.drop();
      return REFERENCE_ELEMENT;
    }
    ParserUtils.getToken(builder,mDOT);
    if (forImport) {
      ParserUtils.getToken(builder,mNLS);
    }
    if (!ParserUtils.getToken(builder,mIDENT)) {
      internalTypeMarker.rollbackTo();
      return WRONGWAY;
    }
    TypeArguments.parse(builder);
    internalTypeMarker.done(REFERENCE_ELEMENT);
    internalTypeMarker=internalTypeMarker.precede();
  }
  if (forPackage || forImport) {
    internalTypeMarker.drop();
    return REFERENCE_ELEMENT;
  }
  internalTypeMarker.done(TYPE_ELEMENT);
  return TYPE_ELEMENT;
}
