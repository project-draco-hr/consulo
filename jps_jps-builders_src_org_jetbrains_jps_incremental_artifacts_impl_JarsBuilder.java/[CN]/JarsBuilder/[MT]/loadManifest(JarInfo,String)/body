{
  for (  Pair<String,Object> pair : jar.getContent()) {
    if (pair.getSecond() instanceof ArtifactRootDescriptor) {
      final String rootPath=pair.getFirst();
      if (!JarFile.MANIFEST_NAME.startsWith(rootPath)) {
        continue;
      }
      final String manifestPath=JpsPathUtil.trimForwardSlashes(JarFile.MANIFEST_NAME.substring(rootPath.length()));
      final ArtifactRootDescriptor descriptor=(ArtifactRootDescriptor)pair.getSecond();
      if (descriptor instanceof FileBasedArtifactRootDescriptor) {
        final File manifestFile=new File(descriptor.getRootFile(),manifestPath);
        if (manifestFile.exists()) {
          final String fullManifestPath=FileUtil.toSystemIndependentName(manifestFile.getAbsolutePath());
          myContext.getLoggingManager().getArtifactBuilderLogger().fileCopied(fullManifestPath);
          mySrcOutMapping.appendOutput(fullManifestPath,targetJarPath);
          return createManifest(new FileInputStream(manifestFile),manifestFile);
        }
      }
 else {
        final Ref<Manifest> manifestRef=Ref.create(null);
        ((JarBasedArtifactRootDescriptor)descriptor).processEntries(new JarBasedArtifactRootDescriptor.EntryProcessor(){
          @Override public void process(          @Nullable InputStream inputStream,          @NotNull String relativePath) throws IOException {
            if (manifestRef.isNull() && relativePath.equals(manifestPath) && inputStream != null) {
              manifestRef.set(createManifest(inputStream,descriptor.getRootFile()));
            }
          }
        }
);
        if (!manifestRef.isNull()) {
          return manifestRef.get();
        }
      }
    }
  }
  return null;
}
