{
  if (file.isDirectory()) {
    final String directoryPath=relativePath.length() == 0 ? "" : relativePath + "/";
    if (!directoryPath.isEmpty()) {
      addDirectoryEntry(jarOutputStream,directoryPath,writtenItemRelativePaths);
    }
    final File[] children=file.listFiles();
    if (children != null) {
      for (      File child : children) {
        addFileOrDirRecursively(jarOutputStream,child,directoryPath + child.getName(),writtenItemRelativePaths);
      }
    }
    return;
  }
  final boolean added=ZipUtil.addFileToZip(jarOutputStream,file,relativePath,writtenItemRelativePaths,myFileFilter);
  if (added) {
    myContext.getLoggingManager().getArtifactBuilderLogger().fileCopied(FileUtil.toSystemIndependentName(file.getAbsolutePath()));
  }
}
