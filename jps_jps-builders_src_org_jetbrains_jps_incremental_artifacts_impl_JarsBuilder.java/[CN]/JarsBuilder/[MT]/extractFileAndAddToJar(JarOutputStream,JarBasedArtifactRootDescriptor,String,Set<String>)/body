{
  final long timestamp=FileSystemUtil.lastModified(root.getRootFile());
  root.processEntries(new JarBasedArtifactRootDescriptor.EntryProcessor(){
    @Override public void process(    @Nullable InputStream inputStream,    @NotNull String relativePath,    ZipEntry entry) throws IOException {
      String pathInJar=addParentDirectories(jarOutputStream,writtenPaths,JpsArtifactPathUtil.appendToPath(relativeOutputPath,relativePath));
      if (inputStream == null) {
        addDirectoryEntry(jarOutputStream,pathInJar + "/",writtenPaths);
      }
 else       if (writtenPaths.add(pathInJar)) {
        ZipEntry newEntry=new ZipEntry(pathInJar);
        newEntry.setTime(timestamp);
        if (entry.getMethod() == ZipEntry.STORED) {
          newEntry.setMethod(ZipEntry.STORED);
          newEntry.setSize(entry.getSize());
          newEntry.setCrc(entry.getCrc());
        }
        jarOutputStream.putNextEntry(newEntry);
        FileUtil.copy(inputStream,jarOutputStream);
        jarOutputStream.closeEntry();
      }
    }
  }
);
}
