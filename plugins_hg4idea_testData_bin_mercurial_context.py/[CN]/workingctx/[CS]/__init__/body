def __init__(self, repo, parents=None, text='', user=None, date=None, extra=None, changes=None):
    self._repo = repo
    self._rev = None
    self._node = None
    self._text = text
    if date:
        self._date = util.parsedate(date)
    if user:
        self._user = user
    if parents:
        self._parents = [changectx(self._repo, p) for p in parents]
    if changes:
        self._status = list(changes)
    self._extra = {}
    if extra:
        self._extra = extra.copy()
    if ('branch' not in self._extra):
        branch = self._repo.dirstate.branch()
        try:
            branch = branch.decode('UTF-8').encode('UTF-8')
        except UnicodeDecodeError:
            raise util.Abort(_('branch name not in UTF-8!'))
        self._extra['branch'] = branch
    if (self._extra['branch'] == ''):
        self._extra['branch'] = 'default'
