def flags(self, path):
    if ('_manifest' in self.__dict__):
        try:
            return self._manifest.flags(path)
        except KeyError:
            return ''
    orig = self._repo.dirstate.copies().get(path, path)

    def findflag(ctx):
        mnode = ctx.changeset()[0]
        (node, flag) = self._repo.manifest.find(mnode, orig)
        ff = self._repo.dirstate.flagfunc((lambda x: (flag or '')))
        try:
            return ff(path)
        except OSError:
            pass
    flag = findflag(self._parents[0])
    if ((flag is None) and (len(self.parents()) > 1)):
        flag = findflag(self._parents[1])
    if ((flag is None) or (self._repo.dirstate[path] == 'r')):
        return ''
    return flag
