def walk(self, match):
    fset = set(match.files())
    fset.discard('.')
    for fn in self:
        for ffn in fset:
            if ((ffn == fn) or fn.startswith(('%s/' % ffn))):
                fset.remove(ffn)
                break
        if match(fn):
            yield fn
    for fn in sorted(fset):
        if (match.bad(fn, ('No such file in rev ' + str(self))) and match(fn)):
            yield fn
