def __init__(self, repo, parents, text, files, filectxfn, user=None, date=None, extra=None):
    self._repo = repo
    self._rev = None
    self._node = None
    self._text = text
    self._date = ((date and util.parsedate(date)) or util.makedate())
    self._user = user
    parents = [(p or nullid) for p in parents]
    (p1, p2) = parents
    self._parents = [changectx(self._repo, p) for p in (p1, p2)]
    files = sorted(set(files))
    self._status = [files, [], [], [], []]
    self._filectxfn = filectxfn
    self._extra = ((extra and extra.copy()) or {})
    if ('branch' not in self._extra):
        self._extra['branch'] = 'default'
    elif (self._extra.get('branch') == ''):
        self._extra['branch'] = 'default'
