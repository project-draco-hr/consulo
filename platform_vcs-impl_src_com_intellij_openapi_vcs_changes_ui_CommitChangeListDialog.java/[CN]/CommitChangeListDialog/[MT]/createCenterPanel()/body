{
  mySplitter=new Splitter(true);
  mySplitter.setHonorComponentsMinimumSize(true);
  mySplitter.setFirstComponent(myBrowser);
  mySplitter.setSecondComponent(myCommitMessageArea);
  initMainSplitter();
  myChangesInfoCalculator=new ChangeInfoCalculator();
  myLegend=new CommitLegendPanel(myChangesInfoCalculator);
  myBrowser.getBottomPanel().add(JBUI.Panels.simplePanel().addToRight(myLegend.getComponent()),BorderLayout.SOUTH);
  JPanel mainPanel;
  if (myAdditionalOptionsPanel != null) {
    JScrollPane optionsPane=ScrollPaneFactory.createScrollPane(myAdditionalOptionsPanel,true);
    optionsPane.getVerticalScrollBar().setUnitIncrement(10);
    JPanel infoPanel=JBUI.Panels.simplePanel(optionsPane).withBorder(JBUI.Borders.emptyLeft(10));
    mainPanel=new JPanel(new MyOptionsLayout(mySplitter,infoPanel,JBUI.scale(250)));
    mainPanel.add(mySplitter);
    mainPanel.add(infoPanel);
  }
 else {
    mainPanel=mySplitter;
  }
  myWarningLabel.setBorder(JBUI.Borders.empty(5,5,0,5));
  final JPanel panel=new JPanel(new GridBagLayout());
  panel.add(myWarningLabel,new GridBag().anchor(GridBagConstraints.NORTHWEST).weightx(1));
  JPanel rootPane=JBUI.Panels.simplePanel(mainPanel).addToBottom(panel);
  myDetailsSplitter=new SplitterWithSecondHideable(true,"Details",rootPane,new SplitterWithSecondHideable.OnOffListener<Integer>(){
    @Override public void on(    Integer integer){
      if (integer == 0)       return;
      myDiffDetails.refresh();
      mySplitter.skipNextLayouting();
      myDetailsSplitter.getComponent().skipNextLayouting();
      final Dimension dialogSize=getSize();
      setSize(dialogSize.width,dialogSize.height + integer);
      repaint();
    }
    @Override public void off(    Integer integer){
      if (integer == 0)       return;
      myDiffDetails.clear();
      mySplitter.skipNextLayouting();
      myDetailsSplitter.getComponent().skipNextLayouting();
      final Dimension dialogSize=getSize();
      setSize(dialogSize.width,dialogSize.height - integer);
      repaint();
    }
  }
){
    @Override protected RefreshablePanel createDetails(){
      final JPanel panel=JBUI.Panels.simplePanel(myDiffDetails.getComponent());
      return new RefreshablePanel(){
        @Override public boolean refreshDataSynch(){
          return false;
        }
        @Override public void dataChanged(){
        }
        @Override public void refresh(){
        }
        @Override public JPanel getPanel(){
          return panel;
        }
        @Override public void away(){
        }
        @Override public boolean isStillValid(        Object o){
          return false;
        }
        @Override public void dispose(){
        }
      }
;
    }
    @Override protected float getSplitterInitialProportion(){
      float value=PropertiesComponent.getInstance().getFloat(DETAILS_SPLITTER_PROPORTION_OPTION,DETAILS_SPLITTER_PROPORTION_OPTION_DEFAULT);
      return value <= 0.05 || value >= 0.95 ? DETAILS_SPLITTER_PROPORTION_OPTION_DEFAULT : value;
    }
  }
;
  return myDetailsSplitter.getComponent();
}
