{
  for (  final ModifiableRootModel modifiableRootModel : otherModuleRootModels) {
    final OrderEntry[] orderEntries=modifiableRootModel.getOrderEntries();
    for (    final OrderEntry orderEntry : orderEntries) {
      if (orderEntry instanceof ModuleOrderEntry && orderEntry.isValid()) {
        final Module orderEntryModule=((ModuleOrderEntry)orderEntry).getModule();
        if (orderEntryModule != null && orderEntryModule.equals(moduleToRemove)) {
          modifiableRootModel.removeOrderEntry(orderEntry);
        }
      }
    }
  }
  if (modifiableRootModelToRemove != null) {
    modifiableRootModelToRemove.dispose();
  }
  moduleModel.disposeModule(moduleToRemove);
}
