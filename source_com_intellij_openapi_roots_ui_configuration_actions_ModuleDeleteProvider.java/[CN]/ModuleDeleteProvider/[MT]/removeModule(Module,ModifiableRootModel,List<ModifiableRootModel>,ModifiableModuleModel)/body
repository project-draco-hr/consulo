{
  for (int i=0; i < otherModuleRootModels.size(); i++) {
    final ModifiableRootModel modifiableRootModel=otherModuleRootModels.get(i);
    final OrderEntry[] orderEntries=modifiableRootModel.getOrderEntries();
    for (int idx=0; idx < orderEntries.length; idx++) {
      final OrderEntry orderEntry=orderEntries[idx];
      if (orderEntry.isValid() && orderEntry instanceof ModuleOrderEntry) {
        final Module orderEntryModule=((ModuleOrderEntry)orderEntry).getModule();
        if (orderEntryModule != null && orderEntryModule.equals(moduleToRemove)) {
          modifiableRootModel.removeOrderEntry(orderEntry);
        }
      }
    }
  }
  if (modifiableRootModelToRemove != null) {
    modifiableRootModelToRemove.dispose();
  }
  moduleModel.disposeModule(moduleToRemove);
}
