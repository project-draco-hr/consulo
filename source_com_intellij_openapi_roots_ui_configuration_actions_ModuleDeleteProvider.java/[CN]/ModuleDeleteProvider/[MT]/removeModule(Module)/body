{
  ModifiableRootModel modifiableModel=ModuleRootManager.getInstance(module).getModifiableModel();
  ModuleManager moduleManager=ModuleManager.getInstance(module.getProject());
  Module[] modules=moduleManager.getModules();
  List<ModifiableRootModel> otherModuleRootModels=new ArrayList<ModifiableRootModel>();
  for (int i=0; i < modules.length; i++) {
    final Module otherModule=modules[i];
    if (otherModule == module)     continue;
    otherModuleRootModels.add(ModuleRootManager.getInstance(otherModule).getModifiableModel());
  }
  ModifiableModuleModel modifiableModuleModel=moduleManager.getModifiableModel();
  removeModule(module,modifiableModel,otherModuleRootModels,modifiableModuleModel);
  final ModifiableRootModel[] modifiableRootModels=otherModuleRootModels.toArray(new ModifiableRootModel[otherModuleRootModels.size()]);
  ProjectRootManager.getInstance(module.getProject()).multiCommit(modifiableModuleModel,modifiableRootModels);
}
