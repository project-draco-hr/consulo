{
  myDefines=new HashMap<String,Set<Define>>();
  myScope.acceptChildren(this);
  try {
    final PsiElement psiElement=myScope.getPsiElement();
    if (psiElement == null || !psiElement.isValid()) {
      return Result.create(null,ModificationTracker.EVER_CHANGED);
    }
    final PsiFile file=psiElement.getContainingFile();
    if (myVisitedFiles != null) {
      myVisitedFiles.add(file);
      return Result.create(myDefines,myVisitedFiles.toArray());
    }
 else {
      return Result.create(myDefines,file);
    }
  }
  finally {
    myVisitedFiles=null;
    myDefines=null;
  }
}
