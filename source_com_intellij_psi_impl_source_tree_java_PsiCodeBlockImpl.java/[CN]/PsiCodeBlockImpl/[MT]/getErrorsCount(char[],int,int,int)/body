{
  final JavaLexer lexer=new JavaLexer(getManager().getEffectiveLanguageLevel());
  lexer.start(buffer,start,end + lengthShift);
  int balance=0;
  while (true) {
    IElementType type=lexer.getTokenType();
    if (type == null)     break;
    if (type == LBRACE) {
      balance++;
    }
 else     if (type == RBRACE) {
      balance--;
    }
    lexer.advance();
  }
  return balance;
}
