{
synchronized (PsiLock.LOCK) {
    if (myProcessed)     return;
    myProcessed=true;
  }
  PsiScopesUtil.walkChildrenScopes(this,new BaseScopeProcessor(){
    public boolean execute(    PsiElement element,    PsiSubstitutor substitutor){
synchronized (PsiLock.LOCK) {
        if (element instanceof PsiLocalVariable) {
          final PsiLocalVariable variable=(PsiLocalVariable)element;
          final String name=variable.getName();
          Set<String> localsSet=myVariablesSet;
          if (localsSet != null && localsSet.contains(name)) {
            myConflict=true;
            myVariablesSet=null;
            myClassesSet=null;
          }
 else {
            if (localsSet == null)             localsSet=new HashSet<String>();
            localsSet.add(name);
            myVariablesSet=localsSet;
          }
        }
 else         if (element instanceof PsiClass) {
          final PsiClass psiClass=(PsiClass)element;
          final String name=psiClass.getName();
          Set<String> classesSet=myClassesSet;
          if (classesSet != null && classesSet.contains(name)) {
            myConflict=true;
            myVariablesSet=null;
            myClassesSet=null;
          }
 else {
            if (classesSet == null)             classesSet=new HashSet<String>();
            classesSet.add(name);
            myClassesSet=classesSet;
          }
        }
        return !myConflict;
      }
    }
  }
,PsiSubstitutor.EMPTY,this,this);
}
