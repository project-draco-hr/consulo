{
  Project project=e.getData(PlatformDataKeys.PROJECT);
  try {
    NewChangelistDialog dlg=new NewChangelistDialog(project);
    dlg.show();
    if (dlg.getExitCode() == DialogWrapper.OK_EXIT_CODE) {
      String name=dlg.getName();
      if (name.length() == 0) {
        name=getUniqueName(project);
      }
      final LocalChangeList list=ChangeListManager.getInstance(project).addChangeList(name,dlg.getDescription());
      if (dlg.isNewChangelistActive()) {
        ChangeListManager.getInstance(project).setDefaultChangeList(list);
      }
      for (      EditChangelistSupport support : Extensions.getExtensions(EditChangelistSupport.EP_NAME,project)) {
        support.changelistCreated(list);
      }
    }
  }
  finally {
    for (    EditChangelistSupport support : Extensions.getExtensions(EditChangelistSupport.EP_NAME,project)) {
      support.disposeControls();
    }
  }
}
