{
  if ((getVirtualFile() != null) && !getVirtualFile().isWritable()) {
    if (ReadonlyStatusHandler.getInstance(myProject).ensureFilesWritable(new VirtualFile[]{getVirtualFile()}).hasReadonlyFiles()) {
      return;
    }
  }
  LvcsAction action=getVirtualFile() != null ? startLvcsAction(revision) : LvcsAction.EMPTY;
  final byte[] revisionContent;
  try {
    revision.loadContent();
    revisionContent=revision.getContent();
  }
 catch (  IOException e) {
    LOG.error(e);
    return;
  }
catch (  VcsException e) {
    Messages.showMessageDialog(VcsBundle.message("message.text.cannot.load.revision",e.getLocalizedMessage()),VcsBundle.message("message.title.get.revision.content"),Messages.getInformationIcon());
    return;
  }
catch (  ProcessCanceledException ex) {
    return;
  }
  final byte[] finalRevisionContent=revisionContent;
  try {
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      public void run(){
        CommandProcessor.getInstance().executeCommand(myProject,getVersionRunnable(finalRevisionContent),createGetActionTitle(revision),null);
      }
    }
);
    if (getVirtualFile() != null) {
      FileStatusManager.getInstance(myProject).fileStatusChanged(getVirtualFile());
    }
  }
  finally {
    action.finish();
  }
}
