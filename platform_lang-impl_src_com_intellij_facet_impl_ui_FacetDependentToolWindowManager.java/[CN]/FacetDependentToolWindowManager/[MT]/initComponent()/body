{
  myFacetListenersRegistry.registerListener(new ProjectWideFacetAdapter<Facet>(){
    @Override public void facetAdded(    Facet facet){
      if (myFacetManager.getFacets(facet.getTypeId()).size() == 1) {
        for (        FacetDependentToolWindow extension : getDependentExtensions(facet)) {
          ToolWindow toolWindow=myToolWindowManager.getToolWindow(extension.id);
          if (toolWindow == null) {
            myToolWindowManager.initToolWindow(extension);
          }
        }
      }
    }
    @Override public void facetRemoved(    Facet facet){
      if (myFacetManager.getFacets(facet.getTypeId()).isEmpty()) {
        for (        FacetDependentToolWindow extension : getDependentExtensions(facet)) {
          ToolWindow toolWindow=myToolWindowManager.getToolWindow(extension.id);
          if (toolWindow != null) {
            String[] ids=extension.facetIdList.split(",");
            if (ids.length > 1) {
              for (              String id : ids) {
                FacetType facetType=FacetTypeRegistry.getInstance().findFacetType(id);
                if (myFacetManager.hasFacets(facetType.getId()))                 return;
              }
            }
            myToolWindowManager.unregisterToolWindow(extension.id);
          }
        }
      }
    }
  }
);
}
