{
  DefaultComboBoxModel model=new DefaultComboBoxModel();
  FileTemplate[] allTemplates=FileTemplateManager.getInstance().getAllTemplates();
  PsiDirectory[] dirs={myDirectory};
  for (  FileTemplate template : allTemplates) {
    if (FileTemplateUtil.canCreateFromTemplate(dirs,template)) {
      model.addElement(template);
    }
  }
  if (myCbxTemplates == null) {
    myCbxTemplates=new JComboBox(model);
    myCbxTemplates.setRenderer(new ListCellRendererWrapper<FileTemplate>(myCbxTemplates.getRenderer()){
      @Override public void customize(      JList list,      FileTemplate fileTemplate,      int index,      boolean selected,      boolean hasFocus){
        if (fileTemplate != null) {
          setIcon(FileTemplateUtil.getIcon(fileTemplate));
          setText(fileTemplate.getName());
        }
      }
    }
);
  }
 else {
    Object selected=myCbxTemplates.getSelectedItem();
    myCbxTemplates.setModel(model);
    if (selected != null) {
      myCbxTemplates.setSelectedItem(selected);
    }
  }
}
