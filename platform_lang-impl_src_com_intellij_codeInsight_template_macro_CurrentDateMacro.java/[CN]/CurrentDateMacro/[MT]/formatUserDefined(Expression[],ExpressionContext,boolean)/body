{
  long time=Clock.getTime();
  if (params.length == 1) {
    Result format=params[0].calculateResult(context);
    if (format != null) {
      String pattern=format.toString();
      try {
        return new SimpleDateFormat(pattern).format(new Date(time));
      }
 catch (      Exception e) {
        return "Problem when formatting date/time for pattern \"" + pattern + "\": "+ e.getMessage();
      }
    }
  }
  return date ? DateFormatUtil.formatDate(time) : DateFormatUtil.formatTime(time);
}
