{
  GradleUtil.executeProjectChangeAction(project,jar,new Runnable(){
    @Override public void run(){
      LibraryTable table=myPlatformFacade.getProjectLibraryTable(project);
      Library library=table.getLibraryByName(jar.getLibraryId().getLibraryName());
      if (library == null) {
        return;
      }
      Library.ModifiableModel model=library.getModifiableModel();
      try {
        OrderRootType ideJarType=myLibraryPathTypeMapper.map(jar.getPathType());
        for (        VirtualFile file : model.getFiles(ideJarType)) {
          if (jar.getPath().equals(GradleUtil.getLocalFileSystemPath(file))) {
            return;
          }
        }
        VirtualFile virtualFile=LocalFileSystem.getInstance().findFileByIoFile(new File(jar.getPath()));
        if (virtualFile == null) {
          return;
        }
        if (virtualFile.isDirectory()) {
          model.addRoot(virtualFile,ideJarType);
        }
 else {
          VirtualFile jarRoot=JarFileSystem.getInstance().getJarRootForLocalFile(virtualFile);
          if (jarRoot == null) {
            GradleLog.LOG.warn(String.format("Can't parse contents of the jar file at path '%s' for the library '%s''",jar.getPath(),library.getName()));
            return;
          }
          model.addRoot(jarRoot,ideJarType);
        }
      }
  finally {
        model.commit();
      }
    }
  }
);
}
