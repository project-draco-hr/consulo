{
  return ApplicationManager.getApplication().runReadAction(new Computable<SearchScope>(){
    public SearchScope compute(){
      final SearchScope scope=method.getUseScope();
      final PsiFile file=method.getContainingFile();
      if (file != null && scope instanceof GlobalSearchScope) {
        final VirtualFile vfile=file.getOriginalFile().getVirtualFile();
        final Project project=method.getProject();
        if (vfile != null && ProjectRootManager.getInstance(project).getFileIndex().isInSource(vfile)) {
          return new GrSourceFilterScope((GlobalSearchScope)scope,project);
        }
      }
      return scope;
    }
  }
);
}
