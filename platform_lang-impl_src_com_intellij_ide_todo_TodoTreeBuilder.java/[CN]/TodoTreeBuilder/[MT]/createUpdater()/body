{
  return new AbstractTreeUpdater(this){
    @Override protected ActionCallback beforeUpdate(    final TreeUpdatePass pass){
      if (!myDirtyFileSet.isEmpty()) {
        final AsyncResult callback=new AsyncResult();
        DumbService.getInstance(myProject).runWhenSmart(new Runnable(){
          public void run(){
            try {
              validateCache();
              getTodoTreeStructure().validateCache();
            }
  finally {
              callback.setDone();
            }
          }
        }
);
        return callback;
      }
      return new ActionCallback.Done();
    }
  }
;
}
