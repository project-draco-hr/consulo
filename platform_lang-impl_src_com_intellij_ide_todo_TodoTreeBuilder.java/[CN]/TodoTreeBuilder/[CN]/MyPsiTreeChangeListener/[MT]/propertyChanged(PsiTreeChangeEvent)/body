{
  String propertyName=e.getPropertyName();
  if (propertyName.equals(PsiTreeChangeEvent.PROP_ROOTS)) {
    getUpdater().runBeforeUpdate(new Runnable(){
      @Override public void run(){
        DumbService.getInstance(myProject).runWhenSmart(new Runnable(){
          @Override public void run(){
            rebuildCache();
          }
        }
);
      }
    }
);
    updateTree(true);
  }
 else   if (PsiTreeChangeEvent.PROP_WRITABLE.equals(propertyName) || PsiTreeChangeEvent.PROP_FILE_NAME.equals(propertyName)) {
    PsiFile psiFile=(PsiFile)e.getElement();
    if (!canContainTodoItems(psiFile)) {
      return;
    }
    updateTree(true);
  }
 else   if (PsiTreeChangeEvent.PROP_DIRECTORY_NAME.equals(propertyName)) {
    PsiDirectory psiDirectory=(PsiDirectory)e.getElement();
    Iterator<PsiFile> iterator=getFiles(psiDirectory);
    if (iterator.hasNext()) {
      updateTree(true);
    }
  }
}
