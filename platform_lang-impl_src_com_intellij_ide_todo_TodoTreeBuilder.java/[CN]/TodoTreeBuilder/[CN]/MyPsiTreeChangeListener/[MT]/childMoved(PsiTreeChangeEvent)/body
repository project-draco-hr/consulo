{
  if (e.getFile() != null) {
    markFileAsDirty(e.getFile());
    updateTree(true);
    return;
  }
  if (e.getChild() instanceof PsiFile) {
    PsiFile psiFile=(PsiFile)e.getChild();
    if (!canContainTodoItems(psiFile)) {
      return;
    }
    markFileAsDirty(psiFile);
    updateTree(true);
  }
 else   if (e.getChild() instanceof PsiDirectory) {
    PsiDirectory psiDirectory=(PsiDirectory)e.getChild();
    boolean shouldUpdate=false;
    for (Iterator<PsiFile> i=getAllFiles(); i.hasNext(); ) {
      PsiFile psiFile=i.next();
      if (psiFile == null) {
        continue;
      }
      if (PsiTreeUtil.isAncestor(psiDirectory,psiFile,true)) {
        markFileAsDirty(psiFile);
        shouldUpdate=true;
      }
    }
    if (shouldUpdate) {
      updateTree(true);
    }
  }
}
