{
  final VirtualFile oldParent=myCurrent.getParent();
  boolean needRename=!Comparing.equal(myCurrent.getName(),myNewName);
  boolean needMove=!myNewParent.equals(oldParent);
  if (needRename) {
    if (needMove) {
      File oldParentFile=VfsUtilCore.virtualToIoFile(oldParent);
      File targetAfterRenameFile=new File(oldParentFile,myNewName);
      if (targetAfterRenameFile.exists() && myCurrent.exists()) {
        performRenameWithConflicts(oldParentFile);
        return myCurrent;
      }
    }
    myCurrent.rename(PatchApplier.class,myNewName);
  }
  if (needMove) {
    myCurrent.move(PatchApplier.class,myNewParent);
  }
  return myCurrent;
}
