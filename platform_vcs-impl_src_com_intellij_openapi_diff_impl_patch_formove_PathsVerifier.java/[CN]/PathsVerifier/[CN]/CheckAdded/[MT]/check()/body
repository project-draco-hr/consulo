{
  final String[] pieces=RelativePathCalculator.split(myAfterName);
  final VirtualFile parent=makeSureParentPathExists(pieces);
  if (parent == null) {
    setErrorMessage(fileNotFoundMessage(myAfterName));
    return false;
  }
  String name=pieces[pieces.length - 1];
  File afterFile=new File(parent.getPath(),name);
  final VirtualFile file=myDelayedPrecheckContext.getOverridenPaths().contains(VcsUtil.getFilePath(afterFile)) ? parent.findChild(name) : createFile(parent,name);
  if (file == null) {
    setErrorMessage(fileNotFoundMessage(myAfterName));
    return false;
  }
  myAddedPaths.add(VcsUtil.getFilePath(file));
  if (!checkExistsAndValid(file,myAfterName)) {
    return false;
  }
  addPatch(myPatch,file);
  return true;
}
