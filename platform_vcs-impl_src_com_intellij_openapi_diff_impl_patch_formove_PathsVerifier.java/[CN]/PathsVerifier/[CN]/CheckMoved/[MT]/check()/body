{
  final String[] pieces=RelativePathCalculator.split(myAfterName);
  final VirtualFile afterFileParent=makeSureParentPathExists(pieces);
  if (afterFileParent == null) {
    setErrorMessage(fileNotFoundMessage(myAfterName));
    return false;
  }
  final VirtualFile beforeFile=myBaseMapper.getFile(myPatch,myBeforeName);
  if (!checkExistsAndValid(beforeFile,myBeforeName)) {
    return false;
  }
  myMovedFiles.put(beforeFile,new MovedFileData(afterFileParent,beforeFile,myPatch.getAfterFileName()));
  addPatch(myPatch,beforeFile);
  return true;
}
