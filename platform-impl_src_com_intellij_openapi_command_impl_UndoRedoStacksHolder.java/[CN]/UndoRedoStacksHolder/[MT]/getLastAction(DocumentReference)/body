{
  LinkedList<UndoableGroup> documentStack=getStack(r);
  for (Iterator<UndoableGroup> iterator=myGlobalStack.descendingIterator(); iterator.hasNext(); ) {
    UndoableGroup group=iterator.next();
    if (isSpecial(group)) {
      if (documentStack.isEmpty() || documentStack.getLast().getCommandCounter() < group.getCommandCounter()) {
        return group;
      }
 else {
        return documentStack.getLast();
      }
    }
  }
  return documentStack.isEmpty() ? null : documentStack.getLast();
}
