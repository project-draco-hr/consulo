{
  LinkedList<UndoableGroup> documentStack=getStack(r);
  for (int i=myGlobalStack.size() - 1; i >= 0; i--) {
    UndoableGroup group=myGlobalStack.get(i);
    if (isSpecial(group)) {
      if (documentStack.isEmpty() || documentStack.getLast().getCommandCounter() < group.getCommandCounter()) {
        return group;
      }
 else {
        return documentStack.getLast();
      }
    }
  }
  return documentStack.isEmpty() ? null : documentStack.getLast();
}
