{
  super(new BorderLayout());
  myCropList=cropList;
  myModel=new MyModel();
  myTextField=new TextFieldWithProcessing();
  myTextField.setColumns(15);
  add(myTextField,BorderLayout.CENTER);
  myToggleHistoryLabel=new JLabel(IconLoader.findIcon("/actions/search.png"));
  myToggleHistoryLabel.setOpaque(true);
  myToggleHistoryLabel.setBackground(myTextField.getBackground());
  myToggleHistoryLabel.setBorder(IdeBorderFactory.createEmptyBorder(0,0,0,4));
  myToggleHistoryLabel.addMouseListener(new MouseAdapter(){
    public void mousePressed(    MouseEvent e){
      togglePopup();
    }
  }
);
  add(myToggleHistoryLabel,BorderLayout.WEST);
  myClearFieldLabel=new JLabel(IconLoader.findIcon("/actions/clean.png"));
  myClearFieldLabel.setOpaque(true);
  myClearFieldLabel.setBackground(myTextField.getBackground());
  myClearFieldLabel.setBorder(IdeBorderFactory.createEmptyBorder(0,4,0,0));
  add(myClearFieldLabel,BorderLayout.EAST);
  myClearFieldLabel.addMouseListener(new MouseAdapter(){
    public void mousePressed(    MouseEvent e){
      myTextField.setText("");
    }
  }
);
  myTextField.getDocument().addDocumentListener(new DocumentAdapter(){
    protected void textChanged(    DocumentEvent e){
      if (!cropList)       return;
      if (myFreaze)       return;
      SwingUtilities.invokeLater(new Runnable(){
        public void run(){
          String text=getTextEditor().getText();
          myModel.setSelectedItemAndCropList(text);
        }
      }
);
      SwingUtilities.invokeLater(new Runnable(){
        public void run(){
          if (0 == myModel.getSize()) {
            hidePopup();
            myModel.uncropList();
          }
 else {
            refreshPopup();
          }
        }
      }
);
    }
    private void refreshPopup(){
      Runnable hider=new Runnable(){
        public void run(){
          hidePopup();
        }
      }
;
      Runnable shower=new Runnable(){
        public void run(){
          showPopup();
        }
      }
;
      if (myModel.croppedListEnlarged()) {
        SwingUtilities.invokeLater(hider);
      }
      SwingUtilities.invokeLater(shower);
    }
  }
);
  setBorder(new CompoundBorder(IdeBorderFactory.createEmptyBorder(4,0,4,0),myTextField.getBorder()));
  myTextField.setOpaque(true);
  myTextField.setBorder(null);
  final ActionManager actionManager=ActionManager.getInstance();
  if (actionManager != null) {
    final AnAction clearTextAction=actionManager.getAction(IdeActions.ACTION_CLEAR_TEXT);
    if (clearTextAction.getShortcutSet().getShortcuts().length == 0) {
      clearTextAction.registerCustomShortcutSet(CommonShortcuts.ESCAPE,this);
    }
  }
}
