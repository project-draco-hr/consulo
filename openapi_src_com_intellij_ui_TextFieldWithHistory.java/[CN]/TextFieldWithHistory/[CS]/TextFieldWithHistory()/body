{
  super(new BorderLayout());
  myModel=new MyModel();
  myTextField=new JTextField();
  myTextField.setColumns(15);
  add(myTextField,BorderLayout.CENTER);
  final JLabel toggleHistoryLabel=new JLabel(IconLoader.findIcon("/actions/search.png"));
  toggleHistoryLabel.setOpaque(true);
  toggleHistoryLabel.setBackground(myTextField.getBackground());
  toggleHistoryLabel.setBorder(IdeBorderFactory.createEmptyBorder(0,0,0,4));
  toggleHistoryLabel.addMouseListener(new MouseAdapter(){
    public void mousePressed(    MouseEvent e){
      togglePopup();
    }
  }
);
  add(toggleHistoryLabel,BorderLayout.WEST);
  final JLabel clearFieldLabel=new JLabel(IconLoader.findIcon("/actions/clean.png"));
  clearFieldLabel.setOpaque(true);
  clearFieldLabel.setBackground(myTextField.getBackground());
  clearFieldLabel.setBorder(IdeBorderFactory.createEmptyBorder(0,4,0,0));
  add(clearFieldLabel,BorderLayout.EAST);
  clearFieldLabel.addMouseListener(new MouseAdapter(){
    public void mousePressed(    MouseEvent e){
      myTextField.setText("");
    }
  }
);
  myTextField.getDocument().addDocumentListener(new DocumentListener(){
    public void insertUpdate(    DocumentEvent e){
      updateCroppedList();
    }
    public void removeUpdate(    DocumentEvent e){
      updateCroppedList();
    }
    public void changedUpdate(    DocumentEvent e){
      updateCroppedList();
    }
    private void updateCroppedList(){
      SwingUtilities.invokeLater(new Runnable(){
        public void run(){
          String text=getTextEditor().getText();
          myModel.setSelectedItemAndCropList(text);
        }
      }
);
      SwingUtilities.invokeLater(new Runnable(){
        public void run(){
          if (0 == myModel.getSize()) {
            hidePopup();
            myModel.uncropList();
          }
 else {
            refreshPopup();
          }
        }
      }
);
    }
    private void refreshPopup(){
      Runnable hider=new Runnable(){
        public void run(){
          hidePopup();
        }
      }
;
      Runnable shower=new Runnable(){
        public void run(){
          showPopup();
        }
      }
;
      if (myModel.croppedListEnlarged()) {
        SwingUtilities.invokeLater(hider);
      }
      SwingUtilities.invokeLater(shower);
    }
  }
);
  setBorder(new CompoundBorder(IdeBorderFactory.createEmptyBorder(4,4,4,0),myTextField.getBorder()));
  myTextField.setBorder(null);
}
