{
  if (myPopup == null) {
    final JList list=new JList(myModel);
    if (myListener != null) {
      removeKeyListener(myListener);
    }
    final Runnable chooseRunnable=new Runnable(){
      public void run(){
        final String value=(String)list.getSelectedValue();
        getTextEditor().setText(value != null ? value : "");
        if (myPopup != null) {
          myPopup.cancel();
          myPopup=null;
        }
      }
    }
;
    myListener=new KeyAdapter(){
      public void keyPressed(      KeyEvent e){
        if (e.getKeyCode() == KeyEvent.VK_DOWN) {
          if (list.getSelectedIndex() < list.getModel().getSize() - 1) {
            list.setSelectedIndex(list.getSelectedIndex() + 1);
          }
        }
 else         if (e.getKeyCode() == KeyEvent.VK_UP) {
          if (list.getSelectedIndex() > 0) {
            list.setSelectedIndex(list.getSelectedIndex() - 1);
          }
        }
 else         if (e.getKeyCode() == KeyEvent.VK_ENTER) {
          if (list.getSelectedIndex() > -1) {
            chooseRunnable.run();
          }
        }
      }
    }
;
    addKeyboardListener(myListener);
    myPopup=JBPopupFactory.getInstance().createListPopupBuilder(list).setMovable(false).setRequestFocus(false).setItemChoosenCallback(chooseRunnable).createPopup();
    if (isShowing())     myPopup.showUnderneathOf(this);
  }
}
