{
  if (initializer instanceof PsiNewExpression) {
    final PsiNewExpression newExpression=(PsiNewExpression)initializer;
    final PsiExpression tryToDetectDiamondNewExpr=((PsiVariable)JavaPsiFacade.getElementFactory(initializer.getProject()).createVariableDeclarationStatement("x",expectedType,initializer).getDeclaredElements()[0]).getInitializer();
    if (tryToDetectDiamondNewExpr instanceof PsiNewExpression && PsiDiamondTypeUtil.canCollapseToDiamond((PsiNewExpression)tryToDetectDiamondNewExpr,(PsiNewExpression)tryToDetectDiamondNewExpr,expectedType)) {
      final PsiElement paramList=PsiDiamondTypeUtil.replaceExplicitWithDiamond(newExpression.getClassOrAnonymousClassReference().getParameterList());
      return PsiTreeUtil.getParentOfType(paramList,PsiNewExpression.class);
    }
  }
  return initializer;
}
