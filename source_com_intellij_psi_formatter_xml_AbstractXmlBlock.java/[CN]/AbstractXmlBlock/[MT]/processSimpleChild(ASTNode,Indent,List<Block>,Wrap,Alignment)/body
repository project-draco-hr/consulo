{
  if (myXmlFormattingPolicy.processJsp() && (child.getElementType() == ElementType.JSP_XML_TEXT || child.getPsi() instanceof JspText)) {
    final Pair<PsiElement,Language> root=JspTextBlock.findPsiRootAt(child);
    if (root != null) {
      createJspTextNode(result,child,indent);
      return;
    }
  }
  if (isXmlTag(child) || child.getElementType() == ElementType.XML_TAG) {
    result.add(new XmlTagBlock(child,wrap,alignment,myXmlFormattingPolicy,indent != null ? indent : Indent.getNoneIndent()));
  }
 else   if (child.getElementType() == ElementType.JSP_SCRIPTLET_END) {
    result.add(new XmlBlock(child,wrap,alignment,myXmlFormattingPolicy,Indent.getNoneIndent(),null));
  }
 else {
    result.add(new XmlBlock(child,wrap,alignment,myXmlFormattingPolicy,indent,null));
  }
}
