{
  final Pair<PsiElement,Language> psiRoot=JspTextBlock.findPsiRootAt(child);
  final ASTNode correspondingNode=psiRoot.getFirst().getNode().findLeafElementAt(child.getStartOffset());
  ASTNode topParentWithTheSameOffset=findParentWithTheSameOffset(correspondingNode);
  final TextRange elementRange=topParentWithTheSameOffset.getTextRange();
  if (canInsertWholeBlock(psiRoot,elementRange) && child.getTextRange().getEndOffset() < elementRange.getEndOffset()) {
    localResult.add(new JspTextBlock(topParentWithTheSameOffset,myXmlFormattingPolicy,psiRoot,indent));
    return findChildAfter(child,elementRange.getEndOffset());
  }
  localResult.add(new JspTextBlock(child,myXmlFormattingPolicy,psiRoot,indent));
  return child;
}
