{
  final Language myLanguage=myNode.getPsi().getLanguage();
  final Language childLanguage=child.getPsi().getLanguage();
  if (useMyFormatter(myLanguage,childLanguage)) {
    Block jspScriptletNode=buildBlockForScriptletNode(child,indent);
    if (jspScriptletNode != null) {
      return jspScriptletNode;
    }
    if (myXmlFormattingPolicy.processJsp() && (child.getElementType() == ElementType.JSP_XML_TEXT || child.getPsi() instanceof JspText)) {
      final Pair<PsiElement,Language> root=JspTextBlock.findPsiRootAt(child);
      if (root != null) {
        return new JspTextBlock(child,myXmlFormattingPolicy,root,indent);
      }
    }
    if (child.getElementType() == getTagType() || child.getElementType() == ElementType.XML_TAG) {
      return new XmlTagBlock(child,wrap,alignment,myXmlFormattingPolicy,indent != null ? indent : getFormatter().getNoneIndent());
    }
 else     if (child.getElementType() == ElementType.JSP_SCRIPTLET_END) {
      return new XmlBlock(child,wrap,alignment,myXmlFormattingPolicy,getFormatter().getNoneIndent());
    }
 else {
      return new XmlBlock(child,wrap,alignment,myXmlFormattingPolicy,indent);
    }
  }
 else {
    final FormattingModel childModel=childLanguage.getFormattingModelBuilder().createModel(child.getPsi(),myXmlFormattingPolicy.getSettings());
    return new AnotherLanguageBlockWrapper(child,myXmlFormattingPolicy,childModel.getRootBlock());
  }
}
