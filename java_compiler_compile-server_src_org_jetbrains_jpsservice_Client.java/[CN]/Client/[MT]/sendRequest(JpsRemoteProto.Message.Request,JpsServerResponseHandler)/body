{
  final UUID sessionUUID=UUID.randomUUID();
  final RequestFuture requestFuture=new RequestFuture(handler);
  myHandlers.put(sessionUUID,requestFuture);
  boolean writeSuccess=false;
  try {
    final ChannelFuture future=Channels.write(myConnectFuture.getChannel(),ProtoUtil.toMessage(sessionUUID,request));
    future.awaitUninterruptibly();
    writeSuccess=future.isSuccess();
    return requestFuture;
  }
  finally {
    if (!writeSuccess) {
      try {
        myHandlers.remove(sessionUUID);
        if (handler != null) {
          handler.sessionTerminated();
        }
      }
  finally {
        requestFuture.setDone();
      }
    }
  }
}
