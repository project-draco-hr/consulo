def applied(self, repo, node, parent):
    'returns True if a node is already an ancestor of parent\n        or has already been transplanted'
    if hasnode(repo, node):
        if (node in repo.changelog.reachable(parent, stop=node)):
            return True
    for t in self.transplants.get(node):
        if (not hasnode(repo, t.lnode)):
            self.transplants.remove(t)
            return False
        if (t.lnode in repo.changelog.reachable(parent, stop=t.lnode)):
            return True
    return False
