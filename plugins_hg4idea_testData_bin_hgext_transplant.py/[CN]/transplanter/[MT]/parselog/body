def parselog(self, fp):
    parents = []
    message = []
    node = revlog.nullid
    inmsg = False
    for line in fp.read().splitlines():
        if inmsg:
            message.append(line)
        elif line.startswith('# User '):
            user = line[7:]
        elif line.startswith('# Date '):
            date = line[7:]
        elif line.startswith('# Node ID '):
            node = revlog.bin(line[10:])
        elif line.startswith('# Parent '):
            parents.append(revlog.bin(line[9:]))
        elif (not line.startswith('#')):
            inmsg = True
            message.append(line)
    return (node, user, date, '\n'.join(message), parents)
