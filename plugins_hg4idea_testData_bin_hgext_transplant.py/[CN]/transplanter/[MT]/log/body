def log(self, user, date, message, p1, p2, merge=False):
    'journal changelog metadata for later recover'
    if (not os.path.isdir(self.path)):
        os.mkdir(self.path)
    fp = self.opener('journal', 'w')
    fp.write(('# User %s\n' % user))
    fp.write(('# Date %s\n' % date))
    fp.write(('# Node ID %s\n' % revlog.hex(p2)))
    fp.write((('# Parent ' + revlog.hex(p1)) + '\n'))
    if merge:
        fp.write((('# Parent ' + revlog.hex(p2)) + '\n'))
    fp.write((message.rstrip() + '\n'))
    fp.close()
