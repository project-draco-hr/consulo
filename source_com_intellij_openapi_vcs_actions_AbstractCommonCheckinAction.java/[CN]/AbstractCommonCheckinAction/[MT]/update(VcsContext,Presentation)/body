{
  Project project=vcsContext.getProject();
  if (project == null) {
    presentation.setEnabled(false);
    presentation.setVisible(false);
    return;
  }
  FilePath[] roots=getRoots(vcsContext);
  if (roots == null || roots.length == 0) {
    presentation.setEnabled(false);
    presentation.setVisible(false);
    return;
  }
  int checkinType=getCheckinType(roots);
  if (checkinType == DIRECTORIES) {
    for (int i=0; i < roots.length; i++) {
      FilePath root=roots[i];
      AbstractVcs vcs=VcsUtil.getVcsFor(project,root);
      if (vcs == null) {
        presentation.setEnabled(false);
        presentation.setVisible(false);
        return;
      }
      CheckinEnvironment checkinEnvironment=vcs.getCheckinEnvironment();
      if (checkinEnvironment == null) {
        presentation.setEnabled(false);
        presentation.setVisible(false);
        return;
      }
    }
  }
 else {
    CheckinEnvironment commonEnvironmentFor=getCommonEnvironmentFor(roots,project);
    if (commonEnvironmentFor == null) {
      presentation.setEnabled(false);
      presentation.setVisible(false);
      return;
    }
  }
  String actionName=getActionName(vcsContext);
  if (shouldShowDialog(vcsContext) || OptionsDialog.shiftIsPressed(vcsContext.getModifiers())) {
    actionName+="...";
  }
  presentation.setText(actionName);
  presentation.setEnabled(true);
  presentation.setVisible(true);
}
