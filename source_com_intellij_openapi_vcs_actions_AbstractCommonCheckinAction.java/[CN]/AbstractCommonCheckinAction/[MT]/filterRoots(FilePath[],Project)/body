{
  final ArrayList<FilePath> result=new ArrayList<FilePath>();
  for (  FilePath root : roots) {
    AbstractVcs vcs=VcsUtil.getVcsFor(project,root);
    if (vcs != null) {
      if (vcs.fileExistsInVcs(root) || !filterRootsBeforeAction()) {
        CheckinEnvironment checkinEnvironment=vcs.getCheckinEnvironment();
        if (checkinEnvironment != null) {
          result.add(root);
        }
      }
    }
  }
  return result.toArray(new FilePath[result.size()]);
}
