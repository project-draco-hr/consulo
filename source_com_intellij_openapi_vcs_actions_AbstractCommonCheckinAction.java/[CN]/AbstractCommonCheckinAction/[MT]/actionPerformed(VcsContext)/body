{
  final Project project=context.getProject();
  if (project == null)   return;
  FilePath[] roots=filterDescindingFiles(getRoots(context),project);
  int ciType=getCheckinType(roots);
  if (ciType == MIXED) {
    return;
  }
  if (ciType == DIRECTORIES) {
    if (ApplicationManager.getApplication().isDispatchThread()) {
      ApplicationManager.getApplication().saveAll();
    }
    checkinDirectories(project,context,roots);
  }
 else {
    CheckinEnvironment env=getCommonEnvironmentFor(roots,project);
    if (env == null)     return;
    if (ApplicationManager.getApplication().isDispatchThread()) {
      ApplicationManager.getApplication().saveAll();
    }
    final List<VcsException> errors=checkinFiles(project,context,roots,env);
    showErrorConfirmation(errors);
  }
}
