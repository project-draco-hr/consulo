{
  try {
    if (myPosition != null) {
      final SourcePosition locationPosition=ApplicationManager.getApplication().runReadAction(new Computable<SourcePosition>(){
        public SourcePosition compute(){
          return ContextUtil.getSourcePosition(context);
        }
      }
);
      if (locationPosition == null) {
        return myDepth;
      }
      if (myDepth == StepRequest.STEP_OVER || myDepth == StepRequest.STEP_INTO) {
        int frameCount=-1;
        if (context.getFrameProxy() != null) {
          try {
            frameCount=context.getFrameProxy().threadProxy().frameCount();
          }
 catch (          EvaluateException e) {
          }
        }
        final boolean filesEqual=myPosition.getFile().equals(locationPosition.getFile());
        if (filesEqual && myPosition.getLine() == locationPosition.getLine() && myFrameCount == frameCount) {
          return myDepth;
        }
        if (myDepth == StepRequest.STEP_INTO) {
          if (filesEqual && myFrameCount == frameCount && myPosition.getLine() != locationPosition.getLine()) {
            return STOP;
          }
        }
      }
    }
    if (myDepth == StepRequest.STEP_INTO) {
      DebuggerSettings settings=DebuggerSettings.getInstance();
      if (settings.SKIP_SYNTHETIC_METHODS) {
        Location location=context.getFrameProxy().location();
        Method method=location.method();
        if (method != null) {
          if (myVirtualMachineProxy.canGetSyntheticAttribute() ? method.isSynthetic() : method.name().indexOf('$') >= 0) {
            return myDepth;
          }
        }
      }
      if (!myIgnoreFilters) {
        if (settings.SKIP_GETTERS) {
          boolean isGetter=ApplicationManager.getApplication().runReadAction(new Computable<Boolean>(){
            public Boolean compute(){
              final PsiMethod psiMethod=PsiTreeUtil.getParentOfType(PositionUtil.getContextElement(context),PsiMethod.class);
              return (psiMethod != null && DebuggerUtils.isSimpleGetter(psiMethod)) ? Boolean.TRUE : Boolean.FALSE;
            }
          }
).booleanValue();
          if (isGetter) {
            return StepRequest.STEP_OUT;
          }
        }
        if (settings.SKIP_CONSTRUCTORS) {
          Location location=context.getFrameProxy().location();
          Method method=location.method();
          if (method != null && method.isConstructor()) {
            return StepRequest.STEP_OUT;
          }
        }
        if (settings.SKIP_CLASSLOADERS) {
          Location location=context.getFrameProxy().location();
          if (DebuggerUtilsEx.isAssignableFrom("java.lang.ClassLoader",location.declaringType())) {
            return StepRequest.STEP_OUT;
          }
        }
      }
      if (myTargetMethodSignature != null) {
        final Location location=context.getFrameProxy().location();
        if (!myTargetMethodSignature.shouldStopAtLocation(location)) {
          return StepRequest.STEP_OUT;
        }
      }
    }
  }
 catch (  VMDisconnectedException e) {
  }
catch (  EvaluateException e) {
    LOG.error(e);
  }
  return STOP;
}
