{
  FileTemplateManager manager=FileTemplateManager.getInstance();
  FileTemplate[] templates=manager.getAllTemplates();
  boolean showAll=templates.length <= FileTemplateManager.RECENT_TEMPLATES_SIZE;
  if (!showAll) {
    Collection<String> recentNames=manager.getRecentNames();
    templates=new FileTemplate[recentNames.size()];
    int i=0;
    for (    String name : recentNames) {
      templates[i]=FileTemplateManager.getInstance().getTemplate(name);
      i++;
    }
  }
  Arrays.sort(templates,new Comparator<FileTemplate>(){
    public int compare(    FileTemplate template1,    FileTemplate template2){
      if (template1.isJavaClassTemplate() && !template2.isJavaClassTemplate()) {
        return -1;
      }
      if (template2.isJavaClassTemplate() && !template1.isJavaClassTemplate()) {
        return 1;
      }
      int i=template1.getExtension().compareTo(template2.getExtension());
      if (i != 0) {
        return i;
      }
      return template1.getName().compareTo(template2.getName());
    }
  }
);
  List<AnAction> result=new ArrayList<AnAction>();
  for (  FileTemplate template : templates) {
    if (canCreateFromTemplate(e,template)) {
      AnAction action=replaceAction(template);
      if (action == null) {
        action=new CreateFromTemplateAction(template);
      }
      result.add(action);
    }
  }
  if (!result.isEmpty()) {
    if (!showAll) {
      result.add(new CreateFromTemplatesAction(IdeBundle.message("action.from.file.template")));
    }
    result.add(Separator.getInstance());
    result.add(new EditFileTemplatesAction(IdeBundle.message("action.edit.file.templates")));
  }
  return result.toArray(new AnAction[result.size()]);
}
