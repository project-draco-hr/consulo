{
  if (value != null && !isExcluded(obj,fieldname,value,true)) {
    if (isReference(obj,fieldname,value,true)) {
      Object tmp=enc.getId(value);
      if (tmp == null) {
        System.err.println("mxObjectCodec.encode: No ID for " + getName() + "."+ fieldname+ "="+ value);
        return;
      }
      value=tmp;
    }
    Object defaultValue=getFieldValue(template,fieldname);
    if (fieldname == null || enc.isEncodeDefaults() || defaultValue == null || !defaultValue.equals(value)) {
      writeAttribute(enc,obj,getAttributeName(fieldname),value,node);
    }
  }
}
