{
  final ArrayList<PsiExpression> expressions=new ArrayList<PsiExpression>();
  if (root instanceof PsiField || root instanceof PsiMethod) {
    final PsiModifierList modifierList=((PsiModifierListOwner)root).getModifierList();
    if (VisibilityUtil.compare(VisibilityUtil.getVisibilityModifier(modifierList),PsiModifier.PRIVATE) < 0)     return null;
  }
  for (  PsiReference reference : ReferencesSearch.search(root,GlobalSearchScope.fileScope(root.getContainingFile()))) {
    final PsiElement element=reference.getElement();
    final PsiExpression expr=PsiTreeUtil.getParentOfType(element,PsiExpression.class,false);
    if (expr != null) {
      expressions.add(expr);
    }
  }
  try {
    final PsiExpression[] occurrences=expressions.toArray(new PsiExpression[expressions.size()]);
    final PsiType[] psiTypes=new TypeSelectorManagerImpl(project,myTypeCodeFragment.getType(),occurrences).getTypesForAll();
    if (psiTypes.length > 0) {
      final String[] history=new String[psiTypes.length];
      for (int i=0; i < psiTypes.length; i++) {
        PsiType psiType=psiTypes[i];
        history[i]=psiType.getCanonicalText();
      }
      return history;
    }
  }
 catch (  PsiTypeCodeFragment.TypeSyntaxException e) {
    LOG.info(e);
    return null;
  }
catch (  PsiTypeCodeFragment.NoTypeException e) {
    LOG.info(e);
    return null;
  }
  return null;
}
