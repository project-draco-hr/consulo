{
  try {
    final ModifiableModuleModel model=ModuleManager.getInstance(project).getModifiableModel();
    final Module module=model.loadModule(imlFile.getPath());
    AccessToken token=WriteAction.start();
    try {
      model.commit();
    }
  finally {
      token.finish();
    }
    final Module newModule=ModuleManager.getInstance(project).findModuleByName(module.getName());
    final Module primaryModule=addPrimaryModuleDependency(project,newModule);
    if (primaryModule != null) {
      VirtualFile dotIdeaDir=imlFile.getParent();
      if (dotIdeaDir != null) {
        updateVcsMapping(primaryModule,dotIdeaDir.getParent());
      }
    }
    if (callback != null) {
      callback.projectOpened(project,newModule);
    }
  }
 catch (  Exception ex) {
    LOG.info(ex);
    Messages.showErrorDialog(project,"Cannot attach project: " + ex.getMessage(),CommonBundle.getErrorTitle());
  }
}
