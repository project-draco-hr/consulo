{
  if (!projectDir.exists()) {
    Project newProject=((ProjectManagerEx)ProjectManager.getInstance()).newProject(projectDir.getParentFile().getName(),projectDir.getParent(),true,false);
    if (newProject == null) {
      return false;
    }
    final VirtualFile baseDir=LocalFileSystem.getInstance().refreshAndFindFileByPath(projectDir.getParent());
    PlatformProjectOpenProcessor.runDirectoryProjectConfigurators(baseDir,newProject);
    newProject.save();
    AccessToken token=ApplicationManager.getApplication().acquireWriteActionLock(null);
    try {
      Disposer.dispose(newProject);
    }
  finally {
      token.finish();
    }
  }
  for (  String file : projectDir.list()) {
    if (FileUtil.getExtension(file).equals("iml")) {
      VirtualFile imlFile=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(new File(projectDir,file));
      if (imlFile != null) {
        attachModule(project,imlFile);
        return true;
      }
    }
  }
  return false;
}
