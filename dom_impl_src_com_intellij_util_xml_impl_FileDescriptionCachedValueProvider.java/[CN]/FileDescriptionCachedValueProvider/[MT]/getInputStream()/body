{
  final FileViewProvider viewProvider=myXmlFile.getViewProvider();
  final VirtualFile file=viewProvider.getVirtualFile();
  final Document document=PsiDocumentManager.getInstance(myXmlFile.getProject()).getCachedDocument(myXmlFile);
  if (document != null) {
    return new InputSource(new CharSequenceReader(document.getCharsSequence()));
  }
  if (!viewProvider.isPhysical()) {
    return new InputSource(new CharSequenceReader(myXmlFile.getText()));
  }
  return new InputSource(file.getInputStream());
}
