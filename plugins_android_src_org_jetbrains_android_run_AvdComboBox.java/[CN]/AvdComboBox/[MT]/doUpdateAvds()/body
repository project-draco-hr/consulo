{
  final Module module=getModule();
  final AndroidFacet facet=module != null ? AndroidFacet.getInstance(module) : null;
  final String[] newAvds;
  if (facet != null) {
    final Set<String> filteringSet=new HashSet<String>();
    if (myShowNotLaunchedOnly) {
      final AndroidDebugBridge debugBridge=facet.getDebugBridge();
      if (debugBridge != null) {
        for (        IDevice device : debugBridge.getDevices()) {
          final String avdName=device.getAvdName();
          if (avdName != null && avdName.length() > 0) {
            filteringSet.add(avdName);
          }
        }
      }
    }
    final List<String> newAvdList=new ArrayList<String>();
    if (myAddEmptyElement) {
      newAvdList.add("");
    }
    for (    AvdInfo avd : facet.getAllCompatibleAvds()) {
      final String avdName=avd.getName();
      if (!filteringSet.contains(avdName)) {
        newAvdList.add(avdName);
      }
    }
    newAvds=newAvdList.toArray(new String[newAvdList.size()]);
  }
 else {
    newAvds=ArrayUtil.EMPTY_STRING_ARRAY;
  }
  if (!Arrays.equals(myOldAvds,newAvds)) {
    myOldAvds=newAvds;
    final Object selected=getComboBox().getSelectedItem();
    getComboBox().setModel(new DefaultComboBoxModel(newAvds));
    getComboBox().setSelectedItem(selected);
  }
}
