def getip():
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        s.connect(('1.0.0.1', 0))
        ip = s.getsockname()[0]
        return ip
    except:
        pass
    try:
        dumbip = socket.gethostbyaddr(socket.gethostname())[2][0]
        if ((not dumbip.startswith('127.')) and (':' not in dumbip)):
            return dumbip
    except (socket.gaierror, socket.herror):
        dumbip = '127.0.0.1'
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        s.connect(('1.0.0.1', 1))
        ip = s.getsockname()[0]
        return ip
    except:
        pass
    return dumbip
