{
  Editor editor=PlatformDataKeys.EDITOR.getData(dataContext);
  if (editor == null) {
    presentation.setVisible(false);
    return;
  }
  Project project=CommonDataKeys.PROJECT.getData(dataContext);
  if (project == null) {
    return;
  }
  PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
  PsiElement element=getTargetElement(editor,project);
  boolean result=element != null && CopyHandler.canCopy(new PsiElement[]{element});
  if (!result && file != null) {
    result=CopyHandler.canCopy(new PsiElement[]{file});
  }
  presentation.setEnabled(result);
  presentation.setVisible(true);
}
