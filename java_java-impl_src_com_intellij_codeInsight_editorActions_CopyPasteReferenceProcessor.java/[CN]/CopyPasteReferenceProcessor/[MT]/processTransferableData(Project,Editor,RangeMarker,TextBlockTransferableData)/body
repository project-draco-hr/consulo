{
  if (DumbService.getInstance(project).isDumb()) {
    return;
  }
  final Document document=editor.getDocument();
  final PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(document);
  if (!(file instanceof PsiClassOwner)) {
    return;
  }
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  final ReferenceTransferableData.ReferenceData[] referenceData=((ReferenceTransferableData)value).getData();
  final PsiJavaCodeReferenceElement[] refs=findReferencesToRestore(file,bounds,referenceData);
  if (CodeInsightSettings.getInstance().ADD_IMPORTS_ON_PASTE == CodeInsightSettings.ASK) {
    askReferencesToRestore(project,refs,referenceData);
  }
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      restoreReferences(referenceData,refs);
    }
  }
);
}
