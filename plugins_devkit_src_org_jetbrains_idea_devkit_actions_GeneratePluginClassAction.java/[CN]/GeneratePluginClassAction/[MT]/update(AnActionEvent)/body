{
  super.update(e);
  final Presentation presentation=e.getPresentation();
  if (presentation.isEnabled()) {
    final DataContext context=e.getDataContext();
    Module module=LangDataKeys.MODULE.getData(context);
    if (module == null || !PluginModuleUtil.isPluginModuleOrDependency(module)) {
      presentation.setEnabled(false);
      presentation.setVisible(false);
    }
    final IdeView view=LangDataKeys.IDE_VIEW.getData(e.getDataContext());
    final Project project=PlatformDataKeys.PROJECT.getData(e.getDataContext());
    if (view != null && project != null) {
      ProjectFileIndex projectFileIndex=ProjectRootManager.getInstance(project).getFileIndex();
      PsiDirectory[] dirs=view.getDirectories();
      for (      PsiDirectory dir : dirs) {
        if (projectFileIndex.isInSourceContent(dir.getVirtualFile()) && JavaDirectoryService.getInstance().getPackage(dir) != null) {
          return;
        }
      }
      presentation.setEnabled(false);
      presentation.setVisible(false);
    }
  }
}
