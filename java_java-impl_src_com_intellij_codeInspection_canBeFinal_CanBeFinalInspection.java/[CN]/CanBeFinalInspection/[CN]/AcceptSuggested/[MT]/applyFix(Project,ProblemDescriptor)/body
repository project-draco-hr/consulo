{
  if (ReadonlyStatusHandler.getInstance(project).ensureFilesWritable(PsiUtilBase.getVirtualFile(descriptor.getPsiElement())).hasReadonlyFiles())   return;
  final PsiElement element=descriptor.getPsiElement();
  final PsiModifierListOwner psiElement=PsiTreeUtil.getParentOfType(element,PsiModifierListOwner.class);
  if (psiElement != null) {
    RefJavaElement refElement=(RefJavaElement)(myManager != null ? myManager.getReference(psiElement) : null);
    try {
      if (psiElement instanceof PsiVariable) {
        ((PsiVariable)psiElement).normalizeDeclaration();
      }
      final PsiModifierList modifierList=psiElement.getModifierList();
      LOG.assertTrue(modifierList != null);
      modifierList.setModifierProperty(PsiModifier.FINAL,true);
    }
 catch (    IncorrectOperationException e) {
      LOG.error(e);
    }
    if (refElement != null) {
      RefJavaUtil.getInstance().setIsFinal(refElement,true);
    }
  }
}
