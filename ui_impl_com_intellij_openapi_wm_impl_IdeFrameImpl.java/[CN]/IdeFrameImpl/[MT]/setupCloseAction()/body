{
  setDefaultCloseOperation(WindowConstants.DO_NOTHING_ON_CLOSE);
  addWindowListener(new WindowAdapter(){
    public void windowClosing(    final WindowEvent e){
      final Application app=ApplicationManager.getApplication();
      app.invokeLater(new Runnable(){
        public void run(){
          if (app.isDisposed())           return;
          final Project[] openProjects=ProjectManager.getInstance().getOpenProjects();
          if (openProjects.length > 1) {
            if (myProject != null && myProject.isOpen()) {
              ProjectUtil.closeProject(myProject);
            }
            RecentProjectsManager.getInstance().updateLastProjectPath();
          }
 else {
            ApplicationManagerEx.getApplicationEx().exit();
          }
        }
      }
,ModalityState.NON_MODAL);
    }
  }
);
}
