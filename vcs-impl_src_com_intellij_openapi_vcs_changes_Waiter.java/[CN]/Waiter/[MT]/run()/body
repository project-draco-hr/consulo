{
  final ProgressIndicator indicator=ProgressManager.getInstance().getProgressIndicator();
  if (indicator != null) {
    indicator.setIndeterminate(true);
    indicator.setText2(VcsBundle.message("commit.wait.util.synched.text"));
  }
synchronized (myLock) {
    if (myStarted) {
      LOG.error("Waiter running under progress being started again.");
      return;
    }
    myStarted=true;
    while (!myDone) {
      try {
        myLock.wait(500);
      }
 catch (      InterruptedException e) {
      }
      if (indicator != null) {
        indicator.checkCanceled();
      }
    }
  }
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
synchronized (myLock) {
        if (!myDone) {
          return;
        }
      }
      if (myProject.isDisposed())       return;
      myRunnable.run();
      ChangesViewManager.getInstance(myProject).refreshView();
    }
  }
,(myState == null) ? ModalityState.NON_MODAL : myState);
}
