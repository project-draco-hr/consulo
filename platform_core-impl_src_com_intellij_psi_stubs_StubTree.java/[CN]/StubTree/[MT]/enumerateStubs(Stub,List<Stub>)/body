{
  final PsiFileStub[] files=((PsiFileStub)root).getStubRoots();
  int idOffset=0;
  final List<Stub> dummyList=new ArrayList<Stub>();
  for (  PsiFileStub file : files) {
    if (file == root)     break;
    final int fileStubsCount;
    final ObjectStubTree existingTree=file.getUserData(STUB_TO_TREE_REFERENCE);
    if (existingTree != null) {
      fileStubsCount=existingTree.getPlainList().size();
    }
 else {
      dummyList.clear();
      enumerateStubs(file,dummyList,idOffset);
      fileStubsCount=dummyList.size();
    }
    idOffset+=fileStubsCount;
  }
  enumerateStubs(root,result,idOffset);
}
