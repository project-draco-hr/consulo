{
  final Map<StubIndexKey,Map<Object,TIntArrayList>> result=new HashMap<StubIndexKey,Map<Object,TIntArrayList>>();
  for (int i=0, plainListSize=myPlainList.size(); i < plainListSize; i++) {
    final StubElement<?> stub=myPlainList.get(i);
    final StubSerializer serializer=SerializationManager.getInstance().getSerializer(stub);
    final int stubIdx=i;
    serializer.indexStub(stub,new IndexSink(){
      @Override public void occurrence(      @NotNull final StubIndexKey indexKey,      @NotNull final Object value){
        Map<Object,TIntArrayList> map=result.get(indexKey);
        if (map == null) {
          map=new HashMap<Object,TIntArrayList>();
          result.put(indexKey,map);
        }
        TIntArrayList list=map.get(value);
        if (list == null) {
          list=new TIntArrayList();
          map.put(value,list);
        }
        list.add(stubIdx);
      }
    }
);
  }
  return result;
}
