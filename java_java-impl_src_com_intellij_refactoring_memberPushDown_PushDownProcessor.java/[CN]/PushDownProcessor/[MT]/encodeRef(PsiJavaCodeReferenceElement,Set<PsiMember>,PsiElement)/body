{
  final PsiElement resolved=expression.resolve();
  if (resolved == null)   return;
  final PsiElement qualifier=expression.getQualifier();
  for (  PsiMember movedMember : movedMembers) {
    if (movedMember.equals(resolved)) {
      if (qualifier == null) {
        toPut.putCopyableUserData(REMOVE_QUALIFIER_KEY,Boolean.TRUE);
      }
 else {
        if (qualifier instanceof PsiJavaCodeReferenceElement && ((PsiJavaCodeReferenceElement)qualifier).isReferenceTo(myClass)) {
          toPut.putCopyableUserData(REPLACE_QUALIFIER_KEY,myClass);
        }
      }
    }
 else     if (movedMember instanceof PsiClass && PsiTreeUtil.getParentOfType(resolved,PsiClass.class,false) == movedMember) {
      if (qualifier instanceof PsiJavaCodeReferenceElement && ((PsiJavaCodeReferenceElement)qualifier).isReferenceTo(movedMember)) {
        toPut.putCopyableUserData(REPLACE_QUALIFIER_KEY,(PsiClass)movedMember);
      }
    }
 else {
      if (qualifier instanceof PsiThisExpression) {
        final PsiJavaCodeReferenceElement qElement=((PsiThisExpression)qualifier).getQualifier();
        if (qElement != null && qElement.isReferenceTo(myClass)) {
          toPut.putCopyableUserData(REPLACE_QUALIFIER_KEY,myClass);
        }
      }
    }
  }
}
