{
  if (shouldAskUser()) {
    int result=Messages.showOkCancelDialog(myProject,"The compiler is running. Proceed with project closing?","Compiler Running",Messages.getQuestionIcon());
    if (result != 0) {
      return false;
    }
    myUserAcceptedCancel=true;
    final CompilerManager compilerManager=CompilerManager.getInstance(project);
    compilerManager.addCompilationStatusListener(new CompilationStatusListener(){
      public void compilationFinished(      boolean aborted,      int errors,      int warnings){
        compilerManager.removeCompilationStatusListener(this);
        ProjectUtil.closeProject(project);
      }
    }
);
    cancel();
    return false;
  }
  return !isRunning();
}
