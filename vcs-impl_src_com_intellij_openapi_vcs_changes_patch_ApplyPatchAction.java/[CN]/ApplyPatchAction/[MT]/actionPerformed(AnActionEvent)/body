{
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  final ApplyPatchDialog dialog=new ApplyPatchDialog(project);
  final VirtualFile vFile=e.getData(PlatformDataKeys.VIRTUAL_FILE);
  if (vFile != null && vFile.getFileType() == StdFileTypes.PATCH) {
    dialog.setFileName(vFile.getPresentableUrl());
  }
  dialog.show();
  if (dialog.getExitCode() != DialogWrapper.OK_EXIT_CODE) {
    return;
  }
  final List<FilePatch> patches=dialog.getPatches();
  final ApplyPatchContext context=dialog.getApplyPatchContext();
  applySkipDirs(patches,context.getSkipTopDirs());
  new PatchApplier(project,context.getBaseDir(),patches,dialog.getSelectedChangeList(),null).execute();
}
