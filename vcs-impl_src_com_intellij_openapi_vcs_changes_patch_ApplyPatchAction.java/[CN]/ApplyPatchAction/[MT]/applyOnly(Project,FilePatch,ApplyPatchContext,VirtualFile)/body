{
  try {
    return patch.apply(file,context,project);
  }
 catch (  ApplyPatchException ex) {
    if (!patch.isNewFile() && !patch.isDeletedFile() && patch instanceof TextFilePatch) {
      ApplyPatchStatus mergeStatus=mergeAgainstBaseVersion(project,file,context,(TextFilePatch)patch,ApplyPatchMergeRequestFactory.INSTANCE);
      if (mergeStatus != null) {
        return mergeStatus;
      }
    }
    Messages.showErrorDialog(project,VcsBundle.message("patch.apply.error",patch.getBeforeName(),ex.getMessage()),VcsBundle.message("patch.apply.dialog.title"));
  }
catch (  Exception ex) {
    LOG.error(ex);
  }
  return ApplyPatchStatus.FAILURE;
}
