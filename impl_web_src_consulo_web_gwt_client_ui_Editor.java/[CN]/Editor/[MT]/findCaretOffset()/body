{
  Range browserRange=Selection.getBrowserRange();
  RangeEndPoint startPoint=browserRange.getStartPoint();
  Text text=startPoint.getTextNode();
  if (text == null) {
    return 0;
  }
  int offset=startPoint.getOffset();
  Node parentNode=text.getParentNode();
  if (parentNode == null) {
    return 0;
  }
  if (!parentNode.getNodeName().equalsIgnoreCase("span")) {
    return 0;
  }
  Object range=((Element)parentNode).getPropertyObject("range");
  if (!(range instanceof GwtTextRange)) {
    return 0;
  }
  return ((GwtTextRange)range).getStartOffset();
}
