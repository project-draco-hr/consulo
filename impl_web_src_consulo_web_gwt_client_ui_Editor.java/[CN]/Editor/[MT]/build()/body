{
  Grid gridPanel=GwtUtil.fillAndReturn(new Grid(1,2));
  setDefaultColors(gridPanel);
  gridPanel.getColumnFormatter().getElement(1).getStyle().setWidth(100,Style.Unit.PCT);
  VerticalPanel editorLinePanel=new VerticalPanel();
  gridPanel.setWidget(0,0,editorLinePanel);
  editorLinePanel.addStyleName("noselectable");
  editorLinePanel.getElement().getStyle().setProperty("borderRightColor",GwtStyleUtil.toString(myScheme.getColor(GwtEditorColorScheme.TEARLINE_COLOR)));
  editorLinePanel.getElement().getStyle().setProperty("borderRightStyle","solid");
  editorLinePanel.getElement().getStyle().setProperty("borderRightWidth","1px");
  editorLinePanel.getElement().getStyle().setWhiteSpace(Style.WhiteSpace.NOWRAP);
  editorLinePanel.getElement().getStyle().setBackgroundColor(GwtStyleUtil.toString(myScheme.getColor(GwtEditorColorScheme.GUTTER_BACKGROUND)));
  for (int i=0; i < myLineCount; i++) {
    final Grid panel=GwtUtil.fillAndReturn(new Grid(1,5));
    panel.getCellFormatter().setHorizontalAlignment(0,0,HasHorizontalAlignment.ALIGN_RIGHT);
    panel.getCellFormatter().getElement(0,0).getStyle().setPaddingLeft(5,Style.Unit.PX);
    panel.getCellFormatter().getElement(0,4).getStyle().setPaddingRight(5,Style.Unit.PX);
    panel.getColumnFormatter().getElement(0).getStyle().setWidth(100,Style.Unit.PCT);
    InlineHTML lineSpan=new InlineHTML(String.valueOf(i + 1));
    lineSpan.addStyleName("editorLine");
    lineSpan.addStyleName("editorGutterLine" + i);
    lineSpan.getElement().getStyle().setColor(GwtStyleUtil.toString(myScheme.getColor(GwtEditorColorScheme.LINE_NUMBERS_COLOR)));
    panel.setWidget(0,0,lineSpan);
    editorLinePanel.add(panel);
  }
  VerticalPanel editorCodePanel=new VerticalPanel(){
{
      sinkEvents(Event.ONCHANGE | Event.ONPASTE | Event.KEYEVENTS);
    }
    @Override public void onBrowserEvent(    Event event){
      event.preventDefault();
    }
  }
;
  gridPanel.setWidget(0,1,editorCodePanel);
  GwtUtil.fill(editorCodePanel);
  editorCodePanel.getElement().setAttribute("spellcheck","false");
  editorCodePanel.getElement().setAttribute("contenteditable","true");
  editorCodePanel.addStyleName("noFocusBorder");
  int lineCount=0;
  FlowPanel lineElement=null;
  for (  EditorSegmentBuilder.Fragment fragment : myBuilder.getFragments()) {
    if (lineElement == null) {
      lineElement=new CodeLinePanel();
      setDefaultColors(lineElement);
      lineElement.setWidth("100%");
      lineElement.addStyleName("editorLine");
      lineElement.addStyleName("gen_Line_" + lineCount);
    }
    lineElement.add(fragment.widget);
    if (fragment.lineWrap) {
      editorCodePanel.add(lineElement);
      lineElement=null;
      lineCount++;
    }
  }
  ScrollPanel scrollPanel=new ScrollPanel(gridPanel);
  GwtUtil.fill(scrollPanel);
  DockPanel panel=new DockPanel();
  panel.setHorizontalAlignment(HasHorizontalAlignment.ALIGN_LEFT);
  panel.setWidth("100%");
  panel.add(scrollPanel,DockPanel.CENTER);
  setWidget(panel);
}
