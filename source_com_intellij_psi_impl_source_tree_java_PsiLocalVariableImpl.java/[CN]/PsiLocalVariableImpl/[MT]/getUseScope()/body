{
  if (PsiUtil.isInJspFile(this)) {
    if (getTreeParent().getElementType() == JavaElementType.DECLARATION_STATEMENT && getTreeParent().getTreeParent() instanceof JspCodeBlock && getTreeParent().getTreeParent().getTreeParent().getElementType() == JspElementType.HOLDER_METHOD) {
      final JspFile jspFile=PsiUtil.getJspFile(this);
      final JspContextManager contextManager=JspContextManager.getInstance(getProject());
      if (contextManager == null) {
        return super.getUseScope();
      }
      final Set<PsiFile> allIncluded=new THashSet<PsiFile>(10);
      final JspFile rootContext=contextManager.getRootContextFile(jspFile);
      allIncluded.add(rootContext);
      JspSpiUtil.visitAllIncludedFilesRecursively(rootContext,new Processor<JspFile>(){
        public boolean process(        final JspFile file){
          allIncluded.add(file);
          return true;
        }
      }
);
      return new LocalSearchScope(allIncluded.toArray(new PsiFile[allIncluded.size()]));
    }
  }
  final GlobalSearchScope maximalUseScope=getManager().getFileManager().getUseScope(this);
  PsiElement parentElement=getParent();
  if (parentElement instanceof PsiDeclarationStatement) {
    return new LocalSearchScope(parentElement.getParent());
  }
 else {
    return maximalUseScope;
  }
}
