{
  super(new BorderLayout());
  myProject=project;
  myAdditionalToolbarActions=additionalToolbarActions;
  myAllChanges=new ArrayList<Change>();
  myReadOnly=!showChangelistChooser;
  ChangeList initalListSelection=null;
  for (  ChangeList list : changeLists) {
    myAllChanges.addAll(list.getChanges());
    if (list instanceof LocalChangeList && ((LocalChangeList)list).isDefault()) {
      initalListSelection=list;
    }
  }
  if (initalListSelection == null) {
    initalListSelection=changeLists.get(0);
  }
  myViewer=new ChangesTreeList(myProject,changes,capableOfExcludingChanges);
  myViewer.setDoubleClickHandler(new Runnable(){
    public void run(){
      showDiff();
    }
  }
);
  setSelectedList(initalListSelection);
  JPanel listPanel=new JPanel(new BorderLayout());
  listPanel.add(myViewer);
  listPanel.setBorder(IdeBorderFactory.createTitledHeaderBorder(VcsBundle.message("commit.dialog.changed.files.label")));
  add(listPanel,BorderLayout.CENTER);
  myHeaderPanel=new JPanel(new BorderLayout());
  if (showChangelistChooser) {
    myHeaderPanel.add(new ChangeListChooser(changeLists),BorderLayout.EAST);
  }
  myHeaderPanel.add(createToolbar(),BorderLayout.WEST);
  add(myHeaderPanel,BorderLayout.NORTH);
  myViewer.setShowFlatten(PropertiesComponent.getInstance(myProject).isTrueValue(FLATTEN_OPTION_KEY));
}
