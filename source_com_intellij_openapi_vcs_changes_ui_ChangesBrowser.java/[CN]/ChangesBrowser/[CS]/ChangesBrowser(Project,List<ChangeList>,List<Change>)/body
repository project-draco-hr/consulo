{
  super(new BorderLayout());
  myProject=project;
  myAllChanges=new ArrayList<Change>();
  ChangeList initalListSelection=null;
  for (  ChangeList list : changeLists) {
    myAllChanges.addAll(list.getChanges());
    if (list.isDefault()) {
      initalListSelection=list;
    }
  }
  if (initalListSelection == null) {
    initalListSelection=changeLists.get(0);
  }
  myViewer=new ChangesTreeList(myProject,changes);
  myViewer.setDoubleClickHandler(new Runnable(){
    public void run(){
      showDiff();
    }
  }
);
  setSelectedList(initalListSelection);
  JPanel listPanel=new JPanel(new BorderLayout());
  listPanel.add(myViewer);
  listPanel.setBorder(IdeBorderFactory.createTitledHeaderBorder(VcsBundle.message("commit.dialog.changed.files.label")));
  add(listPanel,BorderLayout.CENTER);
  JPanel headerPanel=new JPanel(new BorderLayout());
  headerPanel.add(new ChangeListChooser(changeLists),BorderLayout.EAST);
  headerPanel.add(createToolbar(),BorderLayout.WEST);
  add(headerPanel,BorderLayout.NORTH);
  myViewer.setShowFlatten(PropertiesComponent.getInstance(myProject).isTrueValue(FLATTEN_OPTION_KEY));
}
