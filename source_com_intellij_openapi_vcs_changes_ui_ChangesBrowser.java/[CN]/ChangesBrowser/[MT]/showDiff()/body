{
  final Change leadSelection=myViewer.getLeadSelection();
  Change[] changes=myViewer.getSelectedChanges();
  if (changes.length < 2) {
    final Collection<Change> displayedChanges=getCurrentDisplayedChanges();
    changes=displayedChanges.toArray(new Change[displayedChanges.size()]);
  }
  int indexInSelection=Arrays.asList(changes).indexOf(leadSelection);
  if (indexInSelection >= 0) {
    ShowDiffAction.showDiffForChange(changes,indexInSelection,myProject,!myReadOnly ? new DiffToolbarActionsFactory() : null);
  }
 else {
    ShowDiffAction.showDiffForChange(new Change[]{leadSelection},0,myProject,!myReadOnly ? new DiffToolbarActionsFactory() : null);
  }
}
