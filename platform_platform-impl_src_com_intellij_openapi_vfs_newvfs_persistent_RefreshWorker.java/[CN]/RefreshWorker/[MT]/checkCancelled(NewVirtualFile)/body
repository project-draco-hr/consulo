{
  if (myCancelled || ourCancellingCondition != null && ourCancellingCondition.fun(stopAt)) {
    forceMarkDirty(stopAt);
    while (!myRefreshQueue.isEmpty()) {
      NewVirtualFile next=myRefreshQueue.pullFirst().first;
      forceMarkDirty(next);
    }
    throw new RefreshCancelledException();
  }
}
