{
  if (item != null) {
    PsiDocumentManager.getInstance(myProject).commitAllDocuments();
    Integer bracketCount=(Integer)item.getAttribute(LookupItem.BRACKETS_COUNT_ATTR);
    if (bracketCount != null) {
      StringBuilder tail=new StringBuilder();
      for (int i=0; i < bracketCount.intValue(); i++) {
        tail.append("[]");
      }
      EditorModificationUtil.insertStringAtCaret(myEditor,tail.toString());
      PsiDocumentManager.getInstance(myProject).commitDocument(myDocument);
    }
    final TemplateLookupSelectionHandler handler=item.getAttribute(TemplateLookupSelectionHandler.KEY_IN_LOOKUP_ITEM);
    if (handler != null) {
      handler.itemSelected(item,psiFile,myDocument,mySegments.getSegmentStart(currentSegmentNumber),mySegments.getSegmentEnd(currentSegmentNumber));
    }
    if (completionChar == '.') {
      EditorModificationUtil.insertStringAtCaret(myEditor,".");
      AutoPopupController.getInstance(myProject).autoPopupMemberLookup(myEditor);
      return;
    }
    if (item.getAttribute(Expression.AUTO_POPUP_NEXT_LOOKUP) != null) {
      AutoPopupController.getInstance(myProject).autoPopupMemberLookup(myEditor);
      return;
    }
    if (!isFinished()) {
      calcResults(true);
    }
  }
  nextTab();
}
