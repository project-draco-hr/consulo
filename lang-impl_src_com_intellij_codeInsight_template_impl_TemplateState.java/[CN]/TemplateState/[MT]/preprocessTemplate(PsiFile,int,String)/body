{
  if (file.getLanguage().equals(StdLanguages.JSPX) && file instanceof JspFile) {
    if (XmlUtil.toCode(textToInsert)) {
      try {
        caretOffset+=JspSpiUtil.escapeCharsInJspContext((JspFile)file,caretOffset,myTemplate.getTemplateText());
        PostprocessReformattingAspect.getInstance(myProject).doPostponedFormatting();
        myEditor.getCaretModel().moveToOffset(caretOffset);
      }
 catch (      IncorrectOperationException e) {
        LOG.error(e);
      }
    }
  }
}
