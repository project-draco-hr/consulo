{
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      if (myEditor == null)       return;
      final LookupManager lookupManager=LookupManager.getInstance(myProject);
      if (lookupManager.isDisposed())       return;
      final Lookup lookup=lookupManager.showLookup(myEditor,lookupItems,"",new CompletionPreferencePolicy(PsiManager.getInstance(myProject),lookupItems,ExpectedTypeInfo.EMPTY,"",psiFile),new DefaultCharFilter(myEditor,psiFile,end));
      lookup.setCurrentItem(lookupItems[0]);
      toProcessTab=false;
      lookup.addLookupListener(new LookupAdapter(){
        public void lookupCanceled(        LookupEvent event){
          lookup.removeLookupListener(this);
          toProcessTab=true;
        }
        public void itemSelected(        LookupEvent event){
          lookup.removeLookupListener(this);
          if (isFinished())           return;
          toProcessTab=true;
          final LookupItem item=event.getItem();
          TemplateState.this.itemSelected(item,psiFile,currentSegmentNumber,event.getCompletionChar());
        }
      }
);
    }
  }
);
}
