{
  final int oldVariableNumber=myCurrentVariableNumber;
  myCurrentVariableNumber=variableNumber;
  ((DocumentEx)myDocument).setStripTrailingSpacesEnabled(variableNumber < 0);
  if (variableNumber < 0) {
    myCurrentSegmentNumber=-1;
  }
 else {
    myCurrentSegmentNumber=getCurrentSegmentNumber();
  }
  fireCurrentVariableChanged(oldVariableNumber,variableNumber);
  if (myCurrentSegmentNumber < 0) {
    releaseAll();
  }
}
