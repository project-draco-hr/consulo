{
  final Set<PsiFile> selectedScope=getSelectedScope(myRightTree);
  Set<PsiFile> result=new HashSet<PsiFile>();
  ((PackageDependenciesNode)myLeftTree.getModel().getRoot()).fillFiles(result,!mySettings.UI_FLATTEN_PACKAGES);
  selectedScope.removeAll(result);
  if (selectedScope.isEmpty())   return null;
  List<VirtualFile> files=new ArrayList<VirtualFile>();
  final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(myProject).getFileIndex();
  for (  PsiFile psiFile : selectedScope) {
    final VirtualFile file=psiFile.getVirtualFile();
    LOG.assertTrue(file != null);
    if (fileIndex.isInContent(file)) {
      files.add(file);
    }
  }
  if (!files.isEmpty()) {
    return new AnalysisScope(myProject,files);
  }
  return null;
}
