{
  Object oldState=storageData.myStates.get(componentName);
  if (newState == null || JDOMUtil.isEmpty(newState)) {
    if (oldState == null) {
      return null;
    }
    StorageData newStorageData=storageData.clone();
    newStorageData.myStates.remove(componentName);
    return newStorageData;
  }
  prepareElement(newState);
  newLiveStates.put(componentName,newState);
  byte[] newBytes=null;
  if (oldState instanceof Element) {
    if (JDOMUtil.areElementsEqual((Element)oldState,newState)) {
      return null;
    }
  }
 else   if (oldState != null) {
    newBytes=getNewByteIfDiffers(componentName,newState,(byte[])oldState);
    if (newBytes == null) {
      return null;
    }
  }
  StorageData newStorageData=storageData.clone();
  newStorageData.myStates.put(componentName,newBytes == null ? newState : newBytes);
  return newStorageData;
}
