{
  if (lastParent == null)   return true;
  if (processor instanceof ResolverProcessor)   ((ResolverProcessor)processor).setCurrentFileResolveContext(this);
  try {
    if (!super.processDeclarations(processor,state,lastParent,place))     return false;
    for (    final PsiParameter parameter : getAllParameters()) {
      if (!ResolveUtil.processElement(processor,parameter))       return false;
    }
    if (processor instanceof PropertyResolverProcessor && OWNER_NAME.equals(((PropertyResolverProcessor)processor).getName())) {
      processor.handleEvent(ResolveUtil.DECLARATION_SCOPE_PASSED,this);
    }
    if (!ResolveUtil.processElement(processor,getOwner()))     return false;
    final PsiClass closureClass=JavaPsiFacade.getInstance(getProject()).findClass(GROOVY_LANG_CLOSURE,getResolveScope());
    if (closureClass != null) {
      if (!closureClass.processDeclarations(processor,state,lastParent,place))       return false;
      PsiType clType=JavaPsiFacade.getInstance(getProject()).getElementFactory().createType(closureClass,PsiSubstitutor.EMPTY);
      if (!ResolveUtil.processNonCodeMethods(clType,processor,getProject(),place,true))       return false;
    }
    return true;
  }
  finally {
    if (processor instanceof ResolverProcessor)     ((ResolverProcessor)processor).setCurrentFileResolveContext(null);
  }
}
