{
  int offsetR=offset;
  if (last != null) {
    offsetR-=last.getStartOffset() - scopeNode.getStartOffset() + last.getTextLength();
    while (offsetR >= 0) {
      TreeElement next=last.getTreeNext();
      if (next == null) {
        last=last.getTreeParent();
        continue;
      }
      int length=next.getTextLength();
      offsetR-=length;
      last=next;
    }
    scopeNode=last;
    offsetR+=scopeNode.getTextLength();
  }
  return (LeafElement)scopeNode.findLeafElementAt(offsetR);
}
