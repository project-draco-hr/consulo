{
  final LibraryTable table=library.getTable();
  if (table != null) {
    final LibraryProjectStructureElement libraryElement=new LibraryProjectStructureElement(myContext,library);
    final Collection<ProjectStructureElementUsage> usages=new ArrayList<ProjectStructureElementUsage>(myContext.getDaemonAnalyzer().getUsages(libraryElement));
    if (usages.size() > 0) {
      final MultiMap<String,ProjectStructureElementUsage> containerType2Usage=new MultiMap<String,ProjectStructureElementUsage>();
      for (      final ProjectStructureElementUsage usage : usages) {
        containerType2Usage.putValue(usage.getContainingElement().getTypeName(),usage);
      }
      List<String> types=new ArrayList<String>(containerType2Usage.keySet());
      Collections.sort(types);
      final StringBuilder sb=new StringBuilder("Library '");
      Library libraryModel=myContext.getLibraryModel(library);
      sb.append(libraryModel != null ? libraryModel.getName() : library.getName()).append("' is used in ");
      for (int i=0; i < types.size(); i++) {
        if (i > 0 && i == types.size() - 1) {
          sb.append(" and in ");
        }
 else         if (i > 0) {
          sb.append(", in ");
        }
        String type=types.get(i);
        Collection<ProjectStructureElementUsage> usagesOfType=containerType2Usage.get(type);
        if (usagesOfType.size() > 1) {
          sb.append(usagesOfType.size()).append(" ").append(StringUtil.decapitalize(StringUtil.pluralize(type)));
        }
 else {
          sb.append(StringUtil.decapitalize(usagesOfType.iterator().next().getContainingElement().getPresentableName()));
        }
      }
      sb.append(".\n\nAre you sure you want to delete this library?");
      if (DialogWrapper.OK_EXIT_CODE == Messages.showOkCancelDialog(myProject,sb.toString(),"Delete Library",Messages.getQuestionIcon())) {
        for (        final ProjectStructureElementUsage usage : usages) {
          usage.removeSourceElement();
        }
        getModelProvider().getModifiableModel().removeLibrary(library);
        myContext.getDaemonAnalyzer().removeElement(libraryElement);
        return true;
      }
    }
 else {
      getModelProvider().getModifiableModel().removeLibrary(library);
      myContext.getDaemonAnalyzer().removeElement(libraryElement);
      return true;
    }
  }
  return false;
}
