{
  final JarFile jarFile1;
  final JarFile jarFile2;
  try {
    jarFile1=new JarFile(file1);
    jarFile2=new JarFile(file2);
  }
 catch (  IOException e) {
    String textAfter=FileUtil.loadFile(file1);
    String textBefore=FileUtil.loadFile(file2);
    textAfter=StringUtil.convertLineSeparators(textAfter);
    textBefore=StringUtil.convertLineSeparators(textBefore);
    Assert.assertEquals(file1.getPath(),textAfter,textBefore);
    return;
  }
  final File tempDirectory1=PlatformTestCase.createTempDir("tmp1");
  final File tempDirectory2=PlatformTestCase.createTempDir("tmp2");
  ZipUtil.extract(jarFile1,tempDirectory1,CVS_FILE_FILTER);
  ZipUtil.extract(jarFile2,tempDirectory2,CVS_FILE_FILTER);
  jarFile1.close();
  jarFile2.close();
  final VirtualFile dirAfter=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(tempDirectory1);
  final VirtualFile dirBefore=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(tempDirectory2);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      dirAfter.refresh(false,true);
      dirBefore.refresh(false,true);
    }
  }
);
  assertDirectoriesEqual(dirAfter,dirBefore,CVS_FILE_FILTER);
}
