{
  final GroovySDKComboBox.DefaultGroovySDKComboBoxItem selectedItem=(GroovySDKComboBox.DefaultGroovySDKComboBoxItem)myComboBox.getSelectedItem();
  final Module module=myEditorContext.getModule();
  if (module != null) {
    if (selectedItem != null) {
      final GroovySDK sdk=selectedItem.getGroovySDK();
      if (sdk != null && Arrays.asList(GroovyConfigUtils.getInstance().getSDKLibrariesByModule(module)).contains(sdk.getLibrary())) {
        return;
      }
    }
    final Project project=module.getProject();
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      public void run(){
        GroovySDK sdk=null;
        if (selectedItem instanceof GroovySDKComboBox.GroovySDKPointerItem) {
          GroovySDKComboBox.GroovySDKPointerItem pointerItem=(GroovySDKComboBox.GroovySDKPointerItem)selectedItem;
          final GroovySDKPointer pointer=pointerItem.getPointer();
          String name=pointerItem.getName();
          String path=pointerItem.getPath();
          Library library=GroovyConfigUtils.getInstance().createSDKLibrary(path,name,project,true,pointer.isProjectLib());
          if (library != null) {
            sdk=new GroovySDK(library,myModule,pointer.isProjectLib());
          }
        }
 else {
          sdk=selectedItem.getGroovySDK();
        }
        GroovyConfigUtils.getInstance().updateSDKLibInModule(module,sdk);
        for (int i=0; i < myComboBox.getItemCount(); i++) {
          Object item=myComboBox.getItemAt(i);
          if (item != selectedItem && item instanceof GroovySDKComboBox.GroovySDKPointerItem) {
            GroovySDKComboBox.GroovySDKPointerItem pointerItem=(GroovySDKComboBox.GroovySDKPointerItem)item;
            final GroovySDKPointer pointer=pointerItem.getPointer();
            String name=pointerItem.getName();
            String path=pointerItem.getPath();
            GroovyConfigUtils.getInstance().createSDKLibrary(path,name,project,true,pointer.isProjectLib());
          }
        }
      }
    }
);
  }
}
