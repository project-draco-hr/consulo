{
  final StringBuilder buf=new StringBuilder();
  String def=defaultPath != null && wizardContext.isCreatingNewProject() ? CreateFromSourcesMode.class.getSimpleName() : PropertiesComponent.getInstance().getValue(LAST_PROJECT_CREATION_MODE,CreateFromScratchMode.class.getSimpleName());
  for (  WizardMode mode : Extensions.getExtensions(WizardMode.MODES)) {
    if (mode.isAvailable(wizardContext)) {
      myModes.add(mode);
      if (mode.getClass().getSimpleName().equals(def)) {
        myMode=mode;
      }
    }
    final String footnote=mode.getFootnote(wizardContext);
    if (footnote != null) {
      if (buf.length() > 0)       buf.append("<br>");
      buf.append(footnote);
    }
  }
  if (myMode == null) {
    myMode=myModes.get(0);
  }
  myWizardContext=wizardContext;
  myWholePanel=new JPanel(new GridBagLayout());
  final Insets insets=new Insets(0,0,0,5);
  GridBagConstraints gc=new GridBagConstraints(0,GridBagConstraints.RELATIVE,1,1,1,0,GridBagConstraints.NORTHWEST,GridBagConstraints.HORIZONTAL,insets,0,0);
  final ButtonGroup group=new ButtonGroup();
  for (  final WizardMode mode : myModes) {
    insets.top=15;
    insets.left=5;
    final JRadioButton rb=new JRadioButton(mode.getDisplayName(wizardContext),mode == myMode);
    rb.setFont(UIUtil.getLabelFont().deriveFont(Font.BOLD));
    rb.addActionListener(new ActionListener(){
      public void actionPerformed(      final ActionEvent e){
        setMode(mode);
      }
    }
);
    new ClickListener(){
      @Override public boolean onClick(      MouseEvent event,      int clickCount){
        if (mode.getAdditionalSettings(wizardContext) == null) {
          wizardContext.requestNextStep();
          return true;
        }
 else {
          return false;
        }
      }
    }
.installOn(rb);
    myWholePanel.add(rb,gc);
    group.add(rb);
    insets.top=5;
    insets.left=20;
    final JLabel description=new JLabel(mode.getDescription(wizardContext));
    myWholePanel.add(description,gc);
    final JComponent settings=mode.getAdditionalSettings(wizardContext);
    if (settings != null) {
      myWholePanel.add(settings,gc);
    }
  }
  myMode.onChosen(true);
  gc.weighty=1;
  gc.fill=GridBagConstraints.BOTH;
  myWholePanel.add(Box.createVerticalBox(),gc);
  final JLabel note=new JLabel("<html>" + buf.toString() + "</html>",AllIcons.Nodes.WarningIntroduction,SwingConstants.LEFT);
  note.setVisible(buf.length() > 0);
  gc.weighty=0;
  gc.fill=GridBagConstraints.HORIZONTAL;
  gc.insets.bottom=5;
  myWholePanel.add(note,gc);
  if (Registry.is("new.project.wizard")) {
    myPanelWithDescription=new JPanel(new BorderLayout());
    myPanelWithDescription.add(createDescription(),BorderLayout.NORTH);
    myPanelWithDescription.add(myWholePanel,BorderLayout.CENTER);
  }
}
