{
  if (range.getType() == Range.MODIFIED)   return range;
  if (range.getType() == Range.INSERTED || range.getType() == Range.DELETED) {
    boolean canExpandBefore=range.getLine1() != 0 && range.getVcsLine1() != 0;
    boolean canExpandAfter=range.getLine2() < document.getLineCount() && range.getVcsLine2() < uDocument.getLineCount();
    int offset1=range.getLine1() - (canExpandBefore ? 1 : 0);
    int uOffset1=range.getVcsLine1() - (canExpandBefore ? 1 : 0);
    int offset2=range.getLine2() + (canExpandAfter ? 1 : 0);
    int uOffset2=range.getVcsLine2() + (canExpandAfter ? 1 : 0);
    return new Range(offset1,offset2,uOffset1,uOffset2,range.getType());
  }
  throw new IllegalArgumentException("Unknown range type: " + range.getType());
}
