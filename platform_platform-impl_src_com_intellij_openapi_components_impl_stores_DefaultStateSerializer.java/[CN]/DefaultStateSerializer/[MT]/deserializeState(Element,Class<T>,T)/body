{
  if (stateElement == null)   return mergeInto;
  if (stateClass.equals(Element.class)) {
    return (T)stateElement;
  }
 else   if (JDOMExternalizable.class.isAssignableFrom(stateClass)) {
    if (mergeInto != null) {
      try {
        String elementText=JDOMUtil.writeElement(stateElement,"\n");
        LOG.error("State is " + stateClass.getName() + ", merge into is "+ mergeInto.toString()+ ", state element text is "+ elementText);
      }
 catch (      IOException e) {
        LOG.error(e);
      }
    }
    try {
      final T t=stateClass.newInstance();
      try {
        ((JDOMExternalizable)t).readExternal(stateElement);
        return t;
      }
 catch (      InvalidDataException e) {
        throw new StateStorage.StateStorageException(e);
      }
    }
 catch (    InstantiationException e) {
      throw new StateStorage.StateStorageException(e);
    }
catch (    IllegalAccessException e) {
      throw new StateStorage.StateStorageException(e);
    }
  }
 else {
    if (mergeInto == null) {
      return XmlSerializer.deserialize(stateElement,stateClass);
    }
 else {
      XmlSerializer.deserializeInto(mergeInto,stateElement);
      return mergeInto;
    }
  }
}
