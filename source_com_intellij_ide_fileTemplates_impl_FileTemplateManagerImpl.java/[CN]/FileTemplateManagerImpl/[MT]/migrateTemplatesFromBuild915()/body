{
  if (myInternalTemplatesManager != null) {
    userWasAsked=false;
    shouldConvert=false;
    wasConverted=false;
    myInternalTemplatesManager.migrateTemplatesFromBuild915();
    myCodeTemplatesManager.migrateTemplatesFromBuild915();
    if (wasConverted) {
      saveAll();
    }
  }
 else {
    final FileTemplate[] templates=getAllTemplates();
    for (int i=0; i < templates.length; i++) {
      FileTemplate template=templates[i];
      final String name=template.getName();
      final String extension=template.getExtension();
      final String newName=old2NewNames.get(name);
      if (newName != null && !template.isDefault() && getDefaultTemplate(newName,extension) != null) {
        if (!userWasAsked) {
          final int ret=Messages.showOkCancelDialog("Convert file templates to the new format?","Old File Templates Found",Messages.getQuestionIcon());
          userWasAsked=true;
          shouldConvert=ret == 0;
        }
        if (shouldConvert) {
          final FileTemplate defaultTemplate=myTemplates.findByName(newName);
          if (defaultTemplate != null) {
            myTemplates.removeTemplate(defaultTemplate);
          }
          template.getText();
          template.setName(newName);
          wasConverted=true;
        }
      }
    }
  }
}
