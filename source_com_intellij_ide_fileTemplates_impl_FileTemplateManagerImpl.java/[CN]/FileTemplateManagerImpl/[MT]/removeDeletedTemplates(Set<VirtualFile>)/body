{
  boolean aspectsEnabled=ApplicationManagerEx.getApplicationEx().isAspectJSupportEnabled();
  Set<VirtualFile> removedSet=new HashSet<VirtualFile>();
  for (Iterator<VirtualFile> iterator=files.iterator(); iterator.hasNext(); ) {
    VirtualFile file=iterator.next();
    String nameWithExtension=file.getName();
    if (!aspectsEnabled && isAspectTemplate(file) || myDeletedTemplatesManager.contains(nameWithExtension)) {
      removedSet.add(file);
    }
  }
  files.removeAll(removedSet);
}
