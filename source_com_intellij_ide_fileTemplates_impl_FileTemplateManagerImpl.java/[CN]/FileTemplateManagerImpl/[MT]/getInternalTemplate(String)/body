{
  LOG.assertTrue(myInternalTemplatesManager != null);
  String actualTemplateName=ApplicationManager.getApplication().isUnitTestMode() ? templateName + "ForTest" : templateName;
  FileTemplateImpl template=(FileTemplateImpl)myInternalTemplatesManager.getTemplate(actualTemplateName);
  if (template == null) {
    template=(FileTemplateImpl)getTemplate(actualTemplateName);
  }
  if (template == null) {
    template=(FileTemplateImpl)getJ2eeTemplate(actualTemplateName);
    if (template != null) {
      template.setAdjust(true);
    }
 else {
      String text;
      if (!ApplicationManager.getApplication().isUnitTestMode()) {
        text=getDefaultClassTemplateText(templateName);
      }
 else {
        text=getTestClassTemplateText(templateName);
      }
      text=StringUtil.convertLineSeparators(text);
      text=StringUtil.replace(text,"$NAME$","${NAME}");
      text=StringUtil.replace(text,"$PACKAGE_NAME$","${PACKAGE_NAME}");
      text=StringUtil.replace(text,"$DATE$","${DATE}");
      text=StringUtil.replace(text,"$TIME$","${TIME}");
      text=StringUtil.replace(text,"$USER$","${USER}");
      template=(FileTemplateImpl)myInternalTemplatesManager.addTemplate(actualTemplateName,"java");
      template.setText(text);
    }
  }
  template.setInternal(true);
  return template;
}
