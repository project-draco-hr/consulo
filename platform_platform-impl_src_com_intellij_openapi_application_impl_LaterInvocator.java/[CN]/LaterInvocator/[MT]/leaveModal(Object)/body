{
  LOG.assertTrue(isDispatchThread(),"leaveModal() should be invoked in event-dispatch thread");
  if (LOG.isDebugEnabled()) {
    LOG.debug("leaveModal:" + modalEntity);
  }
  ourModalityStateMulticaster.getMulticaster().beforeModalityStateChanged(false);
  int index=ourModalEntities.indexOf(modalEntity);
  LOG.assertTrue(index >= 0);
  ourModalEntities.remove(index);
  ourModalityStack.remove(index + 1);
  for (int i=1; i < ourModalityStack.size(); i++) {
    ((ModalityStateEx)ourModalityStack.get(i)).removeModality(modalEntity);
  }
  ourQueueSkipCount=0;
  requestFlush();
}
