{
  LOG.assertTrue(isDispatchThread(),"enterModal() should be invoked in event-dispatch thread");
  if (LOG.isDebugEnabled()) {
    LOG.debug("enterModal:" + modalEntity);
  }
  ourModalityStateMulticaster.getMulticaster().beforeModalityStateChanged(true);
  ourModalEntities.add(modalEntity);
  ourModalityStack.push(new ModalityStateEx(ArrayUtil.toObjectArray(ourModalEntities)));
  TransactionGuardImpl guard=IdeaApplication.isLoaded() ? (TransactionGuardImpl)TransactionGuard.getInstance() : null;
  if (guard != null) {
    guard.enteredModality(ourModalityStack.peek());
  }
}
