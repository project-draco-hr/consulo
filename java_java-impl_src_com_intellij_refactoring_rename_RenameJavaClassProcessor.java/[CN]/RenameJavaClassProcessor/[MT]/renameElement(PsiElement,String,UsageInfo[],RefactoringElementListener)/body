{
  PsiClass aClass=(PsiClass)element;
  ArrayList<UsageInfo> postponedCollisions=new ArrayList<UsageInfo>();
  List<MemberHidesOuterMemberUsageInfo> hidesOut=new ArrayList<MemberHidesOuterMemberUsageInfo>();
  for (  final UsageInfo usage : usages) {
    if (usage instanceof ResolvableCollisionUsageInfo) {
      if (usage instanceof CollidingClassImportUsageInfo) {
        ((CollidingClassImportUsageInfo)usage).getImportStatement().delete();
      }
 else       if (usage instanceof MemberHidesOuterMemberUsageInfo) {
        hidesOut.add((MemberHidesOuterMemberUsageInfo)usage);
      }
 else {
        postponedCollisions.add(usage);
      }
    }
  }
  ChangeContextUtil.encodeContextInfo(aClass,true,false);
  aClass.setName(newName);
  for (  UsageInfo usage : usages) {
    if (!(usage instanceof ResolvableCollisionUsageInfo)) {
      final PsiReference ref=usage.getReference();
      if (ref == null)       continue;
      try {
        ref.bindToElement(aClass);
      }
 catch (      IncorrectOperationException e) {
        ref.handleElementRename(newName);
      }
    }
  }
  ChangeContextUtil.decodeContextInfo(aClass,null,null);
  for (  UsageInfo postponedCollision : postponedCollisions) {
    ClassHidesImportedClassUsageInfo collision=(ClassHidesImportedClassUsageInfo)postponedCollision;
    collision.resolveCollision();
  }
  for (  MemberHidesOuterMemberUsageInfo usage : hidesOut) {
    PsiJavaCodeReferenceElement collidingRef=(PsiJavaCodeReferenceElement)usage.getElement();
  }
  listener.elementRenamed(aClass);
}
