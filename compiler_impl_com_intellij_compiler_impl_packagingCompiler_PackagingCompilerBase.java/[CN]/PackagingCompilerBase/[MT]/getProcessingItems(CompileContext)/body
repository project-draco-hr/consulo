{
  return new ReadAction<ProcessingItem[]>(){
    protected void run(    final Result<ProcessingItem[]> result){
      final boolean shouldStartBuild=doNotStartBuild(context);
      if (shouldStartBuild) {
        result.setResult(ProcessingItem.EMPTY_ARRAY);
        return;
      }
      C builderContext=createContext(context);
      context.putUserData(myBuilderContextKey,builderContext);
      PackagingProcessingItem[] allProcessingItems=collectItems(builderContext);
      if (LOG.isDebugEnabled()) {
        int num=Math.min(100,allProcessingItems.length);
        LOG.debug("All files (" + num + " of "+ allProcessingItems.length+ "):");
        for (int i=0; i < num; i++) {
          LOG.debug(allProcessingItems[i].getFile().getPath());
        }
      }
      boolean hasFilesToDelete=collectFilesToDelete(context,builderContext.getProcessingItems());
      if (hasFilesToDelete) {
        MockProcessingItem mockItem=new MockProcessingItem(new LightVirtualFile("239239293"));
        result.setResult(ArrayUtil.append(allProcessingItems,mockItem,ProcessingItem.class));
      }
 else {
        result.setResult(allProcessingItems);
      }
    }
  }
.execute().getResultObject();
}
