{
  boolean hasFolding=false;
  FoldRegion[] regions=new FoldRegion[myCount];
  boolean hasExpanded=false;
  for (int i=0; i < myCount; i++) {
    if (ends[i] - starts[i] < 2)     continue;
    regions[i]=addFolding(myEditors[i],starts[i],ends[i],expanded);
    hasFolding|=regions[i] != null;
    hasExpanded|=regions[i] != null && regions[i].isExpanded();
  }
  if (hasExpanded && !expanded) {
    for (    FoldRegion region : regions) {
      if (region != null)       region.setExpanded(true);
    }
  }
  return hasFolding ? new FoldedBlock(regions) : null;
}
