{
  TaskManager manager=TaskManager.getManager(getProject());
  SwitchTaskCombo combo=new SwitchTaskCombo();
  LocalTask defaultTask=manager.getActiveTask();
  assertTrue(defaultTask.isDefault());
  assertEquals(defaultTask.getCreated(),defaultTask.getUpdated());
  Presentation presentation=doTest(combo);
  assertFalse(presentation.isVisible());
  try {
    TaskSettings.getInstance().ALWAYS_DISPLAY_COMBO=true;
    presentation=doTest(combo);
    assertTrue(presentation.isVisible());
  }
  finally {
    TaskSettings.getInstance().ALWAYS_DISPLAY_COMBO=false;
  }
  LocalTask task=manager.createLocalTask("test");
  manager.activateTask(task,false,false);
  presentation=doTest(combo);
  assertTrue(presentation.isVisible());
  manager.activateTask(defaultTask,false,false);
  task=manager.getActiveTask();
  assertTrue(task.isDefault());
  presentation=doTest(combo);
  if (!presentation.isVisible()) {
    LocalTask activeTask=manager.getActiveTask();
    System.out.println(activeTask);
    System.out.println(activeTask.getCreated());
    System.out.println(activeTask.getUpdated());
    fail();
  }
}
