{
  Stack<ASTNode> customFoldingNodesStack=new Stack<ASTNode>(1);
  for (ASTNode child=node.getFirstChildNode(); child != null; child=child.getTreeNext()) {
    if (isCustomRegionStart(child)) {
      customFoldingNodesStack.push(child);
    }
 else     if (isCustomRegionEnd(child)) {
      if (!customFoldingNodesStack.isEmpty()) {
        ASTNode startNode=customFoldingNodesStack.pop();
        int startOffset=startNode.getTextRange().getStartOffset();
        TextRange range=new TextRange(startOffset,child.getTextRange().getEndOffset());
        descriptors.add(new FoldingDescriptor(node,range));
      }
    }
 else {
      addCustomFoldingRegionsRecursively(child,descriptors);
    }
  }
}
