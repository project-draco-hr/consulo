{
  if (!hasNext()) {
    throw new NoSuchElementException();
  }
  BidiRun run=myRuns[myRunIndex];
  if (myRunIndex == 0 && myChunkIndex == 0 && myFragmentIndex == 0) {
    myFragment.startLogicalColumn+=(run.isRtl() ? run.endOffset : run.startOffset) - myFragment.startOffset;
  }
 else {
    myFragment.startLogicalColumn=myFragment.getEndLogicalColumn();
    if (myChunkIndex == 0 && myFragmentIndex == 0) {
      myFragment.startLogicalColumn+=(run.isRtl() ? run.endOffset : run.startOffset) - myFragment.getEndOffset();
    }
    myFragment.startVisualColumn=myFragment.getEndVisualColumn();
    myFragment.startX=myFragment.getEndX();
  }
  myFragment.isRtl=run.isRtl();
  Chunk[] chunks=run.getChunks();
  Chunk chunk=chunks[run.isRtl() ? chunks.length - 1 - myChunkIndex : myChunkIndex];
  myFragment.delegate=chunk.fragments.get(run.isRtl() ? chunk.fragments.size() - 1 - myFragmentIndex : myFragmentIndex);
  myFragment.startOffset=run.isRtl() ? run.endOffset - myOffsetInsideRun : run.startOffset + myOffsetInsideRun;
  myOffsetInsideRun+=myFragment.getLength();
  myFragmentIndex++;
  if (myFragmentIndex >= chunk.fragments.size()) {
    myFragmentIndex=0;
    myChunkIndex++;
    if (myChunkIndex >= chunks.length) {
      myChunkIndex=0;
      myOffsetInsideRun=0;
      myRunIndex++;
    }
  }
  return myFragment;
}
