{
  if (!hasNext()) {
    throw new NoSuchElementException();
  }
  BidiRun run=myRuns[myRunIndex];
  if (myRunIndex == 0 && myFragmentIndex == 0) {
    myFragment.startLogicalColumn+=(run.isRtl() ? run.endOffset : run.startOffset) - myFragment.startOffset;
  }
 else {
    myFragment.startLogicalColumn=myFragment.getEndLogicalColumn();
    if (myFragmentIndex == 0) {
      myFragment.startLogicalColumn+=(run.isRtl() ? run.endOffset : run.startOffset) - myFragment.getEndOffset();
    }
    myFragment.startVisualColumn=myFragment.getEndVisualColumn();
    myFragment.startX=myFragment.getEndX();
  }
  myFragment.isRtl=run.isRtl();
  myFragment.delegate=run.fragments.get(run.isRtl() ? run.fragments.size() - 1 - myFragmentIndex : myFragmentIndex);
  myFragment.startOffset=run.isRtl() ? run.endOffset - myOffsetInsideRun : run.startOffset + myOffsetInsideRun;
  myOffsetInsideRun+=myFragment.getLength();
  myFragmentIndex++;
  if (myFragmentIndex >= run.fragments.size()) {
    myFragmentIndex=0;
    myOffsetInsideRun=0;
    myRunIndex++;
  }
  return myFragment;
}
