{
  EncodingProjectManager.getInstance(getProject()).setEncoding(null,CharsetToolkit.UTF8_CHARSET);
  EncodingProjectManager.getInstance(ProjectManager.getInstance().getDefaultProject()).setEncoding(null,CharsetToolkit.UTF8_CHARSET);
  PostprocessReformattingAspect.getInstance(ourProject).doPostponedFormatting();
  deleteVFile();
  myVFile=getSourceRoot().createChildData(null,fileName);
  VfsUtil.saveText(myVFile,fileText);
  final FileDocumentManager manager=FileDocumentManager.getInstance();
  final Document document=manager.getDocument(myVFile);
  assertNotNull("Can't create document for '" + fileName + "'",document);
  manager.reloadFromDisk(document);
  document.insertString(0," ");
  document.deleteString(0,1);
  myFile=getPsiManager().findFile(myVFile);
  assertNotNull("Can't create PsiFile for '" + fileName + "'. Unknown file type most probably.",myFile);
  assertTrue(myFile.isPhysical());
  myEditor=createEditor(myVFile);
  myVFile.setCharset(CharsetToolkit.UTF8_CHARSET);
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
}
