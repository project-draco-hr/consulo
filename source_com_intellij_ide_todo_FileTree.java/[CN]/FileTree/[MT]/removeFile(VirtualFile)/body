{
  if (!myFiles.contains(file)) {
    return;
  }
  myFiles.remove(file);
  ArrayList<VirtualFile> dirsToBeRemoved=null;
  for (Iterator<VirtualFile> i=myDirectory2Children.keySet().iterator(); i.hasNext(); ) {
    VirtualFile _directory=i.next();
    ArrayList<VirtualFile> children=myDirectory2Children.get(_directory);
    LOG.assertTrue(children != null);
    if (children.contains(file)) {
      children.remove(file);
      if (children.size() == 0) {
        if (dirsToBeRemoved == null) {
          dirsToBeRemoved=new ArrayList<VirtualFile>(2);
        }
        dirsToBeRemoved.add(_directory);
      }
    }
  }
  for (  VirtualFile dir : myStrictDirectory2Children.keySet()) {
    final ArrayList<VirtualFile> children=myStrictDirectory2Children.get(dir);
    LOG.assertTrue(children != null);
    if (children.contains(file)) {
      children.remove(file);
    }
  }
  if (dirsToBeRemoved != null) {
    LOG.assertTrue(dirsToBeRemoved.size() > 0);
    for (int i=0; i < dirsToBeRemoved.size(); i++) {
      removeDir(dirsToBeRemoved.get(i));
    }
  }
}
