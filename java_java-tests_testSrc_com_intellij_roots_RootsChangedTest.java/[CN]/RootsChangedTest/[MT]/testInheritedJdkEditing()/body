{
  final Module moduleA=createModule("a.iml");
  final Module moduleB=createModule("b.iml");
  assertEventsCount(2);
  final Sdk jdk=JavaSdkImpl.getMockJdk17("AAA");
  ProjectJdkTable.getInstance().addJdk(jdk);
  assertEventsCount(0);
  final Sdk jdkBBB=JavaSdkImpl.getMockJdk17("BBB");
  ProjectJdkTable.getInstance().addJdk(jdk);
  assertEventsCount(0);
  ProjectRootManager.getInstance(myProject).setProjectSdk(jdkBBB);
  assertEventsCount(0);
  final ModifiableRootModel rootModelA=ModuleRootManager.getInstance(moduleA).getModifiableModel();
  final ModifiableRootModel rootModelB=ModuleRootManager.getInstance(moduleB).getModifiableModel();
  rootModelA.inheritSdk();
  rootModelB.inheritSdk();
  ProjectRootManager.getInstance(myProject).multiCommit(new ModifiableRootModel[]{rootModelA,rootModelB});
  assertEventsCount(1);
  ProjectRootManager.getInstance(myProject).setProjectSdk(jdk);
  assertEventsCount(1);
  final SdkModificator sdkModificator=jdk.getSdkModificator();
  sdkModificator.addRoot(getVirtualFile(createTempDirectory()),OrderRootType.CLASSES);
  sdkModificator.commitChanges();
  assertEventsCount(1);
  ProjectJdkTable.getInstance().removeJdk(jdk);
  assertEventsCount(1);
}
