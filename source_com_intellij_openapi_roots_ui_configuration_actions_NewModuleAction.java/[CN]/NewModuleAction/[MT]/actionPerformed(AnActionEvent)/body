{
  final Project project=getProject(e);
  if (project == null) {
    return;
  }
  final AddModuleWizard wizard=new AddModuleWizard(project,new DefaultModulesProvider(project),null);
  wizard.show();
  if (wizard.isOK()) {
    final ModuleBuilder moduleBuilder=wizard.getModuleBuilder();
    Exception ex=ApplicationManager.getApplication().runWriteAction(new Computable<Exception>(){
      @Nullable public Exception compute(){
        try {
          final ModifiableModuleModel moduleModel=ModuleManager.getInstance(project).getModifiableModel();
          moduleBuilder.createAndCommit(moduleModel,false);
          return null;
        }
 catch (        Exception e) {
          return e;
        }
      }
    }
);
    if (ex != null) {
      Messages.showErrorDialog(ProjectBundle.message("module.new.error.message",ex.getMessage()),ProjectBundle.message("module.new.error.title"));
    }
  }
}
