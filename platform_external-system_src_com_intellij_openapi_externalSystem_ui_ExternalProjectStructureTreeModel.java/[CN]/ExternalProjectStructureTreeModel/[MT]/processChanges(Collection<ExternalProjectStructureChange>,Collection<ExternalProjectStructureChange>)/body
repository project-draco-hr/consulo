{
  final Runnable task=new Runnable(){
    @Override public void run(){
      Collection<ExternalProjectStructureChange> obsoleteChangesToUse=ContainerUtil.subtract(oldChanges,currentChanges);
      Collection<ExternalProjectStructureChange> currentChangesToUse=ContainerUtil.subtract(currentChanges,oldChanges);
      if (myChangesComparator != null) {
        obsoleteChangesToUse=sort(obsoleteChangesToUse,myChangesComparator);
        currentChangesToUse=sort(currentChangesToUse,myChangesComparator);
      }
      processObsoleteChanges(obsoleteChangesToUse);
      processCurrentChanges(currentChangesToUse);
    }
  }
;
  if (myProcessChangesAtTheSameThread) {
    task.run();
  }
 else {
    UIUtil.invokeLaterIfNeeded(task);
  }
}
