{
  final boolean isOpenInNewTabEnabled;
  final boolean[] toOpenInNewTab=new boolean[1];
  Content selectedContent=UsageViewManager.getInstance(myProject).getSelectedContent(true);
  if (selectedContent != null && selectedContent.isPinned()) {
    toOpenInNewTab[0]=true;
    isOpenInNewTabEnabled=false;
  }
 else {
    toOpenInNewTab[0]=myToOpenInNewTab;
    isOpenInNewTabEnabled=UsageViewManager.getInstance(myProject).getReusableContentsCount() > 0;
  }
  final FindManager findManager=FindManager.getInstance(myProject);
  final FindModel findModel=(FindModel)findManager.getFindInProjectModel().clone();
  findModel.setReplaceState(false);
  findModel.setOpenInNewTabVisible(true);
  findModel.setOpenInNewTabEnabled(isOpenInNewTabEnabled);
  findModel.setOpenInNewTab(toOpenInNewTab[0]);
  FindInProjectUtil.setDirectoryName(findModel,dataContext);
  Editor editor=CommonDataKeys.EDITOR.getData(dataContext);
  FindUtil.initStringToFindWithSelection(findModel,editor);
  findManager.showFindDialog(findModel,new Runnable(){
    @Override public void run(){
      findModel.setOpenInNewTabVisible(false);
      if (isOpenInNewTabEnabled) {
        myToOpenInNewTab=toOpenInNewTab[0]=findModel.isOpenInNewTab();
      }
      startFindInProject(findModel);
    }
  }
);
  findModel.setOpenInNewTabVisible(false);
}
