{
  if (!ApplicationManagerEx.getApplicationEx().isInternal() && !ourDumpChangedComponentStates)   return;
  try {
    File logDirectory=createLogDirectory();
    logDirectory.mkdirs();
    for (    String componentName : componentNames) {
      for (      Pair<VirtualFile,StateStorage> pair : changedFiles) {
        StateStorage storage=pair.second;
        if ((storage instanceof XmlElementStorage)) {
          Element state=((XmlElementStorage)storage).getState(componentName);
          if (state != null) {
            File logFile=new File(logDirectory,"prev_" + componentName + ".xml");
            FileUtil.writeToFile(logFile,JDOMUtil.writeElement(state,"\n").getBytes());
          }
        }
      }
    }
    for (    Pair<VirtualFile,StateStorage> changedFile : changedFiles) {
      File logFile=new File(logDirectory,"new_" + changedFile.first.getName());
      FileUtil.copy(new File(changedFile.first.getPath()),logFile);
    }
  }
 catch (  Throwable e) {
    LOG.info(e);
  }
}
