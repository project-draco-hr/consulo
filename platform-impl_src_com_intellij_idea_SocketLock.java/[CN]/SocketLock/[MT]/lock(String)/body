{
  if (LOG.isDebugEnabled()) {
    LOG.debug("enter: lock(path='" + path + "')");
  }
  acquireSocket();
  if (mySocket == null) {
    if (!myIsDialogShown) {
      final String productName=ApplicationNamesInfo.getInstance().getProductName();
      if (MainImpl.isHeadless()) {
        throw new RuntimeException("Only one instance of " + productName + " can be run at a time.");
      }
      @NonNls final String pathToLogFile=PathManager.getSystemPath() + "/log/idea.log file".replace('/',File.separatorChar);
      JOptionPane.showMessageDialog(JOptionPane.getRootFrame(),CommonBundle.message("cannot.start.other.instance.is.running.error.message",productName,pathToLogFile),CommonBundle.message("title.warning"),JOptionPane.WARNING_MESSAGE);
      myIsDialogShown=true;
    }
    return true;
  }
  for (int i=SOCKET_NUMBER_START; i < SOCKET_NUMBER_END; i++) {
    if (isPortForbidden(i) || i == mySocket.getLocalPort())     continue;
    List lockedList=readLockedList(i);
    if (lockedList.contains(path))     return false;
  }
  myLockedPaths.add(path);
  return true;
}
