{
  g.setColor(Color.GRAY);
  int y=r.y;
  if (myDrawBottom) {
    LogicalPosition logical=editor.xyToLogicalPosition(new Point(0,y));
    Document document=editor.getDocument();
    if (logical.line + 1 >= document.getLineCount()) {
      y=editor.visualPositionToXY(editor.offsetToVisualPosition(document.getTextLength())).y;
    }
 else {
      y=editor.logicalPositionToXY(new LogicalPosition(logical.line + 1,0)).y;
    }
  }
  y--;
  UIUtil.drawLine(g,0,y,((EditorEx)editor).getGutterComponentEx().getWidth(),y);
}
