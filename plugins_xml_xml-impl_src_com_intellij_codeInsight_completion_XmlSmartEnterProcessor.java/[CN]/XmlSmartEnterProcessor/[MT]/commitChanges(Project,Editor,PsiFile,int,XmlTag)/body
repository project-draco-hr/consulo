{
  if (isUncommited(project)) {
    commit(editor);
    if (tagToReformat == null) {
      tagToReformat=PsiTreeUtil.getParentOfType(getStatementAtCaret(editor,psiFile),XmlTag.class);
    }
    editor.getCaretModel().moveToOffset(caretOffset);
  }
  if (tagToReformat != null) {
    reformat(tagToReformat);
  }
  commit(editor);
}
