{
  VirtualFile dotIdea=projectDir.findChild(".idea");
  VirtualFile modulesXml=dotIdea.findChild("modules.xml");
  StorageData storageData=loadStorageFile(project,modulesXml);
  final Element moduleManagerState=storageData.getState("ProjectModuleManager");
  if (moduleManagerState == null) {
    throw new JDOMException("cannot find ProjectModuleManager state in modules.xml");
  }
  final CoreModuleManager moduleManager=(CoreModuleManager)ModuleManager.getInstance(project);
  moduleManager.loadState(moduleManagerState);
  moduleManager.loadModules();
}
