{
  if (myInSmartUpdate) {
    for (    RangeHighlighter highlighter : myHighlighters) {
      if (highlighter.getStartOffset() == textRange.getStartOffset() && highlighter.getEndOffset() == textRange.getEndOffset()) {
        if (attributes.equals(highlighter.getTextAttributes())) {
          if (myInSmartUpdate) {
            highlighter.putUserData(MARKER_USED,new Object());
          }
          return highlighter;
        }
      }
    }
  }
  final RangeHighlighter highlighter=doHightlightRange(textRange,attributes,highlighters);
  if (myInSmartUpdate) {
    highlighter.putUserData(MARKER_USED,new Object());
  }
  return highlighter;
}
