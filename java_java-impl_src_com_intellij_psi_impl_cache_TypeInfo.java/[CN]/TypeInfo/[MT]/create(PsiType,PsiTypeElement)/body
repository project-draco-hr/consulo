{
  if (type == null)   return NULL;
  final boolean isEllipsis=type instanceof PsiEllipsisType;
  int arrayCount=type.getArrayDimensions();
  final String text;
  if (typeElement != null) {
    while (typeElement.getFirstChild() instanceof PsiTypeElement) {
      typeElement=(PsiTypeElement)typeElement.getFirstChild();
    }
    text=typeElement instanceof PsiCompiledElement ? ((ClsTypeElementImpl)typeElement).getCanonicalText() : typeElement.getText();
  }
 else {
    type=type.getDeepComponentType();
    text=type.getInternalCanonicalText();
  }
  PsiAnnotation[] annotations=type.getAnnotations();
  List<PsiAnnotationStub> list;
  if (annotations.length == 0) {
    list=Collections.emptyList();
  }
 else {
    list=new ArrayList<PsiAnnotationStub>(annotations.length);
    for (    PsiAnnotation annotation : annotations) {
      PsiAnnotationStub stub=JavaStubElementTypes.ANNOTATION.createStub(annotation,null);
      list.add(stub);
    }
  }
  return new TypeInfo(StringRef.fromString(text),(byte)arrayCount,isEllipsis,list);
}
