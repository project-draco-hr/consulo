{
  final Document document=myEditor.getDocument();
  final VirtualFile file=FileDocumentManager.getInstance().getFile(document);
  if (file != null) {
    ReadonlyStatusHandler.getInstance(myProject).ensureFilesWritable(file);
  }
  String selectionString=myEditor.getSelectionModel().getSelectedText();
  if (selectionString != null) {
    if (myTemplate.isToReformat())     selectionString=selectionString.trim();
  }
  TemplateManager.getInstance(myProject).startTemplate(myEditor,selectionString,myTemplate);
}
