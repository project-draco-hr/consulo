{
  final VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile == null) {
    return true;
  }
  final Project project=file.getProject();
  final PsiManager psiManager=PsiManager.getInstance(project);
  final VirtualFile[] files=FileIncludeManager.getManager(project).getIncludingFiles(virtualFile,true);
  final PsiFile[] psiFiles=ContainerUtil.map2Array(files,PsiFile.class,new NullableFunction<VirtualFile,PsiFile>(){
    public PsiFile fun(    VirtualFile file){
      return psiManager.findFile(file);
    }
  }
);
  for (  final PsiFile psiFile : psiFiles) {
    if (XsltSupport.isXsltFile(psiFile)) {
      if (!processor.process((XmlFile)psiFile)) {
        return false;
      }
    }
  }
  return true;
}
