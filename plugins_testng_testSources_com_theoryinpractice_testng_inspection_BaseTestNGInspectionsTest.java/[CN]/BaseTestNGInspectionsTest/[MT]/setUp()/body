{
  final IdeaTestFixtureFactory fixtureFactory=IdeaTestFixtureFactory.getFixtureFactory();
  final TestFixtureBuilder<IdeaProjectTestFixture> testFixtureBuilder=fixtureFactory.createFixtureBuilder();
  myFixture=fixtureFactory.createCodeInsightFixture(testFixtureBuilder.getFixture());
  myFixture.setTestDataPath(PathManager.getHomePath() + "/svnPlugins/testng/testData");
  final JavaModuleFixtureBuilder builder=(JavaModuleFixtureBuilder)testFixtureBuilder.addModule(JavaModuleFixtureBuilder.class).addContentRoot(myFixture.getTempDirPath()).addSourceRoot(getSourceRoot());
  builder.setMockJdkLevel(JavaModuleFixtureBuilder.MockJdkLevel.jdk15);
  builder.addLibrary("junit",PathUtil.getJarPathForClass(TestCase.class));
  builder.addLibrary("testng",PathUtil.getJarPathForClass(AfterMethod.class));
  myEnabledTool=getEnabledTool();
  myFixture.enableInspections(myEnabledTool);
  myFixture.setUp();
  final JavaPsiFacade facade=JavaPsiFacade.getInstance(myFixture.getProject());
  myLanguageLevel=LanguageLevelProjectExtension.getInstance(facade.getProject()).getLanguageLevel();
  LanguageLevelProjectExtension.getInstance(facade.getProject()).setLanguageLevel(LanguageLevel.JDK_1_5);
}
