{
  for (  VirtualFile child : dir.getChildren()) {
    final FileType fileType=child.getFileType();
    if (FileTypes.ARCHIVE.equals(fileType)) {
      final StringBuilder builder=StringBuilderSpinAllocator.alloc();
      try {
        builder.append(VirtualFileManager.constructUrl(JarFileSystem.PROTOCOL,child.getPath()));
        builder.append(JarFileSystem.JAR_SEPARATOR);
        final VirtualFile jarRoot=VirtualFileManager.getInstance().findFileByUrl(builder.toString());
        if (jarRoot != null) {
          container.add(jarRoot);
        }
      }
  finally {
        StringBuilderSpinAllocator.dispose(builder);
      }
    }
 else {
      if (recursively && child.isDirectory()) {
        addChildren(child,container,recursively);
      }
    }
  }
}
