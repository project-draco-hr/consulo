{
  SimpleColoredText descriptorText=new SimpleColoredText();
  String text;
  String nodeName;
  if (descriptor == null) {
    text="";
    nodeName=null;
  }
 else {
    text=descriptor.getLabel();
    nodeName=descriptor.getName();
  }
  if (text.equals(NodeDescriptorImpl.EVALUATING_MESSAGE)) {
    descriptorText.append(NodeDescriptorImpl.EVALUATING_MESSAGE,new SimpleTextAttributes(Font.PLAIN,myEvaluatingHighlightColor));
    return descriptorText;
  }
  String[] strings=breakString(text,nodeName);
  SimpleTextAttributes dflt=new SimpleTextAttributes(Font.PLAIN,null);
  if (strings[0] != null) {
    if (descriptor instanceof MessageDescriptor && ((MessageDescriptor)descriptor).getKind() == MessageDescriptor.SPECIAL) {
      descriptorText.append(strings[0],new SimpleTextAttributes(Font.PLAIN,Color.lightGray));
    }
 else {
      descriptorText.append(strings[0],dflt);
    }
  }
  if (strings[1] != null) {
    descriptorText.append(strings[1],new SimpleTextAttributes(Font.PLAIN,myHighlightColor));
  }
  if (strings[2] != null) {
    if (descriptor instanceof ValueDescriptorImpl) {
      if (multiline && strings[2].indexOf('\n') >= 0) {
        strings=breakString(strings[2],"=");
        if (strings[2] != null) {
          strings[2]=strings[0] + strings[1] + "\n"+ strings[2];
        }
      }
      ValueDescriptorImpl valueDescriptor=(ValueDescriptorImpl)descriptor;
      String valueLabel=valueDescriptor.getValueLabel();
      strings=breakString(strings[2],valueLabel);
      if (strings[0] != null) {
        descriptorText.append(strings[0],dflt);
      }
      if (appendValue && strings[1] != null) {
        if (valueLabel != null && StringUtil.startsWithChar(valueLabel,'{') && valueLabel.indexOf('}') > 0 && !StringUtil.endsWithChar(valueLabel,'}')) {
          int idx=valueLabel.indexOf('}');
          String objectId=valueLabel.substring(0,idx + 1);
          valueLabel=valueLabel.substring(idx + 1);
          descriptorText.append(objectId,new SimpleTextAttributes(Font.PLAIN,myEvaluatingHighlightColor));
        }
        valueLabel=DebuggerUtilsEx.truncateString(valueLabel);
        if (descriptor.getEvaluateException() != null) {
          String errorMessage=descriptor.getEvaluateException().getMessage();
          if (valueLabel.endsWith(errorMessage)) {
            descriptorText.append(valueLabel.substring(0,valueLabel.length() - errorMessage.length()),dflt);
            descriptorText.append(errorMessage,new SimpleTextAttributes(Font.PLAIN,myExceptionHighlightColor));
          }
 else {
            descriptorText.append(valueLabel,valueDescriptor.isDirty() ? new SimpleTextAttributes(Font.PLAIN,myChangedValueHighlightColor) : dflt);
            descriptorText.append(errorMessage,new SimpleTextAttributes(Font.PLAIN,myExceptionHighlightColor));
          }
        }
 else {
          if (valueLabel.equals(NodeDescriptorImpl.EVALUATING_MESSAGE)) {
            descriptorText.append(NodeDescriptorImpl.EVALUATING_MESSAGE,new SimpleTextAttributes(Font.PLAIN,myEvaluatingHighlightColor));
          }
 else {
            descriptorText.append(valueLabel,valueDescriptor.isDirty() ? new SimpleTextAttributes(Font.PLAIN,myChangedValueHighlightColor) : dflt);
          }
        }
      }
    }
 else {
      descriptorText.append(strings[2],dflt);
    }
  }
  return descriptorText;
}
