{
  tree.addTreeWillExpandListener(new TreeWillExpandListener(){
    public void treeWillCollapse(    TreeExpansionEvent event){
      TreePath path=event.getPath();
      Enumeration children=((TreeNode)path.getLastPathComponent()).children();
      while (children.hasMoreElements()) {
        TreePath childPath=path.pathByAddingChild(children.nextElement());
        if (tree.isExpanded(childPath)) {
          tree.collapsePath(childPath);
        }
      }
    }
    public void treeWillExpand(    TreeExpansionEvent event){
    }
  }
);
  tree.addTreeExpansionListener(new TreeExpansionListener(){
    public void treeCollapsed(    TreeExpansionEvent event){
    }
    public void treeExpanded(    TreeExpansionEvent event){
      TreePath path=event.getPath();
      TreeNode lastPathComponent=(TreeNode)path.getLastPathComponent();
      if (lastPathComponent.getChildCount() == 1) {
        TreePath firstChildPath=path.pathByAddingChild(lastPathComponent.getChildAt(0));
        tree.expandPath(firstChildPath);
      }
    }
  }
);
}
