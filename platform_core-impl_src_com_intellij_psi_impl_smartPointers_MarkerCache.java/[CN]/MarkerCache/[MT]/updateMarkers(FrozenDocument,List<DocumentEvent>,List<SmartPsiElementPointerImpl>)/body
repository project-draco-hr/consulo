{
  List<SelfElementInfo> infos=ContainerUtil.findAll(ContainerUtil.map(pointers,new NullableFunction<SmartPsiElementPointerImpl,SmartPointerElementInfo>(){
    @Nullable @Override public SmartPointerElementInfo fun(    SmartPsiElementPointerImpl pointer){
      return pointer.getElementInfo();
    }
  }
),SelfElementInfo.class);
  Map<RangeKey,ManualRangeMarker> updated=getUpdatedMarkers(frozen,events);
  Map<ManualRangeMarker,ManualRangeMarker> newStates=ContainerUtil.newHashMap();
  for (  SelfElementInfo info : infos) {
    ManualRangeMarker marker=info.getRangeMarker();
    RangeKey key=marker == null ? null : keyOf(marker);
    if (key != null) {
      newStates.put(marker,updated.get(key));
    }
  }
  myMarkerSet.clear();
  for (  Map.Entry<ManualRangeMarker,ManualRangeMarker> entry : newStates.entrySet()) {
    ManualRangeMarker marker=entry.getKey();
    marker.applyState(entry.getValue());
    if (marker.isValid()) {
      myMarkerSet.add(marker);
    }
  }
  myByRange=null;
  myUpdatedRanges=null;
  for (  SelfElementInfo info : infos) {
    info.updateValidity();
  }
}
