{
  LightFilePointer folderFile=new LightFilePointer(folder.getUrl());
  VirtualFile file=VirtualFileManager.getInstance().findFileByUrl(folder.getContentEntry().getUrl());
  if (file == null)   return forInvalidVirtualFilePointer(folderFile);
  String contentPath=file.getPath();
  String relativePath;
  SimpleTextAttributes textAttributes;
  if (!folderFile.isValid()) {
    textAttributes=SimpleTextAttributes.ERROR_ATTRIBUTES;
    String absolutePath=folderFile.getPresentableUrl();
    relativePath=absolutePath.startsWith(contentPath) ? absolutePath.substring(contentPath.length()) : absolutePath;
  }
 else {
    relativePath=VfsUtil.getRelativePath(folderFile.getFile(),file,File.separatorChar);
    textAttributes=SimpleTextAttributes.REGULAR_ATTRIBUTES;
  }
  if (relativePath == null)   relativePath="";
  relativePath=relativePath.length() == 0 ? "." + File.separatorChar : relativePath;
  return new SimpleTextCellAppearance(relativePath,icon,textAttributes);
}
