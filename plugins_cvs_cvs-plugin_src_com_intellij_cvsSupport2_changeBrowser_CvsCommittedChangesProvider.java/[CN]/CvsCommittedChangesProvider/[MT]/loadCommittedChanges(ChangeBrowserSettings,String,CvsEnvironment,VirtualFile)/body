{
  if (connectionSettings.isOffline()) {
    return Collections.emptyList();
  }
  try {
    connectionSettings=CvsRootOnFileSystem.createMeOn(CvsVfsUtil.getFileFor(rootFile));
  }
 catch (  CannotFindCvsRootException ignore) {
  }
  final CvsChangeListsBuilder builder=new CvsChangeListsBuilder(module,connectionSettings,myProject,rootFile);
  Date dateTo=settings.getDateBeforeFilter();
  Date dateFrom=settings.getDateAfterFilter();
  if (dateFrom == null) {
    final Calendar calendar=Calendar.getInstance();
    calendar.set(1970,2,2);
    dateFrom=calendar.getTime();
  }
  final List<LogInformationWrapper> log=new ArrayList<LogInformationWrapper>();
  final LoadHistoryOperation operation=new LoadHistoryOperation(connectionSettings,module,dateFrom,dateTo,new Consumer<LogInformationWrapper>(){
    @Override public void consume(    LogInformationWrapper logInformationWrapper){
      log.add(logInformationWrapper);
    }
  }
);
  final CvsResult executionResult=operation.run(myProject);
  if (executionResult.isCanceled()) {
    throw new ProcessCanceledException();
  }
 else   if (executionResult.hasErrors()) {
    throw executionResult.composeError();
  }
 else {
    builder.addLogs(log);
    final List<CvsChangeList> versions=builder.getVersions();
    settings.filterChanges(versions);
    return versions;
  }
}
