{
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  if (project != null) {
    final VirtualFile src=VirtualFileManager.getInstance().findFileByUrl(Registry.stringValue("dir.diff.default.src.folder"));
    final VirtualFile trg=VirtualFileManager.getInstance().findFileByUrl(Registry.stringValue("dir.diff.default.trg.folder"));
    final FileChooserDescriptor descriptor=new FileChooserDescriptor(false,true,false,false,false,false);
    final VirtualFile[] files1=src != null ? new VirtualFile[]{src} : FileChooserFactory.getInstance().createFileChooser(descriptor,project).choose(null,project);
    final VirtualFile[] files2=trg != null ? new VirtualFile[]{trg} : FileChooserFactory.getInstance().createFileChooser(descriptor,project).choose(null,project);
    if (files1.length == 1 && files2.length == 1) {
      DiffElement elem1=new VirtualFileDiffElement(files1[0]);
      DiffElement elem2=new VirtualFileDiffElement(files2[0]);
      final DirDiffManager diffManager=DirDiffManager.getInstance(project);
      if (diffManager.canShow(elem1,elem2)) {
        diffManager.showDiff(elem1,elem2);
      }
    }
  }
}
