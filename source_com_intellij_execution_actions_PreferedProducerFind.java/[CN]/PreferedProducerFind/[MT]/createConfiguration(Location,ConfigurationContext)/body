{
  LOG.assertTrue(location != null);
  final RuntimeConfigurationProducer preferedProducer=findPreferedProducer(location,context);
  if (preferedProducer != null) {
    return preferedProducer.getConfiguration();
  }
  final ConfigurationType[] factories=RunManager.getInstance(location.getProject()).getConfigurationFactories();
  for (int i=0; i < factories.length; i++) {
    final ConfigurationType type=factories[i];
    if (type instanceof ConfigurationTypeEx) {
      final RunnerAndConfigurationSettings configuration=((ConfigurationTypeEx)type).createConfigurationByLocation(location);
      if (configuration != null) {
        return configuration;
      }
    }
  }
  return null;
}
