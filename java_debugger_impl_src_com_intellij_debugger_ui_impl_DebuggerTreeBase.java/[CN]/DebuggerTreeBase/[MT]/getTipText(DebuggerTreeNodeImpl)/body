{
  NodeDescriptorImpl descriptor=node.getDescriptor();
  if (descriptor instanceof ValueDescriptorImpl) {
    String text=((ValueDescriptorImpl)descriptor).getValueLabel();
    if (text != null) {
      if (StringUtil.startsWithChar(text,'{') && text.indexOf('}') > 0) {
        int idx=text.indexOf('}');
        if (idx != text.length() - 1) {
          text=text.substring(idx + 1);
        }
      }
      if (StringUtil.startsWithChar(text,'\"') && StringUtil.endsWithChar(text,'\"')) {
        text=text.substring(1,text.length() - 1);
      }
      final String tipText=prepareToolTipText(text);
      if (tipText.length() > 0 && (tipText.indexOf('\n') >= 0 || !getVisibleRect().contains(getRowBounds(getRowForPath(new TreePath(node.getPath())))))) {
        return tipText;
      }
    }
  }
  return node.getMarkupTooltipText() != null ? "" : null;
}
