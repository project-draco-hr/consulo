{
  final JToolTip tooltip=new JToolTip();
  if (tipText == null) {
    tooltip.setTipText(tipText);
  }
 else {
    Dimension rootSize=getVisibleRect().getSize();
    Insets borderInsets=tooltip.getBorder().getBorderInsets(tooltip);
    rootSize.width-=(borderInsets.left + borderInsets.right) * 2;
    rootSize.height-=(borderInsets.top + borderInsets.bottom) * 2;
    final StringBuffer tipBuilder=new StringBuffer();
    try {
      final String markupText=node.getMarkupTooltipText();
      if (markupText != null) {
        tipBuilder.append(markupText);
      }
      if (tipText.length() > 0) {
        final StringTokenizer tokenizer=new StringTokenizer(tipText,"\n ",true);
        while (tokenizer.hasMoreElements()) {
          final String each=tokenizer.nextElement();
          if ("\n".equals(each)) {
            tipBuilder.append("<br>");
          }
 else           if (" ".equals(each)) {
            tipBuilder.append("&nbsp ");
          }
 else {
            tipBuilder.append(JDOMUtil.legalizeText(each));
          }
        }
      }
      tooltip.setTipText(UIUtil.toHtml(tipBuilder.toString(),0));
    }
  finally {
    }
  }
  tooltip.setBorder(null);
  return tooltip;
}
