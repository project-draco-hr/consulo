{
  for (  Project aProject : projects) {
    if (ProjectRootManager.getInstance(aProject).getFileIndex().isInContent(virtualFile)) {
      return aProject;
    }
  }
  IdeFrame frame=IdeFocusManager.getGlobalInstance().getLastFocusedFrame();
  Project project=frame == null ? null : frame.getProject();
  return project != null ? project : projects[0];
}
