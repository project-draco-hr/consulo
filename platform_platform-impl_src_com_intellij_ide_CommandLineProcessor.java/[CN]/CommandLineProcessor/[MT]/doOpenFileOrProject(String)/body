{
  final VirtualFile virtualFile=LocalFileSystem.getInstance().refreshAndFindFileByPath(name);
  if (virtualFile == null) {
    Messages.showErrorDialog("Cannot find file '" + name + "'","Cannot find file");
    return null;
  }
  ProjectOpenProcessor provider=ProjectOpenProcessor.getImportProvider(virtualFile);
  if (provider instanceof PlatformProjectOpenProcessor && !virtualFile.isDirectory()) {
    provider=null;
  }
  if (provider != null || name.endsWith(ProjectFileType.DOT_DEFAULT_EXTENSION) || new File(name,Project.DIRECTORY_STORE_FOLDER).exists()) {
    final Project result=ProjectUtil.openOrImport(name,null,true);
    if (result == null) {
      Messages.showErrorDialog("Cannot open project '" + name + "'","Cannot open project");
    }
    return result;
  }
 else {
    final Project[] projects=ProjectManager.getInstance().getOpenProjects();
    if (projects.length == 0) {
      Messages.showErrorDialog("No project found to open file in","Cannot open file");
      return null;
    }
 else {
      final Project project=projects[0];
      new OpenFileDescriptor(project,virtualFile).navigate(true);
      return project;
    }
  }
}
