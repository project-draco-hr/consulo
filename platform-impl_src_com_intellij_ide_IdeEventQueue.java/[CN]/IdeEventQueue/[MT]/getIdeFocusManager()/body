{
  Window currentWindow=KeyboardFocusManager.getCurrentKeyboardFocusManager().getActiveWindow();
  if (currentWindow != null) {
    Component topLevel=UIUtil.findUltimateParent(currentWindow);
    if (topLevel instanceof IdeFrameImpl) {
      IdeFrameImpl frame=(IdeFrameImpl)topLevel;
      Project project=frame.getProject();
      if (project != null) {
        return IdeFocusManager.getInstance(project);
      }
    }
  }
  return null;
}
