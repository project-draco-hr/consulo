{
  myLock=new Object();
  myIdleListeners=new ArrayList<Runnable>(2);
  myActivityListeners=new ArrayList<Runnable>(2);
  myIdleRequestsAlarm=new Alarm();
  myIdleTimeCounterAlarm=new Alarm(Alarm.ThreadToUse.SWING_THREAD);
  addIdleTimeCounterRequest();
  myListener2Request=new HashMap<Runnable,MyFireIdleRequest>();
  myKeyEventDispatcher=new IdeKeyEventDispatcher();
  myMouseEventDispatcher=new IdeMouseEventDispatcher();
  myPopupManager=new IdePopupManager();
  myExitSuspendModeRunnable=new ExitSuspendModeRunnable();
  mySuspendModeAlarm=new Alarm();
  final KeyboardFocusManager keyboardFocusManager=KeyboardFocusManager.getCurrentKeyboardFocusManager();
  keyboardFocusManager.addPropertyChangeListener("permanentFocusOwner",new PropertyChangeListener(){
    public void propertyChange(    final PropertyChangeEvent e){
      final Application application=ApplicationManager.getApplication();
      if (application == null) {
        return;
      }
      application.assertIsDispatchThread();
      final Window focusedWindow=keyboardFocusManager.getFocusedWindow();
      final Component focusOwner=keyboardFocusManager.getFocusOwner();
      if (mySuspendMode && focusedWindow != null && focusOwner != null && focusOwner != myFocusOwner && !(focusOwner instanceof Window)) {
        exitSuspendMode();
      }
    }
  }
);
}
