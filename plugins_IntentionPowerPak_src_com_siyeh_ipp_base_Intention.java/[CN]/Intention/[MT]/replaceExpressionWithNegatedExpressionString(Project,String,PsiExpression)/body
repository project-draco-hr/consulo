{
  final PsiManager mgr=PsiManager.getInstance(project);
  final PsiElementFactory factory=mgr.getElementFactory();
  PsiExpression expressionToReplace=exp;
  final String expString;
  if (BoolUtils.isNegated(exp)) {
    expressionToReplace=BoolUtils.findNegation(exp);
    expString=newExpression;
  }
 else {
    expString="!(" + newExpression + ')';
  }
  final PsiExpression newCall=factory.createExpressionFromText(expString,null);
  final PsiElement insertedElement=expressionToReplace.replace(newCall);
  final CodeStyleManager codeStyleManager=mgr.getCodeStyleManager();
  codeStyleManager.reformat(insertedElement);
}
