{
  if (startElement == null || endElement == null) {
    myStartElement=myEndElement=null;
    return;
  }
  LOG.assertTrue(startElement.isValid());
  PsiFile startContainingFile=startElement.getContainingFile();
  PsiFile endContainingFile=startElement == endElement ? startContainingFile : endElement.getContainingFile();
  if (startElement != endElement) {
    LOG.assertTrue(endElement.isValid());
    LOG.assertTrue(startContainingFile == endContainingFile,"Both elements must be from the same file");
  }
  Project project=startContainingFile == null ? startElement.getProject() : startContainingFile.getProject();
  myStartElement=SmartPointerManager.getInstance(project).createSmartPsiElementPointer(startElement,startContainingFile);
  myEndElement=endElement == startElement ? null : SmartPointerManager.getInstance(project).createSmartPsiElementPointer(endElement,endContainingFile);
}
