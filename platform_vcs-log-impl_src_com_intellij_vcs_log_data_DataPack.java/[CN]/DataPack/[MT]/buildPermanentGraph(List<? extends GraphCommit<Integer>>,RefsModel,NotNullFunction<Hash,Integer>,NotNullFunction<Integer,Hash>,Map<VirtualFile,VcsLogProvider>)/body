{
  if (commits.isEmpty()) {
    return EmptyPermanentGraph.getInstance();
  }
  GraphColorManagerImpl colorManager=new GraphColorManagerImpl(refsModel,hashGetter,getRefManagerMap(providers));
  Set<Integer> branches=getBranchCommitHashIndexes(refsModel.getAllRefs(),indexGetter);
  StopWatch sw=StopWatch.start("building graph");
  PermanentGraphImpl<Integer> permanentGraph=PermanentGraphImpl.newInstance(commits,colorManager,branches);
  sw.report();
  return permanentGraph;
}
