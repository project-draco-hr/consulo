{
  final List<Match> duplicates=provider.getDuplicates();
  for (Iterator<Match> iterator=duplicates.iterator(); iterator.hasNext(); ) {
    final Match match=iterator.next();
    final ArrayList highlighters=new ArrayList();
    highlightMatch(project,editor,match,highlighters);
    final TextRange textRange=match.getTextRange();
    final LogicalPosition logicalPosition=editor.offsetToLogicalPosition(textRange.getStartOffset());
    expandAllRegionsCoveringRange(project,editor,textRange);
    editor.getScrollingModel().scrollTo(logicalPosition,ScrollType.MAKE_VISIBLE);
    final int matchAnswer=Messages.showYesNoCancelDialog(project,"Replace this code fragment?","Process Duplicates",Messages.getQuestionIcon());
    HighlightManager.getInstance(project).removeSegmentHighlighter(editor,(RangeHighlighter)highlighters.get(0));
    if (matchAnswer == 0) {
      CommandProcessor.getInstance().executeCommand(project,new Runnable(){
        public void run(){
          final Runnable action=new Runnable(){
            public void run(){
              try {
                provider.processMatch(match);
              }
 catch (              IncorrectOperationException e) {
                LOG.error(e);
              }
            }
          }
;
          ApplicationManager.getApplication().runWriteAction(action);
        }
      }
,commandName,null);
    }
 else     if (matchAnswer == 2) {
      break;
    }
  }
}
