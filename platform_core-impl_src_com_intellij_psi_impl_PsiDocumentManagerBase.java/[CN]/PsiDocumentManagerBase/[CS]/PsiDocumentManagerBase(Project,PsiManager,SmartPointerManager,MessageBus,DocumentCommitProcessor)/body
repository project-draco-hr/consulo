{
  myProject=project;
  myPsiManager=psiManager;
  myDocumentCommitProcessor=documentCommitProcessor;
  mySmartPointerManager=(SmartPointerManagerImpl)smartPointerManager;
  mySynchronizer=new PsiToDocumentSynchronizer(this,bus);
  myPsiManager.addPsiTreeChangeListener(mySynchronizer);
  bus.connect().subscribe(PsiDocumentTransactionListener.TOPIC,new PsiDocumentTransactionListener(){
    @Override public void transactionStarted(    @NotNull Document document,    @NotNull PsiFile file){
      myUncommittedDocuments.remove(document);
    }
    @Override public void transactionCompleted(    @NotNull Document document,    @NotNull PsiFile file){
    }
  }
);
  bus.connect().subscribe(DocumentBulkUpdateListener.TOPIC,this);
}
