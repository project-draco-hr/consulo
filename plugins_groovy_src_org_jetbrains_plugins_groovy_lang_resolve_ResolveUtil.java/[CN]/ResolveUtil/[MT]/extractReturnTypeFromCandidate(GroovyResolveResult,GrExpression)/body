{
  final PsiElement element=candidate.getElement();
  if (element instanceof PsiMethod && !candidate.isInvokedOnProperty()) {
    PsiType substituted=candidate.getSubstitutor().substitute(getSmartReturnType((PsiMethod)element));
    return PsiImplUtil.normalizeWildcardTypeByPosition(substituted,expression);
  }
  final PsiType type;
  if (element instanceof GrField) {
    type=((GrField)element).getTypeGroovy();
  }
 else   if (element instanceof PsiMethod) {
    type=getSmartReturnType((PsiMethod)element);
  }
 else {
    return null;
  }
  if (type instanceof GrClosureType) {
    PsiType substituted=candidate.getSubstitutor().substitute(((GrClosureType)type).getSignature().getReturnType());
    return PsiImplUtil.normalizeWildcardTypeByPosition(substituted,expression);
  }
  return null;
}
