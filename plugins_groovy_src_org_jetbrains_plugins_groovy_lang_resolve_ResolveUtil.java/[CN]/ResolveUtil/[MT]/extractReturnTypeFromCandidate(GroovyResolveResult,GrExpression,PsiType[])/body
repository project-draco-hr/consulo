{
  final PsiElement element=candidate.getElement();
  if (element instanceof PsiMethod && !candidate.isInvokedOnProperty()) {
    return TypesUtil.substituteBoxAndNormalizeType(getSmartReturnType((PsiMethod)element),candidate.getSubstitutor(),expression);
  }
  final PsiType type;
  if (element instanceof GrField) {
    type=((GrField)element).getTypeGroovy();
  }
 else   if (element instanceof PsiMethod) {
    type=getSmartReturnType((PsiMethod)element);
  }
 else {
    return null;
  }
  if (type instanceof GrClosureType) {
    final GrSignature signature=((GrClosureType)type).getSignature();
    PsiType returnType=GrClosureSignatureUtil.getReturnType(signature,args,expression);
    return TypesUtil.substituteBoxAndNormalizeType(returnType,candidate.getSubstitutor(),expression);
  }
  return null;
}
