{
  final VirtualFileManagerEx manager=(VirtualFileManagerEx)VirtualFileManager.getInstance();
  manager.fireBeforeRefreshStart(false);
  try {
    List<VirtualFile> filesToRefresh=new ArrayList<VirtualFile>();
    for (    File file : files) {
      final VirtualFile virtualFile=refreshAndFindFileByIoFile(file);
      if (virtualFile != null) {
        filesToRefresh.add(virtualFile);
      }
    }
    RefreshQueue.getInstance().refresh(false,false,null,filesToRefresh.toArray(new VirtualFile[filesToRefresh.size()]));
  }
  finally {
    manager.fireAfterRefreshFinish(false);
  }
}
