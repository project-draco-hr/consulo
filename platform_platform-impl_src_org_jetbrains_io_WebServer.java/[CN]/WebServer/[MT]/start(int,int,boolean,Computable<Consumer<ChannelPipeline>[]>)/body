{
  if (isRunning()) {
    throw new IllegalStateException("server already started");
  }
  ServerBootstrap bootstrap=new ServerBootstrap(channelFactory);
  bootstrap.setOption("child.tcpNoDelay",true);
  bootstrap.setPipelineFactory(new ChannelPipelineFactoryImpl(pipelineConsumers,new DefaultHandler(openChannels)));
  int port=bind(firstPort,portsCount,tryAnyPort,bootstrap);
  if (port != -1) {
    try {
      openChannels.add(bootstrap.bind(new InetSocketAddress(port)));
    }
 catch (    ChannelException e) {
      LOG.error(e);
    }
  }
  return port;
}
