{
  String property=System.getProperty(PROPERTY_ONLY_ANY_HOST);
  boolean onlyAnyHost=property == null ? SystemInfo.isLinux || SystemInfo.isWindowsXP : (property.isEmpty() || Boolean.valueOf(property));
  for (int i=0; i < portsCount; i++) {
    int port=firstPort + i;
    try {
      openChannels.add(bootstrap.bind(new InetSocketAddress(port)));
      if (!onlyAnyHost) {
        openChannels.add(bootstrap.bind(new InetSocketAddress(InetAddress.getByName("127.0.0.1"),port)));
      }
      return port;
    }
 catch (    ChannelException e) {
      if (!openChannels.isEmpty()) {
        openChannels.close();
        openChannels.clear();
      }
      if (portsCount == 1) {
        throw e;
      }
 else       if (!tryAnyPort && i == (portsCount - 1)) {
        LOG.error(e);
      }
    }
catch (    UnknownHostException e) {
      LOG.error(e);
    }
  }
  if (tryAnyPort) {
    try {
      Channel channel=bootstrap.bind(new InetSocketAddress(0));
      openChannels.add(channel);
      return ((InetSocketAddress)channel.getLocalAddress()).getPort();
    }
 catch (    ChannelException e) {
      LOG.error(e);
    }
  }
  return -1;
}
