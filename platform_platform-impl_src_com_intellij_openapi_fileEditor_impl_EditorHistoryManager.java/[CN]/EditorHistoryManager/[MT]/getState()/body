{
  Element element=new Element("state");
  final VirtualFile[] openFiles=FileEditorManager.getInstance(myProject).getOpenFiles();
  for (int i=openFiles.length - 1; i >= 0; i--) {
    final VirtualFile file=openFiles[i];
    if (getEntry(file) != null) {
      updateHistoryEntry(file,false);
    }
  }
  for (  final HistoryEntry entry : myEntriesList) {
    entry.writeExternal(element,myProject);
  }
  return element;
}
