{
  buildStructure(myRoot);
  myElementUpdate.clear();
  final NodeElement[] toExpand=new NodeElement[]{new NodeElement("com"),new NodeElement("jetbrains"),new NodeElement("org"),new NodeElement("xunit")};
  final ActionCallback done=new ActionCallback();
  final Ref<ProgressIndicator> indicatorRef=new Ref<ProgressIndicator>();
  invokeLaterIfNeeded(new Runnable(){
    @Override public void run(){
      getBuilder().batch(new Progressive(){
        @Override public void run(        @NotNull ProgressIndicator indicator){
          indicatorRef.set(indicator);
          expandNext(toExpand,0,indicator,done);
        }
      }
).notify(done);
    }
  }
);
  waitBuilderToCome(new Condition(){
    @Override public boolean value(    Object o){
      return done.isProcessed();
    }
  }
);
  assertTrue(done.isDone());
  assertTree("-/\n" + " -com\n" + "  +intellij\n"+ " -jetbrains\n"+ "  +fabrique\n"+ " -org\n"+ "  +eclipse\n"+ " -xunit\n"+ "  runner\n");
  assertFalse(indicatorRef.get().isCanceled());
}
