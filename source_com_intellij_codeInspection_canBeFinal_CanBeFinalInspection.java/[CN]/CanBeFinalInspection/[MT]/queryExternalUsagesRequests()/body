{
  final CanBeFinalFilter filter=new CanBeFinalFilter(this);
  getRefManager().iterate(new RefManager.RefIterator(){
    public void accept(    RefElement refElement){
      if (filter.accepts(refElement)) {
        refElement.accept(new RefVisitor(){
          public void visitMethod(          final RefMethod refMethod){
            if (!refMethod.isStatic() && refMethod.getAccessModifier() != PsiModifier.PRIVATE && !(refMethod instanceof RefImplicitConstructor)) {
              getManager().enqueueDerivedMethodsProcessing(refMethod,new InspectionManagerEx.DerivedMethodsProcessor(){
                public boolean process(                PsiMethod derivedMethod){
                  refMethod.setCanBeFinal(false);
                  return false;
                }
              }
);
            }
          }
          public void visitClass(          final RefClass refClass){
            if (!refClass.isAnonymous()) {
              getManager().enqueueDerivedClassesProcessing(refClass,new InspectionManagerEx.DerivedClassesProcessor(){
                public boolean process(                PsiClass inheritor){
                  refClass.setCanBeFinal(false);
                  return false;
                }
              }
);
            }
          }
          public void visitField(          final RefField refField){
            getManager().enqueueFieldUsagesProcessor(refField,new InspectionManagerEx.UsagesProcessor(){
              public boolean process(              PsiReference psiReference){
                PsiElement expression=psiReference.getElement();
                if (expression instanceof PsiReferenceExpression && PsiUtil.isAccessedForWriting((PsiExpression)expression)) {
                  refField.setCanBeFinal(false);
                  return false;
                }
                return true;
              }
            }
);
          }
        }
);
      }
    }
  }
);
  return false;
}
