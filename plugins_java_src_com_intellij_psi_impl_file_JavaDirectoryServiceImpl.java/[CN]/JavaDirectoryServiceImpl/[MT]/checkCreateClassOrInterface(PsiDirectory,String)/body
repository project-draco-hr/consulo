{
  PsiUtil.checkIsIdentifier(directory.getManager(),name);
  String fileName=name + "." + StdFileTypes.JAVA.getDefaultExtension();
  directory.checkCreateFile(fileName);
  PsiNameHelper helper=JavaPsiFacade.getInstance(directory.getProject()).getNameHelper();
  PsiPackage aPackage=JavaDirectoryService.getInstance().getPackage(directory);
  String qualifiedName=aPackage == null ? null : aPackage.getQualifiedName();
  if (!StringUtil.isEmpty(qualifiedName) && !helper.isQualifiedName(qualifiedName)) {
    throw new IncorrectOperationException("Cannot create class in invalid package: '" + qualifiedName + "'");
  }
}
