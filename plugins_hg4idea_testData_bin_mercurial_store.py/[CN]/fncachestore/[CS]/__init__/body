def __init__(self, path, opener, pathjoiner):
    self.pathjoiner = pathjoiner
    self.path = self.pathjoiner(path, 'store')
    self.createmode = _calcmode(self.path)
    op = opener(self.path)
    op.createmode = self.createmode
    fnc = fncache(op)
    self.fncache = fnc

    def fncacheopener(path, mode='r', *args, **kw):
        if ((mode not in ('r', 'rb')) and path.startswith('data/')):
            fnc.add(path)
        return op(hybridencode(path), mode, *args, **kw)
    self.opener = fncacheopener
