{
  final SelectionModel selectionModel=editor.getSelectionModel();
  final CaretModel caretModel=editor.getCaretModel();
  ScrollingModel scrollingModel=editor.getScrollingModel();
  if (selectionModel.hasSelection() && (!(editor instanceof EditorEx) || !((EditorEx)editor).isStickySelection())) {
    if (editor.getIndentsModel().getCaretIndentGuide() != null) {
      selectionModel.removeSelection();
    }
 else {
      int start=selectionModel.getSelectionStart();
      int end=selectionModel.getSelectionEnd();
      int caretOffset=caretModel.getOffset();
      VisualPosition targetPosition=myDirection == Direction.RIGHT ? selectionModel.getSelectionEndPosition() : selectionModel.getSelectionStartPosition();
      if (start <= caretOffset && end >= caretOffset) {
        selectionModel.removeSelection();
        if (caretModel.supportsMultipleCarets() && editor.isColumnMode() && targetPosition != null) {
          caretModel.moveToVisualPosition(targetPosition);
        }
 else {
          caretModel.moveToOffset(myDirection == Direction.RIGHT ? end : start);
        }
        scrollingModel.scrollToCaret(ScrollType.RELATIVE);
        return;
      }
    }
  }
  final boolean scrollToCaret=!(editor instanceof EditorImpl) || ((EditorImpl)editor).isScrollToCaret();
  caretModel.moveCaretRelatively(myDirection == Direction.RIGHT ? 1 : -1,0,false,false,scrollToCaret);
}
