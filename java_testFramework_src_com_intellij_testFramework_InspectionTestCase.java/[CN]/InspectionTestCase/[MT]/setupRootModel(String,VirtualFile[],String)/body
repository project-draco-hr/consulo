{
  VirtualFile projectDir=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(new File(testDir));
  assertNotNull(projectDir);
  sourceDir[0]=projectDir.findChild("src");
  if (sourceDir[0] == null) {
    sourceDir[0]=projectDir;
  }
  VirtualFile ext_src=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(new File(testDir + "/ext_src"));
  final ModuleRootManager rootManager=ModuleRootManager.getInstance(myModule);
  final ModifiableRootModel rootModel=rootManager.getModifiableModel();
  rootModel.clear();
  final ContentEntry contentEntry=rootModel.addContentEntry(projectDir);
  contentEntry.addSourceFolder(sourceDir[0],false);
  if (ext_src != null) {
    contentEntry.addSourceFolder(ext_src,false);
  }
  rootModel.setSdk(getTestProjectSdk(sdkName));
  rootModel.commit();
}
