{
  final VirtualFile[] sourceDir=new VirtualFile[1];
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      try {
        setupRootModel(testDir,sourceDir,jdkName);
      }
 catch (      Exception e) {
        LOG.error(e);
      }
    }
  }
);
  AnalysisScope scope=createAnalysisScope(sourceDir[0].getParent());
  InspectionManagerEx inspectionManager=(InspectionManagerEx)InspectionManager.getInstance(myProject);
  final GlobalInspectionContextImpl globalContext=inspectionManager.createNewGlobalContext(true);
  globalContext.setCurrentScope(scope);
  if (runDeadCodeFirst) {
    runTool(new UnusedDeclarationInspection(),scope,globalContext,inspectionManager);
  }
  runTool(tool,scope,globalContext,inspectionManager);
}
