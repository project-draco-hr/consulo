{
  final PsiAnonymousClass anonymousClass=expr.getAnonymousClass();
  final PsiExpressionList argumentList=expr.getArgumentList();
  if (anonymousClass != null) {
    myBuf.append(PsiKeyword.NEW).append(" ").append(anonymousClass.getBaseClassType().getPresentableText());
    if (argumentList != null)     argumentList.accept(this);
    myBuf.append(" {...}");
  }
 else {
    final PsiJavaCodeReferenceElement reference=expr.getClassReference();
    if (reference != null) {
      myBuf.append(PsiKeyword.NEW).append(" ").append(reference.getText());
      final PsiExpression[] arrayDimensions=expr.getArrayDimensions();
      final PsiType type=expr.getType();
      final int dimensions=type != null ? type.getArrayDimensions() : arrayDimensions.length;
      if (arrayDimensions.length > 0)       myBuf.append("[");
      for (int i=0, arrayDimensionsLength=arrayDimensions.length; i < dimensions; i++) {
        final PsiExpression dimension=i < arrayDimensionsLength ? arrayDimensions[i] : null;
        if (i > 0)         myBuf.append("][");
        if (dimension != null) {
          dimension.accept(this);
        }
      }
      if (arrayDimensions.length > 0)       myBuf.append("]");
      if (argumentList != null) {
        argumentList.accept(this);
      }
      final PsiArrayInitializerExpression arrayInitializer=expr.getArrayInitializer();
      if (arrayInitializer != null) {
        arrayInitializer.accept(this);
      }
    }
 else {
      myBuf.append(expr.getText());
    }
  }
}
