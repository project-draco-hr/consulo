{
  final CompilerConfiguration config=CompilerConfiguration.getInstance(myProject);
  if (!config.isAnnotationProcessorsEnabled()) {
    return ProcessingItem.EMPTY_ARRAY;
  }
  final VirtualFile[] files=context.getCompileScope().getFiles(StdFileTypes.JAVA,true);
  final List<ProcessingItem> items=new ArrayList<ProcessingItem>(files.length);
  final Set<Module> excludedModules=config.getExcludedModules();
  for (  final VirtualFile file : files) {
    if (excludedModules.size() != 0 && excludedModules.contains(context.getModuleByFile(file))) {
      continue;
    }
    if (config.isExcludedFromCompilation(file)) {
      continue;
    }
    items.add(new MyProcessingItem(file));
  }
  return items.toArray(new ProcessingItem[items.size()]);
}
