{
  StringBuilder buffer=new StringBuilder("0123456789");
  RangeMarker marker=createMarker("0123456789",2,5);
  PsiToDocumentSynchronizer synchronizer=((PsiDocumentManagerImpl)PsiDocumentManager.getInstance(getProject())).getSynchronizer();
  Document document=marker.getDocument();
  synchronizer.startTransaction(getProject(),document,null);
  synchronizer.replaceString(document,4,5,"3a4");
  buffer.replace(4,5,"3a4");
  synchronizer.insertString(document,7,"b");
  buffer.insert(7,"b");
  synchronizer.insertString(document,1,"b");
  buffer.insert(1,"b");
  synchronizer.doCommitTransaction(document);
  assertEquals(buffer.toString(),document.getText());
  assertValidMarker(marker,3,8);
}
