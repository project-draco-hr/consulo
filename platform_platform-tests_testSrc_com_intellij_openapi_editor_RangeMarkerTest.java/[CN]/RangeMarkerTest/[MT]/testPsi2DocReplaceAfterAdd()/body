{
  StringBuilder buffer=new StringBuilder("0123456789");
  RangeMarker marker=createMarker("0123456789",2,5);
  PsiToDocumentSynchronizer synchronizer=((PsiDocumentManagerImpl)PsiDocumentManager.getInstance(getProject())).getSynchronizer();
  synchronizer.startTransaction(getProject(),marker.getDocument(),null);
  synchronizer.insertString(marker.getDocument(),1,"a");
  buffer.insert(1,"a");
  synchronizer.replaceString(marker.getDocument(),3,4,"a");
  buffer.replace(3,4,"a");
  synchronizer.doCommitTransaction(marker.getDocument());
  assertEquals(buffer.toString(),marker.getDocument().getText());
  assertTrue(marker.isValid());
  assertEquals(3,marker.getStartOffset());
  assertEquals(6,marker.getEndOffset());
}
