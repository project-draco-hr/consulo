{
  getDisplayValue();
  if (physicalIndex < 0 || physicalIndex > myValueTextRange.getLength())   return -1;
  if (myGapPhysicalStarts.length == 0)   return physicalIndex;
  final int bsResult=Arrays.binarySearch(myGapPhysicalStarts,physicalIndex);
  final int gapIndex;
  if (bsResult > 0) {
    gapIndex=bsResult;
  }
 else   if (bsResult < -1) {
    gapIndex=-bsResult - 2;
  }
 else {
    gapIndex=-1;
  }
  if (gapIndex < 0)   return physicalIndex;
  final int shift=myGapPhysicalStarts[gapIndex] - myGapDisplayStarts[gapIndex];
  return Math.max(myGapDisplayStarts[gapIndex],physicalIndex - shift);
}
