{
  if (myRedNodes.value(startNode))   return new GreenFragment(null,null,Collections.<Integer>emptySet());
  Integer upRedNode=getNearRedNode(startNode,maxWalkSize,true);
  Integer downRedNode=getNearRedNode(startNode,maxWalkSize,false);
  Set<Integer> upPart=upRedNode != null ? getMiddleNodes(upRedNode,startNode,false) : getWalkNodes(startNode,true,createStopFunction(maxWalkSize));
  Set<Integer> downPart=downRedNode != null ? getMiddleNodes(startNode,downRedNode,false) : getWalkNodes(startNode,false,createStopFunction(maxWalkSize));
  Set<Integer> middleNodes=ContainerUtil.union(upPart,downPart);
  if (upRedNode != null)   middleNodes.remove(upRedNode);
  if (downRedNode != null)   middleNodes.remove(downRedNode);
  return new GreenFragment(upRedNode,downRedNode,middleNodes);
}
