{
  final Collection<VirtualFile> files=FileBasedIndex.getInstance().getContainingFiles(NAME,name,scope);
  if (files.isEmpty())   return PsiFile.EMPTY_ARRAY;
  List<PsiFileSystemItem> result=new ArrayList<PsiFileSystemItem>();
  PsiManager psiManager=PsiManager.getInstance(project);
  for (  VirtualFile file : files) {
    if (!file.isValid())     continue;
    if (!includeDirs && !file.isDirectory()) {
      PsiFile psiFile=psiManager.findFile(file);
      if (psiFile != null)       result.add(psiFile);
    }
 else     if (includeDirs && file.isDirectory()) {
      PsiDirectory dir=psiManager.findDirectory(file);
      if (dir != null)       result.add(dir);
    }
  }
  if (includeDirs) {
    return ArrayUtil.toObjectArray(result,PsiFileSystemItem.class);
  }
  return result.toArray(new PsiFile[result.size()]);
}
