{
  FileManager fileManager=myPsiManager.getFileManager();
synchronized (cachedList) {
    int insertionIndex=Collections.binarySearch(cachedList,virtualFile,rangesIntersectionComparator);
    if (insertionIndex < 0)     insertionIndex=-insertionIndex - 1;
    while (insertionIndex != 0 && insertionIndex < cachedList.size()) {
      if (compareRanges(cachedList.get(insertionIndex),virtualFile) == 0) {
        insertionIndex--;
      }
 else {
        break;
      }
    }
    while (insertionIndex > 0) {
      if (checkAndRemoveInvalidFile(insertionIndex - 1,cachedList,fileManager) == null) {
        insertionIndex--;
      }
 else {
        break;
      }
    }
    boolean enoughChecking=false;
    int i=insertionIndex;
    while (i < cachedList.size()) {
      VirtualFileWindow oldValidFile=checkAndRemoveInvalidFile(i,cachedList,fileManager);
      if (oldValidFile == null) {
        enoughChecking=false;
      }
 else {
        if (enoughChecking && compareRanges(oldValidFile,virtualFile) == 1)         break;
        i++;
        enoughChecking=true;
      }
    }
    cachedList.add(insertionIndex,virtualFile);
  }
  return virtualFile;
}
