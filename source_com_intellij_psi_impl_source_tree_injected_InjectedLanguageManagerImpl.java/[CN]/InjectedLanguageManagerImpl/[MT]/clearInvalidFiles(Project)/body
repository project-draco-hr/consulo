{
synchronized (cachedFiles) {
    Iterator<VirtualFileWindow> iterator=cachedFiles.iterator();
    while (iterator.hasNext()) {
      VirtualFileWindow cachedFile=iterator.next();
      PsiFile cached=((PsiManagerEx)PsiManager.getInstance(project)).getFileManager().getCachedPsiFile(cachedFile);
      PsiElement context;
      if (cached == null || (context=cached.getContext()) == null || !context.isValid()) {
        iterator.remove();
        continue;
      }
      Document cachedDocument=PsiDocumentManager.getInstance(project).getCachedDocument(cached);
      if (!(cachedDocument instanceof DocumentWindow)) {
        iterator.remove();
      }
    }
  }
}
