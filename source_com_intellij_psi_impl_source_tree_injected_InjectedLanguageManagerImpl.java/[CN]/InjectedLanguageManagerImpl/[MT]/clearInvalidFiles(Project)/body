{
synchronized (cachedFiles) {
    Iterator<VirtualFileWindow> iterator=cachedFiles.iterator();
    while (iterator.hasNext()) {
      VirtualFileWindow cachedFile=iterator.next();
      PsiFile cached=((PsiManagerEx)PsiManager.getInstance(project)).getFileManager().getCachedPsiFile(cachedFile);
      if (cached == null || cached.getContext() == null || !cached.getContext().isValid()) {
        iterator.remove();
        continue;
      }
      Document cachedDocument=PsiDocumentManager.getInstance(project).getCachedDocument(cached);
      if (!(cachedDocument instanceof DocumentWindow)) {
        iterator.remove();
      }
    }
  }
}
