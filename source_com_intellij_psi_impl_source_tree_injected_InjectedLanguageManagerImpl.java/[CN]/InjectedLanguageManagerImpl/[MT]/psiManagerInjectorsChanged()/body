{
  PsiManagerEx psiManager=(PsiManagerEx)PsiManager.getInstance(myProject);
  List<? extends LanguageInjector> injectors=psiManager.getLanguageInjectors();
  LanguageInjector[] extensions=Extensions.getExtensions(LanguageInjector.EXTENSION_POINT_NAME);
  if (injectors.isEmpty() && extensions.length == 0) {
    MultiHostInjector prev=myPsiManagerRegisteredInjectorsAdapter.getAndSet(null);
    if (prev != null) {
      unregisterMultiHostInjector(prev);
    }
  }
 else {
    PsiManagerRegisteredInjectorsAdapter adapter=new PsiManagerRegisteredInjectorsAdapter(psiManager);
    if (myPsiManagerRegisteredInjectorsAdapter.compareAndSet(null,adapter)) {
      registerMultiHostInjector(adapter);
    }
  }
}
