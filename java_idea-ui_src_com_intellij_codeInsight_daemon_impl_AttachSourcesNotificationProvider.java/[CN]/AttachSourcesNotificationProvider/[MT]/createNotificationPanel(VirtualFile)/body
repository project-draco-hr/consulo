{
  if (file.getFileType() != JavaClassFileType.INSTANCE)   return null;
  final List<LibraryOrderEntry> libraries=findOrderEntriesContainingFile(file);
  if (libraries == null)   return null;
  PsiFile psiFile=PsiManager.getInstance(myProject).findFile(file);
  final String fqn=JavaEditorFileSwapper.getFQN(psiFile);
  if (fqn == null)   return null;
  if (JavaEditorFileSwapper.findSourceFile(myProject,file) != null)   return null;
  final EditorNotificationPanel panel=new EditorNotificationPanel();
  final VirtualFile sourceFile=findSourceFile(file);
  final AttachSourcesProvider.AttachSourcesAction defaultAction;
  if (sourceFile != null) {
    panel.setText(ProjectBundle.message("library.sources.not.attached"));
    defaultAction=new AttachJarAsSourcesAction(file,sourceFile,myProject);
  }
 else {
    panel.setText(ProjectBundle.message("library.sources.not.found"));
    defaultAction=new ChooseAndAttachSourcesAction(myProject);
  }
  TreeSet<AttachSourcesProvider.AttachSourcesAction> actions=new TreeSet<AttachSourcesProvider.AttachSourcesAction>(new Comparator<AttachSourcesProvider.AttachSourcesAction>(){
    public int compare(    AttachSourcesProvider.AttachSourcesAction o1,    AttachSourcesProvider.AttachSourcesAction o2){
      if (o1 == defaultAction)       return 1;
      if (o2 == defaultAction)       return -1;
      return o1.getName().compareToIgnoreCase(o2.getName());
    }
  }
);
  actions.add(defaultAction);
  for (  AttachSourcesProvider each : Extensions.getExtensions(EXTENSION_POINT_NAME)) {
    actions.addAll(each.getActions(libraries,psiFile));
  }
  for (  final AttachSourcesProvider.AttachSourcesAction each : actions) {
    panel.createActionLabel(GuiUtils.getTextWithoutMnemonicEscaping(each.getName()),new Runnable(){
      public void run(){
        if (!Comparing.equal(libraries,findOrderEntriesContainingFile(file))) {
          Messages.showErrorDialog(myProject,"Cannot find library for " + StringUtil.getShortName(fqn),"Error");
          return;
        }
        panel.setText(each.getBusyText());
        Runnable onFinish=new Runnable(){
          public void run(){
            SwingUtilities.invokeLater(new Runnable(){
              public void run(){
                panel.setText(ProjectBundle.message("library.sources.not.found"));
              }
            }
);
          }
        }
;
        ActionCallback callback=each.perform(findOrderEntriesContainingFile(file));
        callback.doWhenRejected(onFinish);
        callback.doWhenDone(onFinish);
      }
    }
);
  }
  return panel;
}
