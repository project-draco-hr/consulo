{
  int count=countChildren(filter);
  if (count == 0) {
    return TreeElement.EMPTY_ARRAY;
  }
  final TreeElement[] result=new TreeElement[count];
  count=0;
  for (TreeElement child=firstChild; child != null; child=child.getTreeNext()) {
    if (filter == null || filter.isInSet(child.getElementType())) {
      result[count++]=child;
    }
  }
  return result;
}
