{
  LOG.assertTrue(prev != this,"Loop in tree");
  if (parent == null)   return 0;
synchronized (PsiLock.LOCK) {
    CompositeElement parent=this.parent;
    int sum=0;
    while (parent != null) {
      sum+=parent.getModificationCount();
      parent=parent.getTreeParent();
    }
    recalcStartOffset(sum);
    return myStartOffset;
  }
}
