{
  ApplicationManager.getApplication().assertReadAccessAllowed();
  int count=countChildren(filter);
  if (count == 0) {
    return constructor.newPsiElementArray(0);
  }
  T[] result=constructor.newPsiElementArray(count);
  count=0;
  for (ASTNode child=getFirstChildNode(); child != null; child=child.getTreeNext()) {
    if (filter == null || filter.isInSet(child.getElementType())) {
      result[count++]=(T)SourceTreeToPsiMap.treeElementToPsi(child);
    }
  }
  return result;
}
