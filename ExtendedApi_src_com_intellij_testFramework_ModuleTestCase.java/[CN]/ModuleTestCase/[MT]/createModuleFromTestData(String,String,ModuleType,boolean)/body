{
  final File dirInTestDataFile=new File(dirInTestData);
  assertTrue(dirInTestDataFile.isDirectory());
  final File moduleDir=createTempDirectory();
  FileUtil.copyDir(dirInTestDataFile,moduleDir);
  final Module module=createModule(moduleDir + "/" + newModuleFileName,moduleType);
  VirtualFile root=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(moduleDir);
  if (addSourceRoot) {
    PsiTestUtil.addSourceContentToRoots(module,root);
  }
 else {
    PsiTestUtil.addContentRoot(module,root);
  }
  return module;
}
