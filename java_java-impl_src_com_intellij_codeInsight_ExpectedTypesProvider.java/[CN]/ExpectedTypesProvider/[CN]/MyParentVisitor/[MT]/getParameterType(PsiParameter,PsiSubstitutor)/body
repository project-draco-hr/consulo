{
  PsiType type=parameter.getType();
  LOG.assertTrue(type.isValid());
  if (parameter.isVarArgs()) {
    if (type instanceof PsiArrayType) {
      type=((PsiArrayType)type).getComponentType();
    }
 else {
      LOG.error("Vararg parameter with non-array type. Class=" + parameter.getClass() + "; type="+ parameter.getType());
    }
  }
  PsiType parameterType=substitutor.substitute(type);
  if (parameterType instanceof PsiCapturedWildcardType) {
    parameterType=((PsiCapturedWildcardType)parameterType).getWildcard();
  }
  if (parameterType instanceof PsiWildcardType) {
    final PsiWildcardType psiWildcardType=(PsiWildcardType)parameterType;
    if (psiWildcardType.isExtends()) {
      final PsiType superBound=psiWildcardType.getBound();
      if (superBound != null) {
        parameterType=superBound;
      }
    }
  }
  return parameterType;
}
