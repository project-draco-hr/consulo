{
  if (element == null)   return true;
  if (element instanceof PsiCompiledElement || !element.isPhysical()) {
    if (!processor.execute(element))     return false;
    for (    PsiElement child : element.getChildren()) {
      if (!processElements(child,processor))       return false;
    }
    return true;
  }
  final boolean[] result={true};
  element.accept(new PsiRecursiveElementWalkingVisitor(){
    @Override public void visitElement(    PsiElement element){
      if (processor.execute(element)) {
        super.visitElement(element);
      }
 else {
        stopWalking();
        result[0]=false;
      }
    }
  }
);
  return result[0];
}
