{
  final VirtualFile vFile=event.getFile();
  ApplicationManager.getApplication().runWriteAction(new ExternalChangeAction(){
    public void run(){
      VirtualFile parent=vFile.getParent();
      PsiDirectory parentDir=parent == null ? null : myVFileToPsiDirMap.get(parent);
      if (parentDir == null)       return;
      if (!vFile.isDirectory()) {
        PsiFile psiFile=findFile(vFile);
        if (psiFile != null && psiFile.getProject() == myManager.getProject()) {
          PsiTreeChangeEventImpl treeEvent=new PsiTreeChangeEventImpl(myManager);
          treeEvent.setParent(parentDir);
          myManager.beforeChildAddition(treeEvent);
          treeEvent.setChild(psiFile);
          myManager.childAdded(treeEvent);
        }
      }
 else {
        PsiDirectory psiDir=findDirectory(vFile);
        if (psiDir != null && psiDir.getProject() == myManager.getProject()) {
          PsiTreeChangeEventImpl treeEvent=new PsiTreeChangeEventImpl(myManager);
          treeEvent.setParent(parentDir);
          myManager.beforeChildAddition(treeEvent);
          treeEvent.setChild(psiDir);
          myManager.childAdded(treeEvent);
        }
      }
    }
  }
);
}
