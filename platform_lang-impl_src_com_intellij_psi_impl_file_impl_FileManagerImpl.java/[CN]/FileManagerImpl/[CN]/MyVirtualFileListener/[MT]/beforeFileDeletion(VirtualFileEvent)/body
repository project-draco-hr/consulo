{
  final VirtualFile vFile=event.getFile();
  VirtualFile parent=vFile.getParent();
  final PsiDirectory parentDir=parent == null ? null : myVFileToPsiDirMap.get(parent);
  if (parentDir == null)   return;
  ApplicationManager.getApplication().runWriteAction(new ExternalChangeAction(){
    public void run(){
      if (!vFile.isDirectory()) {
        PsiFile psiFile=getCachedPsiFile(vFile);
        if (psiFile != null) {
          PsiTreeChangeEventImpl treeEvent=new PsiTreeChangeEventImpl(myManager);
          treeEvent.setParent(parentDir);
          treeEvent.setChild(psiFile);
          myManager.beforeChildRemoval(treeEvent);
        }
      }
 else {
        PsiDirectory psiDir=findDirectory(vFile);
        if (psiDir != null) {
          PsiTreeChangeEventImpl treeEvent=new PsiTreeChangeEventImpl(myManager);
          treeEvent.setParent(parentDir);
          treeEvent.setChild(psiDir);
          myManager.beforeChildRemoval(treeEvent);
        }
      }
    }
  }
);
}
