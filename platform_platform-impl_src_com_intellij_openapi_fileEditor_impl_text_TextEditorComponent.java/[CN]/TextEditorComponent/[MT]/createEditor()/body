{
  EditorFactory editorFactory=EditorFactory.getInstance();
  Editor[] editors=editorFactory.getEditors(myDocument);
  if (editors.length == 1) {
    return editors[0];
  }
  final Editor editor=editorFactory.createEditor(myDocument,myProject);
  ((EditorMarkupModel)editor.getMarkupModel()).setErrorStripeVisible(true);
  EditorHighlighter highlighter=EditorHighlighterFactory.getInstance().createEditorHighlighter(myFile,EditorColorsManager.getInstance().getGlobalScheme(),myProject);
  ((EditorEx)editor).setHighlighter(highlighter);
  ((EditorEx)editor).setFile(myFile);
  editor.addEditorMouseListener(myEditorMouseListener);
  ((EditorEx)editor).addPropertyChangeListener(myEditorPropertyChangeListener);
  ((EditorImpl)editor).setDropHandler(new FileDropHandler(editor));
  TextEditorProvider.putTextEditor(editor,myTextEditor);
  return editor;
}
