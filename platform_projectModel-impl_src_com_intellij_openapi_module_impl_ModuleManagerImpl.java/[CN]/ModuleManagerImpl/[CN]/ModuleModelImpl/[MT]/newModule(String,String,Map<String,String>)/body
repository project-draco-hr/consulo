{
  assertWritable();
  final String dirUrl=dirPath == null ? null : VirtualFileManager.constructUrl(LocalFileSystem.PROTOCOL,dirPath);
  ModuleEx moduleEx=null;
  if (dirUrl != null) {
    moduleEx=getModuleByDirUrl(dirUrl);
  }
  if (moduleEx == null) {
    moduleEx=createModule(name,dirUrl);
    if (options != null) {
      for (      Map.Entry<String,String> option : options.entrySet()) {
        moduleEx.setOption(option.getKey(),option.getValue());
      }
    }
    initModule(moduleEx);
  }
  return moduleEx;
}
