{
  Runnable runnableWithProgress=new Runnable(){
    public void run(){
      for (      final Module module : myModuleModel.myPathToModule.values()) {
        final Application app=ApplicationManager.getApplication();
        final Runnable swingRunnable=new Runnable(){
          public void run(){
            app.runWriteAction(new Runnable(){
              public void run(){
                ((ModuleEx)module).moduleAdded();
                fireModuleAdded(module);
              }
            }
);
          }
        }
;
        if (app.isDispatchThread() || app.isHeadlessEnvironment()) {
          swingRunnable.run();
        }
 else {
          ProgressIndicator pi=ProgressManager.getInstance().getProgressIndicator();
          app.invokeAndWait(swingRunnable,pi.getModalityState());
        }
      }
    }
  }
;
  ProgressIndicator progressIndicator=myProgressManager.getProgressIndicator();
  if (progressIndicator == null) {
    myProgressManager.runProcessWithProgressSynchronously(runnableWithProgress,"Loading modules",false,myProject);
  }
 else {
    runnableWithProgress.run();
  }
  myModuleModel.projectOpened();
}
