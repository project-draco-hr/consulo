{
  myBeforeUndoRevision=getCurrentRevision(myFilePath,myDirectory);
  if (myBeforeUndoRevision == null)   return;
  try {
    rollbackTo(myAfterActionPerformedRevision);
    myBeforeUndoRevision=myBeforeUndoRevision.getNextRevision();
    if (myBeforeUndoRevision != null) {
synchronized (myLockedRevisions) {
        myLockedRevisions.add(myBeforeUndoRevision.getItem());
      }
    }
  }
 catch (  final IOException e) {
    myBeforeUndoRevision=null;
    Application application=ApplicationManager.getApplication();
    if (!application.isUnitTestMode()) {
      Runnable showDialogAction=new Runnable(){
        public void run(){
          Messages.showErrorDialog(CommonBundle.message("cannot.undo.command.error.message",e.getLocalizedMessage()),CommonBundle.message("cannot.undo.dialog.title"));
        }
      }
;
      if (application.isDispatchThread()) {
        showDialogAction.run();
      }
 else {
        application.invokeLater(showDialogAction);
      }
    }
 else {
      throw new RuntimeException(e);
    }
  }
}
