{
  if (getLocalVcs() == null) {
    return;
  }
  if (!getLocalVcs().isUnderVcs(vFile)) {
    return;
  }
  final DocumentReference newRef=new DocumentReferenceByVirtualFile(vFile);
  if (!vFile.isDirectory() && vFile.getFileType().isBinary()) {
    myUndoManager.undoableActionPerformed(new NonUndoableAction(){
      public DocumentReference[] getAffectedDocuments(){
        return new DocumentReference[]{newRef};
      }
      public boolean isComplex(){
        return isComplex;
      }
    }
);
  }
  DocumentReference oldRef=myUndoManager.findInvalidatedReferenceByUrl(vFile.getUrl());
  createNonUndoableAction(vFile,newRef,isComplex);
  if ((oldRef != null) && !oldRef.equals(newRef)) {
    createNonUndoableAction(vFile,oldRef,isComplex);
  }
}
