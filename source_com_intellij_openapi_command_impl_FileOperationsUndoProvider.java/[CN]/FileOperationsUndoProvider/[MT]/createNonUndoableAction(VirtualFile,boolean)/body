{
  DocumentReference newRef=new DocumentReferenceByVirtualFile(f);
  if (isDeletion)   newRef.beforeFileDeletion(f);
  registerNonUndoableAction(newRef);
  DocumentReference oldRef=myUndoManager.findInvalidatedReferenceByUrl(f.getUrl());
  if (oldRef != null && !oldRef.equals(newRef)) {
    registerNonUndoableAction(oldRef);
  }
}
