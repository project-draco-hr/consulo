{
  if (!getLocalVcs().isUnderVcs(vFile))   return;
  final String filePath=vFile.getPath();
  final boolean isDirectory=vFile.isDirectory();
  final LvcsRevision afterActionPerformedRevision=getCurrentRevision(filePath,isDirectory);
  if (afterActionPerformedRevision == null)   return;
synchronized (myLockedRevisions) {
    myLockedRevisions.add(afterActionPerformedRevision.getItem());
  }
  MyUndoableAction action=new MyUndoableAction(vFile,filePath,isDirectory,afterActionPerformedRevision);
  compositeUndoableAction.addAction(action);
  VirtualFile[] children=vFile.getChildren();
  if (children == null)   return;
  for (int i=0; i < children.length; i++) {
    addActionForFileTo(compositeUndoableAction,children[i]);
  }
}
