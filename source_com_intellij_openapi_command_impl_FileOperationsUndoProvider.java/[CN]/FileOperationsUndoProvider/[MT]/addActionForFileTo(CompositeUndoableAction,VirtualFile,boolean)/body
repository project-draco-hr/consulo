{
  final String filePath=vFile.getPath();
  final boolean isDirectory=vFile.isDirectory();
  final LvcsRevision afterActionPerformedRevision=getCurrentRevision(filePath,isDirectory);
  if (afterActionPerformedRevision == null)   return;
synchronized (myLockedRevisions) {
    myLockedRevisions.add(afterActionPerformedRevision);
  }
  LvcsBasedUndoableAction action=new LvcsBasedUndoableAction(vFile,filePath,isDirectory,afterActionPerformedRevision,isContentsAffected);
  compositeUndoableAction.addAction(action);
  VirtualFile[] children=vFile.getChildren();
  if (children == null)   return;
  for (  VirtualFile aChildren : children) {
    addActionForFileTo(compositeUndoableAction,aChildren,isContentsAffected);
  }
}
