{
  GroovyPsiElementFactory factory=GroovyPsiElementFactory.getInstance(stmt.getProject());
  GrReferenceExpression refExpr=factory.createReferenceExpressionFromText(refText);
  if (!replaceAllOccurrences) {
    expr.replaceWithExpression(refExpr,false);
  }
 else {
    PsiElement[] occurrences=GroovyRefactoringUtil.getExpressionOccurrences(expr,stmt);
    for (    PsiElement occurrence : occurrences) {
      if (occurrence instanceof GrExpression) {
        GrExpression grExpression=(GrExpression)occurrence;
        grExpression.replaceWithExpression(refExpr,true);
        refExpr=factory.createReferenceExpressionFromText(refText);
      }
 else {
        throw new IncorrectOperationException();
      }
    }
  }
}
