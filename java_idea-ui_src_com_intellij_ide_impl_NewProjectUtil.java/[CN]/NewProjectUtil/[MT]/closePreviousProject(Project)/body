{
  Project[] openProjects=ProjectManager.getInstance().getOpenProjects();
  if (openProjects.length > 0) {
    final GeneralSettings settings=GeneralSettings.getInstance();
    int exitCode=settings.getConfirmOpenNewProject();
    if (exitCode == GeneralSettings.OPEN_PROJECT_ASK) {
      exitCode=Messages.showOkCancelDialog(projectToClose,IdeBundle.message("prompt.open.project.in.new.frame"),IdeBundle.message("title.new.project"),IdeBundle.message("button.existingframe"),IdeBundle.message("button.newframe"),Messages.getQuestionIcon(),new ProjectNewWindowDoNotAskOption());
    }
    if (exitCode == DialogWrapper.OK_EXIT_CODE) {
      ProjectUtil.closeAndDispose(projectToClose != null ? projectToClose : openProjects[openProjects.length - 1]);
    }
  }
}
