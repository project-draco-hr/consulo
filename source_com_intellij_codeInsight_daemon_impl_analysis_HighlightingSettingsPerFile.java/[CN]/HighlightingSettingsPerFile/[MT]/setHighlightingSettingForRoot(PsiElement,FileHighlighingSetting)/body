{
  final PsiFile containingFile=root.getContainingFile();
  FileHighlighingSetting[] defaults=myHighlightSettings.get(containingFile.getVirtualFile());
  if (defaults == null)   defaults=getDefaults(containingFile.getLanguage()).clone();
  defaults[PsiUtil.getRootIndex(root)]=setting;
  boolean toRemove=true;
  for (  FileHighlighingSetting aDefault : defaults) {
    if (aDefault != FileHighlighingSetting.NONE)     toRemove=false;
  }
  if (!toRemove)   myHighlightSettings.put(containingFile.getVirtualFile(),defaults);
 else   myHighlightSettings.remove(containingFile.getVirtualFile());
}
