{
  final VirtualFile file=fileSystemTree.getSelectedFile();
  if (file == null || !file.isDirectory())   return;
  String newFolderName;
  while (true) {
    newFolderName=Messages.showInputDialog(UIBundle.message("create.new.folder.enter.new.folder.name.prompt.text"),UIBundle.message("new.folder.dialog.title"),Messages.getQuestionIcon());
    if (newFolderName == null) {
      return;
    }
    if ("".equals(newFolderName.trim())) {
      Messages.showMessageDialog(UIBundle.message("create.new.folder.folder.name.cannot.be.empty.error.message"),UIBundle.message("error.dialog.title"),Messages.getErrorIcon());
      continue;
    }
    Exception failReason=((FileSystemTreeImpl)fileSystemTree).createNewFolder(file,newFolderName);
    if (failReason != null) {
      Messages.showMessageDialog(UIBundle.message("create.new.folder.could.not.create.folder.error.message",newFolderName),UIBundle.message("error.dialog.title"),Messages.getErrorIcon());
      continue;
    }
    return;
  }
}
