{
  final VirtualFile file=fileSystemTree.getSelectedFile();
  if (file == null || !file.isDirectory())   return;
  String newFolderName;
  while (true) {
    newFolderName=Messages.showInputDialog("Enter a new folder name:","New Folder",Messages.getQuestionIcon());
    if (newFolderName == null) {
      return;
    }
    if ("".equals(newFolderName.trim())) {
      Messages.showMessageDialog("Folder name cannot be empty","Error",Messages.getErrorIcon());
      continue;
    }
    Exception failReason=((FileSystemTreeImpl)fileSystemTree).createNewFolder(file,newFolderName);
    if (failReason != null) {
      Messages.showMessageDialog("Could not create folder '" + newFolderName + "'","Error",Messages.getErrorIcon());
      continue;
    }
    return;
  }
}
