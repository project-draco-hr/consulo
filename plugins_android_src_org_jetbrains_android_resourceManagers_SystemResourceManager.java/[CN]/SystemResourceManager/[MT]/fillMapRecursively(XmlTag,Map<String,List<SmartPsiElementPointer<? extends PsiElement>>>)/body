{
  XmlAttribute idAttr=tag.getAttribute("id",SdkConstants.NS_RESOURCES);
  if (idAttr != null) {
    XmlAttributeValue idAttrValue=idAttr.getValueElement();
    if (idAttrValue != null) {
      if (AndroidResourceUtil.isIdDeclaration(idAttrValue)) {
        String id=AndroidResourceUtil.getResourceNameByReferenceText(idAttrValue.getValue());
        if (id != null) {
          List<SmartPsiElementPointer<? extends PsiElement>> list=result.get(id);
          if (list == null) {
            list=new ArrayList<SmartPsiElementPointer<? extends PsiElement>>();
            result.put(id,list);
          }
          final SmartPointerManager manager=SmartPointerManager.getInstance(tag.getProject());
          list.add(manager.createSmartPsiElementPointer(idAttr));
        }
      }
    }
  }
  for (  XmlTag subtag : tag.getSubTags()) {
    fillMapRecursively(subtag,result);
  }
}
