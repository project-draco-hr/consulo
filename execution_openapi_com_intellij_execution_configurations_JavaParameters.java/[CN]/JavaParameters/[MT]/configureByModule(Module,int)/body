{
  if ((classPathType & JDK_ONLY) != 0) {
    final ModuleRootManager rootManager=ModuleRootManager.getInstance(module);
    final ProjectJdk jdk=rootManager.getJdk();
    if (jdk == null) {
      throw CantRunException.noJdkForModule(module);
    }
    myJdk=jdk;
    final VirtualFile homeDirectory=jdk.getHomeDirectory();
    if (homeDirectory == null || !homeDirectory.isValid()) {
      throw CantRunException.jdkMisconfigured(jdk,module);
    }
  }
  if ((classPathType & CLASSES_ONLY) == 0) {
    return;
  }
  ProjectRootsTraversing.collectRoots(module,(classPathType & TESTS_ONLY) != 0 ? ProjectRootsTraversing.FULL_CLASSPATH_RECURSIVE : ProjectRootsTraversing.FULL_CLASSPATH_WITHOUT_TESTS,myClassPath);
}
