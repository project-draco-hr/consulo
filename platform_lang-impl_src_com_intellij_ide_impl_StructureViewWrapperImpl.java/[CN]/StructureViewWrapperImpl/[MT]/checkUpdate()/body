{
  if (myProject.isDisposed())   return;
  Window mywindow=SwingUtilities.windowForComponent(myPanel);
  if (mywindow != null && !mywindow.isActive())   return;
  final KeyboardFocusManager focusManager=KeyboardFocusManager.getCurrentKeyboardFocusManager();
  final Window focusWindow=focusManager.getFocusedWindow();
  if (focusWindow == mywindow) {
    final Component owner=focusManager.getFocusOwner();
    if (owner instanceof IdeRootPane)     return;
    final DataContext dataContext=DataManager.getInstance().getDataContext(owner);
    if (dataContext.getData(myKey) == this)     return;
    final VirtualFile[] files=PlatformDataKeys.VIRTUAL_FILE_ARRAY.getData(dataContext);
    if (files != null && files.length == 1) {
      setFile(files[0]);
    }
 else {
      setFile(null);
    }
  }
}
