{
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  boolean hadFocus=myStructureView != null && IJSwingUtilities.hasFocus2(myStructureView.getComponent()) || myModuleStructureComponent != null && IJSwingUtilities.hasFocus2(myModuleStructureComponent);
  if (myStructureView != null) {
    myStructureView.storeState();
    Disposer.dispose(myStructureView);
    myStructureView=null;
  }
  if (myModuleStructureComponent != null) {
    Disposer.dispose(myModuleStructureComponent);
    myModuleStructureComponent=null;
  }
  myPanel.removeAll();
  if (!isStructureViewShowing()) {
    return;
  }
  if (myModule != null) {
    myModuleStructureComponent=new ModuleStructureComponent(myModule);
    myPanel.add(myModuleStructureComponent,BorderLayout.CENTER);
    if (hadFocus) {
      JComponent focusedComponent=IdeFocusTraversalPolicy.getPreferredFocusedComponent(myModuleStructureComponent);
      if (focusedComponent != null) {
        focusedComponent.requestFocus();
      }
    }
  }
 else   if (myFileEditor != null && myFileEditor.isValid()) {
    final StructureViewBuilder structureViewBuilder=myFileEditor.getStructureViewBuilder();
    if (structureViewBuilder != null) {
      myStructureView=structureViewBuilder.createStructureView(myFileEditor,myProject);
      myPanel.add(myStructureView.getComponent(),BorderLayout.CENTER);
      if (hadFocus) {
        JComponent focusedComponent=IdeFocusTraversalPolicy.getPreferredFocusedComponent(myStructureView.getComponent());
        if (focusedComponent != null) {
          focusedComponent.requestFocus();
        }
      }
      myStructureView.restoreState();
      myStructureView.centerSelectedRow();
    }
  }
  if (myModuleStructureComponent == null && myStructureView == null) {
    myPanel.add(new JLabel(IdeBundle.message("message.nothing.to.show.in.structure.view"),SwingConstants.CENTER),BorderLayout.CENTER);
  }
  myPanel.validate();
  myPanel.repaint();
}
