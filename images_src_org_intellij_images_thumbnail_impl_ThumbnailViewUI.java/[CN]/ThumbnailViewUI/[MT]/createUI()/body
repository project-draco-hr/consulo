{
  if (cellRenderer == null || list == null) {
    cellRenderer=new ThumbnailListCellRenderer();
    ImageComponent imageComponent=cellRenderer.getImageComponent();
    VirtualFileManager.getInstance().addVirtualFileListener(vfsListener);
    Options options=OptionsManager.getInstance().getOptions();
    EditorOptions editorOptions=options.getEditorOptions();
    TransparencyChessboardOptions chessboardOptions=editorOptions.getTransparencyChessboardOptions();
    imageComponent.setTransparencyChessboardVisible(chessboardOptions.isShowDefault());
    imageComponent.setTransparencyChessboardCellSize(chessboardOptions.getCellSize());
    imageComponent.setTransparencyChessboardWhiteColor(chessboardOptions.getWhiteColor());
    imageComponent.setTransparencyChessboardBlankColor(chessboardOptions.getBlackColor());
    options.addPropertyChangeListener(optionsListener);
    list=new JBList();
    list.setModel(new DefaultListModel());
    list.setLayoutOrientation(JList.HORIZONTAL_WRAP);
    list.setVisibleRowCount(-1);
    list.setCellRenderer(cellRenderer);
    list.setSelectionMode(ListSelectionModel.MULTIPLE_INTERVAL_SELECTION);
    ThumbnailsMouseAdapter mouseListener=new ThumbnailsMouseAdapter();
    list.addMouseListener(mouseListener);
    list.addMouseMotionListener(mouseListener);
    ThumbnailComponentUI componentUI=(ThumbnailComponentUI)UIManager.getUI(cellRenderer);
    Dimension preferredSize=componentUI.getPreferredSize(cellRenderer);
    list.setFixedCellWidth(preferredSize.width);
    list.setFixedCellHeight(preferredSize.height);
    JScrollPane scrollPane=ScrollPaneFactory.createScrollPane(list,ScrollPaneConstants.VERTICAL_SCROLLBAR_AS_NEEDED,ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
    scrollPane.setBorder(IdeBorderFactory.createBorder(SideBorder.TOP));
    ActionManager actionManager=ActionManager.getInstance();
    ActionGroup actionGroup=(ActionGroup)actionManager.getAction(ThumbnailViewActions.GROUP_TOOLBAR);
    ActionToolbar actionToolbar=actionManager.createActionToolbar(ThumbnailViewActions.ACTION_PLACE,actionGroup,true);
    actionToolbar.setTargetComponent(this);
    JComponent toolbar=actionToolbar.getComponent();
    FocusRequester focusRequester=new FocusRequester();
    toolbar.addMouseListener(focusRequester);
    scrollPane.addMouseListener(focusRequester);
    add(toolbar,BorderLayout.NORTH);
    add(scrollPane,BorderLayout.CENTER);
  }
}
