{
  PsiElement scope=DfaUtil.getTopmostBlockInSameClass(forPlace);
  if (scope == null) {
    PsiFile file=forPlace.getContainingFile();
    if (!(file instanceof PsiCodeFragment)) {
      return Collections.emptyMap();
    }
    scope=file;
  }
  DataFlowRunner runner=new DataFlowRunner(){
    @Override protected DfaMemoryState createMemoryState(){
      return new ExpressionTypeMemoryState(getFactory());
    }
  }
;
  final ExpressionTypeInstructionVisitor visitor=new ExpressionTypeInstructionVisitor(forPlace);
  if (runner.analyzeMethod(scope,visitor) == RunnerResult.OK) {
    return visitor.getResult();
  }
  return null;
}
