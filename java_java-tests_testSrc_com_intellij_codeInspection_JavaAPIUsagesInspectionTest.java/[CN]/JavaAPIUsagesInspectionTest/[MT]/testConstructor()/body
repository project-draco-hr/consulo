{
  final LanguageLevel[] languageLevel={null};
  try {
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      @Override public void run(){
        ModifiableRootModel model=ModuleRootManager.getInstance(getModule()).getModifiableModel();
        LanguageLevelModuleExtension extension=model.getModuleExtension(LanguageLevelModuleExtension.class);
        languageLevel[0]=extension.getLanguageLevel();
        extension.setLanguageLevel(LanguageLevel.JDK_1_4);
        model.commit();
      }
    }
);
    doTest();
  }
  finally {
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      @Override public void run(){
        ModifiableRootModel model=ModuleRootManager.getInstance(getModule()).getModifiableModel();
        LanguageLevelModuleExtension extension=model.getModuleExtension(LanguageLevelModuleExtension.class);
        extension.setLanguageLevel(languageLevel[0]);
        model.commit();
      }
    }
);
  }
}
