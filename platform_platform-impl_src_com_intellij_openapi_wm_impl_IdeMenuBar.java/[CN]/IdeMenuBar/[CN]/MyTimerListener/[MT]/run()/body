{
  if (!isShowing()) {
    return;
  }
  final Window myWindow=SwingUtilities.windowForComponent(IdeMenuBar.this);
  if (myWindow != null && !myWindow.isActive())   return;
  final MenuSelectionManager menuSelectionManager=MenuSelectionManager.defaultManager();
  final MenuElement[] selectedPath=menuSelectionManager.getSelectedPath();
  if (selectedPath.length > 0) {
    return;
  }
  final Window window=KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusedWindow();
  if (window instanceof Dialog) {
    if (((Dialog)window).isModal()) {
      return;
    }
  }
  updateMenuActions();
  if (UIUtil.isWinLafOnVista()) {
    repaint();
  }
}
