{
  Writer writer=new OutputStreamWriter(new FileOutputStream(filePath));
  try {
    List<FilePatch> patches=PatchBuilder.buildPatch(changes,gw.getBaseDir(),false,isReverse);
    String lineSeparator=CodeStyleSettingsManager.getInstance(gw.getProject()).getCurrentSettings().getLineSeparator();
    UnifiedDiffWriter.write(patches,writer,lineSeparator);
  }
  finally {
    writer.close();
  }
}
