{
  if (actionGroup == null) {
    actionGroup=new DefaultActionGroup();
    syncAction=new AnAction("Synchronize with Plugin Repository","Synchronize with Plugin Repository",IconLoader.getIcon("/actions/sync.png")){
      public void update(      AnActionEvent e){
        Presentation presentation=e.getPresentation();
        boolean enabled=false;
        if (tabs.getSelectedIndex() == AVAILABLE_TAB) {
          enabled=true;
        }
        presentation.setEnabled(enabled);
      }
      public void actionPerformed(      AnActionEvent e){
        root=null;
        pluginInfoUpdate(null);
        loadAvailablePlugins();
      }
    }
;
    syncAction.registerCustomShortcutSet(new CustomShortcutSet(KeymapManager.getInstance().getActiveKeymap().getShortcuts("Synchronize")),main);
    actionGroup.add(syncAction);
    updatePluginsAction=new AnAction("Update Installed Plugins","Update Installed Plugins",IconLoader.getIcon("/actions/refresh.png")){
      public void actionPerformed(      AnActionEvent e){
        if (availablePluginTable == null) {
          loadAvailablePlugins();
        }
        if (root != null)         do {
          try {
            List<PluginNode> updateList=new ArrayList<PluginNode>();
            checkForUpdate(updateList,root);
            if (updateList.size() == 0) {
              Messages.showMessageDialog(main,"Nothing to update","Plugin Manager",Messages.getInformationIcon());
              break;
            }
 else {
              Set<PluginNode> pluginsToUpdate=new HashSet<PluginNode>();
              final PluginDescriptor[] installedPlugins=PluginManager.getPlugins();
              for (              PluginNode pluginNode : updateList) {
                for (                PluginDescriptor descriptor : installedPlugins) {
                  if (descriptor.getPluginId().equals(pluginNode.getId())) {
                    pluginsToUpdate.add(pluginNode);
                  }
                }
              }
              DialogWrapper dlg=new PluginsToUpdateChooser(pluginsToUpdate);
              dlg.show();
              if (dlg.isOK()) {
                if (downloadPlugins(new ArrayList<PluginNode>(pluginsToUpdate))) {
                  availablePluginTable.updateUI();
                  requireShutdown=true;
                }
              }
              break;
            }
          }
 catch (          IOException e1) {
            if (!IOExceptionDialog.showErrorDialog(e1,"Update Installed Plugins","Plugins updating failed")) {
              break;
            }
 else {
              LOG.error(e1);
            }
          }
        }
 while (true);
      }
    }
;
    actionGroup.add(updatePluginsAction);
    final String downloadMessage="Download and Install Plugin";
    final String updateMessage="Update Plugin";
    installPluginAction=new AnAction(downloadMessage,downloadMessage,IconLoader.getIcon("/actions/install.png")){
      public void update(      AnActionEvent e){
        Presentation presentation=e.getPresentation();
        boolean enabled=false;
        PluginTable table=tabs.getSelectedIndex() == AVAILABLE_TAB ? availablePluginTable : installedPluginTable;
        if ((tabs.getSelectedIndex() == AVAILABLE_TAB && availablePluginTable != null) || (tabs.getSelectedIndex() == INSTALLED_TAB && installedPluginTable != null)) {
          Object pluginObject=table.getSelectedObject();
          if (pluginObject instanceof PluginNode) {
            int status=PluginManagerColumnInfo.getRealNodeState((PluginNode)pluginObject);
            if (status == PluginNode.STATUS_MISSING || status == PluginNode.STATUS_NEWEST || status == PluginNode.STATUS_OUT_OF_DATE || status == PluginNode.STATUS_UNKNOWN) {
              enabled=true;
            }
            presentation.setText(downloadMessage);
          }
 else           if (pluginObject instanceof PluginDescriptor) {
            presentation.setText(updateMessage);
            presentation.setDescription(updateMessage);
            enabled=true;
          }
        }
        presentation.setEnabled(enabled);
      }
      public void actionPerformed(      AnActionEvent e){
        do {
          try {
            if (root == null) {
              loadAvailablePlugins();
            }
            final boolean isUpdate=tabs.getSelectedIndex() == INSTALLED_TAB;
            PluginTable pluginTable=isUpdate ? installedPluginTable : availablePluginTable;
            if (pluginTable == null)             return;
            final Object selectedObject=pluginTable.getSelectedObject();
            PluginNode pluginNode;
            if (selectedObject instanceof PluginNode) {
              pluginNode=(PluginNode)selectedObject;
            }
 else             if (selectedObject instanceof PluginDescriptor) {
              final PluginDescriptor pluginDescriptor=(PluginDescriptor)selectedObject;
              pluginNode=new PluginNode(pluginDescriptor.getPluginId());
              pluginNode.setName(pluginDescriptor.getName());
              pluginNode.setDepends(Arrays.asList(pluginDescriptor.getDependentPluginIds()));
              pluginNode.setSize("-1");
              boolean smthFoundToUpdate=false;
              ArrayList<PluginNode> toUpdate=new ArrayList<PluginNode>();
              try {
                checkForUpdate(toUpdate,root);
                for (                PluginNode node : toUpdate) {
                  if (node.getId().equals(pluginDescriptor.getPluginId())) {
                    smthFoundToUpdate=true;
                  }
                }
                if (!smthFoundToUpdate) {
                  Messages.showMessageDialog(main,"Nothing to update","Plugin Manager",Messages.getInformationIcon());
                  return;
                }
              }
 catch (              IOException e1) {
                LOG.error(e1);
              }
            }
 else {
              return;
            }
            final String message=isUpdate ? updateMessage : downloadMessage;
            if (Messages.showYesNoDialog(main,"Would you like to " + message.toLowerCase() + "\""+ pluginNode.getName()+ "\"?",message,Messages.getQuestionIcon()) == 0) {
              if (downloadPlugin(pluginNode)) {
                requireShutdown=true;
                if (availablePluginTable != null) {
                  availablePluginTable.updateUI();
                }
              }
            }
            break;
          }
 catch (          IOException e1) {
            if (!IOExceptionDialog.showErrorDialog(e1,downloadMessage,"Plugin download failed")) {
              break;
            }
 else {
              LOG.error(e1);
            }
          }
        }
 while (true);
      }
    }
;
    actionGroup.add(installPluginAction);
    uninstallPluginAction=new AnAction("Uninstall Plugin","Uninstall Plugin",IconLoader.getIcon("/actions/uninstall.png")){
      public void update(      AnActionEvent e){
        Presentation presentation=e.getPresentation();
        boolean enabled=false;
        if (installedPluginTable != null && tabs.getSelectedIndex() == INSTALLED_TAB) {
          PluginDescriptor pluginDescriptor=installedPluginTable.getSelectedObject();
          if (pluginDescriptor != null && !pluginDescriptor.isDeleted()) {
            enabled=true;
          }
        }
        presentation.setEnabled(enabled);
      }
      public void actionPerformed(      AnActionEvent e){
        PluginId pluginId=null;
        if (tabs.getSelectedIndex() == INSTALLED_TAB) {
          PluginDescriptor pluginDescriptor=installedPluginTable.getSelectedObject();
          if (pluginDescriptor != null) {
            if (Messages.showYesNoDialog(main,"Do you really want to uninstall plugin \"" + pluginDescriptor.getName() + "\"?","Plugin Uninstall",Messages.getQuestionIcon()) == 0) {
              pluginId=pluginDescriptor.getPluginId();
              pluginDescriptor.setDeleted(true);
            }
          }
        }
        if (pluginId != null) {
          try {
            PluginInstaller.prepareToUninstall(pluginId);
            requireShutdown=true;
            installedPluginTable.updateUI();
          }
 catch (          IOException e1) {
            LOG.equals(e1);
          }
        }
      }
    }
;
    actionGroup.add(uninstallPluginAction);
  }
  return actionGroup;
}
