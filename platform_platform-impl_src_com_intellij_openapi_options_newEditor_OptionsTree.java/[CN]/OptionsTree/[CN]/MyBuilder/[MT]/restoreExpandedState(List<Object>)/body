{
  TreePath[] selected=myTree.getSelectionPaths();
  if (selected == null) {
    selected=new TreePath[0];
  }
  List<TreePath> toCollapse=new ArrayList<TreePath>();
  for (int eachRow=0; eachRow < myTree.getRowCount(); eachRow++) {
    if (!myTree.isExpanded(eachRow))     continue;
    TreePath eachVisiblePath=myTree.getPathForRow(eachRow);
    if (eachVisiblePath == null)     continue;
    Object eachElement=myBuilder.getElementFor(eachVisiblePath.getLastPathComponent());
    if (toRestore.contains(eachElement))     continue;
    for (    TreePath eachSelected : selected) {
      if (!eachVisiblePath.isDescendant(eachSelected)) {
        toCollapse.add(eachVisiblePath);
      }
    }
  }
  for (  TreePath each : toCollapse) {
    myTree.collapsePath(each);
  }
}
