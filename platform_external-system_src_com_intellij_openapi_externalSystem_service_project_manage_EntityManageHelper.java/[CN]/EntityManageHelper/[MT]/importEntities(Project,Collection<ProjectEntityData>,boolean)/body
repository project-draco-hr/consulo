{
  final Set<ModuleData> modules=ContainerUtilRt.newHashSet();
  final Map<ModuleData,Collection<ContentRootData>> contentRoots=ContainerUtilRt.newHashMap();
  final Set<LibraryData> libraries=ContainerUtilRt.newHashSet();
  final Set<JarData> jars=ContainerUtilRt.newHashSet();
  final Map<ModuleData,Collection<DependencyData>> dependencies=ContainerUtilRt.newHashMap();
  ExternalEntityVisitor visitor=new ExternalEntityVisitor(){
    @Override public void visit(    @NotNull ProjectData project){
    }
    @Override public void visit(    @NotNull ModuleData module){
      modules.add(module);
    }
    @Override public void visit(    @NotNull LibraryData library){
      libraries.add(library);
    }
    @Override public void visit(    @NotNull JarData jar){
      jars.add(jar);
    }
    @Override public void visit(    @NotNull ModuleDependencyData dependency){
      addDependency(dependency);
    }
    @Override public void visit(    @NotNull LibraryDependencyData dependency){
      addDependency(dependency);
    }
    @Override public void visit(    @NotNull CompositeLibraryDependencyData dependency){
    }
    @Override public void visit(    @NotNull ContentRootData contentRoot){
      Collection<ContentRootData> roots=contentRoots.get(contentRoot.getOwnerModule());
      if (roots == null) {
        contentRoots.put(contentRoot.getOwnerModule(),roots=ContainerUtilRt.<ContentRootData>newHashSet());
      }
      roots.add(contentRoot);
    }
    private void addDependency(    @NotNull DependencyData dependency){
      Collection<DependencyData> d=dependencies.get(dependency.getOwnerModule());
      if (d == null) {
        dependencies.put(dependency.getOwnerModule(),d=ContainerUtilRt.<DependencyData>newHashSet());
      }
      d.add(dependency);
    }
  }
;
  for (  ProjectEntityData entity : entities) {
    entity.invite(visitor);
  }
  myModuleManager.importModules(modules,project,false,synchronous);
  for (  Map.Entry<ModuleData,Collection<ContentRootData>> entry : contentRoots.entrySet()) {
    Module module=myProjectStructureHelper.findIdeModule(entry.getKey(),project);
    if (module != null) {
      myContentRootManager.importContentRoots(entry.getValue(),module,synchronous);
    }
  }
  myLibraryManager.importLibraries(libraries,project,synchronous);
  myJarManager.importJars(jars,project,synchronous);
  for (  Map.Entry<ModuleData,Collection<DependencyData>> entry : dependencies.entrySet()) {
    Module module=myProjectStructureHelper.findIdeModule(entry.getKey(),project);
    if (module != null) {
      myDependencyManager.importDependencies(entry.getValue(),module,synchronous);
    }
  }
}
