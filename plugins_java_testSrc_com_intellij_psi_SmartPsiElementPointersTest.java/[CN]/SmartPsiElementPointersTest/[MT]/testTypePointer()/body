{
  PsiClass aClass=myJavaFacade.findClass("AClass",GlobalSearchScope.allScope(getProject()));
  final PsiTypeElement typeElement=myJavaFacade.findClass("Test",GlobalSearchScope.allScope(getProject())).getFields()[0].getTypeElement();
  SmartPsiElementPointer typePointer=SmartPointerManager.getInstance(myProject).createSmartPsiElementPointer(typeElement);
  SmartPsiElementPointer classPointer=SmartPointerManager.getInstance(myProject).createSmartPsiElementPointer(aClass);
  Document aClassDocument=PsiDocumentManager.getInstance(myProject).getDocument(aClass.getContainingFile());
  Document testDocument=PsiDocumentManager.getInstance(myProject).getDocument(typeElement.getContainingFile());
  assertNotSame(aClassDocument,testDocument);
  aClassDocument.insertString(aClass.getTextOffset(),"/**/");
  testDocument.insertString(typeElement.getTextOffset(),"/**/");
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  PsiElement element=typePointer.getElement();
  assertNotNull(element);
  assertTrue(element instanceof PsiTypeElement);
  assertTrue(element.isValid());
  assertEquals(classPointer.getElement(),PsiUtil.resolveClassInType(((PsiTypeElement)element).getType()));
}
