{
  final PsiClass aClass=myJavaFacade.findClass("AClass",GlobalSearchScope.allScope(getProject()));
  assertNotNull(aClass);
  Document document=PsiDocumentManager.getInstance(myProject).getDocument(aClass.getContainingFile());
  final SmartPsiElementPointer[] pointer=new SmartPsiElementPointer[1];
  int offset=aClass.getTextOffset();
  DocumentListener listener=new DocumentListener(){
    @Override public void beforeDocumentChange(    DocumentEvent event){
      pointer[0]=SmartPointerManager.getInstance(myProject).createSmartPsiElementPointer(aClass);
    }
    @Override public void documentChanged(    DocumentEvent event){
    }
  }
;
  EditorEventMulticaster multicaster=EditorFactory.getInstance().getEventMulticaster();
  multicaster.addDocumentListener(listener);
  try {
    document.insertString(offset,"/******/");
  }
  finally {
    multicaster.removeDocumentListener(listener);
  }
  pointer[0].getElement();
  document.insertString(0,"/**/");
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  PsiElement element=pointer[0].getElement();
  assertNotNull(element);
  assertTrue(element instanceof PsiClass);
  assertTrue(element.isValid());
}
