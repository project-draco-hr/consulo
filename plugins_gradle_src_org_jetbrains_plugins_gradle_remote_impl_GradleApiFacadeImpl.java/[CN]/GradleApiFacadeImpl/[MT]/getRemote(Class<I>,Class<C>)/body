{
  Object cachedResult=myRemotes.get(implClass);
  if (cachedResult != null) {
    return (I)cachedResult;
  }
  final C result=implClass.newInstance();
  RemoteGradleProcessSettings settings=mySettings.get();
  if (settings != null) {
    result.setSettings(settings);
  }
  result.setNotificationListener(myNotificationListener.get());
  I proxy=(I)Proxy.newProxyInstance(getClass().getClassLoader(),new Class<?>[]{interfaceClass},new InvocationHandler(){
    @Override public Object invoke(    Object proxy,    Method method,    Object[] args) throws Throwable {
      myCallsInProgressNumber.incrementAndGet();
      try {
        return method.invoke(result,args);
      }
  finally {
        myCallsInProgressNumber.decrementAndGet();
        updateAutoShutdownTime();
      }
    }
  }
);
  try {
    I stub=(I)UnicastRemoteObject.exportObject(proxy,0);
    I stored=(I)myRemotes.putIfAbsent(implClass,stub);
    return stored == null ? result : stored;
  }
 catch (  RemoteException e) {
    Object raceResult=myRemotes.get(implClass);
    if (raceResult != null) {
      return (I)raceResult;
    }
 else {
      throw new IllegalStateException(String.format("Can't prepare remote service for interface '%s', implementation '%s'",interfaceClass,implClass),e);
    }
  }
}
