{
  final PsiExpression context=PsiTreeUtil.getParentOfType(position,PsiExpression.class);
  if (context == null)   return;
  final Map<PsiExpression,PsiType> map=GuessManager.getInstance(position.getProject()).getControlFlowExpressionTypes(context);
  for (  final PsiExpression expression : map.keySet()) {
    final PsiType castType=map.get(expression);
    final PsiType baseType=expression.getType();
    if (expectedType == null || (expectedType.isAssignableFrom(castType) && (baseType == null || !expectedType.isAssignableFrom(baseType)))) {
      consumer.consume(CastingLookupElementDecorator.createCastingElement(expressionToLookupElement(expression),castType));
    }
  }
}
