{
  final DefaultTreeModel model=new DefaultTreeModel(new DefaultMutableTreeNode());
  myTree=new Tree(model);
  final ProjectAbstractTreeStructureBase treeStructure=new AbstractProjectTreeStructure(myProject){
    public boolean isFlattenPackages(){
      return false;
    }
    public boolean isShowMembers(){
      return false;
    }
    public boolean isHideEmptyMiddlePackages(){
      return true;
    }
    public Object[] getChildElements(    final Object element){
      return filterFiles(super.getChildElements(element));
    }
    public boolean isAbbreviatePackageNames(){
      return false;
    }
    public boolean isShowLibraryContents(){
      return myShowLibraryContents;
    }
    public boolean isShowModules(){
      return false;
    }
    public List<TreeStructureProvider> getProviders(){
      return myDisableStructureProviders ? null : super.getProviders();
    }
  }
;
  myBuilder=new ProjectTreeBuilder(myProject,myTree,model,AlphaComparator.INSTANCE,treeStructure);
  myTree.setRootVisible(false);
  myTree.expandRow(0);
  myTree.getSelectionModel().setSelectionMode(TreeSelectionModel.SINGLE_TREE_SELECTION);
  myTree.setCellRenderer(new NodeRenderer());
  UIUtil.setLineStyleAngled(myTree);
  final JScrollPane scrollPane=new JScrollPane(myTree);
  scrollPane.setPreferredSize(new Dimension(500,300));
  myTree.addKeyListener(new KeyAdapter(){
    public void keyPressed(    final KeyEvent e){
      if (KeyEvent.VK_ENTER == e.getKeyCode()) {
        doOKAction();
      }
    }
  }
);
  myTree.addMouseListener(new MouseAdapter(){
    public void mouseClicked(    final MouseEvent e){
      if (e.getClickCount() == 2) {
        final TreePath path=myTree.getPathForLocation(e.getX(),e.getY());
        if (path != null && myTree.isPathSelected(path)) {
          doOKAction();
        }
      }
    }
  }
);
  myTree.addTreeSelectionListener(new TreeSelectionListener(){
    public void valueChanged(    final TreeSelectionEvent e){
      handleSelectionChanged();
    }
  }
);
  new TreeSpeedSearch(myTree);
  myTabbedPane=new TabbedPaneWrapper(getDisposable());
  final JPanel dummyPanel=new JPanel(new BorderLayout());
  String name=null;
  if (myInitialFile != null) {
    name=myInitialFile.getName();
  }
  PsiElement context=myInitialFile == null ? null : myInitialFile;
  myGotoByNamePanel=new ChooseByNamePanel(myProject,new MyGotoFileModel(),name,true,context){
    protected void close(    final boolean isOk){
      super.close(isOk);
      if (isOk) {
        doOKAction();
      }
 else {
        doCancelAction();
      }
    }
    protected void initUI(    final ChooseByNamePopupComponent.Callback callback,    final ModalityState modalityState,    boolean allowMultipleSelection){
      super.initUI(callback,modalityState,allowMultipleSelection);
      dummyPanel.add(myGotoByNamePanel.getPanel(),BorderLayout.CENTER);
    }
    protected void choosenElementMightChange(){
      handleSelectionChanged();
    }
  }
;
  myTabbedPane.addTab(IdeBundle.message("tab.chooser.project"),scrollPane);
  myTabbedPane.addTab(IdeBundle.message("tab.chooser.search.by.name"),dummyPanel);
  SwingUtilities.invokeLater(new Runnable(){
    public void run(){
      myGotoByNamePanel.invoke(new MyCallback(),ModalityState.stateForComponent(getRootPane()),false);
    }
  }
);
  myTabbedPane.addChangeListener(new ChangeListener(){
    public void stateChanged(    final ChangeEvent e){
      handleSelectionChanged();
    }
  }
);
  return myTabbedPane.getComponent();
}
