{
  final DefaultTreeModel model=new DefaultTreeModel(new DefaultMutableTreeNode());
  myTree=new Tree(model);
  final ProjectAbstractTreeStructureBase treeStructure=new AbstractProjectTreeStructure(myProject){
    @Override public boolean isFlattenPackages(){
      return false;
    }
    @Override public boolean isShowMembers(){
      return false;
    }
    @Override public boolean isHideEmptyMiddlePackages(){
      return true;
    }
    @Override public Object[] getChildElements(    final Object element){
      return filterFiles(super.getChildElements(element));
    }
    @Override public boolean isAbbreviatePackageNames(){
      return false;
    }
    @Override public boolean isShowLibraryContents(){
      return myShowLibraryContents;
    }
    @Override public boolean isShowModules(){
      return false;
    }
    @Override public List<TreeStructureProvider> getProviders(){
      return myDisableStructureProviders ? null : super.getProviders();
    }
  }
;
  myBuilder=new ProjectTreeBuilder(myProject,myTree,model,AlphaComparator.INSTANCE,treeStructure);
  myTree.setRootVisible(false);
  myTree.expandRow(0);
  myTree.getSelectionModel().setSelectionMode(TreeSelectionModel.SINGLE_TREE_SELECTION);
  myTree.setCellRenderer(new NodeRenderer());
  UIUtil.setLineStyleAngled(myTree);
  final JScrollPane scrollPane=ScrollPaneFactory.createScrollPane(myTree);
  scrollPane.setPreferredSize(new Dimension(500,300));
  myTree.addKeyListener(new KeyAdapter(){
    @Override public void keyPressed(    final KeyEvent e){
      if (KeyEvent.VK_ENTER == e.getKeyCode()) {
        doOKAction();
      }
    }
  }
);
  new DoubleClickListener(){
    @Override protected boolean onDoubleClick(    MouseEvent e){
      final TreePath path=myTree.getPathForLocation(e.getX(),e.getY());
      if (path != null && myTree.isPathSelected(path)) {
        doOKAction();
        return true;
      }
      return false;
    }
  }
.installOn(myTree);
  myTree.addTreeSelectionListener(new TreeSelectionListener(){
    @Override public void valueChanged(    final TreeSelectionEvent e){
      handleSelectionChanged();
    }
  }
);
  new TreeSpeedSearch(myTree);
  myTabbedPane=new TabbedPaneWrapper(getDisposable());
  final JPanel dummyPanel=new JPanel(new BorderLayout());
  String name=null;
  if (myInitialFile != null) {
    name=myInitialFile.getName();
  }
  PsiElement context=myInitialFile == null ? null : myInitialFile;
  myGotoByNamePanel=new ChooseByNamePanel(myProject,new MyGotoFileModel(),name,true,context){
    @Override protected void close(    final boolean isOk){
      super.close(isOk);
      if (isOk) {
        doOKAction();
      }
 else {
        doCancelAction();
      }
    }
    @Override protected void initUI(    final ChooseByNamePopupComponent.Callback callback,    final ModalityState modalityState,    boolean allowMultipleSelection){
      super.initUI(callback,modalityState,allowMultipleSelection);
      dummyPanel.add(myGotoByNamePanel.getPanel(),BorderLayout.CENTER);
      if (mySelectSearchByNameTab) {
        myTabbedPane.setSelectedIndex(1);
      }
    }
    @Override protected void showTextFieldPanel(){
    }
    @Override protected void chosenElementMightChange(){
      handleSelectionChanged();
    }
  }
;
  myTabbedPane.addTab(IdeBundle.message("tab.chooser.project"),scrollPane);
  myTabbedPane.addTab(IdeBundle.message("tab.chooser.search.by.name"),dummyPanel);
  SwingUtilities.invokeLater(new Runnable(){
    @Override public void run(){
      myGotoByNamePanel.invoke(new MyCallback(),ModalityState.stateForComponent(getRootPane()),false);
    }
  }
);
  myTabbedPane.addChangeListener(new ChangeListener(){
    @Override public void stateChanged(    final ChangeEvent e){
      handleSelectionChanged();
    }
  }
);
  return myTabbedPane.getComponent();
}
