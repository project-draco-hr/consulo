{
  PsiClass innerClass=options.getInnerClass();
  PsiClass newClass;
  if (options.getTargetContainer() instanceof PsiDirectory) {
    newClass=JavaDirectoryService.getInstance().createClass((PsiDirectory)options.getTargetContainer(),options.getNewClassName());
    PsiDocComment defaultDocComment=newClass.getDocComment();
    if (defaultDocComment != null && innerClass.getDocComment() == null) {
      innerClass=(PsiClass)innerClass.addAfter(defaultDocComment,null).getParent();
    }
    newClass=(PsiClass)newClass.replace(innerClass);
    PsiUtil.setModifierProperty(newClass,PsiModifier.STATIC,false);
    PsiUtil.setModifierProperty(newClass,PsiModifier.PRIVATE,false);
    PsiUtil.setModifierProperty(newClass,PsiModifier.PROTECTED,false);
    final boolean makePublic=needPublicAccess(options.getOuterClass(),options.getTargetContainer());
    if (makePublic) {
      PsiUtil.setModifierProperty(newClass,PsiModifier.PUBLIC,true);
    }
    final PsiMethod[] constructors=newClass.getConstructors();
    for (    PsiMethod constructor : constructors) {
      final PsiModifierList modifierList=constructor.getModifierList();
      modifierList.setModifierProperty(PsiModifier.PRIVATE,false);
      modifierList.setModifierProperty(PsiModifier.PROTECTED,false);
      if (makePublic && !newClass.isEnum()) {
        modifierList.setModifierProperty(PsiModifier.PUBLIC,true);
      }
    }
  }
 else {
    newClass=(PsiClass)options.getTargetContainer().add(innerClass);
  }
  newClass.setName(options.getNewClassName());
  return newClass;
}
