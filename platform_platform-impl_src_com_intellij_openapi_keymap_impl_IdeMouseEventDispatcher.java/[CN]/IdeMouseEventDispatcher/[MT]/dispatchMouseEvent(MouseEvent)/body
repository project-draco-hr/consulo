{
  MouseEvent previousEvent=myPreviousMouseEvent;
  myPreviousMouseEvent=e;
  Component c=e.getComponent();
  if (e.getID() == MOUSE_PRESSED && c instanceof IdeFrame && !c.hasFocus()) {
    IdeFocusManager focusManager=IdeFocusManager.getGlobalInstance();
    if (focusManager instanceof FocusManagerImpl) {
      Component at=SwingUtilities.getDeepestComponentAt(c,e.getX(),e.getY());
      if (at != null && at.isFocusable()) {
        ((FocusManagerImpl)focusManager).setLastFocusedAtDeactivation((IdeFrame)c,at);
      }
    }
  }
  if (SystemInfo.isXWindow && e.isPopupTrigger() && e.getButton() != 3) {
    resetPopupTrigger(e);
  }
  boolean ignore=false;
  if (!(e.getID() == MouseEvent.MOUSE_PRESSED || e.getID() == MouseEvent.MOUSE_RELEASED || e.getID() == MOUSE_CLICKED)) {
    ignore=true;
  }
  patchClickCount(e);
  if (e.isConsumed() || e.isPopupTrigger() || (e.getButton() > 3 ? e.getID() != MOUSE_PRESSED : e.getID() != MOUSE_RELEASED)|| e.getClickCount() < 1 || e.getButton() == MouseEvent.NOBUTTON) {
    ignore=true;
  }
  if (e.getID() == MOUSE_RELEASED && previousEvent != null && previousEvent.getID() == MOUSE_DRAGGED) {
    ignore=true;
  }
  final JRootPane root=findRoot(e);
  if (root != null) {
    final Integer lastId=myRootPane2BlockedId.get(root);
    if (lastId != null) {
      if (SWING_EVENTS_PRIORITY.indexOf(lastId) < SWING_EVENTS_PRIORITY.indexOf(e.getID())) {
        myRootPane2BlockedId.put(root,e.getID());
        return true;
      }
 else {
        myRootPane2BlockedId.remove(root);
      }
    }
  }
  if (c == null) {
    throw new IllegalStateException("component cannot be null");
  }
  c=SwingUtilities.getDeepestComponentAt(c,e.getX(),e.getY());
  if (c instanceof IdeGlassPaneImpl) {
    c=((IdeGlassPaneImpl)c).getTargetComponentFor(e);
  }
  if (c == null) {
    return false;
  }
  if (isHorizontalScrolling(c,e)) {
    boolean done=doHorizontalScrolling(c,(MouseWheelEvent)e);
    if (done)     return true;
  }
  if (ignore)   return false;
  if (!KeymapManagerImpl.ourKeymapManagerInitialized) {
    return false;
  }
  final MouseShortcut shortcut=new MouseShortcut(e.getButton(),e.getModifiersEx(),e.getClickCount());
  fillActionsList(c,shortcut,IdeKeyEventDispatcher.isModalContext(c));
  ActionManagerEx actionManager=ActionManagerEx.getInstanceEx();
  if (actionManager != null) {
    AnAction[] actions=myActions.toArray(new AnAction[myActions.size()]);
    for (    AnAction action : actions) {
      DataContext dataContext=DataManager.getInstance().getDataContext(c);
      Presentation presentation=myPresentationFactory.getPresentation(action);
      AnActionEvent actionEvent=new AnActionEvent(e,dataContext,ActionPlaces.MAIN_MENU,presentation,ActionManager.getInstance(),e.getModifiers());
      action.beforeActionPerformedUpdate(actionEvent);
      if (presentation.isEnabled()) {
        actionManager.fireBeforeActionPerformed(action,dataContext,actionEvent);
        final Component context=PlatformDataKeys.CONTEXT_COMPONENT.getData(dataContext);
        if (context != null && !context.isShowing())         continue;
        action.actionPerformed(actionEvent);
        e.consume();
      }
    }
    if (actions.length > 0 && e.isConsumed())     return true;
  }
  return e.getButton() > 3;
}
