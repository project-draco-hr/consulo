{
  boolean ignore=false;
  if (SystemInfo.isLinux && e.isPopupTrigger() && e.getButton() != 3) {
    resetPopupTrigger(e);
  }
  if (!(e.getID() == MouseEvent.MOUSE_PRESSED || e.getID() == MouseEvent.MOUSE_RELEASED || e.getID() == MOUSE_CLICKED)) {
    ignore=true;
  }
  if (e.isConsumed() || e.isPopupTrigger() || MouseEvent.MOUSE_RELEASED != e.getID() || e.getClickCount() < 1 || e.getButton() == MouseEvent.NOBUTTON) {
    ignore=true;
  }
  final JRootPane root=findRoot(e);
  if (root != null) {
    final Integer lastId=myRootPane2BlockedId.get(root);
    if (lastId != null) {
      if (SWING_EVENTS_PRIORITY.indexOf(lastId) < SWING_EVENTS_PRIORITY.indexOf(e.getID())) {
        myRootPane2BlockedId.put(root,e.getID());
        return true;
      }
 else {
        myRootPane2BlockedId.remove(root);
      }
    }
  }
  Component component=e.getComponent();
  if (component == null) {
    throw new IllegalStateException("component cannot be null");
  }
  component=SwingUtilities.getDeepestComponentAt(component,e.getX(),e.getY());
  if (component instanceof IdeGlassPaneImpl) {
    component=((IdeGlassPaneImpl)component).getTargetComponentFor(e);
  }
  if (component == null) {
    return false;
  }
  if (isHorizontalScrolling(component,e)) {
    boolean done=doHorizontalScrolling(component,(MouseWheelEvent)e);
    if (done)     return true;
  }
  if (ignore)   return false;
  if (!KeymapManagerImpl.ourKeymapManagerInitialized) {
    return false;
  }
  final MouseShortcut shortcut=new MouseShortcut(e.getButton(),e.getModifiersEx(),e.getClickCount());
  fillActionsList(component,shortcut,IdeKeyEventDispatcher.isModalContext(component));
  ActionManagerEx actionManager=ActionManagerEx.getInstanceEx();
  if (actionManager != null) {
    AnAction[] actions=myActions.toArray(new AnAction[myActions.size()]);
    for (    AnAction action : actions) {
      DataContext dataContext=DataManager.getInstance().getDataContext(component);
      Presentation presentation=myPresentationFactory.getPresentation(action);
      AnActionEvent actionEvent=new AnActionEvent(e,dataContext,ActionPlaces.MAIN_MENU,presentation,ActionManager.getInstance(),e.getModifiers());
      action.beforeActionPerformedUpdate(actionEvent);
      if (presentation.isEnabled()) {
        actionManager.fireBeforeActionPerformed(action,dataContext,actionEvent);
        final Component c=PlatformDataKeys.CONTEXT_COMPONENT.getData(dataContext);
        if (c != null && !c.isShowing())         continue;
        action.actionPerformed(actionEvent);
        e.consume();
      }
    }
  }
  return false;
}
