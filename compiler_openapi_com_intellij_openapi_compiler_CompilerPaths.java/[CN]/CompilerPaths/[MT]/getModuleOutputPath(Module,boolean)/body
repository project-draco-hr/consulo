{
  final String outPathUrl;
  final Application application=ApplicationManager.getApplication();
  if (forTestClasses) {
    if (application.isDispatchThread()) {
      final String url=CompilerModuleExtension.getInstance(module).getCompilerOutputUrlForTests();
      outPathUrl=(url != null) ? url : CompilerModuleExtension.getInstance(module).getCompilerOutputUrl();
    }
 else {
      outPathUrl=application.runReadAction(new Computable<String>(){
        public String compute(){
          final String url=CompilerModuleExtension.getInstance(module).getCompilerOutputUrlForTests();
          return (url != null) ? url : CompilerModuleExtension.getInstance(module).getCompilerOutputUrl();
        }
      }
);
    }
  }
 else {
    if (application.isDispatchThread()) {
      outPathUrl=CompilerModuleExtension.getInstance(module).getCompilerOutputUrl();
    }
 else {
      outPathUrl=application.runReadAction(new Computable<String>(){
        public String compute(){
          return CompilerModuleExtension.getInstance(module).getCompilerOutputUrl();
        }
      }
);
    }
  }
  if (outPathUrl != null) {
    return VirtualFileManager.extractPath(outPathUrl);
  }
  return null;
}
