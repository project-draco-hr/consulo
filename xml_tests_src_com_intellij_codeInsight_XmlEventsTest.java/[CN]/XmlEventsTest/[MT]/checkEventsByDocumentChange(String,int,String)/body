{
  final PomModel model=PomManager.getModel(getProject());
  final Listener listener=new Listener(model.getModelAspect(XmlAspect.class));
  model.addModelListener(listener);
  final XmlTag tagFromText=((XmlFile)createFile("file.xml",rootTagText)).getDocument().getRootTag();
  final PsiFileImpl containingFile=(PsiFileImpl)tagFromText.getContainingFile();
  final PsiDocumentManager documentManager=PsiDocumentManager.getInstance(getProject());
  final Document document=documentManager.getDocument(containingFile);
  CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          document.insertString(positionToInsert,stringToInsert);
          documentManager.commitDocument(document);
        }
      }
);
    }
  }
,"",null);
  assertFileTextEquals(getTestName(false) + ".txt",listener.getEventString());
}
