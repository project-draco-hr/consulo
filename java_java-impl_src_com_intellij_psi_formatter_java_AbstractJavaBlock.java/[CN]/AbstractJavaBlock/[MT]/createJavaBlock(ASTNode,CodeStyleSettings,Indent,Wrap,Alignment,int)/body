{
  Indent actualIndent=indent == null ? getDefaultSubtreeIndent(child) : indent;
  final IElementType elementType=child.getElementType();
  if (child.getPsi() instanceof PsiWhiteSpace) {
    String text=child.getText();
    int start=CharArrayUtil.shiftForward(text,0," \t\n");
    int end=CharArrayUtil.shiftBackward(text,text.length() - 1," \t\n") + 1;
    LOG.assertTrue(start < end);
    return new PartialWhitespaceBlock(child,new TextRange(start + child.getStartOffset(),end + child.getStartOffset()),wrap,alignment,actualIndent,settings);
  }
  if (child.getPsi() instanceof PsiClass) {
    return new CodeBlockBlock(child,wrap,alignment,actualIndent,settings);
  }
  if (isBlockType(elementType)) {
    return new BlockContainingJavaBlock(child,wrap,alignment,actualIndent,settings);
  }
  if (isStatement(child,child.getTreeParent())) {
    return new CodeBlockBlock(child,wrap,alignment,actualIndent,settings);
  }
  if (child instanceof LeafElement) {
    final LeafBlock block=new LeafBlock(child,wrap,alignment,actualIndent);
    block.setStartOffset(startOffset);
    return block;
  }
 else   if (isLikeExtendsList(elementType)) {
    return new ExtendsListBlock(child,wrap,alignment,settings);
  }
 else   if (elementType == JavaElementType.CODE_BLOCK) {
    return new CodeBlockBlock(child,wrap,alignment,actualIndent,settings);
  }
 else   if (elementType == JavaElementType.LABELED_STATEMENT) {
    return new LabeledJavaBlock(child,wrap,alignment,actualIndent,settings);
  }
 else   if (elementType == JavaDocElementType.DOC_COMMENT) {
    return new DocCommentBlock(child,wrap,alignment,actualIndent,settings);
  }
 else {
    final SimpleJavaBlock simpleJavaBlock=new SimpleJavaBlock(child,wrap,alignment,actualIndent,settings);
    simpleJavaBlock.setStartOffset(startOffset);
    return simpleJavaBlock;
  }
}
