{
  final PsiClass[] classes=new PsiClass[classNames.length];
  for (int i=0; i < classes.length; i++) {
    String className=classNames[i];
    classes[i]=JavaPsiFacade.getInstance(getProject()).findClass(className,GlobalSearchScope.allScope(getProject()));
    assertNotNull("Class " + className + " not found",classes[i]);
  }
  PsiPackage aPackage=JavaPsiFacade.getInstance(getProject()).findPackage(newPackageName);
  assertNotNull("Package " + newPackageName + " not found",aPackage);
  final PsiDirectory[] dirs=aPackage.getDirectories();
  assertEquals(dirs.length,1);
  final Application application=ApplicationManager.getApplication();
  CommandProcessor.getInstance().executeCommand(myFixture.getProject(),new Runnable(){
    @Override public void run(){
      application.runWriteAction(new Runnable(){
        @Override public void run(){
          new MoveClassesOrPackagesProcessor(getProject(),classes,new SingleSourceRootMoveDestination(PackageWrapper.create(JavaDirectoryService.getInstance().getPackage(dirs[0])),dirs[0]),true,true,null).run();
        }
      }
);
    }
  }
,"",null);
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
  FileDocumentManager.getInstance().saveAllDocuments();
}
