{
  final PsiClass[] classes=new PsiClass[classNames.length];
  for (int i=0; i < classes.length; i++) {
    String className=classNames[i];
    classes[i]=JavaPsiFacade.getInstance(getProject()).findClass(className,GlobalSearchScope.allScope(getProject()));
    assertNotNull("Class " + className + " not found",classes[i]);
  }
  PsiPackage aPackage=JavaPsiFacade.getInstance(getProject()).findPackage(newPackageName);
  assertNotNull("Package " + newPackageName + " not found",aPackage);
  final PsiDirectory[] dirs=aPackage.getDirectories();
  assertEquals(dirs.length,dirCount);
  final Application application=ApplicationManager.getApplication();
  CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
    @Override public void run(){
      application.runWriteAction(new Runnable(){
        @Override public void run(){
          final PsiDirectory dir=dirs[dirs.length - 1];
          final SingleSourceRootMoveDestination moveDestination=new SingleSourceRootMoveDestination(PackageWrapper.create(JavaDirectoryService.getInstance().getPackage(dir)),dir);
          new MoveClassesOrPackagesProcessor(getProject(),classes,moveDestination,true,true,null).run();
        }
      }
);
    }
  }
,"",null);
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
  FileDocumentManager.getInstance().saveAllDocuments();
}
