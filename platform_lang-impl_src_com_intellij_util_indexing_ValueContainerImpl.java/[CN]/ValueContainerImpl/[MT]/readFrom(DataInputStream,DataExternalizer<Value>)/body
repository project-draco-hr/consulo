{
  while (stream.available() > 0) {
    final int valueCount=DataInputOutputUtil.readINT(stream);
    if (valueCount < 0) {
      removeAssociatedValue(-valueCount);
      setNeedsCompacting(true);
    }
 else {
      for (int valueIdx=0; valueIdx < valueCount; valueIdx++) {
        final Value value=externalizer.read(stream);
        int idCountOrSingleValue=DataInputOutputUtil.readINT(stream);
        if (idCountOrSingleValue > 0) {
          addValue(idCountOrSingleValue,value);
        }
 else {
          idCountOrSingleValue=-idCountOrSingleValue;
          ensureFileSetCapacityForValue(value,idCountOrSingleValue);
          int prev=0;
          for (int i=0; i < idCountOrSingleValue; i++) {
            final int id=DataInputOutputUtil.readINT(stream);
            addValue(prev + id,value);
            prev+=id;
          }
        }
      }
    }
  }
}
