{
  if (map == null) {
    return null;
  }
  final THashMap<Value,Object> cloned=map.clone();
  cloned.forEachEntry(new TObjectObjectProcedure<Value,Object>(){
    @Override public boolean execute(    Value key,    Object val){
      if (val instanceof TIntHashSet) {
        cloned.put(key,((TIntHashSet)val).clone());
      }
 else       if (val instanceof IdBitSet) {
        cloned.put(key,((IdBitSet)val).clone());
      }
      return true;
    }
  }
);
  return cloned;
}
