{
  final Object input=getInput(value);
  if (input == null) {
    if (myInputIdMapping != null) {
      if (!(myInputIdMapping instanceof THashMap)) {
        Object oldMapping=myInputIdMapping;
        myInputIdMapping=new THashMap<Value,Object>(2);
        ((THashMap<Value,Object>)myInputIdMapping).put((Value)oldMapping,myInputIdMappingValue);
        myInputIdMappingValue=null;
      }
      ((THashMap<Value,Object>)myInputIdMapping).put(value,inputId);
    }
 else {
      myInputIdMapping=value != null ? value : (Value)myNullValue;
      myInputIdMappingValue=inputId;
    }
  }
 else {
    final TIntHashSet idSet;
    if (input instanceof Integer) {
      idSet=new IdSet(3,0.98f);
      idSet.add(((Integer)input).intValue());
      if (!(myInputIdMapping instanceof THashMap))       myInputIdMappingValue=idSet;
 else       ((THashMap<Value,Object>)myInputIdMapping).put(value,idSet);
    }
 else {
      idSet=(TIntHashSet)input;
    }
    idSet.add(inputId);
  }
}
