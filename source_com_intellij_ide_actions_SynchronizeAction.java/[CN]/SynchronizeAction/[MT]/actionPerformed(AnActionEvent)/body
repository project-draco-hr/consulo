{
  FileDocumentManager.getInstance().saveAllDocuments();
  final VirtualFileManager vfMan=VirtualFileManager.getInstance();
  final Runnable synchronizeRunnable=new Runnable(){
    public void run(){
      vfMan.refresh(myAsynchronous);
    }
  }
;
  final ApplicationEx application=ApplicationManagerEx.getApplicationEx();
  if (myAsynchronous) {
    application.runReadAction(synchronizeRunnable);
  }
 else {
    final Project project=(Project)DataManager.getInstance().getDataContext().getData(DataConstants.PROJECT);
    application.runProcessWithProgressSynchronously(new Runnable(){
      public void run(){
        final ProgressIndicator pi=ProgressManager.getInstance().getProgressIndicator();
        pi.setText("Synchronizing files...");
        application.invokeAndWait(new Runnable(){
          public void run(){
            application.runWriteAction(synchronizeRunnable);
          }
        }
,pi.getModalityState());
      }
    }
,"",false,project);
  }
}
