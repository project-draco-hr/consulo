{
  return new UpdateSessionAdapter(result.getErrorsAndWarnings(),result.isCanceled() || !result.isLoggedIn()){
    public void onRefreshFilesCompleted(){
      final FileGroup mergedWithConflictsGroup=updatedFiles.getGroupById(FileGroup.MERGED_WITH_CONFLICT_ID);
      final FileGroup binaryMergedGroup=updatedFiles.getGroupById(CvsUpdatePolicy.BINARY_MERGED_ID);
      if (!mergedWithConflictsGroup.isEmpty() || !binaryMergedGroup.isEmpty()) {
        Collection<String> paths=new ArrayList<String>();
        paths.addAll(mergedWithConflictsGroup.getFiles());
        paths.addAll(binaryMergedGroup.getFiles());
        final List<VirtualFile> list=invokeManualMerging(paths,myProject);
        FileGroup mergedGroup=updatedFiles.getGroupById(FileGroup.MERGED_ID);
        for (        VirtualFile mergedFile : list) {
          String path=FileUtil.toSystemDependentName(mergedFile.getPresentableUrl());
          mergedWithConflictsGroup.remove(path);
          binaryMergedGroup.remove(path);
          mergedGroup.add(path);
        }
      }
    }
  }
;
}
