{
  CvsConfiguration cvsConfiguration=CvsConfiguration.getInstance(myProject);
  if (!myLastUpdateWasConfigured) {
    cvsConfiguration.CLEAN_COPY=false;
    cvsConfiguration.RESET_STICKY=false;
  }
  myLastUpdateWasConfigured=false;
  try {
    final UpdateSettingsOnCvsConfiguration updateSettings=createSettingsAndUpdateContext(cvsConfiguration,contextRef);
    final UpdateHandler handler=CommandCvsHandler.createUpdateHandler(contentRoots,updateSettings,myProject,updatedFiles);
    handler.addCvsListener(new UpdatedFilesProcessor(myProject,updatedFiles));
    CvsOperationExecutor cvsOperationExecutor=new CvsOperationExecutor(true,myProject,ModalityState.defaultModalityState());
    cvsOperationExecutor.setShowErrors(false);
    cvsOperationExecutor.performActionSync(handler,CvsOperationExecutorCallback.EMPTY);
    final CvsResult result=cvsOperationExecutor.getResult();
    return createUpdateSessionAdapter(updatedFiles,result);
  }
  finally {
    cvsConfiguration.CLEAN_COPY=false;
    cvsConfiguration.RESET_STICKY=false;
  }
}
