{
  if (contextRef.get() != null) {
    final CvsSequentialUpdateContext cvsContext=(CvsSequentialUpdateContext)contextRef.get();
    contextRef.set(null);
    return cvsContext.getConfiguration();
  }
  if ((!cvsConfiguration.CLEAN_COPY) && cvsConfiguration.UPDATE_DATE_OR_REVISION_SETTINGS.overridesDefault() && (cvsConfiguration.MERGING_MODE != CvsConfiguration.DO_NOT_MERGE)) {
    final UpdateSettingsOnCvsConfiguration secondUpdate=new UpdateSettingsOnCvsConfiguration(cvsConfiguration.PRUNE_EMPTY_DIRECTORIES,cvsConfiguration.MERGING_MODE,cvsConfiguration.MERGE_WITH_BRANCH1_NAME,cvsConfiguration.MERGE_WITH_BRANCH2_NAME,cvsConfiguration.CREATE_NEW_DIRECTORIES,cvsConfiguration.UPDATE_KEYWORD_SUBSTITUTION,new DateOrRevisionSettings(),cvsConfiguration.MAKE_NEW_FILES_READONLY,cvsConfiguration.CLEAN_COPY,cvsConfiguration.RESET_STICKY);
    contextRef.set(new CvsSequentialUpdateContext(secondUpdate,cvsConfiguration.UPDATE_DATE_OR_REVISION_SETTINGS.asString()));
    return new UpdateSettingsOnCvsConfiguration(cvsConfiguration.PRUNE_EMPTY_DIRECTORIES,CvsConfiguration.DO_NOT_MERGE,null,null,cvsConfiguration.CREATE_NEW_DIRECTORIES,cvsConfiguration.UPDATE_KEYWORD_SUBSTITUTION,cvsConfiguration.UPDATE_DATE_OR_REVISION_SETTINGS,cvsConfiguration.MAKE_NEW_FILES_READONLY,cvsConfiguration.CLEAN_COPY,cvsConfiguration.RESET_STICKY);
  }
 else {
    return new UpdateSettingsOnCvsConfiguration(cvsConfiguration,cvsConfiguration.CLEAN_COPY,cvsConfiguration.RESET_STICKY);
  }
}
