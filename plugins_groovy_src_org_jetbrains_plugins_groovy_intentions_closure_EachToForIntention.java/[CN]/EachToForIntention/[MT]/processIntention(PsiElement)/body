{
  final GrMethodCallExpression expression=(GrMethodCallExpression)element;
  final GrClosableBlock block=expression.getClosureArguments()[0];
  final GrParameterList parameterList=block.getParameterList();
  final GrParameter[] parameters=parameterList.getParameters();
  String var;
  if (parameters.length == 1) {
    var=parameters[0].getText();
    var=StringUtil.replace(var,GrModifier.DEF,"");
  }
 else {
    var="it";
  }
  final GrExpression invokedExpression=expression.getInvokedExpression();
  GrExpression qualifier=((GrReferenceExpression)invokedExpression).getQualifierExpression();
  final GroovyPsiElementFactory elementFactory=GroovyPsiElementFactory.getInstance(element.getProject());
  if (qualifier == null) {
    qualifier=elementFactory.createExpressionFromText("this");
  }
  StringBuilder builder=new StringBuilder();
  builder.append("for (").append(var).append(" in ").append(qualifier.getText()).append(") {\n");
  String text=block.getText();
  int index=text.indexOf("->");
  if (index == -1) {
    index=1;
  }
 else {
    index+=2;
  }
  while (index < text.length() && Character.isWhitespace(text.charAt(index)))   index++;
  text=text.substring(index,text.length() - 1);
  builder.append(text);
  builder.append("}");
  final GrStatement statement=elementFactory.createStatementFromText(builder.toString());
  expression.replaceWithStatement(statement);
}
