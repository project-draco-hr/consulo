{
  int offset=editor.getCaretModel().getOffset();
  Pair<PsiElement,TextRange> pair=ObjectUtils.assertNotNull(getRangePair(file,editor));
  PsiFile injectedFile=(PsiFile)pair.first;
  QuickEditHandler handler=getHandler(project,injectedFile,editor,file);
  if (!ApplicationManager.getApplication().isUnitTestMode()) {
    DocumentWindow documentWindow=InjectedLanguageUtil.getDocumentWindow(injectedFile);
    if (documentWindow != null) {
      handler.navigate(((DocumentWindowImpl)documentWindow).hostToInjectedUnescaped(offset));
    }
  }
  return handler;
}
