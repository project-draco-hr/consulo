{
  if (myPanel.getCommitMessage().trim().isEmpty()) {
    Messages.showMessageDialog(myPanel.getComponent(),GitBundle.message("git.commit.message.empty"),GitBundle.message("git.commit.message.empty.title"),Messages.getErrorIcon());
    return ReturnResult.CANCEL;
  }
  DetachedRoot detachedRoot=getDetachedRoot();
  if (detachedRoot == null) {
    return ReturnResult.COMMIT;
  }
  final String title;
  final String message;
  final CharSequence rootPath=StringUtil.last(detachedRoot.myRoot.getPresentableUrl(),50,true);
  final String messageCommonStart="The Git repository <code>" + rootPath + "</code>";
  if (detachedRoot.myRebase) {
    title="Unfinished rebase process";
    message=messageCommonStart + " <br/> has an <b>unfinished rebase</b> process. <br/>" + "You probably want to <b>continue rebase</b> instead of committing. <br/>"+ "Committing during rebase may lead to the commit loss. <br/>"+ "<a href='http://www.kernel.org/pub/software/scm/git/docs/git-rebase.html'>Read more about Git rebase</a>.";
  }
 else {
    title="Commit in detached HEAD may be dangerous";
    message=messageCommonStart + " is in the <b>detached HEAD</b> state. <br/>" + "You can look around, make experimental changes and commit them, but be sure to checkout a branch not to lose your work. <br/>"+ "Otherwise you risk losing your changes. <br/>"+ "<a href='http://sitaramc.github.com/concepts/detached-head.html'>Read more about detached HEAD</a>.";
  }
  final int choice=Messages.showDialog(myPanel.getComponent(),"<html>" + message + "</html>",title,new String[]{"Commit","Cancel"},1,Messages.getWarningIcon());
  if (choice == 0) {
    return ReturnResult.COMMIT;
  }
 else {
    return ReturnResult.CLOSE_WINDOW;
  }
}
