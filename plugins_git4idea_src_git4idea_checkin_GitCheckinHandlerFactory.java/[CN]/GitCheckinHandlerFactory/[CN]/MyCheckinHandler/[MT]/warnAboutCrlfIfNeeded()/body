{
  GitVcsSettings settings=GitVcsSettings.getInstance(myProject);
  if (!SystemInfo.isWindows || !settings.warnAboutCrlf()) {
    return ReturnResult.COMMIT;
  }
  GitCrlfProblemsDetector crlfHelper=GitCrlfProblemsDetector.detect(myPanel.getVirtualFiles());
  if (crlfHelper.shouldWarn()) {
    final GitCrlfDialog dialog=new GitCrlfDialog(myProject);
    UIUtil.invokeAndWaitIfNeeded(new Runnable(){
      @Override public void run(){
        dialog.show();
      }
    }
);
    int decision=dialog.getExitCode();
    if (decision == GitCrlfDialog.CANCEL) {
      return ReturnResult.CANCEL;
    }
 else {
      if (decision == GitCrlfDialog.SET) {
        VirtualFile anyRoot=myPanel.getRoots().iterator().next();
        setCoreAutoCrlfAttribute(anyRoot);
      }
 else {
        if (dialog.dontWarnAgain()) {
          settings.setWarnAboutCrlf(false);
        }
      }
      return ReturnResult.COMMIT;
    }
  }
  return ReturnResult.COMMIT;
}
