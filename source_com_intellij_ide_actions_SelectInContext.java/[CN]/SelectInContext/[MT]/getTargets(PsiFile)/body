{
  ArrayList<SelectInTarget> result=new ArrayList<SelectInTarget>();
  final SelectInTarget[] targets=getManager().getTargets();
  for (int i=0; i < targets.length; i++) {
    SelectInTarget target=targets[i];
    if (target.canSelect(psiFile)) {
      result.add(target);
    }
  }
  if (result.size() > 1) {
    final String activeToolWindowId=ToolWindowManager.getInstance(getProject()).getActiveToolWindowId();
    if (activeToolWindowId != null) {
      SelectInTarget firstTarget=result.get(0);
      if (activeToolWindowId.equals(firstTarget.getToolWindowId())) {
        boolean shouldMoveToBottom=true;
        if (ToolWindowId.PROJECT_VIEW.equals(activeToolWindowId)) {
          final String currentMinorViewId=ProjectView.getInstance(getProject()).getCurrentViewId();
          shouldMoveToBottom=(currentMinorViewId != null) && currentMinorViewId.equals(firstTarget.getMinorViewId());
        }
        if (shouldMoveToBottom) {
          result.remove(0);
          result.add(firstTarget);
        }
      }
    }
  }
  return result.toArray(new SelectInTarget[result.size()]);
}
