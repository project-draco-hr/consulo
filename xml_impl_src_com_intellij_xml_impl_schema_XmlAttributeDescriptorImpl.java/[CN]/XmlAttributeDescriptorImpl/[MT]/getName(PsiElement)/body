{
  final String form=myTag.getAttributeValue("form");
  boolean isQualifiedAttr=QUALIFIED_ATTR_VALUE.equals(form);
  final XmlTag rootTag=(((XmlFile)myTag.getContainingFile())).getDocument().getRootTag();
  String targetNs=rootTag.getAttributeValue("targetNamespace");
  XmlTag contextTag=(XmlTag)context;
  String name=getName();
  boolean attributeShouldBeQualified=false;
  String contextNs=contextTag.getNamespace();
  if (targetNs != null && !contextNs.equals(targetNs)) {
    final XmlElementDescriptor xmlElementDescriptor=contextTag.getDescriptor();
    if (xmlElementDescriptor instanceof XmlElementDescriptorImpl) {
      final XmlElementDescriptorImpl elementDescriptor=(XmlElementDescriptorImpl)xmlElementDescriptor;
      final TypeDescriptor type=elementDescriptor.getType();
      if (type instanceof ComplexTypeDescriptor) {
        final ComplexTypeDescriptor typeDescriptor=(ComplexTypeDescriptor)type;
        attributeShouldBeQualified=typeDescriptor.canContainAttribute(name,targetNs) != ComplexTypeDescriptor.CanContainAttributeType.CanNotContain;
      }
      if (!attributeShouldBeQualified && contextNs.length() == 0 && targetNs.length() > 0) {
        attributeShouldBeQualified=!targetNs.equals(elementDescriptor.getNamespace());
      }
    }
  }
  if (targetNs != null && (isQualifiedAttr || QUALIFIED_ATTR_VALUE.equals(rootTag.getAttributeValue("attributeFormDefault")) || attributeShouldBeQualified)) {
    final String prefixByNamespace=contextTag.getPrefixByNamespace(targetNs);
    if (prefixByNamespace != null && prefixByNamespace.length() > 0) {
      name=prefixByNamespace + ":" + name;
    }
  }
  return name;
}
