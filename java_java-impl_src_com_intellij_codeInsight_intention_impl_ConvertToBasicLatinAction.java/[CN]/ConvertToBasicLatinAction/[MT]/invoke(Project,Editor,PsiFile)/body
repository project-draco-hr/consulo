{
  final PsiElement element=file.findElementAt(editor.getCaretModel().getOffset());
  if (element == null)   return;
  final Pair<PsiElement,Handler> pair=findHandler(element);
  if (pair == null)   return;
  final String text=pair.first.getText();
  final StringBuilder sb=new StringBuilder();
  for (int i=0; i < text.length(); i++) {
    final char ch=text.charAt(i);
    if (!shouldConvert(ch)) {
      sb.append(ch);
    }
 else {
      pair.second.convert(sb,ch);
    }
  }
  pair.first.replace(pair.second.createReplacement(project,sb.toString(),pair.first.getParent()));
}
