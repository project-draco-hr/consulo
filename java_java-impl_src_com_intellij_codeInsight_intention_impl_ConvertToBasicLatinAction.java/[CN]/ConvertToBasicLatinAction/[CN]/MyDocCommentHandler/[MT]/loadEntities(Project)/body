{
  if (ourEntities != null)   return;
  final XmlFile file;
  try {
    final String url=ExternalResourceManager.getInstance().getResourceLocation(XmlUtil.HTML4_LOOSE_URI,project);
    if (url == null) {
      LOG.error("Namespace not found: " + XmlUtil.HTML4_LOOSE_URI);
      return;
    }
    final VirtualFile vFile=VfsUtil.findFileByURL(new URL(url));
    if (vFile == null) {
      LOG.error("Resource not found: " + url);
      return;
    }
    final PsiFile psiFile=PsiManager.getInstance(project).findFile(vFile);
    if (!(psiFile instanceof XmlFile)) {
      LOG.error("Unexpected resource: " + psiFile);
      return;
    }
    file=(XmlFile)psiFile;
  }
 catch (  MalformedURLException e) {
    LOG.error(e);
    return;
  }
  ourEntities=new HashMap<Character,String>();
  final Pattern pattern=Pattern.compile("&#(\\d+);");
  XmlUtil.processXmlElements(file,new PsiElementProcessor(){
    @Override public boolean execute(    @NotNull PsiElement element){
      if (element instanceof XmlEntityDecl) {
        final XmlEntityDecl entity=(XmlEntityDecl)element;
        final Matcher m=pattern.matcher(entity.getValueElement().getValue());
        if (m.matches()) {
          final char i=(char)Integer.parseInt(m.group(1));
          if (shouldConvert(i)) {
            ourEntities.put(i,entity.getName());
          }
        }
      }
      return true;
    }
  }
,true);
}
