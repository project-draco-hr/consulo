{
  if (lastElement == null)   return;
  final PsiReference ref=lastElement.getContainingFile().findReferenceAt(context.offset);
  if (ref != null) {
    completionData.completeReference(ref,lookupSet,context,lastElement);
    return;
  }
  if (lastElement instanceof PsiIdentifier) {
    final PsiElement parent=lastElement.getParent();
    if (parent instanceof PsiVariable) {
      final PsiVariable variable=(PsiVariable)parent;
      if (lastElement.equals(variable.getNameIdentifier())) {
        myPreferencePolicy=completionData.completeVariableName(lookupSet,context,variable);
      }
    }
 else     if (parent instanceof PsiClass) {
      final PsiClass psiClass=(PsiClass)parent;
      if (lastElement.equals(psiClass.getNameIdentifier())) {
        myPreferencePolicy=completionData.completeClassName(lookupSet,context,psiClass);
      }
    }
 else     if (parent instanceof PsiMethod) {
      final PsiMethod psiMethod=(PsiMethod)parent;
      if (lastElement.equals(psiMethod.getNameIdentifier())) {
        myPreferencePolicy=completionData.completeMethodName(lookupSet,context,psiMethod);
      }
    }
    return;
  }
  return;
}
