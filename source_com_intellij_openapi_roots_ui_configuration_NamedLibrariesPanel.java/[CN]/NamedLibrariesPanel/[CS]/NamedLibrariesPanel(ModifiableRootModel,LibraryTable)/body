{
  super(new BorderLayout());
  myRootModel=rootModel;
  myLibraryTable=libraryTable;
  myLibrariesUpdateListener=new LibraryTable.Listener(){
    public void afterLibraryAdded(    Library newLibrary){
      updateChooser(null,true,null);
    }
    public void afterLibraryRenamed(    Library library){
      updateChooser(null,true,null);
    }
    public void beforeLibraryRemoved(    Library library){
    }
    public void afterLibraryRemoved(    Library library){
      updateChooser(null,true,null);
    }
  }
;
  myLibrariesChooser=new ElementsChooser<LibraryChooserElement>();
  myLibrariesChooser.setColorUnmarkedElements(false);
  myMarkListener=new ElementsChooser.ElementsMarkListener<LibraryChooserElement>(){
    public void elementMarkChanged(    LibraryChooserElement libraryElement,    boolean isMarked){
      setChooserElementMarked(libraryElement,isMarked);
    }
  }
;
  myLibrariesChooser.addElementsMarkListener(myMarkListener);
  final JButton editButton=new JButton("Edit...");
  myIncludeAllButton=new JButton("Include All");
  myExcludeAllButton=new JButton("Exclude All");
  editButton.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      removeLibraryTableListener();
      try {
        final HashSet<Library> librariesBeforeEdit=new HashSet<Library>(Arrays.asList(myLibraryTable.getLibraries()));
        final List<Library> selection=new ArrayList<Library>(Arrays.asList(convertToLibraries(myLibrariesChooser.getSelectedElements())));
        final boolean isOk=LibraryTableEditor.showEditDialog(editButton,myLibraryTable,selection);
        final Set<Library> librariesAfterEdit=new HashSet<Library>(Arrays.asList(myLibraryTable.getLibraries()));
        librariesAfterEdit.removeAll(librariesBeforeEdit);
        if (isOk) {
          updateChooser(librariesAfterEdit,!isOk,selection);
        }
 else {
          updateChooser(librariesAfterEdit,!isOk,null);
        }
      }
  finally {
        attachLibraryTableListener();
      }
    }
  }
);
  myIncludeAllButton.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      myLibrariesChooser.setAllElementsMarked(true);
    }
  }
);
  myExcludeAllButton.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      myLibrariesChooser.setAllElementsMarked(false);
    }
  }
);
  final JPanel buttonsPanel=new JPanel(new GridBagLayout());
  buttonsPanel.add(editButton,new GridBagConstraints(0,GridBagConstraints.RELATIVE,1,1,1.0,0.0,GridBagConstraints.NORTHWEST,GridBagConstraints.HORIZONTAL,new Insets(0,2,5,0),0,0));
  buttonsPanel.add(myIncludeAllButton,new GridBagConstraints(0,GridBagConstraints.RELATIVE,1,1,1.0,0.0,GridBagConstraints.NORTHWEST,GridBagConstraints.HORIZONTAL,new Insets(0,2,5,0),0,0));
  buttonsPanel.add(myExcludeAllButton,new GridBagConstraints(0,GridBagConstraints.RELATIVE,1,1,1.0,1.0,GridBagConstraints.NORTHWEST,GridBagConstraints.HORIZONTAL,new Insets(0,2,0,0),0,0));
  add(myLibrariesChooser,BorderLayout.CENTER);
  add(buttonsPanel,BorderLayout.EAST);
  updateChooser(null,false,null);
  attachLibraryTableListener();
}
