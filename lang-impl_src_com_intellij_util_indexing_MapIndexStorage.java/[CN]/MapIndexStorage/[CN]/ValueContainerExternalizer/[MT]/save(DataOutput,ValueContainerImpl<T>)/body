{
  for (final Iterator<T> valueIterator=container.getValueIterator(); valueIterator.hasNext(); ) {
    final T value=valueIterator.next();
    myExternalizer.save(out,value);
    final ValueContainer.IntIterator ids=container.getInputIdsIterator(value);
    if (ids != null) {
      if (ids.size() == 1) {
        out.writeInt(-ids.next());
      }
 else {
        out.writeInt(ids.size());
        while (ids.hasNext()) {
          out.writeInt(ids.next());
        }
      }
    }
 else {
      out.writeInt(0);
    }
  }
}
