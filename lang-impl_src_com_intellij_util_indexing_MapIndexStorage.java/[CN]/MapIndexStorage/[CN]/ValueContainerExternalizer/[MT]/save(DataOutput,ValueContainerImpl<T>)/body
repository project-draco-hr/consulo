{
  for (final Iterator<T> valueIterator=container.getValueIterator(); valueIterator.hasNext(); ) {
    final T value=valueIterator.next();
    myExternalizer.save(out,value);
    final ValueContainer.IntIterator ids=container.getInputIdsIterator(value);
    if (ids != null) {
      if (ids.size() == 1) {
        DataInputOutputUtil.writeSINT(out,-ids.next());
      }
 else {
        DataInputOutputUtil.writeSINT(out,ids.size());
        while (ids.hasNext()) {
          DataInputOutputUtil.writeSINT(out,ids.next());
        }
      }
    }
 else {
      DataInputOutputUtil.writeSINT(out,0);
    }
  }
}
