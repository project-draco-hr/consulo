{
  LOG.assertTrue(antBuildListener != null);
  LOG.assertTrue(errorView != null);
  LOG.assertTrue(commandLine != null);
  LOG.assertTrue(buildFile != null);
  final Project project=buildFile.getProject();
  final File[] workingDirectory=new File[1];
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      final AntFile antFile=buildFile.getAntFile();
      if (antFile == null || !antFile.isValid())       return;
      VirtualFile vFile=antFile.getVirtualFile();
      if (vFile == null || !vFile.isValid())       return;
      VirtualFile vDir=vFile.getParent();
      workingDirectory[0]=VfsUtil.virtualToIoFile(vDir);
    }
  }
);
  final long startTime=new Date().getTime();
  JUnitProcessHandler handler;
  try {
    handler=JUnitProcessHandler.runCommandLine(commandLine);
  }
 catch (  final ExecutionException e) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        ExecutionUtil.showExecutionErrorMessage(e,AntBundle.message("could.not.start.process.erorr.dialog.title"),project);
      }
    }
);
    antBuildListener.buildFinished(AntBuildListener.FAILED_TO_RUN,0);
    return;
  }
  processRunningAnt(progress,handler,errorView,buildFile,startTime,antBuildListener);
}
