{
  LOG.assertTrue(antBuildListener != null);
  LOG.assertTrue(errorView != null);
  LOG.assertTrue(commandLine != null);
  LOG.assertTrue(buildFile != null);
  final Project project=buildFile.getProject();
  final long startTime=new Date().getTime();
  JUnitProcessHandler handler;
  if (LocalHistoryConfiguration.getInstance().ADD_LABEL_ON_RUNNING) {
    LocalHistory.putSystemLabel(project,AntBundle.message("ant.build.local.history.label",buildFile.getName()));
  }
  try {
    handler=JUnitProcessHandler.runCommandLine(commandLine);
  }
 catch (  final ExecutionException e) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        ExecutionErrorDialog.show(e,AntBundle.message("could.not.start.process.erorr.dialog.title"),project);
      }
    }
);
    antBuildListener.buildFinished(AntBuildListener.FAILED_TO_RUN,0);
    return;
  }
  processRunningAnt(progress,handler,errorView,buildFile,startTime,antBuildListener);
  handler.waitFor();
}
