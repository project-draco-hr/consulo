{
  final Project project=buildFile.getProject();
  WindowManager.getInstance().getStatusBar(project).setInfo(AntBundle.message("ant.build.started.status.message"));
  final CheckCancelThread checkThread=new CheckCancelThread(progress,handler);
  checkThread.start();
  final OutputParser parser=OutputParser2.attachParser(project,handler,errorView,progress,buildFile);
  handler.addProcessListener(new ProcessAdapter(){
    public void processTerminated(    ProcessEvent event){
      checkThread.cancel();
      parser.setStopped(true);
      if (progress != null) {
        progress.stop();
      }
      errorView.stopScrollerThread();
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          if (project.isDisposed())           return;
          errorView.removeProgressPanel();
          ToolWindow toolWindow=ToolWindowManager.getInstance(project).getToolWindow(ToolWindowId.MESSAGES_WINDOW);
          if (toolWindow != null) {
            toolWindow.activate(null);
            long buildTime=new Date().getTime() - startTime;
            errorView.buildFinished(progress != null && progress.isCanceled(),buildTime,antBuildListener);
          }
        }
      }
,ModalityState.NON_MODAL);
    }
  }
);
  handler.startNotify();
  errorView.startScrollerThread();
}
