{
  PsiType cachedType=myCachedType;
  if (cachedType == null) {
    TreeElement element=getFirstChildNode();
    while (element != null) {
      IElementType elementType=element.getElementType();
      if (element.getTreeNext() == null && ElementType.PRIMITIVE_TYPE_BIT_SET.contains(elementType)) {
        cachedType=JavaPsiFacade.getInstance(getProject()).getElementFactory().createPrimitiveType(element.getText());
      }
 else       if (elementType == JavaElementType.TYPE) {
        PsiType componentType=((PsiTypeElement)SourceTreeToPsiMap.treeElementToPsi(element)).getType();
        cachedType=getLastChildNode().getElementType() == JavaTokenType.ELLIPSIS ? new PsiEllipsisType(componentType) : componentType.createArrayType();
      }
 else       if (elementType == JavaElementType.JAVA_CODE_REFERENCE) {
        cachedType=new PsiClassReferenceType(getReferenceElement());
      }
 else       if (elementType == JavaTokenType.QUEST) {
        cachedType=createWildcardType();
      }
 else {
        LOG.error("Unknown element type: " + elementType);
      }
      myCachedType=cachedType;
      if (element.getTextLength() != 0)       break;
      element=element.getTreeNext();
    }
  }
  return cachedType;
}
