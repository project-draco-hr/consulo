{
  if (!editor.getSelectionModel().hasSelection())   return;
  final String text=editor.getSelectionModel().getSelectedText();
  if (text == null || text.indexOf('\n') >= 0)   return;
  if (editor instanceof EditorWindow) {
    editor=((EditorWindow)editor).getDelegate();
  }
  final JComponent oldHeader=editor.getHeaderComponent();
  if (oldHeader instanceof EditorSearchComponent) {
    final EditorSearchComponent oldSearch=(EditorSearchComponent)oldHeader;
    if (oldSearch.hasMatches()) {
      String oldText=oldSearch.getTextInField();
      if (!oldSearch.isRegexp()) {
        oldText=StringUtil.escapeToRegexp(oldText);
        oldSearch.setRegexp(true);
      }
      String newText=oldText + '|' + StringUtil.escapeToRegexp(text);
      oldSearch.setTextInField(newText);
      return;
    }
  }
  final EditorSearchComponent header=new EditorSearchComponent(editor,project);
  editor.setHeaderComponent(header);
}
