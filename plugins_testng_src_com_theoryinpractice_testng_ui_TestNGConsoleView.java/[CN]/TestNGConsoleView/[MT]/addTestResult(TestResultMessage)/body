{
  if (testNGResults != null) {
    int exceptionMark=myExceptionalMark == -1 ? 0 : myExceptionalMark;
    final String stackTrace=result.getStackTrace();
    if (stackTrace != null && stackTrace.length() > 10) {
      String trimmed=trimStackTrace(stackTrace);
      List<Printable> printables=getPrintables(result,trimmed);
      for (      Printable printable : printables) {
        printable.print(getConsole());
      }
synchronized (currentTestOutput) {
        exceptionMark=currentTestOutput.size();
        currentTestOutput.addAll(printables);
      }
    }
    testNGResults.addTestResult(result,new ArrayList<Printable>(currentTestOutput),exceptionMark);
    myExceptionalMark=-1;
synchronized (currentTestOutput) {
      currentTestOutput.clear();
    }
  }
}
