{
  if (testNGResults != null) {
    List<Printable> list=null;
    int exceptionMark=0;
    if (result.getResult() == MessageHelper.TEST_STARTED) {
      mark();
    }
 else {
      String stackTrace=result.getStackTrace();
      if (stackTrace != null && stackTrace.length() > 10) {
        String trimmed=trimStackTrace(stackTrace);
        List<Printable> printables=getPrintables(result,trimmed);
        for (        Printable printable : printables) {
          printable.print(console);
        }
synchronized (allOutput) {
          exceptionMark=allOutput.size() - mark;
          allOutput.addAll(printables);
        }
      }
      list=getPrintablesSinceMark();
    }
    testNGResults.addTestResult(result,list,exceptionMark);
  }
}
