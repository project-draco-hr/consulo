{
  Presentation presentation=e.getPresentation();
  presentation.setVisible(true);
  presentation.setEnabled(true);
  DataContext dataContext=e.getDataContext();
  Project project=e.getData(PlatformDataKeys.PROJECT);
  if (project == null || isHidden()) {
    hideAction(e);
    return;
  }
  Editor editor=e.getData(PlatformDataKeys.EDITOR);
  PsiFile file=e.getData(LangDataKeys.PSI_FILE);
  if (file != null) {
    if (file instanceof PsiCompiledElement || !isAvailableForFile(file)) {
      hideAction(e);
      return;
    }
  }
  if (editor == null) {
    if (isAvailableInEditorOnly()) {
      hideAction(e);
      return;
    }
    final PsiElement[] elements=getPsiElementArray(dataContext);
    final boolean isEnabled=isEnabledOnDataContext(dataContext) || elements.length != 0 && isEnabledOnElements(elements);
    if (!isEnabled) {
      disableAction(e);
    }
  }
 else {
    PsiElement element=e.getData(LangDataKeys.PSI_ELEMENT);
    Language[] languages=e.getData(LangDataKeys.CONTEXT_LANGUAGES);
    if (element == null || !isAvailableForLanguage(element.getLanguage())) {
      if (file == null) {
        hideAction(e);
        return;
      }
      element=getElementAtCaret(editor,file);
      if (element != null) {
        languages=new Language[]{element.getLanguage()};
      }
    }
    if (element == null || element instanceof SyntheticElement || languages == null) {
      hideAction(e);
      return;
    }
    boolean isVisible=ContainerUtil.find(languages,myLanguageCondition) != null;
    if (isVisible) {
      boolean isEnabled=isAvailableOnElementInEditorAndFile(element,editor,file,dataContext);
      if (!isEnabled) {
        disableAction(e);
      }
    }
 else {
      hideAction(e);
    }
  }
}
