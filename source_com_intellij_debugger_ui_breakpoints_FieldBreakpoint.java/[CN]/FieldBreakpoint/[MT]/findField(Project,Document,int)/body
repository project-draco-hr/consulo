{
  PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(document);
  if (file == null)   return null;
  offset=CharArrayUtil.shiftForward(document.getCharsSequence(),offset," \t");
  PsiElement element=file.findElementAt(offset);
  if (element == null)   return null;
  PsiField field=PsiTreeUtil.getParentOfType(element,PsiField.class,false);
  int line=document.getLineNumber(offset);
  if (field == null) {
    final PsiField[] fld=new PsiField[]{null};
    DebuggerUtilsEx.iterateLine(project,document,line,new DebuggerUtilsEx.ElementVisitor(){
      public boolean acceptElement(      PsiElement element){
        PsiField field=PsiTreeUtil.getParentOfType(element,PsiField.class,false);
        if (field != null) {
          fld[0]=field;
          return true;
        }
        return false;
      }
    }
);
    field=fld[0];
  }
  return field;
}
