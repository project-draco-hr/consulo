{
  final ID<K,V> name=extension.getName();
  final int version=extension.getVersion();
  if (extension.dependsOnFileContent()) {
    myNeedContentLoading.add(name);
  }
  myIndexIdToVersionMap.put(name,version);
  final File versionFile=getVersionFile(name);
  if (readVersion(versionFile) != version) {
    FileUtil.delete(getIndexRootDir(name));
    rewriteVersion(versionFile,version);
  }
  for (int attempt=0; attempt < 2; attempt++) {
    try {
      final MapIndexStorage<K,V> storage=new MapIndexStorage<K,V>(getStorageFile(name),extension.getKeyDescriptor(),extension.getValueExternalizer());
      final MemoryIndexStorage<K,V> memStorage=new MemoryIndexStorage<K,V>(storage);
      final MapReduceIndex<?,?,FileContent> index=new MapReduceIndex<K,V,FileContent>(extension.getIndexer(),memStorage);
      myIndices.put(name,new Pair<UpdatableIndex<?,?,FileContent>,InputFilter>(index,extension.getInputFilter()));
      break;
    }
 catch (    IOException e) {
      FileUtil.delete(getIndexRootDir(name));
      rewriteVersion(versionFile,version);
    }
  }
}
