{
  if (myIndices.size() == 0) {
    return;
  }
  indicator.pushState();
  try {
    indicator.setText("Building indices...");
    final UnindexedFilesFinder filesCounter=new UnindexedFilesFinder(myIndices.keySet());
    iterateIndexableFiles(project,filesCounter);
    final List<VirtualFile> unindexedFiles=filesCounter.getFiles();
    int myProcessed=0;
    final double myTotalCount=(double)unindexedFiles.size();
    for (    VirtualFile file : unindexedFiles) {
      indicator.setText2(file.getPresentableUrl());
      indexFile(file,loadContent(file));
      indicator.setFraction(((double)++myProcessed) / myTotalCount);
    }
  }
  finally {
    indicator.setText("Saving caches...");
    myFlushStorages.execute();
    indicator.popState();
  }
}
