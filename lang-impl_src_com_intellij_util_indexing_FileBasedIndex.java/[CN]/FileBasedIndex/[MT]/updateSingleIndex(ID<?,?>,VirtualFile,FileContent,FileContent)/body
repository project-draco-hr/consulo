{
  setDataBufferingEnabled(false);
synchronized (myLastIndexedDocStamps) {
    myLastIndexedDocStamps.clear();
    myLastIndexedUnsavedContent.clear();
  }
  final int inputId=Math.abs(getFileId(file));
  final UpdatableIndex<?,?,FileContent> index=getIndex(indexId);
  if (CachesBasedRefSearcher.DEBUG) {
    System.out.println("FileBasedIndex.updateSingleIndex");
    System.out.println("indexId = " + indexId);
    System.out.println("Indexing inputId = " + inputId);
    System.out.println("file = " + file.getPresentableUrl());
    System.out.println("IndexInfrastructure.getIndexRootDir(indexId) = " + IndexInfrastructure.getIndexRootDir(indexId));
  }
  index.update(inputId,currentFC,oldFC);
  if (file.isValid()) {
    if (currentFC != null) {
      IndexingStamp.update(file,indexId,IndexInfrastructure.getIndexCreationStamp(indexId));
    }
 else {
      IndexingStamp.update(file,indexId,-1L);
    }
  }
}
