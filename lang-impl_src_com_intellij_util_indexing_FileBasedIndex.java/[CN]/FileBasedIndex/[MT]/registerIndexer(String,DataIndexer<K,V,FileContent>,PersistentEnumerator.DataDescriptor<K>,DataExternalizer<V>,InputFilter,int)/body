{
  myIndexIdToVersionMap.put(name,version);
  final File versionFile=getVersionFile(name);
  if (readVersion(versionFile) != version || ourUnitTestMode) {
    FileUtil.delete(getIndexRootDir(name));
    rewriteVersion(versionFile,version);
  }
  for (int attempt=0; attempt < 2; attempt++) {
    try {
      final MapIndexStorage<K,V> storage=new MapIndexStorage<K,V>(getStorageFile(name),keyDescriptor,valueExternalizer);
      final MemoryIndexStorage<K,V> memStorage=new MemoryIndexStorage<K,V>(storage);
      final MapReduceIndex<?,?,FileContent> index=new MapReduceIndex<K,V,FileContent>(indexer,memStorage);
      myIndices.put(name,new Pair<UpdatableIndex<?,?,FileContent>,InputFilter>(index,filter));
      break;
    }
 catch (    IOException e) {
      FileUtil.delete(getIndexRootDir(name));
      rewriteVersion(versionFile,version);
    }
  }
}
