{
  final UnindexedFilesUpdater updater=new UnindexedFilesUpdater(project);
  try {
    final StartupManagerEx startupManager=(StartupManagerEx)StartupManager.getInstance(project);
    startupManager.registerPreStartupActivity(new Runnable(){
      public void run(){
        startupManager.getFileSystemSynchronizer().registerCacheUpdater(updater);
        ProjectRootManagerEx.getInstanceEx(project).registerChangeUpdater(updater);
      }
    }
);
  }
  finally {
    myUpdaters.put(project,updater);
  }
}
