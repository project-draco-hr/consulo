{
  if (!file.isDirectory()) {
    if (file instanceof NewVirtualFile) {
      if (((NewVirtualFile)file).getFlag(ALREADY_PROCESSED))       return true;
    }
    if (file instanceof VirtualFileWithId && !SingleRootFileViewProvider.isTooLarge(file)) {
      boolean oldStuff=true;
      for (      ID<?,?> indexId : myIndexIds) {
        if (myFileContentAttic.containsContent(file) ? getInputFilter(indexId).acceptInput(file) : shouldIndexFile(file,indexId)) {
          myFiles.add(file);
          oldStuff=false;
          break;
        }
      }
      FileContent fileContent=null;
      for (      ID<?,?> indexId : mySkipContentLoading) {
        if (shouldIndexFile(file,indexId)) {
          oldStuff=false;
          try {
            if (fileContent == null) {
              fileContent=new FileContent(file);
            }
            updateSingleIndex(indexId,file,fileContent,null);
          }
 catch (          StorageException e) {
            LOG.info(e);
            requestRebuild(indexId);
          }
        }
      }
      IndexingStamp.flushCache();
      if (oldStuff && file instanceof NewVirtualFile) {
        ((NewVirtualFile)file).setFlag(ALREADY_PROCESSED,true);
      }
    }
  }
 else {
    if (myProgressIndicator != null) {
      myProgressIndicator.setText("Scanning files to index");
      myProgressIndicator.setText2(file.getPresentableUrl());
    }
  }
  return true;
}
