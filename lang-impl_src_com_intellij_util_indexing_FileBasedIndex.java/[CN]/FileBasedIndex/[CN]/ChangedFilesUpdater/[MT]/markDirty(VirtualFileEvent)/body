{
  cleanProcessedFlag(event.getFile());
  iterateIndexableFiles(event.getFile(),new Processor<VirtualFile>(){
    public boolean process(    final VirtualFile file){
      FileContent fileContent=null;
      final boolean isTooLarge=SingleRootFileViewProvider.isTooLarge(file);
      for (      ID<?,?> indexId : myIndices.keySet()) {
        if (getInputFilter(indexId).acceptInput(file)) {
          if (needsFileContentLoading(indexId)) {
            if (!isTooLarge) {
              w.lock();
              try {
                myFilesToUpdate.add(file);
              }
  finally {
                w.unlock();
              }
            }
          }
 else {
            try {
              if (fileContent == null) {
                fileContent=new FileContent(file);
              }
              updateSingleIndex(indexId,file,fileContent,null);
            }
 catch (            StorageException e) {
              LOG.info(e);
              requestRebuild(indexId);
            }
          }
        }
      }
      return true;
    }
  }
);
  IndexingStamp.flushCache();
}
