{
  ensureAllInvalidateTasksCompleted();
  final boolean alreadyAquired=myAlreadyAquired.get().booleanValue();
  if (alreadyAquired) {
    return;
  }
  myAlreadyAquired.set(Boolean.TRUE);
  final VirtualFile[] files=queryNeededFiles();
  if (files.length > 0) {
    myForceUpdateSemaphore.down();
    try {
      for (      VirtualFile file : files) {
        processFileImpl(new com.intellij.ide.startup.FileContent(file));
      }
    }
  finally {
      myForceUpdateSemaphore.up();
      myAlreadyAquired.set(Boolean.FALSE);
      myForceUpdateSemaphore.waitFor();
    }
  }
}
