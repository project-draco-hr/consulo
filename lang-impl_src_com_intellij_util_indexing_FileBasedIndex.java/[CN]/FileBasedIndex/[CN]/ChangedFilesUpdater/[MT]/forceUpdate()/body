{
  ensureAllInvalidateTasksCompleted();
  final Boolean alreadyAquired=myAlreadyAquired.get();
  if (alreadyAquired) {
    return;
  }
  myAlreadyAquired.set(Boolean.TRUE);
  myForceUpdateSemaphore.down();
  try {
    for (    VirtualFile file : queryNeededFiles()) {
      processFileImpl(new com.intellij.ide.startup.FileContent(file));
    }
  }
  finally {
    myForceUpdateSemaphore.up();
    myAlreadyAquired.set(Boolean.FALSE);
    myForceUpdateSemaphore.waitFor();
  }
}
