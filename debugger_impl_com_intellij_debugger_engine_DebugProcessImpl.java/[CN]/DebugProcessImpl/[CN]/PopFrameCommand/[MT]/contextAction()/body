{
  final ThreadReferenceProxyImpl thread=myStackFrame.threadProxy();
  try {
    if (!getSuspendManager().isSuspended(thread)) {
      notifyCancelled();
      return;
    }
  }
 catch (  ObjectCollectedException e) {
    notifyCancelled();
    return;
  }
  final SuspendContextImpl suspendContext=getSuspendContext();
  if (!suspendContext.suspends(thread)) {
    SuspendManagerUtil.postponeCommand(suspendContext,this);
    return;
  }
  if (myStackFrame.isBottom()) {
    DebuggerInvocationUtil.invokeLater(myProject,new Runnable(){
      public void run(){
        Messages.showMessageDialog(myProject,DebuggerBundle.message("error.pop.bottom.stackframe"),ActionsBundle.actionText(DebuggerActions.POP_FRAME),Messages.getErrorIcon());
      }
    }
);
    return;
  }
  try {
    thread.popFrames(myStackFrame);
  }
 catch (  final EvaluateException e) {
    DebuggerInvocationUtil.invokeLater(myProject,new Runnable(){
      public void run(){
        Messages.showMessageDialog(myProject,DebuggerBundle.message("error.pop.stackframe",e.getLocalizedMessage()),ActionsBundle.actionText(DebuggerActions.POP_FRAME),Messages.getErrorIcon());
      }
    }
);
    LOG.info(e);
  }
 finally {
    getSuspendManager().popFrame(suspendContext);
  }
}
