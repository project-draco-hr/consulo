{
  vcs.createFile("file",cf("old"),123L,false);
  d.startAction();
  Clock.setCurrentTimestamp(789);
  gateway.addUnsavedDocument("file","new");
  d.finishAction(null);
  assertEquals(c("new"),vcs.getEntry("file").getContent());
  assertEquals(789L,vcs.getEntry("file").getTimestamp());
  assertEquals(2,vcs.getRevisionsFor("file").size());
}
