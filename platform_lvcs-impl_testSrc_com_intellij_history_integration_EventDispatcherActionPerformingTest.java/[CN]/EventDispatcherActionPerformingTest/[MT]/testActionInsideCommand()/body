{
  long timestamp=-1;
  vcs.createFile("f",cf("1"),timestamp,false);
  CommandEvent e=createCommandEvent("command");
  d.commandStarted(e);
  vcs.changeFileContent("f",cf("2"),-1);
  gateway.addUnsavedDocument("f","3");
  d.startAction();
  vcs.changeFileContent("f",cf("4"),-1);
  gateway.addUnsavedDocument("f","5");
  d.finishAction("action");
  vcs.changeFileContent("f",cf("6"),-1);
  d.commandFinished(e);
  List<Revision> rr=vcs.getRevisionsFor("f");
  assertEquals(3,rr.size());
  assertEquals(c("6"),rr.get(0).getEntry().getContent());
  assertEquals(c("3"),rr.get(1).getEntry().getContent());
  assertEquals(c("1"),rr.get(2).getEntry().getContent());
  assertEquals("command",rr.get(0).getCauseChangeName());
  assertNull(rr.get(1).getCauseChangeName());
  assertNull(rr.get(2).getCauseChangeName());
}
