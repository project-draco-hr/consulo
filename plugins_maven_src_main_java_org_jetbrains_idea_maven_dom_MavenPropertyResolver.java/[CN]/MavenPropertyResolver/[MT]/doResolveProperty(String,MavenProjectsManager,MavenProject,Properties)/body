{
  boolean hasPrefix=false;
  String unprefixed=propName;
  if (propName.startsWith("pom.")) {
    unprefixed=propName.substring("pom.".length());
    hasPrefix=true;
  }
 else   if (propName.startsWith("project.")) {
    unprefixed=propName.substring("project.".length());
    hasPrefix=true;
  }
  MavenProject selectedProject=mavenProject;
  while (unprefixed.startsWith("parent.")) {
    MavenId parentId=selectedProject.getParentId();
    if (parentId == null)     return null;
    selectedProject=projectsManager.findProject(parentId);
    if (selectedProject == null)     return null;
    unprefixed=unprefixed.substring("parent.".length());
  }
  if (unprefixed.equals("basedir") || (hasPrefix && mavenProject == selectedProject && unprefixed.equals("baseUri"))) {
    return selectedProject.getDirectory();
  }
  String result;
  result=MavenUtil.getPropertiesFromMavenOpts().get(propName);
  if (result != null)   return result;
  result=MavenServerUtil.collectSystemProperties().getProperty(propName);
  if (result != null)   return result;
  result=selectedProject.getModelMap().get(unprefixed);
  if (result != null)   return result;
  result=additionalProperties.getProperty(propName);
  if (result != null)   return result;
  result=mavenProject.getProperties().getProperty(propName);
  if (result != null)   return result;
  if (unprefixed.equals("groupId")) {
    return selectedProject.getMavenId().getGroupId();
  }
  if (unprefixed.equals("artifactId")) {
    return selectedProject.getMavenId().getArtifactId();
  }
  if (unprefixed.equals("version")) {
    return selectedProject.getMavenId().getVersion();
  }
  if (unprefixed.equals("buildDirectory")) {
    return selectedProject.getBuildDirectory();
  }
  if (unprefixed.equals("finalName")) {
    return selectedProject.getFinalName();
  }
  if (unprefixed.equals("outputDirectory")) {
    return selectedProject.getOutputDirectory();
  }
  if (unprefixed.equals("testOutputDirectory")) {
    return selectedProject.getTestOutputDirectory();
  }
  return null;
}
