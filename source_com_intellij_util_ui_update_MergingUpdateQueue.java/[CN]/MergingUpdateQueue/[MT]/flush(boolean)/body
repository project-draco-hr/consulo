{
  if (myFlushing)   return;
  if (!isModalityStateCorrect())   return;
  myFlushing=true;
  final Runnable toRun=new Runnable(){
    public void run(){
      try {
        List<Update> toUpdate;
        final Update[] all;
synchronized (mySheduledUpdates) {
          toUpdate=new ArrayList<Update>(mySheduledUpdates.size());
          all=mySheduledUpdates.toArray(new Update[mySheduledUpdates.size()]);
          mySheduledUpdates.clear();
        }
        for (int i=0; i < all.length; i++) {
          Update each=all[i];
          if (!isExpired(each)) {
            toUpdate.add(each);
          }
          each.setProcessed();
        }
        execute(toUpdate.toArray(new Update[toUpdate.size()]));
      }
  finally {
        myFlushing=false;
      }
    }
  }
;
  if (invokeLaterIfNotDispatch && !ApplicationManager.getApplication().isDispatchThread()) {
    SwingUtilities.invokeLater(toRun);
  }
 else {
    toRun.run();
  }
}
