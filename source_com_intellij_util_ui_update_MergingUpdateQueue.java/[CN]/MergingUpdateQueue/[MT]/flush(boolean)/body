{
  if (myFlushing) {
    return;
  }
  if (!isModalityStateCorrect()) {
    return;
  }
  myFlushing=true;
  final Runnable toRun=new Runnable(){
    public void run(){
      try {
        List<Update> toUpdate;
        final Update[] all;
synchronized (mySheduledUpdates) {
          toUpdate=new ArrayList<Update>(mySheduledUpdates.size());
          all=mySheduledUpdates.toArray(new Update[mySheduledUpdates.size()]);
          mySheduledUpdates.clear();
        }
        for (        Update each : all) {
          toUpdate.add(each);
          each.setProcessed();
        }
        execute(toUpdate.toArray(new Update[toUpdate.size()]));
      }
  finally {
        myFlushing=false;
      }
    }
  }
;
  if (invokeLaterIfNotDispatch && !ApplicationManager.getApplication().isDispatchThread()) {
    ApplicationManager.getApplication().invokeLater(toRun,ModalityState.NON_MMODAL);
  }
 else {
    toRun.run();
  }
}
