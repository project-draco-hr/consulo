{
  final PsiParameter[] parms=method.getParameterList().getParameters();
  if (args.length < parms.length - 1)   return ApplicabilityLevel.NOT_APPLICABLE;
  final PsiClass containingClass=method.getContainingClass();
  final boolean isRaw=containingClass != null && isRawSubstitutor(containingClass,substitutorForMethod);
  if (!areFirstArgumentsApplicable(args,parms,languageLevel,substitutorForMethod,isRaw))   return ApplicabilityLevel.NOT_APPLICABLE;
  if (args.length == parms.length) {
    if (parms.length == 0)     return ApplicabilityLevel.FIXED_ARITY;
    PsiType parmType=getParameterType(parms[parms.length - 1],languageLevel,substitutorForMethod);
    PsiType argType=args[args.length - 1];
    if (argType == null)     return ApplicabilityLevel.NOT_APPLICABLE;
    if (TypeConversionUtil.isAssignable(parmType,argType))     return ApplicabilityLevel.FIXED_ARITY;
    if (isRaw) {
      final PsiType erasedParamType=TypeConversionUtil.erasure(parmType);
      final PsiType erasedArgType=TypeConversionUtil.erasure(argType);
      if (erasedArgType != null && erasedParamType != null && TypeConversionUtil.isAssignable(erasedParamType,erasedArgType)) {
        return ApplicabilityLevel.FIXED_ARITY;
      }
    }
  }
  if (method.isVarArgs() && languageLevel.compareTo(LanguageLevel.JDK_1_5) >= 0) {
    if (args.length < parms.length)     return ApplicabilityLevel.VARARGS;
    PsiParameter lastParameter=parms[parms.length - 1];
    if (!lastParameter.isVarArgs())     return ApplicabilityLevel.NOT_APPLICABLE;
    PsiType lastParmType=getParameterType(lastParameter,languageLevel,substitutorForMethod);
    if (!(lastParmType instanceof PsiArrayType))     return ApplicabilityLevel.NOT_APPLICABLE;
    lastParmType=((PsiArrayType)lastParmType).getComponentType();
    if (lastParmType instanceof PsiCapturedWildcardType) {
      lastParmType=((PsiCapturedWildcardType)lastParmType).getWildcard();
    }
    for (int i=parms.length - 1; i < args.length; i++) {
      PsiType argType=args[i];
      if (argType == null || !TypeConversionUtil.isAssignable(lastParmType,argType)) {
        return ApplicabilityLevel.NOT_APPLICABLE;
      }
    }
    return ApplicabilityLevel.VARARGS;
  }
  return ApplicabilityLevel.NOT_APPLICABLE;
}
