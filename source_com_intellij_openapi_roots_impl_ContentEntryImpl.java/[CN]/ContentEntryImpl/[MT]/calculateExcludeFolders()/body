{
  if (!myRootModel.isExcludeOutput() && !myRootModel.isExcludeExplodedDirectory() && myExcludedOutputFolders.isEmpty()) {
    return myExcludeFolders.toArray(new ExcludeFolder[myExcludeFolders.size()]);
  }
  final ArrayList<ExcludeFolder> result=new ArrayList<ExcludeFolder>(myExcludeFolders);
  result.addAll(myExcludedOutputFolders);
  if (myRootModel.isExcludeOutput()) {
    final CompilerModuleExtension compilerModuleExtension=CompilerModuleExtension.getInstance(myRootModel.getModule());
    if (!compilerModuleExtension.isCompilerOutputPathInherited()) {
      addExcludeForOutputPath(compilerModuleExtension.getCompilerOutputPointer(),result);
      addExcludeForOutputPath(compilerModuleExtension.getCompilerOutputForTestsPointer(),result);
    }
 else {
      CompilerProjectExtension compilerProjectExtension=CompilerProjectExtension.getInstance(myRootModel.getModule().getProject());
      final String outputUrl=compilerProjectExtension.getCompilerOutputUrl();
      if (outputUrl != null) {
        if (new File(VfsUtil.urlToPath(outputUrl)).exists()) {
          addExcludeForOutputPath(compilerProjectExtension.getCompilerOutputPointer(),result);
        }
      }
    }
  }
  if (myRootModel.isExcludeExplodedDirectory()) {
    addExcludeForOutputPath(myRootModel.myExplodedDirectoryPointer,result);
  }
  return result.toArray(new ExcludeFolder[result.size()]);
}
