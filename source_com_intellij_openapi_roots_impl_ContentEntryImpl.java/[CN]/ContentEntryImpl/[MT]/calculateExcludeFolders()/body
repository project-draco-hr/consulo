{
  if (!myRootModel.isExcludeOutput() && !myRootModel.isExcludeExplodedDirectory() && myExcludedOutputFolders.isEmpty()) {
    return myExcludeFolders.toArray(new ExcludeFolder[myExcludeFolders.size()]);
  }
  final ArrayList<ExcludeFolder> result=new ArrayList<ExcludeFolder>(myExcludeFolders);
  result.addAll(myExcludedOutputFolders);
  if (myRootModel.isExcludeOutput()) {
    if (!myRootModel.isCompilerOutputPathInherited()) {
      addExcludeForOutputPath(myRootModel.myCompilerOutputPointer,result);
      addExcludeForOutputPath(myRootModel.myCompilerOutputPathForTestsPointer,result);
    }
 else {
      ProjectRootManagerImpl projectRootManager=ProjectRootManagerImpl.getInstanceImpl(myRootModel.getModule().getProject());
      final String outputUrl=projectRootManager.getCompilerOutputUrl();
      if (outputUrl != null) {
        if (new File(VfsUtil.urlToPath(outputUrl)).exists()) {
          addExcludeForOutputPath(projectRootManager.getCompilerOutputPointer(),result);
        }
      }
    }
  }
  if (myRootModel.isExcludeExplodedDirectory()) {
    addExcludeForOutputPath(myRootModel.myExplodedDirectoryPointer,result);
  }
  return result.toArray(new ExcludeFolder[result.size()]);
}
