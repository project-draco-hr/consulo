{
  if (myText == null)   return null;
  myText=myText.replaceAll(String.valueOf(UIUtil.MNEMONIC),"");
  final boolean expanded=myCurrentWidth > 0 && dressDescription(editor);
  final HintManagerImpl hintManager=HintManagerImpl.getInstanceImpl();
  final JComponent contentComponent=editor.getContentComponent();
  final JComponent editorComponent=editor.getComponent();
  if (!editorComponent.isShowing())   return null;
  final JLayeredPane layeredPane=editorComponent.getRootPane().getLayeredPane();
  final JEditorPane pane=IdeTooltipManager.initPane(new Html(myText).setKeepFont(true),hintHint,layeredPane);
  hintHint.setContentActive(isActiveHtml(myText));
  if (!hintHint.isAwtTooltip()) {
    correctLocation(editor,pane,p,alignToRight,expanded,myCurrentWidth);
  }
  final JScrollPane scrollPane=ScrollPaneFactory.createScrollPane(pane);
  scrollPane.setBorder(null);
  scrollPane.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_AS_NEEDED);
  scrollPane.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_AS_NEEDED);
  scrollPane.setOpaque(hintHint.isOpaqueAllowed());
  scrollPane.getViewport().setOpaque(hintHint.isOpaqueAllowed());
  scrollPane.setBackground(hintHint.getTextBackground());
  scrollPane.getViewport().setBackground(hintHint.getTextBackground());
  scrollPane.setViewportBorder(null);
  final Ref<AnAction> actionRef=new Ref<AnAction>();
  final LightweightHint hint=new LightweightHint(scrollPane){
    @Override public void hide(){
      onHide(pane);
      super.hide();
      final AnAction action=actionRef.get();
      if (action != null) {
        action.unregisterCustomShortcutSet(contentComponent);
      }
    }
  }
;
  actionRef.set(new AnAction(){
{
      registerCustomShortcutSet(new CustomShortcutSet(KeymapManager.getInstance().getActiveKeymap().getShortcuts(IdeActions.ACTION_SHOW_ERROR_DESCRIPTION)),contentComponent);
    }
    @Override public void actionPerformed(    final AnActionEvent e){
      expand(hint,editor,p,pane,alignToRight,group,hintHint);
    }
  }
);
  pane.addHyperlinkListener(new HyperlinkListener(){
    @Override public void hyperlinkUpdate(    final HyperlinkEvent e){
      myActiveLink=true;
      if (e.getEventType() == HyperlinkEvent.EventType.EXITED) {
        myActiveLink=false;
        return;
      }
      if (e.getEventType() == HyperlinkEvent.EventType.ACTIVATED) {
        final URL url=e.getURL();
        if (url != null) {
          BrowserUtil.browse(url);
          hint.hide();
          return;
        }
        final String description=e.getDescription();
        if (description != null && handle(description,editor)) {
          hint.hide();
          return;
        }
        if (!expanded) {
          expand(hint,editor,p,pane,alignToRight,group,hintHint);
        }
 else {
          stripDescription();
          hint.hide();
          TooltipController.getInstance().showTooltip(editor,new Point(p.x - 3,p.y - 3),createRenderer(myText,0),false,group,hintHint);
        }
      }
    }
  }
);
  pane.addMouseListener(new MouseAdapter(){
    @Override public void mouseReleased(    final MouseEvent e){
      if (!myActiveLink) {
        MouseEvent newMouseEvent=SwingUtilities.convertMouseEvent(e.getComponent(),e,contentComponent);
        hint.hide();
        contentComponent.dispatchEvent(newMouseEvent);
      }
    }
    @Override public void mouseExited(    final MouseEvent e){
      if (!expanded) {
        hint.hide();
      }
    }
  }
);
  hintManager.showEditorHint(hint,editor,p,HintManager.HIDE_BY_ANY_KEY | HintManager.HIDE_BY_TEXT_CHANGE | HintManager.HIDE_BY_OTHER_HINT| HintManager.HIDE_BY_SCROLLING,0,false,hintHint);
  return hint;
}
