{
  XIncludeNodeList result=new XIncludeNodeList();
  String base=null;
  if (bases.size() != 0)   base=bases.peek();
  if (isIncludeElement(original)) {
    resolveInclude(original,base,bases,result,resolved);
  }
 else {
    Element copy=(Element)resolved.importNode(original,false);
    NodeList children=original.getChildNodes();
    for (int i=0; i < children.getLength(); i++) {
      Node n=children.item(i);
      if (n instanceof Element) {
        Element e=(Element)n;
        NodeList kids=resolve(e,bases,resolved);
        for (int j=0; j < kids.getLength(); j++) {
          copy.appendChild(copy.getOwnerDocument().adoptNode(kids.item(j)));
        }
      }
 else {
        copy.appendChild(resolved.importNode(n,true));
      }
    }
    result.add(copy);
  }
  return result;
}
