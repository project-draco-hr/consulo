{
  String libraryName=makeLibraryName(artifact);
  Library library=provider.getLibraryByName(libraryName);
  if (library == null) {
    library=provider.createLibrary(libraryName);
    Library.ModifiableModel libraryModel=provider.getModifiableModel(library);
    String artifactPath=artifact.getFile().getPath();
    setUrl(libraryModel,makeUrl(artifactPath,null),OrderRootType.CLASSES);
    setUrl(libraryModel,makeUrl(artifactPath,MavenConstants.SOURCES_CLASSIFIER),OrderRootType.SOURCES);
    setUrl(libraryModel,makeUrl(artifactPath,MavenConstants.JAVADOC_CLASSIFIER),JavadocOrderRootType.getInstance());
    provider.commit(libraryModel);
  }
  provider.markLibraryAsUsed(library);
  myRootModel.addLibraryEntry(library).setExported(isExportable);
  removeOldLibraryDependency(artifact);
}
