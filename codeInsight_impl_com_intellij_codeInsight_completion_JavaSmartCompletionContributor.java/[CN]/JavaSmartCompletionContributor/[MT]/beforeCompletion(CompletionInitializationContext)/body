{
  if (context.getCompletionType() == CompletionType.SMART && !context.getEditor().getSelectionModel().hasSelection()) {
    final PsiFile file=context.getFile();
    PsiElement element=file.findElementAt(context.getStartOffset());
    if (element instanceof PsiIdentifier) {
      element=element.getParent();
      while (element instanceof PsiJavaCodeReferenceElement || element instanceof PsiMethodCallExpression || element instanceof PsiThisExpression|| element instanceof PsiSuperExpression|| element instanceof PsiTypeElement|| element instanceof PsiClassObjectAccessExpression) {
        context.getOffsetMap().addOffset(CompletionInitializationContext.IDENTIFIER_END_OFFSET,element.getTextRange().getEndOffset());
        element=element.getParent();
      }
    }
  }
}
