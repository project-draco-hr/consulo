{
  PsiManager manager=PsiManager.getInstance(project);
  ArrayList<Object> array=new ArrayList<Object>();
  Object[] refObjects=new Object[refs.length];
  for (int i=0; i < referenceData.length; i++) {
    PsiElement ref=refs[i];
    if (ref != null) {
      LOG.assertTrue(ref.isValid());
      ReferenceTransferableData.ReferenceData data=referenceData[i];
      PsiClass refClass=JavaPsiFacade.getInstance(manager.getProject()).findClass(data.qClassName,ref.getResolveScope());
      if (refClass == null)       continue;
      Object refObject=refClass;
      if (data.staticMemberName != null) {
        refObject=refClass.getQualifiedName() + "." + data.staticMemberName;
      }
      refObjects[i]=refObject;
      if (!array.contains(refObject)) {
        array.add(refObject);
      }
    }
  }
  if (array.isEmpty())   return;
  Object[] selectedObjects=ArrayUtil.toObjectArray(array);
  Arrays.sort(selectedObjects,new Comparator<Object>(){
    @Override public int compare(    Object o1,    Object o2){
      String fqName1=getFQName(o1);
      String fqName2=getFQName(o2);
      return fqName1.compareToIgnoreCase(fqName2);
    }
  }
);
  RestoreReferencesDialog dialog=new RestoreReferencesDialog(project,selectedObjects);
  dialog.show();
  selectedObjects=dialog.getSelectedElements();
  for (int i=0; i < referenceData.length; i++) {
    PsiElement ref=refs[i];
    if (ref != null) {
      LOG.assertTrue(ref.isValid());
      Object refObject=refObjects[i];
      boolean found=false;
      for (      Object selected : selectedObjects) {
        if (Comparing.equal(refObject,selected)) {
          found=true;
          break;
        }
      }
      if (!found) {
        refs[i]=null;
      }
    }
  }
}
