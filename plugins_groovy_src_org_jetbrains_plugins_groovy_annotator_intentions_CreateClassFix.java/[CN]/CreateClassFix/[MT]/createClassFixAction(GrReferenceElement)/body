{
  return new CreateClassActionBase(refElement){
    public void invoke(    @NotNull Project project,    Editor editor,    PsiFile file) throws IncorrectOperationException {
      if (!(file instanceof GroovyFileBase || file instanceof GspFile))       return;
      final PsiManager manager=myRefElement.getManager();
      final String name=myRefElement.getReferenceName();
      final Module module=ModuleUtil.findModuleForPsiElement(file);
      GroovyFileBase groovyFile=file instanceof GspFile ? ((GspFile)file).getGroovyLanguageRoot() : (GroovyFileBase)file;
      final String qualifier=groovyFile instanceof GroovyFile ? groovyFile.getPackageName() : "";
      String title=GroovyBundle.message("create.class.family.name");
      GroovyCreateClassDialog dialog=new GroovyCreateClassDialog(project,title,name,qualifier,module);
      dialog.show();
      if (dialog.getExitCode() != DialogWrapper.OK_EXIT_CODE)       return;
      PsiDirectory targetDirectory=dialog.getTargetDirectory();
      if (targetDirectory == null)       return;
      PsiClass targetClass=createClassByType(targetDirectory,name,manager,myRefElement);
      if (targetClass != null) {
        String qualifiedName=targetClass.getQualifiedName();
        if (qualifiedName != null && qualifiedName.contains(".")) {
          String packageName=qualifiedName.substring(0,qualifiedName.lastIndexOf("."));
          if (!packageName.equals(qualifier)) {
            groovyFile.addImportForClass(targetClass);
          }
        }
        putCursor(project,targetClass.getContainingFile(),targetClass);
      }
    }
  }
;
}
