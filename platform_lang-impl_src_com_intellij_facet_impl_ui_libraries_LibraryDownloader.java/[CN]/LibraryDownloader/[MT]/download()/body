{
  VirtualFile dir=null;
  if (myDirectoryForDownloadedFilesPath != null) {
    File ioDir=new File(FileUtil.toSystemDependentName(myDirectoryForDownloadedFilesPath));
    ioDir.mkdirs();
    dir=LocalFileSystem.getInstance().refreshAndFindFileByPath(myDirectoryForDownloadedFilesPath);
  }
  if (dir == null) {
    dir=chooseDirectoryForLibraries();
  }
  if (dir != null) {
    return doDownload(dir);
  }
  return VirtualFile.EMPTY_ARRAY;
}
