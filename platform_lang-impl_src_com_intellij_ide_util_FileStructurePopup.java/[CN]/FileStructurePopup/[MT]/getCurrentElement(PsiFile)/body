{
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  Object elementAtCursor=myTreeModel.getCurrentEditorElement();
  if (elementAtCursor instanceof PsiElement) {
    return (PsiElement)elementAtCursor;
  }
  if (psiFile != null && myFileEditor instanceof TextEditor) {
    return psiFile.getViewProvider().findElementAt(((TextEditor)myFileEditor).getEditor().getCaretModel().getOffset());
  }
  return null;
}
