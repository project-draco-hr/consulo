{
  if (!myShouldNarrowDown)   return true;
  String filter=mySpeedSearch != null && !StringUtil.isEmpty(mySpeedSearch.getEnteredPrefix()) ? mySpeedSearch.getEnteredPrefix() : null;
  if (!StringUtil.equals(myLastFilter,filter)) {
    myVisibleParents.clear();
    myLastFilter=filter;
  }
  if (filter != null) {
    if (myVisibleParents.contains(value)) {
      return true;
    }
    final String text=getText(value);
    if (text == null)     return false;
    boolean matches=mySpeedSearch.matchingFragments(text) != null;
    if (matches) {
      Object o=value;
      while (o instanceof FilteringTreeStructure.FilteringNode && (o=((FilteringTreeStructure.FilteringNode)o).getParent()) != null) {
        myVisibleParents.add(o);
      }
      return true;
    }
 else {
      return false;
    }
  }
  return true;
}
