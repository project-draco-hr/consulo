def getchanges(self, rev):
    ctx = self.changectx(rev)
    parents = self.parents(ctx)
    if (not parents):
        files = sorted(ctx.manifest())
        if self.ignoreerrors:
            self.getcopies(ctx, parents, files)
        return ([(f, rev) for f in files if (f not in self.ignored)], {})
    if (self._changescache and (self._changescache[0] == rev)):
        (m, a, r) = self._changescache[1]
    else:
        (m, a, r) = self.repo.status(parents[0].node(), ctx.node())[:3]
    copies = self.getcopies(ctx, parents, (m + a))
    changes = [(name, rev) for name in ((m + a) + r) if (name not in self.ignored)]
    return (sorted(changes), copies)
