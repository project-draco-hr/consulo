{
  final RuntimeException[] exception=new RuntimeException[1];
  Runnable executeUndoOrRedoAction=new Runnable(){
    public void run(){
      try {
        if (isUndoInProgress()) {
          myMerger.undoOrRedo(editor,true);
        }
 else {
          myMerger.undoOrRedo(editor,false);
        }
      }
 catch (      RuntimeException ex) {
        exception[0]=ex;
      }
 finally {
        myCurrentOperationState=NONE;
      }
    }
  }
;
  CommandProcessor.getInstance().executeCommand(myProject,executeUndoOrRedoAction,isUndoInProgress() ? CommonBundle.message("undo.command.name") : CommonBundle.message("redo.command.name"),null,myMerger.getUndoConfirmationPolicy());
  if (exception[0] != null)   throw exception[0];
}
