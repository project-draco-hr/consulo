{
  super.update(e);
  final Presentation presentation=e.getPresentation();
  if (presentation.isEnabled()) {
    final DataContext context=e.getDataContext();
    Module module=(Module)context.getData(DataConstants.MODULE);
    if (module == null || !PluginModuleType.isPluginModuleOrDependency(module)) {
      presentation.setEnabled(false);
      presentation.setVisible(false);
    }
    final IdeView view=(IdeView)e.getDataContext().getData(DataConstants.IDE_VIEW);
    final Project project=(Project)e.getDataContext().getData(DataConstants.PROJECT);
    if (view != null && project != null) {
      ProjectFileIndex projectFileIndex=ProjectRootManager.getInstance(project).getFileIndex();
      PsiDirectory[] dirs=view.getDirectories();
      for (      PsiDirectory dir : dirs) {
        if (projectFileIndex.isInSourceContent(dir.getVirtualFile()) && dir.getPackage() != null) {
          return;
        }
      }
      presentation.setEnabled(false);
      presentation.setVisible(false);
    }
  }
}
