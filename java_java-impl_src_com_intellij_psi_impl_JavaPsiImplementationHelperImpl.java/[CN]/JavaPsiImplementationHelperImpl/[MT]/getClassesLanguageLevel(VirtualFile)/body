{
  final ProjectFileIndex index=ProjectRootManager.getInstance(myProject).getFileIndex();
  final VirtualFile sourceRoot=index.getSourceRootForFile(virtualFile);
  final VirtualFile folder=virtualFile.getParent();
  if (sourceRoot != null && folder != null) {
    String relativePath=VfsUtilCore.getRelativePath(folder,sourceRoot,'/');
    LOG.assertTrue(relativePath != null);
    List<OrderEntry> orderEntries=index.getOrderEntriesForFile(virtualFile);
    if (orderEntries.isEmpty()) {
      LOG.error("Inconsistent: " + DirectoryIndex.getInstance(myProject).getInfoForDirectory(folder).toString());
    }
    final VirtualFile[] files=orderEntries.get(0).getFiles(OrderRootType.CLASSES);
    for (    VirtualFile rootFile : files) {
      final VirtualFile classFile=rootFile.findFileByRelativePath(relativePath);
      if (classFile != null) {
        return getLanguageLevel(classFile);
      }
    }
  }
  return null;
}
