{
  IdeaTestApplication.getInstance(null);
  String tempFileName=getClass().getName() + "-" + new Random().nextInt();
  myProjectFixture=IdeaTestFixtureFactory.getFixtureFactory().createFixtureBuilder(tempFileName).getFixture();
  edt(new ThrowableRunnable<Exception>(){
    @Override public void run() throws Exception {
      myProjectFixture.setUp();
    }
  }
);
  myProject=myProjectFixture.getProject();
  ((ProjectComponent)ChangeListManager.getInstance(myProject)).projectOpened();
  ((ProjectComponent)VcsDirtyScopeManager.getInstance(myProject)).projectOpened();
  myProjectRoot=myProject.getBasePath();
  myProjectDir=myProject.getBaseDir();
  myTestRoot=myProjectRoot;
  myPlatformFacade=ServiceManager.getService(myProject,GitPlatformFacade.class);
  myGit=ServiceManager.getService(myProject,Git.class);
  mySettings=myPlatformFacade.getSettings(myProject);
  mySettings.getAppSettings().setPathToGit(GitExecutor.GIT_EXECUTABLE);
  myVcsHelper=overrideService(myProject,AbstractVcsHelper.class,MockVcsHelper.class);
  myChangeListManager=(ChangeListManagerImpl)myPlatformFacade.getChangeListManager(myProject);
  myNotificator=(TestNotificator)ServiceManager.getService(myProject,Notificator.class);
  myVcs=GitVcs.getInstance(myProject);
  virtualCommits=new GitTestVirtualCommitsHolder();
  myAsyncTasks=new ArrayList<Future>();
  cd(myProjectRoot);
  myRepository=createRepo(myProjectRoot);
  ProjectLevelVcsManagerImpl vcsManager=(ProjectLevelVcsManagerImpl)ProjectLevelVcsManager.getInstance(myProject);
  AbstractVcs vcs=vcsManager.findVcsByName("Git");
  Assert.assertEquals(1,vcsManager.getRootsUnderVcs(vcs).length);
  assumeSupportedGitVersion();
}
