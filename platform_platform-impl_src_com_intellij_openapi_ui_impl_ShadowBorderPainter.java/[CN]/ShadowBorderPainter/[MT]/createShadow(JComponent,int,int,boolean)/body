{
  final GraphicsConfiguration graphicsConfiguration=GraphicsEnvironment.getLocalGraphicsEnvironment().getDefaultScreenDevice().getDefaultConfiguration();
  final BufferedImage image=graphicsConfiguration.createCompatibleImage(width,height,Transparency.TRANSLUCENT);
  final Graphics2D g=image.createGraphics();
  final Icon topLeft=isPopup ? POPUP_TOP_LEFT : TOP_LEFT;
  final Icon topRight=isPopup ? POPUP_TOP_RIGHT : TOP_RIGHT;
  final Icon bottom=isPopup ? POPUP_BOTTOM : BOTTOM;
  final Icon top=isPopup ? POPUP_TOP : TOP;
  final Icon bottomRight=isPopup ? POPUP_BOTTOM_RIGHT : BOTTOM_RIGHT;
  final Icon bottomLeft=isPopup ? POPUP_BOTTOM_LEFT : BOTTOM_LEFT;
  final Icon left=isPopup ? POPUP_LEFT : LEFT;
  final Icon right=isPopup ? POPUP_RIGHT : RIGHT;
  final int sideSize=isPopup ? POPUP_SIDE_SIZE : SIDE_SIZE;
  final int bottomSize=isPopup ? POPUP_BOTTOM_SIZE : BOTTOM_SIZE;
  topLeft.paintIcon(c,g,0,0);
  topRight.paintIcon(c,g,width - sideSize * 2,0);
  for (int _x=sideSize * 2; _x < width - sideSize * 2; _x++) {
    top.paintIcon(c,g,_x,0);
  }
  for (int _x=bottomSize * 2; _x < width - bottomSize * 2; _x++) {
    bottom.paintIcon(c,g,_x,height - bottomSize);
  }
  for (int _y=sideSize * 2; _y < height - bottomSize * 2; _y++) {
    left.paintIcon(c,g,0,_y);
    right.paintIcon(c,g,width - sideSize,_y);
  }
  bottomRight.paintIcon(c,g,width - bottomSize * 2,height - bottomSize * 2);
  bottomLeft.paintIcon(c,g,0,height - bottomSize * 2);
  g.dispose();
  return image;
}
