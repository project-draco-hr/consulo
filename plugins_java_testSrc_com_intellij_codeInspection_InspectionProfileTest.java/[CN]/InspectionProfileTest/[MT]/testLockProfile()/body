{
  final List<InspectionToolWrapper> list=new ArrayList<InspectionToolWrapper>();
  list.add(createTool("foo",true));
  InspectionToolRegistrar registrar=new InspectionToolRegistrar(null){
    @NotNull @Override public List<InspectionToolWrapper> createTools(){
      return list;
    }
  }
;
  InspectionProfileImpl profile=createProfile(registrar);
  List<ScopeToolState> tools=profile.getAllTools();
  assertEquals(1,tools.size());
  assertTrue(profile.isToolEnabled(HighlightDisplayKey.find("foo")));
  assertTrue(profile.getToolDefaultState("foo").isEnabled());
  InspectionProfileImpl model=(InspectionProfileImpl)profile.getModifiableModel();
  model.lockProfile(true);
  model.initInspectionTools(getProject());
  model.commit();
  assertEquals("<profile version=\"1.0\" is_locked=\"true\">\n" + "  <option name=\"myName\" value=\"Foo\" />\n" + "  <option name=\"myLocal\" value=\"true\" />\n"+ "  <inspection_tool class=\"foo\" enabled=\"true\" level=\"ERROR\" enabled_by_default=\"true\" />\n"+ "</profile>",serialize(profile));
  Element element=new Element("element");
  profile.writeExternal(element);
  list.add(createTool("bar",true));
  list.add(createTool("disabled",false));
  profile=createProfile(registrar);
  profile.readExternal(element);
  tools=profile.getAllTools();
  assertEquals(3,tools.size());
  assertTrue(profile.isProfileLocked());
  assertFalse(profile.isToolEnabled(HighlightDisplayKey.find("bar")));
  assertFalse(profile.isToolEnabled(HighlightDisplayKey.find("disabled")));
  assertTrue(profile.getToolDefaultState("bar").isEnabled());
  assertFalse(profile.getToolDefaultState("disabled").isEnabled());
  assertEquals("<profile version=\"1.0\" is_locked=\"true\">\n" + "  <option name=\"myName\" value=\"Foo\" />\n" + "  <option name=\"myLocal\" value=\"true\" />\n"+ "  <inspection_tool class=\"bar\" enabled=\"false\" level=\"ERROR\" enabled_by_default=\"true\" />\n"+ "  <inspection_tool class=\"disabled\" enabled=\"false\" level=\"ERROR\" enabled_by_default=\"false\" />\n"+ "  <inspection_tool class=\"foo\" enabled=\"true\" level=\"ERROR\" enabled_by_default=\"true\" />\n"+ "</profile>",serialize(profile));
}
