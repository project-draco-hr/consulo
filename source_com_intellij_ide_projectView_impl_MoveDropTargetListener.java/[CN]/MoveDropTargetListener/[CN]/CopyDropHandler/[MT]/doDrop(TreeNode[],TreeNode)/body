{
  final PsiElement[] sourceElements=getPsiElements(sourceNodes);
  final PsiElement targetElement=getPsiElement(targetNode);
  final PsiPackage psiPackage;
  final PsiDirectory psiDirectory;
  if (targetElement instanceof PsiPackage) {
    psiPackage=(PsiPackage)targetElement;
    final PsiDirectory[] psiDirectories=psiPackage.getDirectories();
    psiDirectory=psiDirectories.length != 0 ? psiDirectories[0] : null;
  }
 else {
    psiDirectory=(PsiDirectory)targetElement;
    psiPackage=psiDirectory == null ? null : JavaDirectoryService.getInstance().getPackage(psiDirectory);
  }
  CopyHandler.doCopy(sourceElements,psiPackage,psiDirectory);
}
