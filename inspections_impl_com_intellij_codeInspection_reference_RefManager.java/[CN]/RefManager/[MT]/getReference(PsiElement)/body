{
  LOG.assertTrue(isValidPointForReference(),"References may become invalid after process is finished");
  if (elem != null && !(elem instanceof PsiPackage) && RefUtil.belongsToScope(elem,this)) {
    if (!elem.isValid())     return null;
    RefElement ref=getRefTable().get(elem);
    if (ref == null) {
      if (elem instanceof PsiClass) {
        ref=new RefClass((PsiClass)elem,this);
      }
 else       if (elem instanceof PsiMethod) {
        ref=new RefMethod((PsiMethod)elem,this);
      }
 else       if (elem instanceof PsiField) {
        ref=new RefField((PsiField)elem,this);
      }
 else       if (elem instanceof PsiFile) {
        ref=new RefFile((PsiFile)elem,this);
      }
 else {
        return null;
      }
      getRefTable().put(elem,ref);
      ref.initialize();
    }
    return ref;
  }
  return null;
}
