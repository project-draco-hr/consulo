{
  myProject=project;
  initMainPanel();
  myFileNameField.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      final FileSaverDialog dialog=FileChooserFactory.getInstance().createSaveFileDialog(new FileSaverDescriptor("Save Patch to",""),myMainPanel);
      final String path=FileUtil.toSystemIndependentName(getFileName());
      final int idx=path.lastIndexOf("/");
      VirtualFile baseDir=idx == -1 ? project.getBaseDir() : (LocalFileSystem.getInstance().refreshAndFindFileByIoFile(new File(path.substring(0,idx))));
      baseDir=baseDir == null ? project.getBaseDir() : baseDir;
      final String name=idx == -1 ? path : path.substring(idx + 1);
      final VirtualFileWrapper fileWrapper=dialog.save(baseDir,name);
      if (fileWrapper != null) {
        myFileNameField.setText(fileWrapper.getFile().getPath());
      }
    }
  }
);
  myFileNameField.setTextFieldPreferredWidth(TEXT_FIELD_WIDTH);
  myBasePathField.setTextFieldPreferredWidth(TEXT_FIELD_WIDTH);
  myBasePathField.addBrowseFolderListener(new TextBrowseFolderListener(FileChooserDescriptorFactory.createSingleFolderDescriptor()));
  myWarningLabel.setForeground(JBColor.RED);
  selectBasePath(ObjectUtils.assertNotNull(myProject.getBaseDir()));
  initEncodingCombo();
}
