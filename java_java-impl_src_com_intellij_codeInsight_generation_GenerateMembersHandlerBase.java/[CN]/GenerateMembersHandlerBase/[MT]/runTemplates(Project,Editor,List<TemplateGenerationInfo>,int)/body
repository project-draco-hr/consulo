{
  TemplateGenerationInfo info=templates.get(index);
  final Template template=info.getTemplate();
  final PsiElement element=info.getPsiMember();
  final TextRange range=element.getTextRange();
  editor.getDocument().deleteString(range.getStartOffset(),range.getEndOffset());
  int offset=range.getStartOffset();
  editor.getCaretModel().moveToOffset(offset);
  editor.getScrollingModel().scrollToCaret(ScrollType.CENTER);
  TemplateManager.getInstance(myProject).startTemplate(editor,template,new TemplateEditingAdapter(){
    public void templateFinished(    Template template,    boolean brokenOff){
      if (index + 1 < templates.size()) {
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          public void run(){
            new WriteCommandAction(myProject){
              protected void run(              Result result) throws Throwable {
                runTemplates(myProject,editor,templates,index + 1);
              }
            }
.execute();
          }
        }
);
      }
    }
  }
);
}
