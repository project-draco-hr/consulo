{
  PrintStream oldOut=System.out;
  PrintStream oldErr=System.err;
  int result;
  try {
    System.setOut(new PrintStream(out));
    System.setErr(new PrintStream(err));
    IdeaTestRunner testRunner=(IdeaTestRunner)getAgentClass().newInstance();
    if (isJUnit4) {
      testRunner.JUNIT4_API=(JUnit4API)Class.forName("com.intellij.rt.junit4.JUnit4Util").newInstance();
    }
    testRunner.setStreams(out,err);
    result=IdeaTestRunner.startRunnerWithArgs(testRunner,args);
  }
 catch (  Exception e) {
    e.printStackTrace(System.err);
    result=-2;
  }
 finally {
    System.setOut(oldOut);
    System.setErr(oldErr);
  }
  return result;
}
