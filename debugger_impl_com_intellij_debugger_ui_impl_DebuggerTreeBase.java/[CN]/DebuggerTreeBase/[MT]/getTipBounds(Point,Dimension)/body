{
  Rectangle nodeBounds=new Rectangle(point);
  TreePath pathForLocation=getPathForLocation(point.x,point.y);
  if (pathForLocation != null) {
    nodeBounds=getPathBounds(pathForLocation);
  }
  Rectangle contentRect=getVisibleRect();
  System.out.println("contentRect = " + contentRect);
  int vgap=nodeBounds.height;
  int width=Math.min(tipContentSize.width,contentRect.width);
  int height;
  int y;
  if (point.y > contentRect.y + contentRect.height / 2) {
    y=Math.max(contentRect.y,nodeBounds.y - tipContentSize.height - vgap);
    height=Math.min(tipContentSize.height,nodeBounds.y - contentRect.y - vgap);
  }
 else {
    y=nodeBounds.y + nodeBounds.height + vgap;
    height=Math.min(tipContentSize.height,contentRect.height - y);
  }
  final Dimension tipSize=new Dimension(width,height);
  int x=point.x - width / 2;
  if (x < contentRect.x) {
    x=contentRect.x;
  }
  if (x + width > contentRect.x + contentRect.width) {
    x=contentRect.x + contentRect.width - width;
  }
  return new Rectangle(new Point(x,y),tipSize);
}
