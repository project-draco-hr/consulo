{
  final VirtualFile file=vcsContext.getSelectedFiles()[0];
  final Project project=vcsContext.getProject();
  final AbstractVcs vcs=ProjectLevelVcsManager.getInstance(project).getVcsFor(file);
  final VcsHistoryProvider vcsHistoryProvider=vcs.getVcsHistoryProvider();
  try {
    final VcsHistorySession session=vcsHistoryProvider.createSessionFor(new FilePathImpl(file));
    if (session == null)     return;
    final List<VcsFileRevision> revisions=session.getRevisionList();
    final HistoryAsTreeProvider treeHistoryProvider=vcsHistoryProvider.getTreeHistoryProvider();
    if (treeHistoryProvider != null) {
      showTreePopup(treeHistoryProvider.createTreeOn(revisions),file,project,vcs.getDiffProvider());
    }
 else {
      showListPopup(revisions,vcs,file,project);
    }
  }
 catch (  VcsException e1) {
    Messages.showErrorDialog(VcsBundle.message("message.text.cannot.show.differences"),CommonBundle.message("title.error"));
  }
}
