{
  final PsiElement psiElement=psiFile.findElementAt(editor.getCaretModel().getOffset());
  LOG.assertTrue(psiElement == null || psiElement.isValid(),psiElement);
  int offset=editor.getCaretModel().getOffset();
  Project project=psiFile.getProject();
  for (  IntentionAction action : IntentionManager.getInstance().getAvailableIntentionActions()) {
    Pair<PsiFile,Editor> place=ShowIntentionActionsHandler.availableFor(psiFile,editor,action,psiElement);
    if (place != null) {
      List<IntentionAction> enableDisableIntentionAction=new ArrayList<IntentionAction>();
      enableDisableIntentionAction.add(new IntentionHintComponent.EnableDisableIntentionAction(action));
      intentions.intentionsToShow.add(new HighlightInfo.IntentionActionDescriptor(action,enableDisableIntentionAction,null));
    }
  }
  List<HighlightInfo.IntentionActionDescriptor> actions=QuickFixAction.getAvailableActions(editor,psiFile,passIdToShowIntentionsFor);
  final DaemonCodeAnalyzer codeAnalyzer=DaemonCodeAnalyzer.getInstance(project);
  final Document document=editor.getDocument();
  HighlightInfo infoAtCursor=((DaemonCodeAnalyzerImpl)codeAnalyzer).findHighlightByOffset(document,offset,true);
  if (infoAtCursor == null || infoAtCursor.getSeverity() == HighlightSeverity.ERROR) {
    intentions.errorFixesToShow.addAll(actions);
  }
 else {
    intentions.inspectionFixesToShow.addAll(actions);
  }
  final int line=document.getLineNumber(offset);
  final List<HighlightInfo> infoList=DaemonCodeAnalyzerImpl.getHighlights(document,HighlightSeverity.INFORMATION,project,document.getLineStartOffset(line),document.getLineEndOffset(line));
  for (  HighlightInfo info : infoList) {
    final GutterIconRenderer renderer=info.getGutterIconRenderer();
    if (renderer != null) {
      final AnAction action=renderer.getClickAction();
      if (action != null) {
        final String text=renderer.getTooltipText();
        if (text != null) {
          final IntentionAction actionAdapter=new AbstractIntentionAction(){
            public void invoke(            @NotNull Project project,            Editor editor,            PsiFile file) throws IncorrectOperationException {
              final RelativePoint relativePoint=JBPopupFactory.getInstance().guessBestPopupLocation(editor);
              action.actionPerformed(new AnActionEvent(relativePoint.toMouseEvent(),DataManager.getInstance().getDataContext(),text,new Presentation(),ActionManager.getInstance(),0));
            }
            @NotNull public String getText(){
              return text;
            }
          }
;
          intentions.guttersToShow.add(new HighlightInfo.IntentionActionDescriptor(actionAdapter,Collections.<IntentionAction>emptyList(),text,renderer.getIcon()));
        }
      }
    }
  }
}
