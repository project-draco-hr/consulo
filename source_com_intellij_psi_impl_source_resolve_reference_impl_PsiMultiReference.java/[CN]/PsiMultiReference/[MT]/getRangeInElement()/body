{
  final PsiReference chosenRef=chooseReference();
  TextRange rangeInElement=chosenRef.getRangeInElement();
  PsiElement element=chosenRef.getElement();
  while (element != myElement) {
    rangeInElement=rangeInElement.shiftRight(element.getStartOffsetInParent());
    element=element.getParent();
    if (element instanceof PsiFile)     break;
  }
  return rangeInElement;
}
