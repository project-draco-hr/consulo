{
  final PsiElement firstElement=findFirstBreadcrumbedElement(position);
  PsiElement element=firstElement;
  if (element == null)   return null;
  final LinkedList<BreadcrumbsPsiItem> result=new LinkedList<BreadcrumbsPsiItem>();
  while (element != null) {
    BreadcrumbsInfoProvider provider=findProviderForElement(element);
    if (provider != null && provider.acceptElement(element)) {
      result.addFirst(new BreadcrumbsPsiItem(element,provider));
    }
    element=(provider != null) ? provider.getParent(element) : element.getParent();
  }
  final CrumbPresentation[] presentations=getCrumbPresentations(result,firstElement);
  if (presentations != null) {
    int i=0;
    for (    BreadcrumbsPsiItem item : result) {
      item.setPresentation(presentations[i++]);
    }
  }
  return result;
}
