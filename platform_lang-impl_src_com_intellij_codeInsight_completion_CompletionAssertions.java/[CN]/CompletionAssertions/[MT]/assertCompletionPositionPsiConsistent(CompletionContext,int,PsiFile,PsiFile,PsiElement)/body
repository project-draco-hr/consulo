{
  if (insertedElement == null) {
    throw new LogEventException("No element at insertion offset","offset=" + newContext.getStartOffset() + "\n"+ DebugUtil.currentStackTrace(),createFileTextAttachment(fileCopy,originalFile),createAstAttachment(fileCopy,originalFile));
  }
  if (fileCopy.findElementAt(offset) != insertedElement) {
    throw new AssertionError("wrong offset");
  }
  final TextRange range=insertedElement.getTextRange();
  String fileCopyText=fileCopy.getText();
  if ((range.getEndOffset() > fileCopyText.length()) || !range.substring(fileCopyText).equals(insertedElement.getText())) {
    throw new LogEventException("Inconsistent completion tree","range=" + range + "\n"+ DebugUtil.currentStackTrace(),createFileTextAttachment(fileCopy,originalFile),createAstAttachment(fileCopy,originalFile),new Attachment("Element at caret.txt",insertedElement.getText()));
  }
}
