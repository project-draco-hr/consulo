{
  if (insertedElement == null) {
    throw new LogEventException("No element at insertion offset","offset=" + newContext.getStartOffset() + "\n"+ DebugUtil.currentStackTrace(),createFileTextAttachment(fileCopy,originalFile),createAstAttachment(fileCopy,originalFile));
  }
  if (fileCopy.findElementAt(offset) != insertedElement) {
    throw new AssertionError("wrong offset");
  }
  final TextRange range=insertedElement.getTextRange();
  CharSequence fileCopyText=fileCopy.getViewProvider().getContents();
  if ((range.getEndOffset() > fileCopyText.length()) || !fileCopyText.subSequence(range.getStartOffset(),range.getEndOffset()).toString().equals(insertedElement.getText())) {
    throw new LogEventException("Inconsistent completion tree","range=" + range + "\n"+ DebugUtil.currentStackTrace(),createFileTextAttachment(fileCopy,originalFile),createAstAttachment(fileCopy,originalFile),new Attachment("Element at caret.txt",insertedElement.getText()));
  }
}
