{
  final PasswordSafeImpl ps=(PasswordSafeImpl)passwordSafe;
  final ChangeListener listener=new ChangeListener(){
    public void stateChanged(    ChangeEvent e){
      boolean isDisk=myRememberOnDiskProtectedRadioButton.isSelected();
      myChangeMasterPasswordButton.setEnabled(isDisk && !isMasterKeyEmpty(ps));
      myResetMasterPasswordButton.setEnabled(isDisk);
    }
  }
;
  myRememberOnDiskProtectedRadioButton.addChangeListener(listener);
  listener.stateChanged(null);
  myChangeMasterPasswordButton.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      if (!isMasterKeyEmpty(ps)) {
        ChangeMasterKeyDialog.changePassword(null,ps.getMasterKeyProvider());
        listener.stateChanged(null);
      }
    }
  }
);
  myResetMasterPasswordButton.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      if (isMasterKeyEmpty(ps)) {
        ResetPasswordDialog.newPassword(null,ps.getMasterKeyProvider());
      }
 else {
        ResetPasswordDialog.resetPassword(null,ps.getMasterKeyProvider());
      }
      listener.stateChanged(null);
    }
  }
);
}
