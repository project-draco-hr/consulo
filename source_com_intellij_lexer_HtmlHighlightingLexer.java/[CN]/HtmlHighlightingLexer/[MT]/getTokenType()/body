{
  if (embeddedLexer != null) {
    return embeddedLexer.getTokenType();
  }
 else {
    IElementType tokenType=super.getTokenType();
    if (tokenType == null)     return tokenType;
    if (tokenType == XmlTokenType.XML_NAME) {
      final int state=getState() & BASE_STATE_MASK;
      if (isHtmlTagState(state)) {
        tokenType=XmlTokenType.XML_TAG_NAME;
      }
    }
 else     if (tokenType == XmlTokenType.XML_WHITE_SPACE || tokenType == XmlTokenType.XML_REAL_WHITE_SPACE) {
      if (hasSeenTag() && (hasSeenStyle() || hasSeenScript())) {
        tokenType=XmlTokenType.XML_WHITE_SPACE;
      }
 else {
        tokenType=(getState() != 0) ? XmlTokenType.TAG_WHITE_SPACE : XmlTokenType.XML_REAL_WHITE_SPACE;
      }
    }
 else     if (tokenType == XmlTokenType.XML_CHAR_ENTITY_REF || tokenType == XmlTokenType.XML_ENTITY_REF_TOKEN) {
      final int state=getState() & BASE_STATE_MASK;
      if (state == _HtmlLexer.COMMENT)       return XmlTokenType.XML_COMMENT_CHARACTERS;
    }
    return tokenType;
  }
}
