{
  final VirtualFile root=ModuleRootManager.getInstance(myModule).getContentRoots()[0];
  PsiTodoSearchHelper.SERVICE.getInstance(myProject).findFilesWithTodoItems();
  new WriteCommandAction.Simple(getProject()){
    @Override protected void run() throws Throwable {
      VirtualFile newFile=root.createChildData(null,"New.java");
      VfsUtil.saveText(newFile,"class A{ Exception e;} //todo");
    }
  }
.execute().throwException();
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  PsiTodoSearchHelper.SERVICE.getInstance(myProject).findFilesWithTodoItems();
  VirtualFile[] sourceRoots=ModuleRootManager.getInstance(myModule).getSourceRoots();
  LOGGER.assertTrue(sourceRoots.length == 1);
  PsiTestUtil.removeSourceRoot(myModule,sourceRoots[0]);
  PsiClass exceptionClass=myJavaFacade.findClass("java.lang.Exception",GlobalSearchScope.allScope(getProject()));
  assertNotNull(exceptionClass);
  checkTodos(new String[]{"2.java","New.java"});
}
