{
  File dir=createTempDirectory();
  final VirtualFile root=LocalFileSystem.getInstance().refreshAndFindFileByPath(dir.getCanonicalPath().replace(File.separatorChar,'/'));
  new WriteCommandAction.Simple(getProject()){
    @Override protected void run() throws Throwable {
      PsiTestUtil.addSourceRoot(myModule,root);
      VirtualFile newFile=root.createChildData(null,"New.java");
      VfsUtil.saveText(newFile,"class A{ Exception e;} //todo");
    }
  }
.execute().throwException();
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  PsiSearchHelper.SERVICE.getInstance(myProject).processAllFilesWithWord("aaa",GlobalSearchScope.allScope(myProject),new Processor<PsiFile>(){
    @Override public boolean process(    final PsiFile psiFile){
      return true;
    }
  }
,true);
  PsiClass exceptionClass=myJavaFacade.findClass("java.lang.Exception",GlobalSearchScope.allScope(getProject()));
  assertNotNull(exceptionClass);
  checkUsages(exceptionClass,new String[]{"1.java","2.java","New.java"});
  checkTodos(new String[]{"2.java","New.java"});
}
