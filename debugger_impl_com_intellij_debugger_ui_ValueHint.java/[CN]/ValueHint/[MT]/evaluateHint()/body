{
  final DebuggerContextImpl debuggerContext=DebuggerManagerEx.getInstanceEx(myProject).getContext();
  final DebuggerSession debuggerSession=debuggerContext.getDebuggerSession();
  if (debuggerSession == null || !debuggerSession.isPaused())   return;
  try {
    final ExpressionEvaluator evaluator=EvaluatorBuilderImpl.getInstance().build(myCurrentExpression);
    debuggerContext.getDebugProcess().getManagerThread().invokeLater(new DebuggerContextCommandImpl(debuggerContext){
      public void threadAction(){
        try {
          final EvaluationContextImpl evaluationContext=debuggerContext.createEvaluationContext();
          final TextWithImports text=new TextWithImportsImpl(CodeFragmentKind.EXPRESSION,myCurrentExpression.getText());
          final Value value=evaluator.evaluate(evaluationContext);
          final WatchItemDescriptor descriptor=new WatchItemDescriptor(myProject,text,value,false);
          if (value instanceof PrimitiveValue || myType == MOUSE_OVER_HINT) {
            descriptor.setContext(evaluationContext);
            if (myType == MOUSE_OVER_HINT) {
              descriptor.setRenderer(debuggerContext.getDebugProcess().getDefaultRenderer(value));
            }
            descriptor.updateRepresentation(evaluationContext,new DescriptorLabelListener(){
              public void labelChanged(){
                if (myCurrentRange != null) {
                  if (myType != MOUSE_OVER_HINT || descriptor.isValueValid()) {
                    final SimpleColoredText simpleColoredText=DebuggerTreeRenderer.getDescriptorText(descriptor,true);
                    if (!(value instanceof PrimitiveValue)) {
                      simpleColoredText.append("(" + DebuggerBundle.message("active.tooltip.suggestion") + ")",SimpleTextAttributes.GRAYED_ATTRIBUTES);
                    }
                    showHint(simpleColoredText);
                  }
                }
              }
            }
);
          }
 else {
            final InspectDebuggerTree tree=new InspectDebuggerTree(myProject);
            tree.getModel().addTreeModelListener(new TreeModelListener(){
              public void treeNodesChanged(              TreeModelEvent e){
              }
              public void treeNodesInserted(              TreeModelEvent e){
              }
              public void treeNodesRemoved(              TreeModelEvent e){
              }
              public void treeStructureChanged(              TreeModelEvent e){
                resize(e.getTreePath(),tree);
              }
            }
);
            tree.setInspectDescriptor(descriptor);
            showHint(tree,debuggerContext,myCurrentExpression.getText(),new ActiveTooltipComponent(tree,myCurrentExpression.getText()));
          }
        }
 catch (        EvaluateException e) {
          LOG.debug(e);
        }
      }
    }
,DebuggerManagerThreadImpl.HIGH_PRIORITY);
  }
 catch (  EvaluateException e) {
    LOG.debug(e);
  }
}
