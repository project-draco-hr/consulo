{
  ArrayList<UsageInfo> result=new ArrayList<UsageInfo>();
  PsiManager manager=myMethod.getManager();
  PsiSearchHelper helper=manager.getSearchHelper();
  if (mySettings.isReplaceUsages()) {
    PsiReference[] refs=helper.findReferences(myMethod,GlobalSearchScope.projectScope(myProject),true);
    for (    PsiReference ref : refs) {
      PsiElement element=ref.getElement();
      PsiElement qualifier=null;
      if (element instanceof PsiReferenceExpression) {
        qualifier=((PsiReferenceExpression)element).getQualifierExpression();
        if (qualifier instanceof PsiThisExpression)         qualifier=null;
      }
      if (!PsiTreeUtil.isAncestor(myMethod,element,true) || qualifier != null) {
        result.add(new UsageInfo(element));
      }
    }
  }
  final PsiMethod[] overridingMethods=helper.findOverridingMethods(myMethod,GlobalSearchScope.allScope(myProject),false);
  for (  PsiMethod overridingMethod : overridingMethods) {
    if (overridingMethod != myMethod) {
      result.add(new OverridingMethodUsageInfo(overridingMethod));
    }
  }
  UsageInfo[] externalUsages=result.toArray(new UsageInfo[0]);
  UsageInfo[] internalUsages;
  internalUsages=MakeMethodStaticUtil.findClassRefsInMethod(myMethod,true);
  UsageInfo[] resultArray=ArrayUtil.mergeArrays(internalUsages,externalUsages,UsageInfo.class);
  return resultArray;
}
