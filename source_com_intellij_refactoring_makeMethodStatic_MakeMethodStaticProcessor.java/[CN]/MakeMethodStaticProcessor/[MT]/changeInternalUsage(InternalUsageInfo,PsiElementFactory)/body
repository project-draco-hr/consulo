{
  if (!mySettings.isChangeSignature())   return;
  PsiElement element=usage.getElement();
  if (element instanceof PsiReferenceExpression) {
    PsiReferenceExpression newRef=null;
    if (mySettings.isMakeFieldParameters()) {
      PsiElement resolved=((PsiReferenceExpression)element).resolve();
      if (resolved instanceof PsiField) {
        String name=mySettings.getNameForField((PsiField)resolved);
        if (name != null) {
          newRef=(PsiReferenceExpression)factory.createExpressionFromText(name,null);
        }
      }
    }
    if (newRef == null && mySettings.isMakeClassParameter()) {
      newRef=(PsiReferenceExpression)factory.createExpressionFromText(mySettings.getClassParameterName() + "." + element.getText(),null);
    }
    if (newRef != null) {
      CodeStyleManager codeStyleManager=CodeStyleManager.getInstance(myProject);
      newRef=(PsiReferenceExpression)codeStyleManager.reformat(newRef);
      element.replace(newRef);
    }
  }
 else   if (element instanceof PsiThisExpression && mySettings.isMakeClassParameter()) {
    element.replace(factory.createExpressionFromText(mySettings.getClassParameterName(),null));
  }
 else   if (element instanceof PsiSuperExpression && mySettings.isMakeClassParameter()) {
    element.replace(factory.createExpressionFromText(mySettings.getClassParameterName(),null));
  }
}
