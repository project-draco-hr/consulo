{
  final StubIndexImpl stubIndex=StubIndexImpl.getInstanceOrInvalidate();
  final Collection<StubIndexKey> allStubIndexKeys=stubIndex != null ? stubIndex.getAllStubIndexKeys() : Collections.<StubIndexKey>emptyList();
  try {
    for (    StubIndexKey key : allStubIndexKeys) {
      stubIndex.getWriteLock(key).lock();
    }
    getWriteLock().lock();
    if (stubIndex != null) {
      stubIndex.clearAllIndices();
    }
    Map<FileType,Integer> versionMap=getVersionMap();
    for (    Map.Entry<FileType,Integer> entry : versionMap.entrySet()) {
      ID stubId=IndexInfrastructure.getStubId(INDEX_ID,entry.getKey());
      try {
        IndexInfrastructure.rewriteVersion(IndexInfrastructure.getVersionFile(stubId),entry.getValue());
      }
 catch (      IOException e) {
        LOG.error(e);
      }
    }
    super.clear();
  }
  finally {
    getWriteLock().unlock();
    for (    StubIndexKey key : allStubIndexKeys) {
      stubIndex.getWriteLock(key).unlock();
    }
  }
}
