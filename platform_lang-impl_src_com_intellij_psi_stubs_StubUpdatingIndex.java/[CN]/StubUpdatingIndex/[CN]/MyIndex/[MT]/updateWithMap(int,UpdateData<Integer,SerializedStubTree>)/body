{
  checkNameStorage();
  StubUpdatingData stubUpdatingData=(StubUpdatingData)updateData;
  final Map<StubIndexKey,Map<Object,StubIdList>> newStubIndicesValueMap=stubUpdatingData.getNewStubIndicesValueMap();
  final StubIndexImpl stubIndex=getStubIndex();
  final Collection<StubIndexKey> allStubIndices=stubIndex.getAllStubIndexKeys();
  try {
    for (    StubIndexKey key : allStubIndices) {
      stubIndex.getWriteLock(key).lock();
    }
    try {
      getWriteLock().lock();
      super.updateWithMap(inputId,updateData);
      final Map<StubIndexKey,Map<Object,StubIdList>> previousStubIndicesValueMap=stubUpdatingData.getOldStubIndicesValueMap();
      updateStubIndices(getAffectedIndices(previousStubIndicesValueMap,newStubIndicesValueMap),inputId,previousStubIndicesValueMap,newStubIndicesValueMap);
    }
  finally {
      getWriteLock().unlock();
    }
  }
  finally {
    for (    StubIndexKey key : allStubIndices) {
      stubIndex.getWriteLock(key).unlock();
    }
  }
}
