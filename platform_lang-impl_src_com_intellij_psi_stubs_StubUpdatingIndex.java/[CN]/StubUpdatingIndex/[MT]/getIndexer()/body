{
  return new DataIndexer<Integer,SerializedStubTree,FileContent>(){
    @NotNull public Map<Integer,SerializedStubTree> map(    final FileContent inputData){
      final Map<Integer,SerializedStubTree> result=new HashMap<Integer,SerializedStubTree>();
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        public void run(){
          final StubElement rootStub=buildStubTree(inputData);
          if (rootStub == null)           return;
          final ByteArrayOutputStream bytes=new ByteArrayOutputStream();
          SerializationManager.getInstance().serialize(rootStub,bytes);
          final int key=Math.abs(FileBasedIndex.getFileId(inputData.getFile()));
          result.put(key,new SerializedStubTree(bytes.toByteArray()));
        }
      }
);
      return result;
    }
  }
;
}
