{
  if (storage instanceof MemoryIndexStorage) {
    final MemoryIndexStorage<Integer,SerializedStubTree> memStorage=(MemoryIndexStorage<Integer,SerializedStubTree>)storage;
    memStorage.addBufferingStateListener(new MemoryIndexStorage.BufferingStateListener(){
      @Override public void bufferingStateChanged(      final boolean newState){
        ((StubIndexImpl)StubIndex.getInstance()).setDataBufferingEnabled(newState);
      }
      @Override public void memoryStorageCleared(){
        ((StubIndexImpl)StubIndex.getInstance()).cleanupMemoryStorage();
      }
    }
);
  }
  return new MyIndex(extension,storage);
}
