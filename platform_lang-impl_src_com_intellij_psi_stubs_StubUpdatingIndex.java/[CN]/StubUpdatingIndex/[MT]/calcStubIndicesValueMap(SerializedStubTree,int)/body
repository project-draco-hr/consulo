{
  if (stub == null)   return Collections.emptyMap();
  Map<StubIndexKey,Map<Object,StubIdList>> stubIndicesValueMap;
  try {
    ObjectStubBase root=(ObjectStubBase)stub.getStub(true);
    ObjectStubTree objectStubTree=root instanceof PsiFileStub ? new StubTree((PsiFileStub)root,false) : new ObjectStubTree(root,false);
    Map<StubIndexKey,Map<Object,int[]>> map=objectStubTree.indexStubTree();
    stubIndicesValueMap=(Map)map;
    for (    StubIndexKey key : map.keySet()) {
      Map<Object,int[]> value=map.get(key);
      for (      Object k : value.keySet()) {
        int[] ints=value.get(k);
        StubIdList stubList=ints.length == 1 ? new StubIdList(ints[0]) : new StubIdList(ints,ints.length);
        ((Map<Object,StubIdList>)(Map)value).put(k,stubList);
      }
    }
    return stubIndicesValueMap;
  }
 catch (  SerializerNotFoundException e) {
    throw new StorageException(e);
  }
}
