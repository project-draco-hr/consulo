{
  final Collection<JpsModule> allModules=model.getProject().getModules();
  for (  final JpsModule module : allModules) {
    final List<File> moduleExcludes=new ArrayList<File>();
    myModuleToExcludesMap.put(module,moduleExcludes);
    for (    String url : module.getExcludeRootsList().getUrls()) {
      final File root=JpsPathUtil.urlToFile(url);
      myExcludedRoots.add(root);
      moduleExcludes.add(root);
    }
  }
  Map<File,JpsModule> contentToModule=new HashMap<File,JpsModule>();
  for (  JpsModule module : allModules) {
    for (    String contentUrl : module.getContentRootsList().getUrls()) {
      File contentRoot=JpsPathUtil.urlToFile(contentUrl);
      contentToModule.put(contentRoot,module);
    }
  }
  List<File> parents=new ArrayList<File>();
  for (  JpsModule module : allModules) {
    for (    String contentUrl : module.getContentRootsList().getUrls()) {
      File contentRoot=JpsPathUtil.urlToFile(contentUrl);
      File parent=contentRoot.getParentFile();
      JpsModule parentModule=null;
      parents.clear();
      while (parent != null) {
        parents.add(parent);
        if (contentToModule.containsKey(parent)) {
          parentModule=contentToModule.get(parent);
          break;
        }
        parent=parent.getParentFile();
      }
      if (parentModule != null) {
        myModuleToExcludesMap.get(parentModule).add(contentRoot);
      }
      for (      File file : parents) {
        contentToModule.put(file,parentModule);
      }
    }
  }
}
