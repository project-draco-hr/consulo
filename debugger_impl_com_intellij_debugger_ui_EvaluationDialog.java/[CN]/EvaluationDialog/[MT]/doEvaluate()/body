{
  if (myEditor == null || myEvaluationPanel == null) {
    return;
  }
  myEvaluationPanel.clear();
  TextWithImports codeToEvaluate=getCodeToEvaluate();
  if (codeToEvaluate == null) {
    return;
  }
  try {
    setOKActionEnabled(false);
    NodeDescriptorImpl descriptor=myEvaluationPanel.getWatchTree().addWatch(codeToEvaluate).getDescriptor();
    if (descriptor instanceof EvaluationDescriptor) {
      final CodeFragmentFactory factory=((MyComboBoxModel)myCbFactories.getModel()).getSelectedItem();
      LOG.assertTrue(factory != null);
      ((EvaluationDescriptor)descriptor).setCodeFragmentFactory(factory);
    }
    myEvaluationPanel.getWatchTree().rebuild(getDebuggerContext());
    descriptor.myIsExpanded=true;
  }
  finally {
    setOKActionEnabled(true);
  }
  getEditor().addRecent(getCodeToEvaluate());
  final DebuggerStateManager manager=myEvaluationPanel.getContextManager();
  final DebuggerContextImpl context=manager.getContext();
  manager.setState(context,context.getDebuggerSession().getState(),DebuggerSession.EVENT_REFRESH,null);
}
