{
  final List<VirtualFile> classRoots=getClassRoots();
  if (classRoots.isEmpty()) {
    return true;
  }
  final String qname=psiPackage.getQualifiedName();
  final PsiManager psiManager=psiPackage.getManager();
  for (  final VirtualFile classRoot : classRoots) {
    if (scope.contains(classRoot)) {
      final VirtualFile dir=classRoot.findFileByRelativePath(qname.replace('.','/'));
      if (dir != null && dir.isDirectory()) {
        final PsiDirectory psiDirectory=ApplicationManager.getApplication().runReadAction(new Computable<PsiDirectory>(){
          @Nullable public PsiDirectory compute(){
            return dir.isValid() ? psiManager.findDirectory(dir) : null;
          }
        }
);
        if (psiDirectory != null && !consumer.process(psiDirectory)) {
          return false;
        }
      }
    }
  }
  return true;
}
