{
  final List<VirtualFile> classRoots=getClassRoots();
  if (classRoots.isEmpty()) {
    return PsiClass.EMPTY_ARRAY;
  }
  List<PsiClass> result=new ArrayList<PsiClass>();
  for (  final VirtualFile classRoot : classRoots) {
    if (scope.contains(classRoot)) {
      final String pkgName=psiPackage.getName();
      final VirtualFile dir=pkgName != null ? classRoot.findFileByRelativePath(pkgName.replace('.','/')) : classRoot;
      if (dir != null && dir.isDirectory()) {
        for (        final VirtualFile file : dir.getChildren()) {
          if (!file.isDirectory()) {
            final PsiFile psi=PsiManager.getInstance(myProject).findFile(file);
            if (psi instanceof PsiClassOwner) {
              result.addAll(Arrays.asList(((PsiClassOwner)psi).getClasses()));
            }
          }
        }
      }
    }
  }
  return result.toArray(new PsiClass[result.size()]);
}
