{
  byte flags=dataStream.readByte();
  final boolean isAnonymous=PsiClassStubImpl.isAnonymous(flags);
  final boolean isEnumConst=PsiClassStubImpl.isEnumConstInitializer(flags);
  final JavaClassElementType type=typeForClass(isAnonymous,isEnumConst);
  if (!isAnonymous) {
    StringRef name=DataInputOutputUtil.readNAME(dataStream,nameStorage);
    StringRef qname=DataInputOutputUtil.readNAME(dataStream,nameStorage);
    final StringRef sourceFileName=DataInputOutputUtil.readNAME(dataStream,nameStorage);
    final PsiClassStubImpl classStub=new PsiClassStubImpl(type,parentStub,qname,name,null,flags);
    classStub.setSourceFileName(sourceFileName);
    return classStub;
  }
 else {
    StringRef baseref=DataInputOutputUtil.readNAME(dataStream,nameStorage);
    return new PsiClassStubImpl(type,parentStub,null,null,baseref,flags);
  }
}
