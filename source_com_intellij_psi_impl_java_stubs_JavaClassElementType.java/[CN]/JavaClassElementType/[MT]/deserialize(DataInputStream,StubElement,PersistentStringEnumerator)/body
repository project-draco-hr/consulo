{
  byte flags=dataStream.readByte();
  if (!PsiClassStubImpl.isAnonymous(flags)) {
    byte socketFlag=dataStream.readByte();
    String name=DataInputOutputUtil.readNAME(dataStream,nameStorage);
    String qname=DataInputOutputUtil.readNAME(dataStream,nameStorage);
    if (socketFlag == NORMAL_CLASS) {
      return new PsiClassStubImpl(parentStub,qname,name,null,flags);
    }
 else     if (socketFlag == INNER_PLUG) {
      String outerFQN=DataInputOutputUtil.readNAME(dataStream,nameStorage);
      return new PsiInnerClassStubPlug(parentStub,qname,name,flags,outerFQN);
    }
 else     if (socketFlag == INNER_SOCKET) {
      return new PsiInnerClassStubSocket(parentStub,qname,name,flags);
    }
 else {
      throw new RuntimeException("Unexpected socket flag: " + socketFlag);
    }
  }
 else {
    String baseref=DataInputOutputUtil.readNAME(dataStream,nameStorage);
    return new PsiClassStubImpl(parentStub,null,null,baseref,flags);
  }
}
