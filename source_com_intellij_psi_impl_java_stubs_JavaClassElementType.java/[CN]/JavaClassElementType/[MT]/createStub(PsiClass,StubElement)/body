{
  final boolean isAnonymous=psi instanceof PsiAnonymousClass;
  final boolean isEnumConst=psi instanceof PsiEnumConstantInitializer;
  byte flags=PsiClassStubImpl.packFlags(RecordUtil.isDeprecatedByDocComment(psi),psi.isInterface(),psi.isEnum(),isEnumConst,isAnonymous,psi.isAnnotationType(),isAnonymous && ((PsiAnonymousClass)psi).isInQualifiedNew(),RecordUtil.isDeprecatedByAnnotation(psi));
  String baseRef=isAnonymous ? ((PsiAnonymousClass)psi).getBaseClassReference().getText() : null;
  final JavaClassElementType type=typeForClass(isAnonymous,isEnumConst);
  return new PsiClassStubImpl(type,parentStub,psi.getQualifiedName(),psi.getName(),baseRef,flags);
}
