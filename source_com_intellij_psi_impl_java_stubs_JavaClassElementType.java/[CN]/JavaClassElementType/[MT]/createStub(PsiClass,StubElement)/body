{
  byte flags=PsiClassStubImpl.packFlags(psi.isDeprecated(),psi.isInterface(),psi.isEnum(),psi instanceof PsiEnumConstantInitializer,psi instanceof PsiAnonymousClass,psi.isAnnotationType(),psi instanceof PsiAnonymousClass && ((PsiAnonymousClass)psi).isInQualifiedNew());
  String baseRef=psi instanceof PsiAnonymousClass ? ((PsiAnonymousClass)psi).getBaseClassReference().getText() : null;
  return new PsiClassStubImpl(parentStub,psi.getQualifiedName(),psi.getName(),baseRef,flags);
}
