{
  List<Object> roots=new ArrayList<Object>();
  Object best=null;
  int maxDiff=-100000;
  mxIGraphModel model=graph.getModel();
  for (  Object vertex : vertices) {
    if (model.isVertex(vertex) && graph.isCellVisible(vertex)) {
      Object[] conns=this.getEdges(vertex);
      int fanOut=0;
      int fanIn=0;
      for (int k=0; k < conns.length; k++) {
        Object src=graph.getView().getVisibleTerminal(conns[k],true);
        if (src == vertex) {
          fanOut++;
        }
 else {
          fanIn++;
        }
      }
      if (fanIn == 0 && fanOut > 0) {
        roots.add(vertex);
      }
      int diff=fanOut - fanIn;
      if (diff > maxDiff) {
        maxDiff=diff;
        best=vertex;
      }
    }
  }
  if (roots.isEmpty() && best != null) {
    roots.add(best);
  }
  return roots;
}
