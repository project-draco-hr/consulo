{
  int versions=0;
  fillFile(myProjectDir,new String[]{AFILE},INITIAL_FILE_CONTENT);
  addAll();
  commitAll("initial content");
  versions++;
  fillFile(myProjectDir,new String[]{AFILE},UPDATED_FILE_CONTENT);
  commitAll("updated content");
  versions++;
  runHgOnProjectRepo("rename",AFILE,BFILE);
  refreshVfs();
  ChangeListManager.getInstance(myProject).ensureUpToDate(false);
  final VcsHistorySession session=getHistorySession(BFILE);
  final List<VcsFileRevision> revisions=session.getRevisionList();
  for (  VcsFileRevision rev : revisions) {
    rev.loadContent();
  }
  assertEquals(revisions.size(),versions);
  assertTrue(session.isCurrentRevision(revisions.get(0).getRevisionNumber()));
  assertEquals(revisions.get(0).getContent(),UPDATED_FILE_CONTENT.getBytes());
  assertEquals(revisions.get(1).getContent(),INITIAL_FILE_CONTENT.getBytes());
}
