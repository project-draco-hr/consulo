{
  StartupManager.getInstance(myProject).registerPostStartupActivity(new Runnable(){
    public void run(){
      MessageBusConnection connection=myProject.getMessageBus().connect(myProject);
      connection.subscribe(FileEditorManagerListener.Before.FILE_EDITOR_MANAGER,new FileEditorManagerListener.Before.Adapter(){
        @Override public void beforeFileOpened(        FileEditorManager source,        VirtualFile file){
          myCurrentOpenedFile=file;
        }
      }
);
      connection.subscribe(FileEditorManagerListener.FILE_EDITOR_MANAGER,new FileEditorManagerListener(){
        @Override public void fileOpened(        FileEditorManager source,        VirtualFile file){
        }
        @Override public void fileClosed(        FileEditorManager source,        VirtualFile file){
        }
        @Override public void selectionChanged(        FileEditorManagerEvent event){
          VirtualFile file=event.getNewFile();
          if (file != null && AndroidDesignerEditorProvider.acceptLayout(myProject,file)) {
            FileEditorProvider provider=EditorHistoryManager.getInstance(myProject).getSelectedProvider(file);
            if (provider != null && file != myCurrentOpenedFile) {
              PropertiesComponent.getInstance(myProject).setValue(KEY,provider.getEditorTypeId());
            }
          }
        }
      }
);
    }
  }
);
}
