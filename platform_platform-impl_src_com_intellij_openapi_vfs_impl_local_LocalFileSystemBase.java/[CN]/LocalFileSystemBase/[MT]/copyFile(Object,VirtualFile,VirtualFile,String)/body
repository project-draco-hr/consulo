{
  final FileAttributes attributes=getAttributes(vFile);
  if (attributes == null || attributes.isSpecial()) {
    throw new FileNotFoundException("Not a file: " + vFile);
  }
  File physicalFile=convertToIOFile(vFile);
  File physicalCopy=auxCopy(vFile,newParent,copyName);
  try {
    if (physicalCopy == null) {
      File newPhysicalParent=convertToIOFile(newParent);
      physicalCopy=new File(newPhysicalParent,copyName);
      try {
        if (attributes.isDirectory()) {
          FileUtil.copyDir(physicalFile,physicalCopy);
        }
 else {
          FileUtil.copy(physicalFile,physicalCopy);
        }
      }
 catch (      IOException e) {
        FileUtil.delete(physicalCopy);
        throw e;
      }
    }
  }
  finally {
    auxNotifyCompleted(new ThrowableConsumer<LocalFileOperationsHandler,IOException>(){
      @Override public void consume(      LocalFileOperationsHandler handler) throws IOException {
        handler.copy(vFile,newParent,copyName);
      }
    }
);
  }
  return new FakeVirtualFile(newParent,copyName);
}
