{
  if (isCaseSensitive()) {
    return super.getCanonicallyCasedName(file);
  }
  final String originalFileName=file.getName();
  try {
    final File ioFile=convertToIOFile(file);
    final File ioCanonicalFile=ioFile.getCanonicalFile();
    String canonicalFileName=ioCanonicalFile.getName();
    if (!SystemInfo.isUnix) {
      return canonicalFileName;
    }
    if (canonicalFileName.compareToIgnoreCase(originalFileName) == 0) {
      return canonicalFileName;
    }
    final File parentFile=ioFile.getParentFile();
    if (parentFile != null) {
      final String[] canonicalFileNames=parentFile.list();
      if (canonicalFileNames != null) {
        for (        String name : canonicalFileNames) {
          if (name.compareToIgnoreCase(originalFileName) == 0) {
            return name;
          }
        }
      }
    }
    return canonicalFileName;
  }
 catch (  IOException e) {
    return originalFileName;
  }
}
