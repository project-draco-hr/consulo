{
  final File ioFile=convertToIOFile(file);
  @SuppressWarnings("IOResourceOpenedButNotSafelyClosed") final OutputStream stream=shallUseSafeStream(requestor,ioFile) ? new SafeFileOutputStream(ioFile) : new FileOutputStream(ioFile);
  return new BufferedOutputStream(stream){
    public void close() throws IOException {
      super.close();
      if (timeStamp > 0) {
        ioFile.setLastModified(timeStamp);
      }
    }
  }
;
}
