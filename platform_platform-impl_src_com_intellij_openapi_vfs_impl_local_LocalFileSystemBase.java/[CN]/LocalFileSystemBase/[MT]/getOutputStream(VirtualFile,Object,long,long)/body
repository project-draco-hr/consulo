{
  final File ioFile=convertToIOFileAndCheck(file);
  @SuppressWarnings("IOResourceOpenedButNotSafelyClosed") final OutputStream stream=shallUseSafeStream(requestor,ioFile) ? new SafeFileOutputStream(ioFile,SystemInfo.isUnix) : new FileOutputStream(ioFile);
  return new BufferedOutputStream(stream){
    @Override public void close() throws IOException {
      super.close();
      if (timeStamp > 0) {
        if (!ioFile.setLastModified(timeStamp)) {
          LOG.error("Failed: " + file.getPath() + ", "+ timeStamp);
        }
      }
    }
  }
;
}
