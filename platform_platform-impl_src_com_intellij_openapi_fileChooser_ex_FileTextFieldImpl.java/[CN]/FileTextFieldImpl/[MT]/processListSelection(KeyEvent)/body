{
  if (togglePopup(e))   return;
  if (!isPopupShowing())   return;
  final InputMap map=myPathTextField.getInputMap(JComponent.WHEN_IN_FOCUSED_WINDOW);
  if (map != null) {
    final Object object=map.get(KeyStroke.getKeyStrokeForEvent(e));
    if (object instanceof Action) {
      final Action action=(Action)object;
      if (action.isEnabled()) {
        action.actionPerformed(new ActionEvent(this,ActionEvent.ACTION_PERFORMED,"action"));
        e.consume();
        return;
      }
    }
  }
  final Object action=getAction(e,myList);
  if ("selectNextRow".equals(action)) {
    if (ensureSelectionExists()) {
      ListScrollingUtil.moveDown(myList,e.getModifiersEx());
      e.consume();
    }
  }
 else   if ("selectPreviousRow".equals(action)) {
    ListScrollingUtil.moveUp(myList,e.getModifiersEx());
    e.consume();
  }
 else   if ("scrollDown".equals(action)) {
    ListScrollingUtil.movePageDown(myList);
    e.consume();
  }
 else   if ("scrollUp".equals(action)) {
    ListScrollingUtil.movePageUp(myList);
    e.consume();
  }
 else   if (getSelectedFileFromCompletionPopup() != null && (e.getKeyCode() == KeyEvent.VK_ENTER || e.getKeyCode() == KeyEvent.VK_TAB) && e.getModifiers() == 0) {
    hideCurrentPopup();
    e.consume();
    processChosenFromCompletion(e.getKeyCode() == KeyEvent.VK_TAB);
  }
}
