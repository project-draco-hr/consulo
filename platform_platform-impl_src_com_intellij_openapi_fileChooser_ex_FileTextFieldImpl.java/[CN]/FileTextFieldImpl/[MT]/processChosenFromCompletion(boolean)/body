{
  final LookupFile file=getSelectedFileFromCompletionPopup();
  if (file == null)   return;
  if (nameOnly) {
    try {
      final Document doc=myPathTextField.getDocument();
      int caretPos=myPathTextField.getCaretPosition();
      if (myFinder.getSeparator().equals(doc.getText(caretPos,1))) {
        for (; caretPos < doc.getLength(); caretPos++) {
          final String eachChar=doc.getText(caretPos,1);
          if (!myFinder.getSeparator().equals(eachChar))           break;
        }
      }
      int start=caretPos > 0 ? caretPos - 1 : caretPos;
      while (start >= 0) {
        final String each=doc.getText(start,1);
        if (myFinder.getSeparator().equals(each)) {
          start++;
          break;
        }
        start--;
      }
      int end=start < caretPos ? caretPos : start;
      while (end <= doc.getLength()) {
        final String each=doc.getText(end,1);
        if (myFinder.getSeparator().equals(each)) {
          break;
        }
        end++;
      }
      if (end > doc.getLength()) {
        end=doc.getLength();
      }
      if (start > end || start < 0 || end > doc.getLength()) {
        setTextToFile(file);
      }
 else {
        replacePathComponent(file,caretPos,start,end);
      }
    }
 catch (    BadLocationException e) {
      LOG.error(e);
    }
  }
 else {
    setTextToFile(file);
  }
}
