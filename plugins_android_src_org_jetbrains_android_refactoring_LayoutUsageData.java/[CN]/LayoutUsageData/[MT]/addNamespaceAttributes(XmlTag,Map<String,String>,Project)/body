{
  final XmlAttribute[] parentAttributes=tag.getAttributes();
  final XmlAttribute firstParentAttribute=parentAttributes.length > 0 ? parentAttributes[0] : null;
  final XmlElementFactory factory=XmlElementFactory.getInstance(project);
  for (  Map.Entry<String,String> entry : namespaces.entrySet()) {
    final String prefix=entry.getKey();
    final String namespace=entry.getValue();
    if (!namespace.equals(tag.getNamespaceByPrefix(prefix))) {
      final XmlAttribute xmlnsAttr=factory.createXmlAttribute("xmlns:" + prefix,namespace);
      if (firstParentAttribute != null) {
        tag.addBefore(xmlnsAttr,firstParentAttribute);
      }
 else {
        tag.add(xmlnsAttr);
      }
    }
  }
}
