{
  if (shouldAskUser()) {
    int result=Messages.showOkCancelDialog(myProject,CompilerBundle.message("warning.compiler.running.on.project.close"),CompilerBundle.message("compiler.running.dialog.title"),Messages.getQuestionIcon());
    if (result != 0) {
      return false;
    }
    myUserAcceptedCancel=true;
    final CompilerManager compilerManager=CompilerManager.getInstance(project);
    compilerManager.addCompilationStatusListener(new CompilationStatusListener(){
      public void compilationFinished(      boolean aborted,      int errors,      int warnings,      final CompileContext compileContext){
        compilerManager.removeCompilationStatusListener(this);
        ProjectUtil.closeProject(project);
      }
    }
);
    cancel();
    return false;
  }
  return !myIndicator.isRunning();
}
