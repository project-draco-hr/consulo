{
  myIndicator=indicator;
  final Semaphore semaphore=((CompilerManagerImpl)CompilerManager.getInstance(myProject)).getCompilationSemaphore();
  semaphore.acquireUninterruptibly();
  try {
    if (!isHeadless()) {
      addIndicatorDelegate();
    }
    myCompileWork.run();
  }
  finally {
    indicator.stop();
    semaphore.release();
  }
}
