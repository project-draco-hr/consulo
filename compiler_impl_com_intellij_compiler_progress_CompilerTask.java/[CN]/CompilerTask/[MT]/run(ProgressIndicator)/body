{
  myIndicator=indicator;
  ((ProgressIndicatorEx)myIndicator).addStateDelegate(new ProgressIndicatorBase(){
    public void cancel(){
      super.cancel();
      closeUI();
    }
    public void stop(){
      super.stop();
      if (!isCanceled()) {
        closeUI();
      }
    }
    public void setText(    final String text){
      updateProgressText();
    }
    public void setText2(    final String text){
      updateProgressText();
    }
    public void setFraction(    final double fraction){
      updateProgressText();
    }
  }
);
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      if (myIsBackgroundMode) {
        openMessageView();
      }
 else {
        if (myIndicator.isRunning()) {
synchronized (myMessageViewLock) {
            if (myErrorTreeView == null) {
              removeAllContents(myProject,null);
            }
          }
        }
      }
    }
  }
);
  myCompileWork.run();
}
