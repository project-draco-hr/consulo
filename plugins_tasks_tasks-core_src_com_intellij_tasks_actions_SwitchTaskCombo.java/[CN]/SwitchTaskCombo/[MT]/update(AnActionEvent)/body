{
  Project project=e.getData(CommonDataKeys.PROJECT);
  Presentation presentation=e.getPresentation();
  if (project == null || project.isDisposed() || (ActionPlaces.MAIN_MENU.equals(e.getPlace()) && findFrame(e) == null)) {
    presentation.setEnabled(false);
    presentation.setText("");
    presentation.setIcon(null);
  }
 else {
    TaskManager taskManager=TaskManager.getManager(project);
    LocalTask activeTask=taskManager.getActiveTask();
    presentation.setVisible(true);
    presentation.setEnabled(true);
    if (isImplicit(activeTask) && taskManager.getAllRepositories().length == 0 && !TaskSettings.getInstance().ALWAYS_DISPLAY_COMBO) {
      presentation.setVisible(false);
    }
 else {
      String s=getText(activeTask);
      presentation.setText(s);
      presentation.setIcon(activeTask.getIcon());
      presentation.setDescription(activeTask.getSummary());
    }
  }
}
