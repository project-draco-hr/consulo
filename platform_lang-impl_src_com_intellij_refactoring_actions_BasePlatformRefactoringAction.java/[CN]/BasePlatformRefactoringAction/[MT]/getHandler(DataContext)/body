{
  final Language[] languages=LangDataKeys.CONTEXT_LANGUAGES.getData(dataContext);
  if (languages != null) {
    for (    Language language : languages) {
      List<RefactoringSupportProvider> providers=LanguageRefactoringSupport.INSTANCE.allForLanguage(language);
      if (providers.isEmpty())       continue;
      if (providers.size() == 1)       return getRefactoringHandler(providers.get(0));
      PsiElement element=getElementAtCaret(LangDataKeys.EDITOR.getData(dataContext),LangDataKeys.PSI_FILE.getData(dataContext));
      if (element != null) {
        for (        RefactoringSupportProvider provider : providers) {
          if (provider.isAvailable(element)) {
            return getRefactoringHandler(provider);
          }
        }
      }
    }
  }
  return null;
}
