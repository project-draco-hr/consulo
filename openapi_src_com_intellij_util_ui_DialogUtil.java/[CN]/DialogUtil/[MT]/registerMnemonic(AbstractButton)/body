{
  String text=button.getText();
  if (SystemInfo.isMac) {
    final int doubleAmpPosition=text.indexOf("&&");
    if (doubleAmpPosition >= 0) {
      final String beforeAmp=text.substring(0,doubleAmpPosition);
      if (doubleAmpPosition < text.length() - 2) {
        final String afterAmp=text.substring(doubleAmpPosition + 2);
        text=beforeAmp.replaceAll("&","") + "&" + afterAmp.replaceAll("&","");
      }
    }
  }
 else {
    text=text.replaceAll("&&","");
  }
  StringBuffer realText=new StringBuffer();
  char mnemonic='\0';
  int index=-1;
  for (int i=0; i < text.length(); i++) {
    char ch=text.charAt(i);
    if (ch != '&') {
      realText.append(ch);
    }
 else     if (i + 1 < text.length()) {
      mnemonic=text.charAt(i + 1);
      index=realText.length();
    }
  }
  if (mnemonic != '\0') {
    button.setText(realText.toString());
    button.setMnemonic(mnemonic);
    button.setDisplayedMnemonicIndex(index);
  }
}
