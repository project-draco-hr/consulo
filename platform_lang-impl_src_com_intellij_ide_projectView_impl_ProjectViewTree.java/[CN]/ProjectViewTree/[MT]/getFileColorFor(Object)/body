{
  Color color=null;
  if (object instanceof AbstractTreeNode) {
    final Object element=((AbstractTreeNode)object).getValue();
    if (element instanceof PsiElement) {
      final PsiElement psi=(PsiElement)element;
      if (!psi.isValid())       return null;
      final VirtualFile file=PsiUtilCore.getVirtualFile(psi);
      if (file != null) {
        color=FileColorManager.getInstance(getProject()).getFileColor(file);
      }
 else       if (psi instanceof PsiDirectory) {
        color=FileColorManager.getInstance(getProject()).getFileColor(((PsiDirectory)psi).getVirtualFile());
      }
 else       if (psi instanceof PsiDirectoryContainer) {
        final PsiDirectory[] dirs=((PsiDirectoryContainer)psi).getDirectories();
        for (        PsiDirectory dir : dirs) {
          Color c=FileColorManager.getInstance(getProject()).getFileColor(dir.getVirtualFile());
          if (c != null && color == null) {
            color=c;
          }
 else           if (c != null && color != null) {
            color=null;
            break;
          }
        }
      }
    }
  }
  return color;
}
