{
  final String fileName=file.getName();
  if (file.getParent().getName().equals(".idea") && fileName.equals("workspace.xml")) {
    List<Object> componentList=new ArrayList<Object>();
    for (    String componentName : COMPONENT_NAMES) {
      Object component=project.getComponent(componentName);
      if (component == null) {
        try {
          component=ServiceManager.getService(project,Class.forName(componentName));
        }
 catch (        ClassNotFoundException ignore) {
        }
      }
      ContainerUtil.addIfNotNull(componentList,component);
    }
    if (!componentList.isEmpty()) {
      final Element root=new Element("project");
      for (      final Object component : componentList) {
        final Element element=new Element("component");
        element.setAttribute("name",ComponentManagerImpl.getComponentName(component));
        root.addContent(element);
        UIUtil.invokeAndWaitIfNeeded(new Runnable(){
          @Override public void run(){
            if (component instanceof JDOMExternalizable) {
              try {
                ((JDOMExternalizable)component).writeExternal(element);
              }
 catch (              WriteExternalException ignore) {
                LOG.error(ignore);
              }
            }
 else {
              Object state=((PersistentStateComponent)component).getState();
              Element element1=XmlSerializer.serialize(state);
              element.addContent(element1.cloneContent());
              element.setAttribute("name",ComponentStoreImpl.getComponentName((PersistentStateComponent)component));
            }
          }
        }
);
      }
      PathMacroManager.getInstance(project).collapsePaths(root);
      return JDOMUtil.writeElement(root);
    }
  }
  return null;
}
