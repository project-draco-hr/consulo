{
  myCurrentBranches.setVisibleBranches(myHeads);
  if (myVisibilityPredicate == null) {
    myMutableGraph=CollapsedMutableGraph.newInstance(myPermanentGraph,myPermanentGraphLayout,myGraphFlags,myBranchNodeIndexes,myDfsUtil);
    GraphCellGeneratorImpl cellGenerator=new GraphCellGeneratorImpl(myMutableGraph);
    myGraphRender=new GraphRender(myMutableGraph,myColorManager,cellGenerator);
  }
 else {
    Condition<Integer> isVisibleNode=new Condition<Integer>(){
      @Override public boolean value(      Integer integer){
        return myVisibilityPredicate.value(myPermanentGraph.getHashIndex(integer));
      }
    }
;
    FilterMutableGraph filterMutableGraph=FilterMutableGraph.newInstance(myPermanentGraph,myPermanentGraphLayout,myGraphFlags.getVisibleNodesInBranches(),myGraphFlags.getFlagsForFilters(),isVisibleNode);
    myMutableGraph=filterMutableGraph;
    FilterGraphCellGenerator filterGraphCellGenerator=new FilterGraphCellGenerator(filterMutableGraph);
    myGraphRender=new GraphRender(myMutableGraph,myColorManager,filterGraphCellGenerator);
  }
}
