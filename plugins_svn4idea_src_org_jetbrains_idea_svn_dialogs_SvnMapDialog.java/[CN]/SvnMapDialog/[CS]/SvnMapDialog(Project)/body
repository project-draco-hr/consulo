{
  super(project,true);
  myProject=project;
  setTitle(SvnBundle.message("dialog.show.svn.map.title"));
  init();
  final SvnVcs vcs=SvnVcs.getInstance(myProject);
  myTableModel.setItems(vcs.getAllWcInfos());
  myTableView.getSelectionModel().addListSelectionListener(new ListSelectionListener(){
    public void valueChanged(    final ListSelectionEvent e){
      final Collection<WCInfo> selected=myTableView.getSelection();
      myChangeFormatButton.setEnabled((selected.size() == 1) && (!ProjectLevelVcsManager.getInstance(project).isBackgroundVcsOperationRunning()));
    }
  }
);
  myChangeFormatButton.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      final Collection<WCInfo> selected=myTableView.getSelection();
      if (selected.size() != 1) {
        return;
      }
      final WCInfo wcInfo=selected.iterator().next();
      final File path=new File(wcInfo.getPath());
      ChangeFormatDialog dialog=new ChangeFormatDialog(project,path,false);
      dialog.setData(true,wcInfo.getFormat().getOption());
      dialog.show();
      if (!dialog.isOK()) {
        return;
      }
      final String newMode=dialog.getUpgradeMode();
      if (!wcInfo.getFormat().getOption().equals(newMode)) {
        final WorkingCopyFormat newFormat=WorkingCopyFormat.getInstance(newMode);
        final Task.Backgroundable task=new SvnFormatWorker(project,newFormat,wcInfo);
        doOKAction();
        ProgressManager.getInstance().run(task);
      }
    }
  }
);
  myChangeFormatButton.setEnabled((myTableView.getSelection().size() == 1) && (!ProjectLevelVcsManager.getInstance(project).isBackgroundVcsOperationRunning()));
}
