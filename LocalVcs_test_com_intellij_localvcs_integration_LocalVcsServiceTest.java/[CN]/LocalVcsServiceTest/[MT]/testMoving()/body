{
  vcs.createDirectory("dir1",null);
  vcs.createDirectory("dir2",null);
  vcs.createFile("dir1/file","content",null);
  vcs.apply();
  VirtualFile f=new TestVirtualFile("dir1/file",null,777L);
  VirtualFile newParent=new TestVirtualFile("dir2",null);
  fileManager.fireBeforeFileMovement(new VirtualFileMoveEvent(null,f,null,newParent));
  assertFalse(vcs.hasEntry("dir1/file"));
  Entry e=vcs.findEntry("dir2/file");
  assertNotNull(e);
  assertEquals("content",e.getContent());
  assertEquals(777L,e.getTimestamp());
}
