{
  if (parent instanceof CodeFragmentElement) {
    final FileElement holderElement=new DummyHolder(fileImpl.getManager(),null).getTreeElement();
    TreeUtil.addChildren(holderElement,fileImpl.createContentLeafElement(newFileText,0,textLength,holderElement.getCharTable()));
    parent.replaceAllChildrenToChildrenOf(holderElement);
  }
 else {
    final PsiFileImpl newFile=(PsiFileImpl)PsiElementFactoryImpl.createFileFromText((PsiManagerImpl)fileImpl.getManager(),fileType,fileImpl.getName(),newFileText,0,textLength);
    final ASTNode newFileElement=newFile.getTreeElement();
    fileImpl.getTreeElement().replaceAllChildrenToChildrenOf(newFileElement);
  }
}
