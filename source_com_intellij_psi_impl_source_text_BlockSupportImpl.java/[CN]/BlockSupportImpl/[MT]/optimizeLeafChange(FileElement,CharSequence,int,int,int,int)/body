{
  final LeafElement leafElement=treeFileElement.findLeafElementAt(startOffset);
  if (leafElement == null || hasErrorElementChild(leafElement.getTreeParent()) || hasErrorElementChild(leafElement.getTreeNext()) || hasErrorElementChild(leafElement.getTreePrev())) {
    return false;
  }
  if (!leafElement.getTextRange().contains(new TextRange(startOffset,endOffset)))   return false;
  final LeafElement leafElementToChange=treeFileElement.findLeafElementAt(changedOffset);
  if (leafElementToChange == null)   return false;
  TextRange leafRangeToChange=leafElementToChange.getTextRange();
  LeafElement newElement=Factory.createLeafElement(leafElementToChange.getElementType(),newFileText,leafRangeToChange.getStartOffset(),leafRangeToChange.getEndOffset() + lengthDiff,-1,treeFileElement.getCharTable());
  newElement.putUserData(CharTable.CHAR_TABLE_KEY,treeFileElement.getCharTable());
  ChangeUtil.replaceChild(leafElementToChange.getTreeParent(),leafElementToChange,newElement);
  return true;
}
