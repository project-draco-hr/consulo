{
  myProject=project;
  myFileManager=javaFileManager;
  myNameHelper=new PsiNameHelperImpl(this);
  myConstantEvaluationHelper=new PsiConstantEvaluationHelperImpl();
  List<PsiElementFinder> elementFinders=new ArrayList<PsiElementFinder>();
  elementFinders.add(new PsiElementFinderImpl());
  ContainerUtil.addAll(elementFinders,myProject.getExtensions(PsiElementFinder.EP_NAME));
  myElementFinders=elementFinders.toArray(new PsiElementFinder[elementFinders.size()]);
  final PsiModificationTracker modificationTracker=psiManager.getModificationTracker();
  if (bus != null) {
    bus.connect().subscribe(PsiModificationTracker.TOPIC,new PsiModificationTracker.Listener(){
      private long lastTimeSeen=-1L;
      @Override public void modificationCountChanged(){
        final long now=modificationTracker.getJavaStructureModificationCount();
        if (lastTimeSeen != now) {
          lastTimeSeen=now;
          myPackageCache.clear();
        }
      }
    }
);
  }
  DummyHolderFactory.setFactory(new JavaDummyHolderFactory());
  JavaElementType.ANNOTATION.getIndex();
}
