{
  final PackagingElementsTree tree=myEditor.getPackagingElementsTree();
  final CompositePackagingElement<?> oldParent=getCommonParent(tree.getSelectedNodes());
  if (oldParent == null)   return;
  final Function<PackagingElement<?>,PackagingElement<?>> map=tree.ensureRootIsWritable();
  final CompositePackagingElement<?> parent=(CompositePackagingElement<?>)map.fun(oldParent);
  if (parent == null)   return;
  final Collection<? extends PackagingElement> selectedElements=tree.getSelectedElements();
  final String name=Messages.showInputDialog(myEditor.getMainComponent(),"Specify artifact name: ","Extract Artifact",null);
  if (name != null) {
    final ModifiableArtifact artifact=myEditor.getContext().getModifiableArtifactModel().addArtifact(name);
    for (    PackagingElement<?> element : selectedElements) {
      artifact.getRootElement().addChild(ArtifactUtil.copyWithChildren(element));
    }
    for (    PackagingElement element : selectedElements) {
      parent.removeChild(map.fun(element));
    }
    parent.addChild(new ArtifactPackagingElement(name));
    tree.rebuildTree();
  }
}
