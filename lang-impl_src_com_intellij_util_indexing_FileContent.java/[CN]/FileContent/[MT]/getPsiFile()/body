{
  PsiFile psi=getUserData(FileBasedIndex.PSI_FILE);
  if (psi == null) {
    psi=getUserData(ourCachedPsiFromContentKey);
  }
  if (psi == null) {
    Project project=getProject();
    if (project == null) {
      if (ApplicationManager.getApplication().isUnitTestMode()) {
        project=ProjectManager.getInstance().getDefaultProject();
      }
 else {
        throw new NoProjectForFileException();
      }
    }
    psi=PsiFileFactory.getInstance(project).createFileFromText(getFileName(),getFileType(),getContentAsText(),1,false,false);
    psi.putUserData(FileBasedIndex.VIRTUAL_FILE,getFile());
    putUserData(ourCachedPsiFromContentKey,psi);
  }
  return psi;
}
