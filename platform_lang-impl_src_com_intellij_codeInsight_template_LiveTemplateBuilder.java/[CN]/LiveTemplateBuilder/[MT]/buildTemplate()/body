{
  TemplateImpl template=new TemplateImpl("","");
  for (  Variable variable : myVariables) {
    template.addVariable(variable.getName(),variable.getExpressionString(),variable.getDefaultValueString(),variable.isAlwaysStopAt());
  }
  Collections.sort(myVariableOccurences,new Comparator<VarOccurence>(){
    public int compare(    VarOccurence o1,    VarOccurence o2){
      if (o1.myOffset < o2.myOffset) {
        return -1;
      }
      if (o1.myOffset > o2.myOffset) {
        return 1;
      }
      return 0;
    }
  }
);
  int last=0;
  for (  VarOccurence occurence : myVariableOccurences) {
    template.addTextSegment(myText.substring(last,occurence.myOffset));
    template.addVariableSegment(occurence.myName);
    last=occurence.myOffset;
  }
  template.addTextSegment(myText.substring(last));
  template.setToReformat(true);
  return template;
}
