{
  myFixture.configureByFile("/codeInsight/completion/normal/" + getTestName(false) + ".java");
  new WriteCommandAction.Simple(getProject()){
    @Override protected void run() throws Throwable {
      final ModifiableRootModel model=ModuleRootManager.getInstance(myFixture.getModule()).getModifiableModel();
      model.getContentEntries()[0].getSourceFolders()[0].setPackagePrefix("foo.bar.goo");
      model.commit();
    }
  }
.execute().throwException();
  myFixture.completeBasic();
  myFixture.checkResultByFile("/codeInsight/completion/normal/" + getTestName(false) + "_after.java");
  assertTrue(JavaPsiFacade.getInstance(getProject()).findPackage("foo").isValid());
  assertTrue(JavaPsiFacade.getInstance(getProject()).findPackage("foo.bar").isValid());
  assertTrue(JavaPsiFacade.getInstance(getProject()).findPackage("foo.bar.goo").isValid());
}
