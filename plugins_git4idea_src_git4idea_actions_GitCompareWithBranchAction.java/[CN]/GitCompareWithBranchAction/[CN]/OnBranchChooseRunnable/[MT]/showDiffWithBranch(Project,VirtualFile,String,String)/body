{
  final FilePath filePath=new FilePathImpl(file);
  final VcsRevisionNumber currentRevisionNumber=GitHistoryUtils.getCurrentRevision(project,filePath,head);
  final VcsRevisionNumber compareRevisionNumber=GitHistoryUtils.getCurrentRevision(project,filePath,branchToCompare);
  if (compareRevisionNumber == null) {
    fileDoesntExistInBranchError(project,file,branchToCompare);
    return;
  }
  final VcsFileRevision compareRevision=new GitFileRevision(project,filePath,(GitRevisionNumber)compareRevisionNumber,false);
  final String currentTitle=currentRevisionNumber != null ? ((GitRevisionNumber)currentRevisionNumber).getShortRev() + " on " + head : "Local changes on " + head;
  final String compareTitle=((GitRevisionNumber)compareRevisionNumber).getShortRev() + " on " + branchToCompare;
  try {
    VcsHistoryUtil.showDiff(project,filePath,new CurrentRevision(file,currentRevisionNumber),compareRevision,currentTitle,compareTitle);
  }
 catch (  IOException e) {
    throw new VcsException(String.format("Couldn't show diff for file [%s], head [%s] and branch [%s]",file.getPresentableUrl(),head,branchToCompare),e);
  }
}
