{
  PsiElementFactory factory=JavaPsiFacade.getInstance(tryStatement.getProject()).getElementFactory();
  JavaCodeStyleManager styleManager=JavaCodeStyleManager.getInstance(tryStatement.getProject());
  String name=styleManager.suggestVariableName(VariableKind.PARAMETER,null,null,exceptionType).names[0];
  name=styleManager.suggestUniqueVariableName(name,tryStatement,false);
  PsiCatchSection catchSection=factory.createCatchSection(exceptionType,name,file);
  PsiCodeBlock finallyBlock=tryStatement.getFinallyBlock();
  if (finallyBlock == null) {
    tryStatement.add(catchSection);
  }
 else {
    PsiElement finallyElement=finallyBlock;
    while (!(finallyElement instanceof PsiKeyword) && !PsiKeyword.FINALLY.equals(finallyElement.getText())) {
      finallyElement=finallyElement.getPrevSibling();
    }
    tryStatement.addBefore(catchSection,finallyElement);
  }
  PsiParameter[] parameters=tryStatement.getCatchBlockParameters();
  parameters[parameters.length - 1].getTypeElement().replace(factory.createTypeElement(exceptionType));
  PsiCodeBlock[] catchBlocks=tryStatement.getCatchBlocks();
  return catchBlocks[catchBlocks.length - 1];
}
