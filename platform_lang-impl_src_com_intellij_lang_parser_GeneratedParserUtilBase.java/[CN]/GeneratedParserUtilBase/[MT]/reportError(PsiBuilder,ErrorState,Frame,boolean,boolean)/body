{
  String expectedText=state.getExpectedText(builder_);
  boolean notEmpty=StringUtil.isNotEmpty(expectedText);
  if (force || notEmpty || advance) {
    String gotText=builder_.eof() ? "unexpected end of file" : notEmpty ? "got '" + builder_.getTokenText() + "'" : "'" + builder_.getTokenText() + "' unexpected";
    String message=expectedText + gotText;
    if (advance) {
      PsiBuilder.Marker mark=builder_.mark();
      builder_.advanceLexer();
      mark.error(message);
    }
 else {
      builder_.error(message);
    }
    builder_.eof();
    frame.errorReportedAt=builder_.rawTokenIndex();
    return true;
  }
  return false;
}
