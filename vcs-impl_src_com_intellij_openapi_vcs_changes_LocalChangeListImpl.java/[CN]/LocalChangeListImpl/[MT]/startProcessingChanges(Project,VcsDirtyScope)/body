{
  createReadChangesCache();
  final Collection<Change> result=new ArrayList<Change>();
  myChangesBeforeUpdate=new ChangeHashSet(myChanges);
  myOutdatedChanges=new ArrayList<Change>();
  final ExcludedFileIndex fileIndex=ExcludedFileIndex.getInstance(project);
  for (  Change oldBoy : myChangesBeforeUpdate) {
    final ContentRevision before=oldBoy.getBeforeRevision();
    final ContentRevision after=oldBoy.getAfterRevision();
    if (scope == null || before != null && scope.belongsTo(before.getFile()) || after != null && scope.belongsTo(after.getFile()) || isIgnoredChange(oldBoy,fileIndex)) {
      result.add(oldBoy);
      myIsInUpdate=true;
      removeChange(oldBoy);
      myOutdatedChanges.add(oldBoy);
    }
  }
  if (isDefault()) {
    myIsInUpdate=true;
  }
  return result;
}
