{
  if (myBuilder == null)   return null;
  final FavoritesTreeNodeDescriptor[] selectedNodeDescriptors=getSelectedNodeDescriptors();
  if (selectedNodeDescriptors == null || selectedNodeDescriptors.length != 1)   return null;
  final FavoritesTreeNodeDescriptor currentDescriptor=selectedNodeDescriptors[0];
  if (currentDescriptor != null && currentDescriptor.getElement() instanceof AbstractTreeNode) {
    final AbstractTreeNode currentNode=((AbstractTreeNode)currentDescriptor.getElement());
    if (currentNode.getValue() instanceof PsiDirectory) {
      return (PsiDirectory)currentNode.getValue();
    }
  }
  final NodeDescriptor parentDescriptor=currentDescriptor.getParentDescriptor();
  if (parentDescriptor != null) {
    final Object parentElement=parentDescriptor.getElement();
    if (parentElement instanceof AbstractTreeNode) {
      final AbstractTreeNode parentNode=((AbstractTreeNode)parentElement);
      if (parentNode.getValue() instanceof PsiDirectory) {
        return (PsiDirectory)parentNode.getValue();
      }
    }
  }
  return null;
}
