{
  if (myBuilder == null)   return null;
  final FavoritesTreeNodeDescriptor[] selectedNodeDescriptors=getSelectedNodeDescriptors();
  if (selectedNodeDescriptors == null || selectedNodeDescriptors.length != 1)   return null;
  final FavoritesTreeNodeDescriptor currentDescriptor=selectedNodeDescriptors[0];
  if (currentDescriptor != null) {
    if (currentDescriptor.getElement() != null) {
      final AbstractTreeNode currentNode=currentDescriptor.getElement();
      if (currentNode.getValue() instanceof PsiDirectory) {
        return (PsiDirectory)currentNode.getValue();
      }
    }
    final NodeDescriptor parentDescriptor=currentDescriptor.getParentDescriptor();
    if (parentDescriptor != null) {
      final Object parentElement=parentDescriptor.getElement();
      if (parentElement instanceof AbstractTreeNode) {
        final AbstractTreeNode<PsiDirectory> parentNode=((AbstractTreeNode<PsiDirectory>)parentElement);
        if (parentNode.getValue() instanceof PsiDirectory) {
          return parentNode.getValue();
        }
      }
    }
  }
  return null;
}
