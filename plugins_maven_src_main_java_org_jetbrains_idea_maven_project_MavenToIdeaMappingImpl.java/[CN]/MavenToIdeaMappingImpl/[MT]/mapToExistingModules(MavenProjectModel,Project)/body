{
  for (  Module module : ModuleManager.getInstance(project).getModules()) {
    nameToModule.put(module.getName(),module);
  }
  mavenProjectModel.visit(new MavenProjectModel.MavenProjectVisitorPlain(){
    public void visit(    MavenProjectModel.Node node){
      Module module=node.getLinkedModule() != null ? node.getLinkedModule() : nameToModule.get(projectToModuleName.get(node));
      if (module == null)       return;
      String modulePath=FileUtil.toSystemIndependentName(module.getModuleFilePath());
      String nodePath=FileUtil.toSystemIndependentName(getModuleFilePath(node));
      if (modulePath.equalsIgnoreCase(nodePath)) {
        projectToModule.put(node,module);
        obsoleteModules.remove(module);
      }
 else {
        obsoleteModules.add(module);
        node.unlinkModule();
      }
    }
  }
);
  for (  Module module : ModuleManager.getInstance(project).getModules()) {
    if (projectNames.contains(module.getName()))     continue;
    obsoleteModules.add(module);
  }
  for (  Module obsoleteModule : obsoleteModules) {
    nameToModule.remove(obsoleteModule.getName());
  }
}
