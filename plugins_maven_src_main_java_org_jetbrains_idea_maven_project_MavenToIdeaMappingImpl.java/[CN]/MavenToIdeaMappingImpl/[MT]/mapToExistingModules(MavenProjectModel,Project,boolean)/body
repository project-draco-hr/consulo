{
  for (  Module module : ModuleManager.getInstance(project).getModules()) {
    nameToModule.put(module.getName(),module);
    if (obsoleteSyntheticModules && SyntheticModuleUtil.isSynthetic(module)) {
      obsoleteModules.add(module);
    }
  }
  mavenProjectModel.visit(new MavenProjectModel.MavenProjectVisitorPlain(){
    public void visit(    MavenProjectModel.Node node){
      Module module=node.getLinkedModule() != null ? node.getLinkedModule() : nameToModule.get(projectToModuleName.get(node));
      if (module != null) {
        if (FileUtil.toSystemIndependentName(module.getModuleFilePath()).equalsIgnoreCase(FileUtil.toSystemIndependentName(getModuleFilePath(node)))) {
          projectToModule.put(node,module);
          obsoleteModules.remove(module);
        }
 else {
          obsoleteModules.add(module);
          node.unlinkModule();
        }
      }
    }
  }
);
  for (  Module obsoleteModule : obsoleteModules) {
    nameToModule.remove(obsoleteModule.getName());
  }
}
