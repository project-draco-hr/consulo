{
  final List<String> duplicateNames=collectDuplicateModuleNames(mavenProjectModel);
  mavenProjectModel.visit(new MavenProjectModel.MavenProjectVisitorPlain(){
    public void visit(    MavenProjectModel.Node node){
      final MavenId projectId=node.getId();
      final String name=node.getLinkedModule() != null ? node.getLinkedModule().getName() : generateModuleName(projectId,duplicateNames);
      projectIdToModuleName.put(projectId,name);
      projectToModuleName.put(node,name);
      libraryNameToModuleName.put(getLibraryName(projectId),name);
      Set<MavenProjectModel.Node> projects=nameToProject.get(name);
      if (projects == null) {
        projects=new HashSet<MavenProjectModel.Node>();
        nameToProject.put(name,projects);
      }
 else {
        duplicateImportedNames.add(name);
      }
      projects.add(node);
    }
  }
);
}
