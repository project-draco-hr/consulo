{
  TemplateState prevState=getTemplateState(editor);
  if (prevState != null) {
    disposeState(prevState);
  }
  TemplateState state=new TemplateState(myProject,editor);
  myDisposables.add(state);
  editor.putUserData(TEMPLATE_STATE_KEY,state);
  return state;
}
