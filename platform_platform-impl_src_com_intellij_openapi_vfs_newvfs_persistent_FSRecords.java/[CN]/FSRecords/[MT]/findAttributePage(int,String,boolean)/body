{
  checkFileIsValid(fileId);
  Storage storage=getAttributesStorage();
  int encodedAttrId=DbConnection.getAttributeId(attrId);
  int recordId=getAttributeRecordId(fileId);
  if (recordId == 0) {
    if (!toWrite)     return 0;
    recordId=storage.createNewRecord();
    setAttributeRecordId(fileId,recordId);
  }
 else {
    DataInputStream attrRefs=storage.readStream(recordId);
    try {
      while (attrRefs.available() > 0) {
        final int attIdOnPage=DataInputOutputUtil.readINT(attrRefs);
        final int attrAddress=DataInputOutputUtil.readINT(attrRefs);
        if (attIdOnPage == encodedAttrId)         return attrAddress;
      }
    }
  finally {
      attrRefs.close();
    }
  }
  if (toWrite) {
    Storage.AppenderStream appender=storage.appendStream(recordId);
    DataInputOutputUtil.writeINT(appender,encodedAttrId);
    int attrAddress=storage.createNewRecord();
    DataInputOutputUtil.writeINT(appender,attrAddress);
    DbConnection.REASONABLY_SMALL.myAttrPageRequested=true;
    try {
      appender.close();
    }
  finally {
      DbConnection.REASONABLY_SMALL.myAttrPageRequested=false;
    }
    return attrAddress;
  }
  return 0;
}
