{
  if (fileId <= 0) {
    throw DbConnection.handleError(new AssertionError("assert fileId > 0 failed"));
  }
  if ((getFlags(fileId) & FREE_RECORD_FLAG) != 0) {
    throw DbConnection.handleError(new AssertionError("Trying to find an attribute of deleted page"));
  }
  int attrsRecord=getAttributeRecordId(fileId,attributeId);
  if (attrsRecord == 0) {
    if (!createIfNotFound)     return 0;
    attrsRecord=getAttributes(attributeId).createNewRecord();
    getRecords().putInt(getAttrOffset(fileId,attributeId),attrsRecord);
  }
 else {
    final DataInputStream attrRefs=getAttributes(attributeId).readStream(attrsRecord);
    try {
      while (attrRefs.available() > 0) {
        final int attIdOnPage=attrRefs.readInt();
        final int attAddress=attrRefs.readInt();
        if (attIdOnPage == attributeId)         return attAddress;
      }
    }
  finally {
      attrRefs.close();
    }
  }
  if (createIfNotFound) {
    Storage.AppenderStream appender=getAttributes(attributeId).appendStream(attrsRecord);
    appender.writeInt(attributeId);
    int attAddress=getAttributes(attributeId).createNewRecord();
    appender.writeInt(attAddress);
    appender.close();
    return attAddress;
  }
  return 0;
}
