{
  GraphCommit<CommitId> commit=myCommits.get(nodeIndex);
  List<Integer> upNodes=upAdjacentNodes.remove(commit.getId());
  if (upNodes == null)   upNodes=Collections.emptyList();
  int edgeIndex=myNodeToEdgeIndex[nodeIndex];
  for (  Integer upNodeIndex : upNodes) {
    fixUnderdoneEdge(upNodeIndex,nodeIndex,commit.getId());
    myLongEdges[edgeIndex]=upNodeIndex;
    edgeIndex++;
  }
  if (!mySimpleNodes.get(nodeIndex)) {
    for (    CommitId downCommitId : commit.getParents()) {
      addUnderdoneEdge(nodeIndex,downCommitId);
      myLongEdges[edgeIndex]=-1;
      edgeIndex++;
    }
  }
  myNodeToEdgeIndex[nodeIndex + 1]=edgeIndex;
}
