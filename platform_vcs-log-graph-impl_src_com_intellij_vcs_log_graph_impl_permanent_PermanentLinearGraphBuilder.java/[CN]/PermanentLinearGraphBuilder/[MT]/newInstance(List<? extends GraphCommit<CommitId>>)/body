{
  graphCommits=fixDuplicateParentCommits(graphCommits);
  Flags simpleNodes=new BitSetFlags(graphCommits.size());
  int longEdgesCount=0;
  for (int nodeIndex=0; nodeIndex < graphCommits.size(); nodeIndex++) {
    GraphCommit<CommitId> commit=graphCommits.get(nodeIndex);
    CommitId nextCommitHashIndex=nextCommitHashIndex(graphCommits,nodeIndex);
    List parents=commit.getParents();
    if (parents.size() == 1 && parents.get(0).equals(nextCommitHashIndex)) {
      simpleNodes.set(nodeIndex,true);
    }
 else {
      longEdgesCount+=parents.size();
    }
  }
  return new PermanentLinearGraphBuilder<>(graphCommits,simpleNodes,longEdgesCount);
}
