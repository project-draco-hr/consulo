{
  final NodeList childNodes=e.getChildNodes();
  for (int i=0; i < childNodes.getLength(); i++) {
    final Node child=childNodes.item(i);
    if (child instanceof org.w3c.dom.Element) {
      org.w3c.dom.Element element=(org.w3c.dom.Element)child;
      substitute(element,caseSensitive,usedMacros);
    }
 else     if (child instanceof org.w3c.dom.Text) {
      org.w3c.dom.Text t=(org.w3c.dom.Text)child;
      t.setTextContent(substitute(t.getTextContent(),caseSensitive,usedMacros));
    }
 else     if (child instanceof org.w3c.dom.Comment) {
      org.w3c.dom.Comment c=(org.w3c.dom.Comment)child;
      c.setText(substitute(c.getText(),caseSensitive,usedMacros));
    }
 else {
      LOG.error("Wrong content: " + child.getClass());
    }
  }
  final NamedNodeMap attributes=e.getAttributes();
  for (int i=0; i < attributes.getLength(); i++) {
    final Node node=attributes.item(i);
    Attr attr=(Attr)node;
    e.setAttribute(attr.getName(),substitute(attr.getValue(),caseSensitive,usedMacros));
  }
}
