{
  dropHighlight();
  Pair<TextRange,List<TextRange>> ranges=collectTextRanges(wholeAffected,toExtract);
  TextRange wholeRange=ranges.first;
  List<TextRange> rangesToExtract=ranges.second;
  List<TextRange> rangesToRemove=RangeSplitter.split(wholeRange,rangesToExtract);
  for (  TextRange r : rangesToRemove) {
    addHighliter(r,UnwrapHandler.HIGHLIGHTER_LEVEL,getTestAttributesForRemoval());
  }
  for (  TextRange r : rangesToExtract) {
    addHighliter(r,UnwrapHandler.HIGHLIGHTER_LEVEL,UnwrapHandler.getTestAttributesForExtract());
  }
}
