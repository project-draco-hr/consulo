{
  int newY=myEditor.visibleLineNumberToYPosition(myVisibleCaret.line);
  int lineHeight=myEditor.getLineHeight();
  Rectangle visibleRect=myEditor.getScrollingModel().getVisibleArea();
  final EditorGutterComponentEx gutter=myEditor.getGutterComponentEx();
  final EditorComponentImpl content=(EditorComponentImpl)myEditor.getContentComponent();
  int updateWidth=myEditor.getScrollPane().getHorizontalScrollBar().getValue() + visibleRect.width;
  if (Math.abs(newY - oldY) <= 2 * lineHeight) {
    int minY=Math.min(oldY,newY);
    int maxY=Math.max(oldY + lineHeight,newY + lineHeight);
    content.repaintEditorComponent(0,minY,updateWidth,maxY - minY);
    gutter.repaint(0,minY,gutter.getWidth(),maxY - minY);
  }
 else {
    content.repaintEditorComponent(0,oldY,updateWidth,2 * lineHeight);
    gutter.repaint(0,oldY,updateWidth,2 * lineHeight);
    content.repaintEditorComponent(0,newY,updateWidth,2 * lineHeight);
    gutter.repaint(0,newY,updateWidth,2 * lineHeight);
  }
}
