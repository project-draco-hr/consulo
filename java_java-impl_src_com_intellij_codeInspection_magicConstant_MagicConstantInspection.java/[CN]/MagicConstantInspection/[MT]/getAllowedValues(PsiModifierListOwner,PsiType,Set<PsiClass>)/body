{
  AllowedValues values;
  if (type != null) {
    values=getAllowedValuesFromMagic(element,type);
    if (values != null)     return values;
  }
  PsiAnnotation[] annotations=AnnotationUtil.getAllAnnotations(element,true,null);
  for (  PsiAnnotation annotation : annotations) {
    PsiJavaCodeReferenceElement ref=annotation.getNameReferenceElement();
    PsiElement resolved=ref == null ? null : ref.resolve();
    if (!(resolved instanceof PsiClass) || !((PsiClass)resolved).isAnnotationType())     continue;
    PsiClass aClass=(PsiClass)resolved;
    if (visited == null)     visited=new THashSet<PsiClass>();
    if (!visited.add(aClass))     continue;
    values=getAllowedValues(aClass,type,visited);
    if (values != null)     return values;
  }
  return parseBeanInfo(element);
}
