{
  final PsiStatement thenBranch=ControlFlowUtils.stripBraces(statement.getThenBranch());
  if (thenBranch == null) {
    return null;
  }
  PsiStatement elseBranch=statement.getElseBranch();
  if (elseBranch == null) {
    final PsiElement nextStatement=PsiTreeUtil.skipSiblingsForward(statement,PsiWhiteSpace.class);
    if (nextStatement instanceof PsiStatement) {
      elseBranch=(PsiStatement)nextStatement;
    }
  }
 else {
    elseBranch=ControlFlowUtils.stripBraces(elseBranch);
  }
  if (elseBranch == null) {
    return null;
  }
  final PsiExpression condition=statement.getCondition();
  if (condition == null) {
    return null;
  }
  if (thenBranch instanceof PsiReturnStatement && elseBranch instanceof PsiReturnStatement) {
    return calculateReplacementReturnStatement(thenBranch,elseBranch,condition);
  }
 else   if (thenBranch instanceof PsiExpressionStatement && elseBranch instanceof PsiExpressionStatement) {
    final PsiExpressionStatement thenStatement=(PsiExpressionStatement)thenBranch;
    final PsiExpressionStatement elseStatement=(PsiExpressionStatement)elseBranch;
    final PsiExpression thenExpression=thenStatement.getExpression();
    final PsiExpression elseExpression=elseStatement.getExpression();
    if (!(thenExpression instanceof PsiAssignmentExpression) || !(elseExpression instanceof PsiAssignmentExpression)) {
      return null;
    }
    final PsiAssignmentExpression thenAssignment=(PsiAssignmentExpression)thenExpression;
    final PsiAssignmentExpression elseAssignment=(PsiAssignmentExpression)elseExpression;
    return calculateReplacementAssignmentStatement(thenAssignment,elseAssignment,condition);
  }
  return null;
}
