{
  Project project=e.getData(CommonDataKeys.PROJECT);
  if (project == null)   return;
  final FileEditor fileEditor=e.getData(PlatformDataKeys.FILE_EDITOR);
  if (fileEditor == null)   return;
  final VirtualFile virtualFile;
  final Editor editor=e.getData(CommonDataKeys.EDITOR);
  if (editor == null) {
    virtualFile=e.getData(CommonDataKeys.VIRTUAL_FILE);
  }
 else {
    PsiDocumentManager.getInstance(project).commitDocument(editor.getDocument());
    PsiFile psiFile=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
    if (psiFile == null)     return;
    virtualFile=psiFile.getVirtualFile();
  }
  String title=virtualFile == null ? fileEditor.getName() : virtualFile.getName();
  FeatureUsageTracker.getInstance().triggerFeatureUsed("navigation.popup.file.structure");
  FileStructurePopup popup=createPopup(project,fileEditor);
  if (popup == null)   return;
  popup.setTitle(title);
  popup.show();
}
