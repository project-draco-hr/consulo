{
  if (action instanceof DefaultActionGroup) {
    final AnAction[] children=((DefaultActionGroup)action).getChildren(null);
    for (    AnAction child : children) {
      if (child instanceof DefaultActionGroup) {
        collectEnabledChildren(child,destinationGroup,dataContext,actionManager);
      }
 else       if (child instanceof Separator) {
        destinationGroup.add(child);
      }
 else {
        if (child instanceof BaseRefactoringAction && ((BaseRefactoringAction)child).hasAvailableHandler(dataContext)) {
          final Presentation presentation=new Presentation();
          final AnActionEvent event=new AnActionEvent(null,dataContext,ActionPlaces.UNKNOWN,presentation,actionManager,0);
          child.update(event);
          if (presentation.isEnabled() && presentation.isVisible()) {
            destinationGroup.add(child);
          }
        }
      }
    }
  }
}
