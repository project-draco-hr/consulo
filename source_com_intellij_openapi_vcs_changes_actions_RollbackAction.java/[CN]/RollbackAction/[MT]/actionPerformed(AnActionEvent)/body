{
  Project project=e.getData(DataKeys.PROJECT);
  List<FilePath> missingFiles=e.getData(ChangesListView.MISSING_FILES_DATA_KEY);
  List<VirtualFile> modifiedWithoutEditing=e.getData(ChangesListView.MODIFIED_WITHOUT_EDITING_DATA_KEY);
  if (missingFiles != null && !missingFiles.isEmpty()) {
    new RollbackDeletionAction().actionPerformed(e);
  }
 else   if (modifiedWithoutEditing != null && !modifiedWithoutEditing.isEmpty()) {
    rollbackModifiedWithoutEditing(project,modifiedWithoutEditing);
  }
 else {
    Change[] changes=e.getData(DataKeys.CHANGES);
    final ChangeList list=ChangesUtil.getChangeListIfOnlyOne(project,changes);
    if (list == null)     return;
    FileDocumentManager.getInstance().saveAllDocuments();
    RollbackChangesDialog.rollbackChanges(project,Arrays.asList(changes));
  }
}
