{
  final boolean isEnabled=isEnabled(e);
  e.getPresentation().setEnabled(isEnabled);
  if (isEnabled) {
    VirtualFile[] files=e.getData(DataKeys.VIRTUAL_FILE_ARRAY);
    if (files != null) {
      for (      VirtualFile file : files) {
        final AbstractVcs vcs=ProjectLevelVcsManager.getInstance(e.getData(DataKeys.PROJECT)).getVcsFor(file);
        if (vcs != null) {
          final RollbackEnvironment rollbackEnvironment=vcs.getRollbackEnvironment();
          if (rollbackEnvironment != null) {
            e.getPresentation().setText(rollbackEnvironment.getRollbackOperationName());
          }
        }
      }
    }
  }
}
