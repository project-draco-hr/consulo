{
  final Change[] changes=e.getData(DataKeys.CHANGES);
  if (changes != null && changes.length > 0) {
    if (ChangesUtil.getChangeListIfOnlyOne(project,changes) == null) {
      return null;
    }
    return changes;
  }
  final VirtualFile[] virtualFiles=e.getData(DataKeys.VIRTUAL_FILE_ARRAY);
  if (virtualFiles != null && virtualFiles.length > 0) {
    List<Change> result=new ArrayList<Change>();
    for (    VirtualFile file : virtualFiles) {
      result.addAll(ChangeListManager.getInstance(project).getChangesIn(file));
    }
    return result.toArray(new Change[result.size()]);
  }
  return null;
}
