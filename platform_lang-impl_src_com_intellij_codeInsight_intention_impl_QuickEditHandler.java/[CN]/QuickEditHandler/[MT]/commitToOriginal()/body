{
  if (!isValid())   return;
  final PsiFile origFile=(PsiFile)myNewFile.getUserData(FileContextUtil.INJECTED_IN_ELEMENT).getElement();
  VirtualFile origFileVirtualFile=origFile != null ? origFile.getVirtualFile() : null;
  myCommittingToOriginal=true;
  try {
    if (origFileVirtualFile == null || !ReadonlyStatusHandler.getInstance(myProject).ensureFilesWritable(origFileVirtualFile).hasReadonlyFiles()) {
      PostprocessReformattingAspect.getInstance(myProject).disablePostprocessFormattingInside(new Runnable(){
        @Override public void run(){
          commitToOriginalInner();
        }
      }
);
    }
  }
  finally {
    myCommittingToOriginal=false;
  }
}
