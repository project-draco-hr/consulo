{
  MavenProject[] rootProjectArray=rootProjects.toArray(new MavenProject[rootProjects.size()]);
  Arrays.sort(rootProjectArray,new Comparator<MavenProject>(){
    @Override public int compare(    MavenProject o1,    MavenProject o2){
      MavenId id1=o1.getMavenId();
      MavenId id2=o2.getMavenId();
      int res=Comparing.compare(id1.getGroupId(),id2.getGroupId());
      if (res != 0)       return res;
      res=Comparing.compare(id1.getArtifactId(),id2.getArtifactId());
      if (res != 0)       return res;
      res=Comparing.compare(id1.getVersion(),id2.getVersion());
      return res;
    }
  }
);
  for (  MavenProject project : rootProjectArray) {
    if (!res.containsKey(project)) {
      res.put(project,deep);
      doBuildProjectTree(manager,res,manager.getModules(project),deep + 1);
    }
  }
}
