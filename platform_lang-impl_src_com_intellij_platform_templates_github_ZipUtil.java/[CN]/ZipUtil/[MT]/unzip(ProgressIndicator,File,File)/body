{
  if (progress != null) {
    progress.setText("Extracting...");
  }
  ZipFile zipFile=new ZipFile(zipArchiveFile);
  try {
    boolean singleTopLevelDir=isSingleTopLevelDir(zipFile.entries());
    for (Enumeration<? extends ZipEntry> e=zipFile.entries(); e.hasMoreElements(); ) {
      ZipEntry zipEntry=e.nextElement();
      unzipEntryToDir(progress,zipFile,zipEntry,extractToDir,singleTopLevelDir);
    }
  }
  finally {
    zipFile.close();
  }
}
