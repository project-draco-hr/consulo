{
  final Ref<HierarchicalArrangementConditionNode> result=new Ref<HierarchicalArrangementConditionNode>();
  node.invite(new ArrangementMatchConditionVisitor(){
    @Override public void visit(    @NotNull ArrangementAtomMatchCondition condition){
      result.set(new HierarchicalArrangementConditionNode(condition));
    }
    @Override public void visit(    @NotNull ArrangementCompositeMatchCondition condition){
      ArrangementMatchCondition typeNode=null;
      for (      ArrangementMatchCondition n : condition.getOperands()) {
        if (n instanceof ArrangementAtomMatchCondition && ((ArrangementAtomMatchCondition)n).getType() == ArrangementSettingType.TYPE) {
          typeNode=n;
          break;
        }
      }
      if (typeNode == null) {
        result.set(new HierarchicalArrangementConditionNode(condition));
      }
 else {
        HierarchicalArrangementConditionNode parent=new HierarchicalArrangementConditionNode(typeNode);
        ArrangementCompositeMatchCondition compositeWithoutType=new ArrangementCompositeMatchCondition(condition.getOperator());
        for (        ArrangementMatchCondition n : condition.getOperands()) {
          if (n != typeNode) {
            compositeWithoutType.addOperand(n);
          }
        }
        if (compositeWithoutType.getOperands().size() == 1) {
          parent.setChild(new HierarchicalArrangementConditionNode(compositeWithoutType.getOperands().iterator().next()));
        }
 else {
          parent.setChild(new HierarchicalArrangementConditionNode(compositeWithoutType));
        }
        result.set(parent);
      }
    }
  }
);
  return result.get();
}
