{
  FileTemplateManager templatesManager=FileTemplateManager.getInstance();
  if (listId == TEMPLATE_ID) {
    FileTemplate[] internals=templatesManager.getInternalTemplates();
    templates=ArrayUtil.mergeArrays(internals,templates,FileTemplate.class);
  }
  ArrayList savedTemplates=new ArrayList();
  for (int i=0; i < templates.length; i++) {
    FileTemplate aTemplate=templates[i];
    FileTemplate aModifiedTemplate=(FileTemplate)savedTemplate2ModifiedTemplate.get(aTemplate);
    if (newModifiedItems.contains(aModifiedTemplate)) {
      savedTemplates.add(aTemplate);
    }
 else {
      removeTemplate(aTemplate,listId,false);
      savedTemplate2ModifiedTemplate.remove(aTemplate);
    }
  }
  for (Iterator iterator=savedTemplates.iterator(); iterator.hasNext(); ) {
    FileTemplate aTemplate=(FileTemplate)iterator.next();
    FileTemplate aModifiedTemplate=(FileTemplate)savedTemplate2ModifiedTemplate.get(aTemplate);
    LOG.assertTrue(aModifiedTemplate != null);
    aTemplate.setAdjust(aModifiedTemplate.isAdjust());
    if (!aModifiedTemplate.isDefault()) {
      FileTemplateUtil.copyTemplate(aModifiedTemplate,aTemplate);
    }
 else {
      if (!aTemplate.isDefault()) {
        removeTemplate(aTemplate,listId,true);
      }
    }
  }
  for (Iterator iterator=newModifiedItems.iterator(); iterator.hasNext(); ) {
    FileTemplate aModifiedTemplate=(FileTemplate)iterator.next();
    LOG.assertTrue(aModifiedTemplate != null);
    if (!savedTemplate2ModifiedTemplate.containsValue(aModifiedTemplate)) {
      if (listId == AllFileTemplatesConfigurable.TEMPLATE_ID) {
        templatesManager.addTemplate(aModifiedTemplate.getName(),aModifiedTemplate.getExtension()).setText(aModifiedTemplate.getText());
      }
 else       if (listId == AllFileTemplatesConfigurable.PATTERN_ID) {
        templatesManager.addPattern(aModifiedTemplate.getName(),aModifiedTemplate.getExtension()).setText(aModifiedTemplate.getText());
      }
 else       if (listId == CODE_ID) {
        templatesManager.addCodeTemplate(aModifiedTemplate.getName(),aModifiedTemplate.getExtension()).setText(aModifiedTemplate.getText());
      }
 else       if (listId == J2EE_ID) {
        templatesManager.addJ2eeTemplate(aModifiedTemplate.getName(),aModifiedTemplate.getExtension()).setText(aModifiedTemplate.getText());
      }
    }
  }
}
