{
  final AntProject project=element.getAntProject();
  final String value=attr.getValue();
  final XmlAttributeValue xmlAttributeValue=attr.getValueElement();
  if (xmlAttributeValue != null) {
    final int offsetInPosition=xmlAttributeValue.getTextRange().getStartOffset() - element.getTextRange().getStartOffset() + 1;
    int startIndex;
    int endIndex=-1;
    while ((startIndex=value.indexOf("${",endIndex + 1)) > endIndex) {
      startIndex+=2;
      endIndex=value.indexOf('}',startIndex);
      if (endIndex < 0)       break;
      if (endIndex >= startIndex) {
        final String propName=value.substring(startIndex,endIndex);
        if (project.isEnvironmentProperty(propName) && AntElementImpl.resolveProperty(element,propName) == null) {
          continue;
        }
        refs.add(new AntPropertyReference(this,element,propName,new TextRange(offsetInPosition + startIndex,offsetInPosition + endIndex),attr));
      }
    }
  }
}
