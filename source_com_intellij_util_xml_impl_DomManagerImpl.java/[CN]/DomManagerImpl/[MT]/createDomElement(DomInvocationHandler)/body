{
synchronized (PsiLock.LOCK) {
    try {
      XmlTag tag=handler.getXmlTag();
      final Class<?> abstractInterface=DomUtil.getRawType(handler.getDomElementType());
      final ClassChooser<? extends DomElement> classChooser=ClassChooserManager.getClassChooser(abstractInterface);
      final Class<? extends DomElement> concreteInterface=classChooser.chooseClass(tag);
      final DomElement element=doCreateDomElement(concreteInterface,handler);
      if (concreteInterface != abstractInterface) {
        handler.setType(concreteInterface);
      }
      handler.setProxy(element);
      handler.attach(tag);
      return element;
    }
 catch (    RuntimeException e) {
      throw e;
    }
catch (    Exception e) {
      throw new CodeGenerationException(e);
    }
  }
}
