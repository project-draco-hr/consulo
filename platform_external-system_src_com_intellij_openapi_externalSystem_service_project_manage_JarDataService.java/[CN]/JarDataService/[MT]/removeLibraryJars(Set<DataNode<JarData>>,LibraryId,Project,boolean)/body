{
  ExternalSystemUtil.executeProjectChangeAction(project,ProjectSystemId.IDE,toRemove,synchronous,new Runnable(){
    @Override public void run(){
      LibraryTable libraryTable=myPlatformFacade.getProjectLibraryTable(project);
      Library library=libraryTable.getLibraryByName(libraryId.getLibraryName());
      if (library == null) {
        return;
      }
      Set<String> pathsToRemove=ContainerUtil.map2Set(toRemove,new Function<DataNode<JarData>,String>(){
        @Override public String fun(        DataNode<JarData> node){
          return node.getData().getPath();
        }
      }
);
      Library.ModifiableModel model=library.getModifiableModel();
      try {
        for (        LibraryPathType gradlePathType : LibraryPathType.values()) {
          OrderRootType idePathType=myLibraryPathTypeMapper.map(gradlePathType);
          for (          VirtualFile file : model.getFiles(idePathType)) {
            if (pathsToRemove.contains(ExternalSystemUtil.getLocalFileSystemPath(file))) {
              model.removeRoot(file.getUrl(),idePathType);
            }
          }
        }
      }
  finally {
        model.commit();
      }
    }
  }
);
}
