{
  if (myTreeIsUpdating || !myUiUpdater.isEmpty()) {
    if (isTextFieldActive() && !StringUtil.isEmpty(myPathTextField.getTextFieldText())) {
      LookupFile toFind=myPathTextField.getFile();
      if (toFind instanceof LocalFsFinder.VfsFile && toFind.exists()) {
        VirtualFile file=((LocalFsFinder.VfsFile)toFind).getFile();
        if (file != null) {
          return new VirtualFile[]{file};
        }
      }
    }
    return VirtualFile.EMPTY_ARRAY;
  }
  final List<VirtualFile> selectedFiles=Arrays.asList(myFileSystemTree.getSelectedFiles());
  return VfsUtilCore.toVirtualFileArray(FileChooserUtil.getChosenFiles(myChooserDescriptor,selectedFiles));
}
