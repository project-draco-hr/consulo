{
  if (myTreeIsUpdating || !myUiUpdater.isEmpty()) {
    if (!isTextFieldActive() || StringUtil.isEmpty(myPathTextField.getTextFieldText()))     return VirtualFile.EMPTY_ARRAY;
    final LocalFsFinder.VfsFile toFind=(LocalFsFinder.VfsFile)myPathTextField.getFile();
    return toFind == null || !toFind.exists() ? VirtualFile.EMPTY_ARRAY : new VirtualFile[]{toFind.getFile()};
  }
  final List<VirtualFile> selectedFiles=Arrays.asList(myFileSystemTree.getSelectedFiles());
  return VfsUtilCore.toVirtualFileArray(FileChooserUtil.getChosenFiles(myChooserDescriptor,selectedFiles));
}
