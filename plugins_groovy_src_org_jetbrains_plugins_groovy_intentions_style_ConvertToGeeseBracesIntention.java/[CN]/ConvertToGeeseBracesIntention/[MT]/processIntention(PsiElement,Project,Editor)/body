{
  IElementType elementType=element.getNode().getElementType();
  if (TokenSets.WHITE_SPACES_SET.contains(elementType)) {
    element=PsiTreeUtil.prevLeaf(element);
  }
  LOG.assertTrue(isClosureRBrace(element) && isClosureContainLF(element));
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  PsiFile file=element.getContainingFile();
  Document document=PsiDocumentManager.getInstance(project).getDocument(file);
  TextRange textRange=findRange(element);
  int startOffset=textRange.getStartOffset();
  int endOffset=textRange.getEndOffset();
  RangeMarker rangeMarker=document.createRangeMarker(textRange);
  String text=document.getText();
  for (int i=endOffset - 1; i >= startOffset; i--) {
    if (text.charAt(i) == '\n')     document.deleteString(i,i + 1);
  }
  CodeStyleManager.getInstance(project).reformatText(file,rangeMarker.getStartOffset(),rangeMarker.getEndOffset());
}
