{
  TextRange range=element.getTextRange();
  if (range.getLength() > 0) {
    final HighlightInfo highlightInfo=HighlightInfo.createHighlightInfo(HighlightInfoType.ERROR,range,element.getErrorDescription());
    if (PsiTreeUtil.getParentOfType(element,XmlTag.class) != null) {
      XmlHighlightVisitor.registerXmlErrorQuickFix(element,highlightInfo);
    }
    return highlightInfo;
  }
  int offset=range.getStartOffset();
  PsiFile containingFile=element.getContainingFile();
  int fileLength=containingFile.getTextLength();
  FileViewProvider viewProvider=containingFile.getViewProvider();
  PsiElement elementAtOffset=viewProvider.findElementAt(offset,viewProvider.getBaseLanguage());
  String text=elementAtOffset == null ? null : elementAtOffset.getText();
  HighlightInfo info;
  if (offset < fileLength && text != null && !StringUtil.startsWithChar(text,'\n') && !StringUtil.startsWithChar(text,'\r')) {
    int start=offset;
    PsiElement prevElement=containingFile.findElementAt(offset - 1);
    if (offset > 0 && prevElement != null && prevElement.getText().equals("(") && StringUtil.startsWithChar(text,')')) {
      start=offset - 1;
    }
    int end=offset + 1;
    info=HighlightInfo.createHighlightInfo(HighlightInfoType.ERROR,start,end,element.getErrorDescription());
    info.navigationShift=offset - start;
  }
 else {
    int start;
    int end;
    if (offset > 0) {
      start=offset - 1;
      end=offset;
    }
 else {
      start=offset;
      end=offset < fileLength ? offset + 1 : offset;
    }
    info=HighlightInfo.createHighlightInfo(HighlightInfoType.ERROR,start,end,element.getErrorDescription());
    info.isAfterEndOfLine=true;
  }
  return info;
}
