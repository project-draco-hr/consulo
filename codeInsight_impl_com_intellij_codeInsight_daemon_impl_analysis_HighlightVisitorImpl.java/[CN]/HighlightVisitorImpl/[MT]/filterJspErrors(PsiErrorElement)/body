{
  PsiElement nextSibling=element.getNextSibling();
  if (nextSibling != null && (nextSibling instanceof PsiErrorElement || (nextSibling.getNode() != null && nextSibling.getNode().getElementType() == TokenType.BAD_CHARACTER))) {
    nextSibling=nextSibling.getNextSibling();
  }
  if (nextSibling == null) {
    final PsiFile containingFile=element.getContainingFile();
    if (PsiUtil.isInJspFile(containingFile)) {
      final JspxFileViewProvider viewProvider=(JspxFileViewProvider)containingFile.getViewProvider();
      nextSibling=viewProvider.findElementAt(element.getTextOffset() + 1,viewProvider.getTemplateDataLanguage());
      if (containingFile.getFileType() == StdFileTypes.JSPX) {
        final ELExpressionHolder expressionHolder=PsiTreeUtil.getParentOfType(nextSibling,ELExpressionHolder.class);
        if (expressionHolder != null) {
          return true;
        }
      }
    }
  }
  while (nextSibling instanceof PsiWhiteSpace) {
    nextSibling=nextSibling.getNextSibling();
  }
  final PsiElement psiElement=nextSibling == null ? null : PsiTreeUtil.findCommonParent(nextSibling,element);
  final boolean nextIsOuterLanguageElement=(nextSibling instanceof OuterLanguageElement || nextSibling instanceof JspExpression || nextSibling instanceof ELExpressionHolder);
  if (nextIsOuterLanguageElement && psiElement != null && !(psiElement instanceof PsiFile)) {
    return true;
  }
  final XmlAttributeValue parentOfType=PsiTreeUtil.getParentOfType(element,XmlAttributeValue.class);
  if (parentOfType != null && parentOfType.getUserData(XmlHighlightVisitor.DO_NOT_VALIDATE_KEY) != null) {
    return true;
  }
  PsiElement prevLeaf=PsiTreeUtil.prevLeaf(element,true);
  while (prevLeaf instanceof PsiWhiteSpace) {
    prevLeaf=prevLeaf.getPrevSibling();
  }
  if (prevLeaf instanceof OuterLanguageElement && prevLeaf.getTextRange().getEndOffset() != element.getContainingFile().getTextLength()) {
    return true;
  }
  return element.getParent().getUserData(XmlHighlightVisitor.DO_NOT_VALIDATE_KEY) != null || (nextIsOuterLanguageElement && prevLeaf == null);
}
