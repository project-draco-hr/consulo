{
  List<DocumentWindow> injected=InjectedLanguageUtil.getCachedInjectedDocuments(hostFile);
  for (  DocumentWindow documentRange : injected) {
    PsiFile file=PsiDocumentManager.getInstance(hostFile.getProject()).getPsiFile(documentRange);
    if (file == null)     continue;
    PsiElement context=file.getContext();
    if (context == null || !context.isValid() || file.getProject().isDisposed()) {
      continue;
    }
    PsiRecursiveElementVisitor visitor=new PsiRecursiveElementVisitor(){
      @Override public void visitElement(      PsiElement element){
        super.visitElement(element);
        for (        PsiReference reference : element.getReferences()) {
          PsiElement resolved=reference.resolve();
          if (resolved instanceof PsiNamedElement) {
            refCountHolder.registerLocallyReferenced((PsiNamedElement)resolved);
          }
        }
      }
    }
;
    file.accept(visitor);
  }
}
