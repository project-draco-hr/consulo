{
  return ApplicationManager.getApplication().runWriteAction(new Computable<ReadonlyStatusHandler.OperationStatus>(){
    public ReadonlyStatusHandler.OperationStatus compute(){
      final List<VirtualFile> filesToSave;
      try {
        filesToSave=getAllStorageFilesToSave(true);
      }
 catch (      IOException e) {
        LOG.error(e);
        return null;
      }
      List<VirtualFile> readonlyFiles=new ArrayList<VirtualFile>();
      for (      VirtualFile file : filesToSave) {
        if (!file.isWritable())         readonlyFiles.add(file);
      }
      if (readonlyFiles.isEmpty())       return new ReadonlyStatusHandler.OperationStatus(VirtualFile.EMPTY_ARRAY,VirtualFile.EMPTY_ARRAY);
      return ReadonlyStatusHandler.getInstance(myProject).ensureFilesWritable(readonlyFiles.toArray(new VirtualFile[readonlyFiles.size()]));
    }
  }
);
}
