{
  final Set<String> usedMacros=new HashSet<String>(Arrays.asList(readUsedMacros(root)));
  usedMacros.removeAll(getDefinedMacros());
  @NonNls final String pathMacroSystemPrefix="path.macro.";
  for (Iterator it=usedMacros.iterator(); it.hasNext(); ) {
    final String macro=(String)it.next();
    final String value=System.getProperty(pathMacroSystemPrefix + macro,null);
    if (value != null) {
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          PathMacrosImpl.getInstanceEx().setMacro(macro,value);
        }
      }
);
      it.remove();
    }
  }
  if (usedMacros.isEmpty()) {
    return true;
  }
  return ProjectManagerImpl.showMacrosConfigurationDialog(project,usedMacros);
}
