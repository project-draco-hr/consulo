{
  if (filePath != null) {
    final IFile iFile=FileSystem.FILE_SYSTEM.createFile(filePath);
    final IFile dir_store=iFile.isDirectory() ? iFile.getChild(Project.DIRECTORY_STORE_FOLDER) : iFile.getParentFile().getChild(Project.DIRECTORY_STORE_FOLDER);
    final StateStorageManager stateStorageManager=getStateStorageManager();
    if (dir_store.exists()) {
      myScheme=StorageScheme.DIRECTORY_BASED;
      stateStorageManager.addMacro(PROJECT_FILE_MACRO,dir_store.getChild("misc.xml").getPath());
      stateStorageManager.addMacro(WS_FILE_MACRO,dir_store.getChild("workspace.xml").getPath());
      stateStorageManager.addMacro(PROJECT_CONFIG_DIR,dir_store.getPath());
    }
 else {
      myScheme=StorageScheme.DEFAULT;
      stateStorageManager.addMacro(PROJECT_FILE_MACRO,filePath);
      int lastDot=filePath.lastIndexOf(".");
      final String filePathWithoutExt=lastDot > 0 ? filePath.substring(0,lastDot) : filePath;
      String workspacePath=filePathWithoutExt + WORKSPACE_EXTENSION;
      stateStorageManager.addMacro(WS_FILE_MACRO,workspacePath);
    }
  }
}
