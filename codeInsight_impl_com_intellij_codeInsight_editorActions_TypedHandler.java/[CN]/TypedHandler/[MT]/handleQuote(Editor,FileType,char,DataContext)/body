{
  if (!CodeInsightSettings.getInstance().AUTOINSERT_PAIR_QUOTE)   return false;
  final QuoteHandler quoteHandler=quoteHandlers.get(fileType);
  if (quoteHandler == null)   return false;
  int offset=editor.getCaretModel().getOffset();
  CharSequence chars=editor.getDocument().getCharsSequence();
  int length=editor.getDocument().getTextLength();
  if (isTypingEscapeQuote(editor,quoteHandler,offset))   return false;
  if (offset < length && chars.charAt(offset) == quote) {
    if (isClosingQuote(editor,quoteHandler,offset)) {
      editor.getCaretModel().moveToOffset(offset + 1);
      editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
      return true;
    }
  }
  HighlighterIterator iterator=((EditorEx)editor).getHighlighter().createIterator(offset);
  if (!iterator.atEnd()) {
    IElementType tokenType=iterator.getTokenType();
    if (fileType == StdFileTypes.JAVA || fileType == StdFileTypes.JSP) {
      if (tokenType instanceof IJavaElementType) {
        if (!TokenTypeEx.WHITE_SPACE_OR_COMMENT_BIT_SET.contains(tokenType) && tokenType != JavaTokenType.SEMICOLON && tokenType != JavaTokenType.COMMA && tokenType != JavaTokenType.RPARENTH && tokenType != JavaTokenType.RBRACKET && tokenType != JavaTokenType.RBRACE && tokenType != JavaTokenType.STRING_LITERAL && tokenType != JavaTokenType.CHARACTER_LITERAL) {
          return false;
        }
      }
    }
  }
  myOriginalHandler.execute(editor,quote,dataContext);
  offset=editor.getCaretModel().getOffset();
  if (isOpeningQuote(editor,quoteHandler,offset - 1) && hasNonClosedLiterals(editor,quoteHandler,offset - 1)) {
    editor.getDocument().insertString(offset,String.valueOf(quote));
  }
  return true;
}
