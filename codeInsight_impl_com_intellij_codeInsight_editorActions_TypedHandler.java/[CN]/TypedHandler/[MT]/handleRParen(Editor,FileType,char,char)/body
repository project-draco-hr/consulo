{
  if (!CodeInsightSettings.getInstance().AUTOINSERT_PAIR_BRACKET)   return false;
  int offset=editor.getCaretModel().getOffset();
  if (offset == editor.getDocument().getTextLength())   return false;
  HighlighterIterator iterator=((EditorEx)editor).getHighlighter().createIterator(offset);
  BraceMatchingUtil.BraceMatcher braceMatcher=BraceMatchingUtil.getBraceMatcher(fileType);
  if (iterator.atEnd() || braceMatcher.getTokenType(rightParen,iterator) != iterator.getTokenType()) {
    return false;
  }
  iterator.retreat();
  int lparenthOffset=BraceMatchingUtil.findLeftmostLParen(iterator,braceMatcher.getTokenType(leftParen,iterator),editor.getDocument().getCharsSequence(),fileType);
  if (lparenthOffset < 0)   return false;
  if (leftParen == '<' && !BraceMatchingUtil.isAfterClassLikeIdentifierOrDot(lparenthOffset,editor))   return false;
  iterator=((EditorEx)editor).getHighlighter().createIterator(lparenthOffset);
  boolean matched=BraceMatchingUtil.matchBrace(editor.getDocument().getCharsSequence(),fileType,iterator,true);
  if (!matched)   return false;
  editor.getCaretModel().moveToOffset(offset + 1);
  editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
  return true;
}
