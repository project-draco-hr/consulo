{
  Project project=(Project)dataContext.getData(DataConstants.PROJECT);
  if (project == null || editor.isColumnMode()) {
    if (myOriginalHandler != null) {
      myOriginalHandler.execute(editor,charTyped,dataContext);
    }
    return;
  }
  final PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
  if (file == null) {
    if (myOriginalHandler != null) {
      myOriginalHandler.execute(editor,charTyped,dataContext);
    }
    return;
  }
  if (editor.isViewer())   return;
  if (!editor.getDocument().isWritable()) {
    if (!FileDocumentManager.fileForDocumentCheckedOutSuccessfully(editor.getDocument(),project)) {
      return;
    }
  }
  AutoPopupController autoPopupController=AutoPopupController.getInstance(project);
  if (charTyped == '.') {
    autoPopupController.autoPopupMemberLookup(InjectedLanguageUtil.getEditorForInjectedLanguage(editor,file));
  }
  if (charTyped == '#') {
    autoPopupController.autoPopupMemberLookup(editor);
  }
  if (charTyped == '@' && file instanceof PsiJavaFile) {
    autoPopupController.autoPopupJavadocLookup(editor);
  }
  final boolean isXmlLikeFile=file.getViewProvider().getBaseLanguage() instanceof XMLLanguage;
  boolean spaceInTag=isXmlLikeFile && charTyped == ' ';
  if (spaceInTag) {
    spaceInTag=false;
    final PsiElement at=file.findElementAt(editor.getCaretModel().getOffset());
    if (at != null) {
      final PsiElement parent=at.getParent();
      if (parent instanceof XmlTag) {
        spaceInTag=true;
      }
    }
  }
  if ((charTyped == '<' || charTyped == '{' || charTyped == '/' || spaceInTag) && isXmlLikeFile) {
    autoPopupController.autoPopupXmlLookup(editor);
  }
  if (charTyped == '(') {
    autoPopupController.autoPopupParameterInfo(editor,null);
  }
  if (!editor.isInsertMode()) {
    myOriginalHandler.execute(editor,charTyped,dataContext);
    return;
  }
  if (editor.getSelectionModel().hasSelection()) {
    EditorModificationUtil.deleteSelectedText(editor);
  }
  final VirtualFile virtualFile=file.getVirtualFile();
  FileType fileType;
  FileType originalFileType=null;
  if (virtualFile != null) {
    originalFileType=fileType=FileTypeManager.getInstance().getFileTypeByFile(virtualFile);
  }
 else {
    fileType=file.getFileType();
  }
  if ('>' == charTyped) {
    if (file instanceof XmlFile) {
      if (handleXmlGreater(project,editor,fileType))       return;
    }
 else     if (file instanceof PsiJavaFile && !(file instanceof JspFile) && CodeInsightSettings.getInstance().AUTOINSERT_PAIR_BRACKET&& ((PsiJavaFile)file).getLanguageLevel().compareTo(LanguageLevel.JDK_1_5) >= 0) {
      if (handleJavaGT(editor))       return;
    }
  }
 else   if (')' == charTyped) {
    if (handleRParen(editor,fileType,')','('))     return;
  }
 else   if (']' == charTyped) {
    if (handleRParen(editor,fileType,']','['))     return;
  }
 else   if (';' == charTyped) {
    if (handleSemicolon(editor,fileType))     return;
  }
 else   if ('"' == charTyped || '\'' == charTyped) {
    if (handleQuote(editor,fileType,charTyped,dataContext))     return;
  }
 else   if ('}' == charTyped) {
    if (originalFileType == StdFileTypes.JSPX || originalFileType == StdFileTypes.JSP) {
      if (handleELClosingBrace(editor,file,project))       return;
    }
 else     if (originalFileType == StdFileTypes.JAVA) {
      if (handleJavaArrayInitializerRBrace(editor))       return;
    }
  }
 else   if ('/' == charTyped) {
    if (file instanceof XmlFile) {
      if (handleXmlSlashInEmptyEnd(project,editor))       return;
    }
  }
  int offsetBefore=editor.getCaretModel().getOffset();
  boolean handleAfterJavaLT='<' == charTyped && file instanceof PsiJavaFile && !(file instanceof JspFile) && CodeInsightSettings.getInstance().AUTOINSERT_PAIR_BRACKET && ((PsiJavaFile)file).getLanguageLevel().compareTo(LanguageLevel.JDK_1_5) >= 0 && BraceMatchingUtil.isAfterClassLikeIdentifierOrDot(offsetBefore,editor);
  myOriginalHandler.execute(editor,charTyped,dataContext);
  if (handleAfterJavaLT) {
    handleAfterJavaLT(editor);
  }
 else   if ('(' == charTyped && CodeInsightSettings.getInstance().AUTOINSERT_PAIR_BRACKET) {
    handleAfterLParen(editor,fileType,'(');
  }
 else   if ('[' == charTyped && CodeInsightSettings.getInstance().AUTOINSERT_PAIR_BRACKET) {
    handleAfterLParen(editor,fileType,'[');
  }
 else   if ('}' == charTyped) {
    indentClosingBrace(project,editor);
  }
 else   if ('{' == charTyped) {
    if (originalFileType == StdFileTypes.JSPX || originalFileType == StdFileTypes.JSP) {
      if (handleELOpeningBrace(editor,file,project))       return;
    }
 else     if (originalFileType == StdFileTypes.JAVA) {
      if (handleJavaArrayInitializerLBrace(editor))       return;
    }
    indentOpenedBrace(project,editor);
  }
 else   if ('/' == charTyped) {
    if (file instanceof XmlFile) {
      handleXmlSlash(project,editor);
    }
  }
 else   if ('=' == charTyped) {
    if (originalFileType == StdFileTypes.JSP) {
      handleJspEqual(project,editor);
    }
  }
}
