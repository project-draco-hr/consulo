{
  final RunContentDescriptor reuseContent=ExecutionManager.getInstance(project).getContentManager().getReuseContent(executor,env.getContentToReuse());
  final RunProfile profile=env.getRunProfile();
  project.getMessageBus().syncPublisher(EXECUTION_TOPIC).processStartScheduled(executor.getId(),env);
  Runnable startRunnable=new Runnable(){
    public void run(){
      boolean started=false;
      try {
        if (project.isDisposed())         return;
        project.getMessageBus().syncPublisher(EXECUTION_TOPIC).processStarting(executor.getId(),env);
        final RunContentDescriptor descriptor=starter.execute(project,executor,state,reuseContent,env);
        if (descriptor != null) {
          ExecutionManager.getInstance(project).getContentManager().showRunContent(executor,descriptor);
          final ProcessHandler processHandler=descriptor.getProcessHandler();
          if (processHandler != null) {
            processHandler.startNotify();
            project.getMessageBus().syncPublisher(EXECUTION_TOPIC).processStarted(executor.getId(),env,processHandler);
            started=true;
            processHandler.addProcessListener(new ProcessExecutionListener(project,profile,processHandler));
          }
        }
      }
 catch (      ExecutionException e) {
        ExecutionUtil.handleExecutionError(project,executor.getToolWindowId(),profile,e);
      }
 finally {
        if (!started) {
          project.getMessageBus().syncPublisher(EXECUTION_TOPIC).processNotStarted(executor.getId(),env);
        }
      }
    }
  }
;
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    startRunnable.run();
  }
 else {
    compileAndRun(startRunnable,profile,state,new Runnable(){
      public void run(){
        if (!project.isDisposed()) {
          project.getMessageBus().syncPublisher(EXECUTION_TOPIC).processNotStarted(executor.getId(),env);
        }
      }
    }
);
  }
}
