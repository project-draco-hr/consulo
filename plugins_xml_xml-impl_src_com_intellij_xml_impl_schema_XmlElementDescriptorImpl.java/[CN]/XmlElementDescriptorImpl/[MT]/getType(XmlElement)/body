{
  final XmlNSDescriptor nsDescriptor=getNSDescriptor(context);
  if (!(nsDescriptor instanceof XmlNSTypeDescriptorProvider))   return null;
  TypeDescriptor type=((XmlNSTypeDescriptorProvider)nsDescriptor).getTypeDescriptor(myDescriptorTag);
  if (type == null) {
    String substAttr=myDescriptorTag.getAttributeValue("substitutionGroup");
    if (substAttr != null) {
      final String namespacePrefix=XmlUtil.findPrefixByQualifiedName(substAttr);
      final String namespace="".equals(namespacePrefix) ? ((XmlNSDescriptorImpl)getNSDescriptor()).getDefaultNamespace() : myDescriptorTag.getNamespaceByPrefix(namespacePrefix);
      final String local=XmlUtil.findLocalNameByQualifiedName(substAttr);
      final XmlElementDescriptorImpl originalElement=(XmlElementDescriptorImpl)((XmlNSDescriptorImpl)getNSDescriptor()).getElementDescriptor(local,namespace);
      if (originalElement != null) {
        type=originalElement.getType(context);
      }
    }
  }
  return type;
}
