{
  Project project=getProject(e);
  if (project == null)   return;
  OpenTaskDialog dialog=new OpenTaskDialog(project);
  dialog.show();
  if (dialog.isOK()) {
    Task task=dialog.getSelectedTask();
    if (task != null) {
      TaskRepository repository=task.getRepository();
      if (dialog.isMarkAsInProgress() && repository != null) {
        try {
          repository.setTaskState(task,TaskState.IN_PROGRESS);
        }
 catch (        Exception ex) {
          Messages.showErrorDialog(project,"Could not set state for " + task.getId(),"Error");
          LOG.warn(ex);
        }
      }
      TaskManager.getManager(project).activateTask(task,dialog.isClearContext(),dialog.isCreateChangelist());
      if (task.getType() == TaskType.EXCEPTION && AnalyzeTaskStacktraceAction.hasTexts(task)) {
        AnalyzeTaskStacktraceAction.analyzeStacktrace(task,project);
      }
    }
  }
}
