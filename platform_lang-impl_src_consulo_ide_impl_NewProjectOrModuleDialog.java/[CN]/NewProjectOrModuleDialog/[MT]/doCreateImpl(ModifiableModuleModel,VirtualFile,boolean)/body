{
  String name=StringUtil.notNullize(getNameText(),baseDir.getName());
  Module newModule=modifiableModel.newModule(name,baseDir.getPath());
  ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(newModule);
  ModifiableRootModel modifiableModelForModule=moduleRootManager.getModifiableModel();
  ContentEntry contentEntry=modifiableModelForModule.addContentEntry(baseDir);
  if (!isModuleCreation()) {
    contentEntry.addFolder(contentEntry.getUrl() + "/" + Project.DIRECTORY_STORE_FOLDER,ExcludedContentFolderTypeProvider.getInstance());
  }
  if (myProcessor != null) {
    myProcessor.setupModule(myConfigurationPanel,contentEntry,modifiableModelForModule);
  }
  modifiableModelForModule.commit();
  if (requireModelCommit) {
    modifiableModel.commit();
  }
  baseDir.refresh(true,true);
  return newModule;
}
