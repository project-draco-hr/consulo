{
  PsiUtil.checkIsIdentifier(myManager,name);
  if (PsiType.NULL.equals(type)) {
    throw new IncorrectOperationException("Cannot create field with type \"<null_type>\".");
  }
  final FileElement treeHolder=DummyHolderFactory.createHolder(myManager,null).getTreeElement();
  final String text=type.getCanonicalText() + " " + name;
  final CompositeElement treeElement=getJavaParsingContext(treeHolder).getDeclarationParsing().parseParameterText(text);
  if (treeElement == null) {
    throw new AssertionError("Null element for text = " + text);
  }
  treeHolder.rawAddChildren(treeElement);
  CodeStyleManager codeStyleManager=CodeStyleManager.getInstance(myManager.getProject());
  PsiParameter parameter=(PsiParameter)SourceTreeToPsiMap.treeElementToPsi(treeElement);
  PsiUtil.setModifierProperty(parameter,PsiModifier.FINAL,CodeStyleSettingsManager.getSettings(myManager.getProject()).GENERATE_FINAL_PARAMETERS);
  treeElement.acceptTree(new GeneratedMarkerVisitor());
  JavaCodeStyleManager.getInstance(myManager.getProject()).shortenClassReferences(parameter);
  return (PsiParameter)codeStyleManager.reformat(parameter);
}
