{
  Socket clientSocket;
  try {
    clientSocket=serverSocket.accept();
    System.out.println("SnapShooter connection accepted");
    final Charset utf8Charset=Charset.forName("UTF-8");
    InputStreamReader reader=new InputStreamReader(clientSocket.getInputStream(),utf8Charset);
    BufferedReader bufferedReader=new BufferedReader(reader);
    OutputStreamWriter writer=new OutputStreamWriter(clientSocket.getOutputStream(),utf8Charset);
    while (true) {
      String command;
      try {
        command=bufferedReader.readLine();
      }
 catch (      IOException ex) {
        break;
      }
      if (command == null) {
        System.out.println("End of stream receiving command");
        break;
      }
      processCommand(command,writer);
    }
  }
 catch (  IOException ex) {
    System.out.println("Exception in SnapShooter connection: " + ex);
  }
}
