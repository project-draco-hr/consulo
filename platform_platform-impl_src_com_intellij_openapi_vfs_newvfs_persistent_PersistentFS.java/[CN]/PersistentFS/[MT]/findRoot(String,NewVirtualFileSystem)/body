{
synchronized (LOCK) {
    final String rootUrl=fs.getProtocol() + "://" + basePath;
    NewVirtualFile root=myRoots.get(rootUrl);
    if (root == null && basePath.length() == 0) {
      root=myFakeRoot;
    }
    if (root == null) {
      try {
        final int rootId=FSRecords.findRootRecord(rootUrl);
        if (basePath.length() > 0) {
          root=new VirtualDirectoryImpl(basePath,null,fs,rootId);
        }
 else {
          root=new VirtualDirectoryImpl(basePath,null,fs,rootId){
            @NotNull public VirtualFile[] getChildren(){
              return getRoots(fs);
            }
          }
;
        }
        if (!fs.exists(root))         return null;
        copyRecordFromDelegateFS(rootId,0,root,fs);
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
      if (basePath.length() > 0) {
        myRoots.put(rootUrl,root);
      }
 else {
        myFakeRoot=root;
      }
    }
    return root;
  }
}
