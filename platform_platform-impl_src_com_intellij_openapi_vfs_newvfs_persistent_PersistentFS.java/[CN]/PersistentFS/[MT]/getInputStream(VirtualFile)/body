{
synchronized (INPUT_LOCK) {
    InputStream contentStream;
    if (mustReloadContent(file) || (contentStream=readContent(file)) == null) {
      final NewVirtualFileSystem delegate=getDelegate(file);
      final long len=delegate.getLength(file);
      FSRecords.setLength(getFileId(file),len);
      final InputStream nativeStream=delegate.getInputStream(file);
      if (len > PersistentFSConstants.FILE_LENGTH_TO_CACHE_THRESHOLD)       return nativeStream;
      return createReplicator(file,nativeStream,len,delegate.isReadOnly());
    }
 else {
      return contentStream;
    }
  }
}
