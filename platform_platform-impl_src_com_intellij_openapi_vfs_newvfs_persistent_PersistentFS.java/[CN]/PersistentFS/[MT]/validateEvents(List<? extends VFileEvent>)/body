{
  List<VFileEvent> filtered=new ArrayList<VFileEvent>(events.size());
  List<VFileDeleteEvent> deletionList=new ArrayList<VFileDeleteEvent>();
  for (  VFileEvent event : events) {
    if (event.isValid()) {
      if (event instanceof VFileDeleteEvent) {
        deletionList.add((VFileDeleteEvent)event);
      }
 else {
        filtered.add(event);
      }
    }
  }
  ContainerUtil.quickSort(deletionList,DEPTH_COMPARATOR);
  List<VirtualFile> filesToBeDeleted=new ArrayList<VirtualFile>();
  for (  VFileDeleteEvent event : deletionList) {
    boolean ok=true;
    VirtualFile candidate=event.getFile();
    for (    VirtualFile file : filesToBeDeleted) {
      if (VfsUtil.isAncestor(file,candidate,false)) {
        ok=false;
        break;
      }
    }
    if (ok) {
      filtered.add(event);
      if (candidate.isDirectory()) {
        filesToBeDeleted.add(candidate);
      }
    }
  }
  return filtered;
}
