{
  final NewVirtualFileSystem delegate=getDelegate(parent);
  VirtualFile fake=new FakeVirtualFile(parent,name);
  int attributes=delegate.getBooleanAttributes(fake,NewVirtualFileSystem.BA_EXISTS | NewVirtualFileSystem.BA_DIRECTORY);
  if ((attributes & NewVirtualFileSystem.BA_EXISTS) != 0) {
    final int parentId=getFileId(parent);
    boolean isDir=(attributes & NewVirtualFileSystem.BA_DIRECTORY) != 0;
    int childId=createAndCopyRecord(delegate,fake,parentId,isDir);
    appendIdToParentList(parentId,childId);
    final VirtualDirectoryImpl dir=(VirtualDirectoryImpl)parent;
    dir.addChild(dir.createChild(name,childId));
  }
}
