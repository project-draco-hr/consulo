{
  final ByteArrayOutputStream cache=new ByteArrayOutputStream((int)len);
  return new ReplicatorInputStream(nativeStream,cache){
    public void close() throws IOException {
      super.close();
synchronized (INPUT_LOCK) {
        if (getBytesRead() == len) {
          DataOutputStream sink=writeContent(file);
          try {
            FileUtil.copy(new ByteArrayInputStream(cache.toByteArray()),sink);
          }
  finally {
            sink.close();
          }
          myRecords.setLength(getFileId(file),len);
          setFlag(file,MUST_RELOAD_CONTENT,false);
        }
 else {
          setFlag(file,MUST_RELOAD_CONTENT,true);
        }
      }
    }
  }
;
}
