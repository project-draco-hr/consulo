{
  final PsiModifierList modifierList=listOwner.getModifierList();
  if (modifierList == null) {
    return PsiAnnotation.EMPTY_ARRAY;
  }
  if (!inHierarchy) {
    return modifierList.getAnnotations();
  }
  final Set<PsiAnnotation> all=new HashSet<PsiAnnotation>(){
    public boolean add(    PsiAnnotation o){
      return !contains(o) && super.add(o);
    }
  }
;
  if (listOwner instanceof PsiMethod) {
    ContainerUtil.addAll(all,modifierList.getAnnotations());
    SuperMethodsSearch.search((PsiMethod)listOwner,null,true,true).forEach(new Processor<MethodSignatureBackedByPsiMethod>(){
      public boolean process(      final MethodSignatureBackedByPsiMethod superMethod){
        ContainerUtil.addAll(all,superMethod.getMethod().getModifierList().getAnnotations());
        return true;
      }
    }
);
    return all.toArray(new PsiAnnotation[all.size()]);
  }
  if (listOwner instanceof PsiParameter) {
    PsiParameter parameter=(PsiParameter)listOwner;
    PsiElement declarationScope=parameter.getDeclarationScope();
    PsiParameterList parameterList;
    if (declarationScope instanceof PsiMethod && parameter.getParent() == (parameterList=((PsiMethod)declarationScope).getParameterList())) {
      PsiMethod method=(PsiMethod)declarationScope;
      final int parameterIndex=parameterList.getParameterIndex(parameter);
      ContainerUtil.addAll(all,modifierList.getAnnotations());
      SuperMethodsSearch.search(method,null,true,true).forEach(new Processor<MethodSignatureBackedByPsiMethod>(){
        public boolean process(        final MethodSignatureBackedByPsiMethod superMethod){
          PsiParameter superParameter=superMethod.getMethod().getParameterList().getParameters()[parameterIndex];
          PsiModifierList modifierList=superParameter.getModifierList();
          if (modifierList != null) {
            ContainerUtil.addAll(all,modifierList.getAnnotations());
          }
          return true;
        }
      }
);
      return all.toArray(new PsiAnnotation[all.size()]);
    }
  }
  return modifierList.getAnnotations();
}
