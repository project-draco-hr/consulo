{
  final Map<TemplateContextType,JCheckBox> contextComboBoxes=new HashMap<TemplateContextType,JCheckBox>();
  ChangeListener listener=new ChangeListener(){
    public void stateChanged(    ChangeEvent e){
      myExpandByCombo.setEnabled(isExpandableFromEditor());
    }
  }
;
  JPanel panel=new JPanel(new GridBagLayout());
  GridBagConstraints gbConstraints=new GridBagConstraints();
  gbConstraints.fill=GridBagConstraints.BOTH;
  gbConstraints.weightx=1;
  gbConstraints.weighty=1;
  final Runnable updateContextTypesEnabledState=new Runnable(){
    public void run(){
      for (      Map.Entry<TemplateContextType,JCheckBox> entry : contextComboBoxes.entrySet()) {
        TemplateContextType contextType=entry.getKey();
        TemplateContextType baseContextType=contextType.getBaseContextType();
        boolean enabled=baseContextType == null || !contextComboBoxes.get(baseContextType).isSelected();
        entry.getValue().setEnabled(enabled);
      }
    }
  }
;
  int row=0;
  int col=0;
  for (  final TemplateContextType contextType : myContext.keySet()) {
    gbConstraints.gridy=row;
    gbConstraints.gridx=col;
    final JCheckBox cb=new JCheckBox(contextType.getPresentableName());
    cb.getModel().addChangeListener(listener);
    panel.add(cb,gbConstraints);
    contextComboBoxes.put(contextType,cb);
    if (row == (myContext.size() + 1) / 2 - 1) {
      row=0;
      col=1;
    }
 else {
      row++;
    }
    cb.setSelected(myContext.get(contextType).booleanValue());
    cb.addActionListener(new ActionListener(){
      public void actionPerformed(      ActionEvent e){
        myContext.put(contextType,cb.isSelected());
        updateContextTypesEnabledState.run();
        updateHighlighter();
        onChange.run();
      }
    }
);
  }
  updateContextTypesEnabledState.run();
  new MnemonicHelper().register(panel);
  return panel;
}
