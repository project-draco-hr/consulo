{
  JPanel panel=new JPanel(new BorderLayout());
  final JLabel ctxLabel=new JLabel();
  final JLabel change=new JLabel();
  change.setForeground(Color.BLUE);
  change.setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
  panel.add(ctxLabel,BorderLayout.CENTER);
  panel.add(change,BorderLayout.EAST);
  final Runnable updateLabel=new Runnable(){
    public void run(){
      StringBuilder sb=new StringBuilder();
      String oldPrefix="";
      for (      TemplateContextType type : myContext.keySet()) {
        if (myContext.get(type).booleanValue()) {
          final TemplateContextType base=type.getBaseContextType();
          String ownName=UIUtil.removeMnemonic(type.getPresentableName());
          String prefix="";
          if (base != null && !(base instanceof EverywhereContextType)) {
            prefix=UIUtil.removeMnemonic(base.getPresentableName()) + ": ";
            ownName=StringUtil.decapitalize(ownName);
          }
          if (sb.length() > 0) {
            sb.append(oldPrefix.equals(prefix) ? ", " : "; ");
          }
          if (!oldPrefix.equals(prefix)) {
            sb.append(prefix);
            oldPrefix=prefix;
          }
          sb.append(ownName);
        }
      }
      final boolean noContexts=sb.length() == 0;
      ctxLabel.setText((noContexts ? "No applicable contexts yet" : "Applicable in " + sb.toString()) + ".  ");
      ctxLabel.setForeground(noContexts ? Color.GRAY : UIUtil.getLabelForeground());
      change.setText(noContexts ? "Define" : "Change");
    }
  }
;
  change.addMouseListener(new MouseAdapter(){
    @Override public void mouseClicked(    MouseEvent e){
      if (disposeContextPopup())       return;
      JPanel content=createPopupContextPanel(updateLabel);
      myContextPopup=JBPopupFactory.getInstance().createComponentPopupBuilder(content,null).setResizable(true).createPopup();
      myContextPopup.show(new RelativePoint(change,new Point(change.getWidth(),-content.getPreferredSize().height - 10)));
    }
  }
);
  updateLabel.run();
  return panel;
}
