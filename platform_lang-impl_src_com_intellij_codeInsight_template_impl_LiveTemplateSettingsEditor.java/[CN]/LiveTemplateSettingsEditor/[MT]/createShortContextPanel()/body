{
  JPanel panel=new JPanel(new BorderLayout());
  final HyperlinkLabel change=new HyperlinkLabel();
  panel.add(change,BorderLayout.WEST);
  final Runnable updateLabel=new Runnable(){
    public void run(){
      List<String> contexts=new ArrayList<String>();
      for (      TemplateContextType type : myContext.keySet()) {
        if (myContext.get(type).booleanValue()) {
          contexts.add(UIUtil.removeMnemonic(type.getPresentableName()));
        }
      }
      change.setHyperlinkText((contexts.isEmpty() ? "No applicable contexts yet" : "Applicable in " + StringUtil.join(contexts,", ")) + ".  ","Change","");
    }
  }
;
  change.addHyperlinkListener(new HyperlinkListener(){
    private JBPopup myPopup;
    @Override public void hyperlinkUpdate(    HyperlinkEvent e){
      if (myPopup != null && !myPopup.isDisposed()) {
        myPopup.cancel();
        myPopup=null;
        return;
      }
      myPopup=JBPopupFactory.getInstance().createComponentPopupBuilder(createPopupContextPanel(updateLabel),null).createPopup();
      myPopup.showUnderneathOf(change);
    }
  }
);
  updateLabel.run();
  return panel;
}
