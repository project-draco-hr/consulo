{
  Set<String> startNodes=new HashSet<String>();
  FragmentManager fragmentManager=middleGraph.getFragmentManager();
  fragmentManager.showAll();
  startNodes.add("a0");
  setVisibleBranches(middleGraph,startNodes);
  fragmentManager.changeVisibility(getRelateFragment(middleGraph,0));
  assertEquals("hide long branch","a0|-|-a0:a9:HIDE_FRAGMENT:a0|-COMMIT_NODE|-a0|-0\n" + "a9|-a0:a9:HIDE_FRAGMENT:a0|-|-COMMIT_NODE|-a0|-1",toStr(middleGraph.getGraph()));
  startNodes.clear();
  startNodes.add("a3");
  runTestGraphBranchesVisibility(middleGraph,startNodes,"a3|-|-a3:a4:USUAL:a3|-COMMIT_NODE|-a3|-0\n" + "a4|-a3:a4:USUAL:a3|-a4:a5:USUAL:a3|-COMMIT_NODE|-a3|-1\n" + "a5|-a4:a5:USUAL:a3|-a5:a6:USUAL:a3|-COMMIT_NODE|-a3|-2\n"+ "a6|-a5:a6:USUAL:a3|-a6:a7:USUAL:a0|-COMMIT_NODE|-a0|-3\n"+ "a7|-a6:a7:USUAL:a0|-a7:a8:USUAL:a0|-COMMIT_NODE|-a0|-4\n"+ "a8|-a7:a8:USUAL:a0|-a8:a9:USUAL:a0|-COMMIT_NODE|-a0|-5\n"+ "a9|-a8:a9:USUAL:a0|-|-COMMIT_NODE|-a0|-6");
  fragmentManager.changeVisibility(getRelateFragment(middleGraph,0));
  startNodes.add("a0");
  runTestGraphBranchesVisibility(middleGraph,startNodes,"a0|-|-a0:a1:USUAL:a0|-COMMIT_NODE|-a0|-0\n" + "a1|-a0:a1:USUAL:a0|-a1:a2:USUAL:a0|-COMMIT_NODE|-a0|-1\n" + "a2|-a1:a2:USUAL:a0|-a2:a6:USUAL:a0|-COMMIT_NODE|-a0|-2\n"+ "a3|-|-a3:a4:USUAL:a3|-COMMIT_NODE|-a3|-3\n"+ "a4|-a3:a4:USUAL:a3|-a4:a5:USUAL:a3|-COMMIT_NODE|-a3|-4\n"+ "a5|-a4:a5:USUAL:a3|-a5:a6:USUAL:a3|-COMMIT_NODE|-a3|-5\n"+ "a6|-a2:a6:USUAL:a0 a5:a6:USUAL:a3|-a6:a7:USUAL:a0|-COMMIT_NODE|-a0|-6\n"+ "a7|-a6:a7:USUAL:a0|-a7:a8:USUAL:a0|-COMMIT_NODE|-a0|-7\n"+ "a8|-a7:a8:USUAL:a0|-a8:a9:USUAL:a0|-COMMIT_NODE|-a0|-8\n"+ "a9|-a8:a9:USUAL:a0|-|-COMMIT_NODE|-a0|-9");
  fragmentManager.showAll();
}
