{
  myChangeList=new ChangeList(new ChangeListStorageImpl(getStorageDir()));
  myVcs=new LocalHistoryFacade(myChangeList);
  myGateway=new IdeaGateway();
  myEventDispatcher=new LocalHistoryEventDispatcher(myVcs,myGateway);
  CommandProcessor.getInstance().addCommandListener(myEventDispatcher);
  VirtualFileManager fm=VirtualFileManagerEx.getInstance();
  fm.addVirtualFileListener(myEventDispatcher);
  fm.addVirtualFileManagerListener(myEventDispatcher);
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    @Override public void run(){
      validateStorage();
    }
  }
);
}
