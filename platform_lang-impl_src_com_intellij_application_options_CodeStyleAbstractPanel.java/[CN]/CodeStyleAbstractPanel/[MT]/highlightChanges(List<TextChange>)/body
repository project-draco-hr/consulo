{
  if (mySkipPreviewHighlighting) {
    return;
  }
  myPreviewRangesToHighlight.clear();
  MarkupModel markupModel=myEditor.getMarkupModel();
  markupModel.removeAllHighlighters();
  int textLength=myEditor.getDocument().getTextLength();
  boolean highlightPreview=false;
  for (  TextRange range : myDiffCalculator.calculateDiff(changesBeforeReformat,myChangesCollector.getChanges())) {
    if (range.getStartOffset() >= textLength) {
      continue;
    }
    highlightPreview=true;
    TextRange rangeToUse=calculateChangeHighlightRange(range);
    myPreviewRangesToHighlight.add(rangeToUse);
  }
  if (highlightPreview) {
    myEndHighlightPreviewChangesTimeMillis=System.currentTimeMillis() + TIME_TO_HIGHLIGHT_PREVIEW_CHANGES_IN_MILLIS;
    myShowsPreviewHighlighters=true;
  }
}
