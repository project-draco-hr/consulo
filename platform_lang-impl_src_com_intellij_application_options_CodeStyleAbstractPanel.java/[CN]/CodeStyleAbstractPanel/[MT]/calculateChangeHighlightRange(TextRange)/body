{
  CharSequence text=myEditor.getDocument().getCharsSequence();
  if (range.getLength() <= 0) {
    int offset=range.getStartOffset();
    while (offset < text.length() && text.charAt(offset) == ' ') {
      offset++;
    }
    return offset > range.getStartOffset() ? new TextRange(offset,offset) : range;
  }
  int startOffset=range.getStartOffset() + 1;
  int endOffset=range.getEndOffset() + 1;
  boolean useSameRange=true;
  while (endOffset <= text.length() && StringUtil.equals(text.subSequence(range.getStartOffset(),range.getEndOffset()),text.subSequence(startOffset,endOffset))) {
    useSameRange=false;
    startOffset++;
    endOffset++;
  }
  startOffset--;
  endOffset--;
  return useSameRange ? range : new TextRange(startOffset,endOffset);
}
