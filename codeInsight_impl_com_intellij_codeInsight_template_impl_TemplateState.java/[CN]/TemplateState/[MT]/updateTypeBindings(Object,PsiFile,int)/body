{
  PsiClass aClass=null;
  if (item instanceof PsiClass) {
    aClass=(PsiClass)item;
  }
 else   if (item instanceof PsiType) {
    aClass=PsiUtil.resolveClassInType(((PsiType)item));
  }
  if (aClass != null) {
    if (aClass instanceof PsiTypeParameter) {
      if (((PsiTypeParameter)aClass).getOwner() instanceof PsiMethod) {
        PsiElement element=file.findElementAt(mySegments.getSegmentStart(segmentNumber));
        PsiMethod method=PsiTreeUtil.getParentOfType(element,PsiMethod.class);
        if (method != null) {
          PsiTypeParameterList paramList=method.getTypeParameterList();
          PsiTypeParameter[] params=paramList.getTypeParameters();
          for (          PsiTypeParameter param : params) {
            if (param.getName().equals(aClass.getName()))             return;
          }
          try {
            paramList.add(aClass.copy());
            unblockDocument();
          }
 catch (          IncorrectOperationException e) {
            LOG.error(e);
          }
        }
      }
    }
 else {
      addImportForClass(aClass,segmentNumber);
      unblockDocument();
    }
  }
}
