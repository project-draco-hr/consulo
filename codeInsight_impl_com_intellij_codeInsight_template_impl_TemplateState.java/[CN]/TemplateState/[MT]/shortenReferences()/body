{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      final PsiFile file=PsiDocumentManager.getInstance(myProject).getPsiFile(myDocument);
      if (file != null) {
        CodeStyleManager codeStyleManager=CodeStyleManager.getInstance(myProject);
        if (myTemplate.isToShortenLongNames()) {
          try {
            IntArrayList indices=initEmptyVariables();
            mySegments.setSegmentsGreedy(false);
            PsiDocumentManager.getInstance(myProject).commitDocument(myDocument);
            codeStyleManager.shortenClassReferences(file,myTemplateRange.getStartOffset(),myTemplateRange.getEndOffset());
            PsiDocumentManager.getInstance(myProject).doPostponedOperationsAndUnblockDocument(myDocument);
            mySegments.setSegmentsGreedy(true);
            restoreEmptyVariables(indices);
          }
 catch (          IncorrectOperationException e) {
            LOG.error(e);
          }
        }
      }
    }
  }
);
}
