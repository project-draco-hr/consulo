{
  final CompletionVariant[] variants=findVariants(position,file);
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      boolean hasApplicableVariants=false;
      for (      CompletionVariant variant : variants) {
        if (variant.hasReferenceFilter()) {
          if (LegacyCompletionContributor.DEBUG) {
            System.out.println("CompletionData.run");
            System.out.println("variant = " + variant);
          }
          variant.addReferenceCompletions(reference,position,set,matcher,file,CompletionData.this);
          hasApplicableVariants=true;
        }
      }
      if (!hasApplicableVariants) {
        myGenericVariant.addReferenceCompletions(reference,position,set,matcher,file,CompletionData.this);
      }
    }
  }
);
}
