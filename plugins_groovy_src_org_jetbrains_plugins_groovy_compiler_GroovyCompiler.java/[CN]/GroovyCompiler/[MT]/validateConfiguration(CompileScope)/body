{
  VirtualFile[] files=compileScope.getFiles(GroovyFileType.GROOVY_FILE_TYPE,true);
  if (files.length == 0)   return true;
  Set<Module> modules=new HashSet<Module>();
  for (  VirtualFile file : files) {
    ProjectRootManager rootManager=ProjectRootManager.getInstance(myProject);
    Module module=rootManager.getFileIndex().getModuleForFile(file);
    if (module != null) {
      modules.add(module);
    }
  }
  for (  Module module : modules) {
    final String groovyInstallPath=GroovyConfigUtils.getInstance().getSDKInstallPath(module);
    final String grailsInstallPath=GrailsConfigUtils.getInstance().getSDKInstallPath(module);
    if (groovyInstallPath.length() == 0 && (grailsInstallPath == null || grailsInstallPath.length() == 0)) {
      if (!GroovyConfigUtils.getInstance().tryToSetUpGroovyFacetOntheFly(module)) {
        Messages.showErrorDialog(myProject,GroovyBundle.message("cannot.compile.groovy.files.no.facet",module.getName()),GroovyBundle.message("cannot.compile"));
        int result=Messages.showOkCancelDialog(GroovyBundle.message("groovy.configure.facet.question.text"),GroovyBundle.message("groovy.configure.facet.question"),GroovyIcons.GROOVY_ICON_32x32);
        if (result == 0) {
          ModulesConfigurator.showDialog(module.getProject(),module.getName(),ClasspathEditor.NAME,false);
        }
      }
      return false;
    }
  }
  Set<Module> nojdkModules=new HashSet<Module>();
  for (  Module module : compileScope.getAffectedModules()) {
    final Sdk sdk=ModuleRootManager.getInstance(module).getSdk();
    if (sdk == null || !(sdk.getSdkType() instanceof JavaSdkType))     nojdkModules.add(module);
  }
  if (!nojdkModules.isEmpty()) {
    final Module[] noJdkArray=nojdkModules.toArray(new Module[nojdkModules.size()]);
    if (noJdkArray.length == 1) {
      Messages.showErrorDialog(myProject,GroovyBundle.message("cannot.compile.groovy.files.no.sdk",noJdkArray[0].getName()),GroovyBundle.message("cannot.compile"));
    }
 else {
      StringBuffer modulesList=new StringBuffer();
      for (int i=0; i < noJdkArray.length; i++) {
        if (i > 0)         modulesList.append(", ");
        modulesList.append(noJdkArray[i].getName());
      }
      Messages.showErrorDialog(myProject,GroovyBundle.message("cannot.compile.groovy.files.no.sdk.mult",modulesList.toString()),GroovyBundle.message("cannot.compile"));
    }
    return false;
  }
  return true;
}
