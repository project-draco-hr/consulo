{
  ProgressIndicator progressIndicator=ProgressManager.getInstance().getProgressIndicator();
  if (progressIndicator != null) {
    setSynchronizingFilesTextToProgress(progressIndicator);
  }
  final Semaphore semaphore=new Semaphore();
  semaphore.down();
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      LOG.info("refreshFilesAsync, modalityState=" + ModalityState.current());
      refreshFilesAsync(new Runnable(){
        public void run(){
          semaphore.up();
        }
      }
);
    }
  }
);
  semaphore.waitFor();
}
