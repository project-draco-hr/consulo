{
  final File workingDir;
  try {
    workingDir=FileUtil.createTempDirectory("archetype","tmp");
    workingDir.deleteOnExit();
  }
 catch (  IOException e) {
    showError(project,e);
    return;
  }
  MavenRunnerParameters params=new MavenRunnerParameters(false,workingDir.getPath(),Collections.singletonList("org.apache.maven.plugins:maven-archetype-plugin:RELEASE:generate"),null);
  MavenRunner runner=MavenRunner.getInstance(project);
  MavenRunnerSettings settings=runner.getState().clone();
  Map<String,String> props=settings.getMavenProperties();
  props.put("interactiveMode","false");
  props.put("archetypeGroupId",myArchetype.groupId);
  props.put("archetypeArtifactId",myArchetype.artifactId);
  props.put("archetypeVersion",myArchetype.version);
  if (myArchetype.repository != null)   props.put("archetypeRepository",myArchetype.repository);
  props.put("groupId",myProjectId.getGroupId());
  props.put("artifactId",myProjectId.getArtifactId());
  props.put("version",myProjectId.getVersion());
  runner.run(params,settings,new Runnable(){
    public void run(){
      copyGeneratedFiles(workingDir,pom,project);
    }
  }
);
}
