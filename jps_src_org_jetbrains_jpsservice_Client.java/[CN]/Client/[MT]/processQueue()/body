{
  if (!myRequestInProgress.getAndSet(true)) {
    final RequestHandlerPair next=myRequestQueue.poll();
    if (next != null) {
      sendRequest(next.request,new JpsServerResponseHandler(){
        public void handleCompileResponse(        JpsRemoteProto.Message.Response.CompileResponse compileResponse){
          if (next.handler != null) {
            next.handler.handleCompileResponse(compileResponse);
          }
          myRequestInProgress.set(false);
          processQueue();
        }
        public void handleStatusResponse(        JpsRemoteProto.Message.Response.StatusResponse response){
          if (next.handler != null) {
            next.handler.handleStatusResponse(response);
          }
          myRequestInProgress.set(false);
          processQueue();
        }
        public void handleFailure(        JpsRemoteProto.Message.Failure failure){
          if (next.handler != null) {
            next.handler.handleFailure(failure);
          }
          myRequestInProgress.set(false);
          processQueue();
        }
      }
);
    }
 else {
      myRequestInProgress.set(false);
    }
  }
}
