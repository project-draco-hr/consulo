{
  final Transferable transferable=EditorModificationUtil.getContentsToPasteToEditor(producer);
  if (transferable == null)   return;
  if (!CodeInsightUtilBase.prepareEditorForWrite(editor))   return;
  final Document document=editor.getDocument();
  if (!FileDocumentManager.getInstance().requestWriting(document,CommonDataKeys.PROJECT.getData(dataContext))) {
    return;
  }
  DataContext context=new DataContext(){
    @Override public Object getData(    @NonNls String dataId){
      return PasteAction.TRANSFERABLE_PROVIDER.is(dataId) ? new Producer<Transferable>(){
        @Nullable @Override public Transferable produce(){
          return transferable;
        }
      }
 : dataContext.getData(dataId);
    }
  }
;
  final Project project=editor.getProject();
  if (project == null || editor.isColumnMode() || editor.getCaretModel().getCaretCount() > 1) {
    if (myOriginalHandler != null) {
      myOriginalHandler.execute(editor,null,context);
    }
    return;
  }
  final PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(document);
  if (file == null) {
    if (myOriginalHandler != null) {
      myOriginalHandler.execute(editor,null,context);
    }
    return;
  }
  DumbService.getInstance(project).setAlternativeResolveEnabled(true);
  document.startGuardedBlockChecking();
  try {
    for (    PasteProvider provider : Extensions.getExtensions(EP_NAME)) {
      if (provider.isPasteEnabled(context)) {
        provider.performPaste(context);
        return;
      }
    }
    doPaste(editor,project,file,document,transferable);
  }
 catch (  ReadOnlyFragmentModificationException e) {
    EditorActionManager.getInstance().getReadonlyFragmentModificationHandler(document).handle(e);
  }
 finally {
    document.stopGuardedBlockChecking();
    DumbService.getInstance(project).setAlternativeResolveEnabled(false);
  }
}
