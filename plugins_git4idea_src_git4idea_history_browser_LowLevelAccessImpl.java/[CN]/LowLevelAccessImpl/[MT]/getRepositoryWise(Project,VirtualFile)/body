{
  GitRepository repository=project == null || project.isDefault() ? null : GitUtil.getRepositoryManager(project).getRepositoryForRoot(root);
  if (repository == null) {
    final File child=new File(root.getPath(),GitUtil.DOT_GIT);
    if (!child.exists()) {
      throw new VcsException("No git repository in " + root.getPath());
    }
    repository=GitRepositoryImpl.getLightInstance(root,project,ServiceManager.getService(project,GitPlatformFacade.class),project);
    repository.update();
    repository.getBranches();
  }
  return repository;
}
