{
  final SymbolicRefs refs=new SymbolicRefs();
  final GitRepository repositoryForRoot=GitRepositoryManager.getInstance(myProject).getRepositoryForRoot(myRoot);
  if (repositoryForRoot != null) {
    final GitBranchesCollection branches=repositoryForRoot.getBranches();
    final Collection<GitBranch> localBranches=branches.getLocalBranches();
    for (    GitBranch localBranch : localBranches) {
      refs.addLocal(localBranch.getName());
    }
    final Collection<GitBranch> remoteBranches=branches.getRemoteBranches();
    for (    GitBranch remoteBranch : remoteBranches) {
      String name=remoteBranch.getName();
      name=name.startsWith("remotes/") ? name.substring("remotes/".length()) : name;
      refs.addRemote(name);
      final GitBranch current=branches.getCurrentBranch();
      refs.setCurrent(current);
      if (current != null) {
        GitBranch tracked=current.tracked(myProject,myRoot);
        String fullName=tracked == null ? null : tracked.getFullName();
        fullName=fullName != null && fullName.startsWith(GitBranch.REFS_REMOTES_PREFIX) ? fullName.substring(GitBranch.REFS_REMOTES_PREFIX.length()) : fullName;
        refs.setTrackedRemote(fullName);
      }
      refs.setUsername(GitConfigUtil.getValue(myProject,myRoot,GitConfigUtil.USER_NAME));
    }
  }
 else {
    final List<GitBranch> allBranches=new ArrayList<GitBranch>();
    final GitBranch current=GitBranch.list(myProject,myRoot,true,true,allBranches,null);
    for (    GitBranch branch : allBranches) {
      if (branch.isRemote()) {
        String name=branch.getName();
        name=name.startsWith("remotes/") ? name.substring("remotes/".length()) : name;
        refs.addRemote(name);
      }
 else {
        refs.addLocal(branch.getName());
      }
    }
    refs.setCurrent(current);
    if (current != null) {
      GitBranch tracked=current.tracked(myProject,myRoot);
      String fullName=tracked == null ? null : tracked.getFullName();
      fullName=fullName != null && fullName.startsWith(GitBranch.REFS_REMOTES_PREFIX) ? fullName.substring(GitBranch.REFS_REMOTES_PREFIX.length()) : fullName;
      refs.setTrackedRemote(fullName);
    }
    refs.setUsername(GitConfigUtil.getValue(myProject,myRoot,GitConfigUtil.USER_NAME));
  }
  final VcsRevisionNumber head=GitHistoryUtils.getCurrentRevision(myProject,new FilePathImpl(myRoot),"HEAD",true);
  refs.setHead(AbstractHash.create(head.asString()));
  return refs;
}
