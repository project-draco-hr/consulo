{
  RootEntry root=new RootEntry();
  root.createDirectory(1,"dir1",null);
  root.createDirectory(2,"dir2",null);
  root.createFile(3,"dir1/file",null,null);
  Change c=new MoveChange("dir1/file","dir2");
  c.applyTo(root);
  os.writeChange(c);
  Change read=is.readChange();
  assertEquals(MoveChange.class,read.getClass());
  MoveChange result=((MoveChange)read);
  assertEquals("dir1/file",result.getPath());
  assertElements(a(idp(1,3),idp(2,3)),result.getAffectedIdPaths());
  assertEquals("dir2",result.getNewParentPath());
}
