{
  Snapshot snapshot=new Snapshot(new ChangeList(),new RootEntry());
  snapshot.doCreateDirectory(p("entry"));
  snapshot.doCreateFile(p("entry/file"),"");
  snapshot.doCreateDirectory(p("entry/dir"));
  Change c=new DeleteChange(p("entry"));
  c.applyTo(snapshot.getRoot());
  os.writeChange(c);
  Entry result=((DeleteChange)is.readChange()).getAffectedEntry();
  assertEquals(DirectoryEntry.class,result.getClass());
  assertEquals("entry",result.getName());
  assertEquals(2,result.getChildren().size());
  assertEquals("file",result.getChildren().get(0).getName());
  assertEquals("dir",result.getChildren().get(1).getName());
}
