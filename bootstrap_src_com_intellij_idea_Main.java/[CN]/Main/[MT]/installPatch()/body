{
  try {
    File ideaHomeDir=getIdeaHomeDir();
    if (ideaHomeDir == null)     return;
    File patchFile=new File(ideaHomeDir,"patch.jar");
    if (!patchFile.exists())     return;
    File tempFile=File.createTempFile("idea.patch",null);
    tempFile.deleteOnExit();
    copyFile(patchFile,tempFile);
    patchFile.delete();
    Process process=Runtime.getRuntime().exec(new String[]{System.getProperty("java.home") + "/bin/java","-classpath",tempFile.getPath(),"com.intellij.updater.Runner","install",ideaHomeDir.getPath()});
    Thread outThread=new Thread(new StreamRedirector(process.getInputStream(),System.out));
    Thread errThread=new Thread(new StreamRedirector(process.getErrorStream(),System.err));
    outThread.start();
    errThread.start();
    try {
      process.waitFor();
    }
  finally {
      outThread.join();
      errThread.join();
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
}
