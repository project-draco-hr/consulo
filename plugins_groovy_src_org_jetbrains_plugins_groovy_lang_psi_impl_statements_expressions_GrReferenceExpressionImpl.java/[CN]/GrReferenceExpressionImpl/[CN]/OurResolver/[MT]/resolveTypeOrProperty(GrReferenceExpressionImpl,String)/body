{
  EnumSet<ClassHint.ResolveKind> kinds=refExpr.getParent() instanceof GrReferenceExpression ? EnumSet.of(ClassHint.ResolveKind.CLASS,ClassHint.ResolveKind.PACKAGE) : EnumSet.of(ClassHint.ResolveKind.CLASS);
  boolean hasAt=refExpr.hasAt();
  GroovyResolveResult[] classCandidates=GroovyResolveResult.EMPTY_ARRAY;
  if (!hasAt) {
    ResolverProcessor classProcessor=new ClassResolverProcessor(refExpr.getReferenceName(),refExpr,kinds);
    refExpr.resolveImpl(classProcessor);
    classCandidates=classProcessor.getCandidates();
    for (    GroovyResolveResult classCandidate : classCandidates) {
      final PsiElement element=classCandidate.getElement();
      if (element instanceof PsiClass && ((PsiClass)element).isEnum()) {
        return classCandidates;
      }
    }
  }
  ResolverProcessor processor=new PropertyResolverProcessor(name,refExpr);
  refExpr.resolveImpl(processor);
  final GroovyResolveResult[] fieldCandidates=processor.getCandidates();
  if (refExpr.hasAt()) {
    return fieldCandidates;
  }
  for (  GroovyResolveResult candidate : fieldCandidates) {
    final PsiElement element=candidate.getElement();
    if (element instanceof PsiField) {
      final PsiClass containingClass=((PsiField)element).getContainingClass();
      if (containingClass != null && PsiTreeUtil.isAncestor(containingClass,refExpr,true))       return fieldCandidates;
    }
 else {
      return fieldCandidates;
    }
  }
  final boolean isLValue=PsiUtil.isLValue(refExpr);
  String[] names;
  names=isLValue ? GroovyPropertyUtils.suggestSettersName(name) : GroovyPropertyUtils.suggestGettersName(name);
  List<GroovyResolveResult> accessorResults=new ArrayList<GroovyResolveResult>();
  for (  String getterName : names) {
    AccessorResolverProcessor accessorResolver=new AccessorResolverProcessor(getterName,refExpr,!isLValue);
    refExpr.resolveImpl(accessorResolver);
    final GroovyResolveResult[] candidates=accessorResolver.getCandidates();
    if (candidates.length == 1 && candidates[0].isStaticsOK()) {
      return candidates;
    }
 else {
      ContainerUtil.addAll(accessorResults,candidates);
    }
  }
  if (fieldCandidates.length > 0)   return fieldCandidates;
  if (accessorResults.size() > 0)   return new GroovyResolveResult[]{accessorResults.get(0)};
  return classCandidates;
}
