{
  final PsiType inferred=GroovyPsiManager.getInstance(refExpr.getProject()).getTypeInferenceHelper().getInferredType(refExpr);
  final PsiType nominal=refExpr.getNominalTypeImpl();
  if (inferred == null)   return nominal;
  if (nominal == null)   return inferred;
  if (!nominal.isAssignableFrom(inferred))   return nominal;
  return inferred;
}
