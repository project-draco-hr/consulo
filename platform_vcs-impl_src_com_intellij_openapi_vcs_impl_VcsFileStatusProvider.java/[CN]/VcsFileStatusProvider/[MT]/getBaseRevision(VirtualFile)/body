{
  final Change change=ChangeListManager.getInstance(myProject).getChange(file);
  if (change != null) {
    final ContentRevision beforeRevision=change.getBeforeRevision();
    if (beforeRevision instanceof BinaryContentRevision)     return null;
    if (beforeRevision != null) {
      String content;
      try {
        content=beforeRevision.getContent();
      }
 catch (      VcsException ex) {
        content=null;
      }
      if (content == null) {
        myHaveEmptyContentRevisions=true;
        return null;
      }
      return Pair.create(beforeRevision.getRevisionNumber(),content);
    }
    return null;
  }
  if (isDocumentModified(file)) {
    String content=ApplicationManager.getApplication().runReadAction(new Computable<String>(){
      @Override public String compute(){
        if (!file.isValid())         return null;
        return LoadTextUtil.loadText(file).toString();
      }
    }
);
    if (content == null)     return null;
    return Pair.create(VcsRevisionNumber.NULL,content);
  }
  return null;
}
