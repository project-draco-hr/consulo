{
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      PsiClass[] classes=dir.getClasses();
      for (      PsiClass aClass : classes) {
        array.add(aClass);
      }
      if (includeSubdirs) {
        PsiDirectory[] dirs=dir.getSubdirectories();
        for (        PsiDirectory directory : dirs) {
          addClassesInDirectory(directory,includeSubdirs,array);
        }
      }
    }
  }
);
}
