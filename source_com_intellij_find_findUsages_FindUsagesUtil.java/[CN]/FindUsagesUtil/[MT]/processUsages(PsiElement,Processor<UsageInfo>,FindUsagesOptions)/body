{
  if (LOG.isDebugEnabled()) {
    LOG.debug("findUsages: element = " + element + ", options = "+ options);
  }
  if (element instanceof PsiVariable) {
    if (options.isReadAccess || options.isWriteAccess) {
      if (options.isReadAccess && options.isWriteAccess) {
        addElementUsages(element,processor,options);
      }
 else {
        addElementUsages(element,new Processor<UsageInfo>(){
          public boolean process(          UsageInfo info){
            boolean isWrite=isAccessedForWriting(info.getElement());
            if (isWrite == options.isWriteAccess) {
              if (!processor.process(info))               return false;
            }
            return true;
          }
        }
,options);
      }
    }
  }
 else {
    if (options.isUsages) {
      addElementUsages(element,processor,options);
    }
  }
  if (ThrowSearchUtil.isSearchable(element) && options.isThrowUsages) {
    new ThrowSearchUtil(processor,options.myThrowRoot,options).run();
  }
  if (element instanceof PsiPackage && options.isClassesUsages) {
    addClassesUsages((PsiPackage)element,processor,options);
  }
  if (element instanceof PsiClass && options.isMethodsUsages) {
    addMethodsUsages((PsiClass)element,processor,options);
  }
  if (element instanceof PsiClass && options.isFieldsUsages) {
    addFieldsUsages((PsiClass)element,processor,options);
  }
  if (element instanceof PsiClass) {
    if (!((PsiClass)element).isInterface()) {
      if (options.isDerivedClasses) {
        addInheritors((PsiClass)element,processor,options);
      }
    }
 else {
      if (options.isDerivedInterfaces) {
        if (options.isImplementingClasses) {
          addInheritors((PsiClass)element,processor,options);
        }
 else {
          addDerivedInterfaces((PsiClass)element,processor,options);
        }
      }
 else       if (options.isImplementingClasses) {
        addImplementingClasses((PsiClass)element,processor,options);
      }
    }
  }
  if (element instanceof PsiMethod) {
    PsiSearchHelper searchHelper=element.getManager().getSearchHelper();
    final PsiMethod psiMethod=(PsiMethod)element;
    if (!psiMethod.hasModifierProperty(PsiModifier.ABSTRACT)) {
      if (options.isOverridingMethods) {
        processOverridingMethods(psiMethod,processor,searchHelper,options);
      }
    }
 else {
      if (options.isImplementingMethods) {
        processOverridingMethods(psiMethod,processor,searchHelper,options);
      }
    }
  }
  if (element instanceof PsiPointcutDef) {
    PsiSearchHelper searchHelper=element.getManager().getSearchHelper();
    PsiPointcutDef pointcut=(PsiPointcutDef)element;
    if (!pointcut.hasModifierProperty(PsiModifier.ABSTRACT)) {
      if (options.isOverridingPointcuts) {
        PsiPointcutDef[] pointcuts=searchHelper.findOverridingPointcuts(pointcut,options.searchScope,options.isCheckDeepInheritance);
        addResults(processor,pointcuts,options,null);
      }
    }
 else {
      if (options.isImplementingPointcuts) {
        PsiPointcutDef[] pointcuts=searchHelper.findOverridingPointcuts(pointcut,options.searchScope,options.isCheckDeepInheritance);
        addResults(processor,pointcuts,options,null);
      }
    }
  }
  if (options.isSearchInNonJavaFiles && options.searchScope instanceof GlobalSearchScope) {
    String stringToSearch=getStringToSearch(element);
    RefactoringUtil.UsageInfoFactory factory=new RefactoringUtil.UsageInfoFactory(){
      public UsageInfo createUsageInfo(      PsiElement usage,      int startOffset,      int endOffset){
        return new UsageInfo(usage,startOffset,endOffset,true);
      }
    }
;
    RefactoringUtil.processUsagesInNonJavaFiles(element,stringToSearch,(GlobalSearchScope)options.searchScope,processor,factory);
  }
}
