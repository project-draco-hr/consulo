{
  XDebuggerTree tree=myDebuggerTreePanel.getTree();
  final XSourcePosition position=stackFrame.getSourcePosition();
  tree.setSourcePosition(position);
  tree.setRoot(new XStackFrameNode(tree,stackFrame),false);
  final Project project=tree.getProject();
  project.putUserData(XVariablesView.DEBUG_VARIABLES,new THashMap<Pair<VirtualFile,Integer>,Set<XValueNodeImpl>>());
  project.putUserData(XVariablesView.DEBUG_VARIABLES_TIMESTAMPS,new ObjectLongHashMap<VirtualFile>());
  Object newEqualityObject=stackFrame.getEqualityObject();
  if (myFrameEqualityObject != null && newEqualityObject != null && myFrameEqualityObject.equals(newEqualityObject) && myTreeState != null) {
    disposeTreeRestorer();
    myTreeRestorer=myTreeState.restoreState(tree);
  }
  if (position != null && Registry.is("debugger.valueTooltipAutoShowOnSelection")) {
    registerInlineEvaluator(stackFrame,tree,position,project);
  }
}
