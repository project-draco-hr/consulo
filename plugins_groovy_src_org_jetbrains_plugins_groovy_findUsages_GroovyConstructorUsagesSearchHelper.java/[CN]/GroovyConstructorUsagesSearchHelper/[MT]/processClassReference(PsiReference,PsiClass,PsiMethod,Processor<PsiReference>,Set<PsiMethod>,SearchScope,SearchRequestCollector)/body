{
  final PsiElement element=ref.getElement();
  if (element instanceof GrCodeReferenceElement) {
    if (!processGroovyConstructorUsages((GrCodeReferenceElement)element,constructor,consumer,ref)) {
      return false;
    }
  }
  final PsiMethod method=getMethodToSearchForCallsWithLiteralArguments(element,clazz,processedMethods);
  if (method != null) {
    final GlobalSearchScope gppScope=getGppScope(clazz.getProject());
    MethodReferencesSearch.searchOptimized(method,gppScope.intersectWith(scope),true,collector,true,new PairProcessor<PsiReference,SearchRequestCollector>(){
      @Override public boolean process(      PsiReference psiReference,      SearchRequestCollector collector){
        if (psiReference instanceof GrReferenceElement) {
          final PsiElement parent=((GrReferenceElement)psiReference).getParent();
          if (parent instanceof GrCall) {
            final GrArgumentList argList=((GrCall)parent).getArgumentList();
            if (argList != null) {
              boolean checkedTypedContext=false;
              for (              GrExpression argument : argList.getExpressionArguments()) {
                if (argument instanceof GrListOrMap && !((GrListOrMap)argument).isMap()) {
                  if (!checkedTypedContext) {
                    if (!GppTypeConverter.hasTypedContext(parent)) {
                      return true;
                    }
                    checkedTypedContext=true;
                  }
                  for (                  PsiType psiType : GroovyExpectedTypesProvider.getDefaultExpectedTypes(argument)) {
                    if (psiType instanceof PsiClassType && clazz.getManager().areElementsEquivalent(clazz,((PsiClassType)psiType).resolve()) && !checkListInstantiation(constructor,consumer,(GrListOrMap)argument,(PsiClassType)psiType)) {
                      return false;
                    }
                  }
                }
              }
            }
          }
        }
        return true;
      }
    }
);
  }
  return true;
}
