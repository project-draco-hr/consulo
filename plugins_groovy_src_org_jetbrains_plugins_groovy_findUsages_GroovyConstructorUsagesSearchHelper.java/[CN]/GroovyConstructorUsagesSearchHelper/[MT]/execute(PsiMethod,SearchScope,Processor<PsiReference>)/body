{
  if (!constructor.isConstructor())   return true;
  if (searchScope instanceof GlobalSearchScope) {
    searchScope=GlobalSearchScope.getScopeRestrictedByFileTypes((GlobalSearchScope)searchScope,GroovyFileType.GROOVY_FILE_TYPE);
  }
  final PsiClass clazz=ApplicationManager.getApplication().runReadAction(new NullableComputable<PsiClass>(){
    public PsiClass compute(){
      return constructor.getContainingClass();
    }
  }
);
  if (clazz == null)   return true;
  if (!ApplicationManager.getApplication().runReadAction(new Computable<Boolean>(){
    public Boolean compute(){
      if (!clazz.isEnum())       return true;
      if (!(clazz instanceof GroovyPsiElement))       return true;
      final PsiField[] fields=clazz.getFields();
      for (      PsiField field : fields) {
        if (field instanceof GrEnumConstant) {
          final PsiReference ref=field.getReference();
          if (ref.isReferenceTo(constructor)) {
            if (!consumer.process(ref))             return false;
          }
        }
      }
      return true;
    }
  }
)) {
    return false;
  }
  ReferencesSearch.search(clazz,searchScope,true).forEach(new ReadActionProcessor<PsiReference>(){
    @Override public boolean processInReadAction(    PsiReference ref){
      final PsiElement element=ref.getElement();
      if (element instanceof GrCodeReferenceElement) {
        GrNewExpression newExpression=null;
        if (element.getParent() instanceof GrNewExpression) {
          newExpression=(GrNewExpression)element.getParent();
        }
 else         if (element.getParent() instanceof GrAnonymousClassDefinition) {
          newExpression=(GrNewExpression)element.getParent().getParent();
        }
        if (newExpression != null) {
          final PsiMethod resolvedConstructor=newExpression.resolveMethod();
          final PsiManager manager=constructor.getManager();
          if (manager.areElementsEquivalent(resolvedConstructor,constructor) && !consumer.process(ref))           return false;
        }
      }
      return true;
    }
  }
);
  if (clazz instanceof GrTypeDefinition) {
    if (!processConstructors(constructor,consumer,clazz,true)) {
      return false;
    }
  }
  if (!DirectClassInheritorsSearch.search(clazz,searchScope).forEach(new Processor<PsiClass>(){
    public boolean process(    PsiClass inheritor){
      if (inheritor instanceof GrTypeDefinition) {
        if (!processConstructors(constructor,consumer,inheritor,false))         return false;
      }
      return true;
    }
  }
)) {
    return false;
  }
  return true;
}
