{
  final PersistentLibraryKind kind=libraryType == null ? null : libraryType.getKind();
  final Library library=((LibraryTableBase.ModifiableModelEx)myModuleLibrariesModel).createLibrary(null,kind);
  final LibraryEx.ModifiableModelEx libModel=(LibraryEx.ModifiableModelEx)library.getModifiableModel();
  if (myDefaultPropertiesFactory != null) {
    libModel.setProperties(myDefaultPropertiesFactory.fun(libraryType));
  }
  for (  OrderRoot root : roots) {
    if (root.isJarDirectory()) {
      libModel.addJarDirectory(root.getFile(),false,root.getType());
    }
 else {
      libModel.addRoot(root.getFile(),root.getType());
    }
  }
  libModel.commit();
  return library;
}
