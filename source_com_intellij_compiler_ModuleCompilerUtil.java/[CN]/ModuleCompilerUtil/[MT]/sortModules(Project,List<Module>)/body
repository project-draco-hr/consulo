{
  final Application applicationEx=ApplicationManager.getApplication();
  if (applicationEx.isDispatchThread()) {
    Collections.sort(modules,moduleDependencyComparator(project));
  }
 else {
    applicationEx.runReadAction(new Runnable(){
      public void run(){
        Collections.sort(modules,moduleDependencyComparator(project));
      }
    }
);
  }
}
