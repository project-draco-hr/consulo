{
  if (expression instanceof PsiLiteralExpression) {
    final String text=expression.getText();
    final PsiType type=expression.getType();
    if (type != null && (type.equalsToText("java.lang.String") || type.equalsToText("char"))) {
      final int textLength=text.length();
      if (textLength > 2) {
        out.append(text.substring(1,textLength - 1));
      }
    }
 else {
      out.append(text);
    }
  }
 else   if (expression instanceof PsiBinaryExpression) {
    final PsiBinaryExpression binaryExpression=(PsiBinaryExpression)expression;
    final Project project=expression.getProject();
    final JavaPsiFacade facade=JavaPsiFacade.getInstance(project);
    final PsiConstantEvaluationHelper evaluationHelper=facade.getConstantEvaluationHelper();
    final Object result=evaluationHelper.computeConstantExpression(expression);
    if (result != null) {
      out.append(result.toString());
    }
 else {
      final PsiExpression lhs=binaryExpression.getLOperand();
      buildContatenationText(lhs,out);
      final PsiExpression rhs=binaryExpression.getROperand();
      if (rhs != null) {
        buildContatenationText(rhs,out);
      }
    }
  }
 else {
    out.append("?");
  }
}
