{
  PsiElement psiTarget=(PsiElement)dataContext.getData(DataConstants.PSI_ELEMENT);
  if (psiTarget instanceof PsiDirectory) {
    PsiDirectory psiDirectory=(PsiDirectory)psiTarget;
    if (!psiDirectory.getManager().isInProject(psiDirectory))     return null;
    return new AnalysisScope(psiDirectory,myFileFilter);
  }
 else   if (psiTarget instanceof PsiPackage) {
    PsiPackage pack=(PsiPackage)psiTarget;
    PsiDirectory[] dirs=pack.getDirectories(GlobalSearchScope.projectScope(pack.getProject()));
    if (dirs == null || dirs.length == 0)     return null;
    return new AnalysisScope(pack,myFileFilter);
  }
  return null;
}
