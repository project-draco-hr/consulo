{
  CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          String fileName=getTestName(false) + extension;
          try {
            String text=loadFile(fileName);
            PsiFile file=createFile(fileName,text);
            JavaCodeStyleManager.getInstance(myProject).optimizeImports(file);
            PostprocessReformattingAspect.getInstance(getProject()).doPostponedFormatting();
            PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
            String textAfter=loadFile(getTestName(false) + "_after" + extension);
            String fileText=file.getText();
            assertEquals(textAfter,fileText);
          }
 catch (          Exception e) {
            LOGGER.error(e);
          }
        }
      }
);
    }
  }
,"","");
}
