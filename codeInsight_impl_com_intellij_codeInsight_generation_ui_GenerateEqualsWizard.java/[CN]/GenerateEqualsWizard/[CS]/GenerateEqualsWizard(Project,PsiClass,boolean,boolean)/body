{
  super(CodeInsightBundle.message("generate.equals.hashcode.wizard.title"),project);
  LOG.assertTrue(needEquals || needHashCode);
  myClass=aClass;
  myClassFields=MemberInfo.extractClassMembers(myClass,MEMBER_INFO_FILTER,false);
  for (  MemberInfo myClassField : myClassFields) {
    myClassField.setChecked(true);
  }
  int testBoxedStep=0;
  if (needEquals) {
    myEqualsPanel=new MemberSelectionPanel(CodeInsightBundle.message("generate.equals.hashcode.equals.fields.chooser.title"),myClassFields,null);
    myEqualsPanel.getTable().setMemberInfoModel(new EqualsMemberInfoModel());
    testBoxedStep+=2;
  }
 else {
    myEqualsPanel=null;
  }
  if (needHashCode) {
    final MemberInfo[] hashCodeMemberInfos;
    if (needEquals) {
      myFieldsToHashCode=createFieldToMemberInfoMap(true);
      hashCodeMemberInfos=new MemberInfo[0];
    }
 else {
      hashCodeMemberInfos=myClassFields;
      myFieldsToHashCode=null;
    }
    myHashCodePanel=new MemberSelectionPanel(CodeInsightBundle.message("generate.equals.hashcode.hashcode.fields.chooser.title"),hashCodeMemberInfos,null);
    myHashCodePanel.getTable().setMemberInfoModel(new HashCodeMemberInfoModel());
    if (needEquals) {
      updateHashCodeMemberInfos(myClassFields);
    }
    testBoxedStep++;
  }
 else {
    myHashCodePanel=null;
    myFieldsToHashCode=null;
  }
  myTestBoxedStep=testBoxedStep;
  myNonNullPanel=new MemberSelectionPanel(CodeInsightBundle.message("generate.equals.hashcode.non.null.fields.chooser.title"),new MemberInfo[0],null);
  myFieldsToNonNull=createFieldToMemberInfoMap(false);
  for (  final Map.Entry<PsiElement,MemberInfo> entry : myFieldsToNonNull.entrySet()) {
    entry.getValue().setChecked(((PsiField)entry.getKey()).getModifierList().findAnnotation(NotNull.class.getName()) != null);
  }
  final MyTableModelListener listener=new MyTableModelListener();
  if (myEqualsPanel != null) {
    myEqualsPanel.getTable().getModel().addTableModelListener(listener);
    addStep(new InstanceofOptionStep());
    addStep(new MyStep(myEqualsPanel));
    myEqualsStepCode=1;
  }
 else {
    myEqualsStepCode=-1;
  }
  if (myHashCodePanel != null) {
    myHashCodePanel.getTable().getModel().addTableModelListener(listener);
    addStep(new MyStep(myHashCodePanel));
    myHashcodeStepCode=myEqualsStepCode > 0 ? myEqualsStepCode + 1 : 1;
  }
 else {
    myHashcodeStepCode=-1;
  }
  addStep(new MyStep(myNonNullPanel));
  init();
  updateStatus();
}
