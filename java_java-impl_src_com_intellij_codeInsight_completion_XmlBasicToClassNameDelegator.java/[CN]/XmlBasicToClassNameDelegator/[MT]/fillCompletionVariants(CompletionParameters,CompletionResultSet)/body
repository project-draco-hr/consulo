{
  PsiElement position=parameters.getPosition();
  if (parameters.getCompletionType() != CompletionType.BASIC || !JavaCompletionContributor.mayStartClassName(result) || !position.getContainingFile().getLanguage().isKindOf(StdLanguages.XML)) {
    return;
  }
  final boolean empty=result.runRemainingContributors(parameters,true).isEmpty();
  if (!empty && parameters.getInvocationCount() == 0) {
    result.restartCompletionWhenNothingMatches();
  }
  if (empty || parameters.isExtendedCompletion()) {
    final int invocationCount=parameters.getInvocationCount();
    CompletionParameters classParams;
    if (empty) {
      classParams=parameters.withType(CompletionType.CLASS_NAME);
    }
 else     if (invocationCount > 1) {
      classParams=parameters.withType(CompletionType.CLASS_NAME).withInvocationCount(invocationCount - 1);
    }
 else {
      return;
    }
    CompletionService.getCompletionService().getVariantsFromContributors(classParams,null,new Consumer<CompletionResult>(){
      public void consume(      final CompletionResult completionResult){
        LookupElement lookupElement=completionResult.getLookupElement();
        JavaPsiClassReferenceElement classElement=lookupElement.as(JavaPsiClassReferenceElement.CLASS_CONDITION_KEY);
        if (classElement != null) {
          classElement.setAutoCompletionPolicy(AutoCompletionPolicy.NEVER_AUTOCOMPLETE);
        }
        lookupElement.putUserData(XmlCompletionContributor.WORD_COMPLETION_COMPATIBLE,Boolean.TRUE);
        result.passResult(completionResult);
      }
    }
);
  }
}
