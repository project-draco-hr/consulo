{
  PsiElement position=parameters.getPosition();
  PsiFile file=position.getContainingFile();
  if (parameters.getCompletionType() != CompletionType.BASIC || !JavaCompletionContributor.mayStartClassName(result) || !file.getLanguage().isKindOf(StdLanguages.XML)) {
    return;
  }
  final boolean empty=result.runRemainingContributors(parameters,true).isEmpty();
  if (!empty && parameters.getInvocationCount() == 0) {
    result.restartCompletionWhenNothingMatches();
  }
  if (empty && JavaClassReferenceCompletionContributor.findJavaClassReference(file,parameters.getOffset()) != null || parameters.isExtendedCompletion()) {
    CompletionService.getCompletionService().getVariantsFromContributors(parameters.delegateToClassName(),null,new Consumer<CompletionResult>(){
      public void consume(      final CompletionResult completionResult){
        LookupElement lookupElement=completionResult.getLookupElement();
        JavaPsiClassReferenceElement classElement=lookupElement.as(JavaPsiClassReferenceElement.CLASS_CONDITION_KEY);
        if (classElement != null) {
          classElement.setAutoCompletionPolicy(AutoCompletionPolicy.NEVER_AUTOCOMPLETE);
        }
        lookupElement.putUserData(XmlCompletionContributor.WORD_COMPLETION_COMPATIBLE,Boolean.TRUE);
        result.passResult(completionResult);
      }
    }
);
  }
}
