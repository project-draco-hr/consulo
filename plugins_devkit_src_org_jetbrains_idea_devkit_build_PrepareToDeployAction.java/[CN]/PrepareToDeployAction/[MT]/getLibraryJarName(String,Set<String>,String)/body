{
  String uniqueName;
  if (preferredName != null && !usedJarNames.contains(preferredName)) {
    uniqueName=preferredName;
  }
 else {
    uniqueName=fileName;
    if (usedJarNames.contains(uniqueName)) {
      final int dotPos=uniqueName.lastIndexOf(".");
      final String name=dotPos < 0 ? uniqueName : uniqueName.substring(0,dotPos);
      final String ext=dotPos < 0 ? "" : uniqueName.substring(dotPos);
      int i=0;
      do {
        i++;
        uniqueName=name + i + ext;
      }
 while (usedJarNames.contains(uniqueName));
    }
  }
  usedJarNames.add(uniqueName);
  return uniqueName;
}
