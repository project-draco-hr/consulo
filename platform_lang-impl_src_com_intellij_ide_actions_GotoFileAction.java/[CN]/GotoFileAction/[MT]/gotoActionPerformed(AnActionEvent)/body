{
  FeatureUsageTracker.getInstance().triggerFeatureUsed("navigation.popup.file");
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  final GotoFileModel gotoFileModel=new GotoFileModel(project);
  final ChooseByNamePopup popup=ChooseByNamePopup.createPopup(project,gotoFileModel,getPsiContext(e),getInitialText(e.getData(PlatformDataKeys.EDITOR)));
  final ChooseByNameFilter filterUI=new GotoFileFilter(popup,gotoFileModel,project);
  popup.invoke(new ChooseByNamePopupComponent.Callback(){
    public void onClose(){
      if (GotoFileAction.class.equals(myInAction)) {
        myInAction=null;
      }
      filterUI.close();
    }
    public void elementChosen(    final Object element){
      if (element == null)       return;
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          Navigatable n=(Navigatable)element;
          if (element instanceof PsiFile) {
            VirtualFile vfile=((PsiFile)element).getVirtualFile();
            if (vfile == null)             return;
            n=new OpenFileDescriptor(project,vfile,popup.getLinePosition(),popup.getColumnPosition());
          }
          if (!n.canNavigate())           return;
          n.navigate(true);
        }
      }
,ModalityState.NON_MODAL);
    }
  }
,ModalityState.current(),true);
}
