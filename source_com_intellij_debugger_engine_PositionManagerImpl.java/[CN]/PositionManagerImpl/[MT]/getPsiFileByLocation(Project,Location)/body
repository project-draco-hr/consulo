{
  if (location == null) {
    return null;
  }
  final ReferenceType refType=location.declaringType();
  if (refType == null) {
    return null;
  }
  final String originalQName=refType.name();
  final PsiManager psiManager=PsiManager.getInstance(project);
  int dollar=originalQName.indexOf('$');
  final String qName=dollar >= 0 ? originalQName.substring(0,dollar) : originalQName;
  PsiClass psiClass=DebuggerUtils.findClass(qName,project);
  if (psiClass == null) {
    psiClass=psiManager.findClass(originalQName,GlobalSearchScope.allScope(project));
  }
  if (psiClass != null) {
    psiClass=(PsiClass)psiClass.getNavigationElement();
    return psiClass.getContainingFile();
  }
  return null;
}
