{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      String tagText=toEscapedText(text);
      for (int i=0; i < text.length(); i++) {
        for (int j=i; j < text.length(); j++) {
          XmlTag tag=XmlElementFactory.getInstance(getProject()).createXHTMLTagFromText("<a>" + tagText + "</a>");
          final PsiElement[] children=tag.getValue().getTextElements();
          assertEquals(1,children.length);
          final XmlText xmlText=(XmlText)children[0];
          assertEquals(tagText,xmlText.getText());
          xmlText.removeText(i,j);
          final StringBuffer expectedDisplay=new StringBuffer(text.replace('_',' '));
          expectedDisplay.delete(i,j);
          assertEquals(expectedDisplay.toString(),xmlText.getValue());
          final String expectedText=toEscapedText(expectedDisplay.toString());
          assertEquals(expectedText,xmlText.getText());
        }
      }
    }
  }
);
}
