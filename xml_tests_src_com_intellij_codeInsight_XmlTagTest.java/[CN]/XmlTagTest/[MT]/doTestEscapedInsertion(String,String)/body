{
  String tagText=toEscapedText(text);
  for (int i=0; i <= text.length(); i++) {
    XmlTag tag=XmlElementFactory.getInstance(getProject()).createXHTMLTagFromText("<a>" + tagText + "</a>");
    final PsiElement[] children=tag.getValue().getTextElements();
    assertEquals(1,children.length);
    final XmlText xmlText=(XmlText)children[0];
    assertEquals(tagText,xmlText.getText());
    xmlText.insertText(textToInsert,i);
    final StringBuffer expectedDisplay=new StringBuffer(text.replace('_','\u00a0'));
    expectedDisplay.insert(i,textToInsert);
    assertEquals(expectedDisplay.toString(),xmlText.getValue());
  }
}
