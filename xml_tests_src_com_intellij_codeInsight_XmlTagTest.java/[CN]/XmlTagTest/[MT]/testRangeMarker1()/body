{
  final XmlFile file=(XmlFile)createFile("file.xhtml","<a>1234<b></b>567</a>");
  final XmlTag root=file.getDocument().getRootTag();
  final XmlTag tag=root.findFirstSubTag("b");
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
        @Override public void run(){
          final int offset=tag.getTextOffset();
          Document document=PsiDocumentManager.getInstance(getProject()).getDocument(root.getContainingFile());
          RangeMarker marker=document.createRangeMarker(offset - 3,offset);
          tag.delete();
          assertEquals(4,marker.getStartOffset());
          assertEquals(7,marker.getEndOffset());
        }
      }
,"",null);
    }
  }
);
}
