{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      for (int i=0; i <= text.length(); i++) {
        XmlTag tag=XmlElementFactory.getInstance(getProject()).createXHTMLTagFromText("<a>" + text + "</a>");
        final PsiElement[] children=tag.getValue().getTextElements();
        assertEquals(1,children.length);
        final XmlText xmlText=(XmlText)children[0];
        assertEquals(text,xmlText.getValue());
        xmlText.insertText(textToInsert,i);
        final StringBuffer expected=new StringBuffer(text);
        expected.insert(i,textToInsert);
        assertEquals(expected.toString(),xmlText.getValue());
      }
    }
  }
);
}
