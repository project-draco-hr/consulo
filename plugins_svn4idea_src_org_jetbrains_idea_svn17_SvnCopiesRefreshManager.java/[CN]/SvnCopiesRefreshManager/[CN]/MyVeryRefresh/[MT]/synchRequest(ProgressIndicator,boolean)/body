{
  final Semaphore semaphore=new Semaphore();
  final Runnable waiter=new Runnable(){
    public void run(){
      semaphore.up();
    }
  }
;
  semaphore.down();
  if (isOnlyInit) {
    myRequestMerger.ensureInitialization(waiter);
  }
 else {
    myRequestMerger.waitRefresh(waiter);
  }
  while (true) {
    if (semaphore.waitFor(ourQueryInterval))     break;
    if (pi != null) {
      pi.checkCanceled();
    }
  }
}
