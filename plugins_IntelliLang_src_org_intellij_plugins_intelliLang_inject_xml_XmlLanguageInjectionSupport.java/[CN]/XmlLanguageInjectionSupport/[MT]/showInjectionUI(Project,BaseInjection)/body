{
  final DialogBuilder builder=new DialogBuilder(project);
  final AbstractInjectionPanel panel;
  if (xmlInjection instanceof XmlTagInjection) {
    panel=new XmlTagPanel((XmlTagInjection)xmlInjection,project);
    builder.setHelpId("reference.settings.injection.language.injection.settings.xml.tag");
  }
 else   if (xmlInjection instanceof XmlAttributeInjection) {
    panel=new XmlAttributePanel((XmlAttributeInjection)xmlInjection,project);
    builder.setHelpId("reference.settings.injection.language.injection.settings.xml.attribute");
  }
 else   throw new AssertionError();
  panel.reset();
  builder.addOkAction();
  builder.addCancelAction();
  builder.setCenterPanel(panel.getComponent());
  builder.setTitle(EditInjectionSettingsAction.EDIT_INJECTION_TITLE);
  builder.setOkOperation(new Runnable(){
    public void run(){
      panel.apply();
      builder.getDialogWrapper().close(DialogWrapper.OK_EXIT_CODE);
    }
  }
);
  if (builder.show() == DialogWrapper.OK_EXIT_CODE) {
    xmlInjection.initializePlaces(false);
    return new AbstractTagInjection().copyFrom(xmlInjection);
  }
  return null;
}
