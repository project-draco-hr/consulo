{
  final XmlTagInjection result=new XmlTagInjection().copyFrom(injection);
  result.getInjectionPlaces().clear();
  final XmlTag xmlTag=xmlText.getParentTag();
  if (xmlTag == null)   return null;
  for (  InjectionPlace place : injection.getInjectionPlaces()) {
    if (place.isEnabled() && place.getElementPattern() != null && place.getElementPattern().accepts(xmlTag)) {
      final Matcher matcher=Pattern.compile("withLocalName[^\"]*\"([^\"]*)\".*withNamespace[^\"]*\"([^\"]*)\"").matcher(place.getText());
      if (matcher.find()) {
        result.setTagName(matcher.group(1));
        result.setTagNamespace(matcher.group(2));
      }
      if (injection instanceof AbstractTagInjection) {
        result.setApplyToSubTagTexts(((AbstractTagInjection)injection).isApplyToSubTagTexts());
      }
    }
  }
  return result;
}
