{
  PsiExpression lOperand=param.getLOperand();
  PsiExpression rOperand=param.getROperand();
  if (rOperand == null)   return null;
  PsiType rType=rOperand.getType();
  IElementType sign=param.getOperationSign().getNode().getElementType();
  PsiType type=TypeConversionUtil.calcTypeForBinaryExpression(null,rType,sign,false);
  if (type != TypeConversionUtil.NULL_TYPE)   return type;
  if (lOperand instanceof PsiBinaryExpressionImpl && !JavaResolveCache.getInstance(param.getProject()).isTypeCached(lOperand)) {
    PsiBinaryExpressionImpl topLevel=param;
    PsiElement element=param;
    while (element instanceof PsiBinaryExpressionImpl) {
      topLevel=(PsiBinaryExpressionImpl)element;
      element=element.getParent();
    }
    topLevel.accept(new JavaRecursiveElementWalkingVisitor(){
      @Override protected void elementFinished(      PsiElement element){
        if (element instanceof PsiExpression) {
          ProgressManager.checkCanceled();
          ((PsiExpression)element).getType();
        }
      }
    }
);
  }
  PsiType lType=lOperand.getType();
  return TypeConversionUtil.calcTypeForBinaryExpression(lType,rType,sign,true);
}
