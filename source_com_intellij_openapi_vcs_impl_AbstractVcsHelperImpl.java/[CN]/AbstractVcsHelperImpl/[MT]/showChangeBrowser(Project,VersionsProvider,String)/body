{
  try {
    final RefreshableOnComponent filterUI=provider.createFilterUI();
    final boolean ok;
    if (filterUI != null) {
      final FilterDialog dlg=new FilterDialog(project,filterUI);
      dlg.show();
      ok=dlg.getExitCode() == DialogWrapper.OK_EXIT_CODE;
    }
 else {
      ok=true;
    }
    if (ok) {
      final AbstractVcsHelper helper=AbstractVcsHelper.getInstance(project);
      final List<RepositoryVersion> versions=new ArrayList<RepositoryVersion>();
      final List<VcsException> exceptions=new ArrayList<VcsException>();
      final boolean done=ProgressManager.getInstance().runProcessWithProgressSynchronously(new Runnable(){
        public void run(){
          try {
            versions.addAll(provider.getFilteredVersions());
          }
 catch (          VcsException e) {
            exceptions.add(e);
          }
        }
      }
,VcsBundle.message("browse.changes.progress.title"),true,project);
      if (!done)       return;
      if (!exceptions.isEmpty()) {
        Messages.showErrorDialog(project,VcsBundle.message("browse.changes.error.message",exceptions.get(0).getMessage()),VcsBundle.message("browse.changes.error.title"));
        return;
      }
      if (versions.isEmpty()) {
        Messages.showInfoMessage(project,VcsBundle.message("browse.changes.nothing.found"),VcsBundle.message("browse.changes.nothing.found.title"));
        return;
      }
      final List<CommittedChangeList> lists=new ArrayList<CommittedChangeList>();
      for (      RepositoryVersion version : versions) {
        lists.add(createFromRepositoryVersion(version));
      }
      helper.showChangesBrowser(lists,title);
    }
  }
 catch (  VcsException e) {
    Messages.showErrorDialog(project,VcsBundle.message("browse.changes.error.message",e.getMessage()),VcsBundle.message("browse.changes.error.title"));
  }
}
