{
  MavenEmbedderSettings settings=new MavenEmbedderSettings();
  settings.setConfigurator(new PlexusComponentConfigurator(){
    public void configureComponents(    @NotNull PlexusContainer c){
      setupContainer(c);
    }
  }
);
  MavenFacadeConsoleWrapper consoleWrapper=new MavenFacadeConsoleWrapper();
  consoleWrapper.setThreshold(facadeSettings.getLoggingLevel());
  settings.setLogger(consoleWrapper);
  settings.setRecursive(false);
  settings.setWorkOffline(facadeSettings.isOffline());
  settings.setUsePluginRegistry(false);
  settings.setMavenHome(facadeSettings.getMavenHome());
  settings.setUserSettingsFile(facadeSettings.getUserSettingsFile());
  settings.setGlobalSettingsFile(facadeSettings.getGlobalSettingsFile());
  settings.setLocalRepository(facadeSettings.getLocalRepository());
  settings.setSnapshotUpdatePolicy(convertUpdatePolicy(facadeSettings.getSnapshotUpdatePolicy()));
  settings.setPluginUpdatePolicy(convertUpdatePolicy(facadeSettings.getPluginUpdatePolicy()));
  settings.setProperties(MavenServerUtil.collectSystemProperties());
  return new MavenFacadeEmbedderImpl(MavenEmbedder.create(settings),consoleWrapper);
}
