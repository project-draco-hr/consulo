{
  final PsiDocumentManager documentManager=PsiDocumentManager.getInstance(project);
  documentManager.commitDocument(document);
  final WaitableBoolean wb=new WaitableBoolean();
  if (psiFile != null && isFileWritable(psiFile) && psiFile.getName().endsWith(".java")) {
    LOG.debug("schedule rearranger task");
    final Runnable task=new rearrangerTask(project,psiFile,settings,document,wb);
    CommandProcessor.getInstance().executeCommand(project,task,"Rearrange",null);
  }
  try {
    LOG.debug("wait for rearranger task to complete.");
    wb.whenTrue();
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
  }
  LOG.debug("end execute");
}
