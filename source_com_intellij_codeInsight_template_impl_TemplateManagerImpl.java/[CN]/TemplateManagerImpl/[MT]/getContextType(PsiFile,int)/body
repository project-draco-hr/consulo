{
  FileType fileType=file.getFileType();
  if (fileType == StdFileTypes.XML) {
    return TemplateContext.XML_CONTEXT;
  }
  if (fileType == StdFileTypes.HTML) {
    return TemplateContext.HTML_CONTEXT;
  }
  if (fileType == StdFileTypes.JSP || fileType == StdFileTypes.JSPX) {
    final Language language=PsiUtil.getLanguageAtOffset(file,offset);
    if (language != null && language.equals(StdLanguages.JAVA))     return TemplateContext.JAVA_CODE_CONTEXT;
    return TemplateContext.JSP_CONTEXT;
  }
  if (fileType == StdFileTypes.JAVA) {
    PsiElement element=file.findElementAt(offset);
    if (isInComment(element)) {
      return TemplateContext.JAVA_COMMENT_CONTEXT;
    }
    if (element instanceof PsiJavaToken) {
      if (((PsiJavaToken)element).getTokenType() == JavaTokenType.STRING_LITERAL) {
        return TemplateContext.JAVA_STRING_CONTEXT;
      }
    }
    return TemplateContext.JAVA_CODE_CONTEXT;
  }
  return TemplateContext.OTHER_CONTEXT;
}
