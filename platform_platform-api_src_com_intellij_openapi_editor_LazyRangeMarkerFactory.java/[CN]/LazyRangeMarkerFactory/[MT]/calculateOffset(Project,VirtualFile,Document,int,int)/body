{
  int offset;
  if (line < document.getLineCount()) {
    final int lineStart=document.getLineStartOffset(line);
    final int lineEnd=document.getLineEndOffset(line);
    final CharSequence docText=document.getCharsSequence();
    final int tabSize=CodeStyleFacade.getInstance(project).getTabSize(FileTypeManager.getInstance().getFileTypeByFile(file));
    offset=lineStart;
    int col=0;
    while (offset < lineEnd && col < column) {
      col+=(docText.charAt(offset) == '\t' ? tabSize : 1);
      offset++;
    }
  }
 else {
    offset=document.getTextLength();
  }
  return offset;
}
