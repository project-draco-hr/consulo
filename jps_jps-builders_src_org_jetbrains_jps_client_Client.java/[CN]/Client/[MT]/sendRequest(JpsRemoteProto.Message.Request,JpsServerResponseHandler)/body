{
  final UUID sessionUUID=UUID.randomUUID();
  final RequestFuture requestFuture=handler != null ? new CancelableRequestFuture(handler,sessionUUID) : new RequestFuture(handler,sessionUUID);
  myHandlers.put(sessionUUID,requestFuture);
  final ChannelFuture channelFuture=Channels.write(myConnectFuture.getChannel(),ProtoUtil.toMessage(sessionUUID,request));
  channelFuture.addListener(new ChannelFutureListener(){
    public void operationComplete(    ChannelFuture future) throws Exception {
      if (!future.isSuccess()) {
        try {
          myHandlers.remove(sessionUUID);
          if (handler != null) {
            handler.sessionTerminated();
          }
        }
  finally {
          requestFuture.setDone();
        }
      }
    }
  }
);
  return requestFuture;
}
