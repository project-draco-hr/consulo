{
  if (!SystemInfo.areSymLinksSupported) {
    System.out.println("Test not passed");
    return;
  }
  final File missingFile=new File(FileUtil.getTempDirectory(),"missing_file");
  assertTrue(missingFile.getAbsolutePath(),!missingFile.exists() || missingFile.delete());
  final File missingLinkFile=createTempLink(missingFile.getAbsolutePath(),"missing_link");
  final VirtualFile missingLinkVFile=refreshAndFind(missingLinkFile);
  assertNull(missingLinkVFile);
  final File selfLinkFile=createTempLink("self_link","self_link");
  final VirtualFile selfLinkVFile=refreshAndFind(selfLinkFile);
  assertNull(selfLinkVFile);
  final File pointLinkFile=createTempLink(".","point_link");
  final VirtualFile pointLinkVFile=refreshAndFind(pointLinkFile);
  assertNotNull(pointLinkVFile);
  assertEquals(0,pointLinkVFile.getChildren().length);
  final File circularDir1=FileUtil.createTempDirectory("dir1.",null);
  final File circularDir2=FileUtil.createTempDirectory("dir2.",null);
  final File circularLink1=createTempLink(circularDir2.getAbsolutePath(),circularDir1 + File.separator + "link");
  final File circularLink2=createTempLink(circularDir1.getAbsolutePath(),circularDir2 + File.separator + "link");
  final VirtualFile circularLink1VFile=refreshAndFind(circularLink1);
  final VirtualFile circularLink2VFile=refreshAndFind(circularLink2);
  assertNotNull(circularLink1VFile);
  assertNotNull(circularLink2VFile);
  assertEquals(1,circularLink1VFile.getChildren().length);
  assertEquals(1,circularLink2VFile.getChildren().length);
  if (!VirtualDirectoryImpl.ALT_SYMLINK_HANDLING) {
    assertEquals(0,circularLink1VFile.getChildren()[0].getChildren().length);
    assertEquals(0,circularLink2VFile.getChildren()[0].getChildren().length);
  }
}
