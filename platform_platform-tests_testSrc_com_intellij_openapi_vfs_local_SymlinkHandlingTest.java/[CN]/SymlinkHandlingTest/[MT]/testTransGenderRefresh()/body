{
  if (!SystemInfo.areSymLinksSupported)   return;
  final File targetFile=FileUtil.createTempFile("target","");
  final File targetDir=FileUtil.createTempDirectory("targetDir","");
  File link=createTempLink(targetFile.getAbsolutePath(),"link");
  VirtualFile vFile1=refreshAndFind(link);
  assertTrue("link=" + link + ", vLink="+ vFile1,vFile1 != null && !vFile1.isDirectory() && vFile1.isSymLink());
  assertTrue(link.getAbsolutePath(),link.delete() && link.mkdir() && link.isDirectory());
  VirtualFile vFile2=refreshAndFind(link);
  assertTrue("link=" + link + ", vLink="+ vFile2,!vFile1.isValid() && vFile2 != null && vFile2.isDirectory() && !vFile2.isSymLink());
  assertTrue(link.getAbsolutePath(),link.delete());
  link=createTempLink(targetDir.getAbsolutePath(),"link");
  vFile1=refreshAndFind(link);
  assertTrue("link=" + link + ", vLink="+ vFile1,!vFile2.isValid() && vFile1 != null && vFile1.isDirectory() && vFile1.isSymLink());
  assertTrue(link.getAbsolutePath(),link.delete() && link.createNewFile() && link.isFile());
  vFile2=refreshAndFind(link);
  assertTrue("link=" + link + ", vLink="+ vFile1,!vFile1.isValid() && vFile2 != null && !vFile2.isDirectory() && !vFile2.isSymLink());
  assertTrue(link.getAbsolutePath(),link.delete());
  link=createTempLink(targetFile.getAbsolutePath(),"link");
  vFile1=refreshAndFind(link);
  assertTrue("link=" + link + ", vLink="+ vFile1,!vFile2.isValid() && vFile1 != null && !vFile1.isDirectory() && vFile1.isSymLink());
}
