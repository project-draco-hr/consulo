{
  final File targetFile=createTempFile(myTempDir,"target","");
  final File targetDir=createTempDirectory(myTempDir,"targetDir","");
  File link=IoTestUtil.createSymLink(targetFile.getPath(),myTempDir + "/link");
  VirtualFile vFile1=refreshAndFind(link);
  assertTrue("link=" + link + ", vLink="+ vFile1,vFile1 != null && !vFile1.isDirectory() && vFile1.isSymLink());
  assertTrue(link.getPath(),link.delete() && link.mkdir() && link.isDirectory());
  VirtualFile vFile2=refreshAndFind(link);
  assertTrue("link=" + link + ", vLink="+ vFile2,!vFile1.isValid() && vFile2 != null && vFile2.isDirectory() && !vFile2.isSymLink());
  assertTrue(link.getPath(),link.delete());
  link=IoTestUtil.createSymLink(targetDir.getPath(),myTempDir + "/link");
  vFile1=refreshAndFind(link);
  assertTrue("link=" + link + ", vLink="+ vFile1,!vFile2.isValid() && vFile1 != null && vFile1.isDirectory() && vFile1.isSymLink());
  assertTrue(link.getPath(),link.delete() && link.createNewFile() && link.isFile());
  vFile2=refreshAndFind(link);
  assertTrue("link=" + link + ", vLink="+ vFile1,!vFile1.isValid() && vFile2 != null && !vFile2.isDirectory() && !vFile2.isSymLink());
  assertTrue(link.getPath(),link.delete());
  link=IoTestUtil.createSymLink(targetFile.getPath(),myTempDir + "/link");
  vFile1=refreshAndFind(link);
  assertTrue("link=" + link + ", vLink="+ vFile1,!vFile2.isValid() && vFile1 != null && !vFile1.isDirectory() && vFile1.isSymLink());
}
