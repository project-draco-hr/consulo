{
  File targetFile=createTestFile(myTempDir,"target");
  File linkFile=createSymLink(targetFile.getPath(),myTempDir + "/link");
  VirtualFile linkVFile=refreshAndFind(linkFile);
  assertTrue("link=" + linkFile + ", vLink="+ linkVFile,linkVFile != null && !linkVFile.isDirectory() && linkVFile.is(VFileProperty.SYMLINK));
  AccessToken token=ApplicationManager.getApplication().acquireWriteActionLock(getClass());
  try {
    linkVFile.delete(this);
  }
  finally {
    token.finish();
  }
  assertFalse(linkVFile.toString(),linkVFile.isValid());
  assertFalse(linkFile.exists());
  assertTrue(targetFile.exists());
  File targetDir=createTestDir(myTempDir,"targetDir");
  File childFile=new File(targetDir,"child.txt");
  assertTrue(childFile.getPath(),childFile.exists() || childFile.createNewFile());
  File linkDir=createSymLink(targetDir.getPath(),myTempDir + "/linkDir");
  VirtualFile linkVDir=refreshAndFind(linkDir);
  assertTrue("link=" + linkDir + ", vLink="+ linkVDir,linkVDir != null && linkVDir.isDirectory() && linkVDir.is(VFileProperty.SYMLINK) && linkVDir.getChildren().length == 1);
  token=ApplicationManager.getApplication().acquireWriteActionLock(getClass());
  try {
    linkVDir.delete(this);
  }
  finally {
    token.finish();
  }
  assertFalse(linkVDir.toString(),linkVDir.isValid());
  assertFalse(linkDir.exists());
  assertTrue(targetDir.exists());
  assertTrue(childFile.exists());
}
