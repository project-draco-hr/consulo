{
  final File file=createTempFile(myTempDir,"file.",".txt");
  final VirtualFile vFile=refreshAndFind(file);
  assertNotNull(file.getPath(),vFile);
  assertTrue(file.getPath(),vFile.isValid());
  final File link1=createTempLink(file.getPath(),myTempDir + "/link1-" + file.getName());
  final File link2=createTempLink(file.getPath(),myTempDir + "/link2-" + link1.getName());
  final VirtualFile vLink=refreshAndFind(link2);
  assertNotNull(link2.getPath(),vLink);
  assertTrue(link2.getPath(),vLink.isValid());
  String fileContent=VfsUtilCore.loadText(vFile);
  assertEquals("",fileContent);
  String linkContent=VfsUtilCore.loadText(vLink);
  assertEquals("",linkContent);
  fileContent="new content";
  vFile.setBinaryContent(fileContent.getBytes());
  assertEquals(fileContent.length(),vLink.getLength());
  assertEquals(fileContent.length(),vFile.getLength());
  linkContent=VfsUtilCore.loadText(vLink);
  assertEquals(fileContent,linkContent);
  linkContent="newer content";
  vLink.setBinaryContent(linkContent.getBytes());
  assertEquals(linkContent.length(),vLink.getLength());
  assertEquals(linkContent.length(),vFile.getLength());
  fileContent=VfsUtilCore.loadText(vFile);
  assertEquals(linkContent,fileContent);
  final String extContent="changed externally";
  FileUtil.writeToFile(file,extContent.getBytes());
  refresh();
  assertEquals(extContent.length(),vFile.getLength());
  assertEquals(extContent.length(),vLink.getLength());
  fileContent=VfsUtilCore.loadText(vFile);
  linkContent=VfsUtilCore.loadText(vLink);
  assertEquals(extContent,fileContent);
  assertEquals(extContent,linkContent);
}
