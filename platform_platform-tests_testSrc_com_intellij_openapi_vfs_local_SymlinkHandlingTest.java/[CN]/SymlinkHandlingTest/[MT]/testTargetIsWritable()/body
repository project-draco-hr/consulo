{
  final File targetFile=FileUtil.createTempFile("target","");
  final File linkFile=createTempLink(targetFile.getAbsolutePath(),"link");
  final VirtualFile linkVFile=refreshAndFind(linkFile);
  assertTrue("link=" + linkFile + ", vLink="+ linkVFile,linkVFile != null && !linkVFile.isDirectory() && linkVFile.isSymLink());
  assertTrue(targetFile.getAbsolutePath(),targetFile.setWritable(true,false) && targetFile.canWrite());
  refresh();
  assertTrue(linkVFile.getPath(),linkVFile.isWritable());
  assertTrue(targetFile.getAbsolutePath(),targetFile.setWritable(false,false) && !targetFile.canWrite());
  refresh();
  assertFalse(linkVFile.getPath(),linkVFile.isWritable());
  final File targetDir=FileUtil.createTempDirectory("targetDir","");
  final File linkDir=createTempLink(targetDir.getAbsolutePath(),"linkDir");
  final VirtualFile linkVDir=refreshAndFind(linkDir);
  assertTrue("link=" + linkDir + ", vLink="+ linkVDir,linkVDir != null && linkVDir.isDirectory() && linkVDir.isSymLink());
  if (!SystemInfo.isWindows) {
    assertTrue(targetDir.getAbsolutePath(),targetDir.setWritable(true,false) && targetDir.canWrite());
    refresh();
    assertTrue(linkVDir.getPath(),linkVDir.isWritable());
    assertTrue(targetDir.getAbsolutePath(),targetDir.setWritable(false,false) && !targetDir.canWrite());
    refresh();
    assertFalse(linkVDir.getPath(),linkVDir.isWritable());
  }
 else {
    assertEquals(linkVDir.getPath(),targetDir.canWrite(),linkVDir.isWritable());
  }
}
