{
  indicator.checkCanceled();
  List<Line> lines1=getLines(text1,policy);
  List<Line> lines2=getLines(text2,policy);
  FairDiffIterable changes=compareSmart(lines1,lines2,indicator);
  changes=optimizeLineChunks(lines1,lines2,changes,indicator);
  changes=expandRanges(lines1,lines2,changes,indicator);
  return convertIntoFragments(lines1,lines2,changes);
}
