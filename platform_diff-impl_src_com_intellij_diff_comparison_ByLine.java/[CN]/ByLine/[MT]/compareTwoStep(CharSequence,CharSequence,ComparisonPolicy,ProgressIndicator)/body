{
  indicator.checkCanceled();
  List<Line> lines1=getLines(text1,policy);
  List<Line> lines2=getLines(text2,policy);
  List<Line> iwLines1=convertToIgnoreWhitespace(lines1);
  List<Line> iwLines2=convertToIgnoreWhitespace(lines2);
  FairDiffIterable iwChanges=compareSmart(iwLines1,iwLines2,indicator);
  iwChanges=optimizeLineChunks(lines1,lines2,iwChanges,indicator);
  FairDiffIterable changes=correctChangesSecondStep(lines1,lines2,iwChanges);
  return convertIntoFragments(lines1,lines2,changes);
}
