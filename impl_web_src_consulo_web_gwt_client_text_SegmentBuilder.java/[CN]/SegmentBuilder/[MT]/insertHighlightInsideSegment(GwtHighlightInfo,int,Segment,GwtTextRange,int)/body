{
  GwtTextRange segmentTextRange=segment.getTextRange();
  if (segmentTextRange.equals(highlightTextRange)) {
    if (!(segment instanceof OriginalStyledSegment)) {
      segment=new OriginalStyledSegment(myText,segment.getTextRange());
      mySegments.set(index,segment);
    }
    add((OriginalStyledSegment)segment,highlightInfo,flag);
  }
 else {
    int start=highlightTextRange.getStartOffset() - segmentTextRange.getStartOffset();
    if (start > 0) {
      final int startOffset=segmentTextRange.getStartOffset();
      final int endOffset=highlightTextRange.getStartOffset();
      mySegments.add(index++,new SimpleSegment(new GwtTextRange(startOffset,endOffset),myText.substring(startOffset,endOffset)));
    }
    OriginalStyledSegment element=new OriginalStyledSegment(myText,highlightTextRange);
    copy(segment,element);
    add(element,highlightInfo,flag);
    mySegments.set(index++,element);
    int end=segmentTextRange.getEndOffset() - highlightTextRange.getEndOffset();
    if (end > 0) {
      final int startOffset=highlightTextRange.getEndOffset();
      final int endOffset=segmentTextRange.getEndOffset();
      mySegments.add(index,new SimpleSegment(new GwtTextRange(startOffset,endOffset),myText.substring(startOffset,endOffset)));
    }
  }
}
