{
  if (!(builder instanceof DumbAware) && DumbService.getInstance(root.getProject()).isDumb()) {
    return FoldingDescriptor.EMPTY;
  }
  if (builder instanceof FoldingBuilderEx) {
    return ((FoldingBuilderEx)builder).buildFoldRegions(root,document,quick);
  }
  final ASTNode astNode=root.getNode();
  if (astNode == null || builder == null) {
    return FoldingDescriptor.EMPTY;
  }
  return builder.buildFoldRegions(astNode,document);
}
