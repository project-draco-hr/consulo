{
synchronized (myRangeMarkers) {
    for (Iterator<RangeMarkerEx> rangeMarkerIterator=myRangeMarkers.keySet().iterator(); rangeMarkerIterator.hasNext(); ) {
      try {
        final RangeMarkerEx rangeMarker=rangeMarkerIterator.next();
        if (rangeMarker != null && rangeMarker.isValid()) {
          if (event.getOffset() <= rangeMarker.getEndOffset()) {
            rangeMarker.documentChanged(event);
            if (!rangeMarker.isValid()) {
              rangeMarkerIterator.remove();
              if (myGuardedBlocks.remove(rangeMarker)) {
                LOG.error("Guarded blocks should stay valid: " + rangeMarker);
              }
            }
          }
        }
 else {
          rangeMarkerIterator.remove();
        }
      }
 catch (      Exception e) {
        LOG.error(e);
      }
    }
  }
}
