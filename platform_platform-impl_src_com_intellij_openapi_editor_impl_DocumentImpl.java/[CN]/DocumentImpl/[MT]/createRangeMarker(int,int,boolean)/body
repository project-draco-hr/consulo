{
  ApplicationManagerEx.getApplicationEx().assertReadAccessToDocumentsAllowed();
  if (!(0 <= startOffset && startOffset <= endOffset && endOffset <= getTextLength())) {
    LOG.error("Incorrect offsets startOffset=" + startOffset + ", endOffset="+ endOffset+ ", text length="+ getTextLength());
  }
  RangeMarkerImpl rangeMarker=surviveOnExternalChange ? new PersistentRangeMarker(this,startOffset,endOffset) : new RangeMarkerImpl(this,startOffset,endOffset);
  rangeMarker.registerInDocument();
  return rangeMarker;
}
