{
  final VirtualFile[] files=PlatformDataKeys.VIRTUAL_FILE_ARRAY.getData(dataContext);
  if (files == null || files.length == 0)   return;
  String message=createConfirmationMessage(files);
  int returnValue=Messages.showOkCancelDialog(message,UIBundle.message("delete.dialog.title"),ApplicationBundle.message("button.delete"),CommonBundle.getCancelButtonText(),Messages.getQuestionIcon());
  if (returnValue != 0)   return;
  Arrays.sort(files,FileComparator.getInstance());
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      List<String> problems=ContainerUtil.newLinkedList();
      for (      final VirtualFile file : files) {
        try {
          file.delete(this);
        }
 catch (        IOException e) {
          LOG.info(e);
          problems.add(file.getName());
        }
      }
      if (!problems.isEmpty()) {
        boolean more=false;
        if (problems.size() > 10) {
          problems=problems.subList(0,10);
          more=true;
        }
        Messages.showMessageDialog("Could not erase files or folders:\n  " + StringUtil.join(problems,",\n  ") + (more ? "\n  ..." : ""),UIBundle.message("error.dialog.title"),Messages.getErrorIcon());
      }
    }
  }
);
}
