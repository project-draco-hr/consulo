{
  saveAll();
  ChangeListManager changes=ChangeListManager.getInstance(project);
  for (  VirtualFile file : affectedFiles) {
    Change change=changes.getChange(file);
    if (change != null && change.getFileStatus() != FileStatus.MERGED_WITH_CONFLICTS) {
      File f=new File(file.getPath());
      throw new VcsException(GitBundle.message("merge.is.not.needed",f.getAbsolutePath()));
    }
  }
  AbstractVcsHelper.getInstance(project).showMergeDialog(Arrays.asList(affectedFiles),vcs.getMergeProvider());
}
