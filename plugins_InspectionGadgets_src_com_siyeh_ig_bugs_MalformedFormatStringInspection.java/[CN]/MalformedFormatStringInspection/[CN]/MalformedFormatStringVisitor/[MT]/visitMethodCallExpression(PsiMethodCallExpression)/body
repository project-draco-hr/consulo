{
  super.visitMethodCallExpression(expression);
  if (!FormatUtils.isFormatCall(expression)) {
    return;
  }
  final PsiExpressionList argumentList=expression.getArgumentList();
  final PsiExpression[] arguments=argumentList.getExpressions();
  if (arguments.length == 0) {
    return;
  }
  final PsiExpression firstArgument=arguments[0];
  final PsiType type=firstArgument.getType();
  if (type == null) {
    return;
  }
  final int formatArgumentIndex;
  if ("java.util.Locale".equals(type.getCanonicalText()) && arguments.length > 1) {
    formatArgumentIndex=1;
  }
 else {
    formatArgumentIndex=0;
  }
  final PsiExpression formatArgument=arguments[formatArgumentIndex];
  if (!TypeUtils.expressionHasType(formatArgument,CommonClassNames.JAVA_LANG_STRING)) {
    return;
  }
  if (!PsiUtil.isConstantExpression(formatArgument)) {
    return;
  }
  final PsiType formatType=formatArgument.getType();
  final String value=(String)ConstantExpressionUtil.computeCastTo(formatArgument,formatType);
  if (value == null) {
    return;
  }
  final int argumentCount=arguments.length - (formatArgumentIndex + 1);
  final Validator[] validators;
  try {
    validators=FormatDecode.decode(value,argumentCount);
  }
 catch (  Exception e) {
    registerError(formatArgument,e);
    return;
  }
  if (validators.length != argumentCount) {
    if (argumentCount == 1) {
      final PsiExpression argument=arguments[formatArgumentIndex + 1];
      final PsiType argumentType=argument.getType();
      if (argumentType instanceof PsiArrayType) {
        return;
      }
    }
    registerError(formatArgument,validators,Integer.valueOf(argumentCount));
    return;
  }
  for (int i=0; i < validators.length; i++) {
    final Validator validator=validators[i];
    final PsiType argumentType=arguments[i + formatArgumentIndex + 1].getType();
    if (!validator.valid(argumentType)) {
      registerError(formatArgument,validators,Integer.valueOf(argumentCount));
      return;
    }
  }
}
