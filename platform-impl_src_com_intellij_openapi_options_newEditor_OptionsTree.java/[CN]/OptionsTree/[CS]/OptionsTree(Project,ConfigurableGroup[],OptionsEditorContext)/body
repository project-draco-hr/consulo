{
  myProject=project;
  myGroups=Arrays.asList(groups);
  myContext=context;
  myRoot=new Root();
  final SimpleTreeStructure structure=new SimpleTreeStructure(){
    public Object getRootElement(){
      return myRoot;
    }
  }
;
  myTree=new MyTree();
  myTree.setBorder(new EmptyBorder(0,1,0,0));
  myTree.setRowHeight(-1);
  myTree.getSelectionModel().setSelectionMode(TreeSelectionModel.SINGLE_TREE_SELECTION);
  myRendrer=new Renderer();
  myTree.setCellRenderer(myRendrer);
  myTree.setRootVisible(false);
  myTree.setShowsRootHandles(false);
  myBuilder=new FilteringTreeBuilder(myProject,myTree,myContext.getFilter(),structure,new WeightBasedComparator(false)){
    @Override protected boolean isSelectable(    final Object nodeObject){
      return nodeObject instanceof EditorNode;
    }
    @Override public boolean isAutoExpandNode(    final NodeDescriptor nodeDescriptor){
      if (nodeDescriptor instanceof SimpleNode) {
        final SimpleNode node=(SimpleNode)getOriginalNode(((SimpleNode)nodeDescriptor));
        if (myContext.isHoldingFilter())         return true;
        if (node.getParent() == myRoot)         return false;
      }
      return super.isAutoExpandNode(nodeDescriptor);
    }
  }
;
  myBuilder.setFilteringMerge(300);
  Disposer.register(this,myBuilder);
  myBuilder.updateFromRoot();
  setLayout(new BorderLayout());
  myTree.addComponentListener(new ComponentAdapter(){
    @Override public void componentResized(    final ComponentEvent e){
      revalidateTree();
    }
    @Override public void componentMoved(    final ComponentEvent e){
      revalidateTree();
    }
    @Override public void componentShown(    final ComponentEvent e){
      revalidateTree();
    }
  }
);
  final JScrollPane scrolls=new JScrollPane(myTree);
  scrolls.setVerticalScrollBarPolicy(ScrollPaneConstants.VERTICAL_SCROLLBAR_ALWAYS);
  add(scrolls,BorderLayout.CENTER);
  mySelection=new MergingUpdateQueue("OptionsTree",150,false,this,this,this).setRestartTimerOnAdd(true);
  myTree.getSelectionModel().addTreeSelectionListener(new TreeSelectionListener(){
    public void valueChanged(    final TreeSelectionEvent e){
      final TreePath path=e.getNewLeadSelectionPath();
      if (path == null) {
        queueSelection(null);
      }
 else {
        final Base base=extractNode(path.getLastPathComponent());
        queueSelection(base != null ? base.getConfigurable() : null);
      }
    }
  }
);
  myTree.addKeyListener(new KeyListener(){
    public void keyTyped(    final KeyEvent e){
      _onTreeKeyEvent(e);
    }
    public void keyPressed(    final KeyEvent e){
      _onTreeKeyEvent(e);
    }
    public void keyReleased(    final KeyEvent e){
      _onTreeKeyEvent(e);
    }
  }
);
}
