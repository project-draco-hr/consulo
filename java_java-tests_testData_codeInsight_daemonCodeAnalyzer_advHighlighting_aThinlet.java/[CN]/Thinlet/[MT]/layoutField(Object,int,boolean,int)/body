{
  int width=getRectangle(component,"bounds").width - left - dw;
  String text=getString(component,"text","");
  int start=getInteger(component,"start",0);
  if (start > text.length()) {
    setInteger(component,"start",start=text.length(),0);
  }
  int end=getInteger(component,"end",0);
  if (end > text.length()) {
    setInteger(component,"end",end=text.length(),0);
  }
  int offset=getInteger(component,"offset",0);
  int off=offset;
  FontMetrics fm=getFontMetrics(getFont());
  int caret=hidden ? (fm.charWidth('*') * end) : fm.stringWidth(text.substring(0,end));
  if (off > caret) {
    off=caret;
  }
 else   if (off < caret - width + 4) {
    off=caret - width + 4;
  }
  off=Math.max(0,Math.min(off,(hidden ? (fm.charWidth('*') * text.length()) : fm.stringWidth(text)) - width + 4));
  if (off != offset) {
    setInteger(component,"offset",off,0);
  }
}
