{
  DiffFragment[] woFormattingBlocks=myDiffPolicy.buildFragments(text1,text2);
  DiffFragment[] step1lineFragments=new DiffCorrection.TrueLineBlocks(myComparisonPolicy).correctAndNormalize(woFormattingBlocks);
  ArrayList<LineFragment> lineBlocks=new DiffFragmentsProcessor().process(step1lineFragments);
  for (  LineFragment lineBlock : lineBlocks) {
    if (lineBlock.isOneSide() || lineBlock.isEqual())     continue;
    String subText1=lineBlock.getText(text1,FragmentSide.SIDE1);
    String subText2=lineBlock.getText(text2,FragmentSide.SIDE2);
    ArrayList<LineFragment> subFragments=findSubFragments(subText1,subText2);
    lineBlock.setChildren(new ArrayList<Fragment>(subFragments));
    lineBlock.adjustTypeFromChildrenTypes();
  }
  return lineBlocks;
}
