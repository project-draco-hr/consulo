{
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    @Override public void run(){
      final int[] selected=myPackagesTable.getSelectedRows();
      boolean upgradeAvailable=false;
      boolean canUninstall=true;
      boolean canUpgrade=true;
      if (myPackageManagementService != null && selected.length != 0) {
        for (int i=0; i != selected.length; ++i) {
          final int index=selected[i];
          if (index >= myPackagesTable.getRowCount())           continue;
          final Object value=myPackagesTable.getValueAt(index,0);
          if (value instanceof InstalledPackage) {
            final InstalledPackage pkg=(InstalledPackage)value;
            if (!canUninstallPackage(pkg)) {
              canUninstall=false;
            }
            if (!canUpgradePackage(pkg)) {
              canUpgrade=false;
            }
            final String pyPackageName=pkg.getName();
            final String availableVersion=(String)myPackagesTable.getValueAt(index,2);
            if (!upgradeAvailable) {
              upgradeAvailable=PackageVersionComparator.VERSION_COMPARATOR.compare(pkg.getVersion(),availableVersion) < 0 && !myCurrentlyInstalling.contains(pyPackageName);
            }
            if (!canUninstall && !canUpgrade)             break;
          }
        }
      }
      myUninstallButton.setEnabled(canUninstall);
      myUpgradeButton.setEnabled(upgradeAvailable && canUpgrade);
    }
  }
,ModalityState.any());
}
