{
  for (  File root : root2Facets.keySet()) {
    ModuleDescriptorNode moduleNode=new ModuleDescriptorNode(moduleDescriptor,root);
    Map<FacetInfo,DetectedFacetsTree.FacetNode> facetInfos=new HashMap<FacetInfo,DetectedFacetsTree.FacetNode>();
    for (    FacetDetectionProcessor.DetectedFacetInfo detectedFacetInfo : root2Facets.get(root)) {
      DetectedFacetsTree.FacetNode parent=null;
      FacetInfo underlyingFacet=detectedFacetInfo.getFacetInfo().getUnderlyingFacet();
      if (underlyingFacet != null) {
        parent=facetInfos.get(underlyingFacet);
      }
      VirtualFile virtualRoot=LocalFileSystem.getInstance().findFileByIoFile(root);
      DetectedFacetsTree.FacetNode detectedFacet=new FacetInfoNode(detectedFacetInfo,virtualRoot,parent);
      facetInfos.put(detectedFacetInfo.getFacetInfo(),detectedFacet);
      if (parent == null) {
        moduleNode.addRootFacet(detectedFacet);
      }
    }
    myModuleNodes.add(moduleNode);
  }
}
