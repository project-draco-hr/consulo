{
  for (  DetectedFacetsTree.FacetNode facetNode : facets) {
    boolean createFacet=createFacets && facetNode.isChecked();
    FacetDetectionProcessor.DetectedFacetInfo detectedFacetInfo=((FacetInfoNode)facetNode).getDetectedFacetInfo();
    FacetInfo facetInfo=detectedFacetInfo.getFacetInfo();
    FacetType type=facetInfo.getFacetType();
    Facet facet=null;
    if (createFacet) {
      facet=FacetManager.getInstance(module).createFacet(type,facetInfo.getName(),facetInfo.getConfiguration(),underlyingFacet);
      FacetDetector facetDetector=detectedFacetInfo.getFacetDetector();
      facetDetector.beforeFacetAdded(facet,facetModel,rootModel);
      facetModel.addFacet(facet);
      createdFacets.add(Pair.create(facetDetector,facet));
    }
 else {
      VirtualFile[] files=facetNode.getFiles();
      String[] urls=new String[files.length];
      for (int i=0; i < files.length; i++) {
        urls[i]=files[i].getUrl();
      }
      FacetAutodetectingManager.getInstance(module.getProject()).disableAutodetectionInFiles(type,module,urls);
    }
    processFacetsInfos(facetNode.getChildren(),module,rootModel,facetModel,facet,createdFacets,createFacet);
  }
}
