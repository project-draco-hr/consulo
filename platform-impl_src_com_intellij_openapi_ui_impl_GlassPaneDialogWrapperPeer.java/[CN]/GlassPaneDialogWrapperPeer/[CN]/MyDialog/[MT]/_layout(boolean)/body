{
  if (myLocation == null || force) {
    final Dimension s=getPreferredSize();
    final Container parent=SwingUtilities.getRootPane(this);
    if (parent != null) {
      final Dimension pd=parent.getSize();
      final DialogWrapper dialogWrapper=myDialogWrapper.get();
      final int width=(int)(s.width * dialogWrapper.getHorizontalStretch());
      final int height=(int)(s.height * dialogWrapper.getVerticalStretch());
      if (myManualLocation) {
        final Point location=getLocation();
        final int x=location.x + s.width > pd.width ? pd.width - s.width : location.x;
        final int y=location.y + s.height > pd.height ? pd.height - s.height : location.y;
        myLocation=new Point(x,y);
        setBounds(x,y,width,height);
      }
 else {
        myLocation=new Point((pd.width - s.width) / 2,(pd.height - s.height) / 2);
        setBounds(myLocation.x,myLocation.y,width,height);
      }
    }
    createShadow();
    myForceRelayout=false;
  }
}
