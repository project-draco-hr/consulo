{
  if (params.length != 1)   return null;
  final Result result=params[0].calculateResult(context);
  if (result == null)   return null;
  PsiDocumentManager.getInstance(context.getProject()).commitAllDocuments();
  if (result instanceof PsiTypeResult) {
    PsiType type=((PsiTypeResult)result).getType();
    if (type instanceof PsiArrayType) {
      return new PsiTypeResult(((PsiArrayType)type).getComponentType(),PsiManager.getInstance(context.getProject()));
    }
  }
  PsiExpression expr=MacroUtil.resultToPsiExpression(result,context);
  PsiType type;
  if (expr == null) {
    type=MacroUtil.resultToPsiType(result,context);
  }
 else {
    type=expr.getType();
  }
  if (type instanceof PsiArrayType) {
    return new PsiTypeResult(((PsiArrayType)type).getComponentType(),PsiManager.getInstance(context.getProject()));
  }
  return new PsiElementResult(null);
}
