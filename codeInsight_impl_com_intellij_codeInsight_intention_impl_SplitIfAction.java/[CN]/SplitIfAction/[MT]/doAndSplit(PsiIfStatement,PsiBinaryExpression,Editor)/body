{
  PsiExpression lOperand=expression.getLOperand();
  PsiExpression rOperand=getROperand(expression);
  PsiManager psiManager=ifStatement.getManager();
  PsiIfStatement subIf=(PsiIfStatement)ifStatement.copy();
  subIf.getCondition().replace(rOperand);
  ifStatement.getCondition().replace(lOperand);
  if (ifStatement.getThenBranch() instanceof PsiBlockStatement) {
    PsiBlockStatement blockStmt=(PsiBlockStatement)psiManager.getElementFactory().createStatementFromText("{}",null);
    blockStmt=(PsiBlockStatement)CodeStyleManager.getInstance(psiManager.getProject()).reformat(blockStmt);
    blockStmt=(PsiBlockStatement)ifStatement.getThenBranch().replace(blockStmt);
    blockStmt.getCodeBlock().add(subIf);
  }
 else {
    ifStatement.getThenBranch().replace(subIf);
  }
  int offset1=ifStatement.getCondition().getTextOffset();
  editor.getCaretModel().moveToOffset(offset1);
  editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
  editor.getSelectionModel().removeSelection();
}
