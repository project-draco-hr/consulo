{
  Project project=null;
  if (ApplicationManager.getApplication() != null && !ApplicationManager.getApplication().isDisposed()) {
    project=CommonDataKeys.PROJECT.getData(DataManager.getInstance().getDataContext(myComponent));
  }
  if (project != null && project.isDefault()) {
    project=null;
  }
  if (mySearchPopup != null) {
    myPopupLayeredPane.remove(mySearchPopup);
    myPopupLayeredPane.validate();
    myPopupLayeredPane.repaint();
    myPopupLayeredPane=null;
    if (myListenerDisposable != null) {
      Disposer.dispose(myListenerDisposable);
    }
    myListenerDisposable=null;
  }
 else   if (searchPopup != null) {
    FeatureUsageTracker.getInstance().triggerFeatureUsed("ui.tree.speedsearch");
  }
  if (!myComponent.isShowing()) {
    mySearchPopup=null;
  }
 else {
    mySearchPopup=searchPopup;
  }
  fireStateChanged();
  if (mySearchPopup == null || !myComponent.isDisplayable())   return;
  if (project != null) {
    myListenerDisposable=Disposer.newDisposable();
    ToolWindowManagerEx toolWindowManager=(ToolWindowManagerEx)ToolWindowManager.getInstance(project);
    toolWindowManager.addToolWindowManagerListener(myWindowManagerListener,myListenerDisposable);
  }
  JRootPane rootPane=myComponent.getRootPane();
  if (rootPane != null) {
    myPopupLayeredPane=rootPane.getLayeredPane();
  }
 else {
    myPopupLayeredPane=null;
  }
  if (myPopupLayeredPane == null) {
    LOG.error(toString() + " in " + myComponent);
    return;
  }
  myPopupLayeredPane.add(mySearchPopup,JLayeredPane.POPUP_LAYER);
  moveSearchPopup();
}
