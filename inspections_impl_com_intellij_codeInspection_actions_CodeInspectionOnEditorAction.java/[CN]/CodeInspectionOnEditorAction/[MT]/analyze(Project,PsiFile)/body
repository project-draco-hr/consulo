{
  FileDocumentManager.getInstance().saveAllDocuments();
  final InspectionManagerEx inspectionManagerEx=(InspectionManagerEx)InspectionManager.getInstance(project);
  final AnalysisScope scope=new AnalysisScope(psiFile);
  inspectionManagerEx.setCurrentScope(scope);
  final InspectionProfileImpl inspectionProfile=DaemonCodeAnalyzerSettings.getInstance().getInspectionProfile(psiFile);
  inspectionManagerEx.setExternalProfile(inspectionProfile);
  inspectionManagerEx.doInspections(scope);
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      inspectionManagerEx.setExternalProfile(null);
    }
  }
);
}
