{
  FileDocumentManager.getInstance().saveAllDocuments();
  final InspectionManagerEx inspectionManagerEx=(InspectionManagerEx)InspectionManager.getInstance(project);
  final AnalysisScope scope=new AnalysisScope(psiFile);
  final GlobalInspectionContextImpl inspectionContext=inspectionManagerEx.createNewGlobalContext(false);
  inspectionContext.setCurrentScope(scope);
  final InspectionProfile inspectionProfile=InspectionProjectProfileManager.getInstance(project).getInspectionProfile(psiFile);
  inspectionContext.setExternalProfile(inspectionProfile);
  inspectionContext.doInspections(scope,inspectionManagerEx);
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      inspectionContext.setExternalProfile(null);
    }
  }
);
}
