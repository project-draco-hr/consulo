{
  final TestUpdateSettings settings=new TestUpdateSettings();
  UpdateStrategy strategy=new UpdateStrategy(BuildNumber.fromString("IU-98.520"),UpdatesInfoXppParserTest.InfoReader.read("idea-same.xml"),settings);
  final CheckForUpdateResult result1=strategy.checkForUpdates();
  Assert.assertEquals(UpdateStrategy.State.LOADED,result1.getState());
  Assert.assertTrue(result1.isReplacedWithAppDef());
  Assert.assertNull(result1.getNewBuildInSelectedChannel());
  settings.setSelectedChannelId(result1.getSelected().getId());
  strategy=new UpdateStrategy(BuildNumber.fromString("IU-98.520"),UpdatesInfoXppParserTest.InfoReader.read("idea-same.xml"),settings);
  final CheckForUpdateResult result2=strategy.checkForUpdates();
  Assert.assertEquals(UpdateStrategy.State.LOADED,result2.getState());
  Assert.assertFalse(result2.isReplacedWithAppDef());
  Assert.assertNull(result2.getNewBuildInSelectedChannel());
  Assert.assertEquals(settings.getAppDefaultChannelId(),settings.getSelectedChannelId());
}
