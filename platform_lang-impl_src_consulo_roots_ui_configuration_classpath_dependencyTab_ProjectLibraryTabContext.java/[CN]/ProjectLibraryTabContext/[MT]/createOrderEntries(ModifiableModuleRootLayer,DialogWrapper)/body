{
  Object[] selectedValues=myLibraryList.getSelectedValues();
  List<OrderEntry> entries=new ArrayList<OrderEntry>(selectedValues.length);
  for (  Object selectedValue : selectedValues) {
    Library item=(Library)selectedValue;
    final OrderEntry[] orderEntries=layer.getOrderEntries();
    for (    OrderEntry orderEntry : orderEntries) {
      if (orderEntry instanceof LibraryOrderEntry) {
        final LibraryOrderEntry libraryOrderEntry=(LibraryOrderEntry)orderEntry;
        if (item.equals(libraryOrderEntry.getLibrary())) {
          continue;
        }
        String name=item.getName();
        if (name != null && name.equals(libraryOrderEntry.getLibraryName())) {
          if (orderEntry.isValid()) {
            Messages.showErrorDialog(ProjectBundle.message("classpath.message.library.already.added",item.getName()),ProjectBundle.message("classpath.title.adding.dependency"));
            return null;
          }
 else {
            layer.removeOrderEntry(orderEntry);
          }
        }
      }
    }
    final LibraryOrderEntry orderEntry=layer.addLibraryEntry(item);
    DependencyScope defaultScope=getDefaultScope(item);
    if (defaultScope != null) {
      orderEntry.setScope(defaultScope);
    }
    entries.add(orderEntry);
  }
  return entries;
}
