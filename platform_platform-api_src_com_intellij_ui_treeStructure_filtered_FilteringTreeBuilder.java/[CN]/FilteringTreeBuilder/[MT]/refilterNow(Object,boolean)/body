{
  final ActionCallback result=new ActionCallback();
  ((FilteringTreeStructure)getTreeStructure()).refilter();
  updateFromRoot();
  getReady(this).doWhenDone(new Runnable(){
    public void run(){
      System.out.println("ready=" + getUi().isReady() + " preferred="+ preferredSelection);
      if (adjustSelection && preferredSelection != null) {
        FilteringTreeStructure.Node node=((FilteringTreeStructure)getTreeStructure()).getVisibleNodeFor(preferredSelection);
        if (node != null) {
          select(node,new Runnable(){
            public void run(){
              result.setDone();
            }
          }
);
        }
      }
 else {
        result.setDone();
      }
    }
  }
);
  return result;
}
