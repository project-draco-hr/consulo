{
  final ActionCallback result=new ActionCallback();
  getFilteredStructure().refilter();
  updateFromRoot();
  getReady(this).doWhenDone(new Runnable(){
    public void run(){
      Object toSelect=preferredSelection != null ? preferredSelection : myLastSuccessfulSelect;
      if (adjustSelection && toSelect != null) {
        final FilteringTreeStructure.Node nodeToSelect=getFilteredStructure().getVisibleNodeFor(toSelect);
        if (nodeToSelect != null) {
          select(nodeToSelect,new Runnable(){
            public void run(){
              if (getSelectedElements().contains(nodeToSelect)) {
                myLastSuccessfulSelect=getOriginalNode(nodeToSelect);
              }
              result.setDone();
            }
          }
);
        }
      }
 else {
        result.setDone();
      }
    }
  }
);
  return result;
}
