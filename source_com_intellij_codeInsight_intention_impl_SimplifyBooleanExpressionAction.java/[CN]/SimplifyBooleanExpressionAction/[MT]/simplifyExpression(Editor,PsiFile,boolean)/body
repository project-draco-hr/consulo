{
  int offset=editor.getCaretModel().getOffset();
  PsiElement element=file.findElementAt(offset);
  if (element == null)   return null;
  PsiExpression expression=PsiTreeUtil.getParentOfType(element,PsiExpression.class);
  if (expression == null)   return null;
  while (expression.getParent() instanceof PsiExpression) {
    expression=(PsiExpression)expression.getParent();
  }
  final PsiExpression newExpression=SimplifyBooleanExpressionFix.canBeSimplified(expression);
  return replace ? (PsiExpression)expression.replace(newExpression) : newExpression;
}
