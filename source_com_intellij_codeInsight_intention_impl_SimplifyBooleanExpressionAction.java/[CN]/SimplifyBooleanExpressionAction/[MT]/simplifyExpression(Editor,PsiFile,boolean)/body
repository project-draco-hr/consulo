{
  int offset=editor.getCaretModel().getOffset();
  PsiElement element=file.findElementAt(offset);
  if (element == null)   return null;
  PsiExpression expression=PsiTreeUtil.getParentOfType(element,PsiExpression.class);
  if (expression == null)   return null;
  final Boolean constBoolean=SimplifyBooleanExpressionFix.getConstBoolean(expression);
  if (constBoolean == null)   return null;
  PsiExpression topexpression=expression;
  while (topexpression.getParent() instanceof PsiExpression) {
    topexpression=(PsiExpression)topexpression.getParent();
  }
  if (topexpression == expression)   return null;
  final SimplifyBooleanExpressionFix fix=new SimplifyBooleanExpressionFix(topexpression,constBoolean.booleanValue());
  final PsiExpression newExpression=fix.simplifyExpression(topexpression);
  if (Comparing.strEqual(newExpression.getText(),topexpression.getText()))   return null;
  return replace ? (PsiExpression)topexpression.replace(newExpression) : newExpression;
}
