{
  final TextRange range=ElementManipulators.getValueTextRange(psiElement);
  final String elementText=psiElement.getText();
  int offset=getOffset(psiElement,range.getStartOffset(),elementText);
  if (offset == -1 || offset >= elementText.length()) {
    return false;
  }
  if (elementText.charAt(offset) == '#') {
    final int pos=elementText.indexOf('?',offset);
    final String anchor=pos == -1 ? elementText.substring(offset + 1,range.getEndOffset()) : elementText.substring(offset + 1,pos);
    references.add(new AnchorReference(anchor,null,psiElement,offset + 1,soft));
    return false;
  }
  FileReference fileReference=findFileReference(references);
  if (fileReference != null && fileReference.resolve() != null) {
    final int i=elementText.indexOf('#',offset);
    if (i >= 0) {
      final int pos=elementText.indexOf('?',i);
      final String anchor=pos == -1 ? elementText.substring(i + 1,range.getEndOffset()) : elementText.substring(i + 1,pos);
      references.add(new AnchorReference(anchor,fileReference,psiElement,range.getStartOffset() + i,soft));
    }
  }
  return false;
}
