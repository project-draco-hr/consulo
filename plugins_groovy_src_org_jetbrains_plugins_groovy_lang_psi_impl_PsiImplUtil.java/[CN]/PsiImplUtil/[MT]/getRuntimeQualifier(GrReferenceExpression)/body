{
  GrExpression qualifier=refExpr.getQualifierExpression();
  if (qualifier == null) {
    GrClosableBlock closure=PsiTreeUtil.getParentOfType(refExpr,GrClosableBlock.class);
    while (closure != null) {
      GrExpression funExpr=null;
      PsiElement parent=closure.getParent();
      if (parent instanceof GrApplicationStatement) {
        funExpr=((GrApplicationStatement)parent).getFunExpression();
      }
 else       if (parent instanceof GrMethodCallExpression) {
        funExpr=((GrMethodCallExpression)parent).getInvokedExpression();
      }
      if (funExpr instanceof GrReferenceExpression) {
        qualifier=((GrReferenceExpression)funExpr).getQualifierExpression();
        if (qualifier != null)         break;
      }
      closure=PsiTreeUtil.getParentOfType(closure,GrClosableBlock.class);
    }
  }
  return qualifier;
}
