{
  final T oldQualifier=ref.getQualifier();
  final ASTNode node=ref.getNode();
  final PsiElement refNameElement=ref.getReferenceNameElement();
  if (newQualifier == null) {
    if (oldQualifier != null && refNameElement != null) {
      ref.deleteChildRange(ref.getFirstChild(),refNameElement.getPrevSibling());
    }
  }
 else {
    if (oldQualifier == null) {
      if (refNameElement != null) {
        node.addLeaf(GroovyTokenTypes.mDOT,".",refNameElement.getNode());
        ref.addBefore(newQualifier,refNameElement.getPrevSibling());
      }
    }
 else {
      oldQualifier.replace(newQualifier);
    }
  }
}
