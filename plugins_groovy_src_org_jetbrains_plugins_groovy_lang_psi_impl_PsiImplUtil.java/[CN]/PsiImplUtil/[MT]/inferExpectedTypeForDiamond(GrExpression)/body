{
  PsiElement pparent=PsiUtil.skipParentheses(diamondNew,true).getParent();
  if (pparent instanceof GrAssignmentExpression && PsiTreeUtil.isAncestor(((GrAssignmentExpression)pparent).getRValue(),diamondNew,false)) {
    GrExpression lValue=((GrAssignmentExpression)pparent).getLValue();
    if (PsiUtil.mightBeLValue(lValue)) {
      return lValue.getNominalType();
    }
  }
 else   if (pparent instanceof GrVariable && ((GrVariable)pparent).getInitializerGroovy() == diamondNew) {
    return ((GrVariable)pparent).getDeclaredType();
  }
 else   if (pparent instanceof GrListOrMap) {
    PsiElement ppparent=PsiUtil.skipParentheses(pparent.getParent(),true);
    if (ppparent instanceof GrAssignmentExpression && PsiTreeUtil.isAncestor(((GrAssignmentExpression)ppparent).getRValue(),pparent,false)) {
      PsiElement lValue=PsiUtil.skipParentheses(((GrAssignmentExpression)ppparent).getLValue(),false);
      if (lValue instanceof GrTupleExpression) {
        GrExpression[] initializers=((GrListOrMap)pparent).getInitializers();
        int index=ArrayUtil.find(initializers,diamondNew);
        GrExpression[] expressions=((GrTupleExpression)lValue).getExpressions();
        if (index < expressions.length) {
          return expressions[index].getNominalType();
        }
      }
    }
  }
  return null;
}
