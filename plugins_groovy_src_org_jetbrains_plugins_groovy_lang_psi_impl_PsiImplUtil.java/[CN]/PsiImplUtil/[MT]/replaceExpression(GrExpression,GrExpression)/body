{
  if (oldExpr.getParent() == null || oldExpr.getParent().getNode() == null || newExpr.getNode() == null) {
    throw new IncorrectOperationException();
  }
  if (oldExpr.getParent() instanceof GrParenthesizedExpr && newExpr instanceof GrReferenceExpression) {
    return ((GrExpression)oldExpr.getParent()).replaceWithExpression(newExpr);
  }
  ASTNode parentNode=oldExpr.getParent().getNode();
  ASTNode newNode=newExpr.getNode();
  parentNode.replaceChild(oldExpr.getNode(),newNode);
  if (!(newNode.getPsi() instanceof GrExpression)) {
    throw new IncorrectOperationException();
  }
  return ((GrExpression)newNode.getPsi());
}
