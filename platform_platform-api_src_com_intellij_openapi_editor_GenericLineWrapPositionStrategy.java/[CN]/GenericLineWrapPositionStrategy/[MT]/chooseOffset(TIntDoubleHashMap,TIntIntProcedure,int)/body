{
  if (offset2Weight.isEmpty()) {
    return -1;
  }
  final double[] resultingWeight=new double[1];
  final int[] resultingOffset=new int[1];
  offset2Weight.forEachEntry(new TIntDoubleProcedure(){
    @Override public boolean execute(    int offset,    double weight){
      boolean change=false;
      if (comparator.execute(offset,resultingOffset[0])) {
        if (weight >= resultingWeight[0]) {
          change=true;
        }
      }
      if (!change && weight > resultingWeight[0]) {
        change=(offset - startOffset) * weight > (resultingOffset[0] - startOffset) * resultingWeight[0];
      }
      if (change) {
        resultingWeight[0]=weight;
        resultingOffset[0]=offset;
      }
      return true;
    }
  }
);
  return resultingOffset[0];
}
