{
  List<VirtualFile> workQueue=myWorkQueue;
  myWorkQueue=new ArrayList<VirtualFile>();
  if (!workQueue.isEmpty()) {
    ((LocalFileSystemImpl)LocalFileSystem.getInstance()).markSuspicousFilesDirty(workQueue);
    for (    VirtualFile file : workQueue) {
      final NewVirtualFile nvf=(NewVirtualFile)file;
      if (!myIsAsync && !myIsRecursive) {
        nvf.markDirty();
      }
      RefreshWorker worker=new RefreshWorker(file,myIsRecursive);
      worker.scan();
      myEvents.addAll(worker.getEvents());
    }
  }
}
