{
  if (myVisited.contains(tag))   return true;
  myVisited.add(tag);
  if (checkTagName(tag,"element")) {
    if (tag.getAttribute("name") != null) {
      return processor.process(tag);
    }
 else {
      XmlTag referenced=resolveReference(tag.getAttribute("ref"));
      if (referenced != null) {
        return processor.process(referenced);
      }
    }
  }
 else   if (checkTagName(tag,"group")) {
    String value=tag.getAttributeValue("ref");
    if (value != null) {
      XmlTag group=myNsDescriptor.findGroup(value);
      return processTagWithSubTags(group,processor);
    }
  }
 else   if (checkTagName(tag,"restriction","extension")) {
    return processTagWithSubTags(resolveReference(tag.getAttribute("base")),processor) && processTagWithSubTags(tag,processor);
  }
 else {
    return processTagWithSubTags(tag,processor);
  }
  return true;
}
