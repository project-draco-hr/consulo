{
  if (!XmlNSDescriptorImpl.checkSchemaNamespace(tag)) {
    processTagWithSubTags(tag,true);
    return;
  }
  String tagName=tag.getLocalName();
  if (checkTagName(tagName,"element","attribute")) {
    XmlAttribute ref=tag.getAttribute("ref");
    if (ref != null) {
      processTagWithSubTags(resolveReference(ref),false);
    }
 else {
      processTagWithSubTags(tag,false);
    }
  }
 else   if (checkTagName(tagName,"group")) {
    String value=tag.getAttributeValue("ref");
    if (value != null) {
      processTagWithSubTags(myNsDescriptor.findGroup(value),true);
    }
  }
 else   if (checkTagName(tagName,"attributeGroup")) {
    String ref=tag.getAttributeValue("ref");
    if (ref == null)     return;
    XmlTag group=null;
    XmlTag parentTag=tag.getParentTag();
    if (XmlNSDescriptorImpl.equalsToSchemaName(parentTag,"attributeGroup") && ref.equals(parentTag.getAttributeValue("name"))) {
      group=resolveReference(tag.getAttribute("ref"));
    }
    if (group == null)     group=myNsDescriptor.findAttributeGroup(ref);
    processTagWithSubTags(group,true);
  }
 else   if (checkTagName(tagName,"restriction","extension")) {
    processTagWithSubTags(resolveReference(tag.getAttribute("base")),true);
    processTagWithSubTags(tag,true);
  }
 else {
    processTagWithSubTags(tag,true);
  }
}
