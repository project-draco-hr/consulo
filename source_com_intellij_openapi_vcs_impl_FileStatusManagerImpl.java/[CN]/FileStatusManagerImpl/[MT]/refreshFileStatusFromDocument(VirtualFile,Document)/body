{
  if (LOG.isDebugEnabled()) {
    LOG.debug("refreshFileStatusFromDocument: file.getModificationStamp()=" + file.getModificationStamp() + ", document.getModificationStamp()="+ doc.getModificationStamp());
  }
  FileStatus cachedStatus=getCachedStatus(file);
  if (cachedStatus == FileStatus.NOT_CHANGED || file.getModificationStamp() == doc.getModificationStamp()) {
    fileStatusChanged(file);
    final AbstractVcs vcs=myVcsManager.getVcsFor(file);
    if (vcs == null)     return;
    ChangeProvider cp=vcs.getChangeProvider();
    if (cp == null || !cp.isModifiedDocumentTrackingRequired())     return;
    VcsDirtyScopeManager.getInstance(myProject).fileDirty(file);
  }
}
