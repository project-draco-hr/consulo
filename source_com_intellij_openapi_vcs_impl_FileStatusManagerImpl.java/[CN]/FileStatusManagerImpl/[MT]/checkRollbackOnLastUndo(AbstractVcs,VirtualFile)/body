{
  final CheckinEnvironment checkinEnvironment=vcs.getCheckinEnvironment();
  if (vcs.isRollbackOnLastUndo() && checkinEnvironment != null && !((ReadonlyStatusHandlerImpl)ReadonlyStatusHandlerImpl.getInstance(myProject)).SHOW_DIALOG) {
    Change change=ChangeListManager.getInstance(myProject).getChange(file);
    if (change != null) {
      List<VcsException> exceptions=checkinEnvironment.rollbackChanges(Collections.singletonList(change));
      if (exceptions.isEmpty()) {
        file.refresh(true,false,new Runnable(){
          public void run(){
            fileStatusChanged(file);
            VcsDirtyScopeManager.getInstance(myProject).fileDirty(file);
          }
        }
);
        return true;
      }
    }
  }
  return false;
}
