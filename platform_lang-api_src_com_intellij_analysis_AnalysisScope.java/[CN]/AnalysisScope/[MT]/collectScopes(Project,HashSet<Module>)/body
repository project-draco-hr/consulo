{
  if (modules.isEmpty()) {
    return new AnalysisScope[]{new AnalysisScope(defaultProject)};
  }
  final HashSet<AnalysisScope> result=new HashSet<AnalysisScope>();
  final Module[] allModules=ModuleManager.getInstance(defaultProject).getModules();
  for (  final Module module : modules) {
    Set<Module> modulesToAnalyze=getDirectBackwardDependencies(module,allModules);
    modulesToAnalyze.addAll(getExportBackwardDependencies(module,allModules));
    modulesToAnalyze.add(module);
    result.add(new AnalysisScope(modulesToAnalyze.toArray(new Module[modulesToAnalyze.size()])));
  }
  return result.toArray(new AnalysisScope[result.size()]);
}
