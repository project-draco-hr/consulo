{
  final TextEditorState state=super.getStateImpl(project,editor,level);
  if (FileEditorStateLevel.FULL == level) {
    if (project != null && !editor.isDisposed()) {
      PsiDocumentManager.getInstance(project).commitDocument(editor.getDocument());
      state.FOLDING_STATE=CodeFoldingManager.getInstance(project).saveFoldingState(editor);
    }
 else {
      state.FOLDING_STATE=null;
    }
  }
  return state;
}
