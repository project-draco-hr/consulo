{
  if (myAddedBraces == null)   return;
  for (  PsiCodeBlock codeBlock : myAddedBraces) {
    PsiStatement[] statements=codeBlock.getStatements();
    if (statements.length == 1) {
      final PsiElement codeBlockParent=codeBlock.getParent();
      if (codeBlockParent instanceof PsiLambdaExpression) {
        if (statements[0] instanceof PsiReturnStatement) {
          final PsiExpression returnValue=((PsiReturnStatement)statements[0]).getReturnValue();
          if (returnValue != null) {
            codeBlock.replace(returnValue);
          }
        }
 else         if (statements[0] instanceof PsiExpressionStatement) {
          codeBlock.replace(((PsiExpressionStatement)statements[0]).getExpression());
        }
      }
 else {
        if (codeBlockParent instanceof PsiBlockStatement) {
          codeBlockParent.replace(statements[0]);
        }
 else {
          codeBlock.replace(statements[0]);
        }
      }
    }
  }
  final Set<PsiField> fields=myAddedClassInitializers.keySet();
  for (  PsiField psiField : fields) {
    final PsiClassInitializer classInitializer=myAddedClassInitializers.get(psiField);
    final PsiExpression initializer=getSimpleFieldInitializer(psiField,classInitializer);
    if (initializer != null) {
      psiField.getInitializer().replace(initializer);
      classInitializer.delete();
    }
 else {
      psiField.getInitializer().delete();
    }
  }
}
