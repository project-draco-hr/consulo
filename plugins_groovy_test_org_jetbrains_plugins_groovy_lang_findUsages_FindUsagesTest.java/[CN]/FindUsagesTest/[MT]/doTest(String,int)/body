{
  final PsiReference ref=myFixture.getReferenceAtCaretPosition(filePath);
  assertNotNull("Did not find reference",ref);
  final PsiElement resolved=ref.resolve();
  assertNotNull("Could not resolve reference",resolved);
  final Query<PsiReference> query;
  final GlobalSearchScope projectScope=GlobalSearchScope.projectScope(myFixture.getProject());
  if (resolved instanceof PsiMethod) {
    query=MethodReferencesSearch.search((PsiMethod)resolved,projectScope,true);
  }
 else {
    query=ReferencesSearch.search(resolved,projectScope);
  }
  assertEquals(expectedUsagesCount,query.findAll().size());
}
