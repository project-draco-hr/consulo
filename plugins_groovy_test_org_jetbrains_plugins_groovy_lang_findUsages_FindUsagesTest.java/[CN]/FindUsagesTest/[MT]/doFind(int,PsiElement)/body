{
  FindUsagesManager findUsagesManager=((FindManagerImpl)FindManager.getInstance(getProject())).getFindUsagesManager();
  FindUsagesHandler handler=findUsagesManager.getFindUsagesHandler(resolved,false);
  assertNotNull(handler);
  final FindUsagesOptions options=handler.getFindUsagesOptions();
  final CommonProcessors.CollectProcessor<UsageInfo> processor=new CommonProcessors.CollectProcessor<UsageInfo>();
  for (  PsiElement element : handler.getPrimaryElements()) {
    handler.processElementUsages(element,processor,options);
  }
  for (  PsiElement element : handler.getSecondaryElements()) {
    handler.processElementUsages(element,processor,options);
  }
  assertEquals(expectedUsagesCount,processor.getResults().size());
}
