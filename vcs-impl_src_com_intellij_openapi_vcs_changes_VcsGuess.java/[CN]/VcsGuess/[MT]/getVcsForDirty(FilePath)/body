{
  if (filePath.isNonLocal()) {
    return null;
  }
  final VirtualFile validParent=ChangesUtil.findValidParent(filePath);
  if (validParent == null) {
    return null;
  }
  if (myExcludedFileIndex.isInContent(validParent) || isFileInBaseDir(filePath) || myVcsManager.hasExplicitMapping(filePath)|| isInDirectoryBasedRoot(validParent)) {
    if (myExcludedFileIndex.isExcludedFile(validParent)) {
      return null;
    }
    return myVcsManager.getVcsFor(validParent);
  }
  return null;
}
