{
  final ExecutorService taskRunner=Executors.newFixedThreadPool(Runtime.getRuntime().availableProcessors());
  final EmbeddedJavac javac=new EmbeddedJavac(taskRunner);
  final File srcRoot=new File("C:/tmp/MoveClassProblem/util/src");
  final List<File> sources=new ArrayList<File>();
  collectFiles(srcRoot,sources,new FileFilter(){
    public boolean accept(    File pathname){
      return pathname.getName().endsWith(".java");
    }
  }
);
  final File outputDir=new File("C:/tmp/MoveClassProblem/util/_out_");
  outputDir.mkdirs();
  final List<String> options=Arrays.asList(new String[]{});
  javac.compile(sources,options,outputDir,new EmbeddedJavac.OutputConsumer(){
    public void outputLineAvailable(    String line){
      System.out.println("OUTPUT: " + line);
    }
    public void report(    Diagnostic<? extends JavaFileObject> diagnostic){
      System.out.println("DIAGNOSTIC: " + diagnostic.getKind().name() + "/"+ diagnostic.getMessage(Locale.US));
    }
  }
);
  taskRunner.shutdownNow();
}
