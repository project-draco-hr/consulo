{
  if (scope instanceof LocalSearchScope) {
    PsiElement[] scopeElements=((LocalSearchScope)scope).getScope();
    for (    final PsiElement scopeElement : scopeElements) {
      if (PsiTreeUtil.isAncestor(scopeElement,element,false))       return true;
    }
    return false;
  }
 else {
    GlobalSearchScope globalScope=(GlobalSearchScope)scope;
    PsiFile file=element.getContainingFile();
    if (file != null) {
      final PsiElement context=file.getContext();
      if (context != null)       file=context.getContainingFile();
      if (file == null)       return false;
      VirtualFile virtualFile=file.getVirtualFile();
      return virtualFile == null || globalScope.contains(file.getVirtualFile());
    }
 else {
      return true;
    }
  }
}
