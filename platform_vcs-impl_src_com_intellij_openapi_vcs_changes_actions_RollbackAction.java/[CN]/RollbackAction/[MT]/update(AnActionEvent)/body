{
  Project project=e.getData(PlatformDataKeys.PROJECT);
  final boolean visible=project != null && ProjectLevelVcsManager.getInstance(project).hasActiveVcss();
  e.getPresentation().setVisible(visible);
  if (!visible)   return;
  final Change[] leadSelection=e.getData(VcsDataKeys.CHANGE_LEAD_SELECTION);
  final boolean isEnabled=(leadSelection != null && leadSelection.length > 0) || Boolean.TRUE.equals(e.getData(VcsDataKeys.HAVE_LOCALLY_DELETED)) || Boolean.TRUE.equals(e.getData(VcsDataKeys.HAVE_MODIFIED_WITHOUT_EDITING));
  e.getPresentation().setEnabled(isEnabled);
  if (isEnabled) {
    final AbstractVcs[] vcss=ProjectLevelVcsManager.getInstance(project).getAllActiveVcss();
    for (    AbstractVcs vcs : vcss) {
      final RollbackEnvironment rollbackEnvironment=vcs.getRollbackEnvironment();
      if (rollbackEnvironment != null) {
        e.getPresentation().setText(rollbackEnvironment.getRollbackOperationName());
        return;
      }
    }
  }
}
