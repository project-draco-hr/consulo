{
  final boolean isEnabled=isEnabled(e);
  Project project=e.getData(PlatformDataKeys.PROJECT);
  e.getPresentation().setVisible(project != null && ProjectLevelVcsManager.getInstance(project).getAllActiveVcss().length > 0);
  e.getPresentation().setEnabled(isEnabled);
  if (isEnabled) {
    VirtualFile[] files=e.getData(PlatformDataKeys.VIRTUAL_FILE_ARRAY);
    if (files != null) {
      for (      VirtualFile file : files) {
        final AbstractVcs vcs=ProjectLevelVcsManager.getInstance(project).getVcsFor(file);
        if (vcs != null) {
          final RollbackEnvironment rollbackEnvironment=vcs.getRollbackEnvironment();
          if (rollbackEnvironment != null) {
            e.getPresentation().setText(rollbackEnvironment.getRollbackOperationName());
          }
        }
      }
    }
  }
}
