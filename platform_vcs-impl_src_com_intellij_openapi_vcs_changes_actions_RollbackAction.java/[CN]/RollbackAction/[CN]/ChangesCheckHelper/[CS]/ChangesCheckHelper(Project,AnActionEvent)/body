{
  Change[] changes=e.getData(VcsDataKeys.CHANGES);
  if (changes == null) {
    final VirtualFile[] files=e.getData(PlatformDataKeys.VIRTUAL_FILE_ARRAY);
    if (files != null) {
      final ChangeListManager clManager=ChangeListManager.getInstance(project);
      final List<Change> changesList=new LinkedList<Change>();
      for (      VirtualFile vf : files) {
        changesList.addAll(clManager.getChangesIn(vf));
      }
      if (!changesList.isEmpty()) {
        changes=changesList.toArray(new Change[changesList.size()]);
      }
    }
  }
  myChangesSet=changes != null && changes.length > 0;
  if (myChangesSet) {
    if (ChangesUtil.allChangesInOneListOrWholeListsSelected(project,changes)) {
      myChanges=changes;
    }
  }
}
