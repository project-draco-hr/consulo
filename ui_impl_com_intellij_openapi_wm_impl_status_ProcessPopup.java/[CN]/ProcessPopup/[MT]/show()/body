{
  final JPanel component=new JPanel(new BorderLayout()){
    public Dimension getPreferredSize(){
      if (myProcessBox.getComponentCount() > 0) {
        return super.getPreferredSize();
      }
 else {
        final Dimension size=Toolkit.getDefaultToolkit().getScreenSize();
        size.width*=0.3d;
        size.height*=0.3d;
        return size;
      }
    }
  }
;
  component.setFocusable(true);
  component.setBorder(DialogWrapper.ourDefaultBorder);
  component.add(myProcessBox,BorderLayout.NORTH);
  final ComponentPopupBuilder builder=JBPopupFactory.getInstance().createComponentPopupBuilder(component,component);
  builder.addListener(new JBPopupListener(){
    public void onClosed(    final JBPopup popup){
      myProgressPanel.hideProcessPopup();
    }
  }
);
  builder.setMovable(true);
  builder.setResizable(true);
  builder.setTitle(IdeBundle.message("progress.window.title"));
  builder.setDimensionServiceKey("BackgroundProcessPopup2",true);
  builder.setCancelOnClickOutside(false);
  builder.setRequestFocus(true);
  final IconButton hideButton=new IconButton("Hide",IconLoader.getIcon("/general/hideToolWindow.png"),IconLoader.getIcon("/general/hideToolWindow.png"),IconLoader.getIcon("/general/hideToolWindowInactive.png"));
  builder.setCancelButton(hideButton);
  myPopup=builder.createPopup();
  myPopup.showInCenterOf(myProgressPanel.getRootPane());
}
