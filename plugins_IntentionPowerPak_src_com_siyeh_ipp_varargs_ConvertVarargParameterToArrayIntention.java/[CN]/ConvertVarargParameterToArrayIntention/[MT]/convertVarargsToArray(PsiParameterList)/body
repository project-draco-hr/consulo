{
  final PsiParameter[] parameters=parameterList.getParameters();
  if (parameters.length == 0) {
    return;
  }
  final PsiParameter lastParameter=parameters[parameters.length - 1];
  if (lastParameter == null || !lastParameter.isVarArgs()) {
    return;
  }
  final PsiEllipsisType type=(PsiEllipsisType)lastParameter.getType();
  final PsiMethod method=(PsiMethod)parameterList.getParent();
  final Query<PsiReference> query=ReferencesSearch.search(method);
  final PsiType componentType=type.getComponentType();
  final String typeText=componentType.getCanonicalText();
  final int parameterIndex=parameterList.getParameterIndex(lastParameter);
  for (  PsiReference reference : query) {
    final PsiElement referenceElement=reference.getElement();
    if (!(referenceElement instanceof PsiReferenceExpression)) {
      continue;
    }
    final PsiReferenceExpression referenceExpression=(PsiReferenceExpression)referenceElement;
    final PsiMethodCallExpression methodCallExpression=(PsiMethodCallExpression)referenceExpression.getParent();
    modifyCall(methodCallExpression,typeText,parameterIndex);
  }
  final PsiType arrayType=type.toArrayType();
  final PsiManager psiManager=lastParameter.getManager();
  final PsiElementFactory factory=psiManager.getElementFactory();
  final PsiTypeElement newTypeElement=factory.createTypeElement(arrayType);
  final PsiTypeElement typeElement=lastParameter.getTypeElement();
  typeElement.replace(newTypeElement);
}
