{
  String reportFileName="perf_" + ApplicationInfo.getInstance().getBuildNumber() + "_"+ SystemProperties.getUserName()+ "_"+ myDateFormat.format(new Date())+ ".zip";
  final File reportPath=new File(SystemProperties.getUserHome(),reportFileName);
  final File logDir=new File(PathManager.getSystemPath(),"log");
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  try {
    ZipOutputStream zip=new ZipOutputStream(new FileOutputStream(reportPath));
    ZipUtil.addDirToZipRecursively(zip,reportPath,logDir,"",new FileFilter(){
      public boolean accept(      final File pathname){
        if (logDir.equals(pathname.getParentFile())) {
          return pathname.getPath().contains("threadDumps");
        }
        return true;
      }
    }
,null);
    zip.close();
  }
 catch (  IOException ex) {
    Messages.showErrorDialog(project,"Failed to create performance report archive: " + ex.getMessage(),"Submit Performance Report");
    return;
  }
  Messages.showMessageDialog(project,"The performance report has been saved to " + reportPath,"Submit Performance Report",Messages.getInformationIcon());
}
