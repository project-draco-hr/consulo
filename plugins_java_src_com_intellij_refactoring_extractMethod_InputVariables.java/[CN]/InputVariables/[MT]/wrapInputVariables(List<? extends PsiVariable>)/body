{
  final ArrayList<ParameterTablePanel.VariableData> inputData=new ArrayList<ParameterTablePanel.VariableData>(inputVariables.size());
  for (  PsiVariable var : inputVariables) {
    String name=var.getName();
    if (!(var instanceof PsiParameter)) {
      JavaCodeStyleManager codeStyleManager=JavaCodeStyleManager.getInstance(myProject);
      VariableKind kind=codeStyleManager.getVariableKind(var);
      name=codeStyleManager.variableNameToPropertyName(name,kind);
      name=codeStyleManager.propertyNameToVariableName(name,VariableKind.PARAMETER);
    }
    PsiType type=var.getType();
    if (type instanceof PsiEllipsisType) {
      type=((PsiEllipsisType)type).toArrayType();
    }
    final Map<PsiCodeBlock,PsiType> casts=new HashMap<PsiCodeBlock,PsiType>();
    for (    PsiReference reference : ReferencesSearch.search(var,myScope)) {
      final PsiElement element=reference.getElement();
      final PsiElement parent=element.getParent();
      final PsiCodeBlock block=PsiTreeUtil.getParentOfType(parent,PsiCodeBlock.class);
      if (parent instanceof PsiTypeCastExpression) {
        final PsiType currentType=casts.get(block);
        final PsiType castType=((PsiTypeCastExpression)parent).getType();
        casts.put(block,casts.containsKey(block) && currentType == null ? null : getBroaderType(currentType,castType));
      }
 else {
        casts.put(block,null);
      }
    }
    if (!casts.containsValue(null)) {
      PsiType currentType=null;
      for (      PsiType psiType : casts.values()) {
        currentType=getBroaderType(currentType,psiType);
        if (currentType == null) {
          break;
        }
      }
      if (currentType != null) {
        currentType=checkTopLevelInstanceOf(currentType);
        if (currentType != null) {
          type=currentType;
        }
      }
    }
    ParameterTablePanel.VariableData data=new ParameterTablePanel.VariableData(var,type);
    data.name=name;
    data.passAsParameter=true;
    inputData.add(data);
    if (myFoldingAvailable)     myFolding.isParameterFoldable(data,myScope,inputVariables);
  }
  if (myFoldingAvailable) {
    final Set<ParameterTablePanel.VariableData> toDelete=new HashSet<ParameterTablePanel.VariableData>();
    for (int i=inputData.size() - 1; i >= 0; i--) {
      final ParameterTablePanel.VariableData data=inputData.get(i);
      if (myFolding.isParameterSafeToDelete(data,myScope)) {
        toDelete.add(data);
      }
    }
    inputData.removeAll(toDelete);
  }
  return inputData;
}
