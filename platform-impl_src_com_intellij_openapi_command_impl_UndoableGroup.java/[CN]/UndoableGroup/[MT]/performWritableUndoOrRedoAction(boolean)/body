{
  final Iterator<UndoableAction> actions=isUndo ? reverseIterator(myActions.listIterator(myActions.size())) : myActions.iterator();
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      String title;
      String message;
      if (isUndo) {
        title=CommonBundle.message("cannot.undo.dialog.title");
        message=CommonBundle.message("cannot.undo.message");
      }
 else {
        title=CommonBundle.message("cannot.redo.dialog.title");
        message=CommonBundle.message("cannot.redo.message");
      }
      while (actions.hasNext()) {
        UndoableAction undoableAction=actions.next();
        try {
          if (isUndo) {
            undoableAction.undo();
          }
 else {
            undoableAction.redo();
          }
        }
 catch (        UnexpectedUndoException e) {
          if (!ApplicationManager.getApplication().isUnitTestMode()) {
            if (e.getMessage() != null) {
              message+=".\n" + e.getMessage();
            }
            Messages.showMessageDialog(myProject,message,title,Messages.getErrorIcon());
          }
 else {
            LOG.error(e);
          }
        }
      }
    }
  }
);
}
