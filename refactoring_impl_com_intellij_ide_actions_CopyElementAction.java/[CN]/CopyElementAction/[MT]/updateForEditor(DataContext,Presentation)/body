{
  Editor editor=DataKeys.EDITOR.getData(dataContext);
  if (editor == null) {
    presentation.setEnabled(false);
    presentation.setVisible(false);
    return;
  }
  Project project=DataKeys.PROJECT.getData(dataContext);
  PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
  PsiClass topLevelClass=getTopLevelClass(editor,project);
  boolean result=topLevelClass != null && CopyHandler.canCopy(new PsiElement[]{topLevelClass});
  if (!result) {
    result=CopyHandler.canCopy(new PsiElement[]{file});
  }
  presentation.setEnabled(result);
  presentation.setVisible(true);
}
