{
  final Charset charset=detectCharset(virtualFile,bytes);
  final int offset=detectAndSetBOM(virtualFile,bytes);
  final Pair<CharSequence,String> result=convertBytes(bytes,charset,offset);
  if (rememberDetectedSeparators) {
    virtualFile.putUserData(DETECTED_LINE_SEPARATOR_KEY,result.getSecond());
  }
  return result.getFirst();
}
