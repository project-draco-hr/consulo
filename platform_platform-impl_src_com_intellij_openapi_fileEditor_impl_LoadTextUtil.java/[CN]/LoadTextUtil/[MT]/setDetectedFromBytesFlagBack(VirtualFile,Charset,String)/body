{
  if (virtualFile.getBOM() != null) {
    setCharsetWasDetectedFromBytes(virtualFile,true);
    return;
  }
  byte[] content=text.getBytes(charset);
  CharsetToolkit.GuessedEncoding guessedEncoding=new CharsetToolkit(content).guessFromContent(content.length);
  if (guessedEncoding == CharsetToolkit.GuessedEncoding.VALID_UTF8) {
    setCharsetWasDetectedFromBytes(virtualFile,true);
  }
}
