{
  ArrayList<LiveOccurrence> occurrences=new ArrayList<LiveOccurrence>();
  if (myFindModel != null) {
    TextRange r=myFindModel.isGlobal() ? new TextRange(0,Integer.MAX_VALUE) : new TextRange(editor.getSelectionModel().getSelectionStart(),editor.getSelectionModel().getSelectionEnd());
    int offset=r.getStartOffset();
    VirtualFile virtualFile=FileDocumentManager.getInstance().getFile(editor.getDocument());
    ArrayList<FindResult> results=new ArrayList<FindResult>();
    while (true) {
      FindManager findManager=FindManager.getInstance(editor.getProject());
      FindResult result=findManager.findString(editor.getDocument().getCharsSequence(),offset,myFindModel,virtualFile);
      if (!result.isStringFound())       break;
      int newOffset=result.getEndOffset();
      if (offset == newOffset || result.getEndOffset() > r.getEndOffset())       break;
      offset=newOffset;
      results.add(result);
      if (results.size() > myMatchesLimit)       break;
    }
    if (results.size() < myMatchesLimit) {
      if (results.isEmpty()) {
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          @Override public void run(){
            notFound();
          }
        }
);
      }
      findResultsToOccurrences(results,occurrences);
    }
 else {
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        @Override public void run(){
          tooManyMatches();
        }
      }
);
    }
  }
  return occurrences;
}
