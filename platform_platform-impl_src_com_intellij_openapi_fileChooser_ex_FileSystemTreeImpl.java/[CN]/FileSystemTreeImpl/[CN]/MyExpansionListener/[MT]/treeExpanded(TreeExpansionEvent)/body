{
  if (myTreeBuilder == null || !myTreeBuilder.isNodeBeingBuilt(event.getPath()))   return;
  TreePath path=event.getPath();
  DefaultMutableTreeNode node=(DefaultMutableTreeNode)path.getLastPathComponent();
  if (node.getUserObject() instanceof FileNodeDescriptor) {
    FileNodeDescriptor nodeDescriptor=(FileNodeDescriptor)node.getUserObject();
    final FileElement fileDescriptor=nodeDescriptor.getElement();
    final VirtualFile virtualFile=fileDescriptor.getFile();
    if (virtualFile != null) {
      if (!myEverExpanded.contains(virtualFile)) {
        if (virtualFile instanceof NewVirtualFile) {
          ((NewVirtualFile)virtualFile).markDirty();
        }
        myEverExpanded.add(virtualFile);
      }
      AbstractTreeStructure treeStructure=myTreeBuilder.getTreeStructure();
      final boolean async=treeStructure != null && treeStructure.isToBuildChildrenInBackground(virtualFile);
      DumbService.allowStartingDumbModeInside(DumbModePermission.MAY_START_MODAL,new Runnable(){
        @Override public void run(){
          if (virtualFile instanceof NewVirtualFile) {
            RefreshQueue.getInstance().refresh(async,false,null,ModalityState.stateForComponent(myTree),virtualFile);
          }
 else {
            virtualFile.refresh(async,false);
          }
        }
      }
);
    }
  }
}
