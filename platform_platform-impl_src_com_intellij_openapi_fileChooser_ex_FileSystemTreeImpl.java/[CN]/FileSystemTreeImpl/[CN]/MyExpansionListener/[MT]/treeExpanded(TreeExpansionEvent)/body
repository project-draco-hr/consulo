{
  if (myTreeBuilder == null || !myTreeBuilder.isNodeBeingBuilt(event.getPath()))   return;
  TreePath path=event.getPath();
  DefaultMutableTreeNode node=(DefaultMutableTreeNode)path.getLastPathComponent();
  if (node.getUserObject() instanceof FileNodeDescriptor) {
    FileNodeDescriptor nodeDescriptor=(FileNodeDescriptor)node.getUserObject();
    final FileElement fileDescriptor=nodeDescriptor.getElement();
    final VirtualFile virtualFile=fileDescriptor.getFile();
    if (virtualFile != null) {
      if (myTreeBuilder.getTreeStructure().isToBuildChildrenInBackground(virtualFile)) {
        virtualFile.refresh(true,false,new Runnable(){
          @Override public void run(){
            if (myTreeBuilder.isDisposed())             return;
            if (myTreeBuilder.getUi().getExpandedElements().contains(fileDescriptor)) {
              myTreeBuilder.queueUpdateFrom(new FileElement(virtualFile,virtualFile.getName()),false);
            }
          }
        }
,ModalityState.stateForComponent(myTree));
      }
 else {
        virtualFile.refresh(false,false,null,ModalityState.stateForComponent(myTree));
      }
    }
  }
}
