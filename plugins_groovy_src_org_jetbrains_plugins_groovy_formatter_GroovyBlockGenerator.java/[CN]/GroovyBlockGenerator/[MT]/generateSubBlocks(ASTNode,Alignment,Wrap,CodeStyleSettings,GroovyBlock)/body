{
  PsiElement blockPsi=block.getNode().getPsi();
  if (blockPsi instanceof GrBinaryExpression && !(blockPsi.getParent() instanceof GrBinaryExpression)) {
    return generateForBinaryExpr(node,myWrap,mySettings,block.myInnerAlignments);
  }
  if ((block.getNode().getElementType() == mSTRING_LITERAL || block.getNode().getElementType() == mGSTRING_LITERAL) && block.getTextRange().equals(block.getNode().getTextRange())) {
    String text=block.getNode().getText();
    if (text.length() > 6) {
      if (text.substring(0,3).equals("'''") && text.substring(text.length() - 3).equals("'''") || text.substring(0,3).equals("\"\"\"") & text.substring(text.length() - 3).equals("\"\"\"")) {
        return generateForMultiLineString(block.getNode(),myAlignment,myWrap,mySettings);
      }
    }
  }
  if (block.getNode().getElementType() == mGSTRING_BEGIN && block.getTextRange().equals(block.getNode().getTextRange())) {
    String text=block.getNode().getText();
    if (text.length() > 3) {
      if (text.substring(0,3).equals("\"\"\"")) {
        return generateForMultiLineGStringBegin(block.getNode(),myAlignment,myWrap,mySettings);
      }
    }
  }
  if (block.getNode().getElementType() == GSTRING) {
    final ArrayList<Block> subBlocks=new ArrayList<Block>();
    ASTNode[] children=getGroovyChildren(node);
    ASTNode prevChildNode=null;
    for (    ASTNode childNode : children) {
      if (childNode.getTextRange().getLength() > 0) {
        final Indent indent=GroovyIndentProcessor.getChildIndent(block,prevChildNode,childNode);
        subBlocks.add(new GroovyBlock(childNode,myAlignment,indent,myWrap,mySettings));
      }
      prevChildNode=childNode;
    }
    return subBlocks;
  }
  if (NESTED.contains(block.getNode().getElementType()) && blockPsi.getParent() != null && blockPsi.getParent().getNode() != null && !NESTED.contains(blockPsi.getParent().getNode().getElementType())) {
    return generateForNestedExpr(node,myAlignment,myWrap,mySettings);
  }
  if (isListLikeClause(blockPsi)) {
    final ArrayList<Block> subBlocks=new ArrayList<Block>();
    ASTNode prevChildNode=null;
    final Alignment alignment=mustAlign(blockPsi,mySettings,node.getChildren(null)) ? Alignment.createAlignment() : null;
    for (    ASTNode childNode : visibleChildren(node)) {
      final Indent indent=GroovyIndentProcessor.getChildIndent(block,prevChildNode,childNode);
      subBlocks.add(new GroovyBlock(childNode,isKeyword(childNode) ? null : alignment,indent,myWrap,mySettings));
      prevChildNode=childNode;
    }
    return subBlocks;
  }
  if (blockPsi instanceof GrCodeBlock) {
    List<ASTNode> children=visibleChildren(node);
    Map<GrBinaryExpression,Alignment> innerAlignments=calculateInnerAlignments(children);
    final ArrayList<Block> subBlocks=new ArrayList<Block>();
    ASTNode prevChildNode=null;
    for (    ASTNode childNode : children) {
      final Indent indent=GroovyIndentProcessor.getChildIndent(block,prevChildNode,childNode);
      subBlocks.add(new GroovyBlock(childNode,null,indent,myWrap,mySettings,innerAlignments));
      prevChildNode=childNode;
    }
    return subBlocks;
  }
  final ArrayList<Block> subBlocks=new ArrayList<Block>();
  ASTNode prevChildNode=null;
  for (  ASTNode childNode : visibleChildren(node)) {
    final Indent indent=GroovyIndentProcessor.getChildIndent(block,prevChildNode,childNode);
    subBlocks.add(new GroovyBlock(childNode,blockPsi instanceof GrAnonymousClassDefinition ? null : myAlignment,indent,myWrap,mySettings,block.myInnerAlignments));
    prevChildNode=childNode;
  }
  return subBlocks;
}
