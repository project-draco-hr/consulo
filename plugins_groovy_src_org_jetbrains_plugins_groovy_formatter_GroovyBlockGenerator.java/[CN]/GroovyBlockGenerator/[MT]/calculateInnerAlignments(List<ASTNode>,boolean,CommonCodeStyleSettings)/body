{
  Map<PsiElement,Alignment> innerAlignments=CollectionFactory.hashMap();
  List<Alignment> currentGroup=null;
  for (  ASTNode child : children) {
    PsiElement psi=child.getPsi();
    if (psi instanceof GrLabeledStatement) {
      List<LeafPsiElement> table=getSpockTable(((GrLabeledStatement)psi).getStatement());
      if (table.isEmpty()) {
        currentGroup=null;
      }
 else {
        currentGroup=new ArrayList<Alignment>();
        for (        LeafPsiElement expression : table) {
          Alignment alignment=Alignment.createAlignment(true);
          currentGroup.add(alignment);
          ContainerUtil.putIfNotNull(expression,alignment,innerAlignments);
        }
      }
    }
 else     if (currentGroup != null && isTablePart(psi)) {
      List<LeafPsiElement> table=getSpockTable((GrStatement)psi);
      for (int i=0; i < Math.min(table.size(),currentGroup.size()); i++) {
        innerAlignments.put(table.get(i),currentGroup.get(i));
      }
    }
 else     if (psi instanceof GrVariableDeclaration) {
      if (!classLevel || currentGroup == null || fieldGroupEnded(settings,psi)) {
        currentGroup=Arrays.asList(Alignment.createAlignment(true),Alignment.createAlignment(true),Alignment.createAlignment(true));
      }
      GrVariable[] variables=((GrVariableDeclaration)psi).getVariables();
      if (variables.length > 0) {
        Alignment varName=currentGroup.get(1);
        for (        GrVariable variable : variables) {
          innerAlignments.put(variable.getNameIdentifierGroovy(),varName);
        }
        if (classLevel && settings.ALIGN_GROUP_FIELD_DECLARATIONS) {
          ContainerUtil.putIfNotNull(((GrVariableDeclaration)psi).getTypeElementGroovy(),currentGroup.get(0),innerAlignments);
          ASTNode eq=variables[variables.length - 1].getNode().findChildByType(GroovyTokenTypes.mASSIGN);
          if (eq != null) {
            innerAlignments.put(eq.getPsi(),currentGroup.get(2));
          }
        }
      }
    }
 else {
      if (psi instanceof PsiComment) {
        PsiElement prev=psi.getPrevSibling();
        if (prev != null && prev.getNode().getElementType() != mNLS || classLevel && !fieldGroupEnded(settings,psi)) {
          continue;
        }
      }
      currentGroup=null;
    }
  }
  return innerAlignments;
}
