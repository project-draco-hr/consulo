{
  List<AlignmentProvider.Aligner> currentGroup=null;
  for (  ASTNode child : children) {
    PsiElement psi=child.getPsi();
    if (psi instanceof GrLabeledStatement) {
      List<LeafPsiElement> table=getSpockTable(((GrLabeledStatement)psi).getStatement());
      if (table.isEmpty()) {
        currentGroup=null;
      }
 else {
        currentGroup=new ArrayList<AlignmentProvider.Aligner>();
        for (        LeafPsiElement expression : table) {
          currentGroup.add(myAlignmentProvider.createAligner(expression));
        }
      }
    }
 else     if (currentGroup != null && isTablePart(psi)) {
      List<LeafPsiElement> table=getSpockTable((GrStatement)psi);
      for (int i=0; i < Math.min(table.size(),currentGroup.size()); i++) {
        currentGroup.get(i).append(table.get(i));
      }
    }
 else     if (psi instanceof GrVariableDeclaration) {
      final GrVariableDeclaration varDeclaration=(GrVariableDeclaration)psi;
      GrVariable[] variables=varDeclaration.getVariables();
      if (variables.length > 0) {
        if (!classLevel || currentGroup == null || fieldGroupEnded(psi)) {
          currentGroup=new ArrayList<AlignmentProvider.Aligner>();
          currentGroup.add(myAlignmentProvider.createAligner());
          currentGroup.add(myAlignmentProvider.createAligner());
          currentGroup.add(myAlignmentProvider.createAligner());
        }
        AlignmentProvider.Aligner varName=currentGroup.get(1);
        for (        GrVariable variable : variables) {
          varName.append(variable.getNameIdentifierGroovy());
        }
        if (classLevel && mySettings.ALIGN_GROUP_FIELD_DECLARATIONS) {
          final AlignmentProvider.Aligner typeElement=currentGroup.get(0);
          typeElement.append(varDeclaration.getTypeElementGroovy());
          ASTNode current_eq=variables[variables.length - 1].getNode().findChildByType(GroovyTokenTypes.mASSIGN);
          final AlignmentProvider.Aligner eq=currentGroup.get(2);
          if (current_eq != null) {
            eq.append(current_eq.getPsi());
          }
        }
      }
    }
 else {
      if (psi instanceof PsiComment) {
        PsiElement prev=psi.getPrevSibling();
        if (prev != null && prev.getNode().getElementType() != mNLS || classLevel && !fieldGroupEnded(psi)) {
          continue;
        }
      }
      currentGroup=null;
    }
  }
}
