{
  final LayoutTreeComponent treeComponent=myEditor.getPackagingElementsTree();
  final LayoutTreeSelection selection=treeComponent.getSelection();
  final CompositePackagingElement<?> oldParent=selection.getCommonParentElement();
  if (oldParent == null)   return;
  final Function<PackagingElement<?>,PackagingElement<?>> map=treeComponent.ensureRootIsWritable();
  final CompositePackagingElement<?> parent=(CompositePackagingElement<?>)map.fun(oldParent);
  if (parent == null)   return;
  final Collection<? extends PackagingElement> selectedElements=selection.getSelectedElements();
  final String name=Messages.showInputDialog(myEditor.getMainComponent(),ProjectBundle.message("label.text.specify.artifact.name"),ProjectBundle.message("dialog.title.extract.artifact"),null);
  if (name != null) {
    final ModifiableArtifact artifact=myEditor.getContext().getModifiableArtifactModel().addArtifact(name,PlainArtifactType.getInstance());
    for (    PackagingElement<?> element : selectedElements) {
      artifact.getRootElement().addChild(ArtifactUtil.copyWithChildren(element));
    }
    for (    PackagingElement element : selectedElements) {
      parent.removeChild(map.fun(element));
    }
    parent.addChild(new ArtifactPackagingElement(name));
    treeComponent.rebuildTree();
  }
}
