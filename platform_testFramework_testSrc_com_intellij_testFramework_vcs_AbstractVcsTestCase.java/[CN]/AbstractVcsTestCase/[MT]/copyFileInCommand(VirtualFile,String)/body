{
  final AtomicReference<VirtualFile> res=new AtomicReference<VirtualFile>();
  new WriteCommandAction.Simple(myProject){
    @Override protected void run() throws Throwable {
      try {
        res.set(file.copy(this,file.getParent(),toName));
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
    }
  }
.execute();
  return res.get();
}
