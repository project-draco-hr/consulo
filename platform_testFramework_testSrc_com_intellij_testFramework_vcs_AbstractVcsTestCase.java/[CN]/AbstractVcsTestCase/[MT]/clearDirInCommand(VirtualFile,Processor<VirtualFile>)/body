{
  new WriteCommandAction.Simple(myProject){
    @Override protected void run() throws Throwable {
      int numOfRuns=5;
      for (int i=0; i < numOfRuns; i++) {
        try {
          final VirtualFile[] children=dir.getChildren();
          for (          VirtualFile child : children) {
            if (filter != null && filter.process(child)) {
              child.delete(AbstractVcsTestCase.this);
            }
          }
          return;
        }
 catch (        IOException e) {
          if (i == (numOfRuns - 1)) {
            throw e;
          }
          Thread.sleep(50);
          continue;
        }
      }
    }
  }
.execute();
}
