{
  if (getPropertiesFile() != null)   return true;
  final String path=FileUtil.toSystemIndependentName(myPropertiesFile.getText());
  if (StringUtil.isEmptyOrSpaces(path)) {
    String message=CodeInsightBundle.message("i18nize.empty.file.path",myPropertiesFile.getText());
    Messages.showErrorDialog(myProject,message,CodeInsightBundle.message("i18nize.error.creating.properties.file"));
    myPropertiesFile.requestFocusInWindow();
    return false;
  }
  FileType fileType=FileTypeManager.getInstance().getFileTypeByFileName(path);
  if (fileType != StdFileTypes.PROPERTIES) {
    String message=CodeInsightBundle.message("i18nize.cant.create.properties.file.because.its.name.is.associated",myPropertiesFile.getText(),fileType.getDescription());
    Messages.showErrorDialog(myProject,message,CodeInsightBundle.message("i18nize.error.creating.properties.file"));
    myPropertiesFile.requestFocusInWindow();
    return false;
  }
  final VirtualFile virtualFile;
  try {
    final File file=new File(path).getCanonicalFile();
    FileUtil.createParentDirs(file);
    final IOException[] e=new IOException[1];
    virtualFile=ApplicationManager.getApplication().runWriteAction(new Computable<VirtualFile>(){
      public VirtualFile compute(){
        VirtualFile dir=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(file.getParentFile());
        try {
          if (dir == null) {
            throw new IOException("Error creating directory structure for file '" + path + "'");
          }
          return dir.createChildData(this,file.getName());
        }
 catch (        IOException e1) {
          e[0]=e1;
        }
        return null;
      }
    }
);
    if (e[0] != null)     throw e[0];
  }
 catch (  IOException e) {
    Messages.showErrorDialog(myProject,e.getLocalizedMessage(),CodeInsightBundle.message("i18nize.error.creating.properties.file"));
    return false;
  }
  PsiFile psiFile=PsiManager.getInstance(myProject).findFile(virtualFile);
  return psiFile instanceof PropertiesFile;
}
