{
  ASTNode leftNode=child1.getNode();
  ASTNode rightNode=child2.getNode();
  final PsiElement left=leftNode.getPsi();
  final PsiElement right=rightNode.getPsi();
  IElementType leftType=leftNode.getElementType();
  IElementType rightType=rightNode.getElementType();
  if (!mirrorsAst(child1) || !mirrorsAst(child2)) {
    return NO_SPACING;
  }
  if (leftType == mGDOC_COMMENT_START && rightType == mGDOC_COMMENT_DATA || leftType == mGDOC_COMMENT_DATA && rightType == mGDOC_COMMENT_END) {
    return LAZY_SPACING;
  }
  if (mLT == leftType && rightNode.getPsi() instanceof GrTypeParameter || mGT == rightType && leftNode.getPsi() instanceof GrTypeParameter || mIDENT == leftType && rightNode.getPsi() instanceof GrTypeParameterList) {
    return NO_SPACING;
  }
  if (mLPAREN.equals(rightType) && rightNode.getPsi().getParent().getNode() != null && METHOD_DEFS.contains(rightNode.getPsi().getParent().getNode().getElementType())) {
    return NO_SPACING;
  }
  if (ARGUMENTS.equals(rightType)) {
    return NO_SPACING;
  }
  if ((mLBRACK.equals(rightType) && rightNode.getPsi().getParent().getNode() != null && INDEX_OR_ARRAY.contains(rightNode.getPsi().getParent().getNode().getElementType())) || ARRAY_DECLARATOR.equals(rightType)) {
    return NO_SPACING;
  }
  if (METHOD_DEFS.contains(leftType)) {
    if (rightType == mSEMI) {
      return NO_SPACING;
    }
    return Spacing.createSpacing(0,0,settings.BLANK_LINES_AROUND_METHOD + 1,settings.KEEP_LINE_BREAKS,100);
  }
  if (METHOD_DEFS.contains(rightType)) {
    if (leftNode.getElementType() == GROOVY_DOC_COMMENT) {
      return Spacing.createSpacing(0,0,settings.BLANK_LINES_AROUND_METHOD,settings.KEEP_LINE_BREAKS,0);
    }
    return Spacing.createSpacing(0,0,settings.BLANK_LINES_AROUND_METHOD + 1,settings.KEEP_LINE_BREAKS,100);
  }
  if (leftType == mLCURLY && rightType == PARAMETERS_LIST) {
    return LAZY_SPACING;
  }
  if (LEFT_BRACES.contains(leftType) || RIGHT_BRACES.contains(rightType)) {
    PsiElement parent=(LEFT_BRACES.contains(leftType) ? left : right).getParent();
    boolean shouldHaveSpace=parent instanceof GrTypeCastExpression && settings.SPACE_WITHIN_CAST_PARENTHESES;
    return shouldHaveSpace ? COMMON_SPACING : NO_SPACING_WITH_NEWLINE;
  }
  if ((mLT.equals(leftType) || mGT.equals(rightType)) && leftNode.getPsi().getParent() != null && leftNode.getPsi().getParent() instanceof GrTypeArgumentList) {
    return NO_SPACING_WITH_NEWLINE;
  }
  if (rightNode.getPsi() != null && rightNode.getPsi() instanceof GrTypeArgumentList) {
    return NO_SPACING_WITH_NEWLINE;
  }
  if (rightType == mCOLON && left instanceof GrParameter && left.getParent() instanceof GrForInClause) {
    return COMMON_SPACING;
  }
  if ((PUNCTUATION_SIGNS.contains(rightType)) || (mCOLON.equals(rightType) && !(rightNode.getPsi().getParent() instanceof GrConditionalExpression))) {
    return NO_SPACING_WITH_NEWLINE;
  }
  if (DOTS.contains(leftType)) {
    return NO_SPACING_WITH_NEWLINE;
  }
  if (IMPORT_STATEMENT.equals(leftType) && IMPORT_STATEMENT.equals(rightType)) {
    return IMPORT_BETWEEN_SPACING;
  }
  if ((IMPORT_STATEMENT.equals(leftType) && (!IMPORT_STATEMENT.equals(rightType) && !mSEMI.equals(rightType))) || ((!IMPORT_STATEMENT.equals(leftType) && !mSEMI.equals(leftType)) && IMPORT_STATEMENT.equals(rightType))) {
    return IMPORT_OTHER_SPACING;
  }
  if ((VARIABLE_DEFINITION.equals(leftType) || VARIABLE_DEFINITION.equals(rightType)) && !(leftNode.getTreeNext() instanceof PsiErrorElement)) {
    return Spacing.createSpacing(0,0,1,false,100);
  }
  if ((mLT.equals(leftType) && mLT.equals(rightType)) || (mGT.equals(leftType) && mGT.equals(rightType))) {
    return NO_SPACING_WITH_NEWLINE;
  }
  if (PREFIXES.contains(leftType) || POSTFIXES.contains(rightType) || (PREFIXES_OPTIONAL.contains(leftType) && leftNode.getPsi().getParent() instanceof GrUnaryExpression)) {
    return NO_SPACING_WITH_NEWLINE;
  }
  if (RANGES.contains(leftType) || RANGES.contains(rightType)) {
    return NO_SPACING_WITH_NEWLINE;
  }
  if (left.getParent() != null && left.getParent().equals(right.getParent()) && (left.getParent() instanceof GrString || leftNode.getTreeParent().getElementType() == mREGEX_LITERAL || leftNode.getTreeParent().getElementType() == mDOLLAR_SLASH_REGEX_LITERAL)) {
    return NO_SPACING;
  }
  if (isDollarInGStringInjection(leftNode) || isDollarInGStringInjection(rightNode)) {
    return NO_SPACING;
  }
  if (leftNode.getPsi().getParent() instanceof GrStringInjection && rightNode.getPsi().getParent() instanceof GrString && rightNode.getPsi().getParent().equals(leftNode.getPsi().getParent().getParent())) {
    return NO_SPACING;
  }
  if (mGDOC_ASTERISKS == leftType && mGDOC_COMMENT_DATA == rightType) {
    String text=rightNode.getText();
    if (text.length() > 0 && !text.startsWith(" ")) {
      return COMMON_SPACING;
    }
    return NO_SPACING;
  }
  if (leftType == mGDOC_TAG_VALUE_TOKEN && rightType == mGDOC_COMMENT_DATA) {
    return LAZY_SPACING;
  }
  if (left instanceof GrStatement && right instanceof GrStatement && left.getParent() instanceof GrStatementOwner&& right.getParent() instanceof GrStatementOwner) {
    return COMMON_SPACING_WITH_NL;
  }
  if (rightType == mGDOC_INLINE_TAG_END || leftType == mGDOC_INLINE_TAG_START || rightType == mGDOC_INLINE_TAG_START || leftType == mGDOC_INLINE_TAG_END) {
    return NO_SPACING;
  }
  if ((leftType == GDOC_INLINED_TAG && rightType == mGDOC_COMMENT_DATA) || (leftType == mGDOC_COMMENT_DATA && rightType == GDOC_INLINED_TAG)) {
    return NO_SPACING;
  }
  if (leftType == CLASS_TYPE_ELEMENT && rightType == mTRIPLE_DOT) {
    return NO_SPACING;
  }
  if (rightType == mLT || rightType == mGT) {
    if (right.getParent() instanceof GrCodeReferenceElement) {
      PsiElement p=right.getParent().getParent();
      if (p instanceof GrNewExpression || p instanceof GrAnonymousClassDefinition) {
        return NO_SPACING;
      }
    }
  }
  if (leftType == mRPAREN && left.getParent() instanceof GrTypeCastExpression) {
    return settings.SPACE_AFTER_TYPE_CAST ? COMMON_SPACING : NO_SPACING;
  }
  return COMMON_SPACING;
}
