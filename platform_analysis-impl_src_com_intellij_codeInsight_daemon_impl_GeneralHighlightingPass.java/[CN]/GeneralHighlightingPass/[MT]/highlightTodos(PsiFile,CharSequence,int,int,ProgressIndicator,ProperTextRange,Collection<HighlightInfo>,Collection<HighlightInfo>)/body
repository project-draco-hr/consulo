{
  PsiTodoSearchHelper helper=PsiTodoSearchHelper.getInstance(file.getProject());
  if (helper == null)   return;
  TodoItem[] todoItems=helper.findTodoItems(file,startOffset,endOffset);
  if (todoItems.length == 0)   return;
  for (  TodoItem todoItem : todoItems) {
    progress.checkCanceled();
    TextRange range=todoItem.getTextRange();
    TextAttributes attributes=todoItem.getPattern().getAttributes().getTextAttributes();
    HighlightInfo.Builder builder=HighlightInfo.newHighlightInfo(HighlightInfoType.TODO).range(range);
    builder.textAttributes(attributes);
    String description=text.subSequence(range.getStartOffset(),range.getEndOffset()).toString();
    builder.description(description);
    builder.unescapedToolTip(StringUtil.shortenPathWithEllipsis(description,1024));
    HighlightInfo info=builder.createUnconditionally();
    (priorityRange.containsRange(info.getStartOffset(),info.getEndOffset()) ? insideResult : outsideResult).add(info);
  }
}
