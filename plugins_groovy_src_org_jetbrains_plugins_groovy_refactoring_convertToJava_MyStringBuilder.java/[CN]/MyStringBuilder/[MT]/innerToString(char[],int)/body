{
  int posInInner=0;
  final int size=positions.size();
  for (int i=0; i < size; i++) {
    final int pos=positions.get(i);
    final int length=pos - posInInner;
    System.arraycopy(arr,posInInner,chars,posInChars,length);
    posInChars+=length;
    posInInner+=length;
    CharSequence seq=builders.get(i);
    if (seq instanceof MyStringBuilder) {
      posInChars=((MyStringBuilder)seq).innerToString(chars,posInChars);
    }
 else {
      final int seqLength=seq.length();
      for (int j=0; j < seqLength; j++) {
        chars[posInChars]=seq.charAt(j);
        posInChars++;
      }
    }
  }
  final int length=innerLen - posInInner;
  System.arraycopy(arr,posInInner,chars,posInChars,length);
  return posInChars + length;
}
