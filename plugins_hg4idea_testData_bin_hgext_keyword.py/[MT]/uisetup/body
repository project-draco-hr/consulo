def uisetup(ui):
    'Collects [keyword] config in kwtools.\n    Monkeypatches dispatch._parse if needed.'
    for (pat, opt) in ui.configitems('keyword'):
        if (opt != 'ignore'):
            kwtools['inc'].append(pat)
        else:
            kwtools['exc'].append(pat)
    if kwtools['inc']:

        def kwdispatch_parse(orig, ui, args):
            'Monkeypatch dispatch._parse to obtain running hg command.'
            (cmd, func, args, options, cmdoptions) = orig(ui, args)
            kwtools['hgcmd'] = cmd
            return (cmd, func, args, options, cmdoptions)
        extensions.wrapfunction(dispatch, '_parse', kwdispatch_parse)
