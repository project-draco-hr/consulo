def _kwfwrite(ui, repo, expand, *pats, **opts):
    'Selects files and passes them to kwtemplater.overwrite.'
    if (repo.dirstate.parents()[1] != nullid):
        raise util.Abort(_('outstanding uncommitted merge'))
    kwt = kwtools['templater']
    status = _status(ui, repo, kwt, *pats, **opts)
    (modified, added, removed, deleted) = status[:4]
    if (modified or added or removed or deleted):
        raise util.Abort(_('outstanding uncommitted changes'))
    wlock = lock = None
    try:
        wlock = repo.wlock()
        lock = repo.lock()
        kwt.overwrite(None, expand, status[6])
    finally:
        release(lock, wlock)
