'expand keywords in tracked files\n\nThis extension expands RCS/CVS-like or self-customized $Keywords$ in\ntracked text files selected by your configuration.\n\nKeywords are only expanded in local repositories and not stored in the\nchange history. The mechanism can be regarded as a convenience for the\ncurrent user or for archive distribution.\n\nConfiguration is done in the [keyword] and [keywordmaps] sections of\nhgrc files.\n\nExample::\n\n    [keyword]\n    # expand keywords in every python file except those matching "x*"\n    **.py =\n    x*    = ignore\n\nNOTE: the more specific you are in your filename patterns the less you\nlose speed in huge repositories.\n\nFor [keywordmaps] template mapping and expansion demonstration and\ncontrol run "hg kwdemo". See "hg help templates" for a list of\navailable templates and filters.\n\nAn additional date template filter {date|utcdate} is provided. It\nreturns a date like "2006/09/18 15:13:13".\n\nThe default template mappings (view with "hg kwdemo -d") can be\nreplaced with customized keywords and templates. Again, run "hg\nkwdemo" to control the results of your config changes.\n\nBefore changing/disabling active keywords, run "hg kwshrink" to avoid\nthe risk of inadvertently storing expanded keywords in the change\nhistory.\n\nTo force expansion after enabling it, or a configuration change, run\n"hg kwexpand".\n\nAlso, when committing with the record extension or using mq\'s qrecord,\nbe aware that keywords cannot be updated. Again, run "hg kwexpand" on\nthe files in question to update keyword expansions after all changes\nhave been checked in.\n\nExpansions spanning more than one line and incremental expansions,\nlike CVS\' $Log$, are not supported. A keyword template map "Log =\n{desc}" expands to the first line of the changeset description.\n'
from mercurial import commands, cmdutil, dispatch, filelog, revlog, extensions
from mercurial import patch, localrepo, templater, templatefilters, util, match
from mercurial.hgweb import webcommands
from mercurial.lock import release
from mercurial.node import nullid
from mercurial.i18n import _
import re, shutil, tempfile
commands.optionalrepo += ' kwdemo'
nokwcommands = 'add addremove annotate bundle copy export grep incoming init log outgoing push rename rollback tip verify convert email glog'
restricted = 'merge record resolve qfold qimport qnew qpush qrefresh qrecord transplant'
utcdate = (lambda x: util.datestr((x[0], 0), '%Y/%m/%d %H:%M:%S'))
kwtools = {'templater': None, 'hgcmd': '', 'inc': [], 'exc': ['.hg*'], }
cmdtable = {'kwdemo': (demo, [('d', 'default', None, _('show default keyword template maps')), ('f', 'rcfile', '', _('read maps from rcfile'))], _('hg kwdemo [-d] [-f RCFILE] [TEMPLATEMAP]...')), 'kwexpand': (expand, commands.walkopts, _('hg kwexpand [OPTION]... [FILE]...')), 'kwfiles': (files, ([('A', 'all', None, _('show keyword status flags of all files')), ('i', 'ignore', None, _('show files excluded from expansion')), ('u', 'unknown', None, _('only show unknown (not tracked) files')), ('a', 'all', None, _('show keyword status flags of all files (DEPRECATED)')), ('u', 'untracked', None, _('only show untracked files (DEPRECATED)'))] + commands.walkopts), _('hg kwfiles [OPTION]... [FILE]...')), 'kwshrink': (shrink, commands.walkopts, _('hg kwshrink [OPTION]... [FILE]...')), }
