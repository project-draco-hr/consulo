def __init__(self, ui, repo):
    self.ui = ui
    self.repo = repo
    self.match = match.match(repo.root, '', [], kwtools['inc'], kwtools['exc'])
    self.restrict = (kwtools['hgcmd'] in restricted.split())
    kwmaps = self.ui.configitems('keywordmaps')
    if kwmaps:
        self.templates = dict(((k, templater.parsestring(v, False)) for (k, v) in kwmaps))
    escaped = map(re.escape, self.templates.keys())
    kwpat = ('\\$(%s)(: [^$\\n\\r]*? )??\\$' % '|'.join(escaped))
    self.re_kw = re.compile(kwpat)
    templatefilters.filters['utcdate'] = utcdate
    self.ct = cmdutil.changeset_templater(self.ui, self.repo, False, None, '', False)
