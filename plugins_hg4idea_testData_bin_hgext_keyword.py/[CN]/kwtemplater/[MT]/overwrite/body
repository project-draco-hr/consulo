def overwrite(self, node, expand, files):
    'Overwrites selected files expanding/shrinking keywords.'
    ctx = self.repo[node]
    mf = ctx.manifest()
    if (node is not None):
        files = [f for f in ctx.files() if (f in mf)]
        notify = self.ui.debug
    else:
        notify = self.ui.note
    candidates = [f for f in files if self.iskwfile(f, ctx.flags)]
    if candidates:
        self.restrict = True
        msg = ((expand and _('overwriting %s expanding keywords\n')) or _('overwriting %s shrinking keywords\n'))
        for f in candidates:
            fp = self.repo.file(f)
            data = fp.read(mf[f])
            if util.binary(data):
                continue
            if expand:
                if (node is None):
                    ctx = self.repo.filectx(f, fileid=mf[f]).changectx()
                (data, found) = self.substitute(data, f, ctx, self.re_kw.subn)
            else:
                found = self.re_kw.search(data)
            if found:
                notify((msg % f))
                self.repo.wwrite(f, data, mf.flags(f))
                if (node is None):
                    self.repo.dirstate.normal(f)
        self.restrict = False
