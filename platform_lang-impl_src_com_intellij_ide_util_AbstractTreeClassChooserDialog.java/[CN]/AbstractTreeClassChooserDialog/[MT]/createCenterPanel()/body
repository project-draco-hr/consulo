{
  final DefaultTreeModel model=new DefaultTreeModel(new DefaultMutableTreeNode());
  myTree=new Tree(model);
  ProjectAbstractTreeStructureBase treeStructure=new AbstractProjectTreeStructure(myProject){
    @Override public boolean isFlattenPackages(){
      return false;
    }
    @Override public boolean isShowMembers(){
      return myIsShowMembers;
    }
    @Override public boolean isHideEmptyMiddlePackages(){
      return true;
    }
    @Override public boolean isAbbreviatePackageNames(){
      return false;
    }
    @Override public boolean isShowLibraryContents(){
      return myIsShowLibraryContents;
    }
    @Override public boolean isShowModules(){
      return false;
    }
  }
;
  myBuilder=new ProjectTreeBuilder(myProject,myTree,model,AlphaComparator.INSTANCE,treeStructure);
  myTree.setRootVisible(false);
  myTree.setShowsRootHandles(true);
  myTree.expandRow(0);
  myTree.getSelectionModel().setSelectionMode(TreeSelectionModel.SINGLE_TREE_SELECTION);
  myTree.setCellRenderer(new NodeRenderer());
  UIUtil.setLineStyleAngled(myTree);
  JScrollPane scrollPane=ScrollPaneFactory.createScrollPane(myTree);
  scrollPane.setPreferredSize(new Dimension(500,300));
  myTree.addKeyListener(new KeyAdapter(){
    @Override public void keyPressed(    KeyEvent e){
      if (KeyEvent.VK_ENTER == e.getKeyCode()) {
        doOKAction();
      }
    }
  }
);
  new DoubleClickListener(){
    @Override protected boolean onDoubleClick(    MouseEvent event){
      TreePath path=myTree.getPathForLocation(event.getX(),event.getY());
      if (path != null && myTree.isPathSelected(path)) {
        doOKAction();
        return true;
      }
      return false;
    }
  }
.installOn(myTree);
  myTree.addTreeSelectionListener(new TreeSelectionListener(){
    @Override public void valueChanged(    TreeSelectionEvent e){
      handleSelectionChanged();
    }
  }
);
  new TreeSpeedSearch(myTree);
  myTabbedPane=new TabbedPaneWrapper(getDisposable());
  final JPanel dummyPanel=new JPanel(new BorderLayout());
  String name=null;
  myGotoByNamePanel=new ChooseByNamePanel(myProject,createChooseByNameModel(),name,myScope.isSearchInLibraries(),getContext()){
    @Override protected void showTextFieldPanel(){
    }
    @Override protected void close(    boolean isOk){
      super.close(isOk);
      if (isOk) {
        doOKAction();
      }
 else {
        doCancelAction();
      }
    }
    @NotNull @Override protected Set<Object> filter(    @NotNull Set<Object> elements){
      return doFilter(elements);
    }
    @Override protected void initUI(    ChooseByNamePopupComponent.Callback callback,    ModalityState modalityState,    boolean allowMultipleSelection){
      super.initUI(callback,modalityState,allowMultipleSelection);
      dummyPanel.add(myGotoByNamePanel.getPanel(),BorderLayout.CENTER);
      IdeFocusTraversalPolicy.getPreferredFocusedComponent(myGotoByNamePanel.getPanel()).requestFocus();
    }
    @Override protected void showList(){
      super.showList();
      if (myInitialClass != null && myList.getModel().getSize() > 0) {
        myList.setSelectedValue(myInitialClass,true);
        myInitialClass=null;
      }
    }
    @Override protected void chosenElementMightChange(){
      handleSelectionChanged();
    }
  }
;
  Disposer.register(myDisposable,myGotoByNamePanel);
  myTabbedPane.addTab(IdeBundle.message("tab.chooser.search.by.name"),dummyPanel);
  myTabbedPane.addTab(IdeBundle.message("tab.chooser.project"),scrollPane);
  myGotoByNamePanel.invoke(new MyCallback(),getModalityState(),false);
  myTabbedPane.addChangeListener(new ChangeListener(){
    @Override public void stateChanged(    ChangeEvent e){
      handleSelectionChanged();
    }
  }
);
  return myTabbedPane.getComponent();
}
