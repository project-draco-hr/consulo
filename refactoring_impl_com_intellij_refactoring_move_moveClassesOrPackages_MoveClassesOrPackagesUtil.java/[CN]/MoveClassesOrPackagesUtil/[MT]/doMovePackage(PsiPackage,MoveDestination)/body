{
  PsiManager manager=aPackage.getManager();
  final PackageWrapper targetPackage=moveDestination.getTargetPackage();
  final String newPrefix;
  if ("".equals(targetPackage.getQualifiedName())) {
    newPrefix="";
  }
 else {
    newPrefix=targetPackage.getQualifiedName() + ".";
  }
  final String newPackageQualifiedName=newPrefix + aPackage.getName();
  final GlobalSearchScope projectScope=GlobalSearchScope.projectScope(aPackage.getProject());
  PsiDirectory[] dirs=aPackage.getDirectories(projectScope);
  for (  PsiDirectory dir : dirs) {
    final PsiDirectory targetDirectory=moveDestination.getTargetDirectory(dir);
    if (targetDirectory != null) {
      moveDirectoryRecursively(dir,targetDirectory);
    }
  }
  aPackage.handleQualifiedNameChange(newPackageQualifiedName);
  return JavaPsiFacade.getInstance(manager.getProject()).findPackage(newPackageQualifiedName);
}
