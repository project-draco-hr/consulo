{
  if (myPopupActions == null) {
    final StructureConfigurableContext context=ProjectStructureConfigurable.getInstance(myState.getProject()).getContext();
    int actionIndex=1;
    final List<AddItemPopupAction<?>> actions=new ArrayList<AddItemPopupAction<?>>();
    actions.add(new AddItemPopupAction<Library>(this,actionIndex++,ProjectBundle.message("classpath.add.simple.module.library.action"),Icons.JAR_ICON){
      protected ClasspathTableItem createTableItem(      final Library item){
        final OrderEntry[] entries=getRootModel().getOrderEntries();
        for (        OrderEntry entry : entries) {
          if (entry instanceof LibraryOrderEntry) {
            final LibraryOrderEntry libraryOrderEntry=(LibraryOrderEntry)entry;
            if (item.equals(libraryOrderEntry.getLibrary())) {
              return ClasspathTableItem.createLibItem(libraryOrderEntry);
            }
          }
        }
        LOG.error("Unknown library " + item);
        return null;
      }
      protected ClasspathElementChooserDialog<Library> createChooserDialog(){
        final LibraryTable.ModifiableModel moduleLibraryModel=getRootModel().getModuleLibraryTable().getModifiableModel();
        return new CreateSingleEntryModuleLibraryDialog(ClasspathPanelImpl.this,moduleLibraryModel);
      }
    }
);
    actions.add(new AddItemPopupAction<Library>(this,actionIndex++,ProjectBundle.message("classpath.add.new.library.action"),Icons.LIBRARY_ICON){
      protected ClasspathTableItem createTableItem(      final Library item){
        final OrderEntry[] entries=getRootModel().getOrderEntries();
        for (        OrderEntry entry : entries) {
          if (entry instanceof LibraryOrderEntry) {
            final LibraryOrderEntry libraryOrderEntry=(LibraryOrderEntry)entry;
            if (item.equals(libraryOrderEntry.getLibrary())) {
              return ClasspathTableItem.createLibItem(libraryOrderEntry);
            }
          }
        }
        return ClasspathTableItem.createLibItem(getRootModel().addLibraryEntry(item));
      }
      protected ClasspathElementChooserDialog<Library> createChooserDialog(){
        return new CreateLibraryDialog(ClasspathPanelImpl.this.getProject(),getRootModel(),context,ClasspathPanelImpl.this.getComponent());
      }
    }
);
    actions.add(new ChooseExistingLibraryAction(this,actionIndex++,ProjectBundle.message("classpath.add.existing.library.action"),context));
    actions.add(new AddItemPopupAction<Module>(this,actionIndex,ProjectBundle.message("classpath.add.module.dependency.action"),StdModuleTypes.JAVA.getNodeIcon(false)){
      protected ClasspathTableItem createTableItem(      final Module item){
        return ClasspathTableItem.createItem(getRootModel().addModuleOrderEntry(item));
      }
      protected ClasspathElementChooserDialog<Module> createChooserDialog(){
        final List<Module> chooseItems=getDependencyModules();
        if (chooseItems.isEmpty()) {
          Messages.showMessageDialog(ClasspathPanelImpl.this,ProjectBundle.message("message.no.module.dependency.candidates"),getTitle(),Messages.getInformationIcon());
          return null;
        }
        return new ChooseModulesToAddDialog(chooseItems,ProjectBundle.message("classpath.chooser.title.add.module.dependency"));
      }
    }
);
    myPopupActions=actions;
  }
}
