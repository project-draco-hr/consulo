{
  CommandProcessor.getInstance().executeCommand(project,new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          try {
            final GrIntroduceParameterHandler hackedHandler=new GrIntroduceParameterHandler(){
              @Override protected void showDialog(              IntroduceParameterInfo info){
                final GrIntroduceExpressionSettings hackedSettings=getSettings(info,removeUnusedParameters,replaceFieldsWithGetters,declareFinal,generateDelegate);
                if (info.getToReplaceIn() instanceof GrMethod) {
                  new GrIntroduceParameterProcessor(hackedSettings).run();
                }
 else {
                  new GrIntroduceClosureParameterProcessor(hackedSettings).run();
                }
              }
            }
;
            hackedHandler.invoke(project,editor,file,null);
            if (conflicts != null)             fail("Conflicts were expected");
          }
 catch (          Exception e) {
            if (conflicts == null) {
              e.printStackTrace();
              fail("Conflicts were not expected");
            }
            assertEquals(conflicts,e.getMessage());
          }
        }
      }
);
    }
  }
,"introduce Parameter",null);
}
