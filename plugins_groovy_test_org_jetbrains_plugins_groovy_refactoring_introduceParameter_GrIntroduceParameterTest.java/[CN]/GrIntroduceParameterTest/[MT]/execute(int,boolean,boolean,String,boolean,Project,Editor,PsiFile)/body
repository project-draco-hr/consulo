{
  CommandProcessor.getInstance().executeCommand(project,new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          try {
            final GrIntroduceParameterHandler hackedHandler=new GrIntroduceParameterHandler(){
              @Override protected void showDialog(              final GrIntroduceParameterContext context){
                final GrIntroduceParameterSettings hackedSettings=getSettings(context,removeUnusedParameters,replaceFieldsWithGetters,declareFinal,generateDelegate);
                BaseRefactoringProcessor processor;
                if (context.toReplaceIn instanceof GrMethod) {
                  processor=new GrIntroduceParameterProcessor(hackedSettings,context);
                }
 else {
                  processor=new GrIntroduceClosureParameterProcessor(hackedSettings,context);
                }
                processor.run();
              }
            }
;
            hackedHandler.invoke(project,editor,file,null);
            if (conflicts != null)             fail("Conflicts were expected");
          }
 catch (          Exception e) {
            if (conflicts == null) {
              e.printStackTrace();
              fail("Conflicts were not expected");
            }
            assertEquals(conflicts,e.getMessage());
          }
        }
      }
);
    }
  }
,"introduce Parameter",null);
}
