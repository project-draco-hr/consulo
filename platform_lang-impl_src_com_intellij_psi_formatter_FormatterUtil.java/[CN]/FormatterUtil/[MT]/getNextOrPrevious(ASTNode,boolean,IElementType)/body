{
  if (node == null)   return null;
  ASTNode each=isNext ? node.getTreeNext() : node.getTreePrev();
  ASTNode parent=node.getTreeParent();
  while (each == null && parent != null) {
    each=isNext ? parent.getTreeNext() : parent.getTreePrev();
    parent=parent.getTreeParent();
  }
  if (each == null) {
    return null;
  }
  for (  IElementType type : typesToIgnore) {
    if (each.getElementType() == type) {
      return getNextOrPrevious(each,isNext,typesToIgnore);
    }
  }
  return each;
}
