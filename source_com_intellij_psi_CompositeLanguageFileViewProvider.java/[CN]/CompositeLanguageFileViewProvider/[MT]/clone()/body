{
  final CompositeLanguageFileViewProvider viewProvider=cloneInner();
  final PsiFileImpl psiFile=(PsiFileImpl)getPsi(getBaseLanguage());
  final FileElement treeClone=(FileElement)psiFile.calcTreeElement().clone();
  psiFile.setTreeElementPointer(treeClone);
  treeClone.setPsiElement(psiFile);
  final XmlText[] xmlTexts=JspImplUtil.gatherTexts((XmlFile)psiFile);
  for (  Map.Entry<Language,PsiFile> entry : myRoots.entrySet()) {
    if (entry.getValue() != psiFile) {
      final PsiFileImpl copy=(PsiFileImpl)viewProvider.getPsi(entry.getKey());
      JspImplUtil.copyRoot((PsiFileImpl)entry.getValue(),xmlTexts,copy);
    }
  }
  return viewProvider;
}
