{
  final CompositeLanguageFileViewProvider viewProvider=cloneInner();
  final PsiFileImpl psiFile=(PsiFileImpl)getPsi(getBaseLanguage());
  final FileElement treeClone=(FileElement)psiFile.calcTreeElement().clone();
  psiFile.setTreeElementPointer(treeClone);
  treeClone.setPsiElement(psiFile);
  final XmlText[] xmlTexts=JspImplUtil.gatherTexts((XmlFile)psiFile);
  for (  Map.Entry<Language,PsiFile> entry : myRoots.entrySet()) {
    final PsiFile root=entry.getValue();
    if (root instanceof PsiFileImpl && root != psiFile) {
      final PsiFileImpl copy=(PsiFileImpl)viewProvider.getPsi(entry.getKey());
      JspImplUtil.copyRoot((PsiFileImpl)root,xmlTexts,copy);
    }
  }
  return viewProvider;
}
