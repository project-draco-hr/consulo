{
  LOG.debug("JspxFile: reparseRoot " + getVirtualFile().getName());
  final PsiFile psiFileImpl=cachedRoot;
  final ASTNode oldFileTree=psiFileImpl.getNode();
  if (oldFileTree == null || oldFileTree.getFirstChildNode() instanceof ChameleonElement) {
    if (psiFileImpl instanceof PsiFileImpl)     ((PsiFileImpl)psiFileImpl).setTreeElementPointer(null);
    psiFileImpl.subtreeChanged();
    return;
  }
  final PsiFile fileForNewText=createFile(lang);
  final ASTNode newFileTree=fileForNewText.getNode();
  ChameleonTransforming.transformChildren(newFileTree,true);
  ChameleonTransforming.transformChildren(oldFileTree,true);
  CompositeLanguageParsingUtil.mergeTreeElements((TreeElement)newFileTree.getFirstChildNode(),(TreeElement)oldFileTree.getFirstChildNode(),(CompositeElement)oldFileTree);
  checkConsistensy(cachedRoot);
}
