{
  final Collection<VirtualFile> result=new HashSet<VirtualFile>();
  final boolean isDirectory=vf.isDirectory();
  VirtualFile parent=!isDirectory || !vf.exists() ? vf.getParent() : vf;
  final File parentIo=new File(parent.getPath());
  if (isSvnVersioned(project,parentIo)) {
    checkCanceled(progress);
    File ioFile=new File(vf.getPath());
    callback.handleWorkingCopyRoot(ioFile,progress);
    checkCanceled(progress);
    result.add(parent);
  }
 else   if (isDirectory) {
    checkCanceled(progress);
    final VirtualFile[] childrenVF=parent.getChildren();
    for (    VirtualFile file : childrenVF) {
      checkCanceled(progress);
      if (file.isDirectory()) {
        result.addAll(crawlWCRoots(project,file,callback,progress));
      }
    }
  }
  return result;
}
