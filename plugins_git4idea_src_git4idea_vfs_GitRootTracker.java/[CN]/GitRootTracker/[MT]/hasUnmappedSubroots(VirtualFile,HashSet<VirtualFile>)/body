{
  VirtualFile[] children=ApplicationManager.getApplication().runReadAction(new Computable<VirtualFile[]>(){
    public VirtualFile[] compute(){
      return directory.isValid() ? directory.getChildren() : VirtualFile.EMPTY_ARRAY;
    }
  }
);
  for (  final VirtualFile child : children) {
    if (!child.isDirectory()) {
      continue;
    }
    if (child.getName().equals(".git") && (rootSet == null || !rootSet.contains(child.getParent()))) {
      return true;
    }
    if (hasUnmappedSubroots(child,rootSet)) {
      return true;
    }
  }
  return false;
}
