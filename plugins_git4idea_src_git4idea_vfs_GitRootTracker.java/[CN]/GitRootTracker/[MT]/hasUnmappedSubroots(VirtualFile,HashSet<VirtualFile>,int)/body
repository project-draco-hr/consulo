{
  if (depth > 3) {
    return false;
  }
  VirtualFile[] children=ApplicationManager.getApplication().runReadAction(new Computable<VirtualFile[]>(){
    public VirtualFile[] compute(){
      return directory.isValid() ? directory.getChildren() : VirtualFile.EMPTY_ARRAY;
    }
  }
);
  for (  final VirtualFile child : children) {
    if (!child.isDirectory()) {
      continue;
    }
    if (child.getName().equals(".git")) {
      return !rootSet.contains(child.getParent());
    }
    if (hasUnmappedSubroots(child,rootSet,depth + 1)) {
      return true;
    }
  }
  return false;
}
