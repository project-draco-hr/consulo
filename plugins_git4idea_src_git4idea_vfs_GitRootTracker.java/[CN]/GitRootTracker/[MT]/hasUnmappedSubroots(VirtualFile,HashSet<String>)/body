{
  VirtualFile[] children=ApplicationManager.getApplication().runReadAction(new Computable<VirtualFile[]>(){
    public VirtualFile[] compute(){
      return directory.getChildren();
    }
  }
);
  for (  final VirtualFile child : children) {
    if (child.getName().equals(".git") || !child.isDirectory()) {
      continue;
    }
    boolean hasUnmapped=ApplicationManager.getApplication().runReadAction(new Computable<Boolean>(){
      public Boolean compute(){
        if (child.isValid())         return false;
        return child.findChild(".git") != null && !rootSet.contains(child.getPath());
      }
    }
);
    if (hasUnmapped) {
      return true;
    }
    if (hasUnmappedSubroots(child,rootSet)) {
      return true;
    }
  }
  return false;
}
