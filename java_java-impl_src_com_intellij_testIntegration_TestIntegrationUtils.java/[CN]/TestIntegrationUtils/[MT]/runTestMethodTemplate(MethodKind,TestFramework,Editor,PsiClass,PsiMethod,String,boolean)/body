{
  Template template=createTestMethodTemplate(methodKind,framework,targetClass,name,automatic);
  final TextRange range=method.getTextRange();
  editor.getDocument().replaceString(range.getStartOffset(),range.getEndOffset(),"");
  editor.getCaretModel().moveToOffset(range.getStartOffset());
  final Project project=targetClass.getProject();
  TemplateEditingAdapter adapter=null;
  if (!automatic) {
    adapter=new TemplateEditingAdapter(){
      @Override public void templateFinished(      Template template,      boolean brokenOff){
        ApplicationManager.getApplication().runWriteAction(new Runnable(){
          public void run(){
            PsiDocumentManager.getInstance(project).commitDocument(editor.getDocument());
            PsiFile psi=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
            PsiElement el=PsiTreeUtil.findElementOfClassAtOffset(psi,editor.getCaretModel().getOffset() - 1,PsiMethod.class,false);
            if (el != null) {
              PsiMethod method=PsiTreeUtil.getParentOfType(el,PsiMethod.class,false);
              if (method != null) {
                if (method.findDeepestSuperMethods().length > 0) {
                  GenerateMembersUtil.setupGeneratedMethod(method);
                }
                CreateFromUsageUtils.setupEditor(method,editor);
              }
            }
          }
        }
);
      }
    }
;
  }
  TemplateManager.getInstance(project).startTemplate(editor,template,adapter);
}
