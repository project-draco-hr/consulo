{
  final File rootFile=getRootFile(directory);
  if (rootFile != null) {
    rootFiles.add(rootFile);
  }
  try {
    final File[] files=directory.listFiles(new FileFilter(){
      @Override public boolean accept(      File file){
        if (!file.isDirectory()) {
          return false;
        }
        final File rootFile=getRootFile(file);
        if (!rootFile.exists()) {
          return false;
        }
        if (root == null) {
          return true;
        }
        try {
          final String cvsRoot=FileUtils.readLineFromFile(rootFile).trim();
          return root.equals(cvsRoot);
        }
 catch (        IOException e) {
          throw new RuntimeException(e);
        }
      }
    }
);
    for (    File file : files) {
      collectRootFiles(file,root,rootFiles);
    }
  }
 catch (  RuntimeException e) {
    final Throwable cause=e.getCause();
    if (cause instanceof IOException) {
      throw (IOException)cause;
    }
  }
}
