{
  DataContext dataContext=e.getDataContext();
  IdeView view=DataKeys.IDE_VIEW.getData(dataContext);
  Project project=DataKeys.PROJECT.getData(dataContext);
  PsiDirectory directory=PackageUtil.getOrChooseDirectory(view);
  if (directory == null)   return;
  boolean isDirectory=directory.getPackage() == null;
  MyInputValidator validator=new MyInputValidator(project,directory,isDirectory);
  Messages.showInputDialog(project,isDirectory ? IdeBundle.message("prompt.enter.new.directory.name") : IdeBundle.message("prompt.enter.new.package.name"),isDirectory ? IdeBundle.message("title.new.directory") : IdeBundle.message("title.new.package"),Messages.getQuestionIcon(),"",validator);
  if (validator.myCreatedElement == null)   return;
  view.selectElement(validator.myCreatedElement);
}
