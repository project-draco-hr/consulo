{
  final JPanel panel=new JPanel(new BorderLayout());
  final SelectWCopyComboAction selectWcCombo=new SelectWCopyComboAction();
  final DefaultActionGroup group=new DefaultActionGroup();
  final SelectBranchAction highlightBranchesAction=new SelectBranchAction(manager,selectWcCombo);
  final ChainConsumer visiblenessConsumer=new ChainConsumer(panel,manager);
  manager.registerCompositePart(visiblenessConsumer);
  final SelectWcRootAction selectRootAction=new SelectWcRootAction(myProject,highlightBranchesAction,visiblenessConsumer);
  final MyUseBranchFilterCheckboxAction checkBoxAction=new MyUseBranchFilterCheckboxAction(highlightBranchesAction);
  final SelectWCopyDialogAction selectWcopyDialog=new SelectWCopyDialogAction(selectRootAction,highlightBranchesAction,checkBoxAction,myProject);
  final MergeInfoHolder mergeInfoHolder=new MergeInfoHolder(myProject,manager,selectRootAction,highlightBranchesAction,selectWcCombo,checkBoxAction);
  group.add(checkBoxAction);
  group.add(selectRootAction);
  group.add(highlightBranchesAction);
  group.add(selectWcCombo);
  group.add(selectWcopyDialog);
  group.add(new MyRefresh(mergeInfoHolder));
  final ActionToolbar customToolbar=ActionManager.getInstance().createActionToolbar(ActionPlaces.UNKNOWN,group,true);
  panel.add(customToolbar.getComponent(),BorderLayout.WEST);
  selectRootAction.setSelected(0);
  highlightBranchesAction.setSelected(0);
  selectWcCombo.setSelected(0);
  final DefaultActionGroup popup=new DefaultActionGroup(myVcs.getDisplayName(),true);
  popup.add(new IntegrateChangeListsAction());
  popup.add(new ConfigureBranchesAction());
  myConnection.subscribe(VcsConfigurationChangeListener.BRANCHES_CHANGED,new VcsConfigurationChangeListener.Notification(){
    public void execute(    final Project project,    final VirtualFile vcsRoot){
      selectRootAction.reload();
    }
  }
);
  myConnection.subscribe(SvnMapDialog.WC_CONVERTED,new Runnable(){
    public void run(){
      selectRootAction.reload();
    }
  }
);
  ProjectLevelVcsManager.getInstance(myProject).addVcsListener(new VcsListener(){
    public void directoryMappingChanged(){
      selectRootAction.reload();
    }
  }
);
  return new Pair<JPanel,List<AnAction>>(panel,Collections.<AnAction>singletonList(popup));
}
