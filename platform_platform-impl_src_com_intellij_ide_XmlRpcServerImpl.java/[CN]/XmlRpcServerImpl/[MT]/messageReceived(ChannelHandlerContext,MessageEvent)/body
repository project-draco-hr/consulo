{
  if (e.getMessage() instanceof HttpRequest) {
    HttpRequest request=(HttpRequest)e.getMessage();
    if (request.getMethod() == HttpMethod.POST) {
      ChannelBuffer result;
      ChannelBufferInputStream in=new ChannelBufferInputStream(request.getContent());
      try {
        result=ChannelBuffers.copiedBuffer(new XmlRpcWorker(handlerMapping).execute(in,xmlRpcContext));
      }
 catch (      Throwable ex) {
        context.getChannel().close();
        LOG.error(ex);
        return;
      }
 finally {
        in.close();
      }
      HttpResponse response=Responses.create("text/xml");
      response.setContent(result);
      Responses.send(response,request,context);
      return;
    }
    if (request.getMethod() == HttpMethod.OPTIONS && HttpMethod.POST.getName().equals(request.getHeader("Access-Control-Request-Method"))) {
      HttpResponse response=Responses.create("text/plain");
      response.setHeader("Access-Control-Allow-Origin","*");
      response.setHeader("Access-Control-Allow-Methods","POST, OPTIONS");
      Responses.send(response,request,context);
      return;
    }
  }
  context.sendUpstream(e);
}
