{
  if (classParameterList != null) {
    final CompositeElement errorElement=Factory.createErrorElement(JavaErrorMessages.message("unexpected.token"));
    TreeUtil.addChildren(errorElement,classParameterList);
    TreeUtil.insertAfter(first,errorElement);
  }
  CompositeElement variable;
  if (context == Context.CLASS_CONTEXT || context == Context.ANNOTATION_INTERFACE_CONTEXT) {
    variable=ASTFactory.composite(FIELD);
    TreeUtil.addChildren(variable,first);
  }
 else   if (context == Context.CODE_BLOCK_CONTEXT) {
    variable=ASTFactory.composite(LOCAL_VARIABLE);
    TreeUtil.addChildren(variable,first);
  }
 else {
    LOG.assertTrue(false);
    return null;
  }
  CompositeElement variable1=variable;
  boolean unclosed=false;
  boolean eatSemicolon=true;
  boolean shouldRollback;
  while (true) {
    shouldRollback=true;
    while (lexer.getTokenType() == LBRACKET) {
      TreeUtil.addChildren(variable1,ParseUtil.createTokenElement(lexer,myContext.getCharTable()));
      lexer.advance();
      if (lexer.getTokenType() != RBRACKET) {
        TreeUtil.addChildren(variable1,Factory.createErrorElement(JavaErrorMessages.message("expected.rbracket")));
        unclosed=true;
        break;
      }
      TreeUtil.addChildren(variable1,ParseUtil.createTokenElement(lexer,myContext.getCharTable()));
      lexer.advance();
    }
    if (lexer.getTokenType() == EQ) {
      TreeUtil.addChildren(variable1,ParseUtil.createTokenElement(lexer,myContext.getCharTable()));
      lexer.advance();
      TreeElement expr=myContext.getExpressionParsing().parseExpression(lexer);
      if (expr != null) {
        shouldRollback=false;
        TreeUtil.addChildren(variable1,expr);
      }
 else {
        TreeUtil.addChildren(variable1,Factory.createErrorElement(JavaErrorMessages.message("expected.expression")));
        unclosed=true;
        break;
      }
    }
    if (lexer.getTokenType() != COMMA)     break;
    TreeElement comma=ParseUtil.createTokenElement(lexer,myContext.getCharTable());
    lexer.advance();
    TreeUtil.insertAfter(variable1,comma);
    if (lexer.getTokenType() != IDENTIFIER) {
      TreeUtil.insertAfter(comma,Factory.createErrorElement(JavaErrorMessages.message("expected.identifier")));
      unclosed=true;
      eatSemicolon=false;
      break;
    }
    CompositeElement variable2=ASTFactory.composite(variable1.getElementType());
    TreeUtil.insertAfter(comma,variable2);
    TreeUtil.addChildren(variable2,ParseUtil.createTokenElement(lexer,myContext.getCharTable()));
    lexer.advance();
    variable1=variable2;
  }
  if (lexer.getTokenType() == SEMICOLON && eatSemicolon) {
    TreeUtil.addChildren(variable1,ParseUtil.createTokenElement(lexer,myContext.getCharTable()));
    lexer.advance();
  }
 else {
    if (lexer.getTokenType() != null && shouldRollback) {
      int spaceStart=lexer instanceof StoppableLexerAdapter ? ((StoppableLexerAdapter)lexer).getPrevTokenEnd() : ((FilterLexer)lexer).getPrevTokenEnd();
      int spaceEnd=lexer.getTokenStart();
      final CharSequence buffer=lexer.getBufferSequence();
      int lineStart=CharArrayUtil.shiftBackwardUntil(buffer,spaceEnd,"\n\r");
      if (startPos.getOffset() < lineStart && lineStart < spaceStart) {
        final int newBufferEnd=CharArrayUtil.shiftForward(buffer,lineStart,"\n\r \t");
        lexer.restore(startPos);
        StoppableLexerAdapter stoppableLexer=new StoppableLexerAdapter(new StoppableLexerAdapter.StoppingCondition(){
          public boolean stopsAt(          IElementType token,          int start,          int end){
            return start >= newBufferEnd || end > newBufferEnd;
          }
        }
,lexer);
        return parseDeclaration(stoppableLexer,context);
      }
    }
    if (!unclosed) {
      TreeUtil.addChildren(variable1,Factory.createErrorElement(JavaErrorMessages.message("expected.semicolon")));
    }
  }
  return variable;
}
