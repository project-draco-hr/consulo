{
  final boolean dumb=DumbService.isDumb(scope.getProject());
  scope.accept(new JavaRecursiveElementWalkingVisitor(){
    @Override public void visitClass(    PsiClass aClass){
      if (dumb || !addClosureFolding(aClass,document,foldElements,processedComments,quick)) {
        addToFold(foldElements,aClass,document,true);
        addElementsToFold(foldElements,aClass,document,false,quick);
      }
    }
    @Override public void visitMethodCallExpression(    PsiMethodCallExpression expression){
      if (!dumb) {
        addMethodGenericParametersFolding(expression,foldElements,document,quick);
      }
      super.visitMethodCallExpression(expression);
    }
    @Override public void visitNewExpression(    PsiNewExpression expression){
      if (!dumb) {
        addGenericParametersFolding(expression,foldElements,document,quick);
      }
      super.visitNewExpression(expression);
    }
    @Override public void visitComment(    PsiComment comment){
      addCommentFolds(comment,processedComments,foldElements);
      super.visitComment(comment);
    }
  }
);
}
