{
  GrCall callExpression=GroovyRefactoringUtil.getCallExpressionByMethodReference(usage.getElement());
  if (callExpression == null)   return true;
  GrArgumentList argList=callExpression.getArgumentList();
  GrExpression[] oldArgs=argList.getExpressionArguments();
  final GrExpression anchor;
  if (!data.getMethodToSearchFor().isVarArgs()) {
    anchor=getLast(oldArgs);
  }
 else {
    final PsiParameter[] parameters=data.getMethodToSearchFor().getParameterList().getParameters();
    if (parameters.length > oldArgs.length) {
      anchor=getLast(oldArgs);
    }
 else {
      final int lastNonVararg=parameters.length - 2;
      anchor=lastNonVararg >= 0 ? oldArgs[lastNonVararg] : null;
    }
  }
  PsiMethod method=PsiTreeUtil.getParentOfType(argList,PsiMethod.class);
  GrClosureSignature signature=GrClosureSignatureUtil.createSignature(callExpression);
  if (signature == null)   signature=GrClosureSignatureUtil.createSignature(data.getMethodToSearchFor(),PsiSubstitutor.EMPTY);
  final GrClosureSignatureUtil.ArgInfo<PsiElement>[] actualArgs=GrClosureSignatureUtil.mapParametersToArguments(signature,argList,callExpression,callExpression.getClosureArguments(),true);
  if (method != null && IntroduceParameterUtil.isMethodInUsages(data,method,usages)) {
    argList.addAfter(GroovyPsiElementFactory.getInstance(data.getProject()).createExpressionFromText(data.getParameterName()),anchor);
  }
 else {
    PsiElement initializer=ExpressionConverter.getExpression(data.getParameterInitializer().getExpression(),GroovyFileType.GROOVY_LANGUAGE,data.getProject());
    LOG.assertTrue(initializer instanceof GrExpression);
    GrExpression newArg=(GrExpression)argList.addAfter(initializer,anchor);
    new OldReferencesResolver(callExpression,newArg,data.getMethodToReplaceIn(),data.getReplaceFieldsWithGetters(),initializer,signature,actualArgs).resolve();
    ChangeContextUtil.clearContextInfo(initializer);
  }
  if (actualArgs == null) {
    removeParamsFromUnresolvedCall(callExpression,data);
  }
 else {
    removeParametersFromCall(actualArgs,data.getParametersToRemove());
  }
  return false;
}
