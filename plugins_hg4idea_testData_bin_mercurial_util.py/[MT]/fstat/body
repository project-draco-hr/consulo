def fstat(fp):
    'stat file object that may not have fileno method.'
    try:
        return os.fstat(fp.fileno())
    except AttributeError:
        return os.stat(fp.name)
