def filechunkiter(f, size=65536, limit=None):
    'Create a generator that produces the data in the file size\n    (default 65536) bytes at a time, up to optional limit (default is\n    to read all data).  Chunks may be less than size bytes if the\n    chunk is the last chunk in the file, or the file is a socket or\n    some other type of file that sometimes reads less data than is\n    requested.'
    assert (size >= 0)
    assert ((limit is None) or (limit >= 0))
    while True:
        if (limit is None):
            nbytes = size
        else:
            nbytes = min(limit, size)
        s = (nbytes and f.read(nbytes))
        if (not s):
            break
        if limit:
            limit -= len(s)
        yield s
