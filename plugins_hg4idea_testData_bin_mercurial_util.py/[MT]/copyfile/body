def copyfile(src, dest):
    'copy a file, preserving mode and atime/mtime'
    if os.path.islink(src):
        try:
            os.unlink(dest)
        except:
            pass
        os.symlink(os.readlink(src), dest)
    else:
        try:
            shutil.copyfile(src, dest)
            shutil.copystat(src, dest)
        except shutil.Error as inst:
            raise Abort(str(inst))
