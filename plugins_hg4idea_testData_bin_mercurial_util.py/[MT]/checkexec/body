def checkexec(path):
    '\n    Check whether the given path is on a filesystem with UNIX-like exec flags\n\n    Requires a directory (like /foo/.hg)\n    '
    try:
        EXECFLAGS = ((stat.S_IXUSR | stat.S_IXGRP) | stat.S_IXOTH)
        (fh, fn) = tempfile.mkstemp(dir=path, prefix='hg-checkexec-')
        try:
            os.close(fh)
            m = (os.stat(fn).st_mode & 511)
            new_file_has_exec = (m & EXECFLAGS)
            os.chmod(fn, (m ^ EXECFLAGS))
            exec_flags_cannot_flip = ((os.stat(fn).st_mode & 511) == m)
        finally:
            os.unlink(fn)
    except (IOError, OSError):
        return False
    return (not (new_file_has_exec or exec_flags_cannot_flip))
