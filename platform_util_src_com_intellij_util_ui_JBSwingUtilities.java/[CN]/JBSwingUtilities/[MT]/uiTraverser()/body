{
  return new TreeTraverser<Component>(){
    @Override public Iterable<Component> children(    Component c){
      Iterable<Component> result=ContainerUtil.emptyIterable();
      if (c instanceof JMenu) {
        result=Arrays.asList(((JMenu)c).getMenuComponents());
      }
 else       if (c instanceof Container) {
        result=Arrays.asList(((Container)c).getComponents());
      }
      if (c instanceof JComponent) {
        JComponent jc=(JComponent)c;
        Iterable<? extends Component> orphans=UIUtil.getClientProperty(jc,NOT_IN_HIERARCHY_COMPONENTS);
        if (orphans != null) {
          result=ContainerUtil.concat(result,orphans);
        }
        JPopupMenu jpm=jc.getComponentPopupMenu();
        if (jpm != null && jpm.isVisible() && jpm.getInvoker() == jc) {
          result=ContainerUtil.concat(result,Collections.singletonList(jpm));
        }
      }
      return result;
    }
  }
;
}
