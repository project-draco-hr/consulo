{
  Project project=context.getProject();
  if (project == null)   return false;
  VcsSelection selection=VcsSelectionUtil.getSelection(context);
  if (selection == null)   return false;
  VirtualFile file=FileDocumentManager.getInstance().getFile(selection.getDocument());
  if (file == null)   return false;
  final ProjectLevelVcsManagerImpl vcsManager=(ProjectLevelVcsManagerImpl)ProjectLevelVcsManager.getInstance(project);
  final BackgroundableActionEnabledHandler handler=vcsManager.getBackgroundableActionHandler(VcsBackgroundableActions.HISTORY_FOR_SELECTION);
  if (handler.isInProgress(VcsBackgroundableActions.keyFrom(file)))   return false;
  AbstractVcs activeVcs=ProjectLevelVcsManager.getInstance(project).getVcsFor(file);
  if (activeVcs == null)   return false;
  VcsHistoryProvider provider=activeVcs.getVcsBlockHistoryProvider();
  if (provider == null)   return false;
  if (!AbstractVcs.fileInVcsByFileStatus(project,VcsUtil.getFilePath(file)))   return false;
  return true;
}
