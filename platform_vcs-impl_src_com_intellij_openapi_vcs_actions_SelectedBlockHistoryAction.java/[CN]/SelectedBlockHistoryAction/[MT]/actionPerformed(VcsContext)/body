{
  try {
    final VcsSelection selection=VcsSelectionUtil.getSelection(context);
    VirtualFile file=FileDocumentManager.getInstance().getFile(selection.getDocument());
    final Project project=context.getProject();
    if (project == null)     return;
    final AbstractVcs activeVcs=ProjectLevelVcsManager.getInstance(project).getVcsFor(file);
    if (activeVcs == null)     return;
    final VcsHistoryProvider provider=activeVcs.getVcsBlockHistoryProvider();
    final int selectionStart=selection.getSelectionStartLineNumber();
    final int selectionEnd=selection.getSelectionEndLineNumber();
    new VcsHistoryProviderBackgroundableProxy(project,provider).createSessionFor(new FilePathImpl(file),new Consumer<VcsHistorySession>(){
      public void consume(      VcsHistorySession session){
        if (session == null)         return;
        VcsBlockHistoryDialog vcsHistoryDialog=new VcsBlockHistoryDialog(project,context.getSelectedFiles()[0],activeVcs,provider,session,Math.min(selectionStart,selectionEnd),Math.max(selectionStart,selectionEnd),selection.getDialogTitle());
        vcsHistoryDialog.show();
      }
    }
,VcsBackgroundableActions.HISTORY_FOR_SELECTION,false);
  }
 catch (  Exception exception) {
    reportError(exception);
  }
}
