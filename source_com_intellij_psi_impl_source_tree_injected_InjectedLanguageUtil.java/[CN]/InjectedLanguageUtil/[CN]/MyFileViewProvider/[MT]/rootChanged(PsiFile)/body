{
  super.rootChanged(psiFile);
  PsiDocumentManager documentManager=PsiDocumentManager.getInstance(getManager().getProject());
  DocumentRange documentRange=(DocumentRange)documentManager.getDocument(psiFile);
  String text=psiFile.getText();
  text=StringUtil.trimStart(text,documentRange.getPrefix());
  text=StringUtil.trimEnd(text,documentRange.getSuffix());
  PsiLanguageInjectionHost injectionHost=(PsiLanguageInjectionHost)psiFile.getContext();
  PsiFile hostFile=injectionHost.getContainingFile();
  TextRange hostTextRange=injectionHost.getTextRange();
  RangeMarker documentWindow=documentRange.getTextRange();
  TextRange rangeInsideHost=new TextRange(documentWindow.getStartOffset(),documentWindow.getEndOffset()).shiftRight(-hostTextRange.getStartOffset());
  String newHostText=StringUtil.replaceSubstring(injectionHost.getText(),rangeInsideHost,text);
  if (!newHostText.equals(injectionHost.getText())) {
    injectionHost.fixText(newHostText);
    PsiDocumentManagerImpl.checkConsistency(psiFile,documentRange);
    PsiDocumentManagerImpl.checkConsistency(hostFile,documentRange.getDelegate());
  }
}
