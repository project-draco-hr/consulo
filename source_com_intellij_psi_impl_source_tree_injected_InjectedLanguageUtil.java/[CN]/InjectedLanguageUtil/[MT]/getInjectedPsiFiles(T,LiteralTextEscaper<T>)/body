{
  if (!host.isPhysical()) {
    CachedValueProvider.Result<List<Pair<PsiElement,TextRange>>> result=new InjectedPsiProvider<T>(host,textEscaper).compute();
    return result == null ? null : result.getValue();
  }
  CachedValue<List<Pair<PsiElement,TextRange>>> cachedPsi=host.getUserData(INJECTED_PSI);
  if (cachedPsi == null) {
    InjectedPsiProvider<T> provider=new InjectedPsiProvider<T>(host,textEscaper);
    CachedValueProvider.Result<List<Pair<PsiElement,TextRange>>> result=provider.compute();
    if (result == null)     return null;
    cachedPsi=host.getManager().getCachedValuesManager().createCachedValue(provider,false);
    ((CachedValueImpl<List<Pair<PsiElement,TextRange>>>)cachedPsi).setValue(result);
    ((UserDataHolderEx)host).putUserDataIfAbsent(INJECTED_PSI,cachedPsi);
    return result.getValue();
  }
  return cachedPsi.getValue();
}
