{
  if (editor == null || file == null || editor instanceof EditorDelegate)   return editor;
  PsiFile injectedFile=findInjectedPsiAt(file,offset);
  if (injectedFile == null)   return editor;
  Document document=PsiDocumentManager.getInstance(editor.getProject()).getDocument(injectedFile);
  return EditorDelegate.create((DocumentRange)document,(EditorImpl)editor,injectedFile);
}
