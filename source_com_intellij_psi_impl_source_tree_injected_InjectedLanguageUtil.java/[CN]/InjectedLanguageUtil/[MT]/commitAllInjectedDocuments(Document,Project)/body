{
  List<DocumentRange> injected=hostDocument.getUserData(INJECTED_FILES_KEY);
  if (injected == null)   return;
  List<DocumentRange> oldInjected=new ArrayList<DocumentRange>(injected);
  PsiDocumentManager documentManager=PsiDocumentManager.getInstance(project);
  PsiFile psiFile=documentManager.getPsiFile(hostDocument);
  for (  DocumentRange injDocument : oldInjected) {
    final PsiFileImpl oldFile=(PsiFileImpl)documentManager.getPsiFile(injDocument);
    RangeMarker rangeMarker=injDocument.getTextRange();
    if (!rangeMarker.isValid() || oldFile == null) {
      injected.remove(injDocument);
    }
    PsiElement element=psiFile.findElementAt(rangeMarker.getStartOffset());
    PsiLanguageInjectionHost injectionHost=findInjectionHost(element);
    if (injectionHost == null)     continue;
    injectionHost.getInjectedPsi();
  }
}
