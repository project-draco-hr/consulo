{
  final Ref<PsiElement> out=new Ref<PsiElement>();
  enumerate(element,new PsiLanguageInjectionHost.InjectedPsiVisitor(){
    public void visit(    @NotNull PsiFile injectedPsi,    @NotNull List<Pair<PsiLanguageInjectionHost,TextRange>> places){
      for (      Pair<PsiLanguageInjectionHost,TextRange> place : places) {
        TextRange rangeInsideHost=place.getSecond();
        TextRange hostRange=place.getFirst().getTextRange();
        if (hostRange.cutOut(rangeInsideHost).grown(1).contains(offset)) {
          DocumentWindow document=(DocumentWindow)documentManager.getCachedDocument(injectedPsi);
          int injectedOffset=document.hostToInjected(offset);
          PsiElement injElement=injectedPsi.findElementAt(injectedOffset);
          out.set(injElement == null ? injectedPsi : injElement);
        }
      }
    }
  }
,true);
  return out.get();
}
