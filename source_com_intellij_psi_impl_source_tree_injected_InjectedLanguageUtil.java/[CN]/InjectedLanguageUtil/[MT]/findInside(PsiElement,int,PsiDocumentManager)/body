{
  final Ref<PsiElement> out=new Ref<PsiElement>();
  enumerate(element,new PsiLanguageInjectionHost.InjectedPsiVisitor(){
    public void visit(    @NotNull PsiFile injectedPsi,    @NotNull List<PsiLanguageInjectionHost.Shred> places){
      for (      PsiLanguageInjectionHost.Shred place : places) {
        TextRange hostRange=place.host.getTextRange();
        if (hostRange.cutOut(place.rangeInsideHost).grown(1).contains(offset)) {
          DocumentWindow document=(DocumentWindow)documentManager.getCachedDocument(injectedPsi);
          int injectedOffset=document.hostToInjected(offset);
          PsiElement injElement=injectedPsi.findElementAt(injectedOffset);
          out.set(injElement == null ? injectedPsi : injElement);
        }
      }
    }
  }
,true);
  return out.get();
}
