{
  if (event.isFromSave())   return;
  final VirtualFile file=event.getFile();
  final Document document=getCachedDocument(file);
  if (document == null) {
    myEventDispatcher.getMulticaster().fileWithNoDocumentChanged(file);
    return;
  }
  long documentStamp=document.getModificationStamp();
  long oldFileStamp=event.getOldModificationStamp();
  if (documentStamp != oldFileStamp) {
    LOG.info("reaload from disk?");
    LOG.info("  documentStamp:" + documentStamp);
    LOG.info("  oldFileStamp:" + oldFileStamp);
    Runnable askReloadRunnable=new Runnable(){
      public void run(){
        if (!file.isValid())         return;
        if (askReloadFromDisk(file,document)) {
          reloadFromDisk(document);
        }
      }
    }
;
    if (!ApplicationManager.getApplication().isUnitTestMode()) {
      LaterInvocator.invokeLater(askReloadRunnable);
    }
 else {
      askReloadRunnable.run();
    }
  }
 else {
    reloadFromDisk(document);
  }
}
