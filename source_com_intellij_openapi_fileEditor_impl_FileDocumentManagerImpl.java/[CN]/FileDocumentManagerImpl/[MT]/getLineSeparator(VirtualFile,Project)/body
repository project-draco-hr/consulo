{
  String lineSeparator=file != null ? file.getUserData(DETECTED_LINE_SEPARATOR_KEY) : null;
  if (lineSeparator == null) {
    CodeStyleSettingsManager settingsManager=project == null ? CodeStyleSettingsManager.getInstance() : CodeStyleSettingsManager.getInstance(project);
    return settingsManager.getCurrentSettings().getLineSeparator();
  }
 else {
    return lineSeparator;
  }
}
