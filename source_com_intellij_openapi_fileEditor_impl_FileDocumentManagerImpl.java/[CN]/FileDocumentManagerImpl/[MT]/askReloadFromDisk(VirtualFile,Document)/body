{
  String message="Changes have been made to \"" + file.getPresentableUrl() + "\"\nin memory and on disk.";
  if (ApplicationManager.getApplication().isUnitTestMode())   throw new RuntimeException(message);
  final DialogBuilder builder=new DialogBuilder((Project)null);
  builder.setCenterPanel(new JLabel(message,Messages.getQuestionIcon(),SwingUtilities.TRAILING));
  builder.addOkAction().setText("&Load FS Changes");
  builder.addCancelAction().setText("&Keep Memory Changes");
  builder.addAction(new AbstractAction("&Show difference"){
    public void actionPerformed(    ActionEvent e){
      String windowtitle="File Cache Conflict " + file.getPresentableUrl();
      SimpleDiffRequest request=new SimpleDiffRequest(getDummyProject(),windowtitle);
      FileType fileType=FileTypeManager.getInstance().getFileTypeByFile(file);
      String fsContent=loadText(file).toString();
      request.setContents(new SimpleContent(fsContent,fileType),new DocumentContent(myDummyProject,document,fileType));
      request.setContentTitles("File system content","Memory content");
      DialogBuilder diffBuidler=new DialogBuilder(getDummyProject());
      DiffPanelImpl diffPanel=(DiffPanelImpl)DiffManager.getInstance().createDiffPanel(diffBuidler.getWindow(),getDummyProject());
      diffPanel.getOptions().setShowSourcePolicy(DiffPanelOptions.ShowSourcePolicy.DONT_SHOW);
      diffBuidler.setCenterPanel(diffPanel.getComponent());
      diffPanel.setDiffRequest(request);
      diffBuidler.addOkAction().setText("Save changes");
      diffBuidler.addCancelAction();
      diffBuidler.setTitle(windowtitle);
      if (diffBuidler.show() == DialogWrapper.OK_EXIT_CODE)       builder.getDialogWrapper().close(DialogWrapper.CANCEL_EXIT_CODE);
    }
  }
);
  builder.setTitle("File Cache Conflict");
  builder.setButtonsAlignment(SwingUtilities.CENTER);
  return builder.show() == 0;
}
