{
  String message=UIBundle.message("file.cache.conflict.message.text",file.getPresentableUrl());
  if (ApplicationManager.getApplication().isUnitTestMode())   throw new RuntimeException(message);
  final DialogBuilder builder=new DialogBuilder((Project)null);
  builder.setCenterPanel(new JLabel(message,Messages.getQuestionIcon(),SwingConstants.TRAILING));
  builder.addOkAction().setText(UIBundle.message("file.cache.conflict.load.fs.changes.button"));
  builder.addCancelAction().setText(UIBundle.message("file.cache.conflict.keep.memory.changes.button"));
  builder.addAction(new AbstractAction(UIBundle.message("file.cache.conflict.show.difference.button")){
    public void actionPerformed(    ActionEvent e){
      String windowtitle=UIBundle.message("file.cache.conflict.for.file.dialog.title",file.getPresentableUrl());
      final ProjectEx project=(ProjectEx)VfsUtil.guessProjectForFile(file);
      SimpleDiffRequest request=new SimpleDiffRequest(project,windowtitle);
      FileType fileType=file.getFileType();
      String fsContent=LoadTextUtil.loadText(file).toString();
      request.setContents(new SimpleContent(fsContent,fileType),new DocumentContent(project,document,fileType));
      request.setContentTitles(UIBundle.message("file.cache.conflict.diff.content.file.system.content"),UIBundle.message("file.cache.conflict.diff.content.memory.content"));
      DialogBuilder diffBuilder=new DialogBuilder(project);
      DiffPanelImpl diffPanel=(DiffPanelImpl)DiffManager.getInstance().createDiffPanel(diffBuilder.getWindow(),project);
      diffPanel.getOptions().setShowSourcePolicy(DiffPanelOptions.ShowSourcePolicy.DONT_SHOW);
      diffBuilder.setCenterPanel(diffPanel.getComponent());
      diffPanel.setDiffRequest(request);
      diffBuilder.addOkAction().setText(UIBundle.message("file.cache.conflict.save.changes.button"));
      diffBuilder.addCancelAction();
      diffBuilder.setTitle(windowtitle);
      diffBuilder.addDisposable(diffPanel);
      if (diffBuilder.show() == DialogWrapper.OK_EXIT_CODE)       builder.getDialogWrapper().close(DialogWrapper.CANCEL_EXIT_CODE);
    }
  }
);
  builder.setTitle(UIBundle.message("file.cache.conflict.dialog.title"));
  builder.setButtonsAlignment(SwingConstants.CENTER);
  return builder.show() == 0;
}
