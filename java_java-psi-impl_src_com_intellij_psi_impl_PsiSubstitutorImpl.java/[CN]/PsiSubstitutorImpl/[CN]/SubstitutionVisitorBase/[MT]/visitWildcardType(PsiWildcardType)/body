{
  final PsiType bound=wildcardType.getBound();
  if (bound == null) {
    return wildcardType;
  }
 else {
    final PsiType newBound=bound.accept(this);
    if (newBound == null) {
      return null;
    }
    if (newBound instanceof PsiWildcardType) {
      return handleBoundComposition(wildcardType,(PsiWildcardType)newBound);
    }
    if (newBound instanceof PsiCapturedWildcardType) {
      final PsiWildcardType wildcard=((PsiCapturedWildcardType)newBound).getWildcard();
      if (wildcardType.isExtends() != wildcard.isExtends()) {
        return wildcard.isBounded() ? PsiWildcardType.createUnbounded(wildcardType.getManager()) : newBound;
      }
      if (!wildcard.isBounded())       return PsiWildcardType.createUnbounded(wildcardType.getManager());
    }
    return PsiWildcardType.changeBound(wildcardType,newBound);
  }
}
