{
  if (!editor.getSelectionModel().hasSelection()) {
    editor.getSelectionModel().selectWordAtCaret(true);
  }
  int startOffset=editor.getSelectionModel().getSelectionStart();
  int endOffset=editor.getSelectionModel().getSelectionEnd();
  StringBuilder builder=StringBuilderSpinAllocator.alloc();
  try {
    final String text=editor.getDocument().getCharsSequence().subSequence(startOffset,endOffset).toString();
    toCase(builder,text,true);
    if (text.equals(builder.toString())) {
      toCase(builder,text,false);
    }
    editor.getDocument().replaceString(startOffset,endOffset,builder.toString());
    editor.getSelectionModel().setSelection(startOffset,endOffset);
  }
  finally {
    StringBuilderSpinAllocator.dispose(builder);
  }
}
