{
  if (!editor.getSelectionModel().hasSelection()) {
    editor.getSelectionModel().selectWordAtCaret(true);
  }
  int startOffset=editor.getSelectionModel().getSelectionStart();
  int endOffset=editor.getSelectionModel().getSelectionEnd();
  String text=editor.getDocument().getCharsSequence().subSequence(startOffset,endOffset).toString();
  String lowered=text.toLowerCase();
  if (text.equals(lowered))   lowered=lowered.toUpperCase();
  editor.getDocument().replaceString(startOffset,endOffset,lowered);
  editor.getSelectionModel().setSelection(startOffset,endOffset);
}
