{
  if (params.length != 0)   return null;
  final Project project=context.getProject();
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  PsiType[] types=null;
  int offset=context.getTemplateStartOffset();
  PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(context.getEditor().getDocument());
  PsiFile fileCopy=(PsiFile)file.copy();
  BlockSupport blockSupport=ServiceManager.getService(project,BlockSupport.class);
  try {
    blockSupport.reparseRange(fileCopy,offset,offset,CompletionUtil.DUMMY_IDENTIFIER);
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
  PsiElement element=fileCopy.findElementAt(offset);
  if (element instanceof PsiIdentifier && element.getParent() instanceof PsiExpression) {
    ExpectedTypeInfo[] infos=ExpectedTypesProvider.getInstance(project).getExpectedTypes((PsiExpression)element.getParent(),false);
    if (infos.length > 0) {
      types=new PsiType[infos.length];
      for (int i=0; i < infos.length; i++) {
        ExpectedTypeInfo info=infos[i];
        types[i]=info.getType();
      }
    }
  }
  return types;
}
