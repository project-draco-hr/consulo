{
  if (language == null) {
    return;
  }
  final LiteralEscaper literalEscaper=LanguageLiteralEscapers.INSTANCE.forLanguage(containingFile.getLanguage());
  boolean injectionStarted=false;
  for (  Trinity<PsiLanguageInjectionHost,InjectedLanguage,TextRange> trinity : list) {
    final PsiLanguageInjectionHost host=trinity.first;
    if (host.getContainingFile() != containingFile)     continue;
    final TextRange textRange=trinity.third;
    final InjectedLanguage injectedLanguage=trinity.second;
    if (!injectionStarted) {
      registrar.startInjecting(language);
      injectionStarted=true;
    }
    if (injectedLanguage.isDynamic()) {
      final StringBuilder prefix=new StringBuilder(injectedLanguage.getPrefix());
      final StringBuilder suffix=new StringBuilder(injectedLanguage.getSuffix());
      final String text=textRange.substring(host.getText());
      final String result=literalEscaper != null ? literalEscaper.unescapeText(text) : text;
      adjustPrefixAndSuffix(result,prefix,suffix);
      addPlaceSafe(registrar,prefix.toString(),suffix.toString(),host,textRange);
    }
 else {
      addPlaceSafe(registrar,injectedLanguage.getPrefix(),injectedLanguage.getSuffix(),host,textRange);
    }
  }
  if (injectionStarted) {
    registrar.doneInjecting();
  }
}
