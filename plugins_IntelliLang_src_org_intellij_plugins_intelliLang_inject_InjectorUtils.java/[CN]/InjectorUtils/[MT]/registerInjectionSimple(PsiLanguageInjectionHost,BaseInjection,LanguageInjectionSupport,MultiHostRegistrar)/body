{
  Language language=InjectedLanguage.findLanguageById(injection.getInjectedLanguageId());
  if (language == null)   return false;
  InjectedLanguage injectedLanguage=InjectedLanguage.create(injection.getInjectedLanguageId(),injection.getPrefix(),injection.getSuffix(),false);
  List<TextRange> ranges=injection.getInjectedArea(host);
  List<Trinity<PsiLanguageInjectionHost,InjectedLanguage,TextRange>> list=ContainerUtil.newArrayListWithExpectedSize(ranges.size());
  for (  TextRange range : ranges) {
    list.add(Trinity.create(host,injectedLanguage,range));
  }
  registerInjection(language,list,host.getContainingFile(),registrar);
  if (support != null) {
    registerSupport(support,true,registrar);
  }
  return !ranges.isEmpty();
}
