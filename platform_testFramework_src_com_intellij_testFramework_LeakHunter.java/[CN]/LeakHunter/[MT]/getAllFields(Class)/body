{
  Field[] cached=allFields.get(aClass);
  if (cached == null) {
    Field[] declaredFields=aClass.getDeclaredFields();
    List<Field> fields=new ArrayList<Field>(declaredFields.length + 5);
    for (    Field declaredField : declaredFields) {
      declaredField.setAccessible(true);
      fields.add(declaredField);
    }
    Class superclass=aClass.getSuperclass();
    if (superclass != null) {
      for (      Field sup : getAllFields(superclass)) {
        if (!fields.contains(sup)) {
          fields.add(sup);
        }
      }
    }
    cached=fields.isEmpty() ? EMPTY_FIELD_ARRAY : fields.toArray(new Field[fields.size()]);
    allFields.put(aClass,cached);
  }
  return cached;
}
