{
  List<Field> cached=allFields.get(aClass);
  if (cached == null) {
    Field[] declaredFields=aClass.getDeclaredFields();
    cached=new ArrayList<Field>(declaredFields.length + 5);
    for (    Field declaredField : declaredFields) {
      declaredField.setAccessible(true);
      cached.add(declaredField);
    }
    Class superclass=aClass.getSuperclass();
    if (superclass != null) {
      for (      Field sup : getAllFields(superclass)) {
        if (!cached.contains(sup)) {
          cached.add(sup);
        }
      }
    }
    ((ArrayList)cached).trimToSize();
    allFields.put(aClass,cached);
  }
  return cached;
}
