{
  myProfiles=new ArrayList<String>();
  try {
    MavenEmbedder e=MavenEmbedderFactory.createEmbedderForRead(getCoreState());
    for (    VirtualFile f : myFiles) {
      MavenProjectHolder holder=MavenReader.readProject(e,f,new ArrayList<String>());
      if (!holder.isValid)       continue;
      Set<String> profiles=new LinkedHashSet<String>();
      ProjectUtil.collectProfileIds(holder.mavenProject.getModel(),profiles);
      if (!profiles.isEmpty())       myProfiles.addAll(profiles);
    }
    MavenEmbedderFactory.releaseEmbedder(e);
  }
 catch (  CanceledException e) {
  }
}
