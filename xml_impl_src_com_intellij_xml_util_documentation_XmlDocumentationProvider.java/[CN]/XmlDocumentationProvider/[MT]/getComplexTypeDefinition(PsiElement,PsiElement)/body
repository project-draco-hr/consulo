{
  XmlElementDescriptor descriptor=element.getUserData(DESCRIPTOR_KEY);
  XmlTag contextTag=null;
  if (descriptor == null && originalElement != null && (contextTag=PsiTreeUtil.getParentOfType(originalElement,XmlTag.class)) != null) {
    descriptor=contextTag.getDescriptor();
  }
  if (descriptor instanceof XmlElementDescriptorImpl) {
    TypeDescriptor type=((XmlElementDescriptorImpl)descriptor).getType(contextTag);
    if (type instanceof ComplexTypeDescriptor) {
      return ((ComplexTypeDescriptor)type).getDeclaration();
    }
  }
  return null;
}
