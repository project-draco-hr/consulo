{
  final VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile == null) {
    return;
  }
  myGlobalContext.incrementJobDoneAmount(ANNOTATOR,ProjectUtil.calcRelativeToProjectPath(virtualFile,file.getProject()));
  final Project project=file.getProject();
  Document document=PsiDocumentManager.getInstance(project).getDocument(file);
  if (document == null)   return;
  GeneralHighlightingPass pass=new GeneralHighlightingPass(project,file,document,0,file.getTextLength(),true){
    @NotNull @Override protected HighlightVisitor[] createHighlightVisitors(){
      return new HighlightVisitor[]{new DefaultHighlightVisitor(project,highlightErrorElements,runAnnotators)};
    }
    @Override protected HighlightInfoHolder createInfoHolder(    final PsiFile file){
      final HighlightInfoFilter[] filters=ApplicationManager.getApplication().getExtensions(HighlightInfoFilter.EXTENSION_POINT_NAME);
      return new HighlightInfoHolder(file,getColorsScheme(),filters){
        @Override public boolean add(        @Nullable HighlightInfo info){
          if (info == null)           return true;
          if (info.severity == HighlightInfoType.INJECTED_FRAGMENT_SEVERITY)           return true;
          ProblemHighlightType problemHighlightType=HighlightInfo.convertType(info.type);
          GlobalInspectionUtil.createProblem(file,info.description,problemHighlightType,new TextRange(info.startOffset,info.endOffset),myManager,myProblemDescriptionsProcessor,myGlobalContext);
          return true;
        }
      }
;
    }
  }
;
  DaemonProgressIndicator progress=new DaemonProgressIndicator();
  progress.start();
  pass.collectInformation(progress);
}
