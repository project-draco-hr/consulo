{
  if (changes.size() > 0 && !ChangesUtil.hasFileChanges(changes)) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        Messages.showErrorDialog(myProject,VcsBundle.message("shelve.changes.only.directories"),VcsBundle.message("shelve.changes.action"));
      }
    }
);
    return;
  }
  try {
    final ShelvedChangeList list=ShelveChangesManager.getInstance(myProject).shelveChanges(changes,commitMessage);
    ShelvedChangesViewManager.getInstance(myProject).activateView(list);
  }
 catch (  final Exception ex) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        Messages.showErrorDialog(myProject,VcsBundle.message("create.patch.error.title",ex.getMessage()),CommonBundle.getErrorTitle());
      }
    }
,ModalityState.NON_MODAL);
  }
}
