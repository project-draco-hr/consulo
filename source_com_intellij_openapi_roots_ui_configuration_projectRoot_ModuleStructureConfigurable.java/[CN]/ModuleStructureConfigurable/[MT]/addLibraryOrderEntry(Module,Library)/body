{
  final ModuleEditor moduleEditor=myContext.myModulesConfigurator.getModuleEditor(module);
  LOG.assertTrue(moduleEditor != null,"Current module editor was not initialized");
  final ModifiableRootModel modelProxy=moduleEditor.getModifiableRootModelProxy();
  final OrderEntry[] entries=modelProxy.getOrderEntries();
  for (  OrderEntry entry : entries) {
    if (entry instanceof LibraryOrderEntry && Comparing.strEqual(entry.getPresentableName(),library.getName())) {
      if (Messages.showYesNoDialog(myWholePanel,ProjectBundle.message("project.roots.replace.library.entry.message",entry.getPresentableName()),ProjectBundle.message("project.roots.replace.library.entry.title"),Messages.getInformationIcon()) == DialogWrapper.OK_EXIT_CODE) {
        modelProxy.removeOrderEntry(entry);
        break;
      }
    }
  }
  modelProxy.addLibraryEntry(library);
  Set<String> modules=myContext.myLibraryDependencyCache.get(library);
  if (modules == null) {
    modules=new HashSet<String>();
    myContext.myLibraryDependencyCache.put(library,modules);
  }
  modules.add(module.getName());
  myTree.repaint();
}
