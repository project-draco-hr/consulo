{
  final Module module=myContext.myModulesConfigurator.addModule(myTree);
  if (module != null) {
    final MasterDetailsComponent.MyNode node=new MasterDetailsComponent.MyNode(new ModuleConfigurable(myContext.myModulesConfigurator,module,TREE_UPDATER));
    final TreePath selectionPath=myTree.getSelectionPath();
    MyNode parent=null;
    if (selectionPath != null) {
      MyNode selected=(MyNode)selectionPath.getLastPathComponent();
      final Object o=selected.getConfigurable().getEditableObject();
      if (o instanceof ModuleGroup) {
        myContext.myModulesConfigurator.getModuleModel().setModuleGroupPath(module,((ModuleGroup)o).getGroupPath());
        parent=selected;
      }
 else       if (o instanceof Module) {
        final ModifiableModuleModel modifiableModuleModel=myContext.myModulesConfigurator.getModuleModel();
        final String[] groupPath=modifiableModuleModel.getModuleGroupPath((Module)o);
        if (groupPath != null) {
          modifiableModuleModel.setModuleGroupPath(module,groupPath);
          parent=findNodeByObject(myRoot,new ModuleGroup(groupPath));
        }
      }
    }
    if (parent == null)     parent=myRoot;
    addNode(node,parent);
    ((DefaultTreeModel)myTree.getModel()).reload(parent);
    selectNodeInTree(node);
    myContext.myValidityCache.clear();
  }
}
