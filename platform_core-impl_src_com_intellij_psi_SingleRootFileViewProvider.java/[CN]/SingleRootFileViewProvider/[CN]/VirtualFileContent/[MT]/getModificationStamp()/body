{
  final VirtualFile virtualFile=getVirtualFile();
  if (virtualFile instanceof LightVirtualFile) {
    Document doc=getCachedDocument();
    if (doc != null)     return getLastCommittedStamp(doc);
    return virtualFile.getModificationStamp();
  }
  final Document document=getDocument();
  if (document == null) {
    return virtualFile.getModificationStamp();
  }
 else {
    return getLastCommittedStamp(document);
  }
}
