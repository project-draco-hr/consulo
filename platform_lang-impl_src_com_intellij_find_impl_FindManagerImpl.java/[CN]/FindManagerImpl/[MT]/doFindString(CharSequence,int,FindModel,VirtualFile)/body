{
  FindModel model=normalizeIfMultilined(findmodel);
  String toFind=model.getStringToFind();
  if (toFind.length() == 0) {
    return NOT_FOUND_RESULT;
  }
  if (model.isInCommentsOnly() || model.isInStringLiteralsOnly()) {
    return findInCommentsAndLiterals(text,offset,model,file);
  }
  if (model.isRegularExpressions()) {
    return findStringByRegularExpression(text,offset,model);
  }
  final StringSearcher searcher=createStringSearcher(model);
  int index;
  if (model.isForward()) {
    final int res=searcher.scan(text.subSequence(offset,text.length()));
    index=res < 0 ? -1 : res + offset;
  }
 else {
    index=searcher.scan(text.subSequence(0,offset));
  }
  if (index < 0) {
    return NOT_FOUND_RESULT;
  }
  return new FindResultImpl(index,index + toFind.length());
}
