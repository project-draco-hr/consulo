{
  Matcher matcher=compileRegExp(model,text);
  if (model.isForward()) {
    if (!matcher.find(startOffset)) {
      return null;
    }
    if (matcher.end() > text.length()) {
      return null;
    }
  }
 else {
    int start=-1;
    while (matcher.find() && matcher.end() < startOffset) {
      start=matcher.start();
    }
    if (start < 0) {
      return null;
    }
  }
  try {
    StringBuffer replaced=new StringBuffer();
    String toReplace=StringUtil.unescapeStringCharacters(model.getStringToReplace());
    matcher.appendReplacement(replaced,toReplace);
    return replaced.substring(matcher.start());
  }
 catch (  Exception e) {
    throw createMalformedReplacementException(model,e);
  }
}
