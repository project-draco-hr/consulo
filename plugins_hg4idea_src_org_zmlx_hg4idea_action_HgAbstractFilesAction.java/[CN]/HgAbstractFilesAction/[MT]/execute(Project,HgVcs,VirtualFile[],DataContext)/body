{
  List<VirtualFile> enabledFiles=new LinkedList<VirtualFile>();
  for (  VirtualFile file : files) {
    if (isEnabled(project,activeVcs,file)) {
      enabledFiles.add(file);
    }
  }
  batchPerform(project,activeVcs,enabledFiles,context);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      for (      VirtualFile file : files) {
        file.refresh(false,true);
      }
    }
  }
);
  try {
    for (    VirtualFile file : enabledFiles) {
      HgUtil.markFileDirty(project,file);
    }
  }
 catch (  InvocationTargetException e) {
    LOG.error("Exception while marking files dirty",e);
  }
catch (  InterruptedException e) {
    LOG.error("Exception while marking files dirty",e);
  }
}
