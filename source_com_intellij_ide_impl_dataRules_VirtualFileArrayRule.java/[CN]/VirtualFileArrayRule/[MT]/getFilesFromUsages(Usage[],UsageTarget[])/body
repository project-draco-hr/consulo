{
  Set<VirtualFile> result=new HashSet<VirtualFile>();
  if (usages != null) {
    for (int i=0; i < usages.length; i++) {
      Usage usage=usages[i];
      if (usage instanceof UsageInFile) {
        UsageInFile usageInFile=(UsageInFile)usage;
        result.add(usageInFile.getFile());
      }
      if (usage instanceof UsageInFiles) {
        UsageInFiles usageInFiles=(UsageInFiles)usage;
        result.addAll(Arrays.asList(usageInFiles.getFiles()));
      }
    }
  }
  if (usageTargets != null) {
    for (int i=0; i < usageTargets.length; i++) {
      UsageTarget usageTarget=usageTargets[i];
      VirtualFile[] files=usageTarget.getFiles();
      if (files != null) {
        result.addAll(Arrays.asList(files));
      }
    }
  }
  return result.toArray(new VirtualFile[result.size()]);
}
