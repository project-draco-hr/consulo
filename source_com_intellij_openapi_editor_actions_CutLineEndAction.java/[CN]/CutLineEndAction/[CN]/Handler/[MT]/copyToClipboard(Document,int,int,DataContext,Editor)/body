{
  String s=doc.getCharsSequence().subSequence(caretOffset,lineEndOffset).toString();
  s=StringUtil.convertLineSeparators(s,"\n");
  StringSelection contents=new StringSelection(s);
  Project project=DataKeys.PROJECT.getData(dataContext);
  if (project == null) {
    Clipboard clipboard=editor.getComponent().getToolkit().getSystemClipboard();
    clipboard.setContents(contents,EmptyClipboardOwner.INSTANCE);
  }
 else {
    CopyPasteManager.getInstance().setContents(contents);
  }
}
