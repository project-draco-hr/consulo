{
  final PsiElement contextElement=file.findElementAt(editor.getCaretModel().getOffset());
  PsiElement element=null;
  final PsiReference ref=TargetElementUtilBase.findReference(editor,editor.getCaretModel().getOffset());
  if (ref != null) {
    element=TargetElementUtilBase.getInstance().adjustReference(ref);
    if (element == null && ref instanceof PsiPolyVariantReference) {
      element=ref.getElement();
    }
  }
  final Lookup activeLookup=LookupManager.getInstance(myProject).getActiveLookup();
  if (activeLookup != null) {
    LookupElement item=activeLookup.getCurrentItem();
    if (item != null) {
      final DocumentationProvider documentationProvider=getProviderFromElement(file);
      if (documentationProvider != null) {
        element=documentationProvider.getDocumentationElementForLookupItem(PsiManager.getInstance(myProject),item.getObject(),ref != null ? ref.getElement() : contextElement);
      }
    }
  }
  return element;
}
