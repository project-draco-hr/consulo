{
  final Project project=e.getData(DataKeys.PROJECT);
  final MavenProjectsState projectsState=project != null ? project.getComponent(MavenProjectsState.class) : null;
  final VirtualFile file=e.getData(DataKeys.VIRTUAL_FILE);
  final List<String> profiles=e.getData(MavenDataKeys.MAVEN_PROFILES_KEY);
  if (projectsState != null && file != null && profiles != null && isEnabled(projectsState,file,profiles)) {
    final Collection<String> activeProfiles=new ArrayList<String>(projectsState.getProfiles(file));
    if (activeProfiles.contains(profiles.get(0))) {
      activeProfiles.removeAll(profiles);
    }
 else {
      activeProfiles.addAll(profiles);
    }
    projectsState.setProfiles(file,activeProfiles);
  }
}
