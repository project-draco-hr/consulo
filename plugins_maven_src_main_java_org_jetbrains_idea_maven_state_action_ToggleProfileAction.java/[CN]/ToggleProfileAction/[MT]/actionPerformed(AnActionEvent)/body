{
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  final MavenProjectsManager projectsManager=project != null ? MavenProjectsManager.getInstance(project) : null;
  final VirtualFile file=e.getData(PlatformDataKeys.VIRTUAL_FILE);
  final List<String> profiles=e.getData(MavenDataKeys.MAVEN_PROFILES_KEY);
  if (projectsManager != null && file != null && profiles != null && isEnabled(projectsManager,file,profiles)) {
    final Collection<String> activeProfiles=new ArrayList<String>(projectsManager.getProfiles(file));
    if (activeProfiles.contains(profiles.get(0))) {
      activeProfiles.removeAll(profiles);
    }
 else {
      activeProfiles.addAll(profiles);
    }
    projectsManager.setProfiles(file,activeProfiles);
  }
}
