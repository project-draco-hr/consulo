{
  final ChangeListManagerEx manager=(ChangeListManagerEx)ChangeListManager.getInstance(project);
  if (changes.isEmpty()) {
    String operationName=UIUtil.removeMnemonic(RollbackUtil.getRollbackOperationName(project));
    Messages.showWarningDialog(project,VcsBundle.message("commit.dialog.no.changes.detected.text"),VcsBundle.message("changes.action.rollback.nothing",operationName));
    return;
  }
  final ArrayList<Change> validChanges=new ArrayList<Change>();
  final Set<LocalChangeList> lists=new THashSet<LocalChangeList>();
  lists.addAll(manager.getInvolvedListsFilterChanges(changes,validChanges));
  rollback(project,new ArrayList<LocalChangeList>(lists),validChanges,refreshSynchronously,afterVcsRefreshInAwt);
}
