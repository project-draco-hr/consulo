{
  final VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile == null)   throw new IllegalStateException("Cannot get language level for " + file.getName());
  final Module module=ProjectRootManager.getInstance(project).getFileIndex().getModuleForFile(virtualFile);
  if (module != null) {
    return module.getEffectiveLanguageLevel();
  }
 else {
    final PsiFile originalFile=file.getOriginalFile();
  }
  return PsiManager.getInstance(project).getEffectiveLanguageLevel();
}
