{
  int myTokenEnd=baseLexer.getTokenEnd();
  if (seenTag) {
    int lastState=0;
    int lastStart=0;
    FoundEnd:     while (baseLexer.getTokenType() != XmlTokenType.XML_END_TAG_START) {
      if (baseLexer.getTokenType() == XmlTokenType.XML_COMMENT_CHARACTERS) {
        final char[] buf=baseLexer.getBuffer();
        final int end=baseLexer.getTokenEnd();
        for (int i=baseLexer.getTokenStart(); i < end; ++i) {
          if (buf[i] == '<' && i + 1 < end && buf[i + 1] == '/') {
            myTokenEnd=i;
            lastStart=i - 1;
            lastState=0;
            break FoundEnd;
          }
        }
      }
      lastState=baseLexer.getState();
      myTokenEnd=baseLexer.getTokenEnd();
      lastStart=baseLexer.getTokenStart();
      if (myTokenEnd == getBufferEnd())       break;
      baseLexer.advance();
    }
    baseLexer.start(getBuffer(),lastStart,getBufferEnd(),lastState);
    baseLexer.getTokenType();
  }
  return myTokenEnd;
}
