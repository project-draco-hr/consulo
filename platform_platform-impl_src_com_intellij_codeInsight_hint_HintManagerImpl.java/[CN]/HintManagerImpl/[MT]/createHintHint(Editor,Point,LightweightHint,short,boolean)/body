{
  JRootPane rootPane=editor.getComponent().getRootPane();
  if (rootPane == null) {
    return new HintHint(editor,p);
  }
  JLayeredPane lp=rootPane.getLayeredPane();
  HintHint hintInfo=new HintHint(editor,SwingUtilities.convertPoint(lp,p,editor.getContentComponent()));
  boolean showByBalloon=Registry.is("editor.balloonHints");
  if (showByBalloon) {
    if (!createInEditorComponent) {
      hintInfo=new HintHint(lp,p);
    }
    hintInfo.setAwtTooltip(true).setHighlighterType(true);
  }
  hintInfo.initStyleFrom(hint.getComponent());
  if (showByBalloon) {
    hintInfo.setBorderColor(Color.gray);
    hintInfo.setFont(hintInfo.getTextFont().deriveFont(Font.PLAIN));
    hintInfo.setCalloutShift(-(int)(editor.getLineHeight() * 0.1));
  }
  hintInfo.setPreferredPosition(Balloon.Position.above);
  if (constraint == UNDER || constraint == RIGHT_UNDER) {
    hintInfo.setPreferredPosition(Balloon.Position.below);
  }
 else   if (constraint == RIGHT) {
    hintInfo.setPreferredPosition(Balloon.Position.atRight);
  }
 else   if (constraint == LEFT) {
    hintInfo.setPreferredPosition(Balloon.Position.atLeft);
  }
  hintInfo.setPositionChangeShift(0,editor.getLineHeight());
  return hintInfo;
}
