{
  if (hint.getComponent() instanceof ScrollAwareHint) {
    ((ScrollAwareHint)hint.getComponent()).editorScrolled();
  }
  Editor editor=e.getEditor();
  if (!editor.getComponent().isShowing() || editor.isOneLineMode())   return;
  Rectangle newRectangle=e.getOldRectangle();
  Rectangle oldRectangle=e.getNewRectangle();
  Rectangle bounds=hint.getBounds();
  Point location=bounds.getLocation();
  location=SwingUtilities.convertPoint(editor.getComponent().getRootPane().getLayeredPane(),location,editor.getContentComponent());
  int xOffset=location.x - oldRectangle.x;
  int yOffset=location.y - oldRectangle.y;
  location=new Point(newRectangle.x + xOffset,newRectangle.y + yOffset);
  Rectangle newBounds=new Rectangle(location.x,location.y,bounds.width,bounds.height);
  final boolean valid=hideIfOutOfEditor ? oldRectangle.contains(newBounds) : oldRectangle.intersects(newBounds);
  if (valid) {
    location=SwingUtilities.convertPoint(editor.getContentComponent(),location,editor.getComponent().getRootPane().getLayeredPane());
    hint.setLocation(location.x,location.y);
  }
 else {
    hint.hide();
  }
}
