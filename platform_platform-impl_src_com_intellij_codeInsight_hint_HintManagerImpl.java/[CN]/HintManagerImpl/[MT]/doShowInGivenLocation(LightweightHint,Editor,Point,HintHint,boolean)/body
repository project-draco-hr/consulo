{
  if (ApplicationManager.getApplication().isUnitTestMode())   return;
  JLayeredPane layeredPane=editor.getComponent().getRootPane().getLayeredPane();
  Dimension size=updateSize ? hint.getComponent().getPreferredSize() : hint.getComponent().getSize();
  if (hint.isRealPopup()) {
    final Point editorCorner=editor.getComponent().getLocation();
    SwingUtilities.convertPointToScreen(editorCorner,layeredPane);
    final Point point=new Point(p);
    SwingUtilities.convertPointToScreen(point,layeredPane);
    final Rectangle editorScreen=ScreenUtil.getScreenRectangle(point.x,point.y);
    SwingUtilities.convertPointToScreen(p,layeredPane);
    final Rectangle rectangle=new Rectangle(p,size);
    ScreenUtil.moveToFit(rectangle,editorScreen,null);
    p=rectangle.getLocation();
    SwingUtilities.convertPointFromScreen(p,layeredPane);
  }
 else   if (layeredPane.getWidth() < p.x + size.width && !hintInfo.isAwtTooltip()) {
    p.x=Math.max(0,layeredPane.getWidth() - size.width);
  }
  if (hint.isVisible()) {
    if (updateSize) {
      hint.updateBounds(p.x,p.y);
    }
 else {
      hint.updateLocation(p.x,p.y);
    }
  }
 else {
    hint.show(layeredPane,p.x,p.y,editor.getContentComponent(),hintInfo);
  }
}
