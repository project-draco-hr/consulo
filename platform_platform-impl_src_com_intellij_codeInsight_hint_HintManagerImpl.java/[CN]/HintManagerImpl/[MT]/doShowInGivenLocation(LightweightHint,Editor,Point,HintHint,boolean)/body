{
  if (ApplicationManager.getApplication().isUnitTestMode())   return;
  JComponent externalComponent=getExternalComponent(editor);
  Dimension size=updateSize ? hint.getComponent().getPreferredSize() : hint.getComponent().getSize();
  if (hint.isRealPopup()) {
    final Point editorCorner=editor.getComponent().getLocation();
    SwingUtilities.convertPointToScreen(editorCorner,externalComponent);
    final Point point=new Point(p);
    SwingUtilities.convertPointToScreen(point,externalComponent);
    final Rectangle editorScreen=ScreenUtil.getScreenRectangle(point.x,point.y);
    SwingUtilities.convertPointToScreen(p,externalComponent);
    final Rectangle rectangle=new Rectangle(p,size);
    ScreenUtil.moveToFit(rectangle,editorScreen,null);
    p=rectangle.getLocation();
    SwingUtilities.convertPointFromScreen(p,externalComponent);
  }
 else   if (externalComponent.getWidth() < p.x + size.width && !hintInfo.isAwtTooltip()) {
    p.x=Math.max(0,externalComponent.getWidth() - size.width);
  }
  if (hint.isVisible()) {
    if (updateSize) {
      hint.pack();
    }
    hint.updatePosition(hintInfo.getPreferredPosition());
    hint.updateLocation(p.x,p.y);
  }
 else {
    hint.show(externalComponent,p.x,p.y,editor.getContentComponent(),hintInfo);
  }
}
