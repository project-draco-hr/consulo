{
  if (myDownloadLibraries) {
    RequiredLibrariesInfo requiredLibraries=new RequiredLibrariesInfo(getLibraryInfos());
    VirtualFile[] jars=myNewLibraryEditor != null ? myNewLibraryEditor.getFiles(OrderRootType.CLASSES) : VirtualFile.EMPTY_ARRAY;
    RequiredLibrariesInfo.RequiredClassesNotFoundInfo info=requiredLibraries.checkLibraries(jars,all);
    if (info != null) {
      LibraryDownloadInfo[] downloadingInfos=LibraryDownloader.getDownloadingInfos(info.getLibraryInfos());
      if (downloadingInfos.length > 0) {
        LibraryDownloader downloader=new LibraryDownloader(downloadingInfos,null,parent,getDirectoryForDownloadedLibrariesPath(),myDownloadedLibraryName);
        VirtualFile[] files=downloader.download();
        if (files.length != downloadingInfos.length) {
          return false;
        }
        myNewLibraryEditor=new NewLibraryEditor();
        myNewLibraryEditor.setName(myDownloadedLibraryName);
        for (        VirtualFile file : files) {
          myNewLibraryEditor.addRoot(file,OrderRootType.CLASSES);
        }
      }
    }
  }
  return true;
}
