{
  if (myDownloadLibraries) {
    RequiredLibrariesInfo requiredLibraries=new RequiredLibrariesInfo(getLibraryInfos());
    List<VirtualFile> roots=new ArrayList<VirtualFile>();
    roots.addAll(myAddedJars);
    for (    Library library : myUsedLibraries) {
      roots.addAll(Arrays.asList(librariesContainer.getLibraryFiles(library,OrderRootType.CLASSES)));
    }
    VirtualFile[] jars=VfsUtil.toVirtualFileArray(roots);
    RequiredLibrariesInfo.RequiredClassesNotFoundInfo info=requiredLibraries.checkLibraries(jars,all);
    if (info != null) {
      LibraryDownloadInfo[] downloadingInfos=LibraryDownloader.getDownloadingInfos(info.getLibraryInfos());
      if (downloadingInfos.length > 0) {
        LibraryDownloader downloader=new LibraryDownloader(downloadingInfos,null,parent,getDirectoryForDownloadedLibrariesPath(),myLibraryName,mirrorsMap);
        VirtualFile[] files=downloader.download();
        if (files.length != downloadingInfos.length) {
          return false;
        }
        myAddedJars.addAll(Arrays.asList(files));
      }
    }
  }
  return true;
}
