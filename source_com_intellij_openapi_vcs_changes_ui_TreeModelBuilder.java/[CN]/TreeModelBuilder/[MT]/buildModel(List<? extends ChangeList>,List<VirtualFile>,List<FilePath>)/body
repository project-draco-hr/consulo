{
  for (  ChangeList list : changeLists) {
    ChangesBrowserNode listNode=new ChangesBrowserNode(list);
    model.insertNodeInto(listNode,root,0);
    final HashMap<FilePath,ChangesBrowserNode> foldersCache=new HashMap<FilePath,ChangesBrowserNode>();
    final HashMap<Module,ChangesBrowserNode> moduleCache=new HashMap<Module,ChangesBrowserNode>();
    for (    Change change : list.getChanges()) {
      insertChangeNode(change,foldersCache,moduleCache,listNode);
    }
  }
  if (!unversionedFiles.isEmpty()) {
    ChangesBrowserNode unversionedNode=new ChangesBrowserNode(VcsBundle.message("changes.nodetitle.unversioned.files"));
    model.insertNodeInto(unversionedNode,root,root.getChildCount());
    final HashMap<FilePath,ChangesBrowserNode> foldersCache=new HashMap<FilePath,ChangesBrowserNode>();
    final HashMap<Module,ChangesBrowserNode> moduleCache=new HashMap<Module,ChangesBrowserNode>();
    for (    VirtualFile file : unversionedFiles) {
      final ChangesBrowserNode node=new ChangesBrowserNode(file);
      model.insertNodeInto(node,getParentNodeFor(node,foldersCache,moduleCache,unversionedNode),0);
    }
  }
  if (!locallyDeletedFiles.isEmpty()) {
    ChangesBrowserNode locallyDeletedNode=new ChangesBrowserNode(VcsBundle.message("changes.nodetitle.locally.deleted.files"));
    model.insertNodeInto(locallyDeletedNode,root,root.getChildCount());
    final HashMap<FilePath,ChangesBrowserNode> foldersCache=new HashMap<FilePath,ChangesBrowserNode>();
    final HashMap<Module,ChangesBrowserNode> moduleCache=new HashMap<Module,ChangesBrowserNode>();
    for (    FilePath file : locallyDeletedFiles) {
      final ChangesBrowserNode node=new ChangesBrowserNode(file);
      model.insertNodeInto(node,getParentNodeFor(node,foldersCache,moduleCache,locallyDeletedNode),0);
    }
  }
  collapseDirectories(model,root);
  sortNodes();
  return model;
}
