{
  final HashMap<FilePath,ChangesBrowserNode> foldersCache=new HashMap<FilePath,ChangesBrowserNode>();
  final HashMap<Module,ChangesBrowserNode> moduleCache=new HashMap<Module,ChangesBrowserNode>();
  for (  Change change : changes) {
    final ChangesBrowserNode node=new ChangesBrowserNode(change);
    ChangesUtil.getFilePath(change).refresh();
    model.insertNodeInto(node,getParentNodeFor(node,foldersCache,moduleCache,root),0);
  }
  collapseDirectories(model,root);
  sortNodes();
  return model;
}
