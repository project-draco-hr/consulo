{
  if (!compareAndSetState(ExternalSystemTaskState.NOT_STARTED,ExternalSystemTaskState.IN_PROGRESS))   return;
  ExternalSystemProgressNotificationManager progressManager=ServiceManager.getService(ExternalSystemProgressNotificationManager.class);
  for (  ExternalSystemTaskNotificationListener listener : listeners) {
    progressManager.addNotificationListener(getId(),listener);
  }
  ExternalSystemProcessingManager processingManager=ServiceManager.getService(ExternalSystemProcessingManager.class);
  try {
    processingManager.add(this);
    doExecute();
    setState(ExternalSystemTaskState.FINISHED);
  }
 catch (  Throwable e) {
    setState(ExternalSystemTaskState.FAILED);
    myError.set(e);
    LOG.warn(e);
  }
 finally {
    for (    ExternalSystemTaskNotificationListener listener : listeners) {
      progressManager.removeNotificationListener(listener);
    }
    processingManager.release(getId());
  }
}
