{
  JList list=null;
  if (myChooserComponent instanceof JList) {
    list=(JList)myChooserComponent;
    myChooserComponent=ListWithFilter.wrap(list,new MyListWrapper(list),myItemsNamer);
  }
  JPanel contentPane=new JPanel(new BorderLayout());
  if (!myForceMovable && myTitle != null) {
    JLabel label=new JLabel(myTitle);
    label.setBorder(BorderFactory.createEmptyBorder(2,5,2,5));
    label.setHorizontalAlignment(SwingConstants.CENTER);
    contentPane.add(label,BorderLayout.NORTH);
  }
  if (list != null) {
    if (list.getSelectedIndex() == -1 && myAutoselect) {
      list.setSelectedIndex(0);
    }
  }
  (list != null ? list : myChooserComponent).addMouseListener(new MouseAdapter(){
    @Override public void mousePressed(    MouseEvent e){
      if (UIUtil.isActionClick(e) && !UIUtil.isSelectionButtonDown(e) && !e.isConsumed()) {
        closePopup(true,e,true);
      }
    }
  }
);
  registerClosePopupKeyboardAction(KeyStroke.getKeyStroke(KeyEvent.VK_ESCAPE,0),false);
  registerClosePopupKeyboardAction(KeyStroke.getKeyStroke(KeyEvent.VK_ENTER,0),true);
  for (  KeyStroke keystroke : myAdditionalKeystrokes) {
    registerClosePopupKeyboardAction(keystroke,true);
  }
  final JScrollPane scrollPane;
  if (myChooserComponent instanceof ListWithFilter) {
    scrollPane=((ListWithFilter)myChooserComponent).getScrollPane();
  }
 else   if (myChooserComponent instanceof JTable) {
    scrollPane=createScrollPane((JTable)myChooserComponent);
  }
 else   if (myChooserComponent instanceof JTree) {
    scrollPane=createScrollPane((JTree)myChooserComponent);
  }
 else {
    throw new IllegalStateException("PopupChooserBuilder is intended to be constructed with one of JTable, JTree, JList components");
  }
  scrollPane.getViewport().setCursor(Cursor.getPredefinedCursor(Cursor.HAND_CURSOR));
  Insets viewportPadding=UIUtil.getListViewportPadding();
  ((JComponent)scrollPane.getViewport().getView()).setBorder(BorderFactory.createEmptyBorder(viewportPadding.top,viewportPadding.left,viewportPadding.bottom,viewportPadding.right));
  if (myChooserComponent instanceof ListWithFilter) {
    contentPane.add(myChooserComponent,BorderLayout.CENTER);
  }
 else {
    contentPane.add(scrollPane,BorderLayout.CENTER);
  }
  if (mySouthComponent != null) {
    contentPane.add(mySouthComponent,BorderLayout.SOUTH);
  }
  if (myEastComponent != null) {
    contentPane.add(myEastComponent,BorderLayout.EAST);
  }
  ComponentPopupBuilder builder=JBPopupFactory.getInstance().createComponentPopupBuilder(contentPane,myChooserComponent);
  for (  JBPopupListener each : myListeners) {
    builder.addListener(each);
  }
  builder.setDimensionServiceKey(null,myDimensionServiceKey,false).setRequestFocus(myRequestFocus).setResizable(myForceResizable).setMovable(myForceMovable).setTitle(myForceMovable ? myTitle : null).setCancelCallback(myCancelCallback).setAlpha(myAlpha).setFocusOwners(myFocusOwners).setCancelKeyEnabled(myCancelKeyEnabled && !(myChooserComponent instanceof ListWithFilter)).setAdText(myAd,myAdAlignment).setKeyboardActions(myKeyboardActions).setMayBeParent(myMayBeParent).setLocateWithinScreenBounds(true).setCancelOnOtherWindowOpen(true).setModalContext(myModalContext);
  if (myCommandButton != null) {
    builder.setCommandButton(myCommandButton);
  }
  if (myMinSize != null) {
    builder.setMinSize(myMinSize);
  }
  if (mySettingsButtons != null) {
    builder.setSettingButtons(mySettingsButtons);
  }
  myPopup=builder.createPopup();
  return myPopup;
}
