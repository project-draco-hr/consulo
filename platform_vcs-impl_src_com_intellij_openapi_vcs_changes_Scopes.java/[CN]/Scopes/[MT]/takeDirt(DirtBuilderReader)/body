{
  if (dirt.isEverythingDirty()) {
    markEverythingDirty();
    return;
  }
  final Collection<FilePathUnderVcs> dirs=dirt.getDirsForVcs();
  final Collection<FilePathUnderVcs> files=dirt.getFilesForVcs();
  final MultiMap<AbstractVcs,FilePath> filesMap=new MultiMap<AbstractVcs,FilePath>();
  final MultiMap<AbstractVcs,FilePath> dirsMap=new MultiMap<AbstractVcs,FilePath>();
  for (  FilePathUnderVcs dir : dirs) {
    dirsMap.putValue(dir.getVcs(),dir.getPath());
  }
  for (  FilePathUnderVcs file : files) {
    filesMap.putValue(file.getVcs(),file.getPath());
  }
  final Set<AbstractVcs> keys=new HashSet<AbstractVcs>(filesMap.keySet());
  keys.addAll(dirsMap.keySet());
  for (  AbstractVcs key : keys) {
    Collection<FilePath> dirPaths=dirsMap.get(key);
    dirPaths=dirPaths == null ? Collections.<FilePath>emptyList() : dirPaths;
    Collection<FilePath> filePaths=filesMap.get(key);
    filePaths=filePaths == null ? Collections.<FilePath>emptyList() : filePaths;
    getScope(key).addDirtyData(dirPaths,filePaths);
  }
}
