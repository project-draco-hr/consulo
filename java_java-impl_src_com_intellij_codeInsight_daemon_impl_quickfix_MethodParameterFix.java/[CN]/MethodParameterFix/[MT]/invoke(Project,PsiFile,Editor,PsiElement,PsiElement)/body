{
  final PsiMethod myMethod=(PsiMethod)startElement;
  if (!CodeInsightUtilBase.prepareFileForWrite(myMethod.getContainingFile()))   return;
  try {
    PsiMethod method=myMethod;
    if (myFixWholeHierarchy) {
      method=myMethod.findDeepestSuperMethod();
      if (method == null)       method=myMethod;
    }
    final PsiMethod finalMethod=method;
    Runnable runnable=new Runnable(){
      public void run(){
        ChangeSignatureProcessor processor=new ChangeSignatureProcessor(project,finalMethod,false,null,finalMethod.getName(),finalMethod.getReturnType(),getNewParametersInfo(finalMethod));
        processor.run();
        UndoUtil.markPsiFileForUndo(file);
      }
    }
;
    if (ApplicationManager.getApplication().isUnitTestMode()) {
      runnable.run();
    }
 else {
      ApplicationManager.getApplication().invokeLater(runnable,project.getDisposed());
    }
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
}
