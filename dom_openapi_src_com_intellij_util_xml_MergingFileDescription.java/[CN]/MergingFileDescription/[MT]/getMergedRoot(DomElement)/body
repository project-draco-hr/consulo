{
  Set<XmlFile> files=getFilesToMerge(element);
  final XmlFile xmlFile=element.getRoot().getFile();
  if (xmlFile != null) {
    files=new HashSet<XmlFile>(files);
    files.add(xmlFile);
  }
  ArrayList<T> roots=new ArrayList<T>(files.size());
  for (  XmlFile file : files) {
    final DomFileElement<T> fileElement=element.getManager().getFileElement(file);
    if (fileElement != null) {
      roots.add(fileElement.getRootElement());
    }
  }
  if (roots.size() == 1) {
    return roots.iterator().next();
  }
  if (myMerger == null) {
    myMerger=element.getManager().createModelMerger();
  }
  return myMerger.mergeModels(getRootElementClass(),roots);
}
