{
  final DomManager domManager=element.getManager();
  XmlFile xmlFile=element.getFile();
  Set<XmlFile> files=new HashSet<XmlFile>();
  files.add(xmlFile);
  final XmlFile originalFile=(XmlFile)xmlFile.getOriginalFile();
  if (originalFile != null) {
    final DomFileElement originalElement=domManager.getFileElement(originalFile);
    if (originalElement != null) {
      element=originalElement;
    }
  }
  files.addAll(getFilesToMerge(element));
  ArrayList<T> roots=new ArrayList<T>(files.size());
  for (  XmlFile file : files) {
    final DomFileElement<T> fileElement=domManager.getFileElement(file);
    if (fileElement != null) {
      roots.add(fileElement.getRootElement());
    }
  }
  if (roots.size() == 1) {
    return roots.iterator().next();
  }
  if (myMerger == null) {
    myMerger=DomService.getInstance().createModelMerger();
  }
  return myMerger.mergeModels(getRootElementClass(),roots);
}
