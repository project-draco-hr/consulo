{
  UIUtil.invokeLaterIfNeeded(new Runnable(){
    @Override public void run(){
      String lineSeparator=null;
      VirtualFile file=getSelectedFile();
      if (file == null || !file.isWritable()) {
        myActionEnabled=false;
      }
 else {
        lineSeparator=LoadTextUtil.detectLineSeparator(file,true);
      }
      myComponent.resetColor();
      if (lineSeparator == null) {
        myComponent.setText("");
      }
 else {
        myActionEnabled=true;
        String text=getText(lineSeparator);
        myComponent.setToolTipText(String.format("Line separator: %s%nClick to change",text));
        myComponent.setText(text);
        Project project=getProject();
        if (project != null) {
          String projectSeparator=CodeStyleSettingsManager.getInstance(project).getCurrentSettings().getLineSeparator();
          if (projectSeparator != null && !projectSeparator.equals(lineSeparator)) {
            myComponent.setCustomColor(getErrorColor());
          }
        }
      }
      if (myActionEnabled) {
        myComponent.setForeground(UIUtil.getActiveTextColor());
      }
 else {
        myComponent.setForeground(UIUtil.getInactiveTextColor());
      }
      if (myStatusBar != null) {
        myStatusBar.updateWidget(ID());
      }
    }
  }
);
}
