{
  final Project project=getEventProject(e);
  boolean visible=false;
  if (project != null && ModuleManager.getInstance(project).getModules().length > 0) {
    final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
    for (    VirtualFile root : getRoots(e)) {
      if (!root.isInLocalFileSystem() && !fileIndex.isInLibraryClasses(root)) {
        visible=true;
        break;
      }
      if (root.isInLocalFileSystem() && root.isDirectory()) {
        for (        VirtualFile child : root.getChildren()) {
          final VirtualFile jarRoot=ArchiveVfsUtil.getJarRootForLocalFile(child);
          if (jarRoot != null && !fileIndex.isInLibraryClasses(child)) {
            visible=true;
            break;
          }
        }
      }
    }
  }
  e.getPresentation().setVisible(visible);
  e.getPresentation().setEnabled(visible);
}
