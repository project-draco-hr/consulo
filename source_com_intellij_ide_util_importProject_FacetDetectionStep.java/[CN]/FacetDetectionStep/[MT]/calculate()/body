{
  myLastRoots=getRoots();
  ProgressIndicator progressIndicator=ProgressManager.getInstance().getProgressIndicator();
  Map<ModuleDescriptor,Map<File,List<FacetDetectionProcessor.DetectedFacetInfo>>> result=new HashMap<ModuleDescriptor,Map<File,List<FacetDetectionProcessor.DetectedFacetInfo>>>();
  for (  ModuleDescriptor moduleDescriptor : myProjectBuilder.getModules()) {
    Map<File,List<FacetDetectionProcessor.DetectedFacetInfo>> root2Facets=new HashMap<File,List<FacetDetectionProcessor.DetectedFacetInfo>>();
    for (    File root : moduleDescriptor.getContentRoots()) {
      FacetDetectionProcessor processor=new FacetDetectionProcessor(progressIndicator);
      processor.process(root);
      List<FacetDetectionProcessor.DetectedFacetInfo> facets=processor.getDetectedFacetsInfos();
      if (!facets.isEmpty()) {
        root2Facets.put(root,facets);
      }
    }
    if (!root2Facets.isEmpty()) {
      result.put(moduleDescriptor,root2Facets);
    }
  }
  return result;
}
