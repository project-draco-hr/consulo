{
  myLastRoots=getRoots();
  ProgressIndicator progressIndicator=ProgressManager.getInstance().getProgressIndicator();
  Map<ModuleDescriptor,Map<File,List<Pair<FacetInfo,VirtualFile>>>> result=new HashMap<ModuleDescriptor,Map<File,List<Pair<FacetInfo,VirtualFile>>>>();
  for (  ModuleDescriptor moduleDescriptor : myProjectBuilder.getModules()) {
    Map<File,List<Pair<FacetInfo,VirtualFile>>> root2Facets=new HashMap<File,List<Pair<FacetInfo,VirtualFile>>>();
    for (    File root : moduleDescriptor.getContentRoots()) {
      FacetDetectionProcessor processor=new FacetDetectionProcessor(progressIndicator);
      processor.process(root);
      List<Pair<FacetInfo,VirtualFile>> facets=processor.getDetectedFacetsWithFiles();
      if (!facets.isEmpty()) {
        root2Facets.put(root,facets);
      }
    }
    if (!root2Facets.isEmpty()) {
      result.put(moduleDescriptor,root2Facets);
    }
  }
  return result;
}
