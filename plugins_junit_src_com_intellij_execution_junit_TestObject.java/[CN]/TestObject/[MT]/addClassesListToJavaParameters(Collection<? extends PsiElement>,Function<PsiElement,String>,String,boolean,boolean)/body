{
  try {
    if (createTempFile) {
      myTempFile=File.createTempFile("idea_junit",".tmp");
      myTempFile.deleteOnExit();
      myJavaParameters.getProgramParametersList().add("@" + myTempFile.getAbsolutePath());
    }
    final PrintWriter writer=new PrintWriter(new FileWriter(myTempFile));
    try {
      writer.println(junit4 ? JUnitStarter.JUNIT4_PARAMETER : "-junit3");
      writer.println(packageName);
      for (      final PsiElement element : elements) {
        final String name=nameFunction.fun(element);
        if (name == null) {
          LOG.error("invalid element " + element);
          return;
        }
        writer.println(name);
      }
    }
  finally {
      writer.close();
    }
  }
 catch (  IOException e) {
    LOG.error(e);
  }
}
