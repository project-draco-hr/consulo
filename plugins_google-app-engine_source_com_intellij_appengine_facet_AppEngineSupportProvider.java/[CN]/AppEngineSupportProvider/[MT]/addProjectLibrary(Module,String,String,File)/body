{
  return new WriteAction<Library>(){
    protected void run(    final Result<Library> result){
      final LibraryTable libraryTable=LibraryTablesRegistrar.getInstance().getLibraryTable(module.getProject());
      Library library=libraryTable.getLibraryByName(name);
      if (library == null) {
        library=libraryTable.createLibrary(name);
        final Library.ModifiableModel model=library.getModifiableModel();
        model.addJarDirectory(VfsUtil.pathToUrl(path),false);
        if (sourcesDirectory != null) {
          final File[] files=sourcesDirectory.listFiles();
          if (files != null) {
            for (            File file : files) {
              model.addRoot(VfsUtil.getUrlForLibraryRoot(file),OrderRootType.SOURCES);
            }
          }
        }
        model.commit();
      }
      result.setResult(library);
    }
  }
.execute().getResultObject();
}
