{
  final Editor editor=lookup.getEditor();
  if (!lookup.performGuardedChange(new Runnable(){
    @Override public void run(){
      handler.execute(editor,dataContext);
    }
  }
)) {
    return;
  }
  final CompletionProgressIndicator process=CompletionServiceImpl.getCompletionService().getCurrentCompletion();
  if (lookup.truncatePrefix(process == null || !process.isAutopopupCompletion())) {
    return;
  }
  if (process != null) {
    if (hideOffset < editor.getCaretModel().getOffset()) {
      process.scheduleRestart();
      return;
    }
    process.prefixUpdated();
  }
  lookup.hide();
}
