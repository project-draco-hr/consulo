{
  if (isDisposed())   return;
  abortRediff();
  onBeforeRediff();
  boolean forceEDT=ApplicationManager.getApplication().isWriteAccessAllowed();
  int waitMillis=trySync || tryRediffSynchronously() ? ProgressWindow.DEFAULT_PROGRESS_DIALOG_POSTPONE_TIME_MILLIS : 0;
  myTaskExecutor.executeAndTryWait(new Function<ProgressIndicator,Runnable>(){
    @Override public Runnable fun(    ProgressIndicator indicator){
      return performRediff(indicator);
    }
  }
,new Runnable(){
    @Override public void run(){
      onSlowRediff();
    }
  }
,waitMillis,forceEDT);
}
