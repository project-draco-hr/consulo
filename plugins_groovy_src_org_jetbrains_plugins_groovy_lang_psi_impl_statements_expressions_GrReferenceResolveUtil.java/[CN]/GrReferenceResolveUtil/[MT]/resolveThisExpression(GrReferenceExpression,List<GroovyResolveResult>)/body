{
  GrExpression qualifier=ref.getQualifier();
  if (qualifier == null) {
    final PsiElement parent=ref.getParent();
    if (parent instanceof GrConstructorInvocation) {
      GroovyResolveResult[] res=((GrConstructorInvocation)parent).multiResolve(false);
      ContainerUtil.addAll(results,res);
      return true;
    }
    PsiClass aClass=PsiUtil.getContextClass(ref);
    if (aClass == null)     return false;
    results.add(new GroovyResolveResultImpl(aClass,null,null,PsiSubstitutor.EMPTY,true,true));
    return true;
  }
 else {
    if (!(qualifier instanceof GrReferenceExpression))     return false;
    GroovyResolveResult result=((GrReferenceExpression)qualifier).advancedResolve();
    PsiElement resolved=result.getElement();
    if (!(resolved instanceof PsiClass))     return false;
    if (!PsiUtil.hasEnclosingInstanceInScope((PsiClass)resolved,ref,false))     return false;
    results.add(result);
    return true;
  }
}
