{
  final List<Module> modules=new ArrayList<Module>();
  for (  Module module : rootConfigurable.getModules()) {
    if (module.getModuleType() != ModuleType.J2EE_APPLICATION) {
      modules.add(module);
    }
  }
  Collections.sort(modules,new Comparator<Module>(){
    public int compare(    final Module m1,    final Module m2){
      return m1.getName().compareToIgnoreCase(m2.getName());
    }
  }
);
  final ChooseModulesDialog dlg=new ChooseModulesDialog(myProject,modules,ProjectBundle.message("choose.modules.dialog.title"),ProjectBundle.message("choose.modules.dialog.description",libraryToSelect.getName()));
  dlg.show();
  if (dlg.isOK()) {
    final List<Module> choosenModules=dlg.getChosenElements();
    for (    Module module : choosenModules) {
      rootConfigurable.addLibraryOrderEntry(module,libraryToSelect);
    }
  }
}
