{
  if (libraryToSelect != null) {
    selectLibrary(libraryToSelect,false);
    if (myProject != null) {
      final ProjectRootConfigurable rootConfigurable=ProjectRootConfigurable.getInstance(myProject);
      final LibraryEditor libraryEditor=getLibraryEditor(libraryToSelect);
      if (libraryEditor.hasChanges()) {
        ApplicationManager.getApplication().runWriteAction(new Runnable(){
          public void run(){
            libraryEditor.commit();
          }
        }
);
      }
      final DefaultMutableTreeNode libraryNode=rootConfigurable.createLibraryNode(libraryToSelect,libraryPresentableName,module);
      if (myNeedToSelect) {
        rootConfigurable.selectNodeInTree(libraryNode);
        if (!myEditingModuleLibraries) {
          appendLibraryToModules(rootConfigurable,libraryToSelect);
        }
      }
    }
  }
}
