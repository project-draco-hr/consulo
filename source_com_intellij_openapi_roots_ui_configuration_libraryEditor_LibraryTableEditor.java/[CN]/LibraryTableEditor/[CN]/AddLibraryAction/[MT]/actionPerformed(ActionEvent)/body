{
  final String initial=suggestNewLibraryName(myTableModifiableModel);
  final String prompt=ProjectBundle.message("library.name.prompt");
  final String title=myAddLibraryButton.getText();
  final Icon icon=Messages.getQuestionIcon();
  final String libraryName=Messages.showInputDialog(myProject,prompt,title,icon,initial,new InputValidator(){
    public boolean checkInput(    final String inputString){
      return true;
    }
    public boolean canClose(    final String inputString){
      if (inputString.length() == 0) {
        Messages.showErrorDialog(ProjectBundle.message("library.name.not.specified.error"),ProjectBundle.message("library.name.not.specified.title"));
        return false;
      }
      if (libraryAlreadyExists(myTableModifiableModel,inputString)) {
        Messages.showErrorDialog(ProjectBundle.message("library.name.already.exists.error",inputString),ProjectBundle.message("library.name.already.exists.title"));
        return false;
      }
      return true;
    }
  }
);
  if (libraryName == null)   return;
  final Library library=myTableModifiableModel.createLibrary(libraryName);
  selectLibrary(library,true);
  if (myProject != null) {
    final BaseLibrariesConfigurable rootConfigurable=ProjectStructureConfigurable.getInstance(myProject).getConfigurableFor(library);
    final LibraryEditor libraryEditor=getLibraryEditor(library);
    if (libraryEditor.hasChanges()) {
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          libraryEditor.commit();
        }
      }
);
    }
    final DefaultMutableTreeNode libraryNode=rootConfigurable.createLibraryNode(library,null,null);
    if (myNeedSelection) {
      rootConfigurable.selectNodeInTree(libraryNode);
      if (!myEditingModuleLibraries) {
        appendLibraryToModules(ModuleStructureConfigurable.getInstance(myProject),library);
      }
    }
  }
  librariesChanged(true);
}
