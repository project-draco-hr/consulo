{
  final Library library=getSelectedLibrary();
  if (library != null) {
    myDescriptor.setTitle(getTitle());
    myDescriptor.setTitle(getDescription());
    for (    Map.Entry<DataKey,Object> entry : myFileChooserUserData.entrySet()) {
      myDescriptor.putUserData(entry.getKey(),entry.getValue());
    }
    VirtualFile toSelect=null;
    if (Comparing.strEqual(myLibraryTableProvider.getTableLevel(),LibraryTablesRegistrar.PROJECT_LEVEL)) {
      final Project project=myProject;
      if (project != null) {
        toSelect=project.getBaseDir();
      }
    }
    attachFiles(library,scanForActualRoots(FileChooser.chooseFiles(myPanel,myDescriptor,toSelect)),getRootType(),addAsJarDirectories());
  }
  fireLibrariesChanged();
  myTree.requestFocus();
}
