{
  final VirtualFile[] filesToAttach=filterAlreadyAdded(library,files,rootType);
  if (filesToAttach.length > 0) {
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      public void run(){
        final LibraryEditor libraryEditor=getLibraryEditor(library);
        for (int i=0; i < filesToAttach.length; i++) {
          libraryEditor.addRoot(filesToAttach[i],rootType);
        }
        if (myEditingModuleLibraries) {
          commitChanges();
        }
      }
    }
);
    myTreeBuilder.updateFromRoot();
  }
}
