{
  if (myChildren instanceof VirtualFile[]) {
    return (VirtualFile[])myChildren;
  }
  final int[] childrenIds=ourPersistence.listIds(this);
  VirtualFile[] children=new VirtualFile[childrenIds.length];
  final Map<String,VirtualFile> map=asMap();
  for (int i=0; i < children.length; i++) {
    final int childId=childrenIds[i];
    final String name=ourPersistence.getName(childId);
    VirtualFile child=map != null ? map.get(name) : null;
    children[i]=child != null && child != NullVirtualFile.INSTANCE ? child : new VFileImpl(name,this,getFileSystem(),childId);
  }
  if (myId > 0) {
    myChildren=children;
  }
  return children;
}
