{
  final FileViewProvider viewProvider=file.getViewProvider();
  for (  final Language language : viewProvider.getLanguages()) {
    final PsiFile psi=viewProvider.getPsi(language);
    final FoldingBuilder foldingBuilder=LanguageFolding.INSTANCE.forLanguage(language);
    if (psi != null && foldingBuilder != null) {
      final ASTNode node=psi.getNode();
      for (      FoldingDescriptor descriptor : foldingBuilder.buildFoldRegions(node,document)) {
        elementsToFoldMap.put(descriptor.getElement().getPsi(),descriptor);
      }
    }
  }
}
