{
  DumbServiceImpl.getInstance(myProject).queueIndexUpdate(new Consumer<ProgressIndicator>(){
    public void consume(    final ProgressIndicator indicator){
      final MyFileContentQueue queue=new MyFileContentQueue();
      try {
        final double count=remaining.size();
        queue.queue(remaining,indicator);
        final Consumer<VirtualFile> uiUpdater=new Consumer<VirtualFile>(){
          final Set<VirtualFile> processed=new THashSet<VirtualFile>();
          public void consume(          VirtualFile virtualFile){
            indicator.checkCanceled();
            indicator.setFraction(processed.size() / count);
            processed.add(virtualFile);
            indicator.setText2(virtualFile.getPresentableUrl());
          }
        }
;
        while (!myProject.isDisposed()) {
          indicator.checkCanceled();
          if (runUntilNextWriteAction(queue,uiUpdater)) {
            break;
          }
        }
      }
  finally {
        queue.clear();
        updatingDone();
      }
    }
  }
);
}
