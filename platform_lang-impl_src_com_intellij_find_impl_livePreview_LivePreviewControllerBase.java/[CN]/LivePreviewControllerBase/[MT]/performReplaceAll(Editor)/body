{
  if (!Utils.ensureOkToWrite(e))   return;
  if (mySearchResults.getFindModel() != null) {
    final FindModel copy=new FindModel();
    copy.copyFrom(mySearchResults.getFindModel());
    final SelectionModel selectionModel=mySearchResults.getEditor().getSelectionModel();
    int offset=0;
    if (selectionModel.getSelectedText() != null) {
      if (!mySearchResults.getFindModel().isGlobal()) {
        offset=selectionModel.getSelectionStart();
      }
    }
 else {
      copy.setGlobal(true);
    }
    FindUtil.replace(e.getProject(),e,offset,copy,this);
    if (myReplaceListener != null) {
      myReplaceListener.replaceAllPerformed(e);
    }
  }
}
