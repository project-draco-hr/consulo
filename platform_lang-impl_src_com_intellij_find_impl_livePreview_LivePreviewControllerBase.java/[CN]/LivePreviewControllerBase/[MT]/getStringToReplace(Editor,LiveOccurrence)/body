{
  String foundString=editor.getDocument().getText(liveOccurrence.getPrimaryRange());
  String documentText=editor.getDocument().getText();
  FindModel currentModel=mySearchResults.getFindModel();
  String stringToReplace=null;
  if (currentModel != null) {
    if (currentModel.isReplaceState()) {
      FindManager findManager=FindManager.getInstance(editor.getProject());
      try {
        stringToReplace=findManager.getStringToReplace(foundString,currentModel,liveOccurrence.getPrimaryRange().getStartOffset(),documentText);
      }
 catch (      FindManager.MalformedReplacementStringException e) {
        return null;
      }
      if (stringToReplace != null && stringToReplace.isEmpty()) {
        stringToReplace=EMPTY_STRING_DISPLAY_TEXT;
      }
    }
  }
  return stringToReplace;
}
