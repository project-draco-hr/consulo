{
  if (myReplaceDenied || !ReadonlyStatusHandler.ensureDocumentWritable(editor.getProject(),editor.getDocument()))   return null;
  TextRange range=occurrence.getPrimaryRange();
  FindModel findModel=mySearchResults.getFindModel();
  TextRange result=null;
  try {
    FindManager findManager=FindManager.getInstance(editor.getProject());
    String stringToReplace=findManager.getStringToReplace(editor.getDocument().getText(range),findModel);
    result=FindUtil.doReplace(editor.getProject(),editor.getDocument(),findModel,new FindResultImpl(range.getStartOffset(),range.getEndOffset()),stringToReplace,true,new ArrayList<Pair<TextRange,String>>());
  }
 catch (  FindManager.MalformedReplacementStringException e) {
  }
  if (myReplaceListener != null) {
    myReplaceListener.replacePerformed(occurrence,replacement,editor);
  }
  myLivePreview.inSmartUpdate();
  mySearchResults.updateThreadSafe(findModel,true,result,mySearchResults.getStamp());
  return result;
}
