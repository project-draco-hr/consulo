{
  String errorString=null;
  final String innerClassName=getClassName();
  final PsiManager manager=PsiManager.getInstance(myProject);
  if ("".equals(innerClassName)) {
    errorString="Class name should be specified";
  }
 else   if (!manager.getNameHelper().isIdentifier(innerClassName)) {
    errorString=RefactoringMessageUtil.getIncorrectIdentifierMessage(innerClassName);
  }
 else {
    PsiElement targetContainer=AnonymousToInnerHandler.findTargetContainer(myAnonClass);
    if (targetContainer instanceof PsiClass) {
      PsiClass targetClass=(PsiClass)targetContainer;
      PsiClass[] innerClasses=targetClass.getInnerClasses();
      for (      PsiClass innerClass : innerClasses) {
        if (innerClassName.equals(innerClass.getName())) {
          errorString="Inner class named '" + innerClassName + "' is already defined\n"+ "in the class "+ targetClass.getName();
          break;
        }
      }
    }
 else {
      LOG.assertTrue(false);
    }
  }
  if (errorString != null) {
    RefactoringMessageUtil.showErrorMessage(REFACTORING_NAME,errorString,HelpID.ANONYMOUS_TO_INNER,myProject);
    myNameField.requestFocusInWindow();
    return;
  }
  super.doOKAction();
  myNameField.requestFocusInWindow();
}
