{
  final List<VirtualFile> toRefreshFiles=new ArrayList<VirtualFile>();
  final List<VirtualFile> toRefreshDirs=new ArrayList<VirtualFile>();
  for (  VirtualFile file : myFilesToRefresh) {
    if (file == null)     continue;
    if (file.isDirectory()) {
      toRefreshDirs.add(file);
    }
 else {
      toRefreshFiles.add(file);
    }
  }
  final RefreshSession session=RefreshQueue.getInstance().createSession(true,true,new Runnable(){
    public void run(){
      if (project.isDisposed())       return;
      filterOutInvalid(toRefreshFiles);
      filterOutInvalid(toRefreshDirs);
      final VcsDirtyScopeManager vcsDirtyScopeManager=VcsDirtyScopeManager.getInstance(project);
      vcsDirtyScopeManager.filesDirty(toRefreshFiles,toRefreshDirs);
    }
  }
);
  filterOutInvalid(myFilesToRefresh);
  session.addAllFiles(myFilesToRefresh);
  session.launch();
  myFilesToRefresh.clear();
}
