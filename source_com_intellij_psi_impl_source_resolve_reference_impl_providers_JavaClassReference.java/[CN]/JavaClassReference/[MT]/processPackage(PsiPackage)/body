{
  final PsiPackage[] subPackages=aPackage.getSubPackages();
  final PsiClass[] classes=aPackage.getClasses();
  final Map<CustomizableReferenceProvider.CustomizationKey,Object> options=getOptions();
  if (options != null) {
    final ArrayList<Object> list=new ArrayList<Object>(Arrays.asList(subPackages));
    final boolean instantiatable=JavaClassReferenceProvider.INSTANTIATABLE.getBooleanValue(options);
    final boolean concrete=JavaClassReferenceProvider.CONCRETE.getBooleanValue(options);
    final boolean notInterface=JavaClassReferenceProvider.NOT_INTERFACE.getBooleanValue(options);
    for (    PsiClass clazz : classes) {
      if (instantiatable) {
        if (PsiUtil.isInstantiatable(clazz)) {
          list.add(clazz);
        }
      }
 else       if (concrete) {
        if (!clazz.hasModifierProperty(PsiModifier.ABSTRACT) && !clazz.isInterface()) {
          list.add(clazz);
        }
      }
 else       if (notInterface) {
        if (!clazz.isInterface()) {
          list.add(clazz);
        }
      }
 else {
        list.add(clazz);
      }
    }
    return list.toArray();
  }
  return ArrayUtil.mergeArrays(subPackages,classes,Object.class);
}
