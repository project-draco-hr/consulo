{
  if (isReferenceTo(element))   return getElement();
  final String qualifiedName;
  if (element instanceof PsiClass) {
    PsiClass psiClass=(PsiClass)element;
    qualifiedName=psiClass.getQualifiedName();
  }
 else   if (element instanceof PsiPackage) {
    PsiPackage psiPackage=(PsiPackage)element;
    qualifiedName=psiPackage.getQualifiedName();
  }
 else {
    throw new IncorrectOperationException("Cannot bind to " + element);
  }
  final String newName=qualifiedName;
  TextRange range=new TextRange(myJavaClassReferenceSet.getReference(0).getRangeInElement().getStartOffset(),getRangeInElement().getEndOffset());
  final PsiElement finalElement=getManipulator(getElement()).handleContentChange(getElement(),range,newName);
  range=new TextRange(range.getStartOffset(),range.getStartOffset() + newName.length());
  myJavaClassReferenceSet.reparse(finalElement,range);
  return finalElement;
}
