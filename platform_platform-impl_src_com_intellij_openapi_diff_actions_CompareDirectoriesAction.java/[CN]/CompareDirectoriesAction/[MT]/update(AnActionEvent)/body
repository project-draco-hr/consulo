{
  final VirtualFile[] files=e.getData(PlatformDataKeys.VIRTUAL_FILE_ARRAY);
  if (files != null && files.length > 0 && files.length < 3) {
    if (files[0].isDirectory() && (files.length == 1 || files[1].isDirectory()) && files[0].getFileSystem() == LocalFileSystem.getInstance()) {
      e.getPresentation().setEnabled(true);
      e.getPresentation().setVisible(true);
      e.getPresentation().setText(files.length == 1 ? "Compare Directory with..." : "Compare Directories");
      return;
    }
  }
  e.getPresentation().setEnabled(false);
  e.getPresentation().setVisible(false);
}
