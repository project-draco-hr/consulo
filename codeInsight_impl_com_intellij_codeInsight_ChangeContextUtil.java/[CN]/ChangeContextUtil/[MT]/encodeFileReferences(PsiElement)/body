{
  element.accept(new PsiRecursiveElementVisitor(){
    public void visitElement(    PsiElement element){
      final PsiReference[] refs=element.getReferences();
      if (refs.length > 0) {
        final PsiElement resolved=refs[refs.length - 1].resolve();
        if (resolved instanceof PsiFileSystemItem) {
          element.putCopyableUserData(REF_FILE_SYSTEM_ITEM_KEY,((PsiFileSystemItem)resolved));
        }
      }
      element.acceptChildren(this);
    }
  }
);
}
