{
  myProject=project;
  myIdeFrame=((WindowManagerEx)WindowManager.getInstance()).getFrame(myProject);
  FileEditorManager.getInstance(project).addFileEditorManagerListener(new FileEditorManagerAdapter(){
    public void selectionChanged(    FileEditorManagerEvent event){
      if (myIdeFrame.getFocusOwner() == null)       return;
      setActiveWindow(myIdeFrame);
    }
  }
);
  myIdeFrame.addWindowFocusListener(myIdeFrameFocusListener);
  myEditorFactoryListener=new EditorFactoryListener(){
    public void editorCreated(    EditorFactoryEvent event){
      final Editor editor=event.getEditor();
      final PsiFile psiFile=PsiDocumentManager.getInstance(myProject).getPsiFile(editor.getDocument());
      if (psiFile == null)       return;
      editor.getComponent().addHierarchyListener(new HierarchyListener(){
        public void hierarchyChanged(        HierarchyEvent e){
          registerEditor(editor);
        }
      }
);
      editor.getContentComponent().addFocusListener(new FocusListener(){
        public void focusGained(        FocusEvent e){
          editorFocused(editor);
        }
        public void focusLost(        FocusEvent e){
        }
      }
);
    }
    public void editorReleased(    EditorFactoryEvent event){
      unregisterEditor(event.getEditor());
    }
  }
;
  EditorFactory.getInstance().addEditorFactoryListener(myEditorFactoryListener);
}
