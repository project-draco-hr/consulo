{
  unregisterEditor(editor);
  final Window window=windowByEditor(editor);
  if (window == null)   return;
  myEditorToWindowMap.put(editor,window);
  List<Editor> list=myWindowToEditorsMap.get(window);
  if (list == null) {
    list=new ArrayList<Editor>();
    myWindowToEditorsMap.put(window,list);
    if (!(window instanceof IdeFrame)) {
      window.addWindowFocusListener(new WindowFocusListener(){
        public void windowGainedFocus(        WindowEvent e){
          if (LOG.isDebugEnabled()) {
            LOG.debug("windowGainedFocus:" + window);
          }
          setActiveWindow(window);
        }
        public void windowLostFocus(        WindowEvent e){
          if (LOG.isDebugEnabled()) {
            LOG.debug("windowLostFocus:" + window);
          }
          setActiveWindow(null);
        }
      }
);
    }
  }
  list.add(editor);
  if (myActiveWindow == window) {
    setActiveWindow(window);
  }
}
