{
  Pair<StoredContent,Long> contentAndStamp=f.getUserData(SAVED_DOCUMENT_CONTENT_AND_STAMP_KEY);
  if (contentAndStamp == null) {
    if (d != null)     saveDocumentContent(f,d);
    return StoredContent.acquireContent(f);
  }
  StoredContent content=contentAndStamp.first;
  if (d == null) {
    f.putUserData(SAVED_DOCUMENT_CONTENT_AND_STAMP_KEY,null);
    return content;
  }
  if (d.getModificationStamp() == contentAndStamp.second)   return null;
  saveDocumentContent(f,d);
  return content;
}
