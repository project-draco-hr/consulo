{
  ContentAndTimestamps contentAndStamp=f.getUserData(SAVED_DOCUMENT_CONTENT_AND_STAMP_KEY);
  if (contentAndStamp == null) {
    if (d != null)     saveDocumentContent(f,d);
    return Pair.create(StoredContent.acquireContent(f),f.getTimeStamp());
  }
  if (d == null) {
    f.putUserData(SAVED_DOCUMENT_CONTENT_AND_STAMP_KEY,null);
    return Pair.create(contentAndStamp.content,contentAndStamp.registeredTimestamp);
  }
  if (d.getModificationStamp() == contentAndStamp.documentModificationStamp)   return null;
  saveDocumentContent(f,d);
  return Pair.create(contentAndStamp.content,contentAndStamp.registeredTimestamp);
}
