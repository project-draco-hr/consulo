{
  if (!file.isDirectory()) {
    if (!isVersioned(file))     return null;
    Content c;
    if (forDeletion) {
      FileDocumentManager m=FileDocumentManager.getInstance();
      Document d=m.getCachedDocument(file);
      if (d != null && !m.isDocumentUnsaved(d))       d=null;
      c=acquireAndClearCurrentContent(file,d);
    }
 else {
      c=getActualContentNoAcquire(file);
    }
    return new FileEntry(file.getName(),c,file.getTimeStamp(),!file.isWritable());
  }
  DirectoryEntry newDir=new DirectoryEntry(file.getName());
  doCreateChildren(newDir,((NewVirtualFile)file).iterInDbChildren(),forDeletion);
  if (!isVersioned(file) && newDir.getChildren().isEmpty())   return null;
  return newDir;
}
