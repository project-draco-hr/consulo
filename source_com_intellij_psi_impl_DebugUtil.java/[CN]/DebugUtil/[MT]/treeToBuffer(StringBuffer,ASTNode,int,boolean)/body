{
  if (skipWhiteSpaces && root.getElementType() == ElementType.WHITE_SPACE)   return;
  for (int i=0; i < indent; i++) {
    buffer.append(' ');
  }
  if (root instanceof CompositeElement) {
    buffer.append(SourceTreeToPsiMap.treeElementToPsi(root).toString());
  }
 else {
    String text=root.getText();
    text=StringUtil.replace(text,"\n","\\n");
    text=StringUtil.replace(text,"\r","\\r");
    text=StringUtil.replace(text,"\t","\\t");
    buffer.append(root.toString() + "('" + text+ "')");
  }
  buffer.append("\n");
  if (root instanceof CompositeElement) {
    ChameleonTransforming.transformChildren(root);
    ASTNode child=root.getFirstChildNode();
    if (child == null) {
      for (int i=0; i < indent + 2; i++) {
        buffer.append(' ');
      }
      buffer.append("<empty list>\n");
    }
 else     while (child != null) {
      treeToBuffer(buffer,child,indent + 2,skipWhiteSpaces);
      child=child.getTreeNext();
    }
  }
}
