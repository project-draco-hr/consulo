{
  PsiVariable refVariable=findPreviousVariable();
  if (refVariable == null)   return;
  if (!CodeInsightUtil.preparePsiElementsForWrite(Arrays.asList(variable,refVariable)))   return;
  refVariable.getModifierList().setModifierProperty(PsiModifier.FINAL,false);
  if (variable.getInitializer() == null) {
    variable.delete();
    return;
  }
  PsiDeclarationStatement declaration=(PsiDeclarationStatement)variable.getParent();
  PsiElementFactory factory=JavaPsiFacade.getInstance(variable.getProject()).getElementFactory();
  PsiStatement statement=factory.createStatementFromText(variable.getName() + " = " + variable.getInitializer().getText()+ ";",variable);
  declaration.replace(statement);
}
