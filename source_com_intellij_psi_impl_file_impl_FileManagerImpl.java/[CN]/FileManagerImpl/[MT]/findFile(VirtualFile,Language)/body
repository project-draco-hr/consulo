{
  final ProjectEx project=(ProjectEx)myManager.getProject();
  if (project.isDummy() || project.isDefault())   return null;
  ApplicationManager.getApplication().assertReadAccessAllowed();
  if (file == null) {
    LOG.assertTrue(false);
    return null;
  }
  if (!file.isValid()) {
    LOG.assertTrue(false,"Invalid file: " + file);
  }
  dispatchPendingEvents();
synchronized (PsiLock.LOCK) {
    final FileCacheEntry key=new FileCacheEntry(file,aspect);
    PsiFile psiFile=myVFileToPsiFileMap.get(key);
    if (psiFile != null)     return psiFile;
    psiFile=createPsiFile(file,aspect);
    if (psiFile == null)     return null;
    myVFileToPsiFileMap.put(key,psiFile);
    return psiFile;
  }
}
