{
  VirtualFile vFile=file.getVirtualFile();
  if (file instanceof PsiBinaryFile) {
    file.setModificationStamp(vFile.getModificationStamp());
  }
 else {
    FileDocumentManager fileDocumentManager=myFileDocumentManager;
    Document document=fileDocumentManager.getCachedDocument(vFile);
    if (document != null && !ignoreDocument) {
      fileDocumentManager.reloadFromDisk(document);
    }
 else {
      PsiTreeChangeEventImpl event=new PsiTreeChangeEventImpl(myManager);
      event.setParent(file);
      event.setFile(file);
      if (file instanceof PsiFileImpl && ((PsiFileImpl)file).isContentsLoaded()) {
        event.setOffset(0);
        event.setOldLength(file.getTextLength());
      }
      myManager.beforeChildrenChange(event);
      if (file instanceof PsiFileImpl) {
        PsiFileImpl fileImpl=(PsiFileImpl)file;
        fileImpl.subtreeChanged();
        if (fileImpl.isContentsLoaded()) {
          ((PsiFileImpl)file).unloadContent();
        }
      }
 else       if (file instanceof ClsFileImpl) {
        if (((ClsFileImpl)file).isContentsLoaded()) {
          ((ClsFileImpl)file).unloadContent();
        }
      }
      file.setModificationStamp(vFile.getModificationStamp());
      myManager.childrenChanged(event);
    }
  }
}
