{
  final ProjectDescriptor pd=context.getProjectDescriptor();
  final BuildFSState fsState=pd.fsState;
  for (  BuildTarget<?> target : chunk.getTargets()) {
    pd.getTargetsState().getTargetConfiguration(target).storeNonexistentOutputRoots(context);
  }
  if (!Utils.errorsDetected(context) && !context.getCancelStatus().isCanceled()) {
    boolean marked=dropRemovedPaths(context,chunk);
    for (    BuildTarget<?> target : chunk.getTargets()) {
      if (target instanceof ModuleBuildTarget) {
        context.clearNonIncrementalMark((ModuleBuildTarget)target);
      }
      final Timestamps timestamps=pd.timestamps.getStorage();
      for (      BuildRootDescriptor rd : pd.getBuildRootIndex().getTargetRoots(target,context)) {
        marked|=fsState.markAllUpToDate(context,rd,timestamps);
      }
    }
    if (marked) {
      context.processMessage(DoneSomethingNotification.INSTANCE);
    }
  }
}
