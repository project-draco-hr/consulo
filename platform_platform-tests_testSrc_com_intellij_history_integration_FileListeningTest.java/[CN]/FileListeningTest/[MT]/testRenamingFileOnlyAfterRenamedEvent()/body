{
  final VirtualFile f=createFile("old.txt");
  final int[] log=new int[2];
  VirtualFileListener l=new VirtualFileAdapter(){
    @Override public void beforePropertyChange(    @NotNull VirtualFilePropertyEvent e){
      log[0]=getRevisionsFor(f).size();
    }
    @Override public void propertyChanged(    @NotNull VirtualFilePropertyEvent e){
      log[1]=getRevisionsFor(f).size();
    }
  }
;
  assertEquals(2,getRevisionsFor(f).size());
  addFileListenerDuring(l,new RunnableAdapter(){
    @Override public void doRun() throws IOException {
      f.rename(this,"new.txt");
    }
  }
);
  assertEquals(2,log[0]);
  assertEquals(3,log[1]);
}
