{
  final ApplicationAdapter listener=new ApplicationAdapter(){
    @Override public void beforeWriteActionStart(    Object action){
      progressIndicator.cancel();
    }
  }
;
  final Application application=ApplicationManager.getApplication();
  try {
    application.addApplicationListener(listener);
    ProgressManager.getInstance().runProcess(new Runnable(){
      @Override public void run(){
        try {
          application.runReadAction(new Runnable(){
            @Override public void run(){
              task.computeInReadAction(progressIndicator);
            }
          }
);
        }
 catch (        ProcessCanceledException ignore) {
        }
 finally {
          if (progressIndicator.isCanceled()) {
            task.onCanceled(progressIndicator);
          }
        }
      }
    }
,progressIndicator);
  }
  finally {
    application.removeApplicationListener(listener);
  }
}
