{
  final DebuggerTreeNodeImpl node=getSelectedNode(event.getDataContext());
  if (node == null) {
    return;
  }
  final NodeDescriptorImpl descriptor=node.getDescriptor();
  if (!(descriptor instanceof ValueDescriptorImpl)) {
    return;
  }
  final DebuggerTree tree=node.getTree();
  tree.saveState(node);
  final ValueDescriptorImpl valueDescriptor=((ValueDescriptorImpl)descriptor);
  final DebuggerContextImpl debuggerContext=tree.getDebuggerContext();
  final ValueMarkup markup=valueDescriptor.getMarkup(debuggerContext.getDebugProcess());
  try {
    if (markup != null) {
      valueDescriptor.setMarkup(debuggerContext.getDebugProcess(),null);
    }
 else {
      final ValueMarkup valueMarkup=ObjectMarkupPropertiesDialog.chooseMarkup(valueDescriptor.getName());
      if (valueMarkup != null) {
        valueDescriptor.setMarkup(debuggerContext.getDebugProcess(),valueMarkup);
      }
 else {
        return;
      }
    }
  }
  finally {
    tree.restoreState(node);
    node.labelChanged();
  }
  final DebuggerSession session=debuggerContext.getDebuggerSession();
  if (session != null) {
    session.refresh(true);
  }
}
