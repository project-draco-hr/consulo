{
  super.install(statusBar);
  EncodingManager.getInstance().addPropertyChangeListener(new PropertyChangeListener(){
    @Override public void propertyChange(    PropertyChangeEvent evt){
      if (evt.getPropertyName().equals(EncodingManagerImpl.PROP_CACHED_ENCODING_CHANGED)) {
        update();
      }
    }
  }
,this);
  ApplicationManager.getApplication().getMessageBus().connect(this).subscribe(VirtualFileManager.VFS_CHANGES,new BulkVirtualFileListenerAdapter(new VirtualFileAdapter(){
    @Override public void propertyChanged(    VirtualFilePropertyEvent event){
      if (VirtualFile.PROP_ENCODING.equals(event.getPropertyName())) {
        update();
      }
    }
  }
));
  final Alarm update=new Alarm();
  EditorFactory.getInstance().getEventMulticaster().addDocumentListener(new DocumentAdapter(){
    @Override public void documentChanged(    DocumentEvent e){
      Document document=e.getDocument();
      Editor selectedEditor=getEditor();
      if (selectedEditor == null || selectedEditor.getDocument() != document)       return;
      update.cancelAllRequests();
      update.addRequest(new Runnable(){
        @Override public void run(){
          if (!isDisposed())           update();
        }
      }
,200);
    }
  }
,this);
}
