{
  Pair<String,Boolean> result=ChooseFileEncodingAction.update(getSelectedFile());
  boolean enabled=result.second;
  final DataContext parent=DataManager.getInstance().getDataContext((Component)myStatusBar);
  final DataContext dataContext=SimpleDataContext.getSimpleContext(PlatformDataKeys.VIRTUAL_FILE.getName(),getSelectedFile(),SimpleDataContext.getSimpleContext(PlatformDataKeys.PROJECT.getName(),getProject(),parent));
  if (!enabled) {
    return null;
  }
  DefaultActionGroup group=new ChooseFileEncodingAction(getSelectedFile()){
    @Override protected void chosen(    VirtualFile virtualFile,    Charset charset){
      if (virtualFile != null) {
        EncodingManager.getInstance().setEncoding(virtualFile,charset);
        update(new AnActionEvent(null,dataContext,ActionPlaces.EDITOR_TOOLBAR,getTemplatePresentation(),ActionManager.getInstance(),0));
        EncodingPanel.this.update();
      }
    }
  }
.createGroup(null);
  return JBPopupFactory.getInstance().createActionGroupPopup(null,group,dataContext,false,false,false,null,30,null);
}
