{
  UIUtil.invokeLaterIfNeeded(new Runnable(){
    @Override public void run(){
      VirtualFile file=getSelectedFile();
      Charset charset=cachedCharsetFromContent(file);
      if (charset == null && file != null)       charset=file.getCharset();
      String text=charset == null ? "" : charset.displayName();
      actionEnabled=encodingActionsPair.areActionsEnabled(null,getEditor(),(Component)myStatusBar,file,getProject());
      Pair<Charset,String> check=file == null ? null : ChooseFileEncodingAction.checkCanReload(file);
      String failReason=check == null ? null : check.second;
      String toolTip="File Encoding" + (check == null || check.first == null ? "" : ": " + check.first.displayName()) + (actionEnabled || failReason == null ? "" : " (change disabled: " + failReason + ")");
      myComponent.setToolTipText(toolTip);
      myComponent.setText(text);
      if (actionEnabled) {
        myComponent.setForeground(UIUtil.getActiveTextColor());
      }
 else {
        myComponent.setForeground(UIUtil.getInactiveTextColor());
      }
      if (myStatusBar != null) {
        myStatusBar.updateWidget(ID());
      }
    }
  }
);
}
