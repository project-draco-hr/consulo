{
  UIUtil.invokeLaterIfNeeded(new Runnable(){
    @Override public void run(){
      VirtualFile file=getSelectedFile();
      String fromBytes=file == null ? null : LoadTextUtil.wasCharsetDetectedFromBytes(file);
      Charset charset=fromBytes == null ? cachedCharsetFromContent(file) : null;
      if (charset == null && file != null)       charset=file.getCharset();
      String text=charset == null ? "" : charset.displayName();
      String failReason=file == null ? null : EncodingActionsPair.checkSomeActionEnabled(file);
      actionEnabled=file != null && failReason == null;
      Pair<Charset,String> check=file == null ? null : ChooseFileEncodingAction.checkCanReload(file);
      String toolTip="File Encoding" + (check == null || check.first == null ? "" : ": " + check.first.displayName()) + (failReason == null ? "" : actionEnabled ? " (" + failReason + ")" : " (change disabled: " + failReason + ")");
      myComponent.setToolTipText(toolTip);
      myComponent.setText(text);
      if (actionEnabled) {
        myComponent.setForeground(UIUtil.getActiveTextColor());
      }
 else {
        myComponent.setForeground(UIUtil.getInactiveTextColor());
      }
      if (myStatusBar != null) {
        myStatusBar.updateWidget(ID());
      }
    }
  }
);
}
