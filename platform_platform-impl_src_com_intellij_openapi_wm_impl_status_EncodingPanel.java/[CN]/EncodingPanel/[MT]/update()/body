{
  UIUtil.invokeLaterIfNeeded(new Runnable(){
    @Override public void run(){
      VirtualFile file=getSelectedFile();
      String fromBytes=file == null ? null : LoadTextUtil.wasCharsetDetectedFromBytes(file);
      Charset charset=fromBytes == null ? cachedCharsetFromContent(file) : null;
      if (charset == null && file != null)       charset=file.getCharset();
      String text=charset == null ? "" : charset.displayName();
      Pair<Charset,String> check=file == null ? null : EncodingUtil.checkSomeActionEnabled(file);
      String failReason=check == null ? null : check.second;
      Charset currentCharset=check == null ? null : check.first;
      actionEnabled=failReason == null;
      String toolTip="File Encoding" + (currentCharset == null ? "" : ": " + currentCharset.displayName()) + (failReason == null ? "" : actionEnabled ? " (" + failReason + ")" : " (change disabled: " + failReason + ")");
      myComponent.setToolTipText(toolTip);
      myComponent.setText(text);
      if (actionEnabled) {
        myComponent.setForeground(UIUtil.getActiveTextColor());
      }
 else {
        myComponent.setForeground(UIUtil.getInactiveTextColor());
      }
      if (myStatusBar != null) {
        myStatusBar.updateWidget(ID());
      }
    }
  }
);
}
