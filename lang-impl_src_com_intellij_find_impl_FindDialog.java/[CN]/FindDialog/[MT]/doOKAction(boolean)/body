{
  FindModel validateModel=(FindModel)myModel.clone();
  applyTo(validateModel);
  validateModel.setFindAll(findAll);
  if (validateModel.getDirectoryName() != null) {
    PsiDirectory directory=FindInProjectUtil.getPsiDirectory(validateModel,myProject);
    if (directory == null) {
      Messages.showMessageDialog(myProject,FindBundle.message("find.directory.not.found.error",validateModel.getDirectoryName()),CommonBundle.getErrorTitle(),Messages.getErrorIcon());
      return;
    }
  }
  if (validateModel.isRegularExpressions()) {
    String toFind=validateModel.getStringToFind();
    try {
      Pattern pattern=Pattern.compile(toFind,validateModel.isCaseSensitive() ? Pattern.MULTILINE : Pattern.MULTILINE | Pattern.CASE_INSENSITIVE);
      if (pattern.matcher("").matches() && !toFind.endsWith("$") && !toFind.startsWith("^")) {
        throw new PatternSyntaxException(FindBundle.message("find.empty.match.regular.expression.error"),toFind,-1);
      }
    }
 catch (    PatternSyntaxException e) {
      Messages.showMessageDialog(myProject,FindBundle.message("find.invalid.regular.expression.error",toFind,e.getDescription()),CommonBundle.getErrorTitle(),Messages.getErrorIcon());
      return;
    }
  }
  validateModel.setFileFilter(null);
  FindSettings.getInstance().setFileMask(null);
  if (useFileFilter != null && useFileFilter.isSelected() && myFileFilter.getSelectedItem() != null) {
    final String mask=(String)myFileFilter.getSelectedItem();
    if (mask.length() > 0) {
      try {
        FindInProjectUtil.createFileMaskRegExp(mask);
        validateModel.setFileFilter(mask);
        FindSettings.getInstance().setFileMask(mask);
      }
 catch (      PatternSyntaxException ex) {
        Messages.showMessageDialog(myProject,FindBundle.message("find.filter.invalid.file.mask.error",myFileFilter.getSelectedItem()),CommonBundle.getErrorTitle(),Messages.getErrorIcon());
        return;
      }
    }
 else {
      Messages.showMessageDialog(myProject,FindBundle.message("find.filter.empty.file.mask.error"),CommonBundle.getErrorTitle(),Messages.getErrorIcon());
      return;
    }
  }
  if (myCbToSkipResultsWhenOneUsage != null) {
    FindSettings.getInstance().setSkipResultsWithOneUsage(isSkipResultsWhenOneUsage());
  }
  myModel.copyFrom(validateModel);
  super.doOKAction();
  myOkHandler.run();
}
