{
  if (duplicates.size() > 0) {
    final String message=RefactoringBundle.message("idea.has.found.fragments.that.can.be.replaced.with.include.directive",ApplicationNamesInfo.getInstance().getProductName());
    final int exitCode=Messages.showYesNoDialog(project,message,REFACTORING_NAME,Messages.getInformationIcon());
    if (exitCode == DialogWrapper.OK_EXIT_CODE) {
      CommandProcessor.getInstance().executeCommand(project,new Runnable(){
        public void run(){
          boolean replaceAll=false;
          for (          Pair<PsiElement,PsiElement> pair : duplicates) {
            if (!replaceAll) {
              highlightInEditor(project,pair,editor);
              ReplacePromptDialog promptDialog=new ReplacePromptDialog(false,RefactoringBundle.message("replace.fragment"),project);
              promptDialog.show();
              final int promptResult=promptDialog.getExitCode();
              if (promptResult == FindManager.PromptResult.SKIP)               continue;
              if (promptResult == FindManager.PromptResult.CANCEL)               break;
              if (promptResult == FindManager.PromptResult.OK) {
                doReplaceRange(includePath,((T)pair.getFirst()),(T)pair.getSecond());
              }
 else               if (promptResult == FindManager.PromptResult.ALL) {
                doReplaceRange(includePath,((T)pair.getFirst()),(T)pair.getSecond());
                replaceAll=true;
              }
 else {
                LOG.error("Unknown return status");
              }
            }
 else {
              doReplaceRange(includePath,((T)pair.getFirst()),(T)pair.getSecond());
            }
          }
        }
      }
,RefactoringBundle.message("remove.duplicates.command"),null);
    }
  }
}
