{
  final VirtualFile testDataRoot=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(new File(getTestDataPath()));
  assertNotNull(testDataRoot);
  final VirtualFile file=testDataRoot.findFileByRelativePath(filePath);
  assertNotNull(file);
  String fileText;
  try {
    fileText=StringUtil.convertLineSeparators(VfsUtil.loadText(file));
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
  final int offset=fileText.indexOf(MARKER);
  assertTrue(offset >= 0);
  fileText=fileText.substring(0,offset) + fileText.substring(offset + MARKER.length());
  final String finalFileText=fileText;
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      myFixture.configureByText(new File(filePath).getName(),finalFileText);
    }
  }
);
  return myFixture.getFile().findReferenceAt(offset);
}
