{
  for (  FacetState child : facetStates) {
    final String typeId=child.getFacetType();
    if (typeId == null) {
      registerLoadingError(underlyingFacet,child,ProjectBundle.message("error.message.facet.type.isn.t.specified"));
      continue;
    }
    final FacetType<?,?> type=myFacetTypeRegistry.findFacetType(typeId);
    if (type == null) {
      registerLoadingError(underlyingFacet,child,ProjectBundle.message("error.message.unknown.facet.type.0",typeId));
      continue;
    }
    ModuleType moduleType=myModule.getModuleType();
    if (!type.isSuitableModuleType(moduleType)) {
      registerLoadingError(underlyingFacet,child,ProjectBundle.message("error.message.0.facets.are.not.allowed.in.1",type.getPresentableName(),moduleType.getName()));
      continue;
    }
    FacetType<?,?> expectedUnderlyingType=null;
    FacetTypeId<?> underlyingTypeId=type.getUnderlyingFacetType();
    if (underlyingTypeId != null) {
      expectedUnderlyingType=myFacetTypeRegistry.findFacetType(underlyingTypeId);
      if (expectedUnderlyingType == null) {
        registerLoadingError(underlyingFacet,child,ProjectBundle.message("error.message.cannot.find.underlying.facet.type.for.0",typeId));
        continue;
      }
    }
    FacetType actualUnderlyingType=underlyingFacet != null ? underlyingFacet.getType() : null;
    if (expectedUnderlyingType != null) {
      if (!expectedUnderlyingType.equals(actualUnderlyingType)) {
        registerLoadingError(underlyingFacet,child,ProjectBundle.message("error.message.0.facet.must.be.placed.under.1.facet",type.getPresentableName(),expectedUnderlyingType.getPresentableName()));
        continue;
      }
    }
 else     if (actualUnderlyingType != null) {
      registerLoadingError(underlyingFacet,child,ProjectBundle.message("error.message.0.cannot.be.placed.under.1",type.getPresentableName(),actualUnderlyingType.getPresentableName()));
      continue;
    }
    try {
      addFacet(type,child,underlyingFacet,model);
    }
 catch (    InvalidDataException e) {
      LOG.info(e);
      registerLoadingError(underlyingFacet,child,ProjectBundle.message("error.message.cannot.load.facet.condiguration.0",e.getMessage()));
    }
  }
}
