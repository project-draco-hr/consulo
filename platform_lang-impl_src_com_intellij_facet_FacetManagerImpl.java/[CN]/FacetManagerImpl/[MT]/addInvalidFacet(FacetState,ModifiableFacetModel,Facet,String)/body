{
  final InvalidFacetManager invalidFacetManager=InvalidFacetManager.getInstance(myModule.getProject());
  final InvalidFacetType type=InvalidFacetType.getInstance();
  final InvalidFacetConfiguration configuration=new InvalidFacetConfiguration(state,errorMessage);
  final InvalidFacet facet=createFacet(type,StringUtil.notNullize(state.getName()),configuration,underlyingFacet);
  model.addFacet(facet);
  if (!invalidFacetManager.isIgnored(facet)) {
    FacetLoadingErrorDescription description=new FacetLoadingErrorDescription(facet);
    ProjectLoadingErrorsNotifier.getInstance(myModule.getProject()).registerError(description);
  }
}
