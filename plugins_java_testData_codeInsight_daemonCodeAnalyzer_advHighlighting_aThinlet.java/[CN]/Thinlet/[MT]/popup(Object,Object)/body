{
  Object popup=null;
  int px=0;
  int py=0;
  if (("menubar" == classname) || ("popupmenu" == classname)) {
    Object popupmenu=get(component,"popupmenu");
    Object selected=get(component,"selected");
    if (popupmenu != null) {
      if (get(popupmenu,"menu") == selected) {
        return null;
      }
      set(popupmenu,"selected",null);
      set(popupmenu,"menu",null);
      removeItemImpl(content,"component",popupmenu);
      repaint(popupmenu);
      set(popupmenu,":parent",null);
      set(component,"popupmenu",null);
      if (mouseinside == popupmenu) {
        findComponent(content,mousex,mousey);
        handleMouseEvent(mousex,mousex,1,false,false,false,MouseEvent.MOUSE_ENTERED,mouseinside,insidepart);
      }
      popup(popupmenu,"popupmenu");
    }
    if ((selected == null) || (getClass(selected) != "menu")) {
      return null;
    }
    popup=createImpl("popupmenu");
    set(popup,"menu",selected);
    set(component,"popupmenu",popup);
    Rectangle bounds=getRectangle(selected,"bounds");
    if ("menubar" == classname) {
      px=bounds.x;
      py=bounds.y + bounds.height - 1;
    }
 else {
      px=bounds.x + getRectangle(component,"bounds").width - 4;
      py=bounds.y;
    }
  }
 else {
    popup=createImpl("combolist");
    set(popup,"combobox",component);
    set(component,"combolist",popup);
    py=getRectangle(component,"bounds").height + 1;
  }
  if (("menubar" == classname) || ("combobox" == classname)) {
    popupowner=component;
  }
  insertItem(content,"component",popup,0);
  set(popup,":parent",content);
  while (component != content) {
    Rectangle r=getRectangle(component,"bounds");
    px+=r.x;
    py+=r.y;
    component=getParent(component);
  }
  setRectangle(popup,"bounds",px,py,0,0);
  doLayout(popup);
  repaint(popup);
  return popup;
}
