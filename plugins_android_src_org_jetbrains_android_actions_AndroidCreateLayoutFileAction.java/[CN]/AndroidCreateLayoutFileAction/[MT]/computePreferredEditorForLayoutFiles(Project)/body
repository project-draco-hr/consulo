{
  final EditorHistoryManager manager=EditorHistoryManager.getInstance(project);
  final Set<VirtualFile> resourceDirs=new HashSet<VirtualFile>();
  final List<AndroidFacet> facets=ProjectFacetManager.getInstance(project).getFacets(AndroidFacet.ID);
  for (  AndroidFacet facet : facets) {
    final VirtualFile resourceDir=AndroidRootUtil.getResourceDir(facet);
    if (resourceDir != null) {
      resourceDirs.add(resourceDir);
    }
  }
  final VirtualFile[] files=manager.getFiles();
  for (int i=files.length - 1; i >= 0; i--) {
    final VirtualFile file=files[i];
    final VirtualFile parent=file.getParent();
    if (parent != null) {
      final String resType=AndroidCommonUtils.getResourceTypeByDirName(parent.getName());
      if (ResourceType.LAYOUT.getName().equals(resType) && resourceDirs.contains(parent.getParent())) {
        final FileEditorProvider provider=manager.getSelectedProvider(file);
        if (provider != null) {
          return provider.getEditorTypeId();
        }
      }
    }
  }
  return null;
}
