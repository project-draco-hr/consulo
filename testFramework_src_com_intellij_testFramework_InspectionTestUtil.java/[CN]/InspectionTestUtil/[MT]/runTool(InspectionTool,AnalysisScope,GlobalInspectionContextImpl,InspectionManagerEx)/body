{
  final String shortName=tool.getShortName();
  final HighlightDisplayKey key=HighlightDisplayKey.find(shortName);
  if (key == null) {
    HighlightDisplayKey.register(shortName);
  }
  globalContext.getTools().put(tool.getShortName(),Collections.singleton(new Pair<InspectionTool,NamedScope>(tool,null)));
  tool.initialize(globalContext);
  ((RefManagerImpl)globalContext.getRefManager()).initializeAnnotators();
  if (tool.isGraphNeeded()) {
    ((RefManagerImpl)tool.getRefManager()).findAllDeclarations();
  }
  tool.runInspection(scope,inspectionManager);
  tool.queryExternalUsagesRequests(inspectionManager);
}
