{
  Assert.assertFalse(getMyBuilder().myWasCleanedUp);
  invokeLaterIfNeeded(new Runnable(){
    @Override public void run(){
      getBuilder().getUi().deactivate();
    }
  }
);
  final WaitFor waitFor=new WaitFor(){
    @Override protected boolean condition(){
      return getMyBuilder().myWasCleanedUp || myCancelRequest != null;
    }
  }
;
  if (myCancelRequest != null) {
    throw new Exception(myCancelRequest);
  }
  waitFor.assertCompleted("Tree cleanup was not performed. isCancelledReadyState=" + getBuilder().getUi().isCancelledReady());
  Assert.assertTrue(getMyBuilder().myWasCleanedUp);
}
