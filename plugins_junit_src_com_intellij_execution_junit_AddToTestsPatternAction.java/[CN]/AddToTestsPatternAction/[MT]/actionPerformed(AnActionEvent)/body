{
  final DataContext dataContext=e.getDataContext();
  final PsiElement[] psiElements=LangDataKeys.PSI_ELEMENT_ARRAY.getData(dataContext);
  final Set<PsiClass> classes=collectTestClasses(psiElements);
  final String classNames=StringUtil.join(classes,new Function<PsiClass,String>(){
    public String fun(    PsiClass psiClass){
      return psiClass.getQualifiedName();
    }
  }
,"||");
  final Project project=PlatformDataKeys.PROJECT.getData(dataContext);
  final List<JUnitConfiguration> patternConfigurations=collectPatternConfigurations(classes,project);
  if (patternConfigurations.size() == 1) {
    final JUnitConfiguration configuration=patternConfigurations.get(0);
    configuration.getPersistentData().PATTERN+=(configuration.getPersistentData().PATTERN.length() > 0 ? "||" : "") + classNames;
  }
 else {
    JBPopupFactory.getInstance().createListPopup(new BaseListPopupStep<JUnitConfiguration>("Choose suite to add",patternConfigurations){
      @Override public PopupStep onChosen(      JUnitConfiguration configuration,      boolean finalChoice){
        configuration.getPersistentData().PATTERN+=(configuration.getPersistentData().PATTERN.length() > 0 ? "||" : "") + classNames;
        return FINAL_CHOICE;
      }
      @Override public Icon getIconFor(      JUnitConfiguration configuration){
        return configuration.getIcon();
      }
      @NotNull @Override public String getTextFor(      JUnitConfiguration value){
        return value.getName();
      }
    }
).showInBestPositionFor(dataContext);
  }
}
