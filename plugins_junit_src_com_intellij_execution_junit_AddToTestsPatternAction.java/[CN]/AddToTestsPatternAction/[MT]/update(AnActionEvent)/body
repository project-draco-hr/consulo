{
  final Presentation presentation=e.getPresentation();
  presentation.setVisible(false);
  final DataContext dataContext=e.getDataContext();
  final PsiElement[] psiElements=LangDataKeys.PSI_ELEMENT_ARRAY.getData(dataContext);
  if (psiElements != null) {
    final Set<PsiClass> foundClasses=PatternConfigurationProducer.collectTestClasses(psiElements);
    if (foundClasses.isEmpty())     return;
    final Project project=PlatformDataKeys.PROJECT.getData(dataContext);
    if (project != null) {
      final List<JUnitConfiguration> foundConfigurations=collectPatternConfigurations(foundClasses,project);
      if (!foundConfigurations.isEmpty()) {
        presentation.setVisible(true);
        if (foundConfigurations.size() == 1) {
          final String patternPresentation=JUnitConfiguration.Data.getPatternPresentation(foundConfigurations.get(0).getPersistentData().getPatterns());
          presentation.setText("Add to temp suite: " + patternPresentation);
        }
      }
    }
  }
}
