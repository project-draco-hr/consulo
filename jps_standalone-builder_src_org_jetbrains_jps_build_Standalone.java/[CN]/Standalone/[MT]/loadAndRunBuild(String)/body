{
  String globalOptionsPath=null;
  if (configPath != null) {
    File optionsDir=new File(configPath,"options");
    if (!optionsDir.isDirectory()) {
      System.err.println("'" + configPath + "' is not valid config path: "+ optionsDir.getAbsolutePath()+ " not found");
      return;
    }
    globalOptionsPath=optionsDir.getAbsolutePath();
  }
  ParameterizedRunnable<JpsModel> initializer=null;
  String scriptPath=initializationScriptPath;
  if (scriptPath != null) {
    File scriptFile=new File(scriptPath);
    if (!scriptFile.isFile()) {
      System.err.println("Script '" + scriptPath + "' not found");
      return;
    }
    initializer=new GroovyModelInitializer(scriptFile);
  }
  Map<String,String> pathVars=new HashMap<String,String>();
  pathVars.put("USER_HOME",System.getProperty("user.home"));
  JpsModelLoaderImpl loader=new JpsModelLoaderImpl(projectPath,globalOptionsPath,pathVars,null,"",initializer);
  BuildType buildType=incremental ? BuildType.MAKE : BuildType.PROJECT_REBUILD;
  Set<String> modulesSet=new HashSet<String>(Arrays.asList(modules));
  List<String> artifactsList=Arrays.asList(artifacts);
  File dataStorageRoot=Utils.getDataStorageRoot(projectPath);
  if (dataStorageRoot == null) {
    System.err.println("Error: Cannot determine build data storage root for project " + projectPath);
    return;
  }
  try {
    runBuild(loader,dataStorageRoot,buildType,modulesSet,artifactsList,true,new ConsoleMessageHandler());
  }
 catch (  Throwable t) {
    System.err.println("Internal error: " + t.getMessage());
    t.printStackTrace();
  }
}
