{
  LOG.assertTrue(expression != null || variable != null);
  GrIntroduceContext context;
  if (variable == null) {
    final PsiElement[] occurrences=findOccurrences(expression,toReplaceIn);
    context=new GrIntroduceContext(project,editor,expression,occurrences,toReplaceIn,variable);
  }
 else {
    final List<PsiElement> list=Collections.synchronizedList(new ArrayList<PsiElement>());
    ReferencesSearch.search(variable,new LocalSearchScope(toReplaceIn)).forEach(new Processor<PsiReference>(){
      @Override public boolean process(      PsiReference psiReference){
        final PsiElement element=psiReference.getElement();
        if (element != null) {
          list.add(element);
        }
        return true;
      }
    }
);
    context=new GrIntroduceContext(project,editor,variable.getInitializerGroovy(),list.toArray(new PsiElement[list.size()]),toReplaceIn,variable);
  }
  showDialog(new GrIntroduceParameterContext(context,toReplaceIn,toSearchFor));
}
