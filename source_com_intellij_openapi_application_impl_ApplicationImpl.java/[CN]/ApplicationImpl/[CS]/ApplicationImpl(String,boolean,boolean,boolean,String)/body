{
  if (isInternal || isUnitTestMode) {
    Disposer.setDebugMode(true);
  }
  myStartTime=System.currentTimeMillis();
  myName=appName;
  ApplicationManagerEx.setApplication(this);
  PluginsFacade.INSTANCE=new PluginsFacade(){
    public IdeaPluginDescriptor getPlugin(    PluginId id){
      return PluginManager.getPlugin(id);
    }
    public IdeaPluginDescriptor[] getPlugins(){
      return PluginManager.getPlugins();
    }
  }
;
  if (!isUnitTestMode) {
    Toolkit.getDefaultToolkit().getSystemEventQueue().push(IdeEventQueue.getInstance());
    IconLoader.activate();
  }
  getPicoContainer().registerComponentInstance(ApplicationEx.class,this);
  myComponentsDescriptor=componentsDescriptor;
  myIsInternal=isInternal;
  myTestModeFlag=isUnitTestMode;
  myHeadlessMode=isHeadless;
  loadApplicationComponents();
  if (SystemInfo.isMac || myTestModeFlag) {
    registerShutdownHook();
  }
}
