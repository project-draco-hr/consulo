{
  if (myDoNotSave)   return;
  ShutDownTracker.getInstance().registerStopperThread(Thread.currentThread());
  try {
    if (!ourSaveSettingsInProgress) {
      ourSaveSettingsInProgress=true;
      final String optionsPath=PathManager.getOptionsPath();
      File file=new File(optionsPath);
      if (!file.exists()) {
        file.mkdirs();
      }
      try {
        getStateStore().saveApplication(optionsPath);
      }
 catch (      final Throwable ex) {
        LOG.info("Saving application settings failed",ex);
        invokeLater(new Runnable(){
          public void run(){
            Messages.showMessageDialog(ApplicationBundle.message("application.save.settings.error",ex.getLocalizedMessage()),CommonBundle.getErrorTitle(),Messages.getErrorIcon());
          }
        }
);
      }
 finally {
        ourSaveSettingsInProgress=false;
      }
    }
    saveSettingsSavingComponents();
  }
  finally {
    ShutDownTracker.getInstance().unregisterStopperThread(Thread.currentThread());
  }
}
