{
  Project[] openProjects=ProjectManagerEx.getInstanceEx().getOpenProjects();
  final boolean[] canClose=new boolean[]{true};
  for (int i=0; i < openProjects.length; i++) {
    final Project project=openProjects[i];
    CommandProcessor commandProcessor=CommandProcessor.getInstance();
    commandProcessor.executeCommand(project,new Runnable(){
      public void run(){
        FileDocumentManager.getInstance().saveAllDocuments();
        if (!ProjectManagerEx.getInstanceEx().closeProject(project)) {
          canClose[0]=false;
        }
      }
    }
,"Exit",null);
    if (!canClose[0])     break;
    ((ProjectEx)project).dispose();
  }
  if (canClose[0]) {
    fireApplicationExiting();
    disposeComponents();
  }
}
