{
  deleteBackupFiles(path);
  backupFiles(path);
  Class[] componentClasses=getComponentInterfaces();
  com.intellij.util.containers.HashMap<String,Element> fileNameToRootElementMap=new com.intellij.util.containers.HashMap<String,Element>();
  for (int i=0; i < componentClasses.length; i++) {
    Class componentClass=componentClasses[i];
    Object component=getComponent(componentClass);
    String fileName;
    if (component instanceof NamedJDOMExternalizable) {
      fileName=((NamedJDOMExternalizable)component).getExternalFileName() + ".xml";
    }
 else {
      fileName=PathManager.DEFAULT_OPTIONS_FILE_NAME + ".xml";
    }
    Element root=getRootElement(fileNameToRootElementMap,fileName);
    try {
      Element node=serializeComponent((BaseComponent)component);
      if (node != null) {
        root.addContent(node);
      }
    }
 catch (    Exception e) {
      LOG.error(e);
    }
  }
  for (Iterator<String> iterator=fileNameToRootElementMap.keySet().iterator(); iterator.hasNext(); ) {
    String fileName=iterator.next();
    Element root=fileNameToRootElementMap.get(fileName);
    try {
      JDOMUtil.writeDocument(new Document(root),path + File.separatorChar + fileName,CodeStyleSettingsManager.getSettings(null).getLineSeparator());
    }
 catch (    IOException e) {
      LOG.error(e);
    }
  }
  deleteBackupFiles(path);
}
