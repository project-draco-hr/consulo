{
  deleteBackupFiles(path);
  backupFiles(path);
  Class[] componentClasses=getComponentInterfaces();
  HashMap<String,Element> fileNameToRootElementMap=new HashMap<String,Element>();
  for (  Class<?> componentClass : componentClasses) {
    Object component=getComponent(componentClass);
    String fileName;
    if (component instanceof NamedJDOMExternalizable) {
      fileName=((NamedJDOMExternalizable)component).getExternalFileName() + XML_EXTENSION;
    }
 else {
      fileName=PathManager.DEFAULT_OPTIONS_FILE_NAME + XML_EXTENSION;
    }
    Element root=getRootElement(fileNameToRootElementMap,fileName);
    try {
      Element node=serializeComponent((BaseComponent)component);
      if (node != null) {
        root.addContent(node);
      }
    }
 catch (    Exception e) {
      LOG.error(e);
    }
  }
  for (  String fileName : fileNameToRootElementMap.keySet()) {
    Element root=fileNameToRootElementMap.get(fileName);
    try {
      JDOMUtil.writeDocument(new Document(root),path + File.separatorChar + fileName,CodeStyleSettingsManager.getSettings(null).getLineSeparator());
    }
 catch (    IOException e) {
      LOG.error(e);
    }
  }
  deleteBackupFiles(path);
}
