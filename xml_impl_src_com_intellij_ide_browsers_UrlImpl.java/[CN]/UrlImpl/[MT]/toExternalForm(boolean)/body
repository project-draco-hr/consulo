{
  if (raw != null && (parameters == null || !skipQueryAndFragment)) {
    return raw;
  }
  try {
    String externalPath=path;
    boolean inLocalFileSystem=isInLocalFileSystem();
    if (inLocalFileSystem && SystemInfo.isWindows && externalPath.charAt(0) != '/') {
      externalPath='/' + externalPath;
    }
    String result=new URI(scheme,inLocalFileSystem ? "" : authority,externalPath,null,null).toASCIIString();
    if (!skipQueryAndFragment) {
      if (parameters != null) {
        result+=parameters;
      }
      raw=result;
    }
    return result;
  }
 catch (  URISyntaxException e) {
    throw new RuntimeException(e);
  }
}
