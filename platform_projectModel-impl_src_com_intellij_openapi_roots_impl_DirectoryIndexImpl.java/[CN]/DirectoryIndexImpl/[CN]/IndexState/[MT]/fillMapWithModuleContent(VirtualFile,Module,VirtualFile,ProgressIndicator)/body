{
  VfsUtilCore.visitChildrenRecursively(root,new DirectoryVisitor(){
    @Override protected DirectoryInfo updateInfo(    VirtualFile file){
      if (progress != null) {
        progress.checkCanceled();
      }
      if (isExcluded(contentRoot,file))       return null;
      if (isIgnored(file))       return null;
      DirectoryInfo info=getOrCreateDirInfo(file);
      if (info.module != null) {
        DirectoryInfo parentInfo=myDirToInfoMap.get(file.getParent());
        if (parentInfo == null || !info.module.equals(parentInfo.module))         return null;
      }
      return info;
    }
    @Override protected void afterChildrenVisited(    DirectoryInfo info){
      info.module=module;
      info.contentRoot=contentRoot;
    }
  }
);
}
