{
  PathManager.loadProperties();
  List<URL> classpath=new ArrayList<URL>();
  addParentClasspath(classpath);
  addIDEALibraries(classpath);
  addAdditionalClassPath(classpath);
  UrlClassLoader newClassLoader=UrlClassLoader.build().urls(filterClassPath(classpath)).allowLock().useCache().get();
  if (updatePlugins && !isLoadingOfExternalPluginsDisabled()) {
    try {
      StartupActionScriptManager.executeActionScript();
    }
 catch (    IOException e) {
      Main.showMessage("Plugin Installation Error",e);
    }
  }
  Thread.currentThread().setContextClassLoader(newClassLoader);
  return newClassLoader;
}
