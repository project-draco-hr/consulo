{
  if (position.visualPositionAware) {
    return position.softWrapLinesOnCurrentLogicalLine;
  }
  int startOffset=editor.getDocument().getLineStartOffset(position.line);
  int endOffset=editor.logicalPositionToOffset(position);
  return editor.getSoftWrapModel().getSoftWrapsForRange(startOffset,endOffset).size();
}
