{
  final int maxScanIndex=Math.min(start + columnNumber + 1,end);
  SoftWrapModel softWrapModel=editor.getSoftWrapModel();
  List<? extends TextChange> softWraps=softWrapModel.getSoftWrapsForRange(start,maxScanIndex);
  int startToUse=start;
  int x=0;
  AtomicInteger currentColumn=new AtomicInteger();
  for (  TextChange softWrap : softWraps) {
    if (currentColumn.get() >= columnNumber) {
      return startToUse;
    }
    int result=calcSoftWrapUnawareOffset(editor,text,startToUse,softWrap.getEnd(),columnNumber,tabSize,x,currentColumn);
    if (result >= 0) {
      return result;
    }
    startToUse=softWrap.getStart();
    x=softWrapModel.getSoftWrapIndentWidthInPixels(softWrap);
  }
  if (currentColumn.get() >= columnNumber) {
    return startToUse;
  }
  int result=calcSoftWrapUnawareOffset(editor,text,startToUse,end,columnNumber,tabSize,x,currentColumn);
  if (result >= 0) {
    return result;
  }
  return end;
}
