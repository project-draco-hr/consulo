{
  boolean hasNonTabs=false;
  boolean hasTabs=false;
  for (int i=start; i < end; i++) {
    if (text.charAt(i) == '\t') {
      hasTabs=true;
      if (hasNonTabs) {
        break;
      }
    }
 else {
      hasNonTabs=true;
    }
  }
  if (!hasTabs)   return Math.min(start + columnNumber,end);
  int shift=0;
  int offset=start;
  for (; offset < end && offset + shift < start + columnNumber; offset++) {
    if (text.charAt(offset) == '\t') {
      shift+=getTabLength(offset + shift - start,tabSize) - 1;
    }
  }
  if (offset + shift > start + columnNumber) {
    offset--;
  }
  return offset;
}
