{
  Project project=e.getData(DataKeys.PROJECT);
  final Editor editor=e.getData(DataKeys.EDITOR);
  final FileEditor fileEditor=e.getData(DataKeys.FILE_EDITOR);
  if (editor == null)   return;
  if (fileEditor == null)   return;
  PsiFile psiFile=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
  if (psiFile == null)   return;
  PsiDocumentManager.getInstance(project).commitDocument(editor.getDocument());
  FeatureUsageTracker.getInstance().triggerFeatureUsed("navigation.popup.file.structure");
  Navigatable navigatable=e.getData(DataKeys.NAVIGATABLE);
  DialogWrapper dialog=createDialog(psiFile,editor,project,navigatable,fileEditor);
  if (dialog != null) {
    final VirtualFile virtualFile=psiFile.getVirtualFile();
    if (virtualFile != null) {
      dialog.setTitle(virtualFile.getPresentableUrl());
    }
    dialog.show();
  }
}
