{
  DataContext dataContext=e.getDataContext();
  Project project=DataKeys.PROJECT.getData(dataContext);
  final Editor editor=DataKeys.EDITOR.getData(dataContext);
  final FileEditor fileEditor=DataKeys.FILE_EDITOR.getData(dataContext);
  if (editor == null)   return;
  if (fileEditor == null)   return;
  PsiFile psiFile=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
  if (psiFile == null)   return;
  PsiDocumentManager.getInstance(project).commitDocument(editor.getDocument());
  FeatureUsageTracker.getInstance().triggerFeatureUsed("navigation.popup.file.structure");
  Navigatable navigatable=DataKeys.NAVIGATABLE.getData(dataContext);
  DialogWrapper dialog=createDialog(psiFile,editor,project,navigatable,fileEditor);
  if (dialog != null) {
    final VirtualFile virtualFile=psiFile.getVirtualFile();
    if (virtualFile != null) {
      dialog.setTitle(virtualFile.getPresentableUrl());
    }
    dialog.show();
  }
}
