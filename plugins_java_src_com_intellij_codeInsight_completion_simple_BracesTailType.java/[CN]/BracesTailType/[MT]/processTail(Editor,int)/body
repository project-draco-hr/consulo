{
  int startOffset=tailOffset;
  CharSequence seq=editor.getDocument().getCharsSequence();
  int nextNonWs=CharArrayUtil.shiftForward(seq,tailOffset," \t");
  if (nextNonWs < seq.length() && seq.charAt(nextNonWs) == '{') {
    tailOffset=nextNonWs + 1;
  }
 else {
    tailOffset=insertChar(editor,startOffset,'{');
  }
  tailOffset=reformatBrace(editor,tailOffset,startOffset);
  if (EnterAfterUnmatchedBraceHandler.isAfterUnmatchedLBrace(editor,tailOffset,getFileType(editor))) {
    new EnterHandler(EditorActionManager.getInstance().getActionHandler(IdeActions.ACTION_EDITOR_ENTER)).executeWriteAction(editor,DataManager.getInstance().getDataContext(editor.getContentComponent()));
    return editor.getCaretModel().getOffset();
  }
  return tailOffset;
}
