{
  if (foldRange.isValid()) {
    VisualPosition foldStart=offsetToLineStartPosition(foldRange.getStartOffset());
    final int endOffset=getEndOffset(foldRange);
    VisualPosition foldEnd=offsetToLineStartPosition(endOffset);
    if (foldStart.line == foldEnd.line) {
      return;
    }
    int y=myEditor.visibleLineNumberToYPosition(foldStart.line) + myEditor.getLineHeight() - myEditor.getDescent() - width;
    int height=width + 2;
    final FoldingGroup group=foldRange.getGroup();
    final boolean drawTop=group == null || ((FoldingModelImpl)myEditor.getFoldingModel()).getFirstRegion(group) == foldRange;
    if (!foldRange.isExpanded()) {
      if (y <= clip.y + clip.height && y + height >= clip.y) {
        if (drawTop) {
          drawSquareWithPlus(g,anchorX,y,width,active,paintBackground);
        }
      }
    }
 else {
      int endY=myEditor.visibleLineNumberToYPosition(foldEnd.line) + myEditor.getLineHeight() - myEditor.getDescent();
      if (y <= clip.y + clip.height && y + height >= clip.y) {
        if (drawTop) {
          drawDirectedBox(g,anchorX,y,width,height,width - 2,active,paintBackground);
        }
      }
      if (endY - height <= clip.y + clip.height && endY >= clip.y) {
        drawDirectedBox(g,anchorX,endY,width,-height,-width + 2,active,paintBackground);
      }
    }
  }
}
