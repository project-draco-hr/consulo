{
  if (!(declaration instanceof PsiClass)) {
    return Visibility.NOT_VISIBLE;
  }
  final Module module=myModuleSelector.getModule();
  if (module == null) {
    return Visibility.NOT_VISIBLE;
  }
  final PsiFile file=declaration.getContainingFile();
  final VirtualFile vFile=file != null ? file.getVirtualFile() : null;
  if (vFile == null) {
    return Visibility.NOT_VISIBLE;
  }
  final JavaPsiFacade facade=JavaPsiFacade.getInstance(myProject);
  final PsiClass baseClass=facade.findClass(myBaseClassName,module.getModuleWithDependenciesAndLibrariesScope(true));
  if (baseClass == null || !((PsiClass)declaration).isInheritor(baseClass,true)) {
    return Visibility.NOT_VISIBLE;
  }
  return Visibility.VISIBLE;
}
