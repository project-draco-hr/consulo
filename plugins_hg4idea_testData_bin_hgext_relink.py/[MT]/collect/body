def collect(src, ui):
    seplen = len(os.path.sep)
    candidates = []
    for (dirpath, dirnames, filenames) in os.walk(src):
        relpath = dirpath[(len(src) + seplen):]
        for filename in filenames:
            if (not (filename[(-2):] in ('.d', '.i'))):
                continue
            st = os.stat(os.path.join(dirpath, filename))
            if (not stat.S_ISREG(st.st_mode)):
                continue
            candidates.append((os.path.join(relpath, filename), st))
    ui.status((_('collected %d candidate storage files\n') % len(candidates)))
    return candidates
