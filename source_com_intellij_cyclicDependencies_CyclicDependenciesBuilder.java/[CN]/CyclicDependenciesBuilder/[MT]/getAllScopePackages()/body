{
  if (myPackages.isEmpty()) {
    final PsiManager psiManager=PsiManager.getInstance(getProject());
    getScope().accept(new PsiRecursiveElementVisitor(){
      @Override public void visitFile(      PsiFile file){
        if (file instanceof PsiJavaFile) {
          PsiJavaFile psiJavaFile=(PsiJavaFile)file;
          final PsiPackage aPackage=psiManager.findPackage(psiJavaFile.getPackageName());
          if (aPackage != null) {
            myPackages.put(aPackage.getQualifiedName(),aPackage);
          }
        }
      }
    }
);
  }
  return myPackages;
}
