{
  final long limit=System.currentTimeMillis() + timeout;
  while (System.currentTimeMillis() < limit) {
    if (semaphore.waitFor(10))     return;
    UIUtil.dispatchAllInvocationEvents();
  }
  fail("Timeout");
}
