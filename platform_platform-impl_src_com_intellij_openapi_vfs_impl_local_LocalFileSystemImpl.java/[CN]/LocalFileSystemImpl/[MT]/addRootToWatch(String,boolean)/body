{
  if (rootPath.length() == 0 || !myWatcher.isOperational())   return null;
  Application app=ApplicationManager.getApplication();
  return app.runReadAction(new Computable<WatchRequest>(){
    @Override public WatchRequest compute(){
synchronized (myLock) {
        final WatchRequestImpl result=new WatchRequestImpl(rootPath,toWatchRecursively);
        boolean alreadyWatched=isAlreadyWatched(result);
        if (!alreadyWatched) {
          final VirtualFile existingFile=findFileByPathIfCached(rootPath);
          if (existingFile != null) {
            final ModalityState modalityState=ModalityState.defaultModalityState();
            RefreshQueue.getInstance().refresh(true,toWatchRecursively,null,modalityState,existingFile);
            if (existingFile.isDirectory() && !toWatchRecursively && existingFile instanceof NewVirtualFile) {
              for (              VirtualFile child : ((NewVirtualFile)existingFile).getCachedChildren()) {
                RefreshQueue.getInstance().refresh(true,false,null,modalityState,child);
              }
            }
          }
        }
        myRootsToWatch.add(result);
        if (alreadyWatched) {
          result.myDominated=true;
          return result;
        }
        myCachedNormalizedRequests=null;
        setUpFileWatcher();
        return result;
      }
    }
  }
);
}
