{
  boolean update=false;
  for (  String root : roots) {
    final WatchRequestImpl result=new WatchRequestImpl(root,recursively);
    final boolean alreadyWatched=isAlreadyWatched(result);
    if (!alreadyWatched) {
      final VirtualFile existingFile=findFileByPathIfCached(root);
      if (existingFile != null) {
        if (existingFile.isDirectory() && !recursively && existingFile instanceof NewVirtualFile) {
          filesToSync.addAll(((NewVirtualFile)existingFile).getCachedChildren());
        }
      }
    }
    result.myDominated=alreadyWatched;
    myRootsToWatch.add(result);
    results.add(result);
    update|=!alreadyWatched;
  }
  return update;
}
