{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      FileDocumentManager.getInstance().saveAllDocuments();
    }
  }
);
  ((PersistentFS)ManagingFS.getInstance()).clearIdCache();
  for (  VirtualFile root : ManagingFS.getInstance().getRoots(this)) {
    if (root instanceof VirtualDirectoryImpl) {
      ((VirtualDirectoryImpl)root).cleanupCachedChildren(survivors);
    }
  }
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      refresh(false);
    }
  }
);
  myRootsToWatch.clear();
  final File file=new File(FileUtil.getTempDirectory());
  String path=file.getCanonicalPath().replace(File.separatorChar,'/');
  addRootToWatch(path,true);
}
