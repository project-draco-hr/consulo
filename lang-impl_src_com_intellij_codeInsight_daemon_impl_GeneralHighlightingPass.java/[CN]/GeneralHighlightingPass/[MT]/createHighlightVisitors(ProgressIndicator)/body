{
  AtomicInteger count=myProject.getUserData(HIGHLIGHT_VISITOR_INSTANCE_COUNT);
  if (count == null) {
    count=((UserDataHolderEx)myProject).putUserDataIfAbsent(HIGHLIGHT_VISITOR_INSTANCE_COUNT,new AtomicInteger(0));
  }
  HighlightVisitor[] highlightVisitors=Extensions.getExtensions(HighlightVisitor.EP_HIGHLIGHT_VISITOR,myProject);
  if (count.getAndIncrement() != 0) {
    highlightVisitors=highlightVisitors.clone();
    for (int i=0; i < highlightVisitors.length; i++) {
      HighlightVisitor highlightVisitor=highlightVisitors[i];
      highlightVisitors[i]=highlightVisitor.clone();
    }
  }
  for (  final HighlightVisitor highlightVisitor : highlightVisitors) {
    if (!highlightVisitor.init(myUpdateAll,myFile)) {
      progress.cancel();
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          DaemonCodeAnalyzer.getInstance(myProject).restart();
        }
      }
,myProject.getDisposed());
      throw new ProcessCanceledException();
    }
  }
  return highlightVisitors;
}
