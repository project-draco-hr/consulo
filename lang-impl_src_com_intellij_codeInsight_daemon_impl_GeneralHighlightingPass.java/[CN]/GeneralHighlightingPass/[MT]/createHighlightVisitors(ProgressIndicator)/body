{
  int oldCount=incVisitorUsageCount(1);
  HighlightVisitor[] highlightVisitors=Extensions.getExtensions(HighlightVisitor.EP_HIGHLIGHT_VISITOR,myProject);
  if (oldCount != 0) {
    highlightVisitors=highlightVisitors.clone();
    for (int i=0; i < highlightVisitors.length; i++) {
      HighlightVisitor highlightVisitor=highlightVisitors[i];
      highlightVisitors[i]=highlightVisitor.clone();
    }
  }
  for (int i=0; i < highlightVisitors.length; i++) {
    HighlightVisitor highlightVisitor=highlightVisitors[i];
    if (!highlightVisitor.init(myUpdateAll,myFile)) {
      progress.cancel();
      for (int j=i - 1; j >= 0; j--) {
        HighlightVisitor visitor=highlightVisitors[j];
        visitor.cleanup(false,myFile);
      }
      incVisitorUsageCount(-1);
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          DaemonCodeAnalyzer.getInstance(myProject).restart();
        }
      }
,myProject.getDisposed());
      throw new ProcessCanceledException();
    }
  }
  return highlightVisitors;
}
