{
  boolean success=true;
  final File dataStorageRoot=context.getDataManager().getDataStorageRoot();
  AndroidFileSetStorage devResourcesStorage=null;
  AndroidFileSetStorage releaseResourcesStorage=null;
  AndroidFileSetStorage devAssetsStorage=null;
  AndroidFileSetStorage releaseAssetsStorage=null;
  try {
    devResourcesStorage=new AndroidFileSetStorage(dataStorageRoot,"resources_packaging_dev");
    releaseResourcesStorage=new AndroidFileSetStorage(dataStorageRoot,"resources_packaging_release");
    devAssetsStorage=new AndroidFileSetStorage(dataStorageRoot,"assets_packaging_dev");
    releaseAssetsStorage=new AndroidFileSetStorage(dataStorageRoot,"assets_packaging_release");
    for (    Module module : modules) {
      final AndroidFacet facet=AndroidJpsUtil.getFacet(module);
      if (facet == null || facet.isLibrary()) {
        continue;
      }
      if (!packageResources(facet,context,devResourcesStorage,devAssetsStorage,releaseResourcesStorage,releaseAssetsStorage,resourcesStates,assetsStates)) {
        success=false;
      }
    }
  }
  finally {
    if (devResourcesStorage != null) {
      devResourcesStorage.close();
    }
    if (releaseResourcesStorage != null) {
      releaseResourcesStorage.close();
    }
    if (devAssetsStorage != null) {
      devAssetsStorage.close();
    }
    if (releaseAssetsStorage != null) {
      releaseAssetsStorage.close();
    }
  }
  return success;
}
