{
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  int offset=editor.getCaretModel().getOffset();
  PsiElement element=findTargetElement(project,editor,offset);
  if (element == null) {
    FeatureUsageTracker.getInstance().triggerFeatureUsed("navigation.goto.declaration");
    chooseAmbiguousTarget(project,editor,offset);
    return;
  }
  FeatureUsageTracker.getInstance().triggerFeatureUsed("navigation.goto.declaration");
  PsiElement navElement=element.getNavigationElement();
  if (navElement == element && element instanceof PsiCompiledElement && element instanceof PsiMethod) {
    PsiMethod method=(PsiMethod)element;
    if (method.isConstructor() && method.getParameterList().getParametersCount() == 0) {
      PsiClass aClass=method.getContainingClass();
      PsiElement navClass=aClass.getNavigationElement();
      if (aClass != navClass)       navElement=navClass;
    }
  }
  if (navElement instanceof Navigatable) {
    if (((Navigatable)navElement).canNavigate()) {
      ((Navigatable)navElement).navigate(true);
    }
  }
 else   if (navElement != null) {
    int navOffset=navElement.getTextOffset();
    VirtualFile virtualFile=PsiUtil.getVirtualFile(navElement);
    if (virtualFile != null) {
      new OpenFileDescriptor(project,virtualFile,navOffset).navigate(true);
    }
  }
}
