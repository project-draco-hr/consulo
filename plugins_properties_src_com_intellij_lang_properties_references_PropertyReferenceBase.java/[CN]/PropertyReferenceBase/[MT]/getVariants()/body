{
  final CompletionProcess process=CompletionService.getCompletionService().getCurrentCompletion();
  if (process != null && process.isAutopopupCompletion() && isSoft()) {
    return ArrayUtil.EMPTY_OBJECT_ARRAY;
  }
  final Set<Object> variants=new THashSet<Object>(new TObjectHashingStrategy<Object>(){
    public int computeHashCode(    final Object object){
      if (object instanceof Property) {
        final String key=((Property)object).getKey();
        return key == null ? 0 : key.hashCode();
      }
 else {
        return 0;
      }
    }
    public boolean equals(    final Object o1,    final Object o2){
      return o1 instanceof Property && o2 instanceof Property && Comparing.equal(((Property)o1).getKey(),((Property)o2).getKey(),true);
    }
  }
);
  List<PropertiesFile> propertiesFileList=getPropertiesFiles();
  if (propertiesFileList == null) {
    final PsiManager psiManager=myElement.getManager();
    final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(psiManager.getProject()).getFileIndex();
    PropertiesFilesManager.getInstance(myElement.getProject()).processAllPropertiesFiles(new Processor<VirtualFile>(){
      public boolean process(      VirtualFile file){
        if (!file.isValid())         return true;
        if (!fileIndex.isInContent(file))         return true;
        PsiFile psiFile=psiManager.findFile(file);
        if (!(psiFile instanceof PropertiesFile))         return true;
        PropertiesFile propertiesFile=(PropertiesFile)psiFile;
        addVariantsFromFile(propertiesFile,variants);
        return true;
      }
    }
);
  }
 else {
    for (    PropertiesFile propFile : propertiesFileList) {
      addVariantsFromFile(propFile,variants);
    }
  }
  return ArrayUtil.toObjectArray(variants);
}
