{
  if (myFilters.isEmpty()) {
    return;
  }
  Deque<ProjectStructureNode<?>> toRemove=new ArrayDeque<ProjectStructureNode<?>>();
  Stack<ProjectStructureNode<?>> toProcess=new Stack<ProjectStructureNode<?>>();
  toProcess.push(root);
  while (!toProcess.isEmpty()) {
    final ProjectStructureNode<?> current=toProcess.pop();
    toRemove.add(current);
    if (passFilters(current)) {
      toRemove.remove(current);
      for (ProjectStructureNode<?> parent=current.getParent(); parent != null; parent=parent.getParent()) {
        if (!toRemove.remove(parent)) {
          break;
        }
      }
    }
    for (    ProjectStructureNode<?> child : current) {
      toProcess.push(child);
    }
  }
  for (ProjectStructureNode<?> node=toRemove.pollLast(); node != null; node=toRemove.pollLast()) {
    final ProjectStructureNode<?> parent=node.getParent();
    if (parent == null) {
      continue;
    }
    parent.remove(node);
    final ProjectEntityId id=node.getDescriptor().getElement();
    if (id instanceof ModuleId) {
      String moduleName=((ModuleId)id).getModuleName();
      myModules.remove(moduleName);
      myModuleDependencies.remove(moduleName);
    }
  }
}
