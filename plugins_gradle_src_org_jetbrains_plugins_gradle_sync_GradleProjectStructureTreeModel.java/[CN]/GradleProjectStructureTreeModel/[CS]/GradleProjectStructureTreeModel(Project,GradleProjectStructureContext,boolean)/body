{
  super(null);
  myProject=project;
  myPlatformFacade=context.getPlatformFacade();
  myProjectStructureHelper=context.getProjectStructureHelper();
  myChangesModel=context.getChangesModel();
  myNodeComparator=new GradleProjectStructureNodeComparator(context);
  context.getChangesModel().addListener(new GradleProjectStructureChangeListener(){
    @Override public void onChanges(    @NotNull final Collection<GradleProjectStructureChange> oldChanges,    @NotNull final Collection<GradleProjectStructureChange> currentChanges){
      final Runnable task=new Runnable(){
        @Override public void run(){
          List<GradleProjectStructureChange> currentChangesToUse=ContainerUtilRt.newArrayList(currentChanges);
          Collection<GradleProjectStructureChange> obsoleteChangesToUse=ContainerUtil.subtract(oldChanges,currentChanges);
          if (myChangesComparator != null) {
            List<GradleProjectStructureChange> toSort=ContainerUtilRt.newArrayList(obsoleteChangesToUse);
            Collections.sort(toSort,myChangesComparator);
            obsoleteChangesToUse=toSort;
            Collections.sort(currentChangesToUse,myChangesComparator);
          }
          processObsoleteChanges(obsoleteChangesToUse);
          processCurrentChanges(currentChangesToUse);
        }
      }
;
      if (myProcessChangesAtTheSameThread) {
        task.run();
      }
 else {
        UIUtil.invokeLaterIfNeeded(task);
      }
    }
  }
);
  if (rebuild) {
    rebuild();
  }
}
