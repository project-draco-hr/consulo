{
  if (!component.isShowing()) {
    throw new IllegalArgumentException("component must be shown on the screen");
  }
  removeAll();
  int x2=Math.max(0,Math.min(x,component.getWidth() - 1));
  int y2=Math.max(0,Math.min(y,component.getHeight() - 1));
  myContext=myDataContextProvider != null ? myDataContextProvider.get() : DataManager.getInstance().getDataContext(component,x2,y2);
  Utils.fillMenu(myGroup,this,true,myPresentationFactory,myContext,myPlace,false,false);
  if (getComponentCount() == 0) {
    return;
  }
  Dimension preferredSize=getPreferredSize();
  int _x, _y;
  Point p=component.getLocationOnScreen();
  _x=p.x + x;
  _y=p.y + y;
  GraphicsConfiguration targetGraphicsConfiguration=null;
  GraphicsEnvironment env=GraphicsEnvironment.getLocalGraphicsEnvironment();
  GraphicsDevice[] devices=env.getScreenDevices();
  for (  GraphicsDevice device : devices) {
    GraphicsConfiguration graphicsConfiguration=device.getDefaultConfiguration();
    Rectangle r=graphicsConfiguration.getBounds();
    if (r.x <= _x && _x <= r.x + r.width && r.y <= _y && _y <= r.y + r.height) {
      targetGraphicsConfiguration=graphicsConfiguration;
      break;
    }
  }
  if (targetGraphicsConfiguration == null && devices.length > 0) {
    targetGraphicsConfiguration=env.getDefaultScreenDevice().getDefaultConfiguration();
  }
  if (targetGraphicsConfiguration == null) {
    throw new IllegalStateException("It's impossible to determine target graphics environment for point (" + _x + ","+ _y+ ")");
  }
  Insets insets=ScreenUtil.getScreenInsets(targetGraphicsConfiguration);
  Rectangle targetRectangle=targetGraphicsConfiguration.getBounds();
  targetRectangle.x+=insets.left;
  targetRectangle.y+=insets.top;
  targetRectangle.width-=insets.left + insets.right;
  targetRectangle.height-=insets.top + insets.bottom;
  if (_x + preferredSize.width > targetRectangle.x + targetRectangle.width) {
    x-=preferredSize.width;
  }
  if (_y + preferredSize.height > targetRectangle.y + targetRectangle.height) {
    int invisibleHeight=_y + preferredSize.height - targetRectangle.y - targetRectangle.height;
    y-=invisibleHeight;
  }
  if (myApp != null) {
    if (myApp.isActive()) {
      Component frame=UIUtil.findUltimateParent(component);
      if (frame instanceof IdeFrame) {
        myFrame=(IdeFrame)frame;
      }
      myConnection=myApp.getMessageBus().connect();
      myConnection.subscribe(ApplicationActivationListener.TOPIC,ActionPopupMenuImpl.this);
    }
  }
  super.show(component,x,y);
}
