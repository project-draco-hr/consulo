{
  final PsiParameterList parameterList=constructor.getParameterList();
  final PsiParameter[] parameters=parameterList.getParameters();
  ParameterInfoImpl[] newParamInfos=new ParameterInfoImpl[parameters.length + fields.length];
  final List<PsiVariable> params=new ArrayList<PsiVariable>(Arrays.asList(parameters));
  Collections.addAll(params,fields);
  Collections.sort(params,new FieldParameterComparator(parameterList));
  int i=0;
  for (  PsiVariable param : params) {
    final PsiType paramType=param.getType();
    if (param instanceof PsiParameter) {
      newParamInfos[i++]=new ParameterInfoImpl(parameterList.getParameterIndex((PsiParameter)param),param.getName(),paramType,param.getName());
    }
 else {
      final String uniqueParameterName=getUniqueParameterName(parameters,param);
      newParamInfos[i++]=new ParameterInfoImpl(-1,uniqueParameterName,paramType,uniqueParameterName);
    }
  }
  final SmartPointerManager manager=SmartPointerManager.getInstance(project);
  final SmartPsiElementPointer constructorPointer=manager.createSmartPsiElementPointer(constructor);
  final PsiMethod fromText=JavaPsiFacade.getElementFactory(project).createMethodFromText(createDummyMethod(constructor,newParamInfos),constructor);
  final PsiClass containingClass=constructor.getContainingClass();
  if (containingClass == null)   return false;
  final int minUsagesNumber=containingClass.findMethodsBySignature(fromText,false).length > 0 ? 0 : 1;
  final List<ParameterInfoImpl> parameterInfos=ChangeMethodSignatureFromUsageFix.performChange(project,editor,file,constructor,minUsagesNumber,newParamInfos,true,true);
  final ParameterInfoImpl[] resultParams=parameterInfos != null ? parameterInfos.toArray(new ParameterInfoImpl[parameterInfos.size()]) : newParamInfos;
  return ApplicationManager.getApplication().runWriteAction(new Computable<Boolean>(){
    @Override public Boolean compute(){
      return doCreate(project,editor,parameters,constructorPointer,resultParams,fields);
    }
  }
);
}
