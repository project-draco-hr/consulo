{
  final boolean[] result=new boolean[1];
  try {
    ProgressManager.getInstance().run(new Task.Backgroundable(null,IdeBundle.message("progress.download.plugins"),true){
      @Override public void run(      @NotNull ProgressIndicator indicator){
        if (PluginInstaller.prepareToInstall(plugins,allPlugins)) {
          ApplicationManager.getApplication().invokeLater(onSuccess);
          result[0]=true;
        }
      }
      @Override public void onCancel(){
        cleanup.run();
        super.onCancel();
      }
      @Override public void onSuccess(){
        super.onSuccess();
        cleanup.run();
      }
    }
);
  }
 catch (  RuntimeException e) {
    if (e.getCause() != null && e.getCause() instanceof IOException) {
      throw (IOException)e.getCause();
    }
 else {
      throw e;
    }
  }
  return result[0];
}
