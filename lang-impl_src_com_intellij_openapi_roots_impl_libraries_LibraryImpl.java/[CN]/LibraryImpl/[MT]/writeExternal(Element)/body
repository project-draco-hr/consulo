{
  LOG.assertTrue(!isDisposed(),"Already disposed!");
  Element element=new Element(ELEMENT);
  if (myName != null) {
    element.setAttribute(LIBRARY_NAME_ATTR,myName);
  }
  for (  OrderRootType rootType : OrderRootType.getSortedRootTypes()) {
    final VirtualFilePointerContainer roots=myRoots.get(rootType);
    if (roots.size() == 0 && rootType.skipWriteIfEmpty())     continue;
    final Element rootTypeElement=new Element(rootType.name());
    roots.writeExternal(rootTypeElement,ROOT_PATH_ELEMENT);
    element.addContent(rootTypeElement);
  }
  List<String> urls=new ArrayList<String>(myJarDirectories.keySet());
  Collections.sort(urls,new Comparator<String>(){
    public int compare(    final String url1,    final String url2){
      return url1.compareToIgnoreCase(url2);
    }
  }
);
  for (  String url : urls) {
    final Element jarDirElement=new Element(JAR_DIRECTORY_ELEMENT);
    jarDirElement.setAttribute(URL_ATTR,url);
    jarDirElement.setAttribute(RECURSIVE_ATTR,myJarDirectories.get(url).toString());
    element.addContent(jarDirElement);
  }
  rootElement.addContent(element);
}
