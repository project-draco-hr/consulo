{
  int braceLevel=1;
  int i=0;
  PsiBuilder.Marker em=builder.mark();
  while (true) {
    if (builder.eof()) {
      break;
    }
    final IElementType type=builder.getTokenType();
    if (GroovyTokenTypes.mLCURLY == type) {
      braceLevel++;
    }
 else     if (GroovyTokenTypes.mRCURLY == type) {
      braceLevel--;
      if (braceLevel == 0) {
        break;
      }
    }
 else     if (braceLevel == 1) {
      if (!rCurlyNeeded && (GroovyTokenTypes.mNLS.equals(type) || GroovyTokenTypes.mSEMI.equals(type))) {
        break;
      }
      if (isExtendedSeparator(type)) {
        break;
      }
    }
    builder.advanceLexer();
    i++;
  }
  if (i > 0) {
    em.error(GroovyBundle.message("separator.or.rcurly.expected"));
  }
 else {
    em.drop();
  }
}
