{
  String label=graph.getLabel(state.getCell());
  Map<String,Object> style=state.getStyle();
  if (label != null && label.length() > 0 && !graph.isHtmlLabel(state.getCell()) && !graph.getModel().isEdge(state.getCell()) && mxUtils.getString(style,mxConstants.STYLE_WHITE_SPACE,"nowrap").equals("wrap")) {
    double w=getWordWrapWidth(state);
    String[] lines=mxUtils.wordWrap(label,mxUtils.getFontMetrics(mxUtils.getFont(state.getStyle())),w * mxConstants.LABEL_SCALE_BUFFER);
    if (lines.length > 0) {
      StringBuffer buffer=new StringBuffer();
      for (      String line : lines) {
        buffer.append(line + '\n');
      }
      label=buffer.substring(0,buffer.length() - 1);
    }
  }
  state.setLabel(label);
}
