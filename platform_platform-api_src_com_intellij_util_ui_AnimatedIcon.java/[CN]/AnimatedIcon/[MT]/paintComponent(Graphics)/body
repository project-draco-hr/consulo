{
  if (myPaintingBgNow)   return;
  if ((myAnimator.isRunning() || myPaintPassive || (myLastPaintWasRunning && !myAnimator.isRunning()))) {
    Rectangle b=getBounds();
    if (!isOpaque()) {
      try {
        myPaintingBgNow=true;
        Container p=getParent();
        if (p instanceof JComponent) {
          JComponent parentComponent=(JComponent)p;
          RepaintManager.currentManager(p).addDirtyRegion(parentComponent,b.x,b.y,b.width,b.height);
          parentComponent.paintImmediately(b);
        }
      }
  finally {
        myPaintingBgNow=false;
      }
    }
 else {
      final Component opaque=UIUtil.findNearestOpaque(this);
      if (opaque != null) {
        g.setColor(opaque.getBackground());
        g.fillRect(b.x,b.y,b.width,b.height);
      }
    }
  }
  Icon icon;
  if (myAnimator.isRunning()) {
    icon=myIcons[myCurrentIconIndex];
  }
 else {
    icon=getPassiveIcon();
  }
  final Dimension size=getSize();
  int x=(size.width - icon.getIconWidth()) / 2;
  int y=(size.height - icon.getIconHeight()) / 2;
  paintIcon(g,icon,x,y);
  myLastPaintWasRunning=myAnimator.isRunning();
}
