def forbidnewline(ui, repo, hooktype, node, newline, **kwargs):
    halt = False
    seen = set()
    tip = repo['tip']
    for rev in xrange((len(repo) - 1), (repo[node].rev() - 1), (-1)):
        c = repo[rev]
        for f in c.files():
            if ((f in seen) or (f not in tip) or (f not in c)):
                continue
            seen.add(f)
            data = c[f].data()
            if ((not util.binary(data)) and (newline in data)):
                if (not halt):
                    ui.warn((_('Attempt to commit or push text file(s) using %s line endings\n') % newlinestr[newline]))
                ui.warn((_('in %s: %s\n') % (short(c.node()), f)))
                halt = True
    if (halt and (hooktype == 'pretxnchangegroup')):
        crlf = newlinestr[newline].lower()
        filter = filterstr[newline]
        ui.warn((_('\nTo prevent this mistake in your local repository,\nadd to Mercurial.ini or .hg/hgrc:\n\n[hooks]\npretxncommit.%s = python:hgext.win32text.forbid%s\n\nand also consider adding:\n\n[extensions]\nwin32text =\n[encode]\n** = %sencode:\n[decode]\n** = %sdecode:\n') % (crlf, crlf, filter, filter)))
    return halt
