{
  myProject=project;
  myCurrentRepository=currentRepository;
  myRepositoryManager=GitUtil.getRepositoryManager(project);
  myVcs=GitVcs.getInstance(project);
  myVcsSettings=GitVcsSettings.getInstance(myProject);
  myMultiRootBranchConfig=new GitMultiRootBranchConfig(myRepositoryManager.getRepositories());
  String title=createPopupTitle(currentRepository);
  Condition<AnAction> preselectActionCondition=new Condition<AnAction>(){
    @Override public boolean value(    AnAction action){
      if (action instanceof GitBranchPopupActions.LocalBranchActions) {
        GitBranchPopupActions.LocalBranchActions branchAction=(GitBranchPopupActions.LocalBranchActions)action;
        String branchName=branchAction.getBranchName();
        String recentBranch;
        List<GitRepository> repositories=branchAction.getRepositories();
        if (repositories.size() == 1) {
          recentBranch=myVcsSettings.getRecentBranchesByRepository().get(repositories.iterator().next().getRoot().getPath());
        }
 else {
          recentBranch=myVcsSettings.getRecentCommonBranch();
        }
        if (recentBranch != null && recentBranch.equals(branchName)) {
          return true;
        }
      }
      return false;
    }
  }
;
  myPopup=new PopupFactoryImpl.ActionGroupPopup(title,createActions(),SimpleDataContext.getProjectContext(project),false,false,false,true,null,-1,preselectActionCondition,null){
    @Override protected WizardPopup createPopup(    WizardPopup parent,    PopupStep step,    Object parentValue){
      WizardPopup popup=super.createPopup(parent,step,parentValue);
      if (parentValue instanceof PopupFactoryImpl.ActionItem) {
        AnAction action=((PopupFactoryImpl.ActionItem)parentValue).getAction();
        if (action instanceof RootAction) {
          popup.setAdText(((RootAction)action).getCaption());
        }
      }
      return popup;
    }
  }
;
  initBranchSyncPolicyIfNotInitialized();
  setCurrentBranchInfo();
  warnThatBranchesDivergedIfNeeded();
}
