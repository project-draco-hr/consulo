{
  myProject=project;
  myCurrentRepository=currentRepository;
  myRepositoryManager=GitUtil.getRepositoryManager(project);
  myVcs=GitVcs.getInstance(project);
  myVcsSettings=GitVcsSettings.getInstance(myProject);
  myMultiRootBranchConfig=new GitMultiRootBranchConfig(myRepositoryManager.getRepositories());
  String title=createPopupTitle(currentRepository);
  Condition<AnAction> preselectActionCondition=new Condition<AnAction>(){
    @Override public boolean value(    AnAction action){
      if (action instanceof GitBranchPopupActions.LocalBranchActions) {
        GitBranchPopupActions.LocalBranchActions branchAction=(GitBranchPopupActions.LocalBranchActions)action;
        String branchName=branchAction.getBranchName();
        String recentBranch;
        List<GitRepository> repositories=branchAction.getRepositories();
        if (repositories.size() == 1) {
          recentBranch=myVcsSettings.getRecentBranchesByRepository().get(repositories.iterator().next().getRoot().getPath());
        }
 else {
          recentBranch=myVcsSettings.getRecentCommonBranch();
        }
        if (recentBranch != null && recentBranch.equals(branchName)) {
          return true;
        }
      }
      return false;
    }
  }
;
  myPopup=new BranchActionGroupPopup(title,project,preselectActionCondition,createActions());
  initBranchSyncPolicyIfNotInitialized();
  setCurrentBranchInfo();
  warnThatBranchesDivergedIfNeeded();
}
