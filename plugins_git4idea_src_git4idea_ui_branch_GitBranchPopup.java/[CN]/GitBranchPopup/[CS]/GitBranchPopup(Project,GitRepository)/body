{
  myProject=project;
  myCurrentRepository=currentRepository;
  GitRepositoryManager repositoryManager=GitRepositoryManager.getInstance(project);
  myMultiRootBranchConfig=new GitMultiRootBranchConfig(repositoryManager.getRepositories());
  String title="Git Branches";
  if (repositoryManager.moreThanOneRoot() && (myMultiRootBranchConfig.diverged() || getSyncSetting() == GitBranchSyncSetting.DONT)) {
    title+=" on [" + GitUIUtil.getShortRepositoryName(currentRepository) + "]";
  }
  myPopup=JBPopupFactory.getInstance().createActionGroupPopup(title,createActions(),SimpleDataContext.getProjectContext(project),JBPopupFactory.ActionSelectionAid.SPEEDSEARCH,true);
  if (repositoryManager.moreThanOneRoot() && getSyncSetting() == GitBranchSyncSetting.NOT_DECIDED) {
    if (!myMultiRootBranchConfig.diverged()) {
      notifyAboutSyncedBranches();
      GitVcsSettings.getInstance(project).setSyncSetting(GitBranchSyncSetting.SYNC);
    }
 else {
      GitVcsSettings.getInstance(project).setSyncSetting(GitBranchSyncSetting.DONT);
    }
  }
}
