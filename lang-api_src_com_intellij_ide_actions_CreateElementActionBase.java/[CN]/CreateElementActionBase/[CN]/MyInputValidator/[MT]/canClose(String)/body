{
  if (inputString.length() == 0) {
    Messages.showMessageDialog(myProject,IdeBundle.message("error.name.should.be.specified"),CommonBundle.getErrorTitle(),Messages.getErrorIcon());
    return false;
  }
  try {
    checkBeforeCreate(inputString,myDirectory);
  }
 catch (  IncorrectOperationException e) {
    Messages.showMessageDialog(myProject,filterMessage(e.getMessage()),getErrorTitle(),Messages.getErrorIcon());
    return false;
  }
  final Exception[] exception=new Exception[1];
  final Runnable command=new Runnable(){
    public void run(){
      final Runnable run=new Runnable(){
        public void run(){
          LocalHistoryAction action=LocalHistoryAction.NULL;
          try {
            action=LocalHistory.startAction(myProject,getActionName(myDirectory,inputString));
            PsiElement[] psiElements=create(inputString,myDirectory);
            myCreatedElements=new SmartPsiElementPointer[psiElements.length];
            SmartPointerManager manager=SmartPointerManager.getInstance(myProject);
            for (int i=0; i < myCreatedElements.length; i++) {
              myCreatedElements[i]=manager.createSmartPsiElementPointer(psiElements[i]);
            }
          }
 catch (          Exception ex) {
            exception[0]=ex;
          }
 finally {
            action.finish();
          }
        }
      }
;
      ApplicationManager.getApplication().runWriteAction(run);
    }
  }
;
  CommandProcessor.getInstance().executeCommand(myProject,command,getCommandName(),null);
  if (exception[0] != null) {
    String errorMessage=filterMessage(exception[0].getMessage());
    if (errorMessage == null || errorMessage.length() == 0) {
      errorMessage=exception[0].toString();
    }
    Messages.showMessageDialog(myProject,errorMessage,getErrorTitle(),Messages.getErrorIcon());
  }
  return myCreatedElements.length != 0;
}
