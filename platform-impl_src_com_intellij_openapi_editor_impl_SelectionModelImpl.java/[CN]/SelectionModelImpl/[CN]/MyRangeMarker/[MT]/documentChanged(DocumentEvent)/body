{
  if (!myIsReleased) {
    int startBefore=getStartOffset();
    int endBefore=getEndOffset();
    super.documentChanged(e);
    if (!isValid()) {
      myLastSelectionStart=myEditor.getCaretModel().getOffset();
      release();
      mySelectionMarker=null;
      fireSelectionChanged(startBefore,endBefore,myLastSelectionStart,myLastSelectionStart);
      return;
    }
    if (startBefore != getStartOffset() || endBefore != getStartOffset()) {
      fireSelectionChanged(startBefore,endBefore,getStartOffset(),getEndOffset());
    }
  }
}
