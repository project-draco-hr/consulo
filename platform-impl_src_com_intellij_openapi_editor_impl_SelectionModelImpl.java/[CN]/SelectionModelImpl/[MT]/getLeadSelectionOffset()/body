{
  validateContext(false);
  int caretOffset=myEditor.getCaretModel().getOffset();
  if (!hasSelection())   return caretOffset;
  int startOffset=mySelectionMarker.getStartOffset();
  int endOffset=mySelectionMarker.getEndOffset();
  if (caretOffset == endOffset)   return startOffset;
  return endOffset;
}
