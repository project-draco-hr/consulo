{
  ArrayList<LocalInspectionTool> enabled=new ArrayList<LocalInspectionTool>();
  final InspectionTool[] tools=myTools.isEmpty() ? getInspectionTools() : myTools.values().toArray(new InspectionTool[myTools.values().size()]);
  for (int i=0; i < tools.length; i++) {
    InspectionTool tool=tools[i];
    if (tool instanceof LocalInspectionToolWrapper) {
      final ToolState state=getToolState(HighlightDisplayKey.find(tool.getShortName()));
      if (state.isEnabled()) {
        enabled.add(((LocalInspectionToolWrapper)tool).getTool());
      }
    }
  }
  return enabled.toArray(new LocalInspectionTool[enabled.size()]);
}
