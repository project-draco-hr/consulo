{
  final DebuggerContextImpl debuggerContext=DebuggerAction.getDebuggerContext(event.getDataContext());
  if (debuggerContext == null)   return;
  final DebuggerSession session=debuggerContext.getDebuggerSession();
  if (session == null) {
    return;
  }
  final MainWatchPanel watchPanel=DebuggerPanelsManager.getInstance(debuggerContext.getProject()).getWatchPanel();
  if (watchPanel == null) {
    return;
  }
  final DebuggerTreeNodeImpl[] selectedNodes=DebuggerAction.getSelectedNodes(event.getDataContext());
  if (selectedNodes != null && selectedNodes.length > 0) {
    addFromNodes(debuggerContext,watchPanel,selectedNodes);
  }
 else {
    final Editor editor=event.getData(PlatformDataKeys.EDITOR);
    if (editor != null) {
      final TextWithImports editorText=DebuggerUtilsEx.getEditorText(editor);
      if (editorText != null) {
        doAddWatch(watchPanel,editorText,null);
      }
    }
  }
}
