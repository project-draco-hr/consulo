{
  if (module == null || !myShowModules) {
    return getRootNode(scopeType);
  }
  ModuleNode node=getMap(myModuleNodes,scopeType).get(module);
  if (node != null)   return node;
  node=new ModuleNode(module);
  final ModuleManager moduleManager=ModuleManager.getInstance(myProject);
  final String[] groupPath=moduleManager.getModuleGroupPath(module);
  if (groupPath == null) {
    getMap(myModuleNodes,scopeType).put(module,node);
    getRootNode(scopeType).add(node);
    return node;
  }
  getMap(myModuleNodes,scopeType).put(module,node);
  if (myShowModuleGroups) {
    getParentModuleGroup(groupPath,scopeType).add(node);
  }
 else {
    getRootNode(scopeType).add(node);
  }
  return node;
}
