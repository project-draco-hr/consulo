{
  LOG.assertTrue(vFile != null);
  final VirtualFile containingDirectory=vFile.getParent();
  LOG.assertTrue(containingDirectory != null);
  PsiJavaPackage aPackage=null;
  final String packageName=myFileIndex.getPackageNameByDirectory(containingDirectory);
  if (packageName != null) {
    aPackage=myJavaPsiFacade.findPackage(packageName);
  }
  if (aPackage != null) {
    if (myFileIndex.isInLibrarySource(vFile) || myFileIndex.isInLibraryClasses(vFile)) {
      return getLibraryDirNode(aPackage,getLibraryForFile(vFile));
    }
 else {
      return getModuleDirNode(aPackage,myFileIndex.getModuleForFile(vFile),getFileScopeType(vFile));
    }
  }
  return myFileIndex.isInLibrarySource(vFile) ? null : getModuleNode(myFileIndex.getModuleForFile(vFile),getFileScopeType(vFile));
}
