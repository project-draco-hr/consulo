{
  final Document document=editor.getDocument();
  final String textForRollback=document.getText();
  try {
    editor.putUserData(SMART_ENTER_TIMESTAMP,editor.getDocument().getModificationStamp());
    myFirstErrorOffset=Integer.MAX_VALUE;
    mySkipEnter=false;
    process(project,editor,psiFile,0);
  }
 catch (  TooManyAttemptsException e) {
    document.replaceString(0,document.getTextLength(),textForRollback);
  }
 finally {
    editor.putUserData(SMART_ENTER_TIMESTAMP,null);
  }
  return true;
}
