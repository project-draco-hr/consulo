{
  if (myRangeMarker != null) {
    Document document=getDocumentToSynchronize();
    if (document != null) {
      FrozenDocument frozen=getDocumentManager().getLastCommittedDocument(document);
      ManualRangeMarker marker=myRangeMarker;
      for (      DocumentEvent event : getDocumentManager().getEventsSinceCommit(document)) {
        frozen=frozen.applyEvent(event,0);
        marker=marker.getUpdatedRange(withFrozen(frozen,event));
        if (marker == null)         return null;
      }
      return marker.getRange();
    }
    return myRangeMarker.getRange();
  }
  return myPsiRange;
}
