{
  PsiElement anchor=file.getViewProvider().findElementAt(syncStartOffset,language);
  if (anchor == null)   return null;
  TextRange range=anchor.getTextRange();
  if (range.getStartOffset() != syncStartOffset)   return null;
  while (range.getEndOffset() < syncEndOffset) {
    anchor=anchor.getParent();
    if (anchor == null || anchor.getTextRange() == null)     break;
    range=anchor.getTextRange();
  }
  while (range.getEndOffset() == syncEndOffset && anchor != null && !type.equals(anchor.getClass())) {
    anchor=anchor.getParent();
    if (anchor == null || anchor.getTextRange() == null)     break;
    range=anchor.getTextRange();
  }
  return range.getEndOffset() == syncEndOffset ? anchor : null;
}
