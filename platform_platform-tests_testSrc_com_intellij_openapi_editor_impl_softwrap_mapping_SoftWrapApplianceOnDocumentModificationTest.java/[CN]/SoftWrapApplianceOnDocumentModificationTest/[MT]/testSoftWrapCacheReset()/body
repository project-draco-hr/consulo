{
  String text="\t first line\n" + "\t second line\n" + "\t third line";
  init(300,text);
  final EditorSettings settings=getEditor().getSettings();
  settings.setUseSoftWraps(false);
  int startOffset=text.indexOf("\t third") - 1;
  getEditor().getDocument().deleteString(startOffset,text.length());
  settings.setUseSoftWraps(true);
  getEditor().getCaretModel().moveToOffset(getEditor().getDocument().getTextLength());
  type("\n test");
  final int offset=getEditor().getDocument().getTextLength() - 1;
  final LogicalPosition logicalPosition=getEditor().offsetToLogicalPosition(offset);
  assertEquals(offset,getEditor().logicalPositionToOffset(logicalPosition));
  final VisualPosition visualPosition=getEditor().offsetToVisualPosition(offset);
  assertEquals(visualPosition,getEditor().logicalToVisualPosition(logicalPosition));
  assertEquals(logicalPosition,getEditor().visualToLogicalPosition(visualPosition));
}
