{
  final KeyboardFocusManager mgr=KeyboardFocusManager.getCurrentKeyboardFocusManager();
  if (mgr.getFocusOwner() == null) {
    Component c=getComponent(myLastFocusedAtDeactivation,ideFrame);
    if (c == null || !c.isShowing()) {
      c=getComponent(myLastFocused,ideFrame);
    }
    final boolean mouseEventAhead=IdeEventQueue.isMouseEventAhead(null);
    if (c != null && c.isShowing() && !mouseEventAhead) {
      final LayoutFocusTraversalPolicyExt policy=LayoutFocusTraversalPolicyExt.findWindowPolicy(c);
      if (policy != null) {
        policy.setNoDefaultComponent(true,FocusManagerImpl.this);
      }
      requestFocus(c,false).doWhenProcessed(new Runnable(){
        @Override public void run(){
          if (policy != null) {
            policy.setNoDefaultComponent(false,FocusManagerImpl.this);
          }
        }
      }
);
    }
  }
  myLastFocusedAtDeactivation.remove(ideFrame);
}
