{
  assertDispatchThread();
  Component result=null;
  if (!ApplicationManager.getApplication().isActive()) {
    final WeakReference<Component> ref=myLastFocusedAtDeactivation.get(getLastFocusedFrame());
    if (ref != null) {
      result=ref.get();
    }
  }
 else   if (myRunContext != null) {
    result=(Component)myRunContext.getData(PlatformDataKeys.CONTEXT_COMPONENT.getName());
  }
  if (result == null) {
    result=isFocusBeingTransferred() ? null : KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusOwner();
  }
  final boolean meaninglessOwner=UIUtil.isMeaninglessFocusOwner(result);
  if (result == null && !isFocusBeingTransferred() || meaninglessOwner) {
    final Component permOwner=KeyboardFocusManager.getCurrentKeyboardFocusManager().getPermanentFocusOwner();
    if (permOwner != null) {
      result=permOwner;
    }
    if (UIUtil.isMeaninglessFocusOwner(result)) {
      result=KeyboardFocusManager.getCurrentKeyboardFocusManager().getActiveWindow();
    }
  }
  return result;
}
