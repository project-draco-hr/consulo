{
  int modalityCount=0;
  Window[] windows=Window.getWindows();
  for (  Window each : windows) {
    if (!each.isShowing())     continue;
    if (each instanceof Dialog) {
      Dialog eachDialog=(Dialog)each;
      if (eachDialog.isModal()) {
        modalityCount++;
      }
 else       if (each instanceof JDialog) {
        if (isModalContextPopup(((JDialog)each).getRootPane())) {
          modalityCount++;
        }
      }
    }
 else     if (each instanceof JWindow) {
      JRootPane rootPane=((JWindow)each).getRootPane();
      if (isModalContextPopup(rootPane)) {
        modalityCount++;
      }
    }
  }
  Iterator<Integer> modalityCounts=myModalityCount2FlushCount.keySet().iterator();
  while (modalityCounts.hasNext()) {
    Integer eachModalityCount=modalityCounts.next();
    if (eachModalityCount > modalityCount) {
      modalityCounts.remove();
    }
  }
  return modalityCount;
}
