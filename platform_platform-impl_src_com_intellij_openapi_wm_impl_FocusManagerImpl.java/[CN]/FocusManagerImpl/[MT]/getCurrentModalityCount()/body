{
  int modalityCount=0;
  Window[] windows=Window.getWindows();
  for (  Window each : windows) {
    if (!each.isShowing())     continue;
    if (each instanceof Dialog) {
      Dialog eachDialog=(Dialog)each;
      if (eachDialog.isModal()) {
        modalityCount++;
      }
 else       if (each instanceof JDialog) {
        if (isModalContextPopup(((JDialog)each).getRootPane())) {
          modalityCount++;
        }
      }
    }
 else     if (each instanceof JWindow) {
      JRootPane rootPane=((JWindow)each).getRootPane();
      if (isModalContextPopup(rootPane)) {
        modalityCount++;
      }
    }
  }
  final int finalModalityCount=modalityCount;
  myModalityCount2FlushCount.retainEntries(new TIntIntProcedure(){
    @Override public boolean execute(    int eachModalityCount,    int flushCount){
      return eachModalityCount <= finalModalityCount;
    }
  }
);
  return modalityCount;
}
