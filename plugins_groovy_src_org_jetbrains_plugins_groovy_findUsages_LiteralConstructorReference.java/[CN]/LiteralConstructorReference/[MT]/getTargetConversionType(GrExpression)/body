{
  PsiElement parent=PsiUtil.skipParentheses(expression.getParent(),true);
  PsiType type=null;
  if (parent instanceof GrSafeCastExpression) {
    type=((GrSafeCastExpression)parent).getType();
  }
 else   if (parent instanceof GrTypeCastExpression) {
    type=((GrTypeCastExpression)parent).getType();
  }
 else   if (parent instanceof GrAssignmentExpression && PsiTreeUtil.isAncestor(((GrAssignmentExpression)parent).getRValue(),expression,false)) {
    final PsiElement lValue=PsiUtil.skipParentheses(((GrAssignmentExpression)parent).getLValue(),false);
    if (lValue instanceof GrReferenceExpression) {
      type=((GrReferenceExpression)lValue).getNominalType();
    }
  }
 else   if (parent instanceof GrVariable) {
    type=((GrVariable)parent).getDeclaredType();
  }
  if (type instanceof PsiClassType && !type.equalsToText(CommonClassNames.JAVA_LANG_OBJECT) && !type.equalsToText(CommonClassNames.JAVA_LANG_STRING)) {
    return (PsiClassType)type;
  }
  return null;
}
