{
  EditorFactory factory=EditorFactory.getInstance();
  EditorEx editor=(EditorEx)(isViewer ? factory.createViewer(document,project) : factory.createEditor(document,project));
  editor.putUserData(DiffManagerImpl.EDITOR_IS_DIFF_KEY,Boolean.TRUE);
  editor.getGutterComponentEx().revalidateMarkup();
  if (fileType != null && project != null && !project.isDisposed()) {
    CodeStyleFacade codeStyleFacade=CodeStyleFacade.getInstance(project);
    editor.getSettings().setTabSize(codeStyleFacade.getTabSize(fileType));
    editor.getSettings().setUseTabCharacter(codeStyleFacade.useTabCharacter(fileType));
  }
  return editor;
}
