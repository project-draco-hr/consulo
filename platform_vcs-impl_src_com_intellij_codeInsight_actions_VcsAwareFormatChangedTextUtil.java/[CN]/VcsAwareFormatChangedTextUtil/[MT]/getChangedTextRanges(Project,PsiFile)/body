{
  Document document=PsiDocumentManager.getInstance(project).getDocument(file);
  if (document == null)   return ContainerUtil.emptyList();
  List<TextRange> cachedChangedLines=getCachedChangedLines(project,document);
  if (cachedChangedLines != null) {
    return cachedChangedLines;
  }
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    CharSequence testContent=file.getUserData(TEST_REVISION_CONTENT);
    if (testContent != null) {
      return calculateChangedTextRanges(document,testContent);
    }
  }
  Change change=ChangeListManager.getInstance(project).getChange(file.getVirtualFile());
  if (change == null) {
    return ContainerUtilRt.emptyList();
  }
  if (change.getType() == Change.Type.NEW) {
    return ContainerUtil.newArrayList(file.getTextRange());
  }
  String contentFromVcs=getRevisionedContentFrom(change);
  return contentFromVcs != null ? calculateChangedTextRanges(document,contentFromVcs) : ContainerUtil.<TextRange>emptyList();
}
