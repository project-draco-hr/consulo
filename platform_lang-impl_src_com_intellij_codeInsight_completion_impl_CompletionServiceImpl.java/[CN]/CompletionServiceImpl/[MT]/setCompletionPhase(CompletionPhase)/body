{
  ApplicationManager.getApplication().assertIsDispatchThread();
  CompletionPhase oldPhase=getCompletionPhase();
  CompletionProgressIndicator oldIndicator=oldPhase.indicator;
  if (oldIndicator != null && !(phase instanceof CompletionPhase.BgCalculation)) {
    LOG.assertTrue(!oldIndicator.isRunning() || oldIndicator.isCanceled(),"don't change phase during running completion: oldPhase=" + oldPhase);
  }
  Disposer.dispose(oldPhase);
  ourPhase=phase;
  ourPhaseTrace=DebugUtil.currentStackTrace();
}
