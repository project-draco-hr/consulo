{
  return ApplicationManager.getApplication().runReadAction(new Computable<CompletionResultSet>(){
    public CompletionResultSet compute(){
      final PsiElement position=parameters.getPosition();
      if (!position.isValid()) {
        throw new ProcessCanceledException();
      }
      final String prefix=CompletionData.findPrefixStatic(position,parameters.getOffset());
      final String textBeforePosition=parameters.getPosition().getContainingFile().getText().substring(0,parameters.getOffset());
      return new CompletionResultSetImpl(consumer,textBeforePosition,new CamelHumpMatcher(prefix),contributor);
    }
  }
);
}
