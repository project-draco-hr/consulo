{
  final int length=prefix.length();
  if (length == 0)   return lookupString;
  boolean isAllLower=true;
  boolean isAllUpper=true;
  boolean sameCase=true;
  for (int i=0; i < length && (isAllLower || isAllUpper || sameCase); i++) {
    final char c=prefix.charAt(i);
    isAllLower=isAllLower && Character.isLowerCase(c);
    isAllUpper=isAllUpper && Character.isUpperCase(c);
    sameCase=sameCase && Character.isLowerCase(c) == Character.isLowerCase(lookupString.charAt(i));
  }
  if (sameCase)   return lookupString;
  if (isAllLower)   return lookupString.toLowerCase();
  if (isAllUpper)   return lookupString.toUpperCase();
  return lookupString;
}
