{
  final PsiElement position=parameters.getPosition();
  final String prefix=CompletionData.findPrefixStatic(position,parameters.getOffset());
  final String textBeforePosition=parameters.getPosition().getContainingFile().getText().substring(0,parameters.getOffset());
  ProgressIndicator indicator=ProgressManager.getInstance().getProgressIndicator();
  if (!(indicator instanceof CompletionProgressIndicator)) {
    throw new AssertionError("createResultSet may be invoked only from completion thread: " + indicator + "!="+ getCurrentCompletion()+ "; phase set at "+ ourPhaseTrace);
  }
  CompletionProgressIndicator process=(CompletionProgressIndicator)indicator;
  CamelHumpMatcher matcher=new CamelHumpMatcher(prefix,true,parameters.isRelaxedMatching());
  CompletionSorterImpl sorter=defaultSorter(parameters,matcher);
  return new CompletionResultSetImpl(consumer,textBeforePosition,matcher,contributor,parameters,sorter,process,null);
}
