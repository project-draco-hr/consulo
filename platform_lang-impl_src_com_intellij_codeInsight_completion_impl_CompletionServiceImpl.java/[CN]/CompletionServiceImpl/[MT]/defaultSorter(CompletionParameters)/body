{
  final CompletionLocation location=new CompletionLocation(parameters);
  return emptySorter().weigh(new LookupElementWeigher(){
    @Override public Comparable weigh(    @NotNull LookupElement item){
      LookupItemWeightComparable result=CompletionLookupArranger.getCachedRelevance(item);
      if (result != null)       return result;
      final double priority=item instanceof LookupItem ? ((LookupItem)item).getPriority() : 0;
      result=new LookupItemWeightComparable(priority,WeighingService.weigh(CompletionService.RELEVANCE_KEY,item,location));
      item.putUserData(CompletionLookupArranger.RELEVANCE_KEY,result);
      return result;
    }
  }
);
}
