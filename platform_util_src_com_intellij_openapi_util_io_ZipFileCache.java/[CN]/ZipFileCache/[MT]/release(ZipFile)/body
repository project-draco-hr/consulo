{
  if (!ourEnabled) {
    close(file);
    return;
  }
synchronized (ourLock) {
    CacheRecord record=ourFileCache.get(file);
    if (record != null) {
      record.count--;
      record.released=System.currentTimeMillis();
      logger().assertTrue(record.count >= 0,record.path);
      return;
    }
    Integer count=ourQueue.get(file);
    if (count != null) {
      count--;
      if (count == 0) {
        ourQueue.remove(file);
        close(file);
      }
 else {
        ourQueue.put(file,count);
      }
      return;
    }
  }
  logger().warn(new IllegalArgumentException("stray file: " + file.getName()));
  close(file);
}
