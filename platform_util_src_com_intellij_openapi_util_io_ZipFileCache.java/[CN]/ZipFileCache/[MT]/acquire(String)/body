{
  if (!ourEnabled) {
    return new ZipFile(path);
  }
  path=FileUtil.toCanonicalPath(path);
synchronized (ourLock) {
    CacheRecord record=ourPathCache.get(path);
    if (record != null) {
      record.count++;
      return record.file;
    }
  }
  CacheRecord record;
  ZipFile file=tryOpen(path);
synchronized (ourLock) {
    record=ourPathCache.get(path);
    if (record == null) {
      record=new CacheRecord(path,file);
      ourPathCache.put(path,record);
      ourFileCache.put(file,record);
      return file;
    }
 else {
      record.count++;
    }
  }
  close(file);
  return record.file;
}
