{
  Project project=e.getData(PlatformDataKeys.PROJECT);
  boolean enabled=false;
  if (project != null) {
    if (ProjectLevelVcsManager.getInstance(project).isBackgroundVcsOperationRunning()) {
      e.getPresentation().setEnabled(false);
      return;
    }
    Change[] changes=e.getData(VcsDataKeys.CHANGES);
    final ChangeList changeList=ChangesUtil.getChangeListIfOnlyOne(project,changes);
    if (changes != null && changeList != null) {
      for (      Change c : changes) {
        final AbstractVcs vcs=ChangesUtil.getVcsForChange(c,project);
        if (vcs != null && vcs.getCheckinEnvironment() != null) {
          enabled=true;
        }
      }
    }
  }
  e.getPresentation().setEnabled(enabled);
}
