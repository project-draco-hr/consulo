{
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
synchronized (VirtualFileHolder.this) {
        if (myProject.isDisposed() || myFiles.isEmpty())         return;
        final List<VirtualFile> currentFiles=new ArrayList<VirtualFile>(myFiles);
        if (scope.getRecursivelyDirtyDirectories().size() == 0) {
          final Set<FilePath> dirtyFiles=scope.getDirtyFiles();
          for (          FilePath dirtyFile : dirtyFiles) {
            VirtualFile f=dirtyFile.getVirtualFile();
            if (f != null) {
              myFiles.remove(f);
            }
          }
        }
 else {
          for (          VirtualFile file : currentFiles) {
            if (fileDropped(file) || scope.belongsTo(new FilePathImpl(file))) {
              myFiles.remove(file);
            }
          }
        }
      }
    }
  }
);
}
