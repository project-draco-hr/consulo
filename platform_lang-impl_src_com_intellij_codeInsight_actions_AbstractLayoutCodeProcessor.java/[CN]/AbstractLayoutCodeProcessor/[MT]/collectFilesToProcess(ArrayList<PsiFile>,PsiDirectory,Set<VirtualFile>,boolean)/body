{
  PsiFile[] files=dir.getFiles();
  for (  PsiFile file : files) {
    if (isFormatable(file) && !shouldIgnore(file,ignoreRoots)) {
      array.add(file);
    }
  }
  if (recursive) {
    PsiDirectory[] subdirs=dir.getSubdirectories();
    for (    PsiDirectory subdir : subdirs) {
      collectFilesToProcess(array,subdir,ignoreRoots,recursive);
    }
  }
}
