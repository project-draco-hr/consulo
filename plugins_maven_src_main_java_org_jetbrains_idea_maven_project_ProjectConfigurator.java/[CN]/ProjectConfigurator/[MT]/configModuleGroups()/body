{
  if (!mySettings.isCreateModuleGroups())   return;
  final Stack<String> groups=new Stack<String>();
  final boolean createTopLevelGroup=myProjectModel.getRootProjects().size() > 1;
  myProjectModel.visit(new MavenProjectModel.PlainNodeVisitor(){
    int depth=0;
    public void visit(    MavenProjectModel.Node node){
      depth++;
      String name=node.getModuleName();
      if (shouldCreateGroup(node)) {
        groups.push(ProjectBundle.message("module.group.name",name));
      }
      Module module=myModuleModel.findModuleByName(name);
      myModuleModel.setModuleGroupPath(module,groups.isEmpty() ? null : groups.toArray(new String[groups.size()]));
    }
    public void leave(    MavenProjectModel.Node node){
      if (shouldCreateGroup(node)) {
        groups.pop();
      }
      depth--;
    }
    private boolean shouldCreateGroup(    MavenProjectModel.Node node){
      return !node.getSubProjects().isEmpty() && (createTopLevelGroup || depth > 1);
    }
  }
);
}
