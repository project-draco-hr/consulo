{
  final LinkedHashMap<MavenProjectModel.Node,Module> modules=new LinkedHashMap<MavenProjectModel.Node,Module>();
  myProjectModel.visit(new MavenProjectModel.PlainNodeVisitor(){
    public void visit(    MavenProjectModel.Node node){
      Module m=createModule(node);
      if (!node.isValid())       return;
      modules.put(node,m);
    }
  }
);
  LinkedHashMap<Module,ModifiableRootModel> rootModels=new LinkedHashMap<Module,ModifiableRootModel>();
  for (  Map.Entry<MavenProjectModel.Node,Module> each : modules.entrySet()) {
    ModifiableRootModel model=createModuleConfigurator(each.getValue(),each.getKey()).config();
    rootModels.put(each.getValue(),model);
  }
  for (  Map.Entry<MavenProjectModel.Node,Module> each : modules.entrySet()) {
    createModuleConfigurator(each.getValue(),each.getKey()).configFacets(rootModels.get(each.getValue()));
  }
  myRootModelsToCommit.addAll(rootModels.values());
  MavenProjectsManager.getInstance(myProject).setImportedModules(new ArrayList<Module>(modules.values()));
}
