{
  final Map<MavenProject,Module> modules=new HashMap<MavenProject,Module>();
  myProjectModel.visit(new MavenProjectModel.MavenProjectVisitorPlain(){
    public void visit(    MavenProjectModel.Node node){
      MavenProjectHolder p=node.getMavenProject();
      Module m=createModule(node);
      if (!p.isValid())       return;
      modules.put(p.getMavenProject(),m);
    }
  }
);
  List<ModifiableRootModel> rootModels=new ArrayList<ModifiableRootModel>();
  for (  Map.Entry<MavenProject,Module> each : modules.entrySet()) {
    createModuleConfigurator(each.getValue(),each.getKey()).config(rootModels);
  }
  ProjectRootManager.getInstance(myProject).multiCommit(rootModels.toArray(new ModifiableRootModel[rootModels.size()]));
  for (  Map.Entry<MavenProject,Module> each : modules.entrySet()) {
    createModuleConfigurator(each.getValue(),each.getKey()).configFacets();
  }
  MavenProjectsManager.getInstance(myProject).setImportedModules(new ArrayList<Module>(modules.values()));
}
