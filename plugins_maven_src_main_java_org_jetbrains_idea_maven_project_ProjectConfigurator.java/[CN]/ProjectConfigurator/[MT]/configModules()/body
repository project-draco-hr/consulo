{
  final LinkedHashMap<MavenProject,Module> modules=new LinkedHashMap<MavenProject,Module>();
  myProjectModel.visit(new MavenProjectModel.PlainNodeVisitor(){
    public void visit(    MavenProjectModel.Node node){
      MavenProjectHolder p=node.getMavenProject();
      Module m=createModule(node);
      if (!p.isValid())       return;
      modules.put(p.getMavenProject(),m);
    }
  }
);
  LinkedHashMap<Module,ModifiableRootModel> rootModels=new LinkedHashMap<Module,ModifiableRootModel>();
  for (  Map.Entry<MavenProject,Module> each : modules.entrySet()) {
    ModifiableRootModel model=createModuleConfigurator(each.getValue(),each.getKey()).config();
    rootModels.put(each.getValue(),model);
  }
  for (  Map.Entry<MavenProject,Module> each : modules.entrySet()) {
    createModuleConfigurator(each.getValue(),each.getKey()).configFacets(rootModels.get(each.getValue()));
  }
  myRootModelsToCommit=rootModels.values();
  MavenProjectsManager.getInstance(myProject).setImportedModules(new ArrayList<Module>(modules.values()));
}
