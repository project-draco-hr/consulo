{
  List<R> descriptors=target.computeRootDescriptors(model,index,ignoredFileIndex,dataPaths);
  for (  AdditionalRootsProviderService<?> provider : rootsProviders) {
    if (provider.getTargetTypes().contains(targetType)) {
      AdditionalRootsProviderService<R> providerService=(AdditionalRootsProviderService<R>)provider;
      final List<R> additionalRoots=providerService.getAdditionalRoots(target,dataPaths);
      if (!additionalRoots.isEmpty()) {
        descriptors=new ArrayList<R>(descriptors);
        descriptors.addAll(additionalRoots);
      }
    }
  }
  for (  BuildRootDescriptor descriptor : descriptors) {
    List<BuildRootDescriptor> list=myRootToDescriptor.get(descriptor.getRootFile());
    if (list == null) {
      list=new SmartList<BuildRootDescriptor>();
      myRootToDescriptor.put(descriptor.getRootFile(),list);
    }
    list.add(descriptor);
  }
  myRootsByTarget.put(target,descriptors);
}
