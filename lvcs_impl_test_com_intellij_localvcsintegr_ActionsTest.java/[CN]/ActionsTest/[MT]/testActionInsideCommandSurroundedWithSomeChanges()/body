{
  final VirtualFile f=root.createChildData(null,"f.java");
  CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
    public void run(){
      try {
        f.setBinaryContent(new byte[]{0});
        setDocumentTextFor(f,new byte[]{1});
        LocalHistoryAction a=LocalHistory.startAction(myProject,"action");
        setDocumentTextFor(f,new byte[]{2});
        a.finish();
        saveDocument(f);
        f.setBinaryContent(new byte[]{3});
      }
 catch (      IOException e) {
        throw new RuntimeException(e);
      }
    }
  }
,"command",null);
  List<Revision> rr=getVcsRevisionsFor(f);
  assertEquals(3,rr.size());
  assertEquals(3,contentOf(rr.get(0))[0]);
  assertEquals(1,contentOf(rr.get(1))[0]);
  assertTrue(contentOf(rr.get(2)).length == 0);
  assertEquals("command",rr.get(0).getCauseAction());
  assertNull(rr.get(1).getCauseAction());
  assertNull(rr.get(2).getCauseAction());
}
