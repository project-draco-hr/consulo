{
  if (myModule != null && !processed.contains(myModule) && !myModule.isDisposed()) {
    processed.add(myModule);
    if (myScope == DependencyScope.RUNTIME && (type == OrderRootType.COMPILATION_CLASSES || type == OrderRootType.PRODUCTION_COMPILATION_CLASSES)) {
      return VirtualFile.EMPTY_ARRAY;
    }
    if (myScope == DependencyScope.TEST && type == OrderRootType.PRODUCTION_COMPILATION_CLASSES) {
      return VirtualFile.EMPTY_ARRAY;
    }
    return ((ModuleRootManagerImpl)ModuleRootManager.getInstance(myModule)).getFilesForOtherModules(type,processed);
  }
 else {
    return VirtualFile.EMPTY_ARRAY;
  }
}
