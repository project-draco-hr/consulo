{
  final ModifiableRootModel model=ModuleRootManager.getInstance(module).getModifiableModel();
  final Library library=model.getModuleLibraryTable().createLibrary(libName);
  final Library.ModifiableModel libraryModel=library.getModifiableModel();
  for (  String root : classesRoots) {
    libraryModel.addRoot(root,BinariesOrderRootType.getInstance());
  }
  for (  String root : sourceRoots) {
    libraryModel.addRoot(root,SourcesOrderRootType.getInstance());
  }
  model.findLibraryOrderEntry(library).setScope(scope);
  new WriteAction(){
    @Override protected void run(    Result result) throws Throwable {
      libraryModel.commit();
      model.commit();
    }
  }
.execute();
}
