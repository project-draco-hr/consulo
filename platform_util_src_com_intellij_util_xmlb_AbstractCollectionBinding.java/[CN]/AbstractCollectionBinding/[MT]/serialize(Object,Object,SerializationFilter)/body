{
  Collection<Object> collection=o == null ? null : getIterable(o);
  final String tagName=getTagName(o);
  if (tagName != null) {
    Element result=new Element(tagName);
    if (ContainerUtil.isEmpty(collection)) {
      return new Element(tagName);
    }
    for (    Object e : collection) {
      if (e == null) {
        throw new XmlSerializationException("Collection " + myAccessor + " contains 'null' object");
      }
      Content child=(Content)getElementBinding(e.getClass()).serialize(e,result,filter);
      if (child != null) {
        result.addContent(child);
      }
    }
    return result;
  }
 else {
    List<Object> result=new SmartList<Object>();
    if (ContainerUtil.isEmpty(collection)) {
      return result;
    }
    for (    Object e : collection) {
      ContainerUtil.addIfNotNull(result,getElementBinding(e.getClass()).serialize(e,result,filter));
    }
    return result;
  }
}
