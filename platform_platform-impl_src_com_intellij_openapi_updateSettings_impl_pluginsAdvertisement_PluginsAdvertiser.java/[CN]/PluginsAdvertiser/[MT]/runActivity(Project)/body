{
  if (!UpdateSettings.getInstance().isCheckNeeded())   return;
  final UnknownFeaturesCollector collectorSuggester=UnknownFeaturesCollector.getInstance(project);
  final Set<UnknownFeature> unknownFeatures=collectorSuggester.getUnknownFeatures();
  final KnownExtensions extensions=loadExtensions();
  if (extensions != null && unknownFeatures.isEmpty())   return;
  final Runnable runnable=new Runnable(){
    @Override public void run(){
      final Application application=ApplicationManager.getApplication();
      if (application.isUnitTestMode() || application.isHeadlessEnvironment())       return;
      ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
        private final Set<PluginDownloader> myPlugins=new HashSet<PluginDownloader>();
        private List<IdeaPluginDescriptor> myAllPlugins;
        @Override public void run(){
          if (extensions == null) {
            loadSupportedExtensions();
          }
          final Set<PluginId> ids=new HashSet<PluginId>();
          for (          UnknownFeature feature : unknownFeatures) {
            final List<PluginId> pluginId=retrieve(feature);
            if (pluginId != null) {
              final List<String> disabledPlugins=PluginManagerCore.getDisabledPlugins();
              for (              PluginId id : pluginId) {
                if (!disabledPlugins.contains(id.getIdString())) {
                  ids.add(id);
                }
              }
            }
          }
          try {
            myAllPlugins=RepositoryHelper.loadPluginsFromRepository(null);
            for (            IdeaPluginDescriptor loadedPlugin : myAllPlugins) {
              if (ids.contains(loadedPlugin.getPluginId())) {
                myPlugins.add(PluginDownloader.createDownloader(loadedPlugin));
              }
            }
            ApplicationManager.getApplication().invokeLater(new Runnable(){
              @Override public void run(){
                onSuccess();
              }
            }
,ModalityState.NON_MODAL);
          }
 catch (          Exception ignore) {
          }
        }
        public void onSuccess(){
          if (!myPlugins.isEmpty()) {
            final String displayId="Plugins Suggestion";
            new NotificationGroup(displayId,NotificationDisplayType.STICKY_BALLOON,true).createNotification(displayId,"Features covered by non-bundled plugins are detected.<br>" + "<a href=\"configure\">Configure plugins...</a><br>" + "<a href=\"ignore\">Ignore All</a>",NotificationType.INFORMATION,new NotificationListener(){
              @Override public void hyperlinkUpdate(              @NotNull Notification notification,              @NotNull HyperlinkEvent event){
                if (event.getEventType() == HyperlinkEvent.EventType.ACTIVATED) {
                  final String description=event.getDescription();
                  if ("ignore".equals(description)) {
                    for (                    UnknownFeature feature : unknownFeatures) {
                      collectorSuggester.ignoreFeature(feature);
                    }
                    notification.expire();
                  }
 else                   if ("configure".equals(description)) {
                    LOG.assertTrue(myAllPlugins != null);
                    notification.expire();
                    new PluginsAdvertiserDialog(project,myPlugins.toArray(new PluginDownloader[myPlugins.size()]),myAllPlugins).show();
                  }
                }
              }
            }
).notify(project);
          }
        }
      }
);
    }
  }
;
  SwingUtilities.invokeLater(runnable);
}
