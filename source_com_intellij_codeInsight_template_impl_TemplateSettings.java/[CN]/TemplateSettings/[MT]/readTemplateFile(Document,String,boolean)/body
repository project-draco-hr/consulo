{
  if (document == null) {
    throw new InvalidDataException();
  }
  Element root=document.getRootElement();
  if (root == null || !TEMPLATE_SET.equals(root.getName())) {
    throw new InvalidDataException();
  }
  String groupName=root.getAttributeValue(GROUP);
  if (groupName == null || groupName.length() == 0)   groupName=defGroupName;
  for (Iterator iterator=root.getChildren(TEMPLATE).iterator(); iterator.hasNext(); ) {
    Element element=(Element)iterator.next();
    String name=element.getAttributeValue(NAME);
    String value=element.getAttributeValue(VALUE);
    String description=element.getAttributeValue(DESCRIPTION);
    String shortcut=element.getAttributeValue(SHORTCUT);
    if (isDefault && myDeletedTemplates.contains(name))     continue;
    TemplateImpl template=addTemplate(name,value,groupName,description,shortcut,isDefault);
    template.setToReformat("true".equals(element.getAttributeValue(TO_REFORMAT)));
    template.setToShortenLongNames("true".equals(element.getAttributeValue(TO_SHORTEN_FQ_NAMES)));
    template.setDeactivated("true".equals(element.getAttributeValue(DEACTIVATED)));
    for (Iterator i=element.getChildren(VARIABLE).iterator(); i.hasNext(); ) {
      Element e=(Element)i.next();
      String variableName=e.getAttributeValue(NAME);
      String expression=e.getAttributeValue(EXPRESSION);
      String defaultValue=e.getAttributeValue(DEFAULT_VALUE);
      boolean isAlwaysStopAt="true".equals(e.getAttributeValue(ALWAYS_STOP_AT));
      template.addVariable(variableName,expression,defaultValue,isAlwaysStopAt);
    }
    Element context=element.getChild(CONTEXT);
    if (context != null) {
      DefaultJDOMExternalizer.readExternal(template.getTemplateContext(),context);
    }
  }
}
