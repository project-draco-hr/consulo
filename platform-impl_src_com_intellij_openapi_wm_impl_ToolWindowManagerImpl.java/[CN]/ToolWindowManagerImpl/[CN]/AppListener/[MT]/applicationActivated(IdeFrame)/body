{
  final FocusCommand cmd=myFocusCommandOnAppActivation;
  ActionCallback callback=myCallbackOnActivation;
  myFocusCommandOnAppActivation=null;
  myCallbackOnActivation=null;
  if (cmd != null) {
    requestFocus(cmd,true).notifyWhenDone(callback);
  }
 else {
    final KeyboardFocusManager mgr=KeyboardFocusManager.getCurrentKeyboardFocusManager();
    if (ideFrame == myWindowManager.getFrame(myProject)) {
      final Component owner=mgr.getFocusOwner();
      Component old=myFocusedComponentOnDeactivation != null ? myFocusedComponentOnDeactivation.get() : null;
      if (old == null) {
        old=IdeFocusTraversalPolicy.getPreferredFocusedComponent(((IdeFrameImpl)ideFrame).getRootPane());
      }
      if (owner == null && old != null && old.isShowing()) {
        requestFocus(old,false);
      }
      myFocusedComponentOnDeactivation=null;
    }
  }
}
