{
  myRedispatching=true;
  try {
    final KeyEvent[] events=myToDispatchOnDone.toArray(new KeyEvent[myToDispatchOnDone.size()]);
    if (isFocusTranferInProgress())     return;
    IdeEventQueue.getInstance().getKeyEventDispatcher().resetState();
    for (int i=0; i < events.length; i++) {
      KeyEvent each=events[i];
      if (isFocusTranferInProgress())       return;
      final Component owner=KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusOwner();
      if (owner != null) {
        IdeEventQueue.getInstance().dispatchEvent(new KeyEvent(owner,each.getID(),each.getWhen(),each.getModifiersEx(),each.getKeyCode(),each.getKeyChar(),each.getKeyLocation()));
      }
      myToDispatchOnDone.remove(each);
    }
  }
  finally {
    myRedispatching=false;
  }
  final Runnable[] all=myIdleRequests.toArray(new Runnable[myIdleRequests.size()]);
  myIdleRequests.clear();
  for (  Runnable each : all) {
    each.run();
  }
}
