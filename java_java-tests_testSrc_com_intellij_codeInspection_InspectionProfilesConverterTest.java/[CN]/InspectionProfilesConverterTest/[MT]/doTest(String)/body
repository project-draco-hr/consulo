{
  try {
    final String relativePath="/inspection/converter/";
    final File projectFile=new File(JavaTestUtil.getJavaTestDataPath() + relativePath + dirName+ "/options.ipr");
    final List children=JDOMUtil.loadDocument(projectFile).getRootElement().getChildren("component");
    for (    Object child : children) {
      final Element element=(Element)child;
      if (Comparing.strEqual(element.getAttributeValue("name"),"InspectionProjectProfileManager")) {
        final InspectionProjectProfileManager profileManager=InspectionProjectProfileManager.getInstance(getProject());
        InspectionProfileImpl.INIT_INSPECTIONS=true;
        profileManager.readExternal(element);
        final Element configElement=new Element("config");
        profileManager.writeExternal(configElement);
        final File file=new File(JavaTestUtil.getJavaTestDataPath() + relativePath + dirName+ "/options.after.xml");
        PlatformTestUtil.assertElementsEqual(configElement,JDOMUtil.loadDocument(file).getRootElement());
        break;
      }
    }
  }
  finally {
    InspectionProfileImpl.INIT_INSPECTIONS=false;
  }
}
