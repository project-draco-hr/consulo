{
  final AndroidRunningState state=super.getState(executor,env);
  if (state == null) {
    return null;
  }
  final AndroidFacet facet=state.getFacet();
  final AndroidFacetConfiguration configuration=facet.getConfiguration();
  if (!configuration.PACK_TEST_CODE) {
    final Module module=facet.getModule();
    final int count=getTestSourceRootCount(module);
    if (count > 0) {
      final String message="Code and resources under test source " + (count > 1 ? "roots" : "root") + " aren't included into debug APK.\nWould you like to include them and recompile "+ module.getName()+ " module?"+ "\n(You may change this option in Android facet settings later)";
      final int result=Messages.showYesNoCancelDialog(getProject(),message,"Test code not included into APK",Messages.getQuestionIcon());
      if (result == Messages.YES) {
        configuration.PACK_TEST_CODE=true;
      }
 else       if (result == Messages.CANCEL) {
        return null;
      }
    }
  }
  return state;
}
