{
  PsiDirectory result=null;
  for (int i=0; i < elements.length; i++) {
    PsiElement element=elements[i];
    PsiDirectory directory;
    if (element instanceof PsiDirectory) {
      directory=(PsiDirectory)element;
      directory=directory.getParentDirectory();
    }
 else     if (element instanceof PsiFile) {
      directory=((PsiFile)element).getContainingDirectory();
    }
 else {
      throw new IllegalArgumentException("unexpected element " + element);
    }
    if (directory == null)     continue;
    if (result == null) {
      result=directory;
    }
 else {
      if (PsiTreeUtil.isAncestor(directory,result,true)) {
        result=directory;
      }
    }
  }
  return result;
}
