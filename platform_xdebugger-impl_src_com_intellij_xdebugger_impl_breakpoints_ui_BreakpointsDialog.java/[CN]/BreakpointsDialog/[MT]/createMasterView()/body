{
  myTreeController=new BreakpointItemsTreeController(myRulesEnabled){
    @Override public void nodeStateWillChangeImpl(    CheckedTreeNode node){
      if (node instanceof BreakpointItemNode) {
        ((BreakpointItemNode)node).getBreakpointItem().saveState();
      }
      super.nodeStateWillChangeImpl(node);
    }
    @Override public void nodeStateDidChangeImpl(    CheckedTreeNode node){
      super.nodeStateDidChangeImpl(node);
      if (node instanceof BreakpointItemNode) {
        myDetailController.doUpdateDetailView(true);
      }
    }
    @Override protected void selectionChangedImpl(){
      super.selectionChangedImpl();
      saveCurrentItem();
      myDetailController.updateDetailView();
    }
  }
;
  JTree tree=new BreakpointsCheckboxTree(myProject,myTreeController);
  new AnAction("BreakpointDialog.GoToSource"){
    @Override public void actionPerformed(    AnActionEvent e){
      navigate();
      close(OK_EXIT_CODE);
    }
  }
.registerCustomShortcutSet(new CustomShortcutSet(KeyStroke.getKeyStroke(KeyEvent.VK_ENTER,0)),tree);
  new AnAction("BreakpointDialog.ShowSource"){
    @Override public void actionPerformed(    AnActionEvent e){
      navigate();
    }
  }
.registerCustomShortcutSet(ActionManager.getInstance().getAction(IdeActions.ACTION_EDIT_SOURCE).getShortcutSet(),tree);
  final DefaultActionGroup breakpointTypes=new DefaultActionGroup();
  for (  BreakpointPanelProvider provider : myBreakpointsPanelProviders) {
    breakpointTypes.addAll(provider.getAddBreakpointActions(myProject));
  }
  ToolbarDecorator decorator=ToolbarDecorator.createDecorator(tree).setAddAction(new AnActionButtonRunnable(){
    @Override public void run(    AnActionButton button){
      JBPopupFactory.getInstance().createActionGroupPopup(null,breakpointTypes,DataManager.getInstance().getDataContext(button.getContextComponent()),JBPopupFactory.ActionSelectionAid.NUMBERING,false).show(button.getPreferredPopupPoint());
    }
  }
).setRemoveAction(new AnActionButtonRunnable(){
    @Override public void run(    AnActionButton button){
      myTreeController.removeSelectedBreakpoints(myProject);
    }
  }
).setRemoveActionUpdater(new AnActionButtonUpdater(){
    @Override public boolean isEnabled(    AnActionEvent e){
      boolean enabled=false;
      final ItemWrapper[] items=myMasterController.getSelectedItems();
      for (      ItemWrapper item : items) {
        if (item.allowedToRemove()) {
          enabled=true;
        }
      }
      return enabled;
    }
  }
);
  for (  ToggleActionButton action : myToggleRuleActions) {
    decorator.addExtraAction(action);
  }
  JPanel decoratedTree=decorator.createPanel();
  myTreeController.setTreeView(tree);
  myTreeController.buildTree(myBreakpointItems);
  initSelection(myBreakpointItems);
  final BreakpointPanelProvider.BreakpointsListener listener=new BreakpointPanelProvider.BreakpointsListener(){
    @Override public void breakpointsChanged(){
      collectItems();
      myTreeController.rebuildTree(myBreakpointItems);
    }
  }
;
  for (  BreakpointPanelProvider provider : myBreakpointsPanelProviders) {
    provider.addListener(listener,myProject,myListenerDisposable);
  }
  return decoratedTree;
}
