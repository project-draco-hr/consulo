{
  if (DaemonListeners.isUnderIgnoredAction(null))   return;
  List<Pair<PsiElement,Boolean>> toUpdate=changedElements.get(document);
  if (toUpdate != null) {
    Application application=ApplicationManager.getApplication();
    final Editor editor=FileEditorManager.getInstance(myProject).getSelectedTextEditor();
    if (editor != null && !application.isUnitTestMode()) {
      application.invokeLater(new Runnable(){
        public void run(){
          if (myProject.isDisposed())           return;
          EditorMarkupModel markupModel=(EditorMarkupModel)editor.getMarkupModel();
          markupModel.setErrorStripeRenderer(markupModel.getErrorStripeRenderer());
        }
      }
,ModalityState.stateForComponent(editor.getComponent()));
    }
    for (    Pair<PsiElement,Boolean> changedElement : toUpdate) {
      PsiElement element=changedElement.getFirst();
      Boolean whiteSpaceOptimizationAllowed=changedElement.getSecond();
      updateByChange(element,document,whiteSpaceOptimizationAllowed);
    }
    changedElements.remove(document);
  }
}
