{
  Map<String,BuildTargetType> types=new HashMap<String,BuildTargetType>();
  for (  BuilderService service : JpsServiceManager.getInstance().getExtensions(BuilderService.class)) {
    for (    BuildTargetType type : service.getTargetTypes()) {
      String id=type.getTypeId();
      BuildTargetType old=types.put(id,type);
      if (old != null) {
        LOG.error("Two build target types (" + type + ", "+ old+ ") use same id ("+ id+ ")");
      }
    }
  }
  int typeCount=in.readInt();
  while (typeCount-- > 0) {
    final String typeId=IOUtil.readString(in);
    int targetCount=in.readInt();
    while (targetCount-- > 0) {
      final String id=IOUtil.readString(in);
      BuildTargetType type=types.get(typeId);
      if (type != null) {
        BuildTarget target=type.createTarget(id);
        getDelta(target).load(in);
        myInitialScanPerformed.add(target);
      }
 else {
        LOG.info("Unknown build type id: " + typeId);
        new FilesDelta().load(in);
      }
    }
  }
  int artifactRootsCount=in.readInt();
  while (artifactRootsCount-- > 0) {
    String name=IOUtil.readString(in);
    getDelta(name).load(in);
    myArtifactInitialScanPerformed.add(name);
  }
}
