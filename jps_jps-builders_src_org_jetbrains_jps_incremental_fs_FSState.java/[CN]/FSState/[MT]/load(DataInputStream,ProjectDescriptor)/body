{
  Map<String,BuildTargetType> types=new HashMap<String,BuildTargetType>();
  for (  BuilderService service : JpsServiceManager.getInstance().getExtensions(BuilderService.class)) {
    for (    BuildTargetType type : service.getTargetTypes()) {
      String id=type.getTypeId();
      BuildTargetType old=types.put(id,type);
      if (old != null) {
        LOG.error("Two build target types (" + type + ", "+ old+ ") use same id ("+ id+ ")");
      }
    }
  }
  int typeCount=in.readInt();
  while (typeCount-- > 0) {
    final String typeId=IOUtil.readString(in);
    int targetCount=in.readInt();
    while (targetCount-- > 0) {
      final String id=IOUtil.readString(in);
      BuildTargetType type=types.get(typeId);
      boolean loaded=false;
      if (type != null) {
        BuildTarget target=type.createTarget(id,projectDescriptor);
        if (target != null) {
          getDelta(target).load(in);
          myInitialScanPerformed.add(target);
          loaded=true;
        }
      }
      if (!loaded) {
        LOG.info("Skipping unknown target (typeId=" + typeId + ", type="+ type+ ", id="+ id+ ")");
        new FilesDelta().load(in);
      }
    }
  }
  int artifactRootsCount=in.readInt();
  while (artifactRootsCount-- > 0) {
    String name=IOUtil.readString(in);
    getDelta(name).load(in);
    myArtifactInitialScanPerformed.add(name);
  }
}
