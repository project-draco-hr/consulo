{
  final ModuleManager moduleManager=ModuleManager.getInstance(myProject);
  final Module[] modules=ApplicationManager.getApplication().runReadAction(new Computable<Module[]>(){
    public Module[] compute(){
      return moduleManager.getModules();
    }
  }
);
  final TreeSet<VirtualFile> checkSet=new TreeSet<VirtualFile>(FilePathComparator.getInstance());
  myRoots=new HashSet<VirtualFile>();
  myRoots.addAll(myInitialRoots);
  checkSet.addAll(myInitialRoots);
  for (  Module module : modules) {
    final VirtualFile[] files=ModuleRootManager.getInstance(module).getContentRoots();
    for (    VirtualFile file : files) {
      final VirtualFile floor=checkSet.floor(file);
      if (floor != null) {
        myModulesSet.put(file,module.getName());
        myRoots.add(file);
      }
    }
  }
}
