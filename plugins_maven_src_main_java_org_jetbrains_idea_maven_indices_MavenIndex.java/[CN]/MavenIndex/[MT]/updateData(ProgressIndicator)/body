{
  progress.setText2(IndicesBundle.message("maven.indices.updating.saving"));
  String newDataDirName;
  IndexData newData;
  newDataDirName=findAvailableDataDirName();
  FileUtil.copyDir(getUpdateDir(),getDataContextDir(getDataDir(newDataDirName)));
  newData=openData(newDataDirName);
  try {
    doUpdateIndexData(newData,progress);
    newData.flush();
  }
 catch (  Throwable e) {
    newData.close();
    FileUtil.delete(getDataDir(newDataDirName));
    if (e instanceof IOException)     throw (IOException)e;
    throw new RuntimeException(e);
  }
synchronized (this) {
    IndexData oldData=myData;
    String oldDataDir=myDataDirName;
    myData=newData;
    myDataDirName=newDataDirName;
    myUpdateTimestamp=System.currentTimeMillis();
    oldData.close();
    FileUtil.delete(getDataDir(oldDataDir));
  }
}
