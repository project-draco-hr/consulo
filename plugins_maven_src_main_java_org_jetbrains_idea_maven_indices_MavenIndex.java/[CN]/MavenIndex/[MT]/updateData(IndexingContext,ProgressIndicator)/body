{
  progress.setText2(IndicesBundle.message("maven.indices.updating.saving"));
  String newDataDir;
  IndexData newData;
synchronized (myDirectoryLock) {
    newDataDir=findAvailableDataDir();
    newData=openData(newDataDir);
  }
  try {
    doUpdateIndexData(context,newData,progress);
    newData.flush();
  }
 catch (  Throwable e) {
    newData.close();
    FileUtil.delete(getDataDir(newDataDir));
    if (e instanceof IOException)     throw (IOException)e;
    throw new RuntimeException(e);
  }
synchronized (this) {
    IndexData oldData=myData;
    String oldDataDir=myDataDirName;
    myData=newData;
    myDataDirName=newDataDir;
    myUpdateTimestamp=System.currentTimeMillis();
    oldData.close();
    FileUtil.delete(getDataDir(oldDataDir));
  }
}
