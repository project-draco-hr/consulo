{
  myWizardTree=new MyTree();
  myWizardTree.getAccessibleContext().setAccessibleName("WizardTree");
  myBuilder=new FilteringTreeBuilder(getProject(),myWizardTree,this,getTreeStep().getStructure(),AlphaComparator.INSTANCE){
    @Override protected boolean isSelectable(    final Object nodeObject){
      return getTreeStep().isSelectable(nodeObject,nodeObject);
    }
  }
;
  myBuilder.updateFromRoot();
  myWizardTree.getSelectionModel().setSelectionMode(TreeSelectionModel.SINGLE_TREE_SELECTION);
  Action action=myWizardTree.getActionMap().get("toggleSelectionPreserveAnchor");
  if (action != null) {
    action.setEnabled(false);
  }
  myWizardTree.addKeyListener(new KeyAdapter(){
    public void keyPressed(    KeyEvent e){
      if (e.getKeyCode() == KeyEvent.VK_SPACE) {
        toggleExpansion(myWizardTree.getAnchorSelectionPath());
      }
    }
  }
);
  myWizardTree.setRootVisible(getTreeStep().isRootVisible());
  myWizardTree.setShowsRootHandles(true);
  ToolTipManager.sharedInstance().registerComponent(myWizardTree);
  myWizardTree.setCellRenderer(new MyRenderer());
  myMouseMotionListener=new MyMouseMotionListener();
  myMouseListener=new MyMouseListener();
  registerAction("select",KeyEvent.VK_ENTER,0,new AbstractAction(){
    public void actionPerformed(    ActionEvent e){
      handleSelect(true);
    }
  }
);
  registerAction("toggleExpansion",KeyEvent.VK_SPACE,0,new AbstractAction(){
    public void actionPerformed(    ActionEvent e){
      toggleExpansion(myWizardTree.getSelectionPath());
    }
  }
);
  final Action oldExpandAction=getActionMap().get("selectChild");
  getActionMap().put("selectChild",new AbstractAction(){
    public void actionPerformed(    ActionEvent e){
      final TreePath path=myWizardTree.getSelectionPath();
      if (path != null && 0 == myWizardTree.getModel().getChildCount(path.getLastPathComponent())) {
        handleSelect(false);
        return;
      }
      oldExpandAction.actionPerformed(e);
    }
  }
);
  final Action oldCollapseAction=getActionMap().get("selectParent");
  getActionMap().put("selectParent",new AbstractAction(){
    public void actionPerformed(    ActionEvent e){
      final TreePath path=myWizardTree.getSelectionPath();
      if (shouldHidePopup(path)) {
        goBack();
        return;
      }
      oldCollapseAction.actionPerformed(e);
    }
  }
);
  return myWizardTree;
}
