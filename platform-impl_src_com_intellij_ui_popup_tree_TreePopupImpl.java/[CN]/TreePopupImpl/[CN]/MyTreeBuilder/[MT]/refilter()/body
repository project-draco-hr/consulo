{
  Object selectedObject=getSelected();
  final Object toSelect=getTreeStep().isSelectable(selectedObject,selectedObject) ? selectedObject : null;
  ((TreePopupStructure)getTreeStructure()).refilter();
  updateFromRoot();
  boolean wasSelected=false;
  if (selectedObject != null) {
    wasSelected=myWizardTree.select(this,new SimpleNodeVisitor(){
      public boolean accept(      SimpleNode simpleNode){
        if (simpleNode instanceof TreePopupStructure.Node) {
          TreePopupStructure.Node node=(TreePopupStructure.Node)simpleNode;
          return node.getDelegate().equals(toSelect);
        }
 else {
          return false;
        }
      }
    }
,true);
  }
  if (!wasSelected) {
    myWizardTree.select(this,new SimpleNodeVisitor(){
      public boolean accept(      SimpleNode simpleNode){
        if (simpleNode instanceof TreePopupStructure.Node) {
          TreePopupStructure.Node node=(TreePopupStructure.Node)simpleNode;
          if (getTreeStep().isSelectable(node,node.getDelegate())) {
            return true;
          }
        }
 else {
          return false;
        }
        return false;
      }
    }
,true);
  }
  if (!wasSelected && myLastSuccessfulSelect != null) {
    wasSelected=myWizardTree.select(this,new SimpleNodeVisitor(){
      public boolean accept(      SimpleNode simpleNode){
        if (simpleNode instanceof TreePopupStructure.Node) {
          Object object=((TreePopupStructure.Node)simpleNode).getDelegate();
          return myLastSuccessfulSelect.equals(object);
        }
        return false;
      }
    }
,true);
    if (wasSelected) {
      myLastSuccessfulSelect=getSelected();
    }
  }
 else   if (wasSelected) {
    myLastSuccessfulSelect=getSelected();
  }
}
