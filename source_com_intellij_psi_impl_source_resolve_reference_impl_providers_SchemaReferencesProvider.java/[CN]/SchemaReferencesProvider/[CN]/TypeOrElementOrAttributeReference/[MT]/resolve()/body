{
  final XmlAttribute attribute=PsiTreeUtil.getParentOfType(myElement,XmlAttribute.class);
  final XmlTag tag=attribute.getParent();
  XmlDocument document=((XmlFile)tag.getContainingFile()).getDocument();
  String canonicalText=getCanonicalText();
  XmlNSDescriptor nsDescriptor=(XmlNSDescriptor)document.getMetaData();
  if (nsDescriptor instanceof XmlNSDescriptorImpl) {
    XmlNSDescriptorImpl xmlNSDescriptor=((XmlNSDescriptorImpl)nsDescriptor);
    final String localName=tag.getLocalName();
    final String attributeLocalName=attribute.getLocalName();
    if ("ref".equals(attributeLocalName) || "substitutionGroup".equals(attributeLocalName)) {
      if (localName.equals("group")) {
        return xmlNSDescriptor.findGroup(canonicalText);
      }
 else       if (localName.equals("attributeGroup")) {
        return xmlNSDescriptor.findAttributeGroup(canonicalText);
      }
 else       if ("element".equals(localName)) {
        XmlElementDescriptor descriptor=xmlNSDescriptor.getElementDescriptor(XmlUtil.findLocalNameByQualifiedName(canonicalText),tag.getNamespaceByPrefix(XmlUtil.findPrefixByQualifiedName(canonicalText)),new HashSet<XmlNSDescriptorImpl>(),true);
        return descriptor != null ? descriptor.getDeclaration() : null;
      }
 else       if ("attribute".equals(localName)) {
        XmlAttributeDescriptor descriptor=xmlNSDescriptor.getAttribute(XmlUtil.findLocalNameByQualifiedName(canonicalText),tag.getNamespaceByPrefix(XmlUtil.findPrefixByQualifiedName(canonicalText)));
        return descriptor != null ? descriptor.getDeclaration() : null;
      }
    }
 else     if ("type".equals(attributeLocalName) || "base".equals(attributeLocalName)) {
      TypeDescriptor typeDescriptor=((XmlNSDescriptorImpl)nsDescriptor).getTypeDescriptor(canonicalText,tag);
      if (typeDescriptor instanceof ComplexTypeDescriptor) {
        return ((ComplexTypeDescriptor)typeDescriptor).getDeclaration();
      }
    }
  }
  return null;
}
