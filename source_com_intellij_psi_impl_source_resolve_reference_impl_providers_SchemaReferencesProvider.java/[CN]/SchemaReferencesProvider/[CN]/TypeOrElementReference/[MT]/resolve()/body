{
  final XmlAttribute attribute=PsiTreeUtil.getParentOfType(myElement,XmlAttribute.class);
  final XmlTag tag=attribute.getParent();
  XmlDocument document=((XmlFile)tag.getContainingFile()).getDocument();
  String canonicalText=getCanonicalText();
  final String namespaceByPrefix=tag.getNamespaceByPrefix(XmlUtil.findPrefixByQualifiedName(canonicalText));
  XmlNSDescriptor nsDescriptor=(XmlNSDescriptor)document.getMetaData();
  if (namespaceByPrefix != null) {
    XmlNSDescriptor namespaceDescriptor=tag.getNSDescriptor(namespaceByPrefix,true);
    if (namespaceDescriptor != null)     nsDescriptor=namespaceDescriptor;
  }
  if (nsDescriptor instanceof XmlNSDescriptorImpl) {
    XmlNSDescriptorImpl xmlNSDescriptor=((XmlNSDescriptorImpl)nsDescriptor);
    final String localName=tag.getLocalName();
    if ("ref".equals(attribute.getLocalName())) {
      if (localName.equals("group")) {
        return ((XmlNSDescriptorImpl)nsDescriptor).findGroup(canonicalText);
      }
 else       if (localName.equals("attributeGroup")) {
        return ((XmlNSDescriptorImpl)nsDescriptor).findAttributeGroup(canonicalText);
      }
 else {
        XmlElementDescriptor descriptor=xmlNSDescriptor.getElementDescriptor(XmlUtil.findLocalNameByQualifiedName(canonicalText),namespaceByPrefix,new HashSet<XmlNSDescriptorImpl>(),true);
        return descriptor != null ? descriptor.getDeclaration() : null;
      }
    }
 else {
      TypeDescriptor typeDescriptor=((XmlNSDescriptorImpl)nsDescriptor).getTypeDescriptor(canonicalText,tag);
      if (typeDescriptor instanceof ComplexTypeDescriptor) {
        return ((ComplexTypeDescriptor)typeDescriptor).getDeclaration();
      }
    }
  }
  return null;
}
