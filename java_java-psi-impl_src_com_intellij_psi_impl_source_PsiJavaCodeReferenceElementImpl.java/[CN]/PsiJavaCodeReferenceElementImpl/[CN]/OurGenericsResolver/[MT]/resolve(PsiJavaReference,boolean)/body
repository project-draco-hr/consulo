{
  PsiJavaCodeReferenceElementImpl referenceElement=(PsiJavaCodeReferenceElementImpl)ref;
  int kind=referenceElement.getKind();
  JavaResolveResult[] result=referenceElement.resolve(kind);
  if (incompleteCode && result.length == 0 && kind != CLASS_FQ_NAME_KIND && kind != CLASS_FQ_OR_PACKAGE_NAME_KIND) {
    VariableResolverProcessor processor=new VariableResolverProcessor(referenceElement);
    PsiScopesUtil.resolveAndWalk(processor,referenceElement,null,incompleteCode);
    result=processor.getResult();
    if (result.length == 0 && kind == CLASS_NAME_KIND) {
      result=referenceElement.resolve(PACKAGE_NAME_KIND);
    }
  }
  JavaResolveUtil.substituteResults((PsiJavaCodeReferenceElement)ref,result);
  return result;
}
