{
  if (t instanceof PsiArrayType) {
    PsiType normType=normalize(((PsiArrayType)t).getComponentType(),objectBottom);
    return normType == null ? null : normType.createArrayType();
  }
 else   if (t instanceof PsiClassType) {
    PsiClassType.ClassResolveResult result=resolveType(t);
    if (result == null) {
      return null;
    }
    PsiClass aclass=result.getElement();
    PsiSubstitutor subst=result.getSubstitutor();
    PsiManager manager=aclass.getManager();
    if (aclass.hasTypeParameters()) {
      PsiTypeParameter[] parms=getTypeParametersList(aclass);
      PsiSubstitutor newbst=PsiSubstitutor.EMPTY;
      boolean anyBottom=false;
      for (int i=0; i < parms.length; i++) {
        PsiType p=subst.substitute(parms[i]);
        if (p != null) {
          PsiType pp=normalize(p,objectBottom);
          if (pp == null) {
            return null;
          }
          if (pp == Bottom.BOTTOM || (objectBottom && pp.getCanonicalText().equals("java.lang.Object"))) {
            anyBottom=true;
          }
          newbst=newbst.put(parms[i],pp);
        }
 else {
          anyBottom=true;
        }
      }
      if (anyBottom || newbst == PsiSubstitutor.EMPTY) {
        newbst=manager.getElementFactory().createRawSubstitutor(aclass);
      }
      return manager.getElementFactory().createType(aclass,newbst);
    }
    return manager.getElementFactory().createType(aclass);
  }
 else {
    return t;
  }
}
