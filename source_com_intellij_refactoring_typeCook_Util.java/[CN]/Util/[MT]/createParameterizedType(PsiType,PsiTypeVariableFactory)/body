{
  if (t == null) {
    return factory.create();
  }
  if (t instanceof PsiClassType) {
    final PsiClassType.ClassResolveResult result=resolveType(t);
    final PsiSubstitutor aSubst=result.getSubstitutor();
    final PsiClass aClass=result.getElement();
    PsiSubstitutor theSubst=PsiSubstitutor.EMPTY;
    for (Iterator<PsiTypeParameter> i=aSubst.getSubstitutionMap().keySet().iterator(); i.hasNext(); ) {
      final PsiTypeParameter parm=i.next();
      theSubst=theSubst.put(parm,createParameterizedType(aSubst.substitute(parm),factory));
    }
    return aClass.getManager().getElementFactory().createType(aClass,theSubst);
  }
 else   if (t instanceof PsiArrayType) {
    return createParameterizedType(((PsiArrayType)t).getComponentType(),factory).createArrayType();
  }
  return t;
}
