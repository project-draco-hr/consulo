{
  if (t instanceof PsiClassType) {
    PsiClassType.ClassResolveResult result=resolveType(t);
    if (result == null) {
      return null;
    }
    PsiClass theClass=result.getElement();
    PsiSubstitutor theSubst=result.getSubstitutor();
    PsiManager theManager=theClass.getManager();
    PsiTypeParameter[] theParms=Util.getTypeParametersList(theClass);
    PsiSubstitutor subst=PsiSubstitutor.EMPTY;
    for (int i=0; i < theParms.length; i++) {
      PsiTypeParameter theParm=theParms[i];
      PsiType actualType=theSubst.substitute(theParm);
      if (actualType == null || actualType instanceof PsiWildcardType) {
        subst=subst.put(theParm,Bottom.BOTTOM);
      }
 else {
        PsiType banType=banalize(actualType);
        if (banType == null) {
          return null;
        }
        subst=subst.put(theParm,banType);
      }
    }
    return theManager.getElementFactory().createType(theClass,subst);
  }
  return t;
}
