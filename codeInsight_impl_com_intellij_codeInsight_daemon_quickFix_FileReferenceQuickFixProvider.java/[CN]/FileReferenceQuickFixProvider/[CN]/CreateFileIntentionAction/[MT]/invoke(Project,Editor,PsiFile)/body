{
  if (myIsdirectory) {
    myDirectory.createSubdirectory(myNewFileName);
  }
 else {
    final PsiFile newfile=myDirectory.createFile(myNewFileName);
    String text=null;
    if (myText != null) {
      final PsiManager psiManager=file.getManager();
      final PsiFile psiFile=psiManager.getElementFactory().createFileFromText("_" + myNewFileName,myText);
      final PsiElement psiElement=CodeStyleManager.getInstance(file.getProject()).reformat(psiFile);
      text=psiElement.getText();
    }
    final FileEditorManager editorManager=FileEditorManager.getInstance(myDirectory.getProject());
    final FileEditor[] fileEditors=editorManager.openFile(newfile.getVirtualFile(),true);
    if (text != null) {
      for (      FileEditor feditor : fileEditors) {
        if (feditor instanceof TextEditor) {
          final Document document=((TextEditor)feditor).getEditor().getDocument();
          document.setText(text);
          if (ApplicationManager.getApplication().isUnitTestMode()) {
            FileDocumentManager.getInstance().saveDocument(document);
          }
          PsiDocumentManager.getInstance(project).commitDocument(document);
          break;
        }
      }
    }
  }
}
