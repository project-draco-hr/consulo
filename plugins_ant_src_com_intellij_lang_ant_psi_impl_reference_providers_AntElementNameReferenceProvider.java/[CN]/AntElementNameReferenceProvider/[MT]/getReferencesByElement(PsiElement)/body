{
  if (!(element instanceof AntStructuredElement)) {
    return PsiReference.EMPTY_ARRAY;
  }
  final AntStructuredElement se=(AntStructuredElement)element;
  final AntElementNameReference nameReference=new AntElementNameReference(this,se);
  if (element instanceof AntTask) {
    final AntTask task=(AntTask)element;
    if (task.isMacroDefined()) {
      final XmlAttribute[] attrs=task.getSourceElement().getAttributes();
      if (attrs.length == 0) {
        return new PsiReference[]{nameReference};
      }
      List<PsiReference> result=new ArrayList<PsiReference>(attrs.length + 1);
      result.add(nameReference);
      for (      XmlAttribute attr : attrs) {
        result.add(new AntElementNameReference(this,task,attr));
      }
      return result.toArray(new PsiReference[result.size()]);
    }
  }
 else   if (se.isPresetDefined()) {
    return new PsiReference[]{nameReference};
  }
  final AntTask task=PsiTreeUtil.getParentOfType(element,AntTask.class);
  return (task != null && (task.isMacroDefined() || task.isPresetDefined())) ? new PsiReference[]{nameReference} : PsiReference.EMPTY_ARRAY;
}
