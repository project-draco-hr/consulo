{
  if (!(element instanceof AntStructuredElement)) {
    return PsiReference.EMPTY_ARRAY;
  }
  final AntStructuredElement se=(AntStructuredElement)element;
  final AntElementNameReference nameReference=new AntElementNameReference(se);
  if (element instanceof AntTask) {
    final AntTask task=(AntTask)element;
    if (task.isMacroDefined()) {
      final XmlAttribute[] attrs=task.getSourceElement().getAttributes();
      if (attrs.length == 0) {
        return new PsiReference[]{nameReference};
      }
      final List<PsiReference> result=PsiReferenceListSpinAllocator.alloc();
      try {
        result.add(nameReference);
        for (        XmlAttribute attr : attrs) {
          result.add(new AntElementNameReference(task,attr));
        }
        return result.toArray(new PsiReference[result.size()]);
      }
  finally {
        PsiReferenceListSpinAllocator.dispose(result);
      }
    }
  }
  return new PsiReference[]{nameReference};
}
