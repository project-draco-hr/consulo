import cgi, re, os, time, urllib, textwrap
import util, encoding
agescales = [('second', 1), ('minute', 60), ('hour', 3600), ('day', (3600 * 24)), ('week', ((3600 * 24) * 7)), ('month', ((3600 * 24) * 30)), ('year', ((3600 * 24) * 365))]
agescales.reverse()
para_re = None
space_re = None
_escapes = [('\\', '\\\\'), ('"', '\\"'), ('\t', '\\t'), ('\n', '\\n'), ('\r', '\\r'), ('\x0c', '\\f'), ('\x08', '\\b')]
filters = {'addbreaks': nl2br, 'basename': os.path.basename, 'stripdir': stripdir, 'age': age, 'date': (lambda x: util.datestr(x)), 'domain': domain, 'email': util.email, 'escape': (lambda x: cgi.escape(x, True)), 'fill68': (lambda x: fill(x, width=68)), 'fill76': (lambda x: fill(x, width=76)), 'firstline': firstline, 'tabindent': (lambda x: indent(x, '\t')), 'hgdate': (lambda x: ('%d %d' % x)), 'isodate': (lambda x: util.datestr(x, '%Y-%m-%d %H:%M %1%2')), 'isodatesec': (lambda x: util.datestr(x, '%Y-%m-%d %H:%M:%S %1%2')), 'json': json, 'jsonescape': jsonescape, 'localdate': (lambda x: (x[0], util.makedate()[1])), 'nonempty': nonempty, 'obfuscate': obfuscate, 'permissions': permissions, 'person': person, 'rfc822date': (lambda x: util.datestr(x, '%a, %d %b %Y %H:%M:%S %1%2')), 'rfc3339date': (lambda x: util.datestr(x, '%Y-%m-%dT%H:%M:%S%1:%2')), 'short': (lambda x: x[:12]), 'shortdate': util.shortdate, 'stringify': stringify, 'strip': (lambda x: x.strip()), 'urlescape': (lambda x: urllib.quote(x)), 'user': (lambda x: util.shortuser(x)), 'stringescape': (lambda x: x.encode('string_escape')), 'xmlescape': xmlescape, }
