{
  final ByteArrayOutputStream baos=new ByteArrayOutputStream();
  final StringBuilder remoteTitleBuilder=new StringBuilder();
  final Ref<Boolean> success=new Ref<Boolean>();
  ProgressManager.getInstance().runProcessWithProgressSynchronously(new Runnable(){
    public void run(){
      try {
        final ProgressIndicator indicator=ProgressManager.getInstance().getProgressIndicator();
        if (indicator != null) {
          indicator.setIndeterminate(true);
        }
        final SvnVcs vcs=SvnVcs.getInstance(myProject);
        SVNURL svnurl=getURLInBranch(vcs,baseUrl);
        if (svnurl == null) {
          reportNotFound(baseUrl);
          return;
        }
        remoteTitleBuilder.append(svnurl.toString());
        SVNWCClient client=vcs.createWCClient();
        client.doGetFileContents(svnurl,SVNRevision.UNDEFINED,SVNRevision.HEAD,true,baos);
        success.set(true);
      }
 catch (      SVNException ex) {
        reportException(ex,baseUrl);
      }
    }
  }
,SvnBundle.message("compare.with.branch.progress.loading.content"),true,myProject);
  if (success.isNull()) {
    return;
  }
  SimpleDiffRequest req=new SimpleDiffRequest(myProject,SvnBundle.message("compare.with.branch.diff.title"));
  req.setContents(new SimpleContent(CharsetToolkit.bytesToString(baos.toByteArray(),myVirtualFile.getCharset())),new FileContent(myProject,myVirtualFile));
  req.setContentTitles(remoteTitleBuilder.toString(),myVirtualFile.getPresentableUrl());
  DiffManager.getInstance().getDiffTool().show(req);
}
