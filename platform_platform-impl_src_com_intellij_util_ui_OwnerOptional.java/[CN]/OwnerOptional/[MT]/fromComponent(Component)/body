{
  Window owner=findOwnerByComponent(parentComponent);
  IdePopupManager manager=IdeEventQueue.getInstance().getPopupManager();
  if (manager.isPopupWindow(owner)) {
    manager.closeAllPopups();
    owner=owner.getOwner();
    while (owner != null && !(owner instanceof Dialog) && !(owner instanceof Frame)) {
      owner=owner.getOwner();
    }
  }
  if (owner instanceof Dialog) {
    Dialog ownerDialog=(Dialog)owner;
    if (ownerDialog.isModal()) {
      owner=ownerDialog;
    }
 else {
      while (owner instanceof Dialog && !((Dialog)owner).isModal()) {
        owner=owner.getOwner();
      }
    }
  }
  while (owner != null && !owner.isShowing()) {
    owner=owner.getOwner();
  }
  return new OwnerOptional(owner);
}
