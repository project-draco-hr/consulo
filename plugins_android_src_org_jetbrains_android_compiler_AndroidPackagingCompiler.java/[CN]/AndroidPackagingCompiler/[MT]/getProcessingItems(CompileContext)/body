{
  final List<ProcessingItem> items=new ArrayList<ProcessingItem>();
  for (  Module module : ModuleManager.getInstance(context.getProject()).getModules()) {
    AndroidFacet facet=AndroidFacet.getInstance(module);
    if (facet != null && !facet.getConfiguration().LIBRARY_PROJECT) {
      VirtualFile manifestFile=AndroidRootUtil.getManifestFileForCompiler(facet);
      VirtualFile[] sourceRoots=getSourceRootsForModuleAndDependencies(module,facet.getConfiguration().PACK_TEST_CODE);
      if (manifestFile != null) {
        AndroidFacetConfiguration configuration=facet.getConfiguration();
        VirtualFile outputDir=AndroidDexCompiler.getOutputDirectoryForDex(module);
        if (outputDir != null) {
          VirtualFile[] externalJars=getExternalJars(module,configuration);
          File resPackage=AndroidResourcesPackagingCompiler.getOutputFile(module,outputDir);
          String resPackagePath=FileUtil.toSystemDependentName(resPackage.getPath());
          File classesDexFile=new File(outputDir.getPath(),AndroidCommonUtils.CLASSES_FILE_NAME);
          String classesDexPath=FileUtil.toSystemDependentName(classesDexFile.getPath());
          AndroidPlatform platform=configuration.getAndroidPlatform();
          if (platform == null) {
            context.addMessage(CompilerMessageCategory.ERROR,AndroidBundle.message("android.compilation.error.specify.platform",module.getName()),null,-1,-1);
            continue;
          }
          String sdkPath=platform.getSdkData().getLocation();
          String outputPath=AndroidRootUtil.getApkPath(facet);
          if (outputPath == null) {
            context.addMessage(CompilerMessageCategory.ERROR,AndroidBundle.message("android.compilation.error.apk.path.not.specified",module.getName()),null,-1,-1);
            continue;
          }
          final String keystorePath=FileUtil.toSystemDependentName(VfsUtil.urlToPath(configuration.CUSTOM_DEBUG_KEYSTORE_PATH));
          items.add(createItem(module,facet,manifestFile,sourceRoots,externalJars,resPackagePath,classesDexPath,sdkPath,outputPath,false,AndroidCompileUtil.isReleaseBuild(context),keystorePath));
        }
      }
    }
  }
  return items.toArray(new ProcessingItem[items.size()]);
}
