{
  if (!shouldGenerateApk(item.myModule,context,unsigned)) {
    return;
  }
  try {
    final String[] externalLibPaths=getPaths(item.getExternalLibraries());
    final String resPackagePath=unsigned ? item.getResPackagePath() + AndroidResourcesPackagingCompiler.RELEASE_SUFFIX : item.getResPackagePath();
    final String finalPath=unsigned ? item.getFinalPath() + UNSIGNED_SUFFIX : item.getFinalPath();
    final Map<CompilerMessageCategory,List<String>> messages=AndroidApkBuilder.execute(context.getProject(),resPackagePath,item.getClassesDexPath(),item.getSourceRoots(),externalLibPaths,item.getNativeLibsFolders(),finalPath,unsigned,item.mySdkPath,item.getCustomKeystorePath());
    AndroidCompileUtil.addMessages(context,messages);
  }
 catch (  final IOException e) {
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      public void run(){
        if (context.getProject().isDisposed())         return;
        context.addMessage(CompilerMessageCategory.ERROR,e.getMessage(),null,-1,-1);
      }
    }
);
  }
}
