def process(self, t, map):
    'Perform expansion. t is name of map element to expand. map contains\n        added elements for use during expansion. Is a generator.'
    tmpl = self.loader(t)
    iters = [self._process(tmpl, map)]
    while iters:
        try:
            item = iters[0].next()
        except StopIteration:
            iters.pop(0)
            continue
        if isinstance(item, str):
            yield item
        elif (item is None):
            yield ''
        elif hasattr(item, '__iter__'):
            iters.insert(0, iter(item))
        else:
            yield str(item)
