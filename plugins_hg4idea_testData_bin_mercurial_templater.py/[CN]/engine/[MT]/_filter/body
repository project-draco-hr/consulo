def _filter(self, expr, get, map):
    if (expr not in self.cache):
        parts = expr.split('|')
        val = parts[0]
        try:
            filters = [self.filters[f] for f in parts[1:]]
        except KeyError as i:
            raise SyntaxError((_("unknown filter '%s'") % i[0]))

        def apply(get):
            x = get(val)
            for f in filters:
                x = f(x)
            return x
        self.cache[expr] = apply
    return self.cache[expr](get)
