{
  DfaValue result=null;
  if (psiExpression instanceof PsiReferenceExpression) {
    PsiElement psiSource=((PsiReferenceExpression)psiExpression).resolve();
    if (psiSource != null) {
      if (psiSource instanceof PsiVariable) {
        final PsiVariable variable=(PsiVariable)psiSource;
        DfaValue constValue=getConstFactory().create(variable);
        if (constValue != null)         return constValue;
        PsiExpression initializer=variable.getInitializer();
        if (initializer instanceof PsiBinaryExpression && variable.hasModifierProperty(PsiModifier.FINAL)) {
          PsiType type=initializer.getType();
          if (type != null && type.equalsToText("java.lang.String")) {
            return getNotNullFactory().create(type);
          }
        }
      }
      PsiVariable psiVariable=resolveVariable((PsiReferenceExpression)psiExpression);
      if (psiVariable != null) {
        result=getVarFactory().create(psiVariable,false);
      }
    }
  }
 else   if (psiExpression instanceof PsiLiteralExpression) {
    final PsiLiteralExpression literal=(PsiLiteralExpression)psiExpression;
    if (literal.getValue() instanceof String) {
      result=getNotNullFactory().create(psiExpression.getType());
    }
 else {
      result=getConstFactory().create(literal);
    }
  }
 else   if (psiExpression instanceof PsiNewExpression) {
    result=getNotNullFactory().create(psiExpression.getType());
  }
 else {
    final Object value=ConstantExpressionEvaluator.computeConstantExpression(psiExpression,new THashSet<PsiVariable>(),false);
    if (value != null) {
      if (value instanceof String) {
        result=getNotNullFactory().create(psiExpression.getType());
      }
 else {
        result=getConstFactory().createFromValue(value,psiExpression.getType());
      }
    }
  }
  return result;
}
