{
  DfaValue result=null;
  if (psiExpression instanceof PsiReferenceExpression) {
    PsiElement psiSource=((PsiReferenceExpression)psiExpression).resolve();
    if (psiSource != null) {
      if (psiSource instanceof PsiVariable) {
        final PsiVariable variable=(PsiVariable)psiSource;
        DfaValue constValue=getConstFactory().create(variable);
        if (constValue != null)         return constValue;
        if (variable.getInitializer() instanceof PsiBinaryExpression && variable.hasModifierProperty(PsiModifier.FINAL)) {
          PsiType type=variable.getInitializer().getType();
          if (type.equalsToText("java.lang.String")) {
            return getNotNullFactory().create(type);
          }
        }
      }
      PsiVariable psiVariable=resolveVariable((PsiReferenceExpression)psiExpression);
      if (psiVariable != null) {
        result=getVarFactory().create(psiVariable,false);
      }
    }
  }
 else   if (psiExpression instanceof PsiLiteralExpression) {
    result=getConstFactory().create((PsiLiteralExpression)psiExpression);
  }
 else   if (psiExpression instanceof PsiNewExpression) {
    result=getNotNullFactory().create(psiExpression.getType());
  }
 else {
    final Object value=ConstantExpressionEvaluator.computeConstantExpression(psiExpression,new THashSet<PsiVariable>(),false);
    if (value != null) {
      result=getConstFactory().createFromValue(value,psiExpression.getType());
    }
  }
  return result;
}
