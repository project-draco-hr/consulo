{
  IRuleInstance hri=new HeaderRule().createRuleInstance();
  resultRuleInstances.add(hri);
  prioritizedRuleInstances.add(hri);
  for (  IRule rule : rules) {
    IRuleInstance instance=rule.createRuleInstance();
    resultRuleInstances.add(instance);
    boolean inserted=false;
    for (int i=prioritizedRuleInstances.size() - 1; i >= 0; i--) {
      IRuleInstance entry=(prioritizedRuleInstances.get(i));
      if (rule.getPriority() <= entry.getRule().getPriority()) {
        prioritizedRuleInstances.add(i + 1,instance);
        inserted=true;
        break;
      }
    }
    if (!inserted) {
      prioritizedRuleInstances.add(0,instance);
    }
  }
  IRuleInstance defaultRuleInstance=new DefaultRule().createRuleInstance();
  resultRuleInstances.add(defaultRuleInstance);
  prioritizedRuleInstances.add(defaultRuleInstance);
  IRuleInstance tri=new TrailerRule().createRuleInstance();
  resultRuleInstances.add(tri);
  prioritizedRuleInstances.add(tri);
}
