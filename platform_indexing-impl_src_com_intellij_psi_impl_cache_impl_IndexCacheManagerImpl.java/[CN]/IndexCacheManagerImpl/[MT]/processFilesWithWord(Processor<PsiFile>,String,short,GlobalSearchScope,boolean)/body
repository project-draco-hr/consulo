{
  final List<VirtualFile> vFiles=new ArrayList<VirtualFile>(5);
  collectVirtualFilesWithWord(new CommonProcessors.CollectProcessor<VirtualFile>(vFiles),word,occurrenceMask,scope,caseSensitively);
  if (vFiles.isEmpty())   return true;
  final Processor<VirtualFile> virtualFileProcessor=new ReadActionProcessor<VirtualFile>(){
    @RequiredReadAction @Override public boolean processInReadAction(    VirtualFile virtualFile){
      if (virtualFile.isValid()) {
        final PsiFile psiFile=myPsiManager.findFile(virtualFile);
        return psiFile == null || psiFileProcessor.process(psiFile);
      }
      return true;
    }
  }
;
  for (  VirtualFile vFile : vFiles) {
    ProgressIndicatorProvider.checkCanceled();
    if (!virtualFileProcessor.process(vFile)) {
      return false;
    }
  }
  return true;
}
