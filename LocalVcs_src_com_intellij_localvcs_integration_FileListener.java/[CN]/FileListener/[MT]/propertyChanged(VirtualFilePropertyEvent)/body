{
  if (!e.getPropertyName().equals(VirtualFile.PROP_NAME))   return;
  VirtualFile newFile=e.getFile();
  VirtualFile oldFile=new RenamedVirtualFile(e.getFile(),(String)e.getOldValue());
  boolean wasInContent=myVcs.hasEntry(oldFile.getPath());
  if (notAllowedOrNotUnderContentRoot(newFile)) {
    if (wasInContent)     getState().delete(oldFile);
    return;
  }
  if (!wasInContent) {
    getState().create(newFile);
    return;
  }
  getState().rename(oldFile,e.getFile().getName());
}
