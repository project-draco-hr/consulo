{
  if (context.getExpression() == null)   return;
  final GrExpression expression=context.getExpression();
  final PsiElement _scope=context.getScope();
  final PsiElement scope=_scope instanceof GroovyScriptClass ? _scope.getContainingFile() : _scope;
  final GrMethod method=getContainingMethod(expression,scope);
  LOG.assertTrue(method != null);
  final GrStatement anchor;
  if (settings.removeLocalVar()) {
    GrVariable variable=resolveLocalVar(context);
    anchor=PsiTreeUtil.getParentOfType(variable,GrStatement.class);
  }
 else {
    anchor=(GrStatement)findAnchor(context,settings,context.getOccurrences(),method.getBlock());
  }
  generateAssignment(context,settings,field,anchor,method.getBlock());
}
