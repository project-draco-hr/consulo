{
  int len=value.length();
  if (len < STRING_LENGTH_THRESHOLD && isAscii(value)) {
    buffer[0]=(byte)len;
    for (int i=0; i < len; i++) {
      buffer[i + STRING_HEADER_SIZE]=(byte)value.charAt(i);
    }
    storage.write(buffer,0,len + STRING_HEADER_SIZE);
  }
 else {
    storage.writeByte((byte)0xFF);
    try {
      storage.writeUTF(value);
    }
 catch (    UTFDataFormatException e) {
      storage.writeUTF(LONGER_THAN_64K_MARKER);
      writeString(value,storage);
    }
  }
}
