{
  SearchScope customScope=findModel.getCustomScope();
  VirtualFile directory=getDirectory(findModel);
  Module module=findModel.getModuleName() == null ? null : ModuleManager.getInstance(project).findModuleByName(findModel.getModuleName());
  return findModel.isCustomScope() && customScope != null ? customScope.intersectWith(GlobalSearchScope.allScope(project)) : directory != null ? forDirectory(project,findModel.isWithSubdirectories(),directory) : module != null ? module.getModuleContentScope() : findModel.isProjectScope() ? ProjectScope.getContentScope(project) : GlobalSearchScope.allScope(project);
}
