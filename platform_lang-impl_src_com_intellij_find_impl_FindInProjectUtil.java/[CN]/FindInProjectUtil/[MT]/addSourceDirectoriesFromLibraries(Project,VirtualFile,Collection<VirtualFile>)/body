{
  ProjectFileIndex index=ProjectFileIndex.SERVICE.getInstance(project);
  if (index.isInLibrarySource(file))   return;
  VirtualFile classRoot=index.getClassRootForFile(file);
  if (classRoot == null)   return;
  String relativePath=VfsUtilCore.getRelativePath(file,classRoot);
  if (relativePath == null)   return;
  for (  OrderEntry orderEntry : index.getOrderEntriesForFile(file)) {
    for (    VirtualFile sourceRoot : orderEntry.getFiles(OrderRootType.SOURCES)) {
      VirtualFile sourceFile=sourceRoot.findFileByRelativePath(relativePath);
      if (sourceFile != null) {
        outSourceRoots.add(sourceFile);
      }
    }
  }
}
