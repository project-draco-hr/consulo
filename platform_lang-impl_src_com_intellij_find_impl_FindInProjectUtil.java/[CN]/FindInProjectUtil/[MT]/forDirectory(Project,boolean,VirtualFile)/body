{
  Set<VirtualFile> result=new LinkedHashSet<VirtualFile>();
  result.add(directory);
  addSourceDirectoriesFromLibraries(project,directory,result);
  VirtualFile[] array=result.toArray(new VirtualFile[result.size()]);
  return GlobalSearchScopesCore.directoriesScope(project,withSubdirectories,array);
}
