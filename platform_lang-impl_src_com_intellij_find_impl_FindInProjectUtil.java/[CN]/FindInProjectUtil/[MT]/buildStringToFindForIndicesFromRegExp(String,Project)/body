{
  if (!Registry.is("idea.regexp.search.uses.indices"))   return "";
  final AccessToken accessToken=ReadAction.start();
  try {
    final List<PsiElement> topLevelRegExpChars=getTopLevelRegExpChars("a",project);
    if (topLevelRegExpChars.size() != 1)     return "";
    return StringUtil.join(getTopLevelRegExpChars(stringToFind,project),new Function<PsiElement,String>(){
      final Class regExpCharPsiClass=topLevelRegExpChars.get(0).getClass();
      @Override public String fun(      PsiElement element){
        return regExpCharPsiClass.isInstance(element) ? element.getText() : " ";
      }
    }
,"");
  }
  finally {
    accessToken.finish();
  }
}
