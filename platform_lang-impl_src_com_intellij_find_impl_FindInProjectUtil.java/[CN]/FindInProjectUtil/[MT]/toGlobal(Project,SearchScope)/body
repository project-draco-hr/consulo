{
  if (scope instanceof GlobalSearchScope || scope == null) {
    return (GlobalSearchScope)scope;
  }
  return ApplicationManager.getApplication().runReadAction(new Computable<GlobalSearchScope>(){
    @Override public GlobalSearchScope compute(){
      return GlobalSearchScope.filesScope(project,getLocalScopeFiles((LocalSearchScope)scope));
    }
  }
);
}
