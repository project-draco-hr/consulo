{
  if (scope instanceof GlobalSearchScope || scope == null) {
    return (GlobalSearchScope)scope;
  }
  Set<VirtualFile> files=new HashSet<VirtualFile>();
  for (  PsiElement element : ((LocalSearchScope)scope).getScope()) {
    PsiFile file=element.getContainingFile();
    if (file != null) {
      ContainerUtil.addIfNotNull(files,file.getVirtualFile());
    }
  }
  return GlobalSearchScope.filesScope(project,files);
}
