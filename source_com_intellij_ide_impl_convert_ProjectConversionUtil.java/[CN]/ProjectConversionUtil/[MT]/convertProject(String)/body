{
  try {
    final Element root=loadProjectFileRoot(projectFilePath);
    final Element versionComponent=JDomConvertingUtil.findComponent(root,ProjectFileVersionImpl.COMPONENT_NAME);
    if (versionComponent != null && isConverted(versionComponent)) {
      return ProjectConversionResult.OK;
    }
    final ProjectConverter converter=getConverter(projectFilePath);
    if (converter == null) {
      return ProjectConversionResult.OK;
    }
    converter.prepare();
    if (!converter.isConversionNeeded()) {
      return ProjectConversionResult.OK;
    }
    if (versionComponent != null) {
      LOG.assertTrue(!isConverted(versionComponent));
      return new ProjectConversionResult(converter.createHelper());
    }
    String projectName=FileUtil.getNameWithoutExtension(new File(projectFilePath));
    ProjectConversionWizard wizard=new ProjectConversionWizard(converter,projectName);
    wizard.show();
    if (!wizard.isOK()) {
      return ProjectConversionResult.DO_NOT_OPEN;
    }
    if (wizard.isConverted()) {
      return ProjectConversionResult.OK;
    }
    return new ProjectConversionResult(converter.createHelper());
  }
 catch (  IOException e) {
    Messages.showErrorDialog(IdeBundle.message("error.cannot.load.project",e.getMessage()),IdeBundle.message("title.cannot.convert.project"));
    return ProjectConversionResult.DO_NOT_OPEN;
  }
catch (  QualifiedJDomException e) {
    LOG.info(e);
    Messages.showErrorDialog(IdeBundle.message("error.some.file.is.corrupted.message",e.getFilePath(),e.getCause().getMessage()),IdeBundle.message("title.cannot.convert.project"));
    return ProjectConversionResult.DO_NOT_OPEN;
  }
}
