{
  RenamePsiElementProcessor processor=RenamePsiElementProcessor.forElement(element);
  PsiElement substituted=processor.substituteElementToRename(element,editor);
  if (substituted == null || !canRename(project,editor,substituted))   return;
  RenameDialog dialog=processor.createRenameDialog(project,substituted,nameSuggestionContext,editor);
  if (defaultName == null && ApplicationManager.getApplication().isUnitTestMode()) {
    String[] strings=dialog.getSuggestedNames();
    if (strings != null && strings.length > 0) {
      Arrays.sort(strings);
      defaultName=strings[0];
    }
 else {
      defaultName="undefined";
    }
  }
  if (defaultName != null) {
    try {
      dialog.performRename(defaultName);
    }
  finally {
      dialog.close(DialogWrapper.CANCEL_EXIT_CODE);
    }
  }
 else {
    dialog.show();
  }
}
