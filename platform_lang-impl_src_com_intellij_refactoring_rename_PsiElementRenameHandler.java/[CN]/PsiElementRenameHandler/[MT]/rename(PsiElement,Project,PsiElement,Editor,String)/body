{
  RenamePsiElementProcessor processor=RenamePsiElementProcessor.forElement(element);
  element=processor.substituteElementToRename(element,editor);
  if (element == null)   return;
  final RenameDialog dialog=processor.createRenameDialog(project,element,nameSuggestionContext,editor);
  if (defaultName == null && ApplicationManager.getApplication().isUnitTestMode()) {
    String[] strings=dialog.getSuggestedNames();
    if (strings != null && strings.length > 0) {
      Arrays.sort(strings);
      defaultName=strings[0];
    }
 else {
      defaultName="undefined";
    }
  }
  if (defaultName != null) {
    try {
      dialog.performRename(defaultName);
    }
 catch (    CommonRefactoringUtil.RefactoringErrorHintException testErrorHintException) {
      dialog.close(DialogWrapper.CANCEL_EXIT_CODE);
      throw testErrorHintException;
    }
  }
 else {
    dialog.show();
  }
}
