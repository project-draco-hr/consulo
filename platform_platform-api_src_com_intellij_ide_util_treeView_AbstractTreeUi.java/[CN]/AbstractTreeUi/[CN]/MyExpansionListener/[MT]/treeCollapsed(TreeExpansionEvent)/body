{
  dropUpdaterStateIfExternalChange();
  final TreePath path=e.getPath();
  final DefaultMutableTreeNode node=(DefaultMutableTreeNode)path.getLastPathComponent();
  if (!(node.getUserObject() instanceof NodeDescriptor))   return;
  TreePath pathToSelect=null;
  if (isSelectionInside(node)) {
    pathToSelect=new TreePath(node.getPath());
  }
  NodeDescriptor descriptor=getDescriptorFrom(node);
  if (getBuilder().isDisposeOnCollapsing(descriptor)) {
    runDone(new Runnable(){
      public void run(){
        if (isDisposed(node))         return;
        TreePath nodePath=new TreePath(node.getPath());
        if (myTree.isExpanded(nodePath))         return;
        removeChildren(node);
        makeLoadingOrLeafIfNoChildren(node);
      }
    }
);
    if (node.equals(getRootNode())) {
      if (myTree.isRootVisible()) {
      }
    }
 else {
      myTreeModel.reload(node);
    }
  }
  if (pathToSelect != null && myTree.isSelectionEmpty()) {
    addSelectionPath(pathToSelect,true,Condition.FALSE,null);
  }
}
