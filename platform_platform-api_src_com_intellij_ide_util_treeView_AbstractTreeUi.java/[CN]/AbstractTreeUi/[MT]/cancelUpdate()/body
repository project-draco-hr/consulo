{
  if (isReleased())   return new ActionCallback.Rejected();
  setCancelRequested(true);
  Log.print("cancelUpdate requested isReleased=" + isReleased() + " cancelProcessed="+ isCancelProcessed());
  final ActionCallback done=new ActionCallback();
  invokeLaterIfNeeded(new Runnable(){
    public void run(){
      if (isReleased()) {
        done.setRejected();
        return;
      }
      if (myResettingToReadyNow.get()) {
        Log.print("1");
        getReady(this).notify(done);
      }
 else       if (isReady()) {
        Log.print("2");
        resetToReadyNow();
        done.setDone();
      }
 else {
        if (isIdle() && hasPendingWork()) {
          Log.print("3");
          resetToReadyNow();
          done.setDone();
        }
 else {
          Log.print("4 cancelProcessed=" + isCancelProcessed());
          getReady(this).notify(done);
        }
      }
      maybeReady();
    }
  }
);
  if (isEdt() || isPassthroughMode()) {
    maybeReady();
  }
  return done;
}
