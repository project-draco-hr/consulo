{
  if (isReleased())   return new ActionCallback.Rejected();
  setCancelRequested(true);
  final ActionCallback done=new ActionCallback();
  final Runnable cancelUpdate=new Runnable(){
    public void run(){
      if (isReleased()) {
        done.setRejected();
        return;
      }
      if (myResettingToReadyNow.get()) {
        _getReady().notify(done);
      }
 else       if (isReady()) {
        resetToReadyNow();
        done.setDone();
      }
 else {
        if (isIdle() && hasPendingWork()) {
          resetToReadyNow();
          done.setDone();
        }
 else {
          _getReady().notify(done);
        }
      }
      maybeReady();
    }
  }
;
  if (ApplicationManager.getApplication().isUnitTestMode() && isEdt()) {
    cancelUpdate.run();
  }
 else {
    invokeLaterIfNeeded(cancelUpdate,false);
  }
  if (isEdt() || isPassthroughMode()) {
    maybeReady();
  }
  return done;
}
