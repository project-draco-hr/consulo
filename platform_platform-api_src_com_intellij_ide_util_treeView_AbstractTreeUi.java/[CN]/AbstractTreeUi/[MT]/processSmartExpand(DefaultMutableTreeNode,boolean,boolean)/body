{
  if (!getBuilder().isSmartExpand())   return;
  boolean can=canSmartExpand(node,canSmartExpand);
  if (!can && !forced)   return;
  if (isNodeBeingBuilt(node) && !forced) {
    addNodeAction(getElementFor(node),new NodeAction(){
      public void onReady(      DefaultMutableTreeNode node){
        processSmartExpand(node,canSmartExpand,true);
      }
    }
,true);
  }
 else {
    TreeNode child=getChildForSmartExpand(node);
    if (child != null) {
      final TreePath childPath=new TreePath(node.getPath()).pathByAddingChild(child);
      processInnerChange(new Runnable(){
        public void run(){
          myTree.expandPath(childPath);
        }
      }
);
    }
  }
}
