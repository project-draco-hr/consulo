{
  DefaultMutableTreeNode parent=getParentLoading(node);
  if (parent != null)   return parent;
  if (isLoadingParent(node))   return (DefaultMutableTreeNode)node;
  DefaultMutableTreeNode treeNode=(DefaultMutableTreeNode)node;
  final boolean childrenAreNoLoadedYet=myUnbuiltNodes.contains(treeNode) || isUpdatingNow(treeNode);
  if (childrenAreNoLoadedYet) {
    if (node instanceof DefaultMutableTreeNode) {
      final TreePath nodePath=new TreePath(((DefaultMutableTreeNode)node).getPath());
      if (!myTree.isExpanded(nodePath))       return null;
    }
    return (DefaultMutableTreeNode)node;
  }
  return null;
}
