{
  final boolean[] hasNoChildren=new boolean[1];
  final NodeDescriptor descriptor=(NodeDescriptor)node.getUserObject();
  if (!getBuilder().isAlwaysShowPlus(descriptor)) {
    Runnable updateRunnable=new Runnable(){
      public void run(){
        if (isReleased())         return;
        if (hasNoChildren[0]) {
          update(descriptor,false);
          removeLoading(node,false);
        }
      }
    }
;
    if (istToBuildInBackground(descriptor)) {
      Runnable buildRunnable=new Runnable(){
        public void run(){
          if (isReleased())           return;
          update(descriptor,true);
          Object element=getBuilder().getTreeStructureElement(descriptor);
          if (element == null && !isValid(element))           return;
          Object[] children=getChildrenFor(element);
          hasNoChildren[0]=children.length == 0;
        }
      }
;
      addTaskToWorker(buildRunnable,false,updateRunnable,new Runnable(){
        public void run(){
          processNodeActionsIfReady(node);
        }
      }
);
    }
 else {
      Object[] children=getChildrenFor(getBuilder().getTreeStructureElement(descriptor));
      if (children.length == 0)       return;
    }
  }
  insertLoadingNode(node,true);
}
