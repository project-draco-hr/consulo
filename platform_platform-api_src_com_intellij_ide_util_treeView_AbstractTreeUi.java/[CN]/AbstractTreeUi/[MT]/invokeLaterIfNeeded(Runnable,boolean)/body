{
  final ActionCallback result=new ActionCallback();
  Runnable actual=new Runnable(){
    public void run(){
      if (isReleased()) {
        result.setRejected();
      }
 else {
        runnable.run();
        result.setDone();
      }
    }
  }
;
  if (forceEdt) {
    UIUtil.invokeLaterIfNeeded(actual);
  }
 else {
    if (isPassthroughMode() || !isEdt() && !isTreeShowing() && !myWasEverShown) {
      actual.run();
    }
 else {
      UIUtil.invokeLaterIfNeeded(actual);
    }
  }
  return result;
}
