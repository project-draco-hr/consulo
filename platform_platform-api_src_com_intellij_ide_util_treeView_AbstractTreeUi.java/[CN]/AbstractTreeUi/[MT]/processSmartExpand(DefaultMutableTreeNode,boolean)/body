{
  if (!getBuilder().isSmartExpand() || !canSmartExpand(node,canSmartExpand))   return;
  if (isNodeBeingBuilt(node)) {
    addNodeAction(getElementFor(node),new NodeAction(){
      public void onReady(      DefaultMutableTreeNode node){
        processSmartExpand(node,canSmartExpand);
      }
    }
,true);
  }
 else {
    TreeNode child=getChildForSmartExpand(node);
    if (child != null) {
      final TreePath childPath=new TreePath(node.getPath()).pathByAddingChild(child);
      myTree.expandPath(childPath);
    }
  }
}
