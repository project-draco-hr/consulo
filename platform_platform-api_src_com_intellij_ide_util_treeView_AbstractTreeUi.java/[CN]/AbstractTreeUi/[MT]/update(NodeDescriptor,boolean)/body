{
  final AsyncResult<Boolean> result=new AsyncResult<Boolean>();
  if (now || isPassthroughMode()) {
    result.setDone(_update(nodeDescriptor));
  }
 else {
    Object element=getElementFromDescriptor(nodeDescriptor);
    boolean bgLoading=getTreeStructure().isToBuildChildrenInBackground(element);
    boolean edt=isEdt();
    if (bgLoading) {
      if (edt) {
        final Ref<Boolean> changes=new Ref<Boolean>(false);
        queueToBackground(new Runnable(){
          public void run(){
            changes.set(_update(nodeDescriptor));
          }
        }
,new Runnable(){
          public void run(){
            result.setDone(changes.get());
          }
        }
,nodeDescriptor);
      }
 else {
        result.setDone(_update(nodeDescriptor));
      }
    }
 else {
      if (edt || !myWasEverShown) {
        result.setDone(_update(nodeDescriptor));
      }
 else {
        invokeLaterIfNeeded(new Runnable(){
          public void run(){
            execute(new Runnable(){
              public void run(){
                result.setDone(_update(nodeDescriptor));
              }
            }
);
          }
        }
,false);
      }
    }
  }
  result.doWhenDone(new AsyncResult.Handler<Boolean>(){
    public void run(    final Boolean changes){
      if (changes) {
        final long updateStamp=nodeDescriptor.getUpdateCount();
        invokeLaterIfNeeded(new Runnable(){
          public void run(){
            Object element=nodeDescriptor.getElement();
            DefaultMutableTreeNode node=getNodeForElement(element,false);
            if (node != null) {
              TreePath path=getPathFor(node);
              if (path != null && myTree.isVisible(path)) {
                updateNodeImageAndPosition(node,false,changes);
              }
            }
          }
        }
,false);
      }
    }
  }
);
  return result;
}
