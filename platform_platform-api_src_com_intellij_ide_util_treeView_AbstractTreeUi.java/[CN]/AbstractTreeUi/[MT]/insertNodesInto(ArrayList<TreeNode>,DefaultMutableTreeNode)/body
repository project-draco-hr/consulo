{
  sortChildren(parentNode,toInsert,false,false);
  final ArrayList<TreeNode> all=new ArrayList<TreeNode>(toInsert.size() + parentNode.getChildCount());
  all.addAll(toInsert);
  all.addAll(TreeUtil.childrenToArray(parentNode));
  if (toInsert.size() > 0) {
    sortChildren(parentNode,all,true,true);
    int[] newNodeIndices=new int[toInsert.size()];
    int eachNewNodeIndex=0;
    for (int i=0; i < toInsert.size(); i++) {
      TreeNode eachNewNode=toInsert.get(i);
      while (all.get(eachNewNodeIndex) != eachNewNode)       eachNewNodeIndex++;
      newNodeIndices[i]=eachNewNodeIndex;
      parentNode.insert((MutableTreeNode)eachNewNode,eachNewNodeIndex);
    }
    myTreeModel.nodesWereInserted(parentNode,newNodeIndices);
  }
 else {
    ArrayList<TreeNode> before=new ArrayList<TreeNode>();
    before.addAll(all);
    sortChildren(parentNode,all,true,false);
    if (!before.equals(all)) {
      doWithUpdaterState(new Runnable(){
        public void run(){
          parentNode.removeAllChildren();
          for (          TreeNode each : all) {
            parentNode.add((MutableTreeNode)each);
          }
          myTreeModel.nodeStructureChanged(parentNode);
        }
      }
);
    }
  }
}
