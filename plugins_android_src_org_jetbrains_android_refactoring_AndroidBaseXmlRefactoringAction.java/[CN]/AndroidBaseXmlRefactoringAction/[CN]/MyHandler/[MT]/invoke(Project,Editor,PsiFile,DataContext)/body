{
  if (myTagsFromExternalContext.length > 0) {
    doRefactorForTags(project,myTagsFromExternalContext);
    return;
  }
  final TextRange range=getNonEmptySelectionRange(editor);
  if (range != null) {
    final Pair<PsiElement,PsiElement> psiRange=getExtractableRange(file,range.getStartOffset(),range.getEndOffset());
    if (psiRange != null) {
      doRefactorForPsiRange(project,file,psiRange.getFirst(),psiRange.getSecond());
    }
    return;
  }
  final PsiElement element=getElementAtCaret(editor,file);
  if (element == null) {
    return;
  }
  final XmlTag tag=PsiTreeUtil.getParentOfType(element,XmlTag.class);
  if (tag == null) {
    return;
  }
  doRefactorForTags(project,new XmlTag[]{tag});
}
