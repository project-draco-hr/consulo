{
  if (refWhat != null) {
    if (refWhat instanceof RefParameter) {
      if (forWriting) {
        ((RefParameter)refWhat).parameterReferenced(true);
      }
      if (forReading) {
        ((RefParameter)refWhat).parameterReferenced(false);
      }
    }
    addOutReference(refWhat);
    ((RefJavaElementImpl)refWhat).markReferenced(this,psiFrom,psiWhat,forWriting,forReading,expression);
  }
 else {
    if (psiWhat instanceof PsiMethod) {
      final PsiClass containingClass=((PsiMethod)psiWhat).getContainingClass();
      if (containingClass != null && containingClass.isEnum() && "values".equals(((PsiMethod)psiWhat).getName())) {
        for (        PsiField enumConstant : containingClass.getFields()) {
          if (enumConstant instanceof PsiEnumConstant) {
            final RefJavaElementImpl enumConstantReference=(RefJavaElementImpl)getRefManager().getReference(enumConstant);
            if (enumConstantReference != null) {
              addOutReference(enumConstantReference);
              enumConstantReference.markReferenced(this,psiFrom,enumConstant,false,true,expression);
            }
          }
        }
      }
    }
  }
}
