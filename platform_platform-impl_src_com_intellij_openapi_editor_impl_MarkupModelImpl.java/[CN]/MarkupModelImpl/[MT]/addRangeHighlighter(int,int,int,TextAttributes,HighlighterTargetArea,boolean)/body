{
  RangeHighlighterEx segmentHighlighter=isPersistent ? new PersistentRangeHighlighterImpl(this,startOffset,layer,targetArea,textAttributes) : new RangeHighlighterImpl(this,startOffset,endOffset,layer,targetArea,textAttributes);
  RangeMarkerImpl marker=(RangeMarkerImpl)segmentHighlighter;
  marker.registerInDocument();
  myCachedHighlighters=null;
  fireAfterAdded(segmentHighlighter);
  return segmentHighlighter;
}
