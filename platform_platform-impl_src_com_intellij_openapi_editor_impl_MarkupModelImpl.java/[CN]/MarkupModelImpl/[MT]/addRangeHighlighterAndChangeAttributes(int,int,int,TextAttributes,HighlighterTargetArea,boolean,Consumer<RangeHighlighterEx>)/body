{
  ApplicationManager.getApplication().assertIsDispatchThread();
  RangeHighlighterEx highlighter=isPersistent ? new PersistentRangeHighlighterImpl(this,startOffset,layer,targetArea,textAttributes) : new RangeHighlighterImpl(this,startOffset,endOffset,layer,targetArea,textAttributes);
  myCachedHighlighters=null;
  if (changeAttributesAction != null) {
    if (isPersistent) {
      ((PersistentRangeHighlighterImpl)highlighter).changeAttributesInBatch(changeAttributesAction);
    }
 else {
      ((RangeHighlighterImpl)highlighter).changeAttributesInBatch(changeAttributesAction);
    }
  }
  fireAfterAdded(highlighter);
  return highlighter;
}
