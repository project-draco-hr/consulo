{
  final Artifact[] artifactsFromScope=getArtifacts(compileScope);
  if (artifactsFromScope != null) {
    return new HashSet<Artifact>(Arrays.asList(artifactsFromScope));
  }
  final Set<Artifact> cached=compileScope.getUserData(CACHED_ARTIFACTS_KEY);
  if (cached != null) {
    return cached;
  }
  Set<Artifact> artifacts=new HashSet<Artifact>();
  final ArtifactManager artifactManager=ArtifactManager.getInstance(project);
  final Set<Module> modules=new HashSet<Module>(Arrays.asList(compileScope.getAffectedModules()));
  for (  Artifact artifact : artifactManager.getArtifacts()) {
    if (artifact.isBuildOnMake()) {
      if (modules.containsAll(Arrays.asList(ModuleManager.getInstance(project).getModules())) || containsModuleOutput(artifact,modules,artifactManager)) {
        artifacts.add(artifact);
      }
    }
  }
  compileScope.putUserData(CACHED_ARTIFACTS_KEY,artifacts);
  return artifacts;
}
