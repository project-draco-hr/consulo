{
  FileInfo[] copy=fileInfos.toArray(new FileInfo[fileInfos.size()]);
  MultiValuesMap<EditFileProvider,VirtualFile> providerToFile=new MultiValuesMap<EditFileProvider,VirtualFile>();
  final List<VirtualFile> unknown=new ArrayList<VirtualFile>();
  for (  FileInfo fileInfo : copy) {
    if (fileInfo.getUseVersionControl()) {
      providerToFile.put(fileInfo.getEditFileProvider(),fileInfo.getFile());
    }
 else {
      unknown.add(fileInfo.getFile());
    }
  }
  if (!unknown.isEmpty()) {
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      public void run(){
        try {
          for (          VirtualFile file : unknown) {
            ReadOnlyAttributeUtil.setReadOnlyAttribute(file,false);
            file.refresh(false,false);
          }
        }
 catch (        IOException e) {
        }
      }
    }
);
  }
  for (  EditFileProvider editFileProvider : providerToFile.keySet()) {
    final Collection<VirtualFile> files=providerToFile.get(editFileProvider);
    try {
      editFileProvider.editFiles(files.toArray(new VirtualFile[files.size()]));
    }
 catch (    VcsException e) {
      Messages.showErrorDialog(VcsBundle.message("message.text.cannot.edit.file",e.getLocalizedMessage()),VcsBundle.message("message.title.edit.files"));
    }
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      public void run(){
        for (        final VirtualFile file : files) {
          file.refresh(false,false);
        }
      }
    }
);
  }
  for (  FileInfo fileInfo : copy) {
    if (!fileInfo.getFile().exists() || fileInfo.getFile().isWritable()) {
      fileInfos.remove(fileInfo);
    }
  }
}
