{
  final List<File> classpath=new ArrayList<File>();
  for (  CompileServerPlugin serverPlugin : CompileServerPlugin.EP_NAME.getExtensions()) {
    final PluginId pluginId=serverPlugin.getPluginDescriptor().getPluginId();
    final IdeaPluginDescriptor plugin=PluginManager.getPlugin(pluginId);
    LOG.assertTrue(plugin != null,pluginId);
    final File baseFile=plugin.getPath();
    if (baseFile.isFile()) {
      classpath.add(baseFile);
    }
 else     if (baseFile.isDirectory()) {
      final String relativePath=serverPlugin.getJarPath();
      File jarFile=new File(new File(baseFile,"lib"),relativePath);
      if (jarFile.exists()) {
        classpath.add(jarFile);
      }
 else {
        final String moduleName=FileUtil.getNameWithoutExtension(PathUtil.getFileName(relativePath));
        final File dir=new File(baseFile.getParentFile(),moduleName);
        if (!dir.exists()) {
          LOG.warn("Cannot add plugin " + pluginId + " to compile server classpath: "+ jarFile.getAbsolutePath()+ " and "+ dir.getAbsolutePath()+ " don't exist");
        }
        classpath.add(dir);
      }
    }
  }
  return classpath;
}
