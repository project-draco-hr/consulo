{
  if (!ourCanUseSnappy || string.length() < STRING_COMPRESSION_THRESHOLD) {
    if (string instanceof CharBuffer && ((CharBuffer)string).capacity() > STRING_COMPRESSION_THRESHOLD) {
      string=string.toString();
    }
    return string;
  }
  try {
    return Snappy.compress(string.toString(),Charset.defaultCharset());
  }
 catch (  IOException ex) {
    ex.printStackTrace();
    return string;
  }
}
