{
  VirtualFile root=null;
  ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  if (file != null) {
    if (fileIndex.isInLibrarySource(file) || fileIndex.isInLibraryClasses(file)) {
      LOG.debug("File is in library sources " + file);
      root=getVcsRootForLibraryFile(project,file);
    }
 else {
      LOG.debug("File is not in library sources " + file);
      root=ProjectLevelVcsManager.getInstance(project).getVcsRootFor(file);
    }
  }
  return root != null ? root : guessGitRoot(project);
}
