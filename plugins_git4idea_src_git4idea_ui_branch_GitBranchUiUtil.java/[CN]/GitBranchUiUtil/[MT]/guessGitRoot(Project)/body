{
  ProjectLevelVcsManager vcsManager=ProjectLevelVcsManager.getInstance(project);
  AbstractVcs gitVcs=GitVcs.getInstance(project);
  if (gitVcs == null) {
    return null;
  }
  VirtualFile[] gitRoots=vcsManager.getRootsUnderVcs(gitVcs);
  if (gitRoots.length == 0) {
    return null;
  }
  if (gitRoots.length == 1) {
    return gitRoots[0];
  }
  GitVcsSettings settings=GitVcsSettings.getInstance(project);
  if (settings != null) {
    String recentRootPath=settings.getRecentRootPath();
    if (recentRootPath != null) {
      VirtualFile recentRoot=VcsUtil.getVirtualFile(recentRootPath);
      if (recentRoot != null) {
        return recentRoot;
      }
    }
  }
  VirtualFile projectBaseDir=project.getBaseDir();
  if (projectBaseDir == null) {
    return null;
  }
  VirtualFile rootCandidate=null;
  for (  VirtualFile root : gitRoots) {
    if (root.equals(projectBaseDir)) {
      return root;
    }
 else     if (VfsUtilCore.isAncestor(root,projectBaseDir,true)) {
      rootCandidate=root;
    }
  }
  return rootCandidate;
}
