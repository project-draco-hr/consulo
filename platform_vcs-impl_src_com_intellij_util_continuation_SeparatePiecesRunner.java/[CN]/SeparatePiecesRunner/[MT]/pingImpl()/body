{
  while (true) {
    myCurrentWrapper.set(null);
    if (!myProject.isDefault() && !myProject.isOpen())     return;
    if (getSuspendFlag())     return;
    final TaskDescriptor current=getNextMatching();
    if (current == null) {
      return;
    }
    if (Where.AWT.equals(current.getWhere())) {
      setIndicator(null);
      try {
        current.run(this);
      }
 catch (      RuntimeException th) {
        handleException(th,true);
      }
    }
 else {
      final TaskWrapper task=new TaskWrapper(myProject,current.getName(),myCancellable,current);
      myCurrentWrapper.set(task);
      if (ApplicationManager.getApplication().isUnitTestMode()) {
        setIndicator(new EmptyProgressIndicator());
      }
 else {
        setIndicator(new BackgroundableProcessIndicator(task));
      }
      ProgressManagerImpl.runProcessWithProgressAsynchronously(task,getIndicator());
      return;
    }
  }
}
