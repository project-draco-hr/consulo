{
  super("JAVA","text/java","application/x-java","text/x-java");
  myFormattingModelBuilder=new FormattingModelBuilder(){
    @NotNull public FormattingModel createModel(    final PsiElement element,    final CodeStyleSettings settings){
      final FileElement fileElement=TreeUtil.getFileElement((TreeElement)SourceTreeToPsiMap.psiElementToTree(element));
      return new PsiBasedFormattingModel(element.getContainingFile(),AbstractJavaBlock.createJavaBlock(fileElement,settings),FormattingDocumentModelImpl.createOn(element.getContainingFile()));
    }
  }
;
  SyntaxHighlighterFactory.LANGUAGE_FACTORY.addExpicitExtension(this,new SyntaxHighlighterFactory(){
    @NotNull public SyntaxHighlighter getSyntaxHighlighter(    final Project project,    final VirtualFile virtualFile){
      LanguageLevel languageLevel;
      if (project != null && virtualFile != null) {
        final Module module=ProjectRootManager.getInstance(project).getFileIndex().getModuleForFile(virtualFile);
        if (module != null) {
          languageLevel=module.getEffectiveLanguageLevel();
        }
 else {
          languageLevel=LanguageLevel.HIGHEST;
        }
      }
 else {
        languageLevel=LanguageLevel.HIGHEST;
      }
      return new JavaFileHighlighter(languageLevel);
    }
  }
);
}
