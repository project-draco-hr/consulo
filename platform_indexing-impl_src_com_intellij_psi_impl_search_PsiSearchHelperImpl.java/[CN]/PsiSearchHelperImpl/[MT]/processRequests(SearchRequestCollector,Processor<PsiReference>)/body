{
  Map<SearchRequestCollector,Processor<PsiReference>> collectors=ContainerUtil.newHashMap();
  collectors.put(collector,processor);
  appendCollectorsFromQueryRequests(collectors);
  ProgressIndicator progress=ProgressIndicatorProvider.getGlobalProgressIndicator();
  do {
    final MultiMap<Set<IdIndexEntry>,RequestWithProcessor> globals=new MultiMap<Set<IdIndexEntry>,RequestWithProcessor>();
    final List<Computable<Boolean>> customs=ContainerUtil.newArrayList();
    final LinkedHashSet<RequestWithProcessor> locals=ContainerUtil.newLinkedHashSet();
    distributePrimitives(collectors,locals,globals,customs);
    if (!processGlobalRequestsOptimized(globals,progress)) {
      return false;
    }
    for (    RequestWithProcessor local : locals) {
      if (!processSingleRequest(local.request,local.refProcessor)) {
        return false;
      }
    }
    for (    Computable<Boolean> custom : customs) {
      if (!custom.compute()) {
        return false;
      }
    }
  }
 while (appendCollectorsFromQueryRequests(collectors));
  return true;
}
