{
  if (text.isEmpty()) {
    throw new IllegalArgumentException("Cannot search for elements with empty text");
  }
  ProgressIndicator progress=getOrCreateIndicator();
  if (searchScope instanceof GlobalSearchScope) {
    StringSearcher searcher=new StringSearcher(text,options.contains(Options.CASE_SENSITIVE_SEARCH),true,searchContext == UsageSearchContext.IN_STRINGS,options.contains(Options.PROCESS_ONLY_JAVA_IDENTIFIERS_IF_POSSIBLE));
    return processElementsWithTextInGlobalScope(processor,(GlobalSearchScope)searchScope,searcher,searchContext,options.contains(Options.CASE_SENSITIVE_SEARCH),containerName,progress,options.contains(Options.PROCESS_INJECTED_PSI));
  }
  LocalSearchScope scope=(LocalSearchScope)searchScope;
  PsiElement[] scopeElements=scope.getScope();
  final StringSearcher searcher=new StringSearcher(text,options.contains(Options.CASE_SENSITIVE_SEARCH),true,searchContext == UsageSearchContext.IN_STRINGS,options.contains(Options.PROCESS_ONLY_JAVA_IDENTIFIERS_IF_POSSIBLE));
  Processor<PsiElement> localProcessor=localProcessor(processor,progress,options.contains(Options.PROCESS_INJECTED_PSI),searcher);
  return JobLauncher.getInstance().invokeConcurrentlyUnderProgress(Arrays.asList(scopeElements),progress,true,true,localProcessor);
}
