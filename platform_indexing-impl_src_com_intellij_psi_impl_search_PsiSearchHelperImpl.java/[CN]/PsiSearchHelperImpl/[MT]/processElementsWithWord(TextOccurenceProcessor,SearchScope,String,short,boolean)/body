{
  if (text.length() == 0) {
    throw new IllegalArgumentException("Cannot search for elements with empty text");
  }
  final ProgressIndicator progress=ProgressIndicatorProvider.getInstance().getProgressIndicator();
  if (searchScope instanceof GlobalSearchScope) {
    StringSearcher searcher=new StringSearcher(text,caseSensitively,true);
    return processElementsWithTextInGlobalScope(processor,(GlobalSearchScope)searchScope,searcher,searchContext,caseSensitively,progress);
  }
 else {
    LocalSearchScope scope=(LocalSearchScope)searchScope;
    PsiElement[] scopeElements=scope.getScope();
    final boolean ignoreInjectedPsi=scope.isIgnoreInjectedPsi();
    return JobLauncher.getInstance().invokeConcurrentlyUnderProgress(Arrays.asList(scopeElements),progress,false,new Processor<PsiElement>(){
      @Override public boolean process(      PsiElement scopeElement){
        return processElementsWithWordInScopeElement(scopeElement,processor,text,caseSensitively,ignoreInjectedPsi,progress);
      }
    }
);
  }
}
