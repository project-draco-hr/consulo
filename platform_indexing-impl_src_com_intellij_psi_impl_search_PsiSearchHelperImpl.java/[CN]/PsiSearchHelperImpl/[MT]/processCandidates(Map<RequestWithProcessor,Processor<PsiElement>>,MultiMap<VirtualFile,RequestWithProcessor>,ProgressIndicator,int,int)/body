{
  List<VirtualFile> files=new ArrayList<VirtualFile>(candidateFiles.keySet());
  return processPsiFileRoots(files,totalSize,alreadyProcessedFiles,progress,new Processor<PsiFile>(){
    @Override public boolean process(    final PsiFile psiRoot){
      final VirtualFile vfile=psiRoot.getVirtualFile();
      for (      final RequestWithProcessor singleRequest : candidateFiles.get(vfile)) {
        Processor<PsiElement> localProcessor=localProcessors.get(singleRequest);
        if (!localProcessor.process(psiRoot)) {
          return false;
        }
      }
      return true;
    }
  }
);
}
