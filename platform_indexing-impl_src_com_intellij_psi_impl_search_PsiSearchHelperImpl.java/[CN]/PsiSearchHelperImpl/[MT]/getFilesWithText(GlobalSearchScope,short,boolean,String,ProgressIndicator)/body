{
  myManager.startBatchFilesProcessingMode();
  try {
    final List<VirtualFile> result=new ArrayList<VirtualFile>();
    Processor<VirtualFile> processor=new CommonProcessors.CollectProcessor<VirtualFile>(result){
      @Override public boolean process(      VirtualFile file){
        if (progress != null)         progress.checkCanceled();
        return super.process(file);
      }
    }
;
    boolean success=processFilesWithText(scope,searchContext,caseSensitively,text,processor);
    LOG.assertTrue(success);
    return result;
  }
  finally {
    myManager.finishBatchFilesProcessingMode();
  }
}
