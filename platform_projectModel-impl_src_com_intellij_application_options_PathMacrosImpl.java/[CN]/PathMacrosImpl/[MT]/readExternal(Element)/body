{
  try {
    myLock.writeLock().lock();
    final List children=element.getChildren(MACRO_ELEMENT);
    for (    Object aChildren : children) {
      Element macro=(Element)aChildren;
      final String name=macro.getAttributeValue(NAME_ATTR);
      String value=macro.getAttributeValue(VALUE_ATTR);
      if (name == null || value == null) {
        throw new InvalidDataException();
      }
      if (SYSTEM_MACROS.contains(name)) {
        continue;
      }
      if (value.length() > 1 && value.charAt(value.length() - 1) == '/') {
        value=value.substring(0,value.length() - 1);
      }
      myMacros.put(name,value);
    }
    final List ignoredChildren=element.getChildren(IGNORED_MACRO_ELEMENT);
    for (    final Object child : ignoredChildren) {
      final Element macroElement=(Element)child;
      final String ignoredName=macroElement.getAttributeValue(NAME_ATTR);
      if (ignoredName != null && ignoredName.length() > 0 && !myIgnoredMacros.contains(ignoredName)) {
        myIgnoredMacros.add(ignoredName);
      }
    }
  }
  finally {
    myLock.writeLock().unlock();
  }
}
