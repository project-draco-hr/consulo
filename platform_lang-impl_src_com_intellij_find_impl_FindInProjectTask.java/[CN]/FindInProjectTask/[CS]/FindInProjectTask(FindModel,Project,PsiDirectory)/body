{
  myFindModel=findModel;
  myProject=project;
  myPsiDirectory=psiDirectory;
  myPsiManager=PsiManager.getInstance(project);
  final String moduleName=findModel.getModuleName();
  myModule=moduleName == null ? null : ApplicationManager.getApplication().runReadAction(new Computable<Module>(){
    @Override public Module compute(){
      return ModuleManager.getInstance(project).findModuleByName(moduleName);
    }
  }
);
  myProjectFileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  myFileIndex=myModule == null ? myProjectFileIndex : ModuleRootManager.getInstance(myModule).getFileIndex();
  final String filter=findModel.getFileFilter();
  final Pattern pattern=FindInProjectUtil.createFileMaskRegExp(filter);
  myFileMask=pattern == null ? Conditions.<VirtualFile>alwaysTrue() : new Condition<VirtualFile>(){
    @Override public boolean value(    VirtualFile file){
      return file != null && pattern.matcher(file.getName()).matches();
    }
  }
;
  final ProgressIndicator progress=ProgressManager.getInstance().getProgressIndicator();
  myProgress=progress != null ? progress : new EmptyProgressIndicator();
}
