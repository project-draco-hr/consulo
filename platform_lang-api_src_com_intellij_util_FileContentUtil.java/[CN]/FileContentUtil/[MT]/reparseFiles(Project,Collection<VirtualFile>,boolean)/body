{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      final Set<VFilePropertyChangeEvent> events=new THashSet<VFilePropertyChangeEvent>();
      for (      VirtualFile file : files) {
        saveOrReload(file,events);
      }
      if (includeOpenFiles) {
        for (        VirtualFile open : FileEditorManager.getInstance(project).getOpenFiles()) {
          if (!files.contains(open)) {
            saveOrReload(open,events);
          }
        }
      }
      ApplicationManager.getApplication().getMessageBus().syncPublisher(VirtualFileManager.VFS_CHANGES).before(new ArrayList<VFileEvent>(events));
      ApplicationManager.getApplication().getMessageBus().syncPublisher(VirtualFileManager.VFS_CHANGES).after(new ArrayList<VFileEvent>(events));
    }
  }
);
}
