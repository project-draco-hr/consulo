{
  if (element == null || !element.isValid())   return null;
  final Project project=element.getProject();
  final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  if (element instanceof PsiPackage) {
    final PsiPackage aPackage=(PsiPackage)element;
    final PsiDirectory[] directories=aPackage.getDirectories(GlobalSearchScope.projectScope(project));
    for (    final PsiDirectory directory : directories) {
      if (isSource(directory,fileIndex))       return aPackage;
    }
    return null;
  }
 else   if (element instanceof PsiDirectory) {
    final PsiDirectory directory=(PsiDirectory)element;
    return isSource(directory,fileIndex) ? JavaDirectoryService.getInstance().getPackage(directory) : null;
  }
 else {
    return null;
  }
}
