{
  myBusConnection.subscribe(VirtualFileManager.VFS_CHANGES,new MyFileChangeListener());
  myBusConnection.subscribe(ProjectTopics.PROJECT_ROOTS,new MyRootChangesListener());
  myChangedDocumentsQueue.makeUserAware(myProject);
  myChangedDocumentsQueue.activate();
  myDocumentListener=new DocumentAdapter(){
    public void documentChanged(    DocumentEvent event){
      Document doc=event.getDocument();
      VirtualFile file=FileDocumentManager.getInstance().getFile(doc);
      if (file == null)       return;
      boolean isMavenFile=file.getName().equals(MavenConstants.POM_XML) || file.getName().equals(MavenConstants.PROFILES_XML) || isSettingsFile(file);
      if (!isMavenFile)       return;
synchronized (myChangedDocuments) {
        myChangedDocuments.add(doc);
      }
      myChangedDocumentsQueue.queue(new Update(MavenProjectsManagerWatcher.this){
        public void run(){
          final Set<Document> copy;
synchronized (myChangedDocuments) {
            copy=new THashSet<Document>(myChangedDocuments);
            myChangedDocuments.clear();
          }
          MavenUtil.invokeLater(myProject,new Runnable(){
            public void run(){
              for (              Document each : copy) {
                FileDocumentManager.getInstance().saveDocument(each);
              }
            }
          }
);
        }
      }
);
    }
  }
;
  getDocumentEventMulticaster().addDocumentListener(myDocumentListener);
  mySettingsPathsChangesListener=new MavenGeneralSettings.Listener(){
    public void pathChanged(){
      updateSettingsFilePointers();
      onSettingsChange();
    }
  }
;
  myGeneralSettings.addListener(mySettingsPathsChangesListener);
  updateSettingsFilePointers();
}
