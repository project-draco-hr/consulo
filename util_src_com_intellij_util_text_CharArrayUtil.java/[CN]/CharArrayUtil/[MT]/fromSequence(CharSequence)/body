{
  if (seq instanceof CharSequenceBackedByArray) {
    return ((CharSequenceBackedByArray)seq).getChars();
  }
  if (seq instanceof CharBuffer) {
    final CharBuffer buffer=(CharBuffer)seq;
    if (buffer.hasArray() && buffer.arrayOffset() == 0 && !buffer.isReadOnly()) {
      final char[] bufArray=buffer.array();
      return bufArray;
    }
    char[] chars=new char[seq.length()];
    buffer.position(0);
    buffer.get(chars);
    buffer.position(0);
    return chars;
  }
  if (seq instanceof StringBuffer) {
    char[] chars=new char[seq.length()];
    ((StringBuffer)seq).getChars(0,seq.length(),chars,0);
    return chars;
  }
  if (seq instanceof String) {
    char[] chars=new char[seq.length()];
    ((String)seq).getChars(0,seq.length(),chars,0);
    return chars;
  }
  return seq.toString().toCharArray();
}
