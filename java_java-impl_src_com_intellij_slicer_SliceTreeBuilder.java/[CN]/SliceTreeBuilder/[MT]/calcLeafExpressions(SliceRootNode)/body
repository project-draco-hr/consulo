{
  final Ref<Collection<PsiElement>> leafExpressions=Ref.create(null);
  boolean b=ProgressManager.getInstance().runProcessWithProgressSynchronously(new Runnable(){
    public void run(){
      Collection<PsiElement> l=SliceLeafAnalyzer.calcLeafExpressions(root);
      leafExpressions.set(l);
    }
  }
,"Expanding all nodes... (may very well take the whole day)",true,root.getProject());
  if (!b)   return null;
  Collection<PsiElement> leaves=leafExpressions.get();
  return leaves;
}
