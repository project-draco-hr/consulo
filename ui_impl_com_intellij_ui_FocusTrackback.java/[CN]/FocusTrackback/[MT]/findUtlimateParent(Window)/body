{
  Window root=parent == null ? JOptionPane.getRootFrame() : parent;
  while (root != null) {
    final Container next=root.getParent();
    if (next == null)     break;
    if (next instanceof Window) {
      root=(Window)next;
    }
    final Window nextWindow=SwingUtilities.getWindowAncestor(next);
    if (nextWindow == null)     break;
    root=nextWindow;
  }
  if (((ApplicationEx)ApplicationManager.getApplication()).isInternal() && !(root instanceof IdeFrame)) {
    LOG.assertTrue(false,"Expected to be child for " + IdeFrame.class.getName() + " but was child of: "+ (root == null ? "null" : root.getClass().getName()));
  }
  return root;
}
