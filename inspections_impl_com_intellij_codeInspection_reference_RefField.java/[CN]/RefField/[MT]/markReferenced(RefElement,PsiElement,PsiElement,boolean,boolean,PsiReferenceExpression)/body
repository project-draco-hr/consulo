{
  super.markReferenced(refFrom,psiFrom,psiWhat,forWriting,forReading,expressionFrom);
  boolean referencedFromClassInitializer=false;
  if (forWriting && expressionFrom != null) {
    PsiClassInitializer initializer=PsiTreeUtil.getParentOfType(expressionFrom,PsiClassInitializer.class);
    if (initializer != null) {
      if (initializer.getParent() instanceof PsiClass && psiFrom == initializer.getParent()) {
        referencedFromClassInitializer=true;
      }
    }
  }
  if (forWriting) {
    setUsedForWriting(true);
    if (!(refFrom instanceof RefMethod) || !((RefMethod)refFrom).isConstructor() || ((PsiField)psiWhat).hasInitializer()) {
      if (!referencedFromClassInitializer) {
        setCanBeFinal(false);
      }
    }
  }
  if (forReading) {
    setUsedForReading(true);
  }
}
