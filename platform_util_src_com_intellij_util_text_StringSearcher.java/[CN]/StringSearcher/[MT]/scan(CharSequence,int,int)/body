{
  if (myForwardDirection) {
    int start=_start;
    int end=_end - myPatternLength;
    while (start <= end) {
      int i=myPatternLength - 1;
      char lastChar=text.charAt(start + i);
      if (!myCaseSensitive) {
        lastChar=StringUtil.toLowerCase(lastChar);
      }
      if (myPatternArray[i] == lastChar) {
        i--;
        while (i >= 0) {
          char c=text.charAt(start + i);
          if (!myCaseSensitive) {
            c=StringUtil.toLowerCase(c);
          }
          if (myPatternArray[i] != c)           break;
          i--;
        }
        if (i < 0)         return start;
      }
      int step=0 <= lastChar && lastChar < 128 ? mySearchTable[lastChar] : 1;
      if (step <= 0) {
        int index;
        for (index=myPatternLength - 2; index >= 0; index--) {
          if (myPatternArray[index] == lastChar)           break;
        }
        step=myPatternLength - index - 1;
        mySearchTable[lastChar]=step;
      }
      start+=step;
    }
    return -1;
  }
 else {
    int start=1;
    int end=text.length() - myPatternLength + 1;
    while (start <= end) {
      int i=myPatternLength - 1;
      char lastChar=text.charAt(text.length() - (start + i));
      if (!myCaseSensitive) {
        lastChar=StringUtil.toLowerCase(lastChar);
      }
      if (myPatternArray[myPatternLength - 1 - i] == lastChar) {
        i--;
        while (i >= 0) {
          char c=text.charAt(text.length() - (start + i));
          if (!myCaseSensitive) {
            c=StringUtil.toLowerCase(c);
          }
          if (myPatternArray[myPatternLength - 1 - i] != c)           break;
          i--;
        }
        if (i < 0)         return text.length() - start - myPatternLength + 1;
      }
      int step=0 <= lastChar && lastChar < 128 ? mySearchTable[lastChar] : 1;
      if (step <= 0) {
        int index;
        for (index=myPatternLength - 2; index >= 0; index--) {
          if (myPatternArray[myPatternLength - 1 - index] == lastChar)           break;
        }
        step=myPatternLength - index - 1;
        mySearchTable[lastChar]=step;
      }
      start+=step;
    }
    return -1;
  }
}
