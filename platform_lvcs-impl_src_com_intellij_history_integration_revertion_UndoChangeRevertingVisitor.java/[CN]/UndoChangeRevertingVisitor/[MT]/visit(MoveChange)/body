{
  if (shouldRevert(c)) {
    VirtualFile f=myGateway.findVirtualFile(c.getPath());
    if (f != null) {
      try {
        VirtualFile parent=myGateway.findOrCreateFileSafely(c.getOldParent(),true);
        VirtualFile existing=parent.findChild(f.getName());
        if (existing != null)         existing.delete(LocalHistory.VFS_EVENT_REQUESTOR);
        f.move(LocalHistory.VFS_EVENT_REQUESTOR,parent);
      }
 catch (      IOException e) {
        throw new RuntimeIOException(e);
      }
    }
  }
  checkShouldStop(c);
}
