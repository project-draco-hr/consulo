{
  mySegmentEndOffset=getCurrentFoldRegionStartOffset();
  if (mySegmentEndOffset > mySegmentStartOffset) {
    mySegmentEndOffset=Math.min(myNextWrapOffset,Math.min(mySegmentEndOffset,myDocument.getLineEndOffset(myCurrentEndLogicalLine)));
    boolean normalLineEnd=mySegmentEndOffset < getCurrentFoldRegionStartOffset() && mySegmentEndOffset < myNextWrapOffset;
    myInlays=myView.getEditor().getInlayModel().getInlineElementsInRange(mySegmentStartOffset,mySegmentEndOffset - ((normalLineEnd && mySegmentEndOffset > mySegmentStartOffset) ? 0 : 1));
    if (!myInlays.isEmpty() && myInlays.get(0).getOffset() == mySegmentStartOffset) {
      myCurrentInlayIndex=0;
      myFragmentIterator=null;
    }
 else {
      myCurrentInlayIndex=-1;
      setFragmentIterator();
    }
  }
}
