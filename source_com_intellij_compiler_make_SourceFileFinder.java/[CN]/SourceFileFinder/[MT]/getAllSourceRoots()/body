{
  if (myProjectSourceRoots == null) {
    myProjectSourceRoots=new HashMap<VirtualFile,String>();
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      public void run(){
        final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(myProject).getFileIndex();
        final Module[] allModules=ModuleManager.getInstance(myProject).getModules();
        for (int idx=0; idx < allModules.length; idx++) {
          final VirtualFile[] sourceRoots=myCompileContext.getSourceRoots(allModules[idx]);
          for (int i=0; i < sourceRoots.length; i++) {
            final VirtualFile sourceRoot=sourceRoots[i];
            String packageName=fileIndex.getPackageNameByDirectory(sourceRoot);
            myProjectSourceRoots.put(sourceRoot,packageName == null || packageName.length() == 0 ? "" : "/" + packageName.replace('.','/') + "/");
          }
        }
      }
    }
);
  }
  return myProjectSourceRoots;
}
