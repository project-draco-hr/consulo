{
  final Project project=getEventProject(e);
  final VirtualFile[] files=e.getData(PlatformDataKeys.VIRTUAL_FILE_ARRAY);
  FeatureUsageTracker.getInstance().triggerFeatureUsed("jar.diff");
  if (project != null && files != null) {
    VirtualFileDiffElement src=null;
    VirtualFileDiffElement trg=null;
    if (files.length == 2 && isJarOrZip(files[0]) && isJarOrZip(files[1])) {
      src=new JarFileDiffElement(files[0]);
      trg=new JarFileDiffElement(files[1]);
    }
 else     if (files.length == 1 && isJarOrZip(files[0])) {
      src=new JarFileDiffElement(files[0]);
      final FileChooserDescriptor descriptor=new FileChooserDescriptor(true,false,true,true,false,false){
        @Override public boolean isFileVisible(        VirtualFile file,        boolean showHiddenFiles){
          return file.isDirectory() || (!file.isDirectory() && isJarOrZip(file));
        }
      }
;
      final VirtualFile[] result=FileChooserFactory.getInstance().createFileChooser(descriptor,project).choose(project.getBaseDir(),project);
      if (result.length == 1 && result[0] != null && isJarOrZip(result[0])) {
        trg=new JarFileDiffElement(result[0]);
      }
    }
    final DirDiffManager mgr=DirDiffManager.getInstance(project);
    if (src != null && trg != null && mgr.canShow(src,trg)) {
      mgr.showDiff(src,trg,new DirDiffSettings(),null);
    }
  }
}
