{
  if (element == null || !element.isValid())   return null;
  final Project project=element.getProject();
  final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  if (element instanceof PsiJavaPackage) {
    final PsiJavaPackage aPackage=(PsiJavaPackage)element;
    final PsiDirectory[] directories=aPackage.getDirectories(GlobalSearchScope.projectScope(project));
    for (    final PsiDirectory directory : directories) {
      if (isSource(directory,fileIndex))       return aPackage;
    }
    return null;
  }
 else   if (element instanceof PsiDirectory) {
    final PsiDirectory directory=(PsiDirectory)element;
    if (isSource(directory,fileIndex)) {
      return JavaDirectoryService.getInstance().getPackage(directory);
    }
  }
  return null;
}
