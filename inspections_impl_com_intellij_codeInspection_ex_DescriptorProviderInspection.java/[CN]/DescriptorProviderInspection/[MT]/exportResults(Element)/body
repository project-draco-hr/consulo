{
  getRefManager().iterate(new RefVisitor(){
    public void visitElement(    final RefEntity refEntity){
      if (myProblemElements.containsKey(refEntity)) {
        CommonProblemDescriptor[] descriptions=getDescriptions(refEntity);
        for (        CommonProblemDescriptor description : descriptions) {
          @NonNls final String template=description.getDescriptionTemplate();
          int line=description instanceof ProblemDescriptor ? ((ProblemDescriptor)description).getLineNumber() : -1;
          final String text=description instanceof ProblemDescriptor ? ((ProblemDescriptor)description).getPsiElement().getText() : "";
          @NonNls String problemText=template.replaceAll("#ref",text.replaceAll("\\$","\\\\\\$"));
          problemText=problemText.replaceAll(" #loc "," ");
          Element element=XMLExportUtl.createElement(refEntity,parentNode,line);
          Element problemClassElement=new Element(InspectionsBundle.message("inspection.export.results.problem.element.tag"));
          problemClassElement.addContent(getDisplayName());
          element.addContent(problemClassElement);
          try {
            Element descriptionElement=new Element(InspectionsBundle.message("inspection.export.results.description.tag"));
            descriptionElement.addContent(problemText);
            element.addContent(descriptionElement);
          }
 catch (          IllegalDataException e) {
            System.out.println("Cannot save results for " + refEntity.getName());
          }
        }
      }
    }
  }
);
}
