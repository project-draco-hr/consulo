{
  DebuggerManagerThreadImpl.assertIsManagerThread();
  final ValueDescriptorImpl parentDescriptor=(ValueDescriptorImpl)builder.getParentDescriptor();
  final NodeManager nodeManager=builder.getNodeManager();
  final NodeDescriptorFactory nodeDescriptorFactory=builder.getDescriptorManager();
  List<DebuggerTreeNode> children=new ArrayList<DebuggerTreeNode>();
  if (value instanceof ObjectReference) {
    final ObjectReference objRef=(ObjectReference)value;
    final ReferenceType refType=objRef.referenceType();
    final List<Field> fields=refType.allFields();
    if (fields.size() > 0) {
      for (      final Field field : fields) {
        if (!shouldDisplay(evaluationContext,objRef,field)) {
          continue;
        }
        children.add(nodeManager.createNode(nodeDescriptorFactory.getFieldDescriptor(parentDescriptor,objRef,field),evaluationContext));
      }
      if (SORT_ASCENDING) {
        Collections.sort(children,NodeManagerImpl.getNodeComparator());
      }
    }
 else {
      children.add(nodeManager.createMessageNode(MessageDescriptor.CLASS_HAS_NO_FIELDS.getLabel()));
    }
  }
  builder.setChildren(children);
}
