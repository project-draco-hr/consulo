{
  final VirtualFile scriptFile=getScriptFile();
  if (scriptFile == null) {
    return null;
  }
  final PsiFile psiFile=PsiManager.getInstance(getProject()).findFile(scriptFile);
  if (!(psiFile instanceof GroovyFile)) {
    return null;
  }
  if (!((GroovyFile)psiFile).isScript()) {
    return new DefaultGroovyScriptRunner();
  }
  return GroovyScriptTypeDetector.getScriptType((GroovyFile)psiFile).getRunner();
}
