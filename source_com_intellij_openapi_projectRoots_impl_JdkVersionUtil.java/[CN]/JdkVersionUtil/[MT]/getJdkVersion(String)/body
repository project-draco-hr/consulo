{
  if (homePath == null || !new File(homePath).exists()) {
    return null;
  }
  final String[] versionString=new String[1];
  try {
    Process process=Runtime.getRuntime().exec(new String[]{homePath + File.separator + "bin"+ File.separator+ "java","-version"});
    VersionParsingThread parsingThread=new VersionParsingThread(process.getErrorStream(),versionString);
    final Future<?> parsingThreadFuture=ApplicationManager.getApplication().executeOnPooledThread(parsingThread);
    ReadStreamThread readThread=new ReadStreamThread(process.getInputStream());
    ApplicationManager.getApplication().executeOnPooledThread(readThread);
    try {
      try {
        process.waitFor();
      }
 catch (      InterruptedException e) {
        LOG.info(e);
        process.destroy();
      }
    }
  finally {
      try {
        parsingThreadFuture.get();
      }
 catch (      Exception e) {
        LOG.info(e);
      }
    }
  }
 catch (  IOException ex) {
    LOG.info(ex);
  }
  return versionString[0];
}
