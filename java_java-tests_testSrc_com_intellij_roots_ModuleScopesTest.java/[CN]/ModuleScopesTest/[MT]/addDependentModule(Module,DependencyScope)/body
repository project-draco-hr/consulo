{
  final Module moduleB=createModule("b.iml",StdModuleTypes.JAVA);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      VirtualFile rootB=myFixture.findOrCreateDir("b");
      VirtualFile outB=myFixture.findOrCreateDir("out");
      final ModifiableRootModel modelA=ModuleRootManager.getInstance(moduleA).getModifiableModel();
      modelA.addModuleOrderEntry(moduleB).setScope(scope);
      modelA.commit();
      final ModifiableRootModel modelB=ModuleRootManager.getInstance(moduleB).getModifiableModel();
      final ContentEntry contentEntry=modelB.addContentEntry(rootB);
      contentEntry.addSourceFolder(rootB,false);
      final CompilerModuleExtension extension=modelB.getModuleExtension(CompilerModuleExtension.class);
      extension.inheritCompilerOutputPath(false);
      extension.setCompilerOutputPath(outB);
      modelB.commit();
    }
  }
);
  return moduleB;
}
