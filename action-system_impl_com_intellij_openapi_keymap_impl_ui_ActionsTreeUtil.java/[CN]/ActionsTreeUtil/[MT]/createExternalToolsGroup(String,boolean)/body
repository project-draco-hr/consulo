{
  final ActionManagerEx actionManager=ActionManagerEx.getInstanceEx();
  String[] ids=actionManager.getActionIds(Tool.ACTION_ID_PREFIX);
  Arrays.sort(ids);
  Group group=new Group(KeyMapBundle.message("actions.tree.external.tools.group"),TOOLS_ICON,TOOLS_OPEN_ICON);
  ToolManager toolManager=ToolManager.getInstance();
  HashMap<String,Group> toolGroupNameToGroup=new HashMap<String,Group>();
  for (  String id : ids) {
    if (!isActionFiltered(filter,actionManager.getAction(id),forceFiltering))     continue;
    String groupName=toolManager.getGroupByActionId(id);
    if (groupName != null && groupName.trim().length() == 0) {
      groupName=null;
    }
    Group subGroup=toolGroupNameToGroup.get(groupName);
    if (subGroup == null) {
      subGroup=new Group(groupName,null,null);
      toolGroupNameToGroup.put(groupName,subGroup);
      if (groupName != null) {
        group.addGroup(subGroup);
      }
    }
    subGroup.addActionId(id);
  }
  Group subGroup=toolGroupNameToGroup.get(null);
  if (subGroup != null) {
    group.addAll(subGroup);
  }
  return group;
}
