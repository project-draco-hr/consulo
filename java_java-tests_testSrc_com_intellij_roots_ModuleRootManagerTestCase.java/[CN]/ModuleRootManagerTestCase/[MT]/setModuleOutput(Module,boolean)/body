{
  final VirtualFile output=getVirtualFile(createTempDir(module.getName() + (test ? "Test" : "Prod") + "Output"));
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      final ModifiableRootModel model=ModuleRootManager.getInstance(module).getModifiableModel();
      final CompilerModuleExtension extension=model.getModuleExtension(CompilerModuleExtension.class);
      assertNotNull(extension);
      extension.inheritCompilerOutputPath(false);
      if (test) {
        extension.setCompilerOutputPathForTests(output);
      }
 else {
        extension.setCompilerOutputPath(output);
      }
      model.commit();
    }
  }
);
  return output;
}
