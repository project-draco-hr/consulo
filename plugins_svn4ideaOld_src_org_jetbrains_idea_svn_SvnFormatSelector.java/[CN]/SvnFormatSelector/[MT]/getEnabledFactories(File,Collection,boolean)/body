{
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    return factories;
  }
  if (!writeAccess) {
    return factories;
  }
  final WorkingCopyFormat format=getWorkingCopyFormat(path);
  Collection result=format2Factories(format,factories);
  if (result == null) {
    final WorkingCopyFormat presetFormat=SvnWorkingCopyFormatHolder.getPresetFormat();
    if (presetFormat != null) {
      result=format2Factories(presetFormat,factories);
    }
  }
  if (result == null) {
    throw new SVNException(SVNErrorMessage.create(SVNErrorCode.WC_NOT_DIRECTORY));
  }
  return result;
}
