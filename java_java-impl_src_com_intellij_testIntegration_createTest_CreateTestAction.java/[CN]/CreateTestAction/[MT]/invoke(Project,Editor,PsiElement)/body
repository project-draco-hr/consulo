{
  if (!CodeInsightUtilBase.preparePsiElementForWrite(element))   return;
  final Module srcModule=ModuleUtil.findModuleForPsiElement(element);
  final PsiClass srcClass=getContainingClass(element);
  if (srcClass == null)   return;
  PsiDirectory srcDir=element.getContainingFile().getContainingDirectory();
  PsiPackage srcPackage=JavaDirectoryService.getInstance().getPackage(srcDir);
  final CreateTestDialog d=new CreateTestDialog(project,getText(),srcClass,srcPackage,srcModule);
  d.show();
  if (!d.isOK())   return;
  CommandProcessor.getInstance().executeCommand(project,new Runnable(){
    @Override public void run(){
      TestFramework framework=d.getSelectedTestFrameworkDescriptor();
      TestGenerator generator=TestGenerators.INSTANCE.forLanguage(framework.getLanguage());
      generator.generateTest(project,d);
    }
  }
,CodeInsightBundle.message("intention.create.test"),this);
}
