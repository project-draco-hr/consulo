{
  FileDocumentManager.getInstance().saveAllDocuments();
  final InspectionManagerEx inspectionManagerEx=(InspectionManagerEx)InspectionManager.getInstance(project);
  final AnalysisScope scope=new AnalysisScope(psiFile);
  final GlobalInspectionContextImpl inspectionContext=inspectionManagerEx.createNewGlobalContext(false);
  inspectionContext.setCurrentScope(scope);
  final InspectionProfile inspectionProfile=InspectionProjectProfileManager.getInstance(project).getInspectionProfile();
  inspectionContext.setExternalProfile(inspectionProfile);
  inspectionContext.doInspections(scope,inspectionManagerEx);
}
