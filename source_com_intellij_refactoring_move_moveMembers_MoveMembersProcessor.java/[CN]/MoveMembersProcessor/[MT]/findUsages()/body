{
  final PsiManager manager=PsiManager.getInstance(myProject);
  final PsiSearchHelper helper=manager.getSearchHelper();
  final List<UsageInfo> usagesList=new ArrayList<UsageInfo>();
  for (Iterator<PsiMember> it=myMembersToMove.iterator(); it.hasNext(); ) {
    PsiMember member=it.next();
    PsiReference[] refs=helper.findReferences(member,GlobalSearchScope.projectScope(myProject),false);
    for (int i=0; i < refs.length; i++) {
      PsiElement ref=refs[i].getElement();
      if (ref instanceof PsiReferenceExpression) {
        PsiReferenceExpression refExpr=(PsiReferenceExpression)ref;
        PsiExpression qualifier=refExpr.getQualifierExpression();
        if (RefactoringHierarchyUtil.willBeInTargetClass(refExpr,myMembersToMove,myTargetClass,true)) {
          if (!isInMovedElement(refExpr)) {
            if (qualifier != null) {
              usagesList.add(new MyUsageInfo(member,refExpr,null,qualifier));
            }
          }
 else {
            if (qualifier instanceof PsiReferenceExpression && ((PsiReferenceExpression)qualifier).isReferenceTo(member.getContainingClass())) {
              usagesList.add(new MyUsageInfo(member,refExpr,null,qualifier));
            }
          }
        }
 else {
          if (qualifier == null) {
            usagesList.add(new MyUsageInfo(member,refExpr,myTargetClass,refExpr));
          }
 else {
            usagesList.add(new MyUsageInfo(member,refExpr,myTargetClass,qualifier));
          }
        }
      }
 else {
        if (!isInMovedElement(ref)) {
          usagesList.add(new MyUsageInfo(member,ref,null,ref));
        }
      }
    }
  }
  UsageInfo[] usageInfos=usagesList.toArray(new UsageInfo[usagesList.size()]);
  usageInfos=UsageViewUtil.removeDuplicatedUsages(usageInfos);
  return usageInfos;
}
