{
  updateErrorMessage.pass(null);
  if (myInitialTargetDirectory != null && selectedItem instanceof DirectoryChooser.ItemWrapper && selectedItem != NULL_WRAPPER) {
    final PsiDirectory directory=((DirectoryChooser.ItemWrapper)selectedItem).getDirectory();
    final boolean isSelectionInTestSourceContent=fileIndex.isInTestSourceContent(directory.getVirtualFile());
    final boolean inTestSourceContent=fileIndex.isInTestSourceContent(myInitialTargetDirectory.getVirtualFile());
    if (isSelectionInTestSourceContent != inTestSourceContent) {
      if (inTestSourceContent && reportBaseInTestSelectionInSource()) {
        updateErrorMessage.pass("Source root is selected while the test root is expected");
      }
      if (isSelectionInTestSourceContent && reportBaseInSourceSelectionInTest()) {
        updateErrorMessage.pass("Test root is selected while the source root is expected");
      }
    }
  }
}
