{
  if (reference instanceof PsiMultiReference) {
    reference=ContainerUtil.findInstance(((PsiMultiReference)reference).getReferences(),PsiJavaReference.class);
  }
  if (reference instanceof PsiJavaReference) {
    final PsiJavaReference javaReference=(PsiJavaReference)reference;
    ElementFilter checkClass=new ElementFilter(){
      @Override public boolean isAcceptable(      Object element,      PsiElement context){
        return filter.isAcceptable(element,context);
      }
      @Override public boolean isClassAcceptable(      Class hintClass){
        if (ReflectionCache.isAssignable(PsiClass.class,hintClass)) {
          return acceptClasses;
        }
        if (ReflectionCache.isAssignable(PsiVariable.class,hintClass) || ReflectionCache.isAssignable(PsiMethod.class,hintClass) || ReflectionCache.isAssignable(CandidateInfo.class,hintClass)) {
          return acceptMembers;
        }
        return false;
      }
    }
;
    JavaCompletionProcessor.Options options=JavaCompletionProcessor.Options.DEFAULT_OPTIONS.withFilterStaticAfterInstance(parameters.getInvocationCount() <= 1);
    return JavaCompletionUtil.processJavaReference(element,javaReference,checkClass,options,matcher,parameters);
  }
  return Collections.emptySet();
}
