{
  final ActionCallback result=new ActionCallback();
  AbstractTreeNode alreadySelected=alreadySelectedNode(element);
  final Runnable onDone=new Runnable(){
    public void run(){
      if (requestFocus) {
        IdeFocusManager.getInstance(myProject).requestFocus(getTree(),true);
      }
      result.setDone();
    }
  }
;
  final Condition<AbstractTreeNode> condition=new Condition<AbstractTreeNode>(){
    public boolean value(    AbstractTreeNode abstractTreeNode){
      if (result.isProcessed())       return false;
      return nonStopCondition.value(abstractTreeNode);
    }
  }
;
  if (alreadySelected == null) {
    expandPathTo(file,(AbstractTreeNode)getTreeStructure().getRootElement(),element,condition).doWhenDone(new AsyncResult.Handler<AbstractTreeNode>(){
      public void run(      AbstractTreeNode node){
        select(node,onDone);
      }
    }
).notifyWhenRejected(result);
  }
 else {
    select(alreadySelected,onDone);
  }
  return result;
}
