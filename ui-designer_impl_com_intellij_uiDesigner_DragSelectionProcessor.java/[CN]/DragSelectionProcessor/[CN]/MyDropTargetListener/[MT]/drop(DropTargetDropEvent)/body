{
  myGridInsertProcessor.removeFeedbackPainter();
  final int dropX=(int)dtde.getLocation().getX();
  final int dropY=(int)dtde.getLocation().getY();
  final int componentCount=myDraggedComponentList.getComponents().size();
  GridInsertProcessor.GridInsertLocation location=myGridInsertProcessor.getGridInsertLocation(dropX,dropY,myDraggedComponentList.getDragRelativeColumn());
  if (!myGridInsertProcessor.isDropInsertAllowed(location,componentCount)) {
    location=null;
  }
  if (!FormEditingUtil.canDrop(myEditor,dropX,dropY,componentCount) && (location == null || location.getMode() == GridInsertProcessor.GridInsertMode.None)) {
    return;
  }
  ArrayList<RadComponent> droppedComponents;
  if (dtde.getDropAction() == DnDConstants.ACTION_COPY) {
    final String serializedComponents=CutCopyPasteSupport.serializeForCopy(myEditor,myDraggedComponentList.getComponents());
    cancelDrag(myDraggedComponentList);
    TIntArrayList xs=new TIntArrayList();
    TIntArrayList ys=new TIntArrayList();
    droppedComponents=new ArrayList<RadComponent>();
    CutCopyPasteSupport.loadComponentsToPaste(myEditor,serializedComponents,xs,ys,droppedComponents);
  }
 else {
    droppedComponents=myDraggedComponentList.getComponents();
  }
  final int[] dx=new int[componentCount];
  final int[] dy=new int[componentCount];
  for (int i=0; i < componentCount; i++) {
    final RadComponent component=droppedComponents.get(i);
    dx[i]=component.getX() - dropX;
    dy[i]=component.getY() - dropY;
  }
  final RadComponent[] components=droppedComponents.toArray(new RadComponent[componentCount]);
  final GridConstraints[] originalConstraints=myDraggedComponentList.getOriginalConstraints();
  final RadContainer[] originalParents=myDraggedComponentList.getOriginalParents();
  if (location != null && location.getMode() != GridInsertProcessor.GridInsertMode.None) {
    myGridInsertProcessor.processGridInsertOnDrop(location,components,originalConstraints);
  }
 else {
    FormEditingUtil.drop(myEditor,dropX,dropY,components,dx,dy);
  }
  if (dtde.getDropAction() == DnDConstants.ACTION_COPY) {
    FormEditingUtil.clearSelection(myEditor.getRootContainer());
    for (    RadComponent component : droppedComponents) {
      component.setSelected(true);
      InsertComponentProcessor.createBindingWhenDrop(myEditor,component);
    }
  }
  for (int i=0; i < originalConstraints.length; i++) {
    if (originalParents[i].isGrid()) {
      FormEditingUtil.deleteEmptyGridCells(originalParents[i],originalConstraints[i]);
    }
  }
}
