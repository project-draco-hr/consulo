{
  ConcurrentMap<String,PsiPackage> map=myPackageCache.get(extensionClass);
  if (map != null) {
    final PsiPackage psiPackage=map.get(qualifiedName);
    if (psiPackage != null) {
      return psiPackage;
    }
  }
  final PsiPackage newPackage=createPackage(qualifiedName,extensionClass);
  if (newPackage != null) {
    if (map == null) {
      myPackageCache.put(extensionClass,map=new ConcurrentHashMap<String,PsiPackage>());
    }
    ConcurrencyUtil.cacheOrGet(map,qualifiedName,newPackage);
  }
  return newPackage;
}
