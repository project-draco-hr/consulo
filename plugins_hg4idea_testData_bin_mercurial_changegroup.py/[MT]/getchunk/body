def getchunk(source):
    "return the next chunk from changegroup 'source' as a string"
    d = source.read(4)
    if (not d):
        return ''
    l = struct.unpack('>l', d)[0]
    if (l <= 4):
        return ''
    d = source.read((l - 4))
    if (len(d) < (l - 4)):
        raise util.Abort((_('premature EOF reading chunk (got %d bytes, expected %d)') % (len(d), (l - 4))))
    return d
