def collector(cl, mmfs, files):

    def collect(node):
        c = cl.read(node)
        for fn in c[3]:
            files.setdefault(fn, fn)
        mmfs.setdefault(c[0], node)
    return collect
