{
  final int size;
  r.lock();
  try {
    size=myFutureInvalidations.size();
    if (size == 0)     return;
  }
  finally {
    r.unlock();
  }
  final ProgressIndicator current=ProgressManager.getInstance().getProgressIndicator();
  final ProgressIndicator indicator=current != null ? current : new EmptyProgressIndicator();
  indicator.setText("");
  int count=0;
  while (true) {
    InvalidationTask task;
    w.lock();
    try {
      task=myFutureInvalidations.poll();
    }
  finally {
      w.unlock();
    }
    if (task == null) {
      break;
    }
    indicator.setFraction(((double)count++) / size);
    indicator.setText2(task.getSubj().getPresentableUrl());
    task.run();
  }
}
