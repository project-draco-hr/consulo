{
  final VirtualFile file=fileContent.getVirtualFile();
  final boolean reallyRemoved;
  w.lock();
  try {
    reallyRemoved=myFilesToUpdate.remove(file);
  }
  finally {
    w.unlock();
  }
  if (reallyRemoved && file.isValid()) {
    if (onlyRemoveOutdatedData) {
      final List<ID<?,?>> affected=new ArrayList<ID<?,?>>();
      for (      final ID<?,?> indexId : myIndices.keySet()) {
        if (getInputFilter(indexId).acceptInput(file)) {
          affected.add(indexId);
        }
      }
      removeFileDataFromIndices(affected,file);
    }
 else {
      indexFileContent(project,fileContent);
    }
    IndexingStamp.flushCache();
  }
}
