{
  if (isDumb(project)) {
    handleDumbMode(indexId,project);
  }
  if (myReentrancyGuard.get().booleanValue()) {
    return;
  }
  myReentrancyGuard.set(Boolean.TRUE);
  try {
    myChangedFilesCollector.ensureAllInvalidateTasksCompleted();
    if (isUpToDateCheckEnabled()) {
      try {
        checkRebuild(indexId,false);
        myChangedFilesCollector.forceUpdate(project,filter);
        indexUnsavedDocuments(indexId,project,filter);
      }
 catch (      StorageException e) {
        scheduleRebuild(indexId,e);
      }
catch (      RuntimeException e) {
        final Throwable cause=e.getCause();
        if (cause instanceof StorageException || cause instanceof IOException) {
          scheduleRebuild(indexId,e);
        }
 else {
          throw e;
        }
      }
    }
  }
  finally {
    myReentrancyGuard.set(Boolean.FALSE);
  }
}
