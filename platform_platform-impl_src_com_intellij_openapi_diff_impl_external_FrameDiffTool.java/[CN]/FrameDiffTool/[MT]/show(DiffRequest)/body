{
  Collection hints=request.getHints();
  boolean shouldOpenDialog=shouldOpenDialog(hints);
  if (shouldOpenDialog) {
    final DialogBuilder builder=new DialogBuilder(request.getProject());
    DiffPanelImpl diffPanel=createDiffPanelIfShouldShow(request,builder.getWindow());
    if (diffPanel == null)     return;
    builder.setCenterPanel(diffPanel.getComponent());
    builder.addDisposable(diffPanel);
    builder.setPreferedFocusComponent(diffPanel.getPreferredFocusedComponent());
    builder.removeAllActions();
    builder.setTitle(request.getWindowTitle());
    builder.setDimensionServiceKey(request.getGroupKey());
    new AnAction(){
      public void actionPerformed(      final AnActionEvent e){
        builder.getDialogWrapper().close(0);
      }
    }
.registerCustomShortcutSet(new CustomShortcutSet(KeymapManager.getInstance().getActiveKeymap().getShortcuts("CloseContent")),diffPanel.getComponent());
    showDiffDialog(builder,hints);
  }
 else {
    final FrameWrapper frameWrapper=new FrameWrapper(request.getProject(),request.getGroupKey());
    DiffPanelImpl diffPanel=createDiffPanelIfShouldShow(request,frameWrapper.getFrame());
    if (diffPanel == null)     return;
    frameWrapper.setTitle(request.getWindowTitle());
    DiffUtil.initDiffFrame(frameWrapper,diffPanel);
    new AnAction(){
      public void actionPerformed(      final AnActionEvent e){
        frameWrapper.getFrame().dispose();
      }
    }
.registerCustomShortcutSet(new CustomShortcutSet(KeymapManager.getInstance().getActiveKeymap().getShortcuts("CloseContent")),diffPanel.getComponent());
    frameWrapper.show();
  }
}
