{
  final PsiElement context=file.getContext();
  if (context != null)   file=context.getContainingFile();
  if (useIncludingFileAsContext()) {
    final FileContextProvider contextProvider=FileContextProvider.getProvider(file);
    if (contextProvider != null) {
      final Collection<PsiFileSystemItem> folders=contextProvider.getContextFolders(file);
      if (!folders.isEmpty()) {
        return folders;
      }
      final PsiFile contextFile=contextProvider.getContextFile(file);
      if (contextFile != null) {
        return Collections.singleton(contextFile.getParent());
      }
    }
  }
  return getContextByFileSystemItem(file.getOriginalFile());
}
