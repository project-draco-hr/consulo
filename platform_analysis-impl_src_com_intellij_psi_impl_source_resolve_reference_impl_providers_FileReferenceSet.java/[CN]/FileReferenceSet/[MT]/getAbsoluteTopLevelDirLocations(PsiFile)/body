{
  final VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile == null)   return Collections.emptyList();
  final PsiDirectory parent=file.getParent();
  final Module module=ModuleUtilCore.findModuleForPsiElement(parent == null ? file : parent);
  if (module == null)   return Collections.emptyList();
  final List<PsiFileSystemItem> list=new ArrayList<>();
  final Project project=file.getProject();
  for (  FileReferenceHelper helper : FileReferenceHelperRegistrar.getHelpers()) {
    if (helper.isMine(project,virtualFile)) {
      if (helper.isFallback() && !list.isEmpty()) {
        continue;
      }
      final Collection<PsiFileSystemItem> roots=helper.getRoots(module);
      for (      PsiFileSystemItem root : roots) {
        if (root == null) {
          LOG.error("Helper " + helper + " produced a null root for "+ file);
        }
      }
      list.addAll(roots);
    }
  }
  return list;
}
