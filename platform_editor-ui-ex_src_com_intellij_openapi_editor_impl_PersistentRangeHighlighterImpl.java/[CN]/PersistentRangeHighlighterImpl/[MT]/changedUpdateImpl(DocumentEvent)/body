{
  DocumentEventImpl event=(DocumentEventImpl)e;
  final boolean shouldTranslateViaDiff=isValid() && PersistentRangeMarkerUtil.shouldTranslateViaDiff(event,getStartOffset(),getEndOffset());
  boolean wasTranslatedViaDiff=shouldTranslateViaDiff;
  if (shouldTranslateViaDiff) {
    wasTranslatedViaDiff=translatedViaDiff(e,event);
  }
  if (!wasTranslatedViaDiff) {
    super.changedUpdateImpl(e);
    if (isValid()) {
      myLine=getDocument().getLineNumber(getStartOffset());
      int endLine=getDocument().getLineNumber(getEndOffset());
      if (endLine != myLine) {
        setIntervalEnd(getDocument().getLineEndOffset(myLine));
      }
    }
  }
  if (isValid() && getTargetArea() == HighlighterTargetArea.LINES_IN_RANGE) {
    setIntervalStart(DocumentUtil.getFirstNonSpaceCharOffset(getDocument(),myLine));
    setIntervalEnd(getDocument().getLineEndOffset(myLine));
  }
}
