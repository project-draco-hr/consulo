{
  final GwtVirtualFile gwtVirtualFile=new GwtVirtualFile();
  gwtVirtualFile.url=virtualFile.getUrl();
  gwtVirtualFile.name=virtualFile.getName();
  gwtVirtualFile.isDirectory=virtualFile.isDirectory();
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    @Override public void run(){
      Icon icon=IconUtil.getIcon(virtualFile,Iconable.ICON_FLAG_READ_STATUS | Iconable.ICON_FLAG_VISIBILITY,project);
      if (icon instanceof DeferredIcon) {
        icon=((DeferredIcon)icon).evaluate();
      }
      if (setIconLayers(icon,gwtVirtualFile.iconLayers)) {
        return;
      }
      if (icon instanceof RowIcon) {
        int iconCount=((RowIcon)icon).getIconCount();
        for (int i=0; i < iconCount; i++) {
          Icon nextIcon=((RowIcon)icon).getIcon(i);
          if (i == 0) {
            setIconLayers(nextIcon,gwtVirtualFile.iconLayers);
          }
 else           if (i == 1) {
            List<String> list=new SmartList<String>();
            setIconLayers(nextIcon,list);
            if (!list.isEmpty()) {
              gwtVirtualFile.rightIcon=list.get(0);
            }
          }
        }
      }
    }
  }
);
  VirtualFile[] children=virtualFile.getChildren();
  for (  VirtualFile child : children) {
    gwtVirtualFile.children.add(createVirtualFile(project,child));
  }
  return gwtVirtualFile;
}
