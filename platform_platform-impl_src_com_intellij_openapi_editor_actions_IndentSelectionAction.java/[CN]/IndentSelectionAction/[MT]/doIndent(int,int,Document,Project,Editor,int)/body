{
  boolean bulkMode=endIndex - startIndex > 50;
  if (bulkMode)   ((DocumentEx)document).setInBulkUpdate(true);
  try {
    PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(document);
    IndentStrategy indentStrategy=LanguageIndentStrategy.getIndentStrategy(file);
    List<Integer> nonModifiableLines=new ArrayList<Integer>();
    if (!LanguageIndentStrategy.isDefault(indentStrategy)) {
      for (int i=startIndex; i <= endIndex; i++) {
        if (!canIndent(document,file,i,indentStrategy)) {
          nonModifiableLines.add(i);
        }
      }
    }
    for (int i=startIndex; i <= endIndex; i++) {
      if (!nonModifiableLines.contains(i)) {
        EditorActionUtil.indentLine(project,editor,i,blockIndent);
      }
    }
  }
  finally {
    if (bulkMode)     ((DocumentEx)document).setInBulkUpdate(false);
  }
}
