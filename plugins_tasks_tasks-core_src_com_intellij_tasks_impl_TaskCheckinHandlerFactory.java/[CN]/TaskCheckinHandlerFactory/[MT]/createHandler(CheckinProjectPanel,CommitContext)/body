{
  return new CheckinHandler(){
    @Override public void checkinSuccessful(){
      final String message=panel.getCommitMessage();
      if (message != null) {
        final Project project=panel.getProject();
        final TaskManagerImpl manager=(TaskManagerImpl)TaskManager.getManager(project);
        if (manager.getState().saveContextOnCommit) {
          final Task task=findTask(message,manager);
          SwingUtilities.invokeLater(new Runnable(){
            @Override public void run(){
              final WorkingContextManager contextManager=WorkingContextManager.getInstance(project);
              if (task != null) {
                LocalTask localTask=manager.addTask(task);
                localTask.setUpdated(new Date());
                contextManager.saveContext(localTask);
              }
 else {
                contextManager.saveContext(null,message);
              }
            }
          }
);
        }
      }
    }
  }
;
}
