{
  @SuppressWarnings("IOResourceOpenedButNotSafelyClosed") final InputStream stream=loader.getResourceAsStream(templateName);
  if (stream == null) {
    throw new IOException("Template '" + templateName + "' not found by "+ loader);
  }
  final String template=FileUtil.loadTextAndClose(stream);
  if (variables == null || variables.size() == 0) {
    return template;
  }
  final StringBuilder buffer=new StringBuilder(template);
  for (  Map.Entry<String,String> var : variables.entrySet()) {
    final String name=var.getKey();
    final int pos=buffer.indexOf(name);
    if (pos >= 0) {
      buffer.replace(pos,pos + name.length(),var.getValue());
    }
  }
  return buffer.toString();
}
