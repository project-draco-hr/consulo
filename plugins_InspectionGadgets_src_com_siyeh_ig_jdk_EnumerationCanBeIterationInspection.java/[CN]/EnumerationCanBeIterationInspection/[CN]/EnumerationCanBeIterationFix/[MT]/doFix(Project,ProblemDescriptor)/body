{
  final PsiElement element=descriptor.getPsiElement();
  final PsiReferenceExpression methodExpression=(PsiReferenceExpression)element.getParent();
  final PsiMethodCallExpression methodCallExpression=(PsiMethodCallExpression)methodExpression.getParent();
  final PsiElement parent=methodCallExpression.getParent();
  final PsiVariable variable;
  final PsiAssignmentExpression assignmentExpression;
  if (parent instanceof PsiVariable) {
    variable=(PsiVariable)parent;
    assignmentExpression=null;
  }
 else   if (parent instanceof PsiAssignmentExpression) {
    assignmentExpression=(PsiAssignmentExpression)parent;
    final PsiExpression lhs=assignmentExpression.getLExpression();
    if (!(lhs instanceof PsiReferenceExpression)) {
      return;
    }
    final PsiReferenceExpression referenceExpression=(PsiReferenceExpression)lhs;
    final PsiElement target=referenceExpression.resolve();
    if (!(target instanceof PsiVariable)) {
      return;
    }
    variable=(PsiVariable)target;
  }
 else {
    return;
  }
  final String variableName=createVariableName(element);
  final PsiStatement statement=PsiTreeUtil.getParentOfType(element,PsiStatement.class);
  if (statement == null) {
    return;
  }
  final boolean deleteInitialization=replaceMethodCalls(variable,statement.getTextOffset(),variableName);
  final PsiStatement newStatement=createDeclaration(methodCallExpression,variableName);
  if (newStatement == null) {
    return;
  }
  final PsiElement statementParent=statement.getParent();
  statementParent.addAfter(newStatement,statement);
  if (deleteInitialization) {
    if (assignmentExpression == null) {
      variable.delete();
    }
 else {
      assignmentExpression.delete();
    }
  }
}
