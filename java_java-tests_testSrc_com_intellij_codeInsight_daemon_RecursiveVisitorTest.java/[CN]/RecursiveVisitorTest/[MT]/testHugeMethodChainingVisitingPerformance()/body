{
  StringBuilder text=new StringBuilder("Object s = new StringBuilder()");
  final int N=1500;
  for (int i=0; i < N; i++) {
    text.append(".append(\"xxx\")");
  }
  text.append(";");
  final PsiElement expression=JavaPsiFacade.getInstance(getProject()).getElementFactory().createStatementFromText(text.toString(),null);
  final int[] n={0};
  PlatformTestUtil.startPerformanceTest(100,new ThrowableRunnable(){
    @Override public void run() throws Exception {
      n[0]=0;
      expression.accept(new JavaRecursiveElementWalkingVisitor(){
        @Override public void visitMethodCallExpression(        PsiMethodCallExpression expression){
          super.visitMethodCallExpression(expression);
          n[0]++;
        }
      }
);
      assertEquals(N,n[0]);
    }
  }
).cpuBound().assertTiming();
}
