{
  ChangesCacheFile cacheFile=new ChangesCacheFile(getCachePath(location),provider,location);
  if (cacheFile.isEmpty()) {
    List<CommittedChangeList> changes=provider.getCommittedChanges(provider.createDefaultSettings(),location,0);
    try {
      cacheFile.writeChanges(changes);
    }
 catch (    IOException e) {
      LOG.error(e);
    }
    settings.filterChanges(changes);
    return changes;
  }
 else {
    try {
      List<CommittedChangeList> changes=cacheFile.readChanges(settings);
      final Date date=cacheFile.getLastCachedDate();
      final ChangeBrowserSettings defaultSettings=provider.createDefaultSettings();
      defaultSettings.setDateAfter(date);
      List<CommittedChangeList> newChanges=provider.getCommittedChanges(defaultSettings,location,0);
      newChanges=cacheFile.writeChanges(newChanges);
      settings.filterChanges(newChanges);
      changes.addAll(newChanges);
      return changes;
    }
 catch (    IOException e) {
      LOG.error(e);
    }
  }
  return provider.getCommittedChanges(settings,location,maxCount);
}
