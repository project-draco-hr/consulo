{
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    refreshCacheSync(cache,postRunnable);
    return;
  }
  final Task task=new Task.Backgroundable(myProject,"Refreshing VCS history"){
    private boolean hasNewChanges=false;
    public void run(    final ProgressIndicator indicator){
      try {
        final List<CommittedChangeList> list=refreshCache(cache);
        hasNewChanges=(list.size() > 0);
      }
 catch (      Exception e) {
        LOG.error(e);
      }
    }
    public void onSuccess(){
      if (postRunnable != null && hasNewChanges) {
        postRunnable.run();
      }
    }
  }
;
  ProgressManager.getInstance().run(task);
}
