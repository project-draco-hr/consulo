{
  GitSimpleHandler handler=new GitSimpleHandler(myProject,myVcsRoot,"diff");
  handler.addParameters("--name-status","--diff-filter=ADCMRUX","-M","HEAD");
  handler.setNoSSH(true);
  handler.setSilent(true);
  handler.endOptions();
  try {
    String output=handler.run();
    String[] lines=output.split("\n");
    GitChangeUtils.parseChanges(myProject,myVcsRoot,null,GitChangeUtils.loadRevision(myProject,myVcsRoot,"HEAD"),lines,0,myChanges,myUnmergedNames);
  }
 catch (  VcsException ex) {
    if (!GitChangeUtils.isHeadMissing(ex)) {
      throw ex;
    }
    handler=new GitSimpleHandler(myProject,myVcsRoot,"ls-files");
    handler.addParameters("--cached");
    handler.setNoSSH(true);
    handler.setSilent(true);
    String output=handler.run();
    if (output.length() > 0) {
      StringTokenizer tokenizer=new StringTokenizer(output,"\n\r");
      while (tokenizer.hasMoreTokens()) {
        final String s=tokenizer.nextToken();
        Change ch=new Change(null,GitContentRevision.createRevision(myVcsRoot,s,null,myProject,false),FileStatus.ADDED);
        myChanges.add(ch);
      }
    }
  }
}
