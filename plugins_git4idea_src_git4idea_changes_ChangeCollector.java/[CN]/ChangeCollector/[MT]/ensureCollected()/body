{
  if (myIsCollected) {
    if (myIsFailed) {
      throw new IllegalStateException("The method should not be called after after exception has been thrown.");
    }
 else {
      return;
    }
  }
  myIsCollected=true;
  updateIndex();
  myHeadRevision=GitChangeUtils.loadRevision(myProject,myVcsRoot,"HEAD");
  final Collection<FilePath> dirtyPaths=getDirtyPaths();
  collectIndexChanges(dirtyPaths);
  collectWorkingTreeChanges(dirtyPaths);
  myIsFailed=false;
}
