{
  if (!myFailureDetected) {
    try {
      boolean newValue=User32.INSTANCE.GetSystemMetrics(0x1000) != 0;
      LOG.debug("Detected remote desktop: ",newValue);
      if (newValue != myRemoteDesktopConnected) {
        myRemoteDesktopConnected=newValue;
        if (myRemoteDesktopConnected) {
          ApplicationManager.getApplication().invokeLater(new Runnable(){
            @Override public void run(){
              Notifications.Bus.notify(new Notification(Notifications.SYSTEM_MESSAGES_GROUP_ID,ApplicationBundle.message("remote.desktop.detected.title"),ApplicationBundle.message("remote.desktop.detected.message"),NotificationType.INFORMATION));
            }
          }
);
        }
      }
    }
 catch (    Throwable e) {
      myRemoteDesktopConnected=false;
      myFailureDetected=true;
      LOG.warn("Error while calling GetSystemMetrics",e);
    }
  }
}
