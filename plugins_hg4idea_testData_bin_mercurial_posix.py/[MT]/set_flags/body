def set_flags(f, l, x):
    s = os.lstat(f).st_mode
    if l:
        if (not stat.S_ISLNK(s)):
            data = open(f).read()
            os.unlink(f)
            try:
                os.symlink(data, f)
            except:
                open(f, 'w').write(data)
        return
    if stat.S_ISLNK(s):
        data = os.readlink(f)
        os.unlink(f)
        open(f, 'w').write(data)
        s = (438 & (~ umask))
    sx = (s & 64)
    if (x and (not sx)):
        os.chmod(f, (s | (((s & 292) >> 2) & (~ umask))))
    elif ((not x) and sx):
        os.chmod(f, (s & 438))
