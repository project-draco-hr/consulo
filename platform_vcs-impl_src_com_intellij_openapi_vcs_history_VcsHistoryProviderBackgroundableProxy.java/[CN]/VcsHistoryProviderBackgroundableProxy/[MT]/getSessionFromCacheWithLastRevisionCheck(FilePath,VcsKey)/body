{
  final ProgressIndicator pi=ProgressManager.getInstance().getProgressIndicator();
  if (pi != null) {
    pi.setText2("Checking last revision");
  }
  final VcsAbstractHistorySession cached=myVcsHistoryCache.getFull(filePath,vcsKey,(VcsCacheableHistorySessionFactory<Serializable,VcsAbstractHistorySession>)myDelegate);
  if (cached == null)   return null;
  final FilePath correctedFilePath=((VcsCacheableHistorySessionFactory<Serializable,VcsAbstractHistorySession>)myDelegate).getUsedFilePath(cached);
  final ItemLatestState lastRevision=myDiffProvider.getLastRevision(correctedFilePath != null ? correctedFilePath : filePath);
  if (lastRevision != null && !lastRevision.isDefaultHead() && lastRevision.isItemExists()) {
    final List<VcsFileRevision> revisionList=cached.getRevisionList();
    if (!revisionList.isEmpty() && revisionList.get(0).getRevisionNumber().equals(lastRevision.getNumber())) {
      return cached;
    }
  }
  return null;
}
