{
  final ProjectLevelVcsManagerImpl vcsManager=(ProjectLevelVcsManagerImpl)ProjectLevelVcsManager.getInstance(myProject);
  final VcsBackgroundableActions resultingActionKey=actionKey == null ? VcsBackgroundableActions.CREATE_HISTORY_SESSION : actionKey;
  final BackgroundableActionEnabledHandler handler;
  handler=vcsManager.getBackgroundableActionHandler(resultingActionKey);
  if (handler.isInProgress(resultingActionKey))   return;
  handler.register(resultingActionKey);
  ProgressManager.getInstance().run(new Task.Backgroundable(myProject,VcsBundle.message("loading.file.history.progress"),true,BackgroundFromStartOption.getInstance()){
    @Override public void run(    @NotNull ProgressIndicator indicator){
      try {
        myDelegate.reportAppendableHistory(filePath,partner);
      }
 catch (      VcsException e) {
        partner.reportException(e);
      }
 finally {
        partner.finished();
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          public void run(){
            handler.completed(resultingActionKey);
          }
        }
,ModalityState.NON_MODAL);
      }
    }
  }
);
}
