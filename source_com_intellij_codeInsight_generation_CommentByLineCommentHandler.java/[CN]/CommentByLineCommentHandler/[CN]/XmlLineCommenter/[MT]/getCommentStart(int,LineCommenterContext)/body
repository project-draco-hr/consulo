{
  if (offset > context.getDocument().getTextLength() - "<!--".length())   return -1;
  if (!CharArrayUtil.regionMatches(context.getChars(),offset,"<!--"))   return -1;
  PsiDocumentManager.getInstance(context.getProject()).commitDocument(context.getDocument());
  PsiElement element=context.getFile().findElementAt(offset);
  if (element instanceof XmlToken && element.getTextRange().getStartOffset() == offset) {
    XmlToken token=(XmlToken)element;
    if (token.getTokenType() == XmlTokenType.XML_COMMENT_START) {
      return offset;
    }
  }
  return offset;
}
