{
  final Document myDocument=context.getDocument();
  if (!initialized) {
    PsiDocumentManager.getInstance(context.getProject()).commitAllDocuments();
    myJavaComment=true;
    for (int line1=context.getStartLine(); line1 <= context.getEndLine(); line1++) {
      int offset1=myDocument.getLineStartOffset(line1);
      final PsiElement elementAt=context.getFile().findElementAt(offset1);
      if (elementAt instanceof JspToken) {
        myJavaComment=false;
      }
    }
    initialized=true;
  }
  if (myJavaComment) {
    myDocument.insertString(offset,"//");
  }
 else {
    myDocument.insertString(offset,"<%--");
    myDocument.insertString(myDocument.getLineEndOffset(line),"--%>");
  }
}
