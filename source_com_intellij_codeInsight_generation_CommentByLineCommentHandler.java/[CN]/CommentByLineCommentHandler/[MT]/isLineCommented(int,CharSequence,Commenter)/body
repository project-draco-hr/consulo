{
  boolean commented;
  String prefix=commenter.getLineCommentPrefix();
  int lineStart=myDocument.getLineStartOffset(line);
  lineStart=CharArrayUtil.shiftForward(chars,lineStart," \t");
  if (prefix != null) {
    commented=CharArrayUtil.regionMatches(chars,lineStart,prefix);
    if (commented) {
      myStartOffsets[line - myLine1]=lineStart;
      myEndOffsets[line - myLine1]=-1;
    }
  }
 else {
    prefix=commenter.getBlockCommentPrefix();
    String suffix=commenter.getBlockCommentSuffix();
    int lineEnd=myDocument.getLineEndOffset(line);
    final int textLength=myDocument.getTextLength();
    if (lineEnd == textLength) {
      final int shifted=CharArrayUtil.shiftBackward(chars,textLength - 1," \t");
      if (shifted < textLength - 1)       lineEnd=shifted;
    }
 else {
      lineEnd=CharArrayUtil.shiftBackward(chars,lineEnd," \t");
    }
    commented=CharArrayUtil.regionMatches(chars,lineStart,prefix) && CharArrayUtil.regionMatches(chars,lineEnd - suffix.length(),suffix);
    if (commented) {
      myStartOffsets[line - myLine1]=lineStart;
      myEndOffsets[line - myLine1]=lineEnd;
    }
  }
  return commented;
}
