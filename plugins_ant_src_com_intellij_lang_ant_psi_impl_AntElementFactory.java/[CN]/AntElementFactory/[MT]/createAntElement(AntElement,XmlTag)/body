{
  instantiate();
  final String elementName=tag.getName();
  if ("target".equals(elementName)) {
    return new AntTargetImpl(parent,tag);
  }
  final Class taskClass=AntDefaultIntrospector.getTaskClass(elementName);
  if (taskClass != null) {
    AntTaskCreator antTaskCreator=antTaskTypeToKnownAntTaskCreatorMap.get(taskClass);
    if (antTaskCreator != null) {
      return antTaskCreator.create(parent,tag);
    }
  }
  if (parent instanceof AntTask) {
    AntTask task=(AntTask)parent;
    final Class elementType=task.getNestedElementType(task.getSourceElement().getName());
    if (elementType != null) {
      AntTaskCreator antTaskCreator=antTaskTypeToKnownAntTaskCreatorMap.get(elementType);
      if (antTaskCreator != null) {
        return antTaskCreator.create(parent,tag);
      }
    }
  }
  return new AntElementImpl(parent,tag);
}
