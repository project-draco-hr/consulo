{
  super.onBeforeDocumentChange(e);
  if (myDiffChanges.isEmpty())   return;
  List<Document> documents=ContainerUtil.map(getEditors(),new Function<EditorEx,Document>(){
    @Override public Document fun(    EditorEx editorEx){
      return editorEx.getDocument();
    }
  }
);
  ThreeSide side=ThreeSide.fromValue(documents,e.getDocument());
  if (side == null) {
    LOG.warn("Unknown document changed");
    return;
  }
  int line1=e.getDocument().getLineNumber(e.getOffset());
  int line2=e.getDocument().getLineNumber(e.getOffset() + e.getOldLength()) + 1;
  int shift=DiffUtil.countLinesShift(e);
  List<SimpleThreesideDiffChange> invalid=new ArrayList<SimpleThreesideDiffChange>();
  for (  SimpleThreesideDiffChange change : myDiffChanges) {
    if (change.processChange(line1,line2,shift,side)) {
      invalid.add(change);
    }
  }
  if (!invalid.isEmpty()) {
    myDiffChanges.removeAll(invalid);
    myInvalidDiffChanges.addAll(invalid);
  }
}
