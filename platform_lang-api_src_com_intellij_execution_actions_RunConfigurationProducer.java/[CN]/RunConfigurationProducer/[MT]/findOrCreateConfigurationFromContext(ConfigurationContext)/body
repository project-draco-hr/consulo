{
  Location location=context.getLocation();
  if (location == null) {
    return null;
  }
  ConfigurationFromContext fromContext=createConfigurationFromContext(context);
  if (fromContext != null) {
    final PsiElement psiElement=fromContext.getSourceElement();
    final Location<PsiElement> _location=PsiLocation.fromPsiElement(psiElement,location.getModule());
    if (_location != null) {
      final RunManager runManager=RunManager.getInstance(context.getProject());
      final ConfigurationType type=fromContext.getConfigurationType();
      final List<RunnerAndConfigurationSettings> configurations=runManager.getConfigurationSettingsList(type);
      final RunnerAndConfigurationSettings settings=findExistingConfiguration(context);
      if (settings != null) {
        fromContext.setConfigurationSettings(settings);
      }
 else {
        final ArrayList<String> currentNames=new ArrayList<String>();
        for (        RunnerAndConfigurationSettings configurationSettings : configurations) {
          currentNames.add(configurationSettings.getName());
        }
        RunConfiguration configuration=fromContext.getConfiguration();
        String name=configuration.getName();
        if (name == null) {
          LOG.error(configuration);
          name="Unnamed";
        }
        configuration.setName(RunManager.suggestUniqueName(name,currentNames));
      }
    }
  }
  return fromContext;
}
