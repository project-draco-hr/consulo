{
synchronized (ourAppendersCache) {
    final AppenderCacheKey key=new AppenderCacheKey(record,this);
    AppenderStream appenderStream=ourAppendersCache.get(key);
    if (appenderStream != null) {
      if (appenderStream.size() > 4048) {
        closeStream(appenderStream);
      }
 else {
        return appenderStream;
      }
    }
    appenderStream=new AppenderStream(this,record);
    ourAppendersCache.put(key,appenderStream);
    return appenderStream;
  }
}
