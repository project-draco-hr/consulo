{
  PsiElement refNameElement=ref.getReferenceNameElement();
  if (refNameElement == null)   return null;
  if (!isInspectionEnabled(ref.getContainingFile(),ref.getProject()))   return null;
  GrUnresolvedAccessInspection inspection=getInstance(ref.getContainingFile(),ref.getProject());
  boolean cannotBeDynamic=PsiUtil.isCompileStatic(ref) || isPropertyAccessInStaticMethod(ref);
  GroovyResolveResult resolveResult=getBestResolveResult(ref);
  if (resolveResult.getElement() != null) {
    if (isStaticOk(resolveResult))     return null;
    String message=GroovyBundle.message("cannot.reference.nonstatic",ref.getReferenceName());
    return createAnnotationForRef(ref,cannotBeDynamic,message);
  }
  if (ResolveUtil.isKeyOfMap(ref)) {
    return HighlightInfo.createHighlightInfo(HighlightInfoType.INFORMATION,refNameElement,null,MAP_KEY_ATTRIBUTES);
  }
  if (!cannotBeDynamic) {
    if (!inspection.myHighlightIfGroovyObjectOverridden && areGroovyObjectMethodsOverridden(ref))     return null;
    if (!inspection.myHighlightIfMissingMethodsDeclared && areMissingMethodsDeclared(ref))     return null;
    if (GroovySuppressableInspectionTool.isElementToolSuppressedIn(ref,SHORT_NAME))     return null;
  }
  if (cannotBeDynamic || shouldHighlightAsUnresolved(ref)) {
    HighlightInfo info=createAnnotationForRef(ref,cannotBeDynamic,GroovyBundle.message("cannot.resolve",ref.getReferenceName()));
    HighlightDisplayKey displayKey=HighlightDisplayKey.find(SHORT_NAME);
    if (isCall(ref)) {
      registerStaticImportFix(ref,info,displayKey);
    }
 else {
      registerCreateClassByTypeFix(ref,info,displayKey);
      registerAddImportFixes(ref,info,displayKey);
    }
    registerReferenceFixes(ref,info,cannotBeDynamic,displayKey);
    UnresolvedReferenceQuickFixProvider.registerReferenceFixes(ref,new QuickFixActionRegistrarAdapter(info,displayKey));
    OrderEntryFix.registerFixes(new QuickFixActionRegistrarAdapter(info,displayKey),ref);
    return info;
  }
  return null;
}
