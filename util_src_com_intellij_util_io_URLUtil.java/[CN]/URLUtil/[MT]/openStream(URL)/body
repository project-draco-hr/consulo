{
  @NonNls final String protocol=url.getProtocol();
  try {
    if (protocol.equals("jar")) {
      return openJarStream(url);
    }
    return url.openStream();
  }
 catch (  FileNotFoundException ex) {
    String file=null;
    if (protocol.equals("file")) {
      file=url.getFile();
    }
 else     if (protocol.equals("jar")) {
      int pos=url.getFile().indexOf("!");
      if (pos >= 0) {
        file=url.getFile().substring(pos + 1);
      }
    }
    if (file != null && file.startsWith("/")) {
      InputStream resourceStream=URLUtil.class.getResourceAsStream(file);
      if (resourceStream != null)       return resourceStream;
    }
    throw ex;
  }
}
