{
  try {
    if (isCreateInnerClass()) {
      myInnerClass=(PsiClass)getMethod().getContainingClass().add(myElementFactory.createClass(getInnerClassName()));
      final boolean isStatic=copyMethodModifiers() && notHasGeneratedFields();
      for (      UsageInfo usage : usages) {
        final PsiMethodCallExpression methodCallExpression=PsiTreeUtil.getParentOfType(usage.getElement(),PsiMethodCallExpression.class);
        if (methodCallExpression != null) {
          replaceMethodCallExpression(inferTypeArguments(methodCallExpression),methodCallExpression);
        }
      }
      if (myExtractProcessor.generatesConditionalExit()) {
        myInnerClass.add(myElementFactory.createField("myResult",PsiPrimitiveType.BOOLEAN));
        myInnerClass.add(myElementFactory.createMethodFromText("boolean is(){return myResult;}",myInnerClass));
      }
      final PsiParameter[] parameters=getMethod().getParameterList().getParameters();
      if (parameters.length > 0) {
        createInnerClassConstructor(parameters);
      }
 else       if (isStatic) {
        final PsiMethod copy=(PsiMethod)getMethod().copy();
        copy.setName("invoke");
        myInnerClass.add(copy);
        if (myMultipleExitPoints) {
          addOutputVariableFieldsWithGetters();
        }
        return;
      }
      if (myMultipleExitPoints) {
        addOutputVariableFieldsWithGetters();
      }
      myCopyMethodToInner=new Runnable(){
        public void run(){
          copyMethodWithoutParameters();
          copyMethodTypeParameters();
        }
      }
;
    }
 else {
      for (      UsageInfo usage : usages) {
        final PsiMethodCallExpression methodCallExpression=PsiTreeUtil.getParentOfType(usage.getElement(),PsiMethodCallExpression.class);
        if (methodCallExpression != null) {
          methodCallExpression.replace(processMethodDeclaration(methodCallExpression.getArgumentList()));
        }
      }
    }
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
}
