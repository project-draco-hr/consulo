{
  final JPanel topPanel=new JPanel(new BorderLayout());
  final JPanel wrapper=new JPanel();
  final BoxLayout boxLayout=new BoxLayout(wrapper,BoxLayout.X_AXIS);
  wrapper.setLayout(boxLayout);
  final JLabel label=new JLabel(myFilePath);
  label.setBorder(BorderFactory.createEmptyBorder(1,2,0,0));
  wrapper.add(label);
  topPanel.add(wrapper,BorderLayout.CENTER);
  myPanel.add(topPanel,BorderLayout.NORTH);
  final JPanel wrapperDiffs=new JPanel(new GridBagLayout());
  final JPanel oneMore=new JPanel(new BorderLayout());
  oneMore.add(wrapperDiffs,BorderLayout.NORTH);
  final LineNumberConvertor oldConvertor=new LineNumberConvertor();
  final LineNumberConvertor newConvertor=new LineNumberConvertor();
  final StringBuilder sbOld=new StringBuilder();
  final StringBuilder sbNew=new StringBuilder();
  final List<BeforeAfter<Integer>> ranges=new ArrayList<BeforeAfter<Integer>>();
  BeforeAfter<Integer> lines=new BeforeAfter<Integer>(0,0);
  for (  BeforeAfter<TextRange> lineNumbers : myFragmentedContent.getRanges()) {
    ranges.add(lines);
    oldConvertor.put(lines.getBefore(),lineNumbers.getBefore().getStartOffset());
    newConvertor.put(lines.getAfter(),lineNumbers.getAfter().getStartOffset());
    final Document document=myFragmentedContent.getBefore();
    if (sbOld.length() > 0) {
      sbOld.append('\n');
    }
    sbOld.append(document.getText(new TextRange(document.getLineStartOffset(lineNumbers.getBefore().getStartOffset()),document.getLineEndOffset(lineNumbers.getBefore().getEndOffset()))));
    final Document document1=myFragmentedContent.getAfter();
    if (sbNew.length() > 0) {
      sbNew.append('\n');
    }
    sbNew.append(document1.getText(new TextRange(document1.getLineStartOffset(lineNumbers.getAfter().getStartOffset()),document1.getLineEndOffset(lineNumbers.getAfter().getEndOffset()))));
    int before=lines.getBefore() + lineNumbers.getBefore().getEndOffset() - lineNumbers.getBefore().getStartOffset() + 1;
    int after=lines.getAfter() + lineNumbers.getAfter().getEndOffset() - lineNumbers.getAfter().getStartOffset() + 1;
    lines=new BeforeAfter<Integer>(before,after);
  }
  ranges.add(new BeforeAfter<Integer>(lines.getBefore() == 0 ? 0 : lines.getBefore() - 1,lines.getAfter() == 0 ? 0 : lines.getAfter() - 1));
  final DiffPanel diffPanel=myMyDiffPanelHolder.getOrCreate();
  final FragmentedDiffPanelState diffPanelState=(FragmentedDiffPanelState)((DiffPanelImpl)diffPanel).getDiffPanelState();
  diffPanelState.setRanges(ranges);
  diffPanel.setContents(new SimpleContent(sbOld.toString()),new SimpleContent(sbNew.toString()));
  ((DiffPanelImpl)diffPanel).setLineNumberConvertors(oldConvertor,newConvertor);
  ((DiffPanelImpl)diffPanel).prefferedSizeByContents(-1);
  myPanel.add(diffPanel.getComponent(),BorderLayout.CENTER);
}
