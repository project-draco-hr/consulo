{
  final Editor editor=((DiffPanelImpl)getCurrentPanel()).getEditor1();
  Rectangle visibleArea=editor.getScrollingModel().getVisibleArea();
  final int offset=editor.getScrollingModel().getVerticalScrollOffset();
  int leftPixels=offset % editor.getLineHeight();
  final Point start=visibleArea.getLocation();
  final LogicalPosition startLp=editor.xyToLogicalPosition(start);
  final Point location=new Point(start.x + visibleArea.width,start.y + visibleArea.height);
  final LogicalPosition lp=editor.xyToLogicalPosition(location);
  int curStartLine=startLp.line == editor.getDocument().getLineCount() - 1 ? startLp.line : startLp.line + 1;
  int cutEndLine=lp.line == 0 ? 0 : lp.line - 1;
  boolean commonPartOk=leftPixels == 0 || startLp.line == lp.line;
  return new BeforeAfter<Integer>(commonPartOk && startLp.softWrapLinesOnCurrentLogicalLine == 0 ? startLp.line : curStartLine,commonPartOk && lp.softWrapLinesOnCurrentLogicalLine == 0 ? lp.line : cutEndLine);
}
