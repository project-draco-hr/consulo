{
  if (ApplicationManagerEx.getApplicationEx().isDoNotSave())   return;
  if (mySavingInProgress.compareAndSet(false,true)) {
    try {
      doSave();
    }
 catch (    IComponentStore.SaveCancelledException e) {
      LOG.info(e);
    }
catch (    PluginException e) {
      PluginManager.disablePlugin(e.getPluginId().getIdString());
      MessagesEx.error(this,"The plugin " + e.getPluginId() + " failed to save settings and has been disabled. Please restart "+ ApplicationNamesInfo.getInstance().getFullProductName()+ (ApplicationManagerEx.getApplicationEx().isInternal() ? "\n" + StringUtil.getThrowableText(e) : ""));
    }
catch (    IOException e) {
      MessagesEx.error(this,ProjectBundle.message("project.save.error",ApplicationManagerEx.getApplicationEx().isInternal() ? StringUtil.getThrowableText(e) : e.getMessage())).showLater();
    }
 finally {
      mySavingInProgress.set(false);
    }
  }
}
