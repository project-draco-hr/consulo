{
  if (ApplicationManagerEx.getApplicationEx().isDoNotSave())   return;
  if (mySavingInProgress.compareAndSet(false,true)) {
    try {
      doSave();
    }
 catch (    IComponentStore.SaveCancelledException e) {
      LOG.info(e);
    }
catch (    PluginException e) {
      PluginManager.disablePlugin(e.getPluginId().getIdString());
      Notifications.Bus.notify(new Notification(PLUGIN_SETTINGS_ERROR,"Unable to save plugin settings!","<p>The plugin <i>" + e.getPluginId() + "</i> failed to save settings and has been disabled. Please restart"+ ApplicationNamesInfo.getInstance().getFullProductName()+ "</p>"+ (ApplicationManagerEx.getApplicationEx().isInternal() ? "<p>" + StringUtil.getThrowableText(e) + "</p>" : ""),NotificationType.ERROR),NotificationDisplayType.BALLOON,this);
      LOG.info("Unable to save plugin settings",e);
    }
catch (    IOException e) {
      MessagesEx.error(this,ProjectBundle.message("project.save.error",ApplicationManagerEx.getApplicationEx().isInternal() ? StringUtil.getThrowableText(e) : e.getMessage())).showLater();
      LOG.info("Error saving project",e);
    }
 finally {
      mySavingInProgress.set(false);
    }
  }
}
