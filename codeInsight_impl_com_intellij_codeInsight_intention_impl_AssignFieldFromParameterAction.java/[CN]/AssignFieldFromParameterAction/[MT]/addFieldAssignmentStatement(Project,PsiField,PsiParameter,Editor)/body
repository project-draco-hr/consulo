{
  final PsiMethod method=(PsiMethod)parameter.getDeclarationScope();
  PsiCodeBlock methodBody=method.getBody();
  if (methodBody == null)   return;
  PsiManager psiManager=PsiManager.getInstance(project);
  PsiElementFactory factory=psiManager.getElementFactory();
  String fieldName=field.getName();
  String parameterName=parameter.getName();
  final boolean isMethodStatic=method.hasModifierProperty(PsiModifier.STATIC);
  PsiClass targetClass=method.getContainingClass();
  String stmtText=fieldName + " = " + parameterName+ ";";
  if (Comparing.strEqual(fieldName,parameterName)) {
    @NonNls String prefix=isMethodStatic ? targetClass.getName() == null ? "" : targetClass.getName() + "." : "this.";
    stmtText=prefix + stmtText;
  }
  PsiStatement assignmentStmt=factory.createStatementFromText(stmtText,methodBody);
  assignmentStmt=(PsiStatement)CodeStyleManager.getInstance(project).reformat(assignmentStmt);
  PsiStatement[] statements=methodBody.getStatements();
  int i=CreateFieldFromParameterAction.findFieldAssignmentAnchor(statements,null,targetClass,parameter);
  PsiElement inserted;
  if (i == statements.length) {
    inserted=methodBody.add(assignmentStmt);
  }
 else {
    inserted=methodBody.addAfter(assignmentStmt,i > 0 ? statements[i - 1] : null);
  }
  editor.getCaretModel().moveToOffset(inserted.getTextRange().getEndOffset());
  editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
}
