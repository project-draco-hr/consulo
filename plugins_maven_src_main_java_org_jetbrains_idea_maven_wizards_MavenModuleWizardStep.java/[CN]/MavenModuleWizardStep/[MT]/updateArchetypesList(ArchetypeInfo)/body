{
  myLoadingCancelled.set(true);
  myLoadingCancelled=new AtomicBoolean();
  final AtomicBoolean currentStatus=myLoadingCancelled;
  myLoadingIcon.setVisible(true);
  myLoadingIcon.setBackground(myArchetypesTree.getBackground());
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    public void run(){
      try {
        Thread.sleep(3000);
      }
 catch (      InterruptedException e) {
        throw new RuntimeException(e);
      }
      final Set<ArchetypeInfo> archetypes=MavenIndicesManager.getInstance().getArchetypes();
      SwingUtilities.invokeLater(new Runnable(){
        public void run(){
          if (currentStatus.get())           return;
          myLoadingIcon.setVisible(false);
          TreeNode root=groupAndSortArchetypes(archetypes);
          TreeModel model=new DefaultTreeModel(root);
          myArchetypesTree.setModel(model);
          if (selected != null) {
            TreePath path=findNodePath(selected,model,model.getRoot());
            if (path != null) {
              myArchetypesTree.expandPath(path.getParentPath());
              TreeUtil.selectPath(myArchetypesTree,path,true);
            }
          }
          updateArchetypeDescription();
        }
      }
);
    }
  }
);
}
