{
  final PsiElementFactory factory=JavaPsiFacade.getInstance(file.getProject()).getElementFactory();
  for (  final CompletionVariantItem ce : myCompletionsList) {
    final Object comp=ce.myCompletion;
    if (comp instanceof String) {
      myPeer.addKeyword(factory,set,ce.myTailType,comp,matcher,file);
    }
 else {
      final CompletionContext context=position.getUserData(CompletionContext.COMPLETION_CONTEXT_KEY);
      if (comp instanceof ContextGetter) {
        final Object[] elements=((ContextGetter)comp).get(position,context);
        for (        Object element : elements) {
          myPeer.addLookupItem(set,ce.myTailType,element,matcher,file);
        }
      }
 else       if (comp instanceof KeywordChooser) {
        final String[] keywords=((KeywordChooser)comp).getKeywords(context,position);
        for (        String keyword : keywords) {
          myPeer.addKeyword(factory,set,ce.myTailType,keyword,matcher,file);
        }
      }
    }
  }
}
