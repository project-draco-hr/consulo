{
  if (expression == null)   return null;
  ConstantExpressionEvaluator evaluator=new ConstantExpressionEvaluator(visitedVars,throwExceptionOnOverflow,expression.getProject(),auxEvaluator);
  if (expression instanceof PsiCompiledElement) {
    if (expression instanceof PsiPrefixExpression) {
      PsiElement operand=((PsiPrefixExpression)expression).getOperand();
      if (operand == null)       return null;
      Object value=evaluator.myConstantExpressionVisitor.handle(operand);
      ConstantExpressionVisitor.store(operand,value);
    }
    return evaluator.myConstantExpressionVisitor.handle(expression);
  }
  expression.accept(evaluator);
  Object cached=evaluator.getCached(expression);
  return cached == NO_VALUE ? null : cached;
}
