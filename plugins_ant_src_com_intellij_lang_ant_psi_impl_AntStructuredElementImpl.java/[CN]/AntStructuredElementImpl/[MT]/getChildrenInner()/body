{
synchronized (PsiLock.LOCK) {
    if (!myInGettingChildren) {
      myInGettingChildren=true;
      try {
        final List<AntElement> children=new ArrayList<AntElement>();
        if (hasIdElement()) {
          children.add(getIdElement());
        }
        if (hasNameElement()) {
          children.add(getNameElement());
        }
        for (        final PsiElement element : getSourceElement().getChildren()) {
          if (element instanceof XmlElement) {
            final AntElement antElement=AntElementFactory.createAntElement(this,(XmlElement)element);
            if (antElement != null) {
              children.add(antElement);
              if (antElement instanceof AntStructuredElement) {
                antElement.getChildren();
              }
            }
          }
        }
        final int count=children.size();
        return count > 0 ? children.toArray(new AntElement[count]) : AntElement.EMPTY_ARRAY;
      }
  finally {
        myInGettingChildren=false;
      }
    }
  }
  return AntElement.EMPTY_ARRAY;
}
