{
synchronized (PsiLock.LOCK) {
    AntTypeDefinition definition=getTypeDefinition();
    if (definition != null) {
      if (!myDefinitionCloned) {
        definition=new AntTypeDefinitionImpl((AntTypeDefinitionImpl)definition);
        myDefinition=definition;
        myDefinitionCloned=true;
      }
      definition.registerNestedType(def.getTypeId(),def.getClassName());
    }
    getAntFile().registerCustomType(def);
  }
}
