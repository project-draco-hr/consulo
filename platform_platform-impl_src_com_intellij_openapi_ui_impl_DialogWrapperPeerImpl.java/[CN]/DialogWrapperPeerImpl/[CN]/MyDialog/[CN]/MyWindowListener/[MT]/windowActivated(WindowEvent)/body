{
  SwingUtilities.invokeLater(new Runnable(){
    @Override public void run(){
      final DialogWrapper wrapper=getActiveWrapper();
      if (wrapper == null && !myFocusedCallback.isProcessed()) {
        myFocusedCallback.setRejected();
        myTypeAheadDone.setRejected();
        return;
      }
      if (myActivated) {
        return;
      }
      myActivated=true;
      JComponent toFocus=wrapper == null ? null : wrapper.getPreferredFocusedComponent();
      if (getRootPane() != null && toFocus == null) {
        toFocus=getRootPane().getDefaultButton();
      }
      if (getRootPane() != null) {
        IJSwingUtilities.moveMousePointerOn(getRootPane().getDefaultButton());
      }
      setupSelectionOnPreferredComponent(toFocus);
      if (toFocus != null) {
        if (isShowing() && isActive()) {
          getFocusManager().requestFocus(toFocus,true);
          notifyFocused(wrapper);
        }
      }
 else {
        if (isShowing()) {
          notifyFocused(wrapper);
        }
      }
      if (myTypeAheadCallback != null) {
        myTypeAheadCallback.setDone();
      }
    }
  }
);
}
