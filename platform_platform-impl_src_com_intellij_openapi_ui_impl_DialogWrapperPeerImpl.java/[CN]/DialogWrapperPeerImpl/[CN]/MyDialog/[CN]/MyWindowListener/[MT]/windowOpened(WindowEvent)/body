{
  final FocusRequestor requestor=IdeFocusManager.findInstanceByComponent(e.getWindow()).getFurtherRequestor();
  SwingUtilities.invokeLater(new Runnable(){
    public void run(){
      myOpened=true;
      final DialogWrapper activeWrapper=getActiveWrapper();
      if (activeWrapper == null) {
        myFocusedCallback.setRejected();
        myTypeAheadDone.setRejected();
        return;
      }
      JComponent toFocus=activeWrapper.getPreferredFocusedComponent();
      if (toFocus == null) {
        toFocus=getRootPane().getDefaultButton();
      }
      moveMousePointerOnButton(getRootPane().getDefaultButton());
      setupSelectionOnPreferredComponent(toFocus);
      if (toFocus != null) {
        final JComponent toRequest=toFocus;
        SwingUtilities.invokeLater(new Runnable(){
          public void run(){
            if (isShowing()) {
              requestor.requestFocus(toRequest,true);
              notifyFocused(activeWrapper);
            }
          }
        }
);
      }
 else {
        if (isShowing()) {
          notifyFocused(activeWrapper);
        }
      }
    }
  }
);
}
