{
  if (!CodeInsightUtil.prepareFileForWrite(myExpression.getContainingFile()))   return;
  try {
    final PsiExpression qualifierExpression=myExpression.getQualifierExpression();
    final PsiElementFactory factory=file.getManager().getElementFactory();
    if (qualifierExpression instanceof PsiThisExpression && ((PsiThisExpression)qualifierExpression).getQualifier() == null) {
      qualifierExpression.delete();
      if (myExpression.resolve() != myMember) {
        PsiReferenceExpression expr=(PsiReferenceExpression)factory.createExpressionFromText("A.foo",myExpression);
        expr.getQualifierExpression().replace(factory.createReferenceExpression(myMember.getContainingClass()));
        expr.getReferenceNameElement().replace(myExpression);
        myExpression.replace(expr);
      }
    }
 else {
      qualifierExpression.replace(factory.createReferenceExpression(myMember.getContainingClass()));
    }
    QuickFixAction.spoilDocument(project,file);
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
}
