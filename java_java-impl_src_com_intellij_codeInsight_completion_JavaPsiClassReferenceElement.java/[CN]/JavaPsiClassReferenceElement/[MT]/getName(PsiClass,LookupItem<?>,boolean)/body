{
  if (item instanceof JavaPsiClassReferenceElement) {
    String forced=((JavaPsiClassReferenceElement)item).getForcedPresentableName();
    if (forced != null) {
      return forced;
    }
  }
  String name=PsiUtilCore.getName(psiClass);
  if (item.getAttribute(LookupItem.FORCE_QUALIFY) != null) {
    if (psiClass.getContainingClass() != null) {
      name=psiClass.getContainingClass().getName() + "." + name;
    }
  }
  if (diamond) {
    return name + "<>";
  }
  PsiSubstitutor substitutor=(PsiSubstitutor)item.getAttribute(LookupItem.SUBSTITUTOR);
  if (substitutor != null) {
    final PsiTypeParameter[] params=psiClass.getTypeParameters();
    if (params.length > 0) {
      return name + formatTypeParameters(substitutor,params);
    }
  }
  return StringUtil.notNullize(name);
}
