{
  final PsiFile psiFile=(PsiFile)value;
  String path=null;
  if (path == null) {
    final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(psiFile.getProject()).getFileIndex();
    VirtualFile file=psiFile.getVirtualFile();
    final PsiFile originalFile=psiFile.getOriginalFile();
    if (file == null && originalFile != null) {
      file=originalFile.getVirtualFile();
    }
    if (file != null) {
      VirtualFile root=fileIndex.getSourceRootForFile(file);
      if (root == null) {
        root=fileIndex.getContentRootForFile(file);
      }
      if (root != null) {
        path=VfsUtil.getRelativePath(file,root,'/');
      }
    }
  }
  return path;
}
