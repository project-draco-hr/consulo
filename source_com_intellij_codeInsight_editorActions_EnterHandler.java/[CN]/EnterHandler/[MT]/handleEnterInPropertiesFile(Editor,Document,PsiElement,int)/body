{
  final IElementType elementType=psiAtOffset == null ? null : psiAtOffset.getNode().getElementType();
  final String toInsert;
  if (elementType == PropertiesTokenTypes.VALUE_CHARACTERS) {
    toInsert="\\\n  ";
  }
 else   if (elementType == PropertiesTokenTypes.END_OF_LINE_COMMENT) {
    toInsert="\n#";
  }
 else {
    toInsert="\n";
  }
  document.insertString(caretOffset,toInsert);
  caretOffset+=toInsert.length();
  editor.getCaretModel().moveToOffset(caretOffset);
  editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
  editor.getSelectionModel().removeSelection();
}
