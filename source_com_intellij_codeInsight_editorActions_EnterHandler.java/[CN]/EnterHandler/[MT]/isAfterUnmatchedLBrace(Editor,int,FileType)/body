{
  if (offset == 0)   return false;
  CharSequence chars=editor.getDocument().getCharsSequence();
  if (chars.charAt(offset - 1) != '{')   return false;
  EditorHighlighter highlighter=((EditorEx)editor).getHighlighter();
  HighlighterIterator iterator=highlighter.createIterator(offset - 1);
  BraceMatchingUtil.BraceMatcher braceMatcher=BraceMatchingUtil.getBraceMatcher(fileType);
  if (!braceMatcher.isLBraceToken(iterator,chars,fileType) || !braceMatcher.isStructuralBrace(iterator,chars,fileType)) {
    return false;
  }
  iterator=highlighter.createIterator(0);
  Language language=iterator.getTokenType().getLanguage();
  int balance=0;
  while (!iterator.atEnd()) {
    IElementType tokenType=iterator.getTokenType();
    if (tokenType.getLanguage().equals(language)) {
      if (braceMatcher.isStructuralBrace(iterator,chars,fileType)) {
        if (braceMatcher.isLBraceToken(iterator,chars,fileType)) {
          balance++;
        }
 else         if (braceMatcher.isRBraceToken(iterator,chars,fileType)) {
          balance--;
        }
      }
    }
    iterator.advance();
  }
  return balance > 0;
}
