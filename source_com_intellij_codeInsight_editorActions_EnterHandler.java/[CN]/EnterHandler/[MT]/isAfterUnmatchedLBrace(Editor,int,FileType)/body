{
  if (offset == 0)   return false;
  CharSequence chars=editor.getDocument().getCharsSequence();
  if (chars.charAt(offset - 1) != '{')   return false;
  EditorHighlighter highlighter=((EditorEx)editor).getHighlighter();
  HighlighterIterator iterator=highlighter.createIterator(offset - 1);
  BraceMatchingUtil.BraceMatcher braceMatcher=BraceMatchingUtil.getBraceMatcher(fileType);
  if (!braceMatcher.isLBraceToken(iterator,chars,fileType) || !braceMatcher.isStructuralBrace(iterator,chars,fileType)) {
    return false;
  }
  iterator=highlighter.createIterator(offset - 1);
  Language language=iterator.getTokenType().getLanguage();
  do {
    iterator.retreat();
    IElementType tokenType=iterator.getTokenType();
    if (tokenType != ElementType.WHITE_SPACE && !tokenType.getLanguage().equals(language)) {
      iterator.advance();
      break;
    }
  }
 while (iterator.getStart() > 0);
  int balance=0;
  while (!iterator.atEnd()) {
    IElementType tokenType=iterator.getTokenType();
    if (tokenType != ElementType.WHITE_SPACE && !tokenType.getLanguage().equals(language))     break;
    if (braceMatcher.isStructuralBrace(iterator,chars,fileType)) {
      if (braceMatcher.isLBraceToken(iterator,chars,fileType)) {
        balance++;
      }
 else       if (braceMatcher.isRBraceToken(iterator,chars,fileType)) {
        balance--;
      }
    }
    iterator.advance();
  }
  return balance > 0;
}
