{
  if (!CodeInsightUtilBase.prepareFileForWrite(myMethod.getContainingFile()))   return;
  if (myFixWholeHierarchy) {
    final PsiMethod superMethod=myMethod.findDeepestSuperMethod();
    final PsiType superReturnType=superMethod == null ? null : superMethod.getReturnType();
    if (superReturnType != null && !Comparing.equal(myReturnType,superReturnType) && !changeClassTypeArgument(project,superReturnType,superMethod.getContainingClass(),editor)) {
      return;
    }
  }
  final List<PsiMethod> affectedMethods=changeReturnType(myMethod,myReturnType);
  PsiElementFactory factory=JavaPsiFacade.getInstance(project).getElementFactory();
  final SourceMethodSelector returnSelector=new SourceMethodSelector(myMethod);
  if (!PsiType.VOID.equals(myReturnType)) {
    final ReturnStatementAdder adder=new ReturnStatementAdder(factory,myReturnType,returnSelector);
    for (    PsiMethod affectedMethod : affectedMethods) {
      adder.addReturnForMethod(file,affectedMethod);
    }
  }
  final PsiReturnStatement latestReturn=returnSelector.getReturnStatement();
  if (latestReturn != null) {
    Editor editorForMethod=getEditorForMethod(project,editor,latestReturn.getContainingFile());
    selectReturnValueInEditor(latestReturn,editorForMethod);
  }
}
