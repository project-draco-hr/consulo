{
  final FileViewProvider viewProvider=file.getViewProvider();
  T result=null;
  for (  Language lang : viewProvider.getPrimaryLanguages()) {
    PsiElement elementAt=viewProvider.findElementAt(startOffset,lang);
    T run=getParentOfType(elementAt,clazz,false);
    T prev=run;
    while (run != null && run.getTextRange().getStartOffset() == startOffset && run.getTextRange().getEndOffset() <= endOffset) {
      prev=run;
      run=getParentOfType(run,clazz);
    }
    if (prev == null)     continue;
    final int elementStartOffset=prev.getTextRange().getStartOffset();
    final int elementEndOffset=prev.getTextRange().getEndOffset();
    if (elementStartOffset != startOffset || elementEndOffset > endOffset)     continue;
    if (result == null || result.getTextRange().getEndOffset() < elementEndOffset) {
      result=prev;
    }
  }
  return result;
}
