{
  final FacetTypeId typeId=facet.getTypeId();
  WeakHashMap<Facet,Boolean> facets=myFacetsByType.get(typeId);
  boolean lastFacet;
  if (facets != null) {
    facets.remove(facet);
    lastFacet=facets.isEmpty();
    if (lastFacet) {
      myFacetsByType.remove(typeId);
    }
  }
 else {
    lastFacet=true;
  }
  final EventDispatcher<ProjectWideFacetListener> dispatcher=myDispatchers.get(typeId);
  if (dispatcher != null) {
    if (before) {
      dispatcher.getMulticaster().beforeFacetRemoved(facet);
    }
 else {
      dispatcher.getMulticaster().facetRemoved(facet);
      if (lastFacet) {
        dispatcher.getMulticaster().allFacetsRemoved();
      }
    }
  }
  if (before) {
    getAllFacetsMulticaster().beforeFacetRemoved(facet);
  }
 else {
    getAllFacetsMulticaster().facetRemoved(facet);
    if (myFacetsByType.isEmpty()) {
      getAllFacetsMulticaster().allFacetsRemoved();
    }
  }
}
