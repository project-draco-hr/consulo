{
  markDirty();
  int sizeAndCapacityOfRecordAbsoluteOffset=getOffset(record,SIZE_AND_CAPACITY_OFFSET);
  int currentValue=myStorage.getInt(sizeAndCapacityOfRecordAbsoluteOffset);
  if (currentValue < 0) {
    myStorage.putInt(getOffset(-currentValue,CAPACITY_OFFSET_IN_INDIRECT_RECORD),capacity);
    return;
  }
  if (capacity > 0x7fff || capacity < 0 || forceSplit) {
    extendSizeAndCapacityRecord(record,getSize(record),capacity);
    return;
  }
  myStorage.putInt(sizeAndCapacityOfRecordAbsoluteOffset,(currentValue & SIZE_MASK) | (capacity << CAPACITY_SHIFT));
}
