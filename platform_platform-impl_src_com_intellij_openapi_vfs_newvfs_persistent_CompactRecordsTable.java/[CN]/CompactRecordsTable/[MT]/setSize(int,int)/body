{
  markDirty();
  int sizeAndCapacityOfRecordAbsoluteOffset=getOffset(record,SIZE_AND_CAPACITY_OFFSET);
  int currentValue=myStorage.getInt(sizeAndCapacityOfRecordAbsoluteOffset);
  if (currentValue < 0) {
    myStorage.putInt(getOffset(-currentValue,SIZE_OFFSET_IN_INDIRECT_RECORD),size);
    return;
  }
  if (size >= 0xFFFF || size < SPECIAL_NEGATIVE_SIZE || forceSplit) {
    extendSizeAndCapacityRecord(record,size,getCapacity(record));
    return;
  }
  if (size == SPECIAL_NEGATIVE_SIZE) {
    size=SPECIAL_POSITIVE_VALUE_FOR_SPECIAL_NEGATIVE_SIZE;
  }
  myStorage.putInt(sizeAndCapacityOfRecordAbsoluteOffset,size | (currentValue & CAPACITY_MASK));
}
