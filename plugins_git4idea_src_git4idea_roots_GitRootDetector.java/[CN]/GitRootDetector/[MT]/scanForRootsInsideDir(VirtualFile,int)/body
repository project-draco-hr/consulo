{
  final Set<VirtualFile> roots=new HashSet<VirtualFile>();
  if (depth > 2) {
    return roots;
  }
  myPlatformFacade.runReadActionAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      if (myProject.isDisposed() || !dir.isDirectory()) {
        return;
      }
      if (hasGitDir(dir)) {
        roots.add(dir);
      }
      for (      VirtualFile child : dir.getChildren()) {
        roots.addAll(scanForRootsInsideDir(child,depth + 1));
      }
    }
  }
);
  return roots;
}
