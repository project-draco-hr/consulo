{
  final Set<VirtualFile> roots=new HashSet<VirtualFile>();
  if (depth > MAXIMUM_SCAN_DEPTH) {
    return roots;
  }
  myPlatformFacade.runReadAction(new Computable<Object>(){
    @Nullable @Override public Object compute(){
      if (myProject.isDisposed() || !dir.isDirectory()) {
        return null;
      }
      if (hasGitDir(dir)) {
        roots.add(dir);
      }
      for (      VirtualFile child : dir.getChildren()) {
        roots.addAll(scanForRootsInsideDir(child,depth + 1));
      }
      return null;
    }
  }
);
  return roots;
}
