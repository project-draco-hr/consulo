{
  LOG.assertTrue(child.getTreeParent() == myParent);
  ASTNode current=myParent.getFirstChildNode();
  final Iterator<Pair<ASTNode,Integer>> iterator=myOffsets.iterator();
  Pair<ASTNode,Integer> currentChange=iterator.hasNext() ? iterator.next() : null;
  int currentOffset=0;
  do {
    boolean counted=false;
    while (currentChange != null && currentOffset == currentChange.getSecond().intValue() && child.getTreeNext() != currentChange.getFirst()) {
      if (current == currentChange.getFirst()) {
        counted=true;
        current=current.getTreeNext();
      }
      final ChangeInfo changeInfo=myChanges.get(currentChange.getFirst());
      currentOffset+=changeInfo.getOldLength();
      currentChange=iterator.hasNext() ? iterator.next() : null;
    }
    if (current == child)     break;
    if (current == null)     break;
    if (!counted) {
      currentOffset+=current.getTextLength();
      current=current.getTreeNext();
    }
  }
 while (true);
  return currentOffset;
}
