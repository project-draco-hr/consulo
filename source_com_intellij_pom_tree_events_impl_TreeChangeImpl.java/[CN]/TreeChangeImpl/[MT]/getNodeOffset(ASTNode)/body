{
  LOG.assertTrue(child.getTreeParent() == myParent);
  final CharTable table=SharedImplUtil.findCharTableByTree(myParent);
  ASTNode current=myParent.getFirstChildNode();
  final Iterator<Pair<ASTNode,Integer>> iterator=myOffsets.iterator();
  Pair<ASTNode,Integer> currentChange=iterator.hasNext() ? iterator.next() : null;
  int currentOffset=0;
  do {
    boolean counted=false;
    while (currentChange != null && currentOffset == currentChange.getSecond().intValue()) {
      if (current == currentChange.getFirst())       counted=true;
      final ChangeInfo changeInfo=myChanges.get(currentChange.getFirst());
      currentOffset+=changeInfo.getOldLength();
      currentChange=iterator.hasNext() ? iterator.next() : null;
    }
    if (current == child)     break;
    if (!counted)     currentOffset+=((TreeElement)current).getTextLength(table);
    current=current.getTreeNext();
  }
 while (true);
  return currentOffset;
}
