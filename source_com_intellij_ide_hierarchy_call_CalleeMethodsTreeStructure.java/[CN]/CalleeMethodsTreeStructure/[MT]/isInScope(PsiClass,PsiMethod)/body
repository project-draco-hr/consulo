{
  if (!calledMethod.getManager().isInProject(calledMethod)) {
    return false;
  }
  if (CallHierarchyBrowser.SCOPE_CLASS.equals(myScopeType)) {
    if (!PsiTreeUtil.isAncestor(baseClass,calledMethod,true)) {
      return false;
    }
  }
 else   if (CallHierarchyBrowser.SCOPE_PROJECT.equals(myScopeType)) {
    final VirtualFile virtualFile=calledMethod.getContainingFile().getVirtualFile();
    if (virtualFile != null && ProjectRootManager.getInstance(myProject).getFileIndex().isInTestSourceContent(virtualFile)) {
      return false;
    }
  }
 else   if (CallHierarchyBrowser.SCOPE_TEST.equals(myScopeType)) {
    final VirtualFile virtualFile=calledMethod.getContainingFile().getVirtualFile();
    if (virtualFile != null && !ProjectRootManager.getInstance(myProject).getFileIndex().isInTestSourceContent(virtualFile)) {
      return false;
    }
  }
  return true;
}
