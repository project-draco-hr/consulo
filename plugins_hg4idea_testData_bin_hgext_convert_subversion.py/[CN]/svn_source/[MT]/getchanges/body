def getchanges(self, rev):
    if (self._changescache and (self._changescache[0] == rev)):
        return self._changescache[1]
    self._changescache = None
    self.modecache = {}
    (paths, parents) = self.paths[rev]
    if parents:
        (files, self.removed, copies) = self.expandpaths(rev, paths, parents)
    else:
        (uuid, module, revnum) = self.revsplit(rev)
        entries = svn.client.ls((self.baseurl + urllib.quote(module)), optrev(revnum), True, self.ctx)
        files = [n for (n, e) in entries.iteritems() if (e.kind == svn.core.svn_node_file)]
        copies = {}
        self.removed = set()
    files.sort()
    files = zip(files, ([rev] * len(files)))
    del self.paths[rev]
    return (files, copies)
