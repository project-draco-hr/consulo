{
  Editor editor=(Editor)context.getData(DataConstants.EDITOR);
  Project project=(Project)context.getData(DataConstants.PROJECT);
  if (editor == null || project == null)   return null;
  PsiDocumentManager.getInstance(project).commitDocument(editor.getDocument());
  PsiFile file=(PsiFile)context.getData(DataConstants.PSI_FILE);
  if (file == null)   return null;
  PsiClass contextClass=PsiTreeUtil.findElementOfClassAtOffset(file,editor.getCaretModel().getOffset(),PsiClass.class,false);
  if (contextClass == null || contextClass.isEnum() || contextClass.isInterface() || contextClass instanceof PsiAnonymousClass) {
    return null;
  }
  PsiClass componentClass=file.getManager().findClass(BASE_COMPONENT,file.getResolveScope());
  if (componentClass == null || !contextClass.isInheritor(componentClass,true))   return null;
  PsiClass externClass=file.getManager().findClass(JDOM_EXTERN,file.getResolveScope());
  if (externClass == null || contextClass.isInheritor(externClass,true))   return null;
  return contextClass;
}
