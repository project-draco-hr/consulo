{
  PsiElement psiElement=context.getPsiElement();
  if (psiElement == null) {
    return null;
  }
  if (!psiElement.isValid()) {
    return null;
  }
  TextRange textRange=psiElement.getTextRange();
  if (textRange == null) {
    return null;
  }
  VirtualFile virtualFile=psiElement.getContainingFile().getVirtualFile();
  if (virtualFile == null) {
    return null;
  }
  if (!virtualFile.isValid()) {
    return null;
  }
  Document document=FileDocumentManager.getInstance().getDocument(virtualFile);
  PsiDocumentManager.getInstance(psiElement.getProject()).commitDocument(document);
  return new VcsSelection(document,textRange);
}
