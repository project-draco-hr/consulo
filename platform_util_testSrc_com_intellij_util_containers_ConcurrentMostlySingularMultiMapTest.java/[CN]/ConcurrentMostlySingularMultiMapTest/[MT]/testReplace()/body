{
  ConcurrentMostlySingularMultiMap<String,String> map=new ConcurrentMostlySingularMultiMap<String,String>();
  List<String> xxxList=Collections.singletonList("xxx");
  List<String> empty=Collections.emptyList();
  String KEY="key";
  boolean replaced=map.replace(KEY,empty,xxxList);
  assertTrue(replaced);
  assertEquals(1,map.size());
  assertEquals(xxxList,map.get(KEY));
  List<String> yyyList=Collections.singletonList("yyy");
  replaced=map.replace(KEY,xxxList,yyyList);
  assertTrue(replaced);
  assertEquals(1,map.size());
  assertEquals(yyyList,map.get(KEY));
  replaced=map.replace(KEY,yyyList,empty);
  assertTrue(replaced);
  assertEquals(0,map.size());
  assertEquals(empty,map.get(KEY));
}
