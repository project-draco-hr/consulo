{
  ASTNode firstNonEmpty=first;
  while (firstNonEmpty != null && firstNonEmpty != last && firstNonEmpty.getTextLength() == 0) {
    firstNonEmpty=firstNonEmpty.getTreeNext();
  }
  if (firstNonEmpty == null && anchorBefore != null) {
    firstNonEmpty=TreeUtil.findFirstLeaf(anchorBefore);
    while (firstNonEmpty != null && firstNonEmpty.getTextLength() == 0) {
      firstNonEmpty=firstNonEmpty.getTreeNext();
    }
  }
  if (firstNonEmpty == null) {
    firstNonEmpty=TreeUtil.nextLeaf(parent);
  }
  return firstNonEmpty;
}
