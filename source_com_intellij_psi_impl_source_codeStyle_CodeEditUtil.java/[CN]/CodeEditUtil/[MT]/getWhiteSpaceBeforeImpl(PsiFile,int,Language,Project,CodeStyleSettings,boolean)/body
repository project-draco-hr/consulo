{
  if (CodeFormatterFacade.useBlockFormatter(file.getFileType())) {
    final TextRange textRange=file.findElementAt(tokenStartOffset).getTextRange();
    return Formatter.getInstance().getWhiteSpaceBefore(new PsiBasedFormattingModel(file,settings),CodeFormatterFacade.createBlock(file,settings),settings,settings.getIndentOptions(file.getFileType()),textRange,mayChangeLineFeeds);
  }
 else {
    final PseudoTextBuilder pseudoTextBuilder=language.getFormatter();
    LOG.assertTrue(pseudoTextBuilder != null);
    final PseudoText pseudoText=pseudoTextBuilder.build(project,settings,file);
    return GeneralCodeFormatter.getWhiteSpaceBetweenTokens(pseudoText,settings,file.getFileType(),tokenStartOffset,mayChangeLineFeeds);
  }
}
