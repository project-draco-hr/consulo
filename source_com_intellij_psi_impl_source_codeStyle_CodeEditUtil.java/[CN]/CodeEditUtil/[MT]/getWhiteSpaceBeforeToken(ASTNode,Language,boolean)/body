{
  LOG.assertTrue(tokenNode != null);
  final PsiElement secondAsPsiElement=SourceTreeToPsiMap.treeElementToPsi(tokenNode);
  LOG.assertTrue(secondAsPsiElement != null);
  final PsiFile file=secondAsPsiElement.getContainingFile();
  final Project project=secondAsPsiElement.getProject();
  final CodeStyleSettings settings=CodeStyleSettingsManager.getInstance(project).getCurrentSettings();
  final int tokenStartOffset=tokenNode.getStartOffset();
  final boolean oldValue=settings.XML_KEEP_LINE_BREAKS;
  final int oldKeepBlankLines=settings.XML_KEEP_BLANK_LINES;
  settings.XML_KEEP_BLANK_LINES=0;
  try {
    return getWhiteSpaceBeforeImpl(file,tokenStartOffset,language,project,settings,mayChangeLineFeeds);
  }
  finally {
    settings.XML_KEEP_LINE_BREAKS=oldValue;
    settings.XML_KEEP_BLANK_LINES=oldKeepBlankLines;
  }
}
