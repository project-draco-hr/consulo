{
  CodeStyleSettings settings=CodeStyleSettingsManager.getSettings(first.getPsi().getProject());
  final PsiElement psi=first.getPsi();
  final PsiFile file=psi.getContainingFile();
  final FormattingModelBuilder builder=file.getLanguage().getFormattingModelBuilder();
  final FormattingModelBuilder elementBuilder=psi.getLanguage().getFormattingModelBuilder();
  if (builder != null && elementBuilder != null && canModifyWS(file)) {
    Formatter.getInstance().adjustTextRange(builder.createModel(file,settings),settings,settings.getIndentOptions(file.getFileType()),first.getTextRange(),keepBlankLines,keepLineBreaks,changeWSBeforeFirstElement,changeLineFeedsBeforeFirstElement,new MyIndentInfoStorage(file,null));
  }
}
