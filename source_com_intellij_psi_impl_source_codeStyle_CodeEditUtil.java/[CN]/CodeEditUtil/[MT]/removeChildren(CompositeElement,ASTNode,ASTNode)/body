{
  if (DO_OUTPUT) {
    System.out.println("CodeEditUtil.removeChildrenBefore\n" + parent.getPsi().getContainingFile().getText());
  }
  checkAllWhiteSpaces(parent);
  ASTNode lastChild=last == null ? null : last.getTreeNext();
  final ASTNode prevElement=TreeUtil.prevLeaf(first);
  final ASTNode nextElement=findElementAfter(last == null ? parent : last,false);
  if (nextElement != null) {
    saveIndents(nextElement);
  }
  boolean adjustWSBefore=containLineBreaks(first,lastChild);
  if (!mustKeepFirstIndent(prevElement,parent)) {
    adjustWSBefore=true;
  }
  parent.removeRange(first,lastChild);
  if (!adjustWSBefore && parent.getTextLength() == 0 && prevElement != null && isWS(prevElement) && !prevElement.textContains('\n')) {
    adjustWSBefore=true;
  }
  final PsiFile file=parent.getPsi().getContainingFile();
  final CodeStyleSettings.IndentOptions options=CodeStyleSettingsManager.getSettings(file.getProject()).getIndentOptions(file.getFileType());
  if (nextElement != null) {
    ASTNode elementBeforeNext=TreeUtil.prevLeaf(nextElement);
    if (prevElement != null && isWS(prevElement) && isWS(elementBeforeNext) && prevElement != elementBeforeNext) {
      if (!elementBeforeNext.textContains('\n') && prevElement.textContains('\n')) {
        delete(elementBeforeNext);
      }
 else {
        final String text=composeNewWS(prevElement.getText(),elementBeforeNext.getText(),options);
        delete(prevElement);
        replace(elementBeforeNext,text);
      }
    }
    elementBeforeNext=TreeUtil.prevLeaf(nextElement);
    if (isWS(elementBeforeNext) && whiteSpaceHasInvalidPosition(elementBeforeNext)) {
      final ASTNode elementBeforeNext2=elementBeforeNext;
      final String text=elementBeforeNext2.getText();
      delete(elementBeforeNext2);
      FormatterUtil.replaceWhiteSpace(text,nextElement,ElementType.WHITE_SPACE);
    }
    if (adjustWSBefore) {
      adjustWhiteSpaceBefore(nextElement,true,true,true,false);
    }
  }
 else {
    final ASTNode fileNode=SourceTreeToPsiMap.psiElementToTree(parent.getPsi().getContainingFile());
    ASTNode lastLeaf=TreeUtil.findLastLeaf(fileNode);
    if (isWS(lastLeaf)) {
      delete(lastLeaf);
    }
  }
  checkAllWhiteSpaces(parent);
  if (DO_OUTPUT) {
    System.out.println("CodeEditUtil.removeChildren\n" + parent.getPsi().getContainingFile().getText());
  }
}
