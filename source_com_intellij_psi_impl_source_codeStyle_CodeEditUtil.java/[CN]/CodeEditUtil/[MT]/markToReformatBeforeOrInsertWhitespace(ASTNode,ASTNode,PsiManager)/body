{
  final Language leftLang=left != null ? left.getElementType().getLanguage() : null;
  final Language rightLang=right.getElementType().getLanguage();
  final ParserDefinition parserDefinition=rightLang.getParserDefinition();
  LeafElement generatedWhitespace=null;
  if (leftLang == rightLang && parserDefinition != null) {
switch (parserDefinition.spaceExistanceTypeBetweenTokens(left,right)) {
case MUST:
      generatedWhitespace=Factory.createSingleLeafElement(TokenType.WHITE_SPACE," ",0,1,null,manager);
    break;
case MUST_LINE_BREAK:
  generatedWhitespace=Factory.createSingleLeafElement(TokenType.WHITE_SPACE,"\n",0,1,null,manager);
break;
default :
generatedWhitespace=null;
}
}
if (generatedWhitespace != null) {
final ParseUtil.CommonParentState parentState=new ParseUtil.CommonParentState();
ParseUtil.prevLeaf((TreeElement)right,parentState);
parentState.nextLeafBranchStart.getTreeParent().addChild(generatedWhitespace,parentState.nextLeafBranchStart);
}
 else markToReformatBefore(right,true);
}
