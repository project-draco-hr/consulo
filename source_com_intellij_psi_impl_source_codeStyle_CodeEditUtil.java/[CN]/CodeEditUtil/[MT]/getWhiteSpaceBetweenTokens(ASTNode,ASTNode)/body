{
  final PsiElement firstAsPsiElement=SourceTreeToPsiMap.treeElementToPsi(first);
  LOG.assertTrue(firstAsPsiElement != null);
  final PsiFile file=firstAsPsiElement.getContainingFile();
  final FileType fileType=file.getVirtualFile().getFileType();
  final PseudoTextBuilder pseudoTextBuilder=fileType.getPseudoTextBuilder();
  LOG.assertTrue(pseudoTextBuilder != null);
  final Project project=firstAsPsiElement.getProject();
  final CodeStyleSettings settings=CodeStyleSettingsManager.getInstance(project).getCurrentSettings();
  final int startOffset=first.getStartOffset();
  final int endOffset=second.getStartOffset();
  final boolean oldValue=settings.XML_KEEP_LINE_BREAKS;
  settings.XML_KEEP_LINE_BREAKS=false;
  try {
    final PseudoText pseudoText=pseudoTextBuilder.build(project,settings,file);
    return GeneralCodeFormatter.getWhiteSpaceBetweenTokens(pseudoText,settings,fileType,startOffset,endOffset);
  }
  finally {
    settings.XML_KEEP_LINE_BREAKS=oldValue;
  }
}
