{
  if (tokenNode == null)   return language;
  final PsiElement secondAsPsiElement=SourceTreeToPsiMap.treeElementToPsi(tokenNode);
  if (secondAsPsiElement == null)   return language;
  final PsiFile file=secondAsPsiElement.getContainingFile();
  if (file == null)   return language;
  final FileType fileType=file.getFileType();
  if (!(fileType instanceof LanguageFileType)) {
    return language;
  }
  if (((LanguageFileType)fileType).getLanguage().getFormatter() == null) {
    return language;
  }
 else {
    return ((LanguageFileType)fileType).getLanguage();
  }
}
