{
  if (myCreateModuleCb.isSelected() || !myWizardContext.isCreatingNewProject()) {
    if (!ProjectWizardUtil.createDirectoryIfNotExists(IdeBundle.message("directory.module.file"),myModuleFileLocation.getText(),myImlLocationChangedByUser)) {
      return false;
    }
    if (!ProjectWizardUtil.createDirectoryIfNotExists(IdeBundle.message("directory.module.content.root"),myModuleContentRoot.getText(),myContentRootChangedByUser)) {
      return false;
    }
  }
  if (!myWizardContext.isCreatingNewProject()) {
    final Module module;
    final ProjectStructureConfigurable fromConfigurable=ProjectStructureConfigurable.getInstance(myWizardContext.getProject());
    final String moduleName=myModuleName.getText().trim();
    if (fromConfigurable != null) {
      module=fromConfigurable.getModulesConfig().getModule(moduleName);
    }
 else {
      module=ModuleManager.getInstance(myWizardContext.getProject()).findModuleByName(moduleName);
    }
    if (module != null) {
      throw new ConfigurationException("Module \'" + moduleName + "\' already exist in project. Please, specify another name.");
    }
  }
  return !myWizardContext.isCreatingNewProject() || super.validate();
}
