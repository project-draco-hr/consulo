{
  FileDocumentManager.getInstance().saveDocument(content.getDocument());
  LineSeparator separator=content.getLineSeparator();
  if (separator == null)   separator=LineSeparator.getSystemLineSeparator();
  Charset charset=content.getCharset();
  if (charset == null)   charset=Charset.defaultCharset();
  String contentData=ApplicationManager.getApplication().runReadAction(new Computable<String>(){
    @Override public String compute(){
      return content.getDocument().getText();
    }
  }
);
  if (separator != LineSeparator.LF) {
    contentData=StringUtil.convertLineSeparators(contentData,separator.getSeparatorString());
  }
  byte[] bytes=contentData.getBytes(charset);
  return createFile(bytes,tempFileName);
}
