{
  if (content instanceof EmptyContent) {
    return createFile(new byte[0],"empty").getPath();
  }
 else   if (content instanceof FileContent) {
    VirtualFile file=((FileContent)content).getFile();
    if (file.isInLocalFileSystem()) {
      return file.getPath();
    }
    byte[] bytes=file.contentsToByteArray();
    return createFile(bytes,getFileName(title,windowTitle,content.getContentType())).getPath();
  }
 else   if (content instanceof DocumentContent) {
    final DocumentContent documentContent=(DocumentContent)content;
    FileDocumentManager.getInstance().saveDocument(documentContent.getDocument());
    LineSeparator separator=documentContent.getLineSeparator();
    if (separator == null)     separator=LineSeparator.getSystemLineSeparator();
    Charset charset=documentContent.getCharset();
    if (charset == null)     charset=Charset.defaultCharset();
    String contentData=ApplicationManager.getApplication().runReadAction(new Computable<String>(){
      @Override public String compute(){
        return documentContent.getDocument().getText();
      }
    }
);
    if (separator != LineSeparator.LF) {
      contentData=StringUtil.convertLineSeparators(contentData,separator.getSeparatorString());
    }
    byte[] bytes=contentData.getBytes(charset);
    return createFile(bytes,getFileName(title,windowTitle,content.getContentType())).getPath();
  }
 else   if (content instanceof DirectoryContent) {
    VirtualFile file=((DirectoryContent)content).getFile();
    if (file.isInLocalFileSystem()) {
      return file.getPath();
    }
    throw new IllegalArgumentException(content.toString());
  }
  throw new IllegalArgumentException(content.toString());
}
