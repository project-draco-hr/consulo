def rebuild(self):
    if self._rebuilt:
        return True
    self._rebuilt = True
    self.parentmap.clear()
    self.wantedancestors.clear()
    self.seenchildren.clear()
    for (rev, wanted, arg) in self.convertedorder:
        if (rev not in self.origparents):
            self.origparents[rev] = self.getcommit(rev).parents
        if (arg is not None):
            self.children[arg] = (self.children.get(arg, 0) + 1)
    for (rev, wanted, arg) in self.convertedorder:
        parents = self.origparents[rev]
        if wanted:
            self.mark_wanted(rev, parents)
        else:
            self.mark_not_wanted(rev, arg)
        self._discard(arg, *parents)
    return True
