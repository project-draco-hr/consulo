{
  final XmlElement xmlElement=extensions.getXmlElement();
  if (xmlElement == null)   return;
  final PsiManager psiManager=xmlElement.getManager();
  IdeaPlugin ideaPlugin=extensions.getParentOfType(IdeaPlugin.class,true);
  if (ideaPlugin == null)   return;
  String prefix=extensions.getDefaultExtensionNs().getStringValue();
  if (prefix == null)   prefix=extensions.getXmlns().getStringValue();
  if (prefix != null) {
    prefix+=".";
  }
 else {
    prefix="";
  }
  registerExtensions(prefix,ideaPlugin,registrar,psiManager);
  final Collection<String> dependencies=getDependencies(ideaPlugin);
  for (  IdeaPlugin plugin : IdeaPluginConverter.collectAllVisiblePlugins(DomUtil.getFile(extensions))) {
    final String value=plugin.getPluginId();
    if (value == null || dependencies.contains(value)) {
      registerExtensions(prefix,plugin,registrar,psiManager);
    }
  }
}
