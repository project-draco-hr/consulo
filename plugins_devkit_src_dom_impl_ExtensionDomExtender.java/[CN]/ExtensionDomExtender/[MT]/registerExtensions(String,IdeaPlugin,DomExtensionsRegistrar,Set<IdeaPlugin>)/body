{
  if (!visited.add(ideaPlugin)) {
    return;
  }
  final String pluginId=StringUtil.notNullize(ideaPlugin.getPluginId(),"com.intellij");
  for (  ExtensionPoints points : ideaPlugin.getExtensionPoints()) {
    for (    ExtensionPoint point : points.getExtensionPoints()) {
      registerExtensionPoint(registrar,point,prefix,pluginId);
    }
  }
  final Collection<String> dependencies=getDependencies(ideaPlugin);
  for (  IdeaPlugin anotherPlugin : IdeaPluginConverter.collectAllVisiblePlugins(DomUtil.getFile(ideaPlugin))) {
    final String value=anotherPlugin.getPluginId();
    if (value == null || dependencies.contains(value)) {
      registerExtensions(prefix,anotherPlugin,registrar,visited);
    }
  }
}
