{
  final StringBuilder classpathBuffer=StringBuilderSpinAllocator.alloc();
  try {
    for (    final VirtualFile file : cpFiles) {
      final String path;
      if (file.getFileSystem() instanceof LocalFileSystem && file.isDirectory()) {
        path=tryZipFor(file.getPath());
      }
 else {
        path=PathUtil.getLocalPath(file);
      }
      if (path == null) {
        continue;
      }
      if (classpathBuffer.length() > 0) {
        classpathBuffer.append(File.pathSeparatorChar);
      }
      classpathBuffer.append(path);
    }
    return classpathBuffer.toString();
  }
  finally {
    StringBuilderSpinAllocator.dispose(classpathBuffer);
  }
}
