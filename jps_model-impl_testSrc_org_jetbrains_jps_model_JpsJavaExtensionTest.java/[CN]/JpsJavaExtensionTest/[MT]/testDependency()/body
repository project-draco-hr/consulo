{
  final JpsModel model=myModel.createModifiableModel(new TestJpsEventDispatcher());
  final JpsModule module=model.getProject().addModule("m",JpsJavaModuleType.INSTANCE);
  final JpsLibrary library=model.getProject().addLibrary("l",JpsJavaLibraryType.INSTANCE);
  final JpsLibraryDependency dependency=module.getDependenciesList().addLibraryDependency(library);
  JpsJavaExtensionService.getInstance().getOrCreateDependencyExtension(dependency).setScope(JpsJavaDependencyScope.TEST);
  JpsJavaExtensionService.getInstance().getOrCreateDependencyExtension(dependency).setExported(true);
  model.commit();
  List<JpsDependencyElement> dependencies=assertOneElement(myProject.getModules()).getDependenciesList().getDependencies();
  assertEquals(2,dependencies.size());
  final JpsDependencyElement dep=dependencies.get(1);
  final JpsJavaDependencyExtension extension=JpsJavaExtensionService.getInstance().getDependencyExtension(dep);
  assertNotNull(extension);
  assertTrue(extension.isExported());
  assertSame(JpsJavaDependencyScope.TEST,extension.getScope());
}
