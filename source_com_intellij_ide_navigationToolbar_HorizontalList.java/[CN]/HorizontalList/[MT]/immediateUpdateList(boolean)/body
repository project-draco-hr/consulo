{
  if (update) {
    myFirstIndex=0;
    mySelectedIndex=-1;
    myList.clear();
    int index=0;
    for (    final Object object : myModel) {
      final MyCompositeLabel label=new MyCompositeLabel();
      label.getLabel().addMouseListener(new MouseAdapter(){
        public void mouseExited(        MouseEvent e){
          if (!hasChildren(object))           return;
          label.getLabel().setIcon(wrapIcon(object,Color.gray));
          label.repaint();
        }
        public void mouseClicked(        MouseEvent e){
          if (!hasChildren(object))           return;
          final int selectedIndex=myModel.indexOf(object);
          final ListPopup popup=getPopup();
          if (mySelectedIndex == selectedIndex && popup != null) {
            cancelPopup();
            if (isInsideIcon(e.getPoint(),object)) {
              label.getLabel().setIcon(wrapIcon(object,Color.black));
              label.getLabel().repaint();
            }
            return;
          }
          if (isInsideIcon(e.getPoint(),object)) {
            getCtrlClickHandler(selectedIndex).run();
            clearBorder();
            mySelectedIndex=selectedIndex;
            paintBorder();
            label.getLabel().setIcon(wrapIcon(object,Color.black));
            label.getLabel().repaint();
          }
        }
      }
);
      label.getLabel().addMouseMotionListener(new MouseMotionAdapter(){
        public void mouseMoved(        MouseEvent e){
          if (!hasChildren(object))           return;
          if (isInsideIcon(e.getPoint(),object)) {
            label.getLabel().setIcon(wrapIcon(object,Color.black));
          }
 else {
            label.getLabel().setIcon(wrapIcon(object,Color.gray));
          }
          label.repaint();
        }
      }
);
      label.setFont(UIUtil.getLabelFont());
      label.getLabel().setIcon(wrapIcon(object,Color.gray));
      label.getColoredComponent().append(getPresentableText(object),getTextAttributes(object,false));
      clearBorder(label.getColoredComponent());
      label.getLabel().setOpaque(false);
      label.getColoredComponent().setOpaque(true);
      label.setBackground(UIUtil.getListBackground());
      myList.add(label);
      installActions(index);
      index++;
    }
    paintComponent();
  }
}
