{
  final List<T> wasSelected=getSelectedChanges();
  if (!myAlwaysExpandList && !myShowFlatten) {
    myNonFlatTreeState=TreeState.createOn(this,getRoot());
  }
  myShowFlatten=showFlatten;
  setChangesToDisplay(getChanges());
  if (!myAlwaysExpandList && !myShowFlatten && myNonFlatTreeState != null) {
    myNonFlatTreeState.applyTo(this,getRoot());
  }
  select(wasSelected);
}
