{
  final VirtualFile[] roots=ModuleRootManager.getInstance(getModule()).getSourceRoots();
  final VirtualFile suggested=LocalFileSystem.getInstance().findFileByPath(rootPath);
  final VirtualFile root;
  if (roots.length == 0 || roots[0].getParent() == null || Arrays.asList(roots).contains(suggested)) {
    root=suggested;
  }
 else {
    root=roots[0];
  }
  final VirtualFile[] virtualFile=new VirtualFile[1];
  final VirtualFile dir=VfsUtil.createDirectories(root.getPath() + "/" + PathUtil.getParentPath(relativePath));
  new WriteCommandAction.Simple(getProject()){
    protected void run() throws Throwable {
      virtualFile[0]=dir.createChildData(this,StringUtil.getShortName(relativePath,'/'));
      VfsUtil.saveText(virtualFile[0],fileText);
    }
  }
.execute();
  return PsiManager.getInstance(getProject()).findFile(virtualFile[0]);
}
