{
  final VirtualFile dir=VfsUtil.createDirectories(rootPath + "/" + PathUtil.getParentPath(relativePath));
  final VirtualFile[] virtualFile=new VirtualFile[1];
  new WriteCommandAction.Simple(getProject()){
    @Override protected void run() throws Throwable {
      virtualFile[0]=dir.createChildData(this,StringUtil.getShortName(relativePath,'/'));
      VfsUtil.saveText(virtualFile[0],fileText);
    }
  }
.execute();
  return ApplicationManager.getApplication().runReadAction(new Computable<PsiFile>(){
    public PsiFile compute(){
      return PsiManager.getInstance(getProject()).findFile(virtualFile[0]);
    }
  }
);
}
