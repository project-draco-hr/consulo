{
  if (myContentEntryEditor != null && myContentEntryEditor.equals(contentEntryEditor)) {
    return;
  }
  if (myFileSystemTree != null) {
    Disposer.dispose(myFileSystemTree);
    myFileSystemTree=null;
  }
  if (myContentEntryEditor != null) {
    myContentEntryEditor.removeContentEntryEditorListener(myContentEntryEditorListener);
    myContentEntryEditor=null;
  }
  if (contentEntryEditor == null) {
    ((DefaultTreeModel)myTree.getModel()).setRoot(EMPTY_TREE_ROOT);
    myTreePanel.setVisible(false);
    return;
  }
  myTreePanel.setVisible(true);
  myContentEntryEditor=contentEntryEditor;
  myContentEntryEditor.addContentEntryEditorListener(myContentEntryEditorListener);
  final VirtualFile file=contentEntryEditor.getContentEntry().getFile();
  myDescriptor.setRoot(file);
  if (file != null) {
    myDescriptor.setTitle(file.getPresentableUrl());
  }
 else {
    final String url=contentEntryEditor.getContentEntry().getUrl();
    myDescriptor.setTitle(VirtualFileManager.extractPath(url).replace('/',File.separatorChar));
  }
  myFileSystemTree=new FileSystemTreeImpl(myProject,myDescriptor,myTree,getContentEntryCellRenderer()){
    protected AbstractTreeBuilder createTreeBuilder(    JTree tree,    DefaultTreeModel treeModel,    AbstractTreeStructure treeStructure,    Comparator<NodeDescriptor> comparator,    FileChooserDescriptor descriptor){
      return new MyFileTreeBuilder(tree,treeModel,treeStructure,comparator,descriptor);
    }
  }
;
  final NewFolderAction newFolderAction=new MyNewFolderAction(myFileSystemTree);
  DefaultActionGroup mousePopupGroup=new DefaultActionGroup();
  mousePopupGroup.add(myEditingActionsGroup);
  mousePopupGroup.addSeparator();
  mousePopupGroup.add(newFolderAction);
  myFileSystemTree.registerMouseListener(mousePopupGroup);
  myFileSystemTree.updateTree();
  if (file != null) {
    select(file);
  }
}
