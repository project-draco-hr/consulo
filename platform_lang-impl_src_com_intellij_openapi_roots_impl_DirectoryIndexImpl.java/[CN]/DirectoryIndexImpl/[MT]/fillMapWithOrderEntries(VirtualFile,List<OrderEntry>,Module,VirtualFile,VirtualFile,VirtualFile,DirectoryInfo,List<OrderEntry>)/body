{
  if (isIgnored(dir))   return;
  if (forDir != null) {
    if (!VfsUtil.isAncestor(dir,forDir,false))     return;
  }
  DirectoryInfo info=myDirToInfoMap.get(dir);
  if (info == null)   return;
  if (module != null) {
    if (info.module != module)     return;
    if (!info.isInModuleSource)     return;
  }
 else   if (libraryClassRoot != null) {
    if (info.libraryClassRoot != libraryClassRoot)     return;
    if (info.isInModuleSource)     return;
  }
 else   if (librarySourceRoot != null) {
    if (!info.isInLibrarySource)     return;
    if (info.sourceRoot != librarySourceRoot)     return;
    if (info.libraryClassRoot != null)     return;
  }
  final List<OrderEntry> oldEntries=info.getOrderEntries();
  info.addOrderEntries(orderEntries,parentInfo,oldParentEntries);
  final VirtualFile[] children=dir.getChildren();
  for (  VirtualFile child : children) {
    if (child.isDirectory()) {
      fillMapWithOrderEntries(child,orderEntries,module,libraryClassRoot,librarySourceRoot,forDir,info,oldEntries);
    }
  }
}
