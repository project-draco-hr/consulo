{
  checkAvailability();
  if (!(dir instanceof NewVirtualFile))   return null;
  RootIndex rootIndex=getRootIndex();
  String riResult=rootIndex != null ? rootIndex.getPackageName(dir) : null;
  if (ourUseRootIndexOnly) {
    return riResult;
  }
  return assertConsistentResult(dir,riResult,myState.getPackageNameForDirectory((NewVirtualFile)dir));
}
