{
  checkAvailability();
  dispatchPendingEvents();
  if (!(dir instanceof NewVirtualFile))   return null;
  RootIndex rootIndex=getRootIndex();
  DirectoryInfo riInfo=rootIndex != null ? rootIndex.getInfoForDirectory(dir) : null;
  if (ourUseRootIndexOnly) {
    return riInfo;
  }
  DirectoryInfo standardResult=myState.getInfo(((NewVirtualFile)dir).getId());
  assertConsistentResult(dir,riInfo,standardResult);
  if (standardResult != riInfo && standardResult.equals(riInfo) && rootIndex != null) {
    rootIndex.cacheInfos(dir,dir,standardResult);
  }
  return standardResult;
}
