{
  if (isIgnored(dir))   return;
  if (forDir != null) {
    if (!VfsUtil.isAncestor(dir,forDir,false))     return;
  }
  DirectoryInfo info=getOrCreateDirInfo(dir);
  if (info.libraryClassRoot != null) {
    if (info.packageName != null && info.packageName.length() == 0)     return;
  }
  info.libraryClassRoot=classRoot;
  if (!info.isInModuleSource && !info.isInLibrarySource) {
    setPackageName(dir,info,packageName);
  }
  VirtualFile[] children=dir.getChildren();
  for (  VirtualFile child : children) {
    if (child.isDirectory()) {
      String childPackageName=getPackageNameForSubdir(packageName,child.getName());
      fillMapWithLibraryClasses(child,childPackageName,classRoot,forDir);
    }
  }
}
