{
  MultiMap<VirtualFile,OrderEntry> depEntries=new MultiMap<VirtualFile,OrderEntry>();
  MultiMap<VirtualFile,OrderEntry> libClassRootEntries=new MultiMap<VirtualFile,OrderEntry>();
  MultiMap<VirtualFile,OrderEntry> libSourceRootEntries=new MultiMap<VirtualFile,OrderEntry>();
  for (  OrderEntry orderEntry : getOrderEntries(module)) {
    if (orderEntry instanceof ModuleOrderEntry) {
      final Module depModule=((ModuleOrderEntry)orderEntry).getModule();
      if (depModule != null) {
        VirtualFile[] importedClassRoots=OrderEnumerator.orderEntries(depModule).exportedOnly().recursively().classes().usingCache().getRoots();
        for (        VirtualFile importedClassRoot : importedClassRoots) {
          depEntries.putValue(importedClassRoot,orderEntry);
        }
      }
      VirtualFile[] sourceRoots=orderEntry.getFiles(OrderRootType.SOURCES);
      for (      VirtualFile sourceRoot : sourceRoots) {
        depEntries.putValue(sourceRoot,orderEntry);
      }
    }
 else     if (orderEntry instanceof ModuleSourceOrderEntry) {
      List<OrderEntry> oneEntryList=Arrays.asList(orderEntry);
      Module entryModule=orderEntry.getOwnerModule();
      VirtualFile[] sourceRoots=orderEntry.getFiles(OrderRootType.SOURCES);
      for (      VirtualFile sourceRoot : sourceRoots) {
        fillMapWithOrderEntries(sourceRoot,oneEntryList,entryModule,null,null,null,null);
      }
    }
 else     if (orderEntry instanceof LibraryOrderEntry || orderEntry instanceof JdkOrderEntry) {
      VirtualFile[] classRoots=orderEntry.getFiles(OrderRootType.CLASSES);
      for (      VirtualFile classRoot : classRoots) {
        libClassRootEntries.putValue(classRoot,orderEntry);
      }
      VirtualFile[] sourceRoots=orderEntry.getFiles(OrderRootType.SOURCES);
      for (      VirtualFile sourceRoot : sourceRoots) {
        libSourceRootEntries.putValue(sourceRoot,orderEntry);
      }
    }
  }
  for (  Map.Entry<VirtualFile,Collection<OrderEntry>> mapEntry : depEntries.entrySet()) {
    final VirtualFile vRoot=mapEntry.getKey();
    final Collection<OrderEntry> entries=mapEntry.getValue();
    fillMapWithOrderEntries(vRoot,entries,null,null,null,null,null);
  }
  for (  Map.Entry<VirtualFile,Collection<OrderEntry>> mapEntry : libClassRootEntries.entrySet()) {
    final VirtualFile vRoot=mapEntry.getKey();
    final Collection<OrderEntry> entries=mapEntry.getValue();
    fillMapWithOrderEntries(vRoot,entries,null,vRoot,null,null,null);
  }
  for (  Map.Entry<VirtualFile,Collection<OrderEntry>> mapEntry : libSourceRootEntries.entrySet()) {
    final VirtualFile vRoot=mapEntry.getKey();
    final Collection<OrderEntry> entries=mapEntry.getValue();
    fillMapWithOrderEntries(vRoot,entries,null,null,vRoot,null,null);
  }
}
