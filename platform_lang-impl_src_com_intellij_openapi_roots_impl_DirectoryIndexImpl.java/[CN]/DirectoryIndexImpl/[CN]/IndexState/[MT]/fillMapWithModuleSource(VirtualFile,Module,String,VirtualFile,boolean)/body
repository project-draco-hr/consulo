{
  DirectoryInfo info=myDirToInfoMap.get(dir);
  if (info == null)   return;
  if (!module.equals(info.module))   return;
  if (info.isInModuleSource) {
    String definedPackage=myDirToPackageName.get(dir);
    if (definedPackage != null && definedPackage.length() == 0)     return;
  }
  info.isInModuleSource=true;
  info.isTestSource=isTestSource;
  info.sourceRoot=sourceRoot;
  setPackageName(dir,packageName);
  VirtualFile[] children=dir.getChildren();
  for (  VirtualFile child : children) {
    if (child.isDirectory()) {
      String childPackageName=getPackageNameForSubdir(packageName,child.getName());
      fillMapWithModuleSource(child,module,childPackageName,sourceRoot,isTestSource);
    }
  }
}
