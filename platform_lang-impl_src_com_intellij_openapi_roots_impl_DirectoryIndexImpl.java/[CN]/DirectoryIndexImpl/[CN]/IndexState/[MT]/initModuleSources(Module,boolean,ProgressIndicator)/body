{
  assertWritable();
  progress.checkCanceled();
  progress.setText2(ProjectBundle.message("project.index.processing.module.sources.progress",module.getName()));
  ContentEntry[] contentEntries=getContentEntries(module);
  if (reverseAllSets) {
    contentEntries=ArrayUtil.reverseArray(contentEntries);
  }
  for (  ContentEntry contentEntry : contentEntries) {
    VirtualFile contentRoot=contentEntry.getFile();
    SourceFolder[] sourceFolders=contentEntry.getSourceFolders();
    if (reverseAllSets) {
      sourceFolders=ArrayUtil.reverseArray(sourceFolders);
    }
    for (    SourceFolder sourceFolder : sourceFolders) {
      VirtualFile dir=sourceFolder.getFile();
      if (dir instanceof NewVirtualFile && contentRoot instanceof NewVirtualFile) {
        fillMapWithModuleSource(module,(NewVirtualFile)contentRoot,(NewVirtualFile)dir,sourceFolder.getPackagePrefix(),(NewVirtualFile)dir,sourceFolder.isTestSource(),progress);
      }
    }
  }
}
