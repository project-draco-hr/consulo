{
  ProgressIndicator progress=ProgressManager.getInstance().getProgressIndicator();
  if (progress == null)   progress=new EmptyProgressIndicator();
  progress.pushState();
  progress.checkCanceled();
  progress.setText(ProjectBundle.message("project.index.scanning.files.progress"));
  Module[] modules=ModuleManager.getInstance(myProject).getModules();
  if (reverseAllSets)   modules=ArrayUtil.reverseArray(modules);
  initExcludedDirMap(modules,progress);
  for (  Module module : modules) {
    initModuleContents(module,reverseAllSets,progress);
  }
  for (  Module module : modules) {
    initModuleSources(module,reverseAllSets,progress);
    initLibrarySources(module,progress);
    initLibraryClasses(module,progress);
  }
  progress.checkCanceled();
  progress.setText2("");
  for (  Module module : modules) {
    initOrderEntries(module);
  }
  progress.popState();
}
