{
  PsiElement parent=reference.getElement().getParent();
  if (parent instanceof PsiMethodCallExpression) {
    PsiMethodCallExpression callExpr=(PsiMethodCallExpression)parent;
    boolean allowStatics=false;
    PsiExpression qualifier=callExpr.getMethodExpression().getQualifierExpression();
    if (qualifier == null) {
      allowStatics=true;
    }
 else     if (qualifier instanceof PsiJavaCodeReferenceElement) {
      PsiElement referee=((PsiJavaCodeReferenceElement)qualifier).advancedResolve(true).getElement();
      if (referee instanceof PsiClass)       allowStatics=true;
    }
    PsiManager manager=PsiManager.getInstance(project);
    PsiResolveHelper helper=manager.getResolveHelper();
    PsiElement[] candidates=PsiUtil.mapElements(helper.getReferencedMethodCandidates(callExpr,false));
    ArrayList<PsiElement> methods=new ArrayList<PsiElement>();
    for (    PsiElement candidate1 : candidates) {
      PsiMethod candidate=(PsiMethod)candidate1;
      if (candidate.hasModifierProperty(PsiModifier.STATIC) && !allowStatics)       continue;
      List<PsiMethod> supers=Arrays.asList(PsiSuperMethodUtil.findSuperMethods(candidate));
      if (supers.isEmpty()) {
        methods.add(candidate);
      }
 else {
        methods.addAll(supers);
      }
    }
    return methods;
  }
  if (reference instanceof PsiPolyVariantReference) {
    return Arrays.asList(PsiUtil.mapElements(((PsiPolyVariantReference)reference).multiResolve(false)));
  }
  if (reference instanceof PsiMultiReference) {
    PsiReference[] references=((PsiMultiReference)reference).getReferences();
    Set<PsiElement> result=new THashSet<PsiElement>();
    for (    PsiReference psiReference : references) {
      result.addAll(resolveElements(psiReference,project));
    }
    return result;
  }
  PsiElement resolved=reference.resolve();
  if (resolved != null) {
    return Collections.singleton(resolved);
  }
  return Collections.EMPTY_LIST;
}
