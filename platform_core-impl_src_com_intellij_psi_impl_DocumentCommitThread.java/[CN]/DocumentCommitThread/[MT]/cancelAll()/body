{
synchronized (lock) {
    String reason="Cancel all in tests";
    cancel(reason);
    for (    CommitTask commitTask : documentsToCommit) {
      commitTask.cancel(reason,this);
      log(commitTask.project,"Removed from background queue",commitTask);
    }
    documentsToCommit.clear();
    for (    CommitTask commitTask : documentsToApplyInEDT) {
      commitTask.cancel(reason,this);
      log(commitTask.project,"Removed from EDT apply queue (sync commit called)",commitTask);
    }
    documentsToApplyInEDT.clear();
    CommitTask task=currentTask;
    if (task != null) {
      cancelAndRemoveFromDocsToCommit(task,reason);
    }
    cancel("Sync commit intervened");
    ((BoundedTaskExecutor)executor).clearAndCancelAll();
  }
}
