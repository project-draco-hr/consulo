{
  CodeStyleManager.getInstance(file.getProject()).performActionWithFormatterDisabled(new Runnable(){
    @Override public void run(){
synchronized (PsiLock.LOCK) {
        file.getViewProvider().beforeContentsSynchronized();
        final Document document=file.getViewProvider().getDocument();
        PsiDocumentManagerBase documentManager=(PsiDocumentManagerBase)PsiDocumentManager.getInstance(file.getProject());
        PsiToDocumentSynchronizer.DocumentChangeTransaction transaction=documentManager.getSynchronizer().getTransaction(document);
        final PsiFileImpl fileImpl=(PsiFileImpl)file;
        if (transaction == null) {
          final PomModel model=PomManager.getModel(fileImpl.getProject());
          model.runTransaction(new PomTransactionBase(fileImpl,model.getModelAspect(TreeAspect.class)){
            @Override public PomModelEvent runInner(){
              return new TreeAspectEvent(model,diffLog.performActualPsiChange(file));
            }
          }
);
        }
 else {
          diffLog.performActualPsiChange(file);
        }
      }
    }
  }
);
}
