{
  final SortedSet<String> profiles=new TreeSet<String>();
  final MavenEmbedder embedder=MavenFactory.createEmbedderForRead(getCoreState());
  final MavenProjectReader reader=new MavenProjectReader(embedder);
  for (  VirtualFile file : files) {
    ProjectUtil.collectProfileIds(reader.readBare(file.getPath()),profiles);
  }
  MavenFactory.releaseEmbedder(embedder);
  return new ArrayList<String>(profiles);
}
