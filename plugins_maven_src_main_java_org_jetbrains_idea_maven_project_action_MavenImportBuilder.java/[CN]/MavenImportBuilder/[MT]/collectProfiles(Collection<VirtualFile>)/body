{
  Map<VirtualFile,Set<String>> result=new HashMap<VirtualFile,Set<String>>();
  try {
    MavenEmbedder e=EmbedderFactory.createEmbedderForRead(getCoreState());
    MavenProjectReader r=new MavenProjectReader(e);
    for (    VirtualFile f : files) {
      Set<String> profiles=new LinkedHashSet<String>();
      ProjectUtil.collectProfileIds(r.readModel(f.getPath()),profiles);
      if (!profiles.isEmpty())       result.put(f,profiles);
    }
    EmbedderFactory.releaseEmbedder(e);
  }
 catch (  MavenException ignore) {
  }
  return result;
}
