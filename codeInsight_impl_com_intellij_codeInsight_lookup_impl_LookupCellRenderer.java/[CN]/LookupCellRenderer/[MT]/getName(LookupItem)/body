{
  final Object o=item.getObject();
  String name=item.getPresentableText();
  if (o instanceof PsiElement) {
    final PsiElement element=(PsiElement)o;
    if (element.isValid()) {
      name=PsiUtil.getName(element);
      if (element instanceof PsiAnonymousClass) {
        name=null;
      }
 else       if (element instanceof PsiClass) {
        PsiSubstitutor substitutor=(PsiSubstitutor)item.getAttribute(LookupItem.SUBSTITUTOR);
        if (substitutor != null && !substitutor.isValid()) {
          PsiType type=(PsiType)item.getAttribute(LookupItem.TYPE);
          if (type != null) {
            name=type.getPresentableText();
          }
        }
 else {
          name=formatTypeName((PsiClass)element,substitutor);
        }
      }
 else       if (element instanceof PsiKeyword || element instanceof PsiExpression || element instanceof PsiTypeElement) {
        name=element.getText();
      }
 else       if (o instanceof Property) {
        Property property=(Property)o;
        name=property.getKey();
      }
    }
  }
 else   if (o instanceof PsiArrayType) {
    name=((PsiArrayType)o).getDeepComponentType().getPresentableText();
  }
 else   if (o instanceof PsiType) {
    name=((PsiType)o).getPresentableText();
  }
 else   if (o instanceof Template) {
    name=getKeyString((Template)o);
  }
 else   if (o instanceof XmlElementDescriptor) {
    name=((XmlElementDescriptor)o).getDefaultName();
  }
 else   if (o instanceof PsiMetaDataBase) {
    name=((PsiMetaDataBase)o).getName();
  }
 else   if (o instanceof PresentableLookupValue) {
    name=((PresentableLookupValue)o).getPresentation();
  }
 else {
    name=String.valueOf(o);
  }
  if (name == null) {
    name="";
  }
  if (item.getAttribute(LookupItem.FORCE_QUALIFY) != null) {
    if (o instanceof PsiMember && ((PsiMember)o).getContainingClass() != null) {
      name=((PsiMember)o).getContainingClass().getName() + "." + name;
    }
  }
  return name;
}
