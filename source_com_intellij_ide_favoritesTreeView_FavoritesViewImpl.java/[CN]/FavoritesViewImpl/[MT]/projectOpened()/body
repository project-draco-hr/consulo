{
  StartupManager.getInstance(myProject).registerPostStartupActivity(new Runnable(){
    public void run(){
      ToolWindowManager toolWindowManager=ToolWindowManager.getInstance(myProject);
      ToolWindow toolWindow=toolWindowManager.registerToolWindow(ToolWindowId.FAVORITES_VIEW,getComponent(),ToolWindowAnchor.RIGHT);
      toolWindow.setIcon(IconLoader.getIcon("/general/favorites.png"));
      new ContentManagerWatcher(toolWindow,FavoritesViewImpl.this);
      final ContentFactory contentFactory=PeerFactory.getInstance().getContentFactory();
      final DefaultActionGroup favoritesActionsGroup=((DefaultActionGroup)ActionManager.getInstance().getAction(IdeActions.ADD_TO_FAVORITES));
      favoritesActionsGroup.removeAll();
      favoritesActionsGroup.add(new AddToNewFavoritesListAction());
      favoritesActionsGroup.addSeparator();
      if (myName2FavoritesListSet.isEmpty()) {
        final FavoritesTreeViewPanel panel=new FavoritesTreeViewPanel(myProject,null,myProject.getName());
        final Content favoritesContent=contentFactory.createContent(panel,myProject.getName(),false);
        addContent(favoritesContent);
        final String key=myProject.getName();
        myName2FavoritesListSet.put(key,favoritesContent);
        myCurrentFavoritesList=key;
        panel.getFavoritesTreeStructure().initFavoritesList();
        final AddToFavoritesAction addAction=new AddToFavoritesAction(key);
        myActions.put(key,addAction);
        favoritesActionsGroup.add(addAction);
      }
 else {
        for (Iterator<String> iterator=myName2FavoritesListSet.keySet().iterator(); iterator.hasNext(); ) {
          final String key=iterator.next();
          final AddToFavoritesAction addAction=new AddToFavoritesAction(key);
          myActions.put(key,addAction);
          favoritesActionsGroup.add(addAction);
          final Content content=myName2FavoritesListSet.get(key);
          addContent(content);
          ((FavoritesTreeViewPanel)content.getComponent()).getFavoritesTreeStructure().initFavoritesList();
          if (key.equals(myCurrentFavoritesList)) {
            setSelectedContent(content);
          }
        }
      }
    }
  }
);
}
