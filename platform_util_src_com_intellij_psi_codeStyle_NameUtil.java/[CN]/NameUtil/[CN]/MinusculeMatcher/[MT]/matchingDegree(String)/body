{
  Iterable<TextRange> iterable=matchingFragments(name);
  if (iterable == null)   return Integer.MIN_VALUE;
  int fragmentCount=0;
  int matchingCaps=0;
  CharArrayCharSequence seq=new CharArrayCharSequence(myPattern);
  int p=-1;
  TextRange first=null;
  for (  TextRange range : iterable) {
    if (first == null) {
      first=range;
    }
    for (int i=range.getStartOffset(); i < range.getEndOffset(); i++) {
      char c=name.charAt(i);
      p=StringUtil.indexOf(seq,c,p + 1,myPattern.length,false);
      if (p < 0) {
        break;
      }
      if (Character.isUpperCase(myPattern[p])) {
        matchingCaps+=c == myPattern[p] ? 1 : -1;
      }
    }
    fragmentCount++;
  }
  int commonStart=0;
  while (commonStart < name.length() && commonStart < myPattern.length && name.charAt(commonStart) == myPattern[commonStart]) {
    commonStart++;
  }
  boolean prefixMatching=first != null && first.getStartOffset() == 0;
  boolean middleWordStart=first != null && first.getStartOffset() > 0 && isWordStart(name,first.getStartOffset());
  return -fragmentCount + matchingCaps * 10 + commonStart * 2 + (prefixMatching ? 2 : middleWordStart ? 1 : 0);
}
