{
  CharacterIterator it=new StringCharacterIterator(word);
  StringBuffer b=new StringBuffer();
  WordState state=WordState.NO_WORD;
  char curPrevUC='\0';
  for (char c=it.first(); c != CharacterIterator.DONE; c=it.next()) {
switch (state) {
case NO_WORD:
      if (!Character.isUpperCase(c)) {
        b.append(c);
        state=WordState.WORD;
      }
 else {
        state=WordState.PREV_UC;
        curPrevUC=c;
      }
    break;
case PREV_UC:
  if (!Character.isUpperCase(c)) {
    b=startNewWord(result,b,curPrevUC);
    b.append(c);
    state=WordState.WORD;
  }
 else {
    b.append(curPrevUC);
    state=WordState.PREV_UC;
    curPrevUC=c;
  }
break;
case WORD:
if (Character.isUpperCase(c)) {
startNewWord(result,b,c);
b.setLength(0);
state=WordState.PREV_UC;
curPrevUC=c;
}
 else {
b.append(c);
}
break;
}
}
if (state == WordState.PREV_UC) {
b.append(curPrevUC);
}
result.add(b.toString());
}
