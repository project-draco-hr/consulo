{
  if (context.getProject().isDisposed()) {
    return EMPTY_GENERATION_ITEM_ARRAY;
  }
  List<GenerationItem> results=new ArrayList<GenerationItem>(items.length);
  for (  GenerationItem item : items) {
    if (item instanceof IdlGenerationItem) {
      final IdlGenerationItem idlItem=(IdlGenerationItem)item;
      if (!AndroidCompileUtil.isModuleAffected(context,idlItem.myModule)) {
        continue;
      }
      try {
        VirtualFile[] sourceRoots=AndroidPackagingCompiler.getSourceRootsForModuleAndDependencies(idlItem.myModule);
        final String[] sourceRootPaths=AndroidCompileUtil.toOsPaths(sourceRoots);
        final Map<CompilerMessageCategory,List<String>> messages=AndroidIdl.execute(idlItem.myAndroidTarget,idlItem.myFile.getPath(),idlItem.myGeneratedFile.getPath(),sourceRootPaths);
        ApplicationManager.getApplication().runReadAction(new Runnable(){
          public void run(){
            if (context.getProject().isDisposed())             return;
            addMessages(context,messages,idlItem.myFile.getUrl());
          }
        }
);
        if (messages.get(CompilerMessageCategory.ERROR).isEmpty()) {
          results.add(idlItem);
        }
        if (idlItem.myGeneratedFile.exists()) {
          ApplicationManager.getApplication().runReadAction(new Runnable(){
            public void run(){
              if (idlItem.myModule.getProject().isDisposed())               return;
              String className=FileUtil.getNameWithoutExtension(idlItem.myGeneratedFile);
              AndroidCompileUtil.removeDuplicatingClasses(idlItem.myModule,idlItem.myPackageName,className,idlItem.myGeneratedFile.exists() ? idlItem.myGeneratedFile : null,idlItem.mySourceRootPath);
            }
          }
);
        }
      }
 catch (      final IOException e) {
        ApplicationManager.getApplication().runReadAction(new Runnable(){
          public void run(){
            if (context.getProject().isDisposed())             return;
            context.addMessage(CompilerMessageCategory.ERROR,e.getMessage(),idlItem.myFile.getUrl(),-1,-1);
          }
        }
);
      }
    }
  }
  return results.toArray(new GenerationItem[results.size()]);
}
