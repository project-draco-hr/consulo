{
  boolean wasLocked=isLocked();
  if (!wasLocked) {
    lock();
  }
  try {
    runnable.run();
  }
  finally {
    if (!wasLocked) {
      unlock();
    }
  }
}
