{
  myProject=project;
  final PsiDocumentManager psiDocumentManager=PsiDocumentManager.getInstance(project);
  final CommittableUtil committableUtil=ServiceManager.getService(project,CommittableUtil.class);
  CommandProcessor.getInstance().addCommandListener(new CommandAdapter(){
    public void commandStarted(    CommandEvent event){
      undoTransparentActionStarted();
    }
    public void undoTransparentActionStarted(){
      myDirty=false;
    }
    public void undoTransparentActionFinished(){
      if (myDirty) {
        psiDocumentManager.commitAllDocuments();
        committableUtil.queueReset(committable);
      }
    }
    public void commandFinished(    CommandEvent event){
      undoTransparentActionFinished();
    }
  }
,committable);
}
