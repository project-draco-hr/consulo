{
  final DirDiffTableModel model=(DirDiffTableModel)table.getModel();
  final DirDiffElementImpl element=model.getElementAt(row);
  if (element.isSeparator()) {
    return new JPanel(){
      @Override public void paint(      Graphics g){
        super.paint(g);
        int offset=0;
        int i=0;
        final TableColumnModel columnModel=table.getColumnModel();
        while (i < column) {
          offset+=columnModel.getColumn(i).getWidth();
          i++;
        }
        int width=columnModel.getColumn(column).getWidth();
        int height=table.getRowHeight(row);
        final BufferedImage image=getOrCreate(element.getName(),element.getIcon());
        g.drawImage(image,0,0,width,height,offset,0,offset + width,height,null);
      }
    }
;
  }
  final Component c=super.getTableCellRendererComponent(table,value,isSelected,hasFocus,row,column);
  if (c instanceof JLabel) {
    final JLabel label=(JLabel)c;
    if (hasFocus || isSelected) {
      label.setBorder(noFocusBorder);
    }
    label.setIcon(null);
    final DirDiffOperation op=element.getOperation();
    if (column == (table.getColumnCount() - 1) / 2) {
      label.setIcon(op.getIcon());
      label.setHorizontalAlignment(CENTER);
      return label;
    }
    Color fg=isSelected ? UIUtil.getTableSelectionForeground() : op.getTextColor();
    label.setForeground(fg);
    final String name=table.getColumnName(column);
    if (DirDiffTableModel.COLUMN_DATE.equals(name)) {
      label.setHorizontalAlignment(CENTER);
    }
 else     if (DirDiffTableModel.COLUMN_SIZE.equals(name)) {
      label.setHorizontalAlignment(RIGHT);
    }
 else {
      label.setHorizontalAlignment(LEFT);
      final String text=label.getText();
      label.setText("  " + text);
      if (text != null && text.trim().length() > 0) {
        label.setIcon(element.getIcon());
      }
    }
  }
  return c;
}
