{
  if (myType == null) {
    myType=getLanguage().getAssociatedFileType();
    if (myType == null) {
      PsiFile originalFile=getOriginalFile();
      if (originalFile != null) {
        myType=originalFile.getFileType();
      }
 else {
        VirtualFile virtualFile=getVirtualFile();
        myType=virtualFile == null ? FileTypeManager.getInstance().getFileTypeByFileName(getName()) : virtualFile.getFileType();
      }
    }
  }
  return myType;
}
