{
  try {
    final Collection<VirtualFile> initiallyUnmergedFiles=getUnmergedFiles(myProject,myRoots);
    if (initiallyUnmergedFiles.isEmpty()) {
      LOG.info("merge: no unmerged files");
      return mergeDialogInvokedFromNotification ? true : proceedIfNothingToMerge();
    }
 else {
      showMergeDialog(initiallyUnmergedFiles);
      final Collection<VirtualFile> unmergedFilesAfterResolve=getUnmergedFiles(myProject,myRoots);
      if (unmergedFilesAfterResolve.isEmpty()) {
        LOG.info("merge no more unmerged files");
        return mergeDialogInvokedFromNotification ? true : proceedAfterAllMerged();
      }
 else {
        LOG.info("mergeFiles unmerged files remain: " + unmergedFilesAfterResolve);
        if (mergeDialogInvokedFromNotification) {
          notifyUnresolvedRemainAfterNotification();
        }
 else {
          notifyUnresolvedRemain();
        }
      }
    }
  }
 catch (  VcsException e) {
    notifyException(mergeDialogInvokedFromNotification,e);
  }
  return false;
}
