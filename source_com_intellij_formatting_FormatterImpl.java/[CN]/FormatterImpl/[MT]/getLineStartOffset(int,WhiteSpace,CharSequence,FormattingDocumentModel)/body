{
  int lineStartOffset=offset;
  lineStartOffset=CharArrayUtil.shiftBackwardUntil(text,lineStartOffset," \t\n");
  if (lineStartOffset > whiteSpace.getTextRange().getStartOffset()) {
    if (lineStartOffset >= text.length())     lineStartOffset=text.length() - 1;
    if (text.charAt(lineStartOffset) == '\n' && whiteSpace.getTextRange().getStartOffset() <= documentModel.getLineStartOffset(documentModel.getLineNumber(lineStartOffset - 1))) {
      lineStartOffset--;
    }
    lineStartOffset=CharArrayUtil.shiftBackward(text,lineStartOffset,"\t ");
    if (lineStartOffset < 0)     lineStartOffset=0;
    if (lineStartOffset != offset && text.charAt(lineStartOffset) == '\n') {
      lineStartOffset++;
    }
  }
  return lineStartOffset;
}
