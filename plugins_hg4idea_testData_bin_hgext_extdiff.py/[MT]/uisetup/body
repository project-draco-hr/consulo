def uisetup(ui):
    for (cmd, path) in ui.configitems('extdiff'):
        if cmd.startswith('cmd.'):
            cmd = cmd[4:]
            if (not path):
                path = cmd
            diffopts = ui.config('extdiff', ('opts.' + cmd), '')
            diffopts = ((diffopts and [diffopts]) or [])
        elif cmd.startswith('opts.'):
            continue
        elif path:
            diffopts = shlex.split(path)
            path = diffopts.pop(0)
        else:
            (path, diffopts) = (cmd, [])

        def save(cmd, path, diffopts):
            'use closure to save diff command to use'

            def mydiff(ui, repo, *pats, **opts):
                return dodiff(ui, repo, path, (diffopts + opts['option']), pats, opts)
            doc = (_('use %(path)s to diff repository (or selected files)\n\n    Show differences between revisions for the specified files, using\n    the %(path)s program.\n\n    When two revision arguments are given, then changes are shown\n    between those revisions. If only one revision is specified then\n    that revision is compared to the working directory, and, when no\n    revisions are specified, the working directory files are compared\n    to its parent.') % dict(path=util.uirepr(path)))
            mydiff.__doc__ = doc.decode(encoding.encoding)
            return mydiff
        cmdtable[cmd] = (save(cmd, path, diffopts), cmdtable['extdiff'][1][1:], (_('hg %s [OPTION]... [FILE]...') % cmd))
