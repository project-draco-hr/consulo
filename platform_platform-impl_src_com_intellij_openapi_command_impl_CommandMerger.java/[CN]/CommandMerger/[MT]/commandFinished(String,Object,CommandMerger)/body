{
  if (!shouldMerge(groupId,nextCommandToMerge)) {
    flushCurrentCommand();
    myManager.compact();
  }
  merge(nextCommandToMerge);
  if (nextCommandToMerge.isTransparent() || !hasActions())   return;
  clearRedoStacks(nextCommandToMerge);
  myLastGroupId=groupId;
  if (myCommandName == null)   myCommandName=commandName;
}
