{
  if (!isUndoTransparent)   myOnlyUndoTransparents=false;
  if (isUndoTransparent)   myHasUndoTransparents=true;
  myCurrentActions.add(action);
  DocumentReference[] refs=action.getAffectedDocuments();
  if (refs != null) {
    Collections.addAll(myAffectedDocuments,refs);
  }
  myIsComplex|=action.shouldConfirmUndo() || !isUndoTransparent && affectsMultiplePhysicalDocs();
}
