{
  VirtualFile virtualFile=(VirtualFile)dataContext.getData(DataConstantsEx.VIRTUAL_FILE);
  if (virtualFile == null) {
    return null;
  }
  if (virtualFile instanceof ResourceBundleAsVirtualFile) {
    return ((ResourceBundleAsVirtualFile)virtualFile).getResourceBundle();
  }
  Project project=(Project)dataContext.getData(DataConstants.PROJECT);
  if (project != null) {
    final PsiFile psiFile=PsiManager.getInstance(project).findFile(virtualFile);
    if (psiFile instanceof PropertiesFile) {
      return ((PropertiesFile)psiFile).getResourceBundle();
    }
  }
  return null;
}
