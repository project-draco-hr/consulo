{
  ProjectStructureNode<ProjectEntityId> result=new ProjectStructureNode<ProjectEntityId>(myFactory.buildDescriptor(entity));
  Pair<String,Collection<ProjectStructureNode>> pair=processed.get(entity);
  if (pair == null) {
    String cardName=String.valueOf(counter);
    List<ProjectStructureNode> nodes=new ArrayList<ProjectStructureNode>();
    nodes.add(result);
    processed.put(entity,new Pair<String,Collection<ProjectStructureNode>>(cardName,nodes));
    GradleProjectStructureNodeSettings settings=myFactory.buildSettings(entity,myTreeModel,nodes);
    myCards.put(result,new Pair<String,GradleProjectStructureNodeSettings>(cardName,settings));
    mySettingsPanel.add(settings.getComponent(),cardName);
  }
 else {
    pair.second.add(result);
    for (    ProjectStructureNode node : pair.second) {
      Pair<String,GradleProjectStructureNodeSettings> settingsPair=myCards.get(node);
      if (settingsPair != null) {
        myCards.put(result,settingsPair);
        break;
      }
    }
  }
  return result;
}
