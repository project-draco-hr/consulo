{
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  CodeFoldingManager.getInstance(project).updateFoldRegions(editor);
  final FoldRegion[] allFoldRegions=editor.getFoldingModel().getAllFoldRegions();
  Runnable processor=new Runnable(){
    public void run(){
      for (int i=0; i < allFoldRegions.length; i++) {
        FoldRegion region=allFoldRegions[i];
        region.setExpanded(false);
      }
    }
  }
;
  editor.getFoldingModel().runBatchFoldingOperation(processor);
}
