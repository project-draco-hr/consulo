{
  if (!myEditor.getSettings().isIndentGuidesShown())   return Collections.emptyList();
  int[] lineIndents=calcIndents();
  List<IndentGuideDescriptor> descriptors=new ArrayList<IndentGuideDescriptor>();
  IntStack lines=new IntStack();
  IntStack indents=new IntStack();
  lines.push(0);
  indents.push(0);
  final CharSequence chars=myDocument.getCharsSequence();
  for (int line=1; line < lineIndents.length; line++) {
    ProgressManager.checkCanceled();
    int curIndent=lineIndents[line];
    while (!indents.empty() && curIndent <= indents.peek()) {
      ProgressManager.checkCanceled();
      final int level=indents.pop();
      int startLine=lines.pop();
      descriptors.add(createDescriptor(level,startLine,line,chars));
    }
    int prevLine=line - 1;
    int prevIndent=lineIndents[prevLine];
    if (curIndent - prevIndent > 1) {
      lines.push(prevLine);
      indents.push(prevIndent);
    }
  }
  while (!indents.empty()) {
    ProgressManager.checkCanceled();
    final int level=indents.pop();
    if (level > 0) {
      int startLine=lines.pop();
      descriptors.add(createDescriptor(level,startLine,myDocument.getLineCount(),chars));
    }
  }
  return descriptors;
}
