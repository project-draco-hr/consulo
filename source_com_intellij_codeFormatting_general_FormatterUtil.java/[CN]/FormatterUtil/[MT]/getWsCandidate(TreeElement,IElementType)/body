{
  if (element == null)   return null;
  TreeElement treePrev=element.getTreePrev();
  if (treePrev != null) {
    TreeElement candidate=getLastChildOf(treePrev);
    if (candidate != null && isSpace(candidate)) {
      return candidate;
    }
 else     if (candidate != null && candidate.getTextLength() == 0) {
      return getWsCandidate(candidate,fileElementType);
    }
 else {
      return element;
    }
  }
  final CompositeElement treeParent=element.getTreeParent();
  if (treeParent == null || treeParent.getTreeParent() == null || treeParent.getElementType() == fileElementType) {
    return element;
  }
 else {
    return getWsCandidate(treeParent,fileElementType);
  }
}
