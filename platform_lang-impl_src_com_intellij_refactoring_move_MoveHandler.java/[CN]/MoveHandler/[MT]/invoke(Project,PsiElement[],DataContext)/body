{
  final PsiElement targetContainer=dataContext == null ? null : LangDataKeys.TARGET_PSI_ELEMENT.getData(dataContext);
  final Set<PsiElement> filesOrDirs=new HashSet<PsiElement>();
  for (  MoveHandlerDelegate delegate : Extensions.getExtensions(MoveHandlerDelegate.EP_NAME)) {
    if (delegate.canMove(dataContext) && delegate.isValidTarget(targetContainer,elements)) {
      delegate.collectFilesOrDirsFromContext(dataContext,filesOrDirs);
    }
  }
  if (!filesOrDirs.isEmpty()) {
    for (    PsiElement element : elements) {
      if (element instanceof PsiDirectory) {
        filesOrDirs.add(element);
      }
 else {
        final PsiFile containingFile=element.getContainingFile();
        if (containingFile != null) {
          filesOrDirs.add(containingFile);
        }
      }
    }
    MoveFilesOrDirectoriesUtil.doMove(project,PsiUtilBase.toPsiElementArray(filesOrDirs),new PsiElement[]{targetContainer},null);
    return;
  }
  doMove(project,elements,targetContainer,dataContext,null);
}
