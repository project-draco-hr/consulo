{
  int lessPos=referenceText.length();
  int bracesBalance=0;
  int i;
  loop:   for (i=referenceText.length() - 1; i >= 0; i--) {
    final char aChar=referenceText.charAt(i);
switch (aChar) {
case ')':
case '>':
      bracesBalance++;
    break;
case '(':
case '<':
  bracesBalance--;
lessPos=i;
break;
case '@':
case '.':
if (bracesBalance == 0) break loop;
break;
default :
if (bracesBalance == 0 && removeWhitespace && !Character.isWhitespace(aChar) && !Character.isJavaIdentifierPart(aChar)) {
return getShortClassName(removeWhitespace(referenceText),false);
}
}
}
String sub=referenceText.substring(i + 1,lessPos).trim();
return sub.length() == referenceText.length() ? sub : new String(sub);
}
