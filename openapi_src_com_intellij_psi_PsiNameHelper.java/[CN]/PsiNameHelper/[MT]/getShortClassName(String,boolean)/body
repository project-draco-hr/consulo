{
  final char[] chars=referenceText.toCharArray();
  int lessPos=chars.length;
  int bracesBalance=0;
  for (int i=chars.length - 1; i >= 0; i--) {
    final char aChar=chars[i];
switch (aChar) {
case ')':
case '>':
      bracesBalance++;
    break;
case '(':
case '<':
  bracesBalance--;
lessPos=i;
break;
case '@':
case '.':
if (bracesBalance == 0) return new String(chars,i + 1,lessPos - (i + 1)).trim();
break;
default :
if (bracesBalance == 0 && removeWhitespace && !Character.isWhitespace(aChar) && !Character.isJavaIdentifierPart(aChar)) {
return getShortClassName(removeWhitespace(referenceText),false);
}
}
}
String substring=lessPos == chars.length ? referenceText : new String(chars,0,lessPos);
return substring.trim();
}
