{
  PsiFile containingFile=element.getContainingFile();
  if (element instanceof StubBasedPsiElement && containingFile instanceof PsiFileWithStubSupport) {
    PsiFileWithStubSupport stubFile=(PsiFileWithStubSupport)containingFile;
    StubTree stubTree=stubFile.getStubTree();
    if (stubTree != null) {
      StubBasedPsiElement stubPsi=(StubBasedPsiElement)element;
      int stubId=PsiAnchor.calcStubIndex(stubPsi);
      IStubElementType myStubElementType=stubPsi.getElementType();
      if (stubId != -1) {
        return new AnchorElementInfo(element,stubFile,stubId,myStubElementType);
      }
    }
  }
  PsiElement anchor=getAnchor(element);
  if (anchor != null) {
    return new AnchorElementInfo(anchor,containingFile);
  }
  return null;
}
