{
  int index=uri.indexOf("://");
  if (index < 0) {
    try {
      return new URI(uri);
    }
 catch (    URISyntaxException e) {
      LOG.debug(e);
      return null;
    }
  }
  if (SystemInfo.isWindows && uri.startsWith(LocalFileSystem.PROTOCOL_PREFIX)) {
    int firstSlashIndex=index + "://".length();
    if (uri.charAt(firstSlashIndex) != '/') {
      uri=LocalFileSystem.PROTOCOL_PREFIX + '/' + uri.substring(firstSlashIndex);
    }
  }
  try {
    return new URI(uri);
  }
 catch (  URISyntaxException e) {
    LOG.debug("uri is not fully encoded",e);
    try {
      int fragmentIndex=uri.lastIndexOf('#');
      String path=uri.substring(index + 1,fragmentIndex > 0 ? fragmentIndex : uri.length());
      String fragment=fragmentIndex > 0 ? uri.substring(fragmentIndex + 1) : null;
      return new URI(uri.substring(0,index),path,fragment);
    }
 catch (    URISyntaxException e1) {
      LOG.debug(e1);
      return null;
    }
  }
}
