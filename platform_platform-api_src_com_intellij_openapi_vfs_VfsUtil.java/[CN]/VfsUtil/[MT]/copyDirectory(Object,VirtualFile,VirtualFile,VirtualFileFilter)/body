{
  @SuppressWarnings("UnsafeVfsRecursion") VirtualFile[] children=fromDir.getChildren();
  for (  VirtualFile child : children) {
    if (!child.is(VFileProperty.SYMLINK) && !child.is(VFileProperty.SPECIAL) && (filter == null || filter.accept(child))) {
      if (!child.isDirectory()) {
        copyFile(requestor,child,toDir);
      }
 else {
        VirtualFile newChild=toDir.findChild(child.getName());
        if (newChild == null) {
          newChild=toDir.createChildDirectory(requestor,child.getName());
        }
        copyDirectory(requestor,child,newChild,filter);
      }
    }
  }
}
