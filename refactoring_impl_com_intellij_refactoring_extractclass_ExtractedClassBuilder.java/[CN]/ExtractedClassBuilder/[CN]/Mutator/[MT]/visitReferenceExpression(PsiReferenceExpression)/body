{
  final PsiElement qualifier=expression.getQualifier();
  if (qualifier == null || qualifier instanceof PsiThisExpression) {
    final PsiElement referent=expression.resolve();
    if (referent instanceof PsiField) {
      final PsiField field=(PsiField)referent;
      if (fieldIsExtracted(field)) {
        final String name=calculateStrippedName(field);
        final String fieldName=myJavaCodeStyleManager.propertyNameToVariableName(name,field.hasModifierProperty(PsiModifier.STATIC) ? VariableKind.STATIC_FIELD : VariableKind.FIELD);
        if (qualifier != null && fieldName.equals(expression.getReferenceName())) {
          out.append("this.");
        }
        out.append(fieldName);
      }
 else {
        if (field.hasModifierProperty(PsiModifier.STATIC)) {
          out.append(originalClassName + '.' + field.getName());
        }
 else {
          out.append(backPointerName + '.' + PropertyUtil.suggestGetterName(field.getProject(),field)+ "()");
        }
      }
    }
 else {
      visitElement(expression);
    }
  }
 else {
    visitElement(expression);
  }
}
