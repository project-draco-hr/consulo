{
  if (!visited.add(root)) {
    return;
  }
  for (  VirtualFile child : root.getChildren()) {
    if (child.exists()) {
      if (child.isDirectory()) {
        collectClassFilesAndJars(child,result,visited);
      }
 else       if ("jar".equals(child.getExtension()) || "class".equals(child.getExtension())) {
        if (child.getFileSystem() instanceof JarFileSystem) {
          final VirtualFile localFile=JarFileSystem.getInstance().getVirtualFileForJar(child);
          if (localFile != null) {
            result.add(localFile);
          }
        }
 else {
          result.add(child);
        }
      }
    }
  }
}
