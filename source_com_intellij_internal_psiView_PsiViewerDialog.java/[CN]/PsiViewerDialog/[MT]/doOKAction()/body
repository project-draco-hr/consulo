{
  final String text=myEditor.getDocument().getText();
  if ("".equals(text.trim())) {
    return;
  }
  myLastParsedText=text;
  final PsiManager psiManager=PsiManager.getInstance(myProject);
  PsiElement rootElement=null;
  final LanguageDialect dialect=(LanguageDialect)myDialectsComboBox.getSelectedItem();
  try {
    final JavaPsiFacade psiFacade=JavaPsiFacade.getInstance(psiManager.getProject());
    if (myRbMethod.isSelected()) {
      rootElement=psiFacade == null ? null : psiFacade.getElementFactory().createMethodFromText(text,null);
    }
 else     if (myRbCodeBlock.isSelected()) {
      rootElement=psiFacade == null ? null : psiFacade.getElementFactory().createCodeBlockFromText(text,null);
    }
 else     if (myRbExpression.isSelected()) {
      rootElement=psiFacade == null ? null : psiFacade.getElementFactory().createExpressionFromText(text,null);
    }
 else {
      for (int i=0; i < myFileTypeButtons.length; i++) {
        JRadioButton fileTypeButton=myFileTypeButtons[i];
        if (fileTypeButton.isSelected()) {
          final FileType type=myFileTypes[i];
          if (type instanceof LanguageFileType) {
            final Language language=dialect != null ? dialect : ((LanguageFileType)type).getLanguage();
            rootElement=PsiFileFactory.getInstance(myProject).createFileFromText("Dummy." + type.getDefaultExtension(),language,text);
          }
 else {
            rootElement=PsiFileFactory.getInstance(myProject).createFileFromText("Dummy." + type.getDefaultExtension(),text);
          }
        }
      }
    }
  }
 catch (  IncorrectOperationException e1) {
    rootElement=null;
    Messages.showMessageDialog(myProject,e1.getMessage(),"Error",Messages.getErrorIcon());
  }
  ViewerTreeStructure structure=(ViewerTreeStructure)myTreeBuilder.getTreeStructure();
  structure.setRootPsiElement(rootElement);
  myTreeBuilder.updateFromRoot();
  myTree.setRootVisible(true);
  myTree.expandRow(0);
  myTree.setRootVisible(false);
}
