{
  if (!myEditor.getDocument().getText().equals(myLastParsedText))   return;
  TreePath path=myTree.getSelectionPath();
  if (path == null) {
    clearSelection();
  }
 else {
    clearSelection();
    DefaultMutableTreeNode node=(DefaultMutableTreeNode)path.getLastPathComponent();
    ViewerNodeDescriptor descriptor=(ViewerNodeDescriptor)node.getUserObject();
    Object elementObject=descriptor.getElement();
    if (elementObject instanceof PsiElement) {
      PsiElement element=(PsiElement)elementObject;
      TextRange range=element.getTextRange();
      int start=range.getStartOffset();
      int end=range.getEndOffset();
      final ViewerTreeStructure treeStructure=(ViewerTreeStructure)myTreeBuilder.getTreeStructure();
      PsiElement rootPsiElement=treeStructure.getRootPsiElement();
      if (rootPsiElement != null) {
        int baseOffset=rootPsiElement.getTextRange().getStartOffset();
        start-=baseOffset;
        end-=baseOffset;
      }
      myHighlighter=myEditor.getMarkupModel().addRangeHighlighter(start,end,HighlighterLayer.CARET_ROW + 1,myAttributes,HighlighterTargetArea.EXACT_RANGE);
    }
  }
}
