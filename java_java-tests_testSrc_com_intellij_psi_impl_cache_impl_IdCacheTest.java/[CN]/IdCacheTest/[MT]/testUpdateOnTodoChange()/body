{
  TodoPattern pattern=new TodoPattern("newtodo",TodoAttributes.createDefault(),true);
  TodoPattern[] oldPatterns=TodoConfiguration.getInstance().getTodoPatterns();
  TodoConfiguration.getInstance().setTodoPatterns(new TodoPattern[]{pattern});
  try {
    final CacheManager cache=CacheManager.SERVICE.getInstance(myProject);
    checkResult(new String[]{"2.java"},convert(cache.getFilesWithTodoItems()));
    assertEquals(0,cache.getTodoCount(myRootDir.findChild("1.java"),TodoIndexPatternProvider.getInstance()));
    assertEquals(1,cache.getTodoCount(myRootDir.findChild("2.java"),TodoIndexPatternProvider.getInstance()));
    assertEquals(0,cache.getTodoCount(myRootDir.findChild("3.java"),TodoIndexPatternProvider.getInstance()));
  }
  finally {
    TodoConfiguration.getInstance().setTodoPatterns(oldPatterns);
  }
}
