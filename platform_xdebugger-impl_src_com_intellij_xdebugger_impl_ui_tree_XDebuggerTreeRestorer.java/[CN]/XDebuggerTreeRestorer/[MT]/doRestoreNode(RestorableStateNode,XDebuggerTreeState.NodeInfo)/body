{
  if (nodeInfo != null) {
    if (!checkExtendedModified(treeNode) && !(Comparing.equal(nodeInfo.getValue(),treeNode.getRawValue()))) {
      treeNode.markChanged();
    }
    if (!myStopRestoringSelection && nodeInfo.isSelected() && mySelectionPath == null) {
      try {
        myInsideRestoring=true;
        myTree.addSelectionPath(treeNode.getPath());
      }
  finally {
        myInsideRestoring=false;
      }
    }
    if (!(treeNode.isComputed() && treeNode.isLeaf())) {
      restoreChildren((XDebuggerTreeNode)treeNode,nodeInfo);
    }
  }
 else {
    if (!checkExtendedModified(treeNode)) {
      treeNode.markChanged();
    }
    if (mySelectionPath != null && !myStopRestoringSelection && pathsEqual(mySelectionPath,treeNode.getPath())) {
      myTree.addSelectionPath(treeNode.getPath());
    }
  }
}
