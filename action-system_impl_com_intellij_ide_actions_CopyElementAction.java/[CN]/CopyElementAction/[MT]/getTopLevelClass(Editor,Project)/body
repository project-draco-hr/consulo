{
  int offset=editor.getCaretModel().getOffset();
  PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
  if (file == null)   return null;
  PsiElement element=file.findElementAt(offset);
  if (element == null)   element=file;
  while (true) {
    if (element instanceof PsiFile)     break;
    if (element instanceof PsiClass && element.getParent() instanceof PsiFile)     break;
    element=element.getParent();
  }
  if (element instanceof PsiJavaFile) {
    PsiClass[] classes=((PsiJavaFile)element).getClasses();
    if (classes.length > 0) {
      element=classes[0];
    }
  }
  return element instanceof PsiClass ? (PsiClass)element : null;
}
