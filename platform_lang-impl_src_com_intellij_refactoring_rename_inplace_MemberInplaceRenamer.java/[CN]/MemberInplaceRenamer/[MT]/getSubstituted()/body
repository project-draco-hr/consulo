{
  if (mySubstituted != null && mySubstituted.isValid()) {
    if (mySubstituted instanceof PsiNameIdentifierOwner) {
      if (Comparing.strEqual(myOldName,((PsiNameIdentifierOwner)mySubstituted).getName()))       return mySubstituted;
      final RangeMarker rangeMarker=mySubstitutedRange != null ? mySubstitutedRange : myRenameOffset;
      return PsiTreeUtil.getParentOfType(mySubstituted.getContainingFile().findElementAt(rangeMarker.getStartOffset()),PsiNameIdentifierOwner.class);
    }
    return mySubstituted;
  }
  if (mySubstitutedRange != null) {
    final PsiFile psiFile=PsiDocumentManager.getInstance(myProject).getPsiFile(myEditor.getDocument());
    if (psiFile != null) {
      return PsiTreeUtil.getParentOfType(psiFile.findElementAt(mySubstitutedRange.getStartOffset()),PsiNameIdentifierOwner.class);
    }
  }
  return getVariable();
}
