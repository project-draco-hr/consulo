{
  final RefManager refManager=context.getRefManager();
  final AnalysisScope scope=refManager.getScope();
  final SearchScope searchScope=new GlobalSearchScope(refManager.getProject()){
    @Override public boolean contains(    VirtualFile file){
      return !scope.contains(file) || file.getFileType() != StdFileTypes.JAVA;
    }
    @Override public int compare(    VirtualFile file1,    VirtualFile file2){
      return 0;
    }
    @Override public boolean isSearchInModuleContent(    @NotNull Module aModule){
      return true;
    }
    @Override public boolean isSearchInLibraries(){
      return false;
    }
  }
;
  if (myDerivedClassesRequests != null) {
    final List<SmartPsiElementPointer> sortedIDs=getSortedIDs(myDerivedClassesRequests);
    for (    SmartPsiElementPointer sortedID : sortedIDs) {
      final PsiClass psiClass=(PsiClass)dereferenceInReadAction(sortedID);
      if (psiClass == null)       continue;
      context.incrementJobDoneAmount(((GlobalInspectionContextImpl)context).FIND_EXTERNAL_USAGES,ApplicationManager.getApplication().runReadAction(new Computable<String>(){
        @Override public String compute(){
          return psiClass.getQualifiedName();
        }
      }
));
      final List<DerivedClassesProcessor> processors=myDerivedClassesRequests.get(sortedID);
      LOG.assertTrue(processors != null,psiClass.getClass().getName());
      ClassInheritorsSearch.search(psiClass,searchScope,false).forEach(createMembersProcessor(processors,scope));
    }
    myDerivedClassesRequests=null;
  }
  if (myDerivedMethodsRequests != null) {
    final List<SmartPsiElementPointer> sortedIDs=getSortedIDs(myDerivedMethodsRequests);
    for (    SmartPsiElementPointer sortedID : sortedIDs) {
      final PsiMethod psiMethod=(PsiMethod)dereferenceInReadAction(sortedID);
      if (psiMethod == null)       continue;
      final RefMethod refMethod=(RefMethod)refManager.getReference(psiMethod);
      context.incrementJobDoneAmount(((GlobalInspectionContextImpl)context).FIND_EXTERNAL_USAGES,refManager.getQualifiedName(refMethod));
      final List<DerivedMethodsProcessor> processors=myDerivedMethodsRequests.get(sortedID);
      LOG.assertTrue(processors != null,psiMethod.getClass().getName());
      OverridingMethodsSearch.search(psiMethod,searchScope,true).forEach(createMembersProcessor(processors,scope));
    }
    myDerivedMethodsRequests=null;
  }
  if (myFieldUsagesRequests != null) {
    final List<SmartPsiElementPointer> sortedIDs=getSortedIDs(myFieldUsagesRequests);
    for (    SmartPsiElementPointer sortedID : sortedIDs) {
      final PsiField psiField=(PsiField)dereferenceInReadAction(sortedID);
      if (psiField == null)       continue;
      final List<UsagesProcessor> processors=myFieldUsagesRequests.get(sortedID);
      LOG.assertTrue(processors != null,psiField.getClass().getName());
      context.incrementJobDoneAmount(((GlobalInspectionContextImpl)context).FIND_EXTERNAL_USAGES,refManager.getQualifiedName(refManager.getReference(psiField)));
      ReferencesSearch.search(psiField,searchScope,false).forEach(new PsiReferenceProcessorAdapter(createReferenceProcessor(processors,context)));
    }
    myFieldUsagesRequests=null;
  }
  if (myClassUsagesRequests != null) {
    final List<SmartPsiElementPointer> sortedIDs=getSortedIDs(myClassUsagesRequests);
    for (    SmartPsiElementPointer sortedID : sortedIDs) {
      final PsiClass psiClass=(PsiClass)dereferenceInReadAction(sortedID);
      if (psiClass == null)       continue;
      final List<UsagesProcessor> processors=myClassUsagesRequests.get(sortedID);
      LOG.assertTrue(processors != null,psiClass.getClass().getName());
      context.incrementJobDoneAmount(((GlobalInspectionContextImpl)context).FIND_EXTERNAL_USAGES,ApplicationManager.getApplication().runReadAction(new Computable<String>(){
        @Override public String compute(){
          return psiClass.getQualifiedName();
        }
      }
));
      ReferencesSearch.search(psiClass,searchScope,false).forEach(new PsiReferenceProcessorAdapter(createReferenceProcessor(processors,context)));
    }
    myClassUsagesRequests=null;
  }
  if (myMethodUsagesRequests != null) {
    List<SmartPsiElementPointer> sortedIDs=getSortedIDs(myMethodUsagesRequests);
    for (    SmartPsiElementPointer sortedID : sortedIDs) {
      final PsiMethod psiMethod=(PsiMethod)dereferenceInReadAction(sortedID);
      if (psiMethod == null)       continue;
      final List<UsagesProcessor> processors=myMethodUsagesRequests.get(sortedID);
      LOG.assertTrue(processors != null,psiMethod.getClass().getName());
      context.incrementJobDoneAmount(((GlobalInspectionContextImpl)context).FIND_EXTERNAL_USAGES,refManager.getQualifiedName(refManager.getReference(psiMethod)));
      MethodReferencesSearch.search(psiMethod,searchScope,true).forEach(new PsiReferenceProcessorAdapter(createReferenceProcessor(processors,context)));
    }
    myMethodUsagesRequests=null;
  }
}
