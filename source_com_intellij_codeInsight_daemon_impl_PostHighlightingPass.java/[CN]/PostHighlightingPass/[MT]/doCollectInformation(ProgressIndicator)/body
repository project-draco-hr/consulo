{
  if (myCompiled) {
    myHighlights=HighlightInfo.EMPTY_ARRAY;
    ;
    return;
  }
  final PsiElement[] psiRoots=myFile.getPsiRoots();
  List<HighlightInfo> highlights=new ArrayList<HighlightInfo>();
  for (int i=0; i < psiRoots.length; i++) {
    final PsiElement psiRoot=psiRoots[i];
    PsiElement[] elements=CodeInsightUtil.getElementsInRange(psiRoot,myStartOffset,myEndOffset);
    collectHighlights(elements,highlights);
  }
  PsiNamedElement[] unusedDcls=myRefCountHolder.getUnusedDcls();
  for (int i=0; i < unusedDcls.length; i++) {
    PsiNamedElement unusedDcl=unusedDcls[i];
    String message=MessageFormat.format(SYMBOL_IS_NOT_USED,new Object[]{unusedDcl.getName()});
    String dclType=UsageViewUtil.capitalize(UsageViewUtil.getType(unusedDcl));
    if (dclType == null || dclType.length() == 0)     dclType="Symbol";
    final HighlightInfo highlightInfo=createUnusedSymbolInfo(unusedDcl.getNavigationElement(),dclType + message);
    highlights.add(highlightInfo);
  }
  myHighlights=highlights.toArray(new HighlightInfo[highlights.size()]);
}
