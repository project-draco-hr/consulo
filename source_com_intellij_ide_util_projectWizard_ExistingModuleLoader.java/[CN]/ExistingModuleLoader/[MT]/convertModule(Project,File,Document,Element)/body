{
  final ModuleConverter converter=ProjectConversionUtil.getModuleConverter();
  if (converter != null && converter.isConversionNeeded(root)) {
    if (current != null && !ProjectFileVersion.getInstance(current).isConverted()) {
      ProjectFileVersion.getInstance(current).showNotAllowedMessage();
      return false;
    }
    final int res=Messages.showYesNoDialog(current,IdeBundle.message("message.module.file.has.an.older.format.do.you.want.to.convert.it"),IdeBundle.message("dialog.title.convert.module"),Messages.getQuestionIcon());
    if (res != 0) {
      return false;
    }
    if (!file.canWrite()) {
      Messages.showErrorDialog(current,IdeBundle.message("error.message.cannot.modify.file.0",file.getAbsolutePath()),IdeBundle.message("dialog.title.convert.module"));
      return false;
    }
    final File backupFile=ProjectConversionUtil.backupFile(file);
    converter.convertModuleRoot(file.getName(),root);
    JDOMUtil.writeDocument(document,file,SystemProperties.getLineSeparator());
    Messages.showInfoMessage(current,IdeBundle.message("message.your.module.was.succesfully.converted.br.old.version.was.saved.to.0",backupFile.getAbsolutePath()),IdeBundle.message("dialog.title.convert.module"));
  }
  return true;
}
