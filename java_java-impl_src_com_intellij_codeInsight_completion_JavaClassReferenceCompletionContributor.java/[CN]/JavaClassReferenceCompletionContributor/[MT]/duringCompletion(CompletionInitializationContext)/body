{
  PsiReference reference=context.getFile().findReferenceAt(context.getStartOffset());
  if (reference instanceof PsiMultiReference) {
    for (    final PsiReference psiReference : ((PsiMultiReference)reference).getReferences()) {
      if (psiReference instanceof JavaClassReference) {
        reference=psiReference;
        break;
      }
    }
  }
  if (reference instanceof JavaClassReference) {
    final JavaClassReference classReference=(JavaClassReference)reference;
    if (classReference.getExtendClassNames() != null) {
      final PsiReference[] references=classReference.getJavaClassReferenceSet().getReferences();
      final PsiReference last=references[references.length - 1];
      context.setReplacementOffset(last.getRangeInElement().getEndOffset() + last.getElement().getTextRange().getStartOffset());
    }
  }
}
