{
  PsiElement position=parameters.getPosition();
  JavaClassReference reference=findJavaClassReference(position.getContainingFile(),parameters.getOffset());
  if (reference == null) {
    return;
  }
  String[] extendClassNames=reference.getExtendClassNames();
  PsiElement context=reference.getCompletionContext();
  if (extendClassNames != null && context instanceof PsiPackage) {
    if (parameters.getCompletionType() == CompletionType.SMART) {
      JavaClassReferenceSet set=reference.getJavaClassReferenceSet();
      int setStart=set.getRangeInElement().getStartOffset() + set.getElement().getTextRange().getStartOffset();
      String fullPrefix=parameters.getPosition().getContainingFile().getText().substring(setStart,parameters.getOffset());
      reference.processSubclassVariants((PsiPackage)context,extendClassNames,result.withPrefixMatcher(fullPrefix));
      return;
    }
    result.addLookupAdvertisement("Press " + getActionShortcut(IdeActions.ACTION_SMART_TYPE_COMPLETION) + " to see inheritors of "+ StringUtil.join(extendClassNames,", "));
  }
  if (parameters.getCompletionType() == CompletionType.SMART) {
    return;
  }
  if (parameters.getCompletionType() == CompletionType.CLASS_NAME) {
    JavaClassNameCompletionContributor.addAllClasses(parameters,result);
  }
 else {
    LegacyCompletionContributor.completeReference(parameters,result);
  }
  result.stopHere();
}
