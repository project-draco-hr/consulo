{
  boolean generateDelegate=false;
  Editor editor=myFixture.getEditor();
  int startOffset=editor.getSelectionModel().getSelectionStart();
  int endOffset=editor.getSelectionModel().getSelectionEnd();
  final PsiFile myFile=myFixture.getFile();
  final ElementToWorkOn[] elementToWorkOn=new ElementToWorkOn[1];
  ElementToWorkOn.processElementToWorkOn(editor,myFile,"INtr param",HelpID.INTRODUCE_PARAMETER,getProject(),new Pass<ElementToWorkOn>(){
    @Override public void pass(    final ElementToWorkOn e){
      if (e == null)       return;
      elementToWorkOn[0]=e;
    }
  }
);
  final PsiExpression expr=elementToWorkOn[0].getExpression();
  final PsiLocalVariable localVar=elementToWorkOn[0].getLocalVariable();
  PsiElement context=expr == null ? localVar : expr;
  PsiMethod method=Util.getContainingMethod(context);
  if (method == null)   return false;
  final PsiMethod methodToSearchFor;
  if (searchForSuper) {
    final PsiMethod[] superMethods=method.findDeepestSuperMethods();
    methodToSearchFor=superMethods.length > 0 ? superMethods[0] : method;
  }
 else {
    methodToSearchFor=method;
  }
  PsiExpression initializer=expr == null ? localVar.getInitializer() : expr;
  TIntArrayList parametersToRemove=removeUnusedParameters ? Util.findParametersToRemove(method,initializer,null) : new TIntArrayList();
  final Project project=myFixture.getProject();
  final IntroduceParameterProcessor processor=new IntroduceParameterProcessor(project,method,methodToSearchFor,initializer,expr,localVar,true,parameterName,replaceAllOccurences,replaceFieldsWithGetters,declareFinal,generateDelegate,null,parametersToRemove);
  CommandProcessor.getInstance().executeCommand(project,new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          try {
            processor.run();
            if (conflicts != null)             fail("Conflicts were expected");
          }
 catch (          Exception e) {
            if (conflicts == null) {
              e.printStackTrace();
              fail("Conflicts were not expected");
            }
            assertEquals(conflicts,e.getMessage());
          }
        }
      }
);
    }
  }
,"introduce Parameter",null);
  editor.getSelectionModel().removeSelection();
  return true;
}
