{
  final ProjectFromSourcesBuilder projectBuilder=new ProjectFromSourcesBuilder();
  myProjectBuilder=projectBuilder;
  final StepSequence sequence=new StepSequence();
  final Icon icon=context.isCreatingNewProject() ? NEW_PROJECT_ICON : ICON;
  sequence.addCommonStep(new ProjectNameStep(context,this));
  sequence.addCommonStep(new RootsDetectionStep(projectBuilder,sequence,icon,"reference.dialogs.new.project.fromCode.source"));
  for (  ProjectStructureDetector detector : ProjectStructureDetector.EP_NAME.getExtensions()) {
    for (    ModuleWizardStep step : detector.createWizardSteps(projectBuilder,projectBuilder.getProjectDescriptor(detector),context,icon)) {
      sequence.addSpecificStep(detector.getClass().getName(),step);
    }
  }
  if (FrameworkDetectionStep.isEnabled()) {
    FrameworkDetectionStep frameworkDetectionStep=new FrameworkDetectionStep(icon,projectBuilder){
      public List<ModuleDescriptor> getModuleDescriptors(){
        final List<ModuleDescriptor> moduleDescriptors=new ArrayList<ModuleDescriptor>();
        for (        ProjectDescriptor descriptor : projectBuilder.getSelectedDescriptors()) {
          moduleDescriptors.addAll(descriptor.getModules());
        }
        return moduleDescriptors;
      }
    }
;
    projectBuilder.addConfigurationUpdater(frameworkDetectionStep);
    sequence.addCommonFinishingStep(frameworkDetectionStep);
  }
  return sequence;
}
