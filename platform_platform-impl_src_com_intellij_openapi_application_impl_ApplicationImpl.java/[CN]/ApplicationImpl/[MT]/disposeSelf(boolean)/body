{
  final ProjectManagerImpl manager=(ProjectManagerImpl)ProjectManagerEx.getInstanceEx();
  if (manager != null) {
    final boolean[] canClose={true};
    for (    final Project project : manager.getOpenProjects()) {
      try {
        CommandProcessor.getInstance().executeCommand(project,new Runnable(){
          @Override public void run(){
            if (!manager.closeProject(project,true,true,checkCanCloseProject)) {
              canClose[0]=false;
            }
          }
        }
,ApplicationBundle.message("command.exit"),null);
      }
 catch (      Throwable e) {
        LOG.error(e);
      }
      if (!canClose[0]) {
        return false;
      }
    }
  }
  runWriteAction(new Runnable(){
    @Override public void run(){
      Disposer.dispose(ApplicationImpl.this);
    }
  }
);
  Disposer.assertIsEmpty();
  return true;
}
