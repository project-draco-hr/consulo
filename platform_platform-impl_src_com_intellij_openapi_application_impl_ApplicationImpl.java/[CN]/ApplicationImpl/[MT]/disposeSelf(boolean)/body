{
  final CommandProcessor commandProcessor=CommandProcessor.getInstance();
  final Ref<Boolean> canClose=new Ref<Boolean>(true);
  for (  final Project project : ProjectManagerEx.getInstanceEx().getOpenProjects()) {
    try {
      commandProcessor.executeCommand(project,new Runnable(){
        public void run(){
          final ProjectManagerImpl manager=(ProjectManagerImpl)ProjectManagerEx.getInstanceEx();
          if (!manager.closeProject(project,true,true,checkCanCloseProject)) {
            canClose.set(false);
          }
        }
      }
,ApplicationBundle.message("command.exit"),null);
    }
 catch (    Throwable e) {
      LOG.error(e);
    }
    if (!canClose.get()) {
      myDisposeInProgress=false;
      return false;
    }
  }
  Disposer.dispose(this);
  Disposer.assertIsEmpty();
  return true;
}
