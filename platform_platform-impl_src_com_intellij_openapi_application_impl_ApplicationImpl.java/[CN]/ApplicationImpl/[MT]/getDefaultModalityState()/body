{
  if (isDispatchThread()) {
    return getCurrentModalityState();
  }
  ProgressIndicator progress=ProgressManager.getInstance().getProgressIndicator();
  return progress == null ? getNoneModalityState() : progress.getModalityState();
}
