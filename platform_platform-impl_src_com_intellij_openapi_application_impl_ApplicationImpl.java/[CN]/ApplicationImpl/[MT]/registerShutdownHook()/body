{
  ShutDownTracker.getInstance();
  ShutDownTracker.getInstance().registerShutdownTask(new Runnable(){
    public void run(){
      if (isDisposed() || isDisposeInProgress()) {
        return;
      }
      ShutDownTracker.invokeAndWait(isUnitTestMode(),new Runnable(){
        public void run(){
          if (ApplicationManager.getApplication() != ApplicationImpl.this)           return;
          try {
            myDisposeInProgress=true;
            saveAll();
          }
  finally {
            disposeSelf(true);
          }
        }
      }
);
    }
  }
);
}
