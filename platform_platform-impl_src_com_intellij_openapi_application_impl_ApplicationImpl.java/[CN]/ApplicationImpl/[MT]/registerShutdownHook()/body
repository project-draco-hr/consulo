{
  ShutDownTracker.getInstance();
  ShutDownTracker.getInstance().registerShutdownTask(new Runnable(){
    @Override public void run(){
      if (isDisposed() || isDisposeInProgress()) {
        return;
      }
      ShutDownTracker.invokeAndWait(isUnitTestMode(),true,new Runnable(){
        @Override public void run(){
          if (ApplicationManager.getApplication() != ApplicationImpl.this)           return;
          try {
            myDisposeInProgress=true;
            saveAll();
          }
  finally {
            if (!disposeSelf(true)) {
              myDisposeInProgress=false;
            }
          }
        }
      }
);
    }
  }
);
}
