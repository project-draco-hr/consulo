{
  saveSettings();
  if (allowListenersToCancel && !canExit()) {
    return false;
  }
  final boolean success=disposeSelf(allowListenersToCancel);
  if (!success || isUnitTestMode()) {
    return false;
  }
  int exitCode=0;
  if (restart && Restarter.isSupported()) {
    try {
      exitCode=Restarter.scheduleRestart();
    }
 catch (    IOException e) {
      LOG.warn("Cannot restart",e);
    }
  }
  System.exit(exitCode);
  return true;
}
