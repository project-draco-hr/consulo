{
  LOG.assertTrue(toInsertParams || toInsertThrows);
  if (toInsertParams) {
    List<PsiParameter> newParameters=new ArrayList<PsiParameter>();
    newParameters.addAll(Arrays.asList(caller.getParameterList().getParameters()));
    final ParameterInfo[] primaryNewParms=myChangeInfo.newParms;
    PsiSubstitutor substitutor=baseMethod == null ? PsiSubstitutor.EMPTY : calculateSubstitutor(caller,baseMethod);
    for (int i=0; i < primaryNewParms.length; i++) {
      if (primaryNewParms[i].oldParameterIndex < 0)       newParameters.add(createNewParameter(primaryNewParms[i],substitutor));
    }
    PsiParameter[] arrayed=newParameters.toArray(new PsiParameter[newParameters.size()]);
    boolean[] toRemoveParm=new boolean[arrayed.length];
    Arrays.fill(toRemoveParm,false);
    resolveParameterVsFieldsConflicts(arrayed,caller,caller.getParameterList(),toRemoveParm);
  }
  if (toInsertThrows) {
    List<PsiJavaCodeReferenceElement> newThrowns=new ArrayList<PsiJavaCodeReferenceElement>();
    final PsiReferenceList throwsList=caller.getThrowsList();
    newThrowns.addAll(Arrays.asList(throwsList.getReferenceElements()));
    final ThrownExceptionInfo[] primaryNewExns=myChangeInfo.newExceptions;
    for (int i=0; i < primaryNewExns.length; i++) {
      if (primaryNewExns[i].oldIndex < 0) {
        final PsiClassType type=(PsiClassType)primaryNewExns[i].createType(caller,myManager);
        final PsiJavaCodeReferenceElement ref=caller.getManager().getElementFactory().createReferenceElementByType(type);
        newThrowns.add(ref);
      }
    }
    PsiJavaCodeReferenceElement[] arrayed=newThrowns.toArray(new PsiJavaCodeReferenceElement[newThrowns.size()]);
    boolean[] toRemoveParm=new boolean[arrayed.length];
    Arrays.fill(toRemoveParm,false);
    ChangeSignatureUtil.synchronizeList(throwsList,Arrays.asList(arrayed),ThrowsList.INSTANCE,toRemoveParm);
  }
}
