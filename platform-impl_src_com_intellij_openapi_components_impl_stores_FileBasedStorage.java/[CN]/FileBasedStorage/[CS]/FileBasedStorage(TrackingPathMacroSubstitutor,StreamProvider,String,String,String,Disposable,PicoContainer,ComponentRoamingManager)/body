{
  super(pathMacroManager,parentDisposable,rootElementName,streamProvider,fileSpec,componentRoamingManager);
  myRootElementName=rootElementName;
  myFilePath=filePath;
  myFile=FILE_SYSTEM.createFile(myFilePath);
  VirtualFileTracker virtualFileTracker=(VirtualFileTracker)picoContainer.getComponentInstanceOfType(VirtualFileTracker.class);
  MessageBus messageBus=(MessageBus)picoContainer.getComponentInstanceOfType(MessageBus.class);
  if (myFile.exists()) {
    myInitialFileTimestamp=myFile.getTimeStamp();
  }
  if (virtualFileTracker != null && messageBus != null) {
    final String path=myFile.getAbsolutePath();
    final String fileUrl=LocalFileSystem.PROTOCOL + "://" + path.replace(File.separatorChar,'/');
    final Listener listener=messageBus.syncPublisher(StateStorage.STORAGE_TOPIC);
    virtualFileTracker.addTracker(fileUrl,new VirtualFileAdapter(){
      public void contentsChanged(      final VirtualFileEvent event){
        if (event.getFile().getTimeStamp() != myInitialFileTimestamp) {
          listener.storageFileChanged(event,FileBasedStorage.this);
        }
      }
    }
,true,this);
  }
}
