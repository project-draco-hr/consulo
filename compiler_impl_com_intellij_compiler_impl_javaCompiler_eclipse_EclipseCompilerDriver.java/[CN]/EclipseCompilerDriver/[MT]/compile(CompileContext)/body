{
  final INameEnvironment environment=getEnvironment();
  Compiler compiler=new Compiler(environment,getHandlingPolicy(),getCompilerOptions(),getBatchRequestor(compileContext),getProblemFactory()){
    protected void handleInternalException(    Throwable internalException,    CompilationUnitDeclaration unit,    CompilationResult result){
      if (internalException instanceof ProcessCanceledException)       throw (ProcessCanceledException)internalException;
      super.handleInternalException(internalException,unit,result);
    }
  }
;
  compiler.parseThreshold=2500;
  try {
    compiler.compile(getCompilationUnits());
  }
 catch (  ProcessCanceledException e) {
  }
catch (  Exception e) {
    ProgressIndicator indicator=ProgressManager.getInstance().getProgressIndicator();
    if (indicator == null || !indicator.isCanceled()) {
      compileContext.addMessage(CompilerMessageCategory.ERROR,"Internal Error: " + e.toString(),null,-1,-1);
    }
  }
 finally {
    myCompilationResults.offer(END_OF_STREAM);
    environment.cleanup();
  }
}
