{
  final MavenProjectsManager manager=MavenProjectsManager.getInstance(p);
  final MavenImporterSettings settings=manager.getImporterSettings();
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      List<ModifiableRootModel> rootModels=new ArrayList<ModifiableRootModel>();
      for (      Module m : ModuleManager.getInstance(p).getModules()) {
        MavenProjectModel project=manager.findProject(m);
        if (project == null)         return;
        RootModelAdapter a=new RootModelAdapter(m);
        new MavenFoldersConfigurator(project,settings,a).configFoldersUnderTargetDir();
        ModifiableRootModel model=a.getRootModel();
        if (model.isChanged()) {
          rootModels.add(model);
        }
 else {
          model.dispose();
        }
      }
      if (!rootModels.isEmpty()) {
        ModifiableRootModel[] modelsArray=rootModels.toArray(new ModifiableRootModel[rootModels.size()]);
        ProjectRootManager.getInstance(p).multiCommit(modelsArray);
      }
    }
  }
);
}
