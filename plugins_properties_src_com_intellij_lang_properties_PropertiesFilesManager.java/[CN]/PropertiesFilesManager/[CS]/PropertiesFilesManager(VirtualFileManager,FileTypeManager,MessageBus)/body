{
  myVirtualFileManager=virtualFileManager;
  myFileTypeManager=fileTypeManager;
  myVirtualFileListener=new VirtualFileAdapter(){
    public void fileCreated(    VirtualFileEvent event){
      addNewFile(event.getFile());
    }
    public void fileDeleted(    VirtualFileEvent event){
      removeOldFile(event);
    }
    public void fileMoved(    VirtualFileMoveEvent event){
      removeOldFile(event);
      addNewFile(event.getFile());
    }
    public void propertyChanged(    VirtualFilePropertyEvent event){
      VirtualFile file=event.getFile();
      fileChanged(file,event);
    }
    public void contentsChanged(    VirtualFileEvent event){
      VirtualFile file=event.getFile();
      fileChanged(file,null);
    }
  }
;
  messageBus.connect().subscribe(AppTopics.FILE_DOCUMENT_SYNC,new FileDocumentManagerAdapter(){
    @Override public void fileContentLoaded(    VirtualFile file,    Document document){
      addNewFile(file);
    }
  }
);
  EncodingManager.getInstance().addPropertyChangeListener(new PropertyChangeListener(){
    public void propertyChange(    final PropertyChangeEvent evt){
      if (EncodingManager.PROP_NATIVE2ASCII_SWITCH.equals(evt.getPropertyName()) || EncodingManager.PROP_PROPERTIES_FILES_ENCODING.equals(evt.getPropertyName())) {
        encodingChanged();
      }
    }
  }
);
}
