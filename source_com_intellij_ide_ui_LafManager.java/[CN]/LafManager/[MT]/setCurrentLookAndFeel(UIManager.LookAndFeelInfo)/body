{
  if (findLaf(lookAndFeelInfo.getClassName()) == null) {
    LOG.error("unknown LookAndFeel : " + lookAndFeelInfo);
    return;
  }
  if (IDEA_LAF_CLASSNAME.equals(lookAndFeelInfo.getClassName())) {
    IdeaLaf laf=new IdeaLaf();
    IdeaLaf.setCurrentTheme(new com.intellij.ui.IdeaBlueMetalTheme());
    try {
      UIManager.setLookAndFeel(laf);
    }
 catch (    Exception exc) {
      Messages.showMessageDialog("Cannot set " + lookAndFeelInfo.getName() + " look and feel","Error",Messages.getErrorIcon());
      return;
    }
  }
 else {
    try {
      LookAndFeel laf=((LookAndFeel)Class.forName(lookAndFeelInfo.getClassName()).newInstance());
      if (laf instanceof MetalLookAndFeel) {
        MetalLookAndFeel.setCurrentTheme(new DefaultMetalTheme());
      }
      UIManager.setLookAndFeel(laf);
    }
 catch (    Exception exc) {
      Messages.showMessageDialog("Cannot set " + lookAndFeelInfo.getName() + " look and feel","Error",Messages.getErrorIcon());
      return;
    }
  }
  myCurrentLaf=lookAndFeelInfo;
  String popupWeight=System.getProperty("idea.popup.weight");
  if (popupWeight == null) {
    if (SystemInfo.isWindows) {
      popupWeight=HEAVY_WEIGHT_POPUP;
    }
 else {
      popupWeight=MEDIUM_WEIGHT_POPUP;
    }
  }
  PopupFactory popupFactory;
  if (HEAVY_WEIGHT_POPUP.equals(popupWeight)) {
    popupFactory=new PopupFactory(){
      public Popup getPopup(      Component owner,      Component contents,      int x,      int y) throws IllegalArgumentException {
        return new Popup(owner,contents,x,y){
        }
;
      }
    }
;
  }
 else   if (MEDIUM_WEIGHT_POPUP.equals(popupWeight)) {
    popupFactory=new PopupFactory();
  }
 else {
    throw new IllegalStateException("unknown value of property -Didea.popup.weight: " + popupWeight);
  }
  PopupFactory.setSharedInstance(popupFactory);
}
