{
  filePath=StringUtil.trimStart(filePath,getTestName(true) + "/");
  final VirtualFile vFile=myFixture.getTempDirFixture().getFile(filePath);
  assertNotNull("file " + filePath + " not found",vFile);
  String fileText;
  try {
    fileText=StringUtil.convertLineSeparators(VfsUtil.loadText(vFile));
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
  int offset=fileText.indexOf(MARKER);
  assertTrue(offset >= 0);
  fileText=fileText.substring(0,offset) + fileText.substring(offset + MARKER.length());
  if (newFilePath == null) {
    myFixture.configureByText("aaa." + vFile.getExtension(),fileText);
  }
 else {
    myFixture.configureByText(newFilePath,fileText);
  }
  PsiReference ref=myFixture.getFile().findReferenceAt(offset);
  assertNotNull(ref);
  return ref;
}
