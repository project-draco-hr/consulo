{
  if (node instanceof ModuleGroupNode) {
    if (!recursively)     return null;
    final String scope=getSelectedScopeType(node);
    final String modulePattern=node.toString();
    return scope == PatternPackageSet.SCOPE_FILE ? new PatternPackageSet(null,scope,modulePattern,"*") : new PatternPackageSet("*..*",scope,modulePattern,null);
  }
 else   if (node instanceof ModuleNode) {
    if (!recursively)     return null;
    final String scope=getSelectedScopeType(node);
    final String modulePattern=((ModuleNode)node).getModuleName();
    return scope == PatternPackageSet.SCOPE_FILE ? new PatternPackageSet(null,scope,modulePattern,"*") : new PatternPackageSet("*..*",scope,modulePattern,null);
  }
 else   if (node instanceof PackageNode) {
    String pattern=((PackageNode)node).getPackageQName();
    if (pattern != null) {
      pattern+=recursively ? "..*" : ".*";
    }
 else {
      pattern=recursively ? "*..*" : ".*";
    }
    return getPatternSet(node,pattern);
  }
 else   if (node instanceof DirectoryNode) {
    String pattern=((DirectoryNode)node).getFQName();
    if (pattern != null) {
      if (pattern.length() > 0) {
        pattern+=recursively ? "/*" : "*";
      }
 else {
        pattern+=recursively ? "*/" : "*";
      }
    }
    return getPatternSet(node,pattern);
  }
 else   if (node instanceof FileNode) {
    if (recursively)     return null;
    FileNode fNode=(FileNode)node;
    String fqName=fNode.getFQName(getSelectedScopeType(node) == PatternPackageSet.SCOPE_FILE);
    if (fqName != null)     return getPatternSet(node,fqName);
  }
 else   if (node instanceof GeneralGroupNode) {
    return new PatternPackageSet("*..*",getSelectedScopeType(node),null,null);
  }
  return null;
}
