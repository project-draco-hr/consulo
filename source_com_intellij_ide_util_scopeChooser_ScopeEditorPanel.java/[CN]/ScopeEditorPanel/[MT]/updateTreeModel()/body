{
  Runnable updateModel=new Runnable(){
    public void run(){
      try {
        myTreeExpansionMonitor.freeze();
        TreeModelBuilder.TreeModel model=TreeModelBuilder.createTreeModel(myProject,myIsFirstUpdate,false,myTreeMarker);
        myIsFirstUpdate=false;
        if (myErrorMessage == null) {
          myMatchingCountLabel.setText(IdeBundle.message("label.scope.contains.files",model.getMarkedFileCount(),model.getTotalFileCount()));
          myMatchingCountLabel.setForeground(new JLabel().getForeground());
        }
 else {
          showErrorMessage();
        }
        myPackageTree.setModel(model);
        myTreeExpansionMonitor.restore();
      }
  finally {
        myCanceled=false;
      }
    }
  }
;
  if (myIsFirstUpdate) {
    updateModel.run();
  }
 else {
    ProgressManager.getInstance().runProcess(updateModel,new ProgressIndicatorBase(){
      public boolean isCanceled(){
        return myCanceled;
      }
    }
);
  }
}
