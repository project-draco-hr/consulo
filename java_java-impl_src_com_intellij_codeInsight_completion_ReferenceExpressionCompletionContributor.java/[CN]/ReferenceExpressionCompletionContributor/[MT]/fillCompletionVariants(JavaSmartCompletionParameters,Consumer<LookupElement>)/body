{
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      final PsiElement element=parameters.getPosition();
      if (JavaSmartCompletionContributor.INSIDE_TYPECAST_EXPRESSION.accepts(element))       return;
      if (JavaCompletionData.isAfterPrimitiveOrArrayType(element))       return;
      final int offset=parameters.getParameters().getOffset();
      final PsiReference reference=element.getContainingFile().findReferenceAt(offset);
      if (reference != null) {
        final ElementFilter filter=getReferenceFilter(element,false);
        for (        final LookupElement item : completeFinalReference(element,reference,filter,parameters)) {
          result.consume(item);
        }
        final boolean secondTime=parameters.getParameters().getInvocationCount() >= 2;
        for (        final LookupElement item : JavaSmartCompletionContributor.completeReference(element,reference,filter,false,parameters.getParameters())) {
          addSingleArrayElementAccess(element,item,parameters,result);
          if (secondTime) {
            addSecondCompletionVariants(element,reference,item,parameters,result);
          }
        }
        if (secondTime) {
          if (!psiElement().afterLeaf(".").accepts(element)) {
            BasicExpressionCompletionContributor.processDataflowExpressionTypes(element,null,TRUE_MATCHER,new Consumer<LookupElement>(){
              public void consume(              LookupElement baseItem){
                addSecondCompletionVariants(element,reference,baseItem,parameters,result);
              }
            }
);
          }
        }
      }
    }
  }
);
}
