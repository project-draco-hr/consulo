{
synchronized (lock) {
    Map<String,EntryInfo> map=myRelPathsToEntries.get();
    if (map == null) {
      final JarFile zip=getJar();
      map=new THashMap<String,EntryInfo>();
      if (zip != null) {
        map.put("",new EntryInfo("",null,true));
        final Enumeration<? extends JarFile.JarEntry> entries=zip.entries();
        while (entries.hasMoreElements()) {
          JarFile.JarEntry entry=entries.nextElement();
          final String name=entry.getName();
          final boolean isDirectory=name.endsWith("/");
          getOrCreate(isDirectory ? name.substring(0,name.length() - 1) : name,isDirectory,map);
        }
        myRelPathsToEntries=new SoftReference<Map<String,EntryInfo>>(map);
      }
    }
    return map;
  }
}
