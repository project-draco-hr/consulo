{
  if (!super.validate()) {
    return false;
  }
  if (CREATE_SOURCE_PANEL.equals(myCurrentMode) && myRbCreateSource.isSelected()) {
    final String sourceDirectoryPath=getSourceDirectoryPath();
    final String relativePath=myTfSourceDirectoryName.getText().trim();
    if (relativePath.length() == 0) {
      String text=IdeBundle.message("prompt.relative.path.to.sources.empty",sourceDirectoryPath);
      final int answer=Messages.showDialog(myTfSourceDirectoryName,text,IdeBundle.message("title.mark.source.directory"),new String[]{IdeBundle.message("action.mark"),IdeBundle.message("action.do.not.mark"),CommonBundle.getCancelButtonText()},0,Messages.getQuestionIcon());
      if (answer == 2) {
        return false;
      }
      if (answer == 1) {
        myRbNoSource.doClick();
      }
    }
    if (sourceDirectoryPath != null) {
      final File rootDir=new File(getContentRootPath());
      final File srcDir=new File(sourceDirectoryPath);
      try {
        if (!FileUtil.isAncestor(rootDir,srcDir,false)) {
          Messages.showErrorDialog(myTfSourceDirectoryName,IdeBundle.message("error.source.directory.should.be.under.module.content.root.directory"),CommonBundle.getErrorTitle());
          return false;
        }
      }
 catch (      IOException e) {
        Messages.showErrorDialog(myTfSourceDirectoryName,e.getMessage(),CommonBundle.getErrorTitle());
        return false;
      }
      srcDir.mkdirs();
    }
  }
  return true;
}
