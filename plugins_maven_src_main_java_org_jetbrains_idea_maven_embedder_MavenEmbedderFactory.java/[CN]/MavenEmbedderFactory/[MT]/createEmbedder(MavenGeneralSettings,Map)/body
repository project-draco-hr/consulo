{
  DefaultPlexusContainer container=new DefaultPlexusContainer();
  container.setClassWorld(new ClassWorld("plexus.core",generalSettings.getClass().getClassLoader()));
  CustomLoggerManager loggerManager=new CustomLoggerManager(generalSettings.getLoggingLevel());
  container.setLoggerManager(loggerManager);
  try {
    container.initialize();
    container.start();
  }
 catch (  PlexusContainerException e) {
    MavenLog.LOG.error(e);
    throw new RuntimeException(e);
  }
  File mavenHome=generalSettings.getEffectiveMavenHome();
  if (mavenHome != null) {
    System.setProperty(PROP_MAVEN_HOME,mavenHome.getPath());
  }
  Settings settings=buildSettings(container,generalSettings);
  return new MavenEmbedderWrapper(container,settings,loggerManager.getLogger(),generalSettings);
}
