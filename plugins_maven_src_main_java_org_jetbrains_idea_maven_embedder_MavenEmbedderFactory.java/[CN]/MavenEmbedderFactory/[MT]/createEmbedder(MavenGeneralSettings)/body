{
  DefaultPlexusContainer container;
  try {
    container=new DefaultPlexusContainer();
  }
 catch (  RuntimeException e) {
    String s="Cannot initialize Maven. Please make sure that your IDEA installation is correct and has no old libraries.";
    throw new RuntimeException(s,e);
  }
  container.setClassWorld(new ClassWorld("plexus.core",generalSettings.getClass().getClassLoader()));
  CustomLoggerManager loggerManager=new CustomLoggerManager(generalSettings.getLoggingLevel());
  container.setLoggerManager(loggerManager);
  try {
    container.initialize();
    container.start();
  }
 catch (  PlexusContainerException e) {
    MavenLog.LOG.error(e);
    throw new RuntimeException(e);
  }
  File mavenHome=generalSettings.getEffectiveMavenHome();
  if (mavenHome != null) {
    System.setProperty(PROP_MAVEN_HOME,mavenHome.getPath());
  }
  Settings settings=buildSettings(container,generalSettings);
  return new MavenEmbedderWrapper(container,settings,loggerManager.getLogger(),generalSettings);
}
