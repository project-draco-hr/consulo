{
  File file=generalSettings.getEffectiveGlobalSettingsIoFile();
  if (file != null) {
    System.setProperty(MavenSettingsBuilder.ALT_GLOBAL_SETTINGS_XML_LOCATION,file.getPath());
  }
  Settings settings=null;
  try {
    MavenSettingsBuilder settingsBuilder=(MavenSettingsBuilder)container.lookup(MavenSettingsBuilder.ROLE);
    File userSettingsFile=generalSettings.getEffectiveUserSettingsIoFile();
    if (userSettingsFile != null && userSettingsFile.exists() && !userSettingsFile.isDirectory()) {
      settings=settingsBuilder.buildSettings(userSettingsFile,false);
    }
    if (settings == null) {
      settings=settingsBuilder.buildSettings();
    }
  }
 catch (  ComponentLookupException e) {
    MavenLog.LOG.error(e);
  }
catch (  IOException e) {
    MavenLog.LOG.warn(e);
  }
catch (  XmlPullParserException e) {
    MavenLog.LOG.warn(e);
  }
  if (settings == null) {
    settings=new Settings();
  }
  File localRepository=generalSettings.getEffectiveLocalRepository();
  if (localRepository != null) {
    settings.setLocalRepository(localRepository.getPath());
  }
  settings.setOffline(generalSettings.isWorkOffline());
  settings.setInteractiveMode(false);
  settings.setUsePluginRegistry(generalSettings.isUsePluginRegistry());
  RuntimeInfo runtimeInfo=new RuntimeInfo(settings);
  runtimeInfo.setPluginUpdateOverride(generalSettings.getPluginUpdatePolicy() == MavenExecutionOptions.PluginUpdatePolicy.UPDATE);
  settings.setRuntimeInfo(runtimeInfo);
  return settings;
}
