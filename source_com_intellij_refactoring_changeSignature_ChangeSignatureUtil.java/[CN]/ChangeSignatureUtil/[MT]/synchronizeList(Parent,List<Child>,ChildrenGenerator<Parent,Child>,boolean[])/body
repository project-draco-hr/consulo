{
  ArrayList<Child> elementsToRemove=null;
  List<Child> elements;
  int index=0;
  while (true) {
    elements=generator.getChildren(list);
    if (index == newElements.size())     break;
    if (elementsToRemove == null) {
      elementsToRemove=new ArrayList<Child>();
      for (int i=0; i < shouldRemoveChild.length; i++) {
        if (shouldRemoveChild[i]) {
          elementsToRemove.add(elements.get(i));
        }
      }
    }
    Child oldElement=index < elements.size() ? elements.get(index) : null;
    Child newElement=newElements.get(index);
    if (!newElement.equals(oldElement)) {
      if (oldElement != null && elementsToRemove.contains(oldElement)) {
        oldElement.delete();
        index--;
      }
 else {
        list.addBefore(newElement,oldElement);
        if (list.equals(newElement.getParent())) {
          newElement.delete();
        }
      }
    }
    index++;
  }
  for (int i=newElements.size(); i < elements.size(); i++) {
    Child element=elements.get(i);
    element.delete();
  }
}
