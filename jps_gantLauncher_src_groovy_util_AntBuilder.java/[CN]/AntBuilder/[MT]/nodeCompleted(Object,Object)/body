{
  antElementHandler.onEndElement(null,null,antXmlContext);
  lastCompletedNode=node;
  if (parent != null && !(parent instanceof Target)) {
    log.finest("parent is not null: no perform on nodeCompleted");
    return;
  }
  if (node instanceof Task) {
    Task task=(Task)node;
    final String taskName=task.getTaskName();
    InputStream savedIn=System.in;
    InputStream savedProjectInputStream=project.getDefaultInputStream();
    if (!(savedIn instanceof DemuxInputStream)) {
      project.setDefaultInputStream(savedIn);
      System.setIn(new DemuxInputStream(project));
    }
    try {
      task.perform();
    }
  finally {
      project.setDefaultInputStream(savedProjectInputStream);
      System.setIn(savedIn);
    }
    if (node instanceof UnknownElement) {
      final UnknownElement unknownElement=(UnknownElement)node;
      unknownElement.maybeConfigure();
      lastCompletedNode=unknownElement.getRealThing();
    }
    if ("import".equals(taskName)) {
      antXmlContext.setCurrentTarget(collectorTarget);
    }
  }
 else   if (node instanceof Target) {
    antXmlContext.setCurrentTarget(collectorTarget);
  }
 else {
    final RuntimeConfigurable r=(RuntimeConfigurable)node;
    r.maybeConfigure(project);
  }
}
