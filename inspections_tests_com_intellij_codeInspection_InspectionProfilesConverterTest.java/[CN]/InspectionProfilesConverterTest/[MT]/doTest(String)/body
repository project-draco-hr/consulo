{
  try {
    final String relativePath="/inspection/converter/";
    final List children=JDOMUtil.loadDocument(new File(PathManagerEx.getTestDataPath() + relativePath + dirName+ "/options.ipr")).getRootElement().getChildren("component");
    for (    Object child : children) {
      final Element element=(Element)child;
      if (Comparing.strEqual(element.getAttributeValue("name"),"InspectionProjectProfileManager")) {
        final InspectionProjectProfileManager profileManager=InspectionProjectProfileManager.getInstance(getProject());
        InspectionProfileImpl.INIT_INSPECTIONS=true;
        profileManager.readExternal(element);
        final Element confElement=new Element("config");
        profileManager.writeExternal(confElement);
        assertTrue(new String(JDOMUtil.printDocument(new Document(confElement),"\n")),JDOMUtil.areElementsEqual(confElement,JDOMUtil.loadDocument(new File(PathManagerEx.getTestDataPath() + relativePath + dirName+ "/options.after.xml")).getRootElement()));
        break;
      }
    }
  }
  finally {
    InspectionProfileImpl.INIT_INSPECTIONS=false;
  }
}
