{
  final Module moduleForFile=ModuleUtil.findModuleForFile(virtualFile,packageManager.getProject());
  if (moduleForFile == null) {
    return null;
  }
  ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(moduleForFile);
  final ModuleExtension extension=moduleRootManager.getExtension(extensionClass);
  if (extension == null) {
    return null;
  }
  PsiManager psiManager=PsiManager.getInstance(packageManager.getProject());
  for (  PsiPackageSupportProvider p : PsiPackageSupportProvider.EP_NAME.getExtensions()) {
    if (p.getSupportedModuleExtensionClass().isAssignableFrom(extensionClass)) {
      return p.createPackage(psiManager,packageManager,extensionClass,qualifiedName);
    }
  }
  return null;
}
