{
  myFile=null;
  myEditor=null;
  Editor editor=createEditor(virtualFile);
  Document document=editor.getDocument();
  EditorInfo editorInfo=new EditorInfo(document.getText());
  String newFileText=editorInfo.getNewFileText();
  if (!document.getText().equals(newFileText)) {
    document.setText(newFileText);
  }
  PsiFile file=myPsiManager.findFile(virtualFile);
  if (myFile == null)   myFile=file;
  if (myEditor == null)   myEditor=editor;
  editorInfo.applyToEditor(editor);
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
}
