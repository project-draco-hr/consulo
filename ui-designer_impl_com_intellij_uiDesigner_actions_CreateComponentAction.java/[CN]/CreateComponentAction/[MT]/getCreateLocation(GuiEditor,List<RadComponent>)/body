{
  DropLocation dropLocation=null;
  if (selection.size() > 0) {
    RadComponent component=selection.get(0);
    final RadContainer container=component.getParent();
    if (container.isGrid()) {
      GridLayoutManager grid=(GridLayoutManager)container.getLayout();
      GridConstraints c=component.getConstraints();
      if (c.getColumn() + c.getColSpan() < grid.getColumnCount() && container.getComponentAtGrid(c.getRow(),c.getColumn() + c.getColSpan()) == null) {
        dropLocation=new GridDropLocation(container,c.getRow(),c.getColumn() + c.getColSpan());
      }
 else       if (c.getRow() + c.getRowSpan() < grid.getRowCount() && container.getComponentAtGrid(c.getRow() + c.getRowSpan(),c.getColumn()) == null) {
        dropLocation=new GridDropLocation(container,c.getRow() + c.getRowSpan(),c.getColumn());
      }
 else {
        dropLocation=new GridInsertLocation(container,c.getRow() + c.getRowSpan() - 1,c.getColumn(),GridInsertMode.RowAfter);
      }
    }
  }
  if (dropLocation == null) {
    final Point mousePosition=editor.getMainProcessor().getLastMousePosition();
    if (mousePosition != null) {
      RadContainer container=GridInsertProcessor.getDropTargetContainer(editor.getRootContainer(),mousePosition);
      if (container instanceof RadRootContainer && container.getComponentCount() == 1 && container.getComponent(0) instanceof RadContainer) {
        RadContainer childContainer=(RadContainer)container.getComponent(0);
        dropLocation=childContainer.getDropLocation(null);
      }
 else {
        dropLocation=GridInsertProcessor.getDropLocation(editor.getRootContainer(),mousePosition);
      }
    }
 else {
      dropLocation=editor.getRootContainer().getDropLocation(null);
    }
  }
  return dropLocation;
}
