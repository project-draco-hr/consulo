{
  EditorSettingsExternalizable.getInstance().setFoldingOutlineShown(myCbFolding.isSelected());
  super.apply();
  final List<Pair<Editor,Project>> toUpdate=new ArrayList<Pair<Editor,Project>>();
  for (  final Editor editor : EditorFactory.getInstance().getAllEditors()) {
    final Project project=editor.getProject();
    if (project != null && !project.isDefault()) {
      toUpdate.add(Pair.create(editor,project));
    }
  }
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    @Override public void run(){
      for (      Pair<Editor,Project> each : toUpdate) {
        if (each.second == null || each.second.isDisposed()) {
          continue;
        }
        final CodeFoldingManager foldingManager=CodeFoldingManager.getInstance(each.second);
        if (foldingManager != null) {
          foldingManager.buildInitialFoldings(each.first);
        }
      }
      EditorOptionsPanel.reinitAllEditors();
    }
  }
,ModalityState.NON_MODAL);
}
