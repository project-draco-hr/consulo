{
  return new CodeInsightActionHandler(){
    public void invoke(    Project project,    Editor editor,    PsiFile file){
      try {
        ourDoingSmartCodeCompleteAction=true;
        if (file instanceof PsiJavaFile) {
          FeatureUsageTracker.getInstance().triggerFeatureUsed("editing.completion.smarttype.general");
          new SmartCodeCompletionHandler().invoke(project,editor,file);
        }
 else {
          FeatureUsageTracker.getInstance().triggerFeatureUsed("editing.completion.basic");
          new CodeCompletionHandler().invoke(project,editor,file);
        }
      }
  finally {
        ourDoingSmartCodeCompleteAction=false;
      }
    }
    public boolean startInWriteAction(){
      return true;
    }
  }
;
}
