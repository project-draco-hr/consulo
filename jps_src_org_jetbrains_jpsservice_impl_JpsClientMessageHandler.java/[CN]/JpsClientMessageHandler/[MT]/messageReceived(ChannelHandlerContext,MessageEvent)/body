{
  final JpsRemoteProto.Message message=(JpsRemoteProto.Message)e.getMessage();
  final JpsServerResponseHandler handler=getHandler(message);
  if (handler == null) {
    return;
  }
  if (message.getKind() == JpsRemoteProto.Message.Kind.FAILURE) {
    handler.handleFailure(message.getFailure());
  }
 else   if (message.getKind() == JpsRemoteProto.Message.Kind.RESPONSE) {
    final JpsRemoteProto.Message.Response response=message.getResponse();
    if (response.hasCompileResponse()) {
      handler.handleCompileResponse(response.getCompileResponse());
    }
 else     if (response.hasStatusResponse()) {
      handler.handleStatusResponse(response.getStatusResponse());
    }
 else {
      throw new Exception("Unknown response: " + response);
    }
  }
 else {
    throw new Exception("Unknown message received: " + message);
  }
}
