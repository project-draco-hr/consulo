{
  final Project project=groovyFile.getProject();
  final Module module=ModuleUtil.findModuleForPsiElement(groovyFile);
  Set<VirtualFile> jars=new HashSet<VirtualFile>();
  if (module != null) {
    ContainerUtil.addAll(jars,OrderEnumerator.orderEntries(module).getAllLibrariesAndSdkClassesRoots());
  }
  if (groovyFile.isScript() && GroovyScriptTypeDetector.getScriptType(groovyFile) instanceof GantScriptType) {
    jars.addAll(GantScriptType.additionalScopeFiles(groovyFile));
  }
  final ArrayList<URL> urls=new ArrayList<URL>();
  for (  VirtualFile jar : jars) {
    urls.add(VfsUtil.convertToURL(PathUtil.getLocalFile(jar).getUrl()));
  }
  AntClassLoader loader;
synchronized (ourLock) {
    final Map<List<URL>,SoftReference<AntClassLoader>> map=CachedValuesManager.getManager(project).getCachedValue(project,new CachedValueProvider<Map<List<URL>,SoftReference<AntClassLoader>>>(){
      @Override public Result<Map<List<URL>,SoftReference<AntClassLoader>>> compute(){
        final Map<List<URL>,SoftReference<AntClassLoader>> map=CollectionFactory.hashMap();
        final Result<Map<List<URL>,SoftReference<AntClassLoader>>> result=Result.create(map,ProjectRootManager.getInstance(project));
        result.setLockValue(true);
        return result;
      }
    }
);
    final SoftReference<AntClassLoader> reference=map.get(urls);
    loader=reference != null ? reference.get() : null;
    if (loader == null) {
      map.put(urls,new SoftReference<AntClassLoader>(loader=new AntClassLoader(urls)));
    }
  }
  return loader.getAntObjects();
}
