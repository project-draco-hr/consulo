{
  if (!myElement.isValid())   return null;
  String qName=getElement().getText().substring(getReference(0).getRangeInElement().getStartOffset(),getRangeInElement().getEndOffset());
  if (myIndex == myReferences.length - 1) {
    final PsiClass aClass=myElement.getManager().findClass(qName,GlobalSearchScope.allScope(myElement.getProject()));
    if (aClass != null)     return aClass;
  }
  PsiElement resolveResult=myElement.getManager().findPackage(qName);
  if (resolveResult == null)   resolveResult=myElement.getManager().findClass(qName,GlobalSearchScope.allScope(myElement.getProject()));
  if (resolveResult == null) {
    final PsiFile containingFile=myElement.getContainingFile();
    if (containingFile instanceof PsiJavaFile) {
      final ClassResolverProcessor processor=new ClassResolverProcessor(getCanonicalText(),myElement);
      containingFile.processDeclarations(processor,PsiSubstitutor.EMPTY,null,myElement);
      if (processor.getResult().length == 1)       return processor.getResult()[0].getElement();
    }
  }
  return resolveResult;
}
