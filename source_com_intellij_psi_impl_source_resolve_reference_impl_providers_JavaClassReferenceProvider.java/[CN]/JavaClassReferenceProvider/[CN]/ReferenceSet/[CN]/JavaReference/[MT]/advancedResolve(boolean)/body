{
  if (!myElement.isValid())   return JavaResolveResult.EMPTY;
  String qName=getElement().getText().substring(getReference(0).getRangeInElement().getStartOffset(),getRangeInElement().getEndOffset());
  PsiManager manager=myElement.getManager();
  if (myIndex == myReferences.length - 1) {
    final PsiClass aClass=manager.findClass(qName,GlobalSearchScope.allScope(myElement.getProject()));
    if (aClass != null) {
      return new ClassCandidateInfo(aClass,PsiSubstitutor.EMPTY,false,false,myElement);
    }
  }
  PsiElement resolveResult=manager.findPackage(qName);
  if (resolveResult == null) {
    resolveResult=manager.findClass(qName,GlobalSearchScope.allScope(myElement.getProject()));
  }
  if (myInStaticImport && resolveResult == null) {
    resolveResult=JspxStaticImportStatement.resolveMember(qName,manager,getElement().getResolveScope());
  }
  if (resolveResult == null) {
    final PsiFile containingFile=myElement.getContainingFile();
    if (containingFile instanceof PsiJavaFile) {
      final ClassResolverProcessor processor=new ClassResolverProcessor(getCanonicalText(),myElement);
      containingFile.processDeclarations(processor,PsiSubstitutor.EMPTY,null,myElement);
      if (processor.getResult().length == 1) {
        final JavaResolveResult javaResolveResult=processor.getResult()[0];
        if (javaResolveResult != JavaResolveResult.EMPTY && options != null) {
          final Boolean value=RESOLVE_QUALIFIED_CLASS_NAME.getValue(options);
          if (value != null && value.booleanValue()) {
            final String qualifiedName=((PsiClass)javaResolveResult.getElement()).getQualifiedName();
            if (!qName.equals(qualifiedName)) {
              return JavaResolveResult.EMPTY;
            }
          }
        }
        return javaResolveResult;
      }
    }
  }
  return resolveResult != null ? new ClassCandidateInfo(resolveResult,PsiSubstitutor.EMPTY,false,false,myElement) : JavaResolveResult.EMPTY;
}
