{
  ProjectView projectView=ProjectView.getInstance(myProject);
  final TreePath path=myTree.getPathForRow(myTree.getRowForPath(event.getPath()));
  if (path == null)   return;
  final DefaultMutableTreeNode node=(DefaultMutableTreeNode)path.getLastPathComponent();
  if (node instanceof DirectoryNode) {
    Set<ClassNode> classNodes=null;
    for (int i=node.getChildCount() - 1; i >= 0; i--) {
      final TreeNode childNode=node.getChildAt(i);
      if (childNode instanceof FileNode) {
        final FileNode fileNode=(FileNode)childNode;
        final PsiElement file=fileNode.getPsiElement();
        if (file instanceof PsiJavaFile) {
          final PsiClass[] psiClasses=((PsiJavaFile)file).getClasses();
          if (classNodes == null) {
            classNodes=new HashSet<ClassNode>();
          }
          for (          final PsiClass psiClass : psiClasses) {
            if (psiClass != null && psiClass.isValid()) {
              final ClassNode classNode=new ClassNode(psiClass);
              classNodes.add(classNode);
              if (projectView.isShowMembers(ScopeViewPane.ID)) {
                final List<PsiElement> result=new ArrayList<PsiElement>();
                PsiClassChildrenSource.DEFAULT_CHILDREN.addChildren(psiClass,result);
                for (                PsiElement psiElement : result) {
                  psiElement.accept(new PsiElementVisitor(){
                    public void visitClass(                    PsiClass aClass){
                      classNode.add(new ClassNode(aClass));
                    }
                    public void visitMethod(                    PsiMethod method){
                      classNode.add(new MethodNode(method));
                    }
                    public void visitField(                    PsiField field){
                      classNode.add(new FieldNode(field));
                    }
                    public void visitReferenceExpression(                    PsiReferenceExpression expression){
                    }
                  }
);
                }
              }
            }
          }
          node.remove(fileNode);
        }
      }
    }
    if (classNodes != null) {
      for (      ClassNode classNode : classNodes) {
        node.add(classNode);
      }
    }
    TreeUtil.sort(node,new DependencyNodeComparator());
    ((DefaultTreeModel)myTree.getModel()).reload(node);
  }
}
