{
  if (getContainingFile().getLanguage() == XPathFileType.XPATH2.getLanguage()) {
    XPathVariableDeclaration f=PsiTreeUtil.getParentOfType(this,XPathVariableDeclaration.class,true);
    while (f != null) {
      final XPathVariable variable=f.getVariable(getReferencedName());
      if (variable != null) {
        return variable;
      }
      f=PsiTreeUtil.getParentOfType(f,XPathVariableDeclaration.class,true);
    }
  }
  final VariableContext context=getXPathContext().getVariableContext();
  if (context == null) {
    return null;
  }
  return context.resolve(this);
}
