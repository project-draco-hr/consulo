{
  Map<GitRepository,GitPushSpec> defaultSpecs=new HashMap<GitRepository,GitPushSpec>();
  for (  GitRepository repository : myRepositories) {
    GitLocalBranch currentBranch=repository.getCurrentBranch();
    if (currentBranch == null) {
      continue;
    }
    String remoteName=GitBranchUtil.getTrackedRemoteName(repository.getProject(),repository.getRoot(),currentBranch.getName());
    String trackedBranchName=GitBranchUtil.getTrackedBranchName(repository.getProject(),repository.getRoot(),currentBranch.getName());
    GitRemote remote=GitUtil.findRemoteByName(repository,remoteName);
    GitRemoteBranch targetBranch;
    if (remote != null && trackedBranchName != null) {
      targetBranch=GitBranchUtil.findRemoteBranchByName(trackedBranchName,remote.getName(),repository.getBranches().getRemoteBranches());
    }
 else {
      Pair<GitRemote,GitRemoteBranch> remoteAndBranch=GitUtil.findMatchingRemoteBranch(repository,currentBranch);
      if (remoteAndBranch == null) {
        targetBranch=GitPusher.NO_TARGET_BRANCH;
      }
 else {
        targetBranch=remoteAndBranch.getSecond();
      }
    }
    if (myRefspecPanel.turnedOn()) {
      String manualBranchName=myRefspecPanel.getBranchToPush();
      remote=myRefspecPanel.getSelectedRemote();
      GitRemoteBranch manualBranch=GitBranchUtil.findRemoteBranchByName(manualBranchName,remote.getName(),repository.getBranches().getRemoteBranches());
      if (manualBranch == null) {
        manualBranch=new GitStandardRemoteBranch(remote,manualBranchName,GitBranch.DUMMY_HASH);
      }
      targetBranch=manualBranch;
    }
    GitPushSpec pushSpec=new GitPushSpec(currentBranch,targetBranch == null ? GitPusher.NO_TARGET_BRANCH : targetBranch);
    defaultSpecs.put(repository,pushSpec);
  }
  return defaultSpecs;
}
