{
  new WriteCommandAction(myProject){
    @Override protected void run(    com.intellij.openapi.application.Result result) throws Throwable {
      final PsiVariable variable=getVariable();
      LOG.assertTrue(variable != null);
      final PsiModifierList modifierList=variable.getModifierList();
      LOG.assertTrue(modifierList != null);
      final int textOffset=modifierList.getTextOffset();
      final Document document=myEditor.getDocument();
      if (generateFinal) {
        final PsiTypeElement typeElement=variable.getTypeElement();
        final int typeOffset=typeElement != null ? typeElement.getTextOffset() : textOffset;
        document.insertString(typeOffset,PsiModifier.FINAL + " ");
      }
 else {
        final int idx=modifierList.getText().indexOf(PsiModifier.FINAL);
        document.deleteString(textOffset + idx,textOffset + idx + PsiModifier.FINAL.length()+ 1);
      }
    }
  }
.execute();
}
