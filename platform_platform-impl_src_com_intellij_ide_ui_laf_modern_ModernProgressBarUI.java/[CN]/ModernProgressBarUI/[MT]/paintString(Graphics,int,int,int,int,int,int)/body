{
  if (!(g instanceof Graphics2D)) {
    return;
  }
  Graphics2D g2=(Graphics2D)g;
  String progressString=progressBar.getString();
  g2.setFont(progressBar.getFont());
  Point renderLocation=getStringPlacement(g2,progressString,x,y,w,h);
  Rectangle oldClip=g2.getClipBounds();
  if (progressBar.getOrientation() == JProgressBar.HORIZONTAL) {
    g2.setColor(getSelectionBackground());
    SwingUtilities2.drawString(progressBar,g2,progressString,renderLocation.x,renderLocation.y);
    g2.setColor(getSelectionForeground());
    g2.clipRect(fillStart,y,amountFull,h);
    SwingUtilities2.drawString(progressBar,g2,progressString,renderLocation.x,renderLocation.y);
  }
 else {
    g2.setColor(getSelectionBackground());
    AffineTransform rotate=AffineTransform.getRotateInstance(Math.PI / 2);
    g2.setFont(progressBar.getFont().deriveFont(rotate));
    renderLocation=getStringPlacement(g2,progressString,x,y,w,h);
    SwingUtilities2.drawString(progressBar,g2,progressString,renderLocation.x,renderLocation.y);
    g2.setColor(getSelectionForeground());
    g2.clipRect(x,fillStart,w,amountFull);
    SwingUtilities2.drawString(progressBar,g2,progressString,renderLocation.x,renderLocation.y);
  }
  g2.setClip(oldClip);
}
