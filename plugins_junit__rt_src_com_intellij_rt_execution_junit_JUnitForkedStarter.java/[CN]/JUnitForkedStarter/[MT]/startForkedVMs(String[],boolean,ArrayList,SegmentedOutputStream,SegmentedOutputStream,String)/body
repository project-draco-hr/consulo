{
  IdeaTestRunner testRunner=(IdeaTestRunner)JUnitStarter.getAgentClass(isJUnit4).newInstance();
  testRunner.setStreams(out,err,0);
  final Object description=testRunner.getTestToStart(args);
  TreeSender.sendTree(testRunner,description);
  long startTime=System.currentTimeMillis();
  final List children=testRunner.getChildTests(description);
  final boolean forkTillMethod=System.getProperty("idea.fork.junit.tests").equalsIgnoreCase("method");
  int result=processChildren(isJUnit4,listeners,out,err,commandline,testRunner,children,0,forkTillMethod);
  long endTime=System.currentTimeMillis();
  long runTime=endTime - startTime;
  new TimeSender(testRunner.getRegistry()).printHeader(runTime);
  return result;
}
