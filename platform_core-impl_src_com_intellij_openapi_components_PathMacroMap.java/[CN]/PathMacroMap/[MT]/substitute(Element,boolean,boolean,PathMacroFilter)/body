{
  for (  Content child : e.getContent()) {
    if (child instanceof Element) {
      substitute((Element)child,caseSensitive,recursively,filter);
    }
 else     if (child instanceof Text) {
      Text t=(Text)child;
      if (filter == null || !filter.skipPathMacros(t)) {
        String oldText=t.getText();
        String newText=(recursively || (filter != null && filter.recursePathMacros(t))) ? substituteRecursively(oldText,caseSensitive) : substitute(oldText,caseSensitive);
        if (oldText != newText) {
          t.setText(newText);
        }
      }
    }
 else     if (!(child instanceof Comment)) {
      LOGGER.error("Wrong content: " + child.getClass());
    }
  }
  for (  Attribute attribute : e.getAttributes()) {
    if (filter == null || !filter.skipPathMacros(attribute)) {
      String oldValue=attribute.getValue();
      String newValue=(recursively || (filter != null && filter.recursePathMacros(attribute))) ? substituteRecursively(oldValue,caseSensitive) : substitute(oldValue,caseSensitive);
      if (oldValue != newValue) {
        attribute.setValue(newValue);
      }
    }
  }
}
