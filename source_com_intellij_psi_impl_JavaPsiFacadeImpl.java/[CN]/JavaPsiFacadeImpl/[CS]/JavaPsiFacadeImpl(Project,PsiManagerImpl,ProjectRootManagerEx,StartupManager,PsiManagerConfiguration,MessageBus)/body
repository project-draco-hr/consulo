{
  myProject=project;
  myResolveHelper=new PsiResolveHelperImpl(PsiManager.getInstance(project));
  myJavadocManager=new JavadocManagerImpl();
  myNameHelper=new PsiNameHelperImpl(this);
  myConstantEvaluationHelper=new PsiConstantEvaluationHelperImpl();
  myElementFactory=new PsiElementFactoryImpl(psiManager);
  List<PsiElementFinder> elementFinders=new ArrayList<PsiElementFinder>();
  elementFinders.addAll(Arrays.asList(myProject.getComponents(PsiElementFinder.class)));
  elementFinders.add(new PsiElementFinderImpl());
  myElementFinders=elementFinders.toArray(new PsiElementFinder[elementFinders.size()]);
  boolean isProjectDefault=project.isDefault();
  if (psiManagerConfiguration.REPOSITORY_ENABLED && !isProjectDefault) {
    myShortNamesCache=new PsiShortNamesCacheImpl((PsiManagerEx)PsiManager.getInstance(project),projectRootManagerEx);
  }
 else {
    myShortNamesCache=new EmptyShortNamesCacheImpl();
  }
  myFileManager=new JavaFileManagerImpl(psiManager,projectRootManagerEx,psiManager.getFileManager(),bus);
  myProgressManager=ProgressManager.getInstance();
  psiManager.registerRunnableToRunOnChange(new Runnable(){
    public void run(){
      myPackageCache.clear();
    }
  }
);
  startupManager.registerStartupActivity(new Runnable(){
    public void run(){
      runStartupActivity();
    }
  }
);
  JavaFindUsagesHandler.setupForProject(project);
  JavaChangeUtilSupport.setup();
  DummyHolderFactory.setFactory(new JavaDummyHolderFactory());
  Disposer.register(project,this);
}
