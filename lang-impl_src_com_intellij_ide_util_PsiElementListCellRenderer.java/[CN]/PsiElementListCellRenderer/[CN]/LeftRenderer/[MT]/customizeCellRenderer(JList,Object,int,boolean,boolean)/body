{
  if (value instanceof PsiElement) {
    PsiElement element=(PsiElement)value;
    String name=getElementText((T)element);
    Color color=list.getForeground();
    PsiFile psiFile=element.getContainingFile();
    boolean isProblemFile=false;
    if (psiFile != null) {
      VirtualFile vFile=psiFile.getVirtualFile();
      if (vFile != null) {
        if (WolfTheProblemSolver.getInstance(psiFile.getProject()).isProblemFile(vFile)) {
          isProblemFile=true;
        }
        FileStatus status=FileStatusManager.getInstance(psiFile.getProject()).getStatus(vFile);
        color=status.getColor();
      }
    }
    TextAttributes attributes=null;
    if (value instanceof NavigationItem) {
      TextAttributesKey attributesKey=null;
      final ItemPresentation presentation=((NavigationItem)value).getPresentation();
      if (presentation != null)       attributesKey=presentation.getTextAttributesKey();
      if (attributesKey != null) {
        attributes=EditorColorsManager.getInstance().getGlobalScheme().getAttributes(attributesKey);
      }
    }
    SimpleTextAttributes nameAttributes;
    if (isProblemFile) {
      attributes=TextAttributes.merge(new TextAttributes(color,null,Color.red,EffectType.WAVE_UNDERSCORE,Font.PLAIN),attributes);
    }
    nameAttributes=attributes != null ? SimpleTextAttributes.fromTextAttributes(attributes) : null;
    if (nameAttributes == null)     nameAttributes=new SimpleTextAttributes(Font.PLAIN,color);
    append(name,nameAttributes);
    setIcon(PsiElementListCellRenderer.this.getIcon(element));
    String containerText=getContainerText(element,name + (myModuleName != null ? myModuleName + "        " : ""));
    if (containerText != null) {
      append(" " + containerText,new SimpleTextAttributes(Font.PLAIN,Color.GRAY));
    }
  }
 else {
    setIcon(IconUtil.getEmptyIcon(false));
    append(value == null ? "" : value.toString(),new SimpleTextAttributes(Font.PLAIN,list.getForeground()));
  }
  setPaintFocusBorder(false);
  setBackground(selected ? UIUtil.getListSelectionBackground() : UIUtil.getListBackground());
}
