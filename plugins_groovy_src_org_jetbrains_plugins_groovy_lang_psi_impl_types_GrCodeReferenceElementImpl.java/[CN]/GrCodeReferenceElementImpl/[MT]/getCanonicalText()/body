{
  final ReferenceKind kind=getKind(false);
switch (kind) {
case CLASS:
case CLASS_IN_QUALIFIED_NEW:
case CLASS_OR_PACKAGE:
    final PsiElement target=resolve();
  if (target instanceof PsiClass) {
    final PsiClass aClass=(PsiClass)target;
    String name=aClass.getQualifiedName();
    if (name == null) {
      name=aClass.getName();
    }
    final PsiType[] types=getTypeArguments();
    if (types.length == 0)     return name;
    final StringBuilder buf=new StringBuilder();
    buf.append(name);
    buf.append('<');
    for (int i=0; i < types.length; i++) {
      if (i > 0)       buf.append(',');
      buf.append(types[i].getCanonicalText());
    }
    buf.append('>');
    return buf.toString();
  }
 else   if (target instanceof PsiPackage) {
    return ((PsiPackage)target).getQualifiedName();
  }
 else {
    LOG.assertTrue(target == null);
    return getTextSkipWhiteSpaceAndComments();
  }
case CLASS_FQ:
case CLASS_OR_PACKAGE_FQ:
case PACKAGE_FQ:
case STATIC_MEMBER_FQ:
return getTextSkipWhiteSpaceAndComments();
default :
LOG.assertTrue(false);
return null;
}
}
