{
  FilePath selectedFile=getSelectedFileOrNull(context);
  if (selectedFile == null)   return false;
  Project project=context.getProject();
  if (project == null)   return false;
  VirtualFile someVFile=selectedFile.getVirtualFile() != null ? selectedFile.getVirtualFile() : selectedFile.getVirtualFileParent();
  if (someVFile == null) {
    return false;
  }
  AbstractVcs vcs=ProjectLevelVcsManager.getInstance(project).getVcsFor(someVFile);
  if (vcs == null)   return false;
  VcsHistoryProvider vcsHistoryProvider=getProvider(vcs);
  if (vcsHistoryProvider == null)   return false;
  if (selectedFile.isDirectory() && (!vcsHistoryProvider.supportsHistoryForDirectories()))   return false;
  if (!canFileHaveHistory(project,someVFile)) {
    return false;
  }
  return vcsHistoryProvider.canShowHistoryFor(someVFile);
}
