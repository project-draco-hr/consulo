{
  FilePath selectedFile=getSelectedFileOrNull(context);
  if (selectedFile == null)   return false;
  Project project=context.getProject();
  if (project == null)   return false;
  VirtualFile someVFile=selectedFile.getVirtualFile() != null ? selectedFile.getVirtualFile() : selectedFile.getVirtualFileParent();
  AbstractVcs vcs=ProjectLevelVcsManager.getInstance(project).getVcsFor(someVFile);
  if (vcs == null)   return false;
  VcsHistoryProvider vcsHistoryProvider=getProvider(vcs);
  if (vcsHistoryProvider == null)   return false;
  if (selectedFile.isDirectory() && (!vcsHistoryProvider.supportsHistoryForDirectories()))   return false;
  final FileStatus fileStatus=FileStatusManager.getInstance(project).getStatus(someVFile);
  return fileStatus != FileStatus.ADDED && fileStatus != FileStatus.UNKNOWN && fileStatus != FileStatus.IGNORED;
}
