{
  System.out.println("JetBrains.com build server. (C) JetBrains.com, 2010.\n");
  final List<String> notes=myOptions.parse(args);
  for (  String note : notes) {
    System.err.println("WARNING: " + note);
  }
  checkConsistency();
  if (doHelp()) {
    System.out.println("Usage: ??? <options> <project-specifier>\n");
    System.out.println("Options are:");
    System.out.println(myOptions.memo());
  }
  final List<String> projects=myOptions.getFree();
  if (projects.isEmpty() && !doHelp()) {
    System.out.println("Nothing to do; use --help or -h option to see the help.\n");
  }
  for (  String prj : projects) {
    final ProjectWrapper project=new ProjectWrapper(prj);
    boolean saved=false;
switch (getAction()) {
case CLEAN:
      System.out.println("Cleaning project \"" + prj + "\"");
    project.load();
  project.clean();
project.save();
saved=true;
break;
case REBUILD:
System.out.println("Rebuilding project \"" + prj + "\"");
project.load();
project.rebuild();
project.save();
saved=true;
break;
case MAKE:
final Options.Argument make=doMake();
if (make instanceof Options.Value) {
final String module=((Options.Value)make).get();
System.out.println("Making module \"" + module + "\" in project \""+ prj+ "\"");
project.load();
project.makeModule(module,doForce(),doTests());
project.save();
saved=true;
}
 else if (make instanceof Options.Switch) {
System.out.println("Making project \"" + prj + "\"");
project.load();
project.make(doForce(),doTests());
project.save();
saved=true;
}
;
break;
}
final Options.Argument inspect=doInspect();
if (inspect instanceof Options.Switch) {
project.load();
project.report();
if (doSave()) {
project.save();
saved=true;
}
}
 else if (inspect instanceof Options.Value) {
project.load();
project.report(((Options.Value)inspect).get());
if (doSave()) {
project.save();
saved=true;
}
}
if (doSave() && !saved) {
project.load();
project.save();
}
}
}
