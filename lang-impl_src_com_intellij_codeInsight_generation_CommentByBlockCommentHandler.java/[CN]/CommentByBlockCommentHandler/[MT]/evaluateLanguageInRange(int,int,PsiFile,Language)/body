{
  PsiElement elt;
  int curOffset=start;
  do {
    elt=getElementAtOffset(file,curOffset);
    if (elt == null)     break;
    if (!(elt instanceof PsiWhiteSpace)) {
      if (!Comparing.equal(lang,PsiUtil.findLanguageFromElement(elt,file))) {
        lang=file.getLanguage();
        break;
      }
    }
    curOffset=elt.getTextRange().getEndOffset();
  }
 while (curOffset < end);
  if (file.getLanguageDialect() != null)   return file.getLanguageDialect();
  return lang;
}
