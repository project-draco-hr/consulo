{
  super(true,true);
  myProject=project;
  myConfig=AntConfiguration.getInstance(project);
  final DefaultTreeModel model=new DefaultTreeModel(new DefaultMutableTreeNode());
  myTree=new Tree(model);
  myTree.setRootVisible(false);
  myTree.setShowsRootHandles(true);
  myTree.setCellRenderer(new NodeRenderer());
  myBuilder=new AntExplorerTreeBuilder(project,myTree,model);
  myBuilder.setTargetsFiltered(AntConfigurationBase.getInstance(project).isFilterTargets());
  TreeUtil.installActions(myTree);
  new TreeSpeedSearch(myTree);
  myTree.addMouseListener(new PopupHandler(){
    public void invokePopup(    final Component comp,    final int x,    final int y){
      popupInvoked(comp,x,y);
    }
  }
);
  myTree.addMouseListener(new MouseAdapter(){
    public void mouseClicked(    MouseEvent e){
      if (e.getClickCount() == 2) {
        final TreePath path=myTree.getPathForLocation(e.getX(),e.getY());
        if (path != null) {
          runSelection(DataManager.getInstance().getDataContext(myTree));
        }
      }
    }
  }
);
  myTree.registerKeyboardAction(new AbstractAction(){
    public void actionPerformed(    ActionEvent e){
      runSelection(DataManager.getInstance().getDataContext(myTree));
    }
  }
,KeyStroke.getKeyStroke(KeyEvent.VK_ENTER,0),WHEN_FOCUSED);
  myTree.setLineStyleAngled();
  myAntBuildFilePropertiesAction=new AntBuildFilePropertiesAction(this);
  setToolbar(createToolbarPanel());
  setContent(ScrollPaneFactory.createScrollPane(myTree));
  ToolTipManager.sharedInstance().registerComponent(myTree);
  myKeymapListener=new KeymapListener();
  myQueue=new MergingUpdateQueue("AntExplorer.Queue",300,true,this,this);
  DomManager.getDomManager(project).addDomEventListener(new DomEventListener(){
    public void eventOccured(    DomEvent event){
      myQueue.queue(new Update(AntExplorer.this){
        public void run(){
          myBuilder.refresh();
        }
        public boolean canEat(        Update update){
          return true;
        }
      }
);
    }
  }
,this);
  RunManagerEx.getInstanceEx(myProject).addRunManagerListener(new RunManagerAdapter(){
    public void beforeRunTasksChanged(){
      myBuilder.refresh();
    }
  }
);
}
