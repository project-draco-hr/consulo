{
  int initialInsertRow=0;
  for (TreeNode n=root.getParent(); n != null; n=n.getParent()) {
    for (int i=n.getChildCount() - 1; i >= 0; i--) {
      TreeNode child=n.getChildAt(i);
      if (child != root) {
        initialInsertRow+=calculateRowsCount(child);
      }
    }
    initialInsertRow++;
  }
  initialInsertRow+=calculateRowsCount(root);
  if (!tree.isRootVisible()) {
    initialInsertRow--;
  }
  HierarchicalArrangementSettingsNode grouped=grouper.group(setting);
  Pair<DefaultMutableTreeNode,Integer> pair=ArrangementConfigUtil.map(root,grouped);
  DefaultMutableTreeNode topMostNode=(DefaultMutableTreeNode)ArrangementConfigUtil.getLastBefore(pair.first,root);
  int row=initialInsertRow + pair.second - 1;
  ArrangementRuleEditingModelImpl model=new ArrangementRuleEditingModelImpl(setting,topMostNode,pair.first,grouper,rowMappings,row);
  rowMappings.put(row,model);
}
