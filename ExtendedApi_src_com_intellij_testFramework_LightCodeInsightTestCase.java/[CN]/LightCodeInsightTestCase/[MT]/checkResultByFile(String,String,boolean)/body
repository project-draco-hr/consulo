{
  bringRealEditorBack();
  getProject().getComponent(PostprocessReformattingAspect.class).doPostponedFormatting();
  if (ignoreTrailingSpaces) {
    final Editor editor=myEditor;
    ((DocumentEx)editor.getDocument()).stripTrailingSpaces(false);
    EditorUtil.fillVirtualSpaceUntilCaret(editor);
  }
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
  String fullPath=getTestDataPath() + filePath;
  File ioFile=new File(fullPath);
  assertTrue(getMessage("Cannot find file " + fullPath,message),ioFile.exists());
  String fileText=null;
  try {
    fileText=new String(FileUtil.loadFileText(ioFile,CharsetToolkit.UTF8));
  }
 catch (  IOException e) {
    LOG.error(e);
  }
  checkResultByText(message,StringUtil.convertLineSeparators(fileText),ignoreTrailingSpaces);
}
