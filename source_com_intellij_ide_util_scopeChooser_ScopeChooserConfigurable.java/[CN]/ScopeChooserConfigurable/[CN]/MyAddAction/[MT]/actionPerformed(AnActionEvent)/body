{
  final String localScopeChoice=IdeBundle.message("add.local.scope.action.text");
  final String sharedScopeChoice=IdeBundle.message("add.shared.scope.action.text");
  JBPopupFactory.getInstance().createWizardStep(new BaseListPopupStep<String>(IdeBundle.message("add.scope.popup.title"),new String[]{localScopeChoice,sharedScopeChoice}){
    public PopupStep onChosen(    final String s,    final boolean finalChoice){
      SwingUtilities.invokeLater(new Runnable(){
        public void run(){
          if (Comparing.strEqual(s,localScopeChoice)) {
            addScope(myLocalScopesManager,myLocalScopesNode,LOCAL_SCOPES);
          }
 else {
            addScope(mySharedScopesManager,mySharedScopesNode,SHARED_SCOPES);
          }
        }
      }
);
      return PopupStep.FINAL_CHOICE;
    }
    public int getDefaultOptionIndex(){
      final TreePath selectionPath=myTree.getSelectionPath();
      if (selectionPath != null) {
        final MyNode node=(MyNode)selectionPath.getLastPathComponent();
        Object editableObject=node.getConfigurable().getEditableObject();
        if (editableObject instanceof NamedScope) {
          editableObject=((MyNode)node.getParent()).getConfigurable().getEditableObject();
        }
        if (editableObject instanceof NamedScopeManager) {
          return 0;
        }
 else         if (editableObject instanceof DependencyValidationManager) {
          return 1;
        }
      }
      return 0;
    }
  }
).showUnderneathOf(myNorthPanel);
}
