{
  final Project project=e.getRequiredData(CommonDataKeys.PROJECT);
  CleanUnshelvedFilterDialog dialog=new CleanUnshelvedFilterDialog(project);
  dialog.show();
  if (dialog.isOK()) {
    if (dialog.isUnshelvedWithFilterSelected()) {
      ShelveChangesManager.getInstance(project).cleanUnshelved(false,dialog.getTimeLimitInMillis());
    }
 else     if (dialog.isAllUnshelvedSelected()) {
      ShelveChangesManager.getInstance(project).clearRecycled();
    }
 else {
      ShelveChangesManager.getInstance(project).cleanUnshelved(true,System.currentTimeMillis());
    }
  }
}
