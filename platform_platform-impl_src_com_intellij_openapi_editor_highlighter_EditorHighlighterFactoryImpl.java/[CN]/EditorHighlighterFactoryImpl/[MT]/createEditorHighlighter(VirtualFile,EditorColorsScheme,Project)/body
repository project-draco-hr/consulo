{
  final FileType fileType=vFile.getFileType();
  if (fileType instanceof LanguageFileType) {
    LanguageFileType substFileType=substituteFileType(((LanguageFileType)fileType).getLanguage(),vFile,project);
    if (substFileType != null) {
      final EditorHighlighter editorHighlighter=substFileType.getEditorHighlighter(project,vFile,settings);
      boolean isPlain=editorHighlighter.getClass() == LexerEditorHighlighter.class && ((LexerEditorHighlighter)editorHighlighter).isPlain();
      if (!isPlain) {
        return editorHighlighter;
      }
    }
    return ((LanguageFileType)fileType).getEditorHighlighter(project,vFile,settings);
  }
  final ContentBasedClassFileProcessor[] processors=Extensions.getExtensions(ContentBasedClassFileProcessor.EP_NAME);
  SyntaxHighlighter highlighter=null;
  for (  ContentBasedClassFileProcessor processor : processors) {
    if (processor.isApplicable(project,vFile)) {
      highlighter=processor.createHighlighter(project,vFile);
    }
  }
  if (highlighter == null) {
    highlighter=SyntaxHighlighter.PROVIDER.create(fileType,project,vFile);
  }
  return createEditorHighlighter(highlighter,settings);
}
