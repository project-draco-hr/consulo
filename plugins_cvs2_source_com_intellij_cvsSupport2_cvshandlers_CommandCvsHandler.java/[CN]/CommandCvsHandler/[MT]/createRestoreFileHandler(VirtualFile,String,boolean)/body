{
  final File ioFile=new File(VfsUtil.virtualToIoFile(parent),name);
  final Entry entry=CvsEntriesManager.getInstance().getEntryFor(parent,name);
  final String revision=getRevision(entry);
  final CheckoutFileByRevisionOperation operation=new CheckoutFileByRevisionOperation(parent,name,revision,makeNewFilesReadOnly);
  final CommandCvsHandler cvsHandler=new CommandCvsHandler(CvsBundle.message("operation.name.restore"),operation,FileSetToBeUpdated.EMPTY);
  operation.addFinishAction(new Runnable(){
    public void run(){
      final List<VcsException> errors=cvsHandler.getErrors();
      if (errors != null && (!errors.isEmpty()))       return;
      if (entry != null) {
        entry.setRevision(revision);
        entry.setConflict(CvsUtil.formatDate(new Date(ioFile.lastModified())));
        try {
          CvsUtil.saveEntryForFile(ioFile,entry);
        }
 catch (        IOException e) {
          LOG.error(e);
        }
        CvsEntriesManager.getInstance().clearCachedEntriesFor(parent);
      }
    }
  }
);
  return cvsHandler;
}
