{
  AddFilesOperation operation=new AddFilesOperation();
  ArrayList<AddedFileInfo> addedFileInfo=new ArrayList<AddedFileInfo>();
  for (Iterator each=addedRoots.iterator(); each.hasNext(); ) {
    AddedFileInfo info=(AddedFileInfo)each.next();
    info.clearAllCvsAdminDirectoriesInIncludedDirectories();
    addedFileInfo.addAll(info.collectAllIncludedFiles());
  }
  ArrayList<VirtualFile> addedFiles=new ArrayList<VirtualFile>();
  for (Iterator<AddedFileInfo> iterator=addedFileInfo.iterator(); iterator.hasNext(); ) {
    AddedFileInfo info=iterator.next();
    addedFiles.add(info.getFile());
    operation.addFile(info.getFile(),info.getKeywordSubstitution());
  }
  return new CommandCvsHandler("Add",operation,FileSetToBeUpdated.selectedFiles(addedFiles.toArray(new VirtualFile[addedFiles.size()])));
}
