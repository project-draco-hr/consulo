{
  final FacetTypeId typeId=facet.getTypeId();
  WeakHashMap<Facet,Boolean> facets=myFacetsByType.get(typeId);
  if (facets == null) {
    facets=new WeakHashMap<Facet,Boolean>();
    myFacetsByType.put(typeId,facets);
  }
  boolean firstFacet=facets.isEmpty();
  facets.put(facet,true);
  final EventDispatcher<ProjectWideFacetListener> dispatcher=myDispatchers.get(typeId);
  if (dispatcher != null) {
    if (firstFacet) {
      dispatcher.getMulticaster().firstFacetAdded();
    }
    dispatcher.getMulticaster().facetAdded(facet);
  }
}
