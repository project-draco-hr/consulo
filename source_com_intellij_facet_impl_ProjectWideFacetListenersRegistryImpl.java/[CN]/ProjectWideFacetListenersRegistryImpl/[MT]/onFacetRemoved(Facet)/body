{
  final FacetTypeId typeId=facet.getTypeId();
  Integer count=myFacetCounts.get(typeId);
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    if (count == null || count <= 0)     count=1;
  }
  LOG.assertTrue(count != null);
  count--;
  boolean lastFacet=count == 0;
  myFacetCounts.put(typeId,count);
  final EventDispatcher<ProjectWideFacetListener> dispatcher=myDispatchers.get(typeId);
  if (dispatcher != null) {
    dispatcher.getMulticaster().facetRemoved(facet);
    if (lastFacet) {
      dispatcher.getMulticaster().allFacetsRemoved();
    }
  }
}
