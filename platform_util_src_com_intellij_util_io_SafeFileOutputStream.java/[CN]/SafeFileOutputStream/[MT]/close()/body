{
  try {
    myBackDoorStream.close();
  }
 catch (  IOException e) {
    LOG.warn(e);
    FileUtil.delete(backdoorFile());
    throw e;
  }
  final int permissions=myPreserveAttributes ? FileSystemUtil.getPermissions(myTargetFile) : -1;
  if (failed || !FileUtil.delete(myTargetFile)) {
    throw new IOException("Failed to save to " + myTargetFile + ". No data were harmed. Attempt result left at "+ backdoorFile());
  }
  FileUtil.rename(backdoorFile(),myTargetFile);
  if (permissions != -1) {
    FileSystemUtil.setPermissions(myTargetFile,permissions);
  }
}
