{
class Listener extends FileDocumentManagerAdapter implements ProjectEx.ProjectSaved {
    @Override public void beforeDocumentSaving(    @NotNull Document document){
      if (document == myConsole.getEditorDocument()) {
        saveHistory();
      }
    }
    @Override public void saved(    @NotNull Project project){
      saveHistory();
    }
  }
  Listener listener=new Listener();
  ApplicationManager.getApplication().getMessageBus().connect(myConsole).subscribe(ProjectEx.ProjectSaved.TOPIC,listener);
  myConsole.getProject().getMessageBus().connect(myConsole).subscribe(AppTopics.FILE_DOCUMENT_SYNC,listener);
  myConsole.getVirtualFile().putUserData(CONTROLLER_KEY,this);
  Disposer.register(myConsole,new Disposable(){
    @Override public void dispose(){
      myConsole.getVirtualFile().putUserData(CONTROLLER_KEY,null);
      saveHistory();
    }
  }
);
  if (myHelper.getModel().getHistorySize() == 0) {
    loadHistory(myHelper.getId());
  }
  configureActions();
  myLastSaveStamp=getCurrentTimeStamp();
}
