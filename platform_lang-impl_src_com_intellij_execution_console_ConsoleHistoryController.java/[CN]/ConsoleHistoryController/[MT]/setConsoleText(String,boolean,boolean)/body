{
  final Editor editor=myConsole.getCurrentEditor();
  final Document document=editor.getDocument();
  new WriteCommandAction(myConsole.getProject(),myConsole.getFile()){
    protected void run(    final Result result) throws Throwable {
      if (storeUserText) {
        myUserValue=document.getText();
      }
      document.setText(StringUtil.notNullize(command));
      editor.getCaretModel().moveToOffset(scrollToEnd ? document.getTextLength() : 0);
      editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
    }
  }
.execute();
}
