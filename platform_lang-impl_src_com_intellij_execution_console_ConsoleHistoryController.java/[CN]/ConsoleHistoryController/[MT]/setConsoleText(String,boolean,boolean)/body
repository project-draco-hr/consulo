{
  final Editor editor=myConsole.getCurrentEditor();
  final Document document=editor.getDocument();
  new WriteCommandAction.Simple(myConsole.getProject()){
    @Override public void run(){
      if (storeUserText) {
        myUserValue=document.getText();
      }
      if (regularMode) {
        document.setText(StringUtil.notNullize(command));
      }
 else {
        try {
          document.putUserData(UndoConstants.DONT_RECORD_UNDO,Boolean.TRUE);
          document.setText(StringUtil.notNullize(command));
        }
  finally {
          document.putUserData(UndoConstants.DONT_RECORD_UNDO,null);
        }
      }
      editor.getCaretModel().moveToOffset(regularMode ? document.getTextLength() : 0);
      editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
    }
  }
.execute();
}
