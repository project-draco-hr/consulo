{
  if (regularMode && myMultiline && StringUtil.isEmptyOrSpaces(command))   return;
  final Editor editor=myConsole.getCurrentEditor();
  final Document document=editor.getDocument();
  new WriteCommandAction.Simple(myConsole.getProject()){
    @Override public void run(){
      if (storeUserText) {
        String text=document.getText();
        if (Comparing.equal(command,text) && myHelper.getContent() != null)         return;
        myHelper.setContent(text);
      }
      String text=StringUtil.notNullize(command);
      int offset;
      if (regularMode) {
        if (myMultiline) {
          offset=insertTextMultiline(text,editor,document);
        }
 else {
          document.setText(text);
          offset=document.getTextLength();
        }
      }
 else {
        offset=0;
        try {
          document.putUserData(UndoConstants.DONT_RECORD_UNDO,Boolean.TRUE);
          document.setText(text);
        }
  finally {
          document.putUserData(UndoConstants.DONT_RECORD_UNDO,null);
        }
      }
      editor.getCaretModel().moveToOffset(offset);
      editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
    }
  }
.execute();
}
