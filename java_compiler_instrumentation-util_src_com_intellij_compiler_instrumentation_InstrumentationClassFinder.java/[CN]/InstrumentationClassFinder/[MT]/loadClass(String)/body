{
  final String internalName=name.replace('.','/');
  final PseudoClass aClass=myLoaded.get(internalName);
  if (aClass != null) {
    return aClass;
  }
  InputStream is=null;
  final String resourceName=internalName + CLASS_RESOURCE_EXTENSION;
  Resource resource=myPlatformClasspath.getResource(resourceName,false);
  if (resource != null) {
    is=resource.getInputStream();
  }
  if (is == null) {
    is=lookupClassBeforeClasspath(internalName);
  }
  if (is == null) {
    resource=myClasspath.getResource(resourceName,false);
    if (resource != null) {
      is=resource.getInputStream();
    }
  }
  if (is == null) {
    is=lookupClassAfterClasspath(internalName);
  }
  if (is == null) {
    throw new ClassNotFoundException("Class not found: " + internalName);
  }
  try {
    final PseudoClass result=loadPseudoClass(is);
    myLoaded.put(internalName,result);
    return result;
  }
  finally {
    is.close();
  }
}
