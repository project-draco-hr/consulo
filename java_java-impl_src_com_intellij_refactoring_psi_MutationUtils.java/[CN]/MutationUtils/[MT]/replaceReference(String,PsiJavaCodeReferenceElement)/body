{
  final PsiManager mgr=reference.getManager();
  final Project project=mgr.getProject();
  final PsiElementFactory factory=JavaPsiFacade.getInstance(mgr.getProject()).getElementFactory();
  final GlobalSearchScope scope=GlobalSearchScope.allScope(project);
  final PsiJavaCodeReferenceElement newReference=factory.createReferenceElementByFQClassName(className,scope);
  final PsiElement insertedElement=reference.replace(newReference);
  final CodeStyleManager codeStyleManager=CodeStyleManager.getInstance(mgr.getProject());
  final PsiElement shortenedElement=JavaCodeStyleManager.getInstance(mgr.getProject()).shortenClassReferences(insertedElement);
  codeStyleManager.reformat(shortenedElement);
}
