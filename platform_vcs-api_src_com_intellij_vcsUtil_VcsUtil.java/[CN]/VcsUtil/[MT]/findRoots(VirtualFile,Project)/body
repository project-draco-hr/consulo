{
  if (!rootDir.isDirectory()) {
    throw new IllegalArgumentException("Can't find VCS at the target file system path. Reason: expected to find a directory there but it's not. The path: " + rootDir.getParent());
  }
  Collection<VcsRoot> roots=ServiceManager.getService(project,VcsRootDetector.class).detect(rootDir);
  Collection<VcsDirectoryMapping> result=ContainerUtilRt.newArrayList();
  for (  VcsRoot vcsRoot : roots) {
    VirtualFile vFile=vcsRoot.getPath();
    AbstractVcs rootVcs=vcsRoot.getVcs();
    if (rootVcs != null && vFile != null) {
      result.add(new VcsDirectoryMapping(vFile.getPath(),rootVcs.getName()));
    }
  }
  return result;
}
