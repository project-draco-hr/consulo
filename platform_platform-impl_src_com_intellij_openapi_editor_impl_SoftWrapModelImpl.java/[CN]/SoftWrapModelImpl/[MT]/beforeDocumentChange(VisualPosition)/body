{
  List<TextChange> softWraps=myStorage.getSoftWraps();
  LogicalPosition logicalPosition=myEditor.visualToLogicalPosition(visualPosition);
  int offset=myEditor.logicalPositionToOffset(logicalPosition);
  int i=myStorage.getSoftWrapIndex(offset);
  if (i < 0 || i >= softWraps.size()) {
    return;
  }
  TextChange softWrap=softWraps.get(i);
  VisualPosition visualCaretPosition=myEditor.getCaretModel().getVisualPosition();
  if (!visualPosition.equals(myEditor.offsetToVisualPosition(offset))) {
    myEditor.getDocument().replaceString(softWrap.getStart(),softWrap.getEnd(),softWrap.getText());
  }
  myEditor.getCaretModel().moveToVisualPosition(visualCaretPosition);
  myStorage.removeByIndex(i);
}
