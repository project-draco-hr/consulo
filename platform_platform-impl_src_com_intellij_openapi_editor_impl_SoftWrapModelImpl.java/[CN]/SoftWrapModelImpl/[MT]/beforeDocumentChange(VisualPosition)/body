{
  LogicalPosition logicalPosition=myEditor.visualToLogicalPosition(visualPosition);
  int offset=myEditor.logicalPositionToOffset(logicalPosition);
  int i=getSoftWrapIndex(offset);
  if (i < 0 || i >= myWraps.size()) {
    return;
  }
  TextChange softWrap=myWraps.get(i);
  VisualPosition visualCaretPosition=myEditor.getCaretModel().getVisualPosition();
  if (!visualPosition.equals(myEditor.offsetToVisualPosition(offset))) {
    myEditor.getDocument().replaceString(softWrap.getStart(),softWrap.getEnd(),softWrap.getText());
  }
  myEditor.getCaretModel().moveToVisualPosition(visualCaretPosition);
  myWraps.remove(i);
}
