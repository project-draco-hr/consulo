{
  int softWrapIndex=getSoftWrapIndex(change.getStart());
  if (softWrapIndex < 0) {
    softWrapIndex=-softWrapIndex - 1;
  }
  Document document=myEditor.getDocument();
  if (softWrapIndex >= myWraps.size() || document.getTextLength() <= 0) {
    return;
  }
  int firstChangedLine=document.getLineNumber(change.getStart());
  int lastChangedLine=Math.max(document.getLineNumber(change.getEnd()),firstChangedLine + StringUtil.countNewLines(change.getText()));
  for (int i=firstChangedLine; i <= lastChangedLine; i++) {
    myDirtyLines.add(i);
  }
  List<TextChange> modified=myWraps.subList(softWrapIndex,myWraps.size());
  List<TextChange> toModify=new ArrayList<TextChange>(modified);
  modified.clear();
  for (  TextChange softWrap : toModify) {
    myWraps.add(softWrap.advance(change.getDiff()));
  }
}
