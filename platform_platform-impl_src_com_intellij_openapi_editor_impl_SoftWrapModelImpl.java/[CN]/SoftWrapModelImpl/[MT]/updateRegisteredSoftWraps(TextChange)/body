{
  List<TextChange> softWraps=myStorage.getSoftWraps();
  int softWrapIndex=myStorage.getSoftWrapIndex(change.getStart());
  if (softWrapIndex < 0) {
    softWrapIndex=-softWrapIndex - 1;
  }
  Document document=myEditor.getDocument();
  if (softWrapIndex >= softWraps.size() || document.getTextLength() <= 0) {
    return;
  }
  int firstChangedLine=document.getLineNumber(change.getStart());
  int lastChangedLine=Math.max(document.getLineNumber(change.getEnd()),firstChangedLine + StringUtil.countNewLines(change.getText()));
  for (int i=firstChangedLine; i <= lastChangedLine; i++) {
    myDirtyLines.add(i);
  }
  List<TextChange> toModify=new ArrayList<TextChange>(softWraps.subList(softWrapIndex,softWraps.size()));
  myStorage.removeInRange(softWrapIndex,softWraps.size());
  for (  TextChange softWrap : toModify) {
    softWraps.add(softWrap.advance(change.getDiff()));
  }
}
