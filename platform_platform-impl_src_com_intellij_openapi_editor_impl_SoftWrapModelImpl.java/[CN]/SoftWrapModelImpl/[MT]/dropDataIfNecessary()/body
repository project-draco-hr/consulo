{
  if (!myEditor.isUnderRepainting()) {
    return;
  }
  if (myDataIsDirty) {
    myDataIsDirty=false;
    myDirtyLines.clear();
    myStorage.removeAll();
    return;
  }
  Document document=myEditor.getDocument();
  for (TIntIterator it=myDirtyLines.iterator(); it.hasNext(); ) {
    int line=it.next();
    int start=document.getLineStartOffset(line);
    int end=document.getLineEndOffset(line);
    myStorage.removeInRange(start,end);
  }
  myDirtyLines.clear();
}
