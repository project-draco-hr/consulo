{
  if (!myEditor.isUnderRepainting()) {
    return;
  }
  Document document=myEditor.getDocument();
  for (TIntIterator it=myDirtyLines.iterator(); it.hasNext(); ) {
    int line=it.next();
    int start=document.getLineStartOffset(line);
    int end=document.getLineEndOffset(line);
    int startIndex=getSoftWrapIndex(start);
    if (startIndex < 0) {
      startIndex=-startIndex - 1;
    }
    int endIndex=startIndex;
    for (; endIndex < myWraps.size(); endIndex++) {
      TextChange softWrap=myWraps.get(endIndex);
      if (softWrap.getStart() >= end) {
        break;
      }
    }
    myWraps.subList(startIndex,endIndex).clear();
  }
  myDirtyLines.clear();
  if (!myDataIsDirty) {
    return;
  }
  myDataIsDirty=false;
  myWraps.clear();
}
