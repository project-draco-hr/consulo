{
  if (!softWrapAware) {
    return;
  }
  try {
    for (    FoldRegion region : myDeferredFoldRegions) {
      FoldRegion outerRegion=myEditor.getFoldingModel().getCollapsedRegionAtOffset(region.getStartOffset());
      if (outerRegion != null && outerRegion != region && outerRegion.getStartOffset() <= region.getStartOffset() && outerRegion.getEndOffset() >= region.getEndOffset()) {
        continue;
      }
      for (      FoldingListener listener : myFoldListeners) {
        listener.onFoldRegionStateChange(region);
      }
    }
  }
  finally {
    myDeferredFoldRegions.clear();
  }
  for (  FoldingListener listener : myFoldListeners) {
    listener.onFoldProcessingEnd();
  }
}
