{
  myEditor=editor;
  myStorage=storage;
  myPainter=painter;
  myApplianceManager=applianceManager;
  myDataMapper=dataMapper;
  myFoldBasedApplianceStrategy=new SoftWrapFoldBasedApplianceStrategy(editor);
  myVisualSizeManager=new SoftWrapAwareVisualSizeManager(painter);
  myDocumentListeners.add(myApplianceManager);
  myFoldListeners.add(myApplianceManager);
  applianceManager.addListener(myVisualSizeManager);
  applianceManager.addListener(new SoftWrapAwareDocumentParsingListenerAdapter(){
    @Override public void recalculationEnds(){
      for (      SoftWrapChangeListener listener : mySoftWrapListeners) {
        listener.recalculationEnds();
      }
    }
  }
);
  EditorSettings settings=myEditor.getSettings();
  myUseSoftWraps=settings.isUseSoftWraps();
  editor.addPropertyChangeListener(this);
  ApplicationManager.getApplication().getMessageBus().connect(this).subscribe(DocumentBulkUpdateListener.TOPIC,this);
}
