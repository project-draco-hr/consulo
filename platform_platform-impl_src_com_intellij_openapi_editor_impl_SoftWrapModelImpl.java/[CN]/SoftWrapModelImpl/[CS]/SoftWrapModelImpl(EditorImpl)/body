{
  myEditor=editor;
  myStorage=new SoftWrapsStorage();
  myPainter=new CompositeSoftWrapPainter(editor);
  myEditorTextRepresentationHelper=new DefaultEditorTextRepresentationHelper(editor);
  myDataMapper=new CachingSoftWrapDataMapper(editor,myStorage);
  myApplianceManager=new SoftWrapApplianceManager(myStorage,editor,myPainter,myDataMapper);
  myVisualSizeManager=new SoftWrapAwareVisualSizeManager(myPainter);
  myApplianceManager.addListener(myVisualSizeManager);
  myApplianceManager.addListener(new SoftWrapAwareDocumentParsingListenerAdapter(){
    @Override public void recalculationEnds(){
      for (      SoftWrapChangeListener listener : mySoftWrapListeners) {
        listener.recalculationEnds();
      }
    }
  }
);
  myUseSoftWraps=areSoftWrapsEnabledInEditor();
  myEditor.getColorsScheme().getFontPreferences().copyTo(myFontPreferences);
  editor.addPropertyChangeListener(this,this);
  myApplianceManager.addListener(myDataMapper);
  myEditor.getInlayModel().addListener(this,this);
}
