def before(self):
    self.tmppath = tempfile.mkdtemp(prefix=(('convert-' + os.path.basename(self.path)) + '-'))
    (output, status) = self.run('init', repodir=self.tmppath)
    self.checkexit(status)
    tree = self.xml('changes', xml_output=True, summary=True, repodir=self.path)
    tagname = None
    child = None
    for elt in tree.findall('patch'):
        node = elt.get('hash')
        name = elt.findtext('name', '')
        if name.startswith('TAG '):
            tagname = name[4:].strip()
        elif (tagname is not None):
            self.tags[tagname] = node
            tagname = None
        self.changes[node] = elt
        self.parents[child] = [node]
        child = node
    self.parents[child] = []
