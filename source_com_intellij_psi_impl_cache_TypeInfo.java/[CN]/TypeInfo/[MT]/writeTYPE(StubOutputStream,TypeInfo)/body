{
  if (typeInfo == NULL) {
    dataStream.writeByte(NULL_FLAGS);
    return;
  }
  boolean isEllipsis=typeInfo.isEllipsis;
  String text=typeInfo.text.getString();
  byte arrayCount=typeInfo.arrayCount;
  int frequentIndex=ourFrequentTypeIndex.get(text);
  LOG.assertTrue(frequentIndex < 15,frequentIndex);
  List<PsiAnnotationStub> annotations=typeInfo.myAnnotationStubs;
  boolean annotationsArePresent=!annotations.isEmpty();
  int flags=((isEllipsis ? 1 : 0) << 6) | ((arrayCount == 0 ? 0 : 1) << 5) | ((annotationsArePresent ? 1 : 0) << 4)| frequentIndex;
  dataStream.writeByte(flags);
  if (arrayCount != 0) {
    dataStream.writeByte(arrayCount);
  }
  if (frequentIndex == 0) {
    dataStream.writeName(text);
  }
  if (annotationsArePresent) {
    LOG.assertTrue(annotations.size() < 256,annotations.size());
    dataStream.writeByte(annotations.size());
    for (    PsiAnnotationStub annotation : annotations) {
      dataStream.writeUTFFast(annotation.getText());
    }
  }
}
