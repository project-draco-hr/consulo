{
  if (type == null)   return null;
  final boolean isEllipsis=type instanceof PsiEllipsisType;
  int arrayCount=type.getArrayDimensions();
  final String text;
  if (typeElement != null) {
    while (typeElement.getFirstChild() instanceof PsiTypeElement) {
      typeElement=(PsiTypeElement)typeElement.getFirstChild();
    }
    text=typeElement instanceof PsiCompiledElement ? ((ClsTypeElementImpl)typeElement).getCanonicalText() : typeElement.getText();
  }
 else {
    type=type.getDeepComponentType();
    text=type.getInternalCanonicalText();
  }
  return new TypeInfo(StringRef.fromString(text),(byte)arrayCount,isEllipsis);
}
