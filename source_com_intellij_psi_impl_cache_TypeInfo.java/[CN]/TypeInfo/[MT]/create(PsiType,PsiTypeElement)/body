{
  if (type == null)   return null;
  final boolean isEllipsis=type instanceof PsiEllipsisType;
  int arrayCount=type.getArrayDimensions();
  final String text;
  if (typeElement != null) {
    while (typeElement.getFirstChild() instanceof PsiTypeElement) {
      typeElement=(PsiTypeElement)typeElement.getFirstChild();
    }
    text=typeElement instanceof PsiCompiledElement ? ((ClsTypeElementImpl)typeElement).getCanonicalText() : typeElement.getText();
  }
 else {
    type=type.getDeepComponentType();
    text=type.getInternalCanonicalText();
  }
  TypeInfo result=new TypeInfo();
  result.text=StringRef.fromString(text);
  result.arrayCount=(byte)arrayCount;
  result.isEllipsis=isEllipsis;
  return result;
}
