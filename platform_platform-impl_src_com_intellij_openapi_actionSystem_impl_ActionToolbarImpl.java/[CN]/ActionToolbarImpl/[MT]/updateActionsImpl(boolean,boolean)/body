{
  List<AnAction> newVisibleActions=ContainerUtil.newArrayListWithCapacity(myVisibleActions.size());
  DataContext dataContext=getDataContext();
  Utils.expandActionGroup(myActionGroup,newVisibleActions,myPresentationFactory,dataContext,myPlace,myActionManager,transparentOnly);
  if (forced || !newVisibleActions.equals(myVisibleActions)) {
    boolean shouldRebuildUI=newVisibleActions.isEmpty() || myVisibleActions.isEmpty();
    myVisibleActions=newVisibleActions;
    Dimension oldSize=getPreferredSize();
    removeAll();
    mySecondaryActions.removeAll();
    mySecondaryActionsButton=null;
    fillToolBar(myVisibleActions,getLayoutPolicy() == AUTO_LAYOUT_POLICY && myOrientation == SwingConstants.HORIZONTAL);
    Dimension newSize=getPreferredSize();
    ((WindowManagerEx)WindowManager.getInstance()).adjustContainerWindow(this,oldSize,newSize);
    if (shouldRebuildUI) {
      revalidate();
    }
 else {
      Container parent=getParent();
      if (parent != null) {
        parent.invalidate();
        parent.validate();
      }
    }
    repaint();
  }
}
