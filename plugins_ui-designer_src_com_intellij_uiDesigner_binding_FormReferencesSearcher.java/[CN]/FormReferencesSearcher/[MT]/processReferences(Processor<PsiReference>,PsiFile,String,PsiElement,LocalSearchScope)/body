{
  CharSequence chars=ApplicationManager.getApplication().runReadAction(new NullableComputable<CharSequence>(){
    public CharSequence compute(){
      if (filterScope != null) {
        boolean isInScope=false;
        for (        PsiElement filterElement : filterScope.getScope()) {
          if (PsiTreeUtil.isAncestor(filterElement,file,false)) {
            isInScope=true;
            break;
          }
        }
        if (!isInScope)         return null;
      }
      return file.getViewProvider().getContents();
    }
  }
);
  if (chars == null)   return true;
  int index=0;
  final int offset=name.lastIndexOf('.');
  while (true) {
    index=CharArrayUtil.indexOf(chars,name,index);
    if (index < 0)     break;
    final PsiReference ref=file.findReferenceAt(index + offset + 1);
    if (ref != null) {
      final boolean isReferenceTo=ApplicationManager.getApplication().runReadAction(new Computable<Boolean>(){
        public Boolean compute(){
          return ref.isReferenceTo(element);
        }
      }
).booleanValue();
      if (isReferenceTo) {
        if (!processor.process(ref))         return false;
      }
    }
    index++;
  }
  return true;
}
