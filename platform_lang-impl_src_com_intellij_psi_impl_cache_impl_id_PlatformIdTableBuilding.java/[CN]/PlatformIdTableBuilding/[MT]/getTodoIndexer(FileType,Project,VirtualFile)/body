{
  final DataIndexer<TodoIndexEntry,Integer,FileContent> indexer=ourTodoIndexers.get(fileType);
  if (indexer != null) {
    return indexer;
  }
  final DataIndexer<TodoIndexEntry,Integer,FileContent> extIndexer;
  if (fileType instanceof SubstitutedFileType) {
    SubstitutedFileType sft=(SubstitutedFileType)fileType;
    extIndexer=new CompositeTodoIndexer(getTodoIndexer(sft.getOriginalFileType(),project,virtualFile),getTodoIndexer(sft.getFileType(),project,virtualFile));
  }
 else {
    extIndexer=TodoIndexers.INSTANCE.forFileType(fileType);
  }
  if (extIndexer != null) {
    return extIndexer;
  }
  if (fileType instanceof LanguageFileType) {
    final Language lang=((LanguageFileType)fileType).getLanguage();
    final ParserDefinition parserDef=LanguageParserDefinitions.INSTANCE.forLanguage(lang);
    final TokenSet commentTokens=parserDef != null ? parserDef.getCommentTokens(LanguageVersionUtil.findLanguageVersion(lang,project,virtualFile)) : null;
    if (commentTokens != null) {
      return new TokenSetTodoIndexer(commentTokens,virtualFile,project);
    }
  }
  if (fileType instanceof CustomSyntaxTableFileType) {
    return new TokenSetTodoIndexer(ABSTRACT_FILE_COMMENT_TOKENS,virtualFile,project);
  }
  return null;
}
