{
  ChangesBrowserNode baseNode=ChangesBrowserNode.create(myProject,ChangesBrowserNode.SWITCHED_FILES_TAG);
  model.insertNodeInto(baseNode,root,root.getChildCount());
  for (  String branchName : switchedFiles.keySet()) {
    final Collection<VirtualFile> switchedFileList=switchedFiles.get(branchName);
    if (switchedFileList.size() > 0) {
      ChangesBrowserNode branchNode=ChangesBrowserNode.create(myProject,branchName);
      model.insertNodeInto(branchNode,baseNode,baseNode.getChildCount());
      final HashMap<String,ChangesBrowserNode> foldersCache=new HashMap<String,ChangesBrowserNode>();
      final ChangesGroupingPolicy policy=createGroupingPolicy();
      for (      VirtualFile file : switchedFileList) {
        insertChangeNode(file,foldersCache,policy,branchNode,defaultNodeCreator(file));
      }
    }
  }
}
