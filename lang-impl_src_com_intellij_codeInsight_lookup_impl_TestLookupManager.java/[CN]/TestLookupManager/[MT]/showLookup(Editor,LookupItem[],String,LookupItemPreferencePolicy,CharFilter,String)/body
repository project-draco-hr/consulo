{
  hideActiveLookup();
  final CodeInsightSettings settings=CodeInsightSettings.getInstance();
  items=(LookupItem[])items.clone();
  PsiFile psiFile=PsiDocumentManager.getInstance(myProject).getPsiFile(editor.getDocument());
  PsiElement context=psiFile;
  if (psiFile != null) {
    final PsiElement element=psiFile.findElementAt(editor.getCaretModel().getOffset());
    if (element != null) {
      context=element;
    }
  }
  sortItems(context,items,itemPreferencePolicy);
  myActiveLookup=new LookupImpl(myProject,editor,items,prefix,itemPreferencePolicy,filter,bottomText);
  myActiveLookupEditor=editor;
  ((LookupImpl)myActiveLookup).show();
  return myActiveLookup;
}
