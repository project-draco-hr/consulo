{
  final String presentableText=item.getPresentableText();
  if (presentableText != null) {
    return presentableText;
  }
  String name="";
  if (o instanceof PsiElement) {
    final PsiElement element=(PsiElement)o;
    if (element.isValid()) {
      if (element instanceof PsiKeyword || element instanceof PsiExpression || element instanceof PsiTypeElement) {
        name=element.getText();
      }
 else {
        name=PsiUtilBase.getName(element);
      }
    }
  }
 else   if (o instanceof PsiArrayType) {
    name=((PsiArrayType)o).getDeepComponentType().getPresentableText();
  }
 else   if (o instanceof PsiType) {
    name=((PsiType)o).getPresentableText();
  }
  if (item.getAttribute(LookupItem.FORCE_QUALIFY) != null) {
    if (o instanceof PsiMember && ((PsiMember)o).getContainingClass() != null) {
      name=((PsiMember)o).getContainingClass().getName() + "." + name;
    }
  }
  PsiSubstitutor substitutor=(PsiSubstitutor)item.getAttribute(LookupItem.SUBSTITUTOR);
  if (o instanceof PsiClass && substitutor != null) {
    final PsiClass psiClass=(PsiClass)o;
    final PsiTypeParameter[] params=psiClass.getTypeParameters();
    if (params.length > 0) {
      return name + formatTypeParameters(substitutor,params);
    }
  }
  return StringUtil.notNullize(name);
}
