{
  final String shortName=tool.getShortName();
  final HighlightDisplayKey key=HighlightDisplayKey.find(shortName);
  if (key == null) {
    HighlightDisplayKey.register(shortName);
  }
  globalContext.getTools().put(tool.getShortName(),new ToolsImpl(tool,tool.getDefaultLevel(),true));
  tool.initialize(globalContext);
  ((RefManagerImpl)globalContext.getRefManager()).initializeAnnotators();
  if (tool.isGraphNeeded()) {
    ((RefManagerImpl)tool.getRefManager()).findAllDeclarations();
  }
  ((ProgressManagerImpl)ProgressManager.getInstance()).executeProcessUnderProgress(new Runnable(){
    public void run(){
      tool.runInspection(scope,inspectionManager);
    }
  }
,new EmptyProgressIndicator());
  tool.queryExternalUsagesRequests(inspectionManager);
}
