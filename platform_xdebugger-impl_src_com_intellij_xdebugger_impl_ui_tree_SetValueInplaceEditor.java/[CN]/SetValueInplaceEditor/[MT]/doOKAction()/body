{
  if (myModifier == null)   return;
  myExpressionEditor.saveTextInHistory();
  final XDebuggerTreeState treeState=XDebuggerTreeState.saveState(myTree);
  myValueNode.setValueModificationStarted();
  myModifier.setValue(myExpressionEditor.getExpression().getExpression(),new XValueModifier.XModificationCallback(){
    @Override public void valueModified(){
      if (isDetachedTree(myTree)) {
        AppUIUtil.invokeOnEdt(new Runnable(){
          @Override public void run(){
            myTree.rebuildAndRestore(treeState);
          }
        }
);
      }
      XDebuggerUtilImpl.rebuildAllSessionsViews(getProject());
    }
    @Override public void errorOccurred(    @NotNull final String errorMessage){
      AppUIUtil.invokeOnEdt(new Runnable(){
        @Override public void run(){
          myTree.rebuildAndRestore(treeState);
          Editor editor=myExpressionEditor.getEditor();
          if (editor != null) {
            HintManager.getInstance().showErrorHint(editor,errorMessage);
          }
 else {
            Messages.showErrorDialog(myTree,errorMessage);
          }
        }
      }
);
      XDebuggerUtilImpl.rebuildAllSessionsViews(getProject());
    }
    boolean isDetachedTree(    XDebuggerTree tree){
      return XDebugSessionTab.TAB_KEY.getData(DataManager.getInstance().getDataContext(tree)) == null;
    }
  }
);
  super.doOKAction();
}
