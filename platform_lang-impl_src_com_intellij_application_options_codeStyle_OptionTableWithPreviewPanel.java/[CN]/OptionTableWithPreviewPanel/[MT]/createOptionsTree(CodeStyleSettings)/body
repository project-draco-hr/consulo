{
  DefaultMutableTreeNode rootNode=new DefaultMutableTreeNode();
  Map<String,DefaultMutableTreeNode> groupsMap=new THashMap<String,DefaultMutableTreeNode>();
  List<Option> sorted=sortOptions(ContainerUtil.concat(myOptions,myCustomOptions));
  for (  Option each : sorted) {
    if (!(myCustomOptions.contains(each) || myAllowedOptions.contains(each.field.getName()) || myShowAllStandardOptions))     continue;
    String group=each.groupName;
    MyTreeNode newNode=new MyTreeNode(each,each.title,settings);
    DefaultMutableTreeNode groupNode=groupsMap.get(group);
    if (groupNode != null) {
      groupNode.add(newNode);
    }
 else {
      String groupName;
      if (group == null) {
        groupName=each.title;
        groupNode=newNode;
      }
 else {
        groupName=group;
        groupNode=new DefaultMutableTreeNode(groupName);
        groupNode.add(newNode);
      }
      groupsMap.put(groupName,groupNode);
      rootNode.add(groupNode);
    }
  }
  ListTreeTableModel model=new ListTreeTableModel(rootNode,COLUMNS);
  TreeTable treeTable=new TreeTable(model){
    @Override public TreeTableCellRenderer createTableRenderer(    TreeTableModel treeTableModel){
      TreeTableCellRenderer tableRenderer=super.createTableRenderer(treeTableModel);
      UIUtil.setLineStyleAngled(tableRenderer);
      tableRenderer.setRootVisible(false);
      tableRenderer.setShowsRootHandles(true);
      return tableRenderer;
    }
    @Override public TableCellRenderer getCellRenderer(    int row,    int column){
      TreePath treePath=getTree().getPathForRow(row);
      if (treePath == null)       return super.getCellRenderer(row,column);
      Object node=treePath.getLastPathComponent();
      TableCellRenderer renderer=COLUMNS[column].getRenderer(node);
      return renderer == null ? super.getCellRenderer(row,column) : renderer;
    }
    @Override public TableCellEditor getCellEditor(    int row,    int column){
      TreePath treePath=getTree().getPathForRow(row);
      if (treePath == null)       return super.getCellEditor(row,column);
      Object node=treePath.getLastPathComponent();
      TableCellEditor editor=COLUMNS[column].getEditor(node);
      return editor == null ? super.getCellEditor(row,column) : editor;
    }
  }
;
  new TreeTableSpeedSearch(treeTable).setComparator(new SpeedSearchComparator(false));
  treeTable.setRootVisible(false);
  final JTree tree=treeTable.getTree();
  tree.setCellRenderer(myTitleRenderer);
  tree.setShowsRootHandles(true);
  treeTable.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
  treeTable.setTableHeader(null);
  expandTree(tree);
  int maxWidth=tree.getPreferredScrollableViewportSize().width + 10;
  final TableColumn titleColumn=treeTable.getColumnModel().getColumn(0);
  titleColumn.setPreferredWidth(maxWidth);
  titleColumn.setMinWidth(maxWidth);
  titleColumn.setMaxWidth(maxWidth);
  titleColumn.setResizable(false);
  final TableColumn levelColumn=treeTable.getColumnModel().getColumn(1);
  final Dimension valueSize=new JLabel(ApplicationBundle.message("option.table.sizing.text")).getPreferredSize();
  treeTable.setPreferredScrollableViewportSize(new Dimension(maxWidth + valueSize.width + 10,20));
  return treeTable;
}
