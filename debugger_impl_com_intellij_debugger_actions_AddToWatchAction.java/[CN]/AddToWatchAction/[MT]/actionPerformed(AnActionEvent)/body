{
  DataContext context=DataManager.getInstance().getDataContext();
  if (context == null)   return;
  final DebuggerContextImpl debuggerContext=getDebuggerContext(context);
  if (debuggerContext == null)   return;
  final DebuggerSession session=debuggerContext.getDebuggerSession();
  if (session == null) {
    return;
  }
  final MainWatchPanel watchPanel=DebuggerPanelsManager.getInstance(debuggerContext.getProject()).getWatchPanel();
  if (watchPanel == null) {
    return;
  }
  final DebuggerTreeNodeImpl[] selectedNodes=getSelectedNodes(context);
  if (selectedNodes != null && selectedNodes.length > 0) {
    addFromNodes(debuggerContext,watchPanel,selectedNodes);
  }
 else {
    final Editor editor=(Editor)context.getData(DataKeys.EDITOR.getName());
    if (editor != null) {
      final TextWithImports editorText=DebuggerUtilsEx.getEditorText(editor);
      if (editorText != null) {
        doAddWatch(watchPanel,editorText,null);
      }
    }
  }
}
