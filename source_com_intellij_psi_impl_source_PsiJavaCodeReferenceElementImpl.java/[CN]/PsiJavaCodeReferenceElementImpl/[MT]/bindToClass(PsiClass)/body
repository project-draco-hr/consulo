{
  String qName=aClass.getQualifiedName();
  if (qName == null) {
    qName=aClass.getName();
    final PsiClass psiClass=getManager().getResolveHelper().resolveReferencedClass(qName,this);
    if (!getManager().areElementsEquivalent(psiClass,aClass)) {
      throw new IncorrectOperationException();
    }
  }
 else {
    if (getManager().findClass(qName,getResolveScope()) == null) {
      return this;
    }
  }
  final boolean preserveQualification=CodeStyleSettingsManager.getSettings(getProject()).USE_FQ_CLASS_NAMES && isFullyQualified();
  final PsiManager manager=aClass.getManager();
  ASTNode ref=Parsing.parseJavaCodeReferenceText(manager,qName + getParameterList().getText(),SharedImplUtil.findCharTableByTree(this));
  getTreeParent().replaceChildInternal(this,(TreeElement)ref);
  if (!preserveQualification) {
    final CodeStyleManagerEx codeStyleManager=(CodeStyleManagerEx)manager.getCodeStyleManager();
    ref=SourceTreeToPsiMap.psiElementToTree(codeStyleManager.shortenClassReferences(SourceTreeToPsiMap.treeElementToPsi(ref),CodeStyleManagerEx.UNCOMPLETE_CODE));
  }
  return SourceTreeToPsiMap.treeElementToPsi(ref);
}
