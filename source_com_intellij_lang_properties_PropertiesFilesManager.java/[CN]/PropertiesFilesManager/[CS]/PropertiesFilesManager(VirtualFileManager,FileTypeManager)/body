{
  myVirtualFileManager=virtualFileManager;
  myFileTypeManager=fileTypeManager;
  myVirtualFileListener=new VirtualFileAdapter(){
    public void fileCreated(    VirtualFileEvent event){
      addNewFile(event);
    }
    public void fileDeleted(    VirtualFileEvent event){
      removeOldFile(event);
    }
    public void fileMoved(    VirtualFileMoveEvent event){
      removeOldFile(event);
      addNewFile(event);
    }
    public void propertyChanged(    VirtualFilePropertyEvent event){
      VirtualFile file=event.getFile();
      fileChanged(file,event);
    }
    public void contentsChanged(    VirtualFileEvent event){
      VirtualFile file=event.getFile();
      fileChanged(file,null);
    }
  }
;
  EditorSettingsExternalizable.getInstance().addPropertyChangeListener(new PropertyChangeListener(){
    public void propertyChange(    final PropertyChangeEvent evt){
      if (evt.getPropertyName().equals(EditorSettingsExternalizable.PROP_NATIVE2ASCII)) {
        encodingChanged();
      }
    }
  }
);
}
