{
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          if (ApplicationManager.getApplication().isDisposed())           return;
          Collection<VirtualFile> filesToRefresh=new THashSet<VirtualFile>(getAllPropertiesFiles());
          VirtualFile[] virtualFiles=filesToRefresh.toArray(new VirtualFile[filesToRefresh.size()]);
          FileDocumentManager.getInstance().saveAllDocuments();
          for (          VirtualFile virtualFile : virtualFiles) {
            virtualFile.setCharset(null);
          }
          FileDocumentManager.getInstance().reloadFiles(virtualFiles);
        }
      }
);
    }
  }
,ModalityState.NON_MODAL);
}
