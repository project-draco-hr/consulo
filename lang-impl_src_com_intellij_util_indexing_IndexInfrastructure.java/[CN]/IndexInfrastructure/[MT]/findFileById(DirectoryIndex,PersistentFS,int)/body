{
  if (ourUnitTestMode) {
    final VirtualFile testFile=findTestFile(id);
    if (testFile != null) {
      return testFile;
    }
  }
  final boolean isDirectory=fs.isDirectory(id);
  final DirectoryInfo directoryInfo=isDirectory ? dirIndex.getInfoForDirectoryId(id) : dirIndex.getInfoForDirectoryId(fs.getParent(id));
  if (directoryInfo != null && (directoryInfo.contentRoot != null || directoryInfo.sourceRoot != null)) {
    return isDirectory ? directoryInfo.directory : directoryInfo.directory.findChild(fs.getName(id));
  }
  return null;
}
