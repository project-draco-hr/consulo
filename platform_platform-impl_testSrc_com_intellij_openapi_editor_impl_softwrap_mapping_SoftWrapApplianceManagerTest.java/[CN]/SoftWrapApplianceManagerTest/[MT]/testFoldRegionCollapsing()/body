{
  String text="class Test {\n" + "    public void foo() {\n" + "        System.out.println(\"test\");\n"+ "    }\n"+ "}";
  init(300,text);
  final FoldingModel foldingModel=myEditor.getFoldingModel();
  assertEmpty(foldingModel.getAllFoldRegions());
  final int startOffset=text.indexOf('{');
  final int endOffset=text.indexOf('}') + 1;
  VisualPosition foldStartPosition=myEditor.offsetToVisualPosition(startOffset);
  foldingModel.runBatchFoldingOperation(new Runnable(){
    @Override public void run(){
      foldingModel.addFoldRegion(startOffset,endOffset,"...");
    }
  }
);
  final FoldRegion foldRegion=foldingModel.getAllFoldRegions()[0];
  assertNotNull(foldRegion);
  assertTrue(foldRegion.isExpanded());
  foldingModel.runBatchFoldingOperation(new Runnable(){
    @Override public void run(){
      foldRegion.setExpanded(false);
    }
  }
);
  assertEquals(foldStartPosition,myEditor.offsetToVisualPosition(startOffset + 5));
}
