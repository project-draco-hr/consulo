{
  List<MergeableLineMarkerInfo> forMerge=new ArrayList<MergeableLineMarkerInfo>();
  final Iterator<LineMarkerInfo> iterator=markers.iterator();
  while (iterator.hasNext()) {
    final LineMarkerInfo marker=iterator.next();
    if (marker instanceof MergeableLineMarkerInfo) {
      iterator.remove();
      forMerge.add((MergeableLineMarkerInfo)marker);
    }
  }
  if (forMerge.isEmpty() || myEditor == null)   return markers;
  final List<LineMarkerInfo> result=new ArrayList<LineMarkerInfo>(markers);
  TIntObjectHashMap<List<MergeableLineMarkerInfo>> sameLineMarkers=new TIntObjectHashMap<List<MergeableLineMarkerInfo>>();
  for (  MergeableLineMarkerInfo info : forMerge) {
    final LogicalPosition position=myEditor.offsetToLogicalPosition(info.startOffset);
    List<MergeableLineMarkerInfo> infos=sameLineMarkers.get(position.line);
    if (infos == null) {
      infos=new ArrayList<MergeableLineMarkerInfo>();
      sameLineMarkers.put(position.line,infos);
    }
    infos.add(info);
  }
  for (  Object v : sameLineMarkers.getValues()) {
    List<MergeableLineMarkerInfo> infos=(List<MergeableLineMarkerInfo>)v;
    result.addAll(MergeableLineMarkerInfo.merge(infos));
  }
  return result;
}
