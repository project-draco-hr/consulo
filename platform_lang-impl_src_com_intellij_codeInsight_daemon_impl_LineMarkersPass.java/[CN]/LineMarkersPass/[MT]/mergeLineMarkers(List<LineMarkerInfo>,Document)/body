{
  List<MergeableLineMarkerInfo> forMerge=new ArrayList<>();
  TIntObjectHashMap<List<MergeableLineMarkerInfo>> sameLineMarkers=new TIntObjectHashMap<>();
  for (int i=markers.size() - 1; i >= 0; i--) {
    LineMarkerInfo marker=markers.get(i);
    if (marker instanceof MergeableLineMarkerInfo) {
      MergeableLineMarkerInfo mergeable=(MergeableLineMarkerInfo)marker;
      forMerge.add(mergeable);
      markers.remove(i);
      int line=document.getLineNumber(marker.startOffset);
      List<MergeableLineMarkerInfo> infos=sameLineMarkers.get(line);
      if (infos == null) {
        infos=new ArrayList<>();
        sameLineMarkers.put(line,infos);
      }
      infos.add(mergeable);
    }
  }
  if (forMerge.isEmpty())   return markers;
  List<LineMarkerInfo> result=new ArrayList<>(markers);
  for (  Object v : sameLineMarkers.getValues()) {
    List<MergeableLineMarkerInfo> infos=(List<MergeableLineMarkerInfo>)v;
    result.addAll(MergeableLineMarkerInfo.merge(infos));
  }
  return result;
}
