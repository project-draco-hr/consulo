{
  final int stringsCount=5;
  Set<String> strings=new HashSet<String>(stringsCount);
  for (int i=0; i < stringsCount; ++i) {
    final String key=createRandomString();
    strings.add(key);
    myMap.put(key,key + "_value");
  }
  myMap.close();
  myMap=new PersistentHashMap<String,String>(myFile,new EnumeratorStringDescriptor(),new EnumeratorStringDescriptor());
{
    final Collection<String> allKeys=new HashSet<String>(myMap.getAllKeysWithExistingMapping());
    assertEquals(strings,allKeys);
    for (    String key : allKeys) {
      final String val=myMap.get(key);
      assertEquals(key + "_value",val);
    }
  }
  myMap.compact();
{
    final Collection<String> allKeys=new HashSet<String>(myMap.getAllKeysWithExistingMapping());
    assertEquals(strings,allKeys);
    for (    String key : allKeys) {
      final String val=myMap.get(key);
      assertEquals(key + "_value",val);
    }
  }
}
