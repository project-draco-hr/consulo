{
  List<String> strings=new ArrayList<String>(2000);
  for (int i=0; i < 2000; ++i) {
    strings.add(createRandomString());
  }
  for (int i=0; i < 2000; ++i) {
    final String key=strings.get(i);
    myMap.put(key,key + "_value");
    myMap.close();
    myMap=new PersistentHashMap<String,String>(myFile,new EnumeratorStringDescriptor(),new EnumeratorStringDescriptor());
  }
  for (int i=0; i < 2000; ++i) {
    final String key=strings.get(i);
    final String value=key + "_value";
    assertEquals(value,myMap.get(key));
    myMap.put(key,value);
    assertTrue(myMap.isDirty());
    myMap.close();
    myMap=new PersistentHashMap<String,String>(myFile,new EnumeratorStringDescriptor(),new EnumeratorStringDescriptor());
  }
  for (int i=0; i < 2000; ++i) {
    assertTrue(!myMap.isDirty());
    myMap.close();
    myMap=new PersistentHashMap<String,String>(myFile,new EnumeratorStringDescriptor(),new EnumeratorStringDescriptor());
  }
  final String randomKey=createRandomString();
  myMap.put(randomKey,randomKey + "_value");
  assertTrue(myMap.isDirty());
}
