{
  if (ApplicationManager.getApplication().isDispatchThread()) {
    return ModalityState.current();
  }
  final ProgressIndicator pi=ProgressManager.getInstance().getProgressIndicator();
  if (pi == null) {
    return ModalityState.defaultModalityState();
  }
  return pi.getModalityState();
}
