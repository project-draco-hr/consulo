{
  final Boolean[] saveOnce=new Boolean[1];
  final Runnable actualSave=new Runnable(){
    @Override public void run(){
      mySavePermissions.put(Boolean.TRUE.equals(saveOnce[0]));
      try {
        myPersistentAuthenticationProviderProxy.actualSavePermissions(realm,auth);
      }
  finally {
        mySavePermissions.remove();
      }
    }
  }
;
  if (myInteraction.promptInAwt()) {
    new AbstractCalledLater(myProject,getCurrent()){
      @Override public void run(){
        saveOnce[0]=Boolean.TRUE.equals(prompt.get());
        ApplicationManager.getApplication().executeOnPooledThread(actualSave);
      }
    }
.callMe();
  }
 else {
    saveOnce[0]=Boolean.TRUE.equals(prompt.get());
    actualSave.run();
  }
}
