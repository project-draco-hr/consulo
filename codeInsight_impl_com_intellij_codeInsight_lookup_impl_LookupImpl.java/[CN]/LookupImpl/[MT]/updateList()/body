{
  final PatternMatcher matcher=new Perl5Matcher();
  final Pattern pattern=CompletionUtil.createCamelHumpsMatcher(myPrefix);
  Object oldSelected=myList.getSelectedValue();
  DefaultListModel model=new DefaultListModel();
  ArrayList<LookupItem> array=new ArrayList<LookupItem>();
  final String prefix=myPrefix;
  for (  LookupItem item : myItems) {
    String text=item.getLookupString();
    if (StringUtil.startsWithIgnoreCase(text,prefix) || matcher.matches(text,pattern)) {
      model.addElement(item);
      array.add(item);
    }
  }
  boolean isEmpty=array.size() == 0;
  if (isEmpty) {
    LookupItem item=new LookupItem(CompletionBundle.message("completion.no.suggestions"),"");
    item.setAttribute(EMPTY_ITEM_ATTRIBUTE,"");
    model.addElement(item);
    array.add(item);
  }
  myList.setModel(model);
  myList.setVisibleRowCount(Math.min(myList.getModel().getSize(),CodeInsightSettings.getInstance().LOOKUP_HEIGHT));
  if (!isEmpty) {
    selectMostPreferableItem();
    if (myIndex >= 0) {
      ListScrollingUtil.selectItem(myList,myIndex);
    }
 else {
      if (oldSelected == null || !ListScrollingUtil.selectItem(myList,oldSelected)) {
        ListScrollingUtil.selectItem(myList,0);
      }
    }
  }
  LookupItem[] items=array.toArray(new LookupItem[array.size()]);
  int maxWidth=myCellRenderer.getMaximumWidth(items);
  myList.setFixedCellWidth(maxWidth);
}
