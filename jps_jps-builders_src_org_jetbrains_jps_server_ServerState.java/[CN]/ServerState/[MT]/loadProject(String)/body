{
  final Project project=new Project();
  final MethodClosure fakeClosure=new MethodClosure(new Object(),"hashCode");
  for (  GlobalLibrary library : myGlobalLibraries) {
    if (library instanceof SdkLibrary) {
      final SdkLibrary sdk=(SdkLibrary)library;
      Node additionalData=null;
      final String additionalXml=sdk.getAdditionalDataXml();
      if (additionalXml != null) {
        try {
          additionalData=new XmlParser(false,false).parseText(additionalXml);
        }
 catch (        Exception e) {
          LOG.info(e);
        }
      }
      final Sdk jdk=project.createSdk(sdk.getTypeName(),sdk.getName(),sdk.getHomePath(),additionalData);
      jdk.setClasspath(sdk.getPaths());
    }
 else {
      final Library lib=project.createGlobalLibrary(library.getName(),fakeClosure);
      lib.setClasspath(library.getPaths());
    }
  }
  final File projectFile=new File(projectPath);
  final String loadPath=isDirectoryBased(projectFile) ? new File(projectFile,IDEA_PROJECT_DIRNAME).getPath() : projectPath;
  IdeaProjectLoader.loadFromPath(project,loadPath,myPathVariables,getStartupScript());
  final String globalEncoding=myGlobalEncoding;
  if (globalEncoding != null && project.getProjectCharset() == null) {
    project.setProjectCharset(globalEncoding);
  }
  return project;
}
