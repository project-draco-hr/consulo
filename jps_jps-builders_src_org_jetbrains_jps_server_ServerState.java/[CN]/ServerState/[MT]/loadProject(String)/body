{
  final Project project=new Project();
  final MethodClosure fakeClosure=new MethodClosure(new Object(),"hashCode");
  for (  GlobalLibrary library : myGlobalLibraries) {
    if (library instanceof SdkLibrary) {
      final SdkLibrary sdk=(SdkLibrary)library;
      Node additionalData=null;
      final String additionalXml=sdk.getAdditionalDataXml();
      if (additionalXml != null) {
        try {
          additionalData=new XmlParser(false,false).parseText(additionalXml);
        }
 catch (        Exception e) {
          LOG.info(e);
        }
      }
      final Sdk jdk=project.createSdk(sdk.getTypeName(),sdk.getName(),sdk.getVersion(),sdk.getHomePath(),additionalData);
      if (jdk != null) {
        jdk.setClasspath(sdk.getPaths());
      }
 else {
        LOG.info("Failed to load SDK " + sdk.getName() + ", type: "+ sdk.getTypeName());
      }
    }
 else {
      final Library lib=project.createGlobalLibrary(library.getName(),fakeClosure);
      if (lib != null) {
        lib.setClasspath(library.getPaths());
      }
 else {
        LOG.info("Failed to load global library " + library.getName());
      }
    }
  }
  final File projectFile=new File(projectPath);
  final String loadPath=isDirectoryBased(projectFile) ? new File(projectFile,IDEA_PROJECT_DIRNAME).getPath() : projectPath;
  IdeaProjectLoader.loadFromPath(project,loadPath,myPathVariables,getStartupScript(),new SystemOutErrorReporter(false));
  final String globalEncoding=myGlobalEncoding;
  if (globalEncoding != null && project.getProjectCharset() == null) {
    project.setProjectCharset(globalEncoding);
  }
  project.getIgnoredFilePatterns().loadFromString(myIgnoredFilesPatterns);
  return project;
}
