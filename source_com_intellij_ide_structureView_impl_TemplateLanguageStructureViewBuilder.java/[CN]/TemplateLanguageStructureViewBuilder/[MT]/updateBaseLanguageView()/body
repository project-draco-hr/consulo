{
  if (myBaseStructureViewDescriptor == null || !myMainFile.getProject().isOpen())   return;
  final StructureViewComponent view=(StructureViewComponent)myBaseStructureViewDescriptor.structureView;
  if (view.isDisposed())   return;
  StructureViewState state=view.getState();
  Object[] expandedElements=state.getExpandedElements();
  List<PsiAnchor> expanded=new ArrayList<PsiAnchor>(expandedElements == null ? 0 : expandedElements.length);
  if (expandedElements != null) {
    for (    Object element : expandedElements) {
      if (element instanceof PsiElement) {
        expanded.add(new PsiAnchor((PsiElement)element));
      }
    }
  }
  Object[] selectedElements=state.getSelectedElements();
  List<PsiAnchor> selected=new ArrayList<PsiAnchor>(selectedElements == null ? 0 : selectedElements.length);
  if (selectedElements != null) {
    for (    Object element : selectedElements) {
      if (element instanceof PsiElement && ((PsiElement)element).isValid()) {
        selected.add(new PsiAnchor((PsiElement)element));
      }
    }
  }
  updateTemplateDataFileView();
  if (view.isDisposed())   return;
  for (  PsiAnchor pointer : expanded) {
    PsiElement element=pointer.retrieve();
    if (element != null) {
      view.expandPathToElement(element);
    }
  }
  for (  PsiAnchor pointer : selected) {
    PsiElement element=pointer.retrieve();
    if (element != null) {
      view.addSelectionPathTo(element);
    }
  }
}
