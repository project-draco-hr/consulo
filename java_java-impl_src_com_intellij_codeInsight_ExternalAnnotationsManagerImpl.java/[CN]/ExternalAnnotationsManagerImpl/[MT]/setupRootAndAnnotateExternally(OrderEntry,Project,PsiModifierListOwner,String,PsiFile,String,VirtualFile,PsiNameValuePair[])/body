{
  final FileChooserDescriptor descriptor=FileChooserDescriptorFactory.createSingleFolderDescriptor();
  descriptor.setTitle(ProjectBundle.message("external.annotations.root.chooser.title",entry.getPresentableName()));
  descriptor.setDescription(ProjectBundle.message("external.annotations.root.chooser.description"));
  final VirtualFile file=FileChooser.chooseFile(project,descriptor);
  if (file == null) {
    return;
  }
  new WriteCommandAction(project){
    protected void run(    final Result result) throws Throwable {
      appendChosenAnnotationsRoot(entry,file);
      final List<XmlFile> xmlFiles=findExternalAnnotationsFile(listOwner);
      if (xmlFiles != null) {
        if (!CodeInsightUtilBase.preparePsiElementForWrite(xmlFiles.get(0)))         return;
        annotateExternally(listOwner,annotationFQName,xmlFiles.get(0),fromFile,value);
      }
 else {
        final XmlFile annotationsXml=createAnnotationsXml(file,packageName);
        if (annotationsXml != null) {
          final List<XmlFile> createdFiles=new ArrayList<XmlFile>();
          createdFiles.add(annotationsXml);
          myExternalAnnotations.put(getFQN(packageName,virtualFile),createdFiles);
        }
        annotateExternally(listOwner,annotationFQName,annotationsXml,fromFile,value);
      }
    }
  }
.execute();
}
