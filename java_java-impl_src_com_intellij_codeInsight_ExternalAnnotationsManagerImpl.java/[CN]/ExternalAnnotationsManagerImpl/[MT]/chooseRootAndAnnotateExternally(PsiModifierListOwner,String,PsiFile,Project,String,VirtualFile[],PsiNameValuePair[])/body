{
  if (roots.length > 1) {
    JBPopupFactory.getInstance().createListPopup(new BaseListPopupStep<VirtualFile>("Annotation Roots",roots){
      @Override public void canceled(){
        notifyAfterAnnotationChanging(listOwner,annotationFQName,false);
      }
      @Override public PopupStep onChosen(      @NotNull final VirtualFile file,      final boolean finalChoice){
        annotateExternally(file,listOwner,project,packageName,annotationFQName,fromFile,value);
        return FINAL_CHOICE;
      }
      @NotNull @Override public String getTextFor(      @NotNull final VirtualFile value){
        return value.getPresentableUrl();
      }
      @Override public Icon getIconFor(      final VirtualFile aValue){
        return AllIcons.Modules.Annotation;
      }
    }
).showInBestPositionFor(DataManager.getInstance().getDataContext());
  }
 else {
    annotateExternally(roots[0],listOwner,project,packageName,annotationFQName,fromFile,value);
  }
}
