{
  if (canCreateModule()) {
    if (myName == null) {
      myName=project.getName();
    }
    if (myModuleFilePath == null) {
      myModuleFilePath=project.getBaseDir().getPath() + File.separator + myName+ ModuleFileType.DOT_DEFAULT_EXTENSION;
    }
    try {
      return ApplicationManager.getApplication().runWriteAction(new ThrowableComputable<Module,Exception>(){
        @Override public Module compute() throws Exception {
          return createAndCommitIfNeeded(project,model,true);
        }
      }
);
    }
 catch (    Exception ex) {
      LOG.warn(ex);
      Messages.showErrorDialog(IdeBundle.message("error.adding.module.to.project",ex.getMessage()),IdeBundle.message("title.add.module"));
    }
  }
  return null;
}
