{
  final Project project=file.getProject();
  int offset=editor.getCaretModel().getOffset();
  PsiElement element=file.findElementAt(offset);
  Pair<PsiFile,Editor> pair=availableFor(file,editor,action,element);
  if (pair == null)   return;
  final Editor editorToApply=pair.second;
  final PsiFile fileToApply=pair.first;
  Runnable runnable=new Runnable(){
    public void run(){
      try {
        action.invoke(project,editorToApply,fileToApply);
      }
 catch (      IncorrectOperationException e) {
        LOG.error(e);
      }
      DaemonCodeAnalyzer.getInstance(project).updateVisibleHighlighters(editor);
    }
  }
;
  if (action.startInWriteAction()) {
    final Runnable _runnable=runnable;
    runnable=new Runnable(){
      public void run(){
        ApplicationManager.getApplication().runWriteAction(_runnable);
      }
    }
;
  }
  CommandProcessor.getInstance().executeCommand(project,runnable,text,null);
}
