{
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  if (editor instanceof EditorWindow) {
    editor=((EditorWindow)editor).getDelegate();
    file=InjectedLanguageFacadeImpl.getTopLevelFile(file);
  }
  final LookupEx lookup=LookupManager.getActiveLookup(editor);
  if (lookup != null) {
    lookup.showElementActions();
    return;
  }
  if (HintManagerImpl.getInstanceImpl().performCurrentQuestionAction())   return;
  if (file instanceof PsiCodeFragment)   return;
  TemplateState state=TemplateManagerImpl.getTemplateState(editor);
  if (state != null && !state.isFinished()) {
    return;
  }
  final DaemonCodeAnalyzerImpl codeAnalyzer=(DaemonCodeAnalyzerImpl)DaemonCodeAnalyzer.getInstance(project);
  codeAnalyzer.autoImportReferenceAtCursor(editor,file);
  ShowIntentionsPass.IntentionsInfo intentions=new ShowIntentionsPass.IntentionsInfo();
  ShowIntentionsPass.getActionsToShow(editor,file,intentions,-1);
  if (!intentions.isEmpty()) {
    IntentionHintComponent.showIntentionHint(project,file,editor,intentions,true);
  }
}
