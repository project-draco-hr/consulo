{
  super.visitReferenceExpression(expression);
  boolean isLockedOnInstance=false;
  boolean isLockedOnClass=false;
  final PsiMethod containingMethod=PsiTreeUtil.getParentOfType(expression,PsiMethod.class);
  if (containingMethod != null && containingMethod.hasModifierProperty(PsiModifier.SYNCHRONIZED)) {
    if (containingMethod.hasModifierProperty(PsiModifier.STATIC)) {
      isLockedOnClass=true;
    }
 else {
      isLockedOnInstance=true;
    }
  }
  final PsiClass expressionClass=PsiTreeUtil.getParentOfType(expression,PsiClass.class);
  if (expressionClass == null) {
    return;
  }
  PsiElement elementToCheck=expression;
  while (true) {
    final PsiSynchronizedStatement synchronizedStatement=PsiTreeUtil.getParentOfType(elementToCheck,PsiSynchronizedStatement.class);
    if (synchronizedStatement == null || !PsiTreeUtil.isAncestor(expressionClass,synchronizedStatement,true)) {
      break;
    }
    final PsiExpression lockExpression=synchronizedStatement.getLockExpression();
    if (lockExpression instanceof PsiReferenceExpression) {
      final PsiReferenceExpression reference=(PsiReferenceExpression)lockExpression;
      final PsiElement target=reference.resolve();
      if (target instanceof PsiField) {
        final PsiField lockField=(PsiField)target;
        if (lockField.hasModifierProperty(PsiModifier.STATIC)) {
          isLockedOnClass=true;
        }
 else {
          isLockedOnInstance=true;
        }
      }
    }
 else     if (lockExpression instanceof PsiThisExpression) {
      isLockedOnInstance=true;
    }
 else     if (lockExpression instanceof PsiClassObjectAccessExpression) {
      isLockedOnClass=true;
    }
    elementToCheck=synchronizedStatement;
  }
  if (!isLockedOnInstance || isLockedOnClass) {
    return;
  }
  final PsiElement target=expression.resolve();
  if (!(target instanceof PsiField)) {
    return;
  }
  final PsiField lockedField=(PsiField)target;
  if (!lockedField.hasModifierProperty(PsiModifier.STATIC) || ExpressionUtils.isConstant(lockedField)) {
    return;
  }
  final PsiClass containingClass=lockedField.getContainingClass();
  if (!PsiTreeUtil.isAncestor(containingClass,expression,false)) {
    return;
  }
  if (!ignoredClasses.isEmpty()) {
    final PsiType type=lockedField.getType();
    if (type instanceof PsiClassType) {
      final PsiClassType classType=(PsiClassType)type;
      final PsiClass aClass=classType.resolve();
      if (aClass != null && ignoredClasses.contains(aClass.getQualifiedName())) {
        return;
      }
    }
  }
  registerError(expression);
}
