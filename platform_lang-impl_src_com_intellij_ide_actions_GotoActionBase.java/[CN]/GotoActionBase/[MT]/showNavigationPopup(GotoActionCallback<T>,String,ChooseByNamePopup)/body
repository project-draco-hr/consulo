{
  final Class startedAction=myInAction;
  LOG.assertTrue(startedAction != null);
  popup.setCheckBoxShortcut(getShortcutSet());
  popup.setFindUsagesTitle(findUsagesTitle);
  final ChooseByNameFilter<T> filter=callback.createFilter(popup);
  popup.invoke(new ChooseByNamePopupComponent.Callback(){
    @Override public void onClose(){
      ourLastStrings.put(myInAction,Pair.create(popup.getEnteredText(),popup.getSelectedIndex()));
      if (startedAction != null && startedAction.equals(myInAction)) {
        myInAction=null;
      }
      if (filter != null) {
        filter.close();
      }
    }
    @Override public void elementChosen(    Object element){
      callback.elementChosen(popup,element);
    }
  }
,ModalityState.current(),true);
}
