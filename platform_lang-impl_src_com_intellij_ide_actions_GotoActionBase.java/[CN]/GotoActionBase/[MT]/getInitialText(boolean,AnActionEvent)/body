{
  final Editor editor=e.getData(PlatformDataKeys.EDITOR);
  if (editor != null) {
    final String selectedText=editor.getSelectionModel().getSelectedText();
    if (selectedText != null && !selectedText.contains("\n")) {
      return Pair.create(selectedText,0);
    }
  }
  final String query=e.getData(SpeedSearchSupply.SPEED_SEARCH_CURRENT_QUERY);
  if (!StringUtil.isEmpty(query)) {
    return Pair.create(query,0);
  }
  final Component focusOwner=IdeFocusManager.getInstance(getEventProject(e)).getFocusOwner();
  if (focusOwner instanceof JComponent) {
    final SpeedSearchSupply supply=SpeedSearchSupply.getSupply((JComponent)focusOwner);
    if (supply != null) {
      return Pair.create(supply.getEnteredPrefix(),0);
    }
  }
  if (myInAction != null) {
    final Pair<String,Integer> lastString=ourLastStrings.get(myInAction);
    if (lastString != null) {
      return lastString;
    }
  }
  return Pair.create("",0);
}
