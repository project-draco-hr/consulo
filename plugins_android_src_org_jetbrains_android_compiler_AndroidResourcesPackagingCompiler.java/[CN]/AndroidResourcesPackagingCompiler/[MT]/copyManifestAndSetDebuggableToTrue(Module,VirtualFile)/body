{
  final File dir=FileUtil.createTempDirectory("android_manifest_copy","tmp");
  final VirtualFile vDir=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(dir);
  if (vDir == null) {
    throw new IOException("Cannot create temp directory for manifest copy");
  }
  final VirtualFile[] manifestFileCopy=new VirtualFile[1];
  ApplicationManager.getApplication().invokeAndWait(new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          try {
            manifestFileCopy[0]=manifestFile.copy(module.getProject(),vDir,manifestFile.getName());
          }
 catch (          IOException e) {
            LOG.info(e);
            return;
          }
          if (manifestFileCopy[0] == null) {
            return;
          }
          final Manifest manifestInCopy=AndroidUtils.loadDomElement(module,manifestFileCopy[0],Manifest.class);
          if (manifestInCopy == null) {
            return;
          }
          final Application applicationInCopy=manifestInCopy.getApplication();
          if (applicationInCopy == null) {
            return;
          }
          applicationInCopy.getDebuggable().setValue(Boolean.TRUE.toString());
        }
      }
);
      if (manifestFileCopy[0] != null) {
        EncodingManager.getInstance().setEncoding(manifestFileCopy[0],null);
      }
      ApplicationManager.getApplication().saveAll();
    }
  }
,ModalityState.defaultModalityState());
  if (manifestFileCopy[0] == null) {
    FileUtil.delete(dir);
    throw new IOException("Cannot copy manifest file to " + vDir.getPath());
  }
  return Pair.create(manifestFileCopy[0],dir);
}
