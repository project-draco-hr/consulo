{
  context.getProgressIndicator().setText("Packaging Android resources...");
  final List<ProcessingItem> result=new ArrayList<ProcessingItem>();
  for (  ProcessingItem processingItem : items) {
    MyItem item=(MyItem)processingItem;
    if (!AndroidCompileUtil.isModuleAffected(context,item.myModule)) {
      continue;
    }
    try {
      Map<CompilerMessageCategory,List<String>> messages=AndroidApt.packageResources(item.myAndroidTarget,item.myManifestFile.getPath(),item.myResourceDirPaths,item.myAssetsDirPath,item.myOutputPath);
      AndroidCompileUtil.addMessages(context,messages);
    }
 catch (    final IOException e) {
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        public void run(){
          if (context.getProject().isDisposed())           return;
          context.addMessage(CompilerMessageCategory.ERROR,e.getMessage(),null,-1,-1);
        }
      }
);
    }
    if (context.getMessages(CompilerMessageCategory.ERROR).length == 0) {
      result.add(item);
    }
  }
  return result.toArray(new ProcessingItem[result.size()]);
}
