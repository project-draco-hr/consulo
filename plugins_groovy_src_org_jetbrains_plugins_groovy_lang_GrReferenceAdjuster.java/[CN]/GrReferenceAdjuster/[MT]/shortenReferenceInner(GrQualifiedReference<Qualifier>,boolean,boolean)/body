{
  final Qualifier qualifier=ref.getQualifier();
  if (qualifier == null || qualifier instanceof GrSuperReferenceExpression || cannotShortenInContext(ref)) {
    return false;
  }
  if (ref instanceof GrReferenceExpression) {
    final GrTypeArgumentList typeArgs=((GrReferenceExpression)ref).getTypeArgumentList();
    if (typeArgs != null && typeArgs.getTypeArgumentElements().length > 0) {
      return false;
    }
  }
  if (!shorteningIsMeaningfully(ref))   return false;
  final PsiElement resolved=resolveRef(ref,incomplete);
  if (resolved == null)   return false;
  if (!checkCopyWithoutQualifier(ref,addImports,resolved))   return false;
  ref.setQualifier(null);
  return true;
}
