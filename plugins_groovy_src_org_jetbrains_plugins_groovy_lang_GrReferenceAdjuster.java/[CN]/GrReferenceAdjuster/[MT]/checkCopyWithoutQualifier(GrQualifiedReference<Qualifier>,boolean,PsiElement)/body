{
  final GrQualifiedReference<Qualifier> copy=getCopy(ref);
  copy.setQualifier(null);
  if (copy.isReferenceTo(resolved))   return true;
  if (resolved instanceof PsiClass) {
    final PsiClass clazz=(PsiClass)resolved;
    final String qName=clazz.getQualifiedName();
    if (qName != null && addImports && checkIsInnerClass(clazz) && mayInsertImport(ref)) {
      final GroovyFileBase file=(GroovyFileBase)ref.getContainingFile();
      final GrImportStatement added=file.addImportForClass(clazz);
      if (copy.isReferenceTo(resolved))       return true;
      file.removeImport(added);
    }
  }
  return false;
}
