{
  Project project=(Project)e.getDataContext().getData(DataConstants.PROJECT);
  if (project == null) {
    return;
  }
  DebuggerContextImpl context=(DebuggerManagerEx.getInstanceEx(project)).getContext();
  if (context.getDebuggerSession() != null) {
    final String destinationDirectory;
    final VirtualFile projectFile=project.getProjectFile();
    if (projectFile != null) {
      destinationDirectory=projectFile.getParent().getPresentableUrl();
    }
 else {
      destinationDirectory="";
    }
    ExportDialog dialog=new ExportDialog(context.getDebugProcess(),destinationDirectory);
    dialog.show();
    if (dialog.isOK()) {
      try {
        File file=new File(dialog.getFilePath());
        BufferedWriter writer=new BufferedWriter(new FileWriter(file));
        try {
          String text=StringUtil.convertLineSeparators(dialog.getTextToSave(),SystemProperties.getLineSeparator());
          writer.write(text);
        }
  finally {
          writer.close();
        }
      }
 catch (      IOException ex) {
        Messages.showMessageDialog(project,ex.getMessage(),ActionsBundle.actionText(DebuggerActions.EXPORT_THREADS),Messages.getErrorIcon());
      }
    }
  }
}
