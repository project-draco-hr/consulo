{
  Project project=DataKeys.PROJECT.getData(e.getDataContext());
  if (project == null) {
    return;
  }
  DebuggerContextImpl context=(DebuggerManagerEx.getInstanceEx(project)).getContext();
  if (context.getDebuggerSession() != null) {
    String destinationDirectory="";
    final VirtualFile baseDir=project.getBaseDir();
    if (baseDir != null)     destinationDirectory=baseDir.getPresentableUrl();
    ExportDialog dialog=new ExportDialog(context.getDebugProcess(),destinationDirectory);
    dialog.show();
    if (dialog.isOK()) {
      try {
        File file=new File(dialog.getFilePath());
        BufferedWriter writer=new BufferedWriter(new FileWriter(file));
        try {
          String text=StringUtil.convertLineSeparators(dialog.getTextToSave(),SystemProperties.getLineSeparator());
          writer.write(text);
        }
  finally {
          writer.close();
        }
      }
 catch (      IOException ex) {
        Messages.showMessageDialog(project,ex.getMessage(),ActionsBundle.actionText(DebuggerActions.EXPORT_THREADS),Messages.getErrorIcon());
      }
    }
  }
}
