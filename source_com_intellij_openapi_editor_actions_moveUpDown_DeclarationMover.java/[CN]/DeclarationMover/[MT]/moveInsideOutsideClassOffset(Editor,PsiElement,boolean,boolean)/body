{
  if (sibling == null)   return ILLEGAL_MOVE;
  if (sibling instanceof PsiJavaToken && ((PsiJavaToken)sibling).getTokenType() == (isDown ? JavaTokenType.RBRACE : JavaTokenType.LBRACE) && sibling.getParent() instanceof PsiClass) {
    final PsiClass aClass=(PsiClass)sibling.getParent();
    final PsiElement parent=aClass.getParent();
    if (!areWeMovingClass && !(parent instanceof PsiClass))     return ILLEGAL_MOVE;
    return isDown ? nextLineOffset(editor,aClass.getTextRange().getEndOffset()) : aClass.getTextRange().getStartOffset();
  }
  if (sibling instanceof PsiClass) {
    return isDown ? nextLineOffset(editor,((PsiClass)sibling).getLBrace().getTextOffset()) : ((PsiClass)sibling).getRBrace().getTextOffset();
  }
  return NOT_CROSSING_CLASS_BORDER;
}
