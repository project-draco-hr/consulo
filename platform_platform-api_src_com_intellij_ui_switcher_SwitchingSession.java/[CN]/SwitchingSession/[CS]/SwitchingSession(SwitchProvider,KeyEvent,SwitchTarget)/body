{
  myProvider=provider;
  myInitialEvent=e;
  KeyboardFocusManager.getCurrentKeyboardFocusManager().addKeyEventDispatcher(this);
  myTargets.addAll(myProvider.getTargets(true,true));
  Component eachParent=myProvider.getComponent();
  eachParent=eachParent.getParent();
  while (eachParent != null) {
    if (eachParent instanceof SwitchProvider) {
      SwitchProvider eachProvider=(SwitchProvider)eachParent;
      myTargets.addAll(eachProvider.getTargets(true,false));
      if (eachProvider.isCycleRoot()) {
        break;
      }
    }
    eachParent=eachParent.getParent();
  }
  if (myTargets.size() == 0) {
    Disposer.dispose(this);
    return;
  }
  mySelection=myProvider.getCurrentTarget();
  if (myTargets.contains(preselected)) {
    mySelection=preselected;
  }
  myStartSelection=mySelection;
  myGlassPane=IdeGlassPaneUtil.find(myProvider.getComponent());
  for (  SwitchTarget each : myTargets) {
    TargetPainer eachPainter=new TargetPainer(each);
    Disposer.register(this,eachPainter);
    myRootComponent=myProvider.getComponent();
    myGlassPane.addPainter(each.getComponent(),eachPainter,this);
    myPainters.put(each,eachPainter);
  }
}
