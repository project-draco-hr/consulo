{
  FoldingModelImpl foldingModel=(FoldingModelImpl)myEditor.getFoldingModel();
  if (myGroup == null) {
    doSetExpanded(expanded,foldingModel,this);
  }
 else {
    for (    final FoldRegion region : foldingModel.getGroupedRegions(myGroup)) {
      doSetExpanded(expanded,foldingModel,region);
      if (region.isExpanded() != expanded) {
        for (        FoldRegion regionToRevert : foldingModel.getGroupedRegions(myGroup)) {
          if (regionToRevert == region) {
            break;
          }
          doSetExpanded(!expanded,foldingModel,regionToRevert);
        }
        return;
      }
    }
  }
}
