{
  Throwable rootCause=ExceptionUtil.getRootCause(throwable);
  if (rootCause instanceof LogEventException) {
    return ((LogEventException)rootCause).getLogMessage();
  }
  String strMessage=message == null ? "<null> " : message.toString();
  ExceptionWithAttachments withAttachments=ExceptionUtil.findCause(throwable,ExceptionWithAttachments.class);
  if (withAttachments != null) {
    return LogMessageEx.createEvent(strMessage,ExceptionUtil.getThrowableText(throwable),withAttachments.getAttachments());
  }
  return new IdeaLoggingEvent(strMessage,throwable);
}
