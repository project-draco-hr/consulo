{
  PsiDirectory dir=directory;
  String className=newName;
  if (newName.contains(".")) {
    dir=getTopLevelDir(dir);
    String[] names=newName.split("\\.");
    for (int i=0; i < names.length - 1; i++) {
      String name=names[i];
      PsiDirectory subDir=dir.findSubdirectory(name);
      if (subDir == null) {
        subDir=dir.createSubdirectory(name);
      }
      dir=subDir;
    }
    className=names[names.length - 1];
  }
  return doCreate(dir,className,templateName);
}
