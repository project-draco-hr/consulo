{
  PsiField[] cachedFields=myCachedFields;
  if (cachedFields == null) {
    if (getTreeElement() != null) {
      cachedFields=calcTreeElement().getChildrenAsPsiElements(Constants.FIELD_BIT_SET,Constants.PSI_FIELD_ARRAY_CONSTRUCTOR);
    }
 else {
      long[] fieldIds=getRepositoryManager().getClassView().getFields(getRepositoryId());
      PsiField[] fields=fieldIds.length > 0 ? new PsiField[fieldIds.length] : PsiField.EMPTY_ARRAY;
      for (int i=0; i < fieldIds.length; i++) {
        long id=fieldIds[i];
        fields[i]=(PsiField)getRepositoryElementsManager().findOrCreatePsiElementById(id);
      }
      cachedFields=fields;
    }
    myCachedFields=cachedFields;
  }
  return cachedFields;
}
