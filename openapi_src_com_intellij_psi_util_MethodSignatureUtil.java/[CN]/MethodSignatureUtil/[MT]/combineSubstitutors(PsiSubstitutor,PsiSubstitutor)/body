{
  if (substitutor1 == PsiSubstitutor.EMPTY)   return substitutor2;
  Set<PsiTypeParameter> parameters1=substitutor1.getSubstitutionMap().keySet();
  final PsiTypeParameter[] typeParameters=parameters1.toArray(new PsiTypeParameter[parameters1.size()]);
  for (  PsiTypeParameter typeParameter : typeParameters) {
    final PsiType type=substitutor1.substitute(typeParameter);
    PsiType otherSubstituted;
    if (type instanceof PsiClassType) {
      final PsiClass resolved=((PsiClassType)type).resolve();
      if (resolved instanceof PsiTypeParameter) {
        otherSubstituted=substitutor2.substitute((PsiTypeParameter)resolved);
      }
 else {
        otherSubstituted=substitutor2.substitute(type);
      }
    }
 else {
      otherSubstituted=substitutor2.substitute(type);
    }
    substitutor1=substitutor1.put(typeParameter,otherSubstituted);
  }
  return substitutor1;
}
