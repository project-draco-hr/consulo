{
  if (substitutor == PsiSubstitutor.EMPTY)   return parentSubstitutor;
  final PsiTypeParameter[] typeParameters=substitutor.getSubstitutionMap().keySet().toArray(PsiTypeParameter.EMPTY_ARRAY);
  for (int i=0; i < typeParameters.length; i++) {
    PsiTypeParameter typeParameter=typeParameters[i];
    final PsiType type=substitutor.substitute(typeParameter);
    substitutor=substitutor.put(typeParameter,promoteType(type,parentSubstitutor));
  }
  return substitutor;
}
