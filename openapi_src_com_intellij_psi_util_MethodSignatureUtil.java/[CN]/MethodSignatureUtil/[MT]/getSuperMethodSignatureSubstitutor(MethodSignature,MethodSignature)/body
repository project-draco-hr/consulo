{
  PsiTypeParameter[] typeParameters1=methodSignature.getTypeParameters();
  PsiTypeParameter[] typeParameters2=superMethodSignature.getTypeParameters();
  if (typeParameters1.length != typeParameters2.length && typeParameters1.length != 0 && typeParameters2.length != 0)   return null;
  boolean derivedRaw=methodSignature.isRaw();
  boolean superRaw=superMethodSignature.isRaw();
  if (derivedRaw || superRaw) {
    if (!superRaw && derivedRaw)     return null;
    PsiSubstitutor substitutor=superMethodSignature.getSubstitutor();
    substitutor=eraseMethodTypeParameters(typeParameters2,substitutor);
    if (derivedRaw) {
      substitutor=eraseMethodTypeParameters(typeParameters1,substitutor);
    }
    return substitutor;
  }
  PsiSubstitutor substitutor1=methodSignature.getSubstitutor();
  PsiSubstitutor substitutor2=superMethodSignature.getSubstitutor();
  int limit=Math.min(typeParameters1.length,typeParameters2.length);
  for (int i=0; i < limit; i++) {
    PsiElementFactory factory=typeParameters1[i].getManager().getElementFactory();
    substitutor2=substitutor2.put(typeParameters2[i],factory.createType(typeParameters1[i]));
  }
  for (int i=0; i < limit; i++) {
    PsiTypeParameter typeParameter1=typeParameters1[i];
    PsiTypeParameter typeParameter2=typeParameters2[i];
    final PsiClassType[] supers1=typeParameter1.getSuperTypes();
    final PsiClassType[] supers2=typeParameter2.getSuperTypes();
    if (supers1.length != supers2.length)     return null;
    for (int j=0; j < supers1.length; j++) {
      PsiType type1=substitutor1.substitute(supers1[j]);
      PsiType type2=substitutor2.substitute(supers2[j]);
      if (!type1.equals(type2))       return null;
    }
  }
  return substitutor2;
}
