{
  final boolean shouldHighlight=shouldHighlightFile(psiFile);
  if (shouldHighlight) {
    if (psiFile.getFileType() == StdFileTypes.JAVA) {
      final VirtualFile virtualFile=psiFile.getVirtualFile();
      if (virtualFile != null && ProjectRootManager.getInstance(psiFile.getProject()).getFileIndex().isInLibrarySource(virtualFile)) {
        return false;
      }
    }
  }
  return shouldHighlight;
}
