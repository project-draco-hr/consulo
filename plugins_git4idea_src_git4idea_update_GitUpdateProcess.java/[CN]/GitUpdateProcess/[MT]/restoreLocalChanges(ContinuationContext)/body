{
  context.addExceptionHandler(VcsException.class,new Consumer<VcsException>(){
    @Override public void consume(    VcsException e){
      LOG.info("Couldn't restore local changes after update",e);
      notifyImportantError(myProject,"Couldn't restore local changes after update","Restoring changes saved before update failed with an error.<br/>" + e.getLocalizedMessage());
    }
  }
);
  final ContinuationFinalTasksInserter finalTasksInserter=new ContinuationFinalTasksInserter(context);
  finalTasksInserter.allNextAreFinal();
  context.next(new TaskDescriptor("Refresh local files",Where.POOLED){
    @Override public void run(    ContinuationContext context){
      mySaver.refresh();
    }
  }
);
  mySaver.restoreLocalChanges(context);
  finalTasksInserter.removeFinalPropertyAdder();
}
