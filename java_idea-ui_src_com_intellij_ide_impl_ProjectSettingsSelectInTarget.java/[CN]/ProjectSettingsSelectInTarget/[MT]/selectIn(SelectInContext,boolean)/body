{
  final Project project=context.getProject();
  final VirtualFile file=context.getVirtualFile();
  final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  final Module module;
  final Facet facet;
  if (file instanceof WrappingVirtualFile) {
    final Object o=((WrappingVirtualFile)file).getWrappedObject(project);
    facet=o instanceof Facet ? (Facet)o : null;
    module=facet == null ? null : facet.getModule();
  }
 else {
    module=fileIndex.getModuleForFile(file);
    facet=findFacet(project,file,fileIndex);
  }
  if (module != null || facet != null) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        if (facet != null) {
          ModulesConfigurator.showFacetSettingsDialog(facet,null);
        }
 else {
          ModulesConfigurator.showDialog(project,module.getName(),null,false);
        }
      }
    }
);
    return;
  }
  final LibraryOrderEntry libraryOrderEntry=findLibrary(file,fileIndex);
  if (libraryOrderEntry != null) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        ModulesConfigurator.showLibrarySettings(project,libraryOrderEntry);
      }
    }
);
    return;
  }
  final Sdk jdk=findJdk(file,fileIndex);
  if (jdk != null) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        ModulesConfigurator.showSdkSettings(project,jdk);
      }
    }
);
  }
}
