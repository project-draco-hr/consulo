{
  final VirtualFile f=root.createChildData(null,"old.java");
  final boolean[] log=new boolean[4];
  final String oldPath=Paths.appended(root.getPath(),"old.java");
  final String newPath=Paths.appended(root.getPath(),"new.java");
  VirtualFileListener l=new VirtualFileAdapter(){
    public void beforePropertyChange(    VirtualFilePropertyEvent e){
      log[0]=hasVcsEntry(oldPath);
      log[1]=hasVcsEntry(newPath);
    }
    public void propertyChanged(    VirtualFilePropertyEvent e){
      log[2]=hasVcsEntry(oldPath);
      log[3]=hasVcsEntry(newPath);
    }
  }
;
  addFileListenerDuring(l,new RunnableAdapter(){
    @Override public void doRun() throws IOException {
      f.rename(null,"new.java");
    }
  }
);
  assertEquals(true,log[0]);
  assertEquals(false,log[1]);
  assertEquals(false,log[2]);
  assertEquals(true,log[3]);
}
