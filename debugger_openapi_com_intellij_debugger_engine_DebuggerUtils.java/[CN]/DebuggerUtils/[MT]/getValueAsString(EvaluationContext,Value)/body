{
  try {
    if (value == null) {
      return "null";
    }
    if (value instanceof StringReference) {
      return ((StringReference)value).value();
    }
    if (isInteger(value)) {
      long v=((PrimitiveValue)value).longValue();
      return String.valueOf(v);
    }
    if (isNumeric(value)) {
      double v=((PrimitiveValue)value).doubleValue();
      return String.valueOf(v);
    }
    if (value instanceof BooleanValue) {
      boolean v=((PrimitiveValue)value).booleanValue();
      return String.valueOf(v);
    }
    if (value instanceof CharValue) {
      char v=((PrimitiveValue)value).charValue();
      return String.valueOf(v);
    }
    if (value instanceof ObjectReference) {
      final ObjectReference objRef=(ObjectReference)value;
      ReferenceType refType=objRef.referenceType();
      if (refType instanceof ArrayType) {
        try {
          refType=(ReferenceType)objRef.virtualMachine().classesByName("java.lang.Object").get(0);
        }
 catch (        Exception e) {
          throw EvaluateExceptionUtil.createEvaluateException(DebuggerBundle.message("evaluation.error.cannot.evaluate.tostring",objRef.referenceType().name()));
        }
      }
      final Method toStringMethod=findMethod(refType,"toString","()Ljava/lang/String;");
      if (toStringMethod == null) {
        throw EvaluateExceptionUtil.createEvaluateException(DebuggerBundle.message("evaluation.error.cannot.evaluate.tostring",objRef.referenceType().name()));
      }
      StringReference stringReference=null;
      stringReference=(StringReference)evaluationContext.getDebugProcess().invokeMethod(evaluationContext,objRef,toStringMethod,Collections.emptyList());
      return stringReference == null ? "null" : stringReference.value();
    }
    throw EvaluateExceptionUtil.createEvaluateException(DebuggerBundle.message("evaluation.error.unsupported.expression.type"));
  }
 catch (  ObjectCollectedException e) {
    throw EvaluateExceptionUtil.OBJECT_WAS_COLLECTED;
  }
}
