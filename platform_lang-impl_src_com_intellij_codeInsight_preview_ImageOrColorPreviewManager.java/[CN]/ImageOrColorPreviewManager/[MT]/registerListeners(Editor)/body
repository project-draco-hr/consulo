{
  if (editor.isOneLineMode()) {
    return;
  }
  Project project=editor.getProject();
  if (project == null || project.isDisposed()) {
    return;
  }
  PsiFile psiFile=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
  if (psiFile == null || psiFile instanceof PsiCompiledElement || !isSupportedFile(psiFile)) {
    return;
  }
  editor.addEditorMouseMotionListener(this);
  KeyListener keyListener=new KeyAdapter(){
    @Override public void keyPressed(    KeyEvent e){
      if (e.getKeyCode() == KeyEvent.VK_SHIFT && !editor.isOneLineMode()) {
        PointerInfo pointerInfo=MouseInfo.getPointerInfo();
        if (pointerInfo != null) {
          Point location=pointerInfo.getLocation();
          SwingUtilities.convertPointFromScreen(location,editor.getContentComponent());
          alarm.cancelAllRequests();
          alarm.addRequest(new PreviewRequest(location,editor,true),100);
        }
      }
    }
  }
;
  editor.getContentComponent().addKeyListener(keyListener);
  EDITOR_LISTENER_ADDED.set(editor,keyListener);
}
