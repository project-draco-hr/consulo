{
  Rectangle r=getBounds();
  Graphics2D g2d=(Graphics2D)g;
  Shape clip=g2d.getClip();
  ToolWindowType type=myToolWindow.getType();
  Image image;
  if (isActive()) {
    if (myActiveImage == null || myActiveImage.getHeight() != r.height || type != myImageType) {
      myActiveImage=drawToBuffer(true,r.height,myToolWindow.getType() == ToolWindowType.FLOATING);
    }
    image=myActiveImage;
  }
 else {
    if (myImage == null || myImage.getHeight() != r.height || type != myImageType) {
      myImage=drawToBuffer(false,r.height,myToolWindow.getType() == ToolWindowType.FLOATING);
    }
    image=myImage;
  }
  myImageType=myToolWindow.getType();
  Rectangle clipBounds=clip.getBounds();
  for (int x=clipBounds.x; x < clipBounds.x + clipBounds.width; x+=150) {
    g2d.drawImage(image,x,0,null);
  }
}
