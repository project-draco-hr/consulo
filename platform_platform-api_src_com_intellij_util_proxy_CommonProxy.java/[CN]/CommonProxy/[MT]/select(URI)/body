{
  isInstalledAssertion();
  if (uri == null) {
    return NO_PROXY_LIST;
  }
  LOG.debug("CommonProxy.select called for " + uri.toString());
  final String host=uri.getHost() == null ? "" : uri.getHost();
  final int port=uri.getPort();
  final String protocol=uri.getScheme();
  final HostInfo info=new HostInfo(protocol,host,port);
  final Map<String,ProxySelector> copy;
synchronized (myLock) {
    if (myNoProxy.contains(Pair.create(info,Thread.currentThread()))) {
      LOG.debug("CommonProxy.select returns no proxy (in no proxy list) for " + uri.toString());
      return NO_PROXY_LIST;
    }
    copy=new HashMap<String,ProxySelector>(myCustom);
  }
  for (  Map.Entry<String,ProxySelector> entry : copy.entrySet()) {
    final List<Proxy> proxies=entry.getValue().select(uri);
    if (proxies != null && proxies.size() > 0) {
      LOG.debug("CommonProxy.select returns custom proxy for " + uri.toString() + ", "+ proxies.toString());
      return proxies;
    }
  }
  return NO_PROXY_LIST;
}
