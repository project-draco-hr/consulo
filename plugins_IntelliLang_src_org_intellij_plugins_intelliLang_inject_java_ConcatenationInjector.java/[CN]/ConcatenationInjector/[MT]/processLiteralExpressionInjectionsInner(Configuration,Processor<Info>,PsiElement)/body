{
  if (operands.length == 0)   return;
  final PsiElement firstOperand=operands[0];
  final PsiElement topBlock=PsiUtil.getTopLevelEnclosingCodeBlock(firstOperand,null);
  final LocalSearchScope searchScope=new LocalSearchScope(new PsiElement[]{topBlock instanceof PsiCodeBlock ? topBlock : firstOperand.getContainingFile()},"",true);
  final THashSet<PsiModifierListOwner> visitedVars=new THashSet<PsiModifierListOwner>();
  final LinkedList<PsiElement> places=new LinkedList<PsiElement>();
  places.add(firstOperand);
  boolean unparsable=false;
  while (!places.isEmpty()) {
    final PsiElement curPlace=places.removeFirst();
    final PsiModifierListOwner owner=AnnotationUtilEx.getAnnotatedElementFor(curPlace,AnnotationUtilEx.LookupType.PREFER_CONTEXT);
    if (owner == null)     continue;
    final PsiMethod psiMethod;
    final int parameterIndex;
    if (owner instanceof PsiParameter) {
      final PsiElement declarationScope=((PsiParameter)owner).getDeclarationScope();
      psiMethod=declarationScope instanceof PsiMethod ? (PsiMethod)declarationScope : null;
      final PsiParameterList parameterList=psiMethod == null ? null : ((PsiMethod)declarationScope).getParameterList();
      if (parameterList == null || parameterList != owner.getParent())       continue;
      parameterIndex=parameterList.getParameterIndex((PsiParameter)owner);
    }
 else     if (owner instanceof PsiMethod) {
      psiMethod=(PsiMethod)owner;
      parameterIndex=-1;
    }
 else     if (configuration.isResolveReferences() && owner instanceof PsiVariable && visitedVars.add(owner)) {
      final PsiVariable variable=(PsiVariable)owner;
      for (      PsiReference psiReference : ReferencesSearch.search(variable,searchScope).findAll()) {
        final PsiElement element=psiReference.getElement();
        if (element instanceof PsiExpression) {
          final PsiExpression refExpression=(PsiExpression)element;
          places.add(refExpression);
          if (!unparsable) {
            unparsable=checkUnparsableReference(refExpression);
          }
        }
      }
      parameterIndex=-1;
      psiMethod=null;
    }
 else {
      parameterIndex=-1;
      psiMethod=null;
    }
    final List<BaseInjection> injections;
    if (psiMethod == null) {
      injections=Collections.emptyList();
    }
 else {
      injections=ContainerUtil.findAll(configuration.getInjections(LanguageInjectionSupport.JAVA_SUPPORT_ID),new Condition<BaseInjection>(){
        public boolean value(        final BaseInjection injection){
          return injection.acceptsPsiElement(owner);
        }
      }
);
    }
    final Info info=new Info(owner,psiMethod,injections,unparsable,parameterIndex);
    if (!processor.process(info))     return;
  }
}
