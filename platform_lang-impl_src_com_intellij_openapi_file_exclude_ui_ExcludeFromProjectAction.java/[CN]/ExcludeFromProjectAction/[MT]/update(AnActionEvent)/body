{
  DataContext dataContext=e.getDataContext();
  final VirtualFile file=PlatformDataKeys.VIRTUAL_FILE.getData(dataContext);
  final Presentation presentation=e.getPresentation();
  if (file == null) {
    presentation.setVisible(false);
    return;
  }
  final Project project=CommonDataKeys.PROJECT.getData(dataContext);
  if (project != null) {
    ProjectFileExclusionManagerImpl fileExManager=ProjectFileExclusionManagerImpl.getInstance(project);
    if (fileExManager == null) {
      presentation.setVisible(false);
      return;
    }
    if (file.equals(project.getBaseDir()) || !file.isWritable()) {
      presentation.setEnabled(false);
    }
  }
}
