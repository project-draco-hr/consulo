{
  final Runnable runnable;
  final Application application=ApplicationManager.getApplication();
  if (action instanceof DumbAware) {
    runnable=new DumbAwareRunnable(){
      public void run(){
        application.runWriteAction(action);
      }
    }
;
  }
 else {
    runnable=new Runnable(){
      public void run(){
        application.runWriteAction(action);
      }
    }
;
  }
  if (myProject.isInitialized() || (application.isUnitTestMode() && myPostStartupActivitiesPassed)) {
    if (application.isDispatchThread()) {
      runnable.run();
    }
 else {
      application.invokeLater(new Runnable(){
        public void run(){
          if (!myProject.isDisposed()) {
            runnable.run();
          }
        }
      }
);
    }
  }
 else {
    registerPostStartupActivity(runnable);
  }
}
