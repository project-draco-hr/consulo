{
  Application app=ApplicationManager.getApplication();
  app.assertIsDispatchThread();
  if (myPostStartupActivitiesPassed)   return;
  final List<Runnable> dumbAware=CollectionFactory.arrayList();
  final List<Runnable> nonDumbAware=CollectionFactory.arrayList();
  for (  Runnable each : myPostStartupActivities) {
    if (each instanceof DumbAware) {
      dumbAware.add(each);
    }
 else {
      nonDumbAware.add(each);
    }
  }
  runActivities(dumbAware);
  DumbService.getInstance(myProject).runWhenSmart(new Runnable(){
    public void run(){
      if (myProject.isDisposed())       return;
      runActivities(nonDumbAware);
      myPostStartupActivitiesPassed=true;
      myPostStartupActivities.clear();
    }
  }
);
  if (!app.isUnitTestMode()) {
    VirtualFileManager.getInstance().refresh(!app.isHeadlessEnvironment());
  }
}
