{
  final Collection<VirtualFile> filesWeAlreadyHave=myMap.values();
  final Collection<VirtualFile> childrenToRemove=new ArrayList<VirtualFile>();
  for (  VirtualFile current : filesWeAlreadyHave) {
    if (current.equals(vf))     return false;
    if (VfsUtil.isAncestor(vf,current,false)) {
      childrenToRemove.add(current);
      continue;
    }
    if (childrenToRemove.isEmpty()) {
      if (VfsUtil.isAncestor(current,vf,false)) {
        return false;
      }
    }
  }
  for (  VirtualFile virtualFile : childrenToRemove) {
    myMap.removeByValue(virtualFile);
  }
  myMap.put(FilePathsHelper.convertWithLastSeparator(vf),vf);
  return true;
}
