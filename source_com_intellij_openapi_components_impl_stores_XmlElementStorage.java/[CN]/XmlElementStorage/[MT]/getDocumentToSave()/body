{
  final Document document=(Document)getDocument().clone();
  if (myPathMacroSubstitutor != null) {
    myPathMacroSubstitutor.reset();
    myPathMacroSubstitutor.collapsePaths(document.getRootElement());
    myUsedMacros=new HashSet<String>(myPathMacroSubstitutor.getUsedMacros());
  }
 else {
    myUsedMacros=new HashSet<String>();
  }
  return document;
}
