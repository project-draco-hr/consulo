{
  final Collection<FilePath> result=new ArrayList<FilePath>();
  final Ref<MyProgressHolder> inProgressHolderRef=new Ref<MyProgressHolder>();
  final Ref<MyProgressHolder> currentHolderRef=new Ref<MyProgressHolder>();
  myLife.doIfAlive(new Runnable(){
    public void run(){
      inProgressHolderRef.set(myProgressHolder.copy());
      currentHolderRef.set(new MyProgressHolder(new DirtBuilder(myDirtBuilder),null));
    }
  }
);
  final VcsInvalidated inProgressInvalidated=inProgressHolderRef.get() == null ? null : inProgressHolderRef.get().calculateInvalidated();
  final VcsInvalidated currentInvalidated=currentHolderRef.get() == null ? null : currentHolderRef.get().calculateInvalidated();
  for (  FilePath fp : files) {
    if (inProgressInvalidated != null && inProgressInvalidated.isFileDirty(fp) || currentInvalidated != null && currentInvalidated.isFileDirty(fp)) {
      result.add(fp);
    }
  }
  return result;
}
