{
  final JavaModuleExtensionImpl extension=ModuleUtilCore.getExtension(module,JavaModuleExtensionImpl.class);
  if (extension == null) {
    return null;
  }
switch (extension.getSpecialDirLocation()) {
case MODULE_DIR:
    return module.getModuleDirPath() + File.separator + name;
case SOURCE_DIR:
  ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(module);
final VirtualFile[] sourceRoots=moduleRootManager.getSourceRoots(false);
if (sourceRoots.length == 0) {
return null;
}
for (VirtualFile virtualFile : sourceRoots) {
final VirtualFile child=virtualFile.findChild(name);
if (child != null) {
return child.getPath();
}
}
return sourceRoots[0].getPath() + File.separator + name;
}
return null;
}
