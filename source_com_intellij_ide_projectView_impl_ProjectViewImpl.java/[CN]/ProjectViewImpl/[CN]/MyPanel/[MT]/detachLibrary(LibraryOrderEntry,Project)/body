{
  final Module module=orderEntry.getOwnerModule();
  String message=IdeBundle.message("detach.library.from.module",orderEntry.getPresentableName(),module.getName());
  String title=IdeBundle.message("detach.library");
  int ret=Messages.showOkCancelDialog(project,message,title,Messages.getQuestionIcon());
  if (ret != 0)   return;
  CommandProcessor.getInstance().executeCommand(module.getProject(),new Runnable(){
    public void run(){
      final Runnable action=new Runnable(){
        public void run(){
          ModifiableRootModel model=ModuleRootManager.getInstance(module).getModifiableModel();
          for (          OrderEntry entry : model.getOrderEntries()) {
            if (entry instanceof LibraryOrderEntry && ((LibraryOrderEntry)entry).getLibrary() == orderEntry.getLibrary()) {
              model.removeOrderEntry(entry);
            }
          }
          model.commit();
        }
      }
;
      ApplicationManager.getApplication().runWriteAction(action);
    }
  }
,title,null);
}
