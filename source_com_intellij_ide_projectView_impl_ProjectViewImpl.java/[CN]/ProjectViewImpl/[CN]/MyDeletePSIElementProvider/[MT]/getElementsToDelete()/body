{
  final AbstractProjectViewPane viewPane=getCurrentProjectViewPane();
  PsiElement[] elements=viewPane.getSelectedPSIElements();
  for (int idx=0; idx < elements.length; idx++) {
    final PsiElement element=elements[idx];
    if (element instanceof PsiDirectory) {
      final VirtualFile virtualFile=((PsiDirectory)element).getVirtualFile();
      final String path=virtualFile.getPath();
      if (path.endsWith(JarFileSystem.JAR_SEPARATOR)) {
        final VirtualFile vFile=LocalFileSystem.getInstance().findFileByPath(path.substring(0,path.length() - JarFileSystem.JAR_SEPARATOR.length()));
        if (vFile != null) {
          final PsiFile psiFile=PsiManager.getInstance(myProject).findFile(vFile);
          if (psiFile != null) {
            elements[idx]=psiFile;
          }
        }
      }
    }
  }
  return elements;
}
