{
  if ((e.getID() == WindowEvent.WINDOW_GAINED_FOCUS || e.getID() == WindowEvent.WINDOW_LOST_FOCUS) && e.getOppositeWindow() == null) {
    final Application app=ApplicationManager.getApplication();
    if (app instanceof ApplicationImpl) {
      if (e.getID() == WindowEvent.WINDOW_GAINED_FOCUS) {
        ourDeactivationAlarm.cancelAllRequests();
        ((ApplicationImpl)app).tryToApplyActivationState(e.getWindow(),true);
      }
 else {
        ourDeactivationAlarm.addRequest(new Runnable(){
          @Override public void run(){
            ((ApplicationImpl)app).tryToApplyActivationState(e.getWindow(),false);
          }
        }
,APP_DEACTIVATION_DELAY);
      }
    }
  }
}
