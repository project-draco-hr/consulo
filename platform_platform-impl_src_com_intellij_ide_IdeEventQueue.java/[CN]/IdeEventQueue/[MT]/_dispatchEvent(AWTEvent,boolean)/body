{
  if (e.getID() == MouseEvent.MOUSE_DRAGGED) {
    DnDManagerImpl dndManager=(DnDManagerImpl)DnDManager.getInstance();
    if (dndManager != null) {
      dndManager.setLastDropHandler(null);
    }
  }
  myEventCount++;
  if (processAppActivationEvents(e))   return;
  if (!typeaheadFlushing) {
    fixStickyFocusedComponents(e);
  }
  if (!myPopupManager.isPopupActive()) {
    enterSuspendModeIfNeeded(e);
  }
  myKeyboardBusy=(e instanceof KeyEvent) || peekEvent(KeyEvent.KEY_PRESSED) != null || peekEvent(KeyEvent.KEY_RELEASED) != null || peekEvent(KeyEvent.KEY_TYPED) != null;
  if (e instanceof KeyEvent) {
    if (e.getID() == KeyEvent.KEY_RELEASED && ((KeyEvent)e).getKeyCode() == KeyEvent.VK_SHIFT) {
      myMouseEventDispatcher.resetHorScrollingTracker();
    }
  }
  if (!typeaheadFlushing && typeAheadDispatchToFocusManager(e)) {
    return;
  }
  if (e instanceof WindowEvent) {
    ActivityTracker.getInstance().inc();
  }
  if (e instanceof MouseWheelEvent) {
    final MenuElement[] selectedPath=MenuSelectionManager.defaultManager().getSelectedPath();
    if (selectedPath != null && selectedPath.length > 0 && !(selectedPath[0] instanceof ComboPopup)) {
      ((MouseWheelEvent)e).consume();
      return;
    }
  }
  if (e instanceof KeyEvent || e instanceof MouseEvent) {
    ActivityTracker.getInstance().inc();
synchronized (myLock) {
      myIdleRequestsAlarm.cancelAllRequests();
      for (      Runnable idleListener : myIdleListeners) {
        final MyFireIdleRequest request=myListener2Request.get(idleListener);
        if (request == null) {
          LOG.error("There is no request for " + idleListener);
        }
        int timeout=request.getTimeout();
        myIdleRequestsAlarm.addRequest(request,timeout,ModalityState.NON_MODAL);
      }
      if (KeyEvent.KEY_PRESSED == e.getID() || KeyEvent.KEY_TYPED == e.getID() || MouseEvent.MOUSE_PRESSED == e.getID() || MouseEvent.MOUSE_RELEASED == e.getID() || MouseEvent.MOUSE_CLICKED == e.getID()) {
        addIdleTimeCounterRequest();
        for (        Runnable activityListener : myActivityListeners) {
          activityListener.run();
        }
      }
    }
  }
  if (myPopupManager.isPopupActive() && myPopupManager.dispatch(e)) {
    if (myKeyEventDispatcher.isWaitingForSecondKeyStroke()) {
      myKeyEventDispatcher.setState(KeyState.STATE_INIT);
    }
    return;
  }
  for (  EventDispatcher eachDispatcher : myDispatchers) {
    if (eachDispatcher.dispatch(e)) {
      return;
    }
  }
  if (e instanceof InputMethodEvent) {
    if (SystemInfo.isMac && myKeyEventDispatcher.isWaitingForSecondKeyStroke()) {
      return;
    }
  }
  if (e instanceof InputEvent && Patches.SPECIAL_WINPUT_METHOD_PROCESSING) {
    final InputEvent inputEvent=(InputEvent)e;
    if (!inputEvent.getComponent().isShowing()) {
      return;
    }
  }
  if (e instanceof ComponentEvent && myWindowManager != null) {
    myWindowManager.dispatchComponentEvent((ComponentEvent)e);
  }
  if (e instanceof KeyEvent) {
    if (mySuspendMode || !myKeyEventDispatcher.dispatchKeyEvent((KeyEvent)e)) {
      defaultDispatchEvent(e);
    }
 else {
      ((KeyEvent)e).consume();
      defaultDispatchEvent(e);
    }
  }
 else   if (e instanceof MouseEvent) {
    if (((MouseEvent)e).getButton() != 0) {
      setLastClickEvent((MouseEvent)e);
    }
 else     if (lastClickEvent != null && Math.abs(System.currentTimeMillis() - lastClickTime) > 200) {
      setLastClickEvent(null);
    }
    if (!myMouseEventDispatcher.dispatchMouseEvent((MouseEvent)e)) {
      defaultDispatchEvent(e);
    }
  }
 else {
    defaultDispatchEvent(e);
  }
}
