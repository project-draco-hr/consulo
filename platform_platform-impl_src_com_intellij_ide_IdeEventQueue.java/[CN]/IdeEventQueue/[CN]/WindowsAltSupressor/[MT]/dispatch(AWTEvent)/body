{
  boolean dispatch=true;
  if (e instanceof KeyEvent) {
    KeyEvent ke=(KeyEvent)e;
    final Component component=ke.getComponent();
    boolean pureAlt=ke.getKeyCode() == KeyEvent.VK_ALT && (ke.getModifiers() | InputEvent.ALT_MASK) == InputEvent.ALT_MASK;
    if (!pureAlt) {
      myWaitingForAltRelease=false;
    }
 else {
      if (ApplicationManager.getApplication() == null || UISettings.getInstance() == null || !SystemInfo.isWindows || !Registry.is("actionSystem.win.suppressAlt") || !(UISettings.getInstance().HIDE_TOOL_STRIPES || UISettings.getInstance().PRESENTATION_MODE)) {
        return true;
      }
      if (ke.getID() == KeyEvent.KEY_PRESSED) {
        dispatch=!myWaitingForAltRelease;
      }
 else       if (ke.getID() == KeyEvent.KEY_RELEASED) {
        if (myWaitingForAltRelease) {
          myWaitingForAltRelease=false;
          dispatch=false;
        }
 else         if (component != null) {
          SwingUtilities.invokeLater(new Runnable(){
            @Override public void run(){
              try {
                final Window window=UIUtil.getWindow(component);
                if (window == null || !window.isActive()) {
                  return;
                }
                myWaitingForAltRelease=true;
                if (myRobot == null) {
                  myRobot=new Robot();
                }
                myRobot.keyPress(KeyEvent.VK_ALT);
                myRobot.keyRelease(KeyEvent.VK_ALT);
              }
 catch (              AWTException e1) {
                LOG.debug(e1);
              }
            }
          }
);
        }
      }
    }
  }
  return !dispatch;
}
