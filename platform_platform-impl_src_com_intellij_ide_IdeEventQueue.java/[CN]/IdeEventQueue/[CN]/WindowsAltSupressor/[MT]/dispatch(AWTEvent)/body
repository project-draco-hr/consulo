{
  boolean dispatch=true;
  if (e instanceof KeyEvent) {
    KeyEvent ke=((KeyEvent)e);
    boolean pureAlt=ke.getKeyCode() == KeyEvent.VK_ALT && (ke.getModifiers() | KeyEvent.ALT_MASK) == KeyEvent.ALT_MASK;
    if (!pureAlt) {
      myPureAltWasPressed=false;
      myWaitingForAltRelease=false;
      myWaiterScheduled=false;
    }
 else {
      Application app=ApplicationManager.getApplication();
      if (app == null || !SystemInfo.isWindows || !Registry.is("actionSystem.win.supressAlt") || !UISettings.getInstance().HIDE_TOOL_STRIPES) {
        return !dispatch;
      }
      if (ke.getID() == KeyEvent.KEY_PRESSED) {
        myPureAltWasPressed=true;
        dispatch=!myWaitingForAltRelease;
      }
 else       if (ke.getID() == KeyEvent.KEY_RELEASED) {
        if (myWaitingForAltRelease) {
          myPureAltWasPressed=false;
          myWaitingForAltRelease=false;
          myWaiterScheduled=false;
          dispatch=false;
        }
 else {
          myWaiterScheduled=true;
          SwingUtilities.invokeLater(new Runnable(){
            @Override public void run(){
              try {
                myWaitingForAltRelease=true;
                if (myRobot == null) {
                  myRobot=new Robot();
                }
                myRobot.keyPress(KeyEvent.VK_ALT);
                myRobot.keyRelease(KeyEvent.VK_ALT);
              }
 catch (              AWTException e1) {
                LOG.debug(e1);
              }
            }
          }
);
        }
      }
    }
  }
  return !dispatch;
}
