{
  PsiElementFactory factory=JavaPsiFacade.getElementFactory(field.getProject());
  TemplateBuilderImpl builder=new TemplateBuilderImpl(field);
  if (!(expectedTypes instanceof ExpectedTypeInfo[])) {
    expectedTypes=ExpectedTypeInfo.EMPTY_ARRAY;
  }
  new GuessTypeParameters(factory).setupTypeElement(field.getTypeElement(),(ExpectedTypeInfo[])expectedTypes,substitutor,builder,context,targetClass);
  if (createConstantField) {
    field.setInitializer(factory.createExpressionFromText("0",null));
    builder.replaceElement(field.getInitializer(),new EmptyExpression());
  }
  PsiIdentifier identifier=field.getNameIdentifier();
  builder.setEndVariableAfter(identifier);
  field=CodeInsightUtilBase.forcePsiPostprocessAndRestoreElement(field);
  Template template=builder.buildTemplate();
  TextRange range=field.getTextRange();
  editor.getDocument().deleteString(range.getStartOffset(),range.getEndOffset());
  if (((ExpectedTypeInfo[])expectedTypes).length > 1)   template.setToShortenLongNames(false);
  return template;
}
