{
  PsiElementFactory factory=JavaPsiFacade.getElementFactory(field.getProject());
  field=CodeInsightUtilBase.forcePsiPostprocessAndRestoreElement(field);
  TemplateBuilderImpl builder=new TemplateBuilderImpl(field);
  if (!(expectedTypes instanceof ExpectedTypeInfo[])) {
    expectedTypes=ExpectedTypeInfo.EMPTY_ARRAY;
  }
  new GuessTypeParameters(factory).setupTypeElement(field.getTypeElement(),(ExpectedTypeInfo[])expectedTypes,substitutor,builder,context,targetClass);
  if (createConstantField) {
    field.setInitializer(factory.createExpressionFromText("0",null));
    builder.replaceElement(field.getInitializer(),new EmptyExpression());
    PsiIdentifier identifier=field.getNameIdentifier();
    builder.setEndVariableAfter(identifier);
    field=CodeInsightUtilBase.forcePsiPostprocessAndRestoreElement(field);
  }
  editor.getCaretModel().moveToOffset(field.getTextRange().getStartOffset());
  Template template=builder.buildInlineTemplate();
  if (((ExpectedTypeInfo[])expectedTypes).length > 1)   template.setToShortenLongNames(false);
  return template;
}
