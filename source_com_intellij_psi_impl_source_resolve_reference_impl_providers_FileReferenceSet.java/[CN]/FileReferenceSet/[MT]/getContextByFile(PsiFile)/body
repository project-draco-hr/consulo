{
  final Project project=file.getProject();
  final FileContextProvider contextProvider=FileContextProvider.getProvider(file);
  if (contextProvider != null) {
    final PsiFileSystemItem item=contextProvider.getContextFolder(file);
    if (item != null) {
      return Collections.singleton(item);
    }
    if (useIncludingFileAsContext()) {
      final PsiFile contextFile=contextProvider.getContextFile(file);
      if (contextFile != null) {
        return Collections.<PsiFileSystemItem>singleton(contextFile.getParent());
      }
    }
  }
  final VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile != null) {
    return FileReferenceHelperRegistrar.getNotNullHelper(file).getContexts(project,virtualFile);
  }
  final PsiDirectory parent=file.getParent();
  return parent == null ? Collections.<PsiFileSystemItem>emptyList() : Collections.<PsiFileSystemItem>singleton(parent);
}
