{
  String root=JavaTestUtil.getJavaTestDataPath() + "/refactoring/moveClassAndFile/" + testName;
  String rootBefore=root + "/before";
  PsiTestUtil.removeAllRoots(myModule,IdeaTestUtil.getMockJdk17());
  VirtualFile rootDir=PsiTestUtil.createTestProjectStructure(myProject,myModule,rootBefore,myFilesToDelete);
  performAction(newPackageName,fileNameNearFirstClass,classNames);
  String rootAfter=root + "/after";
  VirtualFile rootDir2=LocalFileSystem.getInstance().findFileByPath(rootAfter.replace(File.separatorChar,'/'));
  myProject.getComponent(PostprocessReformattingAspect.class).doPostponedFormatting();
  IdeaTestUtil.assertDirectoriesEqual(rootDir2,rootDir,IdeaTestUtil.CVS_FILE_FILTER);
}
