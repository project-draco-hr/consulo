{
  TreeElement child=firstChild;
  while (child != null) {
    final int textLength=child.getTextLength();
    if (textLength > offset) {
      if (child instanceof LeafElement) {
        if (((LeafElement)child).isChameleon()) {
          child=(TreeElement)ChameleonTransforming.transform((LeafElement)child);
          continue;
        }
 else         if (child instanceof ForeignLeafPsiElement) {
          continue;
        }
      }
      return child.findLeafElementAt(offset);
    }
    offset-=textLength;
    child=child.getTreeNext();
  }
  return null;
}
