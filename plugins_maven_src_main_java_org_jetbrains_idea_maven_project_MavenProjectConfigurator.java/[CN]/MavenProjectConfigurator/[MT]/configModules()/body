{
  final LinkedHashMap<MavenProjectModel,Module> modules=new LinkedHashMap<MavenProjectModel,Module>();
  myProjectModel.visit(new MavenProjectModelManager.SimpleVisitor(){
    public void visit(    MavenProjectModel each){
      Module m=createModule(each);
      modules.put(each,m);
    }
  }
);
  LinkedHashMap<Module,ModifiableRootModel> rootModels=new LinkedHashMap<Module,ModifiableRootModel>();
  for (  Map.Entry<MavenProjectModel,Module> each : modules.entrySet()) {
    if (each.getKey().isAggregator())     continue;
    ModifiableRootModel model=createModuleConfigurator(each.getValue(),each.getKey()).config();
    rootModels.put(each.getValue(),model);
  }
  for (  Map.Entry<MavenProjectModel,Module> each : modules.entrySet()) {
    if (each.getKey().isAggregator())     continue;
    createModuleConfigurator(each.getValue(),each.getKey()).preConfigFacets(rootModels.get(each.getValue()));
  }
  for (  Map.Entry<MavenProjectModel,Module> each : modules.entrySet()) {
    if (each.getKey().isAggregator())     continue;
    createModuleConfigurator(each.getValue(),each.getKey()).configFacets(rootModels.get(each.getValue()));
  }
  myRootModelsToCommit.addAll(rootModels.values());
  MavenProjectsManager.getInstance(myProject).setMavenizedModules(new ArrayList<Module>(modules.values()));
}
