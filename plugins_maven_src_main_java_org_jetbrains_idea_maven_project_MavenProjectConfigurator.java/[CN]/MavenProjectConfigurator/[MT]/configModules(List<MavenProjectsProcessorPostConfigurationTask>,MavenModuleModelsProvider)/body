{
  List<MavenProject> projects=getMavenProjectsToConfigure();
  Set<MavenProject> projectsWithNewlyCreatedModules=new HashSet<MavenProject>();
  for (  MavenProject each : projects) {
    if (ensureModuleCreated(each)) {
      projectsWithNewlyCreatedModules.add(each);
    }
  }
  LinkedHashMap<Module,MavenModuleConfigurator> configurators=new LinkedHashMap<Module,MavenModuleConfigurator>();
  for (  MavenProject each : projects) {
    Module module=myMavenProjectToModule.get(each);
    MavenModuleConfigurator c=createModuleConfigurator(module,each,rootModelsProvider);
    configurators.put(module,c);
    c.config(projectsWithNewlyCreatedModules.contains(each));
  }
  for (  MavenProject each : projects) {
    configurators.get(myMavenProjectToModule.get(each)).preConfigFacets();
  }
  for (  MavenProject each : projects) {
    configurators.get(myMavenProjectToModule.get(each)).configFacets(postTasks);
  }
  for (  MavenModuleConfigurator each : configurators.values()) {
    myRootModelsToCommit.add(each.getRootModel());
  }
  ArrayList<Module> modules=new ArrayList<Module>(myMavenProjectToModule.values());
  MavenProjectsManager.getInstance(myProject).setMavenizedModules(modules);
}
