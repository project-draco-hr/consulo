{
  myStartOffset=myEndOffset;
  advanceSegmentHighlighters();
  myCurrentFold=myFoldingModel.fetchOutermost(myStartOffset);
  if (myCurrentFold != null) {
    myEndOffset=myCurrentFold.getEndOffset();
  }
 else {
    myEndOffset=Math.min(getHighlighterEnd(myStartOffset),getSelectionEnd(myStartOffset));
    myEndOffset=Math.min(myEndOffset,getSegmentHighlightersEnd());
    myEndOffset=Math.min(myEndOffset,getFoldRangesEnd(myStartOffset));
    myEndOffset=Math.min(myEndOffset,getCaretEnd(myStartOffset));
    myEndOffset=Math.min(myEndOffset,getGuardedBlockEnd(myStartOffset));
  }
  reinit();
}
