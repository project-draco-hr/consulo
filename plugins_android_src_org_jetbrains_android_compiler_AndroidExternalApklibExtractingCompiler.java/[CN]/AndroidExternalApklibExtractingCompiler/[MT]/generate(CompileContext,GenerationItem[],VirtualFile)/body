{
  if (items == null || items.length == 0) {
    return new GenerationItem[0];
  }
  context.getProgressIndicator().setText(AndroidBundle.message("android.compile.messages.processing.external.apklib.dependencies"));
  final GenerationItem[] generatedItems=doGenerate(context,items);
  final Set<VirtualFile> generatedVFiles=new HashSet<VirtualFile>();
  final HashSet<VirtualFile> visited=new HashSet<VirtualFile>();
  for (  GenerationItem item : generatedItems) {
    final MyGenerationItem genItem=(MyGenerationItem)item;
    final File srcRoot=new File(genItem.getGenContentRootPath() + '/' + AndroidMavenUtil.APK_LIB_ARTIFACT_SOURCE_ROOT);
    final VirtualFile vSrcRoot=LocalFileSystem.getInstance().findFileByIoFile(srcRoot);
    if (vSrcRoot != null) {
      vSrcRoot.getParent().refresh(false,true);
      AndroidUtils.collectFiles(vSrcRoot,visited,generatedVFiles);
    }
  }
  if (context instanceof CompileContextEx) {
    ((CompileContextEx)context).markGenerated(generatedVFiles);
  }
  return generatedItems;
}
