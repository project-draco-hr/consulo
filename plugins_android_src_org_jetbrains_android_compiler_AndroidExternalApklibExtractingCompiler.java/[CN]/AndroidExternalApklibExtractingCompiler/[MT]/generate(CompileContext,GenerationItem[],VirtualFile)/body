{
  if (items == null || items.length == 0) {
    return new GenerationItem[0];
  }
  context.getProgressIndicator().setText(AndroidBundle.message("android.compile.messages.processing.external.apklib.dependencies"));
  final GenerationItem[] generatedItems=doGenerate(context,items);
  final Set<VirtualFile> generatedVFiles=new HashSet<VirtualFile>();
  final HashSet<VirtualFile> visited=new HashSet<VirtualFile>();
  for (  GenerationItem item : generatedItems) {
    final MyGenerationItem genItem=(MyGenerationItem)item;
    final File contentRoot=new File(genItem.getGenContentRootPath());
    final VirtualFile vContentRoot=LocalFileSystem.getInstance().findFileByIoFile(contentRoot);
    if (vContentRoot != null) {
      vContentRoot.refresh(false,true);
      final VirtualFile vSrcRoot=vContentRoot.findChild(AndroidMavenUtil.APK_LIB_ARTIFACT_SOURCE_ROOT);
      if (vSrcRoot != null) {
        AndroidCompileUtil.markDirty(vSrcRoot,true);
        AndroidUtils.collectFiles(vSrcRoot,visited,generatedVFiles);
      }
    }
  }
  if (context instanceof CompileContextEx) {
    ((CompileContextEx)context).markGenerated(generatedVFiles);
  }
  return generatedItems;
}
