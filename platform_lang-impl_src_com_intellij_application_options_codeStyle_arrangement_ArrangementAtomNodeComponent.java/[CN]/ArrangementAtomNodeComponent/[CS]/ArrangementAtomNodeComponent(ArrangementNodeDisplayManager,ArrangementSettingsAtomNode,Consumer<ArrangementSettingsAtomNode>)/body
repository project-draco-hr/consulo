{
  mySettingsNode=node;
  myLabel.setHorizontalAlignment(SwingConstants.CENTER);
  myLabel.setText(manager.getDisplayValue(node));
  int width=manager.getMaxWidth(node.getType());
  int height=myLabel.getPreferredSize().height;
  final ArrangementRemoveConditionAction action;
  if (closeCallback == null) {
    myCloseButton=null;
    action=null;
  }
 else {
    action=new ArrangementRemoveConditionAction();
    Icon buttonIcon=action.getTemplatePresentation().getIcon();
    Dimension buttonSize=new Dimension(buttonIcon.getIconWidth(),buttonIcon.getIconHeight());
    myCloseButton=new ActionButton(action,action.getTemplatePresentation().clone(),ArrangementConstants.RULE_TREE_PLACE,buttonSize){
      @Override protected Icon getIcon(){
        return myCloseButtonHovered ? action.getTemplatePresentation().getHoveredIcon() : action.getTemplatePresentation().getIcon();
      }
    }
;
    Dimension preferredButtonSize=myCloseButton.getPreferredSize();
    width+=preferredButtonSize.width;
    height=Math.max(height,preferredButtonSize.height);
  }
  mySize=new Dimension(width,height);
  GridBagConstraints constraints=new GridBag().anchor(GridBagConstraints.CENTER).insets(0,0,0,0);
  JPanel labelPanel=new JPanel(new GridBagLayout()){
    @Override public void paint(    Graphics g){
      Rectangle buttonBounds=getCloseButtonScreenLocation();
      if (buttonBounds != null && action != null) {
        Point mouseScreenLocation=MouseInfo.getPointerInfo().getLocation();
        myCloseButtonHovered=buttonBounds.contains(mouseScreenLocation);
      }
      super.paint(g);
    }
  }
;
  myLabel.setBackground(Color.red);
  labelPanel.add(myLabel,constraints);
  if (myCloseButton != null) {
    labelPanel.add(myCloseButton,new GridBag().anchor(GridBagConstraints.EAST).insets(0,0,0,0));
  }
  labelPanel.setBorder(IdeBorderFactory.createEmptyBorder(PADDING));
  labelPanel.setOpaque(false);
  final int arcSize=myLabel.getFont().getSize();
  JPanel roundBorderPanel=new JPanel(new GridBagLayout()){
    @Override public void paint(    Graphics g){
      Color color=mySelected ? UIUtil.getTreeSelectionBackground() : UIUtil.getTabbedPaneBackground();
      Rectangle bounds=getBounds();
      g.setColor(color);
      g.fillRoundRect(0,0,bounds.width,bounds.height,arcSize,arcSize);
      super.paint(g);
    }
  }
;
  roundBorderPanel.add(labelPanel);
  roundBorderPanel.setBorder(IdeBorderFactory.createRoundedBorder(arcSize));
  roundBorderPanel.setOpaque(false);
  myRenderer.setBorder(IdeBorderFactory.createEmptyBorder(PADDING));
  myRenderer.add(roundBorderPanel,constraints);
  myRenderer.setOpaque(false);
}
