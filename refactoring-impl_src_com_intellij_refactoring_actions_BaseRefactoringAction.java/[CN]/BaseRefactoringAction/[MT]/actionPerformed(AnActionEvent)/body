{
  DataContext dataContext=e.getDataContext();
  final Project project=(Project)dataContext.getData(DataConstants.PROJECT);
  if (project == null)   return;
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  final Editor editor=(Editor)dataContext.getData(DataConstants.EDITOR);
  final PsiElement[] elements=getPsiElementArray(dataContext);
  RefactoringActionHandler handler=getHandler(dataContext);
  if (handler == null)   return;
  if (editor != null) {
    final PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
    if (file == null)     return;
    handler.invoke(project,editor,file,dataContext);
  }
 else {
    handler.invoke(project,elements,dataContext);
  }
}
