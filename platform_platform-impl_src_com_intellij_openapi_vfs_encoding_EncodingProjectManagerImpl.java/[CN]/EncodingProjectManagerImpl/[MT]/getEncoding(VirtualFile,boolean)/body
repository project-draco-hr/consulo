{
  VirtualFile parent=virtualFile;
  while (true) {
    Charset charset=myMapping.get(parent);
    if (charset != null || !useParentDefaults)     return charset;
    if (parent == null)     break;
    parent=parent.getParent();
  }
  return getDefaultCharset();
}
