{
  startReloadWithProgress(new Runnable(){
    @Override public void run(){
      processSubFiles(root,new Processor<VirtualFile>(){
        @Override public boolean process(        final VirtualFile file){
          if (!(file instanceof VirtualFileSystemEntry))           return true;
          Document cachedDocument=FileDocumentManager.getInstance().getCachedDocument(file);
          if (cachedDocument != null) {
            ProgressManager.progress("Reloading file...",file.getPresentableUrl());
            UIUtil.invokeLaterIfNeeded(new Runnable(){
              @Override public void run(){
                reload(file);
              }
            }
);
          }
 else           if (file.isCharsetSet()) {
            file.setCharset(null);
          }
          return true;
        }
      }
);
    }
  }
);
}
