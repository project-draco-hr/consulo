{
  if (!myRenameOrMoveCached) {
    myRenameOrMoveCached=true;
    if (myBeforeRevision != null && myAfterRevision != null && !myBeforeRevision.getFile().equals(myAfterRevision.getFile())) {
      if (myBeforeRevision.getFile().getParentPath().equals(myAfterRevision.getFile().getParentPath())) {
        myRenamed=true;
      }
 else {
        myMoved=true;
      }
    }
  }
  if (myMoved && myMoveRelativePath == null && project != null) {
    final VirtualFile oldFile=myBeforeRevision.getFile().getParentPath().getVirtualFile();
    final VirtualFile newFile=myAfterRevision.getFile().getParentPath().getVirtualFile();
    if (oldFile != null && newFile != null) {
      Module oldModule=ModuleUtil.findModuleForFile(oldFile,project);
      Module newModule=ModuleUtil.findModuleForFile(newFile,project);
      if (oldModule != newModule) {
        myMoveRelativePath=ProjectLevelVcsManager.getInstance(project).getPresentableRelativePathFor(oldFile);
      }
    }
    if (myMoveRelativePath == null) {
      myMoveRelativePath=FileUtil.getRelativePath(myAfterRevision.getFile().getIOFile(),myBeforeRevision.getFile().getIOFile());
    }
  }
}
