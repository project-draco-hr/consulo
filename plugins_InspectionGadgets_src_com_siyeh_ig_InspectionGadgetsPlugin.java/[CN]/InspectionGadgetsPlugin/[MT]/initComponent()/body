{
  final RegistryValue registryValue=Registry.get("inspectionGadgets.telemetry.enabled");
  telemetryEnabled=registryValue.asBoolean();
  if (telemetryEnabled) {
    telemetry=new InspectionGadgetsTelemetry();
  }
  registryValue.addListener(new RegistryValueListener.Adapter(){
    @Override public void afterValueChanged(    RegistryValue registryValue){
      telemetryEnabled=registryValue.asBoolean();
      final ProjectManager projectManager=ProjectManager.getInstance();
      final Project[] openProjects=projectManager.getOpenProjects();
      if (telemetryEnabled) {
        telemetry=new InspectionGadgetsTelemetry();
        for (        Project project : openProjects) {
          final TelemetryToolWindow toolWindow=new TelemetryToolWindow(telemetry);
          toolWindow.register(project);
        }
      }
 else {
        for (        Project project : openProjects) {
          TelemetryToolWindow.unregister(project);
        }
        telemetry=null;
      }
    }
  }
,ApplicationManager.getApplication());
}
