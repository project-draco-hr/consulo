{
  ChangeContextUtil.encodeFileReferences(file);
  PsiManager manager=file.getManager();
  if (!newDirectory.equals(file.getContainingDirectory())) {
    manager.moveFile(file,newDirectory);
  }
  ChangeContextUtil.decodeFileReferences(file);
}
