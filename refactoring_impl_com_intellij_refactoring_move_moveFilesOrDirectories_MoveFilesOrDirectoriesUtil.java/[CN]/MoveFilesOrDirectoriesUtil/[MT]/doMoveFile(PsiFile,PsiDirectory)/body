{
  FileReferenceContextUtil.encodeFileReferences(file);
  PsiManager manager=file.getManager();
  if (!newDirectory.equals(file.getContainingDirectory())) {
    manager.moveFile(file,newDirectory);
  }
  FileReferenceContextUtil.decodeFileReferences(file);
}
