{
  if (psiFile == null) {
    return false;
  }
  if (psiFile instanceof PsiCodeFragment) {
    return false;
  }
  final VirtualFile file=psiFile.getVirtualFile();
  if (file == null) {
    return false;
  }
  Module module=ModuleUtilCore.findModuleForPsiElement(psiFile);
  if (module == null) {
    return false;
  }
  ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(module);
  if (moduleRootManager.getExtension(JavaModuleExtensionImpl.class) == null) {
    return true;
  }
  final ProjectFileIndex projectFileIndex=ProjectRootManager.getInstance(psiFile.getProject()).getFileIndex();
  return !projectFileIndex.isInSource(file) && !projectFileIndex.isInLibraryClasses(file);
}
