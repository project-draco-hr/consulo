{
  FileTypeManager fileTypeManager=FileTypeManager.getInstance();
  if (file.isDirectory()) {
    return false;
  }
  if (file.getFileType() != StdFileTypes.JAVA && !withLibrary) {
    return false;
  }
  if (fileTypeManager.isFileIgnored(file)) {
    return false;
  }
  if (!withLibrary) {
    Module module=ModuleUtilCore.findModuleForFile(file,project);
    if (module == null) {
      return false;
    }
    ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(module);
    if (moduleRootManager.getExtension(JavaModuleExtensionImpl.class) == null) {
      return false;
    }
  }
  final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  return fileIndex.isInSource(file) || withLibrary && fileIndex.isInLibraryClasses(file);
}
