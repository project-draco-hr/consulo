{
  Executor executor=ExecutorRegistry.getInstance().getExecutorById(executorId);
  if (executor == null)   return null;
  String runnerId=getRunnerId(executorId);
  if (runnerId == null)   return null;
  ProgramRunner runner=RunnerRegistry.getInstance().findRunnerById(runnerId);
  if (runner == null)   return null;
  AbstractExternalSystemTaskConfigurationType configurationType=findConfigurationType(externalSystemId);
  if (configurationType == null)   return null;
  String name=AbstractExternalSystemTaskConfigurationType.generateName(project,taskSettings);
  RunnerAndConfigurationSettings settings=RunManager.getInstance(project).createRunConfiguration(name,configurationType.getFactory());
  ExternalSystemRunConfiguration runConfiguration=(ExternalSystemRunConfiguration)settings.getConfiguration();
  runConfiguration.getSettings().setExternalProjectPath(taskSettings.getExternalProjectPath());
  runConfiguration.getSettings().setTaskNames(ContainerUtil.newArrayList(taskSettings.getTaskNames()));
  runConfiguration.getSettings().setTaskDescriptions(ContainerUtil.newArrayList(taskSettings.getTaskDescriptions()));
  runConfiguration.getSettings().setVmOptions(taskSettings.getVmOptions());
  runConfiguration.getSettings().setScriptParameters(taskSettings.getScriptParameters());
  runConfiguration.getSettings().setExecutionName(taskSettings.getExecutionName());
  return Pair.create(runner,new ExecutionEnvironment(executor,runner,settings,project));
}
