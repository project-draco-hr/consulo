{
  if (externalProject == null) {
    return;
  }
  Collection<DataNode<ModuleData>> moduleNodes=ExternalSystemApiUtil.findAll(externalProject,ProjectKeys.MODULE);
  for (  DataNode<ModuleData> node : moduleNodes) {
    myExternalModulePaths.add(node.getData().getLinkedExternalProjectPath());
  }
  ExternalSystemApiUtil.executeProjectChangeAction(true,new DisposeAwareProjectChange(myProject){
    @Override public void execute(){
      ProjectRootManagerEx.getInstanceEx(myProject).mergeRootsChangesDuring(new Runnable(){
        @Override public void run(){
          myProjectDataManager.importData(externalProject.getKey(),Collections.singleton(externalProject),myProject,true);
        }
      }
);
      processOrphanProjectLibraries();
    }
  }
);
  if (--myCounter[0] <= 0) {
    processOrphanModules();
  }
}
