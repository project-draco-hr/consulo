{
  final Project[] project=new Project[]{p};
  ProjectReloadState.getInstance(project[0]).onBeforeAutomaticProjectReload();
  final Application application=ApplicationManager.getApplication();
  application.invokeLater(new Runnable(){
    public void run(){
      LOG.info("Reloading project.");
      ProjectImpl projectImpl=(ProjectImpl)project[0];
      IProjectStore projectStore=projectImpl.getStateStore();
      final String location=projectImpl.getLocation();
      final List<IFile> original;
      try {
        final IComponentStore.SaveSession saveSession=projectStore.startSave();
        original=saveSession.getAllStorageFiles(true);
        saveSession.finishSave();
      }
 catch (      IOException e) {
        LOG.error(e);
        return;
      }
      if (project[0].isDisposed() || ProjectUtil.closeProject(project[0])) {
        application.runWriteAction(new Runnable(){
          public void run(){
            for (            final IFile originalFile : original) {
              restoreCopy(LocalFileSystem.getInstance().refreshAndFindFileByIoFile(originalFile));
            }
          }
        }
);
        project[0]=null;
        if (takeMemorySnapshot) {
          ProfilingUtil.forceCaptureMemorySnapshot();
        }
        ProjectUtil.openProject(location,null,true);
      }
    }
  }
,ModalityState.NON_MODAL);
}
