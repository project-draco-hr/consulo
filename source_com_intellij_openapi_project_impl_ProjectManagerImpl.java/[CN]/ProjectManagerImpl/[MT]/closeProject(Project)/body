{
  if (!isProjectOpened(project))   return true;
  if (!canClose(project))   return false;
  fireProjectClosing(project);
  ShutDownTracker.getInstance().registerStopperThread(Thread.currentThread());
  try {
    FileDocumentManager.getInstance().saveAllDocuments();
    project.save();
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      public void run(){
        myOpenProjects.remove(project);
        fireProjectClosed(project);
        Disposer.dispose(project);
      }
    }
);
    ApplicationManagerEx.getApplicationEx().saveSettings();
  }
  finally {
    ShutDownTracker.getInstance().unregisterStopperThread(Thread.currentThread());
  }
  return true;
}
