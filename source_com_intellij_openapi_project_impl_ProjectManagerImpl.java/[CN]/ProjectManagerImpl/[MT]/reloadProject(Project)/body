{
  ProjectReloadState.getInstance(project).onBeforeAutomaticProjectReload();
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      LOG.info("Reloading project.");
      final String path=project.getProjectFilePath();
      final List<VirtualFile> original=getAllProjectFiles(project);
      if (project.isDisposed() || ProjectUtil.closeProject(project)) {
        ApplicationManager.getApplication().runWriteAction(new Runnable(){
          public void run(){
            for (            final VirtualFile aOriginal : original) {
              restoreCopy(aOriginal);
            }
          }
        }
);
        ProjectUtil.openProject(path,null,true);
      }
    }
  }
,ModalityState.NON_MMODAL);
}
