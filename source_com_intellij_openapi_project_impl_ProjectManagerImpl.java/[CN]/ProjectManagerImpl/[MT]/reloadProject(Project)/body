{
  ProjectReloadState.getInstance(project).onBeforeAutomaticProjectReload();
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      LOG.info("Reloading project after external change.");
      final String path=project.getProjectFilePath();
      final List<VirtualFile> original=getAllProjectFiles(project);
      if (project.isDisposed() || ProjectUtil.closeProject(project)) {
        ApplicationManager.getApplication().runWriteAction(new Runnable(){
          public void run(){
            for (Iterator<VirtualFile> iterator=original.iterator(); iterator.hasNext(); ) {
              restoreCopy(iterator.next());
            }
          }
        }
);
        ProjectUtil.openProject(path,null,true);
      }
    }
  }
,ModalityState.NON_MMODAL);
}
