{
  if (expression instanceof PsiPolyadicExpression) {
    final PsiPolyadicExpression polyadicExpression=(PsiPolyadicExpression)expression;
    final IElementType tokenType=polyadicExpression.getOperationTokenType();
    final PsiElement parent=expression.getParent();
    if (parent instanceof PsiPolyadicExpression) {
      final PsiPolyadicExpression parentPolyadicExpression=(PsiPolyadicExpression)parent;
      final IElementType parentOperationSign=parentPolyadicExpression.getOperationTokenType();
      if (!tokenType.equals(parentOperationSign)) {
        out.append('(');
        createText(polyadicExpression,out);
        out.append(')');
        return out;
      }
    }
 else     if (parent instanceof PsiConditionalExpression || parent instanceof PsiInstanceOfExpression) {
      out.append('(');
      createText(polyadicExpression,out);
      out.append(')');
      return out;
    }
    createText(polyadicExpression,out);
  }
 else   if (expression instanceof PsiParenthesizedExpression) {
    final PsiParenthesizedExpression parenthesizedExpression=(PsiParenthesizedExpression)expression;
    final PsiExpression unwrappedExpression=parenthesizedExpression.getExpression();
    out.append('(');
    createReplacementText(unwrappedExpression,out);
    out.append(')');
  }
 else   if (expression instanceof PsiInstanceOfExpression) {
    out.append('(');
    out.append(expression.getText());
    out.append(')');
  }
 else   if (expression != null) {
    out.append(expression.getText());
  }
  return out;
}
