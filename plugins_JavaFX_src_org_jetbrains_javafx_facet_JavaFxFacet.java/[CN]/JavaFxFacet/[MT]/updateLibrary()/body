{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      final Module module=getModule();
      final ModifiableRootModel model=ModuleRootManager.getInstance(module).getModifiableModel();
      boolean modelChanged=false;
      final Sdk sdk=JavaFxSdkUtil.getSdk(JavaFxFacet.this);
      final String name=(sdk != null) ? getFacetLibraryName(sdk.getName()) : null;
      boolean librarySeen=false;
      for (      OrderEntry entry : model.getOrderEntries()) {
        if (entry instanceof LibraryOrderEntry) {
          final String libraryName=((LibraryOrderEntry)entry).getLibraryName();
          if (name != null && name.equals(libraryName)) {
            librarySeen=true;
            continue;
          }
          if (libraryName != null && StringUtil.startsWith(libraryName,JAVAFX_FACET_LIBRARY_PREFIX)) {
            model.removeOrderEntry(entry);
            modelChanged=true;
          }
        }
      }
      if (!librarySeen && name != null) {
        Library library=LibraryTablesRegistrar.getInstance().getLibraryTable().getLibraryByName(name);
        if (library == null) {
          library=JavaFxSdkListener.addLibrary(sdk);
        }
        model.addLibraryEntry(library);
        modelChanged=true;
      }
      if (modelChanged) {
        model.commit();
      }
 else {
        model.dispose();
      }
    }
  }
);
}
