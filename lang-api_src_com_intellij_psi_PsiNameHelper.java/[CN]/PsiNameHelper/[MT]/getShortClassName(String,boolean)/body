{
  final char[] chars=referenceText.toCharArray();
  int lessPos=chars.length;
  int count=0;
  for (int i=chars.length - 1; i >= 0; i--) {
    final char aChar=chars[i];
switch (aChar) {
case ')':
case '>':
      count++;
    break;
case '(':
case '<':
  count--;
lessPos=i;
break;
case '@':
case '.':
if (count == 0) return new String(chars,i + 1,lessPos - (i + 1)).trim();
break;
default :
if (count == 0) {
if (Character.isWhitespace(aChar)) {
break;
}
 else if (flag && !Character.isJavaIdentifierPart(aChar)) {
return getShortClassName(removeWhitespace(referenceText),false);
}
}
}
}
return new String(chars,0,lessPos).trim();
}
