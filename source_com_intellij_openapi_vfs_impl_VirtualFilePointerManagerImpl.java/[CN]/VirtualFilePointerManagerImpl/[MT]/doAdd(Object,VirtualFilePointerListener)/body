{
  flushQueue();
  MyWeakReference<VirtualFilePointer> weakReference=myUrlToPointerMap.get(url);
  VirtualFilePointer existingPointer=weakReference != null ? weakReference.get() : null;
  final boolean notexists=existingPointer == null;
  if (notexists) {
    existingPointer=url instanceof String ? new VirtualFilePointerImpl((String)url,myVirtualFileManager) : new VirtualFilePointerImpl((VirtualFile)url,myVirtualFileManager);
    weakReference=new MyWeakReference<VirtualFilePointer>(existingPointer,myReferenceQueue,url);
    myUrlToPointerMap.put(url,weakReference);
  }
  if (listener != null) {
    THashSet<VirtualFilePointer> pointerSet=myListenerToPointersMap.get(listener);
    if (pointerSet == null) {
      pointerSet=new THashSet<VirtualFilePointer>();
      myListenerToPointersMap.put(listener,pointerSet);
    }
    pointerSet.add(existingPointer);
  }
  return existingPointer;
}
