{
synchronized (this) {
    if (listener != null) {
      THashSet<VirtualFilePointer> virtualFilePointers=myListenerToPointersMap.get(listener);
      if (virtualFilePointers == null) {
        virtualFilePointers=new THashSet<VirtualFilePointer>();
        myListenerToPointersMap.put(listener,virtualFilePointers);
      }
      virtualFilePointers.add(pointer);
    }
    flushQueue();
  }
  return pointer;
}
