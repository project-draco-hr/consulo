{
  final HashMap<VirtualFilePointerListener,ArrayList<VirtualFilePointer>> listenerToArrayOfPointers=new HashMap<VirtualFilePointerListener,ArrayList<VirtualFilePointer>>();
synchronized (this) {
    Set<VirtualFilePointer> visitedPointers=new HashSet<VirtualFilePointer>(myUrlToPointerMap.size());
    for (    Map.Entry<VirtualFilePointerListener,THashSet<VirtualFilePointer>> entry : myListenerToPointersMap.entrySet()) {
      ArrayList<VirtualFilePointer> list=null;
      for (      VirtualFilePointer _pointer : entry.getValue()) {
        VirtualFilePointerImpl pointer=(VirtualFilePointerImpl)_pointer;
        if (listenerNotifier.processPointer(pointer)) {
          if (list == null) {
            list=new ArrayList<VirtualFilePointer>();
            listenerToArrayOfPointers.put(entry.getKey(),list);
          }
          visitedPointers.add(pointer);
          list.add(pointer);
        }
      }
    }
    for (    WeakReference<VirtualFilePointer> pointer : myUrlToPointerMap.values()) {
      final VirtualFilePointer filePointer=pointer.get();
      if (filePointer != null && !visitedPointers.contains(filePointer)) {
        visitedPointers.add(filePointer);
        listenerNotifier.processPointer((VirtualFilePointerImpl)filePointer);
      }
    }
  }
  iterateMap(listenerToArrayOfPointers,listenerNotifier);
  return listenerToArrayOfPointers;
}
