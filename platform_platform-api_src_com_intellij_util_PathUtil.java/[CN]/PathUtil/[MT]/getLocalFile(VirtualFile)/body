{
  if (!file.isValid()) {
    return file;
  }
  if (file.getFileSystem() instanceof JarFileSystem) {
    final VirtualFile jarFile=JarFileSystem.getInstance().getVirtualFileForJar(file);
    if (jarFile != null) {
      return jarFile;
    }
  }
  return file;
}
