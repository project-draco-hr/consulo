{
  Project project=method.getProject();
  PsiElementFactory factory=method.getManager().getElementFactory();
  PsiMethod newMethod;
  PsiTypeParameter[] typeParams=method.getTypeParameterList().getTypeParameters();
  try {
    PsiType returnType=method.getReturnType();
    if (method.isConstructor()) {
      newMethod=factory.createConstructor();
      newMethod.getNameIdentifier().replace(factory.createIdentifier(method.getName()));
    }
 else {
      newMethod=factory.createMethod(method.getName(),substitutor.substitute(returnType));
    }
    newMethod.getModifierList().setModifierProperty(PsiModifier.PUBLIC,method.hasModifierProperty(PsiModifier.PUBLIC));
    PsiDocComment docComment=((PsiMethod)method.getNavigationElement()).getDocComment();
    if (docComment != null) {
      newMethod.addAfter(docComment,null);
    }
    PsiParameter[] parameters=method.getParameterList().getParameters();
    CodeStyleManager codeStyleManager=CodeStyleManager.getInstance(project);
    Map<PsiType,Pair<String,Integer>> m=new HashMap<PsiType,Pair<String,Integer>>();
    for (int i=0; i < parameters.length; i++) {
      PsiParameter parameter=parameters[i];
      PsiType paramType=substitutor.substitute(parameter.getType());
      String paramName=parameter.getName();
      if (paramName == null) {
        Pair<String,Integer> pair=m.get(paramType);
        if (pair != null) {
          paramName=pair.first + pair.second;
          m.put(paramType,Pair.create(pair.first,new Integer(pair.second.intValue() + 1)));
        }
 else {
          String[] names=codeStyleManager.suggestVariableName(VariableKind.PARAMETER,null,null,paramType).names;
          if (names.length > 0) {
            paramName=names[0];
          }
 else           paramName="p" + i;
          m.put(paramType,new Pair<String,Integer>(paramName,new Integer(1)));
        }
      }
      if (paramName == null)       paramName="p" + i;
      PsiParameter newParameter=factory.createParameter(paramName,paramType);
      newMethod.getParameterList().add(newParameter);
    }
    for (int i=0; i < typeParams.length; i++) {
      if (substitutor.substitute(typeParams[i]) != null)       newMethod.getTypeParameterList().add(typeParams[i]);
    }
    PsiClassType[] thrownTypes=method.getThrowsList().getReferencedTypes();
    for (int i=0; i < thrownTypes.length; i++) {
      PsiType thrownType=substitutor.substitute(thrownTypes[i]);
      newMethod.getThrowsList().add(factory.createReferenceElementByType((PsiClassType)thrownType));
    }
    return newMethod;
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
  return method;
}
