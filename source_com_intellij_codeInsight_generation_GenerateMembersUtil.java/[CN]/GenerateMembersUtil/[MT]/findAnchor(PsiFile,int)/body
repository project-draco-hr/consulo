{
  PsiElement element=file.findElementAt(offset);
  if (element == null)   return null;
  while (true) {
    if (element instanceof PsiFile)     return null;
    PsiElement parent=element.getParent();
    if (parent instanceof PsiClass && !(parent instanceof PsiTypeParameter)) {
      if (((PsiClass)parent).isEnum()) {
        PsiElement lastChild=null;
        PsiElement[] children=parent.getChildren();
        for (int i=0; i < children.length; i++) {
          PsiElement child=children[i];
          if (child instanceof PsiJavaToken && ";".equals(child.getText())) {
            lastChild=child;
            break;
          }
 else           if ((child instanceof PsiJavaToken && ",".equals(child.getText())) || child instanceof PsiEnumConstant) {
            lastChild=child;
            continue;
          }
        }
        if (lastChild != null) {
          int adjustedOffset=lastChild.getTextRange().getEndOffset();
          if (offset < adjustedOffset)           return findAnchor(file,adjustedOffset);
        }
      }
      break;
    }
    element=parent;
  }
  return element;
}
