{
  if (!CodeInsightUtil.prepareFileForWrite(file))   return;
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      final PsiManager manager=PsiManager.getInstance(project);
      final List<PsiClass> classesToImport=getClassesToImport(manager);
      PsiClass[] classes=classesToImport.toArray(new PsiClass[classesToImport.size()]);
      if (classes.length == 0)       return;
      CodeInsightUtil.sortIdenticalShortNameClasses(classes);
      final AddImportAction action=new AddImportAction(project,myRef,classes,editor);
      action.execute();
    }
  }
);
}
