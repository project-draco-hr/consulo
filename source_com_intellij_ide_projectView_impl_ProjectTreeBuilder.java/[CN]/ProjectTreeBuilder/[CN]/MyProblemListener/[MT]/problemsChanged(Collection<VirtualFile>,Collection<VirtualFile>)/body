{
  Set<VirtualFile> filesToRefresh=new THashSet<VirtualFile>(added);
  filesToRefresh.addAll(removed);
synchronized (myFilesToRefresh) {
    if (myFilesToRefresh.addAll(filesToRefresh)) {
      myUpdateProblemAlarm.cancelAllRequests();
      myUpdateProblemAlarm.addRequest(new Runnable(){
        public void run(){
          Set<VirtualFile> filesToRefresh;
synchronized (myFilesToRefresh) {
            filesToRefresh=new THashSet<VirtualFile>(myFilesToRefresh);
          }
          updateNodesContaining(filesToRefresh,myRootNode);
synchronized (myFilesToRefresh) {
            myFilesToRefresh.removeAll(filesToRefresh);
          }
        }
      }
,200,ModalityState.NON_MMODAL);
    }
  }
}
