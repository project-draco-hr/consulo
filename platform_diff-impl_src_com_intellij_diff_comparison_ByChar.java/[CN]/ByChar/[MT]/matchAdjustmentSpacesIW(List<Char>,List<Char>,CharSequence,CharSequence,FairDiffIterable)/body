{
  final List<Range> ranges=new ArrayList<Range>();
  for (  Range ch : changes.iterateChanges()) {
    int startOffset1;
    int endOffset1;
    if (ch.start1 == ch.end1) {
      startOffset1=endOffset1=expandForwardW(chars1,chars2,text1,text2,ch,true);
    }
 else {
      startOffset1=chars1.get(ch.start1).getOffset();
      endOffset1=chars1.get(ch.end1 - 1).getOffset() + 1;
    }
    int startOffset2;
    int endOffset2;
    if (ch.start2 == ch.end2) {
      startOffset2=endOffset2=expandForwardW(chars1,chars2,text1,text2,ch,false);
    }
 else {
      startOffset2=chars2.get(ch.start2).getOffset();
      endOffset2=chars2.get(ch.end2 - 1).getOffset() + 1;
    }
    ranges.add(new Range(startOffset1,endOffset1,startOffset2,endOffset2));
  }
  return create(ranges,text1.length(),text2.length());
}
