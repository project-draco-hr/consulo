{
  super(true,updater);
  myProject=project;
  myCopyrightProfile=copyrightProfile;
  myDisplayName=myCopyrightProfile.getName();
  myWholePanel=new JPanel(new VerticalFlowLayout());
  myCopyrightEditorPanel=new JEditorPane();
  myCopyrightEditorPanel.setFont(EditorColorsManager.getInstance().getGlobalScheme().getFont(EditorFontType.PLAIN));
  DefaultActionGroup group=new DefaultActionGroup();
  group.add(new AnAction("Preview",null,AllIcons.Actions.Preview){
    @Override public void actionPerformed(    AnActionEvent e){
      try {
        String evaluate=VelocityHelper.evaluate(null,project,null,myCopyrightEditorPanel.getText());
        new PreviewDialog(project,evaluate,myCopyrightEditorPanel.getSize()).show();
      }
 catch (      Exception e1) {
        Messages.showErrorDialog(myProject,"Template contains error:\n" + e1.getMessage(),"Preview");
      }
    }
  }
);
  PredefinedCopyrightTextEP[] extensions=PredefinedCopyrightTextEP.EP_NAME.getExtensions();
  if (extensions.length > 0) {
    group.add(new AnAction("Reset To",null,AllIcons.Actions.Reset){
      @Override public void actionPerformed(      AnActionEvent e){
        DefaultActionGroup actionGroup=new DefaultActionGroup();
        for (        PredefinedCopyrightTextEP extension : extensions) {
          actionGroup.add(new AnAction(extension.name){
            @Override public void actionPerformed(            AnActionEvent e){
              String text=extension.getText();
              myCopyrightEditorPanel.setText(text);
            }
          }
);
        }
        ActionPopupMenu popupMenu=ActionManager.getInstance().createActionPopupMenu(ActionPlaces.UNKNOWN,actionGroup);
        popupMenu.getComponent().show(e.getInputEvent().getComponent(),e.getInputEvent().getComponent().getWidth(),0);
      }
    }
);
  }
  ActionToolbar actionToolbar=ActionManager.getInstance().createActionToolbar(ActionPlaces.UNKNOWN,group,true);
  JPanel result=new JPanel(new BorderLayout());
  JPanel toolBarPanel=new JPanel(new BorderLayout());
  toolBarPanel.add(actionToolbar.getComponent(),BorderLayout.WEST);
  JLabel label=new JBLabel("Velocity Template");
  label.setForeground(JBColor.GRAY);
  toolBarPanel.add(label,BorderLayout.EAST);
  result.add(toolBarPanel,BorderLayout.NORTH);
  result.add(new JBScrollPane(myCopyrightEditorPanel),BorderLayout.CENTER);
  result.setPreferredSize(new Dimension(-1,400));
  myWholePanel.add(result);
  myWholePanel.add(LabeledComponent.left(myKeywordField=new JBTextField(),"Keyword to detect copyright in comments"));
  myWholePanel.add(LabeledComponent.left(myAllowReplaceTextField=new JBTextField(),"Allow replacing copyright if old copyright contains"));
}
