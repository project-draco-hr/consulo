{
  try {
    getPsiManager().addPsiTreeChangeListener(listener);
    eventsFired="";
    this.newText=newText;
    original=getFile().getText();
    Document document=PsiDocumentManager.getInstance(getProject()).getDocument(getFile());
    document.setText(newText);
    PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
    document.setText(original);
    PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
  }
  finally {
    getPsiManager().removePsiTreeChangeListener(listener);
  }
}
