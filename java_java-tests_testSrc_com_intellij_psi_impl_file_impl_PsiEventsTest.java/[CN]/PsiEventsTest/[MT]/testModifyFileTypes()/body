{
  FileManager fileManager=myPsiManager.getFileManager();
  EventsTestListener listener=new EventsTestListener();
  myPsiManager.addPsiTreeChangeListener(listener,getTestRootDisposable());
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      ((FileTypeManagerEx)FileTypeManager.getInstance()).fireBeforeFileTypesChanged();
      ((FileTypeManagerEx)FileTypeManager.getInstance()).fireFileTypesChanged();
    }
  }
);
  String string=listener.getEventsString();
  String expected="beforePropertyChange\n" + "propertyChanged\n";
  assertEquals(expected,string);
}
