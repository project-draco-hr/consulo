{
  final String path1=args[1];
  final String path2=args[2];
  final VirtualFile file1=findFile(path1);
  final VirtualFile file2=findFile(path2);
  final boolean isDirs=isDirs(file1,file2);
  final boolean isJars=isJars(file1,file2);
  if (isDirs || isJars) {
    final DirDiffManager diffManager=DirDiffManager.getInstance(ProjectManager.getInstance().getDefaultProject());
    final DiffElement d1=diffManager.createDiffElement(file1);
    final DiffElement d2=diffManager.createDiffElement(file2);
    if (d1 == null) {
      System.err.println("Can't create diff element from " + path1);
      return;
    }
    if (d2 == null) {
      System.err.println("Can't create diff element from " + path2);
      return;
    }
    if (!diffManager.canShow(d1,d2)) {
      System.err.println("Diff manager can't compare '" + path1 + "' and '"+ path2+ "'");
      return;
    }
    final DirDiffSettings settings=new DirDiffSettings();
    settings.showInFrame=false;
    diffManager.showDiff(d1,d2,settings,null);
  }
 else {
    SimpleDiffRequest request=SimpleDiffRequest.compareFiles(file1,file2,null);
    request.addHint(DiffTool.HINT_SHOW_MODAL_DIALOG);
    DiffManager.getInstance().getIdeaDiffTool().show(request);
    FileDocumentManager.getInstance().saveAllDocuments();
  }
}
