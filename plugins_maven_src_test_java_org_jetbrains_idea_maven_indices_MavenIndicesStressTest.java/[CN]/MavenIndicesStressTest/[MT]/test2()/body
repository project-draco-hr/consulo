{
  MavenCustomRepositoryHelper helper;
  helper=new MavenCustomRepositoryHelper(myDir,"plugins","local1","local2");
  helper.copy("plugins","local1");
  helper.copy("local2","local1");
  setRepositoryPath(helper.getTestDataPath("local1"));
  final MavenIndexerWrapper indexer=MavenServerManager.getInstance().createIndexer();
  File indicesDir=new File(myDir,"indices");
  MavenIndices indices=new MavenIndices(indexer,indicesDir,this);
  MavenIndex index=indices.add("id",getRepositoryPath(),MavenIndex.Kind.LOCAL);
  fail();
  indices.close();
  MavenIndices indices1=new MavenIndices(indexer,indicesDir,this);
  MavenIndices indices2=new MavenIndices(indexer,indicesDir,this);
  AtomicInteger finishedCount=new AtomicInteger(0);
  Thread t1=createThread(indices1.getIndices().get(0),finishedCount);
  Thread t2=createThread(indices2.getIndices().get(0),finishedCount);
  t1.start();
  t2.start();
  do {
    t1.join(100);
    t2.join(100);
  }
 while (finishedCount.get() < 2);
  t1.join(100);
  t2.join(100);
  indices.close();
  indices1.close();
  indices2.close();
}
