{
  ExternalSystemApiUtil.executeProjectChangeAction(new DisposeAwareProjectChange(project){
    @Override public void execute(){
      ProjectRootManagerEx.getInstanceEx(project).mergeRootsChangesDuring(new Runnable(){
        @Override public void run(){
          if (ExternalSystemApiUtil.isNewProjectConstruction()) {
            LibraryTable projectLibraryTable=ProjectLibraryTable.getInstance(project);
            if (projectLibraryTable == null) {
              LOG.warn("Can't resolve external dependencies of the target gradle project (" + project + "). Reason: project "+ "library table is undefined");
              return;
            }
            LibraryTable.ModifiableModel model=projectLibraryTable.getModifiableModel();
            try {
              for (              Library library : model.getLibraries()) {
                model.removeLibrary(library);
              }
            }
  finally {
              model.commit();
            }
          }
          myProjectDataManager.importData(Collections.<DataNode<?>>singletonList(projectWithResolvedLibraries),project,false);
        }
      }
);
    }
  }
);
}
