{
  SimpleTextAttributes simpleTextAttributes=SimpleTextAttributes.REGULAR_ATTRIBUTES;
  if (value instanceof DefaultMutableTreeNode) {
    final Object userObject=((DefaultMutableTreeNode)value).getUserObject();
    if (userObject instanceof AbstractTreeNode) {
      simpleTextAttributes=getSimpleTextAttributes(((AbstractTreeNode)userObject).getPresentation());
    }
 else     if (userObject instanceof NodeDescriptor) {
      final Object element=((NodeDescriptor)userObject).getElement();
      if (element instanceof AbstractTreeNode) {
        simpleTextAttributes=getSimpleTextAttributes(((AbstractTreeNode)element).getPresentation());
      }
    }
  }
  if (color != null) {
    final TextAttributes textAttributes=simpleTextAttributes.toTextAttributes();
    textAttributes.setForegroundColor(color);
    simpleTextAttributes=SimpleTextAttributes.fromTextAttributes(textAttributes);
  }
  return simpleTextAttributes;
}
