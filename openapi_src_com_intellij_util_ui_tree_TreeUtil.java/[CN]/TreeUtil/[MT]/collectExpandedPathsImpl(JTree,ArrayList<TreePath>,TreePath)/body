{
  final TreeModel model=tree.getModel();
  final Object lastPathComponent=path.getLastPathComponent();
  if (model.isLeaf(lastPathComponent)) {
    return false;
  }
  boolean hasExpandedChildren=false;
  for (int i=model.getChildCount(lastPathComponent) - 1; i >= 0; i--) {
    hasExpandedChildren|=collectExpandedPathsImpl(tree,paths,path.pathByAddingChild(model.getChild(lastPathComponent,i)));
  }
  if (!hasExpandedChildren) {
    paths.add(path);
    return true;
  }
 else {
    return false;
  }
}
