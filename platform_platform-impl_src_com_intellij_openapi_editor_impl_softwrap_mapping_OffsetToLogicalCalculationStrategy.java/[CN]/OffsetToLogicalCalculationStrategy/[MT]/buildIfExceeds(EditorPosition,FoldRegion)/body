{
  if (myTargetOffset >= foldRegion.getEndOffset()) {
    return null;
  }
  Document document=myEditor.getDocument();
  int targetLogicalLine=document.getLineNumber(myTargetOffset);
  if (targetLogicalLine == position.logicalLine) {
    FoldingData cachedData=getFoldRegionData(foldRegion);
    int x=0;
    if (cachedData != null) {
      x=cachedData.startX;
    }
    position.logicalColumn+=myRepresentationHelper.toVisualColumnSymbolsNumber(document.getCharsSequence(),foldRegion.getStartOffset(),myTargetOffset,x);
  }
 else {
    position.logicalColumn=myRepresentationHelper.toVisualColumnSymbolsNumber(document.getCharsSequence(),foldRegion.getStartOffset(),myTargetOffset,0);
    position.softWrapColumnDiff=0;
    int linesDiff=document.getLineNumber(myTargetOffset) - document.getLineNumber(foldRegion.getStartOffset());
    position.logicalLine+=linesDiff;
    position.foldedLines+=linesDiff;
    position.softWrapLinesBefore+=position.softWrapLinesCurrent;
    position.softWrapLinesCurrent=0;
  }
  position.foldingColumnDiff=position.visualColumn - position.softWrapColumnDiff - position.logicalColumn;
  position.offset=myTargetOffset;
  return position.buildLogicalPosition();
}
