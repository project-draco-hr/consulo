{
  if (myTargetOffset >= foldRegion.getEndOffset()) {
    return null;
  }
  Document document=myEditor.getDocument();
  int targetLogicalLine=document.getLineNumber(myTargetOffset);
  if (targetLogicalLine == position.logicalLine) {
    position.logicalColumn+=SoftWrapModelImpl.getEditorTextRepresentationHelper(myEditor).toVisualColumnSymbolsNumber(document.getCharsSequence(),foldRegion.getStartOffset(),myTargetOffset,position.x);
  }
 else {
    position.logicalColumn=SoftWrapModelImpl.getEditorTextRepresentationHelper(myEditor).toVisualColumnSymbolsNumber(document.getCharsSequence(),foldRegion.getStartOffset(),myTargetOffset,0);
    position.softWrapColumnDiff=0;
    int linesDiff=document.getLineNumber(myTargetOffset) - document.getLineNumber(foldRegion.getStartOffset());
    position.logicalLine+=linesDiff;
    position.foldedLines+=linesDiff;
    position.softWrapLinesBefore+=position.softWrapLinesCurrent;
    position.softWrapLinesCurrent=0;
  }
  position.foldingColumnDiff=position.visualColumn - position.softWrapColumnDiff - position.logicalColumn;
  position.offset=myTargetOffset;
  return position.buildLogicalPosition();
}
