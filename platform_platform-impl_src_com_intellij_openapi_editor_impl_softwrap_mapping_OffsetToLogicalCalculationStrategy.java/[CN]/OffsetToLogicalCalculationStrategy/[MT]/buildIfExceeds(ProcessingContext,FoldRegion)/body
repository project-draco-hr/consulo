{
  if (myTargetOffset >= foldRegion.getEndOffset()) {
    return null;
  }
  Document document=myEditor.getDocument();
  int targetLogicalLine=document.getLineNumber(myTargetOffset);
  if (targetLogicalLine == context.logicalLine) {
    FoldingData cachedData=getFoldRegionData(foldRegion);
    context.logicalColumn+=myRepresentationHelper.toVisualColumnSymbolsNumber(document.getCharsSequence(),foldRegion.getStartOffset(),myTargetOffset,cachedData.startX);
  }
 else {
    context.logicalColumn=myRepresentationHelper.toVisualColumnSymbolsNumber(document.getCharsSequence(),foldRegion.getStartOffset(),myTargetOffset,0);
    context.softWrapColumnDiff=0;
    int linesDiff=document.getLineNumber(myTargetOffset) - document.getLineNumber(foldRegion.getStartOffset());
    context.logicalLine+=linesDiff;
    context.foldedLines+=linesDiff;
    context.softWrapLinesBefore+=context.softWrapLinesCurrent;
    context.softWrapLinesCurrent=0;
  }
  context.foldingColumnDiff=context.visualColumn - context.softWrapColumnDiff - context.logicalColumn;
  context.offset=myTargetOffset;
  return context.buildLogicalPosition();
}
