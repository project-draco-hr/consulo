{
  new WriteCommandAction.Simple(getProject()){
    @Override protected void run() throws Throwable {
      final VirtualFile dir=getVirtualFile(createTempDirectory());
      PsiTestUtil.addSourceContentToRoots(getModule(),dir);
      final VirtualFile childData=dir.createChildData(this,"abc.xml");
      assertResultsAndClear();
      VfsUtil.saveText(childData,"<a/>");
      final DomFileElementImpl<DomElement> fileElement=getFileElement(childData);
      assertResultsAndClear();
      childData.delete(this);
      assertEventCount(1);
      putExpected(new DomEvent(fileElement,false));
      assertResultsAndClear();
      assertFalse(fileElement.isValid());
    }
  }
.execute().throwException();
}
