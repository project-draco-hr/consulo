{
  final Document document=editor.getDocument();
  PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(document);
  if (file == null) {
    return null;
  }
  PsiElement elementAt=file.findElementAt(TargetElementUtilBase.adjustOffset(document,offset));
  for (  GotoDeclarationHandler handler : Extensions.getExtensions(GotoDeclarationHandler.EP_NAME)) {
    try {
      PsiElement[] result=handler.getGotoDeclarationTargets(elementAt,editor);
      if (result != null && result.length > 0) {
        return result;
      }
    }
 catch (    AbstractMethodError e) {
      LOG.error(handler.toString(),e);
    }
  }
  int flags=TargetElementUtilBase.getInstance().getAllAccepted() & ~TargetElementUtilBase.ELEMENT_NAME_ACCEPTED;
  PsiElement element=TargetElementUtilBase.getInstance().findTargetElement(editor,flags,offset);
  if (element != null) {
    return new PsiElement[]{element};
  }
  if (editor instanceof EditorWindow) {
    EditorWindow window=(EditorWindow)editor;
    return findTargetElementsNoVS(project,window.getDelegate(),window.getDocument().injectedToHost(offset));
  }
  return null;
}
