{
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  try {
    int offset=editor.getCaretModel().getOffset();
    PsiElement[] elements=findAllTargetElements(project,editor,offset);
    FeatureUsageTracker.getInstance().triggerFeatureUsed("navigation.goto.declaration");
    if (elements.length != 1) {
      chooseAmbiguousTarget(editor,offset,elements);
      return;
    }
    final PsiElement element=elements[0];
    PsiElement navElement=element.getNavigationElement();
    navElement=TargetElementUtilBase.getInstance().getGotoDeclarationTarget(element,navElement);
    if (navElement instanceof Navigatable) {
      if (((Navigatable)navElement).canNavigate()) {
        ((Navigatable)navElement).navigate(true);
      }
    }
 else     if (navElement != null) {
      int navOffset=navElement.getTextOffset();
      VirtualFile virtualFile=PsiUtilCore.getVirtualFile(navElement);
      if (virtualFile != null) {
        new OpenFileDescriptor(project,virtualFile,navOffset).navigate(true);
      }
    }
  }
 catch (  IndexNotReadyException e) {
    DumbService.getInstance(project).showDumbModeNotification("Navigation is not available here during index update");
  }
}
