{
  final ArrayList<Block> localResult=new ArrayList<Block>();
  processChild(localResult,child,AlignmentStrategy.getNullStrategy(),null,Indent.getNoneIndent());
  child=child.getTreeNext();
  AlignmentStrategy varDeclarationAlignmentStrategy=AlignmentStrategy.createAlignmentPerTypeStrategy(VAR_DECLARATION_ELEMENT_TYPES_TO_ALIGN,JavaElementType.FIELD,true);
  while (child != null) {
    if (!FormatterUtil.containsWhiteSpacesOnly(child)) {
      if (!ElementType.JAVA_COMMENT_BIT_SET.contains(child.getElementType()) && !shouldUseVarDeclarationAlignment(child)) {
        varDeclarationAlignmentStrategy=AlignmentStrategy.createAlignmentPerTypeStrategy(VAR_DECLARATION_ELEMENT_TYPES_TO_ALIGN,JavaElementType.FIELD,true);
      }
      final boolean rBrace=isRBrace(child);
      Indent childIndent=rBrace ? Indent.getNoneIndent() : getCodeBlockInternalIndent(childrenIndent,false);
      if (!rBrace && child.getElementType() == JavaElementType.CODE_BLOCK && (getBraceStyle() == CommonCodeStyleSettings.NEXT_LINE_SHIFTED || getBraceStyle() == CommonCodeStyleSettings.NEXT_LINE_SHIFTED2)) {
        childIndent=Indent.getNormalIndent();
      }
      AlignmentStrategy alignmentStrategyToUse=ALIGN_IN_COLUMNS_ELEMENT_TYPES.contains(child.getElementType()) ? varDeclarationAlignmentStrategy : AlignmentStrategy.getNullStrategy();
      child=processChild(localResult,child,alignmentStrategyToUse,childWrap,childIndent);
      if (rBrace) {
        result.add(createCodeBlockBlock(localResult,indent,childrenIndent));
        return child;
      }
    }
    if (child != null) {
      child=child.getTreeNext();
    }
  }
  result.add(createCodeBlockBlock(localResult,indent,childrenIndent));
  return null;
}
