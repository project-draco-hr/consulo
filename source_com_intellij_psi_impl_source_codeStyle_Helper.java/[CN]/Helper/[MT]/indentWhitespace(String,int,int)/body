{
  final int posLF=whitespace.lastIndexOf('\n');
  if ((indentLevelsDiff == 0 && indentSpacesDiff == 0) || posLF < 0)   return whitespace;
  final int oldIndent=getIndent(whitespace,false);
  int newLevels=oldIndent / INDENT_FACTOR + indentLevelsDiff;
  int newSpaces=oldIndent % INDENT_FACTOR + indentSpacesDiff;
  if (newLevels < 0) {
    newSpaces-=(-newLevels) * mySettings.getIndentSize(getFileType());
    newLevels=0;
  }
  if (newSpaces < 0) {
    final int levels=(-newSpaces) / mySettings.getIndentSize(getFileType());
    newLevels-=levels + 1;
    newSpaces+=(levels + 1) * mySettings.getIndentSize(getFileType());
    if (newLevels < 0) {
      newSpaces=0;
      newLevels=0;
    }
  }
  return whitespace.substring(0,posLF + 1) + fillIndent(newLevels * INDENT_FACTOR + newSpaces);
}
