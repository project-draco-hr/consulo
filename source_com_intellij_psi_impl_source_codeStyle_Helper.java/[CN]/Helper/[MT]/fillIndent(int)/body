{
  int indentLevel=(indent + INDENT_FACTOR / 2) / INDENT_FACTOR;
  int spaceCount=indent - indentLevel * INDENT_FACTOR;
  int indentLevelSize=indentLevel * mySettings.getIndentSize(getFileType());
  int totalSize=indentLevelSize + spaceCount;
  StringBuffer buffer=new StringBuffer();
  if (mySettings.useTabCharacter(getFileType())) {
    if (mySettings.isSmartTabs(getFileType())) {
      int tabCount=indentLevelSize / mySettings.getTabSize(getFileType());
      int leftSpaces=indentLevelSize - tabCount * mySettings.getTabSize(getFileType());
      for (int i=0; i < tabCount; i++) {
        buffer.append('\t');
      }
      for (int i=0; i < leftSpaces + spaceCount; i++) {
        buffer.append(' ');
      }
    }
 else {
      int size=totalSize;
      while (size > 0) {
        if (size >= mySettings.getTabSize(getFileType())) {
          buffer.append('\t');
          size-=mySettings.getTabSize(getFileType());
        }
 else {
          buffer.append(' ');
          size--;
        }
      }
    }
  }
 else {
    for (int i=0; i < totalSize; i++) {
      buffer.append(' ');
    }
  }
  return buffer.toString();
}
