{
  final Set<String> deletedJars=deleteOutdatedFiles(context);
  final List<PackagingProcessingItem> processedItems=new ArrayList<PackagingProcessingItem>();
  final Set<String> writtenPaths=createPathsHashSet();
  Boolean built=new ReadAction<Boolean>(){
    protected void run(    final Result<Boolean> result){
      boolean built=doBuild(context,items,processedItems,writtenPaths,deletedJars);
      result.setResult(built);
    }
  }
.execute().getResultObject();
  if (!built) {
    return ProcessingItem.EMPTY_ARRAY;
  }
  context.getProgressIndicator().setText(CompilerBundle.message("packaging.compiler.message.updating.caches"));
  refreshOutputFiles(writtenPaths);
  new ReadAction(){
    protected void run(    final Result result){
      processDestinations(processedItems);
    }
  }
.execute();
  removeInvalidItems(processedItems);
  updateOutputCache(processedItems);
  return processedItems.toArray(new ProcessingItem[processedItems.size()]);
}
