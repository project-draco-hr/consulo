{
  GradleSettings settings=GradleSettings.getInstance(myProject);
  String linkedProjectPath=settings.getLinkedProjectPath();
  if (StringUtil.isEmpty(linkedProjectPath)) {
    return null;
  }
  String compileOutput=null;
  CompilerProjectExtension compilerProjectExtension=CompilerProjectExtension.getInstance(myProject);
  if (compilerProjectExtension != null) {
    compileOutput=compilerProjectExtension.getCompilerOutputUrl();
  }
  if (compileOutput == null) {
    compileOutput="";
  }
  ExternalProject result=new ExternalProject(linkedProjectPath,compileOutput,id);
  final Map<String,ExternalModule> modules=ContainerUtilRt.newHashMap();
  for (  Module ideModule : myFacade.getModules(myProject)) {
    final ExternalModule module=new ExternalModule(ideModule.getName(),ideModule.getModuleFilePath());
    modules.put(module.getName(),module);
  }
  for (  Module ideModule : myFacade.getModules(myProject)) {
    final ExternalModule module=modules.get(ideModule.getName());
    RootPolicy<Void> visitor=new RootPolicy<Void>(){
      @Override public Void visitLibraryOrderEntry(      LibraryOrderEntry libraryOrderEntry,      Void value){
        Library library=libraryOrderEntry.getLibrary();
        if (library != null) {
          ExternalLibraryDependency dependency=new ExternalLibraryDependency(module,new ExternalLibrary(GradleUtil.getLibraryName(library)));
          dependency.setScope(libraryOrderEntry.getScope());
          dependency.setExported(libraryOrderEntry.isExported());
          module.addDependency(dependency);
        }
        return value;
      }
      @Override public Void visitModuleOrderEntry(      ModuleOrderEntry moduleOrderEntry,      Void value){
        ExternalModule dependencyModule=modules.get(moduleOrderEntry.getModuleName());
        if (dependencyModule != null) {
          ExternalModuleDependency dependency=new ExternalModuleDependency(module,dependencyModule);
          dependency.setScope(moduleOrderEntry.getScope());
          dependency.setExported(moduleOrderEntry.isExported());
          module.addDependency(dependency);
        }
        return value;
      }
    }
;
    for (    OrderEntry orderEntry : myFacade.getOrderEntries(ideModule)) {
      orderEntry.accept(visitor,null);
    }
    result.addModule(module);
  }
  return result;
}
