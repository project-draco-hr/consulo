{
  if (!myIsMovable)   return;
  final PsiExpression qualifier;
  if (referenceElement instanceof PsiReferenceExpression) {
    qualifier=((PsiReferenceExpression)referenceElement).getQualifierExpression();
  }
 else {
    qualifier=null;
  }
  if (qualifier == null || qualifier instanceof PsiThisExpression || qualifier instanceof PsiSuperExpression) {
    final PsiElement resolved=referenceElement.resolve();
    PsiClass containingClass=null;
    if (resolved instanceof PsiField) {
      containingClass=((PsiField)resolved).getContainingClass();
    }
 else     if (resolved instanceof PsiMethod) {
      containingClass=((PsiMethod)resolved).getContainingClass();
    }
 else     if (resolved instanceof PsiClass) {
      final PsiElement parent=resolved.getParent();
      if (parent instanceof PsiClass && !((PsiClass)resolved).hasModifierProperty(PsiModifier.STATIC)) {
        containingClass=(PsiClass)resolved;
      }
 else {
        return;
      }
    }
    if (containingClass != null) {
      myIsMovable=myManager.areElementsEquivalent(myTargetSuperClass,containingClass) || myTargetSuperClass.isInheritor(containingClass,true);
    }
 else {
      myIsMovable=false;
    }
  }
 else {
    qualifier.accept(this);
  }
}
