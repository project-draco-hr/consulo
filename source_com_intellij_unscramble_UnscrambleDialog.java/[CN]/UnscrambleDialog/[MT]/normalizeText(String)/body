{
  StringBuilder builder=new StringBuilder(text.length());
  String[] lines=text.split("\n");
  boolean first=true;
  for (  String line : lines) {
    if (!first && mustHaveNewLineBefore(line)) {
      builder.append("\n");
      if (line.startsWith("\""))       builder.append("\n");
    }
    first=false;
    builder.append(line);
  }
  return builder.toString();
}
