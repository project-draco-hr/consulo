{
  final TextRange textRange=list.getTextRange();
  offset=textRange.contains(offset) ? offset : textRange.getStartOffset() + 1;
  if (previousOffset == offset)   return previousBestPoint;
  String listText=list.getText();
  final boolean isMultiline=listText.indexOf('\n') >= 0 || listText.indexOf('\r') >= 0;
  final LogicalPosition pos=myEditor.offsetToLogicalPosition(offset);
  Point p;
  if (!isMultiline) {
    p=chooseBestHintPosition(myEditor.getProject(),myEditor,pos.line,pos.column,hint);
  }
 else {
    p=HintManager.getInstance().getHintPosition(hint,myEditor,pos,HintManager.ABOVE);
    Dimension hintSize=hint.getComponent().getPreferredSize();
    JComponent editorComponent=myEditor.getComponent();
    JLayeredPane layeredPane=editorComponent.getRootPane().getLayeredPane();
    p.x=Math.min(p.x,layeredPane.getWidth() - hintSize.width);
    p.x=Math.max(p.x,0);
  }
  previousBestPoint=p;
  previousOffset=offset;
  return p;
}
