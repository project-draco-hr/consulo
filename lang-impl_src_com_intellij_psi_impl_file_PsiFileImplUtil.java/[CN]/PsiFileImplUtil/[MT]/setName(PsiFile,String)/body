{
  VirtualFile vFile=file.getViewProvider().getVirtualFile();
  PsiManagerImpl manager=(PsiManagerImpl)file.getManager();
  try {
    vFile.rename(manager,newName);
  }
 catch (  IOException e) {
    throw new IncorrectOperationException(e.toString(),e);
  }
  return file.getViewProvider().isPhysical() ? manager.findFile(vFile) : file;
}
