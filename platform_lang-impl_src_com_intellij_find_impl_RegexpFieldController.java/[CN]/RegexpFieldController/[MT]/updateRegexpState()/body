{
  boolean regularExpressions=myFindModel.isRegularExpressions();
  Project project=myTextField.getProject();
  PsiFile psiFile=PsiDocumentManager.getInstance(project).getPsiFile(myTextField.getDocument());
  if (psiFile != null && (!regularExpressions == (psiFile.getFileType() == PlainTextFileType.INSTANCE))) {
    return;
  }
  @NonNls final String s=regularExpressions ? "*.regexp" : "*.txt";
  FileType fileType=FileTypeManager.getInstance().getFileTypeByFileName(s);
  if (regularExpressions && fileType == FileTypes.UNKNOWN) {
    fileType=FileTypeManager.getInstance().getFileTypeByFileName("*.txt");
  }
  final PsiFile file=PsiFileFactory.getInstance(project).createFileFromText(s,fileType,myTextField.getText(),-1,true);
  if (myListener != null) {
    myListener.documentWillBeReplaced(this);
  }
  Document document=PsiDocumentManager.getInstance(project).getDocument(file);
  myTextField.setNewDocumentAndFileType(fileType,document);
  if (myListener != null) {
    myListener.documentWasReplaced(this);
  }
}
