{
  File file=new File(FileUtil.toCanonicalPath(projectPath));
  if (file.isFile() && projectPath.endsWith(".ipr")) {
    new JpsProjectLoader(project,pathVariables,file.getParentFile()).loadFromIpr(file);
  }
 else {
    File dotIdea=new File(file,PathMacroUtil.DIRECTORY_STORE_NAME);
    File directory;
    if (dotIdea.isDirectory()) {
      directory=dotIdea;
    }
 else     if (file.isDirectory() && file.getName().equals(PathMacroUtil.DIRECTORY_STORE_NAME)) {
      directory=file;
    }
 else {
      throw new IOException("Cannot find IntelliJ IDEA project files at " + projectPath);
    }
    new JpsProjectLoader(project,pathVariables,directory.getParentFile()).loadFromDirectory(directory);
  }
}
