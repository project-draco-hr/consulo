{
  final File file=new File(path);
  String name=FileUtil.getNameWithoutExtension(file);
  if (!file.exists()) {
    LOG.info("Module '" + name + "' is skipped: "+ file.getAbsolutePath()+ " doesn't exist");
    return null;
  }
  final JpsMacroExpander expander=createModuleMacroExpander(myPathVariables,file);
  final Element moduleRoot=loadRootElement(file,expander);
  final String typeId=moduleRoot.getAttributeValue("type");
  final JpsModulePropertiesSerializer<?> serializer=getModulePropertiesSerializer(typeId);
  final JpsModule module=createModule(name,moduleRoot,serializer);
  module.getContainer().setChild(JpsModuleSerializationDataExtensionImpl.ROLE,new JpsModuleSerializationDataExtensionImpl(file.getParentFile()));
  for (  JpsModelSerializerExtension extension : JpsModelSerializerExtension.getExtensions()) {
    extension.loadModuleOptions(module,moduleRoot);
  }
  String baseModulePath=FileUtil.toSystemIndependentName(file.getParent());
  String classpath=moduleRoot.getAttributeValue(CLASSPATH_ATTRIBUTE);
  if (classpath == null) {
    JpsModuleRootModelSerializer.loadRootModel(module,JDomSerializationUtil.findComponent(moduleRoot,"NewModuleRootManager"),projectSdkType);
  }
 else {
    for (    JpsModelSerializerExtension extension : JpsModelSerializerExtension.getExtensions()) {
      JpsModuleClasspathSerializer classpathSerializer=extension.getClasspathSerializer();
      if (classpathSerializer != null && classpathSerializer.getClasspathId().equals(classpath)) {
        String classpathDir=moduleRoot.getAttributeValue(CLASSPATH_DIR_ATTRIBUTE);
        classpathSerializer.loadClasspath(module,classpathDir,baseModulePath,expander,paths);
      }
    }
  }
  JpsFacetSerializer.loadFacets(module,JDomSerializationUtil.findComponent(moduleRoot,"FacetManager"),baseModulePath);
  return module;
}
