{
  if (configuration instanceof PersistentStateComponent) {
    Object state=((PersistentStateComponent)configuration).getState();
    if (state instanceof Element)     return ((Element)state);
    return XmlSerializer.serialize(state,new SkipDefaultValuesSerializationFilters());
  }
 else {
    final Element config=new Element(JpsFacetLoader.CONFIGURATION_ELEMENT);
    configuration.writeExternal(config);
    return config;
  }
}
