{
  myContext=context;
  myType=type;
  myJdkChooser=new JdkChooserPanel(getProject(context,type));
  myPanel=new JPanel(new GridBagLayout());
  myPanel.setBorder(BorderFactory.createEtchedBorder());
  final JLabel label=new JLabel(IdeBundle.message("prompt.please.select.module.jdk",type.getPresentableName()));
  label.setUI(new MultiLineLabelUI());
  myPanel.add(label,new GridBagConstraints(0,GridBagConstraints.RELATIVE,2,1,1.0,0.0,GridBagConstraints.NORTHWEST,GridBagConstraints.HORIZONTAL,new Insets(8,10,8,10),0,0));
  final JLabel jdklabel=new JLabel(IdeBundle.message("label.project.jdk"));
  jdklabel.setFont(UIUtil.getLabelFont().deriveFont(Font.BOLD));
  myPanel.add(jdklabel,new GridBagConstraints(0,GridBagConstraints.RELATIVE,2,1,1.0,0.0,GridBagConstraints.NORTHWEST,GridBagConstraints.NONE,new Insets(8,10,0,10),0,0));
  myPanel.add(myJdkChooser,new GridBagConstraints(0,GridBagConstraints.RELATIVE,1,2,1.0,1.0,GridBagConstraints.NORTHWEST,GridBagConstraints.BOTH,new Insets(2,10,10,5),0,0));
  JButton configureButton=new JButton(IdeBundle.message("button.configure"));
  myPanel.add(configureButton,new GridBagConstraints(1,GridBagConstraints.RELATIVE,1,1,0.0,0.0,GridBagConstraints.NORTHWEST,GridBagConstraints.NONE,new Insets(2,0,5,5),0,0));
  mySetAsDefaultButton=new JButton("Set Default");
  mySetAsDefaultButton.setMnemonic('D');
  myPanel.add(mySetAsDefaultButton,new GridBagConstraints(1,GridBagConstraints.RELATIVE,1,1,0.0,1.0,GridBagConstraints.NORTHWEST,GridBagConstraints.NONE,new Insets(2,0,10,5),0,0));
  configureButton.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      final Project project=getProject(context,type);
      final ProjectStructureConfigurable projectConfig=ProjectStructureConfigurable.getInstance(project);
      final JdkListConfigurable jdkConfig=JdkListConfigurable.getInstance(project);
      final ProjectSdksModel projectJdksModel=projectConfig.getProjectJdksModel();
      final boolean[] successfullyAdded=new boolean[1];
      projectJdksModel.doAdd(type,new Consumer<Sdk>(){
        public void consume(        final Sdk jdk){
          successfullyAdded[0]=jdkConfig.addJdkNode(jdk,false);
          myJdkChooser.updateList(jdk,type);
          if (!successfullyAdded[0]) {
            try {
              projectJdksModel.apply(jdkConfig);
            }
 catch (            ConfigurationException e1) {
            }
          }
        }
      }
);
    }
  }
);
  final Project defaultProject=ProjectManagerEx.getInstanceEx().getDefaultProject();
  mySetAsDefaultButton.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      final Sdk jdk=getJdk();
      final Runnable runnable=new Runnable(){
        public void run(){
          ProjectRootManagerEx.getInstanceEx(defaultProject).setProjectSdk(jdk);
        }
      }
;
      ApplicationManager.getApplication().runWriteAction(runnable);
      mySetAsDefaultButton.setEnabled(false);
    }
  }
);
  myJdkChooser.addSelectionListener(new ListSelectionListener(){
    @Override public void valueChanged(    ListSelectionEvent e){
      mySetAsDefaultButton.setEnabled(getJdk() != ProjectRootManagerEx.getInstanceEx(defaultProject).getProjectSdk());
    }
  }
);
}
