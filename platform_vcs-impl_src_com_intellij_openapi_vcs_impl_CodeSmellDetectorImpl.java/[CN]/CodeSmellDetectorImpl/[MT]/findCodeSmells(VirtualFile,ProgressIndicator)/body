{
  final List<CodeSmellInfo> result=Collections.synchronizedList(new ArrayList<CodeSmellInfo>());
  final DaemonCodeAnalyzerImpl codeAnalyzer=(DaemonCodeAnalyzerImpl)DaemonCodeAnalyzer.getInstance(myProject);
  final ProgressIndicator daemonIndicator=new DaemonProgressIndicator();
  ((ProgressIndicatorEx)progress).addStateDelegate(new AbstractProgressIndicatorExBase(){
    @Override public void cancel(){
      super.cancel();
      daemonIndicator.cancel();
    }
  }
);
  ProgressManager.getInstance().runProcess(new Runnable(){
    @Override public void run(){
      DumbService.getInstance(myProject).runReadActionInSmartMode(new Runnable(){
        @Override public void run(){
          final PsiFile psiFile=PsiManager.getInstance(myProject).findFile(file);
          final Document document=FileDocumentManager.getInstance().getDocument(file);
          if (psiFile == null || document == null) {
            return;
          }
          List<HighlightInfo> infos=codeAnalyzer.runMainPasses(psiFile,document,daemonIndicator);
          convertErrorsAndWarnings(infos,result,document);
        }
      }
);
    }
  }
,daemonIndicator);
  return result;
}
