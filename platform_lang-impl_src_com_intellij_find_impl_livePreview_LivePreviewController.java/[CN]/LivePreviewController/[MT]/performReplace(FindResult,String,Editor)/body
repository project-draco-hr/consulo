{
  Project project=mySearchResults.getProject();
  if (myReplaceDenied || !ReadonlyStatusHandler.ensureDocumentWritable(project,editor.getDocument()))   return null;
  FindModel findModel=mySearchResults.getFindModel();
  TextRange result=FindUtil.doReplace(project,editor.getDocument(),findModel,new FindResultImpl(occurrence.getStartOffset(),occurrence.getEndOffset()),replacement,true,new ArrayList<>());
  myLivePreview.inSmartUpdate();
  mySearchResults.updateThreadSafe(findModel,true,result,mySearchResults.getStamp());
  return result;
}
