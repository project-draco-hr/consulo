def recode(self, s, encoding=None):
    if (not encoding):
        encoding = (self.encoding or 'utf-8')
    if isinstance(s, unicode):
        return s.encode('utf-8')
    try:
        return s.decode(encoding).encode('utf-8')
    except:
        try:
            return s.decode('latin-1').encode('utf-8')
        except:
            return s.decode(encoding, 'replace').encode('utf-8')
