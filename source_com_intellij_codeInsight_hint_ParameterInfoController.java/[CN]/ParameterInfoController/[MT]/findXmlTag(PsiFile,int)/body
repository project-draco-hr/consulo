{
  if (!(file instanceof XmlFile))   return null;
  PsiElement element=file.findElementAt(offset);
  if (element == null)   return null;
  element=element.getParent();
  while (element != null) {
    if (element instanceof XmlTag) {
      XmlTag tag=(XmlTag)element;
      final PsiElement[] children=tag.getChildren();
      if (offset <= children[0].getTextRange().getStartOffset())       return null;
      for (int i=0; i < children.length; i++) {
        PsiElement child=children[i];
        final TextRange range=child.getTextRange();
        if (range.getStartOffset() <= offset && range.getEndOffset() > offset)         return tag;
        if (child instanceof XmlToken) {
          XmlToken token=(XmlToken)child;
          if (token.getTokenType() == XmlTokenType.XML_TAG_END)           return null;
        }
      }
      return null;
    }
    element=element.getParent();
  }
  return null;
}
