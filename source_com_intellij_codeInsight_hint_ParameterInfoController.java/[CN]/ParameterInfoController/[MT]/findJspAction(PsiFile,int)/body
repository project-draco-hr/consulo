{
  if (!(file instanceof JspFile))   return null;
  PsiElement element=file.findElementAt(offset);
  if (element == null)   return null;
  element=element.getParent();
  while (element != null) {
    if (element instanceof JspAction) {
      JspAction action=(JspAction)element;
      final PsiElement[] children=action.getChildren();
      if (offset <= children[0].getTextRange().getStartOffset())       return null;
      for (int i=0; i < children.length; i++) {
        PsiElement child=children[i];
        final TextRange range=child.getTextRange();
        if (range.getStartOffset() <= offset && range.getEndOffset() > offset)         return action;
        if (child instanceof JspToken) {
          JspToken token=(JspToken)child;
          if (token.getTokenType() == JspTokenType.JSP_ACTION_END)           return null;
        }
      }
      return null;
    }
    element=element.getParent();
  }
  return null;
}
