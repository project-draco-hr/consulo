{
  GroovyResolveResult resolveResult=refExpr.advancedResolve();
  GroovyResolveResult[] results=refExpr.multiResolve(false);
  for (  GroovyResolveResult result : results) {
    registerUsedImport(refExpr,result);
  }
  PsiElement resolved=resolveResult.getElement();
  final PsiElement parent=refExpr.getParent();
  if (resolved != null) {
    if (resolved instanceof PsiMember) {
      highlightMemberResolved(holder,refExpr,((PsiMember)resolved));
    }
    if (!resolveResult.isAccessible()) {
      String message=GroovyBundle.message("cannot.access",refExpr.getReferenceName());
      holder.createWarningAnnotation(refExpr.getReferenceNameElement(),message);
    }
    if (!resolveResult.isStaticsOK() && resolved instanceof PsiModifierListOwner) {
      final String key=((PsiModifierListOwner)resolved).hasModifierProperty(PsiModifier.STATIC) ? "cannot.reference.static" : "cannot.reference.nonstatic";
      String message=GroovyBundle.message(key,refExpr.getReferenceName());
      holder.createWarningAnnotation(refExpr,message);
    }
 else     if (parent instanceof GrCall) {
      if (resolved instanceof PsiMethod && resolved.getUserData(GrMethod.BUILDER_METHOD) == null) {
        checkMethodApplicability(resolveResult,refExpr,holder);
      }
 else {
        checkClosureApplicability(resolveResult,refExpr.getType(),refExpr,holder);
      }
    }
    if (isAssignmentLHS(refExpr) || resolved instanceof PsiPackage)     return;
  }
 else {
    GrExpression qualifier=refExpr.getQualifierExpression();
    if (qualifier == null && isAssignmentLHS(refExpr))     return;
    if (parent instanceof GrReferenceExpression && "class".equals(((GrReferenceExpression)parent).getReferenceName())) {
      checkSingleResolvedElement(holder,refExpr,resolveResult);
    }
  }
  final PsiType refExprType=refExpr.getType();
  PsiElement refNameElement=refExpr.getReferenceNameElement();
  PsiElement elt=refNameElement == null ? refExpr : refNameElement;
  Annotation annotation=holder.createInfoAnnotation(elt,null);
  if (refExprType == null) {
    if (resolved == null) {
      if (refExpr.getQualifierExpression() == null) {
        if (!(parent instanceof GrCallExpression)) {
          registerCreateClassByTypeFix(refExpr,annotation);
        }
        registerAddImportFixes(refExpr,annotation);
      }
      registerReferenceFixes(refExpr,annotation);
      annotation.setTextAttributes(DefaultHighlighter.UNRESOLVED_ACCESS);
    }
 else {
      annotation.setTextAttributes(DefaultHighlighter.UNTYPED_ACCESS);
    }
  }
 else   if (refExprType instanceof PsiClassType && ((PsiClassType)refExprType).resolve() == null) {
    annotation.setTextAttributes(DefaultHighlighter.UNTYPED_ACCESS);
  }
}
