{
  final GrTypeElement typeElement=newExpression.getTypeElement();
  if (typeElement instanceof GrBuiltInTypeElement) {
    if (newExpression.getArrayCount() == 0) {
      myHolder.createErrorAnnotation(typeElement,GroovyBundle.message("create.instance.of.built-in.type"));
    }
  }
  if (newExpression.getArrayCount() > 0)   return;
  GrCodeReferenceElement refElement=newExpression.getReferenceElement();
  if (refElement == null)   return;
  final PsiElement element=refElement.resolve();
  if (element instanceof PsiClass) {
    PsiClass clazz=(PsiClass)element;
    if (clazz.hasModifierProperty(GrModifier.ABSTRACT)) {
      if (newExpression.getAnonymousClassDefinition() == null) {
        String message=clazz.isInterface() ? GroovyBundle.message("cannot.instantiate.interface",clazz.getName()) : GroovyBundle.message("cannot.instantiate.abstract.class",clazz.getName());
        myHolder.createErrorAnnotation(refElement,message);
      }
      return;
    }
    if (newExpression.getQualifier() != null) {
      if (clazz.hasModifierProperty(GrModifier.STATIC)) {
        myHolder.createErrorAnnotation(newExpression,GroovyBundle.message("qualified.new.of.static.class"));
      }
    }
 else {
      final PsiClass outerClass=clazz.getContainingClass();
      if (com.intellij.psi.util.PsiUtil.isInnerClass(clazz) && !PsiUtil.hasEnclosingInstanceInScope(outerClass,newExpression,true)) {
        Annotation annotation=myHolder.createErrorAnnotation(newExpression,GroovyBundle.message("cannot.reference.nonstatic",clazz.getQualifiedName()));
        annotation.setTextAttributes(DefaultHighlighter.UNRESOLVED_ACCESS);
      }
    }
  }
  final GroovyResolveResult constructorResolveResult=newExpression.resolveConstructorGenerics();
  final PsiElement constructor=constructorResolveResult.getElement();
  if (constructor != null) {
    final GrArgumentList argList=newExpression.getArgumentList();
    if (argList != null && argList.getExpressionArguments().length == 0 && ((PsiMethod)constructor).getParameterList().getParametersCount() == 0) {
      checkDefaultMapConstructor(myHolder,argList,constructor);
    }
  }
 else {
    final GroovyResolveResult[] results=newExpression.multiResolveConstructor();
    final GrArgumentList argList=newExpression.getArgumentList();
    PsiElement toHighlight=argList != null ? argList : getElementToHighlight(refElement);
    if (results.length > 0) {
      String message=GroovyBundle.message("ambiguous.constructor.call");
      myHolder.createWarningAnnotation(toHighlight,message);
    }
 else {
      if (element instanceof PsiClass) {
        PsiType[] argumentTypes=PsiUtil.getArgumentTypes(refElement,true);
        if (argumentTypes == null || argumentTypes.length == 0 || (argumentTypes.length == 1 && InheritanceUtil.isInheritor(argumentTypes[0],CommonClassNames.JAVA_UTIL_MAP))) {
          checkDefaultMapConstructor(myHolder,argList,element);
        }
 else {
          String message=GroovyBundle.message("cannot.find.default.constructor",((PsiClass)element).getName());
          myHolder.createWarningAnnotation(toHighlight,message);
        }
      }
    }
  }
}
