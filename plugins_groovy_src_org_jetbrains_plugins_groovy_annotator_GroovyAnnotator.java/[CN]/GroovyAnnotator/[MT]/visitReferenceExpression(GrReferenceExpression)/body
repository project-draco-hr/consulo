{
  checkStringNameIdentifier(referenceExpression);
  GroovyResolveResult resolveResult=referenceExpression.advancedResolve();
  GroovyResolveResult[] results=referenceExpression.multiResolve(false);
  PsiElement resolved=resolveResult.getElement();
  final PsiElement parent=referenceExpression.getParent();
  if (resolved != null) {
    if (resolved instanceof PsiMember) {
      highlightMemberResolved(myHolder,referenceExpression,((PsiMember)resolved));
    }
    if (!resolveResult.isStaticsOK() && resolved instanceof PsiModifierListOwner) {
      if (!((PsiModifierListOwner)resolved).hasModifierProperty(PsiModifier.STATIC)) {
        Annotation annotation=myHolder.createInfoAnnotation(referenceExpression,GroovyBundle.message("cannot.reference.nonstatic",referenceExpression.getReferenceName()));
        annotation.setTextAttributes(DefaultHighlighter.UNRESOLVED_ACCESS);
      }
    }
  }
 else {
    GrExpression qualifier=referenceExpression.getQualifierExpression();
    if (qualifier == null && isDeclarationAssignment(referenceExpression))     return;
    if (!(parent instanceof GrCall) && ResolveUtil.isKeyOfMap(referenceExpression)) {
      PsiElement refNameElement=referenceExpression.getReferenceNameElement();
      PsiElement elt=refNameElement == null ? referenceExpression : refNameElement;
      Annotation annotation=myHolder.createInfoAnnotation(elt,null);
      annotation.setTextAttributes(DefaultHighlighter.MAP_KEY);
      return;
    }
    if (parent instanceof GrReferenceExpression && "class".equals(((GrReferenceExpression)parent).getReferenceName())) {
      checkSingleResolvedElement(myHolder,referenceExpression,resolveResult,false);
    }
  }
  if (parent instanceof GrCall) {
    if (resolved == null && results.length > 0) {
      resolved=results[0].getElement();
    }
  }
  if (isDeclarationAssignment(referenceExpression) || resolved instanceof PsiPackage)   return;
  if (resolved == null) {
    PsiElement refNameElement=referenceExpression.getReferenceNameElement();
    if (refNameElement != null && referenceExpression.getQualifier() == null) {
      final IElementType type=refNameElement.getNode().getElementType();
      if (type == GroovyTokenTypes.mGSTRING_LITERAL || type == GroovyTokenTypes.mSTRING_LITERAL)       return;
    }
    PsiElement elt=refNameElement == null ? referenceExpression : refNameElement;
    Annotation annotation=myHolder.createInfoAnnotation(elt,null);
    final GrExpression qualifier=referenceExpression.getQualifierExpression();
    if (qualifier == null) {
      if (parent instanceof GrMethodCall) {
        registerStaticImportFix(referenceExpression,annotation);
      }
 else {
        registerCreateClassByTypeFix(referenceExpression,annotation);
        registerAddImportFixes(referenceExpression,annotation);
      }
    }
 else {
      if (qualifier.getType() == null) {
        return;
      }
    }
    if (!GroovyUnresolvedHighlightFilter.shouldHighlight(referenceExpression))     return;
    CollectConsumer<PomTarget> consumer=new CollectConsumer<PomTarget>();
    for (    PomDeclarationSearcher searcher : PomDeclarationSearcher.EP_NAME.getExtensions()) {
      searcher.findDeclarationsAt(referenceExpression,0,consumer);
      if (consumer.getResult().size() > 0)       return;
    }
    registerReferenceFixes(referenceExpression,annotation);
    annotation.setTextAttributes(DefaultHighlighter.UNRESOLVED_ACCESS);
  }
}
