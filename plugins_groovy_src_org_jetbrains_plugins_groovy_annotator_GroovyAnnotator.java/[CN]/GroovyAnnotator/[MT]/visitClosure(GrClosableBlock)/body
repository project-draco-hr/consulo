{
  super.visitClosure(closure);
  if (!closure.hasParametersSection() && !followsError(closure) && isClosureAmbiguous(closure)) {
    myHolder.createErrorAnnotation(closure,GroovyBundle.message("ambiguous.code.block"));
  }
  if (TypeInferenceHelper.isTooComplexTooAnalyze(closure)) {
    int startOffset=closure.getTextRange().getStartOffset();
    int endOffset;
    PsiElement arrow=closure.getArrow();
    if (arrow != null) {
      endOffset=arrow.getTextRange().getEndOffset();
    }
 else {
      Document document=PsiDocumentManager.getInstance(closure.getProject()).getDocument(closure.getContainingFile());
      if (document == null)       return;
      String text=document.getText();
      endOffset=Math.min(closure.getTextRange().getEndOffset(),text.indexOf('\n',startOffset));
    }
    myHolder.createWeakWarningAnnotation(new TextRange(startOffset,endOffset),GroovyBundle.message("closure.is.too.complex.to.analyze"));
  }
}
