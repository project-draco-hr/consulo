{
  super.visitClosure(closure);
  if (!closure.hasParametersSection() && isClosureAmbiguous(closure)) {
    myHolder.createErrorAnnotation(closure,GroovyBundle.message("ambiguous.code.block"));
  }
  if (TypeInferenceHelper.isTooComplexTooAnalyze(closure)) {
    int startOffset=closure.getLBrace().getTextRange().getStartOffset();
    int endOffset;
    if (closure.getArrow() != null) {
      endOffset=closure.getArrow().getTextRange().getEndOffset();
    }
 else {
      String text=PsiDocumentManager.getInstance(closure.getProject()).getDocument(closure.getContainingFile()).getText();
      endOffset=Math.min(closure.getTextRange().getEndOffset(),text.indexOf('\n',startOffset));
    }
    myHolder.createWeakWarningAnnotation(new TextRange(startOffset,endOffset),GroovyBundle.message("closure.is.too.complex.to.analyze"));
  }
}
