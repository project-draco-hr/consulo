{
  if (GroovyConfigUtils.getInstance().isVersionAtLeast(expression,GroovyConfigUtils.GROOVY1_8))   return;
  final GrReferenceExpression qualifier=expression instanceof GrThisReferenceExpression ? ((GrThisReferenceExpression)expression).getQualifier() : ((GrSuperReferenceExpression)expression).getQualifier();
  if (qualifier == null) {
    if (expression instanceof GrSuperReferenceExpression) {
      final GrMethod method=PsiTreeUtil.getParentOfType(expression,GrMethod.class);
      if (method != null && method.hasModifierProperty(PsiModifier.STATIC)) {
        Annotation annotation=holder.createInfoAnnotation(expression,GroovyBundle.message("cannot.reference.nonstatic",expression.getText()));
        annotation.setTextAttributes(DefaultHighlighter.UNRESOLVED_ACCESS);
      }
    }
  }
 else {
    final PsiElement resolved=qualifier.resolve();
    if (resolved instanceof PsiClass) {
      if (PsiTreeUtil.isAncestor(resolved,expression,true)) {
        if (!PsiUtil.hasEnclosingInstanceInScope((PsiClass)resolved,expression,true)) {
          Annotation annotation=holder.createInfoAnnotation(expression,GroovyBundle.message("cannot.reference.nonstatic",expression.getText()));
          annotation.setTextAttributes(DefaultHighlighter.UNRESOLVED_ACCESS);
        }
      }
 else {
        holder.createErrorAnnotation(expression,GroovyBundle.message("is.not.enclosing.class",((PsiClass)resolved).getQualifiedName()));
      }
    }
 else {
      holder.createErrorAnnotation(qualifier,GroovyBundle.message("unknown.class",qualifier.getText()));
    }
  }
}
