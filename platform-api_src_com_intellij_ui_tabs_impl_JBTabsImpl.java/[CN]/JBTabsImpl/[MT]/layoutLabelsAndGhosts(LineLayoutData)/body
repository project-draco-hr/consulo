{
  int y=data.insets.top;
  boolean reachedBounds=false;
  if (data.leftGhostVisible || isGhostsAlwaysVisible()) {
    data.leftGhost=new Rectangle(data.eachX,y,getGhostTabWidth(),myHeaderFitSize.height);
    myLeftGhost.setBounds(data.leftGhost);
    data.eachX+=data.leftGhost.width;
  }
  int deltaToFit=0;
  if (data.leftGhostVisible || data.rightGhostVisible) {
    if (data.requiredWidth < data.toFitWidth) {
      deltaToFit=(int)Math.floor((data.toFitWidth - data.requiredWidth) / (double)data.toLayout.size());
    }
  }
  int totalWidth=0;
  int leftX=data.eachX;
  for (  TabInfo eachInfo : data.toLayout) {
    final TabLabel label=myInfo2Label.get(eachInfo);
    final Dimension eachSize=label.getPreferredSize();
    boolean isLast=data.toLayout.indexOf(eachInfo) == data.toLayout.size() - 1;
    if (!isLast || deltaToFit == 0) {
      label.setBounds(data.eachX,y,eachSize.width + deltaToFit,myHeaderFitSize.height);
    }
 else {
      int width=data.toFitWidth - totalWidth;
      label.setBounds(data.eachX,y,width,myHeaderFitSize.height);
    }
    label.setAligmentToCenter(deltaToFit > 0);
    data.eachX=(int)label.getBounds().getMaxX();
    data.eachX++;
    totalWidth=(int)(label.getBounds().getMaxX() - leftX);
  }
  for (  TabInfo eachInfo : data.toDrop) {
    myInfo2Label.get(eachInfo).setBounds(0,0,0,0);
  }
  if (data.rightGhostVisible || isGhostsAlwaysVisible()) {
    data.rightGhost=new Rectangle(data.eachX,y,getGhostTabWidth(),myHeaderFitSize.height);
    myRightGhost.setBounds(data.rightGhost);
  }
}
