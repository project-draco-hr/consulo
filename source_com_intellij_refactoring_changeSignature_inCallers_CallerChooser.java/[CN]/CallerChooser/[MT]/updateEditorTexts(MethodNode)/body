{
  final MethodNode parentNode=(MethodNode)node.getParent();
  final String callerText=getText(node.getMethod());
  final Document callerDocument=myCallerEditor.getDocument();
  final String calleeText=parentNode != null ? getText(parentNode.getMethod()) : "";
  final Document calleeDocument=myCalleeEditor.getDocument();
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      callerDocument.replaceString(0,callerDocument.getTextLength(),callerText);
      calleeDocument.replaceString(0,calleeDocument.getTextLength(),calleeText);
    }
  }
);
  final PsiMethod caller=node.getMethod();
  final PsiMethod callee=parentNode != null ? parentNode.getMethod() : null;
  if (caller != null && callee != null) {
    final PsiReference[] refs=myMethod.getManager().getSearchHelper().findReferences(callee,new LocalSearchScope(caller),false);
    HighlightManager highlighter=HighlightManager.getInstance(myProject);
    EditorColorsManager colorManager=EditorColorsManager.getInstance();
    TextAttributes attributes=colorManager.getGlobalScheme().getAttributes(EditorColors.TEXT_SEARCH_RESULT_ATTRIBUTES);
    int start=getStartOffset(caller);
    for (int i=0; i < refs.length; i++) {
      final PsiElement element=refs[i].getElement();
      if (element != null) {
        highlighter.addRangeHighlight(myCallerEditor,element.getTextRange().getStartOffset() - start,element.getTextRange().getEndOffset() - start,attributes,false,null);
      }
    }
  }
}
