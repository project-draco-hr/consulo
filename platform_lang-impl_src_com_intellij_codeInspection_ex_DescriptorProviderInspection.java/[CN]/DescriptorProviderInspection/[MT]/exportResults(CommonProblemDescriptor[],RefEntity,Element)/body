{
  for (  CommonProblemDescriptor description : descriptions) {
    @NonNls final String template=description.getDescriptionTemplate();
    int line=description instanceof ProblemDescriptor ? ((ProblemDescriptor)description).getLineNumber() : -1;
    final PsiElement psiElement=description instanceof ProblemDescriptor ? ((ProblemDescriptor)description).getPsiElement() : null;
    @NonNls String problemText=StringUtil.replace(StringUtil.replace(template,"#ref",psiElement != null ? ProblemDescriptionNode.extractHighlightedText(description,psiElement) : "")," #loc "," ");
    Element element=refEntity.getRefManager().export(refEntity,parentNode,line);
    @NonNls Element problemClassElement=new Element(InspectionsBundle.message("inspection.export.results.problem.element.tag"));
    problemClassElement.addContent(getDisplayName());
    if (refEntity instanceof RefElement) {
      final RefElement refElement=(RefElement)refEntity;
      final HighlightSeverity severity=getCurrentSeverity(refElement);
      ProblemHighlightType problemHighlightType=description instanceof ProblemDescriptor ? ((ProblemDescriptor)description).getHighlightType() : ProblemHighlightType.GENERIC_ERROR_OR_WARNING;
      final String attributeKey=getTextAttributeKey(refElement.getRefManager().getProject(),severity,problemHighlightType);
      problemClassElement.setAttribute("severity",severity.myName);
      problemClassElement.setAttribute("attribute_key",attributeKey);
    }
    element.addContent(problemClassElement);
    if (this instanceof GlobalInspectionToolWrapper) {
      final GlobalInspectionTool globalInspectionTool=((GlobalInspectionToolWrapper)this).getTool();
      final QuickFix[] fixes=description.getFixes();
      if (fixes != null) {
        @NonNls Element hintsElement=new Element("hints");
        for (        QuickFix fix : fixes) {
          final String hint=globalInspectionTool.getHint(fix);
          if (hint != null) {
            @NonNls Element hintElement=new Element("hint");
            hintElement.setAttribute("value",hint);
            hintsElement.addContent(hintElement);
          }
        }
        element.addContent(hintsElement);
      }
    }
    try {
      Element descriptionElement=new Element(InspectionsBundle.message("inspection.export.results.description.tag"));
      descriptionElement.addContent(problemText);
      element.addContent(descriptionElement);
    }
 catch (    IllegalDataException e) {
      System.out.println("Cannot save results for " + refEntity.getName() + ", inspection which caused problem: "+ getShortName());
    }
  }
}
