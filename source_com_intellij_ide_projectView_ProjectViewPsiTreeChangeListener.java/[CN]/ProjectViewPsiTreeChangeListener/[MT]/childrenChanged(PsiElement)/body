{
  if (parent instanceof PsiDirectory && isFlattenPackages()) {
    getUpdater().addSubtreeToUpdate(getRootNode());
    return;
  }
  while (true) {
    if (parent == null)     break;
    if (parent instanceof PsiCodeBlock)     break;
    if (parent instanceof PsiFile) {
      VirtualFile virtualFile=((PsiFile)parent).getVirtualFile();
      if (virtualFile != null && myFileTypeManager.getFileTypeByFile(virtualFile) != FileTypes.PLAIN_TEXT) {
        parent=((PsiFile)parent).getContainingDirectory();
        if (parent == null)         break;
      }
    }
    if (getUpdater().addSubtreeToUpdateByElement(parent)) {
      break;
    }
    if (parent instanceof PsiMember || parent instanceof PsiFile || parent instanceof PsiDirectory)     break;
    parent=parent.getParent();
  }
}
