{
  if (parent == null)   return;
  if (parent.getContainingFile() == null)   return;
  if (parent.getContainingFile().getVirtualFile() == null)   return;
  if (parent instanceof PsiDirectory && isFlattenPackages()) {
    getUpdater().addSubtreeToUpdate(getRootNode());
    return;
  }
  while (true) {
    if (parent == null)     break;
    if (parent instanceof PsiCodeBlock)     break;
    if (parent instanceof PsiFile) {
      parent=((PsiFile)parent).getContainingDirectory();
      if (parent == null)       break;
    }
    if (getUpdater().addSubtreeToUpdateByElement(parent)) {
      break;
    }
    if (parent instanceof PsiMethod || parent instanceof PsiField || parent instanceof PsiClass|| parent instanceof PsiFile|| parent instanceof PsiDirectory)     break;
    parent=parent.getParent();
  }
}
