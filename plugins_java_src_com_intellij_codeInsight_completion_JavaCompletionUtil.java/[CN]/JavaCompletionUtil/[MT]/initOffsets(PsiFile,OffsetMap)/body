{
  int offset=Math.max(offsetMap.getOffset(CompletionInitializationContext.SELECTION_END_OFFSET),offsetMap.getOffset(CompletionInitializationContext.IDENTIFIER_END_OFFSET));
  PsiElement element=file.findElementAt(offset);
  if (element instanceof PsiWhiteSpace && (!element.textContains('\n') || CodeStyleSettingsManager.getSettings(file.getProject()).getCommonSettings(JavaLanguage.INSTANCE).METHOD_PARAMETERS_LPAREN_ON_NEXT_LINE)) {
    element=file.findElementAt(element.getTextRange().getEndOffset());
  }
  if (element == null)   return;
  if (LEFT_PAREN.accepts(element)) {
    offsetMap.addOffset(LPAREN_OFFSET,element.getTextRange().getStartOffset());
    PsiElement list=element.getParent();
    PsiElement last=list.getLastChild();
    if (last instanceof PsiJavaToken && ((PsiJavaToken)last).getTokenType() == JavaTokenType.RPARENTH) {
      offsetMap.addOffset(RPAREN_OFFSET,last.getTextRange().getStartOffset());
    }
    offsetMap.addOffset(ARG_LIST_END_OFFSET,list.getTextRange().getEndOffset());
  }
}
