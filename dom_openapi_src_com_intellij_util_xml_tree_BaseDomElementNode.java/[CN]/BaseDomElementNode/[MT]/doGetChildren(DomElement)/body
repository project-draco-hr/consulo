{
  if (!element.isValid())   return NO_CHILDREN;
  List<SimpleNode> children=new ArrayList<SimpleNode>();
  final XmlTag tag=element.getXmlTag();
  final XmlElementDescriptor xmlElementDescriptor=tag == null ? null : tag.getDescriptor();
  final XmlElementDescriptor[] xmlDescriptors=xmlElementDescriptor == null ? null : xmlElementDescriptor.getElementsDescriptors(tag);
  for (  DomFixedChildDescription description : element.getGenericInfo().getFixedChildrenDescriptions()) {
    String childName=description.getXmlElementName();
    if (xmlDescriptors != null) {
      if (findDescriptor(xmlDescriptors,childName) == -1)       continue;
    }
    final List<? extends DomElement> values=description.getStableValues(element);
    if (shouldBeShown(description.getType())) {
      if (DomUtil.isGenericValueType(description.getType())) {
        for (        DomElement value : values) {
          children.add(new GenericValueNode((GenericDomValue)value,this));
        }
      }
 else {
        for (        DomElement domElement : values) {
          children.add(new BaseDomElementNode(domElement,myRootDomElement,this));
        }
      }
    }
  }
  for (  DomCollectionChildDescription description : element.getGenericInfo().getCollectionChildrenDescriptions()) {
    if (shouldBeShown(description.getType())) {
      DomElementsGroupNode groupNode=new DomElementsGroupNode(element,description,this,myRootDomElement);
      if (isMarkedType(description.getType(),CONSOLIDATED_NODES_KEY)) {
        Collections.addAll(children,groupNode.getChildren());
      }
 else {
        children.add(groupNode);
      }
    }
  }
  AbstractDomElementNode[] childrenNodes=children.toArray(new AbstractDomElementNode[children.size()]);
  Comparator<AbstractDomElementNode> comparator=myDomElement.getRoot().getFile().getUserData(COMPARATOR_KEY);
  if (comparator == null) {
    comparator=getDefaultComparator(element);
  }
  if (comparator != null) {
    Arrays.sort(childrenNodes,comparator);
  }
  return childrenNodes;
}
