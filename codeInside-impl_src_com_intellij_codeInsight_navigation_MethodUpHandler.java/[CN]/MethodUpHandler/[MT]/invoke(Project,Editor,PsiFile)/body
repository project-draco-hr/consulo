{
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  int caretOffset=editor.getCaretModel().getOffset();
  int caretLine=editor.getCaretModel().getLogicalPosition().line;
  PsiElement element=file;
  if (file instanceof XmlFile) {
    PsiElement elementAt=file.findElementAt(caretOffset);
    elementAt=PsiTreeUtil.getParentOfType(elementAt,XmlTag.class);
    if (elementAt != null)     element=elementAt;
  }
  int[] offsets=MethodUpDownUtil.getNavigationOffsets(element);
  for (int i=offsets.length - 1; i >= 0; i--) {
    int offset=offsets[i];
    if (offset < caretOffset) {
      int line=editor.offsetToLogicalPosition(offset).line;
      if (line < caretLine) {
        editor.getCaretModel().moveToOffset(offset);
        editor.getSelectionModel().removeSelection();
        editor.getScrollingModel().scrollToCaret(ScrollType.CENTER_UP);
        IdeDocumentHistory.getInstance(project).includeCurrentCommandAsNavigation();
        break;
      }
    }
  }
}
