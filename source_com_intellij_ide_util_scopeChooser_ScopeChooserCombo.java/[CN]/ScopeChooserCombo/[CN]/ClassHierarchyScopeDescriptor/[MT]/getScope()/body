{
  if (myCachedScope == null) {
    TreeClassChooser chooser=TreeClassChooserFactory.getInstance(getProject()).createAllProjectScopeChooser("Choose Base Class of the Hierarchy to Search In");
    chooser.showDialog();
    PsiClass aClass=chooser.getSelectedClass();
    if (aClass == null)     return null;
    List<PsiElement> classesToSearch=new LinkedList<PsiElement>();
    classesToSearch.add(aClass);
    final PsiManager psiManager=PsiManager.getInstance(myProject);
    final GlobalSearchScope searchScope=GlobalSearchScope.allScope(myProject);
    final PsiClass[] descendants=psiManager.getSearchHelper().findInheritors(aClass,searchScope,true);
    classesToSearch.addAll(Arrays.asList(descendants));
    myCachedScope=new LocalSearchScope(classesToSearch.toArray(new PsiElement[classesToSearch.size()]),"Hierarchy of " + aClass.getQualifiedName());
  }
  return myCachedScope;
}
