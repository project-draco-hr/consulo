{
  if (myCachedScope == null) {
    TreeClassChooser chooser=TreeClassChooserFactory.getInstance(getProject()).createAllProjectScopeChooser(IdeBundle.message("prompt.choose.base.class.of.the.hierarchy"));
    chooser.showDialog();
    PsiClass aClass=chooser.getSelectedClass();
    if (aClass == null)     return null;
    List<PsiElement> classesToSearch=new LinkedList<PsiElement>();
    classesToSearch.add(aClass);
    final PsiManager psiManager=PsiManager.getInstance(myProject);
    final PsiClass[] descendants=psiManager.getSearchHelper().findInheritors(aClass,aClass.getUseScope(),true);
    classesToSearch.addAll(Arrays.asList(descendants));
    myCachedScope=new LocalSearchScope(classesToSearch.toArray(new PsiElement[classesToSearch.size()]),IdeBundle.message("scope.hierarchy",ClassPresentationUtil.getNameForClass(aClass,true)));
  }
  return myCachedScope;
}
