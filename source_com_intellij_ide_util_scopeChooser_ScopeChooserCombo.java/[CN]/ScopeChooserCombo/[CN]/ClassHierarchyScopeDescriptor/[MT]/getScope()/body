{
  if (myCachedScope == null) {
    TreeClassChooser chooser=TreeClassChooserFactory.getInstance(myProject).createAllProjectScopeChooser(IdeBundle.message("prompt.choose.base.class.of.the.hierarchy"));
    chooser.showDialog();
    PsiClass aClass=chooser.getSelectedClass();
    if (aClass == null)     return null;
    List<PsiElement> classesToSearch=new LinkedList<PsiElement>();
    classesToSearch.add(aClass);
    classesToSearch.addAll(ClassInheritorsSearch.search(aClass,aClass.getUseScope(),true).findAll());
    myCachedScope=new LocalSearchScope(classesToSearch.toArray(new PsiElement[classesToSearch.size()]),IdeBundle.message("scope.hierarchy",ClassPresentationUtil.getNameForClass(aClass,true)));
  }
  return myCachedScope;
}
