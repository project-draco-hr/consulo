{
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      final PsiElement element=parameters.getPosition();
      final PsiReference reference=element.getContainingFile().findReferenceAt(parameters.getOffset());
      if (reference != null) {
        final Pair<ElementFilter,TailType> pair=getReferenceFilter(element);
        if (pair != null) {
          final THashSet<LookupItem> set=new THashSet<LookupItem>();
          JavaSmartCompletionContributor.SMART_DATA.completeReference(reference,element,set,pair.second,result.getPrefixMatcher(),parameters.getOriginalFile(),pair.first,new CompletionVariant());
          for (          final LookupItem item : set) {
            result.addElement(item);
          }
        }
      }
    }
  }
);
  return true;
}
