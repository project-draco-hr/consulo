{
  E oldValue;
  Object[] elements;
  Object[] newElements;
  do {
    elements=array;
    oldValue=get(elements,index);
    if (oldValue == element) {
      newElements=elements;
    }
 else {
      newElements=createArraySet(elements,index,element);
    }
  }
 while (!replaceArray(elements,newElements));
  return oldValue;
}
