{
  final String actionName=VcsBundle.message("changes.action.rollback.text");
  final LocalHistoryAction action=LocalHistory.startAction(project,actionName);
  RefreshSession session=RefreshQueue.getInstance().createSession(asynchronous,false,new Runnable(){
    public void run(){
      action.finish();
      LocalHistory.putSystemLabel(project,(localHistoryActionName == null) ? actionName : localHistoryActionName);
      if (!project.isDisposed()) {
        for (        FilePath path : pathsToRefresh) {
          if (path.isDirectory()) {
            VcsDirtyScopeManager.getInstance(project).dirDirtyRecursively(path);
          }
 else {
            VcsDirtyScopeManager.getInstance(project).fileDirty(path);
          }
        }
        runAfter.run();
      }
    }
  }
);
  for (  FilePath path : pathsToRefresh) {
    final VirtualFile vf=path.getVirtualFile();
    if (vf != null) {
      session.addFile(vf);
    }
  }
  session.launch();
}
