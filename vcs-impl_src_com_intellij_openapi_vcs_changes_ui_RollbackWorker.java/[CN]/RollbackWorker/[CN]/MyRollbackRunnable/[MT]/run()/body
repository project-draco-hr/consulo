{
  myIndicator=ProgressManager.getInstance().getProgressIndicator();
  final List<Change> changesToRefresh=new ArrayList<Change>();
  try {
    ChangesUtil.processChangesByVcs(myProject,myChanges,new ChangesUtil.PerVcsProcessor<Change>(){
      public void process(      AbstractVcs vcs,      List<Change> changes){
        final RollbackEnvironment environment=vcs.getRollbackEnvironment();
        if (environment != null) {
          changesToRefresh.addAll(changes);
          if (myIndicator != null) {
            myIndicator.setText(vcs.getDisplayName() + ": performing rollback...");
            myIndicator.setIndeterminate(false);
            myIndicator.checkCanceled();
          }
          environment.rollbackChanges(changes,myExceptions,new RollbackProgressModifier(changes.size(),myIndicator));
          if (myIndicator != null) {
            myIndicator.setText2("");
            myIndicator.checkCanceled();
          }
          if (myExceptions.isEmpty() && myDeleteLocallyAddedFiles) {
            deleteAddedFilesLocally(changes);
          }
        }
      }
    }
);
  }
 catch (  ProcessCanceledException e) {
  }
  if (myIndicator != null) {
    myIndicator.startNonCancelableSection();
    myIndicator.setIndeterminate(true);
    myIndicator.setText2("");
    myIndicator.setText(VcsBundle.message("progress.text.synchronizing.files"));
  }
  doRefresh(myProject,changesToRefresh);
  AbstractVcsHelper.getInstanceChecked(myProject).showErrors(myExceptions,VcsBundle.message("changes.action.rollback.text"));
}
