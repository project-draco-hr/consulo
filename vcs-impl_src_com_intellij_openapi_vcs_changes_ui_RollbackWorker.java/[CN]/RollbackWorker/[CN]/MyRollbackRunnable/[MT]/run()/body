{
  myIndicator=ProgressManager.getInstance().getProgressIndicator();
  try {
    ChangesUtil.processChangesByVcs(myProject,myChanges,new ChangesUtil.PerVcsProcessor<Change>(){
      public void process(      AbstractVcs vcs,      List<Change> changes){
        final RollbackEnvironment environment=vcs.getRollbackEnvironment();
        if (environment != null) {
          myPathsToRefresh.addAll(ChangesUtil.getPaths(changes));
          if (myIndicator != null) {
            myIndicator.setText(vcs.getDisplayName() + ": doing rollback...");
            myIndicator.setIndeterminate(false);
            myIndicator.checkCanceled();
          }
          environment.rollbackChanges(changes,myExceptions,new RollbackProgressModifier(changes.size(),myIndicator));
          if (myIndicator != null) {
            myIndicator.setText2("");
            myIndicator.checkCanceled();
          }
          if (myExceptions.isEmpty() && myDeleteLocallyAddedFiles) {
            deleteAddedFilesLocally(changes);
          }
        }
      }
    }
);
  }
 catch (  ProcessCanceledException e) {
  }
  if (myIndicator != null) {
    myIndicator.startNonCancelableSection();
    myIndicator.setIndeterminate(true);
    myIndicator.setText2("");
    myIndicator.setText(VcsBundle.message("progress.text.synchronizing.files"));
  }
  doRefresh(myProject,myPathsToRefresh,(!mySynchronous),myAfterRefresh,myLocalHistoryActionName);
  AbstractVcsHelper.getInstanceChecked(myProject).showErrors(myExceptions,VcsBundle.message("changes.action.rollback.text"));
}
