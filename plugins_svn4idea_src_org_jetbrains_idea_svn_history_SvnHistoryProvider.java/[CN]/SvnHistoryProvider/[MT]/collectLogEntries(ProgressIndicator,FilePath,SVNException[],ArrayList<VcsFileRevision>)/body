{
  SVNWCClient wcClient=myVcs.createWCClient();
  SVNInfo info=wcClient.doInfo(new File(file.getIOFile().getAbsolutePath()),SVNRevision.WORKING);
  if (info == null) {
    exception[0]=new SVNException(SVNErrorMessage.create(SVNErrorCode.UNKNOWN,"File ''{0}'' is not under version control",file.getIOFile()));
    return;
  }
  final String url=info.getURL() == null ? null : info.getURL().toString();
  String relativeUrl=url;
  final String root=info.getRepositoryRootURL().toString();
  if (url != null && url.startsWith(root)) {
    relativeUrl=url.substring(root.length());
  }
  final Ref<String> lastPath=new Ref<String>(relativeUrl);
  if (indicator != null) {
    indicator.setText2(SvnBundle.message("progress.text2.changes.establishing.connection",url));
  }
  final SVNRevision pegRevision=info.getRevision();
  SVNLogClient client=myVcs.createLogClient();
  client.doLog(new File[]{new File(file.getIOFile().getAbsolutePath())},SVNRevision.HEAD,SVNRevision.create(1),false,true,0,new ISVNLogEntryHandler(){
    public void handleLogEntry(    SVNLogEntry logEntry){
      if (indicator != null) {
        indicator.setText2(SvnBundle.message("progress.text2.revision.processed",logEntry.getRevision()));
      }
      Date date=logEntry.getDate();
      String author=logEntry.getAuthor();
      String message=logEntry.getMessage();
      SVNRevision rev=SVNRevision.create(logEntry.getRevision());
      String copyPath=null;
      SVNLogEntryPath entryPath=(SVNLogEntryPath)logEntry.getChangedPaths().get(lastPath.get());
      if (entryPath != null) {
        copyPath=entryPath.getCopyPath();
      }
 else {
        String path=SVNPathUtil.removeTail(lastPath.get());
        while (path.length() > 0) {
          entryPath=(SVNLogEntryPath)logEntry.getChangedPaths().get(path);
          if (entryPath != null) {
            String relativePath=lastPath.get().substring(entryPath.getPath().length());
            copyPath=entryPath.getCopyPath() + relativePath;
            break;
          }
          path=SVNPathUtil.removeTail(path);
        }
      }
      if (copyPath != null) {
        lastPath.set(copyPath);
      }
      result.add(new SvnFileRevision(myVcs,pegRevision,rev,url,author,date,message,copyPath));
    }
  }
);
}
