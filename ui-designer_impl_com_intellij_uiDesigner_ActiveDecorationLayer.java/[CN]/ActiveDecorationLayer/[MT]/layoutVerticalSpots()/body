{
  final RadRootContainer rootContainer=myEditor.getRootContainer();
  for (Iterator<Map.Entry<RadContainer,ArrayList<ActiveSpot>>> i=myVerticalSpots.entrySet().iterator(); i.hasNext(); ) {
    final Map.Entry<RadContainer,ArrayList<ActiveSpot>> entry=i.next();
    final RadContainer container=(RadContainer)FormEditingUtil.findComponent(rootContainer,entry.getKey().getId());
    final ArrayList<ActiveSpot> spots=entry.getValue();
    if (container == null || !container.hasDragger() || !container.isGrid()) {
      for (int j=spots.size() - 1; j >= 0; j--) {
        disposeSpot(spots.get(j));
      }
      i.remove();
    }
 else {
      final GridLayoutManager layout=(GridLayoutManager)container.getLayout();
      final int rowCount=layout.getRowCount();
      if (rowCount > spots.size()) {
        for (int j=rowCount - spots.size() - 1; j >= 0; j--) {
          createSpot(spots);
        }
      }
 else       if (rowCount < spots.size()) {
        for (int j=spots.size() - rowCount - 1; j >= 0; j--) {
          disposeSpot(spots.remove(j));
        }
      }
    }
  }
  FormEditingUtil.iterate(rootContainer,new FormEditingUtil.ComponentVisitor<RadComponent>(){
    public boolean visit(    final RadComponent component){
      if (!(component instanceof RadContainer)) {
        return true;
      }
      final RadContainer container=(RadContainer)component;
      if (!container.isGrid() || !container.hasDragger() || myVerticalSpots.containsKey(container)) {
        return true;
      }
      final GridLayoutManager layout=(GridLayoutManager)container.getLayout();
      final ArrayList<ActiveSpot> spots=new ArrayList<ActiveSpot>();
      myVerticalSpots.put(container,spots);
      for (int i=layout.getRowCount() - 1; i >= 0; i--) {
        createSpot(spots);
      }
      return true;
    }
  }
);
  for (Iterator<Map.Entry<RadContainer,ArrayList<ActiveSpot>>> i=myVerticalSpots.entrySet().iterator(); i.hasNext(); ) {
    final Map.Entry<RadContainer,ArrayList<ActiveSpot>> entry=i.next();
    final RadContainer container=entry.getKey();
    LOG.assertTrue(container.isGrid());
    final GridLayoutManager layout=(GridLayoutManager)container.getLayout();
    final ArrayList<ActiveSpot> spots=entry.getValue();
    LOG.assertTrue(spots.size() == layout.getRowCount());
    final int[] heights=layout.getHeights();
    final int[] ys=layout.getYs();
    final JComponent delegee=container.getDelegee();
    final Point topLeftPoint=SwingUtilities.convertPoint(delegee,0,0,ActiveDecorationLayer.this);
    for (int j=heights.length - 1; j >= 0; j--) {
      final ActiveSpot spot=spots.get(j);
      spot.setContainer(container);
      spot.setCell(j);
      spot.setOrientation(SwingConstants.VERTICAL);
      spot.setCellSize(heights[j]);
      spot.updateActions();
      final Dimension prefSize=spot.getPreferredSize();
      final int width=prefSize.width;
      final int shift=Math.max(0,heights[j] - prefSize.height) / 2;
      spot.setBounds(topLeftPoint.x - width,topLeftPoint.y + ys[j] + shift,width,heights[j] - shift);
      spot.validate();
    }
  }
}
