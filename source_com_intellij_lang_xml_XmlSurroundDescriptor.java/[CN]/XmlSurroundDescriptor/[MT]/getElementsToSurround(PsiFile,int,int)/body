{
  final Pair<XmlTagChild,XmlTagChild> childrenInRange=XmlUtil.findTagChildrenInRange(file,startOffset,endOffset);
  if (childrenInRange == null) {
    final PsiElement elementAt=file.findElementAt(startOffset);
    if (elementAt instanceof XmlToken && ((XmlToken)elementAt).getTokenType() == XmlTokenType.XML_DATA_CHARACTERS) {
      return new PsiElement[]{elementAt};
    }
    return PsiElement.EMPTY_ARRAY;
  }
  List<PsiElement> result=new ArrayList<PsiElement>();
  PsiElement first=childrenInRange.getFirst();
  PsiElement last=childrenInRange.getSecond();
  while (true) {
    result.add(first);
    if (first == last)     break;
    first=first.getNextSibling();
  }
  return result.toArray(new PsiElement[result.size()]);
}
