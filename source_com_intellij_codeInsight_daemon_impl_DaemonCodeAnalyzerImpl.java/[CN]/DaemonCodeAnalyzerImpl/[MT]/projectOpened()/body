{
  EditorEventMulticaster eventMulticaster=EditorFactory.getInstance().getEventMulticaster();
  myDocumentListener=new DocumentAdapter(){
    public void documentChanged(    DocumentEvent e){
      stopProcess(true);
      UpdateHighlightersUtil.updateHighlightersByTyping(myProject,e);
    }
  }
;
  eventMulticaster.addDocumentListener(myDocumentListener);
  myCaretListener=new CaretListener(){
    public void caretPositionChanged(    CaretEvent e){
      stopProcess(true);
    }
  }
;
  eventMulticaster.addCaretListener(myCaretListener);
  eventMulticaster.addEditorMouseMotionListener(myEditorMouseMotionListener);
  myEditorTracker=createEditorTracker();
  myEditorTracker.addEditorTrackerListener(new EditorTrackerListener(){
    public void activeEditorsChanged(    final Editor[] editors){
      if (editors.length > 0) {
        myIsFrameFocused=true;
      }
      stopProcess(true);
    }
  }
);
  myEditorFactoryListener=new EditorFactoryAdapter(){
    public void editorCreated(    EditorFactoryEvent event){
      Editor editor=event.getEditor();
      Document document=editor.getDocument();
      PsiFile file=PsiDocumentManager.getInstance(myProject).getPsiFile(document);
      if (file != null) {
        ((EditorMarkupModel)editor.getMarkupModel()).setErrorStripeRenderer(new RefreshStatusRenderer(myProject,DaemonCodeAnalyzerImpl.this,document,file));
      }
    }
  }
;
  EditorFactory.getInstance().addEditorFactoryListener(myEditorFactoryListener);
  PsiManager.getInstance(myProject).addPsiTreeChangeListener(new PsiChangeHandler(myProject,this));
  ProjectRootManager.getInstance(myProject).addModuleRootListener(new ModuleRootListener(){
    public void beforeRootsChange(    ModuleRootEvent event){
    }
    public void rootsChanged(    ModuleRootEvent event){
      final Editor editor=FileEditorManager.getInstance(myProject).getSelectedTextEditor();
      if (editor != null) {
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          public void run(){
            final EditorMarkupModel markupModel=(EditorMarkupModel)editor.getMarkupModel();
            final Document document=editor.getDocument();
            final PsiFile psiFile=PsiDocumentManager.getInstance(myProject).getPsiFile(document);
            markupModel.setErrorStripeRenderer(new RefreshStatusRenderer(myProject,DaemonCodeAnalyzerImpl.this,document,psiFile));
          }
        }
,ModalityState.stateForComponent(editor.getComponent()));
      }
    }
  }
);
  CommandProcessor.getInstance().addCommandListener(myCommandListener);
  ApplicationManager.getApplication().addApplicationListener(myApplicationListener);
  EditorColorsManager.getInstance().addEditorColorsListener(myEditorColorsListener);
  TodoConfiguration.getInstance().addPropertyChangeListener(myTodoListener);
  ActionManagerEx.getInstanceEx().addAnActionListener(myAnActionListener);
  ExternalResourceManagerEx.getInstanceEx().addExteralResourceListener(myExternalResourceListener);
  if (myProject.hasComponent(AntConfiguration.class)) {
    AntConfiguration.getInstance(myProject).addAntConfigurationListener(myAntConfigurationListener);
  }
  myStatusBarUpdater=new StatusBarUpdater(myProject);
  myErrorStripeHandler=new ErrorStripeHandler(myProject);
  ((EditorEventMulticasterEx)eventMulticaster).addErrorStripeListener(myErrorStripeHandler);
  ProjectManager.getInstance().addProjectManagerListener(myProject,new ProjectManagerAdapter(){
    public void projectClosing(    Project project){
      dispose();
    }
  }
);
  IdeFrame frame=((WindowManagerEx)WindowManager.getInstance()).getFrame(myProject);
  if (frame != null) {
    frame.addWindowFocusListener(myIdeFrameFocusListener);
  }
  myInitialized=true;
}
