{
  Document document=EditorFactory.getInstance().createDocument("[xxxxxxxxxxxxxx]");
  final Editor editor=EditorFactory.getInstance().createEditor(document);
  try {
    final FoldRegion[] fold=new FoldRegion[1];
    editor.getFoldingModel().runBatchFoldingOperation(new Runnable(){
      @Override public void run(){
        fold[0]=editor.getFoldingModel().addFoldRegion(0,2,"");
      }
    }
);
    RangeMarker marker=document.createRangeMarker(0,2);
    document.deleteString(1,2);
    assertTrue(marker.isValid());
    assertFalse(fold[0].isValid());
  }
  finally {
    EditorFactory.getInstance().releaseEditor(editor);
  }
}
