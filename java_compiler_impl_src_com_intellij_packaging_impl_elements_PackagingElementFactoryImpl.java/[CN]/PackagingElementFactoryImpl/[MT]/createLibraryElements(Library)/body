{
  final LibraryTable table=library.getTable();
  final String libraryName=library.getName();
  if (table != null) {
    return Collections.singletonList(createLibraryFiles(libraryName,table.getTableLevel(),null));
  }
  if (libraryName != null) {
    final Module module=((LibraryImpl)library).getModule();
    if (module != null) {
      return Collections.singletonList(createLibraryFiles(libraryName,LibraryTableImplUtil.MODULE_LEVEL,module.getName()));
    }
  }
  final List<PackagingElement<?>> elements=new ArrayList<PackagingElement<?>>();
  for (  VirtualFile file : library.getFiles(OrderRootType.CLASSES)) {
    final String path=FileUtil.toSystemIndependentName(PathUtil.getLocalPath(file));
    elements.add(file.isDirectory() && file.isInLocalFileSystem() ? new DirectoryCopyPackagingElement(path) : new FileCopyPackagingElement(path));
  }
  return elements;
}
