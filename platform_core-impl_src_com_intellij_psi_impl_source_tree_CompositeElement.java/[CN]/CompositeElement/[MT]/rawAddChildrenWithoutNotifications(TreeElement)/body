{
  if (DebugUtil.DO_EXPENSIVE_CHECKS && !(this instanceof LazyParseableElement)) {
    PsiFileImpl file=getCachedFile(this);
    if (file != null && !file.useStrongRefs()) {
      throw new AssertionError("Attempt to modify PSI in a file with weakly-referenced AST. Possible cause: missing PomTransaction.");
    }
  }
  final TreeElement last=getLastChildNode();
  if (last == null) {
    first.rawRemoveUpToWithoutNotifications(null,false);
    setFirstChildNode(first);
    while (true) {
      final TreeElement treeNext=first.getTreeNext();
      first.setTreeParent(this);
      if (treeNext == null)       break;
      first=treeNext;
    }
    setLastChildNode(first);
    first.setTreeParent(this);
  }
 else {
    last.rawInsertAfterMeWithoutNotifications(first);
  }
  DebugUtil.checkTreeStructure(this);
}
