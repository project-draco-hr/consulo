{
  return ApplicationManager.getApplication().runReadAction(new Computable<ProcessingItem[]>(){
    public ProcessingItem[] compute(){
      final CompileScope compileScope=context.getCompileScope();
      final Module[] affectedModules=compileScope.getAffectedModules();
      if (affectedModules.length == 0)       return ProcessingItem.EMPTY_ARRAY;
      Project project=affectedModules[0].getProject();
      Module[] modules=ModuleManager.getInstance(project).getModules();
      Collection<Module> modulesToRebuild=new THashSet<Module>();
      for (      Module module : modules) {
        BuildJarSettings jarSettings=BuildJarSettings.getInstance(module);
        if (jarSettings == null || !jarSettings.isBuildJar())         continue;
        ModuleContainer moduleContainer=jarSettings.getModuleContainer();
        ModuleLink[] containingModules=moduleContainer.getContainingModules();
        for (        ModuleLink moduleLink : containingModules) {
          Module containingModule=moduleLink.getModule();
          if (ArrayUtil.find(affectedModules,containingModule) != -1) {
            modulesToRebuild.add(module);
          }
        }
      }
      ProcessingItem[] result=new ProcessingItem[modulesToRebuild.size()];
      int i=0;
      for (      Module moduleToBuild : modulesToRebuild) {
        if (moduleToBuild.getModuleFile() == null)         continue;
        result[i++]=new MyProcItem(moduleToBuild);
      }
      return result;
    }
  }
);
}
