{
  SmartPsiElementPointer[] lastSearchElements=myLastSearchData.myLastSearchElements;
  if (lastSearchElements == null)   return false;
  List<PsiElement> elements=new ArrayList<PsiElement>();
  for (  SmartPsiElementPointer pointer : lastSearchElements) {
    PsiElement element=pointer.getElement();
    if (element != null)     elements.add(element);
  }
  if (elements.isEmpty()) {
    Messages.showMessageDialog(myProject,FindBundle.message("find.searched.elements.have.been.changed.error"),FindBundle.message("cannot.search.for.usages.title"),Messages.getInformationIcon());
    return true;
  }
  TextEditor textEditor=(TextEditor)editor;
  Document document=textEditor.getEditor().getDocument();
  PsiFile psiFile=PsiDocumentManager.getInstance(myProject).getPsiFile(document);
  if (psiFile == null)   return false;
  PsiElement[] allElements=elements.toArray(new PsiElement[elements.size()]);
  FindUsagesOptions options=myLastSearchData.myLastOptions;
  findUsagesInEditor(new UsageInfoToUsageConverter.TargetElementsDescriptor(allElements),psiFile,direction,options,textEditor);
  return true;
}
