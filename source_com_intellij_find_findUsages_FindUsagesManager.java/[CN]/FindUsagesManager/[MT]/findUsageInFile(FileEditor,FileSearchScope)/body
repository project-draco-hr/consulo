{
  if (editor == null) {
    throw new IllegalArgumentException("editor cannot be null");
  }
  SmartPsiElementPointer[] lastSearchElements=myLastSearchData.myLastSearchElements;
  if (lastSearchElements == null)   return false;
  List<PsiElement> elements=new ArrayList<PsiElement>();
  for (  SmartPsiElementPointer pointer : lastSearchElements) {
    PsiElement element=pointer.getElement();
    if (element != null)     elements.add(element);
  }
  if (elements.size() == 0) {
    Messages.showMessageDialog(myProject,"Searched elements have been changed.\n" + "Cannot search for usages.","Cannot Search for Usages",Messages.getInformationIcon());
    return true;
  }
  TextEditor textEditor=(TextEditor)editor;
  Document document=textEditor.getEditor().getDocument();
  PsiFile psiFile=PsiDocumentManager.getInstance(myProject).getPsiFile(document);
  if (psiFile == null)   return false;
  PsiElement[] allElements=elements.toArray(new PsiElement[elements.size()]);
  FindUsagesOptions options=myLastSearchData.myLastOptions;
  findUsagesInEditor(new UsageInfoToUsageConverter.TargetElementsDescriptor(allElements),psiFile,direction,options,textEditor);
  return true;
}
