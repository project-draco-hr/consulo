{
  final FindUsagesHandler handler=findHandler(element);
  if (handler == null)   return null;
  FindUsagesOptions findUsagesOptions=handler.getFindUsagesOptions();
  LOG.assertTrue(handler.getPsiElement().isValid());
  final UsageInfoToUsageConverter.TargetElementsDescriptor descriptor=new UsageInfoToUsageConverter.TargetElementsDescriptor(handler.getPrimaryElements(),handler.getSecondaryElements());
  UsageViewPresentation presentation=createPresentation(element,findUsagesOptions,myToOpenInNewTab);
  final UsageSearcher usageSearcher=createUsageSearcher(descriptor,findUsagesOptions,null);
  final boolean[] canceled=new boolean[]{false};
  Task task=new Task.Modal(myProject,UsageViewManagerImpl.getProgressTitle(presentation),true){
    public void run(    final ProgressIndicator indicator){
      usageSearcher.generate(processor);
    }
    public void onCancel(){
      canceled[0]=true;
    }
  }
;
  ProgressManager.getInstance().run(task);
  if (canceled[0])   return null;
  return presentation;
}
