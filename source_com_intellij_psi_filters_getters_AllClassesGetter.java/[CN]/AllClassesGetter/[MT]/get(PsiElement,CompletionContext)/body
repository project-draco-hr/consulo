{
  if (context == null || !context.isValid())   return ArrayUtil.EMPTY_OBJECT_ARRAY;
  final List<PsiClass> classesList=new ArrayList<PsiClass>();
  final PsiManager manager=context.getManager();
  final PsiShortNamesCache cache=manager.getShortNamesCache();
  final String prefix=context.getUserData(CompletionUtil.COMPLETION_PREFIX);
  if (myPrefixStr != prefix) {
    myMatcher=new Perl5Matcher();
    myPattern=CompletionUtil.createCampelHumpsMatcher(prefix);
  }
  final GlobalSearchScope scope=context.getContainingFile().getResolveScope();
  final String[] names=cache.getAllClassNames(true);
  boolean lookingForAnnotations=false;
  final PsiElement prevSibling=context.getParent().getPrevSibling();
  if (prevSibling instanceof PsiJavaToken && ((PsiJavaToken)prevSibling).getTokenType() == JavaTokenType.AT) {
    lookingForAnnotations=true;
  }
  for (  final String name : names) {
    if (prefix != null && !(CompletionUtil.checkName(name,prefix) || myMatcher.matches(name,myPattern)))     continue;
    final PsiClass[] classesByName=cache.getClassesByName(name,scope);
    if (lookingForAnnotations) {
      for (      PsiClass psiClass : classesByName) {
        if (psiClass.isAnnotationType()) {
          classesList.add(psiClass);
        }
      }
    }
 else {
      classesList.addAll(Arrays.asList(classesByName));
    }
  }
  Collections.sort(classesList,new Comparator<PsiClass>(){
    public int compare(    PsiClass psiClass,    PsiClass psiClass1){
      if (manager.areElementsEquivalent(psiClass,psiClass1))       return 0;
      return getClassIndex(psiClass) - getClassIndex(psiClass1);
    }
    private int getClassIndex(    PsiClass psiClass){
      if (psiClass.getManager().isInProject(psiClass))       return 2;
      final String qualifiedName=psiClass.getQualifiedName();
      if (qualifiedName.startsWith(JAVA_PACKAGE_PREFIX) || qualifiedName.startsWith(JAVAX_PACKAGE_PREFIX))       return 1;
      return 0;
    }
    public boolean equals(    Object o){
      return o == this;
    }
  }
);
  return classesList.toArray(PsiClass.EMPTY_ARRAY);
}
