{
  if (!InjectedLanguageManager.getInstance(file.getProject()).isInjectedFragment(file)) {
    PsiElement injected=findInjectedElementNoCommit(file,offset);
    if (injected != null) {
      return injected;
    }
  }
  FileViewProvider viewProvider=file.getViewProvider();
  return viewProvider.findElementAt(offset,viewProvider.getBaseLanguage());
}
