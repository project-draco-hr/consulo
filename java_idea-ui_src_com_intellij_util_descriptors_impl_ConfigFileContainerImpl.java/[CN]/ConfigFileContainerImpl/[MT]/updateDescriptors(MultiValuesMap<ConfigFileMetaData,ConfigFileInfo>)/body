{
  Set<ConfigFile> toDelete=new HashSet<ConfigFile>(myConfigFiles.values());
  Set<ConfigFile> added=new HashSet<ConfigFile>();
  for (  Map.Entry<ConfigFileMetaData,Collection<ConfigFileInfo>> entry : descriptorsMap.entrySet()) {
    ConfigFileMetaData metaData=entry.getKey();
    Set<ConfigFileInfo> newDescriptors=new HashSet<ConfigFileInfo>(entry.getValue());
    final Collection<ConfigFile> oldDescriptors=myConfigFiles.get(metaData);
    if (oldDescriptors != null) {
      for (      ConfigFile descriptor : oldDescriptors) {
        if (newDescriptors.contains(descriptor.getInfo())) {
          newDescriptors.remove(descriptor.getInfo());
          toDelete.remove(descriptor);
        }
      }
    }
    for (    ConfigFileInfo configuration : newDescriptors) {
      final ConfigFileImpl configFile=new ConfigFileImpl(this,configuration);
      Disposer.register(this,configFile);
      myConfigFiles.put(metaData,configFile);
      added.add(configFile);
    }
  }
  for (  ConfigFile descriptor : toDelete) {
    myConfigFiles.remove(descriptor.getMetaData(),descriptor);
    Disposer.dispose(descriptor);
  }
  myCachedConfigFiles=null;
  for (  ConfigFile configFile : added) {
    myDispatcher.getMulticaster().configFileAdded(configFile);
  }
  for (  ConfigFile configFile : toDelete) {
    myDispatcher.getMulticaster().configFileRemoved(configFile);
  }
}
