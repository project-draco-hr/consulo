{
  try {
    validateModel(model);
    final Block block=model.getRootBlock();
    final FormatProcessor processor=buildProcessorAndWrapBlocks(model.getDocumentModel(),block,settings,indentOptions,new FormatTextRanges(affectedRange,true));
    LeafBlockWrapper current=processor.getFirstTokenBlock();
    while (current != null) {
      WhiteSpace whiteSpace=current.getWhiteSpace();
      if (!whiteSpace.isReadOnly() && whiteSpace.containsLineFeeds()) {
        storage.saveIndentInfo(current.calcIndentFromParent(),current.getStartOffset());
      }
      current=current.getNextBlock();
    }
  }
 catch (  FormattingModelInconsistencyException e) {
    LOG.error(e);
  }
}
