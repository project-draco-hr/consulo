{
  try {
    validateModel(model);
    SequentialTask task=new MyFormattingTask(){
      @NotNull @Override protected FormatProcessor buildProcessor(){
        FormatOptions options=new FormatOptions(settings,indentOptions,affectedRanges,formatContextAroundRanges);
        FormatProcessor processor=new FormatProcessor(model.getDocumentModel(),model.getRootBlock(),options,getProgressCallback());
        processor.format(model,true);
        return processor;
      }
    }
;
    execute(task);
  }
 catch (  FormattingModelInconsistencyException e) {
    LOG.error(e);
  }
}
