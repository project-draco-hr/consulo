{
  if (myAllThreadsDirty) {
    myAllThreadsDirty=false;
    List threads=myVirtualMachine.allThreads();
    Map<ThreadReference,ThreadReferenceProxyImpl> result=new HashMap<ThreadReference,ThreadReferenceProxyImpl>();
    for (Iterator iterator=threads.iterator(); iterator.hasNext(); ) {
      ThreadReference threadReference=(ThreadReference)iterator.next();
      ThreadReferenceProxyImpl threadReferenceProxy=getThreadReferenceProxy(threadReference);
      LOG.assertTrue(threadReferenceProxy != null);
      result.put(threadReference,threadReferenceProxy);
    }
    myAllThreads=result;
  }
  return (Collection<ThreadReferenceProxyImpl>)myAllThreads.values();
}
