{
  final Project project=e.getData(CommonDataKeys.PROJECT);
  final DirectoryIndex index=DirectoryIndex.getInstance(project);
  if (project != null) {
    final VirtualFile root=e.getData(PlatformDataKeys.VIRTUAL_FILE);
    ProgressManager.getInstance().runProcessWithProgressSynchronously(new Runnable(){
      @Override public void run(){
        final ContentIterator contentIterator=new ContentIterator(){
          @Override public boolean processFile(          VirtualFile fileOrDir){
            LOG.info(fileOrDir.getPath());
            final DirectoryInfo directoryInfo=index.getInfoForDirectory(fileOrDir);
            if (directoryInfo != null) {
              LOG.info(directoryInfo.toString());
            }
            return true;
          }
        }
;
        if (root != null) {
          ProjectRootManager.getInstance(project).getFileIndex().iterateContentUnderDirectory(root,contentIterator);
        }
 else {
          ProjectRootManager.getInstance(project).getFileIndex().iterateContent(contentIterator);
        }
      }
    }
,"Dumping directory index",true,project);
  }
}
