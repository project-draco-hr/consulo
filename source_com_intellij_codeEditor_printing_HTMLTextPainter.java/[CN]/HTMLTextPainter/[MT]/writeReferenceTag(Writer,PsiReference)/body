{
  PsiClass refClass=(PsiClass)ref.resolve();
  PsiFile refFile=refClass.getContainingFile();
  PsiPackage refPackage=refFile.getContainingDirectory().getPackage();
  String refPackageName="";
  if (refPackage != null) {
    refPackageName=refPackage.getQualifiedName();
  }
  PsiPackage psiPackage=myPsiFile.getContainingDirectory().getPackage();
  String psiPackageName="";
  if (psiPackage != null) {
    psiPackageName=psiPackage.getQualifiedName();
  }
  StringBuffer fileName=new StringBuffer();
  if (!psiPackageName.equals(refPackageName)) {
    StringTokenizer tokens=new StringTokenizer(psiPackageName,".");
    while (tokens.hasMoreTokens()) {
      tokens.nextToken();
      fileName.append("../");
    }
    StringTokenizer refTokens=new StringTokenizer(refPackageName,".");
    while (refTokens.hasMoreTokens()) {
      String token=refTokens.nextToken();
      fileName.append(token);
      fileName.append('/');
    }
  }
  fileName.append(ExportToHTMLManager.getHTMLFileName(refFile));
  writer.write("<a href=\"" + fileName + "\">");
  return ref.getElement().getTextRange().getEndOffset();
}
