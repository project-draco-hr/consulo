{
  final FileAndDirsCollector dirtyFilesAndDirs=new FileAndDirsCollector();
  for (  VFileEvent event : events) {
    if (event instanceof VFileContentChangeEvent) {
      final VirtualFile file=((VFileContentChangeEvent)event).getFile();
      dirtyFilesAndDirs.addToFiles(file);
    }
 else     if (event instanceof VFileCopyEvent) {
      final VirtualFile file=((VFileCopyEvent)event).getFile();
      dirtyFilesAndDirs.addToFiles(file);
    }
 else     if (event instanceof VFileCreateEvent) {
      final VFileCreateEvent ce=((VFileCreateEvent)event);
      final VirtualFile file=ce.getParent().findChild(ce.getChildName());
      dirtyFilesAndDirs.addToFiles(file);
    }
 else     if (event instanceof VFileMoveEvent) {
      dirtyFilesAndDirs.add(((VFileMoveEvent)event).getFile());
    }
 else     if (event instanceof VFilePropertyChangeEvent) {
      final VFilePropertyChangeEvent pce=(VFilePropertyChangeEvent)event;
      VirtualFile file=pce.getFile();
      if (pce.getPropertyName().equals(VirtualFile.PROP_NAME)) {
        if (file.getParent() != null) {
          file=file.getParent();
        }
        dirtyFilesAndDirs.add(file);
      }
 else {
        dirtyFilesAndDirs.addToFiles(file);
      }
    }
  }
  dirtyFilesAndDirs.markDirty();
}
