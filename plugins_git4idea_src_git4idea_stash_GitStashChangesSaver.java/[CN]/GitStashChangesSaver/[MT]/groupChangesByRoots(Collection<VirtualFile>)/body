{
  final Map<VirtualFile,Collection<Change>> sortedChanges=new HashMap<VirtualFile,Collection<Change>>();
  for (  LocalChangeList l : myChangeLists) {
    final Collection<Change> changeCollection=l.getChanges();
    for (    Change c : changeCollection) {
      if (c.getAfterRevision() != null) {
        storeChangeInMap(sortedChanges,c,c.getAfterRevision(),rootsToSave);
      }
 else       if (c.getBeforeRevision() != null) {
        storeChangeInMap(sortedChanges,c,c.getBeforeRevision(),rootsToSave);
      }
    }
  }
  return sortedChanges;
}
