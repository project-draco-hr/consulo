{
  myProject=project;
  bus.connect().subscribe(EditorHintListener.TOPIC,new EditorHintListener(){
    @Override public void hintShown(    final Project project,    final LightweightHint hint,    final int flags){
      if (project == myProject) {
        Lookup lookup=getActiveLookup();
        if (lookup != null && BitUtil.isSet(flags,HintManager.HIDE_BY_LOOKUP_ITEM_CHANGE)) {
          lookup.addLookupListener(new LookupAdapter(){
            @Override public void currentItemChanged(            LookupEvent event){
              hint.hide();
            }
            @Override public void itemSelected(            LookupEvent event){
              hint.hide();
            }
            @Override public void lookupCanceled(            LookupEvent event){
              hint.hide();
            }
          }
);
        }
      }
    }
  }
);
  bus.connect().subscribe(DumbService.DUMB_MODE,new DumbService.DumbModeListener(){
    @Override public void enteredDumbMode(){
      hideActiveLookup();
    }
    @Override public void exitDumbMode(){
      hideActiveLookup();
    }
  }
);
  final EditorFactoryAdapter myEditorFactoryListener=new EditorFactoryAdapter(){
    @Override public void editorReleased(    @NotNull EditorFactoryEvent event){
      if (event.getEditor() == myActiveLookupEditor) {
        hideActiveLookup();
      }
    }
  }
;
  EditorFactory.getInstance().addEditorFactoryListener(myEditorFactoryListener,myProject);
}
