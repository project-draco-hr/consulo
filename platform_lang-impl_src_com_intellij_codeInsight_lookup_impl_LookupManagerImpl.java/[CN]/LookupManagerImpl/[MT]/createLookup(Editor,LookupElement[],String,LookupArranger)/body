{
  hideActiveLookup();
  final CodeInsightSettings settings=CodeInsightSettings.getInstance();
  final PsiFile psiFile=PsiDocumentManager.getInstance(myProject).getPsiFile(editor.getDocument());
  final DaemonCodeAnalyzer daemonCodeAnalyzer=DaemonCodeAnalyzer.getInstance(myProject);
  final boolean previousUpdate;
  if (daemonCodeAnalyzer != null) {
    previousUpdate=((DaemonCodeAnalyzerImpl)daemonCodeAnalyzer).isUpdateByTimerEnabled();
    daemonCodeAnalyzer.setUpdateByTimerEnabled(false);
  }
 else {
    previousUpdate=false;
  }
  final LookupImpl lookup=new LookupImpl(myProject,editor,arranger);
  final Alarm alarm=new Alarm();
  final Runnable request=new Runnable(){
    public void run(){
      if (myActiveLookup == lookup) {
        DocumentationManager.getInstance(myProject).showJavaDocInfo(editor,psiFile,false);
      }
    }
  }
;
  if (settings.AUTO_POPUP_JAVADOC_INFO) {
    alarm.addRequest(request,settings.JAVADOC_INFO_DELAY);
  }
  myActiveLookup=lookup;
  myActiveLookupEditor=editor;
  myActiveLookup.addLookupListener(new LookupAdapter(){
    public void itemSelected(    LookupEvent event){
      lookupClosed();
    }
    public void lookupCanceled(    LookupEvent event){
      lookupClosed();
    }
    public void currentItemChanged(    LookupEvent event){
      alarm.cancelAllRequests();
      if (settings.AUTO_POPUP_JAVADOC_INFO) {
        alarm.addRequest(request,settings.JAVADOC_INFO_DELAY);
      }
    }
    private void lookupClosed(){
      alarm.cancelAllRequests();
      if (daemonCodeAnalyzer != null) {
        daemonCodeAnalyzer.setUpdateByTimerEnabled(previousUpdate);
      }
      if (myActiveLookup == null)       return;
      LOG.assertTrue(myActiveLookup.isDisposed());
      myActiveLookup.removeLookupListener(this);
      Lookup lookup=myActiveLookup;
      myActiveLookup=null;
      myActiveLookupEditor=null;
      myPropertyChangeSupport.firePropertyChange(PROP_ACTIVE_LOOKUP,lookup,null);
    }
  }
);
  if (items.length > 0) {
    for (    final LookupElement item : items) {
      if (prefix != null) {
        item.setPrefixMatcher(new CamelHumpMatcher(prefix));
      }
      myActiveLookup.addItem(item);
    }
    myActiveLookup.refreshUi();
  }
 else {
    alarm.cancelAllRequests();
  }
  myPropertyChangeSupport.firePropertyChange(PROP_ACTIVE_LOOKUP,null,myActiveLookup);
  return myActiveLookup;
}
