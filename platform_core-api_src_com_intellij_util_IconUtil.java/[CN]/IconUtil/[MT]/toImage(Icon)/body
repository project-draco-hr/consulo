{
  if (icon instanceof ImageIcon) {
    return ((ImageIcon)icon).getImage();
  }
 else {
    final int w=icon.getIconWidth();
    final int h=icon.getIconHeight();
    final BufferedImage image=GraphicsEnvironment.getLocalGraphicsEnvironment().getDefaultScreenDevice().getDefaultConfiguration().createCompatibleImage(w,h,Color.TRANSLUCENT);
    final Graphics2D g=image.createGraphics();
    icon.paintIcon(null,g,0,0);
    g.dispose();
    return image;
  }
}
