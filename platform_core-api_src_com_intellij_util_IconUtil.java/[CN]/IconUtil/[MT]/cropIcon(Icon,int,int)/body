{
  if (icon.getIconHeight() <= maxHeight && icon.getIconWidth() <= maxWidth) {
    return icon;
  }
  final int w=Math.min(icon.getIconWidth(),maxWidth);
  final int h=Math.min(icon.getIconHeight(),maxHeight);
  final BufferedImage image=GraphicsEnvironment.getLocalGraphicsEnvironment().getDefaultScreenDevice().getDefaultConfiguration().createCompatibleImage(icon.getIconWidth(),icon.getIconHeight(),Transparency.TRANSLUCENT);
  final Graphics2D g=image.createGraphics();
  icon.paintIcon(new JPanel(),g,0,0);
  g.dispose();
  final BufferedImage img=new BufferedImage(w,h,Transparency.TRANSLUCENT);
  final int offX=icon.getIconWidth() > maxWidth ? (icon.getIconWidth() - maxWidth) / 2 : 0;
  final int offY=icon.getIconHeight() > maxHeight ? (icon.getIconHeight() - maxHeight) / 2 : 0;
  for (int col=0; col < w; col++) {
    for (int row=0; row < h; row++) {
      img.setRGB(col,row,image.getRGB(col + offX,row + offY));
    }
  }
  return new ImageIcon(img);
}
