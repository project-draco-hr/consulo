{
  if (!ApplicationManager.getApplication().isUnitTestMode() || INIT_INSPECTIONS) {
    if (!myInitialized.getAndSet(true)) {
      if (myBaseProfile != null) {
        myBaseProfile.initInspectionTools();
      }
      final InspectionTool[] tools=myRegistrar.createTools();
      for (      InspectionTool tool : tools) {
        final String shortName=tool.getShortName();
        HighlightDisplayKey key=HighlightDisplayKey.find(shortName);
        if (key == null) {
          if (tool instanceof LocalInspectionToolWrapper) {
            key=HighlightDisplayKey.register(shortName,tool.getDisplayName(),((LocalInspectionToolWrapper)tool).getTool().getID(),((LocalInspectionToolWrapper)tool).getTool().getAlternativeID());
          }
 else {
            key=HighlightDisplayKey.register(shortName);
          }
        }
        myTools.put(tool.getShortName(),new ToolsImpl(tool,myBaseProfile != null ? myBaseProfile.getErrorLevel(key) : tool.getDefaultLevel(),myBaseProfile != null ? myBaseProfile.isToolEnabled(key) : tool.isEnabledByDefault()));
      }
      if (mySource != null) {
        copyToolsConfigurations(mySource);
      }
    }
  }
}
