{
  if (context.beforeChange != null) {
    for (; context.beforeIndex < context.beforeChanges.size(); context.beforeIndex++) {
      TextChange change=context.beforeChanges.get(context.beforeIndex);
      int offset=change.getStart() + context.beforeShiftToCurrent;
      context.beforeShiftToCurrent+=getDiff(change);
      storage.add(new TextRange(offset,offset + change.getText().length()));
    }
  }
  if (context.currentChange != null) {
    for (; context.currentIndex < context.currentChanges.size(); context.currentIndex++) {
      TextChange change=context.currentChanges.get(context.currentIndex);
      storage.add(new TextRange(change.getStart(),change.getEnd()));
    }
  }
}
