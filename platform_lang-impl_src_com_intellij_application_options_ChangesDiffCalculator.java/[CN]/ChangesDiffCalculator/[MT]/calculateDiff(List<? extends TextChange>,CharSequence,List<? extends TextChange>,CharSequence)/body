{
  List<TextRange> result=new ArrayList<TextRange>();
  Context context=new Context(beforeChanges,beforeText,currentChanges,currentText);
  while (context.beforeChange != null && context.currentChange != null) {
    if (tryMatchScatteredChanges(context)) {
      continue;
    }
    if (context.beforeOriginalStart < context.currentOriginalStart) {
      handleBeforeChangeBeforeCurrentChange(context,result);
    }
 else     if (context.beforeOriginalStart > context.currentOriginalStart) {
      handleBeforeChangeAfterCurrentChange(context,result);
    }
 else {
      handleChangesSharingStartOffset(context,result);
    }
  }
  registerTailChanges(context,result);
  return result;
}
