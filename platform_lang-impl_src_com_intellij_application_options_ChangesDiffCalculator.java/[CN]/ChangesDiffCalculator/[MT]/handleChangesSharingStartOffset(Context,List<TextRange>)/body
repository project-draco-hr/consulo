{
  int lengthDiff=getLength(context.currentChange) - getLength(context.beforeChange);
  int originTextDiff=context.beforeChange.getText().length() - context.currentChange.getText().length();
  int oldSize=storage.size();
  if (lengthDiff > 0) {
    storage.add(new TextRange(context.beforeChange.getEnd() + context.beforeShiftToCurrent,context.currentChange.getEnd() + originTextDiff));
  }
 else   if (lengthDiff < 0) {
    storage.add(new TextRange(context.currentChange.getEnd(),context.currentChange.getEnd()));
  }
 else   if (context.beforeChange.getText().length() != context.currentChange.getText().length()) {
    if (StringUtil.equals(context.textForChangeRange(Context.ChangeType.BEFORE),context.textForChangeRange(Context.ChangeType.CURRENT))) {
      if (originTextDiff < 0) {
        storage.add(new TextRange(context.currentChange.getEnd(),context.currentChange.getEnd()));
      }
 else {
        storage.add(new TextRange(context.currentChange.getEnd(),context.currentChange.getEnd() + originTextDiff));
      }
    }
  }
  if (storage.size() != oldSize) {
    context.beforeShiftToCurrent+=getDiff(context.beforeChange) - getDiff(context.currentChange);
  }
  context.proceedToNextChange(Context.ChangeType.BEFORE);
  context.proceedToNextChange(Context.ChangeType.CURRENT);
}
