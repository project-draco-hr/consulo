{
  final ProjectManagerEx projectManager=ProjectManagerEx.getInstanceEx();
  final Project project=projectManager.newProject(PathManager.getConfigPath() + "/dummy.ipr",true,false);
  if (!virtualFile.isDirectory()) {
    StartupManager.getInstance(project).registerPostStartupActivity(new Runnable(){
      public void run(){
        ToolWindowManager.getInstance(project).invokeLater(new Runnable(){
          public void run(){
            ToolWindowManager.getInstance(project).invokeLater(new Runnable(){
              public void run(){
                FileEditorManager.getInstance(project).openFile(virtualFile,true);
              }
            }
);
          }
        }
);
      }
    }
);
  }
  projectManager.openProject(project);
  return project;
}
