{
  VirtualFile baseDir=null;
  if (virtualFile.isDirectory()) {
    baseDir=virtualFile;
  }
  final File projectFile=new File(getIprBaseName(baseDir) + ".ipr");
  final ProjectManagerEx projectManager=ProjectManagerEx.getInstanceEx();
  Project project=null;
  if (projectFile.exists()) {
    try {
      project=projectManager.loadProject(projectFile.getPath());
    }
 catch (    Exception e) {
    }
  }
  if (project == null) {
    project=projectManager.newProject(projectFile.getPath(),true,false);
  }
  if (project == null)   return null;
  ProjectBaseDirectory.getInstance(project).setBaseDir(baseDir);
  if (baseDir != null) {
    for (    DirectoryProjectConfigurator configurator : Extensions.getExtensions(DirectoryProjectConfigurator.EP_NAME)) {
      configurator.configureProject(project,baseDir);
    }
  }
  openFileFromCommandLine(project,virtualFile);
  projectManager.openProject(project);
  return project;
}
