{
  if (virtualFile.isDirectory()) {
    BASE_DIR=virtualFile;
  }
  final ProjectManagerEx projectManager=ProjectManagerEx.getInstanceEx();
  final Project project=projectManager.newProject(PathManager.getConfigPath() + "/dummy.ipr",true,false);
  if (project == null)   return null;
  StartupManager.getInstance(project).registerPostStartupActivity(new Runnable(){
    public void run(){
      ToolWindowManager.getInstance(project).invokeLater(new Runnable(){
        public void run(){
          ToolWindowManager.getInstance(project).invokeLater(new Runnable(){
            public void run(){
              if (virtualFile.isDirectory()) {
                new FilesystemToolwindow(virtualFile,project);
              }
 else {
                FileEditorManager.getInstance(project).openFile(virtualFile,true);
              }
            }
          }
);
        }
      }
);
    }
  }
);
  projectManager.openProject(project);
  return project;
}
