{
  for (  PaletteGroupHeader groupHeader : myGroupHeaders) {
    groupHeader.getComponentList().removeListSelectionListener(myListSelectionListener);
  }
  String[] oldTabNames=collectTabNames(myGroups);
  if (oldTabNames.length == 1) {
    remove(myScrollPane);
  }
 else {
    myTabbedPane.removeAll();
    remove(myTabbedPane);
  }
  myGroupHeaders.clear();
  myGroups.clear();
  final ArrayList<PaletteGroup> currentGroups=collectCurrentGroups();
  String[] tabNames=collectTabNames(currentGroups);
  if (tabNames.length == 1) {
    PaletteContentWindow contentWindow=new PaletteContentWindow();
    myScrollPane.getViewport().setView(contentWindow);
    add(myScrollPane);
    for (    PaletteGroup group : currentGroups) {
      addGroupToControl(group,contentWindow);
    }
  }
 else {
    add(myTabbedPane);
    for (    String tabName : tabNames) {
      PaletteContentWindow contentWindow=new PaletteContentWindow();
      JScrollPane scrollPane=new JScrollPane(contentWindow);
      myTabbedPane.add(tabName,scrollPane);
      for (      PaletteGroup group : currentGroups) {
        if (group.getTabName().equals(tabName)) {
          addGroupToControl(group,contentWindow);
        }
      }
    }
  }
  revalidate();
}
