{
  ApplicationManager.getApplication().assertIsDispatchThread();
synchronized (this) {
    LOG.assertTrue(!isRunning());
    LOG.assertTrue(!myStoppedAlready);
  }
  enterModality();
  IdeEventQueue.getInstance().pumpEventsForHierarchy(myDialog.myPanel,new Condition<AWTEvent>(){
    public boolean value(    final AWTEvent object){
      if (myShouldShowCancel && object instanceof KeyEvent && object.getID() == KeyEvent.KEY_PRESSED && ((KeyEvent)object).getKeyCode() == KeyEvent.VK_ESCAPE && ((KeyEvent)object).getModifiers() == 0) {
        SwingUtilities.invokeLater(new Runnable(){
          public void run(){
            cancel();
          }
        }
);
      }
      if (!myWasShown && object instanceof PaintEvent) {
        return false;
      }
      return isStarted() && !isRunning();
    }
  }
);
  exitModality();
}
