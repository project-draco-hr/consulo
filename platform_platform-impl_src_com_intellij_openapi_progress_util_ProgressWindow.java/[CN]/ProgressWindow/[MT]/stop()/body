{
  LOG.assertTrue(!myStoppedAlready);
  super.stop();
  if (isDialogShowing()) {
    if (myFocusTrackback != null) {
      myFocusTrackback.setWillBeSheduledForRestore();
    }
  }
  UIUtil.invokeLaterIfNeeded(new Runnable(){
    @Override public void run(){
      boolean wasShowing=isDialogShowing();
      if (myDialog != null) {
        myDialog.hide();
      }
      if (myFocusTrackback != null) {
        if (wasShowing) {
          myFocusTrackback.restoreFocus();
        }
 else {
          myFocusTrackback.consume();
        }
      }
      myStoppedAlready=true;
      Disposer.dispose(ProgressWindow.this);
    }
  }
);
  SwingUtilities.invokeLater(EmptyRunnable.INSTANCE);
}
