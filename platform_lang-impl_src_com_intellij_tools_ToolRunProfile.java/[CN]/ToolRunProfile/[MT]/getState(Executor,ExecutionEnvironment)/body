{
  final Project project=env.getProject();
  if (project == null || myCommandLine == null) {
    return null;
  }
  final CommandLineState commandLineState=new CommandLineState(env){
    GeneralCommandLine createCommandLine(){
      return myCommandLine;
    }
    protected OSProcessHandler startProcess() throws ExecutionException {
      final GeneralCommandLine commandLine=createCommandLine();
      final OSProcessHandler processHandler=new OSProcessHandler(commandLine.createProcess(),commandLine.getCommandLineString());
      ProcessTerminatedListener.attach(processHandler);
      return processHandler;
    }
    public ExecutionResult execute(    @NotNull final Executor executor,    @NotNull ProgramRunner runner) throws ExecutionException {
      final ExecutionResult result=super.execute(executor,runner);
      final ProcessHandler processHandler=result.getProcessHandler();
      if (processHandler != null) {
        processHandler.addProcessListener(new ToolProcessAdapter(project,myTool.synchronizeAfterExecution(),getName()));
      }
      return result;
    }
  }
;
  TextConsoleBuilder builder=TextConsoleBuilderFactory.getInstance().createBuilder(project);
  final FilterInfo[] outputFilters=myTool.getOutputFilters();
  for (int i=0; i < outputFilters.length; i++) {
    builder.addFilter(new RegexpFilter(project,outputFilters[i].getRegExp()));
  }
  commandLineState.setConsoleBuilder(builder);
  return commandLineState;
}
