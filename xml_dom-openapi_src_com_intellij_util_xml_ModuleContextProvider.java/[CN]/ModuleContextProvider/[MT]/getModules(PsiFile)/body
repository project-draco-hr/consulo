{
  if (context == null)   return Module.EMPTY_ARRAY;
  final Set<Module> modules=new HashSet<Module>();
  for (  ModuleContextProvider moduleContextProvider : Extensions.getExtensions(EP_NAME)) {
    ContainerUtil.addAllNotNull(modules,moduleContextProvider.getContextModules(context));
  }
  Module module=ModuleUtilCore.findModuleForPsiElement(context);
  if (module != null)   modules.add(module);
  return modules.toArray(new Module[modules.size()]);
}
