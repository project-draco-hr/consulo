{
  final OrderEntry[] entries=ModuleRootManager.getInstance(module).getOrderEntries();
  for (int i=entries.length - 1; i >= 0; i--) {
    final OrderEntry orderEntry=entries[i];
    if (orderEntry instanceof ModuleOrderEntry) {
      final ModuleOrderEntry moduleOrderEntry=(ModuleOrderEntry)orderEntry;
      if (moduleOrderEntry.getScope() == DependencyScope.COMPILE) {
        final Module depModule=moduleOrderEntry.getModule();
        if (depModule != null) {
          final AndroidFacet depFacet=AndroidFacet.getInstance(depModule);
          if (depFacet != null && (!androidLibrariesOnly || depFacet.getConfiguration().LIBRARY_PROJECT) && visited.add(depFacet)) {
            collectAllAndroidDependencies(depModule,androidLibrariesOnly,result,visited);
            result.add(0,depFacet);
          }
        }
      }
    }
  }
}
