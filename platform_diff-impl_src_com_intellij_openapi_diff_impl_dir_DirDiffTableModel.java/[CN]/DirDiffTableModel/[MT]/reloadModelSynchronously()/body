{
  myUpdating.set(true);
  try {
    myTree=new DTree(null,"",true);
    mySrc.refresh(true);
    myTrg.refresh(true);
    scan(mySrc,myTree,true);
    scan(myTrg,myTree,false);
  }
 catch (  final IOException e) {
    LOG.warn(e);
    reportException(VcsBundle.message("refresh.failed.message",StringUtil.decapitalize(e.getLocalizedMessage())));
  }
 finally {
    myTree.setSource(mySrc);
    myTree.setTarget(myTrg);
    myTree.update(mySettings);
    ArrayList<DirDiffElementImpl> elements=new ArrayList<DirDiffElementImpl>();
    fillElements(myTree,elements);
    myElements.clear();
    myElements.addAll(elements);
    myUpdating.set(false);
  }
}
