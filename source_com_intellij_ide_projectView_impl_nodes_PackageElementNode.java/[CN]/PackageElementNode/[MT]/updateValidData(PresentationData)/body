{
  final PackageElement value=getValue();
  final PsiPackage aPackage=value.getPackage();
  final String qName=aPackage.getQualifiedName();
  final CoverageDataManager coverageManager=CoverageDataManager.getInstance(aPackage.getProject());
  final String coverageString=coverageManager.getPackageCoverageInformationString(qName,value.getModule());
  presentation.setLocationString(coverageString);
  if (!getSettings().isFlattenPackages()) {
    if (getSettings().isHideEmptyMiddlePackages()) {
      if (PackageUtil.isPackageEmpty(aPackage,value.getModule(),true,isLibraryElement())) {
        setValue(null);
        return;
      }
    }
  }
  if (showFwName(aPackage)) {
    presentation.setPresentableText(getSettings().isAbbreviatePackageNames() ? TreeViewUtil.calcAbbreviatedPackageFQName(aPackage) : aPackage.getQualifiedName());
  }
 else {
    if (!(getParentValue() instanceof PackageElement)) {
      presentation.setPresentableText(qName);
    }
 else {
      final PsiPackage parentPackageInTree=((PackageElement)getParentValue()).getPackage();
      PsiPackage parentPackage=aPackage.getParentPackage();
      final StringBuffer buf=new StringBuffer();
      buf.append(aPackage.getName());
      while (parentPackage != null && !parentPackage.equals(parentPackageInTree)) {
        buf.insert(0,".");
        buf.insert(0,parentPackage.getName());
        parentPackage=parentPackage.getParentPackage();
      }
      presentation.setPresentableText(buf.toString());
    }
  }
  presentation.setOpenIcon(Icons.PACKAGE_OPEN_ICON);
  presentation.setClosedIcon(Icons.PACKAGE_ICON);
}
