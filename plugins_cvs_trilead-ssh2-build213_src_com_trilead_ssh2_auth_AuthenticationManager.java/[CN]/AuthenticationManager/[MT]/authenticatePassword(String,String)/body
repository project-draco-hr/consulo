{
  try {
    initialize(user);
    if (methodPossible("password") == false)     throw new IOException("Authentication method password not supported by the server at this stage.");
    PacketUserauthRequestPassword ua=new PacketUserauthRequestPassword("ssh-connection",user,pass);
    tm.sendMessage(ua.getPayload());
    byte[] ar=getNextMessage();
    if (ar[0] == Packets.SSH_MSG_USERAUTH_SUCCESS) {
      authenticated=true;
      tm.removeMessageHandler(this,0,255);
      return true;
    }
    if (ar[0] == Packets.SSH_MSG_USERAUTH_FAILURE) {
      PacketUserauthFailure puf=new PacketUserauthFailure(ar,0,ar.length);
      remainingMethods=puf.getAuthThatCanContinue();
      isPartialSuccess=puf.isPartialSuccess();
      return false;
    }
    throw new IOException("Unexpected SSH message (type " + ar[0] + ")");
  }
 catch (  IOException e) {
    tm.close(e,false);
    throw (IOException)new IOException("Password authentication failed.").initCause(e);
  }
}
