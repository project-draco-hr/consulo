{
synchronized (packets) {
    while (packets.size() == 0) {
      if (connectionClosed)       throw (IOException)new IOException("The connection is closed.").initCause(tm.getReasonClosedCause());
      try {
        packets.wait();
      }
 catch (      InterruptedException ign) {
      }
    }
    byte[] res=(byte[])packets.firstElement();
    packets.removeElementAt(0);
    return res;
  }
}
