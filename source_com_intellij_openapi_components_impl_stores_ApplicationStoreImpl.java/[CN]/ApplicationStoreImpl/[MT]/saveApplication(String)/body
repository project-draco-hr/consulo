{
  deleteBackupFiles(path);
  backupFiles(path);
  HashMap<String,Element> fileNameToRootElementMap=new HashMap<String,Element>();
  final Object[] components=myApplication.getComponents(Object.class);
  for (  Object component : components) {
    if (!(component instanceof BaseComponent))     continue;
    String fileName;
    if (component instanceof NamedJDOMExternalizable) {
      fileName=((NamedJDOMExternalizable)component).getExternalFileName() + XML_EXTENSION;
    }
 else {
      fileName=PathManager.DEFAULT_OPTIONS_FILE_NAME + XML_EXTENSION;
    }
    Element root=getRootElement(fileNameToRootElementMap,fileName);
    try {
      Element node=serializeComponent(component);
      if (node != null) {
        root.addContent(node);
      }
    }
 catch (    Exception e) {
      LOG.error(e);
    }
  }
  for (  String fileName : fileNameToRootElementMap.keySet()) {
    Element root=fileNameToRootElementMap.get(fileName);
    JDOMUtil.writeDocument(new Document(root),path + File.separatorChar + fileName,CodeStyleSettingsManager.getSettings(null).getLineSeparator());
  }
  deleteBackupFiles(path);
}
