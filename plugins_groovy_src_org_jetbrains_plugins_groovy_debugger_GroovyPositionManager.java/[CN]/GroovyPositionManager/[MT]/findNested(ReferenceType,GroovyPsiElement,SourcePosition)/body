{
  final VirtualMachineProxyImpl vmProxy=myDebugProcess.getVirtualMachineProxy();
  if (fromClass.isPrepared()) {
    final List<ReferenceType> nestedTypes=vmProxy.nestedTypes(fromClass);
    for (    ReferenceType nested : nestedTypes) {
      final ReferenceType found=findNested(nested,toFind,classPosition);
      if (found != null) {
        return found;
      }
    }
    try {
      final int lineNumber=classPosition.getLine() + 1;
      if (fromClass.locationsOfLine(lineNumber).size() > 0) {
        return fromClass;
      }
      for (      Location location : fromClass.allLineLocations()) {
        final SourcePosition candidateFirstPosition=SourcePosition.createFromLine(toFind.getContainingFile(),location.lineNumber() - 1);
        if (toFind.equals(findReferenceTypeSourceImage(candidateFirstPosition))) {
          return fromClass;
        }
        break;
      }
    }
 catch (    AbsentInformationException ignored) {
    }
  }
  return null;
}
