{
  final SelectionModel model=editor.getSelectionModel();
  final Document document=editor.getDocument();
  if (!model.hasSelection()) {
    final int offset=editor.getCaretModel().getOffset();
    if (offset <= document.getTextLength()) {
      final int lineNumber=document.getLineNumber(offset);
      final String line=document.getText().substring(document.getLineStartOffset(lineNumber),document.getLineEndOffset(lineNumber)).trim();
      if (StringUtil.isNotEmpty(line)) {
        return line;
      }
    }
    return null;
  }
  final int start=model.getSelectionStart();
  final int end=model.getSelectionEnd();
  if (document.getLineNumber(start) == document.getLineNumber(end)) {
    final String selection=document.getText().substring(start,end).trim();
    if (StringUtil.isNotEmpty(selection)) {
      return selection;
    }
  }
  return null;
}
