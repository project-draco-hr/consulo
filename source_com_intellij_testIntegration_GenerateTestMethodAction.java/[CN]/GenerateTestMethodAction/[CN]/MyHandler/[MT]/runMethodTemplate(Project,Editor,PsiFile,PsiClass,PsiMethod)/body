{
  Template template=createMethodTemplate(project,targetClass);
  final TextRange range=method.getTextRange();
  editor.getDocument().replaceString(range.getStartOffset(),range.getEndOffset(),"");
  editor.getCaretModel().moveToOffset(range.getStartOffset());
  TemplateManager.getInstance(project).startTemplate(editor,template,new TemplateEditingAdapter(){
    @Override public void templateFinished(    Template template){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          PsiDocumentManager.getInstance(project).commitDocument(editor.getDocument());
          PsiFile psi=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
          PsiElement method=psi.findElementAt(range.getStartOffset());
          if (method != null) {
            method=PsiTreeUtil.getParentOfType(method,PsiMethod.class,false);
            if (method != null) {
              CreateFromUsageUtils.setupEditor((PsiMethod)method,editor);
            }
          }
        }
      }
);
    }
  }
);
}
