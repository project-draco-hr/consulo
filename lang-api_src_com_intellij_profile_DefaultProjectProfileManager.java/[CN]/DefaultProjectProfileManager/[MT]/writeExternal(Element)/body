{
  DefaultJDOMExternalizer.writeExternal(this,element);
  final Map<NamedScope,String> usedProfiles=getProfilesUsedInProject();
  final HashSet<String> profilesSet=new HashSet<String>(usedProfiles.values());
  profilesSet.add(PROJECT_PROFILE);
  final List<String> sortedProfiles=new ArrayList<String>(myProfiles.keySet());
  Collections.sort(sortedProfiles);
  if (!sortedProfiles.isEmpty()) {
    final Element assignedScopes=new Element(SCOPES);
    final List<NamedScope> scopes=new ArrayList<NamedScope>(usedProfiles.keySet());
    for (    NamedScope scope : scopes) {
      final Element scopeElement=new Element(SCOPE);
      scopeElement.setAttribute(PROFILE,usedProfiles.get(scope));
      scopeElement.setAttribute(NAME,scope.getName());
      assignedScopes.addContent(scopeElement);
    }
    element.addContent(assignedScopes);
    final Element profiles=new Element(PROFILES);
    for (    String profile : sortedProfiles) {
      final Profile projectProfile=myProfiles.get(profile);
      if (projectProfile != null) {
        final Element profileElement=new Element(PROFILE);
        projectProfile.writeExternal(profileElement);
        profiles.addContent(profileElement);
      }
    }
    element.addContent(profiles);
  }
}
