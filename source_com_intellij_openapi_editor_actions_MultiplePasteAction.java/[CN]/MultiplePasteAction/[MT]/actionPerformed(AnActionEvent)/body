{
  final DataContext dataContext=e.getDataContext();
  Project project=(Project)dataContext.getData(DataConstants.PROJECT);
  Component focusedComponent=(Component)dataContext.getData(DataConstantsEx.CONTEXT_COMPONENT);
  Editor editor=(Editor)dataContext.getData(DataConstants.EDITOR);
  if (!(focusedComponent instanceof JComponent))   return;
  final Chooser chooser=new Chooser(project);
  if (chooser.myAllContents.length > 0) {
    chooser.show();
  }
 else {
    chooser.close(Chooser.CANCEL_EXIT_CODE);
  }
  if (chooser.isOK()) {
    final int selectedIndex=chooser.getSelectedIndex();
    ((CopyPasteManagerEx)CopyPasteManager.getInstance()).moveContentTopStackTop(chooser.myAllContents[selectedIndex]);
    if (editor != null) {
      if (!editor.getDocument().isWritable()) {
        editor.getDocument().fireReadOnlyModificationAttempt();
        return;
      }
      final AnAction pasteAction=ActionManager.getInstance().getAction(IdeActions.ACTION_PASTE);
      AnActionEvent newEvent=new AnActionEvent(e.getInputEvent(),DataManager.getInstance().getDataContext(focusedComponent),e.getPlace(),e.getPresentation(),ActionManager.getInstance(),e.getModifiers());
      pasteAction.actionPerformed(newEvent);
    }
 else {
      final Action pasteAction=((JComponent)focusedComponent).getActionMap().get(DefaultEditorKit.pasteAction);
      if (pasteAction != null) {
        pasteAction.actionPerformed(new ActionEvent(focusedComponent,ActionEvent.ACTION_PERFORMED,""));
      }
    }
  }
}
