{
  try {
    final Ref<List<DiffRequest>> requestsRef=new Ref<List<DiffRequest>>();
    final Ref<Throwable> exceptionRef=new Ref<Throwable>();
    ProgressManager.getInstance().run(new Task.Modal(project,"Loading Requests",true){
      @Override public void run(      @NotNull ProgressIndicator indicator){
        try {
          requestsRef.set(collectRequests(project,chain,indicator));
        }
 catch (        Throwable e) {
          exceptionRef.set(e);
        }
      }
    }
);
    if (!exceptionRef.isNull())     throw exceptionRef.get();
    List<DiffRequest> showInBuiltin=new ArrayList<DiffRequest>();
    for (    DiffRequest request : requestsRef.get()) {
      if (canShow(request)) {
        showRequest(project,request);
      }
 else {
        showInBuiltin.add(request);
      }
    }
    if (!showInBuiltin.isEmpty()) {
      DiffManagerEx.getInstance().showDiffBuiltin(project,new SimpleDiffRequestChain(showInBuiltin),hints);
    }
  }
 catch (  ProcessCanceledException ignore) {
  }
catch (  Throwable e) {
    LOG.error(e);
    Messages.showErrorDialog(project,e.getMessage(),"Can't Show Diff In External Tool");
  }
}
