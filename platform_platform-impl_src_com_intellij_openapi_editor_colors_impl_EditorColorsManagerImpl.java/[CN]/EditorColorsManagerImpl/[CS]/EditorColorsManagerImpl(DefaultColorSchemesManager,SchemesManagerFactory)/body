{
  myDefaultColorSchemesManager=defaultColorSchemesManager;
  mySchemesManager=schemesManagerFactory.createSchemesManager(FILE_SPEC,new BaseSchemeProcessor<EditorColorsSchemeImpl>(){
    @Override public EditorColorsSchemeImpl readScheme(    final Document document) throws InvalidDataException {
      return loadSchemeFromDocument(document,true);
    }
    @Override public Document writeScheme(    final EditorColorsSchemeImpl scheme){
      Element root=new Element(SCHEME_NODE_NAME);
      try {
        scheme.writeExternal(root);
      }
 catch (      WriteExternalException e) {
        LOG.error(e);
        return null;
      }
      return new Document(root);
    }
    public void renameScheme(    final String name,    final EditorColorsScheme scheme){
      scheme.setName(name);
    }
    @Override public boolean shouldBeSaved(    final EditorColorsSchemeImpl scheme){
      return !(scheme instanceof ReadOnlyColorsScheme);
    }
    @Override public void onCurrentSchemeChanged(    final Scheme newCurrentScheme){
      fireChanges(mySchemesManager.getCurrentScheme());
    }
  }
,RoamingType.PER_USER);
  addDefaultSchemes();
  extendDefaultScheme();
  loadAdditionalDefaultSchemes();
  loadAllSchemes();
  setGlobalScheme(myDefaultColorSchemesManager.getAllSchemes()[0]);
  TextAttributesKey.myDefaultsProvider=new TextAttributesKey.TextAttributeKeyDefaultsProvider(){
    @Override public TextAttributes getDefaultAttributes(    TextAttributesKey key){
      final EditorColorsScheme defaultColorScheme=getScheme(EditorColorsScheme.DEFAULT_SCHEME_NAME);
      return defaultColorScheme.getAttributes(key);
    }
  }
;
}
