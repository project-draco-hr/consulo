{
  if (!node.isValid())   return;
  int realMax=Math.max(Math.max(maxEndOf(node.getLeft(),deltaUpToRoot),maxEndOf(node.getRight(),deltaUpToRoot)),deltaUpToRoot + node.intervalEnd());
  node.maxEnd=realMax - deltaUpToRoot;
}
