{
  final StringBuilder buffer=new StringBuilder();
  final PsiModifierList modifierList=method.getModifierList();
  String modifiers=modifierList.getText();
  final String oldModifier=VisibilityUtil.getVisibilityModifier(modifierList);
  final String newModifier=getVisibility();
  String newModifierStr=VisibilityUtil.getVisibilityString(newModifier);
  if (!newModifier.equals(oldModifier)) {
    int index=modifiers.indexOf(oldModifier);
    if (index >= 0) {
      final StringBuilder buf=new StringBuilder(modifiers);
      buf.replace(index,index + oldModifier.length() + ("".equals(newModifierStr) ? 1 : 0),newModifierStr);
      modifiers=buf.toString();
    }
 else {
      if (!StringUtil.isEmpty(newModifierStr)) {
        newModifierStr+=" ";
      }
      modifiers=newModifierStr + modifiers;
    }
  }
  buffer.append(modifiers);
  if (modifiers.length() > 0 && !StringUtil.endsWithChar(modifiers,'\n') && !StringUtil.endsWithChar(modifiers,'\r') && !StringUtil.endsWithChar(modifiers,' ')) {
    buffer.append(" ");
  }
  if (!method.isConstructor()) {
    final CanonicalTypes.Type type=getReturnType();
    if (type != null) {
      buffer.append(type.getTypeText());
    }
    buffer.append(" ");
  }
  buffer.append(getMethodName());
  buffer.append("(");
  final int lineBreakIdx=buffer.lastIndexOf("\n");
  String indent=StringUtil.repeatSymbol(' ',lineBreakIdx >= 0 ? buffer.length() - lineBreakIdx - 1 : buffer.length());
  List<ParameterTableModelItemBase<ParameterInfoImpl>> items=myParametersTableModel.getItems();
  int curIndent=indent.length();
  for (int i=0; i < items.size(); i++) {
    final ParameterTableModelItemBase<ParameterInfoImpl> item=items.get(i);
    if (i > 0) {
      buffer.append(",");
      buffer.append("\n");
      buffer.append(indent);
    }
    final String text=item.typeCodeFragment.getText();
    buffer.append(text).append(" ");
    final String name=item.parameter.getName();
    buffer.append(name);
    curIndent=indent.length() + text.length() + 1+ name.length();
  }
  buffer.append(")");
  PsiTypeCodeFragment[] thrownExceptionsFragments=myExceptionsModel.getTypeCodeFragments();
  if (thrownExceptionsFragments.length > 0) {
    buffer.append(" throws ");
    curIndent+=9;
    indent=StringUtil.repeatSymbol(' ',curIndent);
    for (int i=0; i < thrownExceptionsFragments.length; i++) {
      String text=thrownExceptionsFragments[i].getText();
      if (i != 0)       buffer.append(indent);
      buffer.append(text);
      if (i < thrownExceptionsFragments.length - 1) {
        buffer.append(",");
      }
      buffer.append("\n");
    }
  }
  return buffer.toString();
}
