{
  final Project project=(Project)e.getDataContext().getData(DataConstants.PROJECT);
  if (project == null) {
    return;
  }
  final FavoritesViewImpl favoritesView=FavoritesViewImpl.getInstance(project);
  final AddToFavoritesAction addToFavoritesAction=favoritesView.getAddToFavoritesAction(myFavoritesName);
  final ArrayList<PsiFile> filesToAdd=getFilesToAdd(project);
  final ArrayList<AbstractTreeNode> nodesToAdd=new ArrayList<AbstractTreeNode>();
  final FavoritesTreeViewConfiguration favoritesConfig=FavoritesViewImpl.getInstance(project).getFavoritesTreeViewPanel(myFavoritesName).getFavoritesTreeStructure().getFavoritesConfiguration();
  for (Iterator<PsiFile> iterator=filesToAdd.iterator(); iterator.hasNext(); ) {
    AddToFavoritesAction.addPsiElementNode(iterator.next(),project,nodesToAdd,favoritesConfig,null);
  }
  addToFavoritesAction.addNodes(project,nodesToAdd.toArray(new AbstractTreeNode[nodesToAdd.size()]));
}
