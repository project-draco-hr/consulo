{
  List<ExecutionTarget> suitable=settings == null ? Collections.singletonList(DefaultExecutionTarget.INSTANCE) : getTargetsFor(settings);
synchronized (myActiveTargetLock) {
    int index=-1;
    if (myActiveTarget != null) {
      index=suitable.indexOf(myActiveTarget);
    }
 else     if (mySavedActiveTargetId != null) {
      for (int i=0, size=suitable.size(); i < size; i++) {
        if (suitable.get(i).getId().equals(mySavedActiveTargetId)) {
          index=i;
          break;
        }
      }
    }
    doSetActiveTarget(index >= 0 ? suitable.get(index) : ContainerUtil.getFirstItem(suitable,DefaultExecutionTarget.INSTANCE));
  }
}
