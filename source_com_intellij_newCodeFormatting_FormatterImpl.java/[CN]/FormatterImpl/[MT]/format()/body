{
  myWhiteSpaceBeforeBlock.putAll(WhiteSpacesBuilder.buildWhiteSpaces(myRootBlock,myModel));
  myCurrentLine=0;
  myCurrentOffset=0;
  processBlock(myRootBlock,null);
  int shift=0;
  WhiteSpace prev=null;
  for (Iterator<Block> iterator=myWhiteSpaceBeforeBlock.keySet().iterator(); iterator.hasNext(); ) {
    Block block=iterator.next();
    final WhiteSpace whiteSpace=myWhiteSpaceBeforeBlock.get(block);
    if (prev == whiteSpace)     continue;
    final TextRange textRange=whiteSpace.getTextRange();
    final String newWhiteSpace=whiteSpace.generateWhiteSpace();
    myModel.replaceWhiteSpace(new TextRange(textRange.getStartOffset() + shift,textRange.getEndOffset() + shift),newWhiteSpace);
    shift+=newWhiteSpace.length() - (textRange.getLength());
    prev=whiteSpace;
  }
}
