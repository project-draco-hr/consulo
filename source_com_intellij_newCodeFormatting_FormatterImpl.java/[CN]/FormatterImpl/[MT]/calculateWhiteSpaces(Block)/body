{
  final TextRange textRange=rootBlock.getTextRange();
  final int blockStartOffset=textRange.getStartOffset();
  myCurrentWhiteSpace.append(blockStartOffset,myModel);
  myWhiteSpaceBeforeBlock.put(rootBlock,myCurrentWhiteSpace);
  final List<Block> subBlocks=rootBlock.getSubBlocks();
  if (subBlocks.isEmpty()) {
    myCurrentWhiteSpace=new WhiteSpace(textRange.getEndOffset(),textRange.getEndOffset(),0,0,false);
  }
 else {
    for (Iterator<Block> iterator=subBlocks.iterator(); iterator.hasNext(); ) {
      calculateWhiteSpaces(iterator.next());
    }
  }
}
