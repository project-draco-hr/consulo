{
  mxGraph graph=graphComponent.getGraph();
  mxIGraphModel model=graph.getModel();
  List<mxCellState> previousStates=null;
  if (isCloned()) {
    previousStates=new LinkedList<mxCellState>();
    Iterator<mxCellState> it=deltas.keySet().iterator();
    while (it.hasNext()) {
      mxCellState state=it.next();
      previousStates.addAll(snapshot(state));
    }
  }
  Iterator<mxCellState> it=deltas.keySet().iterator();
  while (it.hasNext()) {
    mxCellState state=it.next();
    mxPoint delta=deltas.get(state);
    mxCellState parentState=graph.getView().getState(model.getParent(state.getCell()));
    translateState(parentState,state,delta.getX(),delta.getY());
  }
  mxRectangle dirty=null;
  it=deltas.keySet().iterator();
  while (it.hasNext()) {
    mxCellState state=it.next();
    mxPoint delta=deltas.get(state);
    mxCellState parentState=graph.getView().getState(model.getParent(state.getCell()));
    mxRectangle tmp=revalidateState(parentState,state,delta.getX(),delta.getY());
    if (dirty != null) {
      dirty.add(tmp);
    }
 else {
      dirty=tmp;
    }
  }
  if (previousStates != null) {
    cellStates=new LinkedList<mxCellState>();
    it=deltas.keySet().iterator();
    while (it.hasNext()) {
      mxCellState state=it.next();
      cellStates.addAll(snapshot(state));
    }
    restore(previousStates);
  }
  if (dirty != null) {
    dirty.grow(2);
  }
  return dirty;
}
