{
  Map current=null;
  for (  Factor factor : descriptor.affectingFactors) {
    Object key;
switch (factor) {
case placeElement:
      key=descriptor.getPlace();
    break;
case placeFile:
  key=descriptor.getPlaceFile();
break;
case qualifierType:
key=descriptor.getTypeText();
break;
default :
throw new IllegalStateException("Unknown variant: " + factor);
}
if (current == null) {
if (key instanceof UserDataHolder) {
final Project project=descriptor.getProject();
current=CachedValuesManager.getManager(project).getCachedValue((UserDataHolder)key,GDSL_MEMBER_CACHE,myProvider,false);
continue;
}
current=myTopLevelCache.getValue();
}
Map next=(Map)current.get(key);
if (next == null) {
current.put(key,next=new ConcurrentHashMap());
}
current=next;
}
if (current == null) current=myTopLevelCache.getValue();
current.put(myExecutor,holder);
}
