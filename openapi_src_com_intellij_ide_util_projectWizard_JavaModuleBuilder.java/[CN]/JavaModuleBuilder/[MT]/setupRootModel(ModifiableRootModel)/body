{
  rootModel.setExcludeOutput(true);
  if (myJdk != null) {
    rootModel.setJdk(myJdk);
  }
 else {
    rootModel.inheritJdk();
  }
  final String moduleRootPath=getContentEntryPath();
  if (moduleRootPath != null) {
    final LocalFileSystem lfs=LocalFileSystem.getInstance();
    VirtualFile moduleContentRoot=lfs.refreshAndFindFileByPath(FileUtil.toSystemIndependentName(moduleRootPath));
    if (moduleContentRoot != null) {
      final ContentEntry contentEntry=rootModel.addContentEntry(moduleContentRoot);
      final List<Pair<String,String>> sourcePaths=getSourcePaths();
      if (sourcePaths != null) {
        for (        final Pair<String,String> sourcePath : sourcePaths) {
          final VirtualFile sourceRoot=lfs.refreshAndFindFileByPath(FileUtil.toSystemIndependentName(sourcePath.first));
          if (sourceRoot != null) {
            contentEntry.addSourceFolder(sourceRoot,false,sourcePath.second);
          }
        }
      }
    }
  }
  if (myCompilerOutputPath != null) {
    String canonicalPath;
    try {
      canonicalPath=FileUtil.resolveShortWindowsName(myCompilerOutputPath);
    }
 catch (    IOException e) {
      canonicalPath=myCompilerOutputPath;
    }
    rootModel.setCompilerOutputPath(VfsUtil.pathToUrl(FileUtil.toSystemIndependentName(canonicalPath)));
  }
 else {
    rootModel.inheritCompilerOutputPath(true);
  }
  LibraryTable libraryTable=rootModel.getModuleLibraryTable();
  for (  Pair<String,String> libInfo : myModuleLibraries) {
    final String moduleLibraryPath=libInfo.first;
    final String sourceLibraryPath=libInfo.second;
    Library library=libraryTable.createLibrary();
    Library.ModifiableModel modifiableModel=library.getModifiableModel();
    modifiableModel.addRoot(getUrlByPath(moduleLibraryPath),OrderRootType.CLASSES);
    if (sourceLibraryPath != null) {
      modifiableModel.addRoot(getUrlByPath(sourceLibraryPath),OrderRootType.SOURCES);
    }
    modifiableModel.commit();
  }
}
