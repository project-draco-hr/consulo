{
  for (  VirtualFile file : myAllFiles) {
    if (!CvsUtil.fileIsUnderCvs(file.getParent())) {
      continue;
    }
 else     if (CvsUtil.fileIsLocallyRemoved(file)) {
      CvsUtil.restoreFile(file);
    }
 else     if (CvsUtil.fileIsUnderCvs(file)) {
      continue;
    }
 else     if (CvsEntriesManager.getInstance().getCvsConnectionSettingsFor(file.getParent()).isOffline()) {
      continue;
    }
 else {
      myAddedFiles.add(file);
    }
  }
  if (!myAddedFiles.isEmpty()) {
    if (CvsVcs2.getInstance(myProject).getAddConfirmation().getValue() != VcsShowConfirmationOption.Value.DO_NOTHING_SILENTLY) {
      final Runnable addRunnable=new Runnable(){
        public void run(){
          if (!myCvsStorageComponent.getIsActive())           return;
          AddFileOrDirectoryAction.createActionToAddNewFileAutomatically().actionPerformed(createDataContext(myAddedFiles));
        }
      }
;
      if (ApplicationManager.getApplication().isUnitTestMode()) {
        addRunnable.run();
      }
 else {
        WaitForProgressToShow.runOrInvokeLaterAboveProgress(addRunnable,null,myProject);
      }
    }
  }
}
