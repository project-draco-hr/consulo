{
  super(module.getProject());
  myModule=module;
  myOptions=options;
  myProjectFileIndex=ProjectRootManager.getInstance(getProject()).getFileIndex();
  OrderEnumerator en=ModuleRootManager.getInstance(module).orderEntries();
  en.recursively();
  if (hasOption(COMPILE)) {
    en.exportedOnly().compileOnly();
  }
  if (hasOption(RUNTIME)) {
    en.runtimeOnly();
  }
  if (!hasOption(LIBRARIES))   en.withoutLibraries().withoutSdk();
  if (!hasOption(MODULES))   en.withoutDepModules();
  if (!hasOption(TESTS))   en.productionOnly();
  en.forEach(new Processor<OrderEntry>(){
    @Override public boolean process(    OrderEntry each){
      if (each instanceof ModuleOrderEntry) {
        ContainerUtil.addIfNotNull(myModules,((ModuleOrderEntry)each).getModule());
      }
 else       if (each instanceof ModuleSourceOrderEntry) {
        ContainerUtil.addIfNotNull(myModules,each.getOwnerModule());
      }
      return true;
    }
  }
);
  if (hasOption(CONTENT)) {
    for (    Module m : myModules) {
      ContentEntry[] entries=ModuleRootManager.getInstance(m).getContentEntries();
      for (      ContentEntry entry : entries) {
        ContainerUtil.addIfNotNull(entry.getFile(),myRoots);
      }
    }
  }
 else {
    Collections.addAll(myRoots,en.roots(new NotNullFunction<OrderEntry,OrderRootType>(){
      @NotNull @Override public OrderRootType fun(      OrderEntry entry){
        if (entry instanceof ModuleOrderEntry || entry instanceof ModuleSourceOrderEntry)         return OrderRootType.SOURCES;
        return OrderRootType.CLASSES;
      }
    }
).getRoots());
  }
}
