{
  final List<VirtualFile> vFiles=new ArrayList<VirtualFile>();
  for (  PsiFile psiFile : files) {
    vFiles.add(psiFile.getVirtualFile());
  }
  if (!ReadonlyStatusHandler.getInstance(myProject).ensureFilesWritable(vFiles.toArray(new VirtualFile[vFiles.size()])).hasReadonlyFiles()) {
    if (!files.isEmpty()) {
      final Runnable[] resultRunnable=new Runnable[1];
      execute(new Runnable(){
        public void run(){
          resultRunnable[0]=prepareFiles(files);
        }
      }
,new Runnable(){
        public void run(){
          if (resultRunnable[0] != null) {
            resultRunnable[0].run();
          }
        }
      }
);
    }
  }
}
