{
  if (ex instanceof RuntimeException) {
    final Throwable cause=ex.getCause();
    if (cause != null && cause != ex) {
      return getExceptionMessage(cause);
    }
  }
 else   if (ex instanceof InvocationTargetException) {
    final Throwable target=((InvocationTargetException)ex).getTargetException();
    if (target != null && target != ex) {
      return getExceptionMessage(target);
    }
  }
  String message=ex.getMessage();
  if (ex instanceof ClassNotFoundException) {
    message=message != null ? "Class not found: " + message : "Class not found";
  }
 else   if (ex instanceof NoClassDefFoundError) {
    message=message != null ? "Required class not found: " + message : "Required class not found";
  }
  return message;
}
