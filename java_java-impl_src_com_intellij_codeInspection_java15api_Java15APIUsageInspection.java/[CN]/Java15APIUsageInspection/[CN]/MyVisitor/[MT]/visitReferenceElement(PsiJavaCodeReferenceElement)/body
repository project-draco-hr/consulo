{
  super.visitReferenceElement(reference);
  final PsiElement resolved=reference.resolve();
  if (resolved instanceof PsiCompiledElement && resolved instanceof PsiMember) {
    final LanguageLevel languageLevel=LanguageLevelUtil.getEffectiveLanguageLevel(ModuleUtil.findModuleForPsiElement(reference.getElement()));
    if (isForbiddenApiUsage((PsiMember)resolved,languageLevel)) {
      PsiClass psiClass=null;
      final PsiElement qualifier=reference.getQualifier();
      if (qualifier != null) {
        if (qualifier instanceof PsiExpression) {
          psiClass=PsiUtil.resolveClassInType(((PsiExpression)qualifier).getType());
        }
      }
 else {
        psiClass=PsiTreeUtil.getParentOfType(reference,PsiClass.class);
      }
      if (psiClass != null) {
        if (isIgnored(psiClass))         return;
        for (        PsiClass superClass : psiClass.getSupers()) {
          if (isIgnored(superClass))           return;
        }
      }
      registerError(reference,languageLevel);
    }
  }
}
