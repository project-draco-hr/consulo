{
  ApplicationManager.getApplication().assertIsDispatchThread();
  PsiFile currentFile=PsiDocumentManager.getInstance(project).getPsiFile(editorMarkupModel.getEditor().getDocument());
  if (currentFile != null && !currentFile.equals(file)) {
    return;
  }
  if (editorMarkupModel.isErrorStripeVisible()) {
    ErrorStripeRenderer renderer=editorMarkupModel.getErrorStripeRenderer();
    if (renderer instanceof TrafficLightRenderer) {
      TrafficLightRenderer tlr=(TrafficLightRenderer)renderer;
      tlr.refresh();
      ((EditorMarkupModelImpl)editorMarkupModel).repaintVerticalScrollBar();
      if (tlr.myFile == null || tlr.myFile.isValid())       return;
      Disposer.dispose(tlr);
    }
    renderer=new TrafficLightRenderer(project,document,file);
    Disposer.register(((EditorImpl)editorMarkupModel.getEditor()).getDisposable(),(Disposable)renderer);
    editorMarkupModel.setErrorStripeRenderer(renderer);
  }
}
