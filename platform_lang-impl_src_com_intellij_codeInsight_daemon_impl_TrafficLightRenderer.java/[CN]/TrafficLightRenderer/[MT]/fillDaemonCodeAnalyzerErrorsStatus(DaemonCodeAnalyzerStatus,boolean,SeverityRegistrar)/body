{
  final int count=severityRegistrar.getSeverityMaxIndex() - 1;
  final HighlightSeverity maxPossibleSeverity=severityRegistrar.getSeverityByIndex(count);
  final HighlightSeverity[] maxFoundSeverity={null};
  DaemonCodeAnalyzerImpl.processHighlights(myDocument,myProject,null,0,myDocument.getTextLength(),new Processor<HighlightInfo>(){
    public boolean process(    HighlightInfo info){
      HighlightSeverity infoSeverity=info.getSeverity();
      if (fillErrorsCount) {
        final int severityIdx=severityRegistrar.getSeverityIdx(infoSeverity);
        if (severityIdx != -1) {
          status.errorCount[severityIdx]++;
        }
      }
 else {
        if (maxFoundSeverity[0] == null || severityRegistrar.compare(maxFoundSeverity[0],infoSeverity) < 0) {
          maxFoundSeverity[0]=infoSeverity;
        }
        if (infoSeverity == maxPossibleSeverity) {
          return false;
        }
      }
      return true;
    }
  }
);
  if (maxFoundSeverity[0] != null) {
    final int severityIdx=severityRegistrar.getSeverityIdx(maxFoundSeverity[0]);
    if (severityIdx != -1) {
      status.errorCount[severityIdx]=1;
    }
  }
}
