{
  final SeverityRegistrar severityRegistrar=SeverityRegistrar.getInstance(myProject);
  if (fillErrorsCount)   Arrays.fill(status.errorCount,0);
  final int count=severityRegistrar.getSeveritiesCount() - 1;
  final HighlightSeverity maxSeverity=severityRegistrar.getSeverityByIndex(count);
  final HighlightSeverity[] maxFoundSeverity={null};
  DaemonCodeAnalyzerImpl.processHighlights(myDocument,myProject,null,0,myDocument.getTextLength(),new Processor<HighlightInfo>(){
    public boolean process(    HighlightInfo info){
      HighlightSeverity infoSeverity=info.getSeverity();
      if (fillErrorsCount) {
        final int severityIdx=severityRegistrar.getSeverityIdx(infoSeverity);
        if (severityIdx != -1) {
          status.errorCount[severityIdx]++;
        }
      }
 else {
        if (infoSeverity == maxSeverity) {
          status.errorCount[count]=1;
          return false;
        }
        if (maxFoundSeverity[0] == null || severityRegistrar.compare(maxFoundSeverity[0],infoSeverity) <= 0) {
          maxFoundSeverity[0]=infoSeverity;
        }
      }
      return true;
    }
  }
);
  if (maxFoundSeverity[0] != null) {
    final int severityIdx=severityRegistrar.getSeverityIdx(maxFoundSeverity[0]);
    if (severityIdx != -1) {
      status.errorCount[severityIdx]=1;
    }
  }
}
