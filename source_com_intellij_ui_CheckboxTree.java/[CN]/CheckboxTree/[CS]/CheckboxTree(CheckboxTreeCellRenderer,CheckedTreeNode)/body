{
  setCellRenderer(cellRenderer);
  setRootVisible(false);
  setShowsRootHandles(true);
  putClientProperty("JTree.lineStyle","Angled");
  TreeToolTipHandler.install(this);
  TreeUtil.installActions(this);
  new TreeSpeedSearch(this);
  addMouseListener(new MouseAdapter(){
    public void mousePressed(    MouseEvent e){
      int row=getRowForLocation(e.getX(),e.getY());
      if (row >= 0) {
        Rectangle rowBounds=getRowBounds(row);
        cellRenderer.setBounds(rowBounds);
        Rectangle checkBounds=cellRenderer.myCheckbox.getBounds();
        checkBounds.setLocation(rowBounds.getLocation());
        if (checkBounds.contains(e.getPoint())) {
          CheckedTreeNode node=(CheckedTreeNode)getPathForRow(row).getLastPathComponent();
          if (node.isEnabled()) {
            toggleNode(node);
            e.consume();
            setSelectionRow(row);
          }
        }
      }
    }
  }
);
  addKeyListener(new KeyAdapter(){
    public void keyPressed(    KeyEvent e){
      if (e.getKeyCode() == KeyEvent.VK_SPACE) {
        TreePath treePath=getLeadSelectionPath();
        CheckedTreeNode firstNode=(CheckedTreeNode)treePath.getLastPathComponent();
        boolean checked=toggleNode(firstNode);
        TreePath[] selectionPaths=getSelectionPaths();
        for (int i=0; selectionPaths != null && i < selectionPaths.length; i++) {
          final TreePath selectionPath=selectionPaths[i];
          CheckedTreeNode node=(CheckedTreeNode)selectionPath.getLastPathComponent();
          checkNode(node,checked);
        }
        e.consume();
      }
    }
  }
);
  setSelectionRow(0);
  setModel(new DefaultTreeModel(root));
}
