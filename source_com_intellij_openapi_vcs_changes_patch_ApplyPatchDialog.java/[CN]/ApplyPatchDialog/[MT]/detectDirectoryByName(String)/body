{
  String[] nameComponents=patchFileName.split("/");
  final String patchName=nameComponents[nameComponents.length - 1];
  final PsiFile[] psiFiles=PsiManager.getInstance(myProject).getShortNamesCache().getFilesByName(patchName);
  if (psiFiles.length == 1) {
    PsiDirectory parent=psiFiles[0].getContainingDirectory();
    boolean matches=true;
    for (int i=nameComponents.length - 2; i >= 0; i--) {
      if (parent.getVirtualFile() == myProject.getProjectFile().getParent()) {
        myDetectedStripLeadingDirs=i + 1;
        myDetectedBaseDirectory=parent.getVirtualFile().getPresentableUrl();
        return true;
      }
      if (!parent.getName().equals(nameComponents[i])) {
        matches=false;
        break;
      }
      parent=parent.getParentDirectory();
    }
    if (matches) {
      myDetectedBaseDirectory=parent.getVirtualFile().getPresentableUrl();
      myDetectedStripLeadingDirs=0;
      return true;
    }
  }
  return false;
}
