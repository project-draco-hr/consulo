{
  final String rootPath=PathManagerEx.getTestDataPath().replace(File.separatorChar,'/') + "/moduleRootManager/exportedModules/";
  final VirtualFile testRoot=LocalFileSystem.getInstance().refreshAndFindFileByPath(rootPath);
  assertNotNull(testRoot);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      final ModifiableModuleModel moduleModel=ModuleManager.getInstance(myProject).getModifiableModel();
      final Module moduleA=moduleModel.newModule("A.iml");
      final Module moduleB=moduleModel.newModule("B.iml");
      final Module moduleC=moduleModel.newModule("C.iml");
      moduleModel.commit();
      configureModule(moduleA,testRoot,"A");
      configureModule(moduleB,testRoot,"B");
      configureModule(moduleC,testRoot,"C");
      ModuleRootModificationUtil.addDependency(moduleB,moduleA,DependencyScope.COMPILE,true);
      ModuleRootModificationUtil.addDependency(moduleC,moduleB);
      final PsiClass pCClass=JavaPsiFacade.getInstance(myProject).findClass("p.C",GlobalSearchScope.moduleWithDependenciesAndLibrariesScope(moduleC));
      assertNotNull(pCClass);
      final PsiClass pAClass=JavaPsiFacade.getInstance(myProject).findClass("p.A",GlobalSearchScope.moduleWithDependenciesAndLibrariesScope(moduleB));
      assertNotNull(pAClass);
      final PsiClass pAClass2=JavaPsiFacade.getInstance(myProject).findClass("p.A",GlobalSearchScope.moduleWithDependenciesAndLibrariesScope(moduleC));
      assertNotNull(pAClass2);
    }
  }
);
}
