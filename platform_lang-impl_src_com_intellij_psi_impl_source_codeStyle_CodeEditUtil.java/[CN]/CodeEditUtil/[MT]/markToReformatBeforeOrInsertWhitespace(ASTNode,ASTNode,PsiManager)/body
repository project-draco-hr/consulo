{
  final Language leftLang=left != null ? PsiUtilBase.getNotAnyLanguage(left) : null;
  final Language rightLang=PsiUtilBase.getNotAnyLanguage(right);
  ASTNode generatedWhitespace=null;
  if (leftLang == rightLang) {
    generatedWhitespace=LanguageTokenSeparatorGenerators.INSTANCE.forLanguage(leftLang).generateWhitespaceBetweenTokens(left,right);
  }
  if (generatedWhitespace != null) {
    final TreeUtil.CommonParentState parentState=new TreeUtil.CommonParentState();
    TreeUtil.prevLeaf((TreeElement)right,parentState);
    parentState.nextLeafBranchStart.getTreeParent().addChild(generatedWhitespace,parentState.nextLeafBranchStart);
  }
 else   markToReformatBefore(right,true);
}
