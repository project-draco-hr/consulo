{
  Template template=(Template)myLookupItem.getObject();
  int offset1=context.startOffset;
  final RangeMarker offsetRangeMarker=context.editor.getDocument().createRangeMarker(offset1,offset1);
  TemplateManager.getInstance(myProject).startTemplate(context.editor,template,new TemplateEditingAdapter(){
    public void templateFinished(    Template template){
      myLookupItem.setAttribute(EXPANDED_TEMPLATE_ATTR,Boolean.TRUE);
      if (!offsetRangeMarker.isValid())       return;
      final int offset=offsetRangeMarker.getStartOffset();
      String lookupString=context.editor.getDocument().getCharsSequence().subSequence(offset,context.editor.getCaretModel().getOffset()).toString();
      myLookupItem.setLookupString(lookupString);
      CompletionContext newContext=new CompletionContext(context.project,context.editor,context.file,offset,offset);
      handleInsert(newContext,myStartOffset,myLookupData,myLookupItem,signatureSelected,completionChar);
    }
  }
);
}
