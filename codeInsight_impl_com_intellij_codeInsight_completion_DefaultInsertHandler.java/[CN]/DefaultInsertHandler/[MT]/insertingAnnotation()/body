{
  final Object obj=myLookupItem.getObject();
  if (!(obj instanceof PsiClass) || !((PsiClass)obj).isAnnotationType())   return false;
  final Document document=myEditor.getDocument();
  PsiDocumentManager.getInstance(myFile.getProject()).commitDocument(document);
  PsiElement elementAt=myFile.findElementAt(myContext.getStartOffset());
  if (elementAt == null)   return false;
  final PsiElement parentElement=elementAt.getParent();
  PsiElement parent=PsiTreeUtil.getParentOfType(elementAt,PsiModifierListOwner.class,PsiCodeBlock.class,PsiComment.class);
  if (parent == null && parentElement instanceof PsiErrorElement) {
    PsiElement nextElement=parentElement.getNextSibling();
    if (nextElement instanceof PsiWhiteSpace)     nextElement=nextElement.getNextSibling();
    if (nextElement instanceof PsiClass)     parent=nextElement;
  }
  if (!(parent instanceof PsiModifierListOwner))   return false;
  if (parent instanceof PsiPackage)   return true;
  return elementAt.getTextRange().getStartOffset() <= parent.getTextOffset();
}
