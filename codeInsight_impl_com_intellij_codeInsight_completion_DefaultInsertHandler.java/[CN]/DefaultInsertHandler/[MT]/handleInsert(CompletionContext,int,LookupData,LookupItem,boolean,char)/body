{
  if (!(item instanceof SimpleLookupItem)) {
    if (item.getObject() instanceof PsiMethod) {
      PsiMethod method=(PsiMethod)item.getObject();
      LookupItem simpleItem=new SimpleLookupItem(method,item.getLookupString()).setInsertHandler(SimpleInsertHandlerFactory.createMethodInsertHandler(method));
      simpleItem.setAttribute(LookupItem.FORCE_SHOW_SIGNATURE_ATTR,item.getAttribute(LookupItem.FORCE_SHOW_SIGNATURE_ATTR));
      simpleItem.setAttribute(CompletionUtil.TAIL_TYPE_ATTR,item.getAttribute(CompletionUtil.TAIL_TYPE_ATTR));
      ((InsertHandler)simpleItem.getAttribute(LookupItem.INSERT_HANDLER_ATTR)).handleInsert(context,startOffset,data,simpleItem,signatureSelected,completionChar);
      return;
    }
  }
  DefaultInsertHandler delegate=this;
  if (isTemplateToBeCompleted(item)) {
    try {
      delegate=(DefaultInsertHandler)clone();
      delegate.clear();
    }
 catch (    CloneNotSupportedException e) {
      e.printStackTrace();
    }
  }
  boolean toClear=true;
  try {
    toClear=delegate.handleInsertInner(context,startOffset,data,item,signatureSelected,completionChar);
  }
  finally {
    if (toClear) {
      delegate.clear();
    }
  }
}
