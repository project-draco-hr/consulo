{
  if (myCurrentExpression instanceof PsiExpression) {
    return EvaluatorBuilderImpl.getInstance().build(myCurrentExpression,debuggerContext.getSourcePosition());
  }
  CodeFragmentFactory factory=DebuggerUtilsEx.getEffectiveCodeFragmentFactory(myCurrentExpression);
  TextWithImportsImpl textWithImports=new TextWithImportsImpl(CodeFragmentKind.EXPRESSION,myCurrentExpression.getText());
  if (factory == null)   return null;
  JavaCodeFragment codeFragment=factory.createCodeFragment(textWithImports,myCurrentExpression.getContext(),getProject());
  codeFragment.forceResolveScope(GlobalSearchScope.allScope(getProject()));
  return factory.getEvaluatorBuilder().build(codeFragment,debuggerContext.getSourcePosition());
}
