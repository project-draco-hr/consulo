{
  if (!(value instanceof ObjectReference)) {
    return expression;
  }
  ReferenceType valueType=((ObjectReference)value).referenceType();
  if (valueType == null) {
    return expression;
  }
  Project project=expression.getProject();
  PsiClass type=RuntimeTypeEvaluator.getCastableRuntimeType(project,value);
  if (type == null) {
    return expression;
  }
  PsiElementFactory elementFactory=JavaPsiFacade.getElementFactory(project);
  try {
    PsiParenthesizedExpression parenthExpression=(PsiParenthesizedExpression)elementFactory.createExpressionFromText("((" + type.getQualifiedName() + ")expression)",null);
    ((PsiTypeCastExpression)parenthExpression.getExpression()).getOperand().replace(expression);
    return parenthExpression;
  }
 catch (  IncorrectOperationException e) {
    throw new EvaluateException(DebuggerBundle.message("error.invalid.type.name",type.getQualifiedName()),e);
  }
}
