{
  PsiFile file=parameters.getOriginalFile();
  for (  final PsiClassType type : expectedClassTypes) {
    consumer.consume(type);
    final PsiClassType.ClassResolveResult baseResult=JavaCompletionUtil.originalize(type).resolveGenerics();
    final PsiClass baseClass=baseResult.getElement();
    if (baseClass == null)     return false;
    final PsiSubstitutor baseSubstitutor=baseResult.getSubstitutor();
    final THashSet<PsiType> statVariants=new THashSet<PsiType>();
    final Processor<PsiClass> processor=CodeInsightUtil.createInheritorsProcessor(parameters.getPosition(),type,0,false,statVariants,baseClass,baseSubstitutor);
    final StatisticsInfo[] stats=StatisticsManager.getInstance().getAllValues(JavaStatisticsManager.getAfterNewKey(type));
    for (    final StatisticsInfo statisticsInfo : stats) {
      final String value=statisticsInfo.getValue();
      if (value.startsWith(JavaStatisticsManager.CLASS_PREFIX)) {
        final String qname=value.substring(JavaStatisticsManager.CLASS_PREFIX.length());
        final PsiClass psiClass=JavaPsiFacade.getInstance(file.getProject()).findClass(qname,file.getResolveScope());
        if (psiClass != null && !PsiTreeUtil.isAncestor(file,psiClass,true) && !processor.process(psiClass))         break;
      }
    }
    for (    final PsiType variant : statVariants) {
      consumer.consume(variant);
    }
  }
  return true;
}
