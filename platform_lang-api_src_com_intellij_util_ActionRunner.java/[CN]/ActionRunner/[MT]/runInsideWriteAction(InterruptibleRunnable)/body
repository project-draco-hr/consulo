{
  final Exception[] exception=new Exception[1];
  Runnable swingRunnable=new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          try {
            runnable.run();
          }
 catch (          Exception e) {
            exception[0]=e;
          }
        }
      }
);
    }
  }
;
  if (SwingUtilities.isEventDispatchThread()) {
    swingRunnable.run();
  }
 else {
    ApplicationManager.getApplication().invokeAndWait(swingRunnable,ModalityState.NON_MODAL);
  }
  Exception e=exception[0];
  if (e != null) {
    if (e instanceof RuntimeException)     throw (RuntimeException)e;
    throw new Exception(e);
  }
}
