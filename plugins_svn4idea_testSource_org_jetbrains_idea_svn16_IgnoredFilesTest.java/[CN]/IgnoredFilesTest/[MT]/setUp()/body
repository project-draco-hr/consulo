{
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      try {
        final IdeaTestFixtureFactory fixtureFactory=IdeaTestFixtureFactory.getFixtureFactory();
        myTempDirFixture=fixtureFactory.createTempDirTestFixture();
        myTempDirFixture.setUp();
        myClientRoot=new File(myTempDirFixture.getTempDirPath(),"clientroot");
        myClientRoot.mkdir();
        initProject(myClientRoot);
        ((StartupManagerImpl)StartupManager.getInstance(myProject)).runPostStartupActivities();
        myChangeListManager=ChangeListManager.getInstance(myProject);
        myVcs=SvnVcs17.getInstance(myProject);
        myVcsManager=(ProjectLevelVcsManagerImpl)ProjectLevelVcsManager.getInstance(myProject);
        myVcsManager.registerVcs(myVcs);
        myVcsManager.setDirectoryMapping(myWorkingCopyDir.getPath(),myVcs.getName());
        ((ProjectComponent)myChangeListManager).projectOpened();
        myVcsDirtyScopeManager=VcsDirtyScopeManager.getInstance(myProject);
        ((ProjectComponent)myVcsDirtyScopeManager).projectOpened();
        myLocalFileSystem=LocalFileSystem.getInstance();
      }
 catch (      Exception e) {
        throw new RuntimeException(e);
      }
    }
  }
);
}
