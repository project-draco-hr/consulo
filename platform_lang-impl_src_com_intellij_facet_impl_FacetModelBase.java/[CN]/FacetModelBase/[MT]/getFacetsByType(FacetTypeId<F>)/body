{
  if (myType2Facets == null) {
    MultiValuesMap<FacetTypeId,Facet> typeToFacets=new MultiValuesMap<FacetTypeId,Facet>();
    for (    Facet facet : getAllFacets()) {
      typeToFacets.put(facet.getTypeId(),facet);
    }
    Map<FacetTypeId,Collection<Facet>> typeToFacetsCollection=new HashMap<FacetTypeId,Collection<Facet>>();
    for (    FacetTypeId id : typeToFacets.keySet()) {
      final Collection<Facet> facets=typeToFacets.get(id);
      typeToFacetsCollection.put(id,Collections.unmodifiableCollection(facets));
    }
    myType2Facets=typeToFacetsCollection;
  }
  final Collection<F> facets=(Collection<F>)myType2Facets.get(typeId);
  return facets != null ? facets : Collections.<F>emptyList();
}
