{
  if (moveType == MoveType.PACKAGES && targetContainer == null && MoveFilesOrDirectoriesUtil.canMoveOrRearrangePackages(elements)) {
    PsiDirectory[] directories=new PsiDirectory[elements.length];
    System.arraycopy(elements,0,directories,0,directories.length);
    SelectMoveOrRearrangePackageDialog dialog=new SelectMoveOrRearrangePackageDialog(project,directories);
    dialog.show();
    if (!dialog.isOK())     return true;
    moveType=dialog.getRefactoringType();
    if (moveType != MoveType.PACKAGES) {
      MoveClassesOrPackagesImpl.doRearrangePackage(project,directories);
      return true;
    }
  }
  return false;
}
