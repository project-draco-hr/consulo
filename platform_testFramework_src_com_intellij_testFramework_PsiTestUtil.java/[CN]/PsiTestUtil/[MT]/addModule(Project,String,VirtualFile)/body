{
  return new WriteCommandAction<Module>(project){
    @Override protected void run(    Result<Module> result) throws Throwable {
      final ModifiableModuleModel moduleModel=ModuleManager.getInstance(project).getModifiableModel();
      String moduleName=moduleModel.newModule(name,root.getPath()).getName();
      moduleModel.commit();
      final Module dep=ModuleManager.getInstance(project).findModuleByName(moduleName);
      final ModifiableRootModel model=ModuleRootManager.getInstance(dep).getModifiableModel();
      final ContentEntry entry=model.addContentEntry(root);
      entry.addFolder(root,ContentFolderType.SOURCE);
      model.commit();
      result.setResult(dep);
    }
  }
.execute().getResultObject();
}
