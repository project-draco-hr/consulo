{
  return new WriteCommandAction<Module>(project){
    @Override protected void run(    Result<Module> result) throws Throwable {
      final ModifiableModuleModel moduleModel=ModuleManager.getInstance(project).getModifiableModel();
      String moduleName=moduleModel.newModule(root.getPath() + "/" + name+ ".iml",type).getName();
      moduleModel.commit();
      final Module dep=ModuleManager.getInstance(project).findModuleByName(moduleName);
      final ModifiableRootModel model=ModuleRootManager.getInstance(dep).getModifiableModel();
      final ContentEntry entry=model.addContentEntry(root);
      entry.addSourceFolder(root,false);
      model.commit();
      result.setResult(dep);
    }
  }
.execute().getResultObject();
}
