{
  boolean hasDirs=false;
  for (  VirtualFile file : files) {
    if (file.isDirectory()) {
      hasDirs=true;
    }
  }
  final List<VirtualFile> fileList=new ArrayList<VirtualFile>();
  if (!hasDirs) {
    Collections.addAll(fileList,files);
  }
 else {
    ProgressManager.getInstance().runProcessWithProgressSynchronously(new Runnable(){
      public void run(){
        for (        VirtualFile file : files) {
          if (file.isDirectory()) {
            ProjectLevelVcsManager.getInstance(project).iterateVcsRoot(file,new Processor<FilePath>(){
              public boolean process(              final FilePath filePath){
                ProgressManager.checkCanceled();
                VirtualFile fileOrDir=filePath.getVirtualFile();
                if (fileOrDir != null && !fileOrDir.isDirectory() && isEnabled(project,activeVcs,fileOrDir) && !fileList.contains(fileOrDir)) {
                  fileList.add(fileOrDir);
                }
                return true;
              }
            }
);
          }
 else {
            if (!fileList.contains(file)) {
              fileList.add(file);
            }
          }
        }
      }
    }
,SvnBundle.message("progress.searching.for.files.with.conflicts"),true,project);
  }
  final ReadonlyStatusHandler.OperationStatus status=ReadonlyStatusHandler.getInstance(project).ensureFilesWritable(fileList);
  fileList.removeAll(Arrays.asList(status.getReadonlyFiles()));
  AbstractVcsHelper.getInstance(project).showMergeDialog(fileList,new SvnMergeProvider(project));
}
