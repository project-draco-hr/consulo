{
  boolean hasDirs=false;
  for (  VirtualFile file : files) {
    if (file.isDirectory()) {
      hasDirs=true;
    }
  }
  final List<VirtualFile> fileList=new ArrayList<VirtualFile>();
  if (!hasDirs) {
    for (    VirtualFile file : files) {
      addIfWritable(file,project,fileList);
    }
  }
 else {
    ProgressManager.getInstance().runProcessWithProgressSynchronously(new Runnable(){
      public void run(){
        for (        VirtualFile file : files) {
          if (file.isDirectory()) {
            ProjectLevelVcsManager.getInstance(project).iterateVcsRoot(file,new Processor<FilePath>(){
              public boolean process(              final FilePath filePath){
                ProgressManager.getInstance().checkCanceled();
                VirtualFile fileOrDir=filePath.getVirtualFile();
                if (fileOrDir != null && !fileOrDir.isDirectory() && isEnabled(project,activeVcs,fileOrDir) && !fileList.contains(fileOrDir)) {
                  addIfWritable(fileOrDir,project,fileList);
                }
                return true;
              }
            }
);
          }
 else {
            if (!fileList.contains(file)) {
              fileList.add(file);
            }
          }
        }
      }
    }
,SvnBundle.message("progress.searching.for.files.with.conflicts"),true,project);
  }
  AbstractVcsHelper.getInstance(project).showMergeDialog(fileList,new SvnMergeProvider(project));
}
