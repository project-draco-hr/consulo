{
  for (  Module module : chunk.getModules()) {
    if (isProjectRebuild()) {
      markDirtyFiles(module,myTimestamps,true,isCompilingTests() ? DirtyMarkScope.TESTS : DirtyMarkScope.PRODUCTION,null);
      updateOutputRootsLayout(module);
    }
 else {
      if (isMake()) {
        if (myProjectDescriptor.fsState.markInitialScanPerformed(module.getName(),isCompilingTests())) {
          initModuleFSState(module);
          updateOutputRootsLayout(module);
        }
      }
 else {
        if (getScope().isRecompilationForced(module.getName())) {
          markDirtyFiles(module,myTimestamps,true,isCompilingTests() ? DirtyMarkScope.TESTS : DirtyMarkScope.PRODUCTION,null);
          updateOutputRootsLayout(module);
        }
      }
    }
  }
}
