{
  myDataManager.getMappings().clearMemoryCaches();
  try {
    if (!myErrorsFound && !myCancelStatus.isCanceled()) {
      final boolean compilingTests=isCompilingTests();
      for (      Module module : chunk.getModules()) {
        if (isProjectRebuild()) {
          myFsState.markInitialScanPerformed(module,compilingTests);
        }
        final List<RootDescriptor> roots=myRootsIndex.getModuleRoots(module);
        for (        RootDescriptor descriptor : roots) {
          if (compilingTests ? descriptor.isTestRoot : !descriptor.isTestRoot) {
            myFsState.markAllUpToDate(descriptor,myTsStorage,myCompilationStartStamp);
          }
        }
      }
    }
  }
  finally {
    myFsState.clearContextRoundData();
  }
}
