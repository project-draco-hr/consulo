{
  final Set<File> excludes=new HashSet<File>();
  for (  String excludePath : module.getExcludes()) {
    excludes.add(new File(excludePath));
  }
  final FSSnapshot snapshot=new FSSnapshot(module);
  final Collection<String> roots=myCompilingTests ? module.getTestRoots() : module.getSourceRoots();
  for (  String srcRoot : roots) {
    final String normalizedRoot=FileUtil.toCanonicalPath(srcRoot);
    final File rootFile=new File(normalizedRoot);
    if (rootFile.exists()) {
      final FSSnapshot.Root root=snapshot.addRoot(rootFile,normalizedRoot);
      buildStructure(root.getNode(),excludes);
    }
  }
  final Collection<File> tempRoots=myTempSourceRoots.get(module);
  if (tempRoots != null) {
    for (    File tempRoot : tempRoots) {
      final FSSnapshot.Root root=snapshot.addRoot(tempRoot,FileUtil.toSystemIndependentName(tempRoot.getPath()));
      buildStructure(root.getNode(),excludes);
    }
  }
  return snapshot;
}
