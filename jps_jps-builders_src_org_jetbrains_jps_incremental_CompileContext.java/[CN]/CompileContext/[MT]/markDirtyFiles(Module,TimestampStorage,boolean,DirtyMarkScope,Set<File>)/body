{
  final Set<File> excludes=new HashSet<File>();
  for (  String excludePath : module.getExcludes()) {
    excludes.add(new File(excludePath));
  }
  final Collection<RootDescriptor> roots=new ArrayList<RootDescriptor>();
  for (  RootDescriptor rd : getModuleRoots(module)) {
    roots.add(rd);
  }
  for (  RootDescriptor rd : roots) {
    if (scope == DirtyMarkScope.TESTS) {
      if (!rd.isTestRoot) {
        continue;
      }
    }
 else     if (scope == DirtyMarkScope.PRODUCTION) {
      if (rd.isTestRoot) {
        continue;
      }
    }
    if (!rd.root.exists()) {
      continue;
    }
    myProjectDescriptor.fsState.clearRecompile(rd);
    myProjectDescriptor.fsState.clearDeletedPaths(module.getName(),isCompilingTests());
    traverseRecursively(rd,rd.root,excludes,tsStorage,forceMarkDirty,currentFiles);
  }
}
