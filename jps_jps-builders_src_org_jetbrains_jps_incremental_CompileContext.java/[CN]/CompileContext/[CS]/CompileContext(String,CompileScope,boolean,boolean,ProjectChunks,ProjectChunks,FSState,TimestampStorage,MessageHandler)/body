{
  myTsStorage=tsStorage;
  myCompilationStartStamp=System.currentTimeMillis();
  myScope=scope;
  myIsProjectRebuild=isProjectRebuild;
  myIsMake=isProjectRebuild ? false : isMake;
  myProductionChunks=productionChunks;
  myTestChunks=testChunks;
  myFsState=fsState;
  myDelegateMessageHandler=delegateMessageHandler;
  myDataManager=new BuildDataManager(projectName);
  final Project project=scope.getProject();
  myProjectPaths=new ProjectPaths(project);
  for (  Module module : project.getModules().values()) {
    List<RootDescriptor> moduleRoots=myModuleToRootsMap.get(module);
    if (moduleRoots == null) {
      moduleRoots=new ArrayList<RootDescriptor>();
      myModuleToRootsMap.put(module,moduleRoots);
    }
    for (    String r : module.getSourceRoots()) {
      final File root=new File(FileUtil.toCanonicalPath(r));
      final RootDescriptor descriptor=new RootDescriptor(module,root,false);
      myRootToModuleMap.put(root,descriptor);
      moduleRoots.add(descriptor);
    }
    for (    String r : module.getTestRoots()) {
      final File root=new File(FileUtil.toCanonicalPath(r));
      final RootDescriptor descriptor=new RootDescriptor(module,root,true);
      myRootToModuleMap.put(root,descriptor);
      moduleRoots.add(descriptor);
    }
  }
}
