{
  TIntArrayList result=new TIntArrayList();
  int x=0;
  int beforeSoftWrapDrawingWidth=myPainter.getMinDrawingWidth(SoftWrapDrawingType.BEFORE_SOFT_WRAP_LINE_FEED);
  int prevSoftWrapOffset=start;
  CharBuffer buffer=CharBuffer.wrap(text);
  for (int i=start; i < end; i++) {
    int symbolWidth=myTextRepresentationHelper.textWidth(buffer,i,i + 1,fontType,x);
    if (x + symbolWidth + beforeSoftWrapDrawingWidth >= myVisibleAreaWidth) {
      int offset=calculateSoftWrapOffset(text,i,prevSoftWrapOffset,end);
      if (offset >= end || offset <= prevSoftWrapOffset) {
        return result;
      }
      result.add(offset);
      i=offset - 1;
      prevSoftWrapOffset=offset;
      x=myPainter.getMinDrawingWidth(SoftWrapDrawingType.BEFORE_SOFT_WRAP_LINE_FEED) + myPainter.getMinDrawingWidth(SoftWrapDrawingType.AFTER_SOFT_WRAP) + reservedWidth;
      continue;
    }
    x+=symbolWidth;
  }
  return result;
}
