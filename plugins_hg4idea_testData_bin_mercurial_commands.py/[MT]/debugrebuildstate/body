def debugrebuildstate(ui, repo, rev='tip'):
    'rebuild the dirstate as it would look like for the given revision'
    ctx = repo[rev]
    wlock = repo.wlock()
    try:
        repo.dirstate.rebuild(ctx.node(), ctx.manifest())
    finally:
        wlock.release()
