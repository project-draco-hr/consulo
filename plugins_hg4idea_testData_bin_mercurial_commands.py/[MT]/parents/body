def parents(ui, repo, file_=None, **opts):
    "show the parents of the working directory or revision\n\n    Print the working directory's parent revisions. If a revision is\n    given via -r/--rev, the parent of that revision will be printed.\n    If a file argument is given, the revision in which the file was\n    last changed (before the working directory revision or the\n    argument to --rev if given) is printed.\n    "
    rev = opts.get('rev')
    if rev:
        ctx = repo[rev]
    else:
        ctx = repo[None]
    if file_:
        m = cmdutil.match(repo, (file_,), opts)
        if (m.anypats() or (len(m.files()) != 1)):
            raise util.Abort(_('can only specify an explicit filename'))
        file_ = m.files()[0]
        filenodes = []
        for cp in ctx.parents():
            if (not cp):
                continue
            try:
                filenodes.append(cp.filenode(file_))
            except error.LookupError:
                pass
        if (not filenodes):
            raise util.Abort((_("'%s' not found in manifest!") % file_))
        fl = repo.file(file_)
        p = [repo.lookup(fl.linkrev(fl.rev(fn))) for fn in filenodes]
    else:
        p = [cp.node() for cp in ctx.parents()]
    displayer = cmdutil.show_changeset(ui, repo, opts)
    for n in p:
        if (n != nullid):
            displayer.show(repo[n])
    displayer.close()
