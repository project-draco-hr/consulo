{
  int width=myIpad.left;
  if (myIcon != null) {
    width+=myIcon.getIconWidth() + myIconTextGap;
  }
  final Insets borderInsets=myBorder != null ? myBorder.getBorderInsets(this) : new Insets(0,0,0,0);
  width+=borderInsets.left;
  Font font=getFont();
  if (font == null) {
    font=UIUtil.getLabelFont();
  }
  LOG.assertTrue(font != null);
  int baseSize=font.getSize();
  boolean wasSmaller=false;
  for (int i=0; i < myAttributes.size(); i++) {
    SimpleTextAttributes attributes=myAttributes.get(i);
    boolean isSmaller=attributes.isSmaller();
    if (font.getStyle() != attributes.getFontStyle() || isSmaller != wasSmaller) {
      font=font.deriveFont(attributes.getFontStyle(),isSmaller ? UIUtil.getFontSize(UIUtil.FontSize.SMALL) : baseSize);
    }
    wasSmaller=isSmaller;
    final FontMetrics metrics=getFontMetrics(font);
    width+=metrics.stringWidth(myFragments.get(i));
    final Integer fixedWidth=myAligns.get(i);
    if (fixedWidth != null && width < fixedWidth.intValue()) {
      width=fixedWidth.intValue();
    }
    if (mainTextOnly && myMainTextLastIndex >= 0 && i == myMainTextLastIndex)     break;
  }
  width+=myIpad.right + borderInsets.right;
  int height=myIpad.top + myIpad.bottom;
  final FontMetrics metrics=getFontMetrics(font);
  int textHeight=metrics.getHeight();
  textHeight+=borderInsets.top + borderInsets.bottom;
  if (myIcon != null) {
    height+=Math.max(myIcon.getIconHeight(),textHeight);
  }
 else {
    height+=textHeight;
  }
  final Insets insets=getInsets();
  if (insets != null) {
    width+=insets.left + insets.right;
    height+=insets.top + insets.bottom;
  }
  return new Dimension(width,height);
}
