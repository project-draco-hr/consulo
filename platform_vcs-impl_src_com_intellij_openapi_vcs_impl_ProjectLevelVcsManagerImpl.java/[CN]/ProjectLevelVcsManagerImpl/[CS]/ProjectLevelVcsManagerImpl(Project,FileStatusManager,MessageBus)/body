{
  myProject=project;
  myMessageBus=messageBus;
  mySerialization=new ProjectLevelVcsManagerSerialization();
  myOptionsAndConfirmations=new OptionsAndConfirmations();
  myDefaultVcsRootPolicy=DefaultVcsRootPolicy.getInstance(project);
  myBackgroundableActionHandlerMap=new HashMap<VcsBackgroundableActions,BackgroundableActionEnabledHandler>();
  myInitialization=new VcsInitialization(myProject);
  myMappings=new NewMappings(myProject,myMessageBus,this,manager);
  myMappingsToRoots=new MappingsToRoots(myMappings,myProject);
  if (!myProject.isDefault()) {
    myVcsEventListenerManager=new VcsEventsListenerManagerImpl();
  }
  myVcsHistoryCache=new VcsHistoryCache();
  myConnect=myMessageBus.connect();
  myVcsListener=new VcsListener(){
    @Override public void directoryMappingChanged(){
      myVcsHistoryCache.clear();
    }
  }
;
  myConnect.subscribe(ProjectLevelVcsManager.VCS_CONFIGURATION_CHANGED,myVcsListener);
}
