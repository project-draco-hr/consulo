{
  int y=0;
  final int[] rows=tree.getSelectionRows();
  final int height=tree.getRowHeight();
  for (  int row : rows) {
    final TreeCellRenderer renderer=tree.getCellRenderer();
    final Object value=tree.getPathForRow(row).getLastPathComponent();
    if (value == null)     continue;
    final Component component=renderer.getTreeCellRendererComponent(tree,value,false,false,false,row,false);
    if (component.getFont() == null) {
      component.setFont(tree.getFont());
    }
    g.translate(0,y);
    component.setBounds(0,0,width,height);
    boolean wasOpaque=false;
    if (component instanceof JComponent) {
      final JComponent j=(JComponent)component;
      if (j.isOpaque())       wasOpaque=true;
      j.setOpaque(false);
    }
    component.paint(g);
    if (wasOpaque) {
      ((JComponent)component).setOpaque(true);
    }
    y+=height;
    g.translate(0,-y);
  }
}
