{
  Set<FilePath> files=new HashSet<FilePath>();
  final TreePath[] paths=getSelectionPaths();
  if (paths != null) {
    for (    TreePath path : paths) {
      if (path.getPathCount() > 1) {
        ChangesBrowserNode firstNode=(ChangesBrowserNode)path.getPathComponent(1);
        if (tag == null || firstNode.getUserObject() == tag) {
          ChangesBrowserNode<?> node=(ChangesBrowserNode)path.getLastPathComponent();
          files.addAll(node.getAllFilePathsUnder());
        }
      }
    }
  }
  return new ArrayList<FilePath>(files);
}
