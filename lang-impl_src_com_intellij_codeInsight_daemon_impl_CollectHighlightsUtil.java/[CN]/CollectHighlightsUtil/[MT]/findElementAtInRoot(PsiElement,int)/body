{
  if (root instanceof PsiFile) {
    final PsiFile file=(PsiFile)root;
    final LanguageDialect dialect=file.getLanguageDialect();
    if (dialect != null) {
      final PsiElement element=file.getViewProvider().findElementAt(offset,dialect);
      if (element != null)       return element;
    }
    return file.getViewProvider().findElementAt(offset,root.getLanguage());
  }
  return root.findElementAt(offset);
}
