{
  ModalityState modalityState=VirtualFileManagerImpl.calcModalityStateForRefreshEventsPosting(asynchronous);
  getManager().beforeRefreshStart(asynchronous,modalityState,null);
  if (!info.getFile().exists()) {
    LOG.info("file deleted");
    final VirtualFile rootFile=info.getRootFile();
    getManager().addEventToFireByRefresh(new Runnable(){
      public void run(){
        fireBeforeFileDeletion(null,rootFile);
synchronized (LOCK) {
          myPathToFileInfoMap.remove(info.getFile().getPath());
        }
        info.close();
        fireFileDeleted(null,rootFile,rootFile.getName(),null);
      }
    }
,asynchronous,modalityState);
  }
 else   if (info.getTimeStamp() != info.getFile().lastModified() || forceRefresh) {
    LOG.info("timestamp changed");
    final VirtualFile rootFile=info.getRootFile();
    getManager().addEventToFireByRefresh(new Runnable(){
      public void run(){
        if (!rootFile.isValid())         return;
        fireBeforeFileDeletion(null,rootFile);
        final String path=info.getFile().getPath();
synchronized (LOCK) {
          myPathToFileInfoMap.remove(path);
          myContentChangingJars.add(path);
        }
        info.close();
        fireFileDeleted(null,rootFile,rootFile.getName(),null);
synchronized (LOCK) {
          myContentChangingJars.remove(path);
        }
        fireFileCreated(null,findFileByPath(path + JAR_SEPARATOR));
      }
    }
,asynchronous,modalityState);
  }
  getManager().afterRefreshFinish(asynchronous,modalityState);
}
