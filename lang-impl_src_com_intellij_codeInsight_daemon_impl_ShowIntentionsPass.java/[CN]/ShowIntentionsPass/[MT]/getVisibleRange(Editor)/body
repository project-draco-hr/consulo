{
  Rectangle visibleRect=editor.getScrollingModel().getVisibleArea();
  LogicalPosition startPosition=editor.xyToLogicalPosition(new Point(visibleRect.x,visibleRect.y));
  int myStartOffset=editor.logicalPositionToOffset(startPosition);
  LogicalPosition endPosition=editor.xyToLogicalPosition(new Point(visibleRect.x + visibleRect.width,visibleRect.y + visibleRect.height));
  int myEndOffset=editor.logicalPositionToOffset(new LogicalPosition(endPosition.line + 1,0));
  return new TextRange(myStartOffset,myEndOffset);
}
