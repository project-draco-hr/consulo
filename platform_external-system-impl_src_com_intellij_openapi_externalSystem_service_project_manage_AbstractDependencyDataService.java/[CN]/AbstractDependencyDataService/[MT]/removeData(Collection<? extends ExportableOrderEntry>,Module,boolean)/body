{
  if (toRemove.isEmpty()) {
    return;
  }
  for (  final ExportableOrderEntry dependency : toRemove) {
    ExternalSystemApiUtil.executeProjectChangeAction(synchronous,new DisposeAwareProjectChange(dependency.getOwnerModule()){
      @Override public void execute(){
        ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(module);
        final ModifiableRootModel moduleRootModel=moduleRootManager.getModifiableModel();
        try {
          for (          OrderEntry entry : moduleRootModel.getOrderEntries()) {
            if (entry instanceof ExportableOrderEntry) {
              ExportableOrderEntry orderEntry=(ExportableOrderEntry)entry;
              if (orderEntry.getPresentableName().equals(dependency.getPresentableName()) && orderEntry.getScope().equals(dependency.getScope())) {
                moduleRootModel.removeOrderEntry(entry);
                break;
              }
            }
 else             if (entry.getPresentableName().equals(dependency.getPresentableName())) {
              moduleRootModel.removeOrderEntry(entry);
              break;
            }
          }
        }
  finally {
          moduleRootModel.commit();
        }
      }
    }
);
  }
}
