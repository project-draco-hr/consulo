{
  final VirtualFile xmlVirtualFile=getContentRoot().findFileByRelativePath("test.xml");
  final FileEditorManager fileEditorManager=FileEditorManager.getInstance(myProject);
  FileEditor[] fileEditors=fileEditorManager.openFile(xmlVirtualFile,false);
  final FileEditor fileEditor=fileEditors[0];
  try {
    final StructureViewComponent structureViewComponent=(StructureViewComponent)fileEditor.getStructureViewBuilder().createStructureView(fileEditor,myProject);
    final JTree tree=structureViewComponent.getTree();
    IdeaTestUtil.assertTreeEqual(tree,"-test.xml\n" + " -test\n" + "  +level1\n"+ "  +level1\n"+ "  +level1\n"+ "  +level1\n");
    tree.expandPath(tree.getPathForRow(3));
    IdeaTestUtil.waitForAlarm(600);
    IdeaTestUtil.assertTreeEqual(tree,"-test.xml\n" + " -test\n" + "  +level1\n"+ "  -level1\n"+ "   +level2\n"+ "  +level1\n"+ "  +level1\n");
    Disposer.dispose(structureViewComponent);
  }
  finally {
    fileEditorManager.closeFile(xmlVirtualFile);
  }
}
