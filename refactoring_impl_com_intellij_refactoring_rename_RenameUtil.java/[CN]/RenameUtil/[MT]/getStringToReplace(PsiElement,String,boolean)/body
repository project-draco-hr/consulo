{
  if (element instanceof PsiMetaBaseOwner) {
    final PsiMetaBaseOwner psiMetaBaseOwner=(PsiMetaBaseOwner)element;
    final PsiMetaDataBase metaData=psiMetaBaseOwner.getMetaData();
    if (metaData != null) {
      return metaData.getName();
    }
  }
  if (element instanceof PsiDirectory) {
    element=((PsiDirectory)element).getPackage();
  }
  if (element instanceof PsiPackage) {
    if (nonJava) {
      String qName=((PsiPackage)element).getQualifiedName();
      int index=qName.lastIndexOf('.');
      return index < 0 ? newName : qName.substring(0,index + 1) + newName;
    }
 else {
      return newName;
    }
  }
 else   if (element instanceof PsiClass) {
    if (nonJava) {
      final PsiClass aClass=(PsiClass)element;
      return getQualifiedNameAfterRename(aClass,newName);
    }
 else {
      return newName;
    }
  }
 else   if (element instanceof PsiNamedElement) {
    return newName;
  }
 else {
    LOG.error("Unknown element type");
    return null;
  }
}
