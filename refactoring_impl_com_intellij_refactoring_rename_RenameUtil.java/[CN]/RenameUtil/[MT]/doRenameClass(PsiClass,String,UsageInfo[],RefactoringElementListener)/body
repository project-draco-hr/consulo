{
  ArrayList<UsageInfo> postponedCollisions=new ArrayList<UsageInfo>();
  for (  final UsageInfo usage : usages) {
    if (usage instanceof ResolvableCollisionUsageInfo) {
      if (usage instanceof CollidingClassImportUsageInfo) {
        ((CollidingClassImportUsageInfo)usage).getImportStatement().delete();
      }
 else {
        postponedCollisions.add(usage);
      }
    }
  }
  ChangeContextUtil.encodeContextInfo(aClass,true);
  PsiFile psiFile=aClass.getContainingFile();
  Document document=psiFile == null ? null : PsiDocumentManager.getInstance(aClass.getProject()).getDocument(psiFile);
  aClass.setName(newName);
  for (  UsageInfo usage : usages) {
    if (!(usage instanceof ResolvableCollisionUsageInfo)) {
      final PsiReference ref=usage.getReference();
      if (ref == null)       continue;
      try {
        ref.bindToElement(aClass);
      }
 catch (      IncorrectOperationException e) {
        ref.handleElementRename(newName);
      }
    }
  }
  ChangeContextUtil.decodeContextInfo(aClass,null,null);
  for (  UsageInfo postponedCollision : postponedCollisions) {
    ClassHidesImportedClassUsageInfo collision=(ClassHidesImportedClassUsageInfo)postponedCollision;
    collision.resolveCollision();
  }
  listener.elementRenamed(aClass);
  if (document != null) {
    ((DocumentEx)document).setModificationStamp(psiFile.getModificationStamp());
  }
}
