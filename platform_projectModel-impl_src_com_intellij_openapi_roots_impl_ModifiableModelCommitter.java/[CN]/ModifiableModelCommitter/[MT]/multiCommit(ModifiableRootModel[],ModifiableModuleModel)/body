{
  ApplicationManager.getApplication().assertWriteAccessAllowed();
  final List<RootModelImpl> modelsToCommit=getSortedChangedModels(rootModels,moduleModel);
  final List<ModifiableRootModel> modelsToDispose=new ArrayList<ModifiableRootModel>(Arrays.asList(rootModels));
  modelsToDispose.removeAll(modelsToCommit);
  ModuleManagerImpl.commitModelWithRunnable(moduleModel,new Runnable(){
    @Override public void run(){
      for (      RootModelImpl rootModel : modelsToCommit) {
        rootModel.doCommitAndDispose(true);
      }
      for (      ModifiableRootModel model : modelsToDispose) {
        model.dispose();
      }
    }
  }
);
}
