{
  CharSequence text=document.getCharsSequence();
  int correctedOffset=offset;
  int textLength=document.getTextLength();
  if (offset >= textLength) {
    correctedOffset=textLength - 1;
  }
 else   if (!isIdentifierPart(file,text,offset)) {
    correctedOffset--;
  }
  if (correctedOffset < 0 || !isIdentifierPart(file,text,correctedOffset))   return offset;
  return correctedOffset;
}
