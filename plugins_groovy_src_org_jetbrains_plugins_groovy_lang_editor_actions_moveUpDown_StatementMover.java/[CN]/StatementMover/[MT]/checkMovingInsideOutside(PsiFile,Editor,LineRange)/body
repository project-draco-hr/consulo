{
  final int offset=editor.getCaretModel().getOffset();
  PsiElement guard=file.getViewProvider().findElementAt(offset);
  if (guard == null)   return false;
  guard=PsiTreeUtil.getParentOfType(guard,GrMethod.class,GrTypeDefinition.class,PsiComment.class,GrClosableBlock.class);
  if (!calcInsertOffset(file,editor,result))   return false;
  int insertOffset=isDown ? getLineStartSafeOffset(editor.getDocument(),toMove2.endLine) : editor.getDocument().getLineStartOffset(toMove2.startLine);
  PsiElement newGuard=PsiTreeUtil.getParentOfType(guard,GrMethod.class,GrTypeDefinition.class,PsiComment.class,GrClosableBlock.class);
  if (newGuard == guard && isInside(insertOffset,newGuard) == isInside(offset,guard))   return true;
  return false;
}
