{
  final int offset=editor.getCaretModel().getOffset();
  PsiElement guard=file.getViewProvider().findElementAt(offset);
  if (guard == null)   return false;
  Class<? extends PsiElement>[] classes=new Class[]{GrMethod.class,GrTypeDefinition.class,PsiComment.class,GroovyFile.class};
  guard=PsiTreeUtil.getParentOfType(guard,classes);
  if (!calcInsertOffset(file,editor,result))   return false;
  int insertOffset=isDown ? getLineStartSafeOffset(editor.getDocument(),toMove2.endLine) - 1 : editor.getDocument().getLineStartOffset(toMove2.startLine);
  PsiElement newGuard=file.getViewProvider().findElementAt(insertOffset);
  newGuard=PsiTreeUtil.getParentOfType(newGuard,classes);
  if (newGuard == guard && isInside(insertOffset,newGuard) == isInside(offset,guard))   return true;
  return false;
}
