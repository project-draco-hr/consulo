{
  @NonNls final String text="class S {{ new ArrayList<caret><> }}";
  configureByText(StdFileTypes.JAVA,text);
  boolean old=CodeInsightSettings.getInstance().ADD_UNAMBIGIOUS_IMPORTS_ON_THE_FLY;
  CodeInsightSettings.getInstance().ADD_UNAMBIGIOUS_IMPORTS_ON_THE_FLY=true;
  DaemonCodeAnalyzerSettings.getInstance().setImportHintEnabled(true);
  ((UndoManagerImpl)UndoManager.getInstance(getProject())).flushCurrentCommandMerger();
  ((UndoManagerImpl)UndoManager.getInstance(getProject())).clearUndoRedoQueueInTests(getFile().getVirtualFile());
  type(" ");
  backspace();
  try {
    doHighlighting();
    assertEmpty(((PsiJavaFile)getFile()).getImportList().getAllImportStatements());
    caretRight();
    doHighlighting();
    assertNotSame(0,((PsiJavaFile)getFile()).getImportList().getAllImportStatements().length);
  }
  finally {
    CodeInsightSettings.getInstance().ADD_UNAMBIGIOUS_IMPORTS_ON_THE_FLY=old;
  }
}
