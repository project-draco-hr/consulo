{
  Project project=PlatformDataKeys.PROJECT.getData(e.getDataContext());
  if (project == null) {
    setDisabled(e);
    return;
  }
  ToolWindowManager mgr=ToolWindowManager.getInstance(project);
  String active=mgr.getActiveToolWindowId();
  if (active != null) {
    ToolWindow window=mgr.getToolWindow(active);
    if (!window.isAvailable() || !window.isVisible() || window.getType() == ToolWindowType.FLOATING) {
      setDisabled(e);
      return;
    }
    update(e,window,mgr);
    if (e.getPresentation().isEnabled()) {
      myLastWindow=window;
      myLastManager=mgr;
    }
 else {
      setDisabled(e);
    }
  }
 else {
    setDisabled(e);
  }
}
