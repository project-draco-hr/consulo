{
  ExternalSystemUtil.updateRecentTasks(new ExternalTaskExecutionInfo(mySettings.clone(),executor.getId()),myProject);
  ConsoleView console=new TextConsoleBuilderImpl(myProject).getConsole();
  final MyProcessHandler processHandler=new MyProcessHandler();
  console.attachToProcess(processHandler);
  final List<ExternalTaskPojo> tasks=ContainerUtilRt.newArrayList();
  for (  String taskName : mySettings.getTaskNames()) {
    tasks.add(new ExternalTaskPojo(taskName,mySettings.getExternalProjectPath(),null));
  }
  if (tasks.isEmpty()) {
    throw new ExecutionException(ExternalSystemBundle.message("run.error.undefined.task"));
  }
  String vmOptions;
  if (myDebugPort > 0) {
    String debuggerSetup="-agentlib:jdwp=transport=dt_socket,server=n,suspend=y,address=" + myDebugPort;
    String regular=mySettings.getVmOptions();
    vmOptions=regular == null ? debuggerSetup : regular + " " + debuggerSetup;
  }
 else {
    vmOptions=mySettings.getVmOptions();
  }
  final ExternalSystemExecuteTaskTask task=new ExternalSystemExecuteTaskTask(mySettings.getExternalSystemId(),myProject,tasks,vmOptions);
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    @Override public void run(){
      final String greeting;
      if (mySettings.getTaskNames().size() > 1) {
        greeting=ExternalSystemBundle.message("run.text.starting.multiple.task",StringUtil.join(mySettings.getTaskNames()," "));
      }
 else {
        greeting=ExternalSystemBundle.message("run.text.starting.single.task",StringUtil.join(mySettings.getTaskNames()," "));
      }
      processHandler.notifyTextAvailable(greeting,ProcessOutputTypes.SYSTEM);
      task.execute(new ExternalSystemTaskNotificationListenerAdapter(){
        private boolean myResetGreeting=true;
        @Override public void onTaskOutput(        @NotNull ExternalSystemTaskId id,        @NotNull String text,        boolean stdOut){
          if (myResetGreeting) {
            processHandler.notifyTextAvailable("\r",ProcessOutputTypes.SYSTEM);
            myResetGreeting=false;
          }
          processHandler.notifyTextAvailable(text,stdOut ? ProcessOutputTypes.STDOUT : ProcessOutputTypes.STDERR);
        }
        @Override public void onEnd(        @NotNull ExternalSystemTaskId id){
          processHandler.notifyProcessTerminated(0);
        }
      }
);
    }
  }
);
  return new DefaultExecutionResult(console,processHandler);
}
