{
  if (!psiClass.isPhysical()) {
    return _getAllMethodsMap(psiClass);
  }
  final Pair<Map<String,List<MethodCandidateInfo>>,Runnable> value=psiClass.getUserData(METHODS_MAP_IN_CLASS_KEY);
  if (value == null) {
    final Map<String,List<MethodCandidateInfo>> allMethods=_getAllMethodsMap(psiClass);
    final Runnable cleaner=new Runnable(){
      public void run(){
        psiClass.putUserData(METHODS_MAP_IN_CLASS_KEY,null);
      }
    }
;
    psiClass.putUserData(METHODS_MAP_IN_CLASS_KEY,new Pair<Map<String,List<MethodCandidateInfo>>,Runnable>(allMethods,cleaner));
    PsiManagerImpl manager=(PsiManagerImpl)psiClass.getManager();
    manager.registerWeakRunnableToRunOnChange(cleaner);
    return allMethods;
  }
  return value.first;
}
