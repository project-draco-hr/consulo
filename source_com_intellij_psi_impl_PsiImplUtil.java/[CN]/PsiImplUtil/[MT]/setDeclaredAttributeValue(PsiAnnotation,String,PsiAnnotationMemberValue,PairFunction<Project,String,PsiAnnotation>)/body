{
  final PsiAnnotationMemberValue existing=psiAnnotation.findDeclaredAttributeValue(attributeName);
  if (value == null) {
    if (existing == null) {
      return null;
    }
    existing.getParent().delete();
  }
 else {
    if (existing != null) {
      ((PsiNameValuePair)existing.getParent()).setValue(value);
    }
 else {
      final PsiNameValuePair[] attributes=psiAnnotation.getParameterList().getAttributes();
      if (attributes.length == 1 && attributes[0].getName() == null) {
        attributes[0].replace(createNameValuePair(attributes[0].getValue(),PsiAnnotation.DEFAULT_REFERENCED_METHOD_NAME + "=",annotationCreator));
      }
      boolean allowNoName=attributes.length == 0 && ("value".equals(attributeName) || null == attributeName);
      final String namePrefix;
      if (allowNoName) {
        namePrefix="";
      }
 else {
        namePrefix=attributeName + "=";
      }
      psiAnnotation.getParameterList().addBefore(createNameValuePair(value,namePrefix,annotationCreator),null);
    }
  }
  return psiAnnotation.findDeclaredAttributeValue(attributeName);
}
