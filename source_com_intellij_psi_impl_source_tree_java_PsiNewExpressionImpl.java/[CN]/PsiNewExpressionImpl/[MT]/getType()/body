{
  PsiType type=null;
  for (ASTNode child=getFirstChildNode(); child != null; child=child.getTreeNext()) {
    IElementType elementType=child.getElementType();
    if (elementType == JavaElementType.JAVA_CODE_REFERENCE) {
      LOG.assertTrue(type == null);
      type=new PsiClassReferenceType((PsiJavaCodeReferenceElement)SourceTreeToPsiMap.treeElementToPsi(child),null);
    }
 else     if (ElementType.PRIMITIVE_TYPE_BIT_SET.contains(elementType)) {
      LOG.assertTrue(type == null);
      type=JavaPsiFacade.getInstance(getProject()).getElementFactory().createPrimitiveType(child.getText());
    }
 else     if (elementType == JavaTokenType.LBRACKET) {
      LOG.assertTrue(type != null);
      type=type.createArrayType();
    }
 else     if (elementType == JavaElementType.ANONYMOUS_CLASS) {
      PsiElementFactory factory=JavaPsiFacade.getInstance(getProject()).getElementFactory();
      type=factory.createType((PsiClass)SourceTreeToPsiMap.treeElementToPsi(child));
    }
  }
  return type;
}
