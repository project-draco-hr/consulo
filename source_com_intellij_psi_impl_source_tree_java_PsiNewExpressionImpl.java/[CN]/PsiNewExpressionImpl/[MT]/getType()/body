{
  PsiType type=null;
  for (ASTNode child=firstChild; child != null; child=child.getTreeNext()) {
    if (child.getElementType() == JAVA_CODE_REFERENCE) {
      LOG.assertTrue(type == null);
      type=new PsiClassReferenceType((PsiJavaCodeReferenceElement)SourceTreeToPsiMap.treeElementToPsi(child));
    }
 else     if (PRIMITIVE_TYPE_BIT_SET.isInSet(child.getElementType())) {
      LOG.assertTrue(type == null);
      type=getManager().getElementFactory().createPrimitiveType(child.getText());
    }
 else     if (child.getElementType() == LBRACKET) {
      LOG.assertTrue(type != null);
      type=type.createArrayType();
    }
 else     if (child.getElementType() == ANONYMOUS_CLASS) {
      PsiElementFactory factory=getManager().getElementFactory();
      type=factory.createType((PsiClass)SourceTreeToPsiMap.treeElementToPsi(child));
    }
  }
  return type;
}
