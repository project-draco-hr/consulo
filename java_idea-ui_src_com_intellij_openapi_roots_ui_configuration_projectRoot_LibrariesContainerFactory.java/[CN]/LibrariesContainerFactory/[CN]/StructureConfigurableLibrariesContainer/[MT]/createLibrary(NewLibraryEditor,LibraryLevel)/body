{
  LibraryTableModifiableModelProvider provider=getProvider(level);
  if (provider == null) {
    LOG.error("cannot create module library in this context");
  }
  LibraryTableBase.ModifiableModelEx model=(LibraryTableBase.ModifiableModelEx)provider.getModifiableModel();
  Library library=model.createLibrary(getUniqueLibraryName(libraryEditor.getName(),model),libraryEditor.getType());
  ExistingLibraryEditor createdLibraryEditor=((LibrariesModifiableModel)model).getLibraryEditor(library);
  createdLibraryEditor.setProperties(libraryEditor.getProperties());
  libraryEditor.copyRoots(createdLibraryEditor);
  return library;
}
