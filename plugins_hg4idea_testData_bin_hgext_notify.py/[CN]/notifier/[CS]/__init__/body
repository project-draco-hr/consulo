def __init__(self, ui, repo, hooktype):
    self.ui = ui
    cfg = self.ui.config('notify', 'config')
    if cfg:
        self.ui.readconfig(cfg, sections=['usersubs', 'reposubs'])
    self.repo = repo
    self.stripcount = int(self.ui.config('notify', 'strip', 0))
    self.root = self.strip(self.repo.root)
    self.domain = self.ui.config('notify', 'domain')
    self.test = self.ui.configbool('notify', 'test', True)
    self.charsets = mail._charsets(self.ui)
    self.subs = self.subscribers()
    self.merge = self.ui.configbool('notify', 'merge', True)
    mapfile = self.ui.config('notify', 'style')
    template = (self.ui.config('notify', hooktype) or self.ui.config('notify', 'template'))
    self.t = cmdutil.changeset_templater(self.ui, self.repo, False, None, mapfile, False)
    if ((not mapfile) and (not template)):
        template = (deftemplates.get(hooktype) or single_template)
    if template:
        template = templater.parsestring(template, quoted=False)
        self.t.use_template(template)
