{
  if (myCenterPanel == null) {
    myCenterPanel=new JPanel(new GridBagLayout());
    final GridBagConstraints gb=new GridBagConstraints(0,0,1,1,1,0,GridBagConstraints.NORTHWEST,GridBagConstraints.NONE,JBUI.insets(1),0,0);
    myPatchFileLabel=new JLabel(VcsBundle.message("patch.apply.file.name.field"));
    myPatchFileLabel.setLabelFor(myPatchFile);
    myCenterPanel.add(myPatchFileLabel,gb);
    gb.fill=GridBagConstraints.HORIZONTAL;
    ++gb.gridy;
    myCenterPanel.add(myPatchFile,gb);
    final DefaultActionGroup group=new DefaultActionGroup();
    final AnAction[] treeActions=myChangesTreeList.getTreeActions();
    group.addAll(treeActions);
    group.add(new MapDirectory());
    final MyShowDiff diffAction=new MyShowDiff();
    diffAction.registerCustomShortcutSet(CommonShortcuts.getDiff(),getRootPane());
    group.add(diffAction);
    group.add(new StripUp());
    group.add(new StripDown());
    group.add(new ResetStrip());
    group.add(new ZeroStrip());
    if (myCanChangePatchFile) {
      group.add(new AnAction("Refresh","Refresh",AllIcons.Actions.Refresh){
        @Override public void actionPerformed(        AnActionEvent e){
          syncUpdatePatchFileAndScheduleReloadIfNeeded(null);
        }
      }
);
    }
    final ActionToolbar toolbar=ActionManager.getInstance().createActionToolbar("APPLY_PATCH",group,true);
    ++gb.gridy;
    gb.fill=GridBagConstraints.HORIZONTAL;
    myCenterPanel.add(toolbar.getComponent(),gb);
    ++gb.gridy;
    gb.weighty=1;
    gb.fill=GridBagConstraints.BOTH;
    myCenterPanel.add(ScrollPaneFactory.createScrollPane(myChangesTreeList),gb);
    ++gb.gridy;
    gb.weighty=0;
    gb.fill=GridBagConstraints.NONE;
    gb.insets.bottom=UIUtil.DEFAULT_VGAP;
    myCenterPanel.add(myCommitLegendPanel.getComponent(),gb);
    ++gb.gridy;
    gb.fill=GridBagConstraints.HORIZONTAL;
    myCenterPanel.add(myChangeListChooser,gb);
  }
  return myCenterPanel;
}
