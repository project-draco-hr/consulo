{
  final NamedTrinity totalTrinity=new NamedTrinity();
  final NamedTrinity includedTrinity=new NamedTrinity();
  final Collection<FilePatchInProgress.PatchChange> included=new LinkedList<FilePatchInProgress.PatchChange>();
  if (doInitCheck) {
    for (    FilePatchInProgress.PatchChange change : changes) {
      acceptChange(totalTrinity,change);
      final FilePatchInProgress filePatchInProgress=change.getPatchInProgress();
      if (filePatchInProgress.baseExistsOrAdded()) {
        acceptChange(includedTrinity,change);
        included.add(change);
      }
    }
  }
 else {
    final Collection<FilePatchInProgress.PatchChange> includedNow=myChangesTreeList.getIncludedChanges();
    final Set<FilePatchInProgress> toBeIncluded=new HashSet<FilePatchInProgress>();
    for (    FilePatchInProgress.PatchChange change : includedNow) {
      final FilePatchInProgress patch=change.getPatchInProgress();
      toBeIncluded.add(patch);
    }
    for (    FilePatchInProgress.PatchChange change : changes) {
      final FilePatchInProgress patch=change.getPatchInProgress();
      acceptChange(totalTrinity,change);
      if (toBeIncluded.contains(patch) && patch.baseExistsOrAdded()) {
        acceptChange(includedTrinity,change);
        included.add(change);
      }
    }
  }
  myInfoCalculator.setTotal(totalTrinity);
  myInfoCalculator.setIncluded(includedTrinity);
  myCommitLegendPanel.update();
  return included;
}
