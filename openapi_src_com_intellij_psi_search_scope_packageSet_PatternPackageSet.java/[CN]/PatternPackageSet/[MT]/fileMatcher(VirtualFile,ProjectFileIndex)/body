{
  if (myModulePattern != null) {
    final VirtualFile contentRoot=fileIndex.isInSource(virtualFile) ? fileIndex.getSourceRootForFile(virtualFile) : fileIndex.getContentRootForFile(virtualFile);
    return myFilePattern.matcher(VfsUtil.getRelativePath(virtualFile,contentRoot,'/')).matches();
  }
 else {
    return myFilePattern.matcher(getRelativePath(virtualFile,fileIndex,true)).matches();
  }
}
