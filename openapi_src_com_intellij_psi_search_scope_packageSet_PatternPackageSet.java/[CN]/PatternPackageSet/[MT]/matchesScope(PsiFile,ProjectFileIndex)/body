{
  VirtualFile vFile=file.getVirtualFile();
  if (vFile == null)   return false;
  boolean isSource=fileIndex.isInSourceContent(vFile);
  if (myScope == SCOPE_ANY)   return !isSource && myModulePattern == null || isSource && matchesModule(vFile,fileIndex);
  if (myScope == SCOPE_SOURCE) {
    return isSource && !fileIndex.isInTestSourceContent(vFile) && matchesModule(vFile,fileIndex);
  }
  if (myScope == SCOPE_LIBRARY) {
    return fileIndex.isInLibraryClasses(vFile) || fileIndex.isInLibrarySource(vFile);
  }
  return isSource && fileIndex.isInTestSourceContent(vFile) && matchesModule(vFile,fileIndex);
}
