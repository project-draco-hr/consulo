{
  if (file.getFileType() instanceof ArchiveFileType) {
    final VirtualFile jar=((ArchiveFileType)file.getFileType()).getFileSystem().getVirtualFileForJar(file);
    if (jar != null) {
      return jar.getPath();
    }
  }
  return toCanonicalPath(file.getPath());
}
