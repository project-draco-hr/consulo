{
  GitLineHandler h=createHandler(project,gitRoots,defaultRoot);
  if (h == null) {
    return;
  }
  final VirtualFile root=h.workingDirectoryFile();
  GitRebaseEditorService service=GitRebaseEditorService.getInstance();
  GitRebaseEditorHandler editor=service.getHandler(project,root);
  configureEditor(editor);
  affectedRoots.add(root);
  try {
    h.setenv(GitHandler.GIT_EDITOR_ENV,service.getEditorCommand());
    h.setenv(GitRebaseEditorMain.IDEA_REBASE_HANDER_NO,Integer.toString(editor.getHandlerNo()));
    GitHandlerUtil.doSynchronously(h,GitBundle.getString("rebasing.title"),h.printableCommandLine());
  }
  finally {
    editor.close();
  }
}
