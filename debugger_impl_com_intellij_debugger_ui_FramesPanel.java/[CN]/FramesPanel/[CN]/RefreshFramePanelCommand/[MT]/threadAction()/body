{
  if (myRefreshOnly && myThreadDescriptorsToUpdate.length != myThreadsCombo.getItemCount()) {
    return;
  }
  final DebuggerContextImpl context=getDebuggerContext();
  final ThreadReferenceProxyImpl threadToSelect=context.getThreadProxy();
  if (threadToSelect == null) {
    return;
  }
  final SuspendContextImpl threadContext=SuspendManagerUtil.getSuspendContextForThread(context.getSuspendContext(),threadToSelect);
  final ThreadDescriptorImpl currentThreadDescriptor=(ThreadDescriptorImpl)myThreadsCombo.getSelectedItem();
  final ThreadReferenceProxyImpl currentThread=currentThreadDescriptor != null ? currentThreadDescriptor.getThreadReference() : null;
  if (myRefreshOnly && threadToSelect.equals(currentThread)) {
    context.getDebugProcess().getManagerThread().invokeLater(new UpdateFramesListCommand(context,threadContext));
  }
 else {
    context.getDebugProcess().getManagerThread().invokeLater(new RebuildFramesListCommand(context,threadContext));
  }
  if (myRefreshOnly) {
    final EvaluationContextImpl evaluationContext=context.createEvaluationContext();
    for (    ThreadDescriptorImpl descriptor : myThreadDescriptorsToUpdate) {
      descriptor.setContext(evaluationContext);
      descriptor.updateRepresentation(evaluationContext,DescriptorLabelListener.DUMMY_LISTENER);
    }
    DebuggerInvocationUtil.invokeLater(getProject(),new Runnable(){
      public void run(){
        try {
          myThreadsListener.setEnabled(false);
          selectThread(threadToSelect);
          myFramesList.repaint();
        }
  finally {
          myThreadsListener.setEnabled(true);
        }
      }
    }
);
  }
 else {
    refillThreadsCombo(threadToSelect);
  }
}
