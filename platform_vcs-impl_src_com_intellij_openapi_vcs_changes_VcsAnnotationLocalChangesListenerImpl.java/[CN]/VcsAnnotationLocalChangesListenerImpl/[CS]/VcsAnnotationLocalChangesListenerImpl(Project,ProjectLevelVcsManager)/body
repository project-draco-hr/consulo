{
  myProject=project;
  myLock=new Object();
  myUpdateStuff=createUpdateStuff();
  myUpdater=new ZipperUpdater(ApplicationManager.getApplication().isUnitTestMode() ? 10 : 300,Alarm.ThreadToUse.SWING_THREAD,project);
  myConnection=myProject.getMessageBus().connect();
  myLocalFileSystem=LocalFileSystem.getInstance();
  myHandler=createHandler();
  myDirtyPaths=new HashSet<String>();
  myDirtyChanges=new HashMap<String,VcsRevisionNumber>();
  myDirtyFiles=new HashSet<VirtualFile>();
  myFileAnnotationMap=new MultiMap<VirtualFile,FileAnnotation>(){
    @Override protected Collection<FileAnnotation> createCollection(){
      return new HashSet<FileAnnotation>(1);
    }
  }
;
  myVcsManager=vcsManager;
  myVcsKeySet=new HashSet<VcsKey>();
  myConnection.subscribe(VcsAnnotationRefresher.LOCAL_CHANGES_CHANGED,myHandler);
}
