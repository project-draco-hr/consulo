{
  return new Runnable(){
    @Override public void run(){
      final Set<String> paths=new HashSet<String>();
      final Map<String,VcsRevisionNumber> changes=new HashMap<String,VcsRevisionNumber>();
      final Set<VirtualFile> files=new HashSet<VirtualFile>();
      Set<VcsKey> vcsToRefresh;
synchronized (myLock) {
        vcsToRefresh=new HashSet<VcsKey>(myVcsKeySet);
        paths.addAll(myDirtyPaths);
        changes.putAll(myDirtyChanges);
        files.addAll(myDirtyFiles);
        myDirtyPaths.clear();
        myDirtyChanges.clear();
        myVcsKeySet.clear();
        myDirtyFiles.clear();
      }
      closeForVcs(vcsToRefresh);
      checkByDirtyScope(paths,changes,files);
    }
  }
;
}
