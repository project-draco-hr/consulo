{
  final PsiFile containingFile=aClass.getContainingFile();
  if (file.equals(containingFile)) {
    return;
  }
  final String qualifiedName=aClass.getQualifiedName();
  if (qualifiedName == null) {
    return;
  }
  final PsiImportList importList=file.getImportList();
  if (importList == null) {
    return;
  }
  final String containingPackageName=file.getPackageName();
  @NonNls final String packageName=ClassUtil.extractPackageName(qualifiedName);
  if (containingPackageName.equals(packageName) || importList.findSingleClassImportStatement(qualifiedName) != null) {
    return;
  }
  if (importList.findOnDemandImportStatement(packageName) != null && !hasDefaultImportConflict(qualifiedName,file) && !hasOnDemandImportConflict(qualifiedName,file)) {
    return;
  }
  final Project project=importList.getProject();
  final JavaPsiFacade psiFacade=JavaPsiFacade.getInstance(project);
  final PsiElementFactory elementFactory=psiFacade.getElementFactory();
  final PsiImportStatement importStatement=elementFactory.createImportStatement(aClass);
  importList.add(importStatement);
}
