{
  super(elementToRename,editor,project,title,new PsiExpression[0],null);
  myProject=project;
  myEditor=editor;
  myCantChangeFinalModifier=cantChangeFinalModifier;
  myTitle=title;
  setExprMarker(exprMarker);
  setOccurrenceMarkers(occurrenceMarkers);
  final PsiDeclarationStatement declarationStatement=PsiTreeUtil.getParentOfType(elementToRename,PsiDeclarationStatement.class);
  myPointer=declarationStatement != null ? SmartPointerManager.getInstance(project).createSmartPsiElementPointer(declarationStatement) : null;
  editor.putUserData(ReassignVariableUtil.DECLARATION_KEY,myPointer);
  if (occurrenceMarkers != null) {
    final ArrayList<RangeMarker> rangeMarkers=new ArrayList<RangeMarker>(occurrenceMarkers);
    rangeMarkers.add(exprMarker);
    editor.putUserData(ReassignVariableUtil.OCCURRENCES_KEY,rangeMarkers.toArray(new RangeMarker[rangeMarkers.size()]));
  }
  myExpression=expression;
  if (declarationStatement != null) {
    final ResolveSnapshotProvider resolveSnapshotProvider=VariableInplaceRenamer.INSTANCE.forLanguage(declarationStatement.getLanguage());
    myConflictResolver=resolveSnapshotProvider != null ? resolveSnapshotProvider.createSnapshot(declarationStatement) : null;
  }
  final PsiType defaultType=elementToRename.getType();
  myDefaultType=SmartTypePointerManager.getInstance(project).createSmartTypePointer(defaultType);
  setAdvertisementText(getAdvertisementText(declarationStatement,defaultType,hasTypeSuggestion));
}
