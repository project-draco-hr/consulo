{
  if (!(file instanceof PsiJavaFile))   return;
  ProgressIndicator indicator=ProgressManager.getInstance().getProgressIndicator();
  if (indicator != null) {
    indicator.setText("Scanning packages");
    indicator.setText2(file.getVirtualFile().getPresentableUrl());
    indicator.setFraction(((double)myScannedFileCount++) / myTotalFileCount);
  }
  boolean isMarked=myMarker == null ? false : myMarker.isMarked(file);
  if (isMarked)   myMarkedFileCount++;
  if (isMarked || myAddUnmarkedFiles) {
    PackageDependenciesNode dirNode=getFileParentNode((PsiJavaFile)file);
    if (myShowFiles) {
      FileNode fileNode=new FileNode(file,isMarked);
      dirNode.add(fileNode);
    }
 else {
      dirNode.addFile(file,isMarked);
    }
  }
}
