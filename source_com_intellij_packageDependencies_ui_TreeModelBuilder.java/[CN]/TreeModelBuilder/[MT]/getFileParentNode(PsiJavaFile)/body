{
  VirtualFile vFile=file.getVirtualFile();
  PsiPackage aPackage=getFilePackage(file);
  if (myFileIndex.isInLibrarySource(vFile) || myFileIndex.isInLibraryClasses(vFile)) {
    return getLibraryDirNode(aPackage,getLibraryForFile(file));
  }
 else {
    return getModuleDirNode(aPackage,myFileIndex.getModuleForFile(vFile),getFileScopeType(vFile));
  }
}
