{
  boolean isMarked=myMarker != null && myMarker.isMarked(file);
  if (!isMarked)   return null;
  final VirtualFile vFile=file.getVirtualFile();
  LOG.assertTrue(vFile != null);
  PsiDirectory dirToReload=file.getContainingDirectory();
  PackageDependenciesNode rootToReload=getMap(myModuleDirNodes,getFileScopeType(vFile)).get(dirToReload);
  if (rootToReload == null && myFlattenPackages) {
    rootToReload=getModuleNode(myFileIndex.getModuleForFile(vFile),getFileScopeType(vFile));
  }
 else {
    while (rootToReload == null && dirToReload != null) {
      dirToReload=dirToReload.getParentDirectory();
      rootToReload=getMap(myModuleDirNodes,getFileScopeType(vFile)).get(dirToReload);
    }
  }
  PackageDependenciesNode dirNode=getFileParentNode(file);
  dirNode.add(new FileNode(file,isMarked));
  return rootToReload;
}
