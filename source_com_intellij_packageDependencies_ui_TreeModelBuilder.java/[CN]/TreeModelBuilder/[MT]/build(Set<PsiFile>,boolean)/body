{
  if (files.size() == 1) {
    myShowFiles=true;
  }
  Runnable buildingRunnable=new Runnable(){
    public void run(){
      for (Iterator<PsiFile> iterator=files.iterator(); iterator.hasNext(); ) {
        buildFileNode(iterator.next());
      }
    }
  }
;
  if (showProgress) {
    ApplicationManager.getApplication().runProcessWithProgressSynchronously(buildingRunnable,"Scanning Packages",false,myProject);
  }
 else {
    buildingRunnable.run();
  }
  TreeUtil.sort(myRoot,new DependecyNodeComparator());
  return new TreeModel(myRoot,myTotalFileCount,myMarkedFileCount);
}
