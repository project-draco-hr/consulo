{
  VirtualFile vFile=file.getVirtualFile();
  if (vFile != null && myFileIndex.isInLibrarySource(vFile)) {
    final VirtualFile directory=vFile.getParent();
    if (directory != null) {
      final String packageName=myFileIndex.getPackageNameByDirectory(directory);
      if (packageName != null) {
        return JavaPsiFacade.getInstance(myPsiManager.getProject()).findPackage(packageName);
      }
    }
  }
  return JavaPsiFacade.getInstance(myPsiManager.getProject()).findPackage(file.getPackageName());
}
