{
  VirtualFile vFile=file.getVirtualFile();
  if (file instanceof PsiJavaFile) {
    PsiPackage aPackage=getFilePackage((PsiJavaFile)file);
    if (myFileIndex.isInLibrarySource(vFile) || myFileIndex.isInLibraryClasses(vFile)) {
      return getLibraryDirNode(aPackage,getLibraryForFile(file));
    }
 else {
      return getModuleDirNode(aPackage,myFileIndex.getModuleForFile(vFile),getFileScopeType(vFile));
    }
  }
  return getModuleNode(myFileIndex.getModuleForFile(vFile),getFileScopeType(vFile));
}
