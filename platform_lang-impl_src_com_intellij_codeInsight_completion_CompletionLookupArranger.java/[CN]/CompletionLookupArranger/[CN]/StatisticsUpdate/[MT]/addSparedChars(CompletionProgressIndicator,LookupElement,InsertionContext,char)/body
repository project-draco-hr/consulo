{
  String textInserted;
  if (context.getOffsetMap().containsOffset(CompletionInitializationContext.START_OFFSET) && context.getOffsetMap().containsOffset(InsertionContext.TAIL_OFFSET) && context.getTailOffset() >= context.getStartOffset()) {
    textInserted=context.getDocument().getImmutableCharSequence().subSequence(context.getStartOffset(),context.getTailOffset()).toString();
  }
 else {
    textInserted=item.getLookupString();
  }
  String withoutSpaces=StringUtil.replace(textInserted,new String[]{" ","\t","\n"},new String[]{"","",""});
  int spared=withoutSpaces.length() - indicator.getLookup().itemPattern(item).length();
  if (!LookupEvent.isSpecialCompletionChar(completionChar) && withoutSpaces.contains(String.valueOf(completionChar))) {
    spared--;
  }
  if (spared > 0) {
    mySpared+=spared;
  }
}
