{
  List<LookupElement> items=getMatchingItems();
  MultiMap<CompletionSorterImpl,LookupElement> itemsBySorter=groupItemsBySorter(items);
  LookupElement relevantSelection=findMostRelevantItem(itemsBySorter);
  LookupImpl lookupImpl=(LookupImpl)lookup;
  List<LookupElement> listModel=isAlphaSorted() ? sortByPresentation(items,lookupImpl) : fillModelByRelevance(lookupImpl,items,itemsBySorter,relevantSelection);
  int toSelect=getItemToSelect(lookupImpl,listModel,onExplicitAction,relevantSelection);
  LOG.assertTrue(toSelect >= 0);
  addDummyItems(items.size() - listModel.size(),listModel);
  return new Pair<List<LookupElement>,Integer>(listModel,toSelect);
}
