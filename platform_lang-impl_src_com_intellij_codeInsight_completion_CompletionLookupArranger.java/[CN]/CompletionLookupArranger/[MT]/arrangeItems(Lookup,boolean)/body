{
  List<LookupElement> items=getMatchingItems();
  MultiMap<CompletionSorterImpl,LookupElement> itemsBySorter=groupItemsBySorter(items);
  List<LookupElement> listModel=isAlphaSorted() ? sortByPresentation(items) : fillModelByRelevance((LookupImpl)lookup,items,itemsBySorter);
  int toSelect=getItemToSelect(lookup,listModel,itemsBySorter,onExplicitAction);
  LOG.assertTrue(toSelect >= 0);
  addDummyItems(items.size() - listModel.size(),listModel);
  return new Pair<List<LookupElement>,Integer>(listModel,toSelect);
}
