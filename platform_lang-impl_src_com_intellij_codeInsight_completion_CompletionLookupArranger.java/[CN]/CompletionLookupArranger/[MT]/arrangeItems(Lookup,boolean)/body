{
  List<LookupElement> items=getMatchingItems();
  MultiMap<CompletionSorterImpl,LookupElement> itemsBySorter=groupItemsBySorter(items);
  LookupElement relevantSelection=findMostRelevantItem(itemsBySorter);
  List<LookupElement> listModel=isAlphaSorted() ? sortByPresentation(items,lookup) : fillModelByRelevance((LookupImpl)lookup,items,itemsBySorter,relevantSelection);
  int toSelect=getItemToSelect((LookupImpl)lookup,listModel,onExplicitAction,relevantSelection);
  LOG.assertTrue(toSelect >= 0);
  addDummyItems(items.size() - listModel.size(),listModel);
  return new Pair<List<LookupElement>,Integer>(listModel,toSelect);
}
