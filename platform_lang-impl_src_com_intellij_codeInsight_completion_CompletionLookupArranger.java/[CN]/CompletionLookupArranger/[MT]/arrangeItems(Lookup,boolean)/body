{
  List<LookupElement> items=matchingItems(lookup);
  MultiMap<CompletionSorterImpl,LookupElement> inputBySorter=groupInputBySorter(items);
  List<LookupElement> listModel=isAlphaSorted() ? sortByPresentation(items) : fillModelByRelevance((LookupImpl)lookup,items,inputBySorter);
  int toSelect=getItemToSelect(lookup,listModel,inputBySorter,onExplicitAction);
  addDummyItems(items.size() - listModel.size(),listModel);
  return new Pair<List<LookupElement>,Integer>(listModel,toSelect);
}
