{
  return new Classifier<LookupElement>(){
    private final FactoryMap<CompletionSorterImpl,Classifier<LookupElement>> myClassifiers=new FactoryMap<CompletionSorterImpl,Classifier<LookupElement>>(){
      @Override protected Map<CompletionSorterImpl,Classifier<LookupElement>> createMap(){
        return Maps.newLinkedHashMap();
      }
      @Override protected Classifier<LookupElement> create(      CompletionSorterImpl key){
        return key.buildClassifier();
      }
    }
;
    @Override public void addElement(    LookupElement element){
      myClassifiers.get(obtainSorter(element)).addElement(element);
    }
    @NotNull private CompletionSorterImpl obtainSorter(    LookupElement element){
      return element.getUserData(SORTER_KEY);
    }
    @Override public Iterable<List<LookupElement>> classify(    List<LookupElement> source){
      MultiMap<CompletionSorter,LookupElement> inputBySorter=new MultiMap<CompletionSorter,LookupElement>();
      for (      LookupElement element : source) {
        inputBySorter.putValue(obtainSorter(element),element);
      }
      final ArrayList<List<LookupElement>> result=new ArrayList<List<LookupElement>>();
      for (      CompletionSorterImpl sorter : myClassifiers.keySet()) {
        ContainerUtil.addAll(result,myClassifiers.get(sorter).classify((List<LookupElement>)inputBySorter.get(sorter)));
      }
      return result;
    }
  }
;
}
