{
  JList list=lookup.getList();
  final boolean testMode=ApplicationManager.getApplication().isUnitTestMode();
  final int limit=Math.max(list.getLastVisibleIndex(),model.size()) + ourUISettings.MAX_LOOKUP_LIST_HEIGHT * 3;
  addSomeItems(model,byRelevance,new Condition<LookupElement>(){
    @Override public boolean value(    LookupElement lastAdded){
      return !testMode && model.size() >= limit;
    }
  }
);
}
