{
  final PsiProximityComparator proximityComparator=new PsiProximityComparator(myLocation.getCompletionParameters().getPosition());
  Collections.sort(items,new Comparator<LookupElement>(){
    public int compare(    LookupElement o1,    LookupElement o2){
      LookupElement c1=getCoreElement(o1);
      LookupElement c2=getCoreElement(o2);
      if (c1 instanceof LookupItem && c2 instanceof LookupItem) {
        double priority1=((LookupItem)c1).getPriority();
        double priority2=((LookupItem)c2).getPriority();
        if (priority1 > priority2)         return -1;
        if (priority2 > priority1)         return 1;
      }
      int grouping1=c1.getGrouping();
      int grouping2=c2.getGrouping();
      if (grouping1 > grouping2)       return -1;
      if (grouping2 > grouping1)       return 1;
      int stringCompare=o1.getLookupString().compareToIgnoreCase(o2.getLookupString());
      if (stringCompare != 0)       return stringCompare;
      return proximityComparator.compare(o1.getObject(),o2.getObject());
    }
  }
);
}
