{
  final CompletionPreselectSkipper[] skippers=CompletionPreselectSkipper.EP_NAME.getExtensions();
  Set<LookupElement> model=new THashSet<LookupElement>(sorted);
  for (  List<LookupElement> group : groups) {
    for (    LookupElement element : group) {
      if (model.contains(element)) {
        if (!shouldSkip(skippers,element)) {
          return sorted.indexOf(element);
        }
      }
    }
  }
  return sorted.size() - 1;
}
