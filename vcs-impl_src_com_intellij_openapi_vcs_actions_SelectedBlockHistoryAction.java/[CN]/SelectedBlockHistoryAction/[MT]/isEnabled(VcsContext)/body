{
  VirtualFile[] selectedFiles=context.getSelectedFiles();
  if (selectedFiles == null)   return false;
  if (selectedFiles.length == 0)   return false;
  VirtualFile file=selectedFiles[0];
  Project project=context.getProject();
  if (project == null)   return false;
  final ProjectLevelVcsManagerImpl vcsManager=(ProjectLevelVcsManagerImpl)ProjectLevelVcsManager.getInstance(project);
  final BackgroundableActionEnabledHandler handler=vcsManager.getBackgroundableActionHandler(VcsBackgroundableActions.HISTORY_FOR_SELECTION);
  if (handler.isInProgress(VcsBackgroundableActions.keyFrom(file)))   return false;
  AbstractVcs vcs=vcsManager.getVcsFor(file);
  if (vcs == null)   return false;
  VcsHistoryProvider vcsHistoryProvider=vcs.getVcsBlockHistoryProvider();
  if (vcsHistoryProvider == null)   return false;
  if (!AbstractVcs.fileInVcsByFileStatus(project,new FilePathImpl(file)))   return false;
  VcsSelection selection=VcsSelectionUtil.getSelection(context);
  if (selection == null) {
    return false;
  }
  return true;
}
