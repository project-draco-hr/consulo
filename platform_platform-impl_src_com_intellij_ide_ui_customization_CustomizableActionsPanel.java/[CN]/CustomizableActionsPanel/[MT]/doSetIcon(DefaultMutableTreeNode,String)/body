{
  String actionId=getActionId(node);
  if (actionId == null)   return;
  final AnAction action=ActionManager.getInstance().getAction(actionId);
  if (action != null && action.getTemplatePresentation() != null) {
    if (path != null && path.length() > 0) {
      Image image=null;
      try {
        image=ImageLoader.loadFromStream(VfsUtil.convertToURL(VfsUtil.pathToUrl(path.replace(File.separatorChar,'/'))).openStream());
      }
 catch (      IOException e) {
        LOG.debug(e);
      }
      Icon icon=new File(path).exists() ? IconLoader.getIcon(image) : null;
      if (icon != null) {
        if (icon.getIconWidth() > EMPTY_ICON.getIconWidth() || icon.getIconHeight() > EMPTY_ICON.getIconHeight()) {
          Messages.showErrorDialog(myActionsTree,IdeBundle.message("custom.icon.validation.message"),IdeBundle.message("custom.icon.validation.title"));
          return;
        }
        node.setUserObject(Pair.create(actionId,icon));
        mySelectedSchema.addIconCustomization(actionId,path);
      }
    }
 else {
      node.setUserObject(Pair.create(actionId,null));
      mySelectedSchema.removeIconCustomization(actionId);
      final DefaultMutableTreeNode nodeOnToolbar=findNodeOnToolbar(actionId);
      if (nodeOnToolbar != null) {
        editToolbarIcon(actionId,nodeOnToolbar);
        node.setUserObject(nodeOnToolbar.getUserObject());
      }
    }
  }
}
