{
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  XmlFile file=(XmlFile)PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
  final int offset=editor.getCaretModel().getOffset();
  PsiElement element=file.findElementAt(offset - 1);
  ASTNode prevLeaf=element.getNode();
  if (!"/".equals(prevLeaf.getText()))   return;
  while ((prevLeaf=TreeUtil.prevLeaf(prevLeaf)) != null && prevLeaf.getElementType() == XmlTokenType.XML_WHITE_SPACE)   ;
  if (prevLeaf == null)   return;
  XmlTag tag=PsiTreeUtil.getParentOfType(prevLeaf.getPsi(),XmlTag.class);
  if (tag == null) {
    PsiElement element2=file.findElementAt(prevLeaf.getStartOffset());
    tag=PsiTreeUtil.getParentOfType(element2,XmlTag.class);
    if (tag == null)     return;
  }
  if (XmlUtil.getTokenOfType(tag,XmlTokenType.XML_TAG_END) != null)   return;
  if (XmlUtil.getTokenOfType(tag,XmlTokenType.XML_EMPTY_ELEMENT_END) != null)   return;
  if (PsiTreeUtil.getParentOfType(element,XmlAttributeValue.class) != null)   return;
  EditorModificationUtil.insertStringAtCaret(editor,">");
}
