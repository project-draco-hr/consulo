{
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  XmlFile file=(XmlFile)PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
  final int offset=editor.getCaretModel().getOffset();
  PsiElement element=file.findElementAt(offset);
  if (!(element instanceof PsiWhiteSpace))   return;
  while (element instanceof PsiWhiteSpace)   element=element.getPrevSibling();
  if (!(element instanceof XmlToken))   return;
  XmlToken token=(XmlToken)element;
  if (!"/".equals(token.getText()))   return;
  PsiElement prevSibling=element.getPrevSibling();
  if (prevSibling != null) {
    element=prevSibling;
  }
 else {
    PsiElement parent=element.getParent();
    if (parent instanceof XmlText) {
      element=parent.getPrevSibling();
    }
  }
  while (element instanceof PsiWhiteSpace)   element=element.getPrevSibling();
  if (!(element instanceof XmlTag))   return;
  XmlTag tag=(XmlTag)element;
  if (XmlUtil.getTokenOfType(tag,XmlTokenType.XML_TAG_END) != null)   return;
  if (XmlUtil.getTokenOfType(tag,XmlTokenType.XML_EMPTY_ELEMENT_END) != null)   return;
  EditorModificationUtil.insertStringAtCaret(editor,">");
}
