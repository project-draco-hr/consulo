{
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  JspFile file=(JspFile)PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
  final int offset=editor.getCaretModel().getOffset();
  PsiElement element=file.findElementAt(offset);
  if (element == null) {
    element=file.findElementAt(editor.getDocument().getTextLength() - 1);
    if (element == null)     return null;
  }
 else {
    if (!(element instanceof JspToken) || ((JspToken)element).getTokenType() != JspTokenType.JSP_ACTION_WHITE_SPACE)     return null;
  }
  while (((element instanceof JspToken) && ((JspToken)element).getTokenType() == JspTokenType.JSP_ACTION_WHITE_SPACE) || element instanceof JspAttribute) {
    element=element.getPrevSibling();
  }
  if (element instanceof JspToken) {
    if (((JspToken)element).getTokenType() == JspTokenType.JSP_ACTION_NAME && ((JspToken)element.getPrevSibling()).getTokenType() == JspTokenType.JSP_ACTION_END_TAG_START) {
      return null;
    }
    element=element.getParent();
    if (element instanceof JspAttribute) {
      element=element.getParent();
    }
  }
  if (!(element instanceof JspAction))   return null;
  return (JspAction)element;
}
