{
  try {
    Document doc=editor.getDocument();
    CharSequence chars=doc.getCharsSequence();
    int lineEnd=doc.getLineEndOffset(doc.getLineNumber(offset));
    while (!iterator.atEnd() && iterator.getStart() < lineEnd) {
      IElementType tokenType=iterator.getTokenType();
      if (tokenType == JavaTokenType.STRING_LITERAL || tokenType == JavaTokenType.CHARACTER_LITERAL) {
        if (iterator.getStart() >= iterator.getEnd() - 1 || chars.charAt(iterator.getEnd() - 1) != '\"' && chars.charAt(iterator.getEnd() - 1) != '\'') {
          return true;
        }
      }
      iterator.advance();
    }
    return false;
  }
  finally {
    while (iterator.atEnd() || iterator.getStart() != offset)     iterator.retreat();
  }
}
