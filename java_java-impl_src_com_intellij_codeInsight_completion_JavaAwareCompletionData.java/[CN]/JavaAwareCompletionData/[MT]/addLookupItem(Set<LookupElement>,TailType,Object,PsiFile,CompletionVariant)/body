{
  if (completion instanceof LookupElement && !(completion instanceof LookupItem)) {
    set.add((LookupElement)completion);
    return;
  }
  LookupElement _ret=LookupItemUtil.objectToLookupItem(completion);
  if (_ret == null || !(_ret instanceof LookupItem))   return;
  LookupItem ret=(LookupItem)_ret;
  final InsertHandler insertHandler=variant.getInsertHandler();
  if (insertHandler != null && ret.getInsertHandler() == null) {
  }
  ret.setInsertHandler(new InsertHandler<LookupElement>(){
    @Override public void handleInsert(    InsertionContext context,    LookupElement item){
      if (context.shouldAddCompletionChar()) {
        return;
      }
      TailType type=analyzeItem(item.getObject(),context.getFile().findElementAt(context.getStartOffset()));
      if (type == TailType.NONE) {
        type=tailType;
      }
      if (type != TailType.NONE) {
        type.processTail(context.getEditor(),context.getTailOffset());
      }
    }
  }
);
  final Map<Object,Object> itemProperties=variant.getItemProperties();
  for (  final Object key : itemProperties.keySet()) {
    ret.setAttribute(key,itemProperties.get(key));
  }
  set.add(ret);
}
