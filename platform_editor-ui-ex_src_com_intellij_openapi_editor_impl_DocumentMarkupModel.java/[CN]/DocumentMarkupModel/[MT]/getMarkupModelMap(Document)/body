{
  ConcurrentMap<Project,MarkupModelImpl> markupModelMap=document.getUserData(MARKUP_MODEL_MAP_KEY);
  if (markupModelMap == null) {
synchronized (lock) {
      markupModelMap=document.getUserData(MARKUP_MODEL_MAP_KEY);
      if (markupModelMap == null) {
        markupModelMap=new ConcurrentHashMap<Project,MarkupModelImpl>();
        document.putUserData(MARKUP_MODEL_MAP_KEY,markupModelMap);
      }
    }
  }
  return markupModelMap;
}
