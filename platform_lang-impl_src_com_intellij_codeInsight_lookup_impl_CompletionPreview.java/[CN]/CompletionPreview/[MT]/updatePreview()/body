{
  LookupElement item=myLookup.getCurrentItem();
  if (item == null) {
    return;
  }
  final EditorImpl editor=getEditorImpl();
  if (editor.getSelectionModel().hasSelection() || editor.getSelectionModel().hasBlockSelection()) {
    return;
  }
  String text=getPreviewText(item);
  int prefixLength=myLookup.getPrefixLength(item);
  if (prefixLength > text.length()) {
    return;
  }
  FList<TextRange> fragments=LookupCellRenderer.getMatchingFragments(myLookup.itemPattern(item).substring(0,prefixLength),text);
  if (fragments == null) {
    return;
  }
  if (!fragments.isEmpty()) {
    ArrayList<TextRange> arrayList=new ArrayList<TextRange>(fragments);
    prefixLength=arrayList.get(arrayList.size() - 1).getEndOffset();
  }
  editor.setCustomImage(null);
  BufferedImage previewImage=createPreviewImage(text.substring(prefixLength));
  editor.setCustomImage(Pair.create(getCaretPoint(),previewImage));
  repaintCaretLine();
}
