{
  LookupElement item=lookup.getCurrentItem();
  if (item == null) {
    return;
  }
  LookupElementPresentation presentation=LookupElementPresentation.renderElement(item);
  String text=presentation.getItemText();
  if (text == null) {
    text=item.getLookupString();
  }
 else {
    String tailText=presentation.getTailText();
    if (tailText != null && tailText.startsWith("(") && tailText.contains(")")) {
      Editor editor=lookup.getEditor();
      CharSequence seq=editor.getDocument().getCharsSequence();
      int caret=editor.getCaretModel().getOffset();
      if (caret >= seq.length() || seq.charAt(caret) != '(') {
        text+="()";
      }
    }
  }
  int prefixLength=lookup.getPrefixLength(item);
  if (prefixLength > text.length()) {
    return;
  }
  FList<TextRange> fragments=LookupCellRenderer.getMatchingFragments(lookup.itemPattern(item).substring(0,prefixLength),text);
  if (fragments == null || fragments.isEmpty()) {
    return;
  }
  ArrayList<TextRange> arrayList=new ArrayList<TextRange>(fragments);
  TextRange last=arrayList.get(arrayList.size() - 1);
  new CompletionPreview(lookup,text,last.getEndOffset());
}
