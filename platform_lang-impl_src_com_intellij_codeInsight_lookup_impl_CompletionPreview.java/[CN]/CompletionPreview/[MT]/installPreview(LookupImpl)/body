{
  LookupElement item=lookup.getCurrentItem();
  if (item == null || !(lookup.getEditor() instanceof EditorImpl)) {
    return;
  }
  String text=getPreviewText(lookup,item);
  int prefixLength=lookup.getPrefixLength(item);
  if (prefixLength > text.length()) {
    return;
  }
  FList<TextRange> fragments=LookupCellRenderer.getMatchingFragments(lookup.itemPattern(item).substring(0,prefixLength),text);
  if (fragments == null) {
    return;
  }
  if (!fragments.isEmpty()) {
    ArrayList<TextRange> arrayList=new ArrayList<TextRange>(fragments);
    prefixLength=arrayList.get(arrayList.size() - 1).getEndOffset();
  }
  new CompletionPreview(lookup,text,prefixLength);
}
