{
  if (element == null)   return;
  final String text=ElementManipulators.getValueText(element);
  final int offsetInPosition=ElementManipulators.getValueTextRange(element).getStartOffset() + element.getTextRange().getStartOffset() - antElement.getTextRange().getStartOffset();
  int startIndex;
  int endIndex=-1;
  while ((startIndex=text.indexOf("@{",endIndex + 1)) > endIndex) {
    startIndex+=2;
    endIndex=startIndex;
    int nestedBrackets=0;
    while (text.length() > endIndex) {
      final char ch=text.charAt(endIndex);
      if (ch == '}') {
        if (nestedBrackets == 0) {
          break;
        }
        --nestedBrackets;
      }
 else       if (ch == '{') {
        ++nestedBrackets;
      }
      ++endIndex;
    }
    if (nestedBrackets > 0 || endIndex == text.length())     return;
    if (endIndex >= startIndex) {
      final String name=text.substring(startIndex,endIndex);
      refs.add(new AntMacroDefParameterReference(antElement,name,new TextRange(offsetInPosition + startIndex,offsetInPosition + endIndex),element));
    }
    endIndex=startIndex;
  }
}
