{
  try {
    return ApplicationManager.getApplication().runReadAction(new Computable<GeneralCommandLine>(){
      public GeneralCommandLine compute(){
        try {
          final Sdk jdk=javaParameters.getJdk();
          if (jdk == null) {
            throw new CantRunException(ExecutionBundle.message("run.configuration.error.no.jdk.specified"));
          }
          final SdkType sdkType=jdk.getSdkType();
          if (!(sdkType instanceof JavaSdkType)) {
            throw new CantRunException(ExecutionBundle.message("run.configuration.error.no.jdk.specified"));
          }
          final String exePath=((JavaSdkType)sdkType).getVMExecutablePath(jdk);
          if (exePath == null) {
            throw new CantRunException(ExecutionBundle.message("run.configuration.cannot.find.vm.executable"));
          }
          if (javaParameters.getMainClass() == null) {
            throw new CantRunException(ExecutionBundle.message("main.class.is.not.specified.error.message"));
          }
          return JdkUtil.setupJVMCommandLine(exePath,javaParameters,forceDynamicClasspath);
        }
 catch (        CantRunException e) {
          throw new RuntimeException(e);
        }
      }
    }
);
  }
 catch (  RuntimeException e) {
    if (e.getCause() instanceof CantRunException) {
      throw (CantRunException)e.getCause();
    }
 else {
      throw e;
    }
  }
}
