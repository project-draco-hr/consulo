{
  final Map<VirtualFile,List<HgTagBranch>> branchesForRepos=new HashMap<VirtualFile,List<HgTagBranch>>();
  new Task.Backgroundable(project,"Collecting information..."){
    @Override public void run(    @NotNull ProgressIndicator indicator){
      for (      final VirtualFile repo : repos) {
        new HgTagBranchCommand(project,repo).listBranches(new Consumer<List<HgTagBranch>>(){
          @Override public void consume(          final List<HgTagBranch> branches){
            branchesForRepos.put(repo,branches);
          }
        }
);
      }
    }
    @Override public void onSuccess(){
      successHandler.consume(branchesForRepos);
    }
  }
.queue();
}
