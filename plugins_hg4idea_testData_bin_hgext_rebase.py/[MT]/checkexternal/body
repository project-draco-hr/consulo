def checkexternal(repo, state, targetancestors):
    'Check whether one or more external revisions need to be taken in\n    consideration. In the latter case, abort.\n    '
    external = nullrev
    source = min(state)
    for rev in state:
        if (rev == source):
            continue
        for p in repo[rev].parents():
            if ((p.rev() not in state) and (p.rev() not in targetancestors)):
                if (external != nullrev):
                    raise util.Abort(_('unable to collapse, there is more than one external parent'))
                external = p.rev()
    return external
