def storestatus(repo, originalwd, target, state, collapse, keep, keepbranches, external):
    'Store the current status to allow recovery'
    f = repo.opener('rebasestate', 'w')
    f.write((repo[originalwd].hex() + '\n'))
    f.write((repo[target].hex() + '\n'))
    f.write((repo[external].hex() + '\n'))
    f.write(('%d\n' % int(collapse)))
    f.write(('%d\n' % int(keep)))
    f.write(('%d\n' % int(keepbranches)))
    for (d, v) in state.iteritems():
        oldrev = repo[d].hex()
        newrev = repo[v].hex()
        f.write(('%s:%s\n' % (oldrev, newrev)))
    f.close()
    repo.ui.debug('rebase status stored\n')
