def rebasenode(repo, rev, p1, p2, state):
    'Rebase a single revision'
    if (repo['.'].rev() != repo[p1].rev()):
        repo.ui.debug((' update to %d:%s\n' % (repo[p1].rev(), repo[p1])))
        merge.update(repo, p1, False, True, False)
    else:
        repo.ui.debug(' already in target\n')
    repo.dirstate.write()
    repo.ui.debug((' merge against %d:%s\n' % (repo[rev].rev(), repo[rev])))
    first = (repo[rev].rev() == repo[min(state)].rev())
    stats = rebasemerge(repo, rev, first)
    return stats
