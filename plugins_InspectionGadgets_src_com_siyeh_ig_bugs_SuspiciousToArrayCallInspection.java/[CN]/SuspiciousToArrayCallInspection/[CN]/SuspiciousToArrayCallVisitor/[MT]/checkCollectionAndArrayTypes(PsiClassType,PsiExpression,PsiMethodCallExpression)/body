{
  final PsiType argumentType=argument.getType();
  if (!(argumentType instanceof PsiArrayType)) {
    return;
  }
  final PsiArrayType arrayType=(PsiArrayType)argumentType;
  if (collectionType.hasParameters()) {
    final PsiType[] parameters=collectionType.getParameters();
    if (parameters.length != 1) {
      return;
    }
    final PsiType parameter=parameters[0];
    final PsiType type;
    final PsiType componentType=arrayType.getComponentType();
    if (parameter instanceof PsiWildcardType) {
      final PsiWildcardType wildcardType=(PsiWildcardType)parameter;
      type=wildcardType.getBound();
    }
 else     if (parameter instanceof PsiClassType) {
      final PsiClassType classType=(PsiClassType)parameter;
      final String classTypeText=classType.getCanonicalText();
      final String componentTypeText=componentType.getCanonicalText();
      type=classType.rawType();
      if (!type.equals(componentType) && !classTypeText.equals(componentTypeText)) {
        registerError(argument,classType);
      }
      return;
    }
 else {
      type=parameter;
    }
    if (!type.equals(componentType)) {
      registerError(argument,type);
    }
  }
 else {
    final PsiElement parent=expression.getParent();
    if (!(parent instanceof PsiTypeCastExpression)) {
      return;
    }
    final PsiTypeCastExpression castExpression=(PsiTypeCastExpression)parent;
    final PsiTypeElement castTypeElement=castExpression.getCastType();
    if (castTypeElement == null) {
      return;
    }
    final PsiType castType=castTypeElement.getType();
    if (!castType.equals(arrayType)) {
      registerError(argument,arrayType.getComponentType());
    }
  }
}
