{
  final PsiReference reference=file.findReferenceAt(editor.getCaretModel().getOffset());
  if (!(reference instanceof PsiJavaCodeReferenceElement))   return false;
  @NonNls final String referenceName=((PsiJavaCodeReferenceElement)reference).getReferenceName();
  if (referenceName == null)   return false;
  final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  final VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile == null)   return false;
  if (fileIndex.getModuleForFile(virtualFile) == null)   return false;
  if (!(((PsiJavaCodeReferenceElement)reference).getParent() instanceof PsiAnnotation && PsiUtil.getLanguageLevel(((PsiJavaCodeReferenceElement)reference)).compareTo(LanguageLevel.JDK_1_5) >= 0))   return false;
  if (!isTestNGAnnotationName(referenceName))   return false;
  return true;
}
