{
  final PsiElement atCaret=super.getStatementAtCaret(editor,psiFile);
  if (atCaret instanceof PsiWhiteSpace)   return null;
  if (atCaret == null)   return null;
  GrCodeBlock codeBlock=PsiTreeUtil.getParentOfType(atCaret,GrCodeBlock.class,false,GrControlStatement.class);
  if (codeBlock instanceof GrClosableBlock && "{}".equals(codeBlock.getText())) {
    codeBlock=PsiTreeUtil.getParentOfType(codeBlock,GrCodeBlock.class,true,GrControlStatement.class);
  }
  if (codeBlock != null) {
    for (    GrStatement statement : codeBlock.getStatements()) {
      if (PsiTreeUtil.isAncestor(statement,atCaret,true)) {
        return statement;
      }
    }
  }
  PsiElement statementAtCaret=PsiTreeUtil.getParentOfType(atCaret,GrStatement.class,GrCodeBlock.class,PsiMember.class,GrDocComment.class);
  if (statementAtCaret instanceof GrBlockStatement)   return null;
  if (statementAtCaret == null)   return null;
  GrControlStatement controlStatement=PsiTreeUtil.getParentOfType(statementAtCaret,GrControlStatement.class,false);
  if (controlStatement != null && !PsiTreeUtil.hasErrorElements(statementAtCaret)) {
    return controlStatement;
  }
  return statementAtCaret instanceof GrStatement || statementAtCaret instanceof GrMember ? statementAtCaret : null;
}
