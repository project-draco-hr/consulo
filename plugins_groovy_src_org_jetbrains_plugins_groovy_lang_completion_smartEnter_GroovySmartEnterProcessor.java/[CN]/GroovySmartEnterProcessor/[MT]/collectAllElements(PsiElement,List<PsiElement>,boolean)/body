{
  res.add(0,atCaret);
  if (doNotStepInto(atCaret)) {
    if (!recurse)     return;
    recurse=false;
  }
  if (atCaret instanceof GrClosableBlock && atCaret.getParent() instanceof GrString) {
    res.add(atCaret.getParent());
  }
  if (atCaret.getParent() instanceof GrArgumentList) {
    res.add(atCaret.getParent().getParent());
  }
  final PsiElement[] children=getChildren(atCaret);
  for (  PsiElement child : children) {
    if (atCaret instanceof GrStatement && child instanceof GrStatement)     continue;
    collectAllElements(child,res,recurse);
  }
}
