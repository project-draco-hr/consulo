{
  final Project project=context.getProject();
  ExcludedEntriesConfiguration configuration=((CompilerConfigurationImpl)CompilerConfiguration.getInstance(project)).getExcludedEntriesConfiguration();
  Set<ExcludeEntryDescription> addedEntries=new HashSet<ExcludeEntryDescription>();
  for (  Module module : ModuleManager.getInstance(project).getModules()) {
    AndroidFacet facet=AndroidFacet.getInstance(module);
    if (facet == null) {
      continue;
    }
    final AndroidPlatform platform=facet.getConfiguration().getAndroidPlatform();
    final int platformToolsRevision=platform != null ? platform.getSdk().getPlatformToolsRevision() : -1;
    if (platformToolsRevision >= 0 && platformToolsRevision <= 7) {
      if (facet.getConfiguration().LIBRARY_PROJECT) {
        excludeAllSourceRoots(module,configuration,addedEntries);
      }
    }
  }
  if (addedEntries.size() > 0) {
    CompilerManager.getInstance(project).addCompilationStatusListener(new MyCompilationStatusListener(project,addedEntries),project);
  }
  return true;
}
