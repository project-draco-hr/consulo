{
  final String type=uiComponent.getType();
  Factory factory=ourMap.get(type);
  if (factory == null) {
    Window.alert("Type " + type + " is not resolved");
    return null;
  }
  final InternalGwtComponent widget=factory.create();
  ourCache.put(uiComponent.getId(),widget);
  final Map<String,String> variables=uiComponent.getVariables();
  if (widget instanceof InternalGwtComponentWithChildren) {
    final List<UIComponent.Child> children=uiComponent.getChildren();
    ((InternalGwtComponentWithChildren)widget).addChildren(proxy,children == null ? Collections.<UIComponent.Child>emptyList() : children);
  }
  final Map<String,String> map=variables == null ? Collections.<String,String>emptyMap() : variables;
  DefaultVariables.updateState(map,widget);
  widget.updateState(map);
  if (widget instanceof InternalGwtComponentWithListeners) {
    ((InternalGwtComponentWithListeners)widget).setupListeners(proxy,uiComponent.getId());
  }
  return widget;
}
