{
  if (!(c instanceof JComponent))   return;
  JComponent comp=(JComponent)c;
  Window wnd=SwingUtilities.getWindowAncestor(comp);
  if (wnd == null)   return;
  if (!wnd.isActive()) {
    if (JBPopupFactory.getInstance().isChildPopupFocused(wnd))     return;
  }
  String tooltipText=comp.getToolTipText(me);
  if (tooltipText == null || tooltipText.trim().isEmpty())   return;
  boolean centerDefault=Boolean.TRUE.equals(comp.getClientProperty(UIUtil.CENTER_TOOLTIP_DEFAULT));
  boolean centerStrict=Boolean.TRUE.equals(comp.getClientProperty(UIUtil.CENTER_TOOLTIP_STRICT));
  int shift=centerStrict ? 0 : centerDefault ? 4 : 0;
  if (c instanceof JTree) {
    TreePath path=((JTree)c).getClosestPathForLocation(me.getX(),me.getY());
    if (path != null) {
      Rectangle pathBounds=((JTree)c).getPathBounds(path);
      if (pathBounds != null && pathBounds.y + 4 < me.getY()) {
        shift+=me.getY() - pathBounds.y - 4;
      }
    }
  }
  queueShow(comp,me,centerStrict || centerDefault,shift,-shift,-shift);
}
