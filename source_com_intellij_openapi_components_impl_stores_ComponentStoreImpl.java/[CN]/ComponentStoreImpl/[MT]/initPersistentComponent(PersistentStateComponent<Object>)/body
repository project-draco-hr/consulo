{
  final String name=getComponentName(component);
  myComponents.put(name,component);
  if (optimizeTestLoading())   return;
  Object state=null;
  final StateStorage defaultsStorage=getDefaultsStorage();
  if (defaultsStorage != null) {
    try {
      final org.w3c.dom.Element defaultState=defaultsStorage.getState(component,name);
      if (defaultState != null) {
        Class stateClass=getComponentStateClass(component);
        state=XmlSerializer.deserialize(defaultState,stateClass);
      }
    }
 catch (    StateStorage.StateStorageException e) {
      LOG.error(e);
    }
  }
  try {
    Storage storageSpec=getComponentStorage(component);
    StateStorage stateStorage=getStateStorage(storageSpec);
    if (stateStorage == null)     return;
    org.w3c.dom.Element elementState=stateStorage.getState(component,name);
    if (elementState != null) {
      Class stateClass=getComponentStateClass(component);
      if (state == null) {
        state=XmlSerializer.deserialize(elementState,stateClass);
      }
 else {
        XmlSerializer.deserializeInto(state,elementState);
      }
    }
  }
 catch (  StateStorage.StateStorageException e) {
    LOG.error(e);
  }
catch (  Throwable e) {
    LOG.error(e);
  }
  if (state != null) {
    component.loadState(state);
  }
}
