{
  if (getTextEditor().isFocusOwner() && !myDelegatingNow) {
    try {
      myDelegatingNow=true;
      final KeyStroke stroke=KeyStroke.getKeyStrokeForEvent(e);
      boolean treeNavigation=stroke.getModifiers() == 0 && (stroke.getKeyCode() == KeyEvent.VK_UP || stroke.getKeyCode() == KeyEvent.VK_DOWN);
      final Object action=getTextEditor().getInputMap().get(stroke);
      if (action == null || treeNavigation) {
        onTextKeyEvent(e);
        return true;
      }
    }
  finally {
      myDelegatingNow=false;
    }
  }
  return false;
}
