{
  final KeyStroke stroke=KeyStroke.getKeyStrokeForEvent(e);
  if (!myDelegatingNow) {
    if ("pressed ESCAPE".equals(stroke.toString()) && getText().length() > 0) {
      setText("");
      return true;
    }
    if (getTextEditor().isFocusOwner()) {
      try {
        myDelegatingNow=true;
        boolean treeNavigation=stroke.getModifiers() == 0 && (stroke.getKeyCode() == KeyEvent.VK_UP || stroke.getKeyCode() == KeyEvent.VK_DOWN);
        if ("pressed ENTER".equals(stroke.toString())) {
          return true;
        }
        final Object action=getTextEditor().getInputMap().get(stroke);
        if (action == null || treeNavigation) {
          onTextKeyEvent(e);
          return true;
        }
      }
  finally {
        myDelegatingNow=false;
      }
    }
  }
  return false;
}
