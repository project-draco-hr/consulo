{
  myProject=project;
  myGroups=groups;
  myProperties=PropertiesComponent.getInstance(project);
  myFilter=new Filter();
  myContext=new OptionsEditorContext(myFilter);
  mySearch=new MySearchField(){
    @Override protected void onTextKeyEvent(    final KeyEvent e){
      myTree.processTextEvent(e);
    }
  }
;
  mySearch.getTextEditor().addMouseListener(new MouseAdapter(){
    @Override public void mousePressed(    MouseEvent e){
      boolean hasText=mySearch.getText().length() > 0;
      if (!myContext.isHoldingFilter() && hasText) {
        myFilter.reenable();
      }
      if (!isSearchFieldFocused() && hasText) {
        mySearch.selectText();
      }
    }
  }
);
  myTree=new OptionsTree(myProject,groups,getContext()){
    @Override protected void onTreeKeyEvent(    final KeyEvent e){
      myFilterFocumentWasChanged=false;
      try {
        mySearch.keyEventToTextField(e);
      }
  finally {
        if (myFilterFocumentWasChanged && !isFilterFieldVisible()) {
          setFilterFieldVisible(true,false,false);
        }
      }
    }
  }
;
  getContext().addColleague(myTree);
  Disposer.register(this,myTree);
  mySearch.addDocumentListener(new DocumentListener(){
    public void insertUpdate(    final DocumentEvent e){
      myFilter.update(e.getType(),true,false);
    }
    public void removeUpdate(    final DocumentEvent e){
      myFilter.update(e.getType(),true,false);
    }
    public void changedUpdate(    final DocumentEvent e){
      myFilter.update(e.getType(),true,false);
    }
  }
);
  myLeftSide=new JPanel(new BorderLayout());
  myLeftSide.add(mySearchWrapper,BorderLayout.NORTH);
  myLeftSide.add(myTree,BorderLayout.CENTER);
  setLayout(new BorderLayout());
  myMainSplitter=new Splitter(false);
  myMainSplitter.setFirstComponent(myLeftSide);
  myMainSplitter.setHonorComponentsMinimumSize(false);
  myLoadingDecorator=new LoadingDecorator(myOwnDetails.getComponent(),this,150);
  myMainSplitter.setSecondComponent(myLoadingDecorator.getComponent());
  myMainSplitter.setProportion(readProportion(0.3f,MAIN_SPLITTER_PROPORTION));
  myContentWrapper.mySplitter.setProportion(readProportion(0.2f,DETAILS_SPLITTER_PROPORTION));
  add(myMainSplitter,BorderLayout.CENTER);
  MyColleague colleague=new MyColleague();
  getContext().addColleague(colleague);
  if (preselectedConfigurable != null) {
    myTree.select(preselectedConfigurable);
  }
 else {
    myTree.selectFirst();
  }
  Toolkit.getDefaultToolkit().addAWTEventListener(this,AWTEvent.MOUSE_EVENT_MASK | AWTEvent.KEY_EVENT_MASK | AWTEvent.MOUSE_MOTION_EVENT_MASK);
  ActionManager.getInstance().addAnActionListener(new AnActionListener(){
    @Override public void beforeActionPerformed(    AnAction action,    DataContext dataContext,    AnActionEvent event){
    }
    @Override public void afterActionPerformed(    AnAction action,    DataContext dataContext,    AnActionEvent event){
      queueModificationCheck();
    }
    @Override public void beforeEditorTyping(    char c,    DataContext dataContext){
    }
  }
,this);
  myModificationChecker=new MergingUpdateQueue("OptionsModificationChecker",1000,false,this,this,this);
  mySpotlightUpdate=new MergingUpdateQueue("OptionsSpotlight",200,false,this,this,this);
  IdeGlassPaneUtil.installPainter(myOwnDetails.getContentGutter(),mySpotlightPainter,this);
  setFilterFieldVisible(true,false,false);
  new UiNotifyConnector.Once(this,new Activatable(){
    public void showNotify(){
      myWindow=SwingUtilities.getWindowAncestor(OptionsEditor.this);
    }
    public void hideNotify(){
    }
  }
);
}
