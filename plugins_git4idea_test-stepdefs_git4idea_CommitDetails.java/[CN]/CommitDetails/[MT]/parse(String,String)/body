{
  CommitDetails commit=new CommitDetails();
  commit.myHash=hash;
  StringBuilder message=new StringBuilder();
  Collection<Change> changes=new ArrayList<Change>();
  ParsingStage stage=ParsingStage.MESSAGE;
  for (  String line : details.split("\n")) {
    Pair<Data,String> data=checkDataLine(line);
    if (data != null) {
      stage=ParsingStage.DATA;
    }
 else     if (line.matches("[MADR]\\d* [^ ]+ .+")) {
      stage=ParsingStage.CHANGES;
    }
    if (stage == ParsingStage.MESSAGE) {
      message.append(line);
    }
 else     if (stage == ParsingStage.CHANGES) {
      changes.add(parseChange(line));
    }
 else     if (data != null) {
      data.getFirst().apply(commit,data.getSecond());
    }
  }
  commit.myMessage=message.toString();
  commit.myChanges=changes;
  return commit;
}
