{
  if (changes.isEmpty()) {
    return;
  }
  int diff=0;
  for (  TextChangeImpl change : changes) {
    diff+=change.getDiff();
  }
  if (length + diff > data.length) {
    throw new IllegalArgumentException(String.format("Can't perform in-place changes merge. Reason: data array is not big enough to hold resulting text. Current size: %d, " + "minimum size: %d",data.length,length + diff));
  }
  try {
    for (Context context=new Context(changes,data,length,length + diff); !context.isComplete(); ) {
      if (!context.startGroup()) {
        return;
      }
      context.endGroup();
    }
  }
 catch (  RuntimeException e) {
    StringBuilder changesDescription=new StringBuilder();
    for (    TextChangeImpl change : changes) {
      changesDescription.append(change.getText().length()).append(":").append(change.getStart()).append("-").append(change.getEnd()).append(",");
    }
    if (changesDescription.length() > 0) {
      changesDescription.setLength(changesDescription.length() - 1);
    }
    LOG.error(String.format("Invalid attempt to perform in-place document changes merge detected. Initial text length: %d, data array length: %d, " + "changes: [%s], changes diff: %d",length,data.length,changesDescription,diff),e);
    char[] merged=mergeToCharArray(data,length,changes);
    System.arraycopy(merged,0,data,0,length + diff);
  }
}
