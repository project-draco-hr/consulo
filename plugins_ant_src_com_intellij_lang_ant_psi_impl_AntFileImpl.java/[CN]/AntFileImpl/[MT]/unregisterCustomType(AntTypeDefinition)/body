{
synchronized (PsiLock.LOCK) {
    if (myTypeDefinitions != null) {
      removeTypeDefinition(def);
    }
    if (myProjectElements != null) {
      final String registeredClassName=myProjectElements.get(def.getTypeId());
      if (registeredClassName != null && registeredClassName.equals(def.getClassName())) {
        myProjectElements.remove(def.getTypeId());
      }
    }
    if (myTargetDefinition != null && myTargetDefinition != def) {
      myTargetDefinition.unregisterNestedType(def.getTypeId());
    }
  }
}
