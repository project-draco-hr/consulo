{
  final XmlFile xmlFile=getSourceElement();
  final AntBuildFileImpl buildFile=(AntBuildFileImpl)AntConfigurationBase.getInstance(xmlFile.getProject()).getAntBuildFile(xmlFile);
  if (buildFile != null) {
    final AntInstallation assignedInstallation=AntBuildFileImpl.ANT_INSTALLATION.get(buildFile.getAllOptions());
    if (assignedInstallation != null) {
      return assignedInstallation;
    }
  }
  final AntConfigurationBase configuration=AntConfigurationBase.getInstance(getProject());
  if (configuration != null) {
    final AntInstallation projectDefaultInstallation=configuration.getProjectDefaultAnt();
    if (projectDefaultInstallation != null) {
      return projectDefaultInstallation;
    }
  }
  return GlobalAntConfiguration.getInstance().getBundledAnt();
}
