{
synchronized (PsiLock.LOCK) {
    final AntFileImpl copy=new AntFileImpl(viewProvider);
    final HashMap<String,AntTypeDefinition> defs=new HashMap<String,AntTypeDefinition>(myTypeDefinitions);
    for (    Map.Entry<String,AntTypeDefinition> entry : defs.entrySet()) {
      final AntTypeDefinitionImpl original=(AntTypeDefinitionImpl)entry.getValue();
      if (original != null) {
        defs.put(entry.getKey(),new AntTypeDefinitionImpl(original));
      }
    }
    copy.myTypeDefinitions=defs;
    copy.myProjectElements=new HashMap<AntTypeId,String>(myProjectElements);
    copy.myClassLoader=myClassLoader;
    copy.myExternalProperties=myExternalProperties != null ? new HashMap<String,String>(myExternalProperties) : null;
    return copy;
  }
}
