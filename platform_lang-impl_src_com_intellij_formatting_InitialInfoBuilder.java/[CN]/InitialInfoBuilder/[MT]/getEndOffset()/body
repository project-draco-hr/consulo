{
  int maxDocOffset=myModel.getTextLength();
  int maxOffset=myRootBlockWrapper != null ? myRootBlockWrapper.getEndOffset() : 0;
  if (myAffectedRanges != null) {
    for (    FormatTextRanges.FormatTextRange range : myAffectedRanges.getRanges()) {
      if (range.getTextRange().getEndOffset() > maxOffset)       maxOffset=range.getTextRange().getEndOffset();
    }
  }
  return maxOffset < maxDocOffset ? maxOffset : maxDocOffset;
}
