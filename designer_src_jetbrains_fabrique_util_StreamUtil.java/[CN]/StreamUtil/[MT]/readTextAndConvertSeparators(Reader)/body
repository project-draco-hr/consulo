{
  char[] buffer=readText(reader);
  int dst=0;
  char prev=' ';
  for (int src=0; src < buffer.length; src++) {
    char c=buffer[src];
switch (c) {
case '\r':
      buffer[dst++]='\n';
    break;
case '\n':
  if (prev != '\r') {
    buffer[dst++]='\n';
  }
break;
default :
buffer[dst++]=c;
break;
}
prev=c;
}
char chars[]=new char[dst];
System.arraycopy(buffer,0,chars,0,chars.length);
return chars;
}
