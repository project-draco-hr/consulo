{
  final AntStructuredElement element=getElement();
  final AntTypeDefinition typeDef=element.getTypeDefinition();
  if (typeDef == null)   return element;
  if (!(element instanceof AntTask)) {
    final AntStructuredElement definingElement=(AntStructuredElement)typeDef.getDefiningElement();
    if (definingElement != null && definingElement.getParent() instanceof AntMacroDef && "element".equals(definingElement.getSourceElement().getName())) {
      element.getSourceElement().setName(newElementName);
    }
  }
 else {
    AntTask task=(AntTask)element;
    if (task.isMacroDefined()) {
      final XmlAttribute attr=getAttribute();
      if (attr == null) {
        task.getSourceElement().setName(newElementName);
      }
 else {
        attr.setName(newElementName);
      }
    }
  }
  return element;
}
