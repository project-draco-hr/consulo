{
  if (!settings.USE_PPK) {
    SSHPasswordProviderImpl sshPasswordProvider=SSHPasswordProviderImpl.getInstance();
    String password=sshPasswordProvider.getPasswordForCvsRoot(cvsRoot);
    if (password == null) {
      SshPasswordDialog sshPasswordDialog=new SshPasswordDialog(CvsBundle.message("prompt.text.enter.password.for.cvs.root",cvsRoot));
      sshPasswordDialog.show();
      if (!sshPasswordDialog.isOK())       return false;
      password=sshPasswordDialog.getPassword();
      sshPasswordProvider.storePasswordForCvsRoot(cvsRoot,password,sshPasswordDialog.saveThisPassword());
    }
    if (password == null)     return false;
  }
 else {
    SSHPasswordProviderImpl sshPasswordProvider=SSHPasswordProviderImpl.getInstance();
    String password=sshPasswordProvider.getPPKPasswordForCvsRoot(cvsRoot);
    if (password == null) {
      SshPasswordDialog sshPasswordDialog=new SshPasswordDialog(CvsBundle.message("prompt.text.enter.private.key.password.for",cvsRoot));
      sshPasswordDialog.setAdditionalText(CvsBundle.message("prompt.path.to.private.key",settings.PATH_TO_PPK));
      sshPasswordDialog.show();
      if (!sshPasswordDialog.isOK())       return false;
      password=sshPasswordDialog.getPassword();
      sshPasswordProvider.storePPKPasswordForCvsRoot(cvsRoot,password,sshPasswordDialog.saveThisPassword());
    }
    if (password == null)     return false;
  }
  return true;
}
