{
  MavenEmbedder embedder=MavenEmbedderFactory.createEmbedderForResolve(coreSettings,this);
  try {
    List<MavenProjectModel> projects=getProjects();
    List<Artifact> allArtifacts=new ArrayList<Artifact>();
    for (    MavenProjectModel each : projects) {
      p.checkCanceled();
      p.setText(ProjectBundle.message("maven.resolving.pom",FileUtil.toSystemDependentName(each.getPath())));
      p.setText2("");
      each.resolve(embedder);
    }
    for (    MavenProjectModel each : projects) {
      p.checkCanceled();
      p.setText(ProjectBundle.message("maven.generating.sources.pom",FileUtil.toSystemDependentName(each.getPath())));
      p.setText2("");
      each.generateSources(embedder);
    }
    refreshResolvedArtifacts(allArtifacts);
    MavenArtifactDownloader d=new MavenArtifactDownloader(artifactSettings,embedder,p);
    d.download(project,projects,false);
  }
  finally {
    MavenEmbedderFactory.releaseEmbedder(embedder);
  }
}
