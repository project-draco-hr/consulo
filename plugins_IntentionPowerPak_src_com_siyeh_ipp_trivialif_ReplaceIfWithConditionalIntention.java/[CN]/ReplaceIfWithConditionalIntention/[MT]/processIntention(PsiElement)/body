{
  final PsiIfStatement ifStatement=(PsiIfStatement)element.getParent();
  if (ifStatement == null) {
    return;
  }
  if (ReplaceIfWithConditionalPredicate.isReplaceableAssignment(ifStatement)) {
    final PsiExpression condition=ifStatement.getCondition();
    if (condition == null) {
      return;
    }
    final PsiStatement thenBranch=ifStatement.getThenBranch();
    final PsiExpressionStatement strippedThenBranch=(PsiExpressionStatement)ConditionalUtils.stripBraces(thenBranch);
    final PsiStatement elseBranch=ifStatement.getElseBranch();
    final PsiExpressionStatement strippedElseBranch=(PsiExpressionStatement)ConditionalUtils.stripBraces(elseBranch);
    final PsiAssignmentExpression thenAssign=(PsiAssignmentExpression)strippedThenBranch.getExpression();
    final PsiAssignmentExpression elseAssign=(PsiAssignmentExpression)strippedElseBranch.getExpression();
    final PsiExpression lhs=thenAssign.getLExpression();
    final String lhsText=lhs.getText();
    final PsiJavaToken sign=thenAssign.getOperationSign();
    final String operator=sign.getText();
    final PsiExpression thenRhs=thenAssign.getRExpression();
    if (thenRhs == null) {
      return;
    }
    final PsiExpression elseRhs=elseAssign.getRExpression();
    if (elseRhs == null) {
      return;
    }
    final String conditional=getConditionalText(condition,thenRhs,elseRhs,thenAssign.getType());
    replaceStatement(lhsText + operator + conditional+ ';',ifStatement);
  }
 else   if (ReplaceIfWithConditionalPredicate.isReplaceableReturn(ifStatement)) {
    final PsiExpression condition=ifStatement.getCondition();
    if (condition == null) {
      return;
    }
    final PsiStatement thenBranch=ifStatement.getThenBranch();
    final PsiReturnStatement thenReturn=(PsiReturnStatement)ConditionalUtils.stripBraces(thenBranch);
    final PsiStatement elseBranch=ifStatement.getElseBranch();
    final PsiReturnStatement elseReturn=(PsiReturnStatement)ConditionalUtils.stripBraces(elseBranch);
    final PsiExpression thenReturnValue=thenReturn.getReturnValue();
    if (thenReturnValue == null) {
      return;
    }
    final PsiExpression elseReturnValue=elseReturn.getReturnValue();
    if (elseReturnValue == null) {
      return;
    }
    final PsiMethod method=PsiTreeUtil.getParentOfType(thenReturn,PsiMethod.class);
    if (method == null) {
      return;
    }
    final PsiType returnType=method.getReturnType();
    final String conditional=getConditionalText(condition,thenReturnValue,elseReturnValue,returnType);
    replaceStatement("return " + conditional + ';',ifStatement);
  }
 else   if (ReplaceIfWithConditionalPredicate.isReplaceableImplicitReturn(ifStatement)) {
    final PsiExpression condition=ifStatement.getCondition();
    if (condition == null) {
      return;
    }
    final PsiStatement rawThenBranch=ifStatement.getThenBranch();
    final PsiReturnStatement thenBranch=(PsiReturnStatement)ConditionalUtils.stripBraces(rawThenBranch);
    final PsiExpression thenReturnValue=thenBranch.getReturnValue();
    if (thenReturnValue == null) {
      return;
    }
    final PsiReturnStatement elseBranch=PsiTreeUtil.getNextSiblingOfType(ifStatement,PsiReturnStatement.class);
    if (elseBranch == null) {
      return;
    }
    final PsiExpression elseReturnValue=elseBranch.getReturnValue();
    if (elseReturnValue == null) {
      return;
    }
    final PsiMethod method=PsiTreeUtil.getParentOfType(thenBranch,PsiMethod.class);
    if (method == null) {
      return;
    }
    final PsiType methodType=method.getReturnType();
    final String conditional=getConditionalText(condition,thenReturnValue,elseReturnValue,methodType);
    if (conditional == null) {
      return;
    }
    replaceStatement("return " + conditional + ';',ifStatement);
    elseBranch.delete();
  }
}
