{
  try {
    VcsLogProvider provider=dataHolder.getLogProvider(root);
    if (graph != null && refs != null && VcsLogProperties.get(provider,VcsLogProperties.LIGHTWEIGHT_BRANCHES)) {
      Set<Integer> branchesIndexes=graph.getContainingBranches(dataHolder.getCommitIndex(hash));
      Collection<VcsRef> branchesRefs=new HashSet<VcsRef>();
      for (      Integer index : branchesIndexes) {
        branchesRefs.addAll(refs.refsToCommit(index));
      }
      branchesRefs=ContainerUtil.sorted(branchesRefs,provider.getReferenceManager().getLabelsOrderComparator());
      ArrayList<String> branchesList=new ArrayList<String>();
      for (      VcsRef ref : branchesRefs) {
        if (ref.getType().isBranch()) {
          branchesList.add(ref.getName());
        }
      }
      return branchesList;
    }
 else {
      List<String> branches=new ArrayList<String>(provider.getContainingBranches(root,hash));
      Collections.sort(branches);
      return branches;
    }
  }
 catch (  VcsException e) {
    LOG.warn(e);
    return Collections.emptyList();
  }
}
