{
  final Set<String> requiresRebuild=new HashSet<String>();
  final FileBasedIndexExtension[] extensions=Extensions.getExtensions(FileBasedIndexExtension.EXTENSION_POINT_NAME);
  for (  FileBasedIndexExtension extension : extensions) {
    final boolean _requiresRebuild=registerIndexer(extension.getName(),extension.getIndexer(),extension.getKeyDescriptor(),extension.getValueExternalizer(),extension.getInputFilter());
    if (_requiresRebuild) {
      requiresRebuild.add(extension.getName());
    }
  }
  dropUnregisteredIndices();
  final VirtualFileListener vfsListener=new MyVFSListener();
  vfManager.addVirtualFileListener(vfsListener);
  myDisposables.add(new Disposable(){
    public void dispose(){
      vfManager.removeVirtualFileListener(vfsListener);
    }
  }
);
  final ProjectManagerListener pmListener=new ProjectManagerAdapter(){
    public void projectOpened(    final Project project){
      StartupManager.getInstance(project).registerPostStartupActivity(new Runnable(){
        public void run(){
          scanContent(project,requiresRebuild);
        }
      }
);
    }
  }
;
  projectManager.addProjectManagerListener(pmListener);
  myDisposables.add(new Disposable(){
    public void dispose(){
      projectManager.removeProjectManagerListener(pmListener);
    }
  }
);
}
