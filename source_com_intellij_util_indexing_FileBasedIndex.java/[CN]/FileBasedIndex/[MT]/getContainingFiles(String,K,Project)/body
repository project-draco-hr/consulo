{
  final AbstractIndex<K,?> index=getIndex(indexId);
  if (index == null) {
    return Collections.emptyList();
  }
  final Set<Integer> files=new HashSet<Integer>();
  final DirectoryIndex dirIndex=project != null ? DirectoryIndex.getInstance(project) : null;
  final PersistentFS fs=(PersistentFS)PersistentFS.getInstance();
  final ValueContainer container=index.getData(dataKey);
  for (Iterator it=container.getValueIterator(); it.hasNext(); ) {
    final Object value=it.next();
    if (dirIndex == null || belongsToProject(container.getInputIdsIterator(value),dirIndex,fs)) {
      for (final ValueContainer.IntIterator idIt=container.getInputIdsIterator(value); idIt.hasNext(); ) {
        files.add(idIt.next());
      }
    }
  }
  return files;
}
