{
  indexUnsavedDocuments();
  final AbstractIndex<K,V> index=getIndex(indexId);
  if (index == null) {
    return Collections.emptyList();
  }
  final ValueContainer<V> container=index.getData(dataKey);
  final List<V> valueList=container.toValueList();
  if (project != null) {
    final DirectoryIndex dirIndex=DirectoryIndex.getInstance(project);
    final PersistentFS fs=(PersistentFS)PersistentFS.getInstance();
    for (Iterator<V> it=valueList.iterator(); it.hasNext(); ) {
      final V value=it.next();
      if (!belongsToProject(container.getInputIdsIterator(value),dirIndex,fs)) {
        it.remove();
      }
    }
  }
  return valueList;
}
