{
  if (!compileRequest.hasProjectId()) {
    return ProtoUtil.toMessage(sessionId,ProtoUtil.createFailure("No project specified"));
  }
  final String projectId=compileRequest.getProjectId();
  final JpsRemoteProto.Message.Request.CompilationRequest.Type compileType=compileRequest.getCommandType();
switch (compileType) {
case CLEAN:
case MAKE:
case FORCED_COMPILATION:
case REBUILD:
{
      final CompilationTask task=new CompilationTask(sessionId,channelContext,projectId,compileRequest.getModuleNameList());
      if (myBuildsInProgress.putIfAbsent(projectId,task) == null) {
        task.getBuildParams().buildType=convertCompileType(compileType);
        task.getBuildParams().useInProcessJavac=true;
        myBuildsExecutor.submit(task);
      }
 else {
        return ProtoUtil.toMessage(sessionId,ProtoUtil.createFailure("Project is being compiled already"));
      }
      return null;
    }
default :
  return ProtoUtil.toMessage(sessionId,ProtoUtil.createFailure("Unsupported command: '" + compileType + "'"));
}
}
