{
  LOG.assertTrue(childBus.myParentBus == this);
  MessageBusImpl lastChild=myChildBuses.isEmpty() ? null : myChildBuses.get(myChildBuses.size() - 1);
  myChildBuses.add(childBus);
  getRootBus().clearSubscriberCache();
  int lastChildIndex=lastChild == null ? 0 : lastChild.myOrder.get(lastChild.myOrder.size() - 1);
  if (lastChildIndex == Integer.MAX_VALUE) {
    LOG.error("Too many child buses");
  }
  List<Integer> childOrder=new ArrayList<Integer>(myOrder.size() + 1);
  childOrder.addAll(myOrder);
  childOrder.add(lastChildIndex + 1);
  return childOrder;
}
