{
  Object value=expression.getValue();
  if (!(value instanceof String))   return;
  String key=(String)value;
  if (isComputablePropertyExpression(expression))   return;
  Ref<String> resourceBundleName=new Ref<String>();
  if (!JavaI18nUtil.isValidPropertyReference(expression,key,resourceBundleName)) {
    final String description=CodeInsightBundle.message("inspection.unresolved.property.key.reference.message",key);
    final String bundleName=resourceBundleName.get();
    final List<PropertiesFile> propertiesFiles=JavaI18nUtil.propertiesFilesByBundleName(bundleName,expression);
    final ProblemDescriptor problem=myManager.createProblemDescriptor(expression,description,new JavaCreatePropertyFix(expression,key,propertiesFiles),ProblemHighlightType.LIKE_UNKNOWN_SYMBOL,onTheFly);
    myProblems.add(problem);
  }
 else   if (expression.getParent() instanceof PsiNameValuePair) {
    PsiNameValuePair nvp=(PsiNameValuePair)expression.getParent();
    if (Comparing.equal(nvp.getName(),AnnotationUtil.PROPERTY_KEY_RESOURCE_BUNDLE_PARAMETER)) {
      PropertiesReferenceManager manager=PropertiesReferenceManager.getInstance(expression.getProject());
      Module module=ModuleUtil.findModuleForPsiElement(expression);
      if (module != null) {
        List<PropertiesFile> propFiles=manager.findPropertiesFiles(module,key);
        if (propFiles.isEmpty()) {
          final String description=CodeInsightBundle.message("inspection.invalid.resource.bundle.reference",key);
          final ProblemDescriptor problem=myManager.createProblemDescriptor(expression,description,(LocalQuickFix)null,ProblemHighlightType.LIKE_UNKNOWN_SYMBOL,onTheFly);
          myProblems.add(problem);
        }
      }
    }
  }
 else   if (expression.getParent() instanceof PsiExpressionList && expression.getParent().getParent() instanceof PsiMethodCallExpression) {
    final Map<String,Object> annotationParams=new HashMap<String,Object>();
    annotationParams.put(AnnotationUtil.PROPERTY_KEY_RESOURCE_BUNDLE_PARAMETER,null);
    if (!JavaI18nUtil.mustBePropertyKey(expression,annotationParams))     return;
    final int paramsCount=JavaI18nUtil.getPropertyValueParamsMaxCount(expression);
    if (paramsCount == -1)     return;
    final PsiExpressionList expressions=(PsiExpressionList)expression.getParent();
    final PsiMethodCallExpression methodCall=(PsiMethodCallExpression)expressions.getParent();
    final PsiMethod method=methodCall.resolveMethod();
    final PsiExpression[] args=expressions.getExpressions();
    for (int i=0; i < args.length; i++) {
      if (args[i] == expression) {
        if (i + paramsCount >= args.length && method != null && method.getParameterList().getParametersCount() == i + 2 && method.getParameterList().getParameters()[i + 1].isVarArgs() && !hasArrayTypeAt(i + 1,methodCall)) {
          myProblems.add(myManager.createProblemDescriptor(methodCall,CodeInsightBundle.message("property.has.more.parameters.than.passed",key,paramsCount,args.length - i - 1),onTheFly,new LocalQuickFix[0],ProblemHighlightType.GENERIC_ERROR));
        }
        break;
      }
    }
  }
}
