{
  int totalContextLines=countContextLines();
  if (getLinesMatchingContext(lines,myStartLineBefore - 1) == totalContextLines) {
    return myStartLineBefore - 1;
  }
  int maxContextStartLine=-1;
  int maxContextLines=0;
  for (int i=0; i < lines.size(); i++) {
    int contextLines=getLinesMatchingContext(lines,i);
    if (contextLines == totalContextLines) {
      return i;
    }
    if (contextLines > maxContextLines) {
      maxContextLines=contextLines;
      maxContextStartLine=i;
    }
  }
  if (maxContextLines < 2) {
    throw new ApplyPatchException("couldn't find context");
  }
  return maxContextStartLine;
}
