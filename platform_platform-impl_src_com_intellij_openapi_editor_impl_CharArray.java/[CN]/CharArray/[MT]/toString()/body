{
  String str=myStringRef != null ? myStringRef.get() : null;
  if (str == null) {
    if (myOriginalSequence != null) {
      str=myOriginalSequence.toString();
    }
 else     if (!hasDeferredChanges()) {
      str=new String(myArray,0,myCount);
    }
 else {
      StringBuilder buffer=new StringBuilder();
      int start=0;
      int count=myCount + myDeferredShift;
      for (      TextChange change : myDeferredChangesStorage.getChanges()) {
        final int length=change.getStart() - start;
        if (length > 0) {
          buffer.append(myArray,start,length);
          count-=length;
        }
        if (change.getText().length() > 0) {
          buffer.append(change.getText());
          count-=change.getText().length();
        }
        start=change.getEnd();
      }
      buffer.append(myArray,start,count);
      str=buffer.toString();
    }
    myStringRef=new SoftReference<String>(str);
  }
  return str;
}
