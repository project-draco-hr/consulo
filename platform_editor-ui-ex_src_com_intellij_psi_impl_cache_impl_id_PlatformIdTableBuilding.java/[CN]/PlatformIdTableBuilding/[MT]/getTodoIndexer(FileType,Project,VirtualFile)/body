{
  final DataIndexer<TodoIndexEntry,Integer,FileContent> indexer=ourTodoIndexers.get(fileType);
  if (indexer != null) {
    return indexer;
  }
  final DataIndexer<TodoIndexEntry,Integer,FileContent> extIndexer;
  if (fileType instanceof SubstitutedFileType && !((SubstitutedFileType)fileType).isSameFileType()) {
    SubstitutedFileType sft=(SubstitutedFileType)fileType;
    extIndexer=new CompositeTodoIndexer(getTodoIndexer(sft.getOriginalFileType(),project,virtualFile),getTodoIndexer(sft.getFileType(),project,virtualFile));
  }
 else {
    extIndexer=TodoIndexers.INSTANCE.forFileType(fileType);
  }
  if (extIndexer != null) {
    return extIndexer;
  }
  if (fileType instanceof LanguageFileType) {
    final Language lang=((LanguageFileType)fileType).getLanguage();
    final ParserDefinition parserDef=LanguageParserDefinitions.INSTANCE.forLanguage(lang);
    LanguageVersion<Language> languageVersion=LanguageVersionUtil.findLanguageVersion(lang,project,virtualFile);
    final TokenSet commentTokens=parserDef != null ? parserDef.getCommentTokens(languageVersion) : null;
    if (commentTokens != null) {
      return new TokenSetTodoIndexer(commentTokens,languageVersion,virtualFile,project);
    }
  }
  if (fileType instanceof CustomSyntaxTableFileType) {
    return new TokenSetTodoIndexer(ABSTRACT_FILE_COMMENT_TOKENS,null,virtualFile,project);
  }
  return null;
}
