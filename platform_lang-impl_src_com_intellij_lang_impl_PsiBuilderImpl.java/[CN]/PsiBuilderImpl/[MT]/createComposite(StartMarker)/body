{
  final IElementType type=marker.myType;
  if (type == TokenType.ERROR_ELEMENT) {
    CompositeElement childNode=new PsiErrorElementImpl();
    if (marker.myDoneMarker instanceof DoneWithErrorMarker) {
      ((PsiErrorElementImpl)childNode).setErrorDescription(((DoneWithErrorMarker)marker.myDoneMarker).myMessage);
    }
    return childNode;
  }
  if (type == null) {
    throw new RuntimeException(UNBALANCED_MESSAGE);
  }
  return ASTFactory.composite(type);
}
