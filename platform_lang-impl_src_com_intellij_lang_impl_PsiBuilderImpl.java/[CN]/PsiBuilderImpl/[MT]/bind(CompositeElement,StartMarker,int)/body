{
  ProductionMarker child=marker.firstChild;
  while (child != null) {
    if (child instanceof StartMarker) {
      final StartMarker childMarker=(StartMarker)child;
      lexIndex=insertLeafs(lexIndex,childMarker.myLexemeIndex,ast);
      if (!childMarker.myDoneMarker.myCollapse) {
        CompositeElement childNode=createComposite(childMarker);
        ast.rawAddChildren(childNode);
        lexIndex=bind(childNode,childMarker,lexIndex);
      }
 else {
        lexIndex=collapseLeafs(ast,childMarker);
      }
      lexIndex=insertLeafs(lexIndex,childMarker.myDoneMarker.myLexemeIndex,ast);
    }
 else     if (child instanceof ErrorItem) {
      lexIndex=insertLeafs(lexIndex,child.myLexemeIndex,ast);
      final PsiErrorElementImpl errorElement=new PsiErrorElementImpl();
      errorElement.setErrorDescription(((ErrorItem)child).myMessage);
      ast.rawAddChildren(errorElement);
    }
    child=child.next;
  }
  return insertLeafs(lexIndex,marker.myDoneMarker.myLexemeIndex,ast);
}
