{
  final HgVersionCommand command=new HgVersionCommand();
  final HgVcs vcs=HgVcs.getInstance(myProject);
  if (vcs == null) {
    return false;
  }
  if (command.isValid(vcs.getHgExecutable())) {
    return true;
  }
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    return false;
  }
  myValidHgExecutable=false;
  try {
    GuiUtils.runOrInvokeAndWait(new Runnable(){
      public void run(){
        String previousHgPath=globalSettings.getHgExecutable();
        HgSetExecutableDialog dialog;
        do {
          dialog=new HgSetExecutableDialog(myProject);
          dialog.setBadHgPath(previousHgPath);
          dialog.show();
          myValidHgExecutable=dialog.isOK() && command.isValid(dialog.getNewHgPath());
          previousHgPath=dialog.getNewHgPath();
        }
 while (!myValidHgExecutable && dialog.isOK());
        if (myValidHgExecutable) {
          globalSettings.setHgExecutable(dialog.getNewHgPath());
        }
      }
    }
);
  }
 catch (  InvocationTargetException e) {
    LOG.info(e);
  }
catch (  InterruptedException e) {
    LOG.info(e);
  }
  return myValidHgExecutable;
}
