{
  myModificationCount++;
  boolean changedInsideCodeBlock=false;
switch (event.getCode()) {
case PsiManagerImpl.BEFORE_CHILDREN_CHANGE:
    if (event.getParent() instanceof PsiFile) {
      changedInsideCodeBlock=true;
      break;
    }
case PsiManagerImpl.CHILDREN_CHANGED:
  changedInsideCodeBlock=isInsideCodeBlock(event.getParent());
break;
case PsiManagerImpl.BEFORE_CHILD_ADDITION:
case PsiManagerImpl.BEFORE_CHILD_REMOVAL:
case PsiManagerImpl.CHILD_ADDED:
case PsiManagerImpl.CHILD_REMOVED:
changedInsideCodeBlock=isInsideCodeBlock(event.getParent());
break;
case PsiManagerImpl.BEFORE_PROPERTY_CHANGE:
case PsiManagerImpl.PROPERTY_CHANGED:
changedInsideCodeBlock=false;
break;
case PsiManagerImpl.BEFORE_CHILD_REPLACEMENT:
case PsiManagerImpl.CHILD_REPLACED:
changedInsideCodeBlock=isInsideCodeBlock(event.getParent());
break;
case PsiManagerImpl.BEFORE_CHILD_MOVEMENT:
case PsiManagerImpl.CHILD_MOVED:
changedInsideCodeBlock=isInsideCodeBlock(event.getOldParent()) && isInsideCodeBlock(event.getNewParent());
break;
default :
LOG.error("Unknown code:" + event.getCode());
}
if (!changedInsideCodeBlock) myOutOfCodeBlockModificationCount++;
}
