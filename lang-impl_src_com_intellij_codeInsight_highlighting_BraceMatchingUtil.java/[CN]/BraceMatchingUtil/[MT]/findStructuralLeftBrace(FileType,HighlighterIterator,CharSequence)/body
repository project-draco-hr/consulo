{
  ourBraceStack.clear();
  ourTagNameStack.clear();
  BraceMatcher matcher=getBraceMatcher(fileType);
  if (matcher == null)   return false;
  while (!iterator.atEnd()) {
    if (isStructuralBraceToken(fileType,iterator,fileText)) {
      if (isRBraceToken(iterator,fileText,fileType)) {
        ourBraceStack.push(iterator.getTokenType());
        ourTagNameStack.push(matcher.getTagName(fileText,iterator));
      }
      if (isLBraceToken(iterator,fileText,fileType)) {
        if (ourBraceStack.size() == 0)         return true;
        final int group=matcher.getTokenGroup(iterator.getTokenType());
        final IElementType topTokenType=ourBraceStack.pop();
        final IElementType tokenType=iterator.getTokenType();
        boolean isStrict=matcher.isStrictTagMatching(fileType,group);
        boolean isCaseSensitive=matcher.areTagsCaseSensitive(fileType,group);
        String topTagName=null;
        String tagName=null;
        if (isStrict) {
          topTagName=ourTagNameStack.pop();
          tagName=matcher.getTagName(fileText,iterator);
        }
        if (!isPairBraces(topTokenType,tokenType,fileType) || isStrict && !Comparing.equal(topTagName,tagName,isCaseSensitive)) {
          return false;
        }
      }
    }
    iterator.retreat();
  }
  return false;
}
