{
  JavaCommandLineState state=new JavaCommandLineState(env){
    @Override protected JavaParameters createJavaParameters() throws ExecutionException {
      return MavenRunConfiguration.this.createJavaParameters(env.getProject());
    }
    @NotNull @Override public ExecutionResult execute(    @NotNull Executor executor,    @NotNull ProgramRunner runner) throws ExecutionException {
      DefaultExecutionResult res=(DefaultExecutionResult)super.execute(executor,runner);
      if (executor.getId().equals(ToolWindowId.RUN) && MavenResumeAction.isApplicable(env.getProject(),getJavaParameters(),MavenRunConfiguration.this)) {
        MavenResumeAction resumeAction=new MavenResumeAction(res.getProcessHandler(),runner,env);
        res.setRestartActions(resumeAction);
      }
      return res;
    }
    @NotNull @Override protected OSProcessHandler startProcess() throws ExecutionException {
      OSProcessHandler result=super.startProcess();
      result.setShouldDestroyProcessRecursively(true);
      result.addProcessListener(new ProcessAdapter(){
        @Override public void processTerminated(        ProcessEvent event){
          updateProjectsFolders();
        }
      }
);
      return result;
    }
  }
;
  state.setConsoleBuilder(MavenConsoleImpl.createConsoleBuilder(getProject()));
  return state;
}
