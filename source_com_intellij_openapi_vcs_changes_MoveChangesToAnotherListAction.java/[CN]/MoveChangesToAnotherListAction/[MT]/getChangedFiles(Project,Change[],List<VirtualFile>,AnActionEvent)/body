{
  VirtualFile[] virtualFiles=(VirtualFile[])e.getDataContext().getData(DataConstants.VIRTUAL_FILE_ARRAY);
  if (virtualFiles != null) {
    List<Change> changedFiles=new ArrayList<Change>();
    for (    VirtualFile vFile : virtualFiles) {
      if (ChangeListManager.getInstance(project).getStatus(vFile).equals(FileStatus.UNKNOWN)) {
        unversionedFiles.add(vFile);
      }
 else {
        Change change=ChangeListManager.getInstance(project).getChange(vFile);
        if (change != null) {
          changedFiles.add(change);
        }
      }
    }
    if (changedFiles.size() > 0 || unversionedFiles.size() > 0) {
      changes=changedFiles.toArray(new Change[changedFiles.size()]);
    }
  }
  return changes;
}
