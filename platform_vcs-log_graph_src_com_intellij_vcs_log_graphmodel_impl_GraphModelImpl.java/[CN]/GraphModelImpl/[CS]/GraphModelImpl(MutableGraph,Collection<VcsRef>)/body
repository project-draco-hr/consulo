{
  this.graph=graph;
  myRefs=allRefs;
  this.fragmentManager=new FragmentManagerImpl(graph,new FragmentManagerImpl.CallBackFunction(){
    @Override public UpdateRequest runIntermediateUpdate(    @NotNull Node upNode,    @NotNull Node downNode){
      return GraphModelImpl.this.updateIntermediate(upNode,downNode);
    }
    @Override public void fullUpdate(){
      GraphModelImpl.this.fullUpdate();
    }
  }
);
  this.visibleNodes=new BranchVisibleNodes(graph);
  visibleNodes.setVisibleNodes(visibleNodes.generateVisibleBranchesNodes(isStartedBranchVisibilityNode));
  branchShowFixer=new GraphBranchShowFixer(graph,fragmentManager);
  graph.setGraphDecorator(new GraphDecoratorImpl(fragmentManager.getGraphPreDecorator(),new Function<Node,Boolean>(){
    @NotNull @Override public Boolean fun(    @NotNull Node key){
      return visibleNodes.isVisibleNode(key);
    }
  }
));
  graph.updateVisibleRows();
}
