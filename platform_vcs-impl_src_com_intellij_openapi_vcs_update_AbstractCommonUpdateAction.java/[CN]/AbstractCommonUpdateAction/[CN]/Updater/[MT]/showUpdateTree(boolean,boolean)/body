{
  RestoreUpdateTree restoreUpdateTree=RestoreUpdateTree.getInstance(myProject);
  restoreUpdateTree.registerUpdateInformation(myUpdatedFiles,myActionInfo);
  final String text=getTemplatePresentation().getText() + ((willBeContinued || (myUpdateNumber > 1)) ? ("#" + myUpdateNumber) : "");
  final UpdateInfoTree updateInfoTree=myProjectLevelVcsManager.showUpdateProjectInfo(myUpdatedFiles,text,myActionInfo,wasCanceled);
  updateInfoTree.setBefore(myBefore);
  updateInfoTree.setAfter(myAfter);
  updateInfoTree.setCanGroupByChangeList(canGroupByChangelist(myVcsToVirtualFiles.keySet()));
  myProject.getMessageBus().connect(updateInfoTree).subscribe(CommittedChangesCache.COMMITTED_TOPIC,new CommittedChangesAdapter(){
    public void incomingChangesUpdated(    final List<CommittedChangeList> receivedChanges){
      if (receivedChanges != null) {
        updateInfoTree.setChangeLists(receivedChanges);
      }
    }
  }
);
}
