{
  MultiMap<AbstractVcs,FilePath> resultPrep=MultiMap.createSet();
  for (  FilePath file : roots) {
    AbstractVcs vcs=VcsUtil.getVcsFor(project,file);
    if (vcs != null) {
      UpdateEnvironment updateEnvironment=myActionInfo.getEnvironment(vcs);
      if (updateEnvironment != null) {
        resultPrep.putValue(vcs,file);
      }
    }
  }
  final Map<AbstractVcs,Collection<FilePath>> result=new THashMap<>();
  for (  Map.Entry<AbstractVcs,Collection<FilePath>> entry : resultPrep.entrySet()) {
    AbstractVcs vcs=entry.getKey();
    result.put(vcs,vcs.filterUniqueRoots(new ArrayList<>(entry.getValue()),ObjectsConvertor.FILEPATH_TO_VIRTUAL));
  }
  return result;
}
