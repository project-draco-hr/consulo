{
  ((CompilerConfigurationImpl)CompilerConfiguration.getInstance(project)).convertPatterns();
  final GenerateAntBuildDialog dialog=new GenerateAntBuildDialog(project);
  dialog.show();
  if (dialog.isOK()) {
    final String[] names=dialog.getRepresentativeModuleNames();
    final GenerationOptionsImpl[] genOptions={null};
    Runnable runnable=new Runnable(){
      public void run(){
        genOptions[0]=new GenerationOptionsImpl(project,dialog.isGenerateSingleFileBuild(),dialog.isFormsCompilationEnabled(),dialog.isBackupFiles(),dialog.isForceTargetJdk(),dialog.isRuntimeClasspathInlined(),dialog.isIdeaHomeGenerated(),names);
      }
    }
;
    if (!ProgressManager.getInstance().runProcessWithProgressSynchronously(runnable,"Analyzing project structure...",true,project)) {
      return;
    }
    if (!validateGenOptions(project,genOptions[0])) {
      return;
    }
    generate(project,genOptions[0]);
  }
}
