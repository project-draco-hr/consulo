{
  final String text=psiFile.getText();
  final PsiFile file=PsiFileFactory.getInstance(project).createFileFromText("a",getFileType(),text,LocalTimeCounter.currentTime(),true);
  final PsiDocumentManager manager=PsiDocumentManager.getInstance(project);
  final Document doc=manager.getDocument(file);
  CommandProcessor.getInstance().executeCommand(project,new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          doc.replaceString(0,doc.getTextLength(),text);
          manager.commitDocument(doc);
          try {
            CodeStyleManager.getInstance(project).reformat(file);
          }
 catch (          IncorrectOperationException e) {
            LOG.error(e);
          }
        }
      }
);
    }
  }
,"","");
  manager.commitDocument(doc);
  return file;
}
