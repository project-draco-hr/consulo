{
  Application application=ApplicationManager.getApplication();
  if (application.isUnitTestMode() && !myEnabledInUnitTestMode) {
    return null;
  }
  if (!myStarted.compareAndSet(false,true)) {
    return null;
  }
  return application.executeOnPooledThread(new Runnable(){
    @Override public void run(){
      try {
        myServer=new WebServer();
      }
 catch (      ChannelException e) {
        LOG.info(e);
        String groupDisplayId="Web Server";
        Notifications.Bus.register(groupDisplayId,NotificationDisplayType.STICKY_BALLOON);
        new Notification(groupDisplayId,"Internal HTTP server disabled","Cannot start internal HTTP server. Some plugins may operate with errors. " + "Please check your firewall settings and restart " + ApplicationNamesInfo.getInstance().getFullProductName(),NotificationType.ERROR).notify(null);
        return;
      }
      myDetectedPortNumber=myServer.start(getDefaultPort(),PORTS_COUNT,true);
      if (myDetectedPortNumber == -1) {
        LOG.info("web server cannot be started, cannot bind to port");
      }
 else {
        LOG.info("web server started, port " + myDetectedPortNumber);
      }
    }
  }
);
}
