{
  String namespacePrefix=XmlUtil.findPrefixByQualifiedName(ref);
  String namespace="".equals(namespacePrefix) ? myDocumentDescriptor.getDefaultNamespace() : tag.getNamespaceByPrefix(namespacePrefix);
  if (namespacePrefix.length() == 0 && nsPrefixFromContext.length() != 0) {
    String namespaceFromContext=((XmlDocument)myDocumentDescriptor.getDeclaration()).getRootTag().getNamespaceByPrefix(nsPrefixFromContext);
    if (namespaceFromContext.length() > 0)     namespace=namespaceFromContext;
  }
  return namespace;
}
