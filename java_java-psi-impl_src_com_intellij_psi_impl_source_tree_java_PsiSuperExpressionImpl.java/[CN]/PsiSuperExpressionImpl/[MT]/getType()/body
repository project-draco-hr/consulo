{
  PsiJavaCodeReferenceElement qualifier=getQualifier();
  if (qualifier != null) {
    final PsiElement aClass=qualifier.resolve();
    return aClass instanceof PsiClass ? getSuperType((PsiClass)aClass) : null;
  }
  for (PsiElement scope=getContext(); scope != null; scope=scope.getContext()) {
    if (scope instanceof PsiClass) {
      PsiClass aClass=(PsiClass)scope;
      return getSuperType(aClass);
    }
    if (scope instanceof PsiExpressionList && scope.getParent() instanceof PsiAnonymousClass) {
      scope=scope.getParent();
    }
 else     if (scope instanceof JavaCodeFragment) {
      PsiType fragmentSuperType=((JavaCodeFragment)scope).getSuperType();
      if (fragmentSuperType != null)       return fragmentSuperType;
    }
  }
  return null;
}
