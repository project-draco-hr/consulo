{
  PsiSwitchStatement switchStatement=statement.getEnclosingSwitchStatement();
  if (switchStatement == null) {
    String description=JavaErrorMessages.message("case.statement.outside.switch");
    return HighlightInfo.newHighlightInfo(HighlightInfoType.ERROR).range(statement).descriptionAndTooltip(description).create();
  }
  if (switchStatement.getBody() == null)   return null;
  PsiExpression switchExpression=switchStatement.getExpression();
  PsiType switchType=switchExpression == null ? PsiType.INT : switchExpression.getType();
  PsiExpression caseValue=statement.getCaseValue();
  if (caseValue != null && switchExpression != null) {
    HighlightInfo highlightInfo=checkAssignability(switchType,caseValue.getType(),caseValue,caseValue);
    if (highlightInfo != null)     return highlightInfo;
  }
  Object value=null;
  boolean isEnumSwitch=false;
  if (!statement.isDefaultCase() && caseValue != null) {
    if (caseValue instanceof PsiReferenceExpression) {
      PsiElement element=((PsiReferenceExpression)caseValue).resolve();
      if (element instanceof PsiEnumConstant) {
        isEnumSwitch=true;
        value=((PsiEnumConstant)element).getName();
        if (!(((PsiReferenceExpression)caseValue).getQualifier() == null)) {
          String message=JavaErrorMessages.message("qualified.enum.constant.in.switch");
          return HighlightInfo.newHighlightInfo(HighlightInfoType.ERROR).range(caseValue).descriptionAndTooltip(message).create();
        }
      }
    }
    if (!isEnumSwitch) {
      value=ConstantExpressionUtil.computeCastTo(caseValue,switchType);
    }
    if (value == null) {
      String description=JavaErrorMessages.message("constant.expression.required");
      return HighlightInfo.newHighlightInfo(HighlightInfoType.ERROR).range(caseValue).descriptionAndTooltip(description).create();
    }
  }
  PsiStatement[] statements=switchStatement.getBody().getStatements();
  for (  PsiStatement st : statements) {
    if (st == statement)     continue;
    if (!(st instanceof PsiSwitchLabelStatement))     continue;
    PsiSwitchLabelStatement labelStatement=(PsiSwitchLabelStatement)st;
    if (labelStatement.isDefaultCase() != statement.isDefaultCase())     continue;
    PsiExpression caseExpr=labelStatement.getCaseValue();
    if (isEnumSwitch && caseExpr instanceof PsiReferenceExpression) {
      PsiElement element=((PsiReferenceExpression)caseExpr).resolve();
      if (!(element instanceof PsiEnumConstant && Comparing.equal(((PsiEnumConstant)element).getName(),value)))       continue;
    }
 else {
      if (!TypeConversionUtil.areTypesAssignmentCompatible(switchType,caseExpr))       continue;
      if (!Comparing.equal(ConstantExpressionUtil.computeCastTo(caseExpr,switchType),value))       continue;
    }
    String description=statement.isDefaultCase() ? JavaErrorMessages.message("duplicate.default.switch.label") : JavaErrorMessages.message("duplicate.switch.label",value);
    PsiElement element=value == null ? statement : caseValue;
    return HighlightInfo.newHighlightInfo(HighlightInfoType.ERROR).range(element).descriptionAndTooltip(description).create();
  }
  PsiElement lastChild=statement.getLastChild();
  while (lastChild instanceof PsiComment || lastChild instanceof PsiWhiteSpace) {
    lastChild=lastChild.getPrevSibling();
  }
  if (!(lastChild instanceof PsiJavaToken && ((PsiJavaToken)lastChild).getTokenType() == JavaTokenType.COLON)) {
    int start=statement.getTextRange().getEndOffset();
    int end=statement.getTextRange().getEndOffset() + 1;
    String description=JavaErrorMessages.message("switch.colon.expected.after.case.label");
    CharSequence chars=statement.getContainingFile().getViewProvider().getContents();
    boolean isAfterEndOfLine=end >= chars.length() || chars.charAt(start) == '\n' || chars.charAt(start) == '\r';
    HighlightInfo.Builder builder=HighlightInfo.newHighlightInfo(HighlightInfoType.ERROR).range(start,end).descriptionAndTooltip(description);
    if (isAfterEndOfLine) {
      builder.endOfLine();
    }
    return builder.create();
  }
  return null;
}
