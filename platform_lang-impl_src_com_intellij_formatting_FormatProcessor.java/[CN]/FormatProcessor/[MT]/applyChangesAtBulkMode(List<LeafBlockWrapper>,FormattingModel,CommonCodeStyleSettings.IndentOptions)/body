{
  FormattingDocumentModel documentModel=model.getDocumentModel();
  Document document=documentModel.getDocument();
  if (document == null) {
    return false;
  }
  List<TextChange> changes=new ArrayList<TextChange>();
  for (  LeafBlockWrapper block : blocksToModify) {
    WhiteSpace whiteSpace=block.getWhiteSpace();
    CharSequence newWs=documentModel.adjustWhiteSpaceIfNecessary(whiteSpace.generateWhiteSpace(indentOption),whiteSpace.getStartOffset(),whiteSpace.getEndOffset(),false);
    changes.add(new TextChangeImpl(newWs,whiteSpace.getStartOffset(),whiteSpace.getEndOffset()));
  }
  CharSequence mergeResult=BulkChangesMerger.INSTANCE.mergeToCharSequence(document.getChars(),document.getTextLength(),changes);
  document.replaceString(0,document.getTextLength(),mergeResult);
  cleanupBlocks(blocksToModify);
  return true;
}
