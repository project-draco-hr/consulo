{
  AbstractBlockWrapper current=myCurrentBlock;
  while (true) {
    final AlignmentImpl alignment=current.getAlignment();
    LeafBlockWrapper offsetResponsibleBlock;
    if (alignment != null && (offsetResponsibleBlock=alignment.getOffsetRespBlockBefore(myCurrentBlock)) != null) {
      final WhiteSpace whiteSpace=offsetResponsibleBlock.getWhiteSpace();
      if (whiteSpace.containsLineFeeds()) {
        return new IndentData(whiteSpace.getIndentSpaces(),whiteSpace.getSpaces());
      }
 else {
        final int offsetBeforeBlock=CoreFormatterUtil.getStartColumn(offsetResponsibleBlock);
        final AbstractBlockWrapper indentedParentBlock=CoreFormatterUtil.getIndentedParentBlock(myCurrentBlock);
        if (indentedParentBlock == null) {
          return new IndentData(0,offsetBeforeBlock);
        }
 else {
          final int parentIndent=indentedParentBlock.getWhiteSpace().getIndentOffset();
          if (parentIndent > offsetBeforeBlock) {
            return new IndentData(0,offsetBeforeBlock);
          }
 else {
            return new IndentData(parentIndent,offsetBeforeBlock - parentIndent);
          }
        }
      }
    }
 else {
      current=current.getParent();
      if (current == null || current.getStartOffset() != myCurrentBlock.getStartOffset())       return null;
    }
  }
}
