{
  if (parent == null) {
    return null;
  }
  ChildAttributes childAttributes=block.getChildAttributes(index);
  if (childAttributes == ChildAttributes.DELEGATE_TO_PREV_CHILD) {
    final Block newBlock=block.getSubBlocks().get(index - 1);
    AbstractBlockWrapper prevWrappedBlock;
    if (parent instanceof CompositeBlockWrapper) {
      prevWrappedBlock=((CompositeBlockWrapper)parent).getChildren().get(index - 1);
    }
 else {
      prevWrappedBlock=parent.getPreviousBlock();
    }
    return getChildAttributesInfo(newBlock,newBlock.getSubBlocks().size(),prevWrappedBlock);
  }
 else   if (childAttributes == ChildAttributes.DELEGATE_TO_NEXT_CHILD) {
    AbstractBlockWrapper nextWrappedBlock;
    if (parent instanceof CompositeBlockWrapper) {
      List<AbstractBlockWrapper> children=((CompositeBlockWrapper)parent).getChildren();
      if (children != null && index < children.size()) {
        nextWrappedBlock=children.get(index);
      }
 else {
        return null;
      }
    }
 else {
      nextWrappedBlock=((LeafBlockWrapper)parent).getNextBlock();
    }
    return getChildAttributesInfo(block.getSubBlocks().get(index),0,nextWrappedBlock);
  }
 else {
    return new ChildAttributesInfo(parent,childAttributes,index);
  }
}
