{
  if (myRunBeforeUpdate != null) {
    myRunBeforeUpdate.run();
    myRunBeforeUpdate=null;
  }
  while (!myNodesToUpdate.isEmpty()) {
    DefaultMutableTreeNode node=myNodesToUpdate.removeFirst();
    updateSubtree(node);
  }
  if (myRunAfterUpdate != null) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
synchronized (AbstractTreeUpdater.this) {
          if (myRunAfterUpdate != null) {
            myRunAfterUpdate.run();
            myRunAfterUpdate=null;
          }
        }
      }
    }
);
  }
}
