{
  String textToInsert=document.getCharsSequence().subSequence(start,end).toString();
  if (!StringUtil.endsWithChar(textToInsert,'\n')) {
    if (mayEndWithNewline) {
      return textToInsert + '\n';
    }
  }
 else {
    if (!mayEndWithNewline) {
      return StringUtil.trimEnd(textToInsert,"\n");
    }
  }
  return textToInsert;
}
