{
  myFileSystems=new ArrayList<VirtualFileSystem>();
  myProtocolToSystemMap=new HashMap<String,VirtualFileSystem>();
  for (  VirtualFileSystem fileSystem : fileSystems) {
    registerFileSystem(fileSystem);
  }
  if (LOG.isDebugEnabled()) {
    addVirtualFileListener(new LoggingListener());
  }
  addVirtualFileListener(myContentProvidersDispatcher.getMulticaster());
  bus.connect().subscribe(VFS_CHANGES,new BulkFileListener(){
    public void before(    final List<? extends VFileEvent> events){
      for (      VFileEvent event : events) {
        fireBefore(event);
      }
    }
    public void after(    final List<? extends VFileEvent> events){
      for (      VFileEvent event : events) {
        fireAfter(event);
      }
    }
  }
);
}
