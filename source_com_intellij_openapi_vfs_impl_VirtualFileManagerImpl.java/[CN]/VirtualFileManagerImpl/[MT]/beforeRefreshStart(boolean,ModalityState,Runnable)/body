{
  Runnable action=new Runnable(){
    public void run(){
      ApplicationManager.getApplication().assertIsDispatchThread();
      final ProgressIndicator indicator=asynchronous ? myAsyncRefreshIndicator : myRefreshIndicator;
      if (asynchronous) {
        if (getAsynchronousRefreshCount() == 0) {
          indicator.start();
        }
      }
 else {
        if (mySynchronousRefreshCount == 0) {
          indicator.start();
        }
      }
      indicator.setText(VfsBundle.message("file.synchronize.progress"));
      myRefreshCount++;
      if (!asynchronous)       mySynchronousRefreshCount++;
      myPostRefreshRunnables.push(postAction);
      if (myRefreshCount == 1) {
        myRefreshEventsToFire=new ArrayList<Runnable>();
        myRefreshEventsToFire.add(new FireBeforeRefresh(asynchronous));
      }
    }
  }
;
  if (asynchronous) {
    ApplicationManager.getApplication().invokeLater(action,modalityState);
  }
 else {
    action.run();
  }
}
