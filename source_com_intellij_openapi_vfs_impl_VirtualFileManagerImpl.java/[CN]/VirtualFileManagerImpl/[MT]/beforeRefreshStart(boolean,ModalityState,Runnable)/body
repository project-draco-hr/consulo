{
  Runnable action=new Runnable(){
    public void run(){
      ApplicationManager.getApplication().assertIsDispatchThread();
      myRefreshCount++;
      if (!asynchronous)       mySynchronousRefreshCount++;
      myPostRefreshRunnables.push(postAction);
      if (myRefreshCount == 1) {
        myRefreshEventsToFire=new ArrayList<Runnable>();
        myRefreshEventsToFire.add(new FireBeforeRefresh(asynchronous));
      }
    }
  }
;
  if (asynchronous) {
    ApplicationManager.getApplication().invokeLater(action,modalityState);
  }
 else {
    action.run();
  }
}
