{
  final PsiPackage aPackage=JavaPsiFacade.getInstance(myProject).findPackage(getTargetPackageName());
  if (aPackage != null) {
    final PsiDirectory[] directories=aPackage.getDirectories(mySourceClass.getResolveScope());
    if (directories.length >= 1) {
      myTargetDirectory=getDirUnderSameSourceRoot(directories);
    }
  }
  final MoveDestination moveDestination=myDestinationFolderComboBox.selectDirectory(new PackageWrapper(PsiManager.getInstance(myProject),getTargetPackageName()),false);
  if (moveDestination == null)   return;
  myTargetDirectory=myTargetDirectory != null ? ApplicationManager.getApplication().runWriteAction(new Computable<PsiDirectory>(){
    @Override public PsiDirectory compute(){
      return moveDestination.getTargetDirectory(myTargetDirectory);
    }
  }
) : null;
  if (myTargetDirectory == null) {
    throw new OperationFailedException("");
  }
  String error=RefactoringMessageUtil.checkCanCreateClass(myTargetDirectory,getExtractedSuperName());
  if (error != null) {
    throw new OperationFailedException(error);
  }
}
