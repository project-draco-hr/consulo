{
  int offset=editor == null ? 0 : editor.getCaretModel().getOffset();
  final PsiElement[] handlerImplementations=handler.searchImplementations(element,editor,offset,includeSelfAlways,true);
  if (handlerImplementations.length > 0)   return handlerImplementations;
  PsiFile psiFile=element.getContainingFile();
  if (psiFile == null) {
    element=element.getNavigationElement();
    psiFile=element.getContainingFile();
    if (psiFile == null)     return PsiElement.EMPTY_ARRAY;
  }
  if (psiFile.getVirtualFile() != null && (element.getTextRange() != null || element instanceof PsiFile)) {
    return new PsiElement[]{element};
  }
 else {
    return PsiElement.EMPTY_ARRAY;
  }
}
