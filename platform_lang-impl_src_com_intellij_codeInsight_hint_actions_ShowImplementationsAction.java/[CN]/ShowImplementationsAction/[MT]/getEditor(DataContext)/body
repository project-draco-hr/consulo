{
  Editor editor=CommonDataKeys.EDITOR.getData(dataContext);
  if (editor == null) {
    final PsiFile file=CommonDataKeys.PSI_FILE.getData(dataContext);
    if (file != null) {
      final FileEditor fileEditor=FileEditorManager.getInstance(file.getProject()).getSelectedEditor(file.getVirtualFile());
      if (fileEditor instanceof TextEditor) {
        editor=((TextEditor)fileEditor).getEditor();
      }
    }
  }
  return editor;
}
