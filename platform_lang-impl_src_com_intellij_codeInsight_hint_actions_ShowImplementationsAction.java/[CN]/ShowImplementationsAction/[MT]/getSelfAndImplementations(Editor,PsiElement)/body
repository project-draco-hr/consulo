{
  ImplementationSearcher handler=new ImplementationSearcher(){
    protected PsiElement[] filterElements(    PsiElement element,    PsiElement[] targetElements,    final int offset){
      Set<PsiElement> unique=new LinkedHashSet<PsiElement>(Arrays.asList(targetElements));
      for (      PsiElement elt : targetElements) {
        PsiFile psiFile=elt.getContainingFile().getOriginalFile();
        if (psiFile.getVirtualFile() == null)         unique.remove(elt);
      }
      return unique.toArray(new PsiElement[unique.size()]);
    }
  }
;
  int offset=editor == null ? 0 : editor.getCaretModel().getOffset();
  final PsiElement[] handlerImplementations=handler.searchImplementations(element,offset,!(element instanceof PomTargetPsiElement),true);
  if (handlerImplementations.length > 0)   return handlerImplementations;
  PsiFile psiFile=element.getContainingFile();
  if (psiFile == null) {
    element=element.getNavigationElement();
    psiFile=element.getContainingFile();
    if (psiFile == null)     return PsiElement.EMPTY_ARRAY;
  }
  if (psiFile.getVirtualFile() != null && (element.getTextRange() != null || element instanceof PsiFile)) {
    return new PsiElement[]{element};
  }
 else {
    return PsiElement.EMPTY_ARRAY;
  }
}
