{
  Map<GitRepository,List<GitPushSpec.SourceDest>> reposAndBranchesToPush=prepareRepositoriesAndBranchesToPush(pushSpec);
  Map<GitRepository,GitCommitsByBranch> commitsByRepoAndBranch=new HashMap<GitRepository,GitCommitsByBranch>();
  for (  GitRepository repository : myRepositories) {
    GitCommitsByBranch commitsByBranch=collectsCommitsToPush(repository,reposAndBranchesToPush.get(repository));
    if (!commitsByBranch.isEmpty()) {
      commitsByRepoAndBranch.put(repository,commitsByBranch);
    }
  }
  return new GitCommitsByRepoAndBranch(commitsByRepoAndBranch);
}
