{
  if (pushSpec.getDest() == NO_TARGET_BRANCH) {
    return GitSimplePushResult.notPushed();
  }
  GitRemote remote=pushSpec.getRemote();
  Collection<String> pushUrls=remote.getPushUrls();
  if (pushUrls.isEmpty()) {
    LOG.error("No urls or pushUrls are defined for " + remote);
    return GitSimplePushResult.error("There are no URLs defined for remote " + remote.getName());
  }
  String url=pushUrls.iterator().next();
  GitSimplePushResult pushResult;
  if (GitHttpAdapter.shouldUseJGit(url)) {
    pushResult=GitHttpAdapter.push(repository,remote.getName(),url,formPushSpec(pushSpec,remote));
  }
 else {
    pushResult=pushNatively(repository,pushSpec,url);
  }
  if (pushResult.getType() == GitSimplePushResult.Type.SUCCESS) {
    setUpstream(repository,pushSpec.getSource(),pushSpec.getRemote(),pushSpec.getDest());
  }
  return pushResult;
}
