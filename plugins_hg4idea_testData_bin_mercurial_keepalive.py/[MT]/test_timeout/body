def test_timeout(url):
    global DEBUG
    dbbackup = DEBUG


    class FakeLogger:

        def debug(self, msg, *args):
            print (msg % args)
        info = warning = error = debug
    DEBUG = FakeLogger()
    print '  fetching the file to establish a connection'
    fo = urllib2.urlopen(url)
    data1 = fo.read()
    fo.close()
    i = 20
    print ('  waiting %i seconds for the server to close the connection' % i)
    while (i > 0):
        sys.stdout.write(('\r  %2i' % i))
        sys.stdout.flush()
        time.sleep(1)
        i -= 1
    sys.stderr.write('\r')
    print '  fetching the file a second time'
    fo = urllib2.urlopen(url)
    data2 = fo.read()
    fo.close()
    if (data1 == data2):
        print '  data are identical'
    else:
        print '  ERROR: DATA DIFFER'
    DEBUG = dbbackup
