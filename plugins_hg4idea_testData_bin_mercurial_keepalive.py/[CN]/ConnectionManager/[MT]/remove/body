def remove(self, connection):
    self._lock.acquire()
    try:
        try:
            host = self._connmap[connection]
        except KeyError:
            pass
        else:
            del self._connmap[connection]
            del self._readymap[connection]
            self._hostmap[host].remove(connection)
            if (not self._hostmap[host]):
                del self._hostmap[host]
    finally:
        self._lock.release()
