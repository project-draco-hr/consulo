{
  final NamespaceCollector.CollectedInfo collectedInfo;
  if (contextElement != null) {
    collectedInfo=NamespaceCollector.collectInfo((XmlFile)contextElement.getContainingFile());
    myNamespaceCache=collectedInfo.namespaces;
  }
 else {
    collectedInfo=NamespaceCollector.empty();
    myNamespaceCache=null;
  }
  myContextProvider=new InteractiveContextProvider(contextElement,collectedInfo,myModel);
  myContextProvider.attachTo(myXPathFile);
  final HistoryElement historyElement=myModel.getSelectedItem();
  if (historyElement != null) {
    myContextProvider.getNamespaceContext().setMap(asMap(historyElement.namespaces));
  }
 else {
    myContextProvider.getNamespaceContext().setMap(asMap(null));
  }
  updateOkAction();
}
