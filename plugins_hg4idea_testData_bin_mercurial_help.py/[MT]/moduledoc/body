def moduledoc(file):
    'return the top-level python documentation for the given file\n\n    Loosely inspired by pydoc.source_synopsis(), but rewritten to\n    handle triple quotes and to return the whole text instead of just\n    the synopsis'
    result = []
    line = file.readline()
    while ((line[:1] == '#') or (not line.strip())):
        line = file.readline()
        if (not line):
            break
    start = line[:3]
    if ((start == '"""') or (start == "'''")):
        line = line[3:]
        while line:
            if line.rstrip().endswith(start):
                line = line.split(start)[0]
                if line:
                    result.append(line)
                break
            elif (not line):
                return None
            result.append(line)
            line = file.readline()
    else:
        return None
    return ''.join(result)
