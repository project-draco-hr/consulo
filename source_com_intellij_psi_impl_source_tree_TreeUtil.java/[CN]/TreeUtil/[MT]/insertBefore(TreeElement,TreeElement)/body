{
  final TreeElement anchorPrev=anchor.getTreePrev();
  if (anchorPrev == null) {
    removeRange(firstNew,null);
    final CompositeElement parent=anchor.getTreeParent();
    if (parent != null)     parent.firstChild=firstNew;
    while (true) {
      final TreeElement treeNext=firstNew.getTreeNext();
      LOG.assertTrue(treeNext != anchor,"Attempt to create cycle");
      if (firstNew instanceof CompositeElement) {
        firstNew.setTreeParent(parent);
      }
      if (treeNext == null)       break;
      firstNew=treeNext;
    }
    anchor.setTreePrev(firstNew);
    firstNew.setTreeNext(anchor);
  }
 else   insertAfter(anchorPrev,firstNew);
  if (DebugUtil.CHECK) {
    DebugUtil.checkTreeStructure(anchor);
  }
}
