{
  removeRange(firstNew,null);
  final CompositeElement parent=anchor.getTreeParent();
  final TreeElement treeNext=anchor.getTreeNext();
  firstNew.setTreePrev(anchor);
  anchor.setTreeNext(firstNew);
  while (true) {
    final TreeElement next=firstNew.getTreeNext();
    LOG.assertTrue(next != anchor,"Attempt to create cycle");
    firstNew.setTreeParent(parent);
    if (next == null)     break;
    firstNew=next;
  }
  if (treeNext == null) {
    if (parent != null) {
      firstNew.setTreeParent(parent);
      parent.lastChild=firstNew;
    }
  }
 else {
    firstNew.setTreeNext(treeNext);
    treeNext.setTreePrev(firstNew);
  }
  if (DebugUtil.CHECK) {
    DebugUtil.checkTreeStructure(anchor);
  }
}
