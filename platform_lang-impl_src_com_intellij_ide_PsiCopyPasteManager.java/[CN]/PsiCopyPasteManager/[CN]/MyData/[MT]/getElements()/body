{
  if (myElements == null)   return PsiElement.EMPTY_ARRAY;
  int validElementsCount=0;
  final AccessToken token=ApplicationManager.getApplication().acquireReadActionLock();
  try {
    for (    PsiElement element : myElements) {
      if (element.isValid()) {
        validElementsCount++;
      }
    }
    if (validElementsCount == myElements.length) {
      return myElements;
    }
    PsiElement[] validElements=new PsiElement[validElementsCount];
    int j=0;
    for (    PsiElement element : myElements) {
      if (element.isValid()) {
        validElements[j++]=element;
      }
    }
    myElements=validElements;
  }
  finally {
    token.finish();
  }
  return myElements;
}
