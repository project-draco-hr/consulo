{
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      PsiClass[] classes=JavaDirectoryService.getInstance().getClasses(dir);
      array.addAll(Arrays.asList(classes));
      if (includeSubdirs) {
        PsiDirectory[] dirs=dir.getSubdirectories();
        for (        PsiDirectory directory : dirs) {
          addClassesInDirectory(directory,includeSubdirs,array);
        }
      }
    }
  }
);
}
