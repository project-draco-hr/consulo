{
  if (element instanceof PsiVariable) {
    if (options.isReadAccess || options.isWriteAccess) {
      if (options.isReadAccess && options.isWriteAccess) {
        addElementUsages(element,processor,options);
      }
 else {
        addElementUsages(element,new Processor<UsageInfo>(){
          public boolean process(          UsageInfo info){
            final PsiElement element=info.getElement();
            boolean isWrite=element instanceof PsiExpression && PsiUtil.isAccessedForWriting((PsiExpression)element);
            if (isWrite == options.isWriteAccess) {
              if (!processor.process(info))               return false;
            }
            return true;
          }
        }
,options);
      }
    }
  }
 else   if (options.isUsages) {
    addElementUsages(element,processor,options);
  }
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      if (ThrowSearchUtil.isSearchable(element) && options.isThrowUsages) {
        ThrowSearchUtil.Root root=options.getUserData(ThrowSearchUtil.THROW_SEARCH_ROOT_KEY);
        if (root == null) {
          final ThrowSearchUtil.Root[] roots=ThrowSearchUtil.getSearchRoots(element);
          if (roots != null && roots.length > 0) {
            root=roots[0];
          }
        }
        if (root != null) {
          ThrowSearchUtil.addThrowUsages(processor,root,options);
        }
      }
    }
  }
);
  if (element instanceof PsiPackage && options.isClassesUsages) {
    addClassesUsages((PsiPackage)element,processor,options);
  }
  if (element instanceof PsiClass && options.isMethodsUsages) {
    addMethodsUsages((PsiClass)element,processor,options);
  }
  if (element instanceof PsiClass && options.isFieldsUsages) {
    addFieldsUsages((PsiClass)element,processor,options);
  }
  if (element instanceof PsiClass) {
    if (((PsiClass)element).isInterface()) {
      if (options.isDerivedInterfaces) {
        if (options.isImplementingClasses) {
          addInheritors((PsiClass)element,processor,options);
        }
 else {
          addDerivedInterfaces((PsiClass)element,processor,options);
        }
      }
 else       if (options.isImplementingClasses) {
        addImplementingClasses((PsiClass)element,processor,options);
      }
    }
 else     if (options.isDerivedClasses) {
      addInheritors((PsiClass)element,processor,options);
    }
  }
  if (element instanceof PsiMethod) {
    final PsiMethod psiMethod=(PsiMethod)element;
    boolean isAbstract=ApplicationManager.getApplication().runReadAction(new Computable<Boolean>(){
      public Boolean compute(){
        return psiMethod.hasModifierProperty(PsiModifier.ABSTRACT);
      }
    }
);
    if (isAbstract && options.isImplementingMethods || options.isOverridingMethods) {
      processOverridingMethods(psiMethod,processor,options);
    }
  }
  if (!ThrowSearchUtil.isSearchable(element) && options.isSearchForTextOccurences && options.searchScope instanceof GlobalSearchScope) {
    processUsagesInText(element,processor,(GlobalSearchScope)options.searchScope);
  }
}
