{
  if (myTabbedPane.getSelectedIndex() != fileIndex) {
    return -1;
  }
  final VirtualFile[] histFiles=EditorHistoryManager.getInstance(getManager().myProject).getFiles();
  for (int idx=0; idx < histFiles.length; idx++) {
    final VirtualFile histFile=histFiles[idx];
    if (histFile.equals(fileBeingClosed)) {
      continue;
    }
    final EditorWithProviderComposite editor=findFileComposite(histFile);
    if (editor == null) {
      continue;
    }
    final int histFileIndex=findComponentIndex(editor.getComponent());
    if (histFileIndex >= 0) {
      return histFileIndex;
    }
  }
  if (fileIndex > 0) {
    return fileIndex - 1;
  }
  return -1;
}
