{
  getManager().mySplitters.myInsideChange++;
  try {
    final EditorWithProviderComposite[] editors=getManager().getEditorComposites(file);
    LOG.assertTrue(editors != null);
    final EditorWithProviderComposite editor=findFileComposite(file);
    getManager().disposeComposite(editor);
    if (myTabbedPane != null) {
      final int componentIndex=findComponentIndex(editor.getComponent());
      if (componentIndex >= 0) {
        int indexToSelect=calcIndexToSelect(file,componentIndex);
        if (indexToSelect >= 0) {
          myTabbedPane.setSelectedIndex(indexToSelect);
        }
        myTabbedPane.removeTabAt(componentIndex);
        final VirtualFile selectedFile=getSelectedFile();
        if (selectedFile != null) {
          getManager().openFileImpl3(this,selectedFile,false,null);
        }
      }
    }
 else {
      myPanel.removeAll();
    }
    if (unsplit && getTabCount() == 0) {
      unsplit();
    }
    myPanel.revalidate();
    if (myTabbedPane == null) {
      myPanel.repaint();
    }
    if (editors.length == 1) {
      getManager().closeFile(file);
    }
  }
  finally {
    getManager().mySplitters.myInsideChange--;
  }
}
