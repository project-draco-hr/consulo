{
synchronized (myDataLock) {
    List<VirtualFile> unversionedFiles=myComposite.getVFHolder(FileHolder.HolderType.UNVERSIONED).getFiles();
    List<VirtualFile> ignoredFiles=myComposite.getVFHolder(FileHolder.HolderType.IGNORED).getFiles();
    boolean somethingChanged=false;
    for (    VirtualFile file : unversionedFiles) {
      if (isIgnoredFile(file)) {
        somethingChanged=true;
        myComposite.getVFHolder(FileHolder.HolderType.UNVERSIONED).removeFile(file);
        myComposite.getVFHolder(FileHolder.HolderType.IGNORED).addFile(file);
      }
    }
    if (checkIgnored) {
      for (      VirtualFile file : ignoredFiles) {
        if (!isIgnoredFile(file)) {
          somethingChanged=true;
          VcsDirtyScopeManager.getInstance(myProject).fileDirty(file);
        }
      }
    }
    if (somethingChanged) {
      FileStatusManager.getInstance(getProject()).fileStatusesChanged();
      myChangesViewManager.scheduleRefresh();
    }
  }
}
