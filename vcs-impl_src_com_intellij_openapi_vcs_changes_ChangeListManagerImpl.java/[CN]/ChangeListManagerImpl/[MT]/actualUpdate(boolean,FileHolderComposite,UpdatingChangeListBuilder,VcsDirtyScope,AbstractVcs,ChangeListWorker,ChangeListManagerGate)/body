{
  try {
    final ChangeProvider changeProvider=vcs.getChangeProvider();
    if (changeProvider != null) {
      final FoldersCutDownWorker foldersCutDownWorker=new FoldersCutDownWorker();
      try {
        myUpdateChangesProgressIndicator=new EmptyProgressIndicator(){
          @Override public boolean isCanceled(){
            checkIfDisposed();
            return false;
          }
        }
;
        builder.setCurrent(scope,foldersCutDownWorker);
        changeProvider.getChanges(scope,builder,myUpdateChangesProgressIndicator,gate);
      }
 catch (      VcsException e) {
        LOG.info(e);
        if (myUpdateException == null) {
          myUpdateException=e;
        }
      }
      composite.getSwitchedFileHolder().calculateChildren();
    }
  }
  finally {
    if ((!myUpdater.isStopped()) && !wasEverythingDirty) {
      changeListWorker.notifyDoneProcessingChanges(myListeners);
    }
  }
}
