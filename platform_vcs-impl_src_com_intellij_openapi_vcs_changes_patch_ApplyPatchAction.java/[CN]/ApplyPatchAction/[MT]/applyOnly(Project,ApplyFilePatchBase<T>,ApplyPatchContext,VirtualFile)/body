{
  final T patchBase=patch.getPatch();
  try {
    return patch.apply(file,context,project);
  }
 catch (  ApplyPatchException ex) {
    if (!patchBase.isNewFile() && !patchBase.isDeletedFile() && patchBase instanceof TextFilePatch) {
      ApplyPatchStatus mergeStatus=mergeAgainstBaseVersion(project,file,new FilePathImpl(file),(TextFilePatch)patchBase,ApplyPatchMergeRequestFactory.INSTANCE);
      if (mergeStatus != null) {
        return mergeStatus;
      }
    }
    Messages.showErrorDialog(project,VcsBundle.message("patch.apply.error",patchBase.getBeforeName(),ex.getMessage()),VcsBundle.message("patch.apply.dialog.title"));
  }
catch (  Exception ex) {
    LOG.error(ex);
  }
  return ApplyPatchStatus.FAILURE;
}
