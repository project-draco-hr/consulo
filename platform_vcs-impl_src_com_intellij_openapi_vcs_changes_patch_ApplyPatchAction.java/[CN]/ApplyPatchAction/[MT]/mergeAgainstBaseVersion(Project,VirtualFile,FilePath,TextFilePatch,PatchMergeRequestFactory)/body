{
  final ApplyPatchForBaseRevisionTexts threeTexts;
  try {
    threeTexts=ApplyPatchForBaseRevisionTexts.create(project,file,pathBeforeRename,patch);
  }
 catch (  VcsException e) {
    return mergeBaseFailure(project,patch,e.getMessage());
  }
  ApplyPatchStatus status=threeTexts.getStatus();
  if (status != ApplyPatchStatus.ALREADY_APPLIED) {
    return ApplicationManager.getApplication().runWriteAction(new Computable<ApplyPatchStatus>(){
      @Override public ApplyPatchStatus compute(){
        return showMergeDialog(project,file,threeTexts.getBase(),threeTexts.getPatched(),mergeRequestFactory);
      }
    }
);
  }
 else {
    return status;
  }
}
