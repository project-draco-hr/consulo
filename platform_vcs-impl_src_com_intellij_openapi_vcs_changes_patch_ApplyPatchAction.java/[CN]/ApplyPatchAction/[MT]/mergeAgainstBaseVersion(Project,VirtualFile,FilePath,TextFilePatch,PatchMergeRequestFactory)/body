{
  final ApplyPatchForBaseRevisionTexts threeTexts=ApplyPatchForBaseRevisionTexts.create(project,file,pathBeforeRename,patch);
  if ((threeTexts == null) || (threeTexts.getStatus() == null)) {
    return null;
  }
  ApplyPatchStatus status=threeTexts.getStatus();
  if (ApplyPatchStatus.FAILURE.equals(status)) {
    final VcsException vcsExc=threeTexts.getException();
    Messages.showErrorDialog(project,VcsBundle.message("patch.load.base.revision.error",patch.getBeforeName(),vcsExc == null ? null : vcsExc.getMessage()),VcsBundle.message("patch.apply.dialog.title"));
    return status;
  }
  if (status != ApplyPatchStatus.ALREADY_APPLIED) {
    return ApplicationManager.getApplication().runWriteAction(new Computable<ApplyPatchStatus>(){
      @Override public ApplyPatchStatus compute(){
        return showMergeDialog(project,file,threeTexts.getBase(),threeTexts.getPatched(),mergeRequestFactory);
      }
    }
);
  }
 else {
    return status;
  }
}
