{
  final SimpleDiffRequest simpleRequest=new SimpleDiffRequest(project,"Result Of Patch Apply To " + file.getName() + " ("+ (file.getParent() == null ? file.getPath() : file.getParent().getPath())+ ")");
  final DocumentImpl patched=new DocumentImpl(texts.getPatched());
  patched.setReadOnly(false);
  final DocumentContent mergedDocument=new DocumentContent(project,patched,file.getFileType());
  mergedDocument.getDocument().setReadOnly(readonly);
  simpleRequest.setContents(new SimpleContent(texts.getLocal().toString(),file.getFileType()),mergedDocument);
  simpleRequest.setContentTitles(VcsBundle.message("diff.title.local"),"Patched (with problems)");
  simpleRequest.addHint(DiffTool.HINT_SHOW_NOT_MODAL_DIALOG);
  simpleRequest.addHint(DiffTool.HINT_DIFF_IS_APPROXIMATE);
  if (!readonly) {
    simpleRequest.setOnOkRunnable(new Runnable(){
      @Override public void run(){
        ApplicationManager.getApplication().runWriteAction(new Runnable(){
          @Override public void run(){
            final String resultText=mergedDocument.getDocument().getText();
            final FileDocumentManager fileDocumentManager=FileDocumentManager.getInstance();
            final Document document=fileDocumentManager.getDocument(file);
            if (document == null) {
              try {
                VfsUtil.saveText(file,resultText);
              }
 catch (              IOException e) {
                showIOException(project,file.getName(),e);
              }
            }
 else {
              document.setText(resultText);
              fileDocumentManager.saveDocument(document);
            }
          }
        }
);
      }
    }
);
  }
  return simpleRequest;
}
