{
  Entry root=new RootEntry();
  createDirectory(root,1,"entry");
  createFile(root,2,"entry/file",new UnavailableContent(),-1);
  createDirectory(root,3,"entry/dir");
  Change c=new DeleteChange("entry");
  c.applyTo(root);
  os.writeChange(c);
  Change read=is.readChange();
  assertEquals(DeleteChange.class,read.getClass());
  DeleteChange result=(DeleteChange)read;
  assertEquals(list(idp(-1,1)),result.getAffectedIdPaths());
  Entry e=result.getAffectedEntry();
  assertEquals(DirectoryEntry.class,e.getClass());
  assertEquals("entry",e.getName());
  assertEquals(2,e.getChildren().size());
  assertEquals("entry/file",e.getChildren().get(0).getPath());
  assertEquals("entry/dir",e.getChildren().get(1).getPath());
}
