{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      final ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(module);
      final ModifiableRootModel model=moduleRootManager.getModifiableModel();
      final GradleProjectEntityImportListener publisher=module.getProject().getMessageBus().syncPublisher(GradleProjectEntityImportListener.TOPIC);
      for (      GradleContentRoot root : contentRoots) {
        publisher.onImportStart(root);
      }
      try {
        for (        GradleContentRoot contentRoot : contentRoots) {
          ContentEntry contentEntry=model.addContentEntry(toVfsUrl(contentRoot.getRootPath()));
          for (          String path : contentRoot.getPaths(SourceType.SOURCE)) {
            contentEntry.addSourceFolder(toVfsUrl(path),false);
          }
          for (          String path : contentRoot.getPaths(SourceType.TEST)) {
            contentEntry.addSourceFolder(toVfsUrl(path),true);
          }
          for (          String path : contentRoot.getPaths(SourceType.EXCLUDED)) {
            contentEntry.addExcludeFolder(toVfsUrl(path));
          }
        }
      }
  finally {
        model.commit();
        for (        GradleContentRoot root : contentRoots) {
          publisher.onImportEnd(root);
        }
      }
    }
  }
);
}
