{
  return ApplicationManager.getApplication().runReadAction(new NullableComputable<PsiElement>(){
    public PsiElement compute(){
      PsiFileImpl fileImpl=(PsiFileImpl)myFile;
      StubTree tree=fileImpl.getStubTree();
      boolean foreign=(tree == null);
      if (foreign) {
        tree=fileImpl.calcStubTree();
      }
      StubElement stub=tree.getPlainList().get(myIndex);
      if (foreign) {
        final PsiElement cachedPsi=((StubBase)stub).getCachedPsi();
        if (cachedPsi != null)         return cachedPsi;
        final ASTNode ast=fileImpl.findTreeForStub(tree,stub);
        return ast != null ? ast.getPsi() : null;
      }
 else {
        return stub != null ? stub.getPsi() : null;
      }
    }
  }
);
}
