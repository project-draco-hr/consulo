{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      final ModifiableRootModel rootModel=ModuleRootManager.getInstance(myModule).getModifiableModel();
      final ContentEntry[] content=rootModel.getContentEntries();
      boolean contentToChangeFound=false;
      for (      ContentEntry contentEntry : content) {
        final ContentFolder[] sourceFolders=contentEntry.getFolders(ContentFolderType.SOURCE);
        for (        ContentFolder sourceFolder : sourceFolders) {
          contentEntry.removeFolder(sourceFolder);
        }
        final VirtualFile contentRoot=contentEntry.getFile();
        if (contentRoot != null && VfsUtilCore.isAncestor(contentRoot,newSourceRoot,false)) {
          contentEntry.addFolder(newSourceRoot,ContentFolderType.SOURCE);
          contentToChangeFound=true;
        }
      }
      assertTrue(contentToChangeFound);
      rootModel.commit();
    }
  }
);
}
