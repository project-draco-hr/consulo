{
  final UrlSerializationHelper helper=new UrlSerializationHelper(SvnVcs.getInstance(myProject));
  final Map<String,SvnBranchConfiguration> map=object.myConfigurationMap;
  final Map<String,SvnBranchConfiguration> newMap=new HashMap<String,SvnBranchConfiguration>(map.size(),1);
  final LocalFileSystem lfs=LocalFileSystem.getInstance();
  final Set<Pair<VirtualFile,SvnBranchConfigurationNew>> whatToInit=new HashSet<Pair<VirtualFile,SvnBranchConfigurationNew>>();
  for (  Map.Entry<String,SvnBranchConfiguration> entry : map.entrySet()) {
    final SvnBranchConfiguration configuration=entry.getValue();
    final VirtualFile root=lfs.refreshAndFindFileByIoFile(new File(entry.getKey()));
    if (root == null) {
      LOG.info("root not found: " + entry.getKey());
      continue;
    }
    final SvnBranchConfiguration configToConvert;
    if ((!myConfigurationBean.mySupportsUserInfoFilter) || configuration.isUserinfoInUrl()) {
      configToConvert=helper.afterDeserialization(entry.getKey(),configuration);
    }
 else {
      configToConvert=configuration;
    }
    final SvnBranchConfigurationNew newConfig=new SvnBranchConfigurationNew();
    newConfig.setTrunkUrl(configToConvert.getTrunkUrl());
    newConfig.setUserinfoInUrl(configToConvert.isUserinfoInUrl());
    for (    String branchUrl : configToConvert.getBranchUrls()) {
      List<SvnBranchItem> stored=getStored(branchUrl);
      if (stored != null && !stored.isEmpty()) {
        newConfig.addBranches(branchUrl,new InfoStorage<List<SvnBranchItem>>(stored,InfoReliability.setByUser));
      }
 else {
        whatToInit.add(new Pair<VirtualFile,SvnBranchConfigurationNew>(root,newConfig));
        newConfig.addBranches(branchUrl,new InfoStorage<List<SvnBranchItem>>(new ArrayList<SvnBranchItem>(),InfoReliability.empty));
      }
    }
    myBunch.updateForRoot(root,new InfoStorage<SvnBranchConfigurationNew>(newConfig,InfoReliability.setByUser),null);
  }
  ((ProjectLevelVcsManagerImpl)myVcsManager).addInitializationRequest(VcsInitObject.BRANCHES,new Runnable(){
    public void run(){
      ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
        public void run(){
          try {
            for (            Pair<VirtualFile,SvnBranchConfigurationNew> pair : whatToInit) {
              final BranchesPreloader branchesPreloader=new BranchesPreloader(myProject,myBunch,pair.getFirst());
              branchesPreloader.setAll(true);
              branchesPreloader.loadImpl(null,pair.getSecond());
            }
          }
 catch (          ProcessCanceledException e) {
          }
        }
      }
);
    }
  }
);
  object.myConfigurationMap.clear();
  object.myConfigurationMap.putAll(newMap);
  myConfigurationBean=object;
}
