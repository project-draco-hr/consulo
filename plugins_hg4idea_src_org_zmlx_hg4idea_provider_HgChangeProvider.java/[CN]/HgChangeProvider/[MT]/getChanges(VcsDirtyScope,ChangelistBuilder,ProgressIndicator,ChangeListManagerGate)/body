{
  final Set<VirtualFile> processedRoots=new LinkedHashSet<VirtualFile>();
  final Collection<HgChange> changes=new HashSet<HgChange>();
  for (  FilePath filePath : dirtyScope.getRecursivelyDirtyDirectories()) {
    changes.addAll(process(builder,filePath,processedRoots));
  }
  for (  FilePath filePath : dirtyScope.getDirtyFiles()) {
    changes.addAll(process(builder,filePath,processedRoots));
  }
  processUnsavedChanges(builder,dirtyScope.getDirtyFilesNoExpand(),changes);
}
