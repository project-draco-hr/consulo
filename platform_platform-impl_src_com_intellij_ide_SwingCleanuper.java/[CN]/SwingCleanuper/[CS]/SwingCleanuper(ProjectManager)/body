{
  myAlarm=new Alarm();
  projectManager.addProjectManagerListener(new ProjectManagerAdapter(){
    public void projectOpened(    final Project project){
      myAlarm.cancelAllRequests();
    }
    public void projectClosed(    final Project project){
      myAlarm.cancelAllRequests();
      myAlarm.addRequest(new Runnable(){
        public void run(){
          final IdeFrameImpl frame;
          final Window window=KeyboardFocusManager.getCurrentKeyboardFocusManager().getFocusedWindow();
          if (window instanceof IdeFrameImpl) {
            frame=(IdeFrameImpl)window;
          }
 else {
            frame=(IdeFrameImpl)SwingUtilities.getAncestorOfClass(IdeFrameImpl.class,window);
          }
          if (frame != null) {
            final Application app=ApplicationManager.getApplication();
            if (app != null && app.isActive()) {
              ((JComponent)frame.getStatusBar()).requestFocus();
            }
          }
          SwingUtilities.invokeLater(new Runnable(){
            public void run(){
              try {
                final Field newFocusOwnerField=KeyboardFocusManager.class.getDeclaredField("newFocusOwner");
                newFocusOwnerField.setAccessible(true);
                newFocusOwnerField.set(null,null);
              }
 catch (              final Exception exc) {
              }
              final KeyboardFocusManager focusManager=FocusManager.getCurrentKeyboardFocusManager();
              resetField(focusManager,Component.class,"realOppositeComponent");
              resetField(focusManager,Window.class,"realOppositeWindow");
              try {
                final Object helperObject=ReflectionUtil.getField(BasicPopupMenuUI.class,null,Object.class,"menuKeyboardHelper");
                if (null != helperObject) {
                  resetField(helperObject,Component.class,"lastFocused");
                }
              }
 catch (              Exception e) {
              }
              try {
                final Field recognizerField=TransferHandler.class.getDeclaredField("recognizer");
                recognizerField.setAccessible(true);
                final Object recognizerObject=recognizerField.get(null);
                if (recognizerObject != null) {
                  final Method setComponentMethod=DragGestureRecognizer.class.getDeclaredMethod("setComponent",Component.class);
                  setComponentMethod.invoke(recognizerObject,new Object[]{null});
                }
              }
 catch (              Exception e) {
              }
              try {
                fixJTextComponentMemoryLeak();
              }
 catch (              NoSuchFieldException e) {
              }
catch (              Exception e) {
              }
              focusManager.setGlobalCurrentFocusCycleRoot(null);
              try {
                final Method m=KeyboardFocusManager.class.getDeclaredMethod("setGlobalFocusOwner",Component.class);
                m.setAccessible(true);
                m.invoke(focusManager,new Object[]{null});
              }
 catch (              Exception e) {
              }
              try {
                final Field f=KeyboardFocusManager.class.getDeclaredField("newFocusOwner");
                f.setAccessible(true);
                f.set(null,null);
              }
 catch (              Exception e) {
              }
              try {
                final Field f=KeyboardFocusManager.class.getDeclaredField("permanentFocusOwner");
                f.setAccessible(true);
                f.set(null,null);
              }
 catch (              Exception e) {
              }
              try {
                final Field f=KeyboardFocusManager.class.getDeclaredField("currentFocusCycleRoot");
                f.setAccessible(true);
                f.set(null,null);
              }
 catch (              Exception e) {
              }
            }
          }
);
        }
      }
,2500);
    }
  }
);
}
