{
  ExportToHTMLDialog exportToHTMLDialog=new ExportToHTMLDialog(myView.getProject(),exportToHTML);
  final ExportToHTMLSettings exportToHTMLSettings=ExportToHTMLSettings.getInstance(myView.getProject());
  if (exportToHTMLSettings.OUTPUT_DIRECTORY == null) {
    exportToHTMLSettings.OUTPUT_DIRECTORY=PathManager.getHomePath() + File.separator + "inspections";
  }
  exportToHTMLDialog.reset();
  exportToHTMLDialog.show();
  if (!exportToHTMLDialog.isOK()) {
    return;
  }
  exportToHTMLDialog.apply();
  final String outputDirectoryName=exportToHTMLSettings.OUTPUT_DIRECTORY;
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    @Override public void run(){
      final Runnable exportRunnable=new Runnable(){
        @Override public void run(){
          if (!exportToHTML) {
            dupm2XML(outputDirectoryName);
          }
 else {
            final HTMLExportFrameMaker maker=new HTMLExportFrameMaker(outputDirectoryName,myView.getProject());
            maker.start();
            try {
              final InspectionTreeNode root=myView.getTree().getRoot();
              TreeUtil.traverse(root,new TreeUtil.Traverse(){
                @Override public boolean accept(                final Object node){
                  if (node instanceof InspectionNode) {
                    exportHTML(maker,(InspectionNode)node);
                  }
                  return true;
                }
              }
);
            }
 catch (            ProcessCanceledException e) {
            }
            maker.done();
          }
        }
      }
;
      if (!ProgressManager.getInstance().runProcessWithProgressSynchronously(exportRunnable,exportToHTML ? InspectionsBundle.message("inspection.generating.html.progress.title") : InspectionsBundle.message("inspection.generating.xml.progress.title"),true,myView.getProject())) {
        return;
      }
      if (exportToHTML && exportToHTMLSettings.OPEN_IN_BROWSER) {
        BrowserUtil.browse(new File(exportToHTMLSettings.OUTPUT_DIRECTORY,"index.html"));
      }
    }
  }
);
}
