{
  final TextRange textRange=ElementManipulators.getValueTextRange(element);
  if (myCompiledValuePattern == null) {
    return Collections.singletonList(textRange);
  }
 else {
    final XmlAttribute attr=(XmlAttribute)element.getParent();
    final List<TextRange> ranges=getMatchingRanges(myCompiledValuePattern.matcher(attr.getDisplayValue()));
    return ranges.size() > 0 ? ContainerUtil.map(ranges,new Function<TextRange,TextRange>(){
      public TextRange fun(      TextRange s){
        return new TextRange(attr.displayToPhysical(s.getStartOffset()),attr.displayToPhysical(s.getEndOffset())).shiftRight(textRange.getStartOffset());
      }
    }
) : Collections.<TextRange>emptyList();
  }
}
