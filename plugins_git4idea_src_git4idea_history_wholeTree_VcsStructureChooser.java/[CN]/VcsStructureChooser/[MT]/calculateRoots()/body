{
  final ProjectLevelVcsManager vcsManager=ProjectLevelVcsManager.getInstance(myVcs.getProject());
  final VirtualFile[] rootsUnderVcs=vcsManager.getRootsUnderVcs(myVcs);
  final ModuleManager moduleManager=ModuleManager.getInstance(myVcs.getProject());
  final Module[] modules=ApplicationManager.getApplication().runReadAction(new Computable<Module[]>(){
    public Module[] compute(){
      return moduleManager.getModules();
    }
  }
);
  myRoots=new HashSet<VirtualFile>();
  myRoots.addAll(Arrays.asList(rootsUnderVcs));
  myModulesSet=new HashMap<VirtualFile,String>();
  for (  Module module : modules) {
    final VirtualFile[] files=ModuleRootManager.getInstance(module).getContentRoots();
    for (    VirtualFile file : files) {
      if (myVcs.equals(vcsManager.getVcsFor(file))) {
        myModulesSet.put(file,module.getName());
        myRoots.add(file);
      }
    }
  }
}
