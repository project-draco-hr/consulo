{
  if (elements.length == 0)   return;
  int flags=HIDE_BY_ESCAPE;
  if (hideByTextChange) {
    flags|=HIDE_BY_TEXT_CHANGE;
  }
  Color scrollmarkColor=getScrollMarkColor(attributes);
  if (editor instanceof EditorWindow) {
    editor=((EditorWindow)editor).getDelegate();
  }
  for (  PsiElement element : elements) {
    TextRange range=element.getTextRange();
    int offset=PsiUtilBase.findInjectedElementOffsetInRealDocument(element);
    int start=range.getStartOffset() + offset;
    int end=range.getEndOffset() + offset;
    addOccurrenceHighlight(editor,start,end,attributes,flags,outHighlighters,scrollmarkColor);
  }
}
