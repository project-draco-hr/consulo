{
  final long curModCount=getManager().getModificationTracker().getModificationCount();
  long curExtResourcesModCount=ExternalResourceManagerEx.getInstanceEx().getModificationCount(getProject());
  if (myDescriptorModCount != curModCount || myExtResourcesModCount != curExtResourcesModCount) {
    if (myExtResourcesModCount != curExtResourcesModCount) {
      myNSDescriptorsMap=null;
    }
    RecursionGuard.StackStamp stamp=ourGuard.markStack();
    XmlElementDescriptor descriptor=computeElementDescriptor();
    if (!stamp.mayCacheNow()) {
      return descriptor;
    }
    myCachedDescriptor=descriptor;
    myDescriptorModCount=curModCount;
    myExtResourcesModCount=curExtResourcesModCount;
  }
  return myCachedDescriptor;
}
