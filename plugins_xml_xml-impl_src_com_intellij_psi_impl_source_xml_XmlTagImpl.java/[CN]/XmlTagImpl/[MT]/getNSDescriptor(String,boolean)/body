{
  final XmlTag parentTag=getParentTag();
  if (parentTag == null && namespace.equals(XmlUtil.XHTML_URI)) {
    final XmlNSDescriptor descriptor=getDtdDescriptor(XmlUtil.getContainingFile(this));
    if (descriptor != null) {
      return descriptor;
    }
  }
  Map<String,CachedValue<XmlNSDescriptor>> map=initNSDescriptorsMap();
  final CachedValue<XmlNSDescriptor> descriptor=map.get(namespace);
  if (descriptor != null) {
    final XmlNSDescriptor value=descriptor.getValue();
    if (value != null) {
      return value;
    }
  }
  if (parentTag == null) {
    final XmlDocument parentOfType=PsiTreeUtil.getParentOfType(this,XmlDocument.class);
    if (parentOfType == null) {
      return null;
    }
    return parentOfType.getDefaultNSDescriptor(namespace,strict);
  }
  return parentTag.getNSDescriptor(namespace,strict);
}
