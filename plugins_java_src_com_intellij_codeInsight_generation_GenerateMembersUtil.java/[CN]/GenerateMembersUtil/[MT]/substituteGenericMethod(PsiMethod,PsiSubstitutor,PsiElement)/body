{
  final Project project=sourceMethod.getProject();
  final JVMElementFactory factory=getFactory(sourceMethod,target);
  final JavaCodeStyleManager codeStyleManager=JavaCodeStyleManager.getInstance(project);
  try {
    final PsiMethod resultMethod=createMethod(factory,sourceMethod,target);
    copyDocComment(sourceMethod,resultMethod,factory);
    copyModifiers(sourceMethod.getModifierList(),resultMethod.getModifierList());
    final PsiSubstitutor collisionResolvedSubstitutor=substituteTypeParameters(factory,target,sourceMethod.getTypeParameterList(),resultMethod.getTypeParameterList(),substitutor,sourceMethod);
    substituteReturnType(PsiManager.getInstance(project),resultMethod,sourceMethod.getReturnType(),collisionResolvedSubstitutor);
    substituteParameters(factory,codeStyleManager,sourceMethod.getParameterList(),resultMethod.getParameterList(),collisionResolvedSubstitutor,target);
    final List<PsiClassType> thrownTypes=ExceptionUtil.collectSubstituted(collisionResolvedSubstitutor,sourceMethod.getThrowsList().getReferencedTypes());
    if (target instanceof PsiClass) {
      final PsiClass[] supers=((PsiClass)target).getSupers();
      for (      PsiClass aSuper : supers) {
        final PsiMethod psiMethod=aSuper.findMethodBySignature(sourceMethod,true);
        if (psiMethod != null && psiMethod != sourceMethod) {
          ExceptionUtil.retainExceptions(thrownTypes,ExceptionUtil.collectSubstituted(TypeConversionUtil.getSuperClassSubstitutor(aSuper,(PsiClass)target,PsiSubstitutor.EMPTY),psiMethod.getThrowsList().getReferencedTypes()));
        }
      }
    }
    substituteThrows(factory,resultMethod.getThrowsList(),collisionResolvedSubstitutor,sourceMethod,thrownTypes);
    return resultMethod;
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
    return sourceMethod;
  }
}
