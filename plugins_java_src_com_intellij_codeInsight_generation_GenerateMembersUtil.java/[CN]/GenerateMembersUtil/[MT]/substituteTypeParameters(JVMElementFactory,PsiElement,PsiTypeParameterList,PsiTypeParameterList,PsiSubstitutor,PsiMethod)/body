{
  if (sourceTypeParameterList == null || targetTypeParameterList == null) {
    return substitutor;
  }
  final Map<PsiTypeParameter,PsiType> substitutionMap=new HashMap<PsiTypeParameter,PsiType>(substitutor.getSubstitutionMap());
  for (  PsiTypeParameter typeParam : sourceTypeParameterList.getTypeParameters()) {
    final PsiTypeParameter substitutedTypeParam=substituteTypeParameter(factory,typeParam,substitutor,sourceMethod);
    final PsiTypeParameter resolvedTypeParam=resolveTypeParametersCollision(factory,sourceTypeParameterList,target,substitutedTypeParam,substitutor);
    targetTypeParameterList.add(resolvedTypeParam);
    if (substitutedTypeParam != resolvedTypeParam) {
      substitutionMap.put(typeParam,factory.createType(resolvedTypeParam));
    }
  }
  return substitutionMap.isEmpty() ? substitutor : factory.createSubstitutor(substitutionMap);
}
