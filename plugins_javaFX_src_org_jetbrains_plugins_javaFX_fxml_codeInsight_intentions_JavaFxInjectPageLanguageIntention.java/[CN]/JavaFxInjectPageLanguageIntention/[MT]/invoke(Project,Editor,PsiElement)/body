{
  if (!CodeInsightUtilBase.preparePsiElementsForWrite(element))   return;
  final XmlFile containingFile=(XmlFile)element.getContainingFile();
  final Set<String> availableLanguages=getAvailableLanguages(project);
  if (availableLanguages.size() == 1) {
    registerPageLanguage(project,containingFile,availableLanguages.iterator().next());
  }
 else {
    final JBList list=new JBList(availableLanguages);
    JBPopupFactory.getInstance().createListPopupBuilder(list).setItemChoosenCallback(new Runnable(){
      @Override public void run(){
        registerPageLanguage(project,containingFile,(String)list.getSelectedValue());
      }
    }
).createPopup().showInBestPositionFor(editor);
  }
}
