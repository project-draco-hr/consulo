{
  final VirtualFile[] files=dir.getVirtualFile().getChildren();
  if (files.length == 0) {
    return false;
  }
  PsiManager manager=dir.getManager();
  int subpackagesCount=0;
  int directoriesCount=0;
  for (  VirtualFile file : files) {
    if (FileTypeManager.getInstance().isFileIgnored(file))     continue;
    if (!file.isDirectory())     return false;
    PsiDirectory childDir=manager.findDirectory(file);
    if (childDir != null) {
      directoriesCount++;
      if (strictlyEmpty && directoriesCount > 1)       return false;
      final PsiPackageManager psiPackageManager=PsiPackageManager.getInstance(dir.getProject());
      PsiPackage tempPackage=moduleExtensionClass == null ? psiPackageManager.findAnyPackage(childDir) : psiPackageManager.findPackage(dir,moduleExtensionClass);
      if (tempPackage != null) {
        subpackagesCount++;
      }
    }
  }
  if (strictlyEmpty) {
    return directoriesCount == subpackagesCount && directoriesCount == 1;
  }
  return directoriesCount == subpackagesCount && directoriesCount > 0;
}
