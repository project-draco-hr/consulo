{
  Map<Integer,ByteBufferWrapper> buffers=getBuffersOrderedForOwner(index,storageLockContext);
  if (buffers != null) {
    mySegmentsAllocationLock.lock();
    try {
      Disposable fileContext=null;
      for (      ByteBufferWrapper buffer : buffers.values()) {
        if (buffer instanceof ReadWriteDirectBufferWrapper) {
          fileContext=((ReadWriteDirectBufferWrapper)buffer).flushWithContext(fileContext);
        }
 else {
          buffer.flush();
        }
      }
      if (fileContext != null) {
        fileContext.dispose();
      }
    }
  finally {
      mySegmentsAllocationLock.unlock();
    }
  }
}
