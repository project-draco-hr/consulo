{
  List<ReadWriteVariableInstruction> result=new ArrayList<ReadWriteVariableInstruction>();
  TObjectIntHashMap<String> namesIndex=buildNamesIndex(flow);
  TIntObjectHashMap<TIntHashSet> written=new TIntObjectHashMap<TIntHashSet>(flow.length);
  boolean[] visited=new boolean[flow.length];
  for (int i=0; i < visited.length; i++)   visited[i]=false;
  CallEnvironment env=new CallEnvironment.DepthFirstCallEnvironment();
  for (int i=0; i < flow.length; i++) {
    if (!visited[i])     doVisitForReadsBeforeWrites(flow[i],written,result,env,namesIndex,visited);
  }
  return result.toArray(new ReadWriteVariableInstruction[result.size()]);
}
