{
  final Collection<VirtualFile> roots=new ArrayList<VirtualFile>(1);
  if (root == null) {
    for (    VcsRoot vcsRoot : myVcsManager.getAllVcsRoots()) {
      if (vcsRoot.vcs != null && vcsRoot.vcs instanceof GitVcs && vcsRoot.path != null) {
        roots.add(vcsRoot.path);
      }
    }
  }
 else {
    roots.add(root);
  }
  final Project project=getProject();
  final Task.Backgroundable task=new Task.Backgroundable(project,"Loading Git branch info"){
    @Override public void run(    @NotNull ProgressIndicator indicator){
      for (      VirtualFile root : roots) {
        try {
          GitBranch currentBranch=GitBranch.current(project,root);
synchronized (myCurrentBranches) {
            myCurrentBranches.put(root,currentBranch);
          }
        }
 catch (        VcsException e) {
          LOG.info("Exception while trying to get current branch for root " + root,e);
        }
      }
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          updateUI();
        }
      }
);
    }
  }
;
  if (project != null) {
    GitVcs.getInstance(project).runInBackground(task);
  }
}
