{
  PsiCodeBlock block=getControlStatementBlock(editor.getCaretModel().getOffset(),psiElement);
  if (processExistingBlankLine(editor,block,psiElement)) {
    return true;
  }
  EditorActionHandler enterHandler=getEnterHandler(IdeActions.ACTION_EDITOR_START_NEW_LINE);
  if (block != null) {
    PsiElement firstElement=block.getFirstBodyElement();
    if (firstElement == null) {
      firstElement=block.getRBrace();
      enterHandler=getEnterHandler(IdeActions.ACTION_EDITOR_ENTER);
    }
    editor.getCaretModel().moveToOffset(firstElement != null ? firstElement.getTextRange().getStartOffset() : block.getTextRange().getEndOffset());
  }
  enterHandler.execute(editor,((EditorEx)editor).getDataContext());
  return true;
}
