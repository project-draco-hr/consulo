{
  String url=null;
  if (descriptor instanceof PluginNode) {
    url=((PluginNode)descriptor).getDownloadUrl();
  }
  if (url == null) {
    url=RepositoryHelper.buildUrlForDownload(consulo.ide.updateSettings.UpdateSettings.getInstance().getChannel(),descriptor.getPluginId().toString());
  }
  PluginDownloader downloader=new PluginDownloader(descriptor.getPluginId().getIdString(),url,null,null,descriptor.getName());
  downloader.setDescriptor(descriptor);
  return downloader;
}
