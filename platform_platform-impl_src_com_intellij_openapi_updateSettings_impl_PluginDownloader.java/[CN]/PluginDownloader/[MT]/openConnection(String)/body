{
  final URLConnection connection=new URL(url).openConnection();
  if (connection instanceof HttpURLConnection) {
    final int responseCode=((HttpURLConnection)connection).getResponseCode();
    if (responseCode != HttpURLConnection.HTTP_OK) {
      String location=null;
      if (responseCode == HttpURLConnection.HTTP_MOVED_PERM || responseCode == HttpURLConnection.HTTP_MOVED_TEMP) {
        location=connection.getHeaderField("Location");
      }
      if (location == null) {
        throw new IOException(IdeBundle.message("error.connection.failed.with.http.code.N",responseCode));
      }
 else {
        myPluginUrl=location;
        ((HttpURLConnection)connection).disconnect();
        return openConnection(location);
      }
    }
  }
  return connection;
}
