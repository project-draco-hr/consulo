{
  IdeaPluginDescriptorImpl descriptor=PluginManager.loadDescriptorFromJar(file);
  if (descriptor == null) {
    if (file.getName().endsWith(".zip")) {
      final File outputDir=FileUtil.createTempDirectory("plugin","");
      try {
        ZipUtil.extract(file,outputDir,new FilenameFilter(){
          public boolean accept(          final File dir,          final String name){
            return true;
          }
        }
);
        final File[] files=outputDir.listFiles();
        if (files != null && files.length == 1) {
          descriptor=PluginManager.loadDescriptor(files[0],PluginManager.PLUGIN_XML);
        }
      }
  finally {
        FileUtil.delete(outputDir);
      }
    }
  }
  return descriptor;
}
