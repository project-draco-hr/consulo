{
  File pluginsTemp=new File(PathManager.getPluginTempPath());
  if (!pluginsTemp.exists() && !pluginsTemp.mkdirs()) {
    throw new IOException(IdeBundle.message("error.cannot.create.temp.dir",pluginsTemp));
  }
  final File file=FileUtil.createTempFile(pluginsTemp,"plugin_","_download",true,false);
  indicator.checkCanceled();
  indicator.setText2(IdeBundle.message("progress.downloading.plugin",getPluginName()));
  return HttpRequests.request(myPluginUrl).gzip(false).connect(new HttpRequests.RequestProcessor<File>(){
    @Override public File process(    @NotNull HttpRequests.Request request) throws IOException {
      request.saveToFile(file,indicator);
      String fileName=guessFileName(request.getConnection(),file);
      File newFile=new File(file.getParentFile(),fileName);
      FileUtil.rename(file,newFile);
      return newFile;
    }
  }
);
}
