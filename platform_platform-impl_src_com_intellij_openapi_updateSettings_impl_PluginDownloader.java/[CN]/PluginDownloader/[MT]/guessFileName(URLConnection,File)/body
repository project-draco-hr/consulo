{
  String contentDisposition=connection.getHeaderField("Content-Disposition");
  if (contentDisposition == null || !contentDisposition.contains(FILENAME)) {
    String usedURL=connection.getURL().toString();
    int startPos=usedURL.lastIndexOf("/");
    myFileName=usedURL.substring(startPos + 1);
    if (myFileName.length() == 0 || myFileName.contains("?")) {
      myFileName=myPluginUrl.substring(myPluginUrl.lastIndexOf("/") + 1);
    }
  }
 else {
    int startIdx=contentDisposition.indexOf(FILENAME);
    myFileName=contentDisposition.substring(startIdx + FILENAME.length(),contentDisposition.length());
    if (myFileName.startsWith("\"") && myFileName.endsWith("\"")) {
      myFileName=myFileName.substring(1,myFileName.length() - 1);
    }
    if (myFileName.indexOf('\\') >= 0 || myFileName.indexOf('/') >= 0 || myFileName.indexOf(File.separatorChar) >= 0 || myFileName.indexOf('\"') >= 0) {
      FileUtil.delete(file);
      throw new IOException("Invalid filename returned by server");
    }
  }
}
