{
  PsiElement host=super.restoreElement();
  if (host == null)   return null;
  Segment segment=myInjectedFileRangeInHostFile.getRange();
  if (segment == null)   return null;
  final TextRange rangeInHostFile=TextRange.create(segment);
  final Ref<PsiElement> result=new Ref<PsiElement>();
  final InjectedLanguageManager manager=InjectedLanguageManager.getInstance(getProject());
  InjectedLanguageUtil.enumerate(host,host.getContainingFile(),new PsiLanguageInjectionHost.InjectedPsiVisitor(){
    @Override public void visit(    @NotNull PsiFile injectedPsi,    @NotNull List<PsiLanguageInjectionHost.Shred> places){
      if (result.get() != null)       return;
      TextRange hostRange=manager.injectedToHost(injectedPsi,new TextRange(0,injectedPsi.getTextLength()));
      Document document=PsiDocumentManager.getInstance(getProject()).getDocument(injectedPsi);
      if (hostRange.contains(rangeInHostFile) && document instanceof DocumentWindow) {
        int start=((DocumentWindow)document).hostToInjected(rangeInHostFile.getStartOffset());
        int end=((DocumentWindow)document).hostToInjected(rangeInHostFile.getEndOffset());
        PsiElement element=findElementInside(injectedPsi,start,end,anchorClass,anchorLanguage);
        result.set(element);
      }
    }
  }
,true);
  return result.get();
}
