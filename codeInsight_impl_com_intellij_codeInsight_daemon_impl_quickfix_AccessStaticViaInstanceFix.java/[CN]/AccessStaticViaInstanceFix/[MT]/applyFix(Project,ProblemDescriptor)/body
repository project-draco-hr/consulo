{
  if (!CodeInsightUtil.prepareFileForWrite(myExpression.getContainingFile()))   return;
  PsiClass containingClass=myMember.getContainingClass();
  if (containingClass == null)   return;
  try {
    PsiExpression qualifierExpression=myExpression.getQualifierExpression();
    PsiElementFactory factory=PsiManager.getInstance(project).getElementFactory();
    if (qualifierExpression instanceof PsiThisExpression && ((PsiThisExpression)qualifierExpression).getQualifier() == null) {
      qualifierExpression.delete();
      if (myExpression.resolve() != myMember) {
        PsiReferenceExpression expr=(PsiReferenceExpression)factory.createExpressionFromText("A.foo",myExpression);
        expr.getQualifierExpression().replace(factory.createReferenceExpression(containingClass));
        expr.getReferenceNameElement().replace(myExpression);
        myExpression.replace(expr);
      }
    }
 else {
      qualifierExpression.replace(factory.createReferenceExpression(containingClass));
    }
    UndoManager.getInstance(project).markDocumentForUndo(myMember.getContainingFile());
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
}
