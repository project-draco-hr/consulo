{
  try {
    URL url=new URL(dtdUrl);
    URLConnection urlConnection=url.openConnection();
    int contentLength=urlConnection.getContentLength();
    int bytesRead=0;
    ByteArrayOutputStream out=new ByteArrayOutputStream();
    InputStream in=urlConnection.getInputStream();
    String contentType=urlConnection.getContentType();
    if (!ApplicationManager.getApplication().isUnitTestMode() && contentType.equals("text/html")) {
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          Messages.showMessageDialog(project,"No xml at the location: \n" + dtdUrl,"Invalid URL",Messages.getErrorIcon());
        }
      }
,indicator.getModalityState());
      return null;
    }
    byte[] buffer=new byte[256];
    while (true) {
      int read=in.read(buffer);
      if (read < 0)       break;
      out.write(buffer,0,read);
      bytesRead+=read;
      indicator.setFraction((double)bytesRead / (double)contentLength);
    }
    in.close();
    out.close();
    return out.toByteArray();
  }
 catch (  MalformedURLException e) {
    if (!ApplicationManager.getApplication().isUnitTestMode()) {
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          Messages.showMessageDialog(project,"Invalid URL: \n" + dtdUrl,"Invalid URL",Messages.getErrorIcon());
        }
      }
,indicator.getModalityState());
    }
  }
  return null;
}
