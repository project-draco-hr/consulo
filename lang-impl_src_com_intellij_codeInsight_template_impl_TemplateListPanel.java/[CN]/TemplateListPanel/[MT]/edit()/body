{
  int selected=myTreeTable.getSelectedRow();
  if (selected < 0)   return;
  TemplateImpl template=getTemplate(selected);
  DefaultMutableTreeNode oldTemplateNode=getNode(selected);
  if (template == null)   return;
  String oldGroupName=template.getGroupName();
  EditTemplateDialog dialog=new EditTemplateDialog(this,CodeInsightBundle.message("dialog.edit.live.template.title"),template,getTemplateGroups(),(String)myExpandByCombo.getSelectedItem());
  dialog.show();
  if (!dialog.isOK())   return;
  TemplateGroup group=getTemplateGroup(template.getGroupName());
  LOG.assertTrue(group != null,template.getGroupName());
  dialog.apply();
  AbstractTableModel model=(AbstractTableModel)myTreeTable.getModel();
  if (!oldGroupName.equals(template.getGroupName())) {
    TemplateGroup oldGroup=getTemplateGroup(oldGroupName);
    oldGroup.removeTemplate(template);
    template.setId(null);
    JTree tree=myTreeTable.getTree();
    DefaultMutableTreeNode parent=(DefaultMutableTreeNode)oldTemplateNode.getParent();
    removeNodeFromParent(oldTemplateNode);
    if (parent.getChildCount() == 0)     removeNodeFromParent(parent);
    DefaultMutableTreeNode templateNode=addTemplate(template);
    TreePath newTemplatePath=new TreePath(templateNode.getPath());
    tree.expandPath(newTemplatePath);
    selected=tree.getRowForPath(newTemplatePath);
    model.fireTableStructureChanged();
  }
  model.fireTableRowsUpdated(selected,selected);
  myTreeTable.setRowSelectionInterval(selected,selected);
  updateTemplateTextArea();
  isModified=true;
}
