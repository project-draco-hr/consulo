{
  if (!myUpdateNeeded)   return;
  myAlarm.cancelAllRequests();
  myAlarm.addRequest(new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          int selected=getSelectedIndex();
          if (selected < 0) {
            myEditor.getDocument().replaceString(0,myEditor.getDocument().getTextLength(),"");
          }
 else {
            TemplateImpl template=getTemplate(selected);
            if (template != null) {
              String text=template.getString();
              myEditor.getDocument().replaceString(0,myEditor.getDocument().getTextLength(),text);
              TemplateEditorUtil.setHighlighter(myEditor,template.getTemplateContext());
            }
 else {
              myEditor.getDocument().replaceString(0,myEditor.getDocument().getTextLength(),"");
            }
          }
        }
      }
);
    }
  }
,100);
}
