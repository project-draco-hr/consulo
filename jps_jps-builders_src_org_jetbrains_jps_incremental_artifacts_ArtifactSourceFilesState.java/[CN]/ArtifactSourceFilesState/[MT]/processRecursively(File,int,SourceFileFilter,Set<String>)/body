{
  final String filePath=FileUtil.toSystemIndependentName(FileUtil.toCanonicalPath(file.getPath()));
  if (!filter.accept(filePath))   return;
  if (file.isDirectory()) {
    final File[] children=file.listFiles();
    if (children != null) {
      for (      File child : children) {
        processRecursively(child,rootIndex,filter,currentPaths);
      }
    }
  }
 else {
    currentPaths.add(filePath);
    final ArtifactSourceTimestampStorage.PerArtifactTimestamp[] state=myTimestampStorage.getState(filePath);
    boolean upToDate=false;
    if (state != null) {
      for (      ArtifactSourceTimestampStorage.PerArtifactTimestamp artifactTimestamp : state) {
        if (artifactTimestamp.myArtifactId == myArtifactId && artifactTimestamp.myTimestamp == file.lastModified()) {
          upToDate=true;
          break;
        }
      }
    }
    if (!upToDate) {
      myDeletedFiles.remove(filePath);
      IntArrayList list=myChangedFiles.get(filePath);
      if (list == null) {
        list=new IntArrayList(1);
        myChangedFiles.put(filePath,list);
      }
      list.add(rootIndex);
    }
  }
}
