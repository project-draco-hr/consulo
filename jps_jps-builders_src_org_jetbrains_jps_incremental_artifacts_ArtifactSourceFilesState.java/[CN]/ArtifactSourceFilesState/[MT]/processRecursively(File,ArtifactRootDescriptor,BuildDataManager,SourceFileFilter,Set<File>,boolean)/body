{
  final String filePath=FileUtil.toSystemIndependentName(FileUtil.toCanonicalPath(file.getPath()));
  if (!filter.accept(filePath,dataManager))   return;
  if (file.isDirectory()) {
    final File[] children=file.listFiles();
    if (children != null) {
      for (      File child : children) {
        processRecursively(child,descriptor,dataManager,filter,currentPaths,forceMarkDirty);
      }
    }
  }
 else {
    if (currentPaths != null) {
      currentPaths.add(file);
    }
    if (forceMarkDirty || myProjectDescriptor.timestamps.getStorage().getStamp(file,myTarget) != FileSystemUtil.lastModified(file)) {
      myProjectDescriptor.fsState.markDirty(null,file,descriptor,myProjectDescriptor.timestamps.getStorage(),false);
    }
  }
}
