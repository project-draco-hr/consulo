{
  final PsiClass psiClass=PsiTreeUtil.getChildOfType(file,PsiClass.class);
  if (psiClass == null) {
    return null;
  }
  final String qualifiedName=psiClass.getQualifiedName();
  if (CLASSES_WITHOUT_TEST_DATA.contains(qualifiedName)) {
    return null;
  }
  final Pair<TestDataDescriptor,Long> cached=CACHE.get(qualifiedName);
  if (cached != null) {
    if (cached.first.isComplete()) {
      return cached.first;
    }
    if (cached.second > System.currentTimeMillis()) {
      return null;
    }
  }
  TestFramework[] frameworks=Extensions.getExtensions(TestFramework.EXTENSION_NAME);
  TestFramework framework=null;
  for (  TestFramework each : frameworks) {
    if (each.isTestClass(psiClass)) {
      framework=each;
      break;
    }
  }
  if (framework == null) {
    return null;
  }
  final PsiElement setUpMethod=framework.findSetUpMethod(psiClass);
  final PsiElement tearDownMethod=framework.findTearDownMethod(psiClass);
  List<String> testNames=new ArrayList<String>();
  for (  PsiMethod method : psiClass.getMethods()) {
    final String name=getTestName(method.getName());
    if (StringUtil.isEmpty(name) || method == setUpMethod || method == tearDownMethod || name.equals(psiClass.getName()) || isUtilityMethod(method,psiClass,framework)) {
      continue;
    }
    testNames.add(name);
  }
  ProjectFileIndex fileIndex=ProjectRootManager.getInstance(psiClass.getProject()).getFileIndex();
  final TestDataDescriptor descriptor=buildDescriptor(gotoModel,fileIndex,testNames,psiClass);
  if (isClassWithoutTestData(descriptor,testNames,psiClass)) {
    CLASSES_WITHOUT_TEST_DATA.add(qualifiedName);
    return null;
  }
  CACHE.put(qualifiedName,new Pair<TestDataDescriptor,Long>(descriptor,System.currentTimeMillis() + CACHE_ENTRY_TTL_MS));
  return descriptor;
}
