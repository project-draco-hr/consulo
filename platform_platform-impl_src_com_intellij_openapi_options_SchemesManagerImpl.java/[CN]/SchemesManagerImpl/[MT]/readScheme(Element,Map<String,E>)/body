{
  if (element.getName().equals("shared-scheme")) {
    String schemeName=element.getAttributeValue(NAME);
    if (filter.containsKey(schemeName)) {
      return null;
    }
    String schemePath=element.getAttributeValue("original-scheme-path");
    Element sharedElement=myProvider != null && myProvider.isEnabled() ? loadElementOrNull(myProvider.loadContent(schemePath,myRoamingType)) : null;
    if (sharedElement == null) {
      Element localCopyElement=element.getChild("scheme-local-copy");
      E scheme=localCopyElement == null ? null : doReadScheme(localCopyElement.getChildren().get(0));
      return scheme == null || filter.containsKey(scheme.getName()) ? null : scheme;
    }
 else {
      E result=readScheme(sharedElement,Collections.<String,E>emptyMap());
      if (result != null) {
        renameScheme(result,schemeName);
      }
      return result;
    }
  }
 else   if (element.getName().equals("shared-scheme-original")) {
    E scheme=doReadScheme(element.getChildren().get(0));
    if (scheme == null || filter.containsKey(scheme.getName())) {
      return null;
    }
    renameScheme(scheme,element.getAttributeValue(NAME));
    return scheme;
  }
 else {
    E scheme=doReadScheme(element);
    return scheme == null || filter.containsKey(scheme.getName()) ? null : scheme;
  }
}
