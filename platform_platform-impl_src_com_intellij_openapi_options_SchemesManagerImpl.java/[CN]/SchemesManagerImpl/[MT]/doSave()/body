{
  myInsideSave=true;
  try {
    ApplicationManager.getApplication().runWriteAction(new DocumentRunnable.IgnoreDocumentRunnable(){
      public void run(){
        ((NewVirtualFile)myVFSBaseDir).markDirtyRecursively();
        myVFSBaseDir.refresh(false,true);
      }
    }
);
    Collection<T> schemes=getAllSchemes();
    myBaseDir.mkdirs();
    UniqueFileNamesProvider fileNameProvider=new UniqueFileNamesProvider();
    reserveUsingFileNames(schemes,fileNameProvider);
    ApplicationManager.getApplication().runWriteAction(new DocumentRunnable.IgnoreDocumentRunnable(){
      public void run(){
        deleteFilesFromDeletedSchemes();
      }
    }
);
    saveSchemes(schemes,fileNameProvider);
    if (myDeletedNames.isEmpty()) {
      deleteServerFiles(DELETED_XML);
    }
 else {
      for (      StreamProvider provider : getEnabledProviders()) {
        try {
          StorageUtil.sendContent(provider,getFileFullPath(DELETED_XML),createDeletedDocument(),myRoamingType,true);
        }
 catch (        IOException e) {
          LOG.debug(e);
        }
      }
    }
  }
  finally {
    myInsideSave=false;
  }
}
