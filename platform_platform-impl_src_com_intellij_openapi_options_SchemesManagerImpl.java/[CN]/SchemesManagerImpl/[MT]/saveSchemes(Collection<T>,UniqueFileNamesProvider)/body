{
  for (  T scheme : schemes) {
    if (isExternalizable(scheme)) {
      @SuppressWarnings("unchecked") final E eScheme=(E)scheme;
      eScheme.getExternalInfo().setPreviouslySavedName(eScheme.getName());
      if (myProcessor.shouldBeSaved(eScheme)) {
        final String fileName=getFileNameForScheme(fileNameProvider,eScheme);
        try {
          final Document document=writeSchemeToDocument(eScheme);
          if (document != null) {
            long newHash=computeHashValue(document);
            Long oldHash=eScheme.getExternalInfo().getHash();
            saveIfNeeded(eScheme,fileName,document,newHash,oldHash);
          }
        }
 catch (        final IOException e) {
          Application app=ApplicationManager.getApplication();
          if (app.isUnitTestMode() || app.isCommandLine()) {
            LOG.error("Cannot write scheme " + fileName + " in '"+ myFileSpec+ "': "+ e.getLocalizedMessage(),e);
          }
 else {
            app.invokeLater(new Runnable(){
              @Override public void run(){
                Messages.showErrorDialog("Cannot save scheme '" + eScheme.getName() + ": "+ e.getLocalizedMessage(),"Save Settings");
              }
            }
);
          }
        }
      }
    }
  }
}
