{
  final PsiFile containingFile=root.getContainingFile();
  final VirtualFile virtualFile=containingFile.getVirtualFile();
  if (virtualFile == null)   return;
  FileHighlighingSetting[] defaults=myHighlightSettings.get(virtualFile);
  if (defaults == null)   defaults=getDefaults(containingFile);
  defaults[PsiUtil.getRootIndex(root)]=setting;
  boolean toRemove=true;
  for (  FileHighlighingSetting aDefault : defaults) {
    if (aDefault != FileHighlighingSetting.NONE)     toRemove=false;
  }
  if (!toRemove) {
    myHighlightSettings.put(virtualFile,defaults);
  }
 else {
    myHighlightSettings.remove(virtualFile);
  }
}
