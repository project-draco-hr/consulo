{
  if (thisModule == null)   return Collections.emptyList();
  Set<Module> modules=new com.intellij.util.containers.HashSet<Module>();
  ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(thisModule);
  ModuleUtil.getDependencies(thisModule,modules);
  List<PsiFileSystemItem> result=new ArrayList<PsiFileSystemItem>();
  final PsiManager psiManager=PsiManager.getInstance(thisModule.getProject());
  if (includingClasses) {
    VirtualFile[] libraryUrls=moduleRootManager.orderEntries().getAllLibrariesAndSdkClassesRoots();
    for (    VirtualFile file : libraryUrls) {
      PsiDirectory directory=psiManager.findDirectory(file);
      if (directory != null) {
        result.add(directory);
      }
    }
  }
  VirtualFile[] sourceRoots=moduleRootManager.orderEntries().recursively().withoutSdk().withoutLibraries().getSourceRoots();
  for (  VirtualFile root : sourceRoots) {
    final PsiDirectory directory=psiManager.findDirectory(root);
    if (directory != null) {
      final PsiPackage aPackage=JavaDirectoryService.getInstance().getPackage(directory);
      if (aPackage != null && aPackage.getName() != null) {
        result.add(PackagePrefixFileSystemItem.create(directory));
      }
 else {
        result.add(directory);
      }
    }
  }
  return result;
}
