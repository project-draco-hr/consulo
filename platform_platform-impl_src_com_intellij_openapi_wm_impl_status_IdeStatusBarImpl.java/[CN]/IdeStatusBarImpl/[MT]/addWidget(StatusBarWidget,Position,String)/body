{
  JPanel panel;
  if (pos == Position.RIGHT) {
    if (myRightPanel == null) {
      myRightPanel=new JPanel();
      myRightPanel.setLayout(new BoxLayout(myRightPanel,BoxLayout.X_AXIS));
      myRightPanel.setOpaque(false);
      add(myRightPanel,BorderLayout.EAST);
    }
    panel=myRightPanel;
  }
 else   if (pos == Position.LEFT) {
    if (myLeftPanel == null) {
      myLeftPanel=new JPanel();
      myLeftPanel.setLayout(new BoxLayout(myLeftPanel,BoxLayout.X_AXIS));
      myLeftPanel.setOpaque(false);
      add(myLeftPanel,BorderLayout.WEST);
    }
    panel=myLeftPanel;
  }
 else {
    if (myCenterPanel == null) {
      myCenterPanel=new JPanel(new BorderLayout());
      myCenterPanel.setOpaque(false);
      add(myCenterPanel,BorderLayout.CENTER);
    }
    panel=myCenterPanel;
  }
  final JComponent c=widget instanceof CustomStatusBarWidget ? ((CustomStatusBarWidget)widget).getComponent() : wrap(widget);
  if (Position.RIGHT == pos && panel.getComponentCount() > 0) {
    final List<String> parts=StringUtil.split(anchor," ");
    if (parts.size() < 2) {
      throw new IllegalArgumentException("anchor should be a relative position ('before' or 'after') and widget ID, like 'after Encoding'");
    }
    for (    final String id : myWidgetMap.keySet()) {
      if (id.equalsIgnoreCase(parts.get(1))) {
        final WidgetBean bean=myWidgetMap.get(id);
        int i=0;
        for (        final Component component : myRightPanel.getComponents()) {
          if (component == bean.component) {
            final String _relative=parts.get(0);
            if ("before".equalsIgnoreCase(_relative)) {
              panel.add(c,i);
              updateBorder(i);
            }
 else {
              final int ndx=i + 1;
              panel.add(c,i + 1);
              updateBorder(ndx);
            }
            installWidget(widget,pos,c);
            return;
          }
          i++;
        }
      }
    }
    throw new IllegalArgumentException("unable to find widget with id: " + parts.get(1));
  }
  if (Position.LEFT == pos && panel.getComponentCount() == 0) {
    c.setBorder(SystemInfo.isMac ? BorderFactory.createEmptyBorder(2,0,2,4) : BorderFactory.createEmptyBorder());
  }
  panel.add(c);
  installWidget(widget,pos,c);
}
