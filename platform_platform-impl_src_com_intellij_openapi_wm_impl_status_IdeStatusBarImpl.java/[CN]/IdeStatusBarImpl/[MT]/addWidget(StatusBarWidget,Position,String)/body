{
  myOrderedWidgets.add(widget.ID());
  JPanel panel;
  if (pos == Position.RIGHT) {
    if (myRightPanel == null) {
      myRightPanel=new JPanel();
      myRightPanel.setLayout(new BoxLayout(myRightPanel,BoxLayout.X_AXIS));
      myRightPanel.setOpaque(false);
      add(myRightPanel,BorderLayout.EAST);
    }
    panel=myRightPanel;
  }
 else   if (pos == Position.LEFT) {
    if (myLeftPanel == null) {
      myLeftPanel=new JPanel();
      myLeftPanel.setLayout(new BoxLayout(myLeftPanel,BoxLayout.X_AXIS));
      myLeftPanel.setOpaque(false);
      add(myLeftPanel,BorderLayout.WEST);
    }
    panel=myLeftPanel;
  }
 else {
    if (myCenterPanel == null) {
      myCenterPanel=new JPanel(new BorderLayout());
      myCenterPanel.setOpaque(false);
      add(myCenterPanel,BorderLayout.CENTER);
    }
    panel=myCenterPanel;
  }
  final JComponent c=wrap(widget);
  if (Position.RIGHT == pos && panel.getComponentCount() > 0) {
    String wid;
    boolean before;
    if (!anchor.equals("__AUTODETECT__")) {
      final List<String> parts=StringUtil.split(anchor," ");
      if (parts.size() < 2 || !myWidgetMap.keySet().contains(parts.get(1))) {
        wid="Notifications";
        before=true;
      }
 else {
        wid=parts.get(1);
        before="before".equalsIgnoreCase(parts.get(0));
      }
    }
 else {
      wid="Memory";
      before=true;
    }
    for (    final String id : myWidgetMap.keySet()) {
      if (id.equalsIgnoreCase(wid)) {
        final WidgetBean bean=myWidgetMap.get(id);
        int i=0;
        for (        final Component component : myRightPanel.getComponents()) {
          if (component == bean.component) {
            if (before) {
              panel.add(c,i);
              updateBorder(i);
            }
 else {
              final int ndx=i + 1;
              panel.add(c,i + 1);
              updateBorder(ndx);
            }
            installWidget(widget,pos,c,anchor);
            return;
          }
          i++;
        }
      }
    }
  }
  if (Position.LEFT == pos && panel.getComponentCount() == 0) {
    c.setBorder(SystemInfo.isMac ? BorderFactory.createEmptyBorder(2,0,2,4) : BorderFactory.createEmptyBorder());
  }
  panel.add(c);
  installWidget(widget,pos,c,anchor);
  if (widget instanceof StatusBarWidget.Multiframe) {
    final StatusBarWidget.Multiframe mfw=(StatusBarWidget.Multiframe)widget;
    updateChildren(new ChildAction(){
      @Override public void update(      IdeStatusBarImpl child){
        StatusBarWidget widgetCopy=mfw.copy();
        child.addWidget(widgetCopy,pos,anchor);
      }
    }
);
  }
}
