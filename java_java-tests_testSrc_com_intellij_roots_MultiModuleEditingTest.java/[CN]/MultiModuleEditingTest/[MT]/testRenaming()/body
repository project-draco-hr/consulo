{
  final ModuleManager moduleManager=ModuleManager.getInstance(myProject);
  final Module moduleA;
  final Module moduleB;
{
    final ModifiableModuleModel moduleModel=moduleManager.getModifiableModel();
    moduleA=moduleModel.newModule("a.iml",StdModuleTypes.JAVA);
    moduleB=moduleModel.newModule("b.iml",StdModuleTypes.JAVA);
    final Module moduleC=moduleModel.newModule("c.iml",StdModuleTypes.JAVA);
    final ModifiableRootModel rootModelB=ModuleRootManager.getInstance(moduleB).getModifiableModel();
    rootModelB.addModuleOrderEntry(moduleC);
    moduleModel.disposeModule(moduleC);
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      public void run(){
        ProjectRootManager.getInstance(myProject).multiCommit(moduleModel,new ModifiableRootModel[]{rootModelB});
      }
    }
);
  }
  final ModuleRootManager rootManagerB=ModuleRootManager.getInstance(moduleB);
  assertEquals(0,rootManagerB.getDependencies().length);
  final String[] dependencyModuleNames=rootManagerB.getDependencyModuleNames();
  assertEquals(1,dependencyModuleNames.length);
  assertEquals("c",dependencyModuleNames[0]);
{
    final ModifiableModuleModel moduleModel=moduleManager.getModifiableModel();
    moduleModel.renameModule(moduleA,"c");
    moduleModel.commit();
  }
  assertEquals(1,rootManagerB.getDependencies().length);
  assertEquals(moduleA,rootManagerB.getDependencies()[0]);
  assertEquals("c",moduleA.getName());
  moduleManager.disposeModule(moduleA);
  moduleManager.disposeModule(moduleB);
}
