{
  final PsiFile psiFile=psiElement instanceof PsiFile ? (PsiFile)psiElement : psiElement.getContainingFile();
  if (psiFile == null) {
    return null;
  }
  VirtualFile virtualFile=psiFile.getVirtualFile();
  if (virtualFile == null) {
    return null;
  }
  if (virtualFile instanceof HttpVirtualFile) {
    return Urls.newFromVirtualFile(virtualFile);
  }
  if (!(preferLocalUrl && HtmlUtil.isHtmlFile(psiFile))) {
    Pair<WebBrowserUrlProvider,Url> provider=getProvider(psiElement);
    if (provider != null) {
      if (provider.second != null) {
        return provider.second;
      }
      try {
        Url url=provider.first.getUrl(psiElement,psiFile,virtualFile);
        if (url != null) {
          return url;
        }
      }
 catch (      WebBrowserUrlProvider.BrowserException e) {
        if (!HtmlUtil.isHtmlFile(psiFile)) {
          throw e;
        }
      }
    }
  }
  return virtualFile instanceof LightVirtualFile ? null : Urls.newFromVirtualFile(virtualFile);
}
