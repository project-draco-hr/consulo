{
  if (Registry.is("allow.dialog.based.popups")) {
    boolean noFocus=!myFocusable || !myRequestFocus;
    boolean cannotBeDialog=noFocus && SystemInfo.isXWindow;
    if (!cannotBeDialog && (isPersistent() || forceDialog)) {
      return new PopupComponent.Factory.Dialog();
    }
  }
  if (forceHeavyweight) {
    return new PopupComponent.Factory.AwtHeavyweight();
  }
  return new PopupComponent.Factory.AwtDefault();
}
