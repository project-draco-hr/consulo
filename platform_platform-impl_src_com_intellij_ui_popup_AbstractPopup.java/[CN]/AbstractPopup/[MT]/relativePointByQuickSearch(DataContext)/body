{
  Rectangle dominantArea=PlatformDataKeys.DOMINANT_HINT_AREA_RECTANGLE.getData(dataContext);
  if (dominantArea != null) {
    final Component focusedComponent=getWndManager().getFocusedComponent(myProject);
    if (focusedComponent != null) {
      Window window=SwingUtilities.windowForComponent(focusedComponent);
      JLayeredPane layeredPane;
      if (window instanceof JFrame) {
        layeredPane=((JFrame)window).getLayeredPane();
      }
 else       if (window instanceof JDialog) {
        layeredPane=((JDialog)window).getLayeredPane();
      }
 else       if (window instanceof JWindow) {
        layeredPane=((JWindow)window).getLayeredPane();
      }
 else {
        throw new IllegalStateException("cannot find parent window: project=" + myProject + "; window="+ window);
      }
      return relativePointWithDominantRectangle(layeredPane,dominantArea);
    }
  }
  return JBPopupFactory.getInstance().guessBestPopupLocation(dataContext);
}
