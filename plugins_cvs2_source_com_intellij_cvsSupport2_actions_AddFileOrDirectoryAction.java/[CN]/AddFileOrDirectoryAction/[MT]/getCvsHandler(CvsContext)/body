{
  ArrayList<VirtualFile> filesToAdd=collectFilesToAdd(context.getSelectedFiles());
  if (filesToAdd.isEmpty())   return CvsHandler.NULL;
  LOG.assertTrue(!filesToAdd.isEmpty());
  Project project=context.getProject();
  Collection<AddedFileInfo> roots=new CreateTreeOnFileList(filesToAdd,project,!myIsAutomaticallyAction).getRoots();
  if (roots.size() == 0) {
    LOG.assertTrue(false,filesToAdd.toString());
  }
  if (myOptions.isToBeShown(project) || OptionsDialog.shiftIsPressed(context.getModifiers())) {
    AbstractAddOptionsDialog dialog=AbstractAddOptionsDialog.createDialog(context.getProject(),roots,myOptions);
    dialog.show();
    if (!dialog.isOK())     return CvsHandler.NULL;
  }
  return CommandCvsHandler.createAddFilesHandler(roots);
}
