{
  TreePath[] paths=getSelectionPaths();
  if (paths == null)   return PsiElement.EMPTY_ARRAY;
  ArrayList<Object> list=new ArrayList<Object>(paths.length);
  for (int i=0; i < paths.length; i++) {
    TreePath path=paths[i];
    Object lastPathComponent=path.getLastPathComponent();
    if (lastPathComponent instanceof DefaultMutableTreeNode) {
      DefaultMutableTreeNode node=(DefaultMutableTreeNode)lastPathComponent;
      Object userObject=node.getUserObject();
      if (userObject instanceof AbstractTreeNode) {
        AbstractTreeNode descriptor=(AbstractTreeNode)userObject;
        Object element=descriptor.getValue();
        list.add(element);
      }
 else       if (userObject instanceof NodeDescriptor) {
        NodeDescriptor descriptor=(NodeDescriptor)userObject;
        Object element=descriptor.getElement();
        list.add(element);
      }
    }
  }
  return list.toArray(new Object[list.size()]);
}
