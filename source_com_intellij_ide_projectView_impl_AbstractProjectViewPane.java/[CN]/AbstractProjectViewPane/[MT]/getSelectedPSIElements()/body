{
  List<PsiElement> psiElements=new ArrayList<PsiElement>();
  for (  Object element : getSelectedElements()) {
    if (element instanceof PsiElement) {
      PsiElement psiElement=(PsiElement)element;
      if (psiElement.isValid()) {
        psiElements.add(psiElement);
      }
    }
 else     if (element instanceof PackageElement) {
      PsiPackage aPackage=((PackageElement)element).getPackage();
      if (aPackage != null && aPackage.isValid()) {
        psiElements.add(aPackage);
      }
    }
  }
  return psiElements.toArray(new PsiElement[psiElements.size()]);
}
