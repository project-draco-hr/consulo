{
  final Object[] elements=getSelectedElements();
  List<PsiElement> psiElements=new ArrayList<PsiElement>();
  for (int i=0; i < elements.length; i++) {
    Object element=elements[i];
    if (element instanceof PsiElement) {
      psiElements.add((PsiElement)element);
    }
 else     if (element instanceof PackageElement) {
      PsiPackage aPackage=((PackageElement)element).getPackage();
      if (aPackage != null) {
        psiElements.add(aPackage);
      }
    }
  }
  return psiElements.toArray(new PsiElement[psiElements.size()]);
}
