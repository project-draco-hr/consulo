{
  CaretModel caretModel=editor.getCaretModel();
  int line=currentVisual.line;
  int column=1;
  if (currentVisual.column <= 1) {
    line--;
    softWrappedLines--;
    int nonSpaceColumn=findFirstNonSpaceColumnOnTheLine(editor,line);
    if (softWrappedLines <= 0) {
      column=nonSpaceColumn >= 0 ? nonSpaceColumn : 0;
    }
 else {
      column=nonSpaceColumn >= 1 ? nonSpaceColumn : 1;
    }
  }
 else {
    int nonSpaceColumn=findFirstNonSpaceColumnOnTheLine(editor,currentVisual.line);
    if (nonSpaceColumn > 1 && nonSpaceColumn < currentVisual.column) {
      column=nonSpaceColumn;
    }
  }
  caretModel.moveToVisualPosition(new VisualPosition(line,column));
}
