{
  int lineHeight=editor.getLineHeight();
  SelectionModel selectionModel=editor.getSelectionModel();
  int selectionStart=selectionModel.getLeadSelectionOffset();
  CaretModel caretModel=editor.getCaretModel();
  LogicalPosition blockSelectionStart=selectionModel.hasBlockSelection() ? selectionModel.getBlockStart() : caretModel.getLogicalPosition();
  Rectangle viewRect=editor.getScrollingModel().getVisibleArea();
  int lineNumber=viewRect.y / lineHeight;
  if (viewRect.y % lineHeight > 0) {
    lineNumber++;
  }
  VisualPosition pos=new VisualPosition(lineNumber,editor.getCaretModel().getVisualPosition().column);
  editor.getCaretModel().moveToVisualPosition(pos);
  setupSelection(editor,isWithSelection,selectionStart,blockSelectionStart);
}
