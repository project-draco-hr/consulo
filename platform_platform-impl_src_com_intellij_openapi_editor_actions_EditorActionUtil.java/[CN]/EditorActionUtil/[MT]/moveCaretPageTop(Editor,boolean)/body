{
  int lineHeight=editor.getLineHeight();
  SelectionModel selectionModel=editor.getSelectionModel();
  int selectionStart=selectionModel.getLeadSelectionOffset();
  CaretModel caretModel=editor.getCaretModel();
  LogicalPosition blockSelectionStart=caretModel.getLogicalPosition();
  Rectangle visibleArea=editor.getScrollingModel().getVisibleArea();
  int lineNumber=visibleArea.y / lineHeight;
  if (visibleArea.y % lineHeight > 0) {
    lineNumber++;
  }
  VisualPosition pos=new VisualPosition(lineNumber,editor.getCaretModel().getVisualPosition().column);
  editor.getCaretModel().moveToVisualPosition(pos);
  setupSelection(editor,isWithSelection,selectionStart,blockSelectionStart);
}
