{
  final VirtualFile virtualFile=dir.getVirtualFile();
  final Project project=dir.getProject();
  final Module module=ProjectRootManager.getInstance(project).getFileIndex().getModuleForFile(virtualFile);
  if (module != null) {
    return LanguageLevelUtil.getEffectiveLanguageLevel(module);
  }
  return LanguageLevelProjectExtension.getInstance(project).getLanguageLevel();
}
