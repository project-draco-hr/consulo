{
  Trinity<String[],VirtualFile[],VirtualFile[]> result;
  if (myList.isEmpty()) {
    myCachedDirectories=VirtualFile.EMPTY_ARRAY;
    myCachedFiles=VirtualFile.EMPTY_ARRAY;
    myCachedUrls=ArrayUtil.EMPTY_STRING_ARRAY;
    result=EMPTY;
  }
 else {
    VirtualFilePointer[] vf=myList.toArray(new VirtualFilePointer[myList.size()]);
    List<VirtualFile> cachedFiles=new ArrayList<VirtualFile>(vf.length);
    List<String> cachedUrls=new ArrayList<String>(vf.length);
    List<VirtualFile> cachedDirectories=new ArrayList<VirtualFile>(vf.length / 3);
    boolean allFilesAreDirs=true;
    for (    VirtualFilePointer v : vf) {
      VirtualFile file=v.getFile();
      String url=v.getUrl();
      cachedUrls.add(url);
      if (file != null) {
        cachedFiles.add(file);
        if (file.isDirectory()) {
          cachedDirectories.add(file);
        }
 else {
          allFilesAreDirs=false;
        }
      }
    }
    VirtualFile[] directories=VfsUtilCore.toVirtualFileArray(cachedDirectories);
    myCachedDirectories=directories;
    VirtualFile[] files;
    myCachedFiles=files=allFilesAreDirs ? directories : VfsUtilCore.toVirtualFileArray(cachedFiles);
    String[] urlsArray;
    myCachedUrls=urlsArray=ArrayUtil.toStringArray(cachedUrls);
    result=Trinity.create(urlsArray,files,directories);
  }
  myTimeStampOfCachedThings=myVirtualFilePointerManager.getModificationCount();
  return result;
}
