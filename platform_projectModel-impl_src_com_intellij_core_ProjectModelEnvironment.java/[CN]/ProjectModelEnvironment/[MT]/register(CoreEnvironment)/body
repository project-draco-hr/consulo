{
  Extensions.registerAreaClass(ExtensionAreas.IDEA_MODULE,null);
  PathMacrosImpl pathMacros=new PathMacrosImpl();
  env.registerApplicationComponent(PathMacros.class,pathMacros);
  CoreEnvironment.registerApplicationExtensionPoint(OrderRootType.EP_NAME,OrderRootType.class);
  CoreEnvironment.registerApplicationExtensionPoint(SdkFinder.EP_NAME,SdkFinder.class);
  final MockProject project=env.getProject();
  env.registerProjectComponent(ModuleManager.class,new CoreModuleManager(project,env.getParentDisposable()));
  env.registerProjectComponent(PathMacroManager.class,new ProjectPathMacroManager(pathMacros,project));
  env.registerProjectExtensionPoint(DirectoryIndexExcludePolicy.EP_NAME,DirectoryIndexExcludePolicy.class);
  DirectoryIndex index=new DirectoryIndexImpl(project);
  env.registerProjectComponent(DirectoryIndex.class,index);
  env.registerProjectComponent(ProjectRootManager.class,new ProjectRootManagerImpl(project,index));
}
