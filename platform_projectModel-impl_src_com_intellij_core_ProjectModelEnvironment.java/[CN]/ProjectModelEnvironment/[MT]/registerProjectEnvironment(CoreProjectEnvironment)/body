{
  final MockProject project=env.getProject();
  env.registerProjectComponent(ModuleManager.class,new CoreModuleManager(project,env.getParentDisposable()));
  env.registerProjectComponent(PathMacroManager.class,new ProjectPathMacroManager(PathMacros.getInstance(),project));
  env.registerProjectExtensionPoint(DirectoryIndexExcludePolicy.EP_NAME,DirectoryIndexExcludePolicy.class);
  DirectoryIndex index=new DirectoryIndexImpl(project);
  project.registerService(DirectoryIndex.class,index);
  env.registerProjectComponent(ProjectRootManager.class,new ProjectRootManagerImpl(project,index));
  project.registerService(ProjectLibraryTable.class,new ProjectLibraryTable());
  project.registerService(ProjectFileIndex.class,new ProjectFileIndexImpl(project,index,FileTypeRegistry.getInstance()));
}
