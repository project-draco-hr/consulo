{
  new CodeCompletionHandlerBase(CompletionType.BASIC,false,true).invoke(project,editor);
  final AutoPopupState state=new AutoPopupState(project,editor);
  editor.putUserData(STATE_KEY,state);
  final Lookup lookup=LookupManager.getActiveLookup(editor);
  if (lookup != null) {
    lookup.addLookupListener(new LookupAdapter(){
      @Override public void itemSelected(      LookupEvent event){
        final AutoPopupState state=getAutoPopupState(editor);
        if (state != null) {
          state.stopAutoPopup();
        }
      }
      @Override public void lookupCanceled(      LookupEvent event){
        final AutoPopupState state=getAutoPopupState(editor);
        if (event.isCanceledExplicitly() && state != null) {
          state.stopAutoPopup();
        }
      }
    }
);
  }
}
