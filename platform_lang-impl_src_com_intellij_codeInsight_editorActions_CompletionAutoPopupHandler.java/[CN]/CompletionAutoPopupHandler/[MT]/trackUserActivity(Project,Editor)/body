{
  final MessageBusConnection connection=project.getMessageBus().connect();
  connection.subscribe(FileEditorManagerListener.FILE_EDITOR_MANAGER,new FileEditorManagerAdapter(){
    @Override public void selectionChanged(    FileEditorManagerEvent event){
      finishAutopopupCompletion();
      connection.disconnect();
    }
  }
);
  editor.addEditorMouseListener(new EditorMouseAdapter(){
    @Override public void mouseClicked(    EditorMouseEvent e){
      editor.removeEditorMouseListener(this);
      finishAutopopupCompletion();
    }
  }
);
  editor.getDocument().addDocumentListener(new DocumentAdapter(){
    @Override public void documentChanged(    DocumentEvent e){
      if (StringUtil.containsLineBreak(e.getNewFragment())) {
        finishAutopopupCompletion();
        editor.getDocument().removeDocumentListener(this);
      }
    }
  }
);
}
