{
  Editor topLevelEditor=InjectedLanguageUtil.getTopLevelEditor(editor);
  PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(topLevelEditor.getDocument());
  if (file == null)   return;
  PsiFile topLevelFile=InjectedLanguageUtil.getTopLevelFile(file);
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  Editor newEditor=InjectedLanguageUtil.getEditorForInjectedLanguageNoCommit(topLevelEditor,topLevelFile);
  try {
    new CodeCompletionHandlerBase(completionType,invokedExplicitly,autopopup).invokeCompletion(project,newEditor,time,hasModifiers);
  }
 catch (  IndexNotReadyException ignored) {
  }
}
