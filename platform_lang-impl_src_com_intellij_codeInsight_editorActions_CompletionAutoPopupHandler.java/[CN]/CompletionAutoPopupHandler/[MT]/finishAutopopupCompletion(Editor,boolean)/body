{
  if (!myAutopopupShown) {
    return true;
  }
  if (myGuard) {
    return false;
  }
  if (!neglectLookup && LookupManager.getActiveLookup(editor) != null) {
    return false;
  }
  myAutopopupShown=false;
  final CompletionProgressIndicator currentCompletion=CompletionServiceImpl.getCompletionService().getCurrentCompletion();
  if (currentCompletion != null) {
    currentCompletion.closeAndFinish(true);
  }
  return true;
}
