{
  final Project project=editor.getProject();
  if (project == null)   return;
  final CompletionPhase.AutoPopupAlarm phase=new CompletionPhase.AutoPopupAlarm(false,editor);
  CompletionServiceImpl.setCompletionPhase(phase);
  AutoPopupController.getInstance(project).invokeAutoPopupRunnable(new Runnable(){
    @Override public void run(){
      runLaterWithCommitted(project,editor.getDocument(),new Runnable(){
        @Override public void run(){
          if (phase.isExpired())           return;
          PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
          if (file != null && condition != null && !condition.value(file))           return;
          invokeCompletion(CompletionType.BASIC,true,project,editor,0);
        }
      }
);
    }
  }
,CodeInsightSettings.getInstance().AUTO_LOOKUP_DELAY);
}
