{
  this.editor=editor;
  this.project=project;
  connection=project.getMessageBus().connect();
  connection.subscribe(FileEditorManagerListener.FILE_EDITOR_MANAGER,new FileEditorManagerAdapter(){
    @Override public void selectionChanged(    FileEditorManagerEvent event){
      finishAutopopupCompletion(editor,false);
    }
  }
);
  mouseListener=new EditorMouseAdapter(){
    @Override public void mouseClicked(    EditorMouseEvent e){
      finishAutopopupCompletion(editor,false);
    }
  }
;
  caretListener=new CaretListener(){
    @Override public void caretPositionChanged(    CaretEvent e){
      finishAutopopupCompletion(editor,false);
    }
  }
;
  editor.getSelectionModel().addSelectionListener(new SelectionListener(){
    @Override public void selectionChanged(    SelectionEvent e){
      finishAutopopupCompletion(editor,false);
    }
  }
);
  documentListener=new DocumentAdapter(){
    @Override public void documentChanged(    DocumentEvent e){
      finishAutopopupCompletion(editor,false);
    }
  }
;
  lookupListener=new PropertyChangeListener(){
    @Override public void propertyChange(    PropertyChangeEvent evt){
      if (evt.getNewValue() != null) {
        finishAutopopupCompletion(editor,true);
      }
    }
  }
;
  editor.addEditorMouseListener(mouseListener);
  editor.getCaretModel().addCaretListener(caretListener);
  editor.getDocument().addDocumentListener(documentListener);
  LookupManager.getInstance(project).addPropertyChangeListener(lookupListener);
}
