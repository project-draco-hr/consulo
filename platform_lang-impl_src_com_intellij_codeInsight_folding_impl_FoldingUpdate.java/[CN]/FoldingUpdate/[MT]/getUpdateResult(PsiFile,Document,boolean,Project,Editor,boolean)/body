{
  final FoldingMap elementsToFoldMap=getFoldingsFor(file,document,quick);
  final UpdateFoldRegionsOperation operation=new UpdateFoldRegionsOperation(project,editor,file,elementsToFoldMap,applyDefaultState ? EXCEPT_CARET_REGION : NO,!applyDefaultState,false);
  Runnable runnable=new Runnable(){
    @Override public void run(){
      editor.getFoldingModel().runBatchFoldingOperationDoNotCollapseCaret(operation);
    }
  }
;
  Set<Object> dependencies=new HashSet<Object>();
  dependencies.add(document);
  dependencies.add(editor.getFoldingModel());
  for (  FoldingDescriptor descriptor : elementsToFoldMap.values()) {
    dependencies.addAll(descriptor.getDependencies());
  }
  return CachedValueProvider.Result.create(runnable,ArrayUtil.toObjectArray(dependencies));
}
