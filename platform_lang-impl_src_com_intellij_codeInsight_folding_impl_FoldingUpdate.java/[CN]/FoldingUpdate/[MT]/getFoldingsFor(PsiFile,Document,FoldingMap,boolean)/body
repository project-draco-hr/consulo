{
  final FileViewProvider viewProvider=file.getViewProvider();
  TextRange docRange=TextRange.from(0,document.getTextLength());
  for (  final Language language : viewProvider.getLanguages()) {
    final PsiFile psi=viewProvider.getPsi(language);
    final FoldingBuilder foldingBuilder=LanguageFolding.INSTANCE.forLanguage(language);
    if (psi != null && foldingBuilder != null) {
      for (      FoldingDescriptor descriptor : LanguageFolding.buildFoldingDescriptors(foldingBuilder,psi,document,quick)) {
        TextRange range=descriptor.getRange();
        if (!docRange.contains(range)) {
          LOG.error("Folding descriptor " + descriptor + " made by "+ foldingBuilder+ " for "+ language+ " and called on file "+ psi+ " is outside document range: "+ docRange);
        }
        elementsToFoldMap.putValue(descriptor.getElement().getPsi(),descriptor);
      }
    }
  }
}
