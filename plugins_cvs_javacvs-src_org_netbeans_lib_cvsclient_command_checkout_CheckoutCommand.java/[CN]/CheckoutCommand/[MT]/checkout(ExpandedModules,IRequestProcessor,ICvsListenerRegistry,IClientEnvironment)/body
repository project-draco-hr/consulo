{
  processExistingModules(expandedModules,clientEnvironment);
  final ICvsFiles cvsFiles;
  try {
    if (getFileObjects().size() > 0) {
      cvsFiles=scanFileSystem(clientEnvironment);
    }
 else {
      cvsFiles=null;
    }
  }
 catch (  IOException ex) {
    throw new IOCommandException(ex);
  }
  final Requests requests=new Requests(CommandRequest.CHECKOUT,clientEnvironment);
  if (getAlternativeCheckoutDirectory() != null) {
    requests.addArgumentRequest("-d");
    requests.addArgumentRequest(getAlternativeCheckoutDirectory());
  }
  requests.addArgumentRequest(!isRecursive(),"-l");
  requests.addArgumentRequest(isResetStickyOnes(),"-A");
  requests.addArgumentRequest(isUseHeadIfNotFound(),"-f");
  requests.addArgumentRequest(getUpdateByDate(),"-D");
  requests.addArgumentRequest(getUpdateByRevisionOrTag(),"-r");
  requests.addArgumentRequest(getKeywordSubstitution(),"-k");
  requests.addArgumentRequest(isPrintToOutput(),"-p");
  if (cvsFiles != null) {
    addFileRequests(cvsFiles,requests,clientEnvironment);
  }
  addModuleArguments(requests);
  requests.addLocalPathDirectoryRequest();
  final DirectoryPruner directoryPruner;
  if (isPruneDirectories()) {
    directoryPruner=new DirectoryPruner(clientEnvironment);
  }
 else {
    directoryPruner=null;
  }
  if (directoryPruner != null) {
    directoryPruner.registerListeners(listenerRegistry);
  }
  try {
    return requestProcessor.processRequests(requests,new DummyRequestsProgressHandler());
  }
  finally {
    try {
      if (myAfterCheckout != null) {
        myAfterCheckout.run();
      }
    }
  finally {
      if (directoryPruner != null) {
        directoryPruner.unregisterListeners(listenerRegistry);
        try {
          directoryPruner.pruneEmptyDirectories();
        }
 catch (        IOException ex) {
          throw new IOCommandException(ex);
        }
      }
    }
  }
}
