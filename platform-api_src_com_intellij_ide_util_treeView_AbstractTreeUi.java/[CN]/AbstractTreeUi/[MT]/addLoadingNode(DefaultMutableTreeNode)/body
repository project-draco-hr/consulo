{
  final NodeDescriptor descriptor=(NodeDescriptor)node.getUserObject();
  if (!getBuilder().isAlwaysShowPlus(descriptor)) {
    if (getTreeStructure().isToBuildChildrenInBackground(getBuilder().getTreeStructureElement(descriptor))) {
      final boolean[] hasNoChildren=new boolean[1];
      Runnable runnable=new Runnable(){
        public void run(){
          if (isReleased())           return;
          update(descriptor,true);
          Object element=getBuilder().getTreeStructureElement(descriptor);
          if (element == null && !isValid(element))           return;
          Object[] children=getChildrenFor(element);
          hasNoChildren[0]=children.length == 0;
        }
      }
;
      Runnable postRunnable=new Runnable(){
        public void run(){
          if (isReleased())           return;
          if (hasNoChildren[0]) {
            update(descriptor,false);
            removeLoadingNode(node);
          }
        }
      }
;
      addTaskToWorker(runnable,false,postRunnable);
    }
 else {
      Object[] children=getChildrenFor(getBuilder().getTreeStructureElement(descriptor));
      if (children.length == 0)       return;
    }
  }
  insertLoadingNode(node,true);
}
