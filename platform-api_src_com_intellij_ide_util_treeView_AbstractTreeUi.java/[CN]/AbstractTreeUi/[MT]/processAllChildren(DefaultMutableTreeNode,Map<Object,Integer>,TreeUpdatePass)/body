{
  final ActionCallback result=new ActionCallback();
  final ArrayList<TreeNode> childNodes=TreeUtil.childrenToArray(node);
  if (isToYieldUpdateFor(node)) {
    yieldAndRun(new Runnable(){
      public void run(){
        if (pass.isExpired())         return;
        if (pass.getUpdateStamp() < getUpdater().getUpdateCount()) {
          getUpdater().addSubtreeToUpdate(pass);
          result.setRejected();
        }
 else {
          processAllChildren(node,elementToIndexMap,pass,childNodes);
          result.setDone();
        }
      }
    }
,pass);
  }
 else {
    processAllChildren(node,elementToIndexMap,pass,childNodes);
    result.setDone();
  }
  return result;
}
