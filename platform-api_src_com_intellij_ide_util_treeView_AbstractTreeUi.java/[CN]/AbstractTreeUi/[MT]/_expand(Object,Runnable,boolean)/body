{
  if (wasRootNodeInitialized()) {
    List<Object> kidsToExpand=new ArrayList<Object>();
    Object eachElement=element;
    DefaultMutableTreeNode firstVisible;
    while (true) {
      firstVisible=getNodeForElement(eachElement,false);
      if (eachElement != element || !parentsOnly) {
        kidsToExpand.add(eachElement);
      }
      if (firstVisible != null)       break;
      eachElement=getTreeStructure().getParentElement(eachElement);
      if (eachElement == null) {
        firstVisible=null;
        break;
      }
    }
    if (firstVisible == null) {
      onDone.run();
    }
    processExpand(firstVisible,kidsToExpand,kidsToExpand.size() - 1,onDone);
  }
 else {
    myDeferredExpansions.add(new Runnable(){
      public void run(){
        _expand(element,onDone,parentsOnly);
      }
    }
);
  }
}
