{
  final Object element=getElementFor(toExpand);
  if (!isValid(element)) {
    runDone(onDone);
    return;
  }
  addNodeAction(element,new NodeAction(){
    public void onReady(    final DefaultMutableTreeNode node){
      if (node.getChildCount() >= 0 && !myTree.isExpanded(new TreePath(node.getPath()))) {
        final ArrayList list=new ArrayList();
        for (int i=0; i < node.getChildCount(); i++) {
          list.add(node.getChildAt(i));
        }
        expand(node);
      }
      if (expandIndex < 0) {
        runDone(onDone);
        return;
      }
      final DefaultMutableTreeNode nextNode=getNodeForElement(kidsToExpand.get(expandIndex),false);
      if (nextNode != null) {
        processExpand(nextNode,kidsToExpand,expandIndex - 1,onDone);
      }
 else {
        runDone(onDone);
      }
    }
  }
);
  expand(toExpand);
}
