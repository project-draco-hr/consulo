{
  ArrayList<TreeNode> nodesToInsert=new ArrayList<TreeNode>();
  final Collection<Object> allElements=elementToIndexMap.getKeys();
  for (  Object child : allElements) {
    Integer index=elementToIndexMap.getValue(child);
    final NodeDescriptor childDescr=getTreeStructure().createDescriptor(child,descriptor);
    if (childDescr == null) {
      LOG.error("childDescr == null, treeStructure = " + getTreeStructure() + ", child = "+ child);
      continue;
    }
    childDescr.setIndex(index.intValue());
    update(childDescr,false);
    if (getElementFromDescriptor(childDescr) == null) {
      LOG.error("childDescr.getElement() == null, child = " + child + ", builder = "+ this);
      continue;
    }
    final DefaultMutableTreeNode childNode=createChildNode(childDescr);
    nodesToInsert.add(childNode);
    createMapping(getElementFromDescriptor(childDescr),childNode);
  }
  return nodesToInsert;
}
