{
  Lexer lexer=new JavaLexer(LanguageLevel.JDK_1_3);
  lexer.start(text);
  skipWhiteSpaceAndComments(lexer);
  final IElementType firstToken=lexer.getTokenType();
  if (firstToken != JavaTokenType.PACKAGE_KEYWORD) {
    if (JAVA_FILE_FIRST_TOKEN_SET.contains(firstToken)) {
      return "";
    }
    return null;
  }
  lexer.advance();
  skipWhiteSpaceAndComments(lexer);
  final StringBuilder buffer=StringBuilderSpinAllocator.alloc();
  try {
    while (true) {
      if (lexer.getTokenType() != JavaTokenType.IDENTIFIER)       break;
      buffer.append(text,lexer.getTokenStart(),lexer.getTokenEnd());
      lexer.advance();
      skipWhiteSpaceAndComments(lexer);
      if (lexer.getTokenType() != JavaTokenType.DOT)       break;
      buffer.append('.');
      lexer.advance();
      skipWhiteSpaceAndComments(lexer);
    }
    String packageName=buffer.toString();
    if (packageName.length() == 0 || StringUtil.endsWithChar(packageName,'.'))     return null;
    return packageName;
  }
  finally {
    StringBuilderSpinAllocator.dispose(buffer);
  }
}
