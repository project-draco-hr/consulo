{
  context.commitDocument();
  PsiExpression expression=PsiTreeUtil.findElementOfClassAtOffset(context.getFile(),context.getOffset(refStart),PsiExpression.class,false);
  if (expression == null)   return true;
  final ExpectedTypeInfo[] expectedTypes=ExpectedTypesProvider.getExpectedTypes(expression,true);
  if (expectedTypes == null)   return true;
  for (  final ExpectedTypeInfo type : expectedTypes) {
    if (type.isInsertExplicitTypeParams()) {
      final String typeParams=getTypeParamsText(type.getType());
      if (typeParams == null) {
        return true;
      }
      context.getDocument().insertString(context.getOffset(refStart),typeParams);
      JavaCompletionUtil.shortenReference(context.getFile(),context.getOffset(refStart));
      break;
    }
  }
  return true;
}
