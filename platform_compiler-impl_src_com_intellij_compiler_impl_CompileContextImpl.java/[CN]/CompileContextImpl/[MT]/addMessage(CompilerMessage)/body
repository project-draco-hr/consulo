{
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    LOG.info("addMessage: " + msg + " this="+ this);
  }
  Collection<CompilerMessage> messages=myMessages.get(msg.getCategory());
  if (messages == null) {
    messages=new LinkedHashSet<CompilerMessage>();
    myMessages.put(msg.getCategory(),messages);
  }
  if (messages.add(msg)) {
    myTask.addMessage(msg);
  }
  if (ApplicationManager.getApplication().isCompilerServerMode()) {
    VirtualFile virtualFile=msg.getVirtualFile();
    CompilerClientConnector.getInstance(myProject).addMessage(msg.getCategory(),msg.getMessage(),virtualFile == null ? null : virtualFile.getPath(),msg.getLine(),msg.getColumn());
  }
 else {
    ProblemsViewImpl.SERVICE.getInstance(myProject).addMessage(msg);
  }
}
