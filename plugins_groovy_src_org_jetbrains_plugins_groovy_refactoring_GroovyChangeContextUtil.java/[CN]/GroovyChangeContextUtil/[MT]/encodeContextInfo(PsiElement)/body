{
  if (element instanceof GrThisReferenceExpression) {
    GrThisReferenceExpression thisExpr=(GrThisReferenceExpression)element;
    final PsiClass containingClass=PsiTreeUtil.getParentOfType(thisExpr,PsiClass.class);
    element.putCopyableUserData(KEY_ENCODED,KEY_ENCODED);
    thisExpr.putCopyableUserData(QUALIFIER_CLASS_KEY,containingClass);
  }
 else   if (element instanceof GrReferenceExpression) {
    GrReferenceExpression refExpr=(GrReferenceExpression)element;
    final GrExpression qualifier=refExpr.getQualifierExpression();
    if (qualifier == null) {
      PsiElement refElement=refExpr.resolve();
      if (refElement instanceof GrAccessorMethod)       refElement=((GrAccessorMethod)refElement).getProperty();
      if (refElement instanceof PsiClass) {
        refExpr.putCopyableUserData(REF_TO_CLASS,(PsiClass)refElement);
        element.putCopyableUserData(KEY_ENCODED,KEY_ENCODED);
      }
 else       if (refElement instanceof PsiMember) {
        refExpr.putCopyableUserData(REF_TO_MEMBER,(PsiMember)refElement);
        element.putCopyableUserData(KEY_ENCODED,KEY_ENCODED);
      }
    }
  }
 else {
    final PsiReference ref=element.getReference();
    if (ref != null) {
      final PsiElement resolvedElement=ref.resolve();
      if (resolvedElement instanceof PsiClass) {
        element.putCopyableUserData(REF_TO_CLASS,(PsiClass)resolvedElement);
        element.putCopyableUserData(KEY_ENCODED,KEY_ENCODED);
      }
    }
  }
  for (PsiElement child=element.getFirstChild(); child != null; child=child.getNextSibling()) {
    encodeContextInfo(child);
  }
}
