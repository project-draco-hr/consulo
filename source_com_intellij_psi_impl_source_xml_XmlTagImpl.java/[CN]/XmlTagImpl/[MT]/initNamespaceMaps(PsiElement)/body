{
  if (myNamespaceMap == null && containNamespaceDeclarations()) {
    myNamespaceMap=new BidirectionalMap<String,String>();
    final XmlAttribute[] attributes=getAttributes();
    for (int i=0; i < attributes.length; i++) {
      final XmlAttribute attribute=attributes[i];
      if (attribute.isNamespaceDeclaration()) {
        final String name=attribute.getName();
        int splitIndex=name.indexOf(':');
        if (splitIndex < 0) {
          myNamespaceMap.put("",attribute.getValue());
        }
 else {
          myNamespaceMap.put(XmlUtil.findLocalNameByQualifiedName(name),attribute.getValue());
        }
      }
    }
  }
  if (parent instanceof XmlDocument && myNamespaceMap == null) {
    myNamespaceMap=new BidirectionalMap<String,String>();
    final String defaultNamespace=XmlUtil.getDefaultNamespace((XmlDocument)parent);
    if (defaultNamespace == XmlUtil.EMPTY_NAMESPACE) {
      final XmlFile xmlFile=(XmlFile)getContainingFile();
      if (xmlFile != null) {
        final String dtdUri=XmlUtil.getDtdUri(xmlFile.getDocument());
        if (dtdUri != null) {
          myNamespaceMap.put("",dtdUri);
          return;
        }
      }
      myNamespaceMap.put("",XmlUtil.EMPTY_NAMESPACE);
    }
 else {
      myNamespaceMap.put("",defaultNamespace);
    }
  }
}
