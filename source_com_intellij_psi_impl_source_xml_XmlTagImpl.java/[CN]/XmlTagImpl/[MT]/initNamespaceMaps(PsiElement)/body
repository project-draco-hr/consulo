{
  if (myNamespaceMap == null && hasNamespaceDeclarations()) {
    myNamespaceMap=new BidirectionalMap<String,String>();
    final XmlAttribute[] attributes=getAttributes();
    for (    final XmlAttribute attribute : attributes) {
      if (attribute.isNamespaceDeclaration()) {
        final String name=attribute.getName();
        int splitIndex=name.indexOf(':');
        final String value=attribute.getValue();
        if (value != null) {
          if (splitIndex < 0) {
            myNamespaceMap.put("",value);
          }
 else {
            myNamespaceMap.put(XmlUtil.findLocalNameByQualifiedName(name),value);
          }
        }
      }
    }
  }
  if (parent instanceof XmlDocument && myNamespaceMap == null) {
    myNamespaceMap=new BidirectionalMap<String,String>();
    final String[][] defaultNamespace=XmlUtil.getDefaultNamespaces((XmlDocument)parent);
    for (    final String[] prefix2ns : defaultNamespace) {
      myNamespaceMap.put(prefix2ns[0],prefix2ns[1]);
    }
  }
}
