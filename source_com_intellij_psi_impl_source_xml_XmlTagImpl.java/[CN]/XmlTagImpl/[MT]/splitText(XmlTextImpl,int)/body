{
  if (displayOffset == 0)   return childText;
  if (displayOffset >= childText.getValue().length()) {
    throw new IllegalArgumentException("Wrong offset: " + displayOffset + " text length: "+ childText.getValue().length());
  }
  final PomModel model=getProject().getModel();
  final XmlAspect aspect=model.getModelAspect(XmlAspect.class);
class MyTransaction extends PomTransactionBase {
    private XmlTextImpl myRight;
    public MyTransaction(){
      super(XmlTagImpl.this,aspect);
    }
    public PomModelEvent runInner() throws IncorrectOperationException {
      final PsiFile containingFile=getContainingFile();
      final FileElement holder=new DummyHolder(containingFile.getManager(),null,((PsiFileImpl)containingFile).getTreeElement().getCharTable()).getTreeElement();
      final XmlTextImpl rightText=(XmlTextImpl)Factory.createCompositeElement(XmlElementType.XML_TEXT);
      TreeUtil.addChildren(holder,rightText);
      addChild(rightText,childText.getTreeNext());
      final String value=childText.getValue();
      childText.setValue(value.substring(0,displayOffset));
      rightText.setValue(value.substring(displayOffset));
      CodeEditUtil.setNodeGenerated(rightText,true);
      myRight=rightText;
      return null;
    }
    public XmlText getResult(){
      return myRight;
    }
  }
  final MyTransaction transaction=new MyTransaction();
  model.runTransaction(transaction);
  return transaction.getResult();
}
