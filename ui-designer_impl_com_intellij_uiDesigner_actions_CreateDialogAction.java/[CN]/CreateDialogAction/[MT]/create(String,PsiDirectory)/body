{
  PsiFile sourceFile=directory.getManager().getElementFactory().createFileFromText(newName + ".java",createClassBody(newName,myRecentGenerateOK,myRecentGenerateCancel,myRecentGenerateMain));
  sourceFile=(PsiFile)directory.add(sourceFile);
  final CodeStyleManager codeStyleManager=CodeStyleManager.getInstance(directory.getProject());
  codeStyleManager.shortenClassReferences(sourceFile);
  codeStyleManager.reformat(sourceFile);
  final PsiPackage aPackage=directory.getPackage();
  final String packageName=aPackage.getQualifiedName();
  final String fqClassName=packageName.length() == 0 ? newName : packageName + "." + newName;
  final String formBody=createFormBody(fqClassName,"/com/intellij/uiDesigner/NewDialog.xml",GuiDesignerConfiguration.getInstance(directory.getProject()).DEFAULT_LAYOUT_MANAGER);
  final PsiFile formFile=directory.getManager().getElementFactory().createFileFromText(newName + ".form",formBody);
  PsiElement createdFile=directory.add(formFile);
  PsiClass[] classes=((PsiJavaFile)sourceFile).getClasses();
  return new PsiElement[]{createdFile,classes[0]};
}
