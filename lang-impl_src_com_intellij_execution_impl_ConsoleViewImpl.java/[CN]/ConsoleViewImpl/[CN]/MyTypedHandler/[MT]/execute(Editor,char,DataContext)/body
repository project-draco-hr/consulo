{
  final ConsoleViewImpl consoleView=editor.getUserData(CONSOLE_VIEW_IN_EDITOR_VIEW);
  if (consoleView == null || !consoleView.myState.isRunning() || consoleView.isViewer) {
    myOriginalHandler.execute(editor,charTyped,dataContext);
  }
 else {
    final String s=String.valueOf(charTyped);
    SelectionModel selectionModel=editor.getSelectionModel();
    if (selectionModel.hasSelection()) {
      consoleView.replaceUserText(s,selectionModel.getSelectionStart(),selectionModel.getSelectionEnd());
    }
 else {
      consoleView.insertUserText(s,editor.getCaretModel().getOffset());
    }
  }
}
