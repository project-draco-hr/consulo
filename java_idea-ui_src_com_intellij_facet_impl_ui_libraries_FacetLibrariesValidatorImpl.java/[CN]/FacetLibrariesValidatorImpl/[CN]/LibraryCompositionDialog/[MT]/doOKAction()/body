{
  myPanel.apply();
  final LibraryCompositionSettings settings=myPanel.getLibraryCompositionSettings();
  final LibrariesContainer librariesContainer=myContext.getLibrariesContainer();
  if (settings.downloadFiles(myMirrorsMap,librariesContainer,myPanel.getMainPanel(),false)) {
    ModifiableRootModel rootModel=myContext.getModifiableRootModel();
    if (rootModel == null) {
      final ModifiableRootModel model=ModuleRootManager.getInstance(myContext.getModule()).getModifiableModel();
      new WriteAction(){
        protected void run(        final Result result){
          settings.addLibraries(model,myAddedLibraries,librariesContainer);
          model.commit();
        }
      }
.execute();
    }
 else {
      settings.addLibraries(rootModel,myAddedLibraries,librariesContainer);
    }
    super.doOKAction();
  }
}
