{
  if (editor.isViewer())   return;
  if (!editor.getDocument().isWritable()) {
    if (!FileDocumentManager.fileForDocumentCheckedOutSuccessfully(editor.getDocument(),PlatformDataKeys.PROJECT.getData(dataContext)))     return;
  }
  ApplicationManager.getApplication().runWriteAction(new DocumentRunnable(editor.getDocument()){
    public void run(){
      final SelectionModel selectionModel=editor.getSelectionModel();
      if (selectionModel.hasBlockSelection()) {
        RangeMarker guard=selectionModel.getBlockSelectionGuard();
        if (guard != null) {
          DocumentEvent evt=new MockDocumentEvent(editor.getDocument(),editor.getCaretModel().getOffset());
          ReadOnlyFragmentModificationException e=new ReadOnlyFragmentModificationException(evt,guard);
          EditorActionManager.getInstance().getReadonlyFragmentModificationHandler().handle(e);
          return;
        }
      }
      Document doc=editor.getDocument();
      doc.startGuardedBlockChecking();
      try {
        executeWriteAction(editor,dataContext);
      }
 catch (      ReadOnlyFragmentModificationException e) {
        EditorActionManager.getInstance().getReadonlyFragmentModificationHandler().handle(e);
      }
 finally {
        doc.stopGuardedBlockChecking();
      }
    }
  }
);
}
