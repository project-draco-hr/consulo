{
  myProject=project;
  myEditor=editor;
  myHandler=handler;
  myProvider=provider;
  myParameterCloseChars=handler.getParameterCloseChars();
  myLbraceMarker=editor.getDocument().createRangeMarker(lbraceOffset,lbraceOffset);
  myHint=hint;
  myComponent=(ParameterInfoComponent)myHint.getComponent();
  ArrayList<ParameterInfoController> allControllers=getAllControllers(myEditor);
  allControllers.add(this);
  myEditorCaretListener=new CaretListener(){
    @Override public void caretPositionChanged(    CaretEvent e){
      if (!myHandler.tracksParameterIndex()) {
        myAlarm.cancelAllRequests();
        addAlarmRequest();
        return;
      }
      int oldOffset=e.getEditor().logicalPositionToOffset(e.getOldPosition());
      int newOffset=e.getEditor().logicalPositionToOffset(e.getNewPosition());
      if (newOffset <= myLbraceMarker.getStartOffset()) {
        myAlarm.cancelAllRequests();
        addAlarmRequest();
        return;
      }
      int offset1=Math.min(oldOffset,newOffset);
      int offset2=Math.max(oldOffset,newOffset);
      CharSequence chars=e.getEditor().getDocument().getCharsSequence();
      int offset=CharArrayUtil.shiftForwardUntil(chars,offset1,myParameterCloseChars);
      if (offset < offset2) {
        myAlarm.cancelAllRequests();
        addAlarmRequest();
      }
 else {
        if (myAlarm.cancelAllRequests() > 0) {
          addAlarmRequest();
        }
      }
    }
  }
;
  myEditor.getCaretModel().addCaretListener(myEditorCaretListener);
  myEditorDocumentListener=new DocumentAdapter(){
    @Override public void documentChanged(    DocumentEvent e){
      if (!myHandler.tracksParameterIndex()) {
        myAlarm.cancelAllRequests();
        addAlarmRequest();
        return;
      }
      CharSequence oldS=e.getOldFragment();
      if (CharArrayUtil.shiftForwardUntil(oldS,0,myParameterCloseChars) < oldS.length()) {
        myAlarm.cancelAllRequests();
        addAlarmRequest();
        return;
      }
      CharSequence newS=e.getNewFragment();
      if (CharArrayUtil.shiftForwardUntil(newS,0,myParameterCloseChars) < newS.length()) {
        myAlarm.cancelAllRequests();
        addAlarmRequest();
        return;
      }
      if (myAlarm.cancelAllRequests() > 0) {
        addAlarmRequest();
      }
    }
  }
;
  myEditor.getDocument().addDocumentListener(myEditorDocumentListener);
  myLookupListener=new PropertyChangeListener(){
    @Override public void propertyChange(    PropertyChangeEvent evt){
      if (LookupManager.PROP_ACTIVE_LOOKUP.equals(evt.getPropertyName())) {
        final LookupImpl lookup=(LookupImpl)evt.getNewValue();
        if (lookup != null && lookup.isShown()) {
          adjustPositionForLookup(lookup);
        }
      }
    }
  }
;
  LookupManager.getInstance(project).addPropertyChangeListener(myLookupListener);
  updateComponent();
  if (myEditor instanceof EditorImpl) {
    Disposer.register(((EditorImpl)myEditor).getDisposable(),new Disposable(){
      @Override public void dispose(){
        ParameterInfoController.this.dispose();
      }
    }
);
  }
}
