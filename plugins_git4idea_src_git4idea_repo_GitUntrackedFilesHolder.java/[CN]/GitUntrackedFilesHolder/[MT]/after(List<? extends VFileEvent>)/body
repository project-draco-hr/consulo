{
  boolean allChanged=false;
  Set<VirtualFile> filesToRefresh=new HashSet<VirtualFile>();
  for (  VFileEvent event : events) {
    if (allChanged) {
      break;
    }
    VirtualFile file=event.getFile();
    if (file == null) {
      continue;
    }
    String path=file.getPath();
    if (totalRefreshNeeded(path)) {
      allChanged=true;
    }
 else {
      VirtualFile affectedFile=getAffectedFile(event);
      if (notIgnored(affectedFile)) {
        filesToRefresh.add(affectedFile);
      }
    }
  }
  if (allChanged) {
    LOG.info(String.format("GitUntrackedFilesHolder: Index has changed, marking %s recursively dirty",myRoot));
    myDirtyScopeManager.dirDirtyRecursively(myRoot);
synchronized (LOCK) {
      myReady=false;
    }
  }
 else {
synchronized (LOCK) {
      myPossiblyUntrackedFiles.addAll(filesToRefresh);
    }
  }
}
