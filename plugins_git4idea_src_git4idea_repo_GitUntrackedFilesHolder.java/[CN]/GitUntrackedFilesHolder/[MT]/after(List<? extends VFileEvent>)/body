{
  boolean indexChanged=false;
  Set<VirtualFile> filesToRefresh=new HashSet<VirtualFile>();
  for (  VFileEvent event : events) {
    if (indexChanged) {
      break;
    }
    VirtualFile file=event.getFile();
    if (file == null) {
      continue;
    }
    String path=file.getPath();
    if (myRepositoryFiles.isIndexFile(path)) {
      indexChanged=true;
    }
 else {
      VirtualFile affectedFile=getAffectedFile(event);
      if (notIgnored(affectedFile)) {
        filesToRefresh.add(affectedFile);
      }
    }
  }
  if (indexChanged) {
    myDirtyScopeManager.dirDirtyRecursively(myRoot);
synchronized (LOCK) {
      myReady=false;
    }
  }
 else {
synchronized (LOCK) {
      myPossiblyUntrackedFiles.addAll(filesToRefresh);
    }
  }
}
