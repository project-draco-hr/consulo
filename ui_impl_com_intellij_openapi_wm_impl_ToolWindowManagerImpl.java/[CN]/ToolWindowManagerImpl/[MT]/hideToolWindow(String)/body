{
  ApplicationManager.getApplication().assertIsDispatchThread();
  checkId(id);
  final WindowInfo info=getInfo(id);
  if (!info.isVisible())   return;
  final ArrayList<FinalizableCommand> commandList=new ArrayList<FinalizableCommand>();
  final boolean wasActive=info.isActive();
  deactivateToolWindowImpl(id,true,commandList);
  WindowInfo info2=null;
  while (!mySideStack.isEmpty(info.getAnchor())) {
    final WindowInfo storedInfo=mySideStack.pop(info.getAnchor());
    final WindowInfo currentInfo=getInfo(storedInfo.getId());
    LOG.assertTrue(currentInfo != null);
    if (storedInfo.getAnchor() == currentInfo.getAnchor() && storedInfo.getType() == currentInfo.getType() && storedInfo.isAutoHide() == currentInfo.isAutoHide()) {
      info2=storedInfo;
      break;
    }
  }
  if (info2 != null) {
    showToolWindowImpl(info2.getId(),false,commandList);
  }
  myActiveStack.remove(id,false);
  if (wasActive) {
    if (myActiveStack.isEmpty()) {
      activateEditorComponentImpl(commandList);
    }
 else {
      final String toBeActivatedId=myActiveStack.pop();
      if (toBeActivatedId != null) {
        activateToolWindowImpl(toBeActivatedId,commandList);
      }
    }
  }
  execute(commandList);
}
