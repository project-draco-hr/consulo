{
  final Commenter commenter=findCommenter(line);
  if (commenter == null)   return;
  String prefix=commenter.getLineCommentPrefix();
  if (prefix != null) {
    myDocument.insertString(offset,prefix);
  }
 else {
    prefix=commenter.getBlockCommentPrefix();
    String suffix=commenter.getBlockCommentSuffix();
    int endOffset=myDocument.getLineEndOffset(line);
    final int textLength=myDocument.getTextLength();
    final CharSequence chars=myDocument.getCharsSequence();
    offset=CharArrayUtil.shiftForward(chars,offset," \t");
    if (endOffset == textLength) {
      final int shifted=CharArrayUtil.shiftBackward(chars,textLength - 1," \t");
      if (shifted < textLength - 1)       endOffset=shifted;
    }
 else {
      endOffset=CharArrayUtil.shiftBackward(chars,endOffset," \t");
    }
    myDocument.insertString(endOffset,suffix);
    myDocument.insertString(offset,prefix);
  }
}
