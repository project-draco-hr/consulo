{
  super.setUp(testMethod);
  myRevisions=new ArrayList<GitTestRevision>(7);
  myRevisionsAfterRename=new ArrayList<GitTestRevision>(4);
  final String[] commitMessages={"initial commit","simple commit","moved a.txt to dir/b.txt","simple commit after rename","commit with {%n} some [%ct] special <format:%H%at> characters including \"--pretty=tformat:%x00%x01%x00%H%x00%ct%x00%an%x20%x3C%ae%x3E%x00%cn%x20%x3C%ce%x3E%x00%x02%x00%s%x00%b%x00%x02%x01\"","commit subject\n\ncommit body which is \n multilined.","first line\nsecond line\nthird line\n\nfifth line\n\nseventh line & the end."};
  final String[] contents={"initial content","second content","second content","fourth content","fifth content","sixth content","seventh content"};
  int commitIndex=0;
  afile=myRepo.createVFile("a.txt",contents[commitIndex]);
  myRepo.addCommit(commitMessages[commitIndex]);
  commitIndex++;
  editFileInCommand(myProject,afile,contents[commitIndex]);
  myRepo.addCommit(commitMessages[commitIndex]);
  int RENAME_COMMIT_INDEX=commitIndex;
  commitIndex++;
  VirtualFile dir=myRepo.createVDir("dir");
  myRepo.mv(afile,"dir/b.txt");
  myRepo.refresh();
  final File bIOFile=new File(dir.getPath(),"b.txt");
  bfilePath=VcsUtil.getFilePath(bIOFile);
  bfile=VcsUtil.getVirtualFile(bIOFile);
  myRepo.commit(commitMessages[commitIndex]);
  commitIndex++;
  for (int i=0; i < 4; i++) {
    editFileInCommand(myProject,bfile,contents[commitIndex]);
    myRepo.addCommit(commitMessages[commitIndex]);
    commitIndex++;
  }
  String[] revisions=myRepo.log("--pretty=format:%H#%at#%P","-M").split("\n");
  for (int i=revisions.length - 1, j=0; i >= 0; i--, j++) {
    String[] details=revisions[j].trim().split("#");
    String[] parents;
    if (details.length > 2) {
      parents=details[2].split(" ");
    }
 else {
      parents=ArrayUtil.EMPTY_STRING_ARRAY;
    }
    final GitTestRevision revision=new GitTestRevision(details[0],details[1],parents,commitMessages[i],MAIN_USER_NAME,MAIN_USER_EMAIL,MAIN_USER_NAME,MAIN_USER_EMAIL,null,contents[i]);
    myRevisions.add(revision);
    if (i > RENAME_COMMIT_INDEX) {
      myRevisionsAfterRename.add(revision);
    }
  }
  assertEquals(myRevisionsAfterRename.size(),5);
}
