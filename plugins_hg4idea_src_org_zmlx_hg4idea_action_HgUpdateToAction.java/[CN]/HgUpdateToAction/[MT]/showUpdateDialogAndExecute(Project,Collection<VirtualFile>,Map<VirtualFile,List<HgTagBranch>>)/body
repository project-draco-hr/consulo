{
  final HgUpdateToDialog dialog=new HgUpdateToDialog(project);
  dialog.setRoots(repos,branchesForRepos);
  dialog.show();
  if (dialog.isOK()) {
    FileDocumentManager.getInstance().saveAllDocuments();
    String updateToValue;
    if (dialog.isBranchSelected() && dialog.getBranch() != null) {
      updateToValue=dialog.getBranch().getName();
    }
 else     if (dialog.isTagSelected() && dialog.getTag() != null) {
      updateToValue=dialog.getTag().getName();
    }
 else     if (dialog.isRevisionSelected()) {
      updateToValue=dialog.getRevision();
    }
 else {
      new HgCommandResultNotifier(project).notifyError(null,"Update failed","Couldn't execute Mercurial command");
      return;
    }
    new Task.Backgroundable(project,HgVcsMessages.message("action.hg4idea.updateTo.description",updateToValue)){
      @Override public void run(      @NotNull ProgressIndicator indicator){
        updateTo(dialog,project);
        markDirtyAndHandleErrors(project,dialog.getRepository());
      }
    }
.queue();
  }
}
