{
  if (!myUIInitialized)   return;
  final List<Facet> implicitFacets=getImplicitFacets();
  if (!Comparing.haveEqualElements(myImplicitFacets,implicitFacets)) {
    final Set<Facet> newFacets=new HashSet<Facet>(implicitFacets);
    newFacets.removeAll(myImplicitFacets);
    if (!ApplicationManager.getApplication().isHeadlessEnvironment()) {
      final boolean someFacetsDeleted=!implicitFacets.containsAll(myImplicitFacets);
      final boolean stopBlinking=!myImplicitFacets.isEmpty() && implicitFacets.isEmpty();
      final boolean startBlinking=myImplicitFacets.isEmpty() && !implicitFacets.isEmpty();
      Runnable runnable=new Runnable(){
        public void run(){
          if (isDisposed())           return;
          if (someFacetsDeleted && myNotificationPopup != null) {
            myNotificationPopup.cancel();
          }
          myPendingNewFacets.addAll(newFacets);
          queueNotificationPopup();
          if (stopBlinking) {
            myAttentionComponent.stopBlinking();
          }
          if (startBlinking) {
            myAttentionComponent.startBlinking();
          }
        }
      }
;
      if (ApplicationManager.getApplication().isDispatchThread() && ApplicationManager.getApplication().getCurrentModalityState() == ModalityState.NON_MODAL) {
        runnable.run();
      }
 else {
        ApplicationManager.getApplication().invokeLater(runnable,ModalityState.NON_MODAL);
      }
    }
    myImplicitFacets=implicitFacets;
  }
}
