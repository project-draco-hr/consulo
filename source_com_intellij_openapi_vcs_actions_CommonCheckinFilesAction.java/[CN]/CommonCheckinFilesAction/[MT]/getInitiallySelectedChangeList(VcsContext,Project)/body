{
  final ChangeListManager changeListManager=ChangeListManager.getInstance(project);
  FilePath[] roots=getRoots(context);
  for (  FilePath root : roots) {
    final VirtualFile file=root.getVirtualFile();
    if (file == null)     continue;
    final Ref<Change> change=new Ref<Change>();
    if (!file.isDirectory()) {
      change.set(changeListManager.getChange(file));
    }
 else {
      ProjectRootManager.getInstance(project).getFileIndex().iterateContentUnderDirectory(file,new ContentIterator(){
        public boolean processFile(        VirtualFile fileOrDir){
          Change c=changeListManager.getChange(fileOrDir);
          if (c != null) {
            change.set(c);
            return false;
          }
          return true;
        }
      }
);
    }
    if (!change.isNull()) {
      return changeListManager.getChangeList(change.get());
    }
  }
  return changeListManager.getDefaultChangeList();
}
