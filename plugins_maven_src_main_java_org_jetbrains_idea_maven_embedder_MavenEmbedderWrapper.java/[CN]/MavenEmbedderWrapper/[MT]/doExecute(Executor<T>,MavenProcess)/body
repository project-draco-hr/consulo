{
  final Ref<T> result=new Ref<T>();
  final boolean[] cancelled=new boolean[1];
  final Exception[] exception=new Exception[1];
  Future<?> future=ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    public void run(){
      try {
        result.set(executor.execute());
      }
 catch (      ProcessCanceledException e) {
        cancelled[0]=true;
      }
catch (      Exception e) {
        exception[0]=e;
      }
    }
  }
);
  while (true) {
    p.checkCanceled();
    try {
      future.get(50,TimeUnit.MILLISECONDS);
    }
 catch (    TimeoutException ignore) {
    }
catch (    ExecutionException e) {
      throw new RuntimeException(e.getCause());
    }
catch (    InterruptedException e) {
      throw new MavenProcessCanceledException();
    }
    if (future.isDone())     break;
  }
  if (cancelled[0])   throw new MavenProcessCanceledException();
  if (exception[0] != null)   throw new RuntimeException(exception[0]);
  return result.get();
}
