{
synchronized (file) {
    if (areBeltsFastened(file))     return;
    file.putUserData(BELTS_ARE_FASTEN_KEY,Boolean.TRUE);
    List<SmartPointerEx> pointers=getPointers(file);
    if (pointers == null)     return;
    PsiDocumentManager psiDocumentManager=PsiDocumentManager.getInstance(file.getProject());
    Document document=psiDocumentManager.getDocument(file);
    if (document instanceof DocumentImpl) {
      ((DocumentImpl)document).normalizeRangeMarkers();
    }
    for (int i=0; i < pointers.size(); i++) {
      SmartPointerEx pointer=pointers.get(i);
      if (pointer != null) {
        pointer.fastenBelt(offset,cachedRangeMarker);
      }
    }
    for (    DocumentWindow injectedDoc : InjectedLanguageUtil.getCachedInjectedDocuments(file)) {
      PsiFile injectedFile=psiDocumentManager.getPsiFile(injectedDoc);
      if (injectedFile == null)       continue;
      RangeMarker cachedMarker=getCachedRangeMarkerToInjectedFragment(injectedFile);
      fastenBelts(injectedFile,0,cachedMarker);
    }
  }
}
