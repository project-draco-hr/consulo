{
  PsiFile file=element.getContainingFile();
  if (file != null) {
synchronized (file) {
      Document document=PsiDocumentManager.getInstance(myProject).getCachedDocument(file);
      if (document != null) {
        if (!(element instanceof PsiFile)) {
          PsiDocumentManagerImpl documentManager=(PsiDocumentManagerImpl)PsiDocumentManager.getInstance(myProject);
          LOG.assertTrue(!documentManager.isUncommited(document) || documentManager.isCommittingDocument(document),"Document for : " + file + " is not committed");
        }
      }
      ArrayList<WeakReference<SmartPointerEx>> pointers=file.getUserData(SMART_POINTERS_IN_PSI_FILE_KEY);
      if (pointers == null) {
        pointers=new ArrayList<WeakReference<SmartPointerEx>>();
        file.putUserData(SMART_POINTERS_IN_PSI_FILE_KEY,pointers);
      }
      pointers.add(new WeakReference<SmartPointerEx>(pointer));
      if (areBeltsFastened(file)) {
        pointer.fastenBelt();
      }
    }
  }
}
