{
  try {
    final EvaluationContextImpl thisEvaluationContext=getEvaluationContext(evaluationContext);
    final ExpressionEvaluator evaluator=DebuggerInvocationUtil.commitAndRunReadAction(myProject,new EvaluatingComputable<ExpressionEvaluator>(){
      public ExpressionEvaluator compute() throws EvaluateException {
        return EvaluatorBuilderImpl.getInstance().build(getEvaluationCode(thisEvaluationContext));
      }
    }
);
    if (!thisEvaluationContext.getDebugProcess().isAttached())     throw EvaluateExceptionUtil.PROCESS_EXITED;
    StackFrameProxyImpl frameProxy=thisEvaluationContext.getFrameProxy();
    if (frameProxy == null)     throw EvaluateExceptionUtil.NULL_STACK_FRAME;
    final Value value=evaluator.evaluate(thisEvaluationContext);
    if (value instanceof ObjectReference) {
      thisEvaluationContext.getSuspendContext().keep(((ObjectReference)value));
    }
    myModifier=evaluator.getModifier();
    setLvalue(myModifier != null);
    return value;
  }
 catch (  final EvaluateException ex) {
    throw new EvaluateException(ex.getMessage() + " Failed to evaluate expression",ex);
  }
}
