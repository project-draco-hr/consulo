{
  Module m=findModuleByName(moduleName);
  ModuleOrderEntry e;
  if (m != null) {
    e=myRootModel.addModuleOrderEntry(m);
  }
 else {
    AccessToken accessToken=ReadAction.start();
    try {
      e=myRootModel.addInvalidModuleEntry(moduleName);
    }
  finally {
      accessToken.finish();
    }
  }
  e.setScope(scope);
  if (testJar) {
    ((ModuleOrderEntryImpl)e).setProductionOnTestDependency(true);
  }
}
