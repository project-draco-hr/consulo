{
  final CreateResourceFileAction action=getInstance();
  String subdirName=resType.getName();
  VirtualFile resourceDir=facet.getLocalResourceManager().getResourceDir();
  if (chooseDirectory) {
    final MyDialog dialog=new MyDialog(facet,action.mySubactions.values(),resType,resName,action,facet.getModule(),true);
    dialog.setTitle(AndroidBundle.message("new.resource.dialog.title"));
    dialog.show();
    if (!dialog.isOK()) {
      return PsiElement.EMPTY_ARRAY;
    }
    subdirName=dialog.getSubdirName();
    final AndroidFacet selectedFacet=AndroidFacet.getInstance(dialog.getSelectedModule());
    LOG.assertTrue(selectedFacet != null);
    resourceDir=selectedFacet.getLocalResourceManager().getResourceDir();
  }
  if (resourceDir != null) {
    final PsiDirectory psiResDir=PsiManager.getInstance(project).findDirectory(resourceDir);
    if (psiResDir != null) {
      CreateElementActionBase.MyInputValidator validator=action.createValidator(project,psiResDir,subdirName);
      if (validator.checkInput(resName) && validator.canClose(resName)) {
        return validator.getCreatedElements();
      }
    }
  }
  return PsiElement.EMPTY_ARRAY;
}
