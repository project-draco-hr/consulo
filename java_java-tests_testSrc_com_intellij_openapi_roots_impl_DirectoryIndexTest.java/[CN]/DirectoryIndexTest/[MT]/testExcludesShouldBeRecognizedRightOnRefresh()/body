{
  final VirtualFile dir=myModule1Dir.createChildDirectory(this,"dir");
  final VirtualFile excluded=dir.createChildDirectory(this,"excluded");
  PsiTestUtil.addExcludedRoot(myModule,excluded);
  new WriteCommandAction.Simple(getProject()){
    @Override protected void run() throws Throwable {
      dir.delete(DirectoryIndexTest.this);
    }
  }
.execute().throwException();
  boolean created=new File(myModule1Dir.getPath(),"dir/excluded/foo").mkdirs();
  assertTrue(created);
  VirtualFileListener l=new VirtualFileAdapter(){
    @Override public void fileCreated(    VirtualFileEvent e){
      assertEquals("dir",e.getFileName());
      VirtualFile file=e.getFile();
      checkInfoNotNull(file);
      checkInfoNull(file.findFileByRelativePath("excluded"));
      checkInfoNull(file.findFileByRelativePath("excluded/foo"));
    }
  }
;
  VirtualFileManager.getInstance().addVirtualFileListener(l,getTestRootDisposable());
  VirtualFileManager.getInstance().refresh(false);
}
