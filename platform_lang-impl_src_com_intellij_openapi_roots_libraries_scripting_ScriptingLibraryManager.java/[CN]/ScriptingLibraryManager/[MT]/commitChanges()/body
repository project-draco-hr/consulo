{
  if (myLibTable != null) {
    LibraryTable libTable=getLibraryTable();
    if (libTable != null) {
      LibraryTable.ModifiableModel libTableModel=libTable.getModifiableModel();
      for (      Library library : libTableModel.getLibraries()) {
        ScriptingLibraryTable.LibraryModel scriptingLibModel=myLibTable.getLibraryByName(library.getName());
        if (scriptingLibModel == null) {
          libTableModel.removeLibrary(library);
        }
 else {
          Library.ModifiableModel libModel=library.getModifiableModel();
          for (          VirtualFile libRoot : libModel.getFiles(OrderRootType.SOURCES)) {
            libModel.removeRoot(libRoot.getUrl(),OrderRootType.SOURCES);
          }
          for (          VirtualFile newRoot : scriptingLibModel.getSourceFiles()) {
            libModel.addRoot(newRoot,OrderRootType.SOURCES);
          }
          libModel.commit();
        }
      }
      for (      ScriptingLibraryTable.LibraryModel scriptingLibModel : myLibTable.getLibraries()) {
        Library library=libTableModel.getLibraryByName(scriptingLibModel.getName());
        if (library == null && libTableModel instanceof LibraryTableBase.ModifiableModelEx) {
          library=((LibraryTableBase.ModifiableModelEx)libTableModel).createLibrary(scriptingLibModel.getName(),myLibraryType);
          Library.ModifiableModel libModel=library.getModifiableModel();
          for (          VirtualFile newRoot : scriptingLibModel.getSourceFiles()) {
            libModel.addRoot(newRoot,OrderRootType.SOURCES);
          }
          libModel.commit();
        }
      }
      libTableModel.commit();
    }
  }
  if (myLibLevel == LibraryLevel.GLOBAL) {
    ModuleManager.getInstance(myProject).getModifiableModel().commit();
  }
}
