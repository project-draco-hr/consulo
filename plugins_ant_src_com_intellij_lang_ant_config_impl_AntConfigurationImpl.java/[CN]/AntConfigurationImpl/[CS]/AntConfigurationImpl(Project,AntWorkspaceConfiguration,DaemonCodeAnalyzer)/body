{
  super(project);
  getProperties().registerProperty(DEFAULT_ANT,AntReference.EXTERNALIZER);
  getProperties().rememberKey(INSTANCE);
  getProperties().rememberKey(DEFAULT_JDK_NAME);
  INSTANCE.set(getProperties(),this);
  myAntWorkspaceConfiguration=antWorkspaceConfiguration;
  myPsiManager=PsiManager.getInstance(project);
  myStartupManager=StartupManager.getInstance(project);
  addAntConfigurationListener(new AntConfigurationListener(){
    public void configurationLoaded(){
      restartDaemon();
    }
    public void buildFileChanged(    final AntBuildFile buildFile){
      restartDaemon();
    }
    public void buildFileAdded(    final AntBuildFile buildFile){
      restartDaemon();
    }
    public void buildFileRemoved(    final AntBuildFile buildFile){
      restartDaemon();
    }
    private void restartDaemon(){
      if (ApplicationManager.getApplication().isDispatchThread()) {
        daemon.restart();
      }
 else {
        SwingUtilities.invokeLater(new Runnable(){
          public void run(){
            daemon.restart();
          }
        }
);
      }
    }
  }
);
  VirtualFileManager.getInstance().addVirtualFileListener(new VirtualFileAdapter(){
    public void beforeFileDeletion(    final VirtualFileEvent event){
      final VirtualFile vFile=event.getFile();
      final AntFile antFile=toAntFile(vFile);
      if (antFile != null) {
        for (        AntBuildFile file : getBuildFiles()) {
          if (antFile.equals(file.getAntFile())) {
            removeBuildFile(file);
            break;
          }
        }
        for (Iterator<VirtualFile> it=myAntFileToContextFileMap.keySet().iterator(); it.hasNext(); ) {
          final VirtualFile file=it.next();
          if (vFile.equals(file) || vFile.equals(myAntFileToContextFileMap.get(file))) {
            it.remove();
          }
        }
      }
    }
  }
,project);
}
