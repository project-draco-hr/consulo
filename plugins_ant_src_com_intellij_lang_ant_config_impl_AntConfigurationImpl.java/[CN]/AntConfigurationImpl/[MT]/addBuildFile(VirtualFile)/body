{
  final AntBuildFile[] result=new AntBuildFile[]{null};
  final AntNoFileException[] ex=new AntNoFileException[]{null};
  final String title=AntBundle.message("register.ant.build.progress",file.getPresentableUrl());
  ProgressManager.getInstance().run(new Task.Backgroundable(getProject(),title,false){
    public void run(    final ProgressIndicator indicator){
      indicator.setIndeterminate(true);
      indicator.pushState();
      try {
        indicator.setText(title);
        myModificationCount++;
        ApplicationManager.getApplication().runReadAction(new Runnable(){
          public void run(){
            try {
              result[0]=addBuildFileImpl(file);
              updateRegisteredActions();
            }
 catch (            AntNoFileException e) {
              ex[0]=e;
            }
          }
        }
);
        if (result[0] != null) {
          ApplicationManager.getApplication().invokeLater(new Runnable(){
            public void run(){
              myEventDispatcher.getMulticaster().buildFileAdded(result[0]);
            }
          }
);
        }
      }
  finally {
        indicator.popState();
      }
    }
  }
);
  if (ex[0] != null) {
    throw ex[0];
  }
  return result[0];
}
