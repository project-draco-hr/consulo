{
  final Set<PsiElement> processed=PsiElementSetSpinAllocator.alloc();
  try {
    return new Object(){
      @Nullable AntFile findContext(      final AntFile file,      Set<PsiElement> processed){
        if (file != null) {
          processed.add(file);
          final AntFile contextFile=toAntFile(myAntFileToContextFileMap.get(file.getVirtualFile()));
          return (contextFile == null || processed.contains(contextFile)) ? file : findContext(contextFile,processed);
        }
        return null;
      }
    }
.findContext(file,processed);
  }
  finally {
    PsiElementSetSpinAllocator.dispose(processed);
  }
}
