{
  List<Element> events=null;
  final Set<String> savedEvents=new HashSet<String>();
synchronized (myEventToTargetMap) {
    for (    final ExecutionEvent event : myEventToTargetMap.keySet()) {
      final Pair<AntBuildFile,String> pair=myEventToTargetMap.get(event);
      if (!buildFile.equals(pair.first)) {
        continue;
      }
      Element eventElement=new Element(EXECUTE_ON_ELEMENT);
      eventElement.setAttribute(EVENT_ELEMENT,event.getTypeId());
      eventElement.setAttribute(TARGET_ELEMENT,pair.second);
      final String id=event.writeExternal(eventElement,getProject());
      if (savedEvents.contains(id))       continue;
      savedEvents.add(id);
      if (events == null) {
        events=new ArrayList<Element>();
      }
      events.add(eventElement);
    }
  }
  if (events != null) {
    Collections.sort(events,EventElementComparator.INSTANCE);
    for (    Element eventElement : events) {
      element.addContent(eventElement);
    }
  }
}
