{
  if (buildFileUrl == null || targetName == null || configType == null) {
    return;
  }
  final RunManagerImpl runManager=(RunManagerImpl)RunManagerEx.getInstanceEx(project);
  final ConfigurationType type=runManager.getConfigurationType(configType);
  if (type == null) {
    return;
  }
  if (configName != null) {
    for (    RunConfiguration configuration : runManager.getConfigurations(type)) {
      if (configName.equals(configuration.getName())) {
        final List<AntBeforeRunTask> tasks=runManager.getBeforeRunTasks(configuration,AntBeforeRunTaskProvider.ID);
        if (!tasks.isEmpty()) {
          AntBeforeRunTask task=tasks.get(0);
          task.setEnabled(true);
          task.setTargetName(targetName);
          task.setAntFileUrl(buildFileUrl);
        }
      }
    }
  }
 else {
    for (    ConfigurationFactory factory : type.getConfigurationFactories()) {
      final RunConfiguration template=runManager.getConfigurationTemplate(factory).getConfiguration();
      final List<AntBeforeRunTask> tasks=runManager.getBeforeRunTasks(template,AntBeforeRunTaskProvider.ID);
      if (!tasks.isEmpty()) {
        AntBeforeRunTask task=tasks.get(0);
        task.setEnabled(true);
        task.setTargetName(targetName);
        task.setAntFileUrl(buildFileUrl);
      }
    }
  }
}
