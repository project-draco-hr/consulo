{
  getProperties().writeExternal(parentNode);
  final ActionRunner.InterruptibleRunnable action=new ActionRunner.InterruptibleRunnable(){
    public void run() throws WriteExternalException {
      for (      final AntBuildFile buildFile : myBuildFiles) {
        Element element=new Element(BUILD_FILE);
        element.setAttribute(URL,buildFile.getVirtualFile().getUrl());
        buildFile.writeProperties(element);
        for (        final ExecutionEvent event : myEventToTargetMap.keySet()) {
          Pair pair=myEventToTargetMap.get(event);
          if (buildFile.equals(pair.first)) {
            Element eventElement=new Element(EXECUTE_ON_ELEMENT);
            eventElement.setAttribute(EVENT_ELEMENT,event.getTypeId());
            eventElement.setAttribute(TARGET_ELEMENT,(String)pair.second);
            event.writeExternal(eventElement);
            element.addContent(eventElement);
          }
        }
        parentNode.addContent(element);
      }
    }
  }
;
  try {
    ActionRunner.runInsideReadAction(action);
  }
 catch (  Exception e) {
    if (e instanceof WriteExternalException)     throw (WriteExternalException)e;
    if (e instanceof RuntimeException)     throw (RuntimeException)e;
    LOG.error(e);
  }
}
