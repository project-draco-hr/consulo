{
  PsiFile xmlFile=myPsiManager.findFile(file);
  if (!(xmlFile instanceof XmlFile) || !AntDomFileDescription.isAntFile(((XmlFile)xmlFile))) {
    throw new AntNoFileException(AntBundle.message("cant.add.file.error.message"),file);
  }
  AntSupport.markFileAsAntFile(file,xmlFile.getProject(),true);
  final AntBuildFileImpl buildFile=new AntBuildFileImpl((XmlFile)xmlFile,this);
  xmlFile.putCopyableUserData(AntBuildFile.ANT_BUILD_FILE_KEY,buildFile);
synchronized (myBuildFiles) {
    myBuildFilesArray=null;
    myBuildFiles.add(buildFile);
  }
  return buildFile;
}
