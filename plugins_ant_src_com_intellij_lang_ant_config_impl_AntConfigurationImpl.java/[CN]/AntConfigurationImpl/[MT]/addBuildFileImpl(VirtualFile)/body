{
  PsiFile psiFile=myPsiManager.findFile(file);
  if (psiFile == null) {
    throw new AntNoFileException(AntBundle.message("cant.add.file.error.message"),file);
  }
  AntSupport.markFileAsAntFile(file,psiFile.getViewProvider(),true);
  psiFile=AntSupport.getAntFile(psiFile);
  if (psiFile == null) {
    throw new AntNoFileException(AntBundle.message("cant.add.file.error.message"),file);
  }
  final AntFile antFile=(AntFile)psiFile;
  final AntBuildFileImpl buildFile=new AntBuildFileImpl(antFile,this);
  antFile.getSourceElement().putCopyableUserData(AntBuildFile.ANT_BUILD_FILE_KEY,buildFile);
synchronized (myBuildFiles) {
    myBuildFilesArray=null;
    myBuildFiles.add(buildFile);
  }
  return buildFile;
}
