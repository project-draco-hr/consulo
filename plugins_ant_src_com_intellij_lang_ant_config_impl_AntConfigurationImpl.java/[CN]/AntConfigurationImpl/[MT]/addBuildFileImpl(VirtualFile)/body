{
  PsiFile psiFile=myPsiManager.findFile(file);
  if (psiFile == null) {
    throw new AntNoFileException(AntBundle.message("cant.add.file.error.message"),file);
  }
  AntSupport.markFileAsAntFile(file,psiFile.getViewProvider(),true);
  psiFile=AntSupport.getAntFile(psiFile);
  if (psiFile == null) {
    throw new AntNoFileException(AntBundle.message("cant.add.file.error.message"),file);
  }
  final AntBuildFileImpl buildFile=new AntBuildFileImpl((AntFile)psiFile,this);
  myBuildFiles.add(buildFile);
  myEventDispatcher.getMulticaster().buildFileAdded(buildFile);
  return buildFile;
}
