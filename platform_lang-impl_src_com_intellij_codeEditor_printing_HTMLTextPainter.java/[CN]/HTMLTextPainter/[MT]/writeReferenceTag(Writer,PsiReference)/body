{
  PsiElement refClass=ref.resolve();
  PsiFile refFile=refClass.getContainingFile();
  String refPackageName=PsiDirectoryFactory.getInstance(myProject).getQualifiedName(refFile.getContainingDirectory(),false);
  String psiPackageName=PsiDirectoryFactory.getInstance(myProject).getQualifiedName(myPsiFile.getContainingDirectory(),false);
  StringBuffer fileName=new StringBuffer();
  if (!psiPackageName.equals(refPackageName)) {
    StringTokenizer tokens=new StringTokenizer(psiPackageName,".");
    while (tokens.hasMoreTokens()) {
      tokens.nextToken();
      fileName.append("../");
    }
    StringTokenizer refTokens=new StringTokenizer(refPackageName,".");
    while (refTokens.hasMoreTokens()) {
      String token=refTokens.nextToken();
      fileName.append(token);
      fileName.append('/');
    }
  }
  fileName.append(ExportToHTMLManager.getHTMLFileName(refFile));
  writer.write("<a href=\"" + fileName + "\">");
  return ref.getElement().getTextRange().getEndOffset();
}
