{
  myProject=project;
  myPsiFile=psiFile;
  myPrintLineNumbers=printLineNumbers;
  myHighlighter=HighlighterFactory.createHighlighter(project,psiFile.getVirtualFile());
  myText=psiFile.getText();
  myHighlighter.setText(myText);
  mySegmentEnd=myText.length();
  myFileName=psiFile.getVirtualFile().getPresentableUrl();
  myHTMLFileName=dirName + File.separator + ExportToHTMLManager.getHTMLFileName(psiFile);
  PsiDocumentManager psiDocumentManager=PsiDocumentManager.getInstance(project);
  psiDocumentManager.commitAllDocuments();
  Document document=psiDocumentManager.getDocument(psiFile);
  ArrayList<LineMarkerInfo> methodSeparators=new ArrayList<LineMarkerInfo>();
  if (document != null) {
    final List<LineMarkerInfo> separators=FileSeparatorProvider.getInstance().getFileSeparators(psiFile,document);
    if (separators != null) {
      methodSeparators.addAll(separators);
    }
  }
  myMethodSeparators=methodSeparators.toArray(new LineMarkerInfo[methodSeparators.size()]);
  myCurrentMethodSeparator=0;
}
