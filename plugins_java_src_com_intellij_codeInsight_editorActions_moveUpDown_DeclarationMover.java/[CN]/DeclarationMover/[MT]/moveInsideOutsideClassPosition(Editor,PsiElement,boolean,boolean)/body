{
  if (sibling == null)   throw new IllegalMoveException();
  if (sibling instanceof PsiJavaToken && ((PsiJavaToken)sibling).getTokenType() == (isDown ? JavaTokenType.RBRACE : JavaTokenType.LBRACE) && sibling.getParent() instanceof PsiClass) {
    final PsiClass aClass=(PsiClass)sibling.getParent();
    final PsiElement parent=aClass.getParent();
    if (!areWeMovingClass && !(parent instanceof PsiClass))     throw new IllegalMoveException();
    if (aClass instanceof PsiAnonymousClass)     throw new IllegalMoveException();
    PsiElement start=isDown ? sibling : aClass.getModifierList();
    return new LineRange(start,sibling,editor.getDocument());
  }
  if (!isDown && sibling.getParent() instanceof PsiClass && (sibling instanceof PsiJavaToken && ((PsiJavaToken)sibling).getTokenType() == JavaTokenType.SEMICOLON || sibling instanceof PsiErrorElement)&& firstNonWhiteElement(sibling.getPrevSibling(),false) instanceof PsiEnumConstant) {
    PsiClass aClass=(PsiClass)sibling.getParent();
    Document document=editor.getDocument();
    int startLine=document.getLineNumber(aClass.getTextRange().getStartOffset());
    int endLine=document.getLineNumber(sibling.getTextRange().getEndOffset()) + 1;
    return new LineRange(startLine,endLine);
  }
  if (sibling instanceof PsiClass) {
    PsiClass aClass=(PsiClass)sibling;
    if (aClass instanceof PsiAnonymousClass)     throw new IllegalMoveException();
    if (isDown) {
      PsiElement child=aClass.getFirstChild();
      if (child == null)       throw new IllegalMoveException();
      return new LineRange(child,aClass.isEnum() ? afterEnumConstantsPosition(aClass) : aClass.getLBrace(),editor.getDocument());
    }
 else {
      PsiElement rBrace=aClass.getRBrace();
      if (rBrace == null)       throw new IllegalMoveException();
      return new LineRange(rBrace,rBrace,editor.getDocument());
    }
  }
  return null;
}
