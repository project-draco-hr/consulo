{
  final ApplicationServer appServer=getOrCreateAppServer(sdk);
  if (appServer != null) {
    final ConfigurationFactory type=AppEngineServerConfigurationType.getInstance().getConfigurationFactories()[0];
    final RunnerAndConfigurationSettings settings=J2EEConfigurationFactory.getInstance().addAppServerConfiguration(project,type,appServer);
    if (artifact != null) {
      final CommonModel configuration=(CommonModel)settings.getConfiguration();
      ((AppEngineServerModel)configuration.getServerModel()).setArtifact(artifact);
      BuildArtifactsBeforeRunTaskProvider.setBuildArtifactBeforeRun(project,configuration,artifact);
    }
    rootModel.addLibraryEntry(appServer.getLibrary()).setScope(DependencyScope.PROVIDED);
  }
}
