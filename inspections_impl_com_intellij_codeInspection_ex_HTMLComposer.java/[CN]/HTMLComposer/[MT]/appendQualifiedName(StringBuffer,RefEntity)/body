{
  String qName="";
  while (!(refEntity instanceof RefProject)) {
    if (qName.length() > 0)     qName="." + qName;
    final String name;
    if (refEntity instanceof RefElement && ((RefElement)refEntity).isSyntheticJSP()) {
      name=XmlUtil.escapeString(refEntity.getName());
    }
 else     if (refEntity instanceof RefMethod) {
      PsiMethod psiMethod=(PsiMethod)((RefMethod)refEntity).getElement();
      if (psiMethod != null) {
        name=psiMethod.getName();
      }
 else {
        name=refEntity.getName();
      }
    }
 else {
      name=refEntity.getName();
    }
    qName=name + qName;
    refEntity=refEntity.getOwner();
  }
  buf.append(qName);
}
