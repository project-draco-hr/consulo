{
  final VcsConfiguration configuration=VcsConfiguration.getInstance(myProject);
  final Collection<VirtualFile> files=myPanel.getVirtualFiles();
  final Runnable performCheckoutAction=new Runnable(){
    @Override public void run(){
      FileDocumentManager.getInstance().saveAllDocuments();
      finishAction.run();
    }
  }
;
  if (configuration.OPTIMIZE_IMPORTS_BEFORE_PROJECT_COMMIT) {
    new OptimizeImportsProcessor(myProject,CheckinHandlerUtil.getPsiFiles(myProject,files),COMMAND_NAME,performCheckoutAction).run();
  }
 else {
    finishAction.run();
  }
}
