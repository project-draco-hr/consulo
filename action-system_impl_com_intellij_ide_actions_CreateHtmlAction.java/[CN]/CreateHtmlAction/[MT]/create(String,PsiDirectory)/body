{
  final FileTemplate template=FileTemplateManager.getInstance().getInternalTemplate(myTemplateName);
  PsiElement element;
  try {
    element=FileTemplateUtil.createFromTemplate(template,getName(newName),FileTemplateManager.getInstance().getDefaultProperties(),directory);
    final PsiFile psiFile=element.getContainingFile();
    final VirtualFile virtualFile=psiFile.getVirtualFile();
    if (virtualFile != null) {
      FileEditorManager.getInstance(directory.getProject()).openFile(virtualFile,true);
      return new PsiElement[]{psiFile};
    }
  }
 catch (  IncorrectOperationException e) {
    throw e;
  }
catch (  Exception e) {
    LOG.error(e);
  }
  return PsiElement.EMPTY_ARRAY;
}
