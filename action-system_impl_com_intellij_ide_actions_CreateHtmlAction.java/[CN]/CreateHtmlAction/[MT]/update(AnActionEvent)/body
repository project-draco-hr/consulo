{
  super.update(e);
  DataContext dataContext=e.getDataContext();
  Project project=(Project)dataContext.getData(DataConstants.PROJECT);
  Presentation presentation=e.getPresentation();
  if (presentation.isEnabled()) {
    Module module=(Module)dataContext.getData(DataConstantsEx.MODULE);
    if (module != null) {
      IdeView view=(IdeView)dataContext.getData(DataConstantsEx.IDE_VIEW);
      if (view != null) {
        ProjectFileIndex projectFileIndex=ProjectRootManager.getInstance(project).getFileIndex();
        PsiDirectory[] dirs=view.getDirectories();
        boolean inSourceRoot=false;
        for (        PsiDirectory dir : dirs) {
          if (projectFileIndex.isInSourceContent(dir.getVirtualFile()) && dir.getPackage() != null) {
            inSourceRoot=true;
            break;
          }
        }
        if (!inSourceRoot)         return;
      }
    }
    presentation.setEnabled(false);
    presentation.setVisible(false);
  }
  final FileTypeManager manager=FileTypeManager.getInstance();
  final FileType fileType=manager.getFileTypeByExtension(HtmlFileType.DOT_DEFAULT_EXTENSION);
  if (fileType == StdFileTypes.PLAIN_TEXT) {
    presentation.setEnabled(false);
    presentation.setVisible(false);
  }
}
