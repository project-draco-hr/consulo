{
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    @Override public void run(){
      PsiClass[] classes=JavaDirectoryService.getInstance().getClasses(dir);
      ContainerUtil.addAll(array,classes);
      if (includeSubdirs) {
        PsiDirectory[] dirs=dir.getSubdirectories();
        for (        PsiDirectory directory : dirs) {
          addClassesInDirectory(directory,includeSubdirs,array);
        }
      }
    }
  }
);
}
