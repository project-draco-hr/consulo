{
  final XmlAttributeValue literal=PsiTreeUtil.getParentOfType(element,XmlAttributeValue.class);
  if (literal == null)   return;
  final String text=StringUtil.unquoteString(literal.getValue());
  final String hexPrefix=text.startsWith("#") ? "#" : "";
  Color oldColor;
  try {
    oldColor=Color.decode(text);
  }
 catch (  NumberFormatException e) {
    oldColor=Color.GRAY;
  }
  Color color=ColorChooser.chooseColor(editorComponent,getText(),oldColor,true);
  if (color == null)   return;
  if (!Comparing.equal(color,oldColor)) {
    final String newText=hexPrefix + ColorUtil.toHex(color);
    final PsiManager manager=literal.getManager();
    final XmlAttribute newAttribute=XmlElementFactory.getInstance(manager.getProject()).createXmlAttribute("name",newText);
    literal.replace(newAttribute.getValueElement());
  }
}
