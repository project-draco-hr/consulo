{
  String kind=element.getAttributeValue(EclipseXml.KIND_ATTR);
  if (kind == null) {
    throw new ConversionException("Missing classpathentry/@kind");
  }
  String path=element.getAttributeValue(EclipseXml.PATH_ATTR);
  if (path == null) {
    throw new ConversionException("Missing classpathentry/@path");
  }
  final boolean exported=EclipseXml.TRUE_VALUE.equals(element.getAttributeValue(EclipseXml.EXPORTED_ATTR));
  final EclipseModuleManager eclipseModuleManager=EclipseModuleManager.getInstance(rootModel.getModule());
  if (kind.equals(EclipseXml.SRC_KIND)) {
    if (path.startsWith("/")) {
      final String moduleName=path.substring(1);
      refsToModules.add(moduleName);
      rootModel.addInvalidModuleEntry(moduleName).setExported(exported);
    }
 else {
      String srcUrl=VfsUtil.pathToUrl(myRootPath + "/" + path);
      boolean isTestFolder=false;
      try {
        isTestFolder=testPattern != null && testPattern.length() > 0 && path.matches(testPattern);
      }
 catch (      PatternSyntaxException e) {
        isTestFolder=false;
      }
      final String linked=expandLinkedResourcesPath(rootModel,usedVariables,path);
      if (linked != null) {
        srcUrl=VfsUtil.pathToUrl(linked);
        eclipseModuleManager.registerEclipseLinkedSrcVarPath(srcUrl,path);
        rootModel.addContentEntry(srcUrl).addSourceFolder(srcUrl,isTestFolder);
      }
 else {
        getContentEntry().addSourceFolder(srcUrl,isTestFolder);
      }
      eclipseModuleManager.setExpectedModuleSourcePlace(rearrangeOrderEntryOfType(rootModel,ModuleSourceOrderEntry.class));
      eclipseModuleManager.registerSrcPlace(srcUrl,idx);
    }
  }
 else   if (kind.equals(EclipseXml.OUTPUT_KIND)) {
    String output=myRootPath + "/" + path;
    final String linked=expandLinkedResourcesPath(rootModel,usedVariables,path);
    if (linked != null) {
      output=linked;
      eclipseModuleManager.registerEclipseLinkedVarPath(VfsUtil.pathToUrl(output),path);
    }
    setupOutput(rootModel,output);
  }
 else   if (kind.equals(EclipseXml.LIB_KIND)) {
    final String libName=getPresentableName(path);
    final Library library=rootModel.getModuleLibraryTable().getModifiableModel().createLibrary(libName);
    final Library.ModifiableModel modifiableModel=library.getModifiableModel();
    final String linked=expandLinkedResourcesPath(rootModel,usedVariables,path);
    final String url;
    if (linked != null) {
      url=VfsUtil.pathToUrl(linked);
      eclipseModuleManager.registerEclipseLinkedVarPath(url,path);
    }
 else {
      url=expandEclipsePath2Url(path,rootModel,myCurrentRoots);
    }
    modifiableModel.addRoot(url,OrderRootType.CLASSES);
    eclipseModuleManager.registerEclipseLibUrl(url);
    final String sourcePath=element.getAttributeValue(EclipseXml.SOURCEPATH_ATTR);
    if (sourcePath != null) {
      final String linkedSrc=expandLinkedResourcesPath(rootModel,usedVariables,sourcePath);
      final String srcUrl;
      if (linkedSrc != null) {
        srcUrl=VfsUtil.pathToUrl(linkedSrc);
        eclipseModuleManager.registerEclipseLinkedSrcVarPath(srcUrl,sourcePath);
      }
 else {
        srcUrl=expandEclipsePath2Url(sourcePath,rootModel,myCurrentRoots);
      }
      modifiableModel.addRoot(srcUrl,OrderRootType.SOURCES);
    }
    EJavadocUtil.appendJavadocRoots(element,rootModel,myCurrentRoots,modifiableModel);
    modifiableModel.commit();
    setLibraryEntryExported(rootModel,exported,library);
  }
 else   if (kind.equals(EclipseXml.VAR_KIND)) {
    int slash=path.indexOf("/");
    if (slash == 0) {
      throw new ConversionException("Incorrect 'classpathentry/var@path' format");
    }
    final String libName=getPresentableName(path);
    final Library library=rootModel.getModuleLibraryTable().getModifiableModel().createLibrary(libName);
    final Library.ModifiableModel modifiableModel=library.getModifiableModel();
    final String url=eclipseVariabledPath2Url(rootModel,usedVariables,path,0);
    modifiableModel.addRoot(url,OrderRootType.CLASSES);
    eclipseModuleManager.registerEclipseVariablePath(url,path);
    final String srcPathAttr=element.getAttributeValue(EclipseXml.SOURCEPATH_ATTR);
    if (srcPathAttr != null) {
      final String srcUrl=eclipseVariabledPath2Url(rootModel,usedVariables,srcPathAttr,srcVarStart(srcPathAttr));
      modifiableModel.addRoot(srcUrl,OrderRootType.SOURCES);
      eclipseModuleManager.registerEclipseSrcVariablePath(srcUrl,srcPathAttr);
    }
    EJavadocUtil.appendJavadocRoots(element,rootModel,myCurrentRoots,modifiableModel);
    modifiableModel.commit();
    setLibraryEntryExported(rootModel,exported,library);
  }
 else   if (kind.equals(EclipseXml.CON_KIND)) {
    if (path.equals(EclipseXml.ECLIPSE_PLATFORM)) {
      readRequiredBundles(rootModel,refsToModules);
      addNamedLibrary(rootModel,unknownLibraries,exported,IdeaXml.ECLIPSE_LIBRARY,LibraryTablesRegistrar.APPLICATION_LEVEL);
    }
 else     if (path.startsWith(EclipseXml.JRE_CONTAINER)) {
      final String jdkName=getLastPathComponent(path);
      if (jdkName == null) {
        rootModel.inheritSdk();
      }
 else {
        final Sdk moduleJdk=ProjectJdkTable.getInstance().findJdk(jdkName);
        if (moduleJdk != null) {
          rootModel.setSdk(moduleJdk);
        }
 else {
          rootModel.setInvalidSdk(jdkName,IdeaXml.JAVA_SDK_TYPE);
          eclipseModuleManager.setInvalidJdk(jdkName);
          unknownJdks.add(jdkName);
        }
      }
      rearrangeOrderEntryOfType(rootModel,JdkOrderEntry.class);
    }
 else     if (path.startsWith(EclipseXml.USER_LIBRARY)) {
      addNamedLibrary(rootModel,unknownLibraries,exported,getPresentableName(path),LibraryTablesRegistrar.PROJECT_LEVEL);
    }
 else     if (path.startsWith(EclipseXml.JUNIT_CONTAINER)) {
      final String junitName=IdeaXml.JUNIT + getPresentableName(path);
      final Library library=rootModel.getModuleLibraryTable().getModifiableModel().createLibrary(junitName);
      final Library.ModifiableModel modifiableModel=library.getModifiableModel();
      modifiableModel.addRoot(getJunitClsUrl(junitName.contains("4")),OrderRootType.CLASSES);
      modifiableModel.commit();
    }
 else     if (path.equals(EclipseXml.GROOVY_DSL_CONTAINER)) {
      eclipseModuleManager.setGroovyDslSupport();
      eclipseModuleManager.registerSrcPlace(EclipseXml.GROOVY_DSL_CONTAINER,idx);
    }
 else {
      eclipseModuleManager.registerUnknownCons(path);
      addNamedLibrary(rootModel,new ArrayList<String>(),exported,path,LibraryTablesRegistrar.APPLICATION_LEVEL);
    }
  }
 else {
    throw new ConversionException("Unknown classpathentry/@kind: " + kind);
  }
}
