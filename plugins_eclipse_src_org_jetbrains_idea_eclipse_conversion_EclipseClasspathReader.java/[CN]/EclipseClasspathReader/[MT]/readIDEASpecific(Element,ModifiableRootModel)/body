{
  PathMacroManager.getInstance(model.getModule()).expandPaths(root);
  model.getModuleExtension(CompilerModuleExtension.class).readExternal(root);
  model.getModuleExtension(LanguageLevelModuleExtension.class).readExternal(root);
  final ContentEntry[] entries=model.getContentEntries();
  if (entries.length > 0) {
    for (    Object o : root.getChildren(IdeaXml.TEST_FOLDER_TAG)) {
      final String url=((Element)o).getAttributeValue(IdeaXml.URL_ATTR);
      SourceFolder folderToBeTest=null;
      for (      SourceFolder folder : entries[0].getSourceFolders()) {
        if (Comparing.strEqual(folder.getUrl(),url)) {
          folderToBeTest=folder;
          break;
        }
      }
      if (folderToBeTest != null) {
        entries[0].removeSourceFolder(folderToBeTest);
      }
      entries[0].addSourceFolder(url,true);
    }
    for (    Object o : root.getChildren(IdeaXml.EXCLUDE_FOLDER_TAG)) {
      entries[0].addExcludeFolder(((Element)o).getAttributeValue(IdeaXml.URL_ATTR));
    }
  }
  for (  Object o : root.getChildren("lib")) {
    Element libElement=(Element)o;
    final String libName=libElement.getAttributeValue("name");
    final Library libraryByName=model.getModuleLibraryTable().getLibraryByName(libName);
    if (libraryByName != null) {
      final Library.ModifiableModel modifiableModel=libraryByName.getModifiableModel();
      for (      Object r : libElement.getChildren("srcroot")) {
        modifiableModel.addRoot(((Element)r).getAttributeValue("url"),OrderRootType.SOURCES);
      }
      modifiableModel.commit();
    }
  }
}
