{
  MouseAdapter adapter=new MouseAdapter(){
    private Point clickPoint;
    private long lastTimeClicked=-1;
    private int clickCount=0;
    @Override public void mousePressed(    MouseEvent e){
      if (Math.abs(lastTimeClicked - e.getWhen()) > TIME_EPS) {
        clickCount=0;
      }
      clickCount++;
      lastTimeClicked=e.getWhen();
      if (!e.isPopupTrigger()) {
        clickPoint=e.getPoint();
      }
    }
    @Override public void mouseReleased(    MouseEvent e){
      Point releasedAt=e.getPoint();
      Point clickedAt=clickPoint;
      clickPoint=null;
      if (clickedAt == null)       return;
      if (e.isPopupTrigger())       return;
      if (releasedAt.x < 0 || releasedAt.y < 0 || releasedAt.x >= c.getWidth() || releasedAt.y >= c.getWidth())       return;
      if (Math.abs(clickedAt.x - releasedAt.x) < EPS && Math.abs(clickedAt.y - releasedAt.y) < EPS) {
        onClick(e,clickCount);
      }
    }
  }
;
  c.addMouseListener(adapter);
  c.addMouseMotionListener(adapter);
}
