{
  if (file != null && file.isValid()) {
    boolean isFullReformat=isFileFullyCoveredByRange(file,formatRange);
    if (!ignoreDocOptions && !isFullReformat) {
      IndentOptions options=IndentOptions.retrieveFromAssociatedDocument(file);
      if (options != null) {
        FileIndentOptionsProvider provider=options.getFileIndentOptionsProvider();
        if (providerProcessor != null && provider != null) {
          providerProcessor.process(provider);
        }
        return options;
      }
    }
    boolean committedDocumentNeeded=false;
    for (    FileIndentOptionsProvider provider : Extensions.getExtensions(FileIndentOptionsProvider.EP_NAME)) {
      if (!isFullReformat || provider.useOnFullReformat()) {
        committedDocumentNeeded|=provider instanceof ProviderForCommittedDocument;
        IndentOptions indentOptions=provider.getIndentOptions(this,file);
        if (indentOptions != null) {
          if (providerProcessor != null) {
            providerProcessor.process(provider);
          }
          indentOptions.setFileIndentOptionsProvider(provider);
          logIndentOptions(file,provider,indentOptions);
          return indentOptions;
        }
      }
    }
    IndentOptions options=getIndentOptions(file.getFileType());
    if (committedDocumentNeeded) {
      markOptionsInaccurateIfDocumentUncommitted(options,file);
    }
    return options;
  }
 else {
    return OTHER_INDENT_OPTIONS;
  }
}
