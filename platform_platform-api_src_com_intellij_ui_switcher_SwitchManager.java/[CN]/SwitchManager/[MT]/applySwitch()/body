{
  final ActionCallback result=new ActionCallback();
  if (isSessionActive()) {
    mySession.finish().doWhenDone(new AsyncResult.Handler<SwitchTarget>(){
      public void run(      final SwitchTarget switchTarget){
        mySession=null;
        IdeFocusManager.getGlobalInstance().doWhenFocusSettlesDown(new Runnable(){
          public void run(){
            tryToInitSessionFromFocus(switchTarget).doWhenProcessed(new Runnable(){
              public void run(){
                result.setDone();
              }
            }
);
          }
        }
);
      }
    }
);
  }
 else {
    result.setDone();
  }
  return result;
}
