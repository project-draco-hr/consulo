{
  if (element instanceof PsiDirectory) {
    final PsiPackage psiPackage=JavaDirectoryService.getInstance().getPackage((PsiDirectory)element);
    return psiPackage == null ? null : new JavaFindUsagesHandler(psiPackage,myFindClassOptions,myFindMethodOptions,myFindPackageOptions,myFindThrowOptions,myFindVariableOptions);
  }
  if (element instanceof PsiMethod && !forHighlightUsages) {
    final PsiMethod[] methods=SuperMethodWarningUtil.checkSuperMethods((PsiMethod)element,JavaFindUsagesHandler.ACTION_STRING);
    if (methods.length > 1) {
      return new JavaFindUsagesHandler(element,methods,myFindClassOptions,myFindMethodOptions,myFindPackageOptions,myFindThrowOptions,myFindVariableOptions);
    }
    if (methods.length == 1) {
      return new JavaFindUsagesHandler(methods[0],myFindClassOptions,myFindMethodOptions,myFindPackageOptions,myFindThrowOptions,myFindVariableOptions);
    }
    return null;
  }
  return new JavaFindUsagesHandler(element,myFindClassOptions,myFindMethodOptions,myFindPackageOptions,myFindThrowOptions,myFindVariableOptions);
}
