{
  toolWindow.setIcon(AndroidUtils.ANDROID_TOOLWINDOW_ICON);
  toolWindow.setAvailable(true,null);
  toolWindow.setToHideOnEmptyContent(true);
  toolWindow.setTitle(TOOL_WINDOW_ID);
  final AndroidLogcatToolWindowView view=new AndroidLogcatToolWindowView(project){
    @Override protected boolean isActive(){
      return toolWindow.isVisible();
    }
  }
;
  final ToolWindowManagerEx toolWindowManager=ToolWindowManagerEx.getInstanceEx(project);
  toolWindowManager.addToolWindowManagerListener(new ToolWindowManagerAdapter(){
    boolean myToolWindowVisible;
    @Override public void stateChanged(){
      ToolWindow window=toolWindowManager.getToolWindow(TOOL_WINDOW_ID);
      if (window != null) {
        boolean visible=window.isVisible();
        if (visible != myToolWindowVisible) {
          myToolWindowVisible=visible;
          view.activate();
          if (visible) {
            checkFacetAndSdk(project,view);
          }
        }
      }
    }
  }
);
  final MessageBusConnection connection=project.getMessageBus().connect(project);
  connection.subscribe(ProjectTopics.PROJECT_ROOTS,new MyAndroidPlatformListener(view));
  JPanel contentPanel=view.getContentPanel();
  final ContentManager contentManager=toolWindow.getContentManager();
  final Content logcatContent=contentManager.getFactory().createContent(contentPanel,AndroidBundle.message("android.logcat.tab.title"),false);
  logcatContent.putUserData(AndroidLogcatToolWindowView.ANDROID_LOGCAT_VIEW_KEY,view);
  logcatContent.setDisposer(view);
  logcatContent.setCloseable(false);
  logcatContent.setPreferredFocusableComponent(contentPanel);
  contentManager.addContent(logcatContent);
  contentManager.setSelectedContent(logcatContent,true);
  final ConsoleView console=new ConsoleViewImpl(project,false);
  final Content adbLogsContent=new ContentImpl(console.getComponent(),AndroidBundle.message("android.adb.logs.tab.title"),false);
  adbLogsContent.setCloseable(false);
  contentManager.addContent(adbLogsContent);
  com.android.ddmlib.Log.setLogOutput(new Log.ILogOutput(){
    @Override public void printLog(    Log.LogLevel logLevel,    String tag,    String message){
      reportAdbLogMessage(logLevel,tag,message,console);
    }
    @Override public void printAndPromptLog(    Log.LogLevel logLevel,    String tag,    String message){
      reportAdbLogMessage(logLevel,tag,message,console);
    }
  }
);
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      view.activate();
      final ToolWindow window=toolWindowManager.getToolWindow(TOOL_WINDOW_ID);
      if (window != null && window.isVisible()) {
        checkFacetAndSdk(project,view);
      }
    }
  }
);
}
