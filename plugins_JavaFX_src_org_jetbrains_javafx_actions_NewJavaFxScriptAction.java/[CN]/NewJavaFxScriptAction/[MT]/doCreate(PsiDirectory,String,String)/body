{
  final FileTemplate template=FileTemplateManager.getInstance().getInternalTemplate(templateName);
  final Properties properties=new Properties(FileTemplateManager.getInstance().getDefaultProperties());
  JavaTemplateUtil.setPackageNameAttribute(properties,directory);
  properties.setProperty(NAME_TEMPLATE_PROPERTY,className);
  final String text;
  try {
    text=template.getText(properties);
  }
 catch (  Exception e) {
    throw new RuntimeException("Unable to load template for " + FileTemplateManager.getInstance().internalTemplateToSubject(templateName),e);
  }
  final PsiFileFactory factory=PsiFileFactory.getInstance(directory.getProject());
  final PsiFile file=factory.createFileFromText(getFileName(className),text);
  return (JavaFxFile)directory.add(file);
}
