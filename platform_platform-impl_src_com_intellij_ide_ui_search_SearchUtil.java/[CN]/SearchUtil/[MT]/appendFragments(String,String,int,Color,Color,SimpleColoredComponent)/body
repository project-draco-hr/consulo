{
  if (text == null)   return;
  if (filter == null || filter.length() == 0) {
    textRenderer.append(text,new SimpleTextAttributes(background,foreground,Color.RED,style));
  }
 else {
    final HashSet<String> quoted=new HashSet<String>();
    filter=processFilter(quoteStrictOccurrences(text,filter),quoted);
    final TreeMap<Integer,String> indx=new TreeMap<Integer,String>();
    for (    String stripped : quoted) {
      int beg=0;
      int idx;
      while ((idx=StringUtil.indexOfIgnoreCase(text,stripped,beg)) != -1) {
        indx.put(idx,text.substring(idx,idx + stripped.length()));
        beg=idx + stripped.length();
      }
    }
    final List<String> selectedWords=new ArrayList<String>();
    int pos=0;
    for (    Integer index : indx.keySet()) {
      final String stripped=indx.get(index);
      final int start=index.intValue();
      if (pos > start) {
        final String highlighted=selectedWords.get(selectedWords.size() - 1);
        if (highlighted.length() < stripped.length()) {
          selectedWords.remove(highlighted);
        }
 else {
          continue;
        }
      }
      appendSelectedWords(text,selectedWords,pos,start,filter);
      selectedWords.add(stripped);
      pos=start + stripped.length();
    }
    appendSelectedWords(text,selectedWords,pos,text.length(),filter);
    int idx=0;
    for (    String word : selectedWords) {
      text=text.substring(idx);
      final String before=text.substring(0,text.indexOf(word));
      if (before.length() > 0)       textRenderer.append(before,new SimpleTextAttributes(background,foreground,null,style));
      idx=text.indexOf(word) + word.length();
      textRenderer.append(text.substring(idx - word.length(),idx),new SimpleTextAttributes(background,foreground,null,style | SimpleTextAttributes.STYLE_SEARCH_MATCH));
    }
    final String after=text.substring(idx,text.length());
    if (after.length() > 0)     textRenderer.append(after,new SimpleTextAttributes(background,foreground,null,style));
  }
}
