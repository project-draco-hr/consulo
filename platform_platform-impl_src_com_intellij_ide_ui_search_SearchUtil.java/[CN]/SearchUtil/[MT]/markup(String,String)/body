{
  if (filter == null || filter.length() == 0) {
    return textToMarkup;
  }
  final Pattern insideHtmlTagPattern=Pattern.compile("[<[^<>]*>]*<[^<>]*");
  final SearchableOptionsRegistrar registrar=SearchableOptionsRegistrar.getInstance();
  final HashSet<String> quoted=new HashSet<String>();
  filter=processFilter(quoteStrictOccurences(textToMarkup,filter),quoted);
  final Set<String> options=registrar.getProcessedWords(filter);
  final Set<String> words=registrar.getProcessedWords(textToMarkup);
  for (  String option : options) {
    if (words.contains(option)) {
      textToMarkup=markup(textToMarkup,insideHtmlTagPattern,option);
    }
  }
  for (  String stripped : quoted) {
    textToMarkup=markup(textToMarkup,insideHtmlTagPattern,stripped);
  }
  return textToMarkup;
}
