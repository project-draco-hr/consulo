{
  if (exprText == null)   return null;
  if (psiVariable == null || !psiVariable.isValid())   return null;
  final PsiElement refVariableElement=containingFile.findElementAt(marker.getStartOffset());
  PsiExpression expression=PsiTreeUtil.getParentOfType(refVariableElement,PsiReferenceExpression.class);
  if (expression instanceof PsiReferenceExpression) {
    final String referenceName=((PsiReferenceExpression)expression).getReferenceName();
    if (((PsiReferenceExpression)expression).resolve() == psiVariable || Comparing.strEqual(psiVariable.getName(),referenceName) || Comparing.strEqual(exprText,referenceName)) {
      return (PsiExpression)expression.replace(elementFactory.createExpressionFromText(exprText,psiVariable));
    }
  }
  if (expression == null) {
    expression=PsiTreeUtil.getParentOfType(refVariableElement,PsiExpression.class);
  }
  while (expression instanceof PsiReferenceExpression) {
    final PsiElement parent=expression.getParent();
    if (parent instanceof PsiMethodCallExpression) {
      if (parent.getText().equals(exprText))       return (PsiExpression)parent;
    }
    if (parent instanceof PsiExpression) {
      expression=(PsiExpression)parent;
    }
 else {
      return null;
    }
  }
  return expression != null && expression.isValid() && expression.getText().equals(exprText) ? expression : null;
}
