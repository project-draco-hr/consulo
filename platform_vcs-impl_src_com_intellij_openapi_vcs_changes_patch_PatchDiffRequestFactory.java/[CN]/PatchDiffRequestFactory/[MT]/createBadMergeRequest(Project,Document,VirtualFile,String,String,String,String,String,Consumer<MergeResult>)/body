{
  if (!DiffUtil.canMakeWritable(document)) {
    throw new InvalidDiffRequestException("Output is read only" + (file != null ? " : '" + file.getPresentableUrl() + "'" : ""));
  }
  if (windowTitle == null)   windowTitle=getBadPatchTitle(file);
  if (localTitle == null)   localTitle=VcsBundle.message("patch.apply.conflict.local.version");
  if (patchedTitle == null)   patchedTitle="Patched (with problems)";
  return new ApplyPatchMergeRequest(project,document,localContent,patchedContent,windowTitle,localTitle,patchedTitle,callback);
}
