{
  final XmlTag rootTag=pluginXml.getDocument().getRootTag();
  if (rootTag != null && "idea-plugin".equals(rootTag.getName())) {
    XmlTag actions=rootTag.findFirstSubTag("actions");
    if (actions == null) {
      actions=(XmlTag)rootTag.add(rootTag.createChildTag("actions",rootTag.getNamespace(),null,false));
    }
    XmlTag actionTag=(XmlTag)actions.add(actions.createChildTag("action",actions.getNamespace(),null,false));
    actionTag.setAttribute("id",myDialog.getActionId());
    actionTag.setAttribute("class",klass.getQualifiedName());
    actionTag.setAttribute("text",myDialog.getActionText());
    String description=myDialog.getActionDescription();
    if (description != null && description.length() > 0) {
      actionTag.setAttribute("description",description);
    }
    String groupId=myDialog.getSelectedGroupId();
    if (groupId != null) {
      XmlTag groupTag=(XmlTag)actionTag.add(actionTag.createChildTag("add-to-group",actions.getNamespace(),null,false));
      groupTag.setAttribute("group-id",groupId);
      final String anchor=myDialog.getSelectedAnchor();
      groupTag.setAttribute("anchor",anchor);
      if (anchor.equals("first") || anchor.equals("last")) {
        groupTag.setAttribute("relative-to-action",myDialog.getSelectedActionId());
      }
    }
    String firstKeyStroke=myDialog.getFirstKeyStroke();
    if (firstKeyStroke != null && firstKeyStroke.length() > 0) {
      XmlTag keyTag=(XmlTag)actionTag.add(actionTag.createChildTag("keyboard-shortcut",actions.getNamespace(),null,false));
      keyTag.setAttribute("keymap",KeymapManager.DEFAULT_IDEA_KEYMAP);
      keyTag.setAttribute("first-keystroke",firstKeyStroke);
      if (myDialog.getSecondKeyStroke().length() > 0) {
        keyTag.setAttribute("second-keystroke",myDialog.getSecondKeyStroke());
      }
    }
  }
}
