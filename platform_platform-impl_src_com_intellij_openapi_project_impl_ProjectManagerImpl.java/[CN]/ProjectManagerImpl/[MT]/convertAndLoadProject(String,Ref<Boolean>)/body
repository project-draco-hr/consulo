{
  final Ref<ConversionResult> conversionResult=new Ref<ConversionResult>();
  final String fp=canonicalize(filePath);
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      conversionResult.set(ConversionService.getInstance().convert(fp));
    }
  }
);
  if (conversionResult.get().openingIsCanceled()) {
    cancelled.set(true);
    return null;
  }
  final Project project=loadProjectWithProgress(filePath,new Ref<Boolean>());
  if (project == null)   return null;
  if (!conversionResult.get().conversionNotNeeded()) {
    StartupManager.getInstance(project).registerPostStartupActivity(new Runnable(){
      public void run(){
        conversionResult.get().postStartupActivity(project);
      }
    }
);
  }
  return project;
}
