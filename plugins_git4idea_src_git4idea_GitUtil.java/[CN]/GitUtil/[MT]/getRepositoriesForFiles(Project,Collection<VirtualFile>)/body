{
  final GitRepositoryManager manager=getRepositoryManager(project);
  com.google.common.base.Function<VirtualFile,GitRepository> ROOT_TO_REPO=new com.google.common.base.Function<VirtualFile,GitRepository>(){
    @Override public GitRepository apply(    @Nullable VirtualFile root){
      return root != null ? manager.getRepositoryForRoot(root) : null;
    }
  }
;
  return Collections2.filter(Collections2.transform(sortFilesByGitRootsIgnoringOthers(files).keySet(),ROOT_TO_REPO),Predicates.notNull());
}
