{
  VirtualFile child=rootDir.findChild(DOT_GIT);
  if (child == null) {
    return null;
  }
  if (child.isDirectory()) {
    return child;
  }
  String content=readFile(child);
  String pathToDir;
  String prefix="gitdir:";
  if (content.startsWith(prefix)) {
    pathToDir=content.substring(prefix.length()).trim();
  }
 else {
    pathToDir=content;
  }
  if (!FileUtil.isAbsolute(pathToDir)) {
    String canonicalPath=FileUtil.toCanonicalPath(FileUtil.join(rootDir.getPath(),pathToDir));
    if (canonicalPath == null) {
      return null;
    }
    pathToDir=FileUtil.toSystemIndependentName(canonicalPath);
  }
  return VcsUtil.getVirtualFile(pathToDir);
}
