{
  return ApplicationManager.getApplication().runReadAction(new Computable<Collection<? extends PsiElement>>(){
    @Override public Collection<? extends PsiElement> compute(){
      if (useScope instanceof GlobalSearchScope) {
        return JavaAnnotationIndex.getInstance().get(annClass.getName(),annClass.getProject(),(GlobalSearchScope)useScope);
      }
      final List<PsiElement> result=new ArrayList<PsiElement>();
      for (      PsiElement element : ((LocalSearchScope)useScope).getScope()) {
        element.accept(new PsiRecursiveElementWalkingVisitor(){
          @Override public void visitElement(          PsiElement element){
            if (element instanceof PsiAnnotation) {
              result.add(element);
            }
          }
        }
);
      }
      return result;
    }
  }
);
}
