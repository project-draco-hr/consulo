{
  return ApplicationManager.getApplication().runReadAction(new Computable<Collection<PsiAnnotation>>(){
    @Override public Collection<PsiAnnotation> compute(){
      if (useScope instanceof GlobalSearchScope) {
        return JavaAnnotationIndex.getInstance().get(annClass.getName(),annClass.getProject(),(GlobalSearchScope)useScope);
      }
      final List<PsiAnnotation> result=ContainerUtil.newArrayList();
      for (      PsiElement element : ((LocalSearchScope)useScope).getScope()) {
        result.addAll(PsiTreeUtil.findChildrenOfType(element,PsiAnnotation.class));
      }
      return result;
    }
  }
);
}
