{
  final SpacingImpl spaceProperty=myCurrentBlock.getSpaceProperty();
  final WhiteSpace whiteSpace=myCurrentBlock.getWhiteSpace();
  whiteSpace.arrangeLineFeeds(spaceProperty,this);
  if (!whiteSpace.containsLineFeeds()) {
    whiteSpace.arrangeSpaces(spaceProperty);
  }
  try {
    if (processWrap(spaceProperty)) {
      return;
    }
  }
  finally {
    if (whiteSpace.containsLineFeeds()) {
      onCurrentLineChanged();
    }
  }
  if (whiteSpace.containsLineFeeds()) {
    adjustLineIndent();
  }
 else {
    whiteSpace.arrangeSpaces(spaceProperty);
  }
  setAlignOffset(myCurrentBlock);
  if (myCurrentBlock.containsLineFeeds()) {
    onCurrentLineChanged();
  }
  if (shouldSaveDependancy(spaceProperty,whiteSpace)) {
    saveDependancy(spaceProperty);
  }
  if (!whiteSpace.isIsReadOnly() && shouldReformatBecauseOfBackwardDependance(whiteSpace.getTextRange())) {
    myAlignAgain.add(whiteSpace);
  }
 else   if (!myAlignAgain.isEmpty()) {
    myAlignAgain.remove(whiteSpace);
  }
  myCurrentBlock=myCurrentBlock.getNextBlock();
}
