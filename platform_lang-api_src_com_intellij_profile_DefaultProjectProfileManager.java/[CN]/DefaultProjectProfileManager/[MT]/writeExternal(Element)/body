{
  final List<String> sortedProfiles=new ArrayList<String>(myProfiles.keySet());
  Element profiles=null;
  Collections.sort(sortedProfiles);
  for (  String profile : sortedProfiles) {
    final Profile projectProfile=myProfiles.get(profile);
    if (projectProfile != null) {
      final Element profileElement=new Element(PROFILE);
      projectProfile.writeExternal(profileElement);
      boolean hasSmthToSave=sortedProfiles.size() > 1 || !Comparing.strEqual(PROJECT_PROFILE,PROJECT_DEFAULT_PROFILE_NAME);
      if (!hasSmthToSave) {
        for (        Object child : profileElement.getChildren()) {
          if (!((Element)child).getName().equals("option")) {
            hasSmthToSave=true;
            break;
          }
        }
      }
      if (!hasSmthToSave)       continue;
      if (profiles == null) {
        profiles=new Element(PROFILES);
        element.addContent(profiles);
      }
      profiles.addContent(profileElement);
    }
  }
  if (profiles != null || !Comparing.strEqual(PROJECT_PROFILE,PROJECT_DEFAULT_PROFILE_NAME)) {
    DefaultJDOMExternalizer.writeExternal(this,element);
    final Element version=new Element("version");
    version.setAttribute("value",VERSION);
    element.addContent(version);
  }
}
