{
  ApplicationManager.getApplication().assertIsDispatchThread();
  while (true) {
    final MyInitializeDdmlibTask task=new MyInitializeDdmlibTask(project);
    AdbErrors.clear();
    Thread t=new Thread(new Runnable(){
      @Override public void run(){
        doInitializeDdmlib();
        task.finish();
      }
    }
);
    t.start();
    boolean retryWas=false;
    while (!task.isFinished()) {
      ProgressManager.getInstance().run(task);
      boolean finished=task.isFinished();
      if (task.isCanceled()) {
        myAdbCrashed=!finished;
        forceInterrupt(t);
        return false;
      }
      myAdbCrashed=false;
      if (!finished) {
        final String adbErrorString=combine(AdbErrors.getErrors());
        final int result=Messages.showDialog(project,"ADB not responding. You can wait more, or kill \"" + SdkConstants.FN_ADB + "\" process manually and click 'Restart'"+ (adbErrorString.length() > 0 ? "\nErrors from ADB:\n" + adbErrorString : ""),CommonBundle.getErrorTitle(),new String[]{"&Wait more","&Restart","&Cancel"},0,Messages.getErrorIcon());
        if (result == 2) {
          myAdbCrashed=true;
          forceInterrupt(t);
          return false;
        }
 else         if (result == 1) {
          myAdbCrashed=true;
          retryWas=true;
        }
      }
    }
    if (!retryWas) {
      break;
    }
  }
  return true;
}
