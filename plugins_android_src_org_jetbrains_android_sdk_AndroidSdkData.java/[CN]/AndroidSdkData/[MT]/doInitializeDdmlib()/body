{
synchronized (myDdmsLock) {
    String adbPath=getAdbPath();
    if (!myDdmLibInitialized) {
      myDdmLibInitialized=true;
      DdmPreferences.setTimeOut(AndroidUtils.TIMEOUT);
      AndroidDebugBridge.init(AndroidEnableDdmsAction.isDdmsEnabled());
      LOG.info("DDMLib initialized");
      final AndroidDebugBridge bridge=AndroidDebugBridge.createBridge(adbPath,true);
      waitUntilConnect(bridge);
      if (!bridge.isConnected()) {
        LOG.info("Failed to connect debug bridge");
      }
    }
 else {
      final AndroidDebugBridge bridge=AndroidDebugBridge.getBridge();
      final boolean forceRestart=myAdbCrashed || (bridge != null && !bridge.isConnected());
      if (forceRestart) {
        LOG.info("Restart debug bridge: " + (myAdbCrashed ? "crashed" : "disconnected"));
      }
      final AndroidDebugBridge newBridge=AndroidDebugBridge.createBridge(adbPath,forceRestart);
      waitUntilConnect(newBridge);
      if (!newBridge.isConnected()) {
        LOG.info("Failed to connect debug bridge after restart");
      }
    }
  }
}
