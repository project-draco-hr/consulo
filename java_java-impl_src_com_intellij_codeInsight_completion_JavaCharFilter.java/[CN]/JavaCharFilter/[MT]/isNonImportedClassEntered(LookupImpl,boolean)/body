{
  if (lookup.isSelectionTouched() || !lookup.isCompletion())   return false;
  CompletionProcess process=CompletionService.getCompletionService().getCurrentCompletion();
  if (process == null || !process.isAutopopupCompletion())   return false;
  LookupElement item=lookup.getCurrentItem();
  if (item == null)   return false;
  PsiFile file=lookup.getPsiFile();
  if (file == null)   return false;
  final String prefix=lookup.itemPattern(item);
  for (  String s : item.getAllLookupStrings()) {
    if (s.equalsIgnoreCase(prefix)) {
      return false;
    }
  }
  for (  PsiClass aClass : PsiShortNamesCache.getInstance(file.getProject()).getClassesByName(prefix,file.getResolveScope())) {
    if (!isObfuscated(aClass) && PsiUtil.isAccessible(aClass,file,null)) {
      return true;
    }
  }
  if (orPackage && prefix.length() > 1 && JavaPsiFacade.getInstance(file.getProject()).findPackage(prefix) != null) {
    return true;
  }
  return false;
}
