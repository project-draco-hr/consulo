{
  if (!lookup.isCompletion())   return null;
  LookupElement item=lookup.getCurrentItem();
  if (item == null)   return null;
  if (c == '!') {
    if (lookup.getPsiFile() instanceof PsiJavaFile) {
      final Object o=item.getObject();
      if (o instanceof PsiVariable) {
        if (PsiType.BOOLEAN.isAssignableFrom(((PsiVariable)o).getType()))         return Result.SELECT_ITEM_AND_FINISH_LOOKUP;
      }
      if (o instanceof PsiMethod) {
        final PsiType type=((PsiMethod)o).getReturnType();
        if (type != null && PsiType.BOOLEAN.isAssignableFrom(type))         return Result.SELECT_ITEM_AND_FINISH_LOOKUP;
      }
      return null;
    }
  }
  if (c == '.' && isWithinLiteral(lookup))   return Result.ADD_TO_PREFIX;
  if (c == '[')   return CharFilter.Result.SELECT_ITEM_AND_FINISH_LOOKUP;
  if (c == '<' && item.getObject() instanceof PsiClass)   return Result.SELECT_ITEM_AND_FINISH_LOOKUP;
  if (c == '#' && PsiTreeUtil.getParentOfType(lookup.getPsiElement(),PsiDocComment.class) != null) {
    if (item.getObject() instanceof PsiClass) {
      return Result.SELECT_ITEM_AND_FINISH_LOOKUP;
    }
  }
  return null;
}
