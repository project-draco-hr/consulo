{
  UsefulTestCase.doPostponedFormatting(ourProject);
  LookupManager.getInstance(ourProject).hideActiveLookup();
  InspectionProfileManager.getInstance().deleteProfile(PROFILE);
  assertNotNull("Application components damaged",ProjectManager.getInstance());
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      try {
        final VirtualFile[] children=ourSourceRoot.getChildren();
        for (        VirtualFile child : children) {
          child.delete(this);
        }
      }
 catch (      IOException e) {
        e.printStackTrace();
      }
      FileDocumentManager manager=FileDocumentManager.getInstance();
      if (manager instanceof FileDocumentManagerImpl) {
        ((FileDocumentManagerImpl)manager).dropAllUnsavedDocuments();
      }
    }
  }
);
  assertFalse(PsiManager.getInstance(getProject()).isDisposed());
  if (!ourAssertionsInTestDetected) {
    if (IdeaLogger.ourErrorsOccurred != null) {
      throw IdeaLogger.ourErrorsOccurred;
    }
  }
  ((PsiDocumentManagerImpl)PsiDocumentManager.getInstance(getProject())).clearUncommitedDocuments();
  ((UndoManagerImpl)UndoManager.getGlobalInstance()).dropHistoryInTests();
  ProjectManagerEx.getInstanceEx().setCurrentTestProject(null);
  ourApplication.setDataProvider(null);
  ourTestCase=null;
  ((PsiManagerImpl)ourPsiManager).cleanupForNextTest();
  final Editor[] allEditors=EditorFactory.getInstance().getAllEditors();
  if (allEditors.length > 0) {
    for (    Editor allEditor : allEditors) {
      EditorFactory.getInstance().releaseEditor(allEditor);
    }
    fail("Unreleased editors: " + allEditors.length);
  }
}
