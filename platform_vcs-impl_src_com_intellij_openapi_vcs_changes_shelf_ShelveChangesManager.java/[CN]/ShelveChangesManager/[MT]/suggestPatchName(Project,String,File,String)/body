{
  @NonNls String defaultPath=PathUtil.suggestFileName(commitMessage);
  if (defaultPath.isEmpty()) {
    defaultPath="unnamed";
  }
  if (defaultPath.length() > PatchNameChecker.MAX - 10) {
    defaultPath=defaultPath.substring(0,PatchNameChecker.MAX - 10);
  }
  while (true) {
    final File nonexistentFile=FileUtil.findSequentNonexistentFile(file,defaultPath,extension == null ? VcsConfiguration.getInstance(project).getPatchFileExtension() : extension);
    if (nonexistentFile.getName().length() >= PatchNameChecker.MAX) {
      defaultPath=defaultPath.substring(0,defaultPath.length() - 1);
      continue;
    }
    return nonexistentFile;
  }
}
