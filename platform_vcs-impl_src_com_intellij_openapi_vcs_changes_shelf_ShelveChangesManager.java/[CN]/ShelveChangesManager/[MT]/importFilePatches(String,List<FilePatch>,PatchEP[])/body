{
  try {
    final File patchPath=getPatchPath(fileName);
    myFileProcessor.savePathFile(new CompoundShelfFileProcessor.ContentProvider(){
      public void writeContentTo(      final Writer writer) throws IOException {
        UnifiedDiffWriter.write(myProject,patches,writer,"\n",patchTransitExtensions);
      }
    }
,patchPath);
    final ShelvedChangeList changeList=new ShelvedChangeList(patchPath.toString(),fileName.replace('\n',' '),new SmartList<ShelvedBinaryFile>());
    myShelvedChangeLists.add(changeList);
    return changeList;
  }
  finally {
    notifyStateChanged();
  }
}
