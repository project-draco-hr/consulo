{
  ProjectLevelVcsManager vcsManager=ProjectLevelVcsManager.getInstance(myProject);
  if (vcsManager.dvcsUsedInProject() && VcsConfiguration.getInstance(myProject).INCLUDE_TEXT_INTO_SHELF) {
    final Set<Change> big=SelectFilesToAddTextsToPatchPanel.getBig(textChanges);
    final ArrayList<FilePath> toKeep=new ArrayList<FilePath>();
    for (    Change change : textChanges) {
      if (change.getBeforeRevision() == null || change.getAfterRevision() == null)       continue;
      if (big.contains(change))       continue;
      FilePath filePath=ChangesUtil.getFilePath(change);
      final AbstractVcs vcs=vcsManager.getVcsFor(filePath);
      if (vcs != null && VcsType.distibuted.equals(vcs.getType())) {
        toKeep.add(filePath);
      }
    }
    commitContext.putUserData(BaseRevisionTextPatchEP.ourPutBaseRevisionTextKey,true);
    commitContext.putUserData(BaseRevisionTextPatchEP.ourBaseRevisionPaths,toKeep);
  }
}
