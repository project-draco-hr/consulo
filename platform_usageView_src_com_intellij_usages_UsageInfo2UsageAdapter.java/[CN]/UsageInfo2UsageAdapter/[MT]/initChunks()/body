{
  PsiFile psiFile=getPsiFile();
  Document document=psiFile == null ? null : PsiDocumentManager.getInstance(getProject()).getDocument(psiFile);
  TextChunk[] chunks;
  if (document == null) {
    PsiElement element=getElement();
    if (element == null) {
      chunks=new TextChunk[]{new TextChunk(SimpleTextAttributes.ERROR_ATTRIBUTES.toTextAttributes(),UsageViewBundle.message("node.invalid"))};
    }
 else {
      chunks=new TextChunk[]{new TextChunk(new TextAttributes(),element.getText())};
    }
  }
 else {
    chunks=ChunkExtractor.extractChunks(psiFile,this);
  }
  myTextChunks=new SoftReference<TextChunk[]>(chunks);
  return chunks;
}
