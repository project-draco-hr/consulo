{
  myUsageInfo=usageInfo;
  myUsagePresentation=ApplicationManager.getApplication().runReadAction(new Computable<UsagePresentation>(){
    public UsagePresentation compute(){
      PsiElement element=getElement();
      PsiFile psiFile=element.getContainingFile();
      Document document=PsiDocumentManager.getInstance(element.getProject()).getDocument(psiFile);
      TextRange range=element.getTextRange();
      int startOffset=range.getStartOffset() + myUsageInfo.startOffset;
      int endOffset=range.getStartOffset() + myUsageInfo.endOffset;
      if (document != null) {
        myLineNumber=getLineNumber(document,startOffset);
        if (endOffset > document.getTextLength()) {
          LOG.error("Invalid usage info, psiElement:" + element + " end offset: "+ endOffset+ " psiFile: "+ psiFile.getName());
        }
        myRangeMarkers.add(document.createRangeMarker(startOffset,endOffset));
        initChunks();
      }
 else {
        myTextChunks=new TextChunk[]{new TextChunk(new TextAttributes(),element.getText())};
        myOffset=element.getTextOffset();
      }
      if (element instanceof PsiFile) {
        myIcon=null;
      }
 else {
        myIcon=element.getIcon(0);
      }
      myTooltipText=myUsageInfo.getTooltipText();
      return new MyUsagePresentation();
    }
  }
);
}
