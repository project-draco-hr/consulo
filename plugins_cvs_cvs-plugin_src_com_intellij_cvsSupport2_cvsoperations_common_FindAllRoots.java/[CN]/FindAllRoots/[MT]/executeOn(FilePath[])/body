{
  final Collection<FilePath> rootsWithoutIntersections=getRootsWithoutIntersections(roots);
  setText(CvsBundle.message("progress.text.searching.for.cvs.root"));
  myManager.lockSynchronizationActions();
  mySuitableFiles=calcVirtualFilesUnderCvsIn(rootsWithoutIntersections) * 2;
  myProcessedFiles=0;
  try {
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      public void run(){
        for (        final FilePath file : rootsWithoutIntersections) {
          VirtualFile virtualFile=file.getVirtualFile();
          if (virtualFile != null) {
            myResult.add(virtualFile);
            process(virtualFile);
          }
 else {
            VirtualFile virtualFileParent=file.getVirtualFileParent();
            if (virtualFileParent != null) {
              myResult.add(virtualFileParent);
            }
          }
        }
      }
    }
);
  }
  finally {
    myManager.unlockSynchronizationActions();
  }
  return myResult;
}
