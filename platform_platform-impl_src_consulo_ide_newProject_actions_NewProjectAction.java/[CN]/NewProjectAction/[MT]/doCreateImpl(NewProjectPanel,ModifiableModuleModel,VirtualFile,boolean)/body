{
  String name=StringUtil.notNullize(projectPanel.getNameText(),baseDir.getName());
  Module newModule=modifiableModel.newModule(name,baseDir.getPath());
  ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(newModule);
  ModifiableRootModel modifiableModelForModule=moduleRootManager.getModifiableModel();
  ContentEntry contentEntry=modifiableModelForModule.addContentEntry(baseDir);
  if (!projectPanel.isModuleCreation()) {
    contentEntry.addFolder(contentEntry.getUrl() + "/" + Project.DIRECTORY_STORE_FOLDER,ExcludedContentFolderTypeProvider.getInstance());
  }
  NewModuleBuilderProcessor processor=projectPanel.getProcessor();
  if (processor != null) {
    processor.setupModule(projectPanel.getConfigurationPanel(),contentEntry,modifiableModelForModule);
  }
  modifiableModelForModule.commit();
  if (requireModelCommit) {
    modifiableModel.commit();
  }
  baseDir.refresh(true,true);
  return newModule;
}
