{
  final StringBuilder text=new StringBuilder(injectedNode.getTextLength());
  injectedNode.accept(new PsiRecursiveElementWalkingVisitor(){
    @Override public void visitElement(    PsiElement element){
      String unescaped=element.getCopyableUserData(UNESCAPED_TEXT);
      if (unescaped != null) {
        text.append(unescaped);
        return;
      }
      if (element.getFirstChild() == null) {
        text.append(element.getText());
        return;
      }
      super.visitElement(element);
    }
  }
);
  return text.toString();
}
