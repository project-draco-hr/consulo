{
  myShowClasses=showClasses;
  Pair<ElementNode,List<ElementNode>> selection=storeSelection();
  DefaultMutableTreeNode root=getRootNode();
  if (!myShowClasses || myContainerNodes.isEmpty()) {
    List<ParentNode> otherObjects=new ArrayList<ParentNode>();
    Enumeration<ParentNode> children=getRootNodeChildren();
    ParentNode newRoot=new ParentNode(null,new MemberChooserObjectBase(getAllContainersNodeName()),new Ref<Integer>(0));
    while (children.hasMoreElements()) {
      final ParentNode nextElement=children.nextElement();
      if (nextElement instanceof ContainerNode) {
        final ContainerNode containerNode=(ContainerNode)nextElement;
        Enumeration<MemberNode> memberNodes=containerNode.children();
        List<MemberNode> memberNodesList=new ArrayList<MemberNode>();
        while (memberNodes.hasMoreElements()) {
          memberNodesList.add(memberNodes.nextElement());
        }
        for (        MemberNode memberNode : memberNodesList) {
          newRoot.add(memberNode);
        }
      }
 else {
        otherObjects.add(nextElement);
      }
    }
    replaceChildren(root,otherObjects);
    sortNode(newRoot,mySorted);
    if (newRoot.children().hasMoreElements())     root.add(newRoot);
  }
 else {
    Enumeration<ParentNode> children=getRootNodeChildren();
    if (children.hasMoreElements()) {
      ParentNode allClassesNode=children.nextElement();
      Enumeration<MemberNode> memberNodes=allClassesNode.children();
      ArrayList<MemberNode> arrayList=new ArrayList<MemberNode>();
      while (memberNodes.hasMoreElements()) {
        arrayList.add(memberNodes.nextElement());
      }
      for (      MemberNode memberNode : arrayList) {
        myNodeToParentMap.get(memberNode).add(memberNode);
      }
    }
    replaceChildren(root,myContainerNodes);
  }
  myTreeModel.nodeStructureChanged(root);
  TreeUtil.expandAll(myTree);
  restoreSelection(selection);
}
