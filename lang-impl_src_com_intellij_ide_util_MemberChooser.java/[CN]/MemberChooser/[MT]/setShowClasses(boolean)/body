{
  myShowClasses=showClasses;
  Pair<ElementNode,List<ElementNode>> selection=storeSelection();
  DefaultMutableTreeNode root=getRootNode();
  if (!myShowClasses || myContainerNodes.size() == 0) {
    List<ParentNode> otherObjects=new ArrayList<ParentNode>();
    Enumeration<ParentNode<T>> children=getRootNodeChildren();
    ParentNode<T> newRoot=new ParentNode<T>(null,new MemberChooserObjectBase(getAllContainersNodeName()),new Ref<Integer>(0));
    while (children.hasMoreElements()) {
      final ParentNode nextElement=children.nextElement();
      if (nextElement instanceof ContainerNode) {
        final ContainerNode<T> containerNode=(ContainerNode<T>)nextElement;
        Enumeration<MemberNode<T>> memberNodes=containerNode.children();
        List<MemberNode<T>> memberNodesList=new ArrayList<MemberNode<T>>();
        while (memberNodes.hasMoreElements()) {
          memberNodesList.add(memberNodes.nextElement());
        }
        for (        MemberNode<T> memberNode : memberNodesList) {
          newRoot.add(memberNode);
        }
      }
 else {
        otherObjects.add(nextElement);
      }
    }
    replaceChildren(root,otherObjects);
    sortNode(newRoot,mySorted);
    if (newRoot.children().hasMoreElements())     root.add(newRoot);
  }
 else {
    Enumeration<ParentNode<T>> children=getRootNodeChildren();
    if (children.hasMoreElements()) {
      ParentNode<T> allClassesNode=children.nextElement();
      Enumeration<MemberNode<T>> memberNodes=allClassesNode.children();
      ArrayList<MemberNode> arrayList=new ArrayList<MemberNode>();
      while (memberNodes.hasMoreElements()) {
        arrayList.add(memberNodes.nextElement());
      }
      for (      MemberNode memberNode : arrayList) {
        myNodeToParentMap.get(memberNode).add(memberNode);
      }
    }
    replaceChildren(root,myContainerNodes);
  }
  myTreeModel.nodeStructureChanged(root);
  TreeUtil.expandAll(myTree);
  restoreSelection(selection);
}
