{
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    return;
  }
  DebuggerInvocationUtil.invokeLater(getProject(),new Runnable(){
    public void run(){
      if (PsiManager.getInstance(myProject).isDisposed()) {
        return;
      }
      if (!isValid()) {
        return;
      }
      DebuggerContextImpl context=DebuggerManagerEx.getInstanceEx(myProject).getContext();
      final DebugProcessImpl debugProcess=context.getDebugProcess();
      if (debugProcess == null || !context.getDebuggerSession().isAttached()) {
        updateCaches(null);
        updateGutter();
        afterUpdate.run();
      }
 else {
        final ModalityState modalityState=ModalityState.current();
        debugProcess.getManagerThread().invoke(new DebuggerCommandImpl(){
          protected void action() throws Exception {
            ApplicationManager.getApplication().runReadAction(new Runnable(){
              public void run(){
                updateCaches(debugProcess);
              }
            }
);
            DebuggerInvocationUtil.invokeLater(getProject(),new Runnable(){
              public void run(){
                updateGutter();
                afterUpdate.run();
              }
            }
,modalityState);
          }
        }
);
      }
    }
  }
,ModalityState.defaultModalityState());
}
