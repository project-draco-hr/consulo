{
  if (file == null) {
    throw new IllegalArgumentException("file cannot be null");
  }
  mySharedProviderList.clear();
  boolean doNotShowTextEditor=false;
  for (int i=myProviders.size() - 1; i >= 0; i--) {
    FileEditorProvider provider=myProviders.get(i);
    if (provider.accept(project,file)) {
      mySharedProviderList.add(provider);
      doNotShowTextEditor|=provider.getPolicy() == FileEditorPolicy.HIDE_DEFAULT_EDITOR;
    }
  }
  if (doNotShowTextEditor) {
    for (int i=mySharedProviderList.size() - 1; i >= 0; i--) {
      if (mySharedProviderList.get(i) instanceof TextEditorProvider) {
        mySharedProviderList.remove(i);
      }
    }
  }
  Collections.sort(myProviders,MyComparator.ourInstance);
  if (mySharedProviderList.size() > 0) {
    return mySharedProviderList.toArray(new FileEditorProvider[mySharedProviderList.size()]);
  }
 else {
    return EMPTY_ARRAY;
  }
}
