{
  if (myEditor == null || myEvaluationPanel == null) {
    return;
  }
  myEvaluationPanel.clear();
  TextWithImports codeToEvaluate=getCodeToEvaluate();
  if (codeToEvaluate == null) {
    return;
  }
  try {
    setOKActionEnabled(false);
    NodeDescriptorImpl descriptor=myEvaluationPanel.getWatchTree().addWatch(codeToEvaluate,"result").getDescriptor();
    if (descriptor instanceof EvaluationDescriptor) {
      final EvaluationDescriptor evalDescriptor=(EvaluationDescriptor)descriptor;
      evalDescriptor.setCodeFragmentFactory(myEditor.getCurrentFactory());
    }
    myEvaluationPanel.getWatchTree().rebuild(getDebuggerContext());
    descriptor.myIsExpanded=true;
  }
  finally {
    setOKActionEnabled(true);
  }
  getEditor().addRecent(getCodeToEvaluate());
  final DebuggerSession session=myEvaluationPanel.getContextManager().getContext().getDebuggerSession();
  if (session != null) {
    session.refresh(true);
  }
}
