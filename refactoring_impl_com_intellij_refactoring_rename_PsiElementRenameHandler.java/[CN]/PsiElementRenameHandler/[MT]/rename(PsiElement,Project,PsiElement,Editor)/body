{
  if (element instanceof PsiMethod) {
    PsiMethod psiMethod=(PsiMethod)element;
    if (psiMethod.isConstructor()) {
      PsiClass containingClass=psiMethod.getContainingClass();
      if (containingClass == null)       return;
      String classType=UsageViewUtil.getType(containingClass);
      String className=UsageViewUtil.getShortName(containingClass);
      int ret=Messages.showYesNoDialog(project,RefactoringBundle.message("constructor.cannot.be.renamed.would.you.like.to.rename.class",classType,className),RefactoringBundle.message("warning.title"),Messages.getQuestionIcon());
      if (ret != 0) {
        return;
      }
      element=containingClass;
      if (!canRename(element,project)) {
        return;
      }
    }
  }
  PsiElement elementToRename=element;
  if (elementToRename instanceof PsiMethod) {
    elementToRename=SuperMethodWarningUtil.checkSuperMethod((PsiMethod)elementToRename,RefactoringBundle.message("to.rename"));
    if (elementToRename == null)     return;
    if (!CommonRefactoringUtil.checkReadOnlyStatus(project,elementToRename))     return;
  }
  if (editor != null) {
    if (elementToRename instanceof PsiVariable && VariableInplaceRenamer.mayRenameInplace((PsiVariable)elementToRename,editor)) {
      new VariableInplaceRenamer((PsiVariable)elementToRename).performInplaceRename(editor);
      return;
    }
  }
  String helpID=HelpID.getRenameHelpID(elementToRename);
  final RenameDialog dialog=new RenameDialog(project,elementToRename,nameSuggestionContext,helpID);
  dialog.show();
}
