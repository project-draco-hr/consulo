{
  PsiElement[] elementArray=BaseRefactoringAction.getPsiElementArray(dataContext);
  if (elementArray == null) {
    final VirtualFile vFile=(VirtualFile)dataContext.getData(DataConstants.VIRTUAL_FILE);
    final Project project=(Project)dataContext.getData(DataConstants.PROJECT);
    if (vFile != null && project != null) {
      return PsiManager.getInstance(project).findFile(vFile);
    }
  }
  if (elementArray == null || elementArray.length != 1) {
    return null;
  }
  return elementArray[0];
}
