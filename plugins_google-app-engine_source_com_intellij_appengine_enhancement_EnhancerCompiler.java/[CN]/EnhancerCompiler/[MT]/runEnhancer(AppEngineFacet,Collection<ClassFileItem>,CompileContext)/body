{
  try {
    final AppEngineSdk sdk=facet.getSdk();
    if (!sdk.isValid()) {
      throw new CantRunException("Valid App Engine SDK isn't specified for '" + facet.getName() + "' facet (module '"+ facet.getModule()+ "')");
    }
    final JavaParameters javaParameters=new JavaParameters();
    new ReadAction(){
      protected void run(      final Result result) throws Throwable {
        context.getProgressIndicator().setText2("'" + facet.getModule().getName() + "' module, '"+ facet.getWebFacet().getName()+ "' facet, processing "+ items.size()+ " classes...");
        javaParameters.configureByModule(facet.getModule(),JavaParameters.JDK_AND_CLASSES);
        javaParameters.getClassPath().add(sdk.getToolsApiJarFile().getAbsolutePath());
        final ParametersList vmParameters=javaParameters.getVMParametersList();
        vmParameters.add("-Xmx256m");
        final ParametersList programParameters=javaParameters.getProgramParametersList();
        programParameters.add("-v");
        for (        ClassFileItem item : items) {
          programParameters.add(FileUtil.toSystemDependentName(item.getFile().getPath()));
        }
        javaParameters.setMainClass("com.google.appengine.tools.enhancer.Enhance");
      }
    }
.execute().throwException();
    final GeneralCommandLine commandLine=CommandLineBuilder.createFromJavaParameters(javaParameters);
    if (LOG.isDebugEnabled()) {
      LOG.debug("starting enchancer: " + commandLine.getCommandLineString());
    }
    final Process process=commandLine.createProcess();
    EnhancerProcessHandler handler=new EnhancerProcessHandler(process,commandLine.getCommandLineString(),context);
    handler.startNotify();
    handler.waitFor();
  }
 catch (  ProcessCanceledException e) {
    throw e;
  }
catch (  Throwable e) {
    context.addMessage(CompilerMessageCategory.ERROR,e.getMessage(),null,-1,-1);
    LOG.info(e);
  }
  return context.getMessageCount(CompilerMessageCategory.ERROR) == 0;
}
