{
  final Project project=PlatformDataKeys.PROJECT.getData(dataContext);
  if (project == null) {
    return;
  }
  final RunContentDescriptor reuseContent=ExecutionManager.getInstance(project).getContentManager().getReuseContent(executor,dataContext);
  final RunProfileState state=profile.getState(dataContext,executor,settings,configurationSettings);
  if (state == null) {
    return;
  }
  Runnable startRunnable=new Runnable(){
    public void run(){
      try {
        if (project.isDisposed())         return;
        final RunContentDescriptor descriptor=doExecute(executor,state,profile,project,reuseContent,settings,configurationSettings);
        if (callback != null)         callback.processStarted(descriptor);
        if (descriptor != null) {
          if (LocalHistoryConfiguration.getInstance().ADD_LABEL_ON_RUNNING) {
            LocalHistory.putSystemLabel(project,executor.getId() + " " + profile.getName());
          }
          ExecutionManager.getInstance(project).getContentManager().showRunContent(executor,descriptor);
          descriptor.getProcessHandler().startNotify();
        }
      }
 catch (      ExecutionException e) {
        ProgramRunnerUtil.handleExecutionError(project,profile,e);
      }
    }
  }
;
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    startRunnable.run();
  }
 else {
    ExecutionManager.getInstance(project).compileAndRun(startRunnable,profile,state);
  }
}
