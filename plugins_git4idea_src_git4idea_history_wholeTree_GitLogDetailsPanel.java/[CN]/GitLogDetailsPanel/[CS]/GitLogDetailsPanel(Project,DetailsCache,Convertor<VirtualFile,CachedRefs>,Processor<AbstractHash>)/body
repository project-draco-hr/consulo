{
  myRefsProvider=refsProvider;
  myMarkProcessor=markProcessor;
  myPanel=new JPanel(new CardLayout());
  myPanel.add(UIVcsUtil.errorPanel("Nothing selected",false),NOTHING_SELECTED);
  myPanel.add(UIVcsUtil.errorPanel("Loading...",false),LOADING);
  myPanel.add(UIVcsUtil.errorPanel("Several commits selected",false),MULTIPLE_SELECTED);
  myHtmlHighlighter=new HtmlHighlighter();
  myPresentationData=new MyPresentationData(myProject,detailsCache,myHtmlHighlighter);
  final JPanel wrapper=new JPanel(new GridBagLayout());
  final GridBagConstraints gb=new GridBagConstraints(0,0,1,1,0,0,GridBagConstraints.NORTHWEST,GridBagConstraints.HORIZONTAL,new Insets(1,1,1,1),0,0);
  myJEditorPane=new JEditorPane(UIUtil.HTML_MIME,"");
  myJEditorPane.setPreferredSize(new Dimension(150,100));
  myJEditorPane.setEditable(false);
  myJEditorPane.setBackground(UIUtil.getComboBoxDisabledBackground());
  myJEditorPane.addHyperlinkListener(new BrowserHyperlinkListener(){
    @Override public void hyperlinkUpdate(    HyperlinkEvent e){
      if (e.getEventType() == HyperlinkEvent.EventType.ACTIVATED && CONFIGURE_BRANCHES.equals(e.getDescription())) {
        if (myRoot == null)         return;
        final CachedRefs symbolicRefs=refsProvider.convert(myRoot);
        if (symbolicRefs == null)         return;
        final TreeSet<String> localBranches=symbolicRefs.getLocalBranches();
        if (localBranches == null || localBranches.isEmpty()) {
          VcsBalloonProblemNotifier.showOverChangesView(myProject,"Branches is not loaded yet",MessageType.WARNING);
          return;
        }
        final ContainedInBranchesConfigDialog dialog=new ContainedInBranchesConfigDialog(myProject,localBranches,symbolicRefs.getRemoteBranches(),symbolicRefs.getCurrentName(),symbolicRefs.getTrackedRemoteName());
        dialog.show();
        if (dialog.isChanged()) {
          myPresentationData.branchesPresentation();
          changeDetailsText();
        }
        return;
      }
      super.hyperlinkUpdate(e);
    }
  }
);
  myMarksPanel=new JPanel();
  final BoxLayout boxLayout=new BoxLayout(myMarksPanel,BoxLayout.X_AXIS);
  myMarksPanel.setLayout(boxLayout);
  gb.weightx=1;
  wrapper.add(myMarksPanel,gb);
  ++gb.gridy;
  gb.weighty=1;
  gb.fill=GridBagConstraints.BOTH;
  final JBScrollPane tableScroll=new JBScrollPane(myJEditorPane);
  tableScroll.setBorder(null);
  myJEditorPane.setBorder(null);
  wrapper.add(tableScroll,gb);
  myJEditorPane.setBackground(UIUtil.getTableBackground());
  myMarksPanel.setBackground(UIUtil.getTableBackground());
  wrapper.setBackground(UIUtil.getTableBackground());
  myPanel.add(wrapper,DATA);
  ((CardLayout)myPanel.getLayout()).show(myPanel,NOTHING_SELECTED);
}
