{
  PsiElement scope;
  if (variable instanceof PsiLocalVariable) {
    scope=variable.getParent().getParent();
  }
 else   if (variable instanceof PsiParameter) {
    scope=((PsiParameter)variable).getDeclarationScope();
  }
 else {
    scope=variable.getParent();
  }
  if (scope.getContainingFile() != context.getContainingFile())   return null;
  PsiElement parent=context.getParent();
  PsiElement prevParent=context;
  while (parent != null) {
    if (parent.equals(scope))     break;
    if (parent instanceof PsiClass && !(prevParent instanceof PsiExpressionList && parent instanceof PsiAnonymousClass)) {
      return (PsiClass)parent;
    }
    prevParent=parent;
    parent=parent.getParent();
  }
  return null;
}
