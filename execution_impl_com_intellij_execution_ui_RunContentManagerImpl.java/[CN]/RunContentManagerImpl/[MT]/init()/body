{
  final JavaProgramRunner[] registeredRunners=ExecutionRegistry.getInstance().getRegisteredRunners();
  for (  JavaProgramRunner registeredRunner : registeredRunners) {
    registerToolwindow(registeredRunner);
  }
  if (ToolWindowManager.getInstance(myProject) == null)   return;
  SwingUtilities.invokeLater(new Runnable(){
    public void run(){
      if (myProject.isDisposed())       return;
      ((ToolWindowManagerEx)ToolWindowManager.getInstance(myProject)).addToolWindowManagerListener(new ToolWindowManagerAdapter(){
        public void stateChanged(){
          if (myProject.isDisposed())           return;
          ToolWindowManager toolWindowManager=ToolWindowManager.getInstance(myProject);
          Set<String> currentWindows=new HashSet<String>();
          String[] toolWindowIds=toolWindowManager.getToolWindowIds();
          for (          String toolWindowId : toolWindowIds) {
            currentWindows.add(toolWindowId);
          }
          myToolwindowIdZbuffer.retainAll(currentWindows);
          final String activeToolWindowId=toolWindowManager.getActiveToolWindowId();
          if (activeToolWindowId != null) {
            if (myToolwindowIdZbuffer.remove(activeToolWindowId)) {
              myToolwindowIdZbuffer.addFirst(activeToolWindowId);
            }
          }
        }
      }
);
    }
  }
);
}
