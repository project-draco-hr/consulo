{
  if (ApplicationManager.getApplication().isUnitTestMode())   return;
  final RunnerInfo runnerInfo=requestor.getInfo();
  LOG.assertTrue(runnerInfo != null);
  final ContentManager contentManager=getContentManagerForRunner(runnerInfo);
  RunContentDescriptor oldDescriptor=chooseReuseContentForDescriptor(contentManager,descriptor);
  final Content content;
  if (oldDescriptor != null) {
    content=oldDescriptor.getAttachedContent();
    myEventDispatcher.getMulticaster().contentRemoved(oldDescriptor,runnerInfo.getToolWindowId());
    oldDescriptor.dispose();
  }
 else {
    content=createNewContent(contentManager,descriptor,runnerInfo.getToolWindowId());
    content.setIcon(requestor.getInfo().getToolWindowIcon());
  }
  content.setComponent(descriptor.getComponent());
  content.putUserData(DESCRIPTOR_KEY,descriptor);
  final ProcessHandler processHandler=descriptor.getProcessHandler();
  if (processHandler != null) {
    final ProcessAdapter processAdapter=new ProcessAdapter(){
      public void startNotified(      final ProcessEvent event){
        content.setIcon(runnerInfo.getIcon());
      }
      public void processTerminated(      final ProcessEvent event){
        content.setIcon(runnerInfo.getDisabledIcon());
      }
    }
;
    processHandler.addProcessListener(processAdapter);
    Disposer.register(content.getDisposer(),new Disposable(){
      public void dispose(){
        processHandler.removeProcessListener(processAdapter);
      }
    }
);
  }
  content.setDisplayName(descriptor.getDisplayName());
  descriptor.setAttachedContent(content);
  content.getManager().setSelectedContent(content);
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      final ToolWindow toolWindow=ToolWindowManager.getInstance(myProject).getToolWindow(runnerInfo.getToolWindowId());
      toolWindow.activate(null);
    }
  }
);
}
