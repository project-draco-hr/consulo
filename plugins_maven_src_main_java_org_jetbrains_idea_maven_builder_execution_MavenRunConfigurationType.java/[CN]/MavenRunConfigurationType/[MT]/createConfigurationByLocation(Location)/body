{
  String path="";
  List<String> goals=null;
  final PsiFile psiFile=location.getPsiElement().getContainingFile();
  if (psiFile != null) {
    final VirtualFile virtualFile=psiFile.getVirtualFile();
    if (virtualFile != null) {
      if (!MavenEnv.POM_FILE.equals(virtualFile.getName())) {
        return null;
      }
      path=virtualFile.getPath();
      final DataContext dataContext=DataManager.getInstance().getDataContext();
      if (dataContext != null) {
        goals=MavenDataKeys.MAVEN_GOALS_KEY.getData(dataContext);
      }
    }
  }
  if (goals == null) {
    return null;
  }
  final String name=ExecutionUtil.shortenName(goals.toString(),0);
  final RunnerAndConfigurationSettingsImpl settings=RunManagerEx.getInstanceEx(location.getProject()).createConfiguration(name,myFactory);
  final RunConfiguration configuration=settings.getConfiguration();
  if (configuration instanceof MavenRunConfiguration) {
    final MavenBuildParameters mavenBuildParameters=((MavenRunConfiguration)configuration).getBuildParameters();
    mavenBuildParameters.setPomPath(path);
    mavenBuildParameters.getGoals().clear();
    mavenBuildParameters.getGoals().addAll(goals);
  }
  return settings;
}
