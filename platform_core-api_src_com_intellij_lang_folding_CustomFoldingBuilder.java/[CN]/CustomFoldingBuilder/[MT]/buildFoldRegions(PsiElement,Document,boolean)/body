{
  List<FoldingDescriptor> descriptors=new ArrayList<FoldingDescriptor>();
  ourCustomRegionElements.set(new HashSet<ASTNode>());
  try {
    if (CustomFoldingProvider.getAllProviders().length > 0) {
      myDefaultProvider=null;
      ASTNode rootNode=root.getNode();
      if (rootNode != null) {
        addCustomFoldingRegionsRecursively(new FoldingStack(rootNode),rootNode,descriptors,0);
      }
    }
    buildLanguageFoldRegions(descriptors,root,document,quick);
  }
  finally {
    ourCustomRegionElements.set(null);
  }
  return descriptors.toArray(new FoldingDescriptor[descriptors.size()]);
}
