{
  String text=group.getTemplatePresentation().getText();
  ActionManager actionManager=ActionManager.getInstance();
  final ArrayList<AnAction> reordableChildren=new ArrayList<AnAction>();
  reordableChildren.addAll(Arrays.asList(group.getChildren(e)));
  final List<ActionUrl> actions=schema.getActions();
  for (Iterator<ActionUrl> iterator=actions.iterator(); iterator.hasNext(); ) {
    ActionUrl actionUrl=iterator.next();
    if ((actionUrl.getParentGroup().equals(text) || actionUrl.getParentGroup().equals(defaultGroupName) || actionUrl.getParentGroup().equals(actionManager.getId(group))) && reordableChildren.size() > actionUrl.getAbsolutePosition()) {
      AnAction componentAction=actionUrl.getComponentAction();
      if (componentAction != null) {
        if (actionUrl.getActionType() == ActionUrl.ADDED) {
          reordableChildren.add(actionUrl.getAbsolutePosition(),componentAction);
        }
 else         if (actionUrl.getActionType() == ActionUrl.DELETED) {
          final AnAction anAction=reordableChildren.get(actionUrl.getAbsolutePosition());
          if (anAction.getTemplatePresentation().getText() == null && anAction instanceof ActionGroup) {
            final Group eqGroup=ActionsTreeUtil.createGroup((ActionGroup)anAction,true);
            if (!actionUrl.getComponent().equals(eqGroup)) {
              continue;
            }
          }
          if (anAction.getTemplatePresentation().getText() == null ? componentAction.getTemplatePresentation().getText() != null : !anAction.getTemplatePresentation().getText().equals(componentAction.getTemplatePresentation().getText())) {
            continue;
          }
          reordableChildren.remove(actionUrl.getAbsolutePosition());
        }
      }
    }
  }
  for (int i=0; i < reordableChildren.size(); i++) {
    if (reordableChildren.get(i) instanceof ActionGroup) {
      final ActionGroup groupToCorrect=(ActionGroup)reordableChildren.get(i);
      final AnAction correctedAction=correctActionGroup(groupToCorrect,schema,"");
      reordableChildren.set(i,correctedAction);
    }
  }
  return reordableChildren.toArray(new AnAction[reordableChildren.size()]);
}
