{
  AndroidSdkData sdkData=platform != null ? platform.getSdkData() : null;
  List<IAndroidTarget> targets=Collections.emptyList();
  if (sdkData != null) {
    myLayoutDeviceManager.loadDevices(sdkData);
    myDevices=new ArrayList<LayoutDevice>(myLayoutDeviceManager.getCombinedList());
    if (myDevices.isEmpty()) {
      myDevices.add(NO_DEVICES);
    }
    myDevices.add(CUSTOM_DEVICE);
    targets=new ArrayList<IAndroidTarget>();
    for (    IAndroidTarget target : sdkData.getTargets()) {
      if (target.isPlatform()) {
        targets.add(target);
      }
    }
  }
 else {
    myDevices=Arrays.asList(NO_DEVICES);
  }
  LayoutDevice newDevice=null;
  String deviceName=myProfile.getDevice();
  if (deviceName != null) {
    for (    LayoutDevice device : myDevices) {
      if (deviceName.equals(device.getName())) {
        newDevice=device;
        break;
      }
    }
  }
  if (newDevice == null && !myDevices.isEmpty()) {
    for (    LayoutDevice device : myDevices) {
      if (device != CUSTOM_DEVICE) {
        newDevice=device;
        break;
      }
    }
  }
  myDeviceAction.setItems(myDevices,newDevice);
  updateDevice(newDevice,myProfile.getDeviceConfiguration());
  IAndroidTarget newTarget=null;
  String targetHashString=myProfile.getTargetHashString();
  if (targetHashString != null) {
    for (    IAndroidTarget target : targets) {
      if (targetHashString.equals(target.hashString())) {
        newTarget=target;
        break;
      }
    }
  }
  if (newTarget == null) {
    IAndroidTarget targetFromModule=platform != null ? platform.getTarget() : null;
    if (targetFromModule != null) {
      String modulePlatformHash=null;
      if (targetFromModule.isPlatform()) {
        modulePlatformHash=targetFromModule.hashString();
      }
 else {
        IAndroidTarget parent=targetFromModule.getParent();
        if (parent != null) {
          modulePlatformHash=parent.hashString();
        }
      }
      if (modulePlatformHash != null) {
        targetFromModule=sdkData.findTargetByHashString(modulePlatformHash);
        if (targetFromModule != null && targets.contains(targetFromModule)) {
          newTarget=targetFromModule;
        }
      }
    }
  }
  if (newTarget == null && !targets.isEmpty()) {
    newTarget=targets.get(0);
  }
  myTargetAction.setItems(targets,newTarget);
  updateTarget(newTarget);
}
