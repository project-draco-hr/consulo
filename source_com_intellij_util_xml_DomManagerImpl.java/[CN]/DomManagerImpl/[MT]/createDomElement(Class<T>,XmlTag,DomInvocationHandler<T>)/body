{
synchronized (PsiLock.LOCK) {
    try {
      Class clazz=getProxyClassFor(getConcreteType(aClass,tag));
      final T element=(T)clazz.getConstructor(new Class[]{InvocationHandler.class}).newInstance(new Object[]{handler});
      handler.setProxy(element);
      setCachedElement(tag,element);
      return element;
    }
 catch (    RuntimeException e) {
      throw e;
    }
catch (    Exception e) {
      throw new CodeGenerationException(e);
    }
  }
}
