{
  final ComboBoxButton comboBoxButton=new ComboBoxButton(presentation){
    public void addNotify(){
      super.addNotify();
      final IdeFrame frame=findFrame(this);
      LOG.assertTrue(frame != null);
      frame.getComponent().getRootPane().putClientProperty(BUTTON_KEY,this);
    }
    @Override public Dimension getPreferredSize(){
      final Dimension size=super.getPreferredSize();
      if (!UISettings.getInstance().SHOW_MAIN_TOOLBAR) {
        return new Dimension(size.width,21);
      }
      return size;
    }
  }
;
  final JPanel panel=new JPanel(new BorderLayout()){
    @Override protected void paintChildren(    Graphics g){
      super.paintChildren(g);
      if (!UISettings.getInstance().SHOW_MAIN_TOOLBAR) {
        g.setColor(UIUtil.getBorderColor());
        g.drawLine(0,getHeight() - 1,getWidth(),getHeight() - 1);
      }
    }
  }
;
  panel.setBorder(BorderFactory.createEmptyBorder(0,2,0,2));
  panel.add(comboBoxButton);
  panel.setOpaque(false);
  return panel;
}
