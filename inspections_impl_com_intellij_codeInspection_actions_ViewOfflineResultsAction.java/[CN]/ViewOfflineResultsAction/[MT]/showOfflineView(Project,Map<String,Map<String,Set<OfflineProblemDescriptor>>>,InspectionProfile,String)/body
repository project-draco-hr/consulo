{
  final AnalysisScope scope=new AnalysisScope(project);
  final InspectionManagerEx managerEx=((InspectionManagerEx)InspectionManagerEx.getInstance(project));
  final GlobalInspectionContextImpl inspectionContext=managerEx.createNewGlobalContext(false);
  inspectionContext.setExternalProfile(inspectionProfile);
  inspectionContext.setCurrentScope(scope);
  inspectionContext.initializeTools(scope,new HashMap<String,Set<InspectionTool>>(),new HashMap<String,Set<InspectionTool>>());
  final InspectionResultsView view=new InspectionResultsView(project,inspectionProfile,scope,inspectionContext,new OfflineInspectionRVContentProvider(resMap,project));
  ((RefManagerImpl)inspectionContext.getRefManager()).inspectionReadActionStarted();
  view.update();
  TreeUtil.selectFirstNode(view.getTree());
  if (inspectionContext.getContentManager() != null) {
    inspectionContext.addView(view,title);
  }
  return view;
}
