{
  HashSet<VirtualFile> unmerged=new HashSet<VirtualFile>();
  String rootPath=root.getPath();
  GitSimpleHandler h=new GitSimpleHandler(project,root,GitCommand.LS_FILES);
  h.setNoSSH(true);
  h.setSilent(true);
  h.addParameters("--unmerged");
  LocalFileSystem lfs=LocalFileSystem.getInstance();
  for (StringScanner s=new StringScanner(h.run()); s.hasMoreData(); ) {
    if (s.isEol()) {
      s.nextLine();
      continue;
    }
    s.boundedToken('\t');
    final String relative=s.line();
    String path=rootPath + "/" + GitUtil.unescapePath(relative);
    VirtualFile file=lfs.refreshAndFindFileByPath(path);
    if (file != null) {
      file.refresh(false,false);
      unmerged.add(file);
    }
  }
  if (unmerged.size() == 0) {
    return Collections.emptyList();
  }
 else {
    ArrayList<VirtualFile> rc=new ArrayList<VirtualFile>(unmerged.size());
    rc.addAll(unmerged);
    Collections.sort(rc,GitUtil.VIRTUAL_FILE_COMPARATOR);
    return rc;
  }
}
