{
  final EditorTextField textField=createTextField(project,externalSystemId);
  final FixedSizeButton selectRegisteredProjectButton=new FixedSizeButton();
  selectRegisteredProjectButton.setIcon(AllIcons.Actions.Module);
  String tooltipText=ExternalSystemBundle.message("run.configuration.tooltip.choose.registered.project",externalSystemId.getReadableName());
  selectRegisteredProjectButton.setToolTipText(tooltipText);
  selectRegisteredProjectButton.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      final Ref<JBPopup> popupRef=new Ref<JBPopup>();
      final Tree tree=buildRegisteredProjectsTree(project,externalSystemId);
      tree.setBorder(IdeBorderFactory.createEmptyBorder(8));
      Runnable treeSelectionCallback=new Runnable(){
        @Override public void run(){
          TreePath path=tree.getSelectionPath();
          if (path != null) {
            Object lastPathComponent=path.getLastPathComponent();
            if (lastPathComponent instanceof ExternalSystemNode) {
              Object e=((ExternalSystemNode)lastPathComponent).getDescriptor().getElement();
              if (e instanceof ExternalProjectPojo) {
                ExternalProjectPojo pojo=(ExternalProjectPojo)e;
                textField.setText(pojo.getPath());
                Editor editor=textField.getEditor();
                if (editor != null) {
                  collapseIfPossible(editor,externalSystemId,project);
                }
              }
            }
          }
          popupRef.get().closeOk(null);
        }
      }
;
      JBPopup popup=new PopupChooserBuilder(tree).setTitle(ExternalSystemBundle.message("run.configuration.title.choose.registered.project",externalSystemId.getReadableName())).setResizable(true).setItemChoosenCallback(treeSelectionCallback).setAutoselectOnMouseMove(true).setCloseOnEnter(false).createPopup();
      popupRef.set(popup);
      popup.showUnderneathOf(selectRegisteredProjectButton);
    }
  }
);
  return new MyPathAndProjectButtonPanel(textField,selectRegisteredProjectButton);
}
