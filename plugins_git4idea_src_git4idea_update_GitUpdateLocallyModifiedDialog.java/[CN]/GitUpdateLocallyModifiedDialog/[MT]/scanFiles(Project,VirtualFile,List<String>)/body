{
  String rootPath=root.getPath();
  GitSimpleHandler h=new GitSimpleHandler(project,root,GitCommand.DIFF);
  h.addParameters("--name-status");
  h.setNoSSH(true);
  h.setStdoutSuppressed(true);
  StringScanner s=new StringScanner(h.run());
  while (s.hasMoreData()) {
    if (s.isEol()) {
      s.line();
      continue;
    }
    if (s.tryConsume("M\t")) {
      String path=rootPath + "/" + GitUtil.unescapePath(s.line());
      files.add(path);
    }
 else {
      throw new VcsException("Working tree is dirty in unsupported way: " + s.line());
    }
  }
}
