{
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      HeavyProcessLatch.INSTANCE.processStarted();
      try {
        runActivities(myPreStartupActivities);
        if (myFileSystemSynchronizer != null || !ApplicationManager.getApplication().isUnitTestMode()) {
          myFileSystemSynchronizer.setCancelable(true);
          try {
            myFileSystemSynchronizer.executeFileUpdate();
          }
 catch (          ProcessCanceledException e) {
            throw e;
          }
catch (          Throwable e) {
            LOG.error(e);
          }
          myFileSystemSynchronizer=null;
        }
        myStartupActivityRunning=true;
        runActivities(myActivities);
        myStartupActivityRunning=false;
        myStartupActivityPassed=true;
      }
  finally {
        HeavyProcessLatch.INSTANCE.processFinished();
      }
    }
  }
);
}
