{
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      HeavyProcessLatch.INSTANCE.processStarted();
      try {
        runActivities(myPreStartupActivities);
        if (myFileSystemSynchronizer != null || !ApplicationManager.getApplication().isUnitTestMode()) {
          myFileSystemSynchronizer.setCancelable(true);
          myFileSystemSynchronizer.executeFileUpdate();
          myFileSystemSynchronizer=null;
        }
        myStartupActivityRunning=true;
        runActivities(myActivities);
        myStartupActivityRunning=false;
        myStartupActivityPassed=true;
      }
  finally {
        HeavyProcessLatch.INSTANCE.processFinished();
      }
    }
  }
);
}
