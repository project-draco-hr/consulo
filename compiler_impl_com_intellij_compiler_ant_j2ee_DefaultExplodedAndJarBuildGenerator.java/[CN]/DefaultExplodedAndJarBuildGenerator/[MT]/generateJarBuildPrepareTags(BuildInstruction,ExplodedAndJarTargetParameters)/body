{
  final List<Tag> prepareTags=new SmartList<Tag>();
  final String tempDirProperty=BuildProperties.getTempDirForModuleProperty(parameters.getContainingModule().getName());
  final File moduleBaseDir=parameters.getChunk().getBaseDir();
  instruction.accept(new BuildInstructionVisitor(){
    public boolean visitJarAndCopyBuildInstruction(    JarAndCopyBuildInstruction instruction) throws RuntimeException {
      if (instruction.isExternalDependencyInstruction())       return true;
      final String jarName=new File(instruction.getOutputRelativePath()).getName();
      final String destJarPath=BuildProperties.propertyRef(tempDirProperty) + "/" + jarName;
      prepareTags.add(generateJarTag(instruction,destJarPath,moduleBaseDir,parameters.getGenerationOptions()));
      return true;
    }
    public boolean visitCompoundBuildInstruction(    CompoundBuildInstruction instruction) throws RuntimeException {
      if (instruction.isExternalDependencyInstruction())       return true;
      if (!instruction.getBuildProperties().isJarEnabled()) {
        final String jarName=new File(instruction.getOutputRelativePath()).getName();
        final String destJarPath=BuildProperties.propertyRef(tempDirProperty) + "/" + jarName;
        final AntCall makeJar=new AntCall(parameters.getCompoundBuildInstructionNaming().getBuildJarTargetName(instruction));
        prepareTags.add(makeJar);
        makeJar.add(new Param(parameters.getJarPathParameter(),destJarPath));
      }
      return true;
    }
  }
);
  return prepareTags.toArray(new Tag[prepareTags.size()]);
}
