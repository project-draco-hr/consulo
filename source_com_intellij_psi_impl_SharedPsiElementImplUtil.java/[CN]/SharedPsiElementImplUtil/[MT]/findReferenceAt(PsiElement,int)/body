{
  if (thisElement == null)   return null;
  PsiElement element=thisElement.findElementAt(offset);
  if (element == null)   return null;
  offset=thisElement.getTextRange().getStartOffset() + offset - element.getTextRange().getStartOffset();
  List<PsiReference> referencesList=new ArrayList<PsiReference>();
  PsiElement elementForMultiRef=TreeUtil.getFileElement((TreeElement)element.getNode()).getPsi();
  while (element != null) {
    addReferences(offset,element,referencesList);
    offset=element.getStartOffsetInParent() + offset;
    element=element.getParent();
  }
  if (referencesList.isEmpty())   return null;
  if (referencesList.size() == 1)   return referencesList.get(0);
  return new PsiMultiReference(referencesList.toArray(new PsiReference[referencesList.size()]),elementForMultiRef);
}
