{
  final List<PsiReference> referencesList=new ArrayList<PsiReference>();
  int offsetInElement=offset;
  final PsiReference[] references=element.getReferences();
  LOG.assertTrue(references != null,element.toString());
  for (int i=0; i < references.length; i++) {
    final PsiReference reference=references[i];
    if (reference == null) {
      LOG.error(element.toString());
    }
    final TextRange range=reference.getRangeInElement();
    if (range.getStartOffset() <= offsetInElement && (offsetInElement < range.getEndOffset() || (offsetInElement == range.getEndOffset() && range.getLength() == 0))) {
      referencesList.add(reference);
    }
  }
  return referencesList.toArray(new PsiReference[referencesList.size()]);
}
