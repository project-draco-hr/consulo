{
  if (name.length() == 0) {
    return null;
  }
  final VirtualFile[] a=asArray();
  if (a != null) {
    for (    VirtualFile file : a) {
      if (namesEqual(name,file.getName()))       return (NewVirtualFile)file;
    }
    return createIfNotFound ? createAndFindChildWithEventFire(name) : null;
  }
  final Map<String,VirtualFile> map;
  final VirtualFile file;
synchronized (this) {
    map=ensureAsMap();
    file=map.get(name);
  }
  if (file == NullVirtualFile.INSTANCE) {
    return createIfNotFound ? createAndFindChildWithEventFire(name) : null;
  }
  if (file != null)   return (NewVirtualFile)file;
  final NewVirtualFileSystem delegate=getFileSystem();
  VirtualFile fake=new FakeVirtualFile(this,name);
  name=delegate.getCanonicallyCasedName(fake);
synchronized (this) {
    int id=ourPersistence.getId(this,name);
    if (id > 0) {
      NewVirtualFile child=createChild(name,id);
      map.put(name,child);
      return child;
    }
  }
  return null;
}
