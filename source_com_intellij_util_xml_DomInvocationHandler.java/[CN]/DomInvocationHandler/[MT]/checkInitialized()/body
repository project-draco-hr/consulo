{
synchronized (PsiLock.LOCK) {
    if (myInitialized || myInitializing)     return;
    myInitializing=true;
    try {
      final HashSet<XmlTag> usedTags=new HashSet<XmlTag>();
      final XmlTag tag=getXmlTag();
      for (      Map.Entry<Method,Pair<String,Integer>> entry : myMethodsMap.getFixedChildrenEntries()) {
        Method method=entry.getKey();
        final String qname=entry.getValue().getFirst();
        final Integer index=entry.getValue().getSecond();
        XmlTag subTag=findSubTag(tag,qname,index);
        final Class aClass=method.getReturnType();
        final IndexedElementInvocationHandler handler=new IndexedElementInvocationHandler(aClass,subTag,this,qname,index);
        final DomElement element=myManager.createDomElement(aClass,subTag,handler);
        myMethod2Children.put(method,element);
        usedTags.add(subTag);
      }
      if (tag != null) {
        for (        Map.Entry<Method,Pair<String,Class<? extends DomElement>>> entry : myMethodsMap.getVariableChildrenEntries()) {
          final Pair<String,Class<? extends DomElement>> pair=entry.getValue();
          String qname=pair.getFirst();
          for (          XmlTag subTag : tag.findSubTags(qname)) {
            if (!usedTags.contains(subTag)) {
              final Class<? extends DomElement> aClass=pair.getSecond();
              final DomInvocationHandler handler=new CollectionElementInvocationHandler(aClass,subTag,this,qname);
              myManager.createDomElement(aClass,subTag,handler);
              usedTags.add(subTag);
            }
          }
        }
      }
    }
  finally {
      myInitializing=false;
      myInitialized=true;
    }
  }
}
