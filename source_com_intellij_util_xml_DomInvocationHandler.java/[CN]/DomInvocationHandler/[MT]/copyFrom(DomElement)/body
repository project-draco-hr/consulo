{
  final XmlTag tag;
  tag=_ensureTagExists(false);
  final XmlTag newTag=element.ensureTagExists();
  List<DomEvent> events=new ArrayList<DomEvent>();
  if (!getTagValue(tag).equals(getTagValue(newTag))) {
    events.add(new ValueChangeEvent(this,getTagValue(tag),getTagValue(newTag)));
  }
  for (  XmlTag subTag : tag.getSubTags()) {
    if (myName2Children.containsKey(subTag)) {
      events.add(new ElementUndefinedEvent(DomManagerImpl.getCachedElement(subTag)));
    }
  }
  for (  XmlTag subTag : newTag.getSubTags()) {
    final DomElement child=myName2Children.get(subTag.getName());
    if (child != null) {
      events.add(new ElementDefinedEvent(child));
      events.add(new ElementChangedEvent(child));
    }
  }
  myTag=(XmlTag)tag.replace(newTag);
  for (  DomEvent event : events) {
    myManager.fireEvent(event);
  }
}
