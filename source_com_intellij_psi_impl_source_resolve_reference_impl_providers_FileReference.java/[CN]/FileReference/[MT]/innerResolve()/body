{
  final String text=getText();
  final Collection<PsiElement> contexts=getContexts();
  final Collection<ResolveResult> result=new ArrayList<ResolveResult>(contexts.size());
  for (  final PsiElement context : contexts) {
    if (text.length() == 0 && !myFileReferenceSet.isEndingSlashNotAllowed() && myIndex == myFileReferenceSet.getAllReferences().length - 1) {
      result.add(new PsiElementResolveResult(context));
    }
 else {
      PsiElement resolved=getFileReferenceContext(context).innerResolve(text,myEqualsToCondition);
      if (resolved != null) {
        result.add(new PsiElementResolveResult(resolved));
      }
    }
  }
  final int resultCount=result.size();
  return resultCount > 0 ? result.toArray(new ResolveResult[resultCount]) : ResolveResult.EMPTY_ARRAY;
}
