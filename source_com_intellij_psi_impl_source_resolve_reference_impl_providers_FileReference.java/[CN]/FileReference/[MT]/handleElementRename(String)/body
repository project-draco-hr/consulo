{
  final ElementManipulator<PsiElement> manipulator=CachingReference.getManipulator(getElement());
  if (manipulator != null) {
    myFileReferenceSet.setElement(manipulator.handleContentChange(getElement(),getRangeInElement(),newElementName));
    int delta=newElementName.length() - myRange.getLength();
    myRange=new TextRange(getRangeInElement().getStartOffset(),getRangeInElement().getStartOffset() + newElementName.length());
    FileReference[] references=myFileReferenceSet.getAllReferences();
    for (int idx=myIndex + 1; idx < references.length; idx++) {
      references[idx].myRange=references[idx].myRange.shiftRight(delta);
    }
    return myFileReferenceSet.getElement();
  }
  throw new IncorrectOperationException("Manipulator for this element is not defined: " + getElement());
}
