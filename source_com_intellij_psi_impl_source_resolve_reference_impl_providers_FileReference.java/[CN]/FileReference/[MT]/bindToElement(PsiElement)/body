{
  if (!(element instanceof PsiFileSystemItem))   throw new IncorrectOperationException("Cannot bind to element");
  final PsiFile file=getElement().getContainingFile();
  final String newName;
  if (WebUtil.getWebModuleProperties(file) != null) {
    newName=JspUtil.getDeploymentPath((PsiFileSystemItem)element);
  }
 else {
    final VirtualFile dst=element.getContainingFile().getVirtualFile();
    if (dst == null)     throw new IncorrectOperationException("Cannot bind to non-physical element:" + element);
    final VirtualFile currentFile=file.getVirtualFile();
    LOG.assertTrue(currentFile != null);
    newName=VfsUtil.getPath(currentFile,dst,'/');
    if (newName == null) {
      throw new IncorrectOperationException("Cannot find path between files; src = " + currentFile.getPresentableUrl() + "; dst = "+ dst.getPresentableUrl());
    }
  }
  final TextRange range=new TextRange(myFileReferenceSet.getStartInElement(),getRangeInElement().getEndOffset());
  final ElementManipulator<PsiElement> manipulator=getManipulator(getElement());
  if (manipulator == null) {
    throw new IncorrectOperationException("Manipulator not defined for: " + getElement());
  }
  return manipulator.handleContentChange(getElement(),range,newName);
}
