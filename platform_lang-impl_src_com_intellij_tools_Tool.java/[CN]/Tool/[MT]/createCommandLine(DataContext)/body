{
  if (getWorkingDirectory() != null && getWorkingDirectory().trim().length() == 0) {
    setWorkingDirectory(null);
  }
  GeneralCommandLine commandLine=new GeneralCommandLine();
  try {
    String paramString=MacroManager.getInstance().expandMacrosInString(getParameters(),true,dataContext);
    String workingDir=MacroManager.getInstance().expandMacrosInString(getWorkingDirectory(),true,dataContext);
    String exePath=MacroManager.getInstance().expandMacrosInString(getProgram(),true,dataContext);
    commandLine.getParametersList().addParametersString(MacroManager.getInstance().expandMacrosInString(paramString,false,dataContext));
    commandLine.setWorkDirectory(MacroManager.getInstance().expandMacrosInString(workingDir,false,dataContext));
    exePath=MacroManager.getInstance().expandMacrosInString(exePath,false,dataContext);
    if (exePath == null)     return null;
    File exeFile=new File(exePath);
    if (exeFile.isDirectory() && exeFile.getName().endsWith(".app")) {
      commandLine.setExePath("open");
      commandLine.getParametersList().prependAll("-a",exePath);
    }
 else {
      commandLine.setExePath(exePath);
    }
  }
 catch (  Macro.ExecutionCancelledException e) {
    return null;
  }
  return commandLine;
}
