{
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    return;
  }
  final AndroidAutogeneratorMode autogenerationMode=ApplicationManager.getApplication().runReadAction(new Computable<AndroidAutogeneratorMode>(){
    @Nullable public AndroidAutogeneratorMode compute(){
      return computeCompilerToRunAndInvalidateLocalAttributesMap();
    }
  }
);
  if (autogenerationMode == null) {
    return;
  }
  if (autogenerationMode == AndroidAutogeneratorMode.AAPT && AndroidRootUtil.getManifestFile(myFacet) != myEvent.getFile()) {
    final HashSet<ResourceEntry> resourceSet=new HashSet<ResourceEntry>();
    DumbService.getInstance(myFacet.getModule().getProject()).waitForSmartMode();
    AndroidCompileUtil.collectAllResources(myFacet,resourceSet);
synchronized (RESOURCES_SET_LOCK) {
      if (resourceSet.equals(myResourceSet) && !myFacet.areSourcesGeneratedWithErrors(AndroidAutogeneratorMode.AAPT)) {
        return;
      }
      myResourceSet=resourceSet;
    }
  }
  AndroidCompileUtil.generate(myFacet.getModule(),autogenerationMode,true);
}
