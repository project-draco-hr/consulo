{
  myEventCount++;
  if (!myPopupManager.isPopupActive()) {
    if (e instanceof KeyEvent) {
      if (!mySuspendMode && peekEvent(WindowEvent.WINDOW_OPENED) != null) {
        enterSuspendMode();
      }
    }
  }
  if ((e instanceof KeyEvent) || (e instanceof MouseEvent)) {
synchronized (myLock) {
      myIdleRequestsAlarm.cancelAllRequests();
      for (      Runnable idleListener : myIdleListeners) {
        final MyFireIdleRequest request=myListener2Request.get(idleListener);
        if (request == null) {
          LOG.assertTrue(false,"There is no request for " + idleListener);
        }
        final Integer timeout=myListener2Timeout.get(idleListener);
        LOG.assertTrue(timeout != null);
        myIdleRequestsAlarm.addRequest(request,timeout,ModalityState.NON_MMODAL);
      }
      if (KeyEvent.KEY_PRESSED == e.getID() || KeyEvent.KEY_TYPED == e.getID() || MouseEvent.MOUSE_PRESSED == e.getID() || MouseEvent.MOUSE_RELEASED == e.getID() || MouseEvent.MOUSE_CLICKED == e.getID()) {
        addIdleTimeCounterRequest();
        for (        Runnable activityListener : myActivityListeners) {
          activityListener.run();
        }
      }
    }
  }
  if (myPopupManager.isPopupActive() && myPopupManager.dispatch(e)) {
    return;
  }
  if (myDispatcher != null && myDispatcher.dispatch(e)) {
    return;
  }
  if (e instanceof InputMethodEvent) {
    if (SystemInfo.isMac && myKeyEventDispatcher.isWaitingForSecondKeyStroke()) {
      return;
    }
  }
  if ((e instanceof InputEvent) && Patches.SPECIAL_WINPUT_METHOD_PROCESSING) {
    final InputEvent inputEvent=(InputEvent)e;
    if (!inputEvent.getComponent().isShowing()) {
      return;
    }
  }
  if (e instanceof ComponentEvent && myWindowManager != null) {
    myWindowManager.dispatchComponentEvent((ComponentEvent)e);
  }
  if (e instanceof KeyEvent) {
    if (mySuspendMode || !myKeyEventDispatcher.dispatchKeyEvent((KeyEvent)e)) {
      defaultDispatchEvent(e);
    }
 else {
      ((KeyEvent)e).consume();
      defaultDispatchEvent(e);
    }
  }
 else   if (e instanceof MouseEvent) {
    if (!myMouseEventDispatcher.dispatchMouseEvent((MouseEvent)e)) {
      defaultDispatchEvent(e);
    }
  }
 else {
    defaultDispatchEvent(e);
  }
}
