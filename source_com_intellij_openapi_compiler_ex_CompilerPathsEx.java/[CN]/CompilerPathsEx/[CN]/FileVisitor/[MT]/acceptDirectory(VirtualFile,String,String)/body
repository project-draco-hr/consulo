{
  final VirtualFile[] children=ApplicationManager.getApplication().runReadAction(new Computable<VirtualFile[]>(){
    public VirtualFile[] compute(){
      return file.getChildren();
    }
  }
);
  for (int idx=0; idx < children.length; idx++) {
    final VirtualFile child=children[idx];
    final String name=child.getName();
    final StringBuffer buf=new StringBuffer(filePath.length() + "/".length() + name.length());
    buf.append(filePath).append("/").append(name);
    accept(child,fileRoot,buf.toString());
  }
}
