{
  final Set<VirtualFile> dirs=new OrderedSet<VirtualFile>((TObjectHashingStrategy<VirtualFile>)TObjectHashingStrategy.CANONICAL);
  for (int idx=0; idx < modules.length; idx++) {
    Module module=modules[idx];
    final VirtualFile outputDir=getModuleOutputDirectory(module,false);
    if (outputDir != null) {
      dirs.add(outputDir);
    }
    VirtualFile testsOutputDir=getModuleOutputDirectory(module,true);
    if (testsOutputDir != null) {
      dirs.add(testsOutputDir);
    }
  }
  return dirs.toArray(new VirtualFile[dirs.size()]);
}
