{
  int oldOffset=editor.getCaretModel().getOffset();
  final int offset=getNavigationPositionFor(info);
  final int endOffset=info.highlighter.getEndOffset();
  final ScrollingModel scrollingModel=editor.getScrollingModel();
  if (offset != oldOffset) {
    ScrollType scrollType=offset > oldOffset ? ScrollType.CENTER_DOWN : ScrollType.CENTER_UP;
    editor.getSelectionModel().removeSelection();
    editor.getCaretModel().moveToOffset(offset);
    scrollingModel.scrollToCaret(scrollType);
  }
  scrollingModel.runActionOnScrollingFinished(new Runnable(){
    public void run(){
      scrollingModel.scrollTo(editor.offsetToLogicalPosition(endOffset),ScrollType.MAKE_VISIBLE);
      scrollingModel.scrollTo(editor.offsetToLogicalPosition(offset),ScrollType.MAKE_VISIBLE);
    }
  }
);
  IdeDocumentHistory.getInstance(project).includeCurrentCommandAsNavigation();
  return true;
}
