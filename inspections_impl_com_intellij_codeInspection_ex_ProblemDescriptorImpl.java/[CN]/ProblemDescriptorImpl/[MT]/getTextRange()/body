{
  PsiElement startElement=getStartElement();
  PsiElement endElement=getEndElement();
  if (startElement == null || endElement == null)   return null;
  TextRange textRange=startElement.getTextRange();
  if (startElement == endElement) {
    if (isAfterEndOfLine())     return new TextRange(textRange.getEndOffset() - 1,textRange.getEndOffset());
    return textRange;
  }
  LOG.assertTrue(!isAfterEndOfLine());
  if (myTextRangeInElement != null) {
    return new TextRange(textRange.getStartOffset() + myTextRangeInElement.getStartOffset(),textRange.getStartOffset() + myTextRangeInElement.getEndOffset());
  }
  return new TextRange(textRange.getStartOffset(),endElement.getTextRange().getEndOffset());
}
