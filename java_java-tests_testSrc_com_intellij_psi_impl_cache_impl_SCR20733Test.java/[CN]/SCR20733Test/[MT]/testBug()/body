{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      PsiClass psiClass=myJavaFacade.findClass("p.A");
      assertEquals("p.A",psiClass.getQualifiedName());
      final PsiFile psiFile=myPsiManager.findFile(myPackDir.findChild("A.java"));
      psiFile.getChildren();
      assertEquals(psiFile,psiClass.getContainingFile());
      VirtualFile file=psiFile.getVirtualFile();
      assertEquals(myModule,ModuleUtil.findModuleForFile(file,myProject));
      Module anotherModule=createModule("another");
      myFilesToDelete.add(new File(anotherModule.getModuleFilePath()));
      ModifiableRootModel rootModel=ModuleRootManager.getInstance(anotherModule).getModifiableModel();
      rootModel.addContentEntry(mySrcDir1).addSourceFolder(mySrcDir1,false);
      rootModel.commit();
      assertEquals(anotherModule,ModuleUtil.findModuleForFile(file,myProject));
    }
  }
);
}
