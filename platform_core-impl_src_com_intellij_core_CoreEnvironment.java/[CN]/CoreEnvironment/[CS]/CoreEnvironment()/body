{
  myFileTypeRegistry=new CoreFileTypeRegistry();
  FileTypeRegistry.ourInstanceGetter=new Getter<FileTypeRegistry>(){
    @Override public FileTypeRegistry get(){
      return myFileTypeRegistry;
    }
  }
;
  myApplication=new MockApplication();
  new ApplicationManager(){
{
      ourApplication=myApplication;
    }
  }
;
  ApplicationComponentLocator.setInstance(myApplication);
  myProject=new MockProject(myApplication.getPicoContainer());
  final MutablePicoContainer appContainer=myApplication.getPicoContainer();
  registerComponentInstance(appContainer,FileDocumentManager.class,new MockFileDocumentManagerImpl(new Function<CharSequence,Document>(){
    @Override public Document fun(    CharSequence charSequence){
      return new DocumentImpl(charSequence);
    }
  }
,null));
  myApplication.registerService(DefaultASTFactory.class,new CoreASTFactory());
  myApplication.registerService(PsiBuilderFactory.class,new PsiBuilderFactoryImpl());
  final MutablePicoContainer projectContainer=myProject.getPicoContainer();
  PsiManagerImpl psiManager=new PsiManagerImpl(myProject,null,null,null,null);
  registerComponentInstance(projectContainer,PsiManager.class,psiManager);
  myProject.registerService(PsiFileFactory.class,new PsiFileFactoryImpl(psiManager));
  myProject.registerService(CachedValuesManager.class,new CachedValuesManagerImpl(myProject,null));
}
