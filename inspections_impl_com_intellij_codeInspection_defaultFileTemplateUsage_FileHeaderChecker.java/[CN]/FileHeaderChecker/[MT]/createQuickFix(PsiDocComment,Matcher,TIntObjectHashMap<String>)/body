{
  final FileTemplate template=FileTemplateManager.getInstance().getPattern(FileTemplateManager.FILE_HEADER_TEMPLATE_NAME);
  final ReplaceWithFileTemplateFix replaceTemplateFix=new ReplaceWithFileTemplateFix(){
    public void applyFix(    @NotNull Project project,    ProblemDescriptor descriptor){
      if (!element.isValid())       return;
      String newText;
      try {
        newText=template.getText(computeProperties(matcher,offsetToProperty));
      }
 catch (      IOException e) {
        LOG.error(e);
        return;
      }
      try {
        int offset=element.getTextRange().getStartOffset();
        PsiFile psiFile=element.getContainingFile();
        if (psiFile == null)         return;
        PsiDocumentManager documentManager=PsiDocumentManager.getInstance(project);
        Document document=documentManager.getDocument(psiFile);
        if (document == null)         return;
        element.delete();
        documentManager.doPostponedOperationsAndUnblockDocument(document);
        documentManager.commitDocument(document);
        document.insertString(offset,newText);
      }
 catch (      IncorrectOperationException e) {
        LOG.error(e);
      }
catch (      IllegalStateException e) {
        LOG.error("Cannot create doc comment from text: '" + newText + "'",e);
      }
    }
    private Properties computeProperties(    final Matcher matcher,    final TIntObjectHashMap<String> offsetToProperty){
      Properties properties=new Properties(FileTemplateManager.getInstance().getDefaultProperties());
      int[] offsets=offsetToProperty.keys();
      Arrays.sort(offsets);
      for (int i=0; i < offsets.length; i++) {
        final int offset=offsets[i];
        String propName=offsetToProperty.get(offset);
        int groupNum=i + 2;
        String propValue=matcher.group(groupNum);
        properties.put(propName,propValue);
      }
      return properties;
    }
  }
;
  final LocalQuickFix editFileTemplateFix=DefaultFileTemplateUsageInspection.createEditFileTemplateFix(template,replaceTemplateFix);
  if (template.isDefault()) {
    return new LocalQuickFix[]{editFileTemplateFix};
  }
  return new LocalQuickFix[]{replaceTemplateFix,editFileTemplateFix};
}
