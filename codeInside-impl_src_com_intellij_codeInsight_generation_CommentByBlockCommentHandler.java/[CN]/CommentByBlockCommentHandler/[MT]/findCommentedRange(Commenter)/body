{
  final FileType fileType=myFile.getFileType();
  if (fileType instanceof CustomFileType) {
    Lexer lexer=new CustomFileTypeLexer(((CustomFileType)fileType).getSyntaxTable());
    final CharSequence text=myDocument.getCharsSequence();
    final int caretOffset=myEditor.getCaretModel().getOffset();
    int commentStart=CharArrayUtil.lastIndexOf(text,commenter.getBlockCommentPrefix(),caretOffset);
    if (commentStart == -1)     return null;
    char[] chars=CharArrayUtil.fromSequence(text);
    lexer.start(chars,commentStart,text.length());
    if (lexer.getTokenType() == CustomHighlighterTokenType.MULTI_LINE_COMMENT && lexer.getTokenEnd() >= caretOffset) {
      return new TextRange(commentStart,lexer.getTokenEnd());
    }
    return null;
  }
  TextRange commentedRange=null;
  PsiElement comment=findCommentAtCaret();
  if (comment != null) {
    String commentText=comment.getText();
    String prefix=commenter.getBlockCommentPrefix();
    String suffix=commenter.getBlockCommentSuffix();
    if (!commentText.startsWith(prefix) || !commentText.endsWith(suffix))     return null;
    commentedRange=comment.getTextRange();
  }
  return commentedRange;
}
