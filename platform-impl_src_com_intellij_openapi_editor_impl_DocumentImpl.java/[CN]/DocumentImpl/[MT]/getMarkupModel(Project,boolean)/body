{
  if (project == null) {
    if (create && myMarkupModel == null) {
      myMarkupModel=new MarkupModelImpl(this);
    }
    return myMarkupModel;
  }
  final DocumentMarkupModelManager documentMarkupModelManager=project.isDisposed() ? null : DocumentMarkupModelManager.getInstance(project);
  if (documentMarkupModelManager == null || documentMarkupModelManager.isDisposed()) {
    return new EmptyMarkupModel(this);
  }
  MarkupModel model=myProjectToMarkupModelMap.get(project);
  if (create && model == null) {
    model=new MarkupModelImpl(this);
    myProjectToMarkupModelMap.put(project,model);
    documentMarkupModelManager.registerDocument(this);
  }
  return model;
}
