{
  Map<String,String> predefinedValues=null;
  if (attributes != null) {
    predefinedValues=new HashMap<String,String>();
    predefinedValues.put(ATTRS,attributes);
  }
  if (callback.isLiveTemplateApplicable(key)) {
    if (attributes != null && !callback.templateContainsVars(key,ATTRS)) {
      TemplateImpl newTemplate=generateTemplateWithAttributes(key,attributes,callback);
      if (newTemplate != null) {
        return callback.startTemplate(newTemplate,predefinedValues,listener);
      }
    }
    return callback.startTemplate(key,predefinedValues,listener);
  }
 else {
    TemplateImpl template=new TemplateImpl("","");
    template.addTextSegment('<' + key);
    if (attributes != null) {
      template.addVariable(ATTRS,"","",false);
      template.addVariableSegment(ATTRS);
    }
    template.addTextSegment(">");
    template.addVariableSegment(TemplateImpl.END);
    template.addTextSegment("</" + key + ">");
    template.setToReformat(true);
    return callback.startTemplate(template,predefinedValues,listener);
  }
}
