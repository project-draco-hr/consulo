{
  PsiFile file=callback.getFile();
  if (file.getLanguage() instanceof XMLLanguage) {
    Editor editor=callback.getEditor();
    PsiElement element=file.findElementAt(editor.getCaretModel().getOffset() - 1);
    int line=editor.getCaretModel().getLogicalPosition().line;
    int lineStart=editor.getDocument().getLineStartOffset(line);
    int parentStart;
    do {
      parentStart=element != null ? element.getTextRange().getStartOffset() : 0;
      int startOffset=parentStart > lineStart ? parentStart : lineStart;
      String key=computeKey(editor,startOffset);
      List<MyToken> tokens=parse(key,callback);
      if (tokens != null) {
        if (check(tokens)) {
          return key;
        }
      }
      if (element != null) {
        element=element.getParent();
      }
    }
 while (element != null && parentStart > lineStart);
  }
  return null;
}
