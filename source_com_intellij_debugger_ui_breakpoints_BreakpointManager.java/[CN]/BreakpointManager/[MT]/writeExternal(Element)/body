{
  final WriteExternalException[] exception=new WriteExternalException[1];
  PsiDocumentManager.getInstance(myProject).commitAndRunReadAction(new Runnable(){
    public void run(){
      try {
        removeInvalidBreakpoints();
        final Map<String,Element> categoryToElementMap=new java.util.HashMap<String,Element>();
        for (Iterator<Breakpoint> it=getBreakpoints().iterator(); it.hasNext(); ) {
          final Breakpoint breakpoint=it.next();
          final String category=breakpoint.getCategory();
          final Element group=getCategoryGroupElement(categoryToElementMap,category,parentNode);
          if (breakpoint.isValid()) {
            writeBreakpoint(group,breakpoint);
          }
        }
        final Element group=getCategoryGroupElement(categoryToElementMap,myAnyExceptionBreakpoint.getCategory(),parentNode);
        writeBreakpoint(group,myAnyExceptionBreakpoint);
      }
 catch (      WriteExternalException e) {
        exception[0]=e;
      }
    }
  }
);
  if (exception[0] != null)   throw exception[0];
}
