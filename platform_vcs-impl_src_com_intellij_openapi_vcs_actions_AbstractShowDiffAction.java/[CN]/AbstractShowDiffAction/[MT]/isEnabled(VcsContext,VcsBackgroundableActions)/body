{
  if (!(isVisible(vcsContext)))   return false;
  final Project project=vcsContext.getProject();
  if (project == null)   return false;
  final ProjectLevelVcsManager vcsManager=ProjectLevelVcsManager.getInstance(project);
  final VirtualFile[] selectedFilePaths=vcsContext.getSelectedFiles();
  if (selectedFilePaths == null || selectedFilePaths.length != 1)   return false;
  final VirtualFile selectedFile=selectedFilePaths[0];
  if (selectedFile.isDirectory())   return false;
  final BackgroundableActionEnabledHandler handler=((ProjectLevelVcsManagerImpl)vcsManager).getBackgroundableActionHandler(actionKey);
  if (handler.isInProgress(VcsBackgroundableActions.keyFrom(selectedFile)))   return false;
  final AbstractVcs vcs=vcsManager.getVcsFor(selectedFile);
  if (vcs == null)   return false;
  final DiffProvider diffProvider=vcs.getDiffProvider();
  if (diffProvider == null)   return false;
  return AbstractVcs.fileInVcsByFileStatus(project,new FilePathImpl(selectedFile));
}
