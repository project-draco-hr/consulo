{
  int state=StringUtil.compareVersionNumbers(descr.getVersion(),existing.getVersion());
  final PluginId pluginId=existing.getPluginId();
  final String idString=pluginId.getIdString();
  final JDOMExternalizableStringList installedPlugins=PluginManagerUISettings.getInstance().myInstalledPlugins;
  if (!installedPlugins.contains(idString) && !((IdeaPluginDescriptorImpl)existing).isDeleted()) {
    installedPlugins.add(idString);
  }
  final PluginManagerUISettings updateSettings=PluginManagerUISettings.getInstance();
  if (state > 0 && !PluginManager.isIncompatible(descr) && !updatedPlugins.contains(descr.getPluginId())) {
    NewVersions2Plugins.put(pluginId,1);
    if (!updateSettings.myOutdatedPlugins.contains(idString)) {
      updateSettings.myOutdatedPlugins.add(idString);
    }
    final IdeaPluginDescriptorImpl plugin=(IdeaPluginDescriptorImpl)existing;
    plugin.setDownloadsCount(descr.getDownloads());
    plugin.setVendor(descr.getVendor());
    plugin.setVendorEmail(descr.getVendorEmail());
    plugin.setVendorUrl(descr.getVendorUrl());
    plugin.setUrl(descr.getUrl());
  }
 else {
    updateSettings.myOutdatedPlugins.remove(idString);
    if (NewVersions2Plugins.remove(pluginId) != null) {
      updatedPlugins.add(pluginId);
    }
  }
}
