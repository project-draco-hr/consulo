{
  VirtualFile root=dir.createChildDirectory(null,"root");
  String url=root.getUrl();
  final VirtualFile finalRoot=root;
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      ModifiableRootModel m=getRootManager().getModifiableModel();
      m.addContentEntry(finalRoot);
      m.commit();
    }
  }
);
  assertSame(root,findContentEntry(url).getFile());
  root.delete(null);
  assertNotNull(findContentEntry(url));
  root=dir.createChildDirectory(null,"root");
  assertSame(root,findContentEntry(url).getFile());
}
