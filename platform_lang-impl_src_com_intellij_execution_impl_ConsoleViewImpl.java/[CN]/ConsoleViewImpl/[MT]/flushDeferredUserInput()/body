{
  final String text=myDeferredUserInput.substring(0,myDeferredUserInput.length());
  final int index=Math.max(text.lastIndexOf('\n'),text.lastIndexOf('\r'));
  if (index < 0)   return;
  final String textToSend=text.substring(0,index + 1);
  myDeferredUserInput.setLength(0);
  myDeferredUserInput.append(text.substring(index + 1));
  myFlushUserInputAlarm.addRequest(new Runnable(){
    public void run(){
      if (myState.isRunning()) {
        try {
          myState.sendUserInput(textToSend);
        }
 catch (        IOException e) {
          return;
        }
      }
    }
  }
,0);
}
