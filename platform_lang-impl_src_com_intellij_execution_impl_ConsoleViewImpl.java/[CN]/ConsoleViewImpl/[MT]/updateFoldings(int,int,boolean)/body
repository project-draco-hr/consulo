{
  final Document document=myEditor.getDocument();
  final CharSequence chars=document.getCharsSequence();
  final int startLine=Math.max(0,line1);
  final List<FoldRegion> toAdd=new ArrayList<FoldRegion>();
  for (int line=startLine; line <= endLine; line++) {
    boolean flushOnly=line == endLine;
    addFolding(document,chars,line,toAdd,flushOnly);
  }
  if (!toAdd.isEmpty()) {
    doUpdateFolding(toAdd,immediately);
  }
}
