{
  assertIsDispatchThread();
  myPendingFoldRegions.addAll(toAdd);
  myFoldingAlarm.cancelAllRequests();
  final Runnable runnable=new Runnable(){
    public void run(){
      assertIsDispatchThread();
      final FoldingModel model=myEditor.getFoldingModel();
      model.runBatchFoldingOperationDoNotCollapseCaret(new Runnable(){
        public void run(){
          assertIsDispatchThread();
          for (          FoldRegion region : myPendingFoldRegions) {
            region.setExpanded(false);
            model.addFoldRegion(region);
          }
          myPendingFoldRegions.clear();
        }
      }
);
    }
  }
;
  if (myPendingFoldRegions.size() > 100) {
    runnable.run();
  }
 else {
    myFoldingAlarm.addRequest(runnable,50);
  }
}
