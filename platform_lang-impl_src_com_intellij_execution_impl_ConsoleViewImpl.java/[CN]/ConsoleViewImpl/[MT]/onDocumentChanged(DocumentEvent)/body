{
  if (event.getNewLength() == 0) {
synchronized (LOCK) {
      ConsoleUtil.updateTokensOnTextRemoval(myTokens,event.getOffset(),event.getOffset() + event.getOldLength());
      int toRemoveLen=event.getOldLength();
      myContentSize-=Math.min(myContentSize,toRemoveLen);
    }
  }
 else   if (!myInDocumentUpdate) {
    int newFragmentLength=event.getNewFragment().length();
    if (event.getOldFragment().length() == 0 && newFragmentLength > 0) {
synchronized (LOCK) {
        myContentSize+=newFragmentLength;
        addToken(newFragmentLength,null,ConsoleViewContentType.NORMAL_OUTPUT);
      }
    }
 else {
      LOG.warn("unhandled external change: " + event);
    }
  }
}
