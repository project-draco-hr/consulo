{
  myFolding.put(line,placeholder);
  final String prevFolding=myFolding.get(line - 1);
  if (prevFolding != null && !prevFolding.equals(placeholder)) {
    final int lEnd=line - 1;
    int lStart=lEnd;
    while (prevFolding.equals(myFolding.get(lStart - 1)))     lStart--;
    if (lStart == lEnd) {
      return;
    }
    int oStart=CharArrayUtil.shiftForward(chars,document.getLineStartOffset(lStart)," \t");
    int oEnd=CharArrayUtil.shiftBackward(chars,document.getLineEndOffset(lEnd) - 1," \t") + 1;
    toAdd.add(new FoldRegionImpl(myEditor,oStart,oEnd,prevFolding,null));
  }
}
