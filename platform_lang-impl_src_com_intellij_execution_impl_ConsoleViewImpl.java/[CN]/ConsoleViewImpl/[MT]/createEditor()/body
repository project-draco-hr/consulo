{
  return ApplicationManager.getApplication().runReadAction(new Computable<EditorEx>(){
    @Override public EditorEx compute(){
      final EditorEx editor=createRealEditor();
      editor.addEditorMouseListener(new EditorPopupHandler(){
        @Override public void invokePopup(        final EditorMouseEvent event){
          popupInvoked(event.getMouseEvent());
        }
      }
);
      editor.getDocument().addDocumentListener(new DocumentListener(){
        @Override public void beforeDocumentChange(        DocumentEvent event){
        }
        @Override public void documentChanged(        DocumentEvent event){
          onDocumentChanged(event);
        }
      }
,ConsoleViewImpl.this);
      int bufferSize=myBuffer.isUseCyclicBuffer() ? myBuffer.getCyclicBufferSize() : 0;
      editor.getDocument().setCyclicBufferSize(bufferSize);
      editor.putUserData(CONSOLE_VIEW_IN_EDITOR_VIEW,ConsoleViewImpl.this);
      editor.getSettings().setAllowSingleLogicalLineFolding(true);
      editor.setHighlighter(createHighlighter());
      if (!myIsViewer) {
        registerConsoleEditorActions(editor);
      }
      return editor;
    }
  }
);
}
