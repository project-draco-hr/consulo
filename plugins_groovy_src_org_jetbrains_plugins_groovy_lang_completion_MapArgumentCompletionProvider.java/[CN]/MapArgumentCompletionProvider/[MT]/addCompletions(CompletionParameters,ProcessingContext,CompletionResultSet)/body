{
  PsiElement mapOrArgumentList;
  PsiElement parent=parameters.getPosition().getParent();
  if (parent instanceof GrReferenceExpression) {
    if (((GrReferenceExpression)parent).getQualifier() != null)     return;
    mapOrArgumentList=parent.getParent();
  }
 else {
    mapOrArgumentList=parent.getParent().getParent();
  }
  PsiElement argumentList=mapOrArgumentList instanceof GrArgumentList ? mapOrArgumentList : mapOrArgumentList.getParent();
  final GrCall call=(GrCall)argumentList.getParent();
  List<GroovyResolveResult> results=new ArrayList<GroovyResolveResult>();
  if (call instanceof GrConstructorCall) {
    GrConstructorCall constructorCall=(GrConstructorCall)call;
    ContainerUtil.addAll(results,constructorCall.multiResolveConstructor());
    ContainerUtil.addAll(results,constructorCall.multiResolveClass());
  }
 else   if (call instanceof GrCallExpression) {
    GrCallExpression callExpression=(GrCallExpression)call;
    ContainerUtil.addAll(results,callExpression.getCallVariants(null));
    final PsiType type=((GrCallExpression)call).getType();
    if (type instanceof PsiClassType) {
      final PsiClass psiClass=((PsiClassType)type).resolve();
      results.add(new GroovyResolveResultImpl(psiClass,true));
    }
  }
  Set<PsiClass> usedClasses=new HashSet<PsiClass>();
  Set<String> usedNames=new HashSet<String>();
  for (  GrNamedArgument argument : PsiUtil.getFirstMapNamedArguments(call)) {
    final GrArgumentLabel label=argument.getLabel();
    if (label != null) {
      ContainerUtil.addIfNotNull(label.getName(),usedNames);
    }
  }
  for (  GroovyResolveResult resolveResult : results) {
    PsiElement element=resolveResult.getElement();
    if (element instanceof PsiMethod) {
      final PsiMethod method=(PsiMethod)element;
      final PsiClass containingClass=method.getContainingClass();
      if (containingClass != null) {
        addPropertiesForClass(result,usedClasses,usedNames,containingClass,call);
      }
      Map<String,String[]> namedArguments=new java.util.HashMap<String,String[]>();
      for (      GroovyNamedArgumentProvider namedArgumentProvider : GroovyNamedArgumentProvider.EP_NAME.getExtensions()) {
        namedArgumentProvider.getNamedArguments(method,namedArguments);
      }
      for (      String namedArgumentName : namedArguments.keySet()) {
        if (!usedNames.contains(namedArgumentName)) {
          final LookupElementBuilder lookup=LookupElementBuilder.create(namedArgumentName).setIcon(GroovyIcons.DYNAMIC).setInsertHandler(NamedArgumentInsertHandler.INSTANCE);
          result.addElement(lookup);
        }
      }
    }
 else     if (element instanceof PsiClass) {
      addPropertiesForClass(result,usedClasses,usedNames,(PsiClass)element,call);
    }
  }
}
