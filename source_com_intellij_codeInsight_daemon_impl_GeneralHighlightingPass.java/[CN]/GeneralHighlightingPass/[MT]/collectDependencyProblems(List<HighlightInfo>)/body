{
  if (myUpdateAll && myFile instanceof PsiJavaFile && myFile.isPhysical()&& myFile.getVirtualFile() != null && mySettings.getInspectionProfile().isToolEnabled(HighlightDisplayKey.ILLEGAL_DEPENDENCY)) {
    DependenciesBuilder builder=new ForwardDependenciesBuilder(myProject,new AnalysisScope(myFile,AnalysisScope.SOURCE_JAVA_FILES));
    final DependencyValidationManager validationManager=DependencyValidationManager.getInstance(myProject);
    builder.analyzeFileDependencies(myFile,new DependenciesBuilder.DependencyProcessor(){
      public void process(      PsiElement place,      PsiElement dependency){
        PsiFile dependencyFile=dependency.getContainingFile();
        if (dependencyFile != null && dependencyFile.isPhysical() && dependencyFile.getVirtualFile() != null) {
          final DependencyRule rule=validationManager.getViolatorDependencyRule(myFile,dependencyFile);
          if (rule != null) {
            HighlightInfo info=HighlightInfo.createHighlightInfo(HighlightInfoType.ILLEGAL_DEPENDENCY,place,"Illegal dependency. Violated rule: \"" + rule.getDisplayText() + "\"");
            if (info != null) {
              list.add(info);
            }
          }
        }
      }
    }
);
  }
}
