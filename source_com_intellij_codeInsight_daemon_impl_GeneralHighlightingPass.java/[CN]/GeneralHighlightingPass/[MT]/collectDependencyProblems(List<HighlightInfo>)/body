{
  if (myUpdateAll && myFile instanceof PsiJavaFile && myFile.isPhysical()&& myFile.getVirtualFile() != null && mySettings.getInspectionProfile(myFile).isToolEnabled(HighlightDisplayKey.ILLEGAL_DEPENDENCY)) {
    final DependencyValidationManager validationManager=DependencyValidationManager.getInstance(myProject);
    if (!validationManager.hasRules())     return;
    DependenciesBuilder builder=new ForwardDependenciesBuilder(myProject,new AnalysisScope(myFile));
    builder.analyzeFileDependencies(myFile,new DependenciesBuilder.DependencyProcessor(){
      public void process(      PsiElement place,      PsiElement dependency){
        PsiFile dependencyFile=dependency.getContainingFile();
        if (dependencyFile != null && dependencyFile.isPhysical() && dependencyFile.getVirtualFile() != null) {
          DependencyRule[] rules=validationManager.getViolatorDependencyRules(myFile,dependencyFile);
          if (rules.length > 0) {
            if (InspectionManagerEx.inspectionResultSuppressed(place,HighlightDisplayKey.ILLEGAL_DEPENDENCY.getID()))             return;
            HighlightInfo info=HighlightInfo.createHighlightInfo(HighlightInfoType.ILLEGAL_DEPENDENCY,place,"Illegal dependency. Violated rules: \"" + rules[0].getDisplayText() + "\"");
            if (info != null) {
              list.add(info);
              List<IntentionAction> options=new ArrayList<IntentionAction>();
              options.add(new SwitchOffToolAction(HighlightDisplayKey.ILLEGAL_DEPENDENCY));
              options.add(new AddNoInspectionCommentAction(HighlightDisplayKey.ILLEGAL_DEPENDENCY,place));
              options.add(new AddNoInspectionDocTagAction(HighlightDisplayKey.ILLEGAL_DEPENDENCY,place));
              options.add(new AddNoInspectionForClassAction(HighlightDisplayKey.ILLEGAL_DEPENDENCY,place));
              options.add(new AddNoInspectionAllForClassAction(place));
              options.add(new AddSuppressWarningsAnnotationAction(HighlightDisplayKey.ILLEGAL_DEPENDENCY,place));
              options.add(new AddSuppressWarningsAnnotationForClassAction(HighlightDisplayKey.ILLEGAL_DEPENDENCY,place));
              options.add(new AddSuppressWarningsAnnotationForAllAction(place));
              QuickFixAction.registerQuickFixAction(info,new EditDependencyRulesAction(rules[0]),options);
            }
          }
        }
      }
    }
);
  }
}
