{
  if (myUpdateAll && myFile instanceof PsiJavaFile && myFile.isPhysical()&& myFile.getVirtualFile() != null && mySettings.getInspectionProfile().isToolEnabled(HighlightDisplayKey.ILLEGAL_DEPENDENCY)) {
    DependenciesBuilder builder=new ForwardDependenciesBuilder(myProject,new AnalysisScope(myFile));
    final DependencyValidationManager validationManager=DependencyValidationManager.getInstance(myProject);
    builder.analyzeFileDependencies(myFile,new DependenciesBuilder.DependencyProcessor(){
      public void process(      PsiElement place,      PsiElement dependency){
        PsiFile dependencyFile=dependency.getContainingFile();
        InspectionManagerEx iManager=((InspectionManagerEx)InspectionManager.getInstance(place.getProject()));
        if (iManager.inspectionResultSuppressed(place,HighlightDisplayKey.ILLEGAL_DEPENDENCY.toString()))         return;
        if (dependencyFile != null && dependencyFile.isPhysical() && dependencyFile.getVirtualFile() != null) {
          DependencyRule[] rules=validationManager.getViolatorDependencyRules(myFile,dependencyFile);
          if (rules.length > 0) {
            HighlightInfo info=HighlightInfo.createHighlightInfo(HighlightInfoType.ILLEGAL_DEPENDENCY,place,"Illegal dependency. Violated rules: \"" + rules[0].getDisplayText() + "\"");
            if (info != null) {
              list.add(info);
              List<IntentionAction> options=new ArrayList<IntentionAction>();
              options.add(new AddNoInspectionCommentAction(HighlightDisplayKey.ILLEGAL_DEPENDENCY,place));
              options.add(new AddNoInspectionDocTagAction(HighlightDisplayKey.ILLEGAL_DEPENDENCY,place));
              options.add(new AddNoInspectionAllForClassAction(place));
              options.add(new SwitchOffToolAction(HighlightDisplayKey.ILLEGAL_DEPENDENCY));
              QuickFixAction.registerQuickFixAction(info,new EditDependencyRulesAction(rules[0]),options);
            }
          }
        }
      }
    }
);
  }
}
