{
  int read=0;
  if (counter < bufferLength) {
    read=Math.min(bufferLength - counter,len);
    System.arraycopy(buffer,counter,b,off,read);
    off+=read;
    len-=read;
    counter+=read;
  }
  if (len > 0) {
    int r=is != null ? is.read(b,off,len) : -1;
    if (read == 0 && r < 0)     return -1;
    if (r >= 0)     read+=r;
  }
  return read;
}
