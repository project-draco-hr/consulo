{
  final EditorFactoryListener myEditorFactoryListener=new EditorFactoryAdapter(){
    public void editorReleased(    @NotNull EditorFactoryEvent event){
      Editor editor=event.getEditor();
      if (editor.getProject() != null && editor.getProject() != myProject)       return;
      if (myProject.isDisposed() || !myProject.isOpen())       return;
      TemplateState tState=getTemplateState(editor);
      if (tState != null) {
        tState.gotoEnd();
      }
      editor.putUserData(TEMPLATE_STATE_KEY,null);
    }
  }
;
  EditorFactory.getInstance().addEditorFactoryListener(myEditorFactoryListener,myProject);
}
