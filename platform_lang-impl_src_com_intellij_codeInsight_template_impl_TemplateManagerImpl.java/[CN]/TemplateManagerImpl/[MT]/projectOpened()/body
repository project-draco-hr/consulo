{
  final EditorFactoryListener myEditorFactoryListener=new EditorFactoryAdapter(){
    public void editorReleased(    EditorFactoryEvent event){
      Editor editor=event.getEditor();
      if (editor.getProject() != null && editor.getProject() != myProject)       return;
      TemplateState tState=getTemplateState(editor);
      if (tState != null) {
        disposeState(tState);
      }
      editor.putUserData(TEMPLATE_STATE_KEY,null);
    }
  }
;
  EditorFactory.getInstance().addEditorFactoryListener(myEditorFactoryListener,myProject);
}
