{
  final int caretOffset=editor.getCaretModel().getOffset();
  final Document document=editor.getDocument();
  CharSequence text=document.getCharsSequence();
  if (template2argument == null || template2argument.size() == 0) {
    return false;
  }
  if (!FileDocumentManager.getInstance().requestWriting(editor.getDocument(),myProject)) {
    return false;
  }
  if (template2argument.size() == 1) {
    TemplateImpl template=template2argument.keySet().iterator().next();
    String argument=template2argument.get(template);
    int templateStart=getTemplateStart(template,argument,caretOffset,text);
    startTemplateWithPrefix(editor,template,templateStart,processor,argument);
  }
 else {
    ListTemplatesHandler.showTemplatesLookup(myProject,editor,template2argument);
  }
  return true;
}
