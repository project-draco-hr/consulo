{
  TemplateContext context=template.getTemplateContext();
  if (isEnabled(file,offset,null,context)) {
    return true;
  }
  Language baseLanguage=file.getViewProvider().getBaseLanguage();
  if (baseLanguage != file.getLanguage()) {
    PsiFile basePsi=file.getViewProvider().getPsi(baseLanguage);
    if (basePsi != null && isEnabled(basePsi,offset,null,context)) {
      return true;
    }
  }
  final Language baseLanguageForBaseLanguage=baseLanguage.getBaseLanguage();
  if (baseLanguageForBaseLanguage != null) {
    final LanguageFileType associatedFileType=baseLanguageForBaseLanguage.getAssociatedFileType();
    if (associatedFileType != null && associatedFileType != file.getFileType()) {
      if (isEnabled(null,0,associatedFileType,context)) {
        return true;
      }
    }
  }
  if (offset > 0) {
    final Language prevLanguage=PsiUtilBase.getLanguageAtOffset(file,offset - 1);
    final PsiFile prevPsi=file.getViewProvider().getPsi(prevLanguage);
    if (prevPsi != null && isEnabled(prevPsi,offset - 1,null,context)) {
      return true;
    }
  }
  return false;
}
