{
  PsiFile file=PsiUtilBase.getPsiFileInEditor(editor,myProject);
  if (file == null)   return false;
  TemplateSettings templateSettings=TemplateSettings.getInstance();
  if (shortcutChar == templateSettings.getDefaultShortcutChar()) {
    for (    final CustomLiveTemplate customLiveTemplate : CustomLiveTemplate.EP_NAME.getExtensions()) {
      final String currentLineBeforeCaret=getCurrentLineBeforeCaret(editor);
      final CustomTemplateCallback callback=new CustomTemplateCallback(editor,file);
      if (customLiveTemplate.isApplicable(currentLineBeforeCaret,callback)) {
        int offset=editor.getCaretModel().getOffset();
        final int startOffset=offset - currentLineBeforeCaret.length();
        editor.getDocument().deleteString(startOffset,offset);
        callback.fixInitialEditorState();
        customLiveTemplate.execute(currentLineBeforeCaret,callback,null);
        return true;
      }
    }
  }
  return startNonCustomTemplate(templateSettings,file,editor,shortcutChar,processor);
}
