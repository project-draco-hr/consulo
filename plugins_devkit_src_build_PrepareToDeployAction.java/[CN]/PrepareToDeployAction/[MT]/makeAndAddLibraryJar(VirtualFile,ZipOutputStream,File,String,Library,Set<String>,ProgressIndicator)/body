{
  File libraryJar=FileUtil.createTempFile(TEMP_PREFIX,JAR_EXTENSION);
  libraryJar.deleteOnExit();
  ZipOutputStream jar=null;
  try {
    jar=new JarOutputStream(new BufferedOutputStream(new FileOutputStream(libraryJar)));
    ZipUtil.addFileOrDirRecursively(jar,libraryJar,VfsUtil.virtualToIoFile(virtualFile),"",new FileFilter(){
      public boolean accept(      File pathname){
        if (progressIndicator != null) {
          progressIndicator.setText2("");
        }
        return !myFileTypeManager.isFileIgnored(FileUtil.toSystemIndependentName(pathname.getPath()));
      }
    }
,new HashSet<String>());
  }
  finally {
    if (jar != null)     jar.close();
  }
  ZipUtil.addFileOrDirRecursively(zos,zipFile,libraryJar,"/" + name + MIDDLE_LIB_DIR+ getLibraryJarName(library,names,virtualFile)+ JAR_EXTENSION,new FileFilter(){
    public boolean accept(    File pathname){
      if (progressIndicator != null) {
        progressIndicator.setText2("");
      }
      return true;
    }
  }
,new HashSet<String>());
}
