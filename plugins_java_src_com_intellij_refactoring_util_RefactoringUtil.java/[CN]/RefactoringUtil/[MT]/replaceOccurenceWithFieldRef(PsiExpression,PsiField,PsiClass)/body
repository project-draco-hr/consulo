{
  final PsiManager manager=destinationClass.getManager();
  final String fieldName=newField.getName();
  final JavaPsiFacade facade=JavaPsiFacade.getInstance(manager.getProject());
  final PsiElement element=occurrence.getUserData(ElementToWorkOn.PARENT);
  final PsiVariable psiVariable=facade.getResolveHelper().resolveAccessibleReferencedVariable(fieldName,element != null ? element : occurrence);
  final PsiElementFactory factory=facade.getElementFactory();
  if (psiVariable != null && psiVariable.equals(newField)) {
    return IntroduceVariableBase.replace(occurrence,factory.createExpressionFromText(fieldName,null),manager.getProject());
  }
 else {
    final PsiReferenceExpression ref=(PsiReferenceExpression)factory.createExpressionFromText("this." + fieldName,null);
    if (!occurrence.isValid())     return null;
    if (newField.hasModifierProperty(PsiModifier.STATIC)) {
      ref.setQualifierExpression(factory.createReferenceExpression(destinationClass));
    }
    return IntroduceVariableBase.replace(occurrence,ref,manager.getProject());
  }
}
