{
  if (psi == null) {
    psi=PsiAdapterFactory.getPsiAdapter();
  }
  PsiMethod methodHashCode=psi.findHashCodeMethod(clazz);
  PsiMethod methodEquals=psi.findEqualsMethod(clazz);
  PsiMethod method;
  if (methodEquals != null && methodHashCode != null) {
    if (methodEquals.getTextOffset() > methodHashCode.getTextOffset()) {
      method=methodEquals;
    }
 else {
      method=methodHashCode;
    }
  }
 else {
    method=methodHashCode != null ? methodHashCode : methodEquals;
  }
  if (method != null) {
    clazz.addAfter(newMethod,method);
  }
 else {
    InsertAtCaretPolicy.getInstance().insertNewMethod(clazz,newMethod);
  }
  return true;
}
