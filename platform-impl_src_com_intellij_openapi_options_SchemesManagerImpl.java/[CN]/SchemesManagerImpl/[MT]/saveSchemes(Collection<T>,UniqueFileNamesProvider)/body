{
  for (  T scheme : schemes) {
    if (isExternalizable(scheme)) {
      E eScheme=(E)scheme;
      eScheme.getExternalInfo().setPreviouslySavedName(eScheme.getName());
      if (myProcessor.shouldBeSaved(eScheme)) {
        final File file=getFileForScheme(myBaseDir,fileNameProvider,eScheme);
        try {
          final Document document=writeSchemeToDocument(eScheme);
          long newHash=computeHashValue(document);
          Long oldHash=eScheme.getExternalInfo().getHash();
          saveIfNeeded(eScheme,file,document,newHash,oldHash);
        }
 catch (        final IOException e) {
          ApplicationManager.getApplication().invokeLater(new Runnable(){
            public void run(){
              String msg="Cannot write scheme " + file.getName() + " in '"+ myFileSpec+ "': "+ e.getLocalizedMessage();
              LOG.warn(msg,e);
              Messages.showErrorDialog(msg,"Save Settings");
            }
          }
);
        }
      }
    }
  }
}
