{
  if (scheme != null && scheme.getName() != null && (!myDeletedNames.contains(scheme.getName()) || forceAdd)) {
    T existing=findSchemeByName(scheme.getName());
    if (existing != null && existing instanceof ExternalizableScheme) {
      ExternalInfo info=((ExternalizableScheme)existing).getExternalInfo();
      if (info.getCurrentFileName() != null) {
        VirtualFile child=myVFSBaseDir.findChild(info.getCurrentFileName() + EXT);
        if (child != null) {
          child.delete(this);
        }
      }
    }
    if (existing != null) {
      mySchemes.remove(existing);
      if (isExternalizable(existing)) {
        myProcessor.onSchemeDeleted((E)existing);
      }
    }
    addNewScheme((T)scheme,true);
    saveFileName(file.getName(),scheme);
    scheme.getExternalInfo().setPreviouslySavedName(scheme.getName());
  }
 else {
    deleteLocalAndServerFiles(file.getName());
  }
}
