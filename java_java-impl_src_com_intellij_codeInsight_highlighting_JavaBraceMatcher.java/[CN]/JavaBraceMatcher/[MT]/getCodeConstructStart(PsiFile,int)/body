{
  PsiElement element=file.findElementAt(openingBraceOffset);
  if (element == null || element instanceof PsiFile)   return openingBraceOffset;
  PsiElement parent=element.getParent();
  if (parent instanceof PsiCodeBlock) {
    parent=parent.getParent();
    if (parent instanceof PsiMethod || parent instanceof PsiClassInitializer) {
      TextRange range=DeclarationRangeUtil.getDeclarationRange(parent);
      return range.getStartOffset();
    }
 else     if (parent instanceof PsiStatement) {
      if (parent instanceof PsiBlockStatement && parent.getParent() instanceof PsiStatement) {
        parent=parent.getParent();
      }
      return parent.getTextRange().getStartOffset();
    }
  }
 else   if (parent instanceof PsiClass) {
    TextRange range=DeclarationRangeUtil.getDeclarationRange(parent);
    return range.getStartOffset();
  }
  return openingBraceOffset;
}
