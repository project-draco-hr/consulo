{
  VirtualFile f=root.createChildData(null,"f.txt");
  f.setBinaryContent(new byte[]{1});
  f.rename(null,"ff.txt");
  createPatchBetweenRevisions(1,0);
  f.rename(null,"f.txt");
  applyPatch();
  VirtualFile patched=root.findChild("ff.txt");
  assertNull(root.findChild("f.txt"));
  assertNotNull(patched);
  assertEquals(1,patched.contentsToByteArray()[0]);
}
