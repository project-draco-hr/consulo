{
  ASTNode node=myNode;
  if (node == null) {
    ApplicationManager.getApplication().assertReadAccessAllowed();
    PsiFileImpl file=(PsiFileImpl)getContainingFile();
    if (!file.isValid())     throw new PsiInvalidElementAccessException(this);
    FileElement treeElement=file.getTreeElement();
    StubTree stubTree=file.getStubTree();
    if (treeElement != null && myNode == null) {
      return notBoundInExistingAst(file,treeElement,stubTree);
    }
    final FileElement fileElement=file.calcTreeElement();
    node=myNode;
    if (node == null) {
      return failedToBindStubToAst(file,stubTree,fileElement);
    }
  }
  return node;
}
