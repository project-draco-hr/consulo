{
  ASTNode node=myNode;
  if (node == null) {
    ApplicationManager.getApplication().assertReadAccessAllowed();
    PsiFileImpl file=(PsiFileImpl)getContainingFile();
synchronized (file.getStubLock()) {
      node=myNode;
      if (node == null) {
        NonCancelableSection criticalSection=ProgressIndicatorProvider.getInstance().startNonCancelableSection();
        try {
          if (!file.isValid())           throw new PsiInvalidElementAccessException(this);
          FileElement treeElement=file.getTreeElement();
          StubTree stubTree=file.getStubTree();
          if (treeElement != null) {
            throw new AssertionError("this=" + this + "; file.isPhysical="+ file.isPhysical()+ "; node="+ myNode+ "; file="+ file+ "; tree="+ treeElement+ "; stubTree="+ stubTree);
          }
          final FileElement fileElement=file.loadTreeElement();
          node=myNode;
          if (node == null) {
            String message=new StringBuilder().append("Failed to bind stub to AST for element ").append(getClass()).append(" in ").append(file.getVirtualFile() == null ? "<unknown file>" : file.getVirtualFile().getPath()).append("\nFile stub tree:\n").append(stubTree != null ? StringUtil.trimLog(((PsiFileStubImpl)stubTree.getRoot()).printTree(),1024) : " is null").append("\nLoaded file AST:\n").append(StringUtil.trimLog(DebugUtil.treeToString(fileElement,true),1024)).toString();
            throw new IllegalArgumentException(message);
          }
        }
  finally {
          criticalSection.done();
        }
      }
    }
  }
  return node;
}
