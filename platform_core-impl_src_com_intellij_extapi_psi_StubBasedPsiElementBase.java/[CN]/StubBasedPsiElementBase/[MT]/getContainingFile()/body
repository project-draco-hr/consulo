{
  StubElement stub=myStub;
  if (stub != null) {
    while (!(stub instanceof PsiFileStub)) {
      stub=stub.getParentStub();
    }
    PsiFile psi=(PsiFile)stub.getPsi();
    if (psi != null) {
      return psi;
    }
    ApplicationManager.getApplication().assertReadAccessAllowed();
synchronized (PsiLock.LOCK) {
      if (myStub != null) {
        throw new PsiInvalidElementAccessException(this,"no psi for file stub " + stub + ", invalidation reason="+ ((PsiFileStubImpl<?>)stub).getInvalidationReason(),null);
      }
    }
  }
  PsiFile file=super.getContainingFile();
  if (file == null) {
    throw new PsiInvalidElementAccessException(this);
  }
  return file;
}
