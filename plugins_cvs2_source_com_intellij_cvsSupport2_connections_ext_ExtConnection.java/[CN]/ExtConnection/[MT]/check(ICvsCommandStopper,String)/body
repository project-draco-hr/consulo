{
  InputStreamWrapper streamWrapper=new InputStreamWrapper(myInputStream,stopper,new ReadWriteStatistics());
  try {
    int i=0;
    StringBuffer buffer=new StringBuffer();
    while (i != -1) {
      i=streamWrapper.read();
      if (i == -1 || i == '\n' || i == ' ' || i == '\r')       break;
      buffer.append((char)i);
    }
    String read=buffer.toString().trim();
    if (!expectedResult.equals(read)) {
      if (read.startsWith(myUserName + "@" + myHost)) {
        throw new AuthenticationException("Server rejected access",null);
      }
 else {
        InputStream errorStream=myProcess.getErrorStream();
        if (errorStream.available() > 0) {
          throw new AuthenticationException(readFrom(errorStream),null);
        }
 else {
          throw new AuthenticationException("Cannot establish external connection",null);
        }
      }
    }
  }
  finally {
    streamWrapper.close();
  }
}
