{
  Object parent=null;
  if (project != null) {
    parent=WindowManager.getInstance().suggestParentWindow(project);
  }
  LOG.debug("suggested parent window=" + parent);
  final JDialog dialog=parent == null ? new JDialog() : (parent instanceof JDialog ? new JDialog((JDialog)parent) : new JDialog((JFrame)parent));
  final Container pane=dialog.getContentPane();
  final JLabel rearrangingLabel=new JLabel("Rearranging files, please wait...");
  final JPanel progressPanel=new JPanel(new GridBagLayout());
  final Constraints constraints=new Constraints(GridBagConstraints.NORTHWEST);
  constraints.newRow();
  constraints.insets=new Insets(15,15,0,0);
  progressPanel.add(rearrangingLabel,constraints.weightedLastCol());
  constraints.newRow();
  bar.setMinimum(0);
  bar.setMaximum(max);
  bar.setPreferredSize(new Dimension(500,15));
  bar.setMinimumSize(new Dimension(500,15));
  bar.setStringPainted(true);
  constraints.insets=new Insets(15,15,5,15);
  progressPanel.add(bar,constraints.weightedFirstCol());
  constraints.insets=new Insets(9,0,5,15);
  final JButton cancelButton=new JButton("Cancel");
  cancelButton.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      LOG.debug("cancel button pressed");
      filename.setText("cancelling...");
      cancelled.value=true;
    }
  }
);
  progressPanel.add(cancelButton,constraints.weightedLastCol());
  constraints.weightedLastRow();
  constraints.insets=new Insets(0,15,15,0);
  filename.setSize(500,15);
  filename.setPreferredSize(new Dimension(500,15));
  progressPanel.add(filename,constraints.weightedLastCol());
  pane.add(progressPanel,BorderLayout.CENTER);
  dialog.setTitle(Rearranger.COMPONENT_NAME);
  dialog.addWindowListener(new WindowListener(){
    public void windowClosed(    final WindowEvent e){
    }
    public void windowActivated(    final WindowEvent e){
    }
    public void windowClosing(    final WindowEvent e){
      LOG.debug("dialog closed, cancel Rearranger");
      filename.setText("cancelling...");
      cancelled.value=true;
    }
    public void windowDeactivated(    final WindowEvent e){
    }
    public void windowDeiconified(    final WindowEvent e){
    }
    public void windowIconified(    final WindowEvent e){
    }
    public void windowOpened(    final WindowEvent e){
    }
  }
);
  dialog.pack();
  return dialog;
}
