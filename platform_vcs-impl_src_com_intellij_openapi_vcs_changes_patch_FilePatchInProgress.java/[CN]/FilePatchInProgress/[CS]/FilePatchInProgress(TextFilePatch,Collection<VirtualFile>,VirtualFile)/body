{
  myPatch=patch;
  myStrippable=new PatchStrippable(patch);
  if (autoBases != null) {
    myAutoBases=new ArrayList<VirtualFile>();
    final String path=myPatch.getBeforeName() == null ? myPatch.getAfterName() : myPatch.getBeforeName();
    for (    VirtualFile autoBase : autoBases) {
      final VirtualFile willBeBase=PathMerger.getBase(autoBase,path);
      if (willBeBase != null) {
        myAutoBases.add(willBeBase);
      }
    }
  }
 else {
    myAutoBases=Collections.emptyList();
  }
  myStatus=getStatus(myPatch);
  if (myAutoBases.isEmpty()) {
    setNewBase(baseDir);
  }
 else {
    setNewBase(myAutoBases.get(0));
  }
}
