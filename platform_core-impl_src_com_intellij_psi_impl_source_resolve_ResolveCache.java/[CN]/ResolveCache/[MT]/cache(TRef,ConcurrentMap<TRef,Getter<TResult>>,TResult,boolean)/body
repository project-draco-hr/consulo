{
  Getter<TResult> cached=map.get(ref);
  if (cached != null && cached.get() == result) {
    return;
  }
  if (result == null) {
    cached=(Getter<TResult>)NULL_RESULT;
  }
 else   if (isPoly && ((Object[])result).length == 0) {
    cached=result.getClass() == ResolveResult[].class ? (Getter<TResult>)EMPTY_POLY_RESULT : new StaticGetter<TResult>(result);
  }
 else {
    cached=new SoftGetter<TResult>(result);
  }
  ConcurrencyUtil.cacheOrGet(map,ref,cached);
}
