{
  TResult cached=map.get(ref);
  if (cached != null && cached == result) {
    return;
  }
  if (result == null) {
    cached=(TResult)NULL_RESULT;
  }
 else {
    cached=result;
  }
  map.put(ref,cached);
}
