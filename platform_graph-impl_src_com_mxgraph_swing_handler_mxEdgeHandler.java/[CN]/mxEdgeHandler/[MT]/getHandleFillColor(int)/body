{
  boolean source=isSource(index);
  if (source || isTarget(index)) {
    mxGraph graph=graphComponent.getGraph();
    Object terminal=graph.getModel().getTerminal(state.getCell(),source);
    if (terminal == null && !graphComponent.getGraph().isTerminalPointMovable(state.getCell(),source)) {
      return mxSwingConstants.LOCKED_HANDLE_FILLCOLOR;
    }
 else     if (terminal != null) {
      return (graphComponent.getGraph().isCellDisconnectable(state.getCell(),terminal,source)) ? mxSwingConstants.CONNECT_HANDLE_FILLCOLOR : mxSwingConstants.LOCKED_HANDLE_FILLCOLOR;
    }
  }
  return super.getHandleFillColor(index);
}
