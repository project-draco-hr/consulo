{
  if (!listOwner.isValid())   return false;
  if (listOwner instanceof PsiParameter) {
    PsiAnnotation[] paramAnnotations=((PsiParameter)listOwner).getAnnotations();
    for (    PsiAnnotation annotation : paramAnnotations) {
      if (annotationFQN.equals(annotation.getQualifiedName())) {
        return true;
      }
    }
  }
 else {
    final PsiModifierList modifierList=listOwner.getModifierList();
    if (modifierList == null) {
      return false;
    }
    PsiAnnotation annotation=modifierList.findAnnotation(annotationFQN);
    if (annotation != null)     return true;
  }
  if (!skipExternal && ExternalAnnotationsManager.getInstance(listOwner.getProject()).findExternalAnnotation(listOwner,annotationFQN) != null) {
    return true;
  }
  if (checkHierarchy && listOwner instanceof PsiMethod) {
    PsiMethod method=(PsiMethod)listOwner;
    if (processed == null)     processed=new THashSet<PsiMethod>();
    if (!processed.add(method))     return false;
    final PsiMethod[] superMethods=method.findSuperMethods();
    for (    PsiMethod superMethod : superMethods) {
      if (isAnnotated(superMethod,annotationFQN,checkHierarchy,skipExternal,processed))       return true;
    }
  }
  return false;
}
