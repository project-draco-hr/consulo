{
  assertIsDispatchThread();
  if (isFoldingEnabled()) {
    if (!myIsBatchFoldingProcessing) {
      LOG.error("Fold regions must be added or removed inside batchFoldProcessing() only.");
      return false;
    }
    myFoldRegionsProcessed=true;
    if (myFoldTree.addRegion(region)) {
      final FoldingGroup group=region.getGroup();
      if (group != null) {
        myGroups.putValue(group,region);
      }
      return true;
    }
  }
  return false;
}
