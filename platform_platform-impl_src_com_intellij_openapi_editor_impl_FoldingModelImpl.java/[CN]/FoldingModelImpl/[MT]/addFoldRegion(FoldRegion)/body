{
  assertIsDispatchThread();
  if (!isFoldingEnabled()) {
    return false;
  }
  if (!myIsBatchFoldingProcessing) {
    LOG.error("Fold regions must be added or removed inside batchFoldProcessing() only.");
    return false;
  }
  myFoldRegionsProcessed=true;
  if (myFoldTree.addRegion(region)) {
    final FoldingGroup group=region.getGroup();
    if (group != null) {
      myGroups.putValue(group,region);
      for (      FoldingListener listener : myListeners) {
        listener.onFoldRegionStateChange(region);
      }
    }
    return true;
  }
  return false;
}
