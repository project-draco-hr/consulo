{
  if (myShowNewNameField) {
    String newName=getNewName();
    if (newName.length() == 0) {
      Messages.showMessageDialog(myProject,RefactoringBundle.message("no.new.name.specified"),RefactoringBundle.message("error.title"),Messages.getErrorIcon());
      return;
    }
  }
  if (myShowDirectoryField) {
    final String targetDirectoryName=myTargetDirectoryField.getText();
    if (targetDirectoryName.length() == 0) {
      Messages.showMessageDialog(myProject,RefactoringBundle.message("no.target.directory.specified"),RefactoringBundle.message("error.title"),Messages.getErrorIcon());
      return;
    }
    RecentsManager.getInstance(myProject).registerRecentEntry(RECENT_KEYS,targetDirectoryName);
    CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
      public void run(){
        ApplicationManager.getApplication().runWriteAction(new Runnable(){
          public void run(){
            try {
              myTargetDirectory=DirectoryUtil.mkdirs(PsiManager.getInstance(myProject),targetDirectoryName.replace(File.separatorChar,'/'));
            }
 catch (            IncorrectOperationException e) {
            }
          }
        }
);
      }
    }
,RefactoringBundle.message("create.directory"),null);
    if (myTargetDirectory == null) {
      Messages.showMessageDialog(myProject,RefactoringBundle.message("cannot.create.directory"),RefactoringBundle.message("error.title"),Messages.getErrorIcon());
      return;
    }
  }
  super.doOKAction();
}
