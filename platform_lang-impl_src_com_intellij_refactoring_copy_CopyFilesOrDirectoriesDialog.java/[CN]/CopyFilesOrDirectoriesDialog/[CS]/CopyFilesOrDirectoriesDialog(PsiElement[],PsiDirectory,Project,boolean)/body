{
  super(project,true);
  myProject=project;
  myShowDirectoryField=!doClone;
  myShowNewNameField=elements.length == 1;
  if (doClone && elements.length != 1) {
    throw new IllegalArgumentException("wrong number of elements to clone: " + elements.length);
  }
  setTitle(doClone ? RefactoringBundle.message("copy.files.clone.title") : RefactoringBundle.message("copy.files.copy.title"));
  init();
  if (elements.length == 1) {
    String text;
    if (elements[0] instanceof PsiFile) {
      PsiFile file=(PsiFile)elements[0];
      text=doClone ? RefactoringBundle.message("copy.files.clone.file.0",file.getVirtualFile().getPresentableUrl()) : RefactoringBundle.message("copy.files.copy.file.0",file.getVirtualFile().getPresentableUrl());
      final String fileName=file.getName();
      myNewNameField.setText(fileName);
      final int dotIdx=fileName.lastIndexOf(".");
      if (dotIdx > -1) {
        myNewNameField.select(0,dotIdx);
        myNewNameField.putClientProperty(DialogWrapperPeerImpl.HAVE_INITIAL_SELECTION,true);
      }
    }
 else {
      PsiDirectory directory=(PsiDirectory)elements[0];
      text=doClone ? RefactoringBundle.message("copy.files.clone.directory.0",directory.getVirtualFile().getPresentableUrl()) : RefactoringBundle.message("copy.files.copy.directory.0",directory.getVirtualFile().getPresentableUrl());
      myNewNameField.setText(directory.getName());
    }
    myInformationLabel.setText(text);
  }
 else {
    setMultipleElementCopyLabel(elements);
  }
  if (myShowDirectoryField) {
    myTargetDirectoryField.prependItem(defaultTargetDirectory == null ? "" : defaultTargetDirectory.getVirtualFile().getPresentableUrl());
  }
  validateOKButton();
}
