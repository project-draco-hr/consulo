{
  Document document=myEditor.getDocument();
  if (myLineWrapPositionStrategy == null) {
    myLineWrapPositionStrategy=LanguageLineWrapPositionStrategy.INSTANCE.forEditor(myEditor);
  }
  int softWrapOffset=myLineWrapPositionStrategy.calculateWrapPosition(document.getCharsSequence(),minOffset,maxOffset,preferredOffset,minOffset != preferredOffset);
  if (softWrapOffset >= lineData.endLineOffset) {
    return null;
  }
  int indent=0;
  if (myCustomIndentUsedLastTime) {
    indent=myCustomIndentValueUsedLastTime;
  }
  SoftWrapImpl softWrap=new SoftWrapImpl(new TextChangeImpl("\n" + StringUtil.repeatSymbol(' ',lineData.indentInColumns + indent),softWrapOffset,softWrapOffset),lineData.indentInColumns + indent + 1,lineData.indentInPixels + (indent * spaceSize) + myPainter.getMinDrawingWidth(SoftWrapDrawingType.AFTER_SOFT_WRAP));
  myStorage.storeOrReplace(softWrap,true);
  return softWrap;
}
