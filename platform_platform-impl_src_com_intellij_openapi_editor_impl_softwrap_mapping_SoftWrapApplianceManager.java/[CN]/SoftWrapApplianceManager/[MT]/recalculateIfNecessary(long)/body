{
  if (myInProgress) {
    return;
  }
  boolean indentChanged=false;
  IndentType currentIndentType=getIndentToUse();
  boolean useCustomIndent=currentIndentType == IndentType.CUSTOM;
  int currentCustomIndent=myEditor.getSettings().getCustomSoftWrapIndent();
  if (useCustomIndent ^ myCustomIndentUsedLastTime || (useCustomIndent && myCustomIndentValueUsedLastTime != currentCustomIndent)) {
    indentChanged=true;
  }
  myCustomIndentUsedLastTime=useCustomIndent;
  myCustomIndentValueUsedLastTime=currentCustomIndent;
  int currentVisibleAreaWidth=myWidthProvider.getVisibleAreaWidth();
  if (!indentChanged && myVisibleAreaWidth == currentVisibleAreaWidth && documentStamp == myLastDocumentStamp) {
    recalculateSoftWraps();
    return;
  }
  myEventsStorage.release();
  myEventsStorage.add(myEditor.getDocument(),new IncrementalCacheUpdateEvent(myEditor.getDocument()));
  myStorage.removeAll();
  myVisibleAreaWidth=currentVisibleAreaWidth;
  recalculateSoftWraps();
}
