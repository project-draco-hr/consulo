{
  while (myContext.currentPosition.offset < myContext.tokenEndOffset) {
    int offset=myContext.currentPosition.offset;
    if (offset > myContext.rangeEndOffset) {
      return;
    }
    if (myContext.delayedSoftWrap != null && myContext.delayedSoftWrap.getStart() == offset) {
      processSoftWrap(myContext.delayedSoftWrap);
      myContext.delayedSoftWrap=null;
    }
    char c=myContext.text.charAt(offset);
    if (c == '\n') {
      myContext.onNewLine();
      continue;
    }
    if (myContext.skipToLineEnd) {
      myContext.skipToLineEnd=false;
      createSoftWrapIfPossible();
      continue;
    }
    int newX=offsetToX(offset,c);
    if (myContext.exceedsVisualEdge(newX) && myContext.delayedSoftWrap == null) {
      createSoftWrapIfPossible();
    }
 else {
      myContext.onNonLineFeedSymbol(c,newX);
    }
  }
}
