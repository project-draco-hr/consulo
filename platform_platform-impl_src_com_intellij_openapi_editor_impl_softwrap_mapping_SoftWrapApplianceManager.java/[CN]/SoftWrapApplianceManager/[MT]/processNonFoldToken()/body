{
  int newX;
  while (myContext.currentPosition.offset < myContext.tokenEndOffset) {
    int offset=myContext.currentPosition.offset;
    if (offset > myContext.rangeEndOffset) {
      return;
    }
    if (myContext.delayedSoftWrap != null && myContext.delayedSoftWrap.getStart() == offset) {
      processSoftWrap(myContext.delayedSoftWrap);
      myContext.delayedSoftWrap=null;
    }
    char c=myContext.text.charAt(offset);
    if (c == '\n') {
      notifyListenersOnVisualLineEnd();
      myContext.onNewLine();
      continue;
    }
    if (myOffset2widthInPixels.end > offset && (myOffset2widthInPixels.anchor + myOffset2widthInPixels.end > offset) && myContext.currentPosition.symbol != '\t') {
      newX=myContext.currentPosition.x + myOffset2widthInPixels.data[offset - myOffset2widthInPixels.anchor];
    }
 else {
      newX=calculateNewX(c);
    }
    if (myContext.exceedsVisualEdge(newX) && myContext.delayedSoftWrap == null) {
      createSoftWrapIfPossible();
    }
 else {
      myContext.onNonLineFeedSymbol(c,newX);
    }
  }
}
