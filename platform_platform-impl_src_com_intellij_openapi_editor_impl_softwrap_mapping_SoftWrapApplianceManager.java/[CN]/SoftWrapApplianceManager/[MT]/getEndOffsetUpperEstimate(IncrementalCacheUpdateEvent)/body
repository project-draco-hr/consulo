{
  int endOffsetUpperEstimate=EditorUtil.getNotFoldedLineEndOffset(myEditor,event.getMandatoryEndOffset());
  int line=myEditor.getDocument().getLineNumber(endOffsetUpperEstimate);
  if (line < myEditor.getDocument().getLineCount() - 1) {
    endOffsetUpperEstimate=myEditor.getDocument().getLineStartOffset(line + 1);
  }
  return endOffsetUpperEstimate;
}
