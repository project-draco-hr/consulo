{
  int initialAnchor=myOffset2fontType.anchor;
  int initialLength=myOffset2fontType.data.length;
  int newLength=start - end;
  if (myOffset2fontType.anchor > 0) {
    newLength+=myOffset2fontType.end;
  }
 else {
    myOffset2fontType.anchor=start;
  }
  if (newLength > myOffset2fontType.data.length) {
    int[] newData=new int[newLength];
    System.arraycopy(myOffset2fontType.data,0,newData,0,myOffset2fontType.end);
    myOffset2fontType.data=newData;
  }
  for (int i=start, counter=0; i < end; i++, counter++) {
    if (i - myOffset2fontType.anchor >= myOffset2fontType.data.length) {
      LOG.error(String.format("Invalid soft wraps processing detected during filling 'offset -> font' mappings. Data array length: initial=%d, current=%d; " + "anchor: initial=%d, current=%d; data array end=%d; offset: start=%d, end=%d, current=%d; document='%s'",initialLength,myOffset2fontType.data.length,initialAnchor,myOffset2fontType.anchor,myOffset2fontType.end,start,end,i,myEditor.getDocument().getCharsSequence()));
    }
    myOffset2fontType.data[i - myOffset2fontType.anchor]=fontType;
    char c=text.charAt(i);
    if (c == '\n' || counter >= STORAGE_SEGMENT_SIZE) {
      myOffset2fontType.end=i - myOffset2fontType.anchor;
      return;
    }
  }
  myOffset2fontType.end=end - myOffset2fontType.anchor;
}
