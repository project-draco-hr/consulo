{
  Document document=myEditor.getDocument();
  int startLineOffset;
  if (logicalLine >= document.getLineCount()) {
    startLineOffset=endLineOffset=document.getTextLength();
  }
 else {
    startLineOffset=document.getLineStartOffset(logicalLine);
    endLineOffset=document.getLineEndOffset(logicalLine);
  }
  CharSequence text=document.getCharsSequence();
  indentInColumns=0;
  indentInPixels=0;
  nonWhiteSpaceSymbolOffset=-1;
  for (int i=startLineOffset; i < endLineOffset; i++) {
    char c=text.charAt(i);
switch (c) {
case ' ':
      indentInColumns+=1;
    indentInPixels+=spaceWidth;
  break;
case '\t':
int x=EditorUtil.nextTabStop(indentInPixels,editor);
indentInColumns+=calculateWidthInColumns(c,x - indentInPixels,spaceWidth);
indentInPixels=x;
break;
default :
nonWhiteSpaceSymbolOffset=i;
return;
}
}
}
