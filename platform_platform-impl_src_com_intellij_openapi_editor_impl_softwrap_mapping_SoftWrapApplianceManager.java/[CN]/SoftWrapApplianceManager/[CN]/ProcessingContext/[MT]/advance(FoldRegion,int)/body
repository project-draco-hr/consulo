{
  lastFoldStartPosition=currentPosition.clone();
  lastFold=foldRegion;
  int visualLineBefore=currentPosition.visualLine;
  int logicalLineBefore=currentPosition.logicalLine;
  int logicalColumnBefore=currentPosition.logicalColumn;
  currentPosition.advance(foldRegion,-1);
  currentPosition.x+=placeHolderWidthInPixels;
  int collapsedFoldingWidthInColumns=currentPosition.logicalColumn;
  if (currentPosition.logicalLine <= logicalLineBefore) {
    collapsedFoldingWidthInColumns=currentPosition.logicalColumn - logicalColumnBefore;
  }
 else {
    final DocumentEx document=myEditor.getDocument();
    int endFoldLine=document.getLineNumber(foldRegion.getEndOffset());
    logicalLineData.endLineOffset=document.getLineEndOffset(endFoldLine);
  }
  notifyListenersOnFoldRegion(foldRegion,collapsedFoldingWidthInColumns,visualLineBefore);
  tokenStartOffset=myContext.currentPosition.offset;
  softWrapStartOffset=foldRegion.getEndOffset();
  lastFoldEndPosition=currentPosition.clone();
}
