{
  notifyListenersOnVisualLineEnd();
  currentPosition.onNewLine();
  softWrapStartOffset=currentPosition.offset;
  lastFoldStartPosition=null;
  lastFoldEndPosition=null;
  lastFold=null;
  lineStartPosition.from(currentPosition);
  logicalLineData.update(currentPosition.logicalLine,getSpaceWidth(),myEditor);
  fontType=myOffset2fontType.get(currentPosition.offset);
  myOffset2fontType.clear();
  myOffset2widthInPixels.clear();
}
