{
  if (!myRecalculateEnd) {
    return;
  }
  Document document=myEditor.getDocument();
  int startLine=document.getLineNumber(endRange.getStartOffset());
  int endLine=document.getLineNumber(endRange.getEndOffset());
  int endOffset=document.getLineEndOffset(endLine);
  int textLength=document.getTextLength();
  if (textLength > 0 && endOffset > textLength) {
    endOffset=textLength - 1;
  }
  endRange=new TextRange(document.getLineStartOffset(startLine),endOffset);
}
