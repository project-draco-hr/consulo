{
  final boolean opaque=rComponent.isOpaque();
  if (rComponent instanceof JComponent) {
    ((JComponent)rComponent).setOpaque(true);
  }
  if (myComponent.isRowSelected(key)) {
    rComponent.setBackground(myComponent.hasFocus() ? UIUtil.getTreeSelectionBackground() : UIUtil.getListUnfocusedSelectionBackground());
  }
 else {
    Color bg=UIUtil.getTreeTextBackground();
    if (myComponent instanceof Tree && ((Tree)myComponent).isFileColorsEnabled()) {
      final Color color=((Tree)myComponent).getFileColorForPath(myComponent.getPathForRow(key));
      if (color != null) {
        bg=color;
      }
    }
    rComponent.setBackground(bg);
  }
  super.doPaintTooltipImage(rComponent,cellBounds,height,g,key);
  if (rComponent instanceof JComponent) {
    ((JComponent)rComponent).setOpaque(opaque);
  }
}
