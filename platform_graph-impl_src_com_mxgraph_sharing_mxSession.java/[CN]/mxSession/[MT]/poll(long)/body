{
  lastTimeMillis=System.currentTimeMillis();
  StringBuffer result=new StringBuffer("<message>");
synchronized (this) {
    if (buffer.length() == 0) {
      wait(timeout);
    }
    if (buffer.length() > 0) {
      result.append("<delta>");
      result.append(buffer.toString());
      result.append("</delta>");
      buffer=new StringBuffer();
    }
    notify();
  }
  result.append("</message>");
  return result.toString();
}
