{
  if (!isValid())   return;
  final PsiFile origFile=(PsiFile)myNewFile.getUserData(FileContextUtil.INJECTED_IN_ELEMENT).getElement();
  if (!myReleased)   myOrigDocument.removeDocumentListener(this);
  try {
    new WriteCommandAction.Simple(myProject,origFile){
      @Override protected void run() throws Throwable {
        PostprocessReformattingAspect.getInstance(myProject).disablePostprocessFormattingInside(new Runnable(){
          @Override public void run(){
            commitToOriginalInner();
          }
        }
);
      }
    }
.execute();
  }
  finally {
    if (!myReleased)     myOrigDocument.addDocumentListener(this);
  }
}
