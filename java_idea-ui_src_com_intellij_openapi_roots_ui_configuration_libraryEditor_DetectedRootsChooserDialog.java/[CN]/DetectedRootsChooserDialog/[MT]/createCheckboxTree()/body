{
  CheckboxTree tree=new CheckboxTree(new CheckboxTree.CheckboxTreeCellRenderer(true){
    public void customizeRenderer(    JTree tree,    Object value,    boolean selected,    boolean expanded,    boolean leaf,    int row,    boolean hasFocus){
      if (!(value instanceof CheckedTreeNode))       return;
      CheckedTreeNode node=(CheckedTreeNode)value;
      final Object userObject=node.getUserObject();
      VirtualFile file;
      if (userObject instanceof SuggestedChildRootInfo) {
        file=((SuggestedChildRootInfo)userObject).getSuggestedRoot();
      }
 else       if (userObject instanceof VirtualFile) {
        file=(VirtualFile)userObject;
      }
 else {
        return;
      }
      String text;
      SimpleTextAttributes attributes;
      Icon icon;
      boolean isValid=true;
      if (leaf) {
        VirtualFile ancestor=(VirtualFile)((CheckedTreeNode)node.getParent()).getUserObject();
        if (ancestor != null) {
          text=VfsUtilCore.getRelativePath(file,ancestor,File.separatorChar);
        }
 else {
          text=file.getPresentableUrl();
        }
        if (text == null) {
          isValid=false;
          text=file.getPresentableUrl();
        }
        attributes=SimpleTextAttributes.REGULAR_ATTRIBUTES;
        icon=PlatformIcons.DIRECTORY_CLOSED_ICON;
      }
 else {
        text=file.getPresentableUrl();
        if (text == null) {
          isValid=false;
        }
        attributes=SimpleTextAttributes.REGULAR_BOLD_ATTRIBUTES;
        icon=expanded ? PlatformIcons.DIRECTORY_OPEN_ICON : PlatformIcons.DIRECTORY_CLOSED_ICON;
      }
      final ColoredTreeCellRenderer textRenderer=getTextRenderer();
      textRenderer.setIcon(icon);
      if (!isValid) {
        textRenderer.append("[INVALID] ",SimpleTextAttributes.ERROR_ATTRIBUTES);
      }
      if (text != null) {
        textRenderer.append(text,attributes);
      }
    }
  }
,myRootNode);
  tree.setRootVisible(false);
  TreeUtil.expandAll(tree);
  return tree;
}
