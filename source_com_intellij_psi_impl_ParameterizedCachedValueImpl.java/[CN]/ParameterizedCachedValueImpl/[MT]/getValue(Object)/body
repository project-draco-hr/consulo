{
  r.lock();
  T value;
  try {
    value=getUpToDateOrNull();
    if (value != null) {
      return value == NULL ? null : value;
    }
  }
  finally {
    r.unlock();
  }
  w.lock();
  try {
    value=getUpToDateOrNull();
    if (value != null) {
      return value == NULL ? null : value;
    }
    CachedValueProvider.Result<T> result=myProvider.compute(param);
    value=result == null ? null : result.getValue();
    setValue(value,result);
    return value;
  }
  finally {
    w.unlock();
  }
}
