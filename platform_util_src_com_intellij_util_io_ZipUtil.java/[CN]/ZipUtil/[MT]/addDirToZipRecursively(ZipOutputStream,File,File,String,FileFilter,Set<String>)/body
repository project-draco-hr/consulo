{
  if (jarFile != null && FileUtil.isAncestor(dir,jarFile,false)) {
    return false;
  }
  if (relativePath.length() != 0) {
    addFileToZip(outputStream,dir,relativePath,writtenItemRelativePaths,fileFilter);
  }
  final File[] children=dir.listFiles();
  if (children != null) {
    for (    File child : children) {
      final String childRelativePath=(relativePath.length() == 0 ? "" : relativePath + "/") + child.getName();
      addFileOrDirRecursively(outputStream,jarFile,child,childRelativePath,fileFilter,writtenItemRelativePaths);
    }
  }
  return true;
}
