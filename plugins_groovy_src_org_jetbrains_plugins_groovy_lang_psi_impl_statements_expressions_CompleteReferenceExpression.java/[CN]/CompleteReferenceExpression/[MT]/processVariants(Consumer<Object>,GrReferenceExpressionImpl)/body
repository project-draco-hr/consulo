{
  final GrExpression qualifier=refExpr.getQualifierExpression();
  Object[] propertyVariants=getVariantsImpl(refExpr,CompletionProcessor.createPropertyCompletionProcessor(refExpr));
  PsiType type=null;
  if (qualifier != null) {
    type=qualifier.getType();
  }
  if (type instanceof PsiClassType) {
    final PsiClassType.ClassResolveResult resolveResult=((PsiClassType)type).resolveGenerics();
    PsiClass clazz=resolveResult.getElement();
    if (clazz != null) {
      Set<String> accessedPropertyNames=processPropertyVariants(consumer,refExpr,clazz,resolveResult.getSubstitutor());
      for (      Object variant : propertyVariants) {
        if (variant instanceof PsiField && accessedPropertyNames.contains(((PsiField)variant).getName())) {
          continue;
        }
 else         if (variant instanceof LookupElement) {
          final Object o=((LookupElement)variant).getObject();
          if (o instanceof PsiField && accessedPropertyNames.contains(((PsiField)o).getName())) {
            continue;
          }
        }
        consumer.consume(variant);
      }
    }
  }
 else {
    for (    Object variant : propertyVariants) {
      consumer.consume(variant);
    }
  }
  if (refExpr.getKind() == GrReferenceExpressionImpl.Kind.TYPE_OR_PROPERTY) {
    ResolverProcessor classVariantsCollector=CompletionProcessor.createClassCompletionProcessor(refExpr);
    final Object[] classVariants=getVariantsImpl(refExpr,classVariantsCollector);
    for (    Object variant : classVariants) {
      consumer.consume(variant);
    }
  }
}
