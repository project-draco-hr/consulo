{
  PsiElement refParent=refExpr.getParent();
  processArgsVariants(consumer,refParent);
  final GrExpression qualifier=refExpr.getQualifierExpression();
  Object[] propertyVariants=getVariantsImpl(refExpr,CompletionProcessor.createPropertyCompletionProcessor(refExpr));
  PsiType type=null;
  if (qualifier == null) {
    if (refParent instanceof GrArgumentList) {
      final PsiElement argList=refParent.getParent();
      if (argList instanceof GrExpression) {
        GrExpression call=(GrExpression)argList;
        type=call.getType();
      }
    }
  }
 else {
    type=qualifier.getType();
  }
  if (type instanceof PsiClassType) {
    PsiClass clazz=((PsiClassType)type).resolve();
    if (clazz != null) {
      Set<String> accessedPropertyNames=processPropertyVariants(consumer,refExpr,clazz);
      for (      Object variant : propertyVariants) {
        if (variant instanceof PsiField && accessedPropertyNames.contains(((PsiField)variant).getName())) {
          continue;
        }
        consumer.consume(variant);
      }
    }
  }
 else {
    for (    Object variant : propertyVariants) {
      consumer.consume(variant);
    }
  }
  if (refExpr.getKind() == GrReferenceExpressionImpl.Kind.TYPE_OR_PROPERTY) {
    ResolverProcessor classVariantsCollector=CompletionProcessor.createClassCompletionProcessor(refExpr);
    final Object[] classVariants=getVariantsImpl(refExpr,classVariantsCollector);
    for (    Object variant : classVariants) {
      consumer.consume(variant);
    }
  }
}
