{
  final PsiFile containingFile=refExpr.getContainingFile();
  final PsiFile originalFile=containingFile.getOriginalFile();
  if (originalFile == null) {
    return propertyVariants;
  }
  final VirtualFile virtualFile=originalFile.getVirtualFile();
  if (virtualFile == null) {
    return propertyVariants;
  }
  Module module=ProjectRootManager.getInstance(refExpr.getProject()).getFileIndex().getModuleForFile(virtualFile);
  if (module == null) {
    return propertyVariants;
  }
  String[] dynamicPropertiesOfClass;
  if (type == null) {
    return propertyVariants;
  }
  dynamicPropertiesOfClass=DynamicManager.getInstance(refExpr.getProject()).getPropertiesNamesOfClass(type.getCanonicalText());
  if (type instanceof PsiClassType) {
    final PsiClass psiClass=((PsiClassType)type).resolve();
    if (psiClass == null) {
      return propertyVariants;
    }
    final Iterable<PsiClass> supers=GroovyUtils.findAllSupers(psiClass,new HashSet<PsiClassType>());
    if (dynamicPropertiesOfClass.length != 0) {
      propertyVariants=ArrayUtil.mergeArrays(propertyVariants,dynamicPropertiesOfClass,Object.class);
    }
    for (    PsiClass aSuper : supers) {
      dynamicPropertiesOfClass=DynamicManager.getInstance(refExpr.getProject()).getPropertiesNamesOfClass(aSuper.getQualifiedName());
      propertyVariants=ArrayUtil.mergeArrays(propertyVariants,dynamicPropertiesOfClass,Object.class);
    }
  }
  return propertyVariants;
}
