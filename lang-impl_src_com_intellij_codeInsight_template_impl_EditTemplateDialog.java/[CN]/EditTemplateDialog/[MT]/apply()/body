{
  updateVariablesByTemplateText();
  myTemplate.setKey(myKeyField.getText().trim());
  myTemplate.setDescription(myDescription.getText().trim());
  myTemplate.setGroupName(((String)myGroupCombo.getSelectedItem()).trim());
  Object selectedItem=myExpandByCombo.getSelectedItem();
  if (myDefaultShortcutItem.equals(selectedItem)) {
    myTemplate.setShortcutChar(TemplateSettings.DEFAULT_CHAR);
  }
 else   if (TAB.equals(selectedItem)) {
    myTemplate.setShortcutChar(TemplateSettings.TAB_CHAR);
  }
 else   if (ENTER.equals(selectedItem)) {
    myTemplate.setShortcutChar(TemplateSettings.ENTER_CHAR);
  }
 else {
    myTemplate.setShortcutChar(TemplateSettings.SPACE_CHAR);
  }
  myTemplate.removeAllParsed();
  for (  Object myVariable : myVariables) {
    Variable variable=(Variable)myVariable;
    myTemplate.addVariable(variable.getName(),variable.getExpressionString(),variable.getDefaultValueString(),variable.isAlwaysStopAt());
  }
  updateTemplateContext();
  myTemplate.setToReformat(myCbReformat.isSelected());
  for (  TemplateOptionalProcessor option : myCbOptionalProcessorMap.keySet()) {
    JCheckBox cb=myCbOptionalProcessorMap.get(option);
    myOptions.put(option,cb.isSelected());
  }
  myTemplate.setString(myTemplateEditor.getDocument().getText());
  myTemplate.parseSegments();
}
