{
  final Project project=field.getProject();
  final FileEditorManager fileEditorManager=FileEditorManager.getInstance(project);
  final Editor editor=fileEditorManager.getSelectedTextEditor();
  if (editor == null) {
    return;
  }
  field=CodeInsightUtilBase.forcePsiPostprocessAndRestoreElement(field);
  final TextRange range=field.getTextRange();
  final TemplateBuilder builder=new TemplateBuilder(field);
  builder.replaceElement(field.getNameIdentifier(),new ConstantNode(field.getName()));
  final Template template=builder.buildTemplate();
  final int startOffset=range.getStartOffset();
  final int endOffset=range.getEndOffset();
  editor.getDocument().replaceString(startOffset,endOffset,"");
  editor.getCaretModel().moveToOffset(startOffset);
  TemplateManager.getInstance(project).startTemplate(editor,template);
}
