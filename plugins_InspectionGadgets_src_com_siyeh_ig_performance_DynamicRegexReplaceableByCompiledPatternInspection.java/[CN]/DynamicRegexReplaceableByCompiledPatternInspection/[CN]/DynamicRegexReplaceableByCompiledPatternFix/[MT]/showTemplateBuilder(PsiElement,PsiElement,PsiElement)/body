{
  final Project project=context.getProject();
  final FileEditorManager fileEditorManager=FileEditorManager.getInstance(project);
  final Editor editor=fileEditorManager.getSelectedTextEditor();
  if (editor == null) {
    return;
  }
  final Document document=editor.getDocument();
  context=CodeInsightUtilBase.forcePsiPostprocessAndRestoreElement(context);
  final TemplateBuilder builder=new TemplateBuilder(context);
  final Expression macroCallNode=new MacroCallNode(new SuggestVariableNameMacro());
  builder.replaceElement(element,macroCallNode);
  for (  PsiElement psiElement : elements) {
    builder.replaceElement(psiElement,macroCallNode);
  }
  final Template template=builder.buildTemplate();
  final TextRange textRange=context.getTextRange();
  final int startOffset=textRange.getStartOffset();
  final int endOffset=textRange.getEndOffset();
  document.replaceString(startOffset,endOffset,"");
  editor.getCaretModel().moveToOffset(startOffset);
  TemplateManager.getInstance(project).startTemplate(editor,template);
}
