{
  final StringBuffer buf=new StringBuffer();
  if (refEntity instanceof RefElement) {
    final Runnable action=new Runnable(){
      public void run(){
        tool.getComposer().compose(buf,refEntity);
      }
    }
;
    ApplicationManager.getApplication().runReadAction(action);
  }
 else {
    tool.getComposer().compose(buf,refEntity);
  }
  uppercaseFirstLetter(buf);
  if (refEntity instanceof RefElement) {
    appendSuppressSection((RefElement)refEntity,buf);
  }
  insertHeaderFooter(buf);
  return buf.toString();
}
