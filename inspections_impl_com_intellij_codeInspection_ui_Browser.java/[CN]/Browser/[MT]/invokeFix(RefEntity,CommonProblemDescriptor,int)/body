{
  final QuickFix[] fixes=descriptor.getFixes();
  if (fixes != null && fixes.length > idx && fixes[idx] != null) {
    if (element instanceof RefElement) {
      PsiElement psiElement=((RefElement)element).getElement();
      if (psiElement != null && psiElement.isValid()) {
        if (!psiElement.isWritable()) {
          final ReadonlyStatusHandler.OperationStatus operationStatus=ReadonlyStatusHandler.getInstance(myView.getProject()).ensureFilesWritable(psiElement.getContainingFile().getVirtualFile());
          if (operationStatus.hasReadonlyFiles()) {
            return;
          }
        }
        ApplicationManager.getApplication().runWriteAction(new Runnable(){
          public void run(){
            Runnable command=new Runnable(){
              public void run(){
                CommandProcessor.getInstance().markCurrentCommandAsComplex(myView.getProject());
                if (descriptor instanceof ProblemDescriptor) {
                  ((LocalQuickFix)fixes[idx]).applyFix(myView.getProject(),(ProblemDescriptor)descriptor);
                }
 else {
                  ((GlobalQuickFix)fixes[idx]).applyFix();
                }
              }
            }
;
            CommandProcessor.getInstance().executeCommand(myView.getProject(),command,fixes[idx].getName(),null);
            final DescriptorProviderInspection tool=((DescriptorProviderInspection)myView.getTree().getSelectedTool());
            if (tool != null) {
              tool.ignoreProblem(element,descriptor,idx);
            }
            myView.updateView(false);
          }
        }
);
      }
    }
 else {
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          Runnable command=new Runnable(){
            public void run(){
              CommandProcessor.getInstance().markCurrentCommandAsComplex(myView.getProject());
              if (!(descriptor instanceof ProblemDescriptor)) {
                ((GlobalQuickFix)fixes[idx]).applyFix();
              }
            }
          }
;
          CommandProcessor.getInstance().executeCommand(myView.getProject(),command,fixes[idx].getName(),null);
          final DescriptorProviderInspection tool=((DescriptorProviderInspection)myView.getTree().getSelectedTool());
          if (tool != null) {
            tool.ignoreProblem(element,descriptor,idx);
          }
          myView.updateView(false);
        }
      }
);
    }
  }
}
