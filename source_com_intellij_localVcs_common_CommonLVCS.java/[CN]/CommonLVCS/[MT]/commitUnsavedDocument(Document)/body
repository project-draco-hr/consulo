{
  VirtualFile file=FileDocumentManager.getInstance().getFile(unsavedDocument);
  if (file == null || !file.isValid())   return;
  if (isUnderVcs(file)) {
    LvcsFile lvcsFile=findFile(file.getPath(),true);
    if (lvcsFile == null)     return;
    if (isOutsideOfProjectRoot(lvcsFile.getRevision()))     return;
    try {
      Charset charset=file.getCharset();
      LOG.assertTrue(charset != null);
      myImplementation.commitFile(lvcsFile.getRevision(),unsavedDocument.getText().getBytes(charset.name()));
    }
 catch (    UnsupportedEncodingException e) {
      LOG.error(e);
    }
  }
}
