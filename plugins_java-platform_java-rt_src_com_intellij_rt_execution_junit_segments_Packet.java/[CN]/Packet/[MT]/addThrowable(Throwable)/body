{
  String filteredTrace;
  try {
    filteredTrace=BaseTestRunner.getFilteredTrace(throwable);
  }
 catch (  Throwable e) {
    filteredTrace=BaseTestRunner.getFilteredTrace(e);
  }
  String message;
  try {
    message=BaseTestRunner.getPreference("filterstack").equals("true") ? makeNewLinesCompatibleWithJUnit(throwableToString(throwable)) : throwableToString(throwable);
  }
 catch (  Throwable e) {
    message=throwableToString(e);
  }
  addLimitedString(message);
  if (filteredTrace.startsWith(message))   filteredTrace=filteredTrace.substring(message.length());
  addLimitedString(new TraceFilter(filteredTrace).execute());
  return this;
}
