{
  tool.initialize(globalContext);
  ((RefManagerImpl)globalContext.getRefManager()).initializeAnnotators();
  if (tool.isGraphNeeded()) {
    ((RefManagerImpl)tool.getRefManager()).findAllDeclarations();
  }
  tool.runInspection(scope,inspectionManager);
  tool.queryExternalUsagesRequests(inspectionManager);
  do {
    ((GlobalJavaInspectionContextImpl)globalContext.getExtension(GlobalJavaInspectionContextImpl.CONTEXT)).processSearchRequests(globalContext);
  }
 while (tool.queryExternalUsagesRequests(inspectionManager));
}
