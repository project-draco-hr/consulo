{
  final String shortName=tool.getShortName();
  final HighlightDisplayKey key=HighlightDisplayKey.find(shortName);
  if (key == null) {
    HighlightDisplayKey.register(shortName);
  }
  tool.initialize(globalContext);
  ((RefManagerImpl)globalContext.getRefManager()).initializeAnnotators();
  if (tool.isGraphNeeded()) {
    ((RefManagerImpl)tool.getRefManager()).findAllDeclarations();
  }
  tool.runInspection(scope,inspectionManager);
  tool.queryExternalUsagesRequests(inspectionManager);
  final GlobalJavaInspectionContextImpl javaInspectionContext=(GlobalJavaInspectionContextImpl)globalContext.getExtension(GlobalJavaInspectionContextImpl.CONTEXT);
  if (javaInspectionContext != null) {
    do {
      javaInspectionContext.processSearchRequests(globalContext);
    }
 while (tool.queryExternalUsagesRequests(inspectionManager));
  }
}
