{
  if (!isFile(file))   return null;
  final CharSequence chars;
  try {
    chars=loadText(file);
  }
 catch (  IOException e) {
    return null;
  }
  String packageName=packageNameFetcher.fun(chars);
  if (packageName != null) {
    F root=getParentFile(file);
    int index=packageName.length();
    while (index > 0) {
      int index1=packageName.lastIndexOf('.',index - 1);
      String token=packageName.substring(index1 + 1,index);
      String dirName=getName(root);
      final boolean equalsToToken=SystemInfo.isFileSystemCaseSensitive ? dirName.equals(token) : dirName.equalsIgnoreCase(token);
      if (!equalsToToken || root.equals(topmostPossibleRoot)) {
        String packagePrefix=packageName.substring(0,index);
        if (!packagePrefixSupported && packagePrefix.length() > 0) {
          return null;
        }
        return Pair.create(root,packagePrefix);
      }
      root=getParentFile(root);
      if (root == null) {
        return null;
      }
      index=index1;
    }
    return Pair.create(root,"");
  }
  return null;
}
