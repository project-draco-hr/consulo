{
  final VcsConfiguration configuration=VcsConfiguration.getInstance(myProject);
  final Collection<VirtualFile> files=myPanel.getVirtualFiles();
  final Runnable performCheckoutAction=new Runnable(){
    public void run(){
      FileDocumentManager.getInstance().saveAllDocuments();
      finishAction.run();
    }
  }
;
  final Runnable reformatCodeAndPerformCheckout=new Runnable(){
    public void run(){
      if (reformat(configuration,true)) {
        new ReformatCodeProcessor(myProject,getPsiFiles(files),performCheckoutAction).run();
      }
 else {
        performCheckoutAction.run();
      }
    }
  }
;
  if (configuration.OPTIMIZE_IMPORTS_BEFORE_PROJECT_COMMIT) {
    new OptimizeImportsProcessor(myProject,getPsiFiles(files),reformatCodeAndPerformCheckout).run();
  }
 else {
    reformatCodeAndPerformCheckout.run();
  }
}
