{
  final Library library=getSelectedLibrary();
  if (library != null) {
    myDescriptor.setTitle(getTitle());
    myDescriptor.setDescription(getDescription());
    for (    Map.Entry<DataKey,Object> entry : myFileChooserUserData.entrySet()) {
      myDescriptor.putUserData(entry.getKey(),entry.getValue());
    }
    VirtualFile toSelect=getFileToSelect(library);
    final VirtualFile[] attachedFiles=attachFiles(library,scanForActualRoots(FileChooser.chooseFiles(myPanel,myDescriptor,toSelect)),getRootType(),addAsJarDirectories());
    if (attachedFiles.length > 0) {
      myLastChosen=attachedFiles[0];
    }
  }
  fireLibrariesChanged();
  myTree.requestFocus();
}
