{
  myDetectedFacetSet=detectedFacetSet;
  myProjectWideFacetListenersRegistry=ProjectWideFacetListenersRegistry.getInstance(project);
  myProject=project;
  myAutodetectingManager=autodetectingManager;
  myDetectedFacetSet.addListener(new ProjectFacetInfoSet.DetectedFacetListener(){
    public void facetDetected(    final DetectedFacetInfo<Module> info){
      onDetectedFacetChanged(Collections.singletonList(info),Collections.<DetectedFacetInfo<Module>>emptyList());
    }
    public void facetRemoved(    final DetectedFacetInfo<Module> info){
      myAutodetectingManager.getFileIndex().removeFromIndex(info);
      onDetectedFacetChanged(Collections.<DetectedFacetInfo<Module>>emptyList(),Collections.singletonList(info));
    }
  }
);
  Disposer.register(myProject,this);
  myProject.getMessageBus().connect().subscribe(ProjectTopics.MODULES,new ModuleAdapter(){
    @Override public void moduleRemoved(    final Project project,    final Module module){
      myDetectedFacetSet.removeDetectedFacets(module);
    }
  }
);
}
