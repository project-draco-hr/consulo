{
  final IdeaPluginDescriptor[] plugins=PluginManager.getPlugins();
  final List<IdeaPluginDescriptor> nonBundledEnabledPlugins=ContainerUtil.filter(plugins,new Condition<IdeaPluginDescriptor>(){
    public boolean value(    final IdeaPluginDescriptor d){
      return d.isEnabled() && !d.isBundled() && d.getPluginId() != null;
    }
  }
);
  return ContainerUtil.map2Set(nonBundledEnabledPlugins,new Function<IdeaPluginDescriptor,UsageDescriptor>(){
    @Override public UsageDescriptor fun(    IdeaPluginDescriptor descriptor){
      return new UsageDescriptor(descriptor.getPluginId().getIdString(),1);
    }
  }
);
}
