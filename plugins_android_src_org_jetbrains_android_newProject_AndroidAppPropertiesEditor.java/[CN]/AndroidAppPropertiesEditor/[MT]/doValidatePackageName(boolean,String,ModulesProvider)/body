{
  if (candidate.length() == 0) {
    return AndroidBundle.message("specify.package.name.error");
  }
  if (!isValidPackageName(candidate)) {
    return AndroidBundle.message("not.valid.package.name.error",candidate);
  }
  if (!AndroidCommonUtils.contains2Identifiers(candidate)) {
    return AndroidBundle.message("package.name.must.contain.2.ids.error");
  }
  if (!library) {
    for (    Module module : modulesProvider.getModules()) {
      final AndroidFacet facet=AndroidFacet.getInstance(module);
      if (facet != null && !facet.getConfiguration().LIBRARY_PROJECT) {
        final Manifest manifest=facet.getManifest();
        if (manifest != null) {
          final String packageName=manifest.getPackage().getValue();
          if (candidate.equals(packageName)) {
            return "Package name '" + packageName + "' is already used by module '"+ module.getName()+ "'";
          }
        }
      }
    }
  }
  return "";
}
