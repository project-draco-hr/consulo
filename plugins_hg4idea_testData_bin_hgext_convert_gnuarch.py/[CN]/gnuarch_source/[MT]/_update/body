def _update(self, rev):
    self.ui.debug(('applying revision %s...\n' % rev))
    (changeset, status) = self.runlines('replay', '-d', self.tmppath, rev)
    if status:
        shutil.rmtree(self.tmppath, ignore_errors=True)
        self._obtainrevision(rev)
    else:
        old_rev = self.parents[rev][0]
        self.ui.debug(('computing changeset between %s and %s...\n' % (old_rev, rev)))
        self._parsechangeset(changeset, rev)
