def before(self):
    self.archives = [i.rstrip('\n') for i in self.runlines0('archives', '-n')]
    if (self.execmd == 'tla'):
        output = self.run0('tree-version', self.path)
    else:
        output = self.run0('tree-version', '-d', self.path)
    self.treeversion = output.strip()
    version = self.treeversion.split('/')
    self.tmppath = os.path.join(tempfile.gettempdir(), ('hg-%s' % version[1]))
    self.parents[None] = []
    treeversion = self.treeversion
    child = None
    while treeversion:
        self.ui.status((_('analyzing tree version %s...\n') % treeversion))
        archive = treeversion.split('/')[0]
        if (archive not in self.archives):
            self.ui.status((_('tree analysis stopped because it points to an unregistered archive %s...\n') % archive))
            break
        (output, status) = self.runlines('revisions', '-r', '-f', treeversion)
        self.checkexit(status, ('failed retrieveing revisions for %s' % treeversion))
        treeversion = None
        for l in output:
            rev = l.strip()
            self.changes[rev] = self.gnuarch_rev(rev)
            self.parents[rev] = []
            (catlog, status) = self.run('cat-log', '-d', self.path, rev)
            if status:
                catlog = self.run0('cat-archive-log', rev)
            self._parsecatlog(catlog, rev)
            self.parents[child].append(rev)
            child = rev
            if self.changes[rev].continuationof:
                treeversion = '--'.join(self.changes[rev].continuationof.split('--')[:(-1)])
                break
            if (rev[(-6):] == 'base-0'):
                break
