{
  LeafElement element=null;
  if (type == JAVA_FILE_TEXT) {
    element=new JavaFileChameleonElement(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type instanceof IXmlLeafElementType) {
    element=new XmlTokenImpl(type,buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == JSP_FILE_TEXT) {
    element=new JspFileChameleonElement(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == XML_FILE_TEXT) {
    element=new XmlFileChameleonElement(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == XHTML_FILE_TEXT) {
    element=new XHtmlFileChameleonElement(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == JSPX_FILE_TEXT) {
    element=new JspxFileChameleonElement(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == HTML_FILE_TEXT) {
    element=new HTMLFileChameleonElement(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == DTD_FILE_TEXT) {
    element=new DTDFileChameleonElement(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == IMPORT_LIST_TEXT) {
    element=new ImportListChameleonElement(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == CODE_BLOCK_TEXT) {
    element=new CodeBlockChameleonElement(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == DOC_COMMENT_TEXT) {
    element=new DocCommentChameleonElement(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == ASPECT_FILE_TEXT) {
    element=new AspectFileChameleonElement(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == EXPRESSION_TEXT) {
    element=new ExpressionChameleonElement(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == STATEMENTS) {
    element=new StatementsChameleonElement(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == TYPE_TEXT) {
    element=new TypeChameleonElement(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == REFERENCE_TEXT) {
    element=new ReferenceChameleonElement(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == PLAIN_TEXT) {
    element=new PsiPlainTextImpl(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == WHITE_SPACE) {
    element=new PsiWhiteSpaceImpl(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == C_STYLE_COMMENT || type == END_OF_LINE_COMMENT) {
    element=new PsiCommentImpl(type,buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == IDENTIFIER) {
    element=new PsiIdentifierImpl(buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == JavaDocTokenType.DOC_TYPE_TEXT) {
    element=new JavaDocReferenceChameleon(type,buffer,startOffset,endOffset,true,lexerState,table);
  }
 else   if (type == JavaDocTokenType.DOC_REFERENCE_TEXT) {
    element=new JavaDocReferenceChameleon(type,buffer,startOffset,endOffset,false,lexerState,table);
  }
 else   if (type == JspTokenType.JSP_IMPORT_ATTRIBUTE_CHAMELEON) {
    element=new JspImportAttributeChameleonElement(type,buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == JspElementType.JSP_DECLARATION_TEXT) {
    element=new JspDeclarationChameleonElement(type,buffer,startOffset,endOffset,lexerState,table);
  }
 else   if (type == JspElementType.HOLDER_TEMPLATE_DATA) {
    element=new JspText(null,buffer,startOffset,endOffset,table);
  }
 else {
    if (KEYWORD_BIT_SET.isInSet(type)) {
      element=new PsiKeywordImpl(type,buffer,startOffset,endOffset,lexerState,table);
    }
 else     if (type instanceof IJavaElementType) {
      element=new PsiJavaTokenImpl(type,buffer,startOffset,endOffset,lexerState,table);
    }
 else     if (type instanceof IJspElementType) {
      element=new JspTokenImpl(type,buffer,startOffset,endOffset,lexerState,table);
    }
 else     if (type instanceof IJavaDocElementType) {
      element=new PsiDocTokenImpl(type,buffer,startOffset,endOffset,lexerState,table);
    }
 else     if (type instanceof IAspectElementType) {
      element=com.intellij.aspects.psi.gen.impl.Factory.createLeafElement(type,buffer,startOffset,endOffset,table);
    }
 else {
      for (int size=ourElementFactories.size(), i=0; i < size; i++) {
        TreeElementFactory elementFactory=ourElementFactories.get(i);
        if (elementFactory.isMyElementType(type)) {
          element=elementFactory.createLeafElement(type,buffer,startOffset,endOffset,lexerState,table);
        }
      }
      if (element == null) {
        element=new LeafPsiElement(type,buffer,startOffset,endOffset,lexerState,table);
      }
    }
  }
  LOG.assertTrue(element.getElementType() == type);
  return element;
}
