{
  final TextFilePatch curPatch=new TextFilePatch(null);
  extractFileName(curLine,curPatch,true,myDiffCommandLike && myIndexLike);
  if (!iterator.hasNext())   throw new PatchSyntaxException(iterator.previousIndex(),"Second file name expected");
  curLine=iterator.next();
  String secondNamePrefix=myDiffFormat == DiffFormat.UNIFIED ? "+++ " : "--- ";
  if (!curLine.startsWith(secondNamePrefix)) {
    throw new PatchSyntaxException(iterator.previousIndex(),"Second file name expected");
  }
  extractFileName(curLine,curPatch,false,myDiffCommandLike && myIndexLike);
  while (iterator.hasNext()) {
    PatchHunk hunk;
    if (myDiffFormat == DiffFormat.UNIFIED) {
      hunk=readNextHunkUnified(iterator);
    }
 else {
      hunk=readNextHunkContext(iterator);
    }
    if (hunk == null)     break;
    curPatch.addHunk(hunk);
  }
  if (curPatch.getBeforeName() == null) {
    curPatch.setBeforeName(curPatch.getAfterName());
  }
  if (curPatch.getAfterName() == null) {
    curPatch.setAfterName(curPatch.getBeforeName());
  }
  return curPatch;
}
