{
  final TextFilePatch curPatch;
  curPatch=new TextFilePatch();
  extractFileName(curLine,curPatch,true);
  myLineIndex++;
  curLine=myLines[myLineIndex];
  String secondNamePrefix=myDiffFormat == DiffFormat.UNIFIED ? "+++ " : "--- ";
  if (!curLine.startsWith(secondNamePrefix)) {
    throw new PatchSyntaxException(myLineIndex,"Second file name expected");
  }
  extractFileName(curLine,curPatch,false);
  myLineIndex++;
  while (myLineIndex < myLines.length) {
    PatchHunk hunk;
    if (myDiffFormat == DiffFormat.UNIFIED) {
      hunk=readNextHunkUnified();
    }
 else {
      hunk=readNextHunkContext();
    }
    if (hunk == null)     break;
    curPatch.addHunk(hunk);
  }
  return curPatch;
}
