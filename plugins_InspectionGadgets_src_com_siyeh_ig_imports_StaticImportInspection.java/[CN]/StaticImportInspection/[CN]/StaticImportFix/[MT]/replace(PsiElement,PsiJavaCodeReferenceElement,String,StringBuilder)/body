{
  if (element.equals(reference)) {
    out.append(newReferenceText);
    return out;
  }
  final PsiElement[] children=element.getChildren();
  if (children.length == 0) {
    out.append(element.getText());
    return out;
  }
  for (  PsiElement child : children) {
    replace(child,reference,newReferenceText,out);
  }
  return out;
}
