{
  PsiElement refElement=expression.resolve();
  if (!(refElement instanceof PsiVariable)) {
    myIsConstant=false;
    return;
  }
  PsiVariable variable=(PsiVariable)refElement;
  Boolean isConst=varIsConst.get(variable);
  if (isConst != null) {
    myIsConstant&=isConst.booleanValue();
    return;
  }
  if (variable instanceof PsiEnumConstant) {
    myIsConstant=true;
    varIsConst.put(variable,Boolean.TRUE);
    return;
  }
  varIsConst.put(variable,Boolean.FALSE);
  if (variable.computeConstantValue() != null) {
    myIsConstant=true;
    varIsConst.put(variable,Boolean.TRUE);
    return;
  }
  if (!variable.hasModifierProperty(PsiModifier.FINAL)) {
    myIsConstant=false;
    return;
  }
  PsiExpression initializer=variable.getInitializer();
  if (initializer == null) {
    myIsConstant=false;
    return;
  }
  initializer.accept(this);
  varIsConst.put(variable,Boolean.valueOf(myIsConstant));
}
