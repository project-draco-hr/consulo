{
  try {
    if (path.isDirectory()) {
      stClient.doStatus(path.getIOFile(),recursively,false,false,false,new ISVNStatusHandler(){
        public void handleStatus(        SVNStatus status) throws SVNException {
          processStatus(VcsUtil.getFilePath(status.getFile(),status.getKind().equals(SVNNodeKind.DIR)),status,builder);
        }
      }
);
    }
 else {
      processFile(path,stClient,builder);
    }
  }
 catch (  SVNException e) {
    if (e.getErrorMessage().getErrorCode() == SVNErrorCode.WC_NOT_DIRECTORY) {
      builder.processUnversionedFile(path.getVirtualFile());
      if (recursively && path.isDirectory()) {
        VirtualFile[] children=path.getVirtualFile().getChildren();
        for (        VirtualFile aChildren : children) {
          FilePath filePath=VcsUtil.getFilePath(aChildren.getPath(),aChildren.isDirectory());
          processFile(filePath,stClient,builder,recursively);
        }
      }
    }
  }
}
