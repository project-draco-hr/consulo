{
  try {
    if (path.isDirectory()) {
      stClient.doStatus(path.getIOFile(),recursively,false,false,false,new ISVNStatusHandler(){
        public void handleStatus(        SVNStatus status) throws SVNException {
          processStatus(PeerFactory.getInstance().getVcsContextFactory().createFilePathOn(status.getFile()),status,builder);
        }
      }
);
    }
 else {
      processFile(path,stClient,builder);
    }
  }
 catch (  SVNException e) {
    if (e.getErrorMessage().getErrorCode() == SVNErrorCode.WC_NOT_DIRECTORY) {
      builder.processUnversionedFile(path.getVirtualFile());
      if (recursively && path.isDirectory()) {
        VirtualFile[] children=path.getVirtualFile().getChildren();
        for (int i=0; i < children.length; i++) {
          FilePath filePath=VcsUtil.getFilePath(children[i].getPath());
          processFile(filePath,stClient,builder,recursively);
        }
      }
    }
  }
}
