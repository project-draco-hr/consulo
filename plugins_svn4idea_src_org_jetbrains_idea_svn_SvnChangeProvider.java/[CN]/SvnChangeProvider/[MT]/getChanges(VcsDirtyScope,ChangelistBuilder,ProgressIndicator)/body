{
  try {
    final SvnChangeProviderContext context=new SvnChangeProviderContext(myVcs,builder);
    for (    FilePath path : dirtyScope.getRecursivelyDirtyDirectories()) {
      processFile(path,context,null,true);
    }
    for (    FilePath path : dirtyScope.getDirtyFiles()) {
      FileStatus status=getParentStatus(context,path);
      processFile(path,context,status,false);
    }
    for (    SvnChangedFile copiedFile : context.getCopiedFiles()) {
      boolean foundRename=false;
      final SVNStatus copiedStatus=copiedFile.getStatus();
      for (Iterator<SvnChangedFile> iterator=context.getDeletedFiles().iterator(); iterator.hasNext(); ) {
        SvnChangedFile deletedFile=iterator.next();
        final SVNStatus deletedStatus=deletedFile.getStatus();
        if (copiedFile.getCopyFromURL().equals(deletedStatus.getURL().toString())) {
          builder.processChange(new Change(SvnContentRevision.create(myVcs,deletedFile.getFilePath(),deletedStatus.getRevision()),CurrentContentRevision.create(copiedFile.getFilePath())));
          iterator.remove();
          foundRename=true;
          break;
        }
      }
      if (!foundRename && copiedStatus.getURL() != null) {
        File wcPath=guessWorkingCopyPath(copiedStatus.getFile(),copiedStatus.getURL(),copiedFile.getCopyFromURL());
        SVNStatus status;
        try {
          status=context.getClient().doStatus(wcPath,false);
        }
 catch (        SVNException ex) {
          status=null;
        }
        if (status != null && status.getContentsStatus() == SVNStatusType.STATUS_DELETED) {
          final FilePath filePath=myFactory.createFilePathOnDeleted(wcPath,false);
          final SvnContentRevision beforeRevision=SvnContentRevision.create(myVcs,filePath,status.getRevision());
          final ContentRevision afterRevision=CurrentContentRevision.create(copiedFile.getFilePath());
          builder.processChange(new Change(beforeRevision,afterRevision));
          foundRename=true;
        }
      }
      if (!foundRename) {
        processStatus(copiedFile.getFilePath(),copiedStatus,builder,null);
      }
    }
    for (    SvnChangedFile deletedFile : context.getDeletedFiles()) {
      processStatus(deletedFile.getFilePath(),deletedFile.getStatus(),builder,null);
    }
  }
 catch (  SVNException e) {
    throw new VcsException(e);
  }
}
