{
  String copiedPath=url.getPath();
  String copyFromPath=SVNURL.parseURIEncoded(copyFromURL).getPath();
  String commonPathAncestor=SVNPathUtil.getCommonPathAncestor(copiedPath,copyFromPath);
  int pathSegmentCount=SVNPathUtil.getSegmentsCount(copiedPath);
  int ancestorSegmentCount=SVNPathUtil.getSegmentsCount(commonPathAncestor);
  boolean startsWithSlash=file.getAbsolutePath().startsWith("/");
  List<String> segments=StringUtil.split(file.getPath(),File.separator);
  List<String> copyFromPathSegments=StringUtil.split(copyFromPath,"/");
  List<String> resultSegments=new ArrayList<String>();
  final int keepSegments=segments.size() - pathSegmentCount + ancestorSegmentCount;
  for (int i=0; i < keepSegments; i++) {
    resultSegments.add(segments.get(i));
  }
  for (int i=ancestorSegmentCount; i < copyFromPathSegments.size(); i++) {
    resultSegments.add(copyFromPathSegments.get(i));
  }
  String result=StringUtil.join(resultSegments,"/");
  if (startsWithSlash) {
    result="/" + result;
  }
  return new File(result);
}
