{
  try {
    if (path.isDirectory()) {
      stClient.doStatus(path.getIOFile(),recursively,false,false,true,new ISVNStatusHandler(){
        public void handleStatus(        SVNStatus status) throws SVNException {
          FilePath path=VcsUtil.getFilePath(status.getFile(),status.getKind().equals(SVNNodeKind.DIR));
          processStatusFirstPass(path,status,builder,copiedFiles,deletedFiles,parentStatus);
          if (status.getContentsStatus() == SVNStatusType.STATUS_UNVERSIONED && path.isDirectory()) {
            SVNStatusClient client=new SVNStatusClient(null,null);
            if (recursively && path.isDirectory()) {
              VirtualFile[] children=path.getVirtualFile().getChildren();
              for (              VirtualFile aChildren : children) {
                FilePath filePath=VcsUtil.getFilePath(aChildren.getPath(),aChildren.isDirectory());
                processFile(filePath,client,builder,copiedFiles,deletedFiles,parentStatus,recursively);
              }
            }
          }
        }
      }
);
    }
 else {
      processFile(path,stClient,builder,copiedFiles,deletedFiles,parentStatus);
    }
  }
 catch (  SVNException e) {
    if (e.getErrorMessage().getErrorCode() == SVNErrorCode.WC_NOT_DIRECTORY) {
      final VirtualFile virtualFile=path.getVirtualFile();
      builder.processUnversionedFile(virtualFile);
      if (recursively && path.isDirectory() && virtualFile != null) {
        VirtualFile[] children=virtualFile.getChildren();
        for (        VirtualFile child : children) {
          FilePath filePath=VcsUtil.getFilePath(child.getPath(),child.isDirectory());
          processFile(filePath,stClient,builder,copiedFiles,deletedFiles,parentStatus,recursively);
        }
      }
    }
 else {
      throw e;
    }
  }
}
