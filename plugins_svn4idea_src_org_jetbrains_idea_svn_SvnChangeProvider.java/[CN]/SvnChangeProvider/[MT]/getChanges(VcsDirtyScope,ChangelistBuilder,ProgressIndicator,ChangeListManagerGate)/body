{
  final SvnScopeZipper zipper=new SvnScopeZipper(dirtyScope);
  zipper.run();
  final Map<String,SvnScopeZipper.MyDirNonRecursive> nonRecursiveMap=zipper.getNonRecursiveDirs();
  final ISVNStatusFileProvider fileProvider=createFileProvider(nonRecursiveMap);
  try {
    final SvnChangeProviderContext context=new SvnChangeProviderContext(myVcs,builder,progress);
    final StatusWalkerPartnerImpl partner=new StatusWalkerPartnerImpl(myVcs,progress);
    final NestedCopiesBuilder nestedCopiesBuilder=new NestedCopiesBuilder();
    final EventDispatcher<StatusReceiver> statusReceiver=EventDispatcher.create(StatusReceiver.class);
    statusReceiver.addListener(context);
    statusReceiver.addListener(nestedCopiesBuilder);
    final SvnRecursiveStatusWalker walker=new SvnRecursiveStatusWalker(myVcs.getProject(),statusReceiver.getMulticaster(),partner);
    for (    FilePath path : zipper.getRecursiveDirs()) {
      walker.go(path,SVNDepth.INFINITY);
    }
    partner.setFileProvider(fileProvider);
    for (    SvnScopeZipper.MyDirNonRecursive item : nonRecursiveMap.values()) {
      walker.go(item.getDir(),SVNDepth.FILES);
    }
    processCopiedAndDeleted(context);
    processUnsaved(dirtyScope,addGate,context);
    mySvnFileUrlMapping.acceptNestedData(nestedCopiesBuilder.getSet());
  }
 catch (  SvnExceptionWrapper e) {
    LOG.info(e);
    throw new VcsException(e.getCause());
  }
catch (  SVNException e) {
    if (e.getCause() != null) {
      throw new VcsException(e.getMessage() + e.getCause().getMessage(),e);
    }
    throw new VcsException(e);
  }
}
