{
  if (context.isCanceled()) {
    throw new ProcessCanceledException();
  }
  try {
    if (path.isDirectory()) {
      statusClient.doStatus(path.getIOFile(),recursively,false,false,true,new ISVNStatusHandler(){
        public void handleStatus(        SVNStatus status) throws SVNException {
          if (context.isCanceled()) {
            throw new ProcessCanceledException();
          }
          FilePath path=VcsUtil.getFilePath(status.getFile(),status.getKind().equals(SVNNodeKind.DIR));
          final VirtualFile vFile=path.getVirtualFile();
          if (vFile != null && myExcludedFileIndex.isExcludedFile(vFile)) {
            return;
          }
          processStatusFirstPass(path,status,context,parentStatus);
          if (status.getContentsStatus() == SVNStatusType.STATUS_UNVERSIONED && path.isDirectory()) {
            SVNStatusClient client=myVcs.createStatusClient();
            if (recursively && path.isDirectory()) {
              VirtualFile[] children=vFile.getChildren();
              for (              VirtualFile aChildren : children) {
                FilePath filePath=VcsUtil.getFilePath(aChildren.getPath(),aChildren.isDirectory());
                processFile(filePath,context,parentStatus,recursively,client);
              }
            }
          }
        }
      }
);
    }
 else {
      processFile(path,context,parentStatus);
    }
  }
 catch (  SVNException e) {
    if (e.getErrorMessage().getErrorCode() == SVNErrorCode.WC_NOT_DIRECTORY) {
      final VirtualFile virtualFile=path.getVirtualFile();
      if (virtualFile != null) {
        if (myExcludedFileIndex.isExcludedFile(virtualFile))         return;
        if (parentStatus != FileStatus.IGNORED) {
          if (!SvnUtil.isWorkingCopyRoot(new File(virtualFile.getPath()))) {
            context.getBuilder().processUnversionedFile(virtualFile);
          }
        }
      }
      if (recursively && path.isDirectory() && virtualFile != null) {
        VirtualFile[] children=virtualFile.getChildren();
        for (        VirtualFile child : children) {
          FilePath filePath=VcsUtil.getFilePath(child.getPath(),child.isDirectory());
          processFile(filePath,context,parentStatus,recursively,statusClient);
        }
      }
    }
 else {
      throw e;
    }
  }
}
