{
  if (baseDir != null) {
    final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(baseDir.getProject()).getFileIndex();
    if (fileIndex.isInTestSourceContent(baseDir.getVirtualFile())) {
      if (skipSourceDirsForBaseTestDirectory) {
        return scope.intersectWith(GlobalSearchScopes.projectTestScope(baseDir.getProject()));
      }
    }
 else {
      if (skipTestDirsForBaseSourceDirectory) {
        return scope.intersectWith(GlobalSearchScopes.projectProductionScope(baseDir.getProject()));
      }
    }
  }
  return scope;
}
