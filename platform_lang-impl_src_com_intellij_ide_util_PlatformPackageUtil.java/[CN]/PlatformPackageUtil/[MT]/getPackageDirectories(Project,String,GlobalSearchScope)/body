{
  final PsiManager manager=PsiManager.getInstance(project);
  Query<VirtualFile> query=DirectoryIndex.getInstance(scope.getProject()).getDirectoriesByPackageName(rootPackage,true);
  query=new FilteredQuery<VirtualFile>(query,new Condition<VirtualFile>(){
    @Override public boolean value(    VirtualFile virtualFile){
      return scope.contains(virtualFile);
    }
  }
);
  List<PsiDirectory> directories=ContainerUtil.mapNotNull(query.findAll(),new Function<VirtualFile,PsiDirectory>(){
    @Override public PsiDirectory fun(    VirtualFile virtualFile){
      return manager.findDirectory(virtualFile);
    }
  }
);
  return directories.toArray(new PsiDirectory[directories.size()]);
}
