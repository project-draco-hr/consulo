{
  final PsiType changeType=info.getValue();
  if (changeType != null) {
    try {
      final PsiJavaCodeReferenceElement classReference=expression.getClassOrAnonymousClassReference();
      final PsiType componentType=changeType.getDeepComponentType();
      if (classReference != null) {
        final PsiElement psiElement=replaceTypeWithClassReferenceOrKeyword(project,componentType,classReference);
        final PsiNewExpression newExpression=PsiTreeUtil.getParentOfType(psiElement,PsiNewExpression.class);
        if (newExpression != null && PsiDiamondTypeUtil.canCollapseToDiamond(newExpression,newExpression,changeType)) {
          final PsiJavaCodeReferenceElement anonymousClassReference=newExpression.getClassOrAnonymousClassReference();
          if (anonymousClassReference != null) {
            PsiDiamondTypeUtil.replaceExplicitWithDiamond(anonymousClassReference.getParameterList());
          }
        }
      }
 else {
        final PsiElement typeKeyword=getTypeKeyword(expression);
        if (typeKeyword != null) {
          replaceTypeWithClassReferenceOrKeyword(project,componentType,typeKeyword);
        }
      }
    }
 catch (    IncorrectOperationException e) {
      LOG.error(e);
    }
  }
}
