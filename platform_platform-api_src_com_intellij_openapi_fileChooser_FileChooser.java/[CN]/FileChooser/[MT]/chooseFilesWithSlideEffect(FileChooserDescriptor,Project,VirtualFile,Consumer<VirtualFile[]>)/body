{
  final FileChooserDialog dialog=FileChooserFactory.getInstance().createFileChooser(descriptor,project);
  if (dialog instanceof MacFileChooserDialog) {
    ((MacFileChooserDialog)dialog).chooseWithSheet(null,project,new MacFileChooserDialog.MacFileChooserCallback(){
      public void onChosen(      @NotNull final VirtualFile[] files){
        onChosenCallback.consume(files);
      }
    }
);
  }
 else {
    final VirtualFile[] files=dialog.choose(toSelect,project);
    onChosenCallback.consume(files);
  }
}
