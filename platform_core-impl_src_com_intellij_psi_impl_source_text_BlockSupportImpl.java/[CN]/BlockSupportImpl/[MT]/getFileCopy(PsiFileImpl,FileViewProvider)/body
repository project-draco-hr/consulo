{
  FileViewProvider viewProvider=originalFile.getViewProvider();
  Language language=originalFile.getLanguage();
  PsiFileImpl newFile=(PsiFileImpl)providerCopy.getPsi(language);
  if (newFile == null && language == PlainTextLanguage.INSTANCE && originalFile == viewProvider.getPsi(viewProvider.getBaseLanguage())) {
    newFile=(PsiFileImpl)providerCopy.getPsi(providerCopy.getBaseLanguage());
  }
  if (newFile == null) {
    throw new RuntimeException("View provider " + viewProvider + " refused to parse text with "+ language+ "; languages: "+ viewProvider.getLanguages()+ "; base: "+ viewProvider.getBaseLanguage()+ "; copy: "+ providerCopy+ "; copy.base: "+ providerCopy.getBaseLanguage()+ "; vFile: "+ viewProvider.getVirtualFile()+ "; copy.vFile: "+ providerCopy.getVirtualFile()+ "; fileType: "+ viewProvider.getVirtualFile().getFileType()+ "; copy.original(): "+ (providerCopy.getVirtualFile() instanceof LightVirtualFile ? ((LightVirtualFile)providerCopy.getVirtualFile()).getOriginalFile() : null));
  }
  return newFile;
}
