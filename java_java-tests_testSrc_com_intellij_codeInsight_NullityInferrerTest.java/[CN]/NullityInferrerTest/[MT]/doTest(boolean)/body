{
  final String nullityPath="/codeInsight/nullityinferrer";
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      final VirtualFile aLib=LocalFileSystem.getInstance().findFileByPath(getTestDataPath() + nullityPath + "/lib/annotations.jar");
      if (aLib != null) {
        final VirtualFile file=JarFileSystem.getInstance().getJarRootForLocalFile(aLib);
        if (file != null) {
          final ModifiableRootModel model=ModuleRootManager.getInstance(myModule).getModifiableModel();
          final LibraryTable libraryTable=model.getModuleLibraryTable();
          final Library library=libraryTable.createLibrary("test");
          final Library.ModifiableModel libraryModel=library.getModifiableModel();
          libraryModel.addRoot(file.getUrl(),OrderRootType.CLASSES);
          libraryModel.commit();
          model.commit();
        }
      }
    }
  }
);
  configureByFile(nullityPath + "/before" + getTestName(false)+ ".java");
  final NullityInferrer nullityInferrer=new NullityInferrer(annotateLocalVariables,getProject());
  nullityInferrer.collect(getFile());
  nullityInferrer.apply(getProject());
  checkResultByFile(nullityPath + "/after" + getTestName(false)+ ".java");
}
