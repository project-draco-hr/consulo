{
  final int index=myEntries.get(StringFactory.createStringFromConstantArray(buffer,offset,length));
  if (index <= 0) {
    final CharTableEntry entry=createEntry(buffer,offset,length);
    final int refsLength=myReferences.length;
    if (currentReferencesEnd >= refsLength - 1) {
      final CharTableEntry[] oldReferences=myReferences;
      myReferences=new CharTableEntry[refsLength + Math.max(5,(int)(refsLength * 0.1))];
      System.arraycopy(oldReferences,0,myReferences,0,refsLength);
    }
    myEntries.put(entry,currentReferencesEnd);
    myReferences[currentReferencesEnd++ - 1]=entry;
    return currentReferencesEnd - 1;
  }
  return index;
}
