{
  final List<ChangesCacheFile> files=getAllCaches();
  final RefreshResultConsumer notifyConsumer=new RefreshResultConsumer(){
    private VcsException myError=null;
    private int myCount=0;
    public void receivedChanges(    List<CommittedChangeList> changes){
      if (changes.size() > 0) {
        notifyReloadIncomingChanges();
      }
      checkDone();
    }
    public void receivedError(    VcsException ex){
      myError=ex;
      checkDone();
    }
    private void checkDone(){
      myCount++;
      if (myCount == files.size()) {
        notifyRefreshError(myError);
      }
    }
  }
;
  for (  ChangesCacheFile file : files) {
    refreshCacheAsync(file,initIfEmpty,notifyConsumer);
  }
}
