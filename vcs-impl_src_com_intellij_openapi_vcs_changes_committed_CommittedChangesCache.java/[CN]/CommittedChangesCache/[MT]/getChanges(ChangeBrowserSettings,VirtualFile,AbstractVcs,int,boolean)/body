{
  final CommittedChangesProvider provider=vcs.getCommittedChangesProvider();
  if (provider == null) {
    return Collections.emptyList();
  }
  final RepositoryLocation location=provider.getLocationFor(new FilePathImpl(file));
  if (location == null) {
    return Collections.emptyList();
  }
  if (settings instanceof CompositeCommittedChangesProvider.CompositeChangeBrowserSettings) {
    settings=((CompositeCommittedChangesProvider.CompositeChangeBrowserSettings)settings).get(vcs);
  }
  if (provider instanceof CachingCommittedChangesProvider) {
    try {
      if (cacheOnly) {
        ChangesCacheFile cacheFile=getCacheFile(vcs,file,location);
        if (!cacheFile.isEmpty()) {
          return cacheFile.readChanges(settings,maxCount);
        }
        return Collections.emptyList();
      }
 else {
        if (canGetFromCache(vcs,settings,file,location,maxCount)) {
          return getChangesWithCaching(vcs,settings,file,location,maxCount);
        }
      }
    }
 catch (    IOException e) {
      LOG.error(e);
    }
  }
  return provider.getCommittedChanges(settings,location,maxCount);
}
