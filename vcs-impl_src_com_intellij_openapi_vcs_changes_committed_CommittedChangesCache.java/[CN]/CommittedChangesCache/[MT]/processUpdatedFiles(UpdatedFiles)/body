{
  final Runnable task=new Runnable(){
    public void run(){
      debug("Processing updated files");
      final Collection<ChangesCacheFile> caches=myCachesHolder.getAllCaches();
      for (      final ChangesCacheFile cache : caches) {
        myPendingUpdateCount++;
        try {
          if (cache.isEmpty()) {
            pendingUpdateProcessed();
            return;
          }
          debug("Processing updated files in " + cache.getLocation());
          boolean needRefresh=cache.processUpdatedFiles(updatedFiles,myNewIncomingChanges);
          if (needRefresh) {
            debug("Found unaccounted files, requesting refresh");
            processUpdatedFilesAfterRefresh(cache,updatedFiles);
          }
 else {
            debug("Clearing cached incoming changelists");
            myCachedIncomingChangeLists=null;
            pendingUpdateProcessed();
          }
        }
 catch (        IOException e) {
          LOG.error(e);
        }
      }
    }
  }
;
  myTaskQueue.run(task);
}
