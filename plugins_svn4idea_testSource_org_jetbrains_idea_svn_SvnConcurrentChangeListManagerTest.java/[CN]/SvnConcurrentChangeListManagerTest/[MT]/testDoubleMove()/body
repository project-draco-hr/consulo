{
  enableSilentOperation(VcsConfiguration.StandardConfirmation.ADD);
  final VirtualFile file=createFileInCommand("a.txt","old content");
  final ChangeListManager changeListManager=ChangeListManager.getInstance(myProject);
  changeListManager.ensureUpToDate(false);
  final LocalChangeList list=changeListManager.addChangeList("test",null);
  final LocalChangeList target=changeListManager.addChangeList("target",null);
  final LocalChangeList target2=changeListManager.addChangeList("target2",null);
  changeListManager.moveChangesTo(list,new Change[]{changeListManager.getChange(file)});
  doTest(changeListManager,new Runnable(){
    public void run(){
      changeListManager.moveChangesTo(target,new Change[]{changeListManager.getChange(file)});
      checkFilesAreInList(new VirtualFile[]{file},target.getName(),changeListManager);
      changeListManager.moveChangesTo(target2,new Change[]{changeListManager.getChange(file)});
      checkFilesAreInList(new VirtualFile[]{file},target2.getName(),changeListManager);
    }
  }
);
  checkFilesAreInList(new VirtualFile[]{file},target2.getName(),changeListManager);
  changeListManager.ensureUpToDate(false);
  checkFilesAreInList(new VirtualFile[]{file},target2.getName(),changeListManager);
}
