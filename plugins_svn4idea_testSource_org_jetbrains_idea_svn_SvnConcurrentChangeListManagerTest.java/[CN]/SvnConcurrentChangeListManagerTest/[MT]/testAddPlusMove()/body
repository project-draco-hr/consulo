{
  enableSilentOperation(VcsConfiguration.StandardConfirmation.ADD);
  final VirtualFile file=createFileInCommand("a.txt","old content");
  final ChangeListManager changeListManager=ChangeListManager.getInstance(myProject);
  changeListManager.ensureUpToDate(false);
  final LocalChangeList list=changeListManager.addChangeList("test",null);
  changeListManager.moveChangesTo(list,new Change[]{changeListManager.getChange(file)});
  final String targetName="target";
  doTest(changeListManager,new Runnable(){
    public void run(){
      final LocalChangeList target=changeListManager.addChangeList(targetName,null);
      changeListManager.moveChangesTo(target,new Change[]{changeListManager.getChange(file)});
      checkFilesAreInList(new VirtualFile[]{file},targetName,changeListManager);
    }
  }
);
  checkFilesAreInList(new VirtualFile[]{file},targetName,changeListManager);
  changeListManager.ensureUpToDate(false);
  checkFilesAreInList(new VirtualFile[]{file},targetName,changeListManager);
}
