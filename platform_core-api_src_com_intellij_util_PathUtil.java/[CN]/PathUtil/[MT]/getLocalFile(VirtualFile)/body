{
  if (!file.isValid()) {
    return file;
  }
  if (file.getFileSystem().getProtocol().equals(StandardFileSystems.JAR_PROTOCOL)) {
    final VirtualFile jarFile=StandardFileSystems.getVirtualFileForJar(file);
    if (jarFile != null) {
      return jarFile;
    }
  }
  return file;
}
