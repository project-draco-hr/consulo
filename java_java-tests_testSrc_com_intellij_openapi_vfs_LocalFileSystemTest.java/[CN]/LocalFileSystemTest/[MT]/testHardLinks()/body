{
  if (SystemInfo.isWindows) {
    File dir=FileUtil.createTempDirectory("hardlinks","");
    File oldfile=new File(dir,"oldfile");
    assertTrue(oldfile.createNewFile());
    File newfile=new File(dir,"newfile");
    Process process=Runtime.getRuntime().exec(new String[]{"fsutil","hardlink","create",'"' + newfile.getPath() + '"','"' + oldfile.getPath() + '"'});
    InputStream stream=process.getInputStream();
    System.out.println(new String(FileUtil.loadBytes(stream)));
    process.waitFor();
    VirtualFile file=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(oldfile);
    assertNotNull(file);
    file.setBinaryContent("hello".getBytes(),0,0,new SafeWriteRequestor(){
    }
);
    VirtualFile check=LocalFileSystem.getInstance().findFileByIoFile(newfile);
    assertNotNull(check);
    assertEquals("hello",VfsUtil.loadText(check));
  }
}
