def _gen_sendfile(connection):

    def _sendfile(self, data):
        if isinstance(data, httpsendfile):
            data.seek(0)
            for chunk in util.filechunkiter(data):
                connection.send(self, chunk)
        else:
            connection.send(self, data)
    return _sendfile
