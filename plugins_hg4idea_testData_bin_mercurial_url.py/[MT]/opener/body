def opener(ui, authinfo=None):
    '\n    construct an opener suitable for urllib2\n    authinfo will be added to the password manager\n    '
    handlers = [httphandler()]
    if has_https:
        handlers.append(httpshandler(ui))
    handlers.append(proxyhandler(ui))
    passmgr = passwordmgr(ui)
    if (authinfo is not None):
        passmgr.add_password(*authinfo)
        (user, passwd) = authinfo[2:4]
        ui.debug(('http auth: user %s, password %s\n' % (user, ((passwd and ('*' * len(passwd))) or 'not set'))))
    handlers.extend((urllib2.HTTPBasicAuthHandler(passmgr), httpdigestauthhandler(passmgr)))
    handlers.extend([h(ui, passmgr) for h in handlerfuncs])
    opener = urllib2.build_opener(*handlers)
    opener.addheaders = [('User-agent', 'mercurial/proto-1.0')]
    opener.addheaders.append(('Accept', 'application/mercurial-0.1'))
    return opener
