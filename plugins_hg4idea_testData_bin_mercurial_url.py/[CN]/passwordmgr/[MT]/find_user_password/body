def find_user_password(self, realm, authuri):
    authinfo = urllib2.HTTPPasswordMgrWithDefaultRealm.find_user_password(self, realm, authuri)
    (user, passwd) = authinfo
    if (user and passwd):
        self._writedebug(user, passwd)
        return (user, passwd)
    if (not user):
        auth = self.readauthtoken(authuri)
        if auth:
            (user, passwd) = (auth.get('username'), auth.get('password'))
    if ((not user) or (not passwd)):
        if (not self.ui.interactive()):
            raise util.Abort(_('http authorization required'))
        self.ui.write(_('http authorization required\n'))
        self.ui.status((_('realm: %s\n') % realm))
        if user:
            self.ui.status((_('user: %s\n') % user))
        else:
            user = self.ui.prompt(_('user:'), default=None)
        if (not passwd):
            passwd = self.ui.getpass()
    self.add_password(realm, authuri, user, passwd)
    self._writedebug(user, passwd)
    return (user, passwd)
