{
  int line1=getStartLine(ThreeSide.BASE);
  int line2=getEndLine(ThreeSide.BASE);
  UpdatedLineRange newRange=DiffUtil.updateRangeOnModification(line1,line2,oldLine1,oldLine2,shift);
  boolean rangeAffected=newRange.damaged || (oldLine2 >= line1 && oldLine1 <= line2);
  State oldState=rangeAffected ? storeState() : null;
  if (newRange.startLine == newRange.endLine && getDiffType() == TextDiffType.DELETED && !isResolved()) {
    if (oldState == null)     oldState=storeState();
    myViewer.markChangeResolved(this);
  }
  setStartLine(ThreeSide.BASE,newRange.startLine);
  setEndLine(ThreeSide.BASE,newRange.endLine);
  return oldState;
}
