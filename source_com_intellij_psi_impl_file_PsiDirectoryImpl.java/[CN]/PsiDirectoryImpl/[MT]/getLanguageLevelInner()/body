{
  final VirtualFile virtualFile=getVirtualFile();
  if (virtualFile == null)   throw new IllegalStateException("Cannot get language level for " + getName());
  final Project project=getProject();
  final Module module=ProjectRootManager.getInstance(project).getFileIndex().getModuleForFile(virtualFile);
  if (module != null) {
    return module.getEffectiveLanguageLevel();
  }
  return PsiManager.getInstance(project).getEffectiveLanguageLevel();
}
