{
  try {
    Content selection=mySelection.size() > 0 ? mySelection.get(mySelection.size() - 1) : null;
    int selectedIndex=selection != null ? myContents.indexOf(selection) : -1;
    int indexToBeRemoved=myContents.indexOf(content);
    if (indexToBeRemoved < 0) {
      return false;
    }
    if (!fireContentRemoveQuery(content,indexToBeRemoved)) {
      return false;
    }
    if (!content.isValid()) {
      return false;
    }
    boolean wasSelected=isSelected(content);
    if (wasSelected) {
      removeSelectedContent(content);
    }
    int indexToSelect=-1;
    if (wasSelected) {
      int i=indexToBeRemoved - 1;
      if (i >= 0) {
        indexToSelect=i;
      }
 else       if (getContentCount() > 1) {
        indexToSelect=0;
      }
    }
 else     if (selectedIndex > indexToBeRemoved) {
      indexToSelect=selectedIndex - 1;
    }
    myContents.remove(content);
    content.removePropertyChangeListener(this);
    int newSize=myContents.size();
    if (newSize > 0 && trackSelection) {
      if (indexToSelect > -1) {
        final Content toSelect=myContents.get(indexToSelect);
        if (!isSelected(toSelect)) {
          if (myUI.isSingleSelection()) {
            setSelectedContent(toSelect);
          }
 else {
            addSelectedContent(toSelect);
          }
        }
      }
    }
 else {
      mySelection.clear();
    }
    fireContentRemoved(content,indexToBeRemoved);
    ((ContentImpl)content).setManager(null);
    Disposer.dispose(content);
    return true;
  }
  finally {
    if (ApplicationManager.getApplication().isDispatchThread()) {
      myUI.getComponent().updateUI();
    }
  }
}
