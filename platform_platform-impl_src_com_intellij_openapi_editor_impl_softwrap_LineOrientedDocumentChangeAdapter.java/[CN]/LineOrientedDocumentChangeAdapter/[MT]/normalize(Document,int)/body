{
  if (offset < 0) {
    return 0;
  }
  if (offset >= document.getTextLength()) {
    return Math.max(document.getTextLength() - 1,0);
  }
  return offset;
}
