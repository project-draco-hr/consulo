{
  if (classname == null || name == null || name.length() == 0)   return;
  boolean newlyLoaded=false;
  final URL[] urls=getClassPathUrls();
  Class clazz=CLASS_CACHE.getClass(urls,classname);
  if (clazz == null) {
    ClassLoader loader=getClassLoader(urls);
    try {
      if (loader == null) {
        clazz=Class.forName(classname);
      }
 else {
        clazz=loader.loadClass(classname);
      }
      newlyLoaded=true;
    }
 catch (    ClassNotFoundException e) {
      myLocalizedError=e.getLocalizedMessage();
      clazz=null;
    }
catch (    NoClassDefFoundError e) {
      myLocalizedError=e.getLocalizedMessage();
      clazz=null;
    }
catch (    UnsupportedClassVersionError e) {
      myLocalizedError=e.getLocalizedMessage();
      clazz=null;
    }
  }
  final String nsPrefix=(uri == null) ? null : getSourceElement().getPrefixByNamespace(uri);
  final AntTypeId id=(nsPrefix == null) ? new AntTypeId(name) : new AntTypeId(name,nsPrefix);
  final AntTypeDefinitionImpl def;
  if (clazz == null) {
    def=new AntTypeDefinitionImpl(id,classname,isTask());
  }
 else {
    myClassesLoaded=true;
    def=(AntTypeDefinitionImpl)AntFileImpl.createTypeDefinition(id,clazz,Task.class.isAssignableFrom(clazz));
  }
  if (def != null) {
    myNewDefinitions=new AntTypeDefinition[]{def};
    def.setDefiningElement(this);
    final AntStructuredElement parent=getAntParent();
    if (parent != null) {
      parent.registerCustomType(def);
    }
    if (newlyLoaded && clazz != null) {
      CLASS_CACHE.setClass(urls,classname,clazz);
    }
  }
}
