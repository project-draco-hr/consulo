def trylock(self):
    if self.held:
        self.held += 1
        return
    if (lock._host is None):
        lock._host = socket.gethostname()
    lockname = ('%s:%s' % (lock._host, os.getpid()))
    while (not self.held):
        try:
            util.makelock(lockname, self.f)
            self.held = 1
        except (OSError, IOError) as why:
            if (why.errno == errno.EEXIST):
                locker = self.testlock()
                if (locker is not None):
                    raise error.LockHeld(errno.EAGAIN, self.f, self.desc, locker)
            else:
                raise error.LockUnavailable(why.errno, why.strerror, why.filename, self.desc)
