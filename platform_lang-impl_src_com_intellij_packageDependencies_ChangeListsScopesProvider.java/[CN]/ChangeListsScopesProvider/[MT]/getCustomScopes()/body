{
  final ChangeListManager changeListManager=ChangeListManager.getInstance(myProject);
  final List<NamedScope> result=new ArrayList<NamedScope>();
  result.add(createScope(changeListManager.getAffectedFiles(),IdeBundle.message("scope.modified.files")));
  for (  ChangeList list : changeListManager.getChangeListsCopy()) {
    final List<VirtualFile> files=new ArrayList<VirtualFile>();
    final Collection<Change> changes=list.getChanges();
    for (    Change change : changes) {
      final ContentRevision afterRevision=change.getAfterRevision();
      if (afterRevision != null) {
        final VirtualFile vFile=afterRevision.getFile().getVirtualFile();
        if (vFile != null) {
          files.add(vFile);
        }
      }
    }
    result.add(createScope(files,list.getName()));
  }
  return result;
}
