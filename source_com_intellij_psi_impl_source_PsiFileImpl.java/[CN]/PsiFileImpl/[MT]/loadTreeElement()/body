{
synchronized (PsiLock.LOCK) {
    FileElement treeElement=(FileElement)_getTreeElement();
    if (treeElement != null)     return treeElement;
    if (myViewProvider.isPhysical() && myManager.isAssertOnFileLoading(getViewProvider().getVirtualFile())) {
      LOG.error("File text loaded " + getViewProvider().getVirtualFile().getPresentableUrl());
    }
    final FileViewProvider viewProvider=getViewProvider();
    final Document document=viewProvider.getDocument();
    treeElement=createFileElement(viewProvider.getContents());
    treeElement.putUserData(new Key<Document>("HARD_REFERENCE_TO_DOCUMENT"),document);
    setTreeElement(treeElement);
    treeElement.setPsiElement(this);
    if (myViewProvider.isEventSystemEnabled())     ((PsiDocumentManagerImpl)PsiDocumentManager.getInstance(myManager.getProject())).contentsLoaded(this);
    if (myViewProvider.isPhysical() && LOG.isDebugEnabled()) {
      LOG.debug("Loaded text for file " + getViewProvider().getVirtualFile().getPresentableUrl());
    }
    return treeElement;
  }
}
