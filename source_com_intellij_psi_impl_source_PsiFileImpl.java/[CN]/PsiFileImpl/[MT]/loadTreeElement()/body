{
  if (!isPhysical()) {
    return getTreeElement();
  }
  final Document document=FileDocumentManager.getInstance().getDocument(myFile);
synchronized (PsiLock.LOCK) {
    FileElement treeElement=getTreeElement();
    if (treeElement != null)     return treeElement;
    if (myFile != null && myManager.isAssertOnFileLoading(myFile)) {
      LOG.error("File text loaded " + myFile.getPresentableUrl());
    }
    treeElement=(FileElement)Factory.createCompositeElement(myElementType);
    treeElement.setDocument(document);
    final CharSequence docText=document.getCharsSequence();
    char[] chars=CharArrayUtil.fromSequence(docText);
    TreeElement contentElement=Factory.createLeafElement(myContentElementType,chars,0,docText.length(),-1,treeElement.getCharTable());
    TreeUtil.addChildren(treeElement,contentElement);
    setTreeElement(treeElement);
    treeElement.setPsiElement(this);
    ((PsiDocumentManagerImpl)PsiDocumentManager.getInstance(myManager.getProject())).contentsLoaded(this);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Loaded text for file " + myFile.getPresentableUrl());
    }
    return treeElement;
  }
}
