{
  FileViewProvider provider=myViewProvider.clone();
  PsiFileImpl clone=(PsiFileImpl)provider.getPsi(getLanguage());
  HashMap<Key,Object> copyableMap=getUserData(COPYABLE_USER_MAP_KEY);
  if (copyableMap != null) {
    final HashMap<Key,Object> mapclone=(HashMap<Key,Object>)copyableMap.clone();
    clone.putUserData(COPYABLE_USER_MAP_KEY,mapclone);
  }
  final FileElement treeClone=(FileElement)calcTreeElement().clone();
  clone.myTreeElementPointer=treeClone;
  treeClone.setPsiElement(clone);
  if (getViewProvider().isEventSystemEnabled()) {
    clone.myOriginalFile=this;
  }
 else   if (myOriginalFile != null) {
    clone.myOriginalFile=myOriginalFile;
  }
  return clone;
}
