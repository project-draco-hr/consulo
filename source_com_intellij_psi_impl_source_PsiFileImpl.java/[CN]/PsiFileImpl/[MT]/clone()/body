{
  FileViewProvider provider=getViewProvider().clone();
  PsiFileImpl clone=(PsiFileImpl)provider.getPsi(getLanguage());
  Map<Key,Object> copyableMap=getUserData(COPYABLE_USER_MAP_KEY);
  if (copyableMap != null) {
    final Map<Key,Object> mapclone=((THashMap<Key,Object>)copyableMap).clone();
    clone.putUserData(COPYABLE_USER_MAP_KEY,mapclone);
  }
  if (getTreeElement() != null) {
    final FileElement treeClone=(FileElement)calcTreeElement().clone();
    clone.myTreeElementPointer=treeClone;
    treeClone.setPsiElement(clone);
  }
  if (getViewProvider().isEventSystemEnabled()) {
    clone.myOriginalFile=this;
  }
 else   if (myOriginalFile != null) {
    clone.myOriginalFile=myOriginalFile;
  }
  return clone;
}
