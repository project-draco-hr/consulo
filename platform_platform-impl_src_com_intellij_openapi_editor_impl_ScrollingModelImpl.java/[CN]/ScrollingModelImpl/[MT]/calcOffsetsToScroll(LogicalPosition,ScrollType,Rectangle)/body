{
  Point targetLocation=myEditor.logicalPositionToXY(pos);
  if (myEditor.getSettings().isRefrainFromScrolling() && viewRect.contains(targetLocation)) {
    if (scrollType == ScrollType.CENTER || scrollType == ScrollType.CENTER_DOWN || scrollType == ScrollType.CENTER_UP) {
      scrollType=ScrollType.RELATIVE;
    }
  }
  int spaceWidth=EditorUtil.getSpaceWidth(Font.PLAIN,myEditor);
  int xInsets=myEditor.getSettings().getAdditionalColumnsCount() * spaceWidth;
  int hOffset=scrollType == ScrollType.CENTER || scrollType == ScrollType.CENTER_DOWN || scrollType == ScrollType.CENTER_UP ? 0 : viewRect.x;
  if (targetLocation.x < hOffset) {
    hOffset=targetLocation.x - 4 * spaceWidth;
    hOffset=hOffset > 0 ? hOffset : 0;
  }
 else   if (targetLocation.x >= hOffset + viewRect.width) {
    hOffset=targetLocation.x - Math.max(0,viewRect.width - xInsets);
  }
  int lineHeight=myEditor.getLineHeight();
  int scrollUpBy=viewRect.y - targetLocation.y + (viewRect.height > lineHeight ? lineHeight : 0);
  int scrollDownBy=targetLocation.y - viewRect.y - Math.max(0,viewRect.height - 2 * lineHeight);
  int centerPosition=targetLocation.y - viewRect.height / 3;
  int vOffset=viewRect.y;
  if (scrollType == ScrollType.CENTER) {
    vOffset=centerPosition;
  }
 else   if (scrollType == ScrollType.CENTER_UP) {
    if (scrollUpBy > 0 || scrollDownBy > 0 || vOffset > centerPosition) {
      vOffset=centerPosition;
    }
  }
 else   if (scrollType == ScrollType.CENTER_DOWN) {
    if (scrollUpBy > 0 || scrollDownBy > 0 || vOffset < centerPosition) {
      vOffset=centerPosition;
    }
  }
 else   if (scrollType == ScrollType.RELATIVE) {
    if (scrollUpBy > 0) {
      vOffset=viewRect.y - scrollUpBy;
    }
 else     if (scrollDownBy > 0) {
      vOffset=viewRect.y + scrollDownBy;
    }
  }
 else   if (scrollType == ScrollType.MAKE_VISIBLE) {
    if (scrollUpBy > 0 || scrollDownBy > 0) {
      vOffset=centerPosition;
    }
  }
  JScrollPane scrollPane=myEditor.getScrollPane();
  hOffset=Math.max(0,hOffset);
  vOffset=Math.max(0,vOffset);
  hOffset=Math.min(scrollPane.getHorizontalScrollBar().getMaximum() - getExtent(scrollPane.getHorizontalScrollBar()),hOffset);
  vOffset=Math.min(scrollPane.getVerticalScrollBar().getMaximum() - getExtent(scrollPane.getVerticalScrollBar()),vOffset);
  return new Point(hOffset,vOffset);
}
