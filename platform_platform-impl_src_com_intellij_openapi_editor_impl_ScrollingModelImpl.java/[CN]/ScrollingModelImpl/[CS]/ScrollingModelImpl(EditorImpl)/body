{
  myEditor=editor;
  myEditor.getScrollPane().getViewport().addChangeListener(new ChangeListener(){
    private Rectangle myLastViewRect;
    @Override public void stateChanged(    ChangeEvent event){
      Rectangle viewRect=getVisibleArea();
      VisibleAreaEvent visibleAreaEvent=new VisibleAreaEvent(myEditor,myLastViewRect,viewRect);
      if (!myViewportPositioned && viewRect.height > 0) {
        myViewportPositioned=true;
        if (adjustVerticalOffsetIfNecessary()) {
          return;
        }
      }
      myLastViewRect=viewRect;
      for (      VisibleAreaListener listener : myVisibleAreaListeners) {
        listener.visibleAreaChanged(visibleAreaEvent);
      }
    }
  }
);
  myDocumentListener=new DocumentAdapter(){
    @Override public void beforeDocumentChange(    DocumentEvent e){
      cancelAnimatedScrolling(true);
    }
  }
;
  myEditor.getDocument().addDocumentListener(myDocumentListener);
}
