{
  if (!GppTypeConverter.hasTypedContext(closure)) {
    return null;
  }
  final Pair<PsiMethod,PsiSubstitutor> pair=getOverriddenMethod(closure);
  if (pair != null) {
    final PsiParameter[] parameters=pair.first.getParameterList().getParameters();
    if (parameters.length > index) {
      return pair.second.substitute(parameters[index].getType());
    }
    return null;
  }
  for (  PsiType constraint : getExpectedTypes(closure)) {
    final PsiType suggestion=getSingleMethodParameterType(constraint,index,closure);
    if (suggestion != null) {
      return suggestion;
    }
  }
  return null;
}
