{
  if (fullText == null) {
    return header;
  }
  final Context context=new Context(desiredRowsNumber,desiredSymbolsInRowNumber);
  int startParseOffset=0;
  startParseOffset=process(fullText,startParseOffset,fullText.length(),getHeadParser(context));
  startParseOffset+="<body>".length();
  int bracket=header.indexOf(']');
  int lf=header.indexOf('\n');
  if (bracket > 0 && (lf < 0 || bracket < lf)) {
    context.buffer.append(header.substring(0,bracket + 1)).append(" ");
  }
  startParseOffset=process(fullText,startParseOffset,fullText.length(),getHeaderParser(context,header));
  startParseOffset=process(fullText,startParseOffset,fullText.length(),getBodyParser(context));
  if (qName != null && startParseOffset < fullText.length()) {
    context.buffer.append(String.format("<a href='psi_element://%s'>&lt;more&gt;</a>",qName));
  }
  while (!context.openTags.isEmpty()) {
    context.buffer.append("</").append(context.openTags.pop()).append('>');
  }
  return context.buffer.toString();
}
