{
  if (fullText == null) {
    return header;
  }
  int bodyStart=fullText.indexOf("<body>");
  if (bodyStart < 0) {
    return header;
  }
  bodyStart+="<body>".length();
  int bodyEnd=fullText.indexOf("</body>");
  if (bodyEnd < 0) {
    return header;
  }
  String body=fullText.substring(bodyStart,bodyEnd);
  final Context context=new Context(desiredRowsNumber,desiredSymbolsInRowNumber);
  int startParseOffset=0;
  int bracket=header.indexOf(']');
  int lf=header.indexOf('\n');
  if (bracket > 0 && (lf < 0 || bracket < lf)) {
    context.buffer.append(header.substring(0,bracket + 1)).append(" ");
  }
  startParseOffset=process(body,startParseOffset,body.length(),getHeaderParser(context,header));
  startParseOffset=process(body,startParseOffset,body.length(),getBodyParser(context));
  if (qName != null && startParseOffset < body.length()) {
    context.buffer.append(String.format("<a href='psi_element://%s'>&lt;more&gt;</a>",qName));
  }
  while (!context.openTags.isEmpty()) {
    context.buffer.append("</").append(context.openTags.pop()).append('>');
  }
  return context.buffer.toString();
}
