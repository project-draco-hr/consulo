{
  if (fullText == null) {
    return header;
  }
  Map<String,String> links=new HashMap<String,String>();
  process(fullText,new LinksCollector(links));
  if (qName != null) {
    links.put(qName,DocumentationManager.PSI_ELEMENT_PROTOCOL + qName);
  }
  List<TextRange> modifiedRanges=new ArrayList<TextRange>();
  List<String> sortedReplacements=new ArrayList<String>(links.keySet());
  Collections.sort(sortedReplacements,REPLACEMENTS_COMPARATOR);
  StringBuilder buffer=new StringBuilder(header);
  replace(buffer,"\n","<br/>",modifiedRanges);
  for (  String replaceFrom : sortedReplacements) {
    String visibleName=replaceFrom;
    int i=visibleName.lastIndexOf('.');
    if (i > 0 && i < visibleName.length() - 1) {
      visibleName=visibleName.substring(i + 1);
    }
    replace(buffer,replaceFrom,String.format("<a href=\"%s\">%s</a>",links.get(replaceFrom),visibleName),modifiedRanges);
  }
  return buffer.toString();
}
