{
  Map<String,String> links=new HashMap<String,String>();
  process(headerWithLinks,new LinksCollector(links));
  String headerToUse=headerTemplate.replace("\n","<br/>");
  for (  Map.Entry<String,String> entry : links.entrySet()) {
    String visibleName=entry.getKey();
    int i=visibleName.lastIndexOf('.');
    if (i > 0 && i < visibleName.length() - 1) {
      visibleName=visibleName.substring(i + 1);
    }
    headerToUse=headerToUse.replace(entry.getKey(),String.format("<a href=\"%s\">%s</a>",entry.getValue(),visibleName));
  }
  context.buffer.append(headerToUse);
  MaxColumnCalculator calculator=new MaxColumnCalculator();
  process(headerToUse,calculator);
  return calculator.maxColumn;
}
