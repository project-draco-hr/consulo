{
  final ActionCallback result=new ActionCallback();
  final Set<Object> allSelected=myUi.getSelectedElements();
  Set<Object> toSelect=new HashSet<Object>();
  for (  Object each : adjusted.keySet()) {
    if (adjusted.get(each).value(each))     continue;
    for (    final Object eachSelected : allSelected) {
      if (isParentOrSame(each,eachSelected))       continue;
      toSelect.add(each);
    }
    if (allSelected.size() == 0) {
      toSelect.add(each);
    }
  }
  final Object[] newSelection=ArrayUtil.toObjectArray(toSelect);
  if (newSelection.length > 0) {
    myUi._select(newSelection,new Runnable(){
      public void run(){
        final Set<Object> hangByParent=new HashSet<Object>();
        processUnsuccessfulSelections(newSelection,new Function<Object,Object>(){
          public Object fun(          final Object o){
            if (myUi.isInStructure(o) && !adjusted.get(o).value(o)) {
              hangByParent.add(o);
            }
 else {
              addAdjustedSelection(o,adjusted.get(o),null);
            }
            return null;
          }
        }
,originallySelected);
        processHangByParent(hangByParent).notify(result);
      }
    }
,true,true,true);
  }
 else {
    result.setDone();
  }
  return result;
}
