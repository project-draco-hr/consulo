{
  if (!CodeInsightUtil.prepareFileForWrite(file))   return;
  PsiIfStatement ifStatement=PsiTreeUtil.getParentOfType(file.findElementAt(editor.getCaretModel().getOffset()),PsiIfStatement.class);
  LOG.assertTrue(ifStatement != null);
  PsiElement block=findCodeBlock(ifStatement);
  ControlFlow controlFlow=buildControlFlow(block);
  PsiExpression condition=(PsiExpression)ifStatement.getCondition().copy();
  setupBranches(ifStatement,controlFlow);
  if (condition != null) {
    ifStatement.getCondition().replace(CodeInsightServicesUtil.invertCondition(condition));
  }
  formatIf(ifStatement);
}
