{
  if (StringUtil.isEmptyOrSpaces(mavenHome)) {
    mavenHome=System.getenv("M2_HOME");
    if (StringUtil.isEmptyOrSpaces(mavenHome)) {
      throw new MavenConfigErrorException(BuilderBundle.message("external.maven.home.not.found"));
    }
  }
  File mavenHomeAsFile=new File(mavenHome);
  File mavenConf=getMavenConfFile(mavenHome);
  if (!mavenConf.exists()) {
    throw new MavenConfigErrorException(BuilderBundle.message("external.maven.home.invalid",mavenHome,mavenConf.getPath()));
  }
  try {
    return mavenHomeAsFile.getCanonicalPath();
  }
 catch (  IOException e) {
    throw new MavenConfigErrorException(e);
  }
}
