{
  myEditor=editor;
  myParameters=parameters;
  myHandler=handler;
  myFreezeSemaphore=freezeSemaphore;
  myOffsetMap=offsetMap;
  myLookup=lookup;
  myLookup.setArranger(new CompletionLookupArranger(parameters));
  myState=new CompletionState(lookup.isShown());
  myLookup.addLookupListener(myLookupListener);
  myLookup.setCalculating(true);
  myQueue=new MergingUpdateQueue("completion lookup progress",200,true,myEditor.getContentComponent());
  ApplicationManager.getApplication().assertIsDispatchThread();
  registerItself();
  if (!ApplicationManager.getApplication().isUnitTestMode() && !lookup.isShown()) {
    scheduleAdvertising();
  }
  trackModifiers();
  myDuringCompletionSemaphore.down();
}
