{
  if (isAutopopupCompletion() && hideAutopopupIfMeaningless()) {
    CompletionAutoPopupHandler.scheduleAutoPopup(getProject(),myEditor,getParameters().getOriginalFile());
    return;
  }
  cancel();
  ApplicationManager.getApplication().assertIsDispatchThread();
  final CompletionProgressIndicator current=CompletionServiceImpl.getCompletionService().getCurrentCompletion();
  LOG.assertTrue(this == current,current + "!=" + this);
  final CompletionPhase phase=new CompletionPhase.Restarted(this);
  CompletionServiceImpl.setCompletionPhase(phase);
  final Project project=getProject();
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    @Override public void run(){
      if (phase != CompletionServiceImpl.getCompletionPhase()) {
        return;
      }
      closeAndFinish(false);
      final CodeCompletionHandlerBase newHandler=new CodeCompletionHandlerBase(myParameters.getCompletionType(),false,isAutopopupCompletion());
      try {
        newHandler.invokeCompletion(project,myEditor,myParameters.getInvocationCount(),false);
      }
 catch (      IndexNotReadyException ignored) {
      }
    }
  }
);
}
