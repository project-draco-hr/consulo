{
  ApplicationManager.getApplication().assertIsDispatchThread();
  if (isOutdated())   return;
  if (!myShownLookup) {
    if (hideAutopopupIfMeaningless()) {
      return;
    }
    myShownLookup=true;
    if (StringUtil.isEmpty(myLookup.getAdvertisementText()) && !isAutopopupCompletion()) {
      final String text=DefaultCompletionContributor.getDefaultAdvertisementText(myParameters);
      if (text != null) {
        myLookup.setAdvertisementText(text);
      }
    }
    myLookup.show();
    if (!ApplicationManager.getApplication().isUnitTestMode()) {
      LOG.assertTrue(myLookup.isVisible());
    }
  }
  myLookup.refreshUi();
  if (!ApplicationManager.getApplication().isUnitTestMode()) {
    LOG.assertTrue(myLookup.isVisible(),"really?: myShown=" + myShownLookup + "; lookup.shown="+ myLookup.isShown());
  }
  hideAutopopupIfMeaningless();
}
