{
  if (isAutopopupCompletion() && !myLookup.isSelectionTouched()) {
    myLookup.refreshUi();
    final List<LookupElement> items=myLookup.getItems();
    if (items.isEmpty() && !myLookup.isCalculating()) {
      myLookup.hideLookup(false);
      LOG.assertTrue(CompletionServiceImpl.getCompletionService().getCurrentCompletion() == null);
      CompletionServiceImpl.setCompletionPhase(CompletionPhase.EmptyAutoPopup);
      return true;
    }
    for (    LookupElement item : items) {
      if ((item.getPrefixMatcher().getPrefix() + myLookup.getAdditionalPrefix()).equals(item.getLookupString())) {
        myLookup.hideLookup(true);
        LOG.assertTrue(CompletionServiceImpl.getCompletionService().getCurrentCompletion() == null);
        CompletionServiceImpl.setCompletionPhase(CompletionPhase.PossiblyDisturbingAutoPopup);
        return true;
      }
    }
  }
  return false;
}
