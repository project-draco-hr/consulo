{
  cancel();
  ApplicationManager.getApplication().assertIsDispatchThread();
  Disposer.dispose(myQueue);
  LookupManager.getInstance(getProject()).removePropertyChangeListener(myLookupManagerListener);
  CompletionProgressIndicator currentCompletion=CompletionServiceImpl.getCompletionService().getCurrentCompletion();
  LOG.assertTrue(currentCompletion == this,currentCompletion + "!=" + this);
  CompletionServiceImpl.assertPhase(CompletionPhase.BgCalculation.class,CompletionPhase.ItemsCalculated.class,CompletionPhase.Synchronous.class,CompletionPhase.CommittingDocuments.class);
  if (CompletionServiceImpl.getCompletionPhase() instanceof CompletionPhase.CommittingDocuments) {
    LOG.assertTrue(CompletionServiceImpl.getCompletionPhase().indicator != null,CompletionServiceImpl.getCompletionPhase());
    ((CompletionPhase.CommittingDocuments)CompletionServiceImpl.getCompletionPhase()).replaced=true;
  }
  CompletionServiceImpl.setCompletionPhase(CompletionPhase.NoCompletion);
  if (disposeOffsetMap) {
    disposeOffsetMaps();
  }
}
