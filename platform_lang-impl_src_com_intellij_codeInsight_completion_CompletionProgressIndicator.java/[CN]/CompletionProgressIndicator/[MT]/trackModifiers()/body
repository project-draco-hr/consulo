{
  if (isAutopopupCompletion()) {
    return;
  }
  final JComponent contentComponent=myEditor.getContentComponent();
  contentComponent.addKeyListener(new KeyAdapter(){
    public void keyPressed(    KeyEvent e){
      processModifier(e);
    }
    public void keyReleased(    KeyEvent e){
      processModifier(e);
    }
    private void processModifier(    KeyEvent e){
      final int code=e.getKeyCode();
      if (code == KeyEvent.VK_CONTROL || code == KeyEvent.VK_META || code == KeyEvent.VK_ALT || code == KeyEvent.VK_SHIFT) {
        myState.setModifiersReleased(true);
        if (myState.isWaitingAfterAutoInsertion()) {
          cleanup();
        }
        contentComponent.removeKeyListener(this);
      }
    }
  }
);
}
