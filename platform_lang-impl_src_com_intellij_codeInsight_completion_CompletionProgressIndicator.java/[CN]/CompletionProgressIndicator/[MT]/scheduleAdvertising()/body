{
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    public void run(){
      if (isOutdated())       return;
      final List<CompletionContributor> list=ApplicationManager.getApplication().runReadAction(new Computable<List<CompletionContributor>>(){
        public List<CompletionContributor> compute(){
          if (isOutdated()) {
            return Collections.emptyList();
          }
          return CompletionContributor.forParameters(myParameters);
        }
      }
);
      for (      final CompletionContributor contributor : list) {
        if (myLookup.getAdvertisementText() != null)         return;
        if (!myLookup.isCalculating() && !myLookup.isVisible())         return;
        String s=ApplicationManager.getApplication().runReadAction(new Computable<String>(){
          @Nullable public String compute(){
            if (isOutdated()) {
              return null;
            }
            return contributor.advertise(myParameters);
          }
        }
);
        if (myLookup.getAdvertisementText() != null)         return;
        if (s != null) {
          myLookup.setAdvertisementText(s);
          ApplicationManager.getApplication().invokeLater(new Runnable(){
            public void run(){
              if (isOutdated() || myEditor.getComponent().getRootPane() == null) {
                return;
              }
              updateLookup();
            }
          }
,myQueue.getModalityState());
          return;
        }
      }
    }
  }
);
}
