{
  if (!Registry.is("ide.completion.autopopup.choose.by.enter")) {
    return false;
  }
  if (!ApplicationManager.getApplication().isUnitTestMode()) {
    return true;
  }
switch (CodeInsightSettings.getInstance().AUTOPOPUP_FOCUS_POLICY) {
case CodeInsightSettings.ALWAYS:
    return true;
case CodeInsightSettings.NEVER:
  return false;
}
final Language language=PsiUtilCore.getLanguageAtOffset(parameters.getPosition().getContainingFile(),parameters.getOffset());
for (CompletionConfidence confidence : CompletionConfidenceEP.forLanguage(language)) {
final ThreeState result=confidence.shouldFocusLookup(parameters);
if (result != ThreeState.UNSURE) {
  LOG.debug(confidence + " has returned shouldFocusLookup=" + result);
  return result == ThreeState.YES;
}
}
return false;
}
