{
  LOG.assertTrue(myDisposed);
  if (myModifiersReleased) {
    return;
  }
  final String documentText=myEditor.getDocument().getText();
  final int caret=myEditor.getCaretModel().getOffset();
  final int selStart=myEditor.getSelectionModel().getSelectionStart();
  final int selEnd=myEditor.getSelectionModel().getSelectionEnd();
  myRestorePrefix=new Runnable(){
    @Override public void run(){
      DocumentEx document=(DocumentEx)myEditor.getDocument();
      document.setInBulkUpdate(true);
      try {
        document.setText(documentText);
        myEditor.getSelectionModel().setSelection(selStart,selEnd);
        myEditor.getCaretModel().moveToOffset(caret);
      }
  finally {
        document.setInBulkUpdate(false);
      }
    }
  }
;
}
