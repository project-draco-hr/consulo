{
  super.stop();
  myQueue.cancelAllUpdates();
  myFreezeSemaphore.up();
  invokeLaterIfNotDispatch(new Runnable(){
    public void run(){
      if (isOutdated())       return;
      if (isCanceled())       return;
      if (CompletionProgressIndicator.this != CompletionServiceImpl.getCompletionService().getCurrentCompletion())       return;
      myLookup.setCalculating(false);
      if (!isBackgrounded())       return;
      if (myCount == 0) {
        HintManager.getInstance().hideAllHints();
        LookupManager.getInstance(myContextOriginal.project).hideActiveLookup();
        unregisterItself();
        if (myLookup.isFocused()) {
          myHandler.handleEmptyLookup(myContextOriginal.project,myEditor,myParameters,CompletionProgressIndicator.this);
        }
      }
 else {
        updateLookup();
      }
    }
  }
);
}
