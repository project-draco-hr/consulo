{
  boolean sync=ApplicationManager.getApplication().isUnitTestMode() && !CompletionAutoPopupHandler.ourTestingAutopopup;
  final CompletionThreading strategy=sync ? new SyncCompletion() : new AsyncCompletion();
  strategy.startThread(ProgressWrapper.wrap(this),new Runnable(){
    @Override public void run(){
      scheduleAdvertising();
    }
  }
);
  final WeighingDelegate weigher=strategy.delegateWeighing(this);
class CalculateItems implements Runnable {
    @Override public void run(){
      try {
        calculateItems(initContext,weigher);
      }
 catch (      ProcessCanceledException ignore) {
        cancel();
      }
catch (      Throwable t) {
        cancel();
        LOG.error(t);
      }
    }
  }
  strategy.startThread(this,new CalculateItems());
}
