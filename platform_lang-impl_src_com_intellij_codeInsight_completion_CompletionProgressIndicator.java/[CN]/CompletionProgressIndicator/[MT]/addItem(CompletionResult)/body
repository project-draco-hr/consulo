{
  if (!isRunning())   return;
  ProgressManager.checkCanceled();
  final boolean unitTestMode=ApplicationManager.getApplication().isUnitTestMode();
  if (!unitTestMode) {
    LOG.assertTrue(!ApplicationManager.getApplication().isDispatchThread());
  }
  LookupElement lookupElement=item.getLookupElement();
  if (!myHasPsiElements && lookupElement.getPsiElement() != null) {
    myHasPsiElements=true;
  }
  boolean allowMiddleMatches=myCount > CompletionLookupArranger.MAX_PREFERRED_COUNT * 2;
  if (allowMiddleMatches) {
    addDelayedMiddleMatches();
  }
  myItemSorters.put(lookupElement,(CompletionSorterImpl)item.getSorter());
  if (item.isStartMatch() || allowMiddleMatches) {
    addItemToLookup(item);
  }
 else {
synchronized (myDelayedMiddleMatches) {
      myDelayedMiddleMatches.add(item);
    }
  }
}
