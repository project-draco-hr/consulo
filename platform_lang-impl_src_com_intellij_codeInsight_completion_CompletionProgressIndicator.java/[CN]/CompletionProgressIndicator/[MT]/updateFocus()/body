{
  if (myLookup.isSelectionTouched()) {
    return;
  }
  if (!isAutopopupCompletion()) {
    myLookup.setFocused(true);
    return;
  }
  if (!myLookup.isHintMode()) {
    for (    LookupElement item : myLookup.getItems()) {
      if ((item.getPrefixMatcher().getPrefix() + myLookup.getAdditionalPrefix()).equals(item.getLookupString())) {
        myLookup.setFocused(false);
        return;
      }
    }
  }
  final CompletionPhase phase=CompletionServiceImpl.getCompletionPhase();
  myLookup.setFocused(phase instanceof CompletionPhase.ItemsCalculated && ((CompletionPhase.ItemsCalculated)phase).focusLookup);
}
