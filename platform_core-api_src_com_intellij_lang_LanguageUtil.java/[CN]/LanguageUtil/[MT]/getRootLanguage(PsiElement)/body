{
  final FileViewProvider provider=element.getContainingFile().getViewProvider();
  final Set<Language> languages=provider.getLanguages();
  if (languages.size() > 1) {
    PsiElement current=element;
    while (current != null) {
      final Language language=current.getLanguage();
      if (languages.contains(language))       return language;
      current=current.getParent();
    }
  }
  return provider.getBaseLanguage();
}
