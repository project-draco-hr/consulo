{
  ChameleonTransforming.transformChildren(myNode);
  ASTNode child=myNode.getFirstChildNode();
  int offset=myStartOffset != -1 ? myStartOffset : child != null ? child.getTextRange().getStartOffset() : 0;
  final ArrayList<Block> result=new ArrayList<Block>();
  Indent indent=null;
  while (child != null) {
    if (StdTokenSets.COMMENT_BIT_SET.contains(child.getElementType()) || child.getElementType() == JavaDocElementType.DOC_COMMENT) {
      result.add(createJavaBlock(child,mySettings,Indent.getNoneIndent(),null,null));
      indent=Indent.getNoneIndent();
    }
 else     if (!FormatterUtil.containsWhiteSpacesOnly(child)) {
      break;
    }
    offset+=child.getTextLength();
    child=child.getTreeNext();
  }
  Alignment childAlignment=createChildAlignment();
  Alignment childAlignment2=createChildAlignment2(childAlignment);
  Wrap childWrap=createChildWrap();
  while (child != null) {
    if (!FormatterUtil.containsWhiteSpacesOnly(child) && child.getTextLength() > 0) {
      final ASTNode astNode=child;
      child=processChild(result,astNode,chooseAlignment(childAlignment,childAlignment2,child),childWrap,indent,offset);
      if (astNode != child && child != null) {
        offset=child.getTextRange().getStartOffset();
      }
      if (indent != null && !(myNode.getPsi() instanceof PsiFile) && child.getElementType() != ElementType.MODIFIER_LIST) {
        indent=Indent.getContinuationIndent();
      }
    }
    if (child != null) {
      offset+=child.getTextLength();
      child=child.getTreeNext();
    }
  }
  return result;
}
