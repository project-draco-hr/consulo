{
  PsiTodoSearchHelper helper=PsiTodoSearchHelper.SERVICE.getInstance(file.getProject());
  TodoItem[] todoItems=helper.findTodoItems(file,startOffset,endOffset);
  if (todoItems.length == 0)   return;
  for (  TodoItem todoItem : todoItems) {
    progress.checkCanceled();
    TextRange range=todoItem.getTextRange();
    String description=text.subSequence(range.getStartOffset(),range.getEndOffset()).toString();
    TextAttributes attributes=todoItem.getPattern().getAttributes().getTextAttributes();
    HighlightInfo.Builder builder=HighlightInfo.newHighlightInfo(HighlightInfoType.TODO).range(range);
    if (attributes != null) {
      builder.textAttributes(attributes);
    }
    builder.descriptionAndTooltip(description);
    HighlightInfo info=builder.createUnconditionally();
    if (priorityRange.containsRange(info.getStartOffset(),info.getEndOffset())) {
      result.add(info);
    }
 else {
      outsideResult.add(info);
    }
  }
}
