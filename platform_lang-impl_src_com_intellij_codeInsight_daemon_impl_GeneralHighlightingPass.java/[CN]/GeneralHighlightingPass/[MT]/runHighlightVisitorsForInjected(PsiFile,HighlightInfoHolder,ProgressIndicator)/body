{
  HighlightVisitor[] visitors=getHighlightVisitors();
  try {
    HighlightVisitor[] filtered=filterVisitors(visitors,injectedPsi);
    final List<PsiElement> elements=CollectHighlightsUtil.getElementsInRange(injectedPsi,0,injectedPsi.getTextLength());
    for (    final HighlightVisitor visitor : filtered) {
      visitor.analyze(injectedPsi,true,holder,new Runnable(){
        public void run(){
          for (          PsiElement element : elements) {
            progress.checkCanceled();
            visitor.visit(element);
          }
        }
      }
);
    }
  }
  finally {
    incVisitorUsageCount(-1);
  }
}
