{
  PsiFile[] files=dir.getFiles();
  for (int i=0; i < files.length; i++) {
    PsiFile file=files[i];
    if (isFormatable(file)) {
      array.add(file);
    }
  }
  if (recursive) {
    PsiDirectory[] subdirs=dir.getSubdirectories();
    for (int i=0; i < subdirs.length; i++) {
      collectFilesToProcess(array,subdirs[i],recursive);
    }
  }
}
