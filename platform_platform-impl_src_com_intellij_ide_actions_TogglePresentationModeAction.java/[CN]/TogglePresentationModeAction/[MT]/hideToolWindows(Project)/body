{
  final ToolWindowManagerEx mgr=ToolWindowManagerEx.getInstanceEx(project);
  final DesktopLayout layout=new DesktopLayout();
  layout.copyFrom(mgr.getLayout());
  mgr.clearSideStack();
  final String[] ids=mgr.getToolWindowIds();
  boolean hasVisible=false;
  for (  String id : ids) {
    final ToolWindow toolWindow=mgr.getToolWindow(id);
    if (toolWindow.isVisible()) {
      toolWindow.hide(null);
      hasVisible=true;
    }
  }
  if (hasVisible && UISettings.getInstance().PRESENTATION_MODE) {
    mgr.setLayoutToRestoreLater(layout);
    mgr.activateEditorComponent();
  }
 else   if (!UISettings.getInstance().PRESENTATION_MODE && !hasVisible) {
    final DesktopLayout restoreLayout=mgr.getLayoutToRestoreLater();
    if (restoreLayout != null) {
      mgr.setLayout(restoreLayout);
    }
  }
}
