{
  ContextProvider provider=psiFile.getCopyableUserData(KEY);
  if (provider != null && isValid(provider)) {
    return provider;
  }
  final PsiElement context=psiFile.getContext();
  if (context != null) {
    provider=context.getCopyableUserData(KEY);
    if (provider != null && isValid(provider)) {
      return provider;
    }
  }
  return getFromExtensionOrDefault(psiFile);
}
