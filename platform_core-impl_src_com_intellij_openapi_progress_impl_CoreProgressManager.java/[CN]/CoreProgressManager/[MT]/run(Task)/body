{
  if (task.isHeadless()) {
    if (ApplicationManager.getApplication().isDispatchThread()) {
      runProcessWithProgressSynchronously(task,null);
    }
 else {
      runProcessWithProgressInCurrentThread(task,new EmptyProgressIndicator(),ModalityState.defaultModalityState());
    }
  }
 else   if (task.isModal()) {
    runSynchronously(task.asModal());
  }
 else {
    final Task.Backgroundable backgroundable=task.asBackgroundable();
    if (backgroundable.isConditionalModal() && !backgroundable.shouldStartInBackground()) {
      runSynchronously(task);
    }
 else {
      runAsynchronously(backgroundable);
    }
  }
}
