{
  if (!myOptimizedLineShiftCalculated) {
    myOptimizedLineShiftCalculated=true;
    if (myOldString.length() == 0) {
      int lineShift=0;
      final CharSequence newFragment=getNewFragment();
      for (int i=0; i < newFragment.length(); ++i) {
        final char ch=newFragment.charAt(i);
        if (ch == '\n') {
          ++lineShift;
        }
      }
      myOptimizedLineShift=lineShift != 0 ? lineShift : -1;
    }
  }
  return myOptimizedLineShift;
}
