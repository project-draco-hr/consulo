{
  if (namespace == null) {
    return getAttributeValue(_name);
  }
  boolean hasNamespaceDefined=false;
  XmlTagImpl current=this;
  PsiElement parent=getParent();
  while (current != null) {
    BidirectionalMap<String,String> map=current.initNamespaceMaps(parent);
    if (map != null) {
      List<String> keysByValue=map.getKeysByValue(namespace);
      if (keysByValue != null && !keysByValue.isEmpty()) {
        hasNamespaceDefined|=current == this;
        for (        String prefix : keysByValue) {
          if (prefix != null && prefix.length() > 0) {
            final String value=getAttributeValue(prefix.concat(":").concat(_name));
            if (value != null)             return value;
          }
        }
      }
    }
    current=parent instanceof XmlTag ? (XmlTagImpl)parent : null;
    parent=parent.getParent();
  }
  if (hasNamespaceDefined || namespace.length() == 0) {
    return getAttributeValue(_name);
  }
  return null;
}
