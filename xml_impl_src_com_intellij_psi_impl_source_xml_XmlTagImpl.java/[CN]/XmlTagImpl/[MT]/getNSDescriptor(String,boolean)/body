{
  final XmlTag parentTag=getParentTag();
  if (parentTag == null && namespace.equals(XmlUtil.XHTML_URI)) {
    PsiFile containingFile=getContainingFile();
    if (!(containingFile instanceof XmlFile) && PsiUtil.isInJspFile(containingFile)) {
      containingFile=PsiUtil.getJspFile(containingFile);
    }
    final XmlDocument document=((XmlFile)containingFile).getDocument();
    final XmlProlog prolog=document.getProlog();
    if (prolog != null && prolog.getDoctype() != null) {
      final String url=prolog.getDoctype().getDtdUri();
      XmlNSDescriptor nsDescriptor=url != null ? document.getDefaultNSDescriptor(url,true) : null;
      if (nsDescriptor != null)       return nsDescriptor;
    }
  }
  Map<String,CachedValue<XmlNSDescriptor>> map=initNSDescriptorsMap();
  final CachedValue<XmlNSDescriptor> descriptor=map.get(namespace);
  if (descriptor != null) {
    final XmlNSDescriptor value=descriptor.getValue();
    if (value != null)     return value;
  }
  if (parentTag == null) {
    final XmlDocument parentOfType=PsiTreeUtil.getParentOfType(this,XmlDocument.class);
    if (parentOfType == null)     return null;
    return parentOfType.getDefaultNSDescriptor(namespace,strict);
  }
  return parentTag.getNSDescriptor(namespace,strict);
}
