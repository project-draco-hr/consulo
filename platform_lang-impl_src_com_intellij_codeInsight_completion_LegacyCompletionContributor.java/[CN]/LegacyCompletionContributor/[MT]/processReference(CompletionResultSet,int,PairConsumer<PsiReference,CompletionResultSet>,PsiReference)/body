{
  final int offsetInElement=startOffset - reference.getElement().getTextRange().getStartOffset();
  final String prefix=ApplicationManager.getApplication().runReadAction(new Computable<String>(){
    public String compute(){
      return reference.getElement().getText().substring(reference.getRangeInElement().getStartOffset(),offsetInElement);
    }
  }
);
  consumer.consume(reference,result.withPrefixMatcher(prefix));
}
