{
  final int startOffset=parameters.getOffset();
  final PsiReference ref=ApplicationManager.getApplication().runReadAction(new Computable<PsiReference>(){
    public PsiReference compute(){
      return parameters.getPosition().getContainingFile().findReferenceAt(startOffset);
    }
  }
);
  if (ref instanceof PsiMultiReference) {
    for (    final PsiReference reference : completionData.getReferences((PsiMultiReference)ref)) {
      processReference(result,startOffset,consumer,reference);
    }
  }
 else   if (ref != null) {
    processReference(result,startOffset,consumer,ref);
  }
}
