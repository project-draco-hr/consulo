{
  for (  FilePatch filePatch : patches) {
    if (!(filePatch instanceof TextFilePatch))     continue;
    TextFilePatch patch=(TextFilePatch)filePatch;
    String path=ObjectUtils.assertNotNull(patch.getBeforeName() == null ? patch.getAfterName() : patch.getBeforeName());
    String pathRelatedToProjectDir=project == null ? path : getPathRelatedToDir(ObjectUtils.assertNotNull(project.getBasePath()),basePath,path);
    final Map<String,CharSequence> additionalMap=new HashMap<>();
    for (    PatchEP extension : extensions) {
      final CharSequence charSequence=extension.provideContent(pathRelatedToProjectDir,commitContext);
      if (!StringUtil.isEmpty(charSequence)) {
        additionalMap.put(extension.getName(),charSequence);
      }
    }
    writeFileHeading(patch,writer,lineSeparator,additionalMap);
    for (    PatchHunk hunk : patch.getHunks()) {
      writeHunkStart(writer,hunk.getStartLineBefore(),hunk.getEndLineBefore(),hunk.getStartLineAfter(),hunk.getEndLineAfter(),lineSeparator);
      for (      PatchLine line : hunk.getLines()) {
        char prefixChar=' ';
switch (line.getType()) {
case ADD:
          prefixChar='+';
        break;
case REMOVE:
      prefixChar='-';
    break;
case CONTEXT:
  prefixChar=' ';
break;
}
String text=line.getText();
text=StringUtil.trimEnd(text,"\n");
writeLine(writer,text,prefixChar);
if (line.isSuppressNewLine()) {
writer.write(lineSeparator + NO_NEWLINE_SIGNATURE + lineSeparator);
}
 else {
writer.write(lineSeparator);
}
}
}
}
}
