{
  myManager=manager;
  myParent=parent;
  myTagName=tagName;
  myAbstractType=type;
  final Type concreteInterface=manager.getTypeChooserManager().getTypeChooser(type).chooseType(tag);
  final Converter converter=getConverter(new Function<Class<? extends Annotation>,Annotation>(){
    @Nullable public Annotation fun(    final Class<? extends Annotation> s){
      return getAnnotation(s);
    }
  }
,DomUtil.getGenericValueParameter(concreteInterface),Factory.NULL_FACTORY);
  myGenericInfo=manager.getGenericInfo(concreteInterface);
  myType=concreteInterface;
  myGenericConverter=converter;
  myInvocationCache=manager.getInvocationCache(new Pair<Type,Type>(concreteInterface,converter == null ? null : converter.getClass()));
  final Class<?> rawType=DomReflectionUtil.getRawType(concreteInterface);
  Class<? extends DomElement> implementation=manager.getImplementation(rawType);
  if (implementation == null && !rawType.isInterface()) {
    implementation=(Class<? extends DomElement>)rawType;
  }
  myProxy=rawType.isInterface() ? AdvancedProxy.createProxy(this,implementation,rawType) : AdvancedProxy.createProxy(this,implementation,ArrayUtil.EMPTY_CLASS_ARRAY);
  attach(tag);
}
