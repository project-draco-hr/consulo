{
  final XmlTag tag=ensureTagExists();
  final XmlTag[] subTags=tag.findSubTags(tagName);
  if (subTags.length < index) {
    index=subTags.length;
  }
  final boolean changing=myManager.setChanging(true);
  try {
    XmlTag newTag=createEmptyTag(tagName);
    if (index == 0) {
      if (subTags.length == 0) {
        return (XmlTag)tag.add(newTag);
      }
      return (XmlTag)tag.addBefore(newTag,subTags[0]);
    }
    return (XmlTag)tag.addAfter(newTag,subTags[index - 1]);
  }
  finally {
    myManager.setChanging(changing);
  }
}
