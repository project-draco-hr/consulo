{
  w.lock();
  try {
    if (invalidate && _isValid()) {
      myInvalidated=new Throwable();
    }
    if (!myInitializedChildren.isEmpty()) {
      for (      DomInvocationHandler handler : myFixedChildren.values()) {
        handler.detach(invalidate);
      }
      if (myXmlTag != null && myXmlTag.isValid()) {
        for (        CollectionElementInvocationHandler handler : getAllCollectionChildren()) {
          handler.detach(true);
        }
      }
    }
    myInitializedChildren.clear();
    removeFromCache();
    setXmlTag(null);
  }
  finally {
    w.unlock();
  }
}
