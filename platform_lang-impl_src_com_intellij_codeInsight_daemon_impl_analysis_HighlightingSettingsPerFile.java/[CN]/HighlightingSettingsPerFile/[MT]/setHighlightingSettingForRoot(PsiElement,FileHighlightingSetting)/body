{
  final PsiFile containingFile=root.getContainingFile();
  final VirtualFile virtualFile=containingFile.getVirtualFile();
  if (virtualFile == null)   return;
  FileHighlightingSetting[] defaults=myHighlightSettings.get(virtualFile);
  int rootIndex=PsiUtilBase.getRootIndex(root);
  if (defaults != null && rootIndex >= defaults.length)   defaults=null;
  if (defaults == null)   defaults=getDefaults(containingFile);
  defaults[rootIndex]=setting;
  boolean toRemove=true;
  for (  FileHighlightingSetting aDefault : defaults) {
    if (aDefault != FileHighlightingSetting.NONE)     toRemove=false;
  }
  if (toRemove) {
    myHighlightSettings.remove(virtualFile);
  }
 else {
    myHighlightSettings.put(virtualFile,defaults);
  }
}
