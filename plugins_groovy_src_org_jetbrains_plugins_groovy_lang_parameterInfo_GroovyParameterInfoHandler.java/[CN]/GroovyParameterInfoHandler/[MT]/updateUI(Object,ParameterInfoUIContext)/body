{
  CodeInsightSettings settings=CodeInsightSettings.getInstance();
  if (o == null)   return;
  Object element;
  if (o instanceof GroovyResolveResult) {
    element=((GroovyResolveResult)o).getElement();
    if (element == null || !((PsiElement)element).isValid()) {
      context.setUIComponentEnabled(false);
      return;
    }
  }
 else   if (o instanceof GrClosureType) {
    if (!((GrClosureType)o).isValid()) {
      context.setUIComponentEnabled(false);
      return;
    }
    element=o;
  }
 else {
    return;
  }
  int highlightStartOffset=-1;
  int highlightEndOffset=-1;
  StringBuilder buffer=new StringBuilder();
  if (element instanceof PsiMethod) {
    PsiMethod method=(PsiMethod)element;
    if (method instanceof GrReflectedMethod)     method=((GrReflectedMethod)method).getBaseMethod();
    if (settings.SHOW_FULL_SIGNATURES_IN_PARAMETER_INFO) {
      if (!method.isConstructor()) {
        PsiType returnType=PsiUtil.getSmartReturnType(method);
        if (returnType != null) {
          buffer.append(returnType.getPresentableText());
          buffer.append(' ');
        }
      }
      buffer.append(method.getName());
      buffer.append('(');
    }
    final int currentParameter=context.getCurrentParameterIndex();
    final PsiParameter[] params=method.getParameterList().getParameters();
    int numParams=params.length;
    if (numParams > 0) {
      LOG.assertTrue(o instanceof GroovyResolveResult,o.getClass());
      final PsiSubstitutor substitutor=((GroovyResolveResult)o).getSubstitutor();
      for (int j=0; j < numParams; j++) {
        PsiParameter param=params[j];
        int startOffset=buffer.length();
        appendParameterText(param,substitutor,buffer);
        int endOffset=buffer.length();
        if (j < numParams - 1) {
          buffer.append(", ");
        }
        if (context.isUIComponentEnabled() && (j == currentParameter || (j == numParams - 1 && param.isVarArgs() && currentParameter >= numParams))) {
          highlightStartOffset=startOffset;
          highlightEndOffset=endOffset;
        }
      }
    }
 else {
      buffer.append("no parameters");
    }
    if (settings.SHOW_FULL_SIGNATURES_IN_PARAMETER_INFO) {
      buffer.append(")");
    }
  }
 else   if (element instanceof PsiClass) {
    buffer.append("no parameters");
  }
 else   if (element instanceof GrVariable) {
    final PsiElement parent=context.getParameterOwner().getParent();
    if (parent == null || !parent.isValid()) {
      context.setUIComponentEnabled(false);
      return;
    }
    final PsiType type;
    if (parent instanceof GrMethodCallExpression) {
      type=((GrMethodCallExpression)parent).getInvokedExpression().getType();
    }
 else {
      type=((GrVariable)element).getTypeGroovy();
    }
    generateForClosureType(buffer,type);
  }
 else   if (element instanceof GrClosureType) {
    generateForClosureType(buffer,(GrClosureType)element);
  }
  final boolean isDeprecated=o instanceof PsiDocCommentOwner && ((PsiDocCommentOwner)o).isDeprecated();
  context.setupUIComponentPresentation(buffer.toString(),highlightStartOffset,highlightEndOffset,!context.isUIComponentEnabled(),isDeprecated,false,context.getDefaultParameterColor());
}
