{
  boolean underDarkBuildInLaf=UIUtil.isUnderDarkBuildInLaf();
  JBColor.setDark(underDarkBuildInLaf);
  IconLoader.setUseDarkIcons(underDarkBuildInLaf);
  if (old != underDarkBuildInLaf) {
    String name=underDarkBuildInLaf ? "Darcula" : EditorColorsScheme.DEFAULT_SCHEME_NAME;
    if (name.equals(EditorColorsManager.getInstance().getGlobalScheme().getName())) {
      final EditorColorsScheme scheme=EditorColorsManager.getInstance().getScheme(EditorColorsScheme.DEFAULT_SCHEME_NAME);
      if (scheme != null) {
        EditorColorsManager.getInstance().setGlobalScheme(scheme);
      }
    }
  }
  UISettings.getInstance().fireUISettingsChanged();
  EditorFactory.getInstance().refreshAllEditors();
  Project[] openProjects=ProjectManager.getInstance().getOpenProjects();
  for (  Project openProject : openProjects) {
    FileStatusManager.getInstance(openProject).fileStatusesChanged();
    DaemonCodeAnalyzer.getInstance(openProject).restart();
  }
  for (  IdeFrame frame : WindowManagerEx.getInstanceEx().getAllProjectFrames()) {
    if (frame instanceof IdeFrameImpl) {
      ((IdeFrameImpl)frame).updateView();
    }
  }
  ActionToolbarImpl.updateAllToolbarsImmediately();
}
