{
  if (progressMap.isEmpty() && reentrancyCount != 0) {
    throw new AssertionError("Non-zero stamp with empty stack: " + reentrancyCount);
  }
  checkDepth("1");
  int sizeBefore=progressMap.size();
  progressMap.put(realKey,reentrancyCount);
  depth++;
  checkDepth("2");
  int sizeAfter=progressMap.size();
  if (sizeAfter != sizeBefore + 1) {
    LOG.error("Key doesn't lead to the map size increase: " + sizeBefore + " "+ sizeAfter+ " "+ realKey.second);
  }
}
