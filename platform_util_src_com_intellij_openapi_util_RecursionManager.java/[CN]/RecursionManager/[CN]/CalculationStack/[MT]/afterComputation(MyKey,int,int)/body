{
  if (sizeAfter != progressMap.size()) {
    LOG.error("Map size changed: " + progressMap.size() + " "+ sizeAfter+ " "+ realKey.second);
  }
  depth--;
  Integer value=progressMap.remove(realKey);
  if (sizeBefore != progressMap.size()) {
    LOG.error("Map size doesn't decrease: " + progressMap.size() + " "+ sizeBefore+ " "+ realKey.second);
  }
  if (value == null) {
    throw new AssertionError(realKey.second + " has changed its equals/hashCode");
  }
  reentrancyCount=value;
  if (value == 0) {
    intermediateCache.clear();
  }
 else   if (progressMap.isEmpty()) {
    intermediateCache.clear();
    throw new AssertionError("Non-zero stamp for empty progress map: " + realKey.second + ", "+ value);
  }
 else {
    checkZero();
  }
  checkDepth("3");
}
