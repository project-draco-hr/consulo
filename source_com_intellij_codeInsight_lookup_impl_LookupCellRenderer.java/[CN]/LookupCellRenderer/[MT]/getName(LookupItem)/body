{
  final Object o=item.getObject();
  String name=null;
  if (o instanceof PsiElement) {
    final PsiElement element=(PsiElement)o;
    if (element.isValid()) {
      name=PsiUtil.getName(element);
      if (element instanceof PsiAnonymousClass) {
        name=null;
      }
 else       if (element instanceof PsiClass) {
        PsiSubstitutor substitutor=(PsiSubstitutor)item.getAttribute(LookupItem.SUBSTITUTOR);
        if (substitutor != null && !substitutor.isValid()) {
          PsiType type=(PsiType)item.getAttribute(LookupItem.TYPE);
          if (type != null) {
            name=type.getPresentableText();
          }
        }
 else {
          name=LookupItemUtil.formatTypeName((PsiClass)element,substitutor);
        }
      }
 else       if (element instanceof PsiKeyword || element instanceof PsiExpression || element instanceof PsiTypeElement) {
        name=element.getText();
      }
    }
  }
 else   if (o instanceof PsiType) {
    name=((PsiType)o).getPresentableText();
  }
 else   if (o instanceof Template) {
    name=getKeyString((Template)o);
  }
 else   if (o instanceof XmlElementDescriptor) {
    name=((XmlElementDescriptor)o).getDefaultName();
  }
 else   if (o instanceof PsiMetaData) {
    name=((PsiMetaData)o).getName();
  }
 else   if (o instanceof PresentableLookupValue) {
    name=((PresentableLookupValue)o).getPresentation();
  }
 else {
    name=String.valueOf(o);
  }
  if (name == null) {
    name="";
  }
  if (item.getAttribute(LookupItem.FORCE_QUALIFY) != null) {
    if (o instanceof PsiElement && ((PsiElement)o).getParent() instanceof PsiClass)     name=((PsiClass)((PsiElement)o).getParent()).getName() + "." + name;
  }
  return name;
}
