{
  final PsiElement element=location.getPsiElement();
  final PsiFile file=element.getContainingFile();
  if (!(file instanceof GroovyFile)) {
    return null;
  }
  GroovyFile groovyFile=(GroovyFile)file;
  if (groovyFile.isScript()) {
    mySourceElement=element;
    final PsiClass scriptClass=getScriptClass(location.getPsiElement());
    if (scriptClass == null)     return null;
    final RunnerAndConfigurationSettings settings=createConfiguration(scriptClass);
    if (settings != null) {
      final GroovyScriptRunConfiguration configuration=(GroovyScriptRunConfiguration)settings.getConfiguration();
      GroovyScriptType.getScriptType(groovyFile).tuneConfiguration(groovyFile,configuration,location);
      return (RunnerAndConfigurationSettingsImpl)settings;
    }
  }
  return null;
}
