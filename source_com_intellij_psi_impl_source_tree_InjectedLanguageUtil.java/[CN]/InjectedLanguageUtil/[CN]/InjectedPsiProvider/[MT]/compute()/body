{
  final TextRange hostRange=myHost.getTextRange();
  PsiFile hostPsiFile=myHost.getContainingFile();
  VirtualFile virtualFile=hostPsiFile.getVirtualFile();
  if (virtualFile == null) {
    PsiFile originalFile=hostPsiFile.getOriginalFile();
    if (originalFile != null)     virtualFile=originalFile.getVirtualFile();
  }
  if (virtualFile == null)   return null;
  final VirtualFile hostVirtualFile=virtualFile;
  final DocumentEx hostDocument=(DocumentEx)hostPsiFile.getViewProvider().getDocument();
  final PsiManagerImpl psiManager=(PsiManagerImpl)myHost.getManager();
  final List<Pair<PsiElement,TextRange>> result=new SmartList<Pair<PsiElement,TextRange>>();
  InjectedLanguagePlaces placesRegistrar=new InjectedLanguagePlaces(){
    public void addPlace(    @NotNull Language language,    @NotNull TextRange rangeInsideHost){
      final TextRange documentWindow=hostRange.cutOut(rangeInsideHost);
      DocumentRange documentRange=new DocumentRange(hostDocument,documentWindow);
      String newText=documentRange.getText();
      final VirtualFile virtualFile=new VirtualFileDelegate(hostVirtualFile,documentWindow,language,newText);
      FileDocumentManagerImpl.registerDocument(documentRange,virtualFile);
      PsiElement psi=parseInjectedPsiFile(myHost,rangeInsideHost,psiManager,language,virtualFile,myTextEscaper);
      if (psi != null) {
        psi.putUserData(ResolveUtil.INJECTED_IN_ELEMENT,myHost);
      }
      result.add(new Pair<PsiElement,TextRange>(psi,rangeInsideHost));
    }
  }
;
  for (  LanguageInjector injector : psiManager.getLanguageInjectors()) {
    injector.getLanguagesToInject(myHost,placesRegistrar);
  }
  return Result.createSingleDependency(result,myHost);
}
