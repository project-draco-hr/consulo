{
  final Project project=psiManager.getProject();
  final ParserDefinition parserDefinition=language.getParserDefinition();
  if (parserDefinition == null)   return null;
  final PsiParser parser=parserDefinition.createParser(project);
  final IElementType root=parserDefinition.getFileNodeType();
  final PsiBuilderImpl builder=new PsiBuilderImpl(language,project,null,text);
  final ASTNode parsedNode=parser.parse(root,builder);
  if (!(parsedNode instanceof FileElement))   return null;
  parsedNode.putUserData(TreeElement.MANAGER_KEY,psiManager);
  SingleRootFileViewProvider viewProvider=new SingleRootFileViewProvider(psiManager,virtualFile){
    public FileViewProvider clone(){
      FileViewProvider providerClone=super.clone();
      FileDocumentManagerImpl.registerDocument(providerClone.getDocument(),providerClone.getVirtualFile());
      return providerClone;
    }
  }
;
  PsiFile psiFile=parserDefinition.createFile(viewProvider);
  SrcRepositoryPsiElement repositoryPsiElement=(SrcRepositoryPsiElement)psiFile;
  ((FileElement)parsedNode).setPsiElement(repositoryPsiElement);
  repositoryPsiElement.setTreeElement(parsedNode);
  viewProvider.forceCachedPsi(psiFile);
  return parsedNode.getPsi();
}
