{
  Project project=file.getProject();
  int offset=editor.getCaretModel().getOffset();
  Set<TemplateImpl> array=new LinkedHashSet<TemplateImpl>();
  for (  Language language : file.getViewProvider().getLanguages()) {
    final PsiFile psi=file.getViewProvider().getPsi(language);
    if (psi != null) {
      TemplateContextType contextType=TemplateManager.getInstance(project).getContextType(psi,offset);
      for (      TemplateImpl template : TemplateSettings.getInstance().getTemplates()) {
        if (template.isDeactivated())         continue;
        if (template.getTemplateContext().isEnabled(contextType) && template.isSelectionTemplate()) {
          array.add(template);
        }
      }
    }
  }
  final ArrayList<TemplateImpl> list=new ArrayList<TemplateImpl>(array);
  Collections.sort(list,new Comparator<TemplateImpl>(){
    public int compare(    TemplateImpl o1,    TemplateImpl o2){
      return o1.getKey().compareTo(o2.getKey());
    }
  }
);
  return list;
}
