def save_state(repo, state):
    f = repo.opener('bisect.state', 'w', atomictemp=True)
    wlock = repo.wlock()
    try:
        for kind in state:
            for node in state[kind]:
                f.write(('%s %s\n' % (kind, hex(node))))
        f.rename()
    finally:
        wlock.release()
