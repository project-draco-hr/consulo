{
  final PsiElementFactory factory=manager.getElementFactory();
  final PsiResolveHelper resolveHelper=manager.getResolveHelper();
  final PsiClass aClass=resolveHelper.resolveReferencedClass(myClassQName,context);
  if (aClass == null) {
    return factory.createTypeFromText(myClassQName,context);
  }
  Map<PsiTypeParameter,PsiType> substMap=new HashMap<PsiTypeParameter,PsiType>();
  final Iterator<PsiTypeParameter> iterator=PsiUtil.typeParametersIterator(aClass);
  while (iterator.hasNext()) {
    PsiTypeParameter typeParameter=iterator.next();
    final String name=typeParameter.getName();
    final Type type=mySubstitutor.get(name);
    if (type != null) {
      substMap.put(typeParameter,type.getType(context,manager));
    }
 else {
      substMap.put(typeParameter,null);
    }
  }
  return factory.createType(aClass,factory.createSubstitutor(substMap));
}
