{
  final Application old=ourApplication;
  final Getter<FileTypeRegistry> oldFileTypeRegistry=FileTypeRegistry.ourInstanceGetter;
  final Getter<EncodingRegistry> oldEncodingRegistry=EncodingRegistry.ourInstanceGetter;
  Disposer.register(parent,new Disposable(){
    @Override public void dispose(){
      if (old != null) {
        setApplication(old);
        FileTypeRegistry.ourInstanceGetter=oldFileTypeRegistry;
        EncodingRegistry.ourInstanceGetter=oldEncodingRegistry;
      }
    }
  }
);
  setApplication(instance);
  FileTypeRegistry.ourInstanceGetter=fileTypeRegistryGetter;
  EncodingRegistry.ourInstanceGetter=encodingRegistryGetter;
}
