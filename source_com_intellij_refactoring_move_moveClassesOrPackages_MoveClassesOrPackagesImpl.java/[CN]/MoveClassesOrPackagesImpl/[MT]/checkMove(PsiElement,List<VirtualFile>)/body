{
  if (elementToMove instanceof PsiPackage) {
    final PsiDirectory[] directories=((PsiPackage)elementToMove).getDirectories();
    for (int i=0; i < directories.length; i++) {
      PsiDirectory directory=directories[i];
      checkMove(directory,readOnly);
    }
  }
 else   if (elementToMove instanceof PsiDirectory) {
    final PsiFile[] files=((PsiDirectory)elementToMove).getFiles();
    if (!elementToMove.isWritable()) {
      readOnly.add(((PsiDirectory)elementToMove).getVirtualFile());
      return;
    }
    for (int i=0; i < files.length; i++) {
      PsiFile file=files[i];
      checkMove(file,readOnly);
    }
    final PsiDirectory[] subdirectories=((PsiDirectory)elementToMove).getSubdirectories();
    for (int i=0; i < subdirectories.length; i++) {
      PsiDirectory subdirectory=subdirectories[i];
      checkMove(subdirectory,readOnly);
    }
  }
 else   if (elementToMove instanceof PsiFile) {
    if (!elementToMove.isWritable()) {
      readOnly.add(((PsiFile)elementToMove).getVirtualFile());
      return;
    }
  }
}
