{
  final VirtualFile[] sourceRoots=ProjectRootManager.getInstance(project).getContentSourceRoots();
  List<PsiDirectory> sourceRootDirectories=new ArrayList<PsiDirectory>();
  sourceRoots:   for (int i=0; i < sourceRoots.length; i++) {
    final VirtualFile sourceRoot=sourceRoots[i];
    PsiDirectory sourceRootDirectory=PsiManager.getInstance(project).findDirectory(sourceRoot);
    if (sourceRootDirectory == null) {
      LOG.error("Cannot find PsiDirectory for: " + sourceRoot.getPresentableUrl());
      continue sourceRoots;
    }
    final PsiPackage aPackage=sourceRootDirectory.getPackage();
    if (aPackage == null)     continue;
    final String packagePrefix=aPackage.getQualifiedName();
    for (int j=0; j < directories.length; j++) {
      final PsiDirectory directory=directories[j];
      String qualifiedName=directory.getPackage().getQualifiedName();
      if (!qualifiedName.startsWith(packagePrefix)) {
        continue sourceRoots;
      }
    }
    sourceRootDirectories.add(sourceRootDirectory);
  }
  return sourceRootDirectories;
}
