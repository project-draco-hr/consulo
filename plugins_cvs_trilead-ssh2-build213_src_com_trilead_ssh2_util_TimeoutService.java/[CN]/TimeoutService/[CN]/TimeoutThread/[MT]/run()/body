{
synchronized (todolist) {
    while (true) {
      if (todolist.size() == 0) {
        timeoutThread=null;
        return;
      }
      long now=System.currentTimeMillis();
      TimeoutToken tt=(TimeoutToken)todolist.getFirst();
      if (tt.runTime > now) {
        try {
          todolist.wait(tt.runTime - now);
        }
 catch (        InterruptedException e) {
        }
        continue;
      }
      todolist.removeFirst();
      try {
        tt.handler.run();
      }
 catch (      Exception e) {
        StringWriter sw=new StringWriter();
        e.printStackTrace(new PrintWriter(sw));
        log.log(20,"Exeception in Timeout handler:" + e.getMessage() + "("+ sw.toString()+ ")");
      }
    }
  }
}
