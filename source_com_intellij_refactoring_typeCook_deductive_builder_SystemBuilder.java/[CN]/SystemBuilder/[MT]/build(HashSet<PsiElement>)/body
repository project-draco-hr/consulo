{
  final PsiSearchHelper helper=myManager.getSearchHelper();
  System system=new System(myProject,victims,myTypes,myTypeVariableFactory,mySettings);
  for (Iterator<PsiElement> i=victims.iterator(); i.hasNext(); ) {
    final PsiElement element=i.next();
    if (element instanceof PsiParameter) {
      if (!verifyMethod(element,victims,helper)) {
        continue;
      }
    }
 else     if (element instanceof PsiMethod) {
      if (!verifyMethod(element,victims,helper)) {
        continue;
      }
    }
  }
  PsiType definedType;
  for (Iterator<PsiElement> i=victims.iterator(); i.hasNext(); ) {
    final PsiElement element=i.next();
    if (element instanceof PsiParameter) {
      final PsiParameter p=myParameters.get(element);
      if (p != null) {
        setType(element,definedType=defineType(p));
      }
 else       continue;
    }
 else     if (element instanceof PsiMethod) {
      final PsiMethod m=myMethods.get(element);
      if (m != null) {
        system.addSubtypeConstraint(defineType(element),definedType=defineType(m));
      }
 else       continue;
    }
 else {
      definedType=defineType(element);
    }
    addBoundConstraints(system,definedType,element);
  }
  for (Iterator<PsiElement> i=victims.iterator(); i.hasNext(); ) {
    final PsiElement element=i.next();
    if (element instanceof PsiParameter) {
      final PsiParameter p=myParameters.get(element);
      if (p == null)       continue;
    }
 else     if (element instanceof PsiMethod) {
      final PsiMethod m=myMethods.get(element);
      if (m == null)       continue;
    }
    addUsage(system,element);
    if (!(element instanceof PsiExpression)) {
      final PsiReference[] refs=helper.findReferences(element,helper.getUseScope(element),true);
      for (int k=0; k < refs.length; k++) {
        final PsiElement ref=refs[k].getElement();
        if (ref != null) {
          addUsage(system,ref);
        }
      }
    }
  }
  return system;
}
