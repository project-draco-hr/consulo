{
  String fileName=getTestName(false) + ".java";
  String text=loadFile(fileName);
  final PsiFile file=createFile(fileName,text);
  CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          try {
            JavaCodeStyleManager.getInstance(myProject).shortenClassReferences(file);
            String textAfter=loadFile(getTestName(false) + "_after.java");
            PostprocessReformattingAspect.getInstance(getProject()).doPostponedFormatting();
            PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
            String fileText=file.getText();
            assertEquals(textAfter,fileText);
          }
 catch (          Exception e) {
            LOG.error(e);
          }
        }
      }
);
    }
  }
,"","");
}
