{
  waitForZipToFinish(record);
  WriteRequest request;
synchronized (myLock) {
    request=myPendingWriteRequests.get(record);
  }
  byte[] bytes;
  int length;
  if (request != null) {
    bytes=request.content;
    length=request.length;
  }
 else {
    bytes=super.readBytes(record);
    length=bytes.length;
  }
  InflaterInputStream in=new CustomInflaterInputStream(bytes,length);
  try {
    final BufferExposingByteArrayOutputStream outputStream=new BufferExposingByteArrayOutputStream();
    StreamUtil.copyStreamContent(in,outputStream);
    return outputStream;
  }
  finally {
    in.close();
  }
}
