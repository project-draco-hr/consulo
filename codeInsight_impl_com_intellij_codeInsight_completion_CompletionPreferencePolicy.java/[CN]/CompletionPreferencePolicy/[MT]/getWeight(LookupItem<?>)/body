{
  if (item.getAttribute(LookupItem.WEIGHT) != null)   return item.getAttribute(LookupItem.WEIGHT);
  final int[] result=new int[12];
  String item1StringCap=capitalsOnly(item.getLookupString());
  result[0]=item1StringCap.startsWith(myPrefixCapitals) ? 1 : 0;
  final Object object=item.getObject();
  if (object instanceof PsiClass && myExpectedInfos != null) {
    final PsiClass psiClass=(PsiClass)object;
    for (    final ExpectedTypeInfo info : myExpectedInfos) {
      final PsiClassType psiClassType=psiClass.getManager().getElementFactory().createType(psiClass);
      if (info.getType().getDeepComponentType().equals(psiClassType)) {
        result[0]=Integer.MAX_VALUE;
        break;
      }
 else       if (info.getDefaultType().getDeepComponentType().equals(psiClassType)) {
        result[0]=Integer.MAX_VALUE - 1;
        break;
      }
    }
  }
  result[1]=item1StringCap.startsWith(capitalsOnly(myPrefix) + myPrefixCapitals) ? 1 : 0;
  result[2]=item.getLookupString().startsWith(myPrefix) ? 1 : 0;
  result[3]=item.getLookupString().toLowerCase().startsWith(myPrefixLowered) ? 1 : 0;
  result[4]=getExpectedTypeMatchingDegree(object,item);
  result[5]=object instanceof PsiLocalVariable || object instanceof PsiParameter ? 2 : object instanceof PsiEnumConstant ? 1 : 0;
  final String name=getName(object);
  if (name != null && myExpectedInfos != null) {
    if (myPrefix.equals(name)) {
      result[6]=Integer.MAX_VALUE;
    }
 else {
      final List<String> words=NameUtil.nameToWordsLowerCase(name);
      final List<String> wordsNoDigits=NameUtil.nameToWordsLowerCase(truncDigits(name));
      int max1=calcMatch(words,0);
      max1=calcMatch(wordsNoDigits,max1);
      result[6]=max1;
    }
  }
  if (object instanceof String)   result[6]=1;
 else   if (object instanceof PsiKeyword)   result[6]=-1;
  if (object instanceof PsiMember) {
    final PsiType qualifierType1=CompletionUtil.getQualifierType(item);
    if (qualifierType1 != null) {
      result[7]=StatisticsManager.getInstance().getMemberUseCount(qualifierType1,(PsiMember)object);
    }
  }
  if (object instanceof PsiElement) {
    final PsiProximity proximity=myProximityComparator.getProximity((PsiElement)object);
    result[8]=proximity == null ? -1 : 239 - proximity.ordinal();
  }
  if (name != null && myExpectedInfos != null) {
    int max=0;
    final List<String> wordsNoDigits=NameUtil.nameToWordsLowerCase(truncDigits(name));
    for (    ExpectedTypeInfo myExpectedInfo : myExpectedInfos) {
      String expectedName=((ExpectedTypeInfoImpl)myExpectedInfo).expectedName;
      if (expectedName != null) {
        final THashSet<String> set=new THashSet<String>(NameUtil.nameToWordsLowerCase(truncDigits(expectedName)));
        set.retainAll(wordsNoDigits);
        max=Math.max(max,set.size());
      }
    }
    result[9]=max;
  }
  if (object instanceof PsiLocalVariable || object instanceof PsiParameter) {
    result[10]=5;
  }
 else   if (object instanceof PsiField) {
    result[10]=4;
  }
 else   if (object instanceof PsiMethod) {
    final PsiMethod method=(PsiMethod)object;
    result[10]=PropertyUtil.isSimplePropertyGetter(method) ? 3 : 2;
  }
  if (name != null && myExpectedInfos != null && result[6] != 0) {
    result[11]=239 - NameUtil.nameToWords(name).length;
  }
  item.setAttribute(LookupItem.WEIGHT,result);
  return result;
}
