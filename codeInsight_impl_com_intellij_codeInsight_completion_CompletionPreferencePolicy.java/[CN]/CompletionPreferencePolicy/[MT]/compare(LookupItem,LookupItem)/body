{
  if (item1 == item2)   return 0;
  String item1StringCap=capitalsOnly(item1.getLookupString());
  String item2StringCap=capitalsOnly(item2.getLookupString());
  if (item1StringCap.startsWith(myPrefixCapitals) && !item2StringCap.startsWith(myPrefixCapitals))   return -1;
  if (!item1StringCap.startsWith(myPrefixCapitals) && item2StringCap.startsWith(myPrefixCapitals))   return 1;
  final String fullCaps=capitalsOnly(myPrefix) + myPrefixCapitals;
  if (item1StringCap.startsWith(fullCaps) && !item2StringCap.startsWith(fullCaps))   return -1;
  if (!item1StringCap.startsWith(fullCaps) && item2StringCap.startsWith(fullCaps))   return 1;
  String item1String=item1.getLookupString();
  String item2String=item2.getLookupString();
  if (item1String.startsWith(myPrefix) && !item2String.startsWith(myPrefix))   return -1;
  if (!item1String.startsWith(myPrefix) && item2String.startsWith(myPrefix))   return 1;
  String item1StringLowered=item1.getLookupString().toLowerCase();
  String item2StringLowered=item2.getLookupString().toLowerCase();
  if (item1StringLowered.startsWith(myPrefixLowered) && !item2StringLowered.startsWith(myPrefixLowered))   return -1;
  if (!item1StringLowered.startsWith(myPrefixLowered) && item2StringLowered.startsWith(myPrefixLowered))   return 1;
  Object o1=item1.getObject();
  Object o2=item2.getObject();
  if (myExpectedInfos != null) {
    int matchSize1=getMatchedWordCount(o1);
    int matchSize2=getMatchedWordCount(o2);
    if (matchSize1 != matchSize2) {
      return matchSize2 - matchSize1;
    }
  }
  if (o1 instanceof String || o1 instanceof PsiKeyword) {
    if (o2 instanceof String || o2 instanceof PsiKeyword) {
      return o1.toString().compareTo(o2.toString());
    }
 else {
      return 1;
    }
  }
  if (o2 instanceof String || o2 instanceof PsiKeyword)   return -1;
  if (o1 instanceof PsiLocalVariable || o2 instanceof PsiLocalVariable || o1 instanceof PsiParameter|| o2 instanceof PsiParameter) {
    if (!(o1 instanceof PsiLocalVariable || o1 instanceof PsiParameter))     return 1;
    if (!(o2 instanceof PsiLocalVariable || o2 instanceof PsiParameter))     return -1;
synchronized (myItemToIndexMap) {
      int index1=myItemToIndexMap.get(item1) - 1;
      if (index1 < 0) {
        LOG.error("index1 < 0 : " + item1);
      }
      int index2=myItemToIndexMap.get(item2) - 1;
      if (index2 < 0) {
        LOG.error("index2 < 0 : " + item2);
      }
      return index1 - index2;
    }
  }
  if (o1 instanceof PsiMember && o2 instanceof PsiMember) {
    boolean equalsName1=false;
    if (o1 instanceof PsiNamedElement) {
      equalsName1=myPrefix.equals(((PsiNamedElement)o1).getName());
    }
    boolean equalsName2=false;
    if (o2 instanceof PsiNamedElement) {
      equalsName2=myPrefix.equals(((PsiNamedElement)o2).getName());
    }
    if (equalsName2) {
      if (!equalsName1)       return 1;
    }
 else     if (equalsName1)     return -1;
    PsiType qualifierType1=CompletionUtil.getQualifierType(item1);
    PsiType qualifierType2=CompletionUtil.getQualifierType(item2);
    if (qualifierType1 != null && qualifierType2 != null) {
      int count1=StatisticsManager.getInstance().getMemberUseCount(qualifierType1,(PsiMember)o1);
      int count2=StatisticsManager.getInstance().getMemberUseCount(qualifierType2,(PsiMember)o2);
      if (count2 != count1) {
        return count2 - count1;
      }
    }
  }
  return 0;
}
