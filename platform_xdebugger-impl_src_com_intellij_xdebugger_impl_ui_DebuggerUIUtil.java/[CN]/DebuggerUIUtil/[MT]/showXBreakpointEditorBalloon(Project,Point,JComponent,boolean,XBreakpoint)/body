{
  final XBreakpointManager breakpointManager=XDebuggerManager.getInstance(project).getBreakpointManager();
  final XLightBreakpointPropertiesPanel<XBreakpointBase<?,?,?>> propertiesPanel=new XLightBreakpointPropertiesPanel<XBreakpointBase<?,?,?>>(project,breakpointManager,(XBreakpointBase)breakpoint,showAllOptions);
  final Ref<Balloon> balloonRef=Ref.create(null);
  final Ref<Boolean> isLoading=Ref.create(Boolean.FALSE);
  final Ref<Boolean> moreOptionsRequested=Ref.create(Boolean.FALSE);
  propertiesPanel.setDelegate(new XLightBreakpointPropertiesPanel.Delegate(){
    @Override public void showMoreOptions(){
      if (!isLoading.get()) {
        propertiesPanel.saveProperties();
      }
      if (!balloonRef.isNull()) {
        balloonRef.get().hide();
      }
      showXBreakpointEditorBalloon(project,point,component,true,breakpoint);
      moreOptionsRequested.set(true);
    }
  }
);
  isLoading.set(Boolean.TRUE);
  propertiesPanel.loadProperties();
  isLoading.set(Boolean.FALSE);
  if (moreOptionsRequested.get()) {
    return;
  }
  Runnable showMoreOptions=new Runnable(){
    @Override public void run(){
      propertiesPanel.saveProperties();
      propertiesPanel.dispose();
      BreakpointsDialogFactory.getInstance(project).showDialog(breakpoint);
    }
  }
;
  final JComponent mainPanel=propertiesPanel.getMainPanel();
  final Balloon balloon=showBreakpointEditor(project,mainPanel,point,component,showMoreOptions,breakpoint);
  balloonRef.set(balloon);
  final XBreakpointListener<XBreakpoint<?>> breakpointListener=new XBreakpointAdapter<XBreakpoint<?>>(){
    @Override public void breakpointRemoved(    @NotNull XBreakpoint<?> removedBreakpoint){
      if (removedBreakpoint.equals(breakpoint)) {
        balloon.hide();
      }
    }
  }
;
  balloon.addListener(new JBPopupListener.Adapter(){
    @Override public void onClosed(    LightweightWindowEvent event){
      propertiesPanel.saveProperties();
      propertiesPanel.dispose();
      breakpointManager.removeBreakpointListener(breakpointListener);
    }
  }
);
  breakpointManager.addBreakpointListener(breakpointListener);
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    @Override public void run(){
      IdeFocusManager.findInstance().requestFocus(mainPanel,true);
    }
  }
);
}
