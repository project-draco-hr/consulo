{
  doTest(new PerformAction(){
    public void performAction(    final VirtualFile rootDir,    final VirtualFile rootAfter) throws Exception {
      PsiClass aClass=myJavaFacade.findClass("Test",GlobalSearchScope.projectScope(myProject));
      assertNotNull("Class Test not found",aClass);
      final ArrayList<PsiClass> classes=new ArrayList<PsiClass>();
      classes.add(aClass.findInnerClassByName("Inner",false));
      ExtractClassProcessor processor=new ExtractClassProcessor(aClass,new ArrayList<PsiField>(),new ArrayList<PsiMethod>(),classes,"","Extracted");
      processor.run();
      LocalFileSystem.getInstance().refresh(false);
      FileDocumentManager.getInstance().saveAllDocuments();
    }
  }
);
}
