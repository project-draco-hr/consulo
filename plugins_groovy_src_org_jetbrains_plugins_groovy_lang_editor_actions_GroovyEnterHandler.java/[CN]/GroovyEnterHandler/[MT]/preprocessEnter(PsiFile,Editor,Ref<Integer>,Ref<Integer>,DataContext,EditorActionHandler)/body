{
  Document document=editor.getDocument();
  Project project=file.getProject();
  CaretModel caretModel=editor.getCaretModel();
  String text=document.getText();
  if (StringUtil.isEmpty(text)) {
    return Result.Continue;
  }
  if (!(file instanceof GroovyFileBase)) {
    return Result.Continue;
  }
  final int caret=caretModel.getOffset();
  final EditorHighlighter highlighter=((EditorEx)editor).getHighlighter();
  if (caret >= 1 && caret < text.length() && CodeInsightSettings.getInstance().SMART_INDENT_ON_ENTER) {
    HighlighterIterator iterator=highlighter.createIterator(caret);
    iterator.retreat();
    while (!iterator.atEnd() && TokenType.WHITE_SPACE == iterator.getTokenType()) {
      iterator.retreat();
    }
    boolean afterArrow=!iterator.atEnd() && iterator.getTokenType() == mCLOSABLE_BLOCK_OP;
    if (afterArrow) {
      originalHandler.execute(editor,dataContext);
      PsiDocumentManager.getInstance(project).commitDocument(document);
      CodeStyleManager.getInstance(project).adjustLineIndent(file,caretModel.getOffset());
    }
    iterator=highlighter.createIterator(caretModel.getOffset());
    while (!iterator.atEnd() && TokenType.WHITE_SPACE == iterator.getTokenType()) {
      iterator.advance();
    }
    if (!iterator.atEnd() && mRCURLY == iterator.getTokenType()) {
      PsiDocumentManager.getInstance(project).commitDocument(document);
      final PsiElement element=file.findElementAt(iterator.getStart());
      if (element != null && element.getNode().getElementType() == mRCURLY && element.getParent() instanceof GrClosableBlock && text.length() > caret && afterArrow) {
        return Result.DefaultForceIndent;
      }
    }
    if (afterArrow) {
      return Result.Stop;
    }
    if (editor.isInsertMode() && !HandlerUtils.isReadOnly(editor) && !editor.getSelectionModel().hasSelection()&& handleFlyingGeese(editor,caret,dataContext,originalHandler,file)) {
      return Result.DefaultForceIndent;
    }
  }
  if (handleEnter(editor,dataContext,project,originalHandler))   return Result.Stop;
  return Result.Continue;
}
