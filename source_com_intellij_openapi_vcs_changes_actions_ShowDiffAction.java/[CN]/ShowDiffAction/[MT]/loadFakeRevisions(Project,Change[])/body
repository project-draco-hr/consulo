{
  for (  Change change : changes) {
    final ContentRevision beforeRevision=change.getBeforeRevision();
    final ContentRevision afterRevision=change.getAfterRevision();
    if (beforeRevision instanceof ChangeListManagerImpl.FakeRevision) {
      VcsDirtyScopeManager.getInstance(project).fileDirty(beforeRevision.getFile());
    }
    if (afterRevision instanceof ChangeListManagerImpl.FakeRevision) {
      VcsDirtyScopeManager.getInstance(project).fileDirty(afterRevision.getFile());
    }
  }
  if (!ChangeListManager.getInstance(project).ensureUpToDate(true)) {
    return null;
  }
  List<Change> matchingChanges=new ArrayList<Change>();
  for (  Change change : changes) {
    matchingChanges.addAll(ChangeListManager.getInstance(project).getChangesIn(ChangesUtil.getFilePath(change)));
  }
  return matchingChanges.toArray(new Change[matchingChanges.size()]);
}
