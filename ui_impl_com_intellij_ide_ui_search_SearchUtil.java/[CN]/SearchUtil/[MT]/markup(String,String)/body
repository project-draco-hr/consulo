{
  if (filter == null || filter.length() == 0) {
    return textToMarkup;
  }
  final Pattern insideHtmlTagPattern=Pattern.compile("[<[^<>]*>]*<[^<>]*");
  final Set<String> options=SearchableOptionsRegistrar.getInstance().getProcessedWords(filter);
  final String[] words=textToMarkup.split("[\\W&&[^_-]]");
  for (  String word : words) {
    if (options.contains(PorterStemmerUtil.stem(word.toLowerCase()))) {
      final String[] splittedText=textToMarkup.split(word);
      if (splittedText != null && splittedText.length > 0) {
        textToMarkup="";
        for (        String aPart : splittedText) {
          if (aPart == null) {
            aPart="";
          }
          if (insideHtmlTagPattern.matcher(aPart).matches()) {
            textToMarkup+=aPart + word;
          }
 else {
            textToMarkup+=aPart + "<font color='#ffffff' bgColor='#1d5da7'>" + word+ "</font>";
          }
        }
      }
    }
  }
  return textToMarkup;
}
