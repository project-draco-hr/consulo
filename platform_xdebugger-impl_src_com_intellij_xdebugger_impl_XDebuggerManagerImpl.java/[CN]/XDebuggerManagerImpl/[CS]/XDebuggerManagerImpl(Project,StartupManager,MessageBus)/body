{
  myProject=project;
  myBreakpointManager=new XBreakpointManagerImpl(project,this,startupManager);
  myWatchesManager=new XDebuggerWatchesManager();
  mySessionData=new THashMap<RunContentDescriptor,XDebugSessionData>();
  mySessionTabs=new THashMap<RunContentDescriptor,XDebugSessionTab>();
  mySessions=new LinkedHashMap<ProcessHandler,XDebugSessionImpl>();
  myExecutionPointHighlighter=new ExecutionPointHighlighter(project);
  MessageBusConnection messageBusConnection=messageBus.connect();
  messageBusConnection.subscribe(AppTopics.FILE_DOCUMENT_SYNC,new FileDocumentManagerAdapter(){
    @Override public void fileContentLoaded(    @NotNull VirtualFile file,    @NotNull Document document){
      updateExecutionPoint(file);
    }
    @Override public void fileContentReloaded(    @NotNull VirtualFile file,    @NotNull Document document){
      updateExecutionPoint(file);
    }
    private void updateExecutionPoint(    @NotNull VirtualFile file){
      if (file.equals(myExecutionPointHighlighter.getCurrentFile())) {
        myExecutionPointHighlighter.update();
      }
    }
  }
);
  myBreakpointManager.addBreakpointListener(new XBreakpointAdapter<XBreakpoint<?>>(){
    @Override public void breakpointChanged(    @NotNull XBreakpoint<?> breakpoint){
      if (!(breakpoint instanceof XLineBreakpoint)) {
        final XDebugSessionImpl session=getCurrentSession();
        if (session != null && breakpoint.equals(session.getActiveNonLineBreakpoint())) {
          final XBreakpointBase breakpointBase=(XBreakpointBase)breakpoint;
          breakpointBase.clearIcon();
          myExecutionPointHighlighter.updateGutterIcon(breakpointBase.createGutterIconRenderer());
        }
      }
    }
  }
);
  messageBusConnection.subscribe(RunContentManager.TOPIC,new RunContentWithExecutorListener(){
    @Override public void contentSelected(    @Nullable RunContentDescriptor descriptor,    @NotNull Executor executor){
      if (descriptor != null && executor.equals(DefaultDebugExecutor.getDebugExecutorInstance())) {
        XDebugSessionImpl session=mySessions.get(descriptor.getProcessHandler());
        if (session != null) {
          session.activateSession();
        }
 else {
          setActiveSession(null,null,false,null);
        }
      }
    }
    @Override public void contentRemoved(    @Nullable RunContentDescriptor descriptor,    @NotNull Executor executor){
      if (descriptor != null && executor.equals(DefaultDebugExecutor.getDebugExecutorInstance())) {
        mySessions.remove(descriptor.getProcessHandler());
        mySessionData.remove(descriptor);
        XDebugSessionTab tab=mySessionTabs.remove(descriptor);
        if (tab != null) {
          Disposer.dispose(tab);
        }
      }
    }
  }
);
}
