{
  XDebugSessionTab sessionTab=session.getSessionTab();
  mySessions.remove(session.getDebugProcess().getProcessHandler());
  if (sessionTab != null) {
    RunContentDescriptor descriptor=sessionTab.getRunContentDescriptor();
    if (descriptor != null) {
      Disposer.register(descriptor,new Disposable(){
        @Override public void dispose(){
          mySessions.remove(session.getDebugProcess().getProcessHandler());
        }
      }
);
    }
    if (!myProject.isDisposed() && !ApplicationManager.getApplication().isUnitTestMode() && XDebuggerSettingManagerImpl.getInstanceImpl().getGeneralSettings().isHideDebuggerOnProcessTermination()) {
      ExecutionManager.getInstance(myProject).getContentManager().hideRunContent(DefaultDebugExecutor.getDebugExecutorInstance(),descriptor);
    }
  }
  if (myActiveSession.compareAndSet(session,null)) {
    onActiveSessionChanged();
  }
}
