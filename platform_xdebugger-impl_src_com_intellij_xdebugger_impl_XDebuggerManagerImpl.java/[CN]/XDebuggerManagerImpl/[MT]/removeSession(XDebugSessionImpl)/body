{
  XDebugSessionTab sessionTab=session.getSessionTab();
  mySessions.remove(session.getDebugProcess().getProcessHandler());
  if (sessionTab != null) {
    final RunContentDescriptor descriptor=sessionTab.getRunContentDescriptor();
    mySessionData.put(descriptor,session.getSessionData());
    mySessionTabs.put(descriptor,sessionTab);
    Disposer.register(descriptor,new Disposable(){
      @Override public void dispose(){
        mySessionData.remove(descriptor);
        mySessionTabs.remove(descriptor);
        mySessions.remove(session.getDebugProcess().getProcessHandler());
      }
    }
);
    if (!myProject.isDisposed() && !ApplicationManager.getApplication().isUnitTestMode() && XDebuggerSettingsManager.getInstanceImpl().getGeneralSettings().isHideDebuggerOnProcessTermination()) {
      ExecutionManager.getInstance(myProject).getContentManager().hideRunContent(DefaultDebugExecutor.getDebugExecutorInstance(),descriptor);
    }
  }
  if (myActiveSession == session) {
    myActiveSession=null;
    onActiveSessionChanged();
  }
}
