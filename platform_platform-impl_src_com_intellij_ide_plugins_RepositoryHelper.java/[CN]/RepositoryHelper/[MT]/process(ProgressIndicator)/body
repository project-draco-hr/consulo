{
  BuildNumber buildNumber=ApplicationInfo.getInstance().getBuild();
  @NonNls String url=getListUrl() + "?build=" + buildNumber.asString();
  if (indicator != null) {
    indicator.setText2(IdeBundle.message("progress.connecting.to.plugin.manager",getRepositoryHost()));
  }
  HttpConfigurable.getInstance().setAuthenticator();
  HttpURLConnection connection=(HttpURLConnection)new URL(url).openConnection();
  connection.setRequestProperty("Accept-Encoding","gzip");
  if (indicator != null) {
    indicator.setText2(IdeBundle.message("progress.waiting.for.reply.from.plugin.manager",getRepositoryHost()));
  }
  connection.connect();
  try {
    if (indicator != null) {
      indicator.checkCanceled();
    }
    String encoding=connection.getContentEncoding();
    InputStream is=connection.getInputStream();
    try {
      if ("gzip".equalsIgnoreCase(encoding)) {
        is=new GZIPInputStream(is);
      }
      if (indicator != null) {
        indicator.setText2(IdeBundle.message("progress.downloading.list.of.plugins"));
      }
      RepositoryContentHandler handler=new RepositoryContentHandler();
      readPluginsStream(is,handler,indicator,extPluginsFile);
      return handler.getPluginsList();
    }
  finally {
      is.close();
    }
  }
  finally {
    connection.disconnect();
  }
}
