{
  MergeList mergeList=new MergeList(project,left,base,right);
  String leftText=left.getText();
  String baseText=base.getText();
  String rightText=right.getText();
  @NonNls final Object[] data={"Left\n",leftText,"\nBase\n",baseText,"\nRight\n",rightText};
  ContextLogger logger=new ContextLogger(LOG,new ContextLogger.SimpleContext(data));
  List<MergeBuilder.MergeFragment> fragmentList=processText(leftText,baseText,rightText,logger);
  ArrayList<Change> leftChanges=new ArrayList<Change>();
  ArrayList<Change> rightChanges=new ArrayList<Change>();
  final int fragmentsListSize=fragmentList.size();
  for (int i=0; i < fragmentsListSize; i++) {
    final MergeBuilder.MergeFragment mergeFragment=fragmentList.get(i);
    final TextRange[] ranges=mergeFragment.getRanges();
    logger.assertTrue(ranges[1] != null);
    if (ranges[0] == null) {
      if (ranges[2] == null) {
        if (i == fragmentsListSize - 1 && ranges[1].getEndOffset() == baseText.length()) {
          final int rightTextLength=rightText.length();
          final int leftTextLength=leftText.length();
          rightChanges.add(SimpleChange.fromRanges(ranges[1],new TextRange(rightTextLength,rightTextLength),mergeList.myChanges[1]));
          leftChanges.add(SimpleChange.fromRanges(ranges[1],new TextRange(leftTextLength,leftTextLength),mergeList.myChanges[0]));
        }
 else {
          LOG.error("Left Text: " + leftText + "\n"+ "Right Text: "+ rightText+ "\nBase Text: "+ baseText);
        }
      }
 else {
        rightChanges.add(SimpleChange.fromRanges(ranges[1],ranges[2],mergeList.myChanges[1]));
      }
    }
 else     if (ranges[2] == null) {
      if (ranges[0] == null) {
        LOG.error("Left Text: " + leftText + "\n"+ "Right Text: "+ rightText+ "\nBase Text: "+ baseText);
      }
      leftChanges.add(SimpleChange.fromRanges(ranges[1],ranges[0],mergeList.myChanges[0]));
    }
 else {
      Change[] changes=MergeConflict.createChanges(ranges[0],ranges[1],ranges[2],mergeList);
      leftChanges.add(changes[0]);
      rightChanges.add(changes[1]);
    }
  }
  mergeList.myChanges[0].setChanges(leftChanges);
  mergeList.myChanges[1].setChanges(rightChanges);
  return mergeList;
}
