{
  enableSilentOperation(VcsConfiguration.StandardConfirmation.ADD);
  enableSilentOperation(VcsConfiguration.StandardConfirmation.REMOVE);
  VirtualFile dir=createDirInCommand(myWorkingCopyDir,"child");
  createFileInCommand(dir,"a.txt","content");
  runAndVerifyStatusSorted("A child","A child" + File.separatorChar + "a.txt");
  checkin();
  deleteFileInCommand(dir);
  runAndVerifyStatusSorted("D child","D child" + File.separatorChar + "a.txt");
  refreshVfs();
  final AlienDirtyScope dirtyScope=new AlienDirtyScope();
  dirtyScope.addDir(new FilePathImpl(myWorkingCopyDir));
  final List<Change> changesManually=getChangesInScope(dirtyScope);
  Assert.assertEquals(2,changesManually.size());
  VcsDirtyScopeManager.getInstance(myProject).markEverythingDirty();
  final ChangeListManager clManager=ChangeListManager.getInstance(myProject);
  clManager.ensureUpToDate(false);
  final List<LocalChangeList> lists=clManager.getChangeListsCopy();
  Assert.assertEquals(1,lists.size());
  final Collection<Change> changes=lists.get(0).getChanges();
  Assert.assertEquals(2,changes.size());
}
