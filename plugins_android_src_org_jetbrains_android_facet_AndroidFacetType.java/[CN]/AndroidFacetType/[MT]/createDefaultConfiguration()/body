{
  AndroidFacetConfiguration configuration=new AndroidFacetConfiguration();
  PropertiesComponent component=PropertiesComponent.getInstance();
  LibraryTable libraryTable=LibraryTablesRegistrar.getInstance().getLibraryTable();
  if (component.isValueSet(AndroidSdkUtils.DEFAULT_PLATFORM_NAME_PROPERTY)) {
    Library defaultLib=libraryTable.getLibraryByName(component.getValue(AndroidSdkUtils.DEFAULT_PLATFORM_NAME_PROPERTY));
    if (defaultLib != null && tryToSetAndroidPlatform(configuration,defaultLib)) {
      return configuration;
    }
    for (    Library library : libraryTable.getLibraries()) {
      if (tryToSetAndroidPlatform(configuration,library)) {
        component.setValue(AndroidSdkUtils.DEFAULT_PLATFORM_NAME_PROPERTY,library.getName());
        return configuration;
      }
    }
  }
  return configuration;
}
