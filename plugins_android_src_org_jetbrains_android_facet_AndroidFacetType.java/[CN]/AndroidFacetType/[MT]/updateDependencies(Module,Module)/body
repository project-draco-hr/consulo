{
  final ModifiableRootModel model=ModuleRootManager.getInstance(module).getModifiableModel();
  final Pair<Properties,VirtualFile> pair=readPropertyFile(module,SdkConstants.FN_DEFAULT_PROPERTIES);
  if (pair != null) {
    final VirtualFile baseDir=pair.second.getParent();
    String libDirPath;
    int i=1;
    do {
      libDirPath=pair.first.getProperty("android.library.reference." + i);
      if (libDirPath != null) {
        final VirtualFile libDir=findFileByAbsoluteOrRelativePath(baseDir,FileUtil.toSystemIndependentName(libDirPath));
        if (libDir != null) {
          final Module depModule=ModuleUtil.findModuleForFile(libDir,module.getProject());
          if (depModule != null && (allowedDepModule == null || allowedDepModule == depModule) && ArrayUtil.find(ModuleRootManager.getInstance(depModule).getContentRoots(),libDir) >= 0 && !ModuleRootManager.getInstance(module).isDependsOn(depModule)) {
            model.addModuleOrderEntry(depModule);
          }
        }
      }
      i++;
    }
 while (libDirPath != null);
  }
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      model.commit();
    }
  }
);
}
