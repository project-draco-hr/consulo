{
  final JList list=new JBListWithHintProvider(elements){
    @Nullable @Override protected PsiElement getPsiElementForHint(    Object selectedValue){
      return (PsiElement)selectedValue;
    }
  }
;
  list.setCellRenderer(renderer);
  if (selection != null) {
    list.setSelectedValue(selection,true);
  }
  final Runnable runnable=new Runnable(){
    @Override public void run(){
      int[] ids=list.getSelectedIndices();
      if (ids == null || ids.length == 0)       return;
      for (      Object element : list.getSelectedValues()) {
        if (element != null) {
          processor.execute((T)element);
        }
      }
    }
  }
;
  PopupChooserBuilder builder=new PopupChooserBuilder(list);
  if (title != null) {
    builder.setTitle(title);
  }
  renderer.installSpeedSearch(builder,true);
  return builder.setItemChoosenCallback(runnable).createPopup();
}
