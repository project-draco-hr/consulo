{
  final RuntimeConfigurationProducer result=clone();
  result.myConfiguration=location != null ? result.createConfigurationByElement(location,context) : null;
  if (result.myConfiguration != null) {
    final PsiElement psiElement=result.getSourceElement();
    final Location<PsiElement> _location=PsiLocation.fromPsiElement(psiElement,location != null ? location.getModule() : null);
    if (_location != null) {
      final RunManager runManager=RunManager.getInstance(context.getProject());
      final ConfigurationType type=result.myConfiguration.getType();
      final List<RunnerAndConfigurationSettings> configurations=runManager.getConfigurationSettingsList(type);
      final RunnerAndConfigurationSettings configuration=result.findExistingByElement(_location,configurations,context);
      if (configuration != null) {
        result.myConfiguration=configuration;
      }
 else {
        final ArrayList<String> currentNames=new ArrayList<String>();
        for (        RunnerAndConfigurationSettings configurationSettings : configurations) {
          currentNames.add(configurationSettings.getName());
        }
        result.myConfiguration.setName(RunManager.suggestUniqueName(result.myConfiguration.getName(),currentNames));
      }
    }
  }
  return result;
}
