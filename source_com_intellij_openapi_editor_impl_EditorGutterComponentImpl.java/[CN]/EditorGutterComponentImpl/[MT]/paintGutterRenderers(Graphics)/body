{
  Rectangle clip=g.getClipBounds();
  int firstVisibleOffset=myEditor.logicalPositionToOffset(myEditor.xyToLogicalPosition(new Point(0,clip.y - myEditor.getLineHeight())));
  int lastVisibleOffset=myEditor.logicalPositionToOffset(myEditor.xyToLogicalPosition(new Point(0,clip.y + clip.height + myEditor.getLineHeight())));
  Graphics2D g2=(Graphics2D)g;
  Object antialiasing=g2.getRenderingHint(RenderingHints.KEY_ANTIALIASING);
  g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING,RenderingHints.VALUE_ANTIALIAS_ON);
  try {
    processRangeHighlighters(new RangeHighlighterProcessor(){
      public void process(      RangeHighlighter highlighter){
        paintLineMarkerRenderer(highlighter,g);
      }
    }
,firstVisibleOffset,lastVisibleOffset);
  }
  finally {
    g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING,antialiasing);
  }
  int firstVisibleLine=myEditor.getDocument().getLineNumber(firstVisibleOffset);
  int lastVisibleLine=myEditor.getDocument().getLineNumber(lastVisibleOffset);
  paintIcons(firstVisibleLine,lastVisibleLine,g);
}
