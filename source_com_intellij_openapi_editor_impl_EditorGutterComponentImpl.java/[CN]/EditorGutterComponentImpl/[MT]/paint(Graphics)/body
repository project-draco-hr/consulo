{
  ((ApplicationImpl)ApplicationManager.getApplication()).editorPaintStart();
  try {
    Rectangle clip=g.getClipBounds();
    if (clip.height < 0)     return;
    final Graphics2D g2=(Graphics2D)g;
    final AffineTransform old=g2.getTransform();
    if (isMirrored()) {
      final AffineTransform transform=new AffineTransform(old);
      transform.scale(-1,1);
      transform.translate(-getWidth(),0);
      g2.setTransform(transform);
    }
    paintLineNumbers(g,clip);
    Object antialiasing=g2.getRenderingHint(RenderingHints.KEY_ANTIALIASING);
    g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING,RenderingHints.VALUE_ANTIALIAS_OFF);
    try {
      paintAnnotations(g,clip);
      paintFoldingBackground(g);
      paintLineMarkers(g,clip);
      paintFoldingTree(g,clip);
    }
  finally {
      g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING,antialiasing);
    }
    g2.setTransform(old);
  }
  finally {
    ((ApplicationImpl)ApplicationManager.getApplication()).editorPaintFinish();
  }
}
