{
  Collection hints=request.getHints();
  boolean shouldOpenDialog=FrameDiffTool.shouldOpenDialog(hints);
  if (shouldOpenDialog) {
    final DialogBuilder builder=new DialogBuilder(request.getProject());
    final CompositeDiffPanel diffPanel=createPanel(request,builder.getWindow(),builder);
    if (diffPanel == null) {
      Disposer.dispose(builder);
      return;
    }
    builder.removeAllActions();
    builder.setCenterPanel(diffPanel.getComponent());
    builder.setPreferedFocusComponent(diffPanel.getPreferredFocusedComponent());
    builder.setTitle(request.getWindowTitle());
    builder.setDimensionServiceKey(request.getGroupKey());
    new AnAction(){
      public void actionPerformed(      final AnActionEvent e){
        builder.getDialogWrapper().close(0);
      }
    }
.registerCustomShortcutSet(new CustomShortcutSet(KeymapManager.getInstance().getActiveKeymap().getShortcuts("CloseContent")),diffPanel.getComponent());
    diffPanel.setDiffRequest(request);
    FrameDiffTool.showDiffDialog(builder,hints);
  }
 else {
    final FrameWrapper frameWrapper=new FrameWrapper(request.getProject(),request.getGroupKey());
    final CompositeDiffPanel diffPanel=createPanel(request,frameWrapper.getFrame(),frameWrapper);
    if (diffPanel == null) {
      Disposer.dispose(frameWrapper);
      return;
    }
    frameWrapper.setTitle(request.getWindowTitle());
    diffPanel.setDiffRequest(request);
    DiffUtil.initDiffFrame(request.getProject(),frameWrapper,diffPanel,diffPanel.getComponent());
    new AnAction(){
      public void actionPerformed(      final AnActionEvent e){
        Disposer.dispose(frameWrapper);
      }
    }
.registerCustomShortcutSet(new CustomShortcutSet(KeymapManager.getInstance().getActiveKeymap().getShortcuts("CloseContent")),diffPanel.getComponent());
    frameWrapper.show();
  }
}
