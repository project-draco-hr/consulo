{
  if (stringsXml != null) {
    myFixture.copyFileToProject(BASE_PATH + stringsXml,"res/values/strings.xml");
  }
  myFixture.copyFileToProject(BASE_PATH + "R.java","src/p1/p2/R.java");
  VirtualFile javaFile=myFixture.copyFileToProject(BASE_PATH + "Class" + testName+ ".java","src/p1/p2/Class.java");
  myFixture.configureFromExistingVirtualFile(javaFile);
  final PsiFile javaPsiFile=myFixture.getFile();
  assertTrue(new AndroidAddStringResourceAction().isAvailable(myFixture.getProject(),myFixture.getEditor(),javaPsiFile));
  CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          AndroidAddStringResourceAction.doInvoke(myFixture.getProject(),myFixture.getEditor(),javaPsiFile,"hello");
          if (invokeAfterTemplate != null) {
            invokeAfterTemplate.run();
          }
        }
      }
);
      if (closePopup) {
        myFixture.performEditorAction(IdeActions.ACTION_EDITOR_ESCAPE);
      }
    }
  }
,"","");
  myFixture.checkResultByFile(BASE_PATH + "Class" + testName+ "_after.java");
  myFixture.checkResultByFile("res/values/strings.xml",BASE_PATH + "strings_after.xml",false);
}
