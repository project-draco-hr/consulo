{
  if (inJavaContext) {
    return AllClassesGetter.createLookupItem(psiClass,new InsertHandler<JavaPsiClassReferenceElement>(){
      @Override public void handleInsert(      InsertionContext context,      JavaPsiClassReferenceElement item){
        context.setAddCompletionChar(false);
        int offset=context.getTailOffset() - 1;
        final PsiFile file=context.getFile();
        if (PsiTreeUtil.findElementOfClassAtOffset(file,offset,PsiImportStatementBase.class,false) != null) {
          final PsiJavaCodeReferenceElement ref=PsiTreeUtil.findElementOfClassAtOffset(file,offset,PsiJavaCodeReferenceElement.class,false);
          final String qname=item.getQualifiedName();
          if (qname != null && (ref == null || !qname.equals(ref.getCanonicalText()))) {
            AllClassesGetter.INSERT_FQN.handleInsert(context,item);
          }
          return;
        }
        JavaPsiClassReferenceElement.JAVA_CLASS_INSERT_HANDLER.handleInsert(context,item);
      }
    }
);
  }
  return AllClassesGetter.createLookupItem(psiClass,AllClassesGetter.TRY_SHORTENING);
}
