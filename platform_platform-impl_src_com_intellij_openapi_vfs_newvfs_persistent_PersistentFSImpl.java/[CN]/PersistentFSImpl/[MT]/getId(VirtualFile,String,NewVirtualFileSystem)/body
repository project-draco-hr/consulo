{
  int parentId=getFileId(parent);
  if (parent == myFakeRoot) {
    myRootsLock.readLock().lock();
    try {
      String rootUrl=fs.getProtocol() + "://" + VfsImplUtil.normalize(fs,childName);
      VirtualFileSystemEntry root=myRoots.get(rootUrl);
      return root == null ? 0 : root.getId();
    }
  finally {
      myRootsLock.readLock().unlock();
    }
  }
  int[] children=FSRecords.list(parentId);
  if (children.length > 0) {
    int nameId=FSRecords.getNameId(childName);
    for (    final int childId : children) {
      if (nameId == FSRecords.getNameId(childId)) {
        return childId;
      }
    }
  }
  for (  final int childId : children) {
    if (namesEqual(fs,childName,FSRecords.getName(childId)))     return childId;
  }
  final VirtualFile fake=new FakeVirtualFile(parent,childName);
  final FileAttributes attributes=fs.getAttributes(fake);
  if (attributes != null) {
    final int child=createAndFillRecord(fs,fake,parentId,attributes);
    FSRecords.updateList(parentId,ArrayUtil.append(children,child));
    return child;
  }
  return 0;
}
