{
synchronized (LOCK) {
    LOG.assertTrue(myInternalTemplatesManager != null);
    if (ApplicationManager.getApplication().isUnitTestMode()) {
      String text=getTestClassTemplateText(templateName);
      FileTemplateImpl template=new FileTemplateImpl(normalizeText(text),templateName + "ForTest","java");
      template.setInternal(true);
      return template;
    }
    FileTemplateImpl template=(FileTemplateImpl)myInternalTemplatesManager.getTemplate(templateName);
    if (template == null) {
      template=(FileTemplateImpl)getTemplate(templateName);
    }
    if (template == null) {
      template=(FileTemplateImpl)getJ2eeTemplate(templateName);
      if (template != null) {
        template.setAdjust(true);
      }
 else {
        String text=normalizeText(getDefaultClassTemplateText(templateName));
        template=(FileTemplateImpl)myInternalTemplatesManager.addTemplate(templateName,"java");
        template.setText(text);
      }
    }
    template.setInternal(true);
    return template;
  }
}
