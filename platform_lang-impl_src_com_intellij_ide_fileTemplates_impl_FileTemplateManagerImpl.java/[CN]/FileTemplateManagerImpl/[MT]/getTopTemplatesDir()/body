{
synchronized (TOP_DIRS_LOCK) {
    if (ourTopDirs != null) {
      return ourTopDirs;
    }
    Set<VirtualFile> dirList=new THashSet<VirtualFile>();
    appendDefaultTemplatesDirFromClassloader(FileTemplateManagerImpl.class.getClassLoader(),dirList);
    PluginDescriptor[] plugins=ApplicationManager.getApplication().getPlugins();
    for (    PluginDescriptor plugin : plugins) {
      appendDefaultTemplatesDirFromClassloader(plugin.getPluginClassLoader(),dirList);
    }
    ourTopDirs=VfsUtil.toVirtualFileArray(dirList);
    for (    VirtualFile topDir : ourTopDirs) {
      topDir.refresh(true,true);
    }
    return ourTopDirs;
  }
}
