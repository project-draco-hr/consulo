{
  final Element recentElement=element.getChild(ELEMENT_RECENT_TEMPLATES);
  if (recentElement != null) {
    myRecentList.readExternal(recentElement);
  }
  final DeletedTemplatesManager deletedDefaults=new DeletedTemplatesManager();
  Element deletedTemplatesElement=element.getChild(ELEMENT_DELETED_TEMPLATES);
  if (deletedTemplatesElement != null) {
    deletedDefaults.readExternal(deletedTemplatesElement);
  }
  final DeletedTemplatesManager deletedIncludes=new DeletedTemplatesManager();
  Element deletedIncludesElement=element.getChild(ELEMENT_DELETED_INCLUDES);
  if (deletedIncludesElement != null) {
    deletedIncludes.readExternal(deletedIncludesElement);
  }
  final Set<String> templateNamesWithReformatOff=new HashSet<String>();
  final Element templatesElement=element.getChild(ELEMENT_TEMPLATES);
  if (templatesElement != null) {
    final List children=templatesElement.getChildren();
    for (    final Object child : children) {
      final Element childElement=(Element)child;
      boolean reformat=Boolean.TRUE.toString().equals(childElement.getAttributeValue(ExportableFileTemplateSettings.ATTRIBUTE_REFORMAT));
      if (!reformat) {
        final String name=childElement.getAttributeValue(ExportableFileTemplateSettings.ATTRIBUTE_NAME);
        templateNamesWithReformatOff.add(name);
      }
    }
  }
  ExportableFileTemplateSettings exportableFileTemplateSettings=ServiceManager.getService(ExportableFileTemplateSettings.class);
  if (!exportableFileTemplateSettings.isLoaded()) {
    ExportableFileTemplateSettings.doLoad(this,element);
  }
  final boolean hasDeletedDefaultsInOlderFormat=!deletedDefaults.DELETED_DEFAULT_TEMPLATES.isEmpty();
  final boolean hasDeletedincludesinOlderFormat=!deletedIncludes.DELETED_DEFAULT_TEMPLATES.isEmpty();
  final boolean hasTemplatesWithReformatAttibuteAltered=!templateNamesWithReformatOff.isEmpty();
  final boolean hasSettingsInOlderFormat=hasDeletedDefaultsInOlderFormat || hasDeletedincludesinOlderFormat || hasTemplatesWithReformatAttibuteAltered;
  if (hasSettingsInOlderFormat) {
    final Collection<FileTemplateBase> allDefaults=myDefaultTemplatesManager.getAllTemplates(true);
    if (hasDeletedDefaultsInOlderFormat) {
      applyDeletedState(deletedDefaults,allDefaults);
    }
    if (hasDeletedincludesinOlderFormat) {
      applyDeletedState(deletedIncludes,myPatternsManager.getAllTemplates(true));
    }
    if (hasTemplatesWithReformatAttibuteAltered) {
      applyReformatState(templateNamesWithReformatOff,allDefaults);
      applyReformatState(templateNamesWithReformatOff,myInternalTemplatesManager.getAllTemplates(true));
    }
  }
}
