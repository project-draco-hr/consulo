{
  LOG.assertTrue(!StringUtil.isEmpty(myDefaultTemplatesDir),myDefaultTemplatesDir);
  VirtualFile[] topDirs=getTopTemplatesDir();
  if (LOG.isDebugEnabled()) {
    @NonNls String message="Top dirs found: ";
    for (int i=0; i < topDirs.length; i++) {
      VirtualFile topDir=topDirs[i];
      message+=(i > 0 ? ", " : "") + topDir.getPresentableUrl();
    }
    LOG.debug(message);
  }
  Set<VirtualFile> templatesList=new THashSet<VirtualFile>();
  for (  VirtualFile topDir : topDirs) {
    VirtualFile parentDir=myDefaultTemplatesDir.equals(".") ? topDir : topDir.findChild(myDefaultTemplatesDir);
    if (parentDir != null) {
      templatesList.addAll(listDir(parentDir));
    }
  }
  removeDeletedTemplates(templatesList);
  return templatesList;
}
