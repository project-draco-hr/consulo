{
  PsiManager psiManager=myNewExpression.getManager();
  final Project project=psiManager.getProject();
  final PsiElementFactory elementFactory=psiManager.getElementFactory();
  final PsiClass psiClass=CreateFromUsageUtils.createClass(getReferenceElement(myNewExpression),false,null);
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      try {
        if (psiClass == null)         return;
        setupInheritance(myNewExpression,psiClass);
        setupGenericParameters(myNewExpression,psiClass);
        PsiExpressionList argList=myNewExpression.getArgumentList();
        if (argList != null && argList.getExpressions().length > 0) {
          PsiMethod constructor=elementFactory.createConstructor();
          constructor=(PsiMethod)psiClass.add(constructor);
          TemplateBuilder templateBuilder=new TemplateBuilder(psiClass);
          CreateFromUsageUtils.setupMethodParameters(constructor,templateBuilder,argList,getTargetSubstitutor(myNewExpression));
          setupSuperCall(psiClass,constructor,templateBuilder);
          getReferenceElement(myNewExpression).bindToElement(psiClass);
          Template template=templateBuilder.buildTemplate();
          Editor editor=positionCursor(project,psiClass.getContainingFile(),psiClass);
          TextRange textRange=psiClass.getTextRange();
          editor.getDocument().deleteString(textRange.getStartOffset(),textRange.getEndOffset());
          startTemplate(editor,template,project);
        }
 else {
          positionCursor(project,psiClass.getContainingFile(),psiClass);
        }
      }
 catch (      IncorrectOperationException e) {
        LOG.error(e);
      }
    }
  }
);
}
