{
  Collection<XLineBreakpointImpl> breakpoints=myBreakpoints.getKeysByValue(document);
  if (breakpoints == null)   return;
  TIntHashSet lines=new TIntHashSet();
  final List<XLineBreakpointImpl> toRemove=new ArrayList<XLineBreakpointImpl>();
  for (  XLineBreakpointImpl breakpoint : breakpoints) {
    breakpoint.updatePosition();
    if (!breakpoint.isValid() || !lines.add(breakpoint.getLine())) {
      toRemove.add(breakpoint);
    }
  }
  new WriteAction(){
    protected void run(    final Result result){
      for (      XLineBreakpointImpl breakpoint : toRemove) {
        XDebuggerManager.getInstance(myProject).getBreakpointManager().removeBreakpoint(breakpoint);
      }
    }
  }
.execute();
}
