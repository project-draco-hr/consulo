{
  Collection<XLineBreakpointImpl> breakpoints=myBreakpoints.getKeysByValue(document);
  if (breakpoints == null)   return;
  TIntHashSet lines=new TIntHashSet();
  final List<XBreakpoint<?>> toRemove=new ArrayList<XBreakpoint<?>>();
  for (  XLineBreakpointImpl breakpoint : breakpoints) {
    breakpoint.updatePosition();
    if (!breakpoint.isValid() || !lines.add(breakpoint.getLine())) {
      toRemove.add(breakpoint);
    }
  }
  removeBreakpoints(toRemove);
}
