{
  Project project=e.getData(PlatformDataKeys.PROJECT);
  String fileText=e.getData(PlatformDataKeys.FILE_TEXT);
  VirtualFile file=e.getData(PlatformDataKeys.VIRTUAL_FILE);
  String extension=file.getExtension();
  String nameWithoutExtension=file.getNameWithoutExtension();
  AllFileTemplatesConfigurable fileTemplateOptions=new AllFileTemplatesConfigurable();
  ConfigureTemplatesDialog dialog=new ConfigureTemplatesDialog(project,fileTemplateOptions);
  PsiFile psiFile=e.getData(LangDataKeys.PSI_FILE);
  for (  SaveFileAsTemplateHandler handler : Extensions.getExtensions(SaveFileAsTemplateHandler.EP_NAME)) {
    String textFromHandler=handler.getTemplateText(psiFile,fileText,nameWithoutExtension);
    if (textFromHandler != null) {
      fileText=textFromHandler;
      break;
    }
  }
  fileTemplateOptions.createNewTemplate(nameWithoutExtension,extension,fileText);
  dialog.show();
}
