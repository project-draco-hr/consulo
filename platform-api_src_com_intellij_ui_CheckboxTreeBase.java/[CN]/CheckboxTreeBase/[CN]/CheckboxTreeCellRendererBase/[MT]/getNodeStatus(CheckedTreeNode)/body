{
  if (node.getChildCount() == 0)   return node.isChecked() ? NodeState.FULL : NodeState.CLEAR;
  NodeState result=null;
  for (int i=0; i < node.getChildCount(); i++) {
    TreeNode child=node.getChildAt(i);
    if (child instanceof CheckedTreeNode) {
      NodeState childStatus=getNodeStatus((CheckedTreeNode)child);
      if (childStatus == NodeState.PARTIAL)       return NodeState.PARTIAL;
      if (result == null) {
        result=childStatus;
      }
 else       if (result != childStatus) {
        return NodeState.PARTIAL;
      }
    }
  }
  return result == null ? NodeState.CLEAR : result;
}
