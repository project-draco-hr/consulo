{
  final boolean checked=node.isChecked();
  if (node.getChildCount() == 0)   return checked ? NodeState.FULL : NodeState.CLEAR;
  NodeState result=null;
  for (int i=0; i < node.getChildCount(); i++) {
    TreeNode child=node.getChildAt(i);
    NodeState childStatus=child instanceof CheckedTreeNode ? getNodeStatus((CheckedTreeNode)child) : checked ? NodeState.FULL : NodeState.CLEAR;
    if (childStatus == NodeState.PARTIAL)     return NodeState.PARTIAL;
    if (result == null) {
      result=childStatus;
    }
 else     if (result != childStatus) {
      return NodeState.PARTIAL;
    }
  }
  return result == null ? NodeState.CLEAR : result;
}
