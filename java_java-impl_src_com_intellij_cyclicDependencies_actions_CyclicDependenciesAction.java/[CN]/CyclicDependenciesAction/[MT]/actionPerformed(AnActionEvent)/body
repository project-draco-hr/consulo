{
  DataContext dataContext=e.getDataContext();
  final Project project=PlatformDataKeys.PROJECT.getData(dataContext);
  final Module module=LangDataKeys.MODULE.getData(dataContext);
  if (project != null) {
    PsiFile psiFile=LangDataKeys.PSI_FILE.getData(dataContext);
    if (psiFile != null && !(psiFile instanceof PsiJavaFile)) {
      return;
    }
    AnalysisScope scope=getInspectionScope(dataContext);
    if (scope == null || scope.getScopeType() != AnalysisScope.MODULES) {
      ProjectModuleOrPackageDialog dlg=null;
      if (module != null) {
        dlg=new ProjectModuleOrPackageDialog(ModuleUtil.getModuleNameInReadAction(module),scope);
        dlg.show();
        if (!dlg.isOK())         return;
      }
      if (dlg == null || dlg.isProjectScopeSelected()) {
        scope=getProjectScope(dataContext);
      }
 else {
        if (dlg.isModuleScopeSelected()) {
          scope=getModuleScope(dataContext);
        }
      }
    }
    FileDocumentManager.getInstance().saveAllDocuments();
    new CyclicDependenciesHandler(project,scope).analyze();
  }
}
