{
  final LibraryTable.ModifiableModel moduleLibraryModel=layer.getModuleLibraryTable().getModifiableModel();
  final PersistentLibraryKind kind=libraryType == null ? null : libraryType.getKind();
  final Library library=((LibraryTableBase.ModifiableModelEx)moduleLibraryModel).createLibrary(null,kind);
  final LibraryEx.ModifiableModelEx libModel=(LibraryEx.ModifiableModelEx)library.getModifiableModel();
  for (  OrderRoot root : roots) {
    if (root.isJarDirectory()) {
      libModel.addJarDirectory(root.getFile(),false,root.getType());
    }
 else {
      libModel.addRoot(root.getFile(),root.getType());
    }
  }
  libModel.commit();
  return library;
}
