{
  int startLine=e.getOldLength() == 0 ? myOldEndLine : getVisualPositionLine(e.getOffset());
  int newEndLine=e.getNewLength() == 0 ? startLine : getVisualPositionLine(e.getOffset() + e.getNewLength());
  int oldEndLine=myOldEndLine;
  final int lineWidthSize=myLineWidths.size();
  if (lineWidthSize == 0) {
    reset();
  }
 else {
    final int min=Math.min(oldEndLine,newEndLine);
    final boolean toAddNewLines=min >= lineWidthSize;
    if (toAddNewLines) {
      final int[] delta=new int[min - lineWidthSize + 1];
      myLineWidths.insert(lineWidthSize,delta);
    }
    for (int i=startLine; i <= min; i++)     myLineWidths.set(i,-1);
    if (newEndLine > oldEndLine) {
      int[] delta=new int[newEndLine - oldEndLine];
      Arrays.fill(delta,-1);
      myLineWidths.insert(oldEndLine + 1,delta);
    }
 else     if (oldEndLine > newEndLine && !toAddNewLines) {
      myLineWidths.remove(newEndLine + 1,oldEndLine - newEndLine);
    }
    myIsDirty=true;
  }
}
