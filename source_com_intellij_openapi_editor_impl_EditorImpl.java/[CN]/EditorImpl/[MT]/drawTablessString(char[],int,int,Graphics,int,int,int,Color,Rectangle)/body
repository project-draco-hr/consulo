{
  int endX=x;
  if (start < end) {
    FontInfo font=fontForChar(text[start],fontType);
    for (int j=start; j < end; j++) {
      final char c=text[j];
      FontInfo newFont=fontForChar(c,fontType);
      if (font != newFont || endX > clip.x + clip.width) {
        if (!(x < clip.x && endX < clip.x || x > clip.x + clip.width && endX > clip.x + clip.width)) {
          drawCharsCached(g,text,start,j,x,y,fontType,fontColor);
        }
        start=j;
        x=endX;
        font=newFont;
      }
      if (x < clip.x && endX < clip.x) {
        start=j;
        x=endX;
        font=newFont;
      }
 else       if (x > clip.x + clip.width) {
        return endX;
      }
      endX+=font.charWidth(c,myEditorComponent);
    }
    if (!(x < clip.x && endX < clip.x || x > clip.x + clip.width && endX > clip.x + clip.width)) {
      drawCharsCached(g,text,start,end,x,y,fontType,fontColor);
    }
  }
  return endX;
}
