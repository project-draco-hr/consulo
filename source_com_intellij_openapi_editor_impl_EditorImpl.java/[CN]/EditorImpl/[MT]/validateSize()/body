{
  if (myGutterSizeUpdater != null) {
    SwingUtilities.invokeLater(myGutterSizeUpdater);
  }
  Dimension dim=getPreferredSize();
  if (!dim.equals(myPreferredSize)) {
    myPreferredSize=dim;
    stopOptimizedScrolling();
    myScrollPane.getViewport().setViewSize(myPreferredSize);
    int lineNum=Math.max(1,getDocument().getLineCount());
    myGutterComponent.setLineNumberAreaWidth(getFontMetrics(Font.PLAIN).stringWidth(Integer.toString(lineNum + 2)) + 6);
    final JViewport rowHeader=myScrollPane.getRowHeader();
    if (rowHeader != null) {
      rowHeader.setViewSize(myGutterComponent.getPreferredSize());
    }
    getScrollPane().revalidate();
    myEditorComponent.repaint();
    myScrollPane.repaint();
    myMarkupModel.repaint();
  }
}
