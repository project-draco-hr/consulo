{
  Project project=e.getData(PlatformDataKeys.PROJECT);
  final List<VirtualFile> files;
  final List<VirtualFile> unversionedFiles=e.getData(ChangesListView.UNVERSIONED_FILES_DATA_KEY);
  if (unversionedFiles == null || unversionedFiles.isEmpty()) {
    final VirtualFile unversionedFile=getUnversionedFile(e.getDataContext());
    if (unversionedFile == null) {
      return;
    }
    files=Collections.singletonList(unversionedFile);
  }
 else {
    files=unversionedFiles;
  }
  final ChangeListManagerImpl changeListManager=ChangeListManagerImpl.getInstanceImpl(project);
  changeListManager.addUnversionedFiles(changeListManager.getDefaultChangeList(),files);
}
