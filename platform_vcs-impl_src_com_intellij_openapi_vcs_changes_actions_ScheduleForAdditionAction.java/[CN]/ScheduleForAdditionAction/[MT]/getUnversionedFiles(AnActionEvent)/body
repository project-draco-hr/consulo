{
  List<VirtualFile> unversionedFiles=getFromChangesView(e);
  if (unversionedFiles != null && !unversionedFiles.isEmpty()) {
    return unversionedFiles;
  }
  final VirtualFile[] files=getFromSelection(e);
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  if (files == null || project == null) {
    return Collections.emptyList();
  }
  ProjectLevelVcsManager vcsManager=ProjectLevelVcsManager.getInstance(project);
  FileStatusManager fileStatusManager=FileStatusManager.getInstance(project);
  unversionedFiles=new ArrayList<VirtualFile>();
  for (  VirtualFile file : files) {
    if (isFileUnversioned(file,vcsManager,fileStatusManager)) {
      unversionedFiles.add(file);
    }
  }
  return unversionedFiles;
}
