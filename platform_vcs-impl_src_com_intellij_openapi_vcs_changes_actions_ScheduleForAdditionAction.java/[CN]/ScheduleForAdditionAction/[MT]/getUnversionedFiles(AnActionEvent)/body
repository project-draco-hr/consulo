{
  List<VirtualFile> unversionedFiles=e.getData(ChangesListView.UNVERSIONED_FILES_DATA_KEY);
  if (unversionedFiles != null && !unversionedFiles.isEmpty()) {
    return unversionedFiles;
  }
  unversionedFiles=new ArrayList<VirtualFile>();
  final VirtualFile[] files=PlatformDataKeys.VIRTUAL_FILE_ARRAY.getData(e.getDataContext());
  if (files == null) {
    return unversionedFiles;
  }
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  if (project == null) {
    return unversionedFiles;
  }
  for (  VirtualFile file : files) {
    AbstractVcs vcs=ProjectLevelVcsManager.getInstance(project).getVcsFor(file);
    if (vcs != null && !vcs.areDirectoriesVersionedItems() && file.isDirectory() || FileStatusManager.getInstance(project).getStatus(file) == FileStatus.UNKNOWN) {
      unversionedFiles.add(file);
    }
  }
  return unversionedFiles;
}
