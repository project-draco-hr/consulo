{
  myPsiDocumentManager=psiDocumentManager;
  myPsiManager=psiManager;
  myFileEditorManager=fileEditorManager;
  myProject=project;
  myTemplateManager=templateManager;
  project.getMessageBus().connect().subscribe(ProjectTopics.PROJECT_ROOTS,new ModuleRootListener(){
    public void beforeRootsChange(    ModuleRootEvent event){
      final Set<PsiFile> files=new HashSet<PsiFile>(myListenerMap.keySet());
      for (      PsiFile psiFile : files) {
        removeDocListener(myPsiDocumentManager.getDocument(psiFile),psiFile);
      }
    }
    public void rootsChanged(    ModuleRootEvent event){
      final FileDocumentManager documentManager=FileDocumentManager.getInstance();
      for (      VirtualFile file : myFileEditorManager.getOpenFiles()) {
        addDocListener(documentManager.getDocument(file));
      }
    }
  }
);
}
