{
  if (document == null)   return;
  final VirtualFile file=myDocumentManager.getFile(document);
  if (file != null && file.isValid() && !myListenerMap.containsKey(file)) {
    final PsiFile psiFile=myPsiManager.findFile(file);
    if (psiFile == null || !psiFile.isPhysical())     return;
    final MyDocumentChangeAdapter adapter=new MyDocumentChangeAdapter();
    document.addDocumentListener(adapter);
    myListenerMap.put(file,adapter);
  }
}
