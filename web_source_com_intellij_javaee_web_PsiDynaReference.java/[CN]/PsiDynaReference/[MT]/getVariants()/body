{
switch (myReferences.size()) {
case 0:
    return new Object[0];
case 1:
  return myReferences.get(0).getVariants();
default :
int minOffset=getRangeInElement().getStartOffset();
final String text=myElement.getText();
List<Object> variants=new ArrayList<Object>();
for (PsiReference ref : myReferences) {
final int startOffset=ref.getRangeInElement().getStartOffset();
final String prefix;
if (startOffset > minOffset) {
prefix=text.substring(minOffset,startOffset);
}
 else {
prefix=null;
}
Object[] refVariants=ref.getVariants();
for (Object refVariant : refVariants) {
if (prefix != null) {
if (refVariant instanceof CandidateInfo) {
  refVariant=((CandidateInfo)refVariant).getElement();
}
final LookupItem item=LookupItemUtil.objectToLookupItem(refVariant);
final String s=item.getLookupString();
item.setLookupString(prefix + s);
variants.add(item);
}
 else {
variants.add(refVariant);
}
}
}
return variants.toArray();
}
}
