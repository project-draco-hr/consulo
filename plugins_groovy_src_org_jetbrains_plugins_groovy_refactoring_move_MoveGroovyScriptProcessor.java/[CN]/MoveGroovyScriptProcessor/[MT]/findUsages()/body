{
  List<UsageInfo> allUsages=new ArrayList<UsageInfo>();
  MultiMap<PsiElement,String> conflicts=new MultiMap<PsiElement,String>();
  final List<PsiElement> elements=getElements();
  for (  PsiElement element : elements) {
    final GroovyFile groovyFile=(GroovyFile)element;
    final PsiClass[] classes=groovyFile.getClasses();
    for (    PsiClass aClass : classes) {
      String newName=getTargetPackage().getQualifiedName() + aClass.getName();
      final UsageInfo[] usages=MoveClassesOrPackagesUtil.findUsages(aClass,isSearchInComments(),isSearchInNonJavaFiles(),newName);
      allUsages.addAll(new ArrayList<UsageInfo>(Arrays.asList(usages)));
    }
  }
  myMoveDestination.analyzeModuleConflicts(elements,conflicts,allUsages.toArray(new UsageInfo[allUsages.size()]));
  if (!conflicts.isEmpty()) {
    for (    PsiElement element : conflicts.keySet()) {
      allUsages.add(new ConflictsUsageInfo(element,conflicts.get(element)));
    }
  }
  return UsageViewUtil.removeDuplicatedUsages(allUsages.toArray(new UsageInfo[allUsages.size()]));
}
