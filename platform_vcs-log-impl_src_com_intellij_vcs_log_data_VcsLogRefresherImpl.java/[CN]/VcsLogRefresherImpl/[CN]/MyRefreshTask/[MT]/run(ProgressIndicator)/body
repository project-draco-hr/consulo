{
  DataPack dataPack=myCurrentDataPack;
  while (true) {
    List<RefreshRequest> requests=mySingleTaskController.popRequests();
    Collection<VirtualFile> rootsToRefresh=getRootsToRefresh(requests);
    if (rootsToRefresh.isEmpty()) {
      mySingleTaskController.taskCompleted(dataPack);
      break;
    }
    dataPack=doRefresh(rootsToRefresh);
  }
}
