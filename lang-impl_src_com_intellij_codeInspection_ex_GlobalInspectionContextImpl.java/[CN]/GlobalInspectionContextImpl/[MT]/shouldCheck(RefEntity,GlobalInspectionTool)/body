{
  if (entity instanceof RefElement) {
    final RefElementImpl refElement=(RefElementImpl)entity;
    if (refElement.isSuppressed(tool.getShortName()))     return false;
    final PsiFile file=refElement.getContainingFile();
    if (file == null)     return false;
    if (RUN_WITH_EDITOR_PROFILE) {
      final InspectionProfile inspectionProfile=InspectionProjectProfileManager.getInstance(file.getProject()).getInspectionProfile(file);
      final Set<Pair<InspectionTool,InspectionProfile>> tools=myTools.get(tool.getShortName());
      for (      Pair<InspectionTool,InspectionProfile> inspectionProfilePair : tools) {
        if (Comparing.strEqual(inspectionProfilePair.second.getName(),inspectionProfile.getName())) {
          return ((GlobalInspectionToolWrapper)inspectionProfilePair.first).getTool() == tool;
        }
      }
      return false;
    }
  }
  return true;
}
