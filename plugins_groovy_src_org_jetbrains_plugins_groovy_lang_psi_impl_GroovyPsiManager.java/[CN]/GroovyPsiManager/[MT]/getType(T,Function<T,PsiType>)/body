{
  PsiType type=myCalculatedTypes.get(element);
  if (type == null) {
    type=calculator.fun(element);
    if (type == null) {
      type=PsiType.NULL;
    }
    type=ConcurrencyUtil.cacheOrGet(myCalculatedTypes,element,type);
  }
  if (!type.isValid()) {
    LOG.error("Type is invalid: " + type);
  }
  return PsiType.NULL.equals(type) ? null : type;
}
