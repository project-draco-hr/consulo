{
  final JpsRemoteProto.Message.Request.SetupCommand.Builder cmdBuilder=JpsRemoteProto.Message.Request.SetupCommand.newBuilder();
  if (!pathVars.isEmpty()) {
    for (    Map.Entry<String,String> entry : pathVars.entrySet()) {
      final String var=entry.getKey();
      final String value=entry.getValue();
      if (var != null && value != null) {
        final JpsRemoteProto.Message.Request.SetupCommand.PathVariable.Builder pathVarBuilder=JpsRemoteProto.Message.Request.SetupCommand.PathVariable.newBuilder();
        cmdBuilder.addPathVariable(pathVarBuilder.setName(var).setValue(value).build());
      }
    }
  }
  if (!sdkAndLibs.isEmpty()) {
    for (    GlobalLibrary lib : sdkAndLibs) {
      final JpsRemoteProto.Message.Request.SetupCommand.GlobalLibrary.Builder libBuilder=JpsRemoteProto.Message.Request.SetupCommand.GlobalLibrary.newBuilder();
      libBuilder.setName(lib.getName()).addAllPath(lib.getPaths());
      if (lib instanceof SdkLibrary) {
        libBuilder.setHomePath(((SdkLibrary)lib).getHomePath());
      }
      cmdBuilder.addGlobalLibrary(libBuilder.build());
    }
  }
  cmdBuilder.setGlobalEncoding(globalEncoding);
  return JpsRemoteProto.Message.Request.newBuilder().setRequestType(JpsRemoteProto.Message.Request.Type.SETUP_COMMAND).setSetupCommand(cmdBuilder.build()).build();
}
