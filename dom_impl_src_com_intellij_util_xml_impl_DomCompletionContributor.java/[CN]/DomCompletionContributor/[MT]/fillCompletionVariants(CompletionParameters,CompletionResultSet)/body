{
  if (parameters.getCompletionType() != CompletionType.BASIC)   return;
  final PsiElement element=PsiTreeUtil.getParentOfType(parameters.getPosition(),XmlTag.class,XmlAttributeValue.class);
  if (element != null && !ApplicationManager.getApplication().runReadAction(new Computable<Boolean>(){
    public Boolean compute(){
      if (isSchemaEnumerated(element)) {
        return true;
      }
      final PsiReference[] references=myProvider.getReferencesByElement(element,new ProcessingContext());
      if (references.length > 0) {
        LegacyCompletionContributor.completeReference(parameters,result,new XmlCompletionData());
        return false;
      }
      return true;
    }
  }
).booleanValue()) {
    result.stopHere();
  }
}
