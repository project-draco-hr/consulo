{
  if (parameters.getCompletionType() != CompletionType.BASIC)   return true;
  final PsiElement element=PsiTreeUtil.getParentOfType(parameters.getPosition(),XmlTag.class,XmlAttributeValue.class);
  if (element == null)   return true;
  if (isSchemaEnumerated(element))   return true;
  final PsiReference[] references=ApplicationManager.getApplication().runReadAction(new Computable<PsiReference[]>(){
    public PsiReference[] compute(){
      return myProvider.getReferencesByElement(element,new ProcessingContext());
    }
  }
);
  if (references.length > 0) {
    LegacyCompletionContributor.completeReference(parameters,result,new XmlCompletionData());
    return false;
  }
  return true;
}
