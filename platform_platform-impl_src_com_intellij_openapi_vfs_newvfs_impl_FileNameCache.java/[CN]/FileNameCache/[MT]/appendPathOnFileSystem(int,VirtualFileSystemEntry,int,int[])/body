{
  NameSuffixEntry entry=getEntry(nameId);
  Object o=entry.getRawName();
  String suffix=entry.getSuffix();
  int rawNameLength=o instanceof String ? ((String)o).length() : ((byte[])o).length;
  int nameLength=rawNameLength + suffix.length();
  boolean appendSlash=SystemInfo.isWindows && parent == null && suffix.isEmpty() && rawNameLength == 2 && (o instanceof String ? ((String)o).charAt(1) : (char)((byte[])o)[1]) == ':';
  char[] chars;
  if (parent != null) {
    chars=parent.appendPathOnFileSystem(accumulatedPathLength + 1 + nameLength,positionRef);
    if (positionRef[0] > 0 && chars[positionRef[0] - 1] != '/') {
      chars[positionRef[0]++]='/';
    }
  }
 else {
    int rootPathLength=accumulatedPathLength + nameLength;
    if (appendSlash)     ++rootPathLength;
    chars=new char[rootPathLength];
  }
  if (o instanceof String) {
    positionRef[0]=VirtualFileSystemEntry.copyString(chars,positionRef[0],(String)o);
  }
 else {
    byte[] bytes=(byte[])o;
    int pos=positionRef[0];
    for (int i=0, len=bytes.length; i < len; i++) {
      chars[pos++]=(char)bytes[i];
    }
    positionRef[0]=pos;
  }
  if (appendSlash) {
    chars[positionRef[0]++]='/';
  }
 else {
    positionRef[0]=VirtualFileSystemEntry.copyString(chars,positionRef[0],suffix);
  }
  return chars;
}
