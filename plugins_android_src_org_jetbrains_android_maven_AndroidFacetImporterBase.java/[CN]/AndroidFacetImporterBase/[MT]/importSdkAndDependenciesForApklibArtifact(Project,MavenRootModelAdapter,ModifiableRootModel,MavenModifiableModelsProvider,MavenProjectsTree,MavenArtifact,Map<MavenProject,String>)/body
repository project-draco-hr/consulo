{
  final AndroidExternalApklibDependenciesManager adm=AndroidExternalApklibDependenciesManager.getInstance(project);
  final AndroidExternalApklibDependenciesManager.MyResolvedInfo resolvedInfo=adm.getResolvedInfoForArtifact(artifact.getMavenId());
  for (  OrderEntry entry : apklibModuleModel.getOrderEntries()) {
    if (entry instanceof ModuleOrderEntry || entry instanceof LibraryOrderEntry) {
      apklibModuleModel.removeOrderEntry(entry);
    }
  }
  if (resolvedInfo != null) {
    final Sdk sdk=findOrCreateAndroidPlatform(resolvedInfo.getSdkPath(),resolvedInfo.getApiLevel());
    if (sdk != null) {
      apklibModuleModel.setSdk(sdk);
      moveJdkOrderEntryDown(apklibModuleModel);
    }
    for (    AndroidExternalApklibDependenciesManager.MavenDependencyInfo depArtifactInfo : resolvedInfo.getApklibDependencies()) {
      final MavenId depMavenId=new MavenId(depArtifactInfo.getGroupId(),depArtifactInfo.getArtifactId(),depArtifactInfo.getVersion());
      final String type=depArtifactInfo.getType();
      if (AndroidMavenUtil.APKLIB_DEPENDENCY_AND_PACKAGING_TYPE.equals(type)) {
        final MavenProject depProject=mavenTree.findProject(depMavenId);
        if (depProject != null) {
          final String depModuleName=mavenProject2ModuleName.get(depProject);
          if (depModuleName != null) {
            addCompileModuleDependency(modelsProvider,apklibModuleModel,depModuleName);
          }
        }
 else {
          final String depApklibGenModuleName=AndroidMavenUtil.getModuleNameForExtApklibArtifact(depMavenId);
          addCompileModuleDependency(modelsProvider,apklibModuleModel,depApklibGenModuleName);
        }
      }
 else {
        final String libraryName=depArtifactInfo.getLibraryName();
        final ModifiableRootModel rootModel=rootModelAdapter.getRootModel();
        final LibraryOrderEntry libEntry=findLibraryByName(rootModel,libraryName);
        if (libEntry != null) {
          final Library library=libEntry.getLibrary();
          if (library != null && apklibModuleModel.findLibraryOrderEntry(library) == null) {
            final LibraryOrderEntry newLibEntry=apklibModuleModel.addLibraryEntry(library);
            newLibEntry.setExported(libEntry.isExported());
            newLibEntry.setScope(libEntry.getScope());
          }
        }
      }
    }
  }
 else {
    LOG.info("Cannot find sdk info for artifact " + artifact.getMavenId().getKey());
  }
}
