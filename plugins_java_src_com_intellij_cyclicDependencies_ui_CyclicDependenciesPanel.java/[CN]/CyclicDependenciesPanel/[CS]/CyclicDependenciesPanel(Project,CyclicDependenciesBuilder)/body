{
  super(new BorderLayout());
  myDependencies=builder.getCyclicDependencies();
  myBuilder=builder;
  myProject=project;
  myUsagesPanel=new DependenciesUsagesPanel(myProject,Collections.singletonList(builder.getForwardBuilder()));
  Disposer.register(this,myUsagesPanel);
  mySettings.UI_SHOW_MODULES=false;
  final Splitter treeSplitter=new Splitter();
  Disposer.register(this,new Disposable(){
    public void dispose(){
      treeSplitter.dispose();
    }
  }
);
  treeSplitter.setFirstComponent(ScrollPaneFactory.createScrollPane(myLeftTree));
  treeSplitter.setSecondComponent(ScrollPaneFactory.createScrollPane(myRightTree));
  final Splitter splitter=new Splitter(true);
  Disposer.register(this,new Disposable(){
    public void dispose(){
      splitter.dispose();
    }
  }
);
  splitter.setFirstComponent(treeSplitter);
  splitter.setSecondComponent(myUsagesPanel);
  add(splitter,BorderLayout.CENTER);
  add(createToolbar(),BorderLayout.NORTH);
  myRightTreeExpansionMonitor=PackageTreeExpansionMonitor.install(myRightTree,myProject);
  myLeftTreeExpansionMonitor=PackageTreeExpansionMonitor.install(myLeftTree,myProject);
  updateLeftTreeModel();
  updateRightTreeModel();
  myLeftTree.getSelectionModel().addTreeSelectionListener(new TreeSelectionListener(){
    public void valueChanged(    TreeSelectionEvent e){
      updateRightTreeModel();
      myUsagesPanel.setToInitialPosition();
    }
  }
);
  myRightTree.getSelectionModel().addTreeSelectionListener(new TreeSelectionListener(){
    public void valueChanged(    TreeSelectionEvent e){
      SwingUtilities.invokeLater(new Runnable(){
        public void run(){
          Set<PsiFile> searchIn=getSelectedScope(myRightTree);
          final PackageNode selectedPackageNode=getSelectedPackage(myRightTree);
          if (selectedPackageNode == null) {
            return;
          }
          final PackageDependenciesNode nextPackageNode=getNextPackageNode(selectedPackageNode);
          Set<PsiFile> searchFor=new HashSet<PsiFile>();
          Set<PackageNode> packNodes=new HashSet<PackageNode>();
          getPackageNodesHierarchy(selectedPackageNode,packNodes);
          for (          PackageNode packageNode : packNodes) {
            searchFor.addAll(myBuilder.getDependentFilesInPackage((PsiJavaPackage)packageNode.getPsiElement(),((PsiJavaPackage)nextPackageNode.getPsiElement())));
          }
          if (searchIn.isEmpty() || searchFor.isEmpty()) {
            myUsagesPanel.setToInitialPosition();
          }
 else {
            myBuilder.setRootNodeNameInUsageView(AnalysisScopeBundle.message("cyclic.dependencies.usage.view.root.node.text",((PsiJavaPackage)nextPackageNode.getPsiElement()).getQualifiedName(),((PsiJavaPackage)selectedPackageNode.getPsiElement()).getQualifiedName()));
            myUsagesPanel.findUsages(searchIn,searchFor);
          }
        }
      }
);
    }
  }
);
  initTree(myLeftTree);
  initTree(myRightTree);
  mySettings.UI_FILTER_LEGALS=false;
  mySettings.UI_FLATTEN_PACKAGES=false;
  TreeUtil.selectFirstNode(myLeftTree);
}
