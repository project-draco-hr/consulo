{
  String base=JavaTestUtil.getJavaTestDataPath() + "/compiler/notNullVerification/";
  String path=base + getTestName(false);
  String javaPath=path + ".java";
  String classPath=path + ".class";
  try {
    com.sun.tools.javac.Main.compile(new String[]{"-classpath",base + "annotations.jar",javaPath});
    FileInputStream stream=new FileInputStream(classPath);
    byte[] content=FileUtil.adaptiveLoadBytes(stream);
    stream.close();
    ClassReader reader=new ClassReader(content,0,content.length);
    ClassWriter writer=new PsiClassWriter(myFixture.getProject(),false);
    final NotNullVerifyingInstrumenter instrumenter=new NotNullVerifyingInstrumenter(writer);
    reader.accept(instrumenter,0);
    assertTrue(instrumenter.isModification());
    MyClassLoader classLoader=new MyClassLoader(getClass().getClassLoader());
    byte[] instrumented=writer.toByteArray();
    return classLoader.doDefineClass(getTestName(false),instrumented);
  }
  finally {
    FileUtil.delete(new File(classPath));
  }
}
