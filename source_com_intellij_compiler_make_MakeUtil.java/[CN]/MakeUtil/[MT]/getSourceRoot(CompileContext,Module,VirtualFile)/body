{
  final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(module.getProject()).getFileIndex();
  final VirtualFile root=fileIndex.getSourceRootForFile(file);
  if (root != null) {
    return root;
  }
  final VirtualFile[] sourceRoots=context.getSourceRoots(module);
  for (  final VirtualFile sourceRoot : sourceRoots) {
    if (fileIndex.isInSourceContent(sourceRoot)) {
      continue;
    }
    if (VfsUtil.isAncestor(sourceRoot,file,false)) {
      return sourceRoot;
    }
  }
  return null;
}
