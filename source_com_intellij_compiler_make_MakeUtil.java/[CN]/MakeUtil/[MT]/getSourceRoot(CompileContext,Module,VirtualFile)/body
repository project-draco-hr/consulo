{
  final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(module.getProject()).getFileIndex();
  final VirtualFile root=fileIndex.getSourceRootForFile(file);
  if (root != null) {
    return root;
  }
  final VirtualFile[] sourceRoots=context.getSourceRoots(module);
  for (int idx=0; idx < sourceRoots.length; idx++) {
    final VirtualFile sourceRoot=sourceRoots[idx];
    if (fileIndex.isInSourceContent(sourceRoot)) {
      continue;
    }
    if (VfsUtil.isAncestor(sourceRoot,file,false)) {
      return sourceRoot;
    }
  }
  return null;
}
