{
  int moduleCount=0;
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  if (project != null) {
    for (    Module aModule : (ModuleManager.getInstance(project).getModules())) {
      if (ModuleUtil.getExtension(aModule,PluginModuleExtension.class) != null) {
        moduleCount++;
      }
    }
  }
  boolean enabled=false;
  if (moduleCount > 1) {
    enabled=true;
  }
 else   if (moduleCount > 0) {
    final Module module=e.getData(LangDataKeys.MODULE);
    if (module == null || ModuleUtil.getExtension(module,PluginModuleExtension.class) == null) {
      enabled=true;
    }
  }
  e.getPresentation().setVisible(enabled);
  e.getPresentation().setEnabled(enabled);
  if (enabled) {
    e.getPresentation().setText(DevKitBundle.message("prepare.for.deployment.all"));
  }
}
