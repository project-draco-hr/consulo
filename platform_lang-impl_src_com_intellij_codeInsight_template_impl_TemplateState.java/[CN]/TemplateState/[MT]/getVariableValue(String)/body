{
  if (variableName.equals(TemplateImpl.SELECTION)) {
    return new TextResult(StringUtil.notNullize(getSelectionBeforeTemplate()));
  }
  if (variableName.equals(TemplateImpl.END)) {
    return new TextResult("");
  }
  if (myPredefinedVariableValues != null && myPredefinedVariableValues.containsKey(variableName)) {
    return new TextResult(myPredefinedVariableValues.get(variableName));
  }
  CharSequence text=myDocument.getCharsSequence();
  int segmentNumber=myTemplate.getVariableSegmentNumber(variableName);
  if (segmentNumber < 0) {
    return null;
  }
  int start=mySegments.getSegmentStart(segmentNumber);
  int end=mySegments.getSegmentEnd(segmentNumber);
  int length=myDocument.getTextLength();
  if (start > length || end > length) {
    return null;
  }
  return new TextResult(text.subSequence(start,end).toString());
}
