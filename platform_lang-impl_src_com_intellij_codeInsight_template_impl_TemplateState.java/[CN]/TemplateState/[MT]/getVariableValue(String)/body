{
  if (variableName.equals(TemplateImpl.SELECTION)) {
    final String selection=(String)getProperties().get(ExpressionContext.SELECTION);
    return new TextResult(selection == null ? "" : selection);
  }
  if (variableName.equals(TemplateImpl.END)) {
    return new TextResult("");
  }
  if (variableName.equals(TemplateImpl.ARG) && myArgument != null) {
    return new TextResult(myArgument);
  }
  CharSequence text=myDocument.getCharsSequence();
  int segmentNumber=myTemplate.getVariableSegmentNumber(variableName);
  if (segmentNumber < 0) {
    return null;
  }
  int start=mySegments.getSegmentStart(segmentNumber);
  int end=mySegments.getSegmentEnd(segmentNumber);
  int length=myDocument.getTextLength();
  if (start > length || end > length) {
    return null;
  }
  return new TextResult(text.subSequence(start,end).toString());
}
