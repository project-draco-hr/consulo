{
  if (variableName.equals(TemplateImpl.SELECTION)) {
    return new TextResult(StringUtil.notNullize(getSelectionBeforeTemplate()));
  }
  if (variableName.equals(TemplateImpl.END)) {
    return new TextResult("");
  }
  if (myPredefinedVariableValues != null) {
    String text=myPredefinedVariableValues.get(variableName);
    if (text != null) {
      return new TextResult(text);
    }
  }
  CharSequence text=myDocument.getCharsSequence();
  int segmentNumber=myTemplate.getVariableSegmentNumber(variableName);
  if (segmentNumber < 0 || mySegments.getSegmentsCount() <= segmentNumber) {
    return null;
  }
  int start=mySegments.getSegmentStart(segmentNumber);
  int end=mySegments.getSegmentEnd(segmentNumber);
  int length=myDocument.getTextLength();
  if (start > length || end > length) {
    return null;
  }
  return new TextResult(text.subSequence(start,end).toString());
}
