{
  TextRange range=TextRange.create(start,end);
  if (!TextRange.from(0,myDocument.getCharsSequence().length()).contains(range)) {
    LOG.error("Diagnostic for EA-54980. Can't extract " + range + " range. "+ presentTemplate(myTemplate),AttachmentFactory.createAttachment(myDocument));
  }
  String oldText=range.subSequence(myDocument.getCharsSequence()).toString();
  if (!oldText.equals(newValue)) {
    mySegments.setNeighboursGreedy(segmentNumber,false);
    myDocument.replaceString(start,end,newValue);
    int newEnd=start + newValue.length();
    mySegments.replaceSegmentAt(segmentNumber,start,newEnd);
    mySegments.setNeighboursGreedy(segmentNumber,true);
    fixOverlappedSegments(segmentNumber);
  }
}
