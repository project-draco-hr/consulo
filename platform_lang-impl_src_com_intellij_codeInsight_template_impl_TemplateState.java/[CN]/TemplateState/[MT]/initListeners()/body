{
  myEditorDocumentListener=new DocumentAdapter(){
    public void beforeDocumentChange(    DocumentEvent e){
      myDocumentChanged=true;
    }
  }
;
  myCommandListener=new CommandAdapter(){
    boolean started=false;
    public void commandStarted(    CommandEvent event){
      if (myEditor != null) {
        final int offset=myEditor.getCaretModel().getOffset();
        myDocumentChangesTerminateTemplate=myCurrentSegmentNumber >= 0 && (offset < mySegments.getSegmentStart(myCurrentSegmentNumber) || offset > mySegments.getSegmentEnd(myCurrentSegmentNumber));
      }
      started=true;
    }
    public void beforeCommandFinished(    CommandEvent event){
      if (started) {
        afterChangedUpdate();
      }
    }
  }
;
  myDocument.addDocumentListener(myEditorDocumentListener);
  CommandProcessor.getInstance().addCommandListener(myCommandListener);
}
