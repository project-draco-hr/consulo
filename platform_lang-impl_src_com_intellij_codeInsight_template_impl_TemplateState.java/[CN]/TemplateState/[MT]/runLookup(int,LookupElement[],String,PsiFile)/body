{
  if (myEditor == null)   return;
  final LookupManager lookupManager=LookupManager.getInstance(myProject);
  final LookupImpl lookup=(LookupImpl)lookupManager.showLookup(myEditor,lookupItems);
  if (lookup == null)   return;
  if (CodeInsightSettings.getInstance().AUTO_POPUP_COMPLETION_LOOKUP && myEditor.getUserData(InplaceRefactoring.INPLACE_RENAMER) == null) {
    lookup.setStartCompletionWhenNothingMatches(true);
  }
  lookup.setAdvertisementText(advertisingText);
  lookup.refreshUi(true,true);
  ourLookupShown=true;
  lookup.addLookupListener(new LookupAdapter(){
    public void lookupCanceled(    LookupEvent event){
      lookup.removeLookupListener(this);
      ourLookupShown=false;
    }
    public void itemSelected(    LookupEvent event){
      lookup.removeLookupListener(this);
      if (isFinished())       return;
      ourLookupShown=false;
      TemplateState.this.itemSelected(event.getItem(),psiFile,currentSegmentNumber,event.getCompletionChar(),lookupItems);
    }
  }
);
}
