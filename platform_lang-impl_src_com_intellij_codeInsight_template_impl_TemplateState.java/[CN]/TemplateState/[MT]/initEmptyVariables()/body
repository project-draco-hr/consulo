{
  int endSegmentNumber=myTemplate.getEndSegmentNumber();
  int selStart=myTemplate.getSelectionStartSegmentNumber();
  int selEnd=myTemplate.getSelectionEndSegmentNumber();
  IntArrayList indices=new IntArrayList();
  List<TemplateDocumentChange> changes=ContainerUtil.newArrayList();
  for (int i=0; i < myTemplate.getSegmentsCount(); i++) {
    int length=mySegments.getSegmentEnd(i) - mySegments.getSegmentStart(i);
    if (length != 0)     continue;
    if (i == endSegmentNumber || i == selStart || i == selEnd)     continue;
    String name=myTemplate.getSegmentName(i);
    for (int j=0; j < myTemplate.getVariableCount(); j++) {
      if (myTemplate.getVariableNameAt(j).equals(name)) {
        Expression e=myTemplate.getExpressionAt(j);
        @NonNls String marker="a";
        if (e instanceof MacroCallNode) {
          marker=((MacroCallNode)e).getMacro().getDefaultValue();
        }
        changes.add(new TemplateDocumentChange(marker,mySegments.getSegmentStart(i),mySegments.getSegmentEnd(i),i));
        indices.add(i);
        break;
      }
    }
  }
  executeChanges(changes);
  return indices;
}
