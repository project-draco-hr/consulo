{
  if (myEditor == null)   return;
  final LookupManager lookupManager=LookupManager.getInstance(myProject);
  final LookupImpl lookup=(LookupImpl)lookupManager.showLookup(myEditor,lookupItems.toArray(new LookupElement[lookupItems.size()]));
  if (lookup == null)   return;
  if (CodeInsightSettings.getInstance().AUTO_POPUP_COMPLETION_LOOKUP && myEditor.getUserData(InplaceRefactoring.INPLACE_RENAMER) == null) {
    lookup.setStartCompletionWhenNothingMatches(true);
  }
  if (advertisingText != null) {
    lookup.addAdvertisement(advertisingText,null);
  }
  lookup.refreshUi(true,true);
  ourLookupShown=true;
  lookup.addLookupListener(new LookupAdapter(){
    @Override public void lookupCanceled(    LookupEvent event){
      lookup.removeLookupListener(this);
      ourLookupShown=false;
    }
    @Override public void itemSelected(    LookupEvent event){
      lookup.removeLookupListener(this);
      if (isFinished())       return;
      ourLookupShown=false;
      LookupElement item=event.getItem();
      if (item instanceof TemplateExpressionLookupElement) {
        ((TemplateExpressionLookupElement)item).handleTemplateInsert(lookupItems,event.getCompletionChar());
      }
    }
  }
);
}
