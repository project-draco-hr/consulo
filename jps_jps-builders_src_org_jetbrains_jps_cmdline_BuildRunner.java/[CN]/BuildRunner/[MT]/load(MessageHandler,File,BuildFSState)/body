{
  ProjectTimestamps projectTimestamps=null;
  BuildDataManager dataManager=null;
  try {
    projectTimestamps=new ProjectTimestamps(dataStorageRoot);
    dataManager=new BuildDataManager(dataStorageRoot,STORE_TEMP_CACHES_IN_MEMORY);
    if (dataManager.versionDiffers()) {
      myForceCleanCaches=true;
      msgHandler.processMessage(new CompilerMessage("build",BuildMessage.Kind.INFO,"Dependency data format has changed, project rebuild required"));
    }
  }
 catch (  Exception e) {
    LOG.info(e);
    if (projectTimestamps != null) {
      projectTimestamps.close();
    }
    if (dataManager != null) {
      dataManager.close();
    }
    myForceCleanCaches=true;
    FileUtil.delete(dataStorageRoot);
    projectTimestamps=new ProjectTimestamps(dataStorageRoot);
    dataManager=new BuildDataManager(dataStorageRoot,STORE_TEMP_CACHES_IN_MEMORY);
    msgHandler.processMessage(new CompilerMessage("build",BuildMessage.Kind.INFO,"Project rebuild forced: " + e.getMessage()));
  }
  final JpsModel jpsModel=myModelLoader.loadModel();
  return new ProjectDescriptor(jpsModel,fsState,projectTimestamps,dataManager,BuildLoggingManager.DEFAULT);
}
