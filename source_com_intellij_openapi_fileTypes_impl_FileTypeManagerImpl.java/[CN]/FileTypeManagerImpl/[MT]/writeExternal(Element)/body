{
  parentNode.setAttribute(ATTRIBUTE_VERSION,String.valueOf(VERSION));
  Element element=new Element(ELEMENT_IGNOREFILES);
  parentNode.addContent(element);
  element.setAttribute(ATTRIBUTE_LIST,getIgnoredFilesList());
  Element map=new Element(ELEMENT_EXTENSIONMAP);
  parentNode.addContent(map);
  for (  FileType type : getRegisteredFileTypes()) {
    final List<FileNameMatcher> assocs=myPatternsTable.getAssociations(type);
    final Set<FileNameMatcher> defaultAssocs=new HashSet<FileNameMatcher>(myInitialAssociations.getAssociations(type));
    for (    FileNameMatcher matcher : assocs) {
      if (defaultAssocs.contains(matcher)) {
        defaultAssocs.remove(matcher);
      }
 else       if (shouldSave(type)) {
        Element mapping=new Element(ELEMENT_MAPPING);
        if (matcher instanceof ExtensionFileNameMatcher) {
          mapping.setAttribute(ATTRIBUTE_EXT,((ExtensionFileNameMatcher)matcher).getExtension());
        }
 else         if (matcher instanceof WildcardFileNameMatcher) {
          mapping.setAttribute(ATTRIBUTE_PATTERN,((WildcardFileNameMatcher)matcher).getPattern());
        }
 else {
          continue;
        }
        mapping.setAttribute(ATTRIBUTE_TYPE,type.getName());
        map.addContent(mapping);
      }
    }
    for (    FileNameMatcher matcher : defaultAssocs) {
      Element mapping=new Element(ELEMENT_REMOVED_MAPPING);
      if (matcher instanceof ExtensionFileNameMatcher) {
        mapping.setAttribute(ATTRIBUTE_EXT,((ExtensionFileNameMatcher)matcher).getExtension());
      }
 else       if (matcher instanceof WildcardFileNameMatcher) {
        mapping.setAttribute(ATTRIBUTE_PATTERN,((WildcardFileNameMatcher)matcher).getPattern());
      }
 else {
        continue;
      }
      mapping.setAttribute(ATTRIBUTE_TYPE,type.getName());
      map.addContent(mapping);
    }
  }
}
