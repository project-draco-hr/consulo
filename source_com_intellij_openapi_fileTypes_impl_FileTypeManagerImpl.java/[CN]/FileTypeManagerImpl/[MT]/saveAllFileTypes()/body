{
  File dir=getFileTypesDir(true);
  if (dir == null)   return;
  File[] files=getFileTypeFiles();
  ArrayList<String> filePaths=new ArrayList<String>();
  ArrayList<Document> documents=new ArrayList<Document>();
  UniqueFileNamesProvider namesProvider=new UniqueFileNamesProvider();
  Iterator<FileType> iterator=myFileTypes.iterator();
  while (iterator.hasNext()) {
    FileType fileType=iterator.next();
    if (!(fileType instanceof CustomFileType) || !shouldSave(fileType))     continue;
    if (myDefaultTypes.contains(fileType) && !isDefaultModified(fileType))     continue;
    Element root=new Element(ELEMENT_FILETYPE);
    writeHeader(root,fileType);
    writeSyntaxTableData(root,fileType);
    String name=namesProvider.suggestName(fileType.getName());
    String filePath=dir.getAbsolutePath() + File.separator + name+ XML_EXTENSION;
    filePaths.add(filePath);
    documents.add(new Document(root));
  }
  JDOMUtil.updateFileSet(files,filePaths.toArray(new String[filePaths.size()]),documents.toArray(new Document[documents.size()]),CodeStyleSettingsManager.getSettings(null).getLineSeparator());
}
