{
  NativeEvent nativeEvent=event.getNativeEvent();
  EventTarget eventTarget=nativeEvent.getEventTarget();
  if (!Element.is(eventTarget)) {
    return;
  }
  Element target=(Element)Element.as(eventTarget);
  int type=event.getTypeInt();
  if (type == Event.ONKEYDOWN) {
    setKeyPressed(true);
    if (DOM.getCaptureElement() != null)     return;
    boolean eventTargetsPopup=(target != null) && DOM.isOrHasChild(getElement(),target);
    int button=nativeEvent.getKeyCode();
    boolean alt=nativeEvent.getAltKey();
    boolean ctrl=nativeEvent.getCtrlKey();
    boolean shift=nativeEvent.getShiftKey();
    boolean hasModifiers=alt || ctrl || shift;
    if (eventTargetsPopup && isListPanelOpened()) {
      if (button == KeyCodes.KEY_UP && !hasModifiers) {
        moveCursor(-1);
        cancelAndPrevent(event);
      }
 else       if (button == KeyCodes.KEY_DOWN && !hasModifiers) {
        moveCursor(1);
        cancelAndPrevent(event);
      }
 else       if (button == KeyCodes.KEY_ENTER && !hasModifiers) {
        select(getHighlightRow());
        getChoiceButton().setFocus(false);
        ChangeEvent changeEvent=new ComboBoxChangeEvent(getHighlightRow(),ComboBoxChangeEvent.ChangeEventInputDevice.KEYBOARD);
        fireEvent(changeEvent);
        setKeyPressed(false);
      }
 else       if (button == KeyCodes.KEY_ESCAPE && !hasModifiers) {
        hideList();
        setKeyPressed(false);
      }
 else       if (button == KeyCodes.KEY_TAB && (!hasModifiers || !alt && !ctrl && shift)) {
        hideList();
        setKeyPressed(false);
      }
    }
 else     if (eventTargetsPopup && !hasModifiers && button == KeyCodes.KEY_ENTER && getModel().getCount() > 0) {
      showList(true);
    }
  }
 else   if (type == Event.ONKEYUP) {
    setKeyPressed(false);
  }
}
