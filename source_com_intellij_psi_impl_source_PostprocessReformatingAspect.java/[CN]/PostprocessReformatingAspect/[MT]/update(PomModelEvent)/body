{
  final TreeChangeEvent changeSet=(TreeChangeEvent)event.getChangeSet(myTreeAspect);
  if (changeSet == null)   return;
  final PsiElement psiElement=changeSet.getRootElement().getPsi();
  if (psiElement == null)   return;
  final FileViewProvider viewProvider=psiElement.getContainingFile().getViewProvider();
  if (!viewProvider.isEventSystemEnabled())   return;
  for (  final ASTNode node : changeSet.getChangedElements()) {
    final TreeChange treeChange=changeSet.getChangesByElement(node);
    for (    final ASTNode affectedChild : treeChange.getAffectedChildren()) {
      final ChangeInfo childChange=treeChange.getChangeByChild(affectedChild);
      if (myDisabled) {
        if (childChange.getChangeType() == ChangeInfo.ADD && affectedChild.getElementType() == ElementType.REFORMAT_MARKER) {
          final ASTNode next=TreeUtil.nextLeaf(affectedChild);
          final ASTNode prev=TreeUtil.prevLeaf(affectedChild);
          final ParserDefinition.SpaceRequirements spaceRequirements=getSpaceRequirements(prev,next);
          if (spaceRequirements == ParserDefinition.SpaceRequirements.MUST || spaceRequirements == ParserDefinition.SpaceRequirements.MUST_LINE_BREAK) {
            postponeFormatting(viewProvider,affectedChild);
          }
 else           affectedChild.getTreeParent().removeChild(affectedChild);
        }
        continue;
      }
switch (childChange.getChangeType()) {
case ChangeInfo.ADD:
        postponeFormatting(viewProvider,affectedChild);
      break;
case ChangeInfo.REPLACE:
    postponeFormatting(viewProvider,affectedChild);
  break;
}
}
}
}
