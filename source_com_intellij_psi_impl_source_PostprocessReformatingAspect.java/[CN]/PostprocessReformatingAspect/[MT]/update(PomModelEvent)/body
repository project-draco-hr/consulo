{
  if (myDisabled)   return;
  final TreeChangeEvent changeSet=(TreeChangeEvent)event.getChangeSet(myTreeAspect);
  if (changeSet == null)   return;
  final PsiElement psiElement=changeSet.getRootElement().getPsi();
  if (psiElement == null)   return;
  final FileViewProvider viewProvider=psiElement.getContainingFile().getViewProvider();
  if (!viewProvider.isEventSystemEnabled())   return;
  for (  final ASTNode node : changeSet.getChangedElements()) {
    final TreeChange treeChange=changeSet.getChangesByElement(node);
    for (    final ASTNode affectedChild : treeChange.getAffectedChildren()) {
      final ChangeInfo childChange=treeChange.getChangeByChild(affectedChild);
switch (childChange.getChangeType()) {
case ChangeInfo.ADD:
        postponeFormatting(viewProvider,affectedChild);
      break;
case ChangeInfo.REPLACE:
    postponeFormatting(viewProvider,affectedChild);
  break;
}
}
}
}
