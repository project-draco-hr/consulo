{
  final CodeStyleSettings styleSettings=CodeStyleSettingsManager.getSettings(myPsiManager.getProject());
  final PsiDocumentManager documentManager=PsiDocumentManager.getInstance(myPsiManager.getProject());
  final Document document=viewProvider.getDocument();
  final FileType fileType=viewProvider.getVirtualFile().getFileType();
  final Helper helper=new Helper(fileType,myPsiManager.getProject());
  final CodeFormatterFacade codeFormatter=new CodeFormatterFacade(styleSettings,helper);
  documentManager.commitDocument(document);
  codeFormatter.processText(viewProvider.getPsi(viewProvider.getBaseLanguage()),marker.getStartOffset(),marker.getStartOffset() == marker.getEndOffset() ? marker.getEndOffset() + 1 : marker.getEndOffset());
}
