{
  startElement(switchStmt);
  PsiElementFactory psiFactory=JavaPsiFacade.getInstance(switchStmt.getProject()).getElementFactory();
  PsiExpression caseExpression=switchStmt.getExpression();
  Set<PsiEnumConstant> enumVals=null;
  if (caseExpression != null) {
    caseExpression.accept(this);
    generateBoxingUnboxingInstructionFor(caseExpression,PsiType.INT);
    final PsiClass psiClass=PsiUtil.resolveClassInType(caseExpression.getType());
    if (psiClass != null && psiClass.isEnum()) {
      addInstruction(new FieldReferenceInstruction(caseExpression,"switch statement expression"));
      enumVals=new HashSet<PsiEnumConstant>();
      for (      PsiField f : psiClass.getFields()) {
        if (f instanceof PsiEnumConstant) {
          enumVals.add((PsiEnumConstant)f);
        }
      }
    }
 else {
      addInstruction(new PopInstruction());
    }
  }
  PsiCodeBlock body=switchStmt.getBody();
  if (body != null) {
    PsiStatement[] statements=body.getStatements();
    PsiSwitchLabelStatement defaultLabel=null;
    for (    PsiStatement statement : statements) {
      if (statement instanceof PsiSwitchLabelStatement) {
        PsiSwitchLabelStatement psiLabelStatement=(PsiSwitchLabelStatement)statement;
        if (psiLabelStatement.isDefaultCase()) {
          defaultLabel=psiLabelStatement;
        }
 else {
          try {
            int offset=getStartOffset(statement);
            PsiExpression caseValue=psiLabelStatement.getCaseValue();
            if (caseValue != null && caseExpression instanceof PsiReferenceExpression && ((PsiReferenceExpression)caseExpression).getQualifierExpression() == null && JavaPsiFacade.getInstance(body.getProject()).getConstantEvaluationHelper().computeConstantExpression(caseValue) != null) {
              PsiExpression psiComparison=psiFactory.createExpressionFromText(caseExpression.getText() + "==" + caseValue.getText(),switchStmt);
              psiComparison.accept(this);
            }
 else {
              pushUnknown();
            }
            addInstruction(new ConditionalGotoInstruction(offset,false,statement));
            if (enumVals != null) {
              if (caseValue instanceof PsiReferenceExpression) {
                enumVals.remove(((PsiReferenceExpression)caseValue).resolve());
              }
            }
          }
 catch (          IncorrectOperationException e) {
            LOG.error(e);
          }
        }
      }
    }
    if (enumVals == null || !enumVals.isEmpty()) {
      int offset=defaultLabel != null ? getStartOffset(defaultLabel) : getEndOffset(body);
      addInstruction(new GotoInstruction(offset));
    }
    body.accept(this);
  }
  finishElement(switchStmt);
}
