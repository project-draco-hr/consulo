{
  CacheEntry cacheEntry=getCacheEntryForVisualLine(position.visualLine);
  Document document=myEditor.getDocument();
  if (position.offset >= document.getTextLength() - 1) {
    cacheEntry.setLineEndPosition(position);
    return;
  }
  if (position.offset < 0 || (position.offset > 0 && position.offset < document.getTextLength() && document.getCharsSequence().charAt(position.offset - 1) != '\n')) {
    return;
  }
  cacheEntry.getTabData().clear();
  cacheEntry.getFoldingData().clear();
  cacheEntry.setLineStartPosition(position.clone(),position.visualLine);
}
