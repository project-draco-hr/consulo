{
  myBeforeChangeState.updateByDocumentOffsets(startOffset,endOffset);
  if (!myBeforeChangeState.valid) {
    return;
  }
  myNotAffectedByUpdateTailCacheEntries.clear();
  myNotAffectedByUpdateTailCacheEntries.addAll(myCache.subList(myBeforeChangeState.endCacheEntryIndex + 1,myCache.size()));
  int textLength=myEditor.getDocument().getTextLength();
  if (endOffset >= textLength && !myNotAffectedByUpdateTailCacheEntries.isEmpty() && myNotAffectedByUpdateTailCacheEntries.get(myNotAffectedByUpdateTailCacheEntries.size() - 1).startOffset >= textLength) {
    myNotAffectedByUpdateTailCacheEntries.remove(myNotAffectedByUpdateTailCacheEntries.size() - 1);
  }
  myCache.subList(myBeforeChangeState.startCacheEntryIndex + 1,myCache.size()).clear();
  for (  CacheEntry entry : myNotAffectedByUpdateTailCacheEntries) {
    entry.locked=true;
  }
  myCache.get(myBeforeChangeState.startCacheEntryIndex).collapse();
}
