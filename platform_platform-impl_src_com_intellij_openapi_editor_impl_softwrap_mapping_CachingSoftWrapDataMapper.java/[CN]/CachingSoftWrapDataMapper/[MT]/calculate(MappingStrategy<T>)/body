{
  T eagerMatch=strategy.eagerMatch();
  if (eagerMatch != null) {
    return eagerMatch;
  }
  ProcessingContext context=strategy.buildInitialContext();
  FoldingModelEx foldingModel=myEditor.getFoldingModel();
  boolean foldingState=foldingModel.isFoldingEnabled();
  foldingModel.setFoldingEnabled(true);
  CompositeDataProvider provider;
  try {
    provider=new CompositeDataProvider(new SoftWrapsDataProvider(myStorage),new FoldingDataProvider(myEditor.getFoldingModel().fetchTopLevel()),getTabulationDataProvider(context.visualLine));
  }
  finally {
    foldingModel.setFoldingEnabled(foldingState);
  }
  provider.advance(context.offset);
  while (provider.hasData()) {
    Pair<SoftWrapDataProviderKeys,?> data=provider.getData();
    T result=null;
    int sortingKey=provider.getSortingKey();
    if (context.offset <= sortingKey) {
      result=strategy.advance(context,sortingKey);
      if (result != null) {
        return result;
      }
    }
switch (data.first) {
case SOFT_WRAP:
      result=strategy.processSoftWrap(context,(SoftWrap)data.second);
    break;
case COLLAPSED_FOLDING:
  result=strategy.processFoldRegion(context,(FoldRegion)data.second);
break;
case TABULATION:
result=strategy.processTabulation(context,(TabData)data.second);
break;
}
if (result != null) {
return result;
}
provider.next();
}
return strategy.build(context);
}
