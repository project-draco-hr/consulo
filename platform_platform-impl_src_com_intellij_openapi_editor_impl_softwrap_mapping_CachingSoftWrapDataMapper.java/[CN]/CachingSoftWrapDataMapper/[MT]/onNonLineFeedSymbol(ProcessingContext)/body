{
  CacheEntry cacheEntry=getCacheEntryForVisualLine(context.visualLine);
  Document document=myEditor.getDocument();
  if (context.offset >= document.getTextLength() - 1) {
    cacheEntry.setLineEndPosition(context);
  }
  if (context.offset < 0 || (context.offset > 0 && context.offset < document.getTextLength() && document.getCharsSequence().charAt(context.offset - 1) != '\n')) {
    return;
  }
  cacheEntry.getTabData().clear();
  cacheEntry.getFoldingData().clear();
  cacheEntry.setLineStartPosition(context.clone(),context.visualLine);
}
