{
  if (DEBUG_SOFT_WRAP_PROCESSING) {
    log(String.format("xxxxxxxxxxxx CachingSoftWrapDataMapper.onRecalculationEnd(%s). Current cache size: %d",event,myCache.size()));
    if (myCache.size() < 10) {
      log("\tCurrent cache:");
      for (      CacheEntry cacheEntry : myCache) {
        log("\t\t" + cacheEntry);
      }
    }
  }
  myFoldData.deleteMarked();
  myAfterChangeState.updateByDocumentOffsets(event.getNewStartOffset(),event.getNewEndOffset(),event.getNewLogicalLinesDiff());
  myCache.addAll(myNotAffectedByUpdateTailCacheEntries);
  applyStateChange(event.getExactOffsetsDiff(),event.getNewEndOffset());
  myNotAffectedByUpdateTailCacheEntries.clear();
  if (DEBUG_SOFT_WRAP_PROCESSING) {
    log("After Applying state change");
    dumpCache();
  }
  myBeforeChangeState.cacheShouldBeUpdated=false;
}
