{
  if (!myBeforeChangeState.valid) {
    return;
  }
  int endIndex=Math.max(0,myCache.size() - 1);
  if (endIndex > 0 && endOffset < myEditor.getDocument().getTextLength() - 1) {
    endIndex--;
  }
  myAfterChangeState.updateByCacheIndices(myBeforeChangeState.startCacheEntryIndex,endIndex);
  myCache.subList(myAfterChangeState.endCacheEntryIndex + 1,myCache.size()).clear();
  myCache.addAll(myNotAffectedByUpdateTailCacheEntries);
  for (  CacheEntry entry : myNotAffectedByUpdateTailCacheEntries) {
    entry.locked=false;
  }
  applyStateChange();
  myNotAffectedByUpdateTailCacheEntries.clear();
  myBeforeChangeState.valid=false;
}
