{
  if (myCache.isEmpty()) {
    return new LogicalPosition(visual.line,visual.column,0,0,0,0,0);
  }
  if (!myCache.isEmpty()) {
    CacheEntry cacheEntry=myCache.get(myCache.size() - 1);
    if (visual.line > cacheEntry.visualLine) {
      int lineDiff=visual.line - cacheEntry.visualLine;
      return new LogicalPosition(cacheEntry.endLogicalLine + lineDiff,visual.column,cacheEntry.endSoftWrapLinesBefore + cacheEntry.endSoftWrapLinesCurrent,0,0,cacheEntry.endFoldedLines,0);
    }
  }
  return calculate(new VisualToLogicalCalculationStrategy(visual,myCache,myEditor,myStorage,myRepresentationHelper));
}
