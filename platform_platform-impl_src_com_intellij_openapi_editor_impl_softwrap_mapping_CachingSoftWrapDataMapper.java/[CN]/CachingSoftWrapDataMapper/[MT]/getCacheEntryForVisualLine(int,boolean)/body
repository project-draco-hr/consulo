{
  if (!myCache.isEmpty()) {
    CacheEntry lastEntry=myCache.get(myCache.size() - 1);
    if (lastEntry.visualLine == visualLine) {
      return lastEntry;
    }
 else     if (lastEntry.visualLine < visualLine && createIfNecessary) {
      CacheEntry result=new CacheEntry(visualLine,myEditor,myRepresentationHelper);
      myCache.add(result);
      return result;
    }
  }
  int start=0;
  int end=myCache.size() - 1;
  int cacheEntryIndex=-1;
  while (start <= end) {
    int i=(end + start) >>> 1;
    CacheEntry cacheEntry=myCache.get(i);
    if (cacheEntry.visualLine < visualLine) {
      start=i + 1;
      continue;
    }
    if (cacheEntry.visualLine > visualLine) {
      end=i - 1;
      continue;
    }
    cacheEntryIndex=i;
    break;
  }
  CacheEntry result=null;
  if (cacheEntryIndex < 0) {
    cacheEntryIndex=start;
    if (createIfNecessary) {
      myCache.add(cacheEntryIndex,result=new CacheEntry(visualLine,myEditor,myRepresentationHelper));
    }
  }
 else {
    result=myCache.get(cacheEntryIndex);
  }
  return result;
}
