{
  if (!myCache.isEmpty()) {
    CacheEntry lastEntry=myCache.get(myCache.size() - 1);
    if (lastEntry.visualLine == visualLine) {
      return lastEntry;
    }
 else     if (lastEntry.visualLine < visualLine && createIfNecessary) {
      CacheEntry result=new CacheEntry(visualLine,myEditor);
      myCache.add(result);
      return result;
    }
  }
  int cacheEntryIndex=getCacheEntryIndexForVisualLine(visualLine);
  CacheEntry result=null;
  if (cacheEntryIndex < 0) {
    cacheEntryIndex=-cacheEntryIndex - 1;
    if (createIfNecessary) {
      myCache.add(cacheEntryIndex,result=new CacheEntry(visualLine,myEditor));
    }
  }
 else {
    result=myCache.get(cacheEntryIndex);
  }
  return result;
}
