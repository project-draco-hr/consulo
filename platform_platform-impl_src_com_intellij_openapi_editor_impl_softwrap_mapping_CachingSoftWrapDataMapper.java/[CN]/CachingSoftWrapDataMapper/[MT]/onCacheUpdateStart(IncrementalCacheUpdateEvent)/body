{
  if (DEBUG_SOFT_WRAP_PROCESSING) {
    log(String.format("xxxxxxxxxxxx CachingSoftWrapDataMapper.onRecalculationStart(%s). Current cache size: %d",event,myCache.size()));
  }
  myNotAffectedByUpdateTailCacheEntries.clear();
  myFoldData.markForDeletion(event.getOldStartOffset(),event.getOldEndOffset());
  myBeforeChangeState.updateByDocumentOffsets(event.getOldStartOffset(),event.getOldEndOffset(),event.getOldLogicalLinesDiff());
  if (!myBeforeChangeState.cacheShouldBeUpdated) {
    if (DEBUG_SOFT_WRAP_PROCESSING) {
      log(String.format("xxxxxxxxxxxx CachingSoftWrapDataMapper.onRecalculationStart(): performing eager return"));
      dumpCache();
      log("");
    }
    return;
  }
  if (myBeforeChangeState.endCacheEntryIndex < myCache.size() - 1) {
    myNotAffectedByUpdateTailCacheEntries.addAll(myCache.subList(myBeforeChangeState.endCacheEntryIndex + 1,myCache.size()));
    if (DEBUG_SOFT_WRAP_PROCESSING) {
      log("xxxxxxxxxxxxx CachingSoftWrapDataMapper.onRecalculationStart(). Marked the following " + myNotAffectedByUpdateTailCacheEntries.size() + " entries for update: ");
      for (      CacheEntry cacheEntry : myNotAffectedByUpdateTailCacheEntries) {
        log("\t" + cacheEntry);
      }
    }
  }
  if (myBeforeChangeState.startCacheEntryIndex < myCache.size()) {
    myCache.subList(myBeforeChangeState.startCacheEntryIndex,myCache.size()).clear();
    if (DEBUG_SOFT_WRAP_PROCESSING) {
      log("Removed all cache entries starting from index " + myBeforeChangeState.startCacheEntryIndex + ". Remaining: "+ myCache.size());
      for (      CacheEntry cacheEntry : myCache) {
        log("\t" + cacheEntry);
      }
    }
  }
}
