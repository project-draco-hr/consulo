{
  final List<Object> result=new ArrayList<Object>(list.length);
  for (  Object o : list) {
    final PsiFile psiFile;
    if (o instanceof PsiFile) {
      psiFile=(PsiFile)o;
    }
 else     if (o instanceof PsiFileNode) {
      psiFile=((PsiFileNode)o).getValue();
    }
 else {
      psiFile=null;
    }
    if (psiFile != null) {
      if (myFilter != null && !myFilter.accept(psiFile)) {
        continue;
      }
      if (myFileType != null && psiFile.getFileType() != myFileType) {
        continue;
      }
    }
 else {
      if (o instanceof ProjectViewNode) {
        final Collection<AbstractTreeNode> children=((ProjectViewNode)o).getChildren();
        final Object[] array=children.toArray(new Object[children.size()]);
        if (filterFiles(array).length == 0) {
          continue;
        }
      }
    }
    result.add(o);
  }
  return result.toArray(new Object[result.size()]);
}
