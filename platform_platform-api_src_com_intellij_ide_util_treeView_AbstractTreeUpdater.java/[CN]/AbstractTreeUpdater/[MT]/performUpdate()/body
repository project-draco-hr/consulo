{
  if (myRunBeforeUpdate != null) {
    myRunBeforeUpdate.run();
    myRunBeforeUpdate=null;
  }
  while (!myNodeQueue.isEmpty()) {
    if (isInPostponeMode())     break;
    final TreeUpdatePass eachPass=myNodeQueue.removeFirst();
    beforeUpdate(eachPass).doWhenDone(new Runnable(){
      public void run(){
        try {
          myTreeBuilder.getUi().updateSubtreeNow(eachPass,false);
        }
 catch (        ProcessCanceledException ignored) {
        }
      }
    }
);
  }
  if (isReleased())   return;
  myTreeBuilder.getUi().maybeReady();
  maybeRunAfterUpdate();
}
