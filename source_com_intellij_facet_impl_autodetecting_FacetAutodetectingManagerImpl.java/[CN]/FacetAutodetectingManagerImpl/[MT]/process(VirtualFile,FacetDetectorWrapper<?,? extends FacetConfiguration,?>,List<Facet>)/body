{
  if (detector.getVirtualFileFilter().accept(virtualFile)) {
    if (!ProjectFileVersion.getInstance(myProject).isFacetAdditionEnabled(detector.getFacetType().getId())) {
      return facets;
    }
    Facet facet=detector.detectFacet(virtualFile,myPsiManager);
    if (facet != null) {
      if (facets == null) {
        facets=new SmartList<Facet>();
      }
      facets.add(facet);
    }
  }
  return facets;
}
