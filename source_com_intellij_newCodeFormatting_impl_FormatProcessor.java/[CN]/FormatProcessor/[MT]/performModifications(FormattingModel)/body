{
  List<LeafBlockWrapper> blocksToModify=collectBlocksToModify();
  int shift=0;
  for (  LeafBlockWrapper block : blocksToModify) {
    final WhiteSpace whiteSpace=block.getWhiteSpace();
    final int oldTextRangeLength=block.getTextRange().getLength();
    final String newWhiteSpace=whiteSpace.generateWhiteSpace(myIndentOption);
    final TextRange textRange=whiteSpace.getTextRange();
    final TextRange wsRange=shiftRange(textRange,shift);
    final int newBlockLength=model.replaceWhiteSpace(wsRange,newWhiteSpace,block.getTextRange().getLength());
    shift+=(newWhiteSpace.length() - (textRange.getLength())) + (newBlockLength - oldTextRangeLength);
  }
}
