{
  final SpacePropertyImpl spaceProperty=myCurrentBlock.getSpaceProperty();
  final WhiteSpace whiteSpace=myCurrentBlock.getWhiteSpace();
  whiteSpace.arrangeLineFeeds(spaceProperty,this);
  try {
    if (processWrap(spaceProperty)) {
      return;
    }
  }
  finally {
    if (whiteSpace.containsLineFeeds()) {
      onCurrentLineChanged();
    }
  }
  final Block block=myCurrentBlock.getBlock();
  if (whiteSpace.containsLineFeeds()) {
    adjustLineIndent();
  }
 else {
    whiteSpace.arrangeSpaces(spaceProperty);
  }
  setAlignOffset(getOffsetBefore(block));
  if (myCurrentBlock.containsLineFeeds()) {
    onCurrentLineChanged();
  }
  if (shouldSaveDependancy(spaceProperty,whiteSpace)) {
    saveDependancy(spaceProperty);
  }
  if (!myAlignAgain) {
    myAlignAgain=shouldReformatBecauseOfBackwardDependance(whiteSpace.getTextRange());
  }
  myCurrentBlock=myCurrentBlock.getNextBlock();
}
