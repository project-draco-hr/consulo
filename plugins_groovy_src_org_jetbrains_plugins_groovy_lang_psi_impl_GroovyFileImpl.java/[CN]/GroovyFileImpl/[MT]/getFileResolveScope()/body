{
  final VirtualFile vFile=getOriginalFile().getVirtualFile();
  if (vFile == null) {
    return GlobalSearchScope.allScope(getProject());
  }
  final GlobalSearchScope baseScope=((FileManagerImpl)((PsiManagerEx)getManager()).getFileManager()).getDefaultResolveScope(vFile);
  if (isScript()) {
    return GroovyScriptType.getScriptType(this).patchResolveScope(this,baseScope);
  }
  return baseScope;
}
