{
  for (ProjectStructureNode<?> n=node.getParent(); n != null; n=n.getParent()) {
    final ProjectStructureNodeDescriptor<?> descriptor=n.getDescriptor();
    if (n.getDescriptor().getElement().getType() == ProjectEntityType.SYNTHETIC) {
      continue;
    }
    if (descriptor.getAttributes() != ExternalSystemTextAttributes.EXTERNAL_SYSTEM_LOCAL_CHANGE) {
      break;
    }
    Object id=descriptor.getElement();
    final Object entity=myIdMapper.mapIdToEntity((ProjectEntityId)id,context.project);
    if (entity instanceof ExternalEntity) {
      ((ExternalEntity)entity).invite(context.visitor);
    }
  }
  final Stack<ExternalEntity> toProcess=new Stack<ExternalEntity>();
  final Object id=node.getDescriptor().getElement();
  final Object entity=myIdMapper.mapIdToEntity((ProjectEntityId)id,context.project);
  if (entity instanceof ExternalEntity) {
    toProcess.push((ExternalEntity)entity);
  }
  context.recursive=true;
  while (!toProcess.isEmpty()) {
    final ExternalEntity e=toProcess.pop();
    e.invite(context.visitor);
  }
}
