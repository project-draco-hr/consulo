{
  context.addAffectedFile(getTarget(fileToPatch));
  if (isNewFile()) {
    if (fileToPatch.findChild(getBeforeFileName()) != null) {
      throw new ApplyPatchException("File " + getBeforeFileName() + " already exists");
    }
    VirtualFile newFile=fileToPatch.createChildData(this,getBeforeFileName());
    applyCreate(newFile);
  }
 else   if (isDeletedFile()) {
    FileEditorManagerImpl.getInstance(project).closeFile(fileToPatch);
    fileToPatch.delete(this);
  }
 else {
    return applyChange(fileToPatch);
  }
  return ApplyPatchStatus.SUCCESS;
}
