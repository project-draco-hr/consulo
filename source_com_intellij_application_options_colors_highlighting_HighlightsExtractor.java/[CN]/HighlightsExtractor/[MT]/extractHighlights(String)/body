{
  if (myTags == null || myTags.isEmpty())   return EMPTY_DATA;
  resetIndices();
  List<HighlightData> highlights=new ArrayList<HighlightData>();
  Stack<HighlightData> highlightsStack=new Stack<HighlightData>();
  while (true) {
    String tagName=findTagName(text);
    if (tagName == null)     break;
    if (myTags.containsKey(tagName)) {
      if (myIsOpeningTag) {
        mySkippedLen+=tagName.length() + 2;
        HighlightData highlightData=new HighlightData(myStartOffset - mySkippedLen,myTags.get(tagName));
        highlightsStack.push(highlightData);
      }
 else {
        HighlightData highlightData=highlightsStack.pop();
        highlightData.setEndOffset(myEndOffset - mySkippedLen);
        mySkippedLen+=tagName.length() + 3;
        highlights.add(highlightData);
      }
    }
  }
  return highlights.toArray(new HighlightData[highlights.size()]);
}
