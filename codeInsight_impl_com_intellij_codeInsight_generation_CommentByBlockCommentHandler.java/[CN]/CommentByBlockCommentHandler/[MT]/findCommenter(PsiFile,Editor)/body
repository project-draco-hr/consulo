{
  final FileType fileType=file.getFileType();
  if (fileType instanceof CustomFileType) {
    return ((CustomFileType)fileType).getCommenter();
  }
  final SelectionModel selectionModel=editor.getSelectionModel();
  int caretOffset=editor.getCaretModel().getOffset();
  int mostProbablyCorrectLanguageOffset=caretOffset == selectionModel.getSelectionStart() || caretOffset == selectionModel.getSelectionEnd() ? selectionModel.getSelectionStart() : caretOffset;
  PsiElement elt=getElementAtOffset(file,mostProbablyCorrectLanguageOffset);
  Language lang=elt != null ? PsiUtil.findLanguageFromElement(elt,file) : null;
  if (lang == null)   return null;
  if (selectionModel.hasSelection()) {
    lang=evaluateLanguageInRange(selectionModel.getSelectionStart(),selectionModel.getSelectionEnd(),file,lang);
  }
  if (lang.getCommenter() == null) {
    lang=file.getLanguage();
  }
  return lang.getCommenter();
}
