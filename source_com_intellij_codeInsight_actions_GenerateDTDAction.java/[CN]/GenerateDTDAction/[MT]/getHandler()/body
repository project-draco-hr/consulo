{
  return new CodeInsightActionHandler(){
    public void invoke(    Project project,    Editor editor,    PsiFile file){
      if (file instanceof XmlFile && file.getVirtualFile() != null && file.getVirtualFile().isWritable()) {
        final StringBuffer buffer=new StringBuffer();
        final XmlDocument document=((XmlFile)file).getDocument();
        if (document.getRootTag() != null) {
          buffer.append("<!DOCTYPE " + document.getRootTag().getName() + " [\n");
          buffer.append(XmlUtil.generateDocumentDTD(document));
          buffer.append("]>\n");
          XmlFile tempFile=null;
          try {
            tempFile=(XmlFile)file.getManager().getElementFactory().createFileFromText("dummy.xml",buffer.toString());
            document.getProlog().replace(tempFile.getDocument().getProlog());
          }
 catch (          IncorrectOperationException e) {
            LOG.error(e);
          }
        }
      }
    }
    public boolean startInWriteAction(){
      return true;
    }
  }
;
}
