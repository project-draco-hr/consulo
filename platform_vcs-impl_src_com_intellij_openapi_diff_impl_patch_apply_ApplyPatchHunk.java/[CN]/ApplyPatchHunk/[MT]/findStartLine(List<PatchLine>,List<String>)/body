{
  int totalContextLines=countContextLines(hunkLines);
  final int startLineBefore=myHunk.getStartLineBefore();
  if (getLinesProcessingContext(hunkLines,lines,startLineBefore) == totalContextLines) {
    return startLineBefore;
  }
  int maxContextStartLine=-1;
  int maxContextLines=0;
  for (int i=0; i < lines.size(); i++) {
    int contextLines=getLinesProcessingContext(hunkLines,lines,i);
    if (contextLines == totalContextLines) {
      return i;
    }
    if (contextLines > maxContextLines) {
      maxContextLines=contextLines;
      maxContextStartLine=i;
    }
  }
  if (maxContextLines < 2) {
    throw new ApplyPatchException("couldn't find context");
  }
  return maxContextStartLine;
}
