{
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    @Override public void run(){
      final VirtualFile vcsRoot=myVcsManager.getVcsRootFor(newcomer);
      myAffectedContentRoots.add(vcsRoot);
      THashSet<FilePath> dirsByRoot=myDirtyDirectoriesRecursively.get(vcsRoot);
      if (dirsByRoot != null) {
        for (        FilePath oldBoy : dirsByRoot) {
          if (newcomer.isUnder(oldBoy,false)) {
            return;
          }
        }
      }
      final THashSet<FilePath> dirtyFiles=myDirtyFiles.get(vcsRoot);
      if (dirtyFiles == null) {
        final THashSet<FilePath> set=new THashSet<FilePath>();
        set.add(newcomer);
        myDirtyFiles.put(vcsRoot,set);
      }
 else {
        if (newcomer.isDirectory()) {
          for (Iterator<FilePath> iterator=dirtyFiles.iterator(); iterator.hasNext(); ) {
            final FilePath oldBoy=iterator.next();
            if (!oldBoy.isDirectory() && Comparing.equal(oldBoy.getVirtualFileParent(),newcomer.getVirtualFile())) {
              iterator.remove();
            }
          }
        }
 else         if (!dirtyFiles.isEmpty()) {
          VirtualFile parent=newcomer.getVirtualFileParent();
          if (parent != null && dirtyFiles.contains(new FilePathImpl(parent))) {
            return;
          }
          dirtyFiles.add(newcomer);
        }
      }
    }
  }
);
}
