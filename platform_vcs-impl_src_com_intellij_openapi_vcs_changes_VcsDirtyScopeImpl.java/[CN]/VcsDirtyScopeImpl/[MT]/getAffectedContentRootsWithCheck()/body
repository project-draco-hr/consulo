{
  if (myVcs.allowsNestedRoots()) {
    final ProjectLevelVcsManager vcsManager=ProjectLevelVcsManager.getInstance(myVcs.getProject());
    final VirtualFile[] roots=vcsManager.getRootsUnderVcs(myVcs);
    final Set<VirtualFile> result=new HashSet<VirtualFile>(myAffectedContentRoots);
    for (    VirtualFile root : roots) {
      for (      VirtualFile dir : myDirtyDirectoriesRecursively.keySet()) {
        if (VfsUtilCore.isAncestor(dir,root,true)) {
          result.add(root);
        }
      }
    }
    return new SmartList<VirtualFile>(result);
  }
  return myAffectedContentRoots;
}
