{
  if (myProject.isDisposed())   return;
  for (  VirtualFile root : myAffectedContentRoots) {
    THashSet<FilePath> dirsByRoot=myDirtyDirectoriesRecursively.get(root);
    if (dirsByRoot != null) {
      for (      FilePath dir : dirsByRoot) {
        final VirtualFile vFile=obtainVirtualFile(dir);
        if (vFile != null && vFile.isValid()) {
          myVcsManager.iterateVfUnderVcsRoot(vFile,processor);
        }
      }
    }
  }
  for (  VirtualFile root : myAffectedContentRoots) {
    final THashSet<FilePath> files=myDirtyFiles.get(root);
    if (files != null) {
      for (      FilePath file : files) {
        VirtualFile vFile=obtainVirtualFile(file);
        if (vFile != null && vFile.isValid()) {
          processor.process(vFile);
          if (vFile.isDirectory()) {
            for (            VirtualFile child : vFile.getChildren()) {
              processor.process(child);
            }
          }
        }
      }
    }
  }
}
