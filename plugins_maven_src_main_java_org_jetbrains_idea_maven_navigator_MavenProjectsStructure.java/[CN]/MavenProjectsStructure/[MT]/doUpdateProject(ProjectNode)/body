{
  MavenProject project=node.getMavenProject();
  ProjectsGroupNode newParentNode=myRoot;
  if (myProjectsNavigator.getGroupModules()) {
    MavenProject aggregator=myProjectsManager.findAggregator(project);
    if (aggregator != null) {
      ProjectNode aggregatorNode=findNodeFor(aggregator);
      if (aggregatorNode != null && aggregatorNode.isVisible()) {
        newParentNode=aggregatorNode.getModulesNode();
      }
    }
  }
  node.updateProject();
  reconnectNode(node,newParentNode);
  ProjectsGroupNode newModulesParentNode=myProjectsNavigator.getGroupModules() && node.isVisible() ? node.getModulesNode() : myRoot;
  for (  MavenProject each : myProjectsManager.getModules(project)) {
    ProjectNode moduleNode=findNodeFor(each);
    if (moduleNode != null && !moduleNode.getParent().equals(newModulesParentNode)) {
      reconnectNode(moduleNode,newModulesParentNode);
    }
  }
}
