{
  if (parameters.getCompletionType() != CompletionType.BASIC)   return true;
  if (parameters.getPosition().getContainingFile().getLanguage() == StdLanguages.JAVA) {
    final PsiFile file=parameters.getOriginalFile();
    final int startOffset=parameters.getOffset();
    final PsiElement lastElement=file.findElementAt(startOffset - 1);
    final PsiElement insertedElement=parameters.getPosition();
    final CompletionData completionData=ApplicationManager.getApplication().runReadAction(new Computable<CompletionData>(){
      public CompletionData compute(){
        return getCompletionDataByElementInner(lastElement);
      }
    }
);
    final CompletionResultSet result=_result.withPrefixMatcher(completionData.findPrefix(insertedElement,startOffset));
    final Set<LookupElement> lookupSet=new LinkedHashSet<LookupElement>();
    final PsiReference ref=ApplicationManager.getApplication().runReadAction(new Computable<PsiReference>(){
      public PsiReference compute(){
        return insertedElement.getContainingFile().findReferenceAt(startOffset);
      }
    }
);
    if (ref != null) {
      completionData.completeReference(ref,lookupSet,insertedElement,parameters.getOriginalFile(),startOffset);
    }
    final Set<CompletionVariant> keywordVariants=new HashSet<CompletionVariant>();
    completionData.addKeywordVariants(keywordVariants,insertedElement,parameters.getOriginalFile());
    completionData.completeKeywordsBySet(lookupSet,keywordVariants,insertedElement,result.getPrefixMatcher(),parameters.getOriginalFile());
    for (    final LookupElement item : lookupSet) {
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        public void run(){
          JavaCompletionUtil.highlightMemberOfContainer((LookupItem)item);
        }
      }
);
      if (item.getInsertHandler() == null) {
        ((LookupItem)item).setInsertHandler(new InsertHandler(){
          public void handleInsert(          final InsertionContext context,          final LookupElement item){
            analyzeItem((LookupItem)item,item.getObject(),parameters.getPosition());
            new DefaultInsertHandler().handleInsert(context,item);
          }
        }
);
      }
      result.addElement(item);
    }
    return false;
  }
  return true;
}
