{
  final PsiClass containingClass=PsiTreeUtil.getParentOfType(position,PsiClass.class,false,PsiCodeBlock.class,PsiMethod.class,PsiExpressionList.class);
  if (containingClass != null && psiElement().afterLeaf(PsiKeyword.EXTENDS,PsiKeyword.IMPLEMENTS,",","&").accepts(position)) {
    return new AndFilter(new ClassFilter(PsiClass.class),new NotFilter(new AssignableFromContextFilter()));
  }
  if (JavaCompletionData.DECLARATION_START.isAcceptable(position,position)) {
    return new OrFilter(new ClassFilter(PsiClass.class),new ClassFilter(PsiPackage.class));
  }
  if (JavaCompletionData.INSIDE_PARAMETER_LIST.accepts(position)) {
    return new ClassFilter(PsiClass.class);
  }
  if (psiElement().afterLeaf(PsiKeyword.THROWS,",").inside(psiElement(PsiReferenceList.class).withParent(PsiMethod.class)).accepts(position)) {
    return new OrFilter(new ThisOrAnyInnerFilter(new AssignableFromFilter("java.lang.Throwable")),new ClassFilter(PsiPackage.class));
  }
  if (psiElement().afterLeaf(PsiKeyword.INSTANCEOF).accepts(position)) {
    return new ElementExtractorFilter(new ClassFilter(PsiClass.class));
  }
  if (JavaCompletionData.AFTER_FINAL.accepts(position)) {
    return new ClassFilter(PsiClass.class);
  }
  if (JavaCompletionData.AFTER_TRY_BLOCK.isAcceptable(position,position) || JavaCompletionData.START_SWITCH.isAcceptable(position,position) || JavaCompletionData.INSTANCEOF_PLACE.isAcceptable(position,position)) {
    return null;
  }
  if (psiElement().afterLeaf(psiElement().withText("(").withParent(PsiTryStatement.class)).accepts(position)) {
    return new OrFilter(new ThisOrAnyInnerFilter(new AssignableFromFilter(CommonClassNames.JAVA_LANG_THROWABLE)),new ClassFilter(PsiPackage.class));
  }
  if (JavaSmartCompletionContributor.AFTER_THROW_NEW.accepts(position)) {
    return new ThisOrAnyInnerFilter(new AssignableFromFilter("java.lang.Throwable"));
  }
  if (JavaSmartCompletionContributor.AFTER_NEW.accepts(position)) {
    return new ClassFilter(PsiClass.class);
  }
  if (psiElement().inside(PsiReferenceParameterList.class).accepts(position)) {
    return new ClassFilter(PsiClass.class);
  }
  if (psiElement().inside(PsiAnnotationParameterList.class).accepts(position)) {
    return new OrFilter(new ClassFilter(PsiAnnotationMethod.class),new ClassFilter(PsiClass.class),new ClassFilter(PsiPackage.class),new AndFilter(new ClassFilter(PsiField.class),new ModifierFilter(PsiModifier.STATIC,PsiModifier.FINAL)));
  }
  if (psiElement().afterLeaf("=").inside(PsiVariable.class).accepts(position)) {
    return new OrFilter(new ClassFilter(PsiVariable.class,false),new ExcludeDeclaredFilter(new ClassFilter(PsiVariable.class)));
  }
  if (SWITCH_LABEL.accepts(position)) {
    return new ClassFilter(PsiField.class){
      @Override public boolean isAcceptable(      Object element,      PsiElement context){
        return element instanceof PsiEnumConstant;
      }
    }
;
  }
  return TrueFilter.INSTANCE;
}
