{
  if (refs.isEmpty())   return myGlobalStack.getLast();
  UndoableGroup mostRecentAction=null;
  int mostRecentDocTimestamp=myUndo ? -1 : Integer.MAX_VALUE;
  for (  DocumentReference each : refs) {
    LinkedList<UndoableGroup> stack=getStack(each);
    if (stack.isEmpty())     continue;
    UndoableGroup lastAction=stack.getLast();
    int timestamp=lastAction.getCommandTimestamp();
    if (myUndo ? timestamp > mostRecentDocTimestamp : timestamp < mostRecentDocTimestamp) {
      mostRecentAction=lastAction;
      mostRecentDocTimestamp=timestamp;
    }
  }
  return mostRecentAction;
}
