{
  final PsiElement paramParent=param.getParent();
  if (paramParent instanceof PsiParameterList) {
    final int parameterIndex=((PsiParameterList)paramParent).getParameterIndex(param);
    if (parameterIndex > -1) {
      final PsiLambdaExpression lambdaExpression=PsiTreeUtil.getParentOfType(param,PsiLambdaExpression.class);
      final PsiClassType.ClassResolveResult resolveResult=getFunctionInterfaceType(lambdaExpression);
      if (resolveResult != null) {
        final MethodSignature methodSignature=getFunction(resolveResult.getElement());
        if (methodSignature != null) {
          final PsiType[] types=methodSignature.getParameterTypes();
          if (parameterIndex < types.length) {
            return resolveResult.getSubstitutor().substitute(types[parameterIndex]);
          }
        }
      }
    }
  }
  return new PsiLambdaParameterType(param);
}
