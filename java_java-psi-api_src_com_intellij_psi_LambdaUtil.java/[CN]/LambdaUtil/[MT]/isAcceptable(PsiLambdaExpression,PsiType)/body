{
  final PsiClassType.ClassResolveResult resolveResult=PsiUtil.resolveGenericsClassInType(leftType);
  final PsiClass psiClass=resolveResult.getElement();
  if (psiClass instanceof PsiAnonymousClass) {
    return isAcceptable(lambdaExpression,((PsiAnonymousClass)psiClass).getBaseClassType());
  }
  final MethodSignature methodSignature=getFunction(psiClass);
  if (methodSignature == null)   return false;
  final PsiParameter[] lambdaParameters=lambdaExpression.getParameterList().getParameters();
  final PsiType[] parameterTypes=methodSignature.getParameterTypes();
  if (lambdaParameters.length != parameterTypes.length)   return false;
  for (int lambdaParamIdx=0, length=lambdaParameters.length; lambdaParamIdx < length; lambdaParamIdx++) {
    PsiParameter parameter=lambdaParameters[lambdaParamIdx];
    final PsiTypeElement typeElement=parameter.getTypeElement();
    if (typeElement != null) {
      final PsiType lambdaFormalType=typeElement.getType();
      final PsiType methodParameterType=parameterTypes[lambdaParamIdx];
      if (lambdaFormalType instanceof PsiPrimitiveType) {
        if (methodParameterType instanceof PsiPrimitiveType)         return methodParameterType.equals(lambdaFormalType);
        return false;
      }
      if (!TypeConversionUtil.erasure(lambdaFormalType).isAssignableFrom(TypeConversionUtil.erasure(GenericsUtil.eliminateWildcards(resolveResult.getSubstitutor().substitute(methodSignature.getSubstitutor().substitute(methodParameterType)))))) {
        return false;
      }
    }
  }
  LOG.assertTrue(psiClass != null);
  PsiType methodReturnType=getReturnType(psiClass,methodSignature);
  if (methodReturnType != null) {
    methodReturnType=resolveResult.getSubstitutor().substitute(methodSignature.getSubstitutor().substitute(methodReturnType));
    return checkReturnTypeCompatible(lambdaExpression,methodReturnType) == null;
  }
  return true;
}
