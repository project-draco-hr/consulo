{
  AndroidSdkAdditionalData data=new AndroidSdkAdditionalData(androidSdk,javaSdk);
  data.setBuildTarget(target);
  String sdkName=chooseNameForNewLibrary(target);
  sdkName=SdkConfigurationUtil.createUniqueSdkName(sdkName,Arrays.asList(allSdks));
  final SdkModificator sdkModificator=androidSdk.getSdkModificator();
  sdkModificator.setName(sdkName);
  String versionString=target.getVersionName();
  sdkModificator.setVersionString(versionString != null ? versionString : "unknown");
  sdkModificator.setSdkAdditionalData(data);
  if (addRoots) {
    for (    OrderRoot orderRoot : getLibraryRootsForTarget(target,androidSdk.getHomePath())) {
      sdkModificator.addRoot(orderRoot.getFile(),orderRoot.getType());
    }
  }
  sdkModificator.commitChanges();
}
