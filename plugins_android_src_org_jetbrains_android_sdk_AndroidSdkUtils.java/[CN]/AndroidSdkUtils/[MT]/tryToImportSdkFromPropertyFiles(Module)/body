{
  final Pair<String,VirtualFile> targetProp=AndroidRootUtil.getProjectPropertyValue(module,AndroidUtils.ANDROID_TARGET_PROPERTY);
  final String targetHashString=targetProp != null ? targetProp.getFirst() : null;
  if (targetHashString == null) {
    return false;
  }
  final Pair<String,VirtualFile> sdkDirProperty=AndroidRootUtil.getPropertyValue(module,SdkConstants.FN_LOCAL_PROPERTIES,"sdk.dir");
  String sdkDir=sdkDirProperty != null ? sdkDirProperty.getFirst() : null;
  if (sdkDir != null) {
    sdkDir=FileUtil.toSystemIndependentName(sdkDir);
  }
  final Sdk sdk=findSuitableAndroidSdk(targetHashString,sdkDir);
  if (sdk != null) {
    ModuleRootModificationUtil.setModuleSdk(module,sdk);
    return true;
  }
  if (sdkDir != null && tryToCreateAndSetAndroidSdk(module,sdkDir,targetHashString)) {
    return true;
  }
  final String androidHomeValue=System.getenv(ANDROID_HOME_ENV);
  if (androidHomeValue != null && tryToCreateAndSetAndroidSdk(module,FileUtil.toSystemIndependentName(androidHomeValue),targetHashString)) {
    return true;
  }
  for (  String dir : getAndroidSdkPathsFromExistingPlatforms()) {
    if (tryToCreateAndSetAndroidSdk(module,dir,targetHashString)) {
      return true;
    }
  }
  return false;
}
