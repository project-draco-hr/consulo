{
  final XPathFile xpathFile=(XPathFile)element.getContainingFile();
  final ContextProvider contextProvider=ContextProvider.getContextProvider(xpathFile);
  final NamespaceContext nsContext=contextProvider.getNamespaceContext();
  final Map<QName,? extends Function> functions=contextProvider.getFunctionContext().getFunctions();
  final List<Lookup> lookups=new ArrayList<Lookup>(functions.size());
  for (  QName f : functions.keySet()) {
    final Function functionDecl=functions.get(f);
    final String p;
    if (nsContext != null) {
      p=makePrefix(nsContext.getPrefixForURI(f.getNamespaceURI(),PsiTreeUtil.getContextOfType(element,XmlElement.class,true)));
    }
 else {
      p="";
    }
    lookups.add(FunctionLookup.newFunctionLookup(p + f.getLocalPart(),functionDecl));
  }
  return lookups;
}
