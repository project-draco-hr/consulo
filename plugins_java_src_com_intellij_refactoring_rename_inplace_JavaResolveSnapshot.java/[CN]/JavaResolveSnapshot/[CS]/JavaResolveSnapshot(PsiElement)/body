{
  myProject=scope.getProject();
  myDocument=PsiDocumentManager.getInstance(myProject).getDocument(scope.getContainingFile());
  final SmartPointerManager pointerManager=SmartPointerManager.getInstance(myProject);
  final Map<PsiElement,SmartPsiElementPointer> pointers=new HashMap<PsiElement,SmartPsiElementPointer>();
  scope.accept(new JavaRecursiveElementWalkingVisitor(){
    @Override public void visitReferenceExpression(    PsiReferenceExpression refExpr){
      if (!refExpr.isQualified()) {
        JavaResolveResult resolveResult=refExpr.advancedResolve(false);
        final PsiElement resolved=resolveResult.getElement();
        if (resolved instanceof PsiField && resolveResult.isStaticsScopeCorrect()) {
          SmartPsiElementPointer key=pointerManager.createSmartPsiElementPointer(refExpr);
          SmartPsiElementPointer value=pointers.get(resolved);
          if (value == null) {
            value=pointerManager.createSmartPsiElementPointer(resolved);
            pointers.put(resolved,value);
          }
          myReferencesMap.put(key,value);
        }
      }
      super.visitReferenceExpression(refExpr);
    }
  }
);
}
