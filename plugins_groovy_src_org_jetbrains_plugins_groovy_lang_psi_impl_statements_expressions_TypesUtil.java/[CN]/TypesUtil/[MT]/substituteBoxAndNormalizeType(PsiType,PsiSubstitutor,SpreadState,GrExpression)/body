{
  if (type == null)   return null;
  GlobalSearchScope resolveScope=expression.getResolveScope();
  PsiManager manager=expression.getManager();
  type=substitutor.substitute(type);
  type=boxPrimitiveType(type,manager,resolveScope);
  if (type == null)   return null;
  type=PsiImplUtil.normalizeWildcardTypeByPosition(type,expression);
  type=SpreadState.apply(type,state,expression.getProject());
  return type;
}
