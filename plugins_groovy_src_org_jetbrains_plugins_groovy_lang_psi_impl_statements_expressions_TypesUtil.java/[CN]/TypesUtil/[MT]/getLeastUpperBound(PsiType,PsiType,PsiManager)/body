{
  if (type1 instanceof GrTupleType && type2 instanceof GrTupleType) {
    GrTupleType tuple1=(GrTupleType)type1;
    GrTupleType tuple2=(GrTupleType)type2;
    PsiType[] components1=tuple1.getComponentTypes();
    PsiType[] components2=tuple2.getComponentTypes();
    PsiType[] components3=new PsiType[Math.min(components1.length,components2.length)];
    for (int i=0; i < components3.length; i++) {
      PsiType c1=components1[i];
      PsiType c2=components2[i];
      if (c1 == null || c2 == null) {
        components3[i]=null;
      }
 else {
        components3[i]=getLeastUpperBound(c1,c2,manager);
      }
    }
    return new GrTupleType(components3,JavaPsiFacade.getInstance(manager.getProject()),tuple1.getScope().intersectWith(tuple2.getResolveScope()));
  }
 else   if (type1 instanceof GrClosureType && type2 instanceof GrClosureType) {
    GrClosureType clType1=(GrClosureType)type1;
    GrClosureType clType2=(GrClosureType)type2;
    PsiType[] parameterTypes1=clType1.getClosureParameterTypes();
    PsiType[] parameterTypes2=clType2.getClosureParameterTypes();
    if (parameterTypes1.length == parameterTypes2.length) {
      PsiType[] paramTypes=new PsiType[parameterTypes1.length];
      boolean[] opts=new boolean[parameterTypes1.length];
      for (int i=0; i < paramTypes.length; i++) {
        paramTypes[i]=GenericsUtil.getGreatestLowerBound(parameterTypes1[i],parameterTypes2[i]);
        opts[i]=clType1.isOptionalParameter(i) && clType2.isOptionalParameter(i);
      }
      PsiType returnType=getLeastUpperBound(clType1.getClosureReturnType(),clType2.getClosureReturnType(),manager);
      GlobalSearchScope scope=clType1.getResolveScope().intersectWith(clType2.getResolveScope());
      return GrClosureType.create(returnType,paramTypes,opts,manager,scope,LanguageLevel.JDK_1_5);
    }
  }
  return GenericsUtil.getLeastUpperBound(type1,type2,manager);
}
