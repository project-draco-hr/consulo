{
  if (anchor == null && getRBrace() == null) {
    throw new IncorrectOperationException();
  }
  if (anchor != null && !this.equals(anchor.getParent())) {
    throw new IncorrectOperationException();
  }
  PsiElement actualAnchor=anchor == null ? getRBrace() : anchor;
  if (mayUseNewLinesAsSeparators()) {
    PsiElement prev=actualAnchor.getPrevSibling();
    if (prev instanceof GrParameterList && prev.getTextLength() == 0 && prev.getPrevSibling() != null) {
      prev=prev.getPrevSibling();
    }
    if (!isNls(prev)) {
      getNode().addLeaf(GroovyTokenTypes.mNLS,"\n",actualAnchor.getNode());
    }
  }
  final ASTNode anchorNode=actualAnchor.getNode();
  element=(GrStatement)addBefore(element,actualAnchor);
  if (mayUseNewLinesAsSeparators()) {
    getNode().addLeaf(GroovyTokenTypes.mNLS,"\n",anchorNode);
  }
 else {
    getNode().addLeaf(GroovyTokenTypes.mSEMI,";",anchorNode);
  }
  return element;
}
