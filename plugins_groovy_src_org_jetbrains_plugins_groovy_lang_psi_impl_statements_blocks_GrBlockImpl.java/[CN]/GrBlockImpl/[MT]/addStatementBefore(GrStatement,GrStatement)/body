{
  if (anchor == null && getRBrace() == null) {
    throw new IncorrectOperationException();
  }
  if (anchor != null && !this.equals(anchor.getParent())) {
    throw new IncorrectOperationException();
  }
  final LeafElement nls=Factory.createSingleLeafElement(GroovyTokenTypes.mNLS,"\n",0,1,null,getManager());
  PsiElement actualAnchor=anchor == null ? getRBrace() : anchor;
  if (mayUseNewLinesAsSeparators()) {
    PsiElement prev=actualAnchor.getPrevSibling();
    if (prev instanceof GrParameterList && prev.getTextLength() == 0 && prev.getPrevSibling() != null) {
      prev=prev.getPrevSibling();
    }
    if (!isNls(prev)) {
      addBefore(nls.getPsi(),actualAnchor);
    }
  }
  element=(GrStatement)addBefore(element,actualAnchor);
  if (mayUseNewLinesAsSeparators()) {
    addBefore(nls.getPsi(),actualAnchor);
  }
 else {
    addBefore(Factory.createSingleLeafElement(GroovyTokenTypes.mNLS,"\n",0,1,null,getManager()).getPsi(),actualAnchor);
  }
  return element;
}
