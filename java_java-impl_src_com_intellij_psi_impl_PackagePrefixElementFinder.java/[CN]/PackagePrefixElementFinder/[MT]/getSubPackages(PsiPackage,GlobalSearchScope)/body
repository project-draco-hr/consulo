{
  final Map<String,PsiPackage> packagesMap=new HashMap<String,PsiPackage>();
  final String qualifiedName=psiPackage.getQualifiedName();
  for (  final String prefix : myPackagePrefixIndex.getAllPackagePrefixes(scope)) {
    if (StringUtil.isEmpty(qualifiedName) || StringUtil.startsWithConcatenationOf(prefix,qualifiedName,".")) {
      final int i=prefix.indexOf('.',qualifiedName.length() + 1);
      String childName=i >= 0 ? prefix.substring(0,i) : prefix;
      if (!packagesMap.containsKey(childName)) {
        packagesMap.put(childName,new PsiPackageImpl((PsiManagerEx)psiPackage.getManager(),childName));
      }
    }
  }
  packagesMap.remove(qualifiedName);
  return packagesMap.values().toArray(new PsiPackage[packagesMap.size()]);
}
