{
  int toReplace=-1;
  boolean newSchemeIsShared=isShared(scheme);
  for (int i=0; i < mySchemes.size(); i++) {
    T t=mySchemes.get(i);
    if (Comparing.equal(scheme.getName(),t.getName()) && newSchemeIsShared == isShared(t)) {
      toReplace=i;
      break;
    }
  }
  if (toReplace == -1) {
    mySchemes.add(scheme);
  }
 else {
    if (replaceExisting || !isExternalizable(scheme)) {
      mySchemes.set(toReplace,scheme);
    }
 else {
      renameScheme((E)scheme,generateUniqueName(scheme));
      mySchemes.add(scheme);
    }
  }
  onSchemeAdded(scheme);
  checkCurrentScheme(scheme);
}
