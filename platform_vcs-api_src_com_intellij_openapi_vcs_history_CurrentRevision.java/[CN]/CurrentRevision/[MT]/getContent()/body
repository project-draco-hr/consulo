{
  try {
    Document document=ApplicationManager.getApplication().runReadAction(new Computable<Document>(){
      @Override public Document compute(){
        return FileDocumentManager.getInstance().getDocument(myFile);
      }
    }
);
    if (document != null) {
      return document.getText().getBytes(myFile.getCharset().name());
    }
 else {
      return myFile.contentsToByteArray();
    }
  }
 catch (  final IOException e) {
    UIUtil.invokeLaterIfNeeded(new Runnable(){
      @Override public void run(){
        Messages.showMessageDialog(e.getLocalizedMessage(),VcsBundle.message("message.text.could.not.load.file.content"),Messages.getErrorIcon());
      }
    }
);
    return null;
  }
}
