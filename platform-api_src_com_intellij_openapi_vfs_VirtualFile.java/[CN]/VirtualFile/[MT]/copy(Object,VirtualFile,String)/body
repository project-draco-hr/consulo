{
  if (getFileSystem() != newParent.getFileSystem()) {
    throw new IOException(VfsBundle.message("file.copy.error",newParent.getPresentableUrl()));
  }
  if (!newParent.isDirectory()) {
    throw new IOException(VfsBundle.message("file.copy.target.must.be.directory"));
  }
  Charset charsetBefore=EncodingManager.getInstance().getEncoding(this,true);
  VirtualFile newFile=getFileSystem().copyFile(requestor,this,newParent,copyName);
  EncodingManager.getInstance().restoreEncoding(newFile,charsetBefore);
  return newFile;
}
