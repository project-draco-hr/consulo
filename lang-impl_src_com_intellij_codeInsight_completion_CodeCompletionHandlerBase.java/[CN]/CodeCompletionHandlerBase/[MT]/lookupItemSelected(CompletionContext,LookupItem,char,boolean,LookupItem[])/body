{
  final InsertHandler handler;
  if (item.getInsertHandler() == null) {
    handler=new InsertHandler(){
      public void handleInsert(      final InsertionContext context,      final LookupElement item){
        final int idEndOffset=context.getOffsetMap().getOffset(CompletionInitializationContext.IDENTIFIER_END_OFFSET);
        if (idEndOffset != context.getSelectionEndOffset() && CompletionUtil.isOverwrite((LookupItem)item,completionChar)) {
          context.getEditor().getDocument().deleteString(context.getSelectionEndOffset(),idEndOffset);
        }
        item.getTailType().processTail(context.getEditor(),context.getEditor().getCaretModel().getOffset());
      }
    }
;
  }
 else {
    handler=item.getInsertHandler();
  }
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      PsiDocumentManager.getInstance(context.project).commitAllDocuments();
      handler.handleInsert(new InsertionContext(context.getOffsetMap(),completionChar,signatuireSelected,items,context.file,context.editor),item);
    }
  }
);
}
