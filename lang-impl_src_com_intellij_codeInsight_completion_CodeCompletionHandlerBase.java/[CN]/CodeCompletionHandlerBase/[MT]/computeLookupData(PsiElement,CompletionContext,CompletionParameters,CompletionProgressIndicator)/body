{
  final Collection<LookupElement> lookupSet=new LinkedHashSet<LookupElement>();
  CompletionService.getCompletionService().getVariantsFromContributors(CompletionContributor.EP_NAME,parameters,null,new Consumer<LookupElement>(){
    public void consume(    final LookupElement lookupElement){
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        public void run(){
          if (lookupSet.add(lookupElement)) {
            indicator.addItem((LookupItem)lookupElement);
          }
        }
      }
);
    }
  }
);
  final LookupItem[] items=lookupSet.toArray(new LookupItem[lookupSet.size()]);
  final LookupData data=new LookupData(items,context.getPrefix());
  data.itemPreferencePolicy=new CompletionPreferencePolicy(context.getPrefix(),parameters);
  return data;
}
