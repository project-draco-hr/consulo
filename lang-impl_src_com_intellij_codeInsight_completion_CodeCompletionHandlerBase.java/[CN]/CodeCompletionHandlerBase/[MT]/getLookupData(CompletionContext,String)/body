{
  final PsiFile file=_context.file;
  final Pair<CompletionContext,PsiElement> insertedInfo=ApplicationManager.getApplication().runWriteAction(new Computable<Pair<CompletionContext,PsiElement>>(){
    public Pair<CompletionContext,PsiElement> compute(){
      return insertDummyIdentifier(_context,dummyIdentifier);
    }
  }
);
  PsiElement insertedElement=insertedInfo.getSecond();
  final CompletionContext context=insertedInfo.getFirst();
  insertedElement.putUserData(CompletionContext.COMPLETION_CONTEXT_KEY,context);
  final CompletionParametersImpl parameters=new CompletionParametersImpl(insertedElement,context.file,myCompletionType);
  final Set<LookupItem> lookupSet=new LinkedHashSet<LookupItem>((Collection)CompletionService.getCompletionService().getQueryFactory(myCompletionType,parameters).createQuery(parameters).findAll());
  insertedElement.putUserData(CompletionContext.COMPLETION_CONTEXT_KEY,null);
  final LookupItem[] items=lookupSet.toArray(new LookupItem[lookupSet.size()]);
  final LookupData data=createLookupData(context,items,insertedElement);
  data.itemPreferencePolicy=new CompletionPreferencePolicy(context.getPrefix(),parameters);
  return data;
}
