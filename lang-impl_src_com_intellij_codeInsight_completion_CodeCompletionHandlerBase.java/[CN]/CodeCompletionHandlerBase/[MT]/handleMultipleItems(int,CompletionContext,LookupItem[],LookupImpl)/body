{
  final Project project=context.project;
  final int minPrefixLength=lookup.getMinPrefixLength();
  context.setStartOffset(offset1 - minPrefixLength);
  new WriteCommandAction(project){
    protected void run(    Result result) throws Throwable {
      if (isAutocompleteCommonPrefixOnInvocation() && items.length > 1) {
        lookup.fillInCommonPrefix(false);
        PsiDocumentManager.getInstance(project).commitAllDocuments();
      }
    }
  }
.execute().getResultObject();
  final int newLength=lookup.getMinPrefixLength();
  if (newLength != minPrefixLength) {
    context.editor.getCaretModel().moveToOffset(offset1 - minPrefixLength + newLength);
    context.editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
  }
}
