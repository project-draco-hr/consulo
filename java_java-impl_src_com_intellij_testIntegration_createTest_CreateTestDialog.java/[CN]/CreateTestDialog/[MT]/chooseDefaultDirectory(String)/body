{
  List<PsiDirectory> dirs=new ArrayList<PsiDirectory>();
  for (  ContentEntry e : ModuleRootManager.getInstance(myTargetModule).getContentEntries()) {
    for (    SourceFolder f : e.getSourceFolders()) {
      final VirtualFile file=f.getFile();
      if (file != null && f.isTestSource()) {
        final PsiDirectory dir=PsiManager.getInstance(myProject).findDirectory(file);
        if (dir != null) {
          dirs.add(dir);
        }
      }
    }
  }
  if (!dirs.isEmpty()) {
    for (    PsiDirectory dir : dirs) {
      final String dirName=dir.getVirtualFile().getPath();
      if (dirName.contains("generated"))       continue;
      return dir;
    }
    return dirs.get(0);
  }
  return PackageUtil.findPossiblePackageDirectoryInModule(myTargetModule,packageName);
}
