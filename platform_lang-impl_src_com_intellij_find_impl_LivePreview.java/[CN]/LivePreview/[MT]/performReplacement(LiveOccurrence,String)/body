{
  if (myDelegate != null) {
    final TextRange textRange=myDelegate.performReplace(occurrence,replacement,myEditor);
    if (textRange != null) {
      updateInBackground();
      setContinuation(new Runnable(){
        @Override public void run(){
          if (mySearchResults != null) {
            LiveOccurrence nearest=null;
            int minDist=Integer.MAX_VALUE;
            for (            LiveOccurrence o : mySearchResults) {
              if (nearest == null) {
                nearest=o;
              }
              int dist=Math.abs(o.getPrimaryRange().getStartOffset() - textRange.getStartOffset());
              if (dist < minDist) {
                minDist=dist;
                nearest=o;
              }
            }
            if (nearest != null) {
              moveCursorTo(nearest);
            }
          }
        }
      }
);
      myDelegate.getFocusBack();
    }
  }
}
