{
  if (myEditor == null)   return;
  LiveOccurrence firstVisibleOccurrence=null;
  LiveOccurrence firstOccurrence=null;
  int offset=Integer.MAX_VALUE;
  for (  LiveOccurrence o : mySearchResults) {
    if (insideVisibleArea(myEditor,o.getPrimaryRange())) {
      if (firstVisibleOccurrence == null || o.getPrimaryRange().getStartOffset() < firstVisibleOccurrence.getPrimaryRange().getStartOffset()) {
        firstVisibleOccurrence=o;
      }
    }
    if (o.getPrimaryRange().getStartOffset() < offset) {
      offset=o.getPrimaryRange().getStartOffset();
      firstOccurrence=o;
    }
    for (    TextRange textRange : o.getSecondaryRanges()) {
      highlightRange(textRange,OTHER_TARGETS_ATTRIBUTES,myHighlighters);
    }
    highlightRange(o.getPrimaryRange(),MAIN_TARGET_ATTRIBUTES,myHighlighters);
  }
  if (!tryToRepairOldCursor(oldCursorRange)) {
    setCursor(firstVisibleOccurrence != null ? firstVisibleOccurrence : firstOccurrence);
  }
}
