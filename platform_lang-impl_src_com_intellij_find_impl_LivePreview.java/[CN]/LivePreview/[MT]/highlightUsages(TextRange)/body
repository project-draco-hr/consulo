{
  if (myEditor == null || myShouldStop)   return;
  for (  LiveOccurrence o : mySearchResults) {
    for (    TextRange textRange : o.getSecondaryRanges()) {
      highlightRange(textRange,OTHER_TARGETS_ATTRIBUTES,myHighlighters);
    }
    highlightRange(o.getPrimaryRange(),MAIN_TARGET_ATTRIBUTES,myHighlighters);
  }
  if (!tryToRepairOldCursor(oldCursorRange)) {
    LiveOccurrence afterCaret=firstOccurrenceAfterCaret();
    if (afterCaret != null) {
      setCursor(afterCaret);
    }
 else {
      LiveOccurrence occurrence=firstVisibleOccurrence();
      if (occurrence != null) {
        setCursor(occurrence);
      }
    }
  }
}
