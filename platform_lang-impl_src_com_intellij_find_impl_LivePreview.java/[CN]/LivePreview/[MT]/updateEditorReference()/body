{
  if (myProject == null)   return null;
  FileEditorManagerEx instanceEx=FileEditorManagerEx.getInstanceEx(myProject);
  if (instanceEx != null) {
    VirtualFile currentFile=instanceEx.getCurrentFile();
    if (currentFile != null) {
      FileEditor[] editors=instanceEx.getEditors(currentFile);
      if (editors.length > 0) {
        FileEditor fileEditor=editors[0];
        boolean focusedFound=false;
        for (        FileEditor e : editors) {
          if (e instanceof TextEditor && ((TextEditor)e).getEditor().getContentComponent().hasFocus()) {
            fileEditor=e;
            focusedFound=true;
          }
        }
        boolean needToUpdate=true;
        if (!focusedFound) {
          for (          FileEditor e : editors) {
            if (e instanceof TextEditor && ((TextEditor)e).getEditor() == myEditor) {
              needToUpdate=false;
            }
          }
        }
        if (needToUpdate && fileEditor instanceof TextEditor) {
          Editor editor1=((TextEditor)fileEditor).getEditor();
          if (editor1 != myEditor) {
            cleanUp();
          }
          if (myEditor != null) {
            myEditor.getDocument().removeDocumentListener(this);
          }
          myEditor=editor1;
          myEditor.getDocument().addDocumentListener(this);
        }
      }
 else {
        myEditor=null;
      }
    }
 else {
      myEditor=null;
    }
  }
  return myEditor;
}
