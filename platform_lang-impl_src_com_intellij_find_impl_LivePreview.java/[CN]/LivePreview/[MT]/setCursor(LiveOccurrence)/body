{
  hideBalloon();
  boolean toNotify=myCursor != null && !myCursor.equals(liveOccurrence);
  myCursor=liveOccurrence;
  if (myCursorHighlighter != null) {
    HighlightManager.getInstance(myProject).removeSegmentHighlighter(myEditor,myCursorHighlighter);
    myCursorHighlighter=null;
  }
  if (myCursor != null) {
    ArrayList<RangeHighlighter> dummy=new ArrayList<RangeHighlighter>();
    highlightRange(myCursor.getPrimaryRange(),new TextAttributes(null,null,null,null,0),dummy);
    if (!dummy.isEmpty()) {
      myCursorHighlighter=dummy.get(0);
      myCursorHighlighter.setCustomRenderer(new CustomHighlighterRenderer(){
        @Override public void paint(        Editor editor,        RangeHighlighter highlighter,        Graphics g){
          Graphics2D g2d=(Graphics2D)g;
          VisualPosition startVp=editor.offsetToVisualPosition(highlighter.getStartOffset());
          VisualPosition endVp=editor.offsetToVisualPosition(highlighter.getEndOffset());
          Point start=editor.visualPositionToXY(startVp);
          Point end=editor.visualPositionToXY(endVp);
          drawMatch(g2d,start,end,editor.getLineHeight(),1,4);
        }
      }
);
    }
    if (!insideVisibleArea(myEditor,myCursor.getPrimaryRange())) {
      myEditor.getScrollingModel().scrollTo(myEditor.offsetToLogicalPosition(myCursor.getPrimaryRange().getStartOffset()),ScrollType.CENTER);
      myEditor.getScrollingModel().runActionOnScrollingFinished(new Runnable(){
        @Override public void run(){
          showReplacementPreview();
        }
      }
);
    }
 else {
      showReplacementPreview();
    }
  }
  if (toNotify) {
    for (    CursorListener l : myListeners) {
      l.cursorMoved();
    }
  }
}
