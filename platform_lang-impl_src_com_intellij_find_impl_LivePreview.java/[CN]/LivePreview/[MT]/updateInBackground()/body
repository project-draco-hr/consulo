{
  if (myDelegate == null)   return;
  final TextRange oldCursorRange=myCursor != null ? myCursor.getPrimaryRange() : null;
  mySearchResults=performSearchInBackground();
  Collections.sort(mySearchResults,new Comparator<LiveOccurrence>(){
    @Override public int compare(    LiveOccurrence liveOccurrence,    LiveOccurrence liveOccurence1){
      return liveOccurrence.getPrimaryRange().getStartOffset() - liveOccurence1.getPrimaryRange().getStartOffset();
    }
  }
);
  if (mySearchResults != null) {
    Runnable highlightUsagesBlock=new Runnable(){
      @Override public void run(){
        doInternalCleanUp();
        highlightUsages(oldCursorRange);
        if (myContinuation != null) {
          myContinuation.run();
          myContinuation=null;
        }
      }
    }
;
    if (ApplicationManager.getApplication().isUnitTestMode()) {
      highlightUsagesBlock.run();
    }
 else {
      ApplicationManager.getApplication().invokeLater(highlightUsagesBlock);
    }
  }
}
