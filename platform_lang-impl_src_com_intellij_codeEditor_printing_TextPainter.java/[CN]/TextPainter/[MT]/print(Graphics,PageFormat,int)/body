{
  if (myOffset >= mySegmentEnd || myProgress.isCanceled()) {
    return Printable.NO_SUCH_PAGE;
  }
  isPrintingPass=!isPrintingPass;
  if (!isPrintingPass) {
    return Printable.PAGE_EXISTS;
  }
  myProgress.setText(CodeEditorBundle.message("print.file.page.progress",myFileName,(pageIndex + 1)));
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    @Override public void run(){
      myPageIndex=pageIndex;
      Graphics2D g2D=(Graphics2D)g;
      Rectangle2D.Double clip=new Rectangle2D.Double(pageFormat.getImageableX(),pageFormat.getImageableY(),pageFormat.getImageableWidth(),pageFormat.getImageableHeight());
      double headerHeight=drawHeader(g2D,clip);
      clip.y+=headerHeight;
      clip.height-=headerHeight;
      double footerHeight=drawFooter(g2D,clip);
      clip.height-=footerHeight;
      Rectangle2D.Double border=(Rectangle2D.Double)clip.clone();
      clip.x+=getCharWidth(g2D) / 2;
      clip.width-=getCharWidth(g2D);
      if (myPrintSettings.PRINT_LINE_NUMBERS) {
        double numbersStripWidth=calcNumbersStripWidth(g2D,clip) + getCharWidth(g2D) / 2;
        clip.x+=numbersStripWidth;
        clip.width-=numbersStripWidth;
      }
      clip.x+=getCharWidth(g2D) / 2;
      clip.width-=getCharWidth(g2D);
      drawText(g2D,clip);
      drawBorder(g2D,border);
    }
  }
);
  return Printable.PAGE_EXISTS;
}
