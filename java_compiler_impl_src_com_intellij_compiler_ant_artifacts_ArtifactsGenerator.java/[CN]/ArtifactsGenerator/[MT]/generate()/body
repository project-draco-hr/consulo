{
  final List<Generator> generators=new ArrayList<Generator>();
  final Target initTarget=new Target(INIT_ARTIFACTS_TARGET,null,null,null);
  generators.add(initTarget);
  initTarget.add(new Property(ArtifactAntGenerationContextImpl.ARTIFACTS_TEMP_DIR_PROPERTY,BuildProperties.propertyRelativePath(BuildProperties.getProjectBaseDirProperty(),"artifactsTemp")));
  for (  Artifact artifact : myAllArtifacts) {
    if (!myContext.shouldBuildIntoTempDirectory(artifact)) {
      generators.add(new CleanArtifactTarget(artifact,myContext));
    }
    final String outputPath=artifact.getOutputPath();
    if (!StringUtil.isEmpty(outputPath)) {
      initTarget.add(new Property(myContext.getConfiguredArtifactOutputProperty(artifact),myContext.getSubstitutedPath(outputPath)));
    }
  }
  initTarget.add(new Mkdir(BuildProperties.propertyRef(ArtifactAntGenerationContextImpl.ARTIFACTS_TEMP_DIR_PROPERTY)));
  StringBuilder depends=new StringBuilder();
  for (  Artifact artifact : myAllArtifacts) {
    Target target=createArtifactTarget(artifact);
    generators.add(target);
    if (!StringUtil.isEmpty(artifact.getOutputPath())) {
      if (depends.length() > 0)       depends.append(", ");
      depends.append(myContext.getTargetName(artifact));
    }
  }
  for (  Generator generator : myContext.getBeforeBuildGenerators()) {
    initTarget.add(generator);
  }
  Target buildAllArtifacts=new Target(BUILD_ALL_ARTIFACTS_TARGET,depends.toString(),"Build all artifacts",null);
  for (  Artifact artifact : myAllArtifacts) {
    final String artifactOutputPath=artifact.getOutputPath();
    if (!StringUtil.isEmpty(artifactOutputPath) && myContext.shouldBuildIntoTempDirectory(artifact)) {
      final String outputPath=BuildProperties.propertyRef(myContext.getConfiguredArtifactOutputProperty(artifact));
      buildAllArtifacts.add(new Mkdir(outputPath));
      final Copy copy=new Copy(outputPath);
      copy.add(new FileSet(BuildProperties.propertyRef(myContext.getArtifactOutputProperty(artifact))));
      buildAllArtifacts.add(copy);
    }
  }
  buildAllArtifacts.add(new Comment("Delete temporary files"),1);
  for (  Generator generator : myContext.getAfterBuildGenerators()) {
    buildAllArtifacts.add(generator);
  }
  buildAllArtifacts.add(new Delete(BuildProperties.propertyRef(ArtifactAntGenerationContextImpl.ARTIFACTS_TEMP_DIR_PROPERTY)));
  generators.add(buildAllArtifacts);
  return generators;
}
