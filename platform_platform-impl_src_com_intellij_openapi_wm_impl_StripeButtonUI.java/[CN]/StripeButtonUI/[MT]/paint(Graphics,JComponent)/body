{
  final AnchoredButton button=(AnchoredButton)c;
  final String text=button.getText();
  final Icon icon=(button.isEnabled()) ? button.getIcon() : button.getDisabledIcon();
  if ((icon == null) && (text == null)) {
    return;
  }
  final FontMetrics fm=button.getFontMetrics(button.getFont());
  ourViewInsets=c.getInsets(ourViewInsets);
  ourViewRect.x=ourViewInsets.left;
  ourViewRect.y=ourViewInsets.top;
  final ToolWindowAnchor anchor=button.getAnchor();
  if (ToolWindowAnchor.RIGHT == anchor || ToolWindowAnchor.LEFT == anchor) {
    ourViewRect.height=c.getWidth() - (ourViewInsets.left + ourViewInsets.right);
    ourViewRect.width=c.getHeight() - (ourViewInsets.top + ourViewInsets.bottom);
  }
 else {
    ourViewRect.height=c.getHeight() - (ourViewInsets.left + ourViewInsets.right);
    ourViewRect.width=c.getWidth() - (ourViewInsets.top + ourViewInsets.bottom);
  }
  ourIconRect.x=ourIconRect.y=ourIconRect.width=ourIconRect.height=0;
  ourTextRect.x=ourTextRect.y=ourTextRect.width=ourTextRect.height=0;
  final String clippedText=SwingUtilities.layoutCompoundLabel(c,fm,text,icon,button.getVerticalAlignment(),button.getHorizontalAlignment(),button.getVerticalTextPosition(),button.getHorizontalTextPosition(),ourViewRect,ourIconRect,ourTextRect,button.getText() == null ? 0 : button.getIconTextGap());
  final Graphics2D g2=(Graphics2D)g;
  g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING,RenderingHints.VALUE_ANTIALIAS_ON);
  g2.setRenderingHint(RenderingHints.KEY_RENDERING,RenderingHints.VALUE_RENDER_QUALITY);
  final ButtonModel model=button.getModel();
  final Color background=button.getBackground();
  boolean toFill=true;
  Color toBorder=model.isRollover() ? Color.gray : null;
  if (model.isArmed() && model.isPressed() || model.isSelected()) {
    if (toFill) {
      g2.setColor(Gray._210);
      g2.fillRoundRect(3,3,button.getWidth() - 6,button.getHeight() - 7,5,5);
    }
    toBorder=toBorder != null ? toBorder.darker() : Color.gray;
  }
  if (toBorder != null) {
    g.setColor(toBorder);
    g.drawRoundRect(3,3,button.getWidth() - 6,button.getHeight() - 7,5,5);
  }
  AffineTransform tr=null;
  if (ToolWindowAnchor.RIGHT == anchor || ToolWindowAnchor.LEFT == anchor) {
    tr=g2.getTransform();
    if (ToolWindowAnchor.RIGHT == anchor) {
      if (icon != null) {
        icon.paintIcon(c,g2,ourIconRect.y,ourIconRect.x);
      }
      g2.rotate(Math.PI / 2);
      g2.translate(0,-c.getWidth());
    }
 else {
      if (icon != null) {
        icon.paintIcon(c,g2,ourIconRect.y,c.getHeight() - ourIconRect.x - icon.getIconHeight());
      }
      g2.rotate(-Math.PI / 2);
      g2.translate(-c.getHeight(),0);
    }
  }
 else {
    if (icon != null) {
      icon.paintIcon(c,g2,ourIconRect.x,ourIconRect.y);
    }
  }
  if (text != null) {
    if (model.isEnabled()) {
      if (model.isArmed() && model.isPressed() || model.isSelected()) {
        g.setColor(background);
      }
 else {
        g.setColor(button.getForeground());
      }
    }
 else {
      g.setColor(background.darker());
    }
    if (model.isEnabled()) {
      g.setColor(button.getForeground());
      BasicGraphicsUtils.drawString(g,clippedText,button.getMnemonic2(),ourTextRect.x,ourTextRect.y + fm.getAscent());
    }
 else {
      if (model.isSelected()) {
        g.setColor(c.getBackground());
      }
 else {
        g.setColor(getDisabledTextColor());
      }
      BasicGraphicsUtils.drawString(g,clippedText,button.getMnemonic2(),ourTextRect.x,ourTextRect.y + fm.getAscent());
    }
  }
  if (ToolWindowAnchor.RIGHT == anchor || ToolWindowAnchor.LEFT == anchor) {
    g2.setTransform(tr);
  }
}
