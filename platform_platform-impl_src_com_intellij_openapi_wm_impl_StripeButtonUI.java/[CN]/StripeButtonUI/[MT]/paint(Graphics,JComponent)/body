{
  final AnchoredButton button=(AnchoredButton)c;
  final String text=button.getText();
  final Icon icon=(button.isEnabled()) ? button.getIcon() : button.getDisabledIcon();
  if ((icon == null) && (text == null)) {
    return;
  }
  final FontMetrics fm=button.getFontMetrics(button.getFont());
  ourViewInsets=c.getInsets(ourViewInsets);
  ourViewRect.x=ourViewInsets.left;
  ourViewRect.y=ourViewInsets.top;
  final ToolWindowAnchor anchor=button.getAnchor();
  if (ToolWindowAnchor.RIGHT == anchor || ToolWindowAnchor.LEFT == anchor) {
    ourViewRect.height=c.getWidth() - (ourViewInsets.left + ourViewInsets.right);
    ourViewRect.width=c.getHeight() - (ourViewInsets.top + ourViewInsets.bottom);
  }
 else {
    ourViewRect.height=c.getHeight() - (ourViewInsets.left + ourViewInsets.right);
    ourViewRect.width=c.getWidth() - (ourViewInsets.top + ourViewInsets.bottom);
  }
  ourIconRect.x=ourIconRect.y=ourIconRect.width=ourIconRect.height=0;
  ourTextRect.x=ourTextRect.y=ourTextRect.width=ourTextRect.height=0;
  final String clippedText=SwingUtilities.layoutCompoundLabel(c,fm,text,icon,button.getVerticalAlignment(),button.getHorizontalAlignment(),button.getVerticalTextPosition(),button.getHorizontalTextPosition(),ourViewRect,ourIconRect,ourTextRect,button.getText() == null ? 0 : button.getIconTextGap());
  final Graphics2D g2=(Graphics2D)g.create();
  g2.setRenderingHint(RenderingHints.KEY_ANTIALIASING,RenderingHints.VALUE_ANTIALIAS_ON);
  g2.setRenderingHint(RenderingHints.KEY_RENDERING,RenderingHints.VALUE_RENDER_QUALITY);
  final ButtonModel model=button.getModel();
  final Color background=button.getBackground();
  Color toBorder=model.isRollover() ? new Color(0,0,0,50) : null;
  final boolean vertical=anchor == ToolWindowAnchor.LEFT || anchor == ToolWindowAnchor.RIGHT;
  if (anchor == ToolWindowAnchor.RIGHT) {
    g2.translate(1,0);
  }
  if (model.isArmed() && model.isPressed() || model.isSelected()) {
    g2.setColor(new Color(0,0,0,30));
    g2.fillRect(3,3,button.getWidth() - (vertical ? 6 : 5),button.getHeight() - 6);
    g2.setColor(new Color(0,0,0,120));
    g2.drawLine(2,2,3 + button.getWidth() - (vertical ? 7 : 6),2);
    g2.drawLine(2,3,2,3 + button.getHeight() - 7);
    g2.setColor(new Color(0,0,0,40));
    g2.drawRect(3,3,button.getWidth() - (vertical ? 7 : 6),button.getHeight() - 7);
    g2.setColor(new Color(255,255,255,110));
    g2.drawLine(3,button.getHeight() - 3,3 + button.getWidth() - (vertical ? 6 : 5),button.getHeight() - 3);
    g2.drawLine(3 + button.getWidth() - (vertical ? 6 : 5),2,3 + button.getWidth() - (vertical ? 6 : 5),3 + button.getHeight() - 7);
    toBorder=null;
  }
  if (toBorder != null) {
    g2.setColor(toBorder);
    g2.drawRect(2,2,button.getWidth() - (vertical ? 6 : 5),button.getHeight() - 6);
  }
  if (anchor == ToolWindowAnchor.RIGHT) {
    g2.translate(-1,0);
  }
  AffineTransform tr=null;
  if (ToolWindowAnchor.RIGHT == anchor || ToolWindowAnchor.LEFT == anchor) {
    tr=g2.getTransform();
    if (ToolWindowAnchor.RIGHT == anchor) {
      if (icon != null) {
        icon.paintIcon(c,g2,ourIconRect.y,ourIconRect.x);
      }
      g2.rotate(Math.PI / 2);
      g2.translate(0,-c.getWidth());
    }
 else {
      if (icon != null) {
        icon.paintIcon(c,g2,ourIconRect.y,c.getHeight() - ourIconRect.x - icon.getIconHeight());
      }
      g2.rotate(-Math.PI / 2);
      g2.translate(-c.getHeight(),0);
    }
  }
 else {
    if (icon != null) {
      icon.paintIcon(c,g2,ourIconRect.x,ourIconRect.y);
    }
  }
  if (text != null) {
    if (model.isEnabled()) {
      if (model.isArmed() && model.isPressed() || model.isSelected()) {
        g2.setColor(background);
      }
 else {
        g2.setColor(button.getForeground());
      }
    }
 else {
      g2.setColor(background.darker());
    }
    if (model.isEnabled()) {
      g2.setColor(button.getForeground());
      BasicGraphicsUtils.drawString(g2,clippedText,button.getMnemonic2(),ourTextRect.x,ourTextRect.y + fm.getAscent());
    }
 else {
      if (model.isSelected()) {
        g2.setColor(c.getBackground());
      }
 else {
        g2.setColor(getDisabledTextColor());
      }
      BasicGraphicsUtils.drawString(g2,clippedText,button.getMnemonic2(),ourTextRect.x,ourTextRect.y + fm.getAscent());
    }
  }
  if (ToolWindowAnchor.RIGHT == anchor || ToolWindowAnchor.LEFT == anchor) {
    g2.setTransform(tr);
  }
  g2.dispose();
}
