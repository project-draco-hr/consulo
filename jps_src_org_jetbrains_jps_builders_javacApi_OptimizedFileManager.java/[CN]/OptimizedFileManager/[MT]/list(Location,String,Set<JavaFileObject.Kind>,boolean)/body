{
  Iterable<? extends File> path=getLocation(location);
  if (path == null)   return Collections.emptyList();
  String relativePath=packageName.replace('.',File.separatorChar);
  ListBuffer<JavaFileObject> results=new ListBuffer<JavaFileObject>();
  for (  File root : path) {
    Archive archive=myArchives.get(root);
    final boolean isFile;
    if (archive != null) {
      isFile=true;
    }
 else {
      Boolean cachedIsFile=myIsFile.get(root);
      if (cachedIsFile == null) {
        cachedIsFile=root.isFile();
        myIsFile.put(root,cachedIsFile);
      }
      isFile=cachedIsFile.booleanValue();
    }
    if (isFile) {
      collectFromArchive(root,archive,relativePath,kinds,recurse,results);
    }
 else {
      File directory=relativePath.length() != 0 ? new File(root,relativePath) : root;
      collectFromDirectory(directory,kinds,recurse,results);
    }
  }
  return results.toList();
}
