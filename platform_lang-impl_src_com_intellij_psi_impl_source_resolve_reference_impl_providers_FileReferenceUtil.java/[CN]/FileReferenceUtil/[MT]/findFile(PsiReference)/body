{
  for (int i=references.length - 1; i >= 0; i--) {
    PsiReference ref=references[i];
    if (ref instanceof FileReferenceOwner && !(ref instanceof PsiFileReference)) {
      ref=((FileReferenceOwner)ref).getLastFileReference();
    }
    if (ref instanceof PsiFileReference) {
      final PsiElement file=references[i].resolve();
      return file instanceof PsiFile ? (PsiFile)file : null;
    }
  }
  return null;
}
