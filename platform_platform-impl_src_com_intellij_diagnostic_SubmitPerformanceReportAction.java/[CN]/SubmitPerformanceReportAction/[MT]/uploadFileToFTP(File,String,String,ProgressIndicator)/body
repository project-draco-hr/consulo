{
  FTPClient ftp=new FTPClient();
  try {
    ftp.connect(ftpSite);
    indicator.setText("Connected to server");
    if (!ftp.login("anonymous","anonymous@jetbrains.com")) {
      return "Failed to login";
    }
    indicator.setText("Logged in");
    int reply=ftp.getReplyCode();
    if (!FTPReply.isPositiveCompletion(reply)) {
      ftp.disconnect();
      return "FTP server refused connection";
    }
    if (!ftp.changeWorkingDirectory(directory)) {
      return "Failed to change directory";
    }
    if (!ftp.setFileType(FTPClient.BINARY_FILE_TYPE)) {
      return "Failed to switch to binary mode";
    }
    FileInputStream readStream=new FileInputStream(reportPath);
    try {
      if (!ftp.storeFile(reportPath.getName(),readStream)) {
        return "Failed to upload file";
      }
    }
  finally {
      readStream.close();
    }
    ftp.logout();
  }
 catch (  IOException e) {
    return e.getMessage();
  }
 finally {
    if (ftp.isConnected()) {
      try {
        ftp.disconnect();
      }
 catch (      IOException ioe) {
      }
    }
  }
  return null;
}
