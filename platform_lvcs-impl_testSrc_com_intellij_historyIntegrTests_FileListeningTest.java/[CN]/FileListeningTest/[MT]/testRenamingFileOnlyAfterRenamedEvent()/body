{
  final VirtualFile f=createFile("old.txt");
  final int[] log=new int[2];
  VirtualFileListener l=new VirtualFileAdapter(){
    public void beforePropertyChange(    VirtualFilePropertyEvent e){
      log[0]=getRevisionsFor(f).size();
    }
    public void propertyChanged(    VirtualFilePropertyEvent e){
      log[1]=getRevisionsFor(f).size();
    }
  }
;
  assertEquals(1,getRevisionsFor(f).size());
  addFileListenerDuring(l,new RunnableAdapter(){
    @Override public void doRun() throws IOException {
      f.rename(null,"new.txt");
    }
  }
);
  assertEquals(1,log[0]);
  assertEquals(2,log[1]);
}
