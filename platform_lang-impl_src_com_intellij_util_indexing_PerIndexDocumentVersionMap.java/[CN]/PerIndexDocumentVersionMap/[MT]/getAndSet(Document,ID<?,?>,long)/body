{
  List<IdVersionInfo> list=document.getUserData(KEY);
  if (list == null) {
    list=((UserDataHolderEx)document).putUserDataIfAbsent(KEY,new ArrayList<IdVersionInfo>());
  }
synchronized (list) {
    for (    IdVersionInfo info : list) {
      if (info.id == indexId) {
        long old=info.docVersion;
        if (info.mapVersion != mapVersion) {
          old=0;
          info.mapVersion=mapVersion;
        }
        info.docVersion=value;
        return old;
      }
    }
    list.add(new IdVersionInfo(indexId,value,mapVersion));
    return 0;
  }
}
