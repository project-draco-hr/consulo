{
  LOG.assertTrue(antBuildListener != null);
  final boolean aborted=isProgressAborted || myIsAborted;
  String message=getFinishStatusText(aborted,buildTimeInMilliseconds);
  WindowManager.getInstance().getStatusBar(myProject).setInfo(message);
  addCommand(new FinishBuildCommand(message));
  if (!myIsOutputPaused) {
    new OutputFlusher().doFlush();
    myTreeView.scrollToLastMessage();
  }
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      final AntBuildFileBase buildFile=myBuildFile;
      if (buildFile != null) {
        if (getErrorCount() == 0 && buildFile.isViewClosedWhenNoErrors()) {
          close();
        }
 else         if (getErrorCount() > 0) {
          myTreeView.scrollToFirstError();
        }
 else {
          myTreeView.scrollToStatus();
        }
      }
      VirtualFileManager.getInstance().refresh(true,new Runnable(){
        public void run(){
          antBuildListener.buildFinished(aborted ? AntBuildListener.ABORTED : AntBuildListener.FINISHED_SUCCESSFULLY,getErrorCount());
        }
      }
);
    }
  }
);
}
