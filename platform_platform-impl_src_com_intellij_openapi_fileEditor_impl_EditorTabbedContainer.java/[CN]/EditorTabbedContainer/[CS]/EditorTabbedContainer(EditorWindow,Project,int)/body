{
  myWindow=window;
  myProject=project;
  final ActionManager actionManager=ActionManager.getInstance();
  myTabs=new JBEditorTabs(project,actionManager,IdeFocusManager.getInstance(project),this);
  myTabs.setTransferHandler(new MyTransferHandler());
  myTabs.setDataProvider(new MyDataProvider()).setPopupGroup(new Getter<ActionGroup>(){
    @Override public ActionGroup get(){
      return (ActionGroup)CustomActionsSchema.getInstance().getCorrectedAction(IdeActions.GROUP_EDITOR_TAB_POPUP);
    }
  }
,ActionPlaces.EDITOR_TAB_POPUP,false).setNavigationActionsEnabled(false).addTabMouseListener(new TabMouseListener()).getPresentation().setTabDraggingEnabled(true).setUiDecorator(new UiDecorator(){
    @Override @NotNull public UiDecoration getDecoration(){
      int sideInset=Registry.is("editor.use.compressible.tabs") ? 2 : 10;
      return new UiDecoration(null,new Insets(TabsUtil.TAB_VERTICAL_PADDING,sideInset,TabsUtil.TAB_VERTICAL_PADDING,sideInset));
    }
  }
).setTabLabelActionsMouseDeadzone(TimedDeadzone.NULL).setGhostsAlwaysVisible(true).setTabLabelActionsAutoHide(false).setActiveTabFillIn(EditorColorsManager.getInstance().getGlobalScheme().getDefaultBackground()).setPaintFocus(false).getJBTabs().addListener(new TabsListener.Adapter(){
    @Override public void selectionChanged(    final TabInfo oldSelection,    final TabInfo newSelection){
      final FileEditorManager editorManager=FileEditorManager.getInstance(myProject);
      final FileEditor oldEditor=oldSelection != null ? editorManager.getSelectedEditor((VirtualFile)oldSelection.getObject()) : null;
      if (oldEditor != null) {
        oldEditor.deselectNotify();
      }
      final FileEditor newEditor=editorManager.getSelectedEditor((VirtualFile)newSelection.getObject());
      if (newEditor != null) {
        newEditor.selectNotify();
      }
    }
  }
).setAdditionalSwitchProviderWhenOriginal(new MySwitchProvider()).setSelectionChangeHandler(new JBTabs.SelectionChangeHandler(){
    @NotNull @Override public ActionCallback execute(    TabInfo info,    boolean requestFocus,    @NotNull final ActiveRunnable doChangeSelection){
      final ActionCallback result=new ActionCallback();
      CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
        @Override public void run(){
          ((IdeDocumentHistoryImpl)IdeDocumentHistory.getInstance(myProject)).onSelectionChanged();
          result.notify(doChangeSelection.run());
        }
      }
,"EditorChange",null);
      return result;
    }
  }
).getPresentation().setRequestFocusOnLastFocusedComponent(true);
  myTabs.addMouseListener(new MouseAdapter(){
    @Override public void mouseClicked(    MouseEvent e){
      if (myTabs.findInfo(e) != null || isFloating())       return;
      if (!e.isPopupTrigger() && SwingUtilities.isLeftMouseButton(e) && e.getClickCount() == 2) {
        final ActionManager mgr=ActionManager.getInstance();
        mgr.tryToExecute(mgr.getAction("HideAllWindows"),e,null,ActionPlaces.UNKNOWN,true);
      }
    }
  }
);
  setTabPlacement(UISettings.getInstance().EDITOR_TAB_PLACEMENT);
  updateTabBorder();
  ((ToolWindowManagerEx)ToolWindowManager.getInstance(myProject)).addToolWindowManagerListener(new ToolWindowManagerAdapter(){
    @Override public void stateChanged(){
      updateTabBorder();
    }
    @Override public void toolWindowRegistered(    @NotNull final String id){
      updateTabBorder();
    }
  }
);
  UISettings.getInstance().addUISettingsListener(new UISettingsListener(){
    @Override public void uiSettingsChanged(    UISettings source){
      updateTabBorder();
    }
  }
,this);
  Disposer.register(project,this);
}
