{
  if (entry == null) {
    return;
  }
  long realCrc=crc.getValue();
  crc.reset();
  if (entry.getMethod() == ZipEntry.DEFLATED) {
    def.finish();
    while (!def.finished()) {
      deflate();
    }
    entry.setSize(adjustToLong(def.getTotalIn()));
    entry.setCompressedSize(adjustToLong(def.getTotalOut()));
    entry.setCrc(realCrc);
    def.reset();
    written+=entry.getCompressedSize();
  }
 else {
    long size=written - dataStart;
    entry.setSize(size);
    entry.setCompressedSize(size);
    entry.setCrc(realCrc);
  }
  long save=raf.getFilePointer();
  raf.seek(localDataStart);
  writeOut(ZipLong.getBytes(entry.getCrc()));
  writeOut(ZipLong.getBytes(entry.getCompressedSize()));
  writeOut(ZipLong.getBytes(entry.getSize()));
  raf.seek(save);
  entry=null;
}
