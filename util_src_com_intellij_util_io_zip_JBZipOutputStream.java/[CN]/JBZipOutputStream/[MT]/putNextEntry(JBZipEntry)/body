{
  closeEntry();
  entry=ze;
  if (entry.getMethod() == -1) {
    entry.setMethod(method);
  }
  if (entry.getTime() == -1) {
    entry.setTime(System.currentTimeMillis());
  }
  if (entry.getMethod() == ZipEntry.DEFLATED && hasCompressionLevelChanged) {
    def.setLevel(level);
    hasCompressionLevelChanged=false;
  }
  writeLocalFileHeader(entry);
}
