{
  if (!isDirectory()) {
    throw new IOException(VfsBundle.message("directory.create.wrong.parent.error"));
  }
  if (isInvalidName(name)) {
    throw new IOException(VfsBundle.message("file.invalid.name.error",name));
  }
  final boolean auxCommand=ourFileSystem.auxCreateFile(this,name);
  PhysicalFile physicalFile=getPhysicalFile().createChild(name);
  if (!auxCommand) {
    VirtualFile file=findChild(name);
    if (file != null || physicalFile.exists()) {
      throw new IOException(VfsBundle.message("file.already.exists.error",physicalFile.getPath()));
    }
    physicalFile.createOutputStream().close();
  }
  VirtualFileImpl child=new VirtualFileImpl(this,physicalFile,false);
  addChild(child);
  ourFileSystem.fireFileCreated(requestor,child);
  return child;
}
