{
  if (getParent() == null) {
    return;
  }
  if (myName.equals(newName)) {
    return;
  }
  if (isInvalidName(newName)) {
    throw new IOException(VfsBundle.message("file.invalid.name.error",newName));
  }
  final boolean auxCommand=ourFileSystem.auxRename(this,newName);
  ourFileSystem.fireBeforePropertyChange(requestor,this,PROP_NAME,myName,newName);
  String oldName=myName;
  if (!auxCommand) {
    PhysicalFile file=getPhysicalFile();
    setName(newName);
    PhysicalFile newFile=getPhysicalFile();
    if (!file.renameTo(newFile)) {
      setName(file.getName());
      throw new IOException(VfsBundle.message("file.rename.error",file.getPath(),newFile.getPath()));
    }
  }
 else {
    setName(newName);
  }
  ourFileSystem.firePropertyChanged(requestor,this,PROP_NAME,oldName,myName);
}
