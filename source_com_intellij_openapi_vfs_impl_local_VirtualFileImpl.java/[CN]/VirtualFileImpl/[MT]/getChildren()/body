{
  if (!isDirectory())   return null;
  if (myChildren == null) {
synchronized (ourFileSystem.LOCK) {
      if (myChildren == null) {
        PhysicalFile file=getPhysicalFile();
        PhysicalFile[] files=file.listFiles();
        final int length=files == null ? 0 : files.length;
        if (length == 0) {
          myChildren=EMPTY_VIRTUAL_FILE_ARRAY;
        }
 else {
          myChildren=new VirtualFileImpl[length];
          String path=getPath() + "/";
          for (int i=0; i < length; ++i) {
            PhysicalFile f=files[i];
            String childPath=path + f.getName();
            VirtualFileImpl child=ourFileSystem.myUnaccountedFiles.get(childPath);
            if (child == null) {
              child=new VirtualFileImpl(this,f,f.isDirectory());
            }
 else {
              LOG.assertTrue(child.getParent() == this);
              ourFileSystem.myUnaccountedFiles.remove(childPath);
            }
            myChildren[i]=child;
          }
        }
      }
    }
  }
  return myChildren;
}
