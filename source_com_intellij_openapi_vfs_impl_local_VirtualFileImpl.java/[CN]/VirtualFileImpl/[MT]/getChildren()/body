{
  ApplicationManager.getApplication().assertReadAccessAllowed();
  if (!isDirectory())   return null;
synchronized (ourFileSystem.LOCK) {
    if (myChildren == null) {
      ArrayList<VirtualFile> array=new ArrayList<VirtualFile>();
      PhysicalFile file=getPhysicalFile();
      PhysicalFile[] files=file.listFiles();
      for (      PhysicalFile f : files) {
        array.add(new VirtualFileImpl(this,f,f.isDirectory()));
      }
      myChildren=array.toArray(EMPTY_VIRTUAL_FILE_ARRAY);
    }
  }
  return myChildren;
}
