{
  ApplicationManager.getApplication().assertReadAccessAllowed();
  if (!isDirectory())   return null;
synchronized (myFileSystem.LOCK) {
    if (myChildren == null) {
      ArrayList<VirtualFile> array=new ArrayList<VirtualFile>();
      PhysicalFile file=getPhysicalFile();
      PhysicalFile[] files=file.listFiles();
      if (files != null) {
        for (int i=0; i < files.length; i++) {
          PhysicalFile f=files[i];
          array.add(new VirtualFileImpl(myFileSystem,this,f,f.isDirectory()));
        }
      }
      myChildren=array.toArray(EMPTY_VIRTUAL_FILE_ARRAY);
    }
  }
  return myChildren;
}
