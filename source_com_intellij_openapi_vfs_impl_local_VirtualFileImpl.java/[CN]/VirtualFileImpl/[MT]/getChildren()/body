{
  if (!isDirectory())   return null;
  if (myChildren == null) {
    File file=getPhysicalFile();
    File[] files=file.listFiles();
    VirtualFileImpl[] children;
    final int length=files == null ? 0 : files.length;
    if (length == 0) {
      children=EMPTY_VIRTUAL_FILE_ARRAY;
    }
 else {
      children=new VirtualFileImpl[length];
      String path=getPath() + "/";
      for (int i=0; i < length; ++i) {
        File f=files[i];
        String childPath=path + f.getName();
        VirtualFileImpl child=ourFileSystem.myUnaccountedFiles.remove(childPath);
        if (child == null || !child.isValid()) {
          if (SystemInfo.isWindows && FileWatcher.isAvailable()) {
            child=new VirtualFileImpl(this,f);
          }
 else {
            child=new VirtualFileImpl(this,f,f.isDirectory());
          }
        }
        children[i]=child;
      }
    }
synchronized (ourFileSystem.LOCK) {
      if (myChildren == null) {
        myChildren=children;
      }
    }
  }
  return myChildren;
}
