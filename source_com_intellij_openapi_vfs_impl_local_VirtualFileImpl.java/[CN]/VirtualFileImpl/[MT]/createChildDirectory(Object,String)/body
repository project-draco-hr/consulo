{
  if (!isDirectory()) {
    throw new IOException("Not a directory. Cannot create new directory in.");
  }
  if (isInvalidName(name)) {
    throw new IOException("Invalid file name: \"" + name + "\"");
  }
  final FileOperation auxCommand=myFileSystem.auxCreateDirectory(this,name);
  PhysicalFile physicalFile=getPhysicalFile().createChild(name);
  if (auxCommand != null) {
    putUserData(FileOperation.KEY,auxCommand);
    auxCommand.perform();
  }
 else {
    VirtualFile file=findChild(name);
    if (file != null || physicalFile.exists()) {
      throw new IOException("Cannot create file " + physicalFile.getPath() + ". File already exists.");
    }
    if (!physicalFile.mkdir()) {
      throw new IOException("Cannot create file " + physicalFile.getPath() + ".");
    }
  }
  VirtualFileImpl child=new VirtualFileImpl(myFileSystem,this,physicalFile,true);
  addChild(child);
  myFileSystem.fireFileCreated(requestor,child);
  return child;
}
