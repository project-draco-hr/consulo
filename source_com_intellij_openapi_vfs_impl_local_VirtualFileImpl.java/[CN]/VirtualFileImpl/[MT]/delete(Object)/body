{
  LOG.assertTrue(isValid());
  PhysicalFile physicalFile=getPhysicalFile();
  VirtualFileImpl parent=(VirtualFileImpl)getParent();
  if (parent == null) {
    throw new IOException("Cannot delete root file " + physicalFile.getPath() + ".");
  }
  final FileOperation auxCommand=myFileSystem.auxDelete(this);
  if (auxCommand != null) {
    putUserData(FileOperation.KEY,auxCommand);
  }
  myFileSystem.fireBeforeFileDeletion(requestor,this);
  boolean isDirectory=isDirectory();
  if (auxCommand != null) {
    auxCommand.perform();
  }
 else {
    delete(physicalFile);
  }
  parent.removeChild(this);
  myFileSystem.fireFileDeleted(requestor,this,myName,isDirectory,parent);
}
