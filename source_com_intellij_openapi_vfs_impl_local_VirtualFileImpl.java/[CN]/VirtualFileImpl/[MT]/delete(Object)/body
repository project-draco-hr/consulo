{
  LOG.assertTrue(isValid());
  PhysicalFile physicalFile=getPhysicalFile();
  VirtualFileImpl parent=(VirtualFileImpl)getParent();
  if (parent == null) {
    throw new IOException("Cannot delete root file " + physicalFile.getPath() + ".");
  }
  final boolean auxCommand=myFileSystem.auxDelete(this);
  myFileSystem.fireBeforeFileDeletion(requestor,this);
  boolean isDirectory=isDirectory();
  if (!auxCommand) {
    delete(physicalFile);
  }
  parent.removeChild(this);
  myFileSystem.fireFileDeleted(requestor,this,myName,isDirectory,parent);
  if (auxCommand && isDirectory && physicalFile.exists()) {
    VirtualFileImpl newMe=new VirtualFileImpl(myFileSystem,parent,physicalFile,true);
    parent.addChild(newMe);
    myFileSystem.fireFileCreated(requestor,newMe);
  }
}
