{
  String testName=getTestName(true);
  final VirtualFile actualRoot=myFixture.copyDirectoryToProject(testName + "/before","");
  performAction(fileNames,newDirName,VfsUtilCore.getRelativePath(actualRoot,myFixture.getTempDirFixture().getFile(""),'/'));
  final VirtualFile expectedRoot=LocalFileSystem.getInstance().findFileByPath(getTestDataPath() + getTestName(true) + "/after");
  getProject().getComponent(PostprocessReformattingAspect.class).doPostponedFormatting();
  VirtualFileManager.getInstance().syncRefresh();
  try {
    PlatformTestUtil.assertDirectoriesEqual(expectedRoot,actualRoot);
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
