{
  if (editor.isViewer())   return;
  Document doc=editor.getDocument();
  if (!doc.isWritable()) {
    if (!FileDocumentManager.fileForDocumentCheckedOutSuccessfully(doc,PlatformDataKeys.PROJECT.getData(dataContext))) {
      return;
    }
  }
  doc.startGuardedBlockChecking();
  try {
    final String str=String.valueOf(charTyped);
    CommandProcessor.getInstance().setCurrentCommandName(EditorBundle.message("typing.in.editor.command.name"));
    EditorModificationUtil.typeInStringAtCaretHonorBlockSelection(editor,str,true);
  }
 catch (  ReadOnlyFragmentModificationException e) {
    EditorActionManager.getInstance().getReadonlyFragmentModificationHandler().handle(e);
  }
 finally {
    doc.stopGuardedBlockChecking();
  }
}
