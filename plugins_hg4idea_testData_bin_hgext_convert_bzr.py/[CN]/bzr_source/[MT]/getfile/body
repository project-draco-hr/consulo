def getfile(self, name, rev):
    revtree = self.sourcerepo.revision_tree(rev)
    fileid = revtree.path2id(name.decode((self.encoding or 'utf-8')))
    kind = None
    if (fileid is not None):
        kind = revtree.kind(fileid)
    if (kind not in supportedkinds):
        raise IOError((_('%s is not available in %s anymore') % (name, rev)))
    if (kind == 'symlink'):
        target = revtree.get_symlink_target(fileid)
        if (target is None):
            raise util.Abort((_('%s.%s symlink has no target') % (name, rev)))
        return target
    else:
        sio = revtree.get_file(fileid)
        return sio.read()
