def __init__(self, ui, path, rev=None):
    super(bzr_source, self).__init__(ui, path, rev=rev)
    if (not os.path.exists(os.path.join(path, '.bzr'))):
        raise NoRepo((_('%s does not look like a Bazaar repository') % path))
    try:
        branch
    except NameError:
        raise NoRepo(_('Bazaar modules could not be loaded'))
    path = os.path.abspath(path)
    self._checkrepotype(path)
    self.branch = branch.Branch.open(path)
    self.sourcerepo = self.branch.repository
    self._parentids = {}
