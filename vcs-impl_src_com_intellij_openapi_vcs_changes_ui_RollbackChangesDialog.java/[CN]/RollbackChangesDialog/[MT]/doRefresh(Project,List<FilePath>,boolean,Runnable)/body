{
  final LocalHistoryAction action=LocalHistory.startAction(project,VcsBundle.message("changes.action.rollback.text"));
  RefreshSession session=RefreshQueue.getInstance().createSession(asynchronous,true,new Runnable(){
    public void run(){
      action.finish();
      if (!project.isDisposed()) {
        for (        FilePath path : pathsToRefresh) {
          if (path.isDirectory()) {
            VcsDirtyScopeManager.getInstance(project).dirDirtyRecursively(path);
          }
 else {
            VcsDirtyScopeManager.getInstance(project).fileDirty(path);
          }
        }
        runAfter.run();
      }
    }
  }
);
  for (  FilePath path : pathsToRefresh) {
    session.addFile(ChangesUtil.findValidParent(path));
  }
  session.launch();
}
