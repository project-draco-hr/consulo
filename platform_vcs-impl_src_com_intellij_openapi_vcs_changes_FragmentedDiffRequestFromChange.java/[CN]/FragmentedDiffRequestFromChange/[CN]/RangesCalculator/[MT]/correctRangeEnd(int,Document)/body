{
  if (end == 0)   return end;
  return "\n".equals(document.getText(new TextRange(end - 1,end))) ? end - 1 : end;
}
