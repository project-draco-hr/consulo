{
  final FilePath filePath=ChangesUtil.getFilePath(change);
  final RangesCalculator calculator=new RangesCalculator();
  calculator.execute(change,filePath,myRangesCache,LineStatusTrackerManager.getInstance(myProject));
  final VcsException exception=calculator.getException();
  if (exception != null) {
    throw exception;
  }
  final List<BeforeAfter<TextRange>> ranges=calculator.expand(extraLines);
  return new FragmentedContent(calculator.getOldDocument(),calculator.getDocument(),ranges);
}
