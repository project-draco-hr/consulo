{
  if (pathToFile() == null) {
    VirtualFile[] files=FileChooser.chooseFiles(myComponent,FILE_DESCRIPTOR);
    if (files.length > 0) {
      VirtualFile selectedFile=files[0];
      myState.currentScript=selectedFile.getPresentableUrl();
      myCurrentScript.setText(myState.currentScript);
    }
 else {
      Messages.showErrorDialog("File to save is not selected.","Cannot save script");
      return;
    }
  }
  BufferedWriter writer=null;
  try {
    final OutputStream os=pathToFile().getOutputStream(this);
    writer=new BufferedWriter(new OutputStreamWriter(os));
    final String toWrite=myDocument.getText();
    writer.write(toWrite != null ? toWrite : "");
  }
 catch (  IOException e) {
    Messages.showErrorDialog(e.getMessage(),"Cannot save script");
  }
 finally {
    if (writer != null) {
      try {
        writer.close();
      }
 catch (      IOException e) {
        LOG.error(e);
      }
    }
  }
}
