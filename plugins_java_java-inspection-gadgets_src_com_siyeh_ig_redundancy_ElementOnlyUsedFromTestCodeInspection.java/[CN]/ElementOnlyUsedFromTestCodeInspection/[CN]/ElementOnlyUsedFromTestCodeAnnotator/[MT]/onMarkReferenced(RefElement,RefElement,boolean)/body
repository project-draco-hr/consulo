{
  if (!(refWhat instanceof RefMethod) && !(refWhat instanceof RefField) && !(refWhat instanceof RefClass)) {
    return;
  }
  if (referencedFromClassInitializer || refFrom instanceof RefImplicitConstructor) {
    return;
  }
  final PsiElement whatElement=refWhat.getElement();
  if (isInsideTestClass(whatElement) || isUnderTestSources(whatElement)) {
    return;
  }
  if (refFrom instanceof RefMethod && refWhat instanceof RefClass) {
    final RefMethod method=(RefMethod)refFrom;
    if (method.isConstructor() && method.getOwnerClass() == refWhat) {
      return;
    }
  }
  final Boolean onlyUsedFromTestCode=refWhat.getUserData(ONLY_USED_FROM_TEST_CODE);
  if (onlyUsedFromTestCode == null) {
    refWhat.putUserData(ONLY_USED_FROM_TEST_CODE,Boolean.TRUE);
  }
 else   if (!onlyUsedFromTestCode.booleanValue()) {
    return;
  }
  final PsiElement fromElement=refFrom.getElement();
  if (isInsideTestClass(fromElement) || isUnderTestSources(fromElement)) {
    return;
  }
  if (refWhat instanceof RefMethod) {
    final RefMethod what=(RefMethod)refWhat;
    if (what.isConstructor()) {
      final RefClass ownerClass=what.getOwnerClass();
      ownerClass.putUserData(ONLY_USED_FROM_TEST_CODE,Boolean.FALSE);
    }
  }
  refWhat.putUserData(ONLY_USED_FROM_TEST_CODE,Boolean.FALSE);
}
