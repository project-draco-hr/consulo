{
synchronized (myDocumentToStatusMap) {
    PsiFile file=PsiDocumentManager.getInstance(myProject).getPsiFile(document);
    if (!ProblemHighlightFilter.shouldHighlightFile(file))     return null;
    FileStatus status=myDocumentToStatusMap.get(document);
    if (status == null) {
      return file == null ? null : file.getTextRange();
    }
    if (status.defensivelyMarked) {
      status.markWholeFileDirty(myProject);
      status.defensivelyMarked=false;
    }
    if (!status.dirtyScopes.containsKey(passId))     throw new IllegalStateException("Unknown pass " + passId);
    RangeMarker marker=status.dirtyScopes.get(passId);
    return marker == null ? null : marker.isValid() ? TextRange.create(marker) : new TextRange(0,document.getTextLength());
  }
}
