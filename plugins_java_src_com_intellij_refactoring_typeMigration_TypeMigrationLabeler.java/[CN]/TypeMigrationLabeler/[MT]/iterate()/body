{
  final LinkedList<Pair<TypeMigrationUsageInfo,PsiType>> roots=(LinkedList<Pair<TypeMigrationUsageInfo,PsiType>>)myMigrationRoots.clone();
  myMigrationRoots=new LinkedList<Pair<TypeMigrationUsageInfo,PsiType>>();
  final PsiReference[][] cachedUsages=new PsiReference[roots.size()][];
  int j=0;
  for (  final Pair<TypeMigrationUsageInfo,PsiType> p : roots) {
    cachedUsages[j++]=markRootUsages(p.getFirst().getElement(),p.getSecond());
  }
  j=0;
  for (  final Pair<TypeMigrationUsageInfo,PsiType> root : roots) {
    myCurrentRoot=root.getFirst();
    migrateRoot(root.getFirst().getElement(),root.getSecond(),cachedUsages[j++]);
  }
}
