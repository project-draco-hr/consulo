{
  PsiElementFactory elementFactory=candidateClass.getManager().getElementFactory();
  if (PsiUtil.isRawSubstitutor(aClass,substitutor)) {
    return candidateSubstitutor.merge(elementFactory.createRawSubstitutor(candidateClass));
  }
  final PsiType containingType=elementFactory.createType(candidateClass,candidateSubstitutor);
  PsiType type=substitutor.substitute(containingType);
  if (!(type instanceof PsiClassType))   return candidateSubstitutor;
  PsiSubstitutor finalSubstitutor=((PsiClassType)type).resolveGenerics().getSubstitutor();
  return finalSubstitutor;
}
