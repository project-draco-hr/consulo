{
  if (visited.contains(aClass))   return true;
  processor.handleEvent(PsiScopeProcessor.Event.SET_DECLARATION_HOLDER,aClass);
  final ElementClassHint classHint=processor.getHint(ElementClassHint.class);
  final NameHint nameHint=processor.getHint(NameHint.class);
  PsiManager manager=aClass.getManager();
  if (classHint == null || classHint.shouldProcess(PsiField.class)) {
    if (nameHint != null) {
      final PsiField fieldByName=aClass.findFieldByName(nameHint.getName(),false);
      if (fieldByName != null)       if (!processor.execute(fieldByName,substitutor))       return false;
    }
 else {
      final PsiField[] fields=aClass.getFields();
      for (int i=0; i < fields.length; i++) {
        final PsiField field=fields[i];
        if (!processor.execute(field,substitutor))         return false;
      }
    }
    final PsiField[] introducedFields=manager.getAspectManager().getIntroducedFields(aClass);
    for (int i=0; i < introducedFields.length; i++) {
      if (!processor.execute(introducedFields[i],substitutor))       return false;
    }
  }
  if (classHint == null || classHint.shouldProcess(PsiMethod.class)) {
    if (nameHint != null) {
      final PsiMethod[] methods=aClass.findMethodsByName(nameHint.getName(),false);
      for (int i=0; methods != null && i < methods.length; i++) {
        final PsiMethod method=methods[i];
        if (!processor.execute(method,substitutor))         return false;
      }
    }
 else {
      final PsiMethod[] methods=aClass.getMethods();
      for (int i=0; i < methods.length; i++) {
        final PsiMethod method=methods[i];
        if (!processor.execute(method,substitutor))         return false;
      }
    }
    PsiMethod[] introducedMethods=manager.getAspectManager().getIntroducedMethods(aClass);
    for (int i=0; i < introducedMethods.length; i++) {
      if (!processor.execute(introducedMethods[i],substitutor))       return false;
    }
  }
  if (classHint == null || classHint.shouldProcess(PsiClass.class)) {
    if (last != null && last.getParent() == aClass) {
      final PsiTypeParameterList list=aClass.getTypeParameterList();
      if (list != null && !PsiScopesUtil.processScope(list,processor,PsiSubstitutor.EMPTY,last,place))       return false;
    }
    if (!(last instanceof PsiReferenceList) && !(last instanceof PsiModifierList)) {
      if (nameHint != null) {
        final PsiClass inner=aClass.findInnerClassByName(nameHint.getName(),false);
        if (inner != null)         if (!processor.execute(inner,substitutor))         return false;
      }
 else {
        final PsiClass[] inners=aClass.getInnerClasses();
        for (int i=0; i < inners.length; i++) {
          final PsiClass inner=inners[i];
          if (!processor.execute(inner,substitutor))           return false;
        }
      }
    }
  }
  visited.add(aClass);
  if (!(last instanceof PsiReferenceList)) {
    if (!processSuperTypes(aClass.getSuperTypes(),processor,visited,last,place,aClass,substitutor)) {
      return false;
    }
  }
  return true;
}
