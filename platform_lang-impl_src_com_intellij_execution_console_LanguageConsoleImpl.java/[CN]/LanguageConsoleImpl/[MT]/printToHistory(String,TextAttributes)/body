{
  ApplicationManager.getApplication().assertIsDispatchThread();
  text=StringUtil.convertLineSeparators(text);
  final boolean scrollToEnd=shouldScrollHistoryToEnd();
  addTextToHistory(text,attributes);
  if (scrollToEnd) {
    scrollHistoryToEnd();
  }
  queueUiUpdate(scrollToEnd);
}
