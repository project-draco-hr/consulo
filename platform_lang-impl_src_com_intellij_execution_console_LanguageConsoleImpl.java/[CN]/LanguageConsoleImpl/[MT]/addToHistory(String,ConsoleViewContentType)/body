{
  final boolean scrollToEnd=shouldScrollHistoryToEnd();
  final Document history=myHistoryViewer.getDocument();
  final MarkupModel markupModel=history.getMarkupModel(myProject);
  final int offset=history.getTextLength();
  history.insertString(offset,text);
  if (!text.endsWith("\n"))   history.insertString(history.getTextLength(),"\n");
  markupModel.addRangeHighlighter(offset,history.getTextLength(),HighlighterLayer.SYNTAX,contentType.getAttributes(),HighlighterTargetArea.EXACT_RANGE);
  queueUiUpdate(scrollToEnd);
}
