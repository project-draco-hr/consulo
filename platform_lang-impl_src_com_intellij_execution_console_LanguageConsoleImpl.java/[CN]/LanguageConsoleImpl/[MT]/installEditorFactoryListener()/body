{
  myProject.getMessageBus().connect(this).subscribe(FileEditorManagerListener.FILE_EDITOR_MANAGER,new FileEditorManagerAdapter(){
    @Override public void fileOpened(    FileEditorManager source,    VirtualFile file){
      if (!Comparing.equal(file,myFile.getVirtualFile()) || myConsoleEditor == null)       return;
      Editor selectedTextEditor=source.getSelectedTextEditor();
      for (      FileEditor fileEditor : source.getAllEditors(file)) {
        if (!(fileEditor instanceof TextEditor))         continue;
        final Editor editor=((TextEditor)fileEditor).getEditor();
        setConsoleFilePinned((FileEditorManagerEx)source,editor);
        ((EditorEx)editor).addFocusListener(myFocusListener);
        if (selectedTextEditor == editor) {
          myCurrentEditor=editor;
        }
        EmptyAction.registerActionShortcuts(editor.getComponent(),myConsoleEditor.getComponent());
        editor.getCaretModel().addCaretListener(new CaretListener(){
          public void caretPositionChanged(          CaretEvent e){
            queueUiUpdate(false);
          }
        }
);
      }
      queueUiUpdate(false);
    }
    @Override public void fileClosed(    FileEditorManager source,    VirtualFile file){
      if (!Comparing.equal(file,myFile.getVirtualFile()))       return;
      if (myUiUpdateRunnable != null && !Boolean.TRUE.equals(file.getUserData(FileEditorManagerImpl.CLOSING_TO_REOPEN))) {
        if (myCurrentEditor.isDisposed())         myCurrentEditor=null;
        ApplicationManager.getApplication().runReadAction(myUiUpdateRunnable);
      }
    }
  }
);
}
