{
  final EditorFactoryListener factoryListener=new EditorFactoryListener(){
    public void editorCreated(    final EditorFactoryEvent event){
      final Editor editor=event.getEditor();
      if (editor.getDocument() == myEditorDocument) {
        if (myConsoleEditor != null) {
          queueUiUpdate(false);
          registerActionShortcuts(editor.getComponent());
        }
        editor.getCaretModel().addCaretListener(new CaretListener(){
          public void caretPositionChanged(          CaretEvent e){
            queueUiUpdate(false);
          }
        }
);
        editor.getContentComponent().addFocusListener(new FocusListener(){
          public void focusGained(          final FocusEvent e){
            myCurrentEditor=editor;
          }
          public void focusLost(          final FocusEvent e){
          }
        }
);
      }
    }
    public void editorReleased(    final EditorFactoryEvent event){
      if (event.getEditor().getDocument() == myEditorDocument) {
        if (myUiUpdateRunnable != null) {
          ApplicationManager.getApplication().runReadAction(myUiUpdateRunnable);
        }
      }
    }
  }
;
  EditorFactory.getInstance().addEditorFactoryListener(factoryListener);
  Disposer.register(this,new Disposable(){
    public void dispose(){
      EditorFactory.getInstance().removeEditorFactoryListener(factoryListener);
    }
  }
);
}
