{
  myProject.getMessageBus().connect(this).subscribe(FileEditorManagerListener.FILE_EDITOR_MANAGER,new FileEditorManagerAdapter(){
    @Override public void fileOpened(    FileEditorManager source,    VirtualFile file){
      if (file != myFile.getVirtualFile())       return;
      if (myConsoleEditor != null) {
        queueUiUpdate(false);
        for (        FileEditor fileEditor : source.getAllEditors(file)) {
          if (!(fileEditor instanceof TextEditor))           continue;
          final Editor editor=((TextEditor)fileEditor).getEditor();
          registerActionShortcuts(editor.getComponent());
          editor.getCaretModel().addCaretListener(new CaretListener(){
            public void caretPositionChanged(            CaretEvent e){
              queueUiUpdate(false);
            }
          }
);
          editor.getContentComponent().addFocusListener(new FocusListener(){
            public void focusGained(            final FocusEvent e){
              myCurrentEditor=editor;
            }
            public void focusLost(            final FocusEvent e){
            }
          }
);
        }
      }
    }
    @Override public void fileClosed(    FileEditorManager source,    VirtualFile file){
      if (file != myFile.getVirtualFile())       return;
      if (myUiUpdateRunnable != null) {
        ApplicationManager.getApplication().runReadAction(myUiUpdateRunnable);
      }
    }
  }
);
}
