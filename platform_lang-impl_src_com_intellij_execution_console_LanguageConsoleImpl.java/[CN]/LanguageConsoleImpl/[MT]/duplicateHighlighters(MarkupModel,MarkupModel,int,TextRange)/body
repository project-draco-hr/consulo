{
  for (  RangeHighlighter rangeHighlighter : from.getAllHighlighters()) {
    final int localOffset=textRange.getStartOffset();
    final int start=Math.max(rangeHighlighter.getStartOffset(),localOffset) - localOffset;
    final int end=Math.min(rangeHighlighter.getEndOffset(),textRange.getEndOffset()) - localOffset;
    if (start > end)     continue;
    final RangeHighlighter h=to.addRangeHighlighter(start + offset,end + offset,rangeHighlighter.getLayer(),rangeHighlighter.getTextAttributes(),rangeHighlighter.getTargetArea());
    ((RangeHighlighterEx)h).setAfterEndOfLine(((RangeHighlighterEx)rangeHighlighter).isAfterEndOfLine());
  }
}
