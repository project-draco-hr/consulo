{
  setupEditorDefault(myConsoleEditor);
  setupEditorDefault(myHistoryViewer);
  myConsoleEditor.addEditorMouseListener(EditorActionUtil.createEditorPopupHandler(IdeActions.GROUP_CONSOLE_EDITOR_POPUP));
  if (SEPARATOR_THICKNESS > 0 && myShowSeparatorLine) {
    myHistoryViewer.getComponent().setBorder(new SideBorder(JBColor.LIGHT_GRAY,SideBorder.BOTTOM));
  }
  myHistoryViewer.getComponent().setMinimumSize(new Dimension(0,0));
  myHistoryViewer.getComponent().setPreferredSize(new Dimension(0,0));
  myConsoleEditor.getSettings().setAdditionalLinesCount(2);
  myConsoleEditor.setHighlighter(EditorHighlighterFactory.getInstance().createEditorHighlighter(myProject,myVirtualFile));
  myHistoryViewer.setCaretEnabled(false);
  myConsoleEditor.setHorizontalScrollbarVisible(true);
  final VisibleAreaListener areaListener=new VisibleAreaListener(){
    @Override public void visibleAreaChanged(    VisibleAreaEvent e){
      final int offset=myConsoleEditor.getScrollingModel().getHorizontalScrollOffset();
      final ScrollingModel model=myHistoryViewer.getScrollingModel();
      final int historyOffset=model.getHorizontalScrollOffset();
      if (historyOffset != offset) {
        try {
          model.disableAnimation();
          model.scrollHorizontally(offset);
        }
  finally {
          model.enableAnimation();
        }
      }
    }
  }
;
  myConsoleEditor.getScrollingModel().addVisibleAreaListener(areaListener);
  final DocumentAdapter docListener=new DocumentAdapter(){
    @Override public void documentChanged(    final DocumentEvent e){
      queueUiUpdate(false);
    }
  }
;
  myEditorDocument.addDocumentListener(docListener,this);
  myHistoryViewer.getDocument().addDocumentListener(docListener,this);
  myHistoryViewer.getContentComponent().addKeyListener(new KeyAdapter(){
    @Override public void keyTyped(    KeyEvent event){
      if (isConsoleEditorEnabled() && UIUtil.isReallyTypedEvent(event)) {
        myConsoleEditor.getContentComponent().requestFocus();
        myConsoleEditor.processKeyTyped(event);
      }
    }
  }
);
  for (  AnAction action : createActions()) {
    action.registerCustomShortcutSet(action.getShortcutSet(),myConsoleEditor.getComponent());
  }
  EmptyAction.registerActionShortcuts(myHistoryViewer.getComponent(),myConsoleEditor.getComponent());
}
