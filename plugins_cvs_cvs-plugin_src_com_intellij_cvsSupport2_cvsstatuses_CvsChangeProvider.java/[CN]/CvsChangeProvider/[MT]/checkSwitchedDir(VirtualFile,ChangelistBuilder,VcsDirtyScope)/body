{
  VirtualFile parentDir=dir.getParent();
  if (parentDir == null || !myFileIndex.isInContent(parentDir)) {
    return;
  }
  final CvsInfo info=myEntriesManager.getCvsInfoFor(dir);
  if (info.getRepository() == null) {
    builder.processUnversionedFile(dir);
    return;
  }
  final String dirTag=info.getStickyTag();
  final CvsInfo parentInfo=myEntriesManager.getCvsInfoFor(parentDir);
  final String parentDirTag=parentInfo.getStickyTag();
  if (!Comparing.equal(dirTag,parentDirTag)) {
    final String caption=getSwitchedTagCaption(dirTag,parentDirTag,true);
    if (caption != null) {
      builder.processSwitchedFile(dir,caption,true);
    }
  }
 else   if (!scope.belongsTo(VcsContextFactory.SERVICE.getInstance().createFilePathOn(parentDir))) {
    final String parentBranch=myChangeListManager.getSwitchedBranch(parentDir);
    if (parentBranch != null) {
      builder.processSwitchedFile(dir,parentBranch,true);
    }
  }
}
