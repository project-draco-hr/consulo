{
  FilterLexer filterLexer=new FilterLexer(lexer,new FilterLexer.SetFilter(StdTokenSets.WHITE_SPACE_OR_COMMENT_BIT_SET));
  filterLexer.start(buffer,startOffset,endOffset);
  final FileElement dummyRoot=DummyHolderFactory.createHolder(manager,null,table).getTreeElement();
  JavaParsingContext context=new JavaParsingContext(dummyRoot.getCharTable(),LanguageLevelProjectExtension.getInstance(manager.getProject()).getLanguageLevel());
  if (!skipHeader) {
    TreeElement packageStatement=(TreeElement)context.getFileTextParsing().parsePackageStatement(filterLexer);
    if (packageStatement != null) {
      dummyRoot.rawAddChildren(packageStatement);
    }
    final TreeElement importList=(TreeElement)parseImportList(filterLexer,context);
    dummyRoot.rawAddChildren(importList);
  }
  CompositeElement invalidElementsGroup=null;
  while (true) {
    if (filterLexer.getTokenType() == null)     break;
    if (filterLexer.getTokenType() == ElementType.SEMICOLON) {
      dummyRoot.rawAddChildren(ParseUtil.createTokenElement(filterLexer,dummyRoot.getCharTable()));
      filterLexer.advance();
      invalidElementsGroup=null;
      continue;
    }
    TreeElement first=context.getDeclarationParsing().parseDeclaration(filterLexer,DeclarationParsing.Context.FILE_CONTEXT);
    if (first != null) {
      dummyRoot.rawAddChildren(first);
      invalidElementsGroup=null;
      continue;
    }
    if (invalidElementsGroup == null) {
      invalidElementsGroup=Factory.createErrorElement(JavaErrorMessages.message("expected.class.or.interface"));
      dummyRoot.rawAddChildren(invalidElementsGroup);
    }
    invalidElementsGroup.rawAddChildren(ParseUtil.createTokenElement(filterLexer,context.getCharTable()));
    filterLexer.advance();
  }
  ParseUtil.insertMissingTokens(dummyRoot,lexer,startOffset,endOffset,-1,WhiteSpaceAndCommentsProcessor.INSTANCE,context);
  return dummyRoot.getFirstChildNode();
}
