{
  KeymapImpl keymap=getSelectedKeymap();
  if (keymap == null) {
    return;
  }
  KeymapImpl newKeymap=keymap.deriveKeymap();
  String newKeymapName=KeyMapBundle.message("new.keymap.name");
  if (!tryNewKeymapName(newKeymapName)) {
    for (int i=0; ; i++) {
      newKeymapName=KeyMapBundle.message("new.indexed.keymap.name",i);
      if (tryNewKeymapName(newKeymapName)) {
        break;
      }
    }
  }
  newKeymap.setName(newKeymapName);
  newKeymap.setCanModify(true);
  myKeymapListModel.addElement(newKeymap);
  myKeymapList.setSelectedValue(newKeymap,true);
  processCurrentKeymapChanged();
  int result=Messages.showYesNoDialog(this,KeyMapBundle.message("is.new.keymap.active.dialog.message"),KeyMapBundle.message("is.new.keymap.active.dialog.title"),Messages.getQuestionIcon());
  if (result == 0) {
    myActiveKeymap=newKeymap;
    myKeymapList.repaint();
  }
  if (myKeymapNameField.isEnabled()) {
    myKeymapNameField.setSelectionStart(0);
    myKeymapNameField.setSelectionEnd(myKeymapNameField.getText().length());
    myKeymapNameField.requestFocus();
  }
}
