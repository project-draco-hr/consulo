{
  HashSet keymapNames=new HashSet();
  for (int i=0; i < myKeymapListModel.getSize(); i++) {
    Keymap keymap=(Keymap)myKeymapListModel.elementAt(i);
    String name=keymap.getName();
    if (keymapNames.contains(name)) {
      throw new ConfigurationException("All keymaps should have unique names");
    }
    keymapNames.add(name);
  }
  KeymapManagerImpl keymapManager=(KeymapManagerImpl)KeymapManager.getInstance();
  keymapManager.removeAllKeymapsExceptUnmodifiable();
  for (int i=0; i < myKeymapListModel.getSize(); i++) {
    Keymap keymap=(Keymap)myKeymapListModel.elementAt(i);
    if (keymap.canModify()) {
      keymapManager.addKeymap(keymap);
    }
  }
  keymapManager.setActiveKeymap(myActiveKeymap);
  try {
    keymapManager.save();
  }
 catch (  IOException e) {
    throw new ConfigurationException(e.getMessage());
  }
  QuickListsManager.getInstance().removeAllQuickLists();
  int size=myQuickListsModel.getSize();
  for (int i=0; i < size; i++) {
    QuickList list=(QuickList)myQuickListsModel.getElementAt(i);
    QuickListsManager.getInstance().registerQuickList(list,false);
  }
  QuickListsManager.getInstance().registerActions();
}
