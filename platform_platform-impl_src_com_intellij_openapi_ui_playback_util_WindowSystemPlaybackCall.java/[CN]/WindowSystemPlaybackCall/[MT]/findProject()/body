{
  final AsyncResult<Project> project=new AsyncResult<Project>();
  final IdeFocusManager fm=IdeFocusManager.getGlobalInstance();
  fm.doWhenFocusSettlesDown(new Runnable(){
    @Override public void run(){
      Component parent=UIUtil.findUltimateParent(fm.getFocusOwner());
      if (parent instanceof IdeFrame) {
        IdeFrame frame=(IdeFrame)parent;
        if (frame.getProject() != null) {
          project.setDone(frame.getProject());
          return;
        }
      }
      project.setRejected();
    }
  }
);
  return project;
}
