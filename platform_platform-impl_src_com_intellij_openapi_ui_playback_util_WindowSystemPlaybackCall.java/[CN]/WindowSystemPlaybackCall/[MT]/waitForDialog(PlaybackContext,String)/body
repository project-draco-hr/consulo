{
  final AsyncResult<String> result=new AsyncResult<String>();
  final Ref<AWTEventListener> listener=new Ref<AWTEventListener>();
  listener.set(new AWTEventListener(){
    @Override public void eventDispatched(    AWTEvent event){
      if (event.getID() == WindowEvent.WINDOW_ACTIVATED) {
        final Window wnd=((WindowEvent)event).getWindow();
        if (wnd instanceof JDialog) {
          if (title.equals(((JDialog)wnd).getTitle())) {
            Toolkit.getDefaultToolkit().removeAWTEventListener(listener.get());
            SwingUtilities.invokeLater(new Runnable(){
              @Override public void run(){
                getUiReady(context).notify(result);
              }
            }
);
          }
        }
      }
    }
  }
);
  Toolkit.getDefaultToolkit().addAWTEventListener(listener.get(),WindowEvent.WINDOW_EVENT_MASK);
  SimpleTimer.getInstance().setUp(new Runnable(){
    @Override public void run(){
      Toolkit.getDefaultToolkit().removeAWTEventListener(listener.get());
      if (!result.isProcessed()) {
        result.setRejected("Timed out waiting for window: " + title);
      }
    }
  }
,Registry.intValue("actionSystem.commandProcessingTimeout"));
  return result;
}
