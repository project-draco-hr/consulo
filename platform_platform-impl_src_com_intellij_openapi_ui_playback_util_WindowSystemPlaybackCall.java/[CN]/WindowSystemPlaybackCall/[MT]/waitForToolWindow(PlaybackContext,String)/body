{
  final AsyncResult<String> result=new AsyncResult<String>();
  findProject().doWhenDone(new AsyncResult.Handler<Project>(){
    @Override public void run(    Project project){
      ToolWindow toolWindow=ToolWindowManager.getInstance(project).getToolWindow(id);
      if (toolWindow == null) {
        result.setRejected("Cannot find tool window with id: " + id);
        return;
      }
      toolWindow.getReady(context).doWhenDone(new Runnable(){
        @Override public void run(){
          result.setDone();
        }
      }
).doWhenRejected(new Runnable(){
        @Override public void run(){
          result.setRejected("Cannot activate tool window with id:" + id);
        }
      }
);
    }
  }
).doWhenRejected(new Runnable(){
    @Override public void run(){
      result.setRejected("Cannot retrieve open project");
    }
  }
);
  return result;
}
