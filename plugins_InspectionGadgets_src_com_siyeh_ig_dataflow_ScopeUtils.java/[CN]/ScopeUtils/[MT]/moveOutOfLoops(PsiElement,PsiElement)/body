{
  PsiElement result=maxScope;
  if (PsiUtil.isLoopStatement(result)) {
    return result;
  }
  while (!result.equals(scope)) {
    final PsiElement element=getChildWhichContainsElement(result,scope);
    if (element == null || PsiUtil.isLoopStatement(element)) {
      while (result != null && !(result instanceof PsiCodeBlock)) {
        result=result.getParent();
      }
      return result;
    }
 else {
      result=element;
    }
  }
  return scope;
}
