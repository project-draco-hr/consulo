{
  HttpURLConnection connection=(HttpURLConnection)new URL(myPluginUrl).openConnection();
  try {
    final ProgressIndicator pi=new ProgressIndicatorBase();
    pi.setText(IdeBundle.message("progress.connecting"));
    InputStream is=UrlConnectionUtil.getConnectionInputStream(connection,pi);
    if (is == null) {
      throw new IOException("Failed to open connection");
    }
    pi.setText(IdeBundle.message("progress.downloading.plugin",getPluginName()));
    File file=new File(PathManagerEx.getPluginTempPath(),getFileName());
    file.createNewFile();
    int responseCode=connection.getResponseCode();
switch (responseCode) {
case HttpURLConnection.HTTP_OK:
      break;
default :
    throw new IOException(IdeBundle.message("error.connection.failed.with.http.code.N",responseCode));
}
pi.setIndeterminate(true);
OutputStream fos=null;
try {
  fos=new BufferedOutputStream(new FileOutputStream(file,false));
  StreamUtil.copyStreamContent(is,fos);
}
  finally {
  if (fos != null) {
    fos.close();
  }
  is.close();
}
return file;
}
  finally {
connection.disconnect();
}
}
