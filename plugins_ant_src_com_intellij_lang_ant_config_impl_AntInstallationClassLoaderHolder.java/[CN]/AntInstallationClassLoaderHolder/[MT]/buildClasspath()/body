{
  final ArrayList<File> files=new ArrayList<File>();
  final List<AntClasspathEntry> cp=AntInstallation.CLASS_PATH.get(myOptions);
  for (  final AntClasspathEntry entry : cp) {
    entry.addFilesTo(files);
  }
  files.addAll(AntBuildFileImpl.getUserHomeLibraries());
  final List<URL> urls=new ArrayList<URL>(files.size());
  for (  File file : files) {
    try {
      urls.add(file.toURI().toURL());
    }
 catch (    MalformedURLException e) {
      LOG.debug(e);
    }
  }
  final ProgressManager pm=ProgressManager.getInstance();
  return new UrlClassLoader(urls,null,true,false){
    protected Class findClass(    final String name) throws ClassNotFoundException {
      pm.checkCanceled();
      return super.findClass(name);
    }
  }
;
}
