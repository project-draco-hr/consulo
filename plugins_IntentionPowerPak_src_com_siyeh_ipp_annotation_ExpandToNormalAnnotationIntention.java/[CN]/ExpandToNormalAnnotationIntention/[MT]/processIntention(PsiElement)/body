{
  final PsiAnnotation annotation=(PsiAnnotation)element;
  final int textOffset=annotation.getTextOffset();
  final Project project=annotation.getProject();
  final String text=buildReplacementText(annotation);
  final PsiElementFactory factory=JavaPsiFacade.getElementFactory(project);
  final PsiAnnotation newAnnotation=factory.createAnnotationFromText(text,annotation);
  annotation.replace(newAnnotation);
  final FileEditorManager editorManager=FileEditorManager.getInstance(project);
  final Editor editor=editorManager.getSelectedTextEditor();
  if (editor == null) {
    return;
  }
  final CaretModel caretModel=editor.getCaretModel();
  caretModel.moveToOffset(textOffset + text.length() - 1);
}
