{
  DocumentEventImpl e=(DocumentEventImpl)e1;
  if (e.isOnlyOneLineChanged() && mySegments.getSegmentCount() > 0) {
    processOneLineChange(e);
  }
 else {
    if (mySegments.getSegmentCount() == 0 || e.getStartOldIndex() >= mySegments.getSegmentCount() || e.getStartOldIndex() < 0) {
      initSegments(e.getDocument().getCharsSequence(),true);
      return;
    }
    int optimizedLineShift=e.getOptimizedLineShift();
    if (optimizedLineShift != -1) {
      processOptimizedMultilineChange(e,optimizedLineShift);
    }
 else {
      processMultilineChange(e);
    }
  }
  if (e.isWholeTextReplaced()) {
    clearModificationFlags();
  }
}
