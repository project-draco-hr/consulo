{
  DocumentEventImpl e=(DocumentEventImpl)e1;
  if (e.isOnlyOneLineChanged() && mySegments.getSegmentCount() > 0) {
    processOneLineChange(e);
  }
 else {
    if (mySegments.getSegmentCount() == 0 || e.getStartOldIndex() >= mySegments.getSegmentCount() || e.getStartOldIndex() < 0) {
      initSegments(e.getDocument().getCharsSequence(),true);
      return;
    }
    final int optimizedLineShift=e.getOptimizedLineShift();
    if (optimizedLineShift != -1) {
      processOptimizedMultilineInsert(e,optimizedLineShift);
    }
 else {
      final int optimizedOldLineShift=e.getOptimizedOldLineShift();
      if (optimizedOldLineShift != -1) {
        processOptimizedMultilineDelete(e,optimizedOldLineShift);
      }
 else {
        processMultilineChange(e);
      }
    }
  }
  if (e.isWholeTextReplaced()) {
    clearModificationFlags();
  }
}
