{
synchronized (lock) {
    LinkedHashMap<LookupElement,PrefixMatcher> map=new LinkedHashMap<LookupElement,PrefixMatcher>();
    for (    LookupElement item : myItems) {
      if (item.isValid()) {
        PrefixMatcher matcher=lookup.itemMatcher(item).cloneWithPrefix(newPrefix);
        if (matcher.prefixMatches(item)) {
          map.put(item,matcher);
        }
      }
    }
    if (map.size() != myItems.size()) {
      clearItems();
      for (      LookupElement newItem : map.keySet()) {
        addItem(newItem);
      }
    }
    return map;
  }
}
