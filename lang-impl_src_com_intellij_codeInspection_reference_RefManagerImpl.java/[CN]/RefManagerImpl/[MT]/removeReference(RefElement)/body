{
  myLock.writeLock().lock();
  try {
    final Map<PsiElement,RefElement> refTable=getRefTable();
    final PsiElement element=refElem.getElement();
    final RefManagerExtension extension=element != null ? getExtension(element.getLanguage()) : null;
    if (extension != null) {
      extension.removeReference(refElem);
    }
    if (refTable.remove(element) != null)     return;
    for (    PsiElement psiElement : refTable.keySet()) {
      if (refTable.get(psiElement) == refElem) {
        refTable.remove(psiElement);
        return;
      }
    }
  }
  finally {
    myLock.writeLock().unlock();
  }
}
