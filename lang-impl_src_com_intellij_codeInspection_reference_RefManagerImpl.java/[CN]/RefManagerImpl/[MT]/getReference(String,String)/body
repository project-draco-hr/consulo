{
  for (  RefManagerExtension extension : myExtensions.values()) {
    final RefEntity refEntity=extension.getReference(type,fqName);
    if (refEntity != null)     return refEntity;
  }
  if (SmartRefElementPointer.FILE.equals(type)) {
    return RefFileImpl.fileFromExternalName(this,fqName);
  }
 else   if (SmartRefElementPointer.MODULE.equals(type)) {
    return RefModuleImpl.moduleFromName(this,fqName);
  }
 else   if (SmartRefElementPointer.PROJECT.equals(type)) {
    return getRefProject();
  }
 else   if (SmartRefElementPointer.DIR.equals(type)) {
    final VirtualFile vFile=LocalFileSystem.getInstance().findFileByPath(PathMacroManager.getInstance(getProject()).expandPath(fqName));
    if (vFile != null) {
      final PsiDirectory dir=PsiManager.getInstance(getProject()).findDirectory(vFile);
      return getReference(dir);
    }
  }
  return null;
}
