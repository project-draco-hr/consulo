{
  if (qualifier == null || (qualifier instanceof PsiThisExpression && ((PsiThisExpression)qualifier).getQualifier() == null)) {
    return refClass.equals(PsiTreeUtil.getParentOfType(qualifier,PsiClass.class));
  }
  if (qualifier instanceof PsiThisExpression) {
    PsiJavaCodeReferenceElement thisQualifier=((PsiThisExpression)qualifier).getQualifier();
    final PsiElement resolved=thisQualifier.resolve();
    if (!(resolved instanceof PsiClass))     return false;
    return InheritanceUtil.isInheritorOrSelf(((PsiClass)resolved),refClass,true) && !PsiTreeUtil.isAncestor(refClass,resolved,true);
  }
  return false;
}
