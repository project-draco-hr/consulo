{
  Document document=editor.getDocument();
  CharSequence chars=document.getCharsSequence();
  endOffset=CharArrayUtil.shiftBackward(chars,endOffset - 1,"\n\r") + 1;
  int line1=document.getLineNumber(startOffset);
  int line2=document.getLineNumber(endOffset);
  int lineStart=CharArrayUtil.shiftBackwardUntil(chars,startOffset - 1,"\n\r") + 1;
  int spaceEnd=CharArrayUtil.shiftForward(chars,lineStart," \t");
  if (startOffset > spaceEnd) {
    line1++;
    if (line1 > line2)     return;
  }
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(document);
  CodeStyleManager codeStyleManager=CodeStyleManager.getInstance(project);
  try {
    for (int line=line1; line <= line2; line++) {
      lineStart=document.getLineStartOffset(line);
      if (codeStyleManager.isLineToBeIndented(file,lineStart)) {
        codeStyleManager.adjustLineIndent(file,lineStart);
      }
    }
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
}
