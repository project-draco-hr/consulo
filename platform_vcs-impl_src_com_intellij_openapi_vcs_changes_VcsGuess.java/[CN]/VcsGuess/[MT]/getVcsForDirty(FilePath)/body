{
  if (filePath.isNonLocal()) {
    return null;
  }
  final VirtualFile validParent=ApplicationManager.getApplication().runReadAction(new Computable<VirtualFile>(){
    public VirtualFile compute(){
      return ChangesUtil.findValidParent(filePath);
    }
  }
);
  if (validParent == null) {
    return null;
  }
  if (myExcludedFileIndex.isInContent(validParent) || isFileInBaseDir(filePath) || myVcsManager.hasExplicitMapping(validParent)|| isInDirectoryBasedRoot(validParent)) {
    if (myExcludedFileIndex.isExcludedFile(validParent)) {
      return null;
    }
    return myVcsManager.getVcsFor(validParent);
  }
  return null;
}
