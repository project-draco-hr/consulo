{
  SMRunnerUtil.addToInvokeLater(new Runnable(){
    public void run(){
      final String fullTestName=getFullTestName(testName);
      final SMTestProxy testProxy=getProxyByFullTestName(fullTestName);
      if (testProxy == null) {
        LOG.warn("Test wasn't started! TestFailure event: name = {" + testName + "}"+ ", message = {"+ localizedMessage+ "}"+ ", stackTrace = {"+ stackTrace+ "}. "+ cannotFindFullTestNameMsg(fullTestName));
        return;
      }
      if (myFailedTestsSet.contains(testProxy)) {
        LOG.warn("Duplicate failure for test [" + fullTestName + "]: msg = "+ localizedMessage+ ", stacktrace = "+ stackTrace);
        return;
      }
      testProxy.setTestFailed(localizedMessage,stackTrace,isTestError);
      myFailedTestsSet.add(testProxy);
      fireOnTestFailed(testProxy);
    }
  }
);
}
