{
  try {
    myProgressIndicator=ProgressManager.getInstance().getProgressIndicator();
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      public void run(){
        final PsiManager psiManager=PsiManager.getInstance(myProject);
        try {
          psiManager.startBatchFilesProcessingMode();
          ((RefManagerImpl)getRefManager()).inspectionReadActionStarted();
          EntryPointsManager.getInstance(getProject()).resolveEntryPoints(getRefManager());
          List<InspectionTool> needRepeatSearchRequest=new ArrayList<InspectionTool>();
          runTools(needRepeatSearchRequest,scope,runWithEditorSettings,manager);
          performPostRunFindUsages(needRepeatSearchRequest,manager);
        }
 catch (        ProcessCanceledException e) {
          cleanup();
          throw e;
        }
catch (        Exception e) {
          LOG.error(e);
        }
 finally {
          psiManager.finishBatchFilesProcessingMode();
        }
      }
    }
);
  }
  finally {
    if (myRefManager != null) {
      ((RefManagerImpl)getRefManager()).inspectionReadActionFinished();
    }
  }
}
