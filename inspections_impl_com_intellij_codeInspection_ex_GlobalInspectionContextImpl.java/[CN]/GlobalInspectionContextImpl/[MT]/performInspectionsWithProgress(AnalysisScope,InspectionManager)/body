{
  try {
    myProgressIndicator=ProgressManager.getInstance().getProgressIndicator();
    final PsiManager psiManager=PsiManager.getInstance(myProject);
    final Application application=ApplicationManager.getApplication();
    try {
      application.runReadAction(new Runnable(){
        public void run(){
          psiManager.startBatchFilesProcessingMode();
          ((RefManagerImpl)getRefManager()).inspectionReadActionStarted();
        }
      }
);
      try {
        getRefManager().getEntryPointsManager().resolveEntryPoints(getRefManager());
        BUILD_GRAPH.setTotalAmount(scope.getFileCount());
        LOCAL_ANALYSIS.setTotalAmount(scope.getFileCount());
        List<InspectionTool> needRepeatSearchRequest=new ArrayList<InspectionTool>();
        runTools(needRepeatSearchRequest,scope,manager);
      }
 catch (      ProcessCanceledException e) {
        cleanup((InspectionManagerEx)manager);
        throw e;
      }
catch (      Exception e) {
        LOG.error(e);
      }
    }
  finally {
      application.runReadAction(new Runnable(){
        public void run(){
          psiManager.finishBatchFilesProcessingMode();
        }
      }
);
    }
  }
  finally {
    if (myRefManager != null) {
      ((RefManagerImpl)getRefManager()).inspectionReadActionFinished();
    }
  }
}
