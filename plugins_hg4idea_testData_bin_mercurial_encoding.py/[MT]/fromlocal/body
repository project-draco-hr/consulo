def fromlocal(s):
    "\n    Convert a string from the local character encoding to UTF-8\n\n    We attempt to decode strings using the encoding mode set by\n    HGENCODINGMODE, which defaults to 'strict'. In this mode, unknown\n    characters will cause an error message. Other modes include\n    'replace', which replaces unknown characters with a special\n    Unicode character, and 'ignore', which drops the character.\n    "
    try:
        return s.decode(encoding, encodingmode).encode('utf-8')
    except UnicodeDecodeError as inst:
        sub = s[max(0, (inst.start - 10)):(inst.start + 10)]
        raise error.Abort(("decoding near '%s': %s!" % (sub, inst)))
    except LookupError as k:
        raise error.Abort(('%s, please check your locale settings' % k))
