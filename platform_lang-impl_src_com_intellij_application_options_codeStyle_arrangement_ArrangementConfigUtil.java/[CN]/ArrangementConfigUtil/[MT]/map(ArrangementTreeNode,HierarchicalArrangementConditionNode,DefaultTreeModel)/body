{
  ArrangementTreeNode uiNode=null;
  int rowsCreated=0;
  if (uiParentNode != null && uiParentNode.getChildCount() > 0) {
    ArrangementTreeNode child=uiParentNode.getChildAt(uiParentNode.getChildCount() - 1);
    if (conditionNode.getCurrent().equals(child.getBackingCondition())) {
      uiNode=child;
    }
  }
  if (uiNode == null) {
    uiNode=new ArrangementTreeNode(conditionNode.getCurrent());
    if (uiParentNode != null) {
      if (model == null) {
        uiParentNode.add(uiNode);
      }
 else {
        model.insertNodeInto(uiNode,uiParentNode,uiParentNode.getChildCount());
      }
    }
    rowsCreated++;
  }
  ArrangementTreeNode leaf=uiNode;
  HierarchicalArrangementConditionNode childConditionNode=conditionNode.getChild();
  if (childConditionNode != null) {
    Pair<ArrangementTreeNode,Integer> pair=map(uiNode,childConditionNode,model);
    leaf=pair.first;
    rowsCreated+=pair.second;
  }
  return Pair.create(leaf,rowsCreated);
}
