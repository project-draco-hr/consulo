{
  ArrangementTreeNode root=getRoot(node);
  int row=rootVisible ? 0 : -1;
  Stack<ArrangementTreeNode> nodes=new Stack<ArrangementTreeNode>();
  nodes.push(root);
  while (!nodes.isEmpty()) {
    ArrangementTreeNode n=nodes.pop();
    if (n == node) {
      return row;
    }
    row++;
    for (int i=n.getChildCount() - 1; i >= 0; i--) {
      nodes.push(n.getChildAt(i));
    }
  }
  StringBuilder buffer=new StringBuilder();
  String separator="->";
  for (TreeNode n=node; n != null; n=n.getParent()) {
    buffer.append(n).append(separator);
  }
  buffer.setLength(buffer.length() - separator.length());
  throw new RuntimeException("Invalid ArrangementTreeNode detected: " + buffer.toString());
}
