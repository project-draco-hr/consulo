{
  String contentType=request.getConnection().getContentType();
  if (!StringUtil.isEmptyOrSpaces(contentType)) {
    Matcher m=CHARSET_PATTERN.matcher(contentType);
    if (m.find()) {
      try {
        return Charset.forName(StringUtil.unquoteString(m.group(1)));
      }
 catch (      IllegalArgumentException e) {
        throw new IOException("unknown charset (" + contentType + ")",e);
      }
    }
  }
  return CharsetToolkit.UTF8_CHARSET;
}
