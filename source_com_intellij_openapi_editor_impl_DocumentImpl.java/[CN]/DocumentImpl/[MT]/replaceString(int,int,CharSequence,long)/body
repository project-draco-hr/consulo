{
  if (startOffset < 0 || startOffset > getTextLength()) {
    throw new IndexOutOfBoundsException("Wrong startOffset: " + startOffset);
  }
  if (endOffset < 0 || endOffset > getTextLength()) {
    throw new IndexOutOfBoundsException("Wrong endOffset: " + endOffset);
  }
  if (endOffset < startOffset) {
    throw new IllegalArgumentException("endOffset < startOffset: " + endOffset + " < "+ startOffset);
  }
  ApplicationManager.getApplication().assertWriteAccessAllowed();
  assertValidSeparators(s);
  if (!isWritable()) {
    throw new ReadOnlyModificationException(this);
  }
  final int newStringLength=s.length();
  final CharSequence chars=getCharsSequence();
  int newStartInString=0;
  int newEndInString=newStringLength;
  while (newStartInString < newStringLength && startOffset < endOffset && s.charAt(newStartInString) == chars.charAt(startOffset)) {
    startOffset++;
    newStartInString++;
  }
  while (endOffset > startOffset && newEndInString > newStartInString && s.charAt(newEndInString - 1) == chars.charAt(endOffset - 1)) {
    newEndInString--;
    endOffset--;
  }
  if (newEndInString - newStartInString == 0 && startOffset == endOffset) {
    setModificationStamp(newModificationStamp);
    return;
  }
  s=s.subSequence(newStartInString,newEndInString);
  CharSequence sToDelete=myText.substring(startOffset,endOffset);
  RangeMarker guard=getRangeGuard(startOffset,endOffset);
  if (guard != null) {
    throwGuardedFragment(guard,startOffset,sToDelete.toString(),s.toString());
  }
  myText.replace(startOffset,endOffset,sToDelete,s,newModificationStamp);
}
