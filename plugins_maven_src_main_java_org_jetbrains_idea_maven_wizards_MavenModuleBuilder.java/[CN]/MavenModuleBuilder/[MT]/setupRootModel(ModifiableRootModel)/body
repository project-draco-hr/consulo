{
  final VirtualFile root=createAndGetContentEntry();
  rootModel.addContentEntry(root);
  final VirtualFile pom;
  try {
    pom=root.createChildData(this,MavenConstants.POM_XML);
    VfsUtil.saveText(pom,MavenUtil.makeFileContent(myProjectId));
  }
 catch (  IOException e) {
    throw new ConfigurationException(e.getMessage());
  }
  final Project project=rootModel.getProject();
  if (myAggregatorProject != null) {
    new WriteCommandAction.Simple(project,"Create new Maven module",getPsiFile(project,myAggregatorProject.getFile())){
      protected void run() throws Throwable {
        MavenModel model=MavenUtil.getMavenModel(project,myAggregatorProject.getFile());
        Module module=model.getModules().addModule();
        module.setValue(getPsiFile(project,pom));
      }
    }
.execute();
  }
  updateProjectPom(project,pom);
  StartupManager.getInstance(project).runWhenProjectIsInitialized(new Runnable(){
    public void run(){
      MavenProjectsManager manager=MavenProjectsManager.getInstance(project);
      manager.addManagedFile(pom);
      if (myArchetypeId == null) {
        try {
          VfsUtil.createDirectories(root.getPath() + "/src/main/java");
          VfsUtil.createDirectories(root.getPath() + "/src/test/java");
        }
 catch (        IOException e) {
          MavenLog.LOG.info(e);
        }
      }
      reimportMavenProjects(project);
      EditorHelper.openInEditor(getPsiFile(project,pom));
      if (myArchetypeId != null)       generateFromArchetype(project,pom);
    }
  }
);
}
