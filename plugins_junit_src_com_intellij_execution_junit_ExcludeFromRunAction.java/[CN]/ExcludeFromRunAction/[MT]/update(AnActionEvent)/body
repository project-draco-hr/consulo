{
  final Presentation presentation=e.getPresentation();
  presentation.setVisible(false);
  final DataContext dataContext=e.getDataContext();
  final Project project=PlatformDataKeys.PROJECT.getData(dataContext);
  if (project != null) {
    final RunConfiguration configuration=RunConfiguration.DATA_KEY.getData(dataContext);
    if (configuration instanceof JUnitConfiguration) {
      final JUnitConfiguration.Data data=((JUnitConfiguration)configuration).getPersistentData();
      if (data.TEST_OBJECT == JUnitConfiguration.TEST_PATTERN) {
        final AbstractTestProxy testProxy=AbstractTestProxy.DATA_KEY.getData(dataContext);
        if (testProxy != null) {
          final Location location=testProxy.getLocation(project,((JUnitConfiguration)configuration).getConfigurationModule().getSearchScope());
          if (location != null) {
            final PsiElement psiElement=location.getPsiElement();
            if (psiElement instanceof PsiClass && data.getPatterns().contains(((PsiClass)psiElement).getQualifiedName())) {
              presentation.setVisible(true);
            }
          }
        }
      }
    }
  }
}
