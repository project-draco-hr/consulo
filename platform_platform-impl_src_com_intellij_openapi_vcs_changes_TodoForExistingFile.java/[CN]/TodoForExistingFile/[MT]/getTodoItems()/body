{
  return ApplicationManager.getApplication().runReadAction(new Computable<TodoItem[]>(){
    @Override public TodoItem[] compute(){
      final PsiTodoSearchHelper helper=PsiTodoSearchHelper.SERVICE.getInstance(myProject);
      PsiFile psiFile=myFile == null ? null : PsiManager.getInstance(myProject).findFile(myFile);
      if (psiFile != null) {
        return helper.findTodoItems(psiFile);
      }
      return getTodoForText(helper);
    }
  }
);
}
