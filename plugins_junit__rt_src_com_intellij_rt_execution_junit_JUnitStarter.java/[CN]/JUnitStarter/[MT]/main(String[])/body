{
  SegmentedOutputStream out=new SegmentedOutputStream(System.out);
  SegmentedOutputStream err=new SegmentedOutputStream(System.err);
  Vector argList=new Vector();
  for (int i=0; i < args.length; i++) {
    String arg=args[i];
    argList.addElement(arg);
  }
  final ArrayList listeners=new ArrayList();
  boolean isJUnit4=processParameters(argList,listeners);
  if (!canWorkWithJUnitVersion(err,isJUnit4)) {
    err.flush();
    System.exit(-3);
  }
  if (!checkVersion(args,err)) {
    err.flush();
    System.exit(-3);
  }
  String[] array=new String[argList.size()];
  argList.copyInto(array);
  int exitCode=prepareStreamsAndStart(array,isJUnit4,listeners,out,err);
  System.exit(exitCode);
}
