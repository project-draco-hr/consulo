{
  Editor editor=getConsoleEditor();
  if (editor.isDisposed()) {
    return;
  }
  Document document=editor.getDocument();
  boolean scroll=document.getTextLength() == editor.getCaretModel().getOffset() || !editor.getContentComponent().hasFocus();
  if (document.getTextLength() > 0) {
    append(document,"\n");
  }
  String lastDate=DateFormatUtil.formatDate(notification.getTimestamp());
  if (document.getTextLength() == 0 || !lastDate.equals(myLastDate)) {
    myLastDate=lastDate;
    append(document,lastDate + "\n");
  }
  int startDateOffset=document.getTextLength();
  String date=DateFormatUtil.formatTime(notification.getTimestamp()) + "\t";
  append(document,date);
  int tabs=calculateTabs(editor,startDateOffset);
  int titleStartOffset=document.getTextLength();
  int startLine=document.getLineCount() - 1;
  EventLog.LogEntry pair=EventLog.formatForLog(notification,StringUtil.repeatSymbol('\t',tabs));
  final NotificationType type=notification.getType();
  TextAttributesKey key=type == NotificationType.ERROR ? ConsoleViewContentType.LOG_ERROR_OUTPUT_KEY : type == NotificationType.INFORMATION ? ConsoleViewContentType.NORMAL_OUTPUT_KEY : ConsoleViewContentType.LOG_WARNING_OUTPUT_KEY;
  int msgStart=document.getTextLength();
  append(document,pair.message);
  TextAttributes attributes=EditorColorsManager.getInstance().getGlobalScheme().getAttributes(key);
  int layer=HighlighterLayer.CARET_ROW + 1;
  RangeHighlighter highlighter=editor.getMarkupModel().addRangeHighlighter(msgStart,document.getTextLength(),layer,attributes,HighlighterTargetArea.EXACT_RANGE);
  GROUP_ID.set(highlighter,notification.getGroupId());
  NOTIFICATION_ID.set(highlighter,notification.id);
  for (  Pair<TextRange,HyperlinkInfo> link : pair.links) {
    final RangeHighlighter rangeHighlighter=myHyperlinkSupport.getValue().createHyperlink(link.first.getStartOffset() + msgStart,link.first.getEndOffset() + msgStart,null,link.second);
    if (link.second instanceof EventLog.ShowBalloon) {
      ((EventLog.ShowBalloon)link.second).setRangeHighlighter(rangeHighlighter);
    }
  }
  append(document,"\n");
  if (scroll) {
    editor.getCaretModel().moveToOffset(document.getTextLength());
    editor.getScrollingModel().scrollToCaret(ScrollType.MAKE_VISIBLE);
  }
  if (notification.isImportant()) {
    highlightNotification(notification,pair.status,startLine,document.getLineCount() - 1,titleStartOffset,pair.titleLength);
  }
}
