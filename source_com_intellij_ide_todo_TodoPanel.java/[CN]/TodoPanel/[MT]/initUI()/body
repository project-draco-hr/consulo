{
  UIUtil.setLineStyleAngled(myTree);
  myTree.setShowsRootHandles(true);
  myTree.setRootVisible(false);
  myTree.setCellRenderer(new TodoCompositeRenderer());
  EditSourceOnDoubleClickHandler.install(myTree);
  new TreeSpeedSearch(myTree);
  DefaultActionGroup group=new DefaultActionGroup();
  group.add(ActionManager.getInstance().getAction(IdeActions.ACTION_EDIT_SOURCE));
  group.addSeparator();
  group.add(ActionManager.getInstance().getAction(IdeActions.GROUP_VERSION_CONTROLS));
  PopupHandler.installPopupHandler(myTree,group,ActionPlaces.TODO_VIEW_POPUP,ActionManager.getInstance());
  myTree.addKeyListener(new KeyAdapter(){
    public void keyPressed(    KeyEvent e){
      if (!e.isConsumed() && KeyEvent.VK_ENTER == e.getKeyCode()) {
        TreePath path=myTree.getSelectionPath();
        if (path == null) {
          return;
        }
        NodeDescriptor desciptor=(NodeDescriptor)((DefaultMutableTreeNode)path.getLastPathComponent()).getUserObject();
        if (!(desciptor instanceof TodoItemNode)) {
          return;
        }
        OpenSourceUtil.openSourcesFrom(TodoPanel.this,false);
      }
    }
  }
);
  add(new JScrollPane(myTree),BorderLayout.CENTER);
  JPanel toolBarPanel=new JPanel(new GridLayout());
  DefaultActionGroup leftGroup=new DefaultActionGroup();
  leftGroup.add(new PreviousOccurenceToolbarAction(myOccurenceNavigator));
  leftGroup.add(new NextOccurenceToolbarAction(myOccurenceNavigator));
  leftGroup.add(CommonActionsFactory.getCommonActionsFactory().createContextHelpAction("find.todoList"));
  toolBarPanel.add(ActionManager.getInstance().createActionToolbar(ActionPlaces.TODO_VIEW_TOOLBAR,leftGroup,false).getComponent());
  DefaultActionGroup rightGroup=new DefaultActionGroup();
  AnAction expandAllAction=CommonActionsManager.getInstance().createExpandAllAction(myTreeExpander,this);
  rightGroup.add(expandAllAction);
  AnAction collapseAllAction=CommonActionsManager.getInstance().createCollapseAllAction(myTreeExpander,this);
  rightGroup.add(collapseAllAction);
  if (!myCurrentFileMode) {
    MyShowModulesAction showModulesAction=new MyShowModulesAction();
    showModulesAction.registerCustomShortcutSet(new CustomShortcutSet(KeyStroke.getKeyStroke(KeyEvent.VK_M,SystemInfo.isMac ? InputEvent.META_MASK : InputEvent.CTRL_MASK)),myTree);
    rightGroup.add(showModulesAction);
    MyShowPackagesAction showPackagesAction=new MyShowPackagesAction();
    showPackagesAction.registerCustomShortcutSet(new CustomShortcutSet(KeyStroke.getKeyStroke(KeyEvent.VK_P,SystemInfo.isMac ? InputEvent.META_MASK : InputEvent.CTRL_MASK)),myTree);
    rightGroup.add(showPackagesAction);
    MyFlattenPackagesAction flattenPackagesAction=new MyFlattenPackagesAction();
    flattenPackagesAction.registerCustomShortcutSet(new CustomShortcutSet(KeyStroke.getKeyStroke(KeyEvent.VK_F,SystemInfo.isMac ? InputEvent.META_MASK : InputEvent.CTRL_MASK)),myTree);
    rightGroup.add(flattenPackagesAction);
  }
  MyAutoScrollToSourceHandler autoScrollToSourceHandler=new MyAutoScrollToSourceHandler();
  autoScrollToSourceHandler.install(myTree);
  rightGroup.add(autoScrollToSourceHandler.createToggleAction());
  MySetTodoFilterAction setTodoFilterAction=new MySetTodoFilterAction();
  rightGroup.add(setTodoFilterAction);
  toolBarPanel.add(ActionManager.getInstance().createActionToolbar(ActionPlaces.TODO_VIEW_TOOLBAR,rightGroup,false).getComponent());
  add(toolBarPanel,BorderLayout.WEST);
}
