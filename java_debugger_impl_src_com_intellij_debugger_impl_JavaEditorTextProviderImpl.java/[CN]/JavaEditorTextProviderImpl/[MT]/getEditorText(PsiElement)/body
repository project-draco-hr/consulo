{
  String result=null;
  PsiElement element=findExpression(elementAtCaret);
  if (element != null) {
    if (element instanceof PsiReferenceExpression) {
      final PsiReferenceExpression reference=(PsiReferenceExpression)element;
      if (reference.getQualifier() == null) {
        final PsiElement resolved=reference.resolve();
        if (resolved instanceof PsiEnumConstant) {
          final PsiEnumConstant enumConstant=(PsiEnumConstant)resolved;
          final PsiClass enumClass=enumConstant.getContainingClass();
          if (enumClass != null) {
            result=enumClass.getName() + "." + enumConstant.getName();
          }
        }
      }
    }
    if (result == null) {
      result=element.getText();
    }
  }
  return result != null ? new TextWithImportsImpl(CodeFragmentKind.EXPRESSION,result) : null;
}
