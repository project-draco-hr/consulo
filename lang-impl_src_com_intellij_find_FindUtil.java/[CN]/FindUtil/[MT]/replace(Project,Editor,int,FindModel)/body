{
  Document document=editor.getDocument();
  if (!document.isWritable()) {
    if (!FileDocumentManager.fileForDocumentCheckedOutSuccessfully(document,project)) {
      return false;
    }
  }
  document.startGuardedBlockChecking();
  boolean toPrompt=model.isPromptOnReplace();
  if (!toPrompt) {
    ((DocumentEx)document).setInBulkUpdate(true);
  }
  try {
    toPrompt=doReplace(project,editor,model,document,offset,toPrompt);
  }
 catch (  ReadOnlyFragmentModificationException e) {
    EditorActionManager.getInstance().getReadonlyFragmentModificationHandler().handle(e);
  }
 finally {
    if (!toPrompt) {
      ((DocumentEx)document).setInBulkUpdate(false);
    }
    document.stopGuardedBlockChecking();
  }
  return false;
}
