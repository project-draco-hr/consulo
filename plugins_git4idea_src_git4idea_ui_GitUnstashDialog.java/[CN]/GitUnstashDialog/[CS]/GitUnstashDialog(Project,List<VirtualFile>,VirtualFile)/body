{
  super(project,true);
  myProject=project;
  myVcs=GitVcs.getInstance(project);
  setTitle(GitBundle.getString("unstash.title"));
  setOKButtonText(GitBundle.getString("unstash.button.apply"));
  GitUIUtil.setupRootChooser(project,roots,defaultRoot,myGitRootComboBox,myCurrentBranch);
  myStashList.setModel(new DefaultListModel());
  refreshStashList();
  myGitRootComboBox.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      refreshStashList();
      updateDialogState();
    }
  }
);
  myStashList.addListSelectionListener(new ListSelectionListener(){
    public void valueChanged(    final ListSelectionEvent e){
      updateDialogState();
    }
  }
);
  myBranchTextField.getDocument().addDocumentListener(new DocumentAdapter(){
    protected void textChanged(    final DocumentEvent e){
      updateDialogState();
    }
  }
);
  myPopStashCheckBox.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      updateDialogState();
    }
  }
);
  myClearButton.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      if (Messages.YES == Messages.showYesNoDialog(GitUnstashDialog.this.getContentPane(),GitBundle.message("git.unstash.clear.confirmation.message"),GitBundle.message("git.unstash.clear.confirmation.title"),Messages.getWarningIcon())) {
        GitLineHandler h=new GitLineHandler(myProject,getGitRoot(),GitCommand.STASH);
        h.setNoSSH(true);
        h.addParameters("clear");
        GitHandlerUtil.doSynchronously(h,GitBundle.getString("unstash.clearing.stashes"),h.printableCommandLine());
        refreshStashList();
        updateDialogState();
      }
    }
  }
);
  myDropButton.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      final StashInfo stash=getSelectedStash();
      if (Messages.YES == Messages.showYesNoDialog(GitUnstashDialog.this.getContentPane(),GitBundle.message("git.unstash.drop.confirmation.message",stash.myStash,stash.myMessage),GitBundle.message("git.unstash.drop.confirmation.title",stash.myStash),Messages.getQuestionIcon())) {
        ProgressManager.getInstance().run(new Task.Modal(myProject,"Removing stash " + stash.myStash,false){
          @Override public void run(          @NotNull ProgressIndicator indicator){
            GitSimpleHandler h=dropHandler(stash.myStash);
            try {
              h.setSilent(true);
              h.run();
              h.unsilence();
            }
 catch (            VcsException ex) {
              try {
                if (ex.getMessage().startsWith("fatal: Needed a single revision")) {
                  h=dropHandler(translateStash(stash.myStash));
                  h.run();
                }
 else {
                  h.unsilence();
                  throw ex;
                }
              }
 catch (              VcsException ex2) {
                GitUIUtil.showOperationError(myProject,ex,h.printableCommandLine());
                return;
              }
            }
          }
        }
);
        refreshStashList();
        updateDialogState();
      }
    }
    private GitSimpleHandler dropHandler(    String stash){
      GitSimpleHandler h=new GitSimpleHandler(myProject,getGitRoot(),GitCommand.STASH);
      h.setNoSSH(true);
      h.addParameters("drop",stash);
      return h;
    }
  }
);
  myViewButton.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      final VirtualFile root=getGitRoot();
      String resolvedStash;
      String selectedStash=getSelectedStash().myStash;
      try {
        resolvedStash=GitRevisionNumber.resolve(myProject,root,selectedStash).asString();
      }
 catch (      VcsException ex) {
        try {
          if (ex.getMessage().startsWith("fatal: bad revision 'stash@")) {
            selectedStash=translateStash(selectedStash);
            resolvedStash=GitRevisionNumber.resolve(myProject,root,selectedStash).asString();
          }
 else {
            throw ex;
          }
        }
 catch (        VcsException ex2) {
          GitUIUtil.showOperationError(myProject,ex,"resolving revision");
          return;
        }
      }
      GitShowAllSubmittedFilesAction.showSubmittedFiles(myProject,resolvedStash,root);
    }
  }
);
  init();
  updateDialogState();
}
