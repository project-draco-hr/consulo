{
  super(project,true);
  myProject=project;
  setTitle(GitBundle.getString("unstash.title"));
  GitUIUtil.setupRootChooser(project,roots,defaultRoot,myGitRootComboBox,myCurrentBranch);
  myStashList.setModel(new DefaultListModel());
  refreshStashList();
  myGitRootComboBox.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      refreshStashList();
      updateDialogState();
    }
  }
);
  myStashList.addListSelectionListener(new ListSelectionListener(){
    public void valueChanged(    final ListSelectionEvent e){
      updateDialogState();
    }
  }
);
  myBranchTextField.getDocument().addDocumentListener(new DocumentAdapter(){
    protected void textChanged(    final DocumentEvent e){
      updateDialogState();
    }
  }
);
  myClearButton.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      GitLineHandler h=new GitLineHandler(myProject,getGitRoot(),GitHandler.STASH);
      h.setNoSSH(true);
      h.addParameters("clear");
      GitHandlerUtil.doSynchronously(h,GitBundle.getString("unstash.clearing.stashes"),h.printableCommandLine());
      refreshStashList();
      updateDialogState();
    }
  }
);
  myDropButton.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      GitLineHandler h=new GitLineHandler(myProject,getGitRoot(),GitHandler.STASH);
      h.setNoSSH(true);
      final String stash=getSelectedStash();
      h.addParameters("drop",stash);
      GitHandlerUtil.doSynchronously(h,GitBundle.message("unstash.dropping.stash",stash),h.printableCommandLine());
      refreshStashList();
      updateDialogState();
    }
  }
);
  myViewButton.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      final VirtualFile root=getGitRoot();
      String stash;
      try {
        stash=GitRevisionNumber.resolve(myProject,root,getSelectedStash()).asString();
      }
 catch (      VcsException ex) {
        GitUIUtil.showOperationError(myProject,ex,"resolving revision");
        return;
      }
      GitShowAllSubmittedFilesAction.showSubmittedFiles(myProject,stash,root);
    }
  }
);
  init();
  updateDialogState();
}
