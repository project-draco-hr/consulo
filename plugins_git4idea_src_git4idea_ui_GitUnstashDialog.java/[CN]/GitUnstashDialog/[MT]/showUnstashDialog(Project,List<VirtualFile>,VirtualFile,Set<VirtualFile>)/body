{
  GitUnstashDialog d=new GitUnstashDialog(project,gitRoots,defaultRoot);
  d.show();
  if (!d.isOK()) {
    return;
  }
  affectedRoots.add(d.getGitRoot());
  GitLineHandler h=d.handler();
  final AtomicBoolean conflict=new AtomicBoolean();
  h.addLineListener(new GitLineHandlerAdapter(){
    public void onLineAvailable(    String line,    Key outputType){
      if (line.contains("Merge conflict")) {
        conflict.set(true);
      }
    }
  }
);
  int rc=GitHandlerUtil.doSynchronously(h,GitBundle.getString("unstash.unstashing"),h.printableCommandLine(),false);
  if (conflict.get()) {
    VirtualFile root=d.getGitRoot();
    boolean conflictsResolved=new UnstashConflictResolver(project,root,d.getSelectedStash()).merge();
    if (conflictsResolved) {
      LOG.info("loadRoot " + root + " conflicts resolved, dropping stash");
      GitStashUtils.dropStash(project,root);
    }
  }
 else   if (rc != 0) {
    GitUIUtil.showOperationErrors(project,h.errors(),h.printableCommandLine());
  }
}
