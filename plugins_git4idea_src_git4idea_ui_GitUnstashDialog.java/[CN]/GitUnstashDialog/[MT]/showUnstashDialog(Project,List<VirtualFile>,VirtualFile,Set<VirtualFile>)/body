{
  GitUnstashDialog d=new GitUnstashDialog(project,gitRoots,defaultRoot);
  d.show();
  if (!d.isOK()) {
    return;
  }
  VirtualFile root=d.getGitRoot();
  affectedRoots.add(root);
  GitLineHandler h=d.handler();
  final AtomicBoolean conflict=new AtomicBoolean();
  h.addLineListener(new GitLineHandlerAdapter(){
    public void onLineAvailable(    String line,    Key outputType){
      if (line.contains("Merge conflict")) {
        conflict.set(true);
      }
    }
  }
);
  int rc=GitHandlerUtil.doSynchronously(h,GitBundle.getString("unstash.unstashing"),h.printableCommandLine(),false);
  root.refresh(true,true);
  if (conflict.get()) {
    boolean conflictsResolved=new UnstashConflictResolver(project,root,d.getSelectedStash()).merge();
    LOG.info("loadRoot " + root + ", conflictsResolved: "+ conflictsResolved);
  }
 else   if (rc != 0) {
    GitUIUtil.showOperationErrors(project,h.errors(),h.printableCommandLine());
  }
}
