{
  boolean formattedText=myForeground != null || myBackground != null || myFontFamily != null || myBold || myItalic;
  if (!formattedText) {
    escapeAndAdd(charSequence,startOffset,endOffset);
    return;
  }
  StringBuilder styleBuffer=StringBuilderSpinAllocator.alloc();
  StringBuilder closeTagBuffer=StringBuilderSpinAllocator.alloc();
  try {
    if (myForeground != null) {
      defineForeground(myForeground,styleBuffer,closeTagBuffer);
    }
    if (myBackground != null) {
      defineBackground(myBackground,styleBuffer,closeTagBuffer);
    }
    if (myBold) {
      defineBold(styleBuffer,closeTagBuffer);
    }
    if (myItalic) {
      defineItalic(styleBuffer,closeTagBuffer);
    }
    if (myFontFamily != null) {
      appendFontFamilyRule(styleBuffer,myFontFamily);
    }
    myBuilder.append("<span style=\"");
    myBuilder.append(styleBuffer);
    myBuilder.append("\">");
    escapeAndAdd(charSequence,startOffset,endOffset);
    myBuilder.append("</span>");
    myBuilder.append(closeTagBuffer);
  }
  finally {
    StringBuilderSpinAllocator.dispose(styleBuffer);
    StringBuilderSpinAllocator.dispose(closeTagBuffer);
  }
}
