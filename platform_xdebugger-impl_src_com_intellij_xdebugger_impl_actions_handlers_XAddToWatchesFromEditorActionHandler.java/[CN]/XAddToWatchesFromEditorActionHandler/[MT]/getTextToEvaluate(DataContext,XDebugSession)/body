{
  final Editor editor=PlatformDataKeys.EDITOR.getData(dataContext);
  if (editor == null) {
    return null;
  }
  String text=editor.getSelectionModel().getSelectedText();
  if (text == null && session.isSuspended()) {
    final XStackFrame stackFrame=session.getCurrentStackFrame();
    if (stackFrame != null) {
      final XDebuggerEvaluator evaluator=stackFrame.getEvaluator();
      if (evaluator != null) {
        final int offset=editor.getCaretModel().getOffset();
        final Document document=editor.getDocument();
        final TextRange textRange=evaluator.getExpressionRangeAtOffset(session.getProject(),document,offset);
        if (textRange != null) {
          text=textRange.substring(document.getText());
        }
      }
    }
  }
  return StringUtil.isEmptyOrSpaces(text) ? null : text;
}
