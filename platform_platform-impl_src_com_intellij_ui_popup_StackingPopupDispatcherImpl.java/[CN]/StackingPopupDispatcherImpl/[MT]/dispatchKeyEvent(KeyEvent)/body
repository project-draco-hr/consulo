{
  final boolean closeRequest=e.getID() == KeyEvent.KEY_PRESSED && e.getKeyCode() == KeyEvent.VK_ESCAPE && e.getModifiers() == 0;
  JBPopup popup;
  if (closeRequest) {
    popup=findPopup();
  }
 else {
    popup=getFocusedPopup();
  }
  return popup != null && popup.dispatchKeyEvent(e);
}
