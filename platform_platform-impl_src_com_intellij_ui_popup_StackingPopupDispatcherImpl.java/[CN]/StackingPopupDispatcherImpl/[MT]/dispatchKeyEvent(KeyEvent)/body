{
  final boolean closeRequest=e.getID() == KeyEvent.KEY_PRESSED && e.getKeyCode() == KeyEvent.VK_ESCAPE && e.getModifiers() == 0;
  JBPopup popup;
  if (closeRequest) {
    popup=findPopup();
  }
 else {
    popup=getFocusedPopup();
  }
  if (popup == null)   return false;
  if (closeRequest) {
    if (popup.isCancelKeyEnabled()) {
      popup.cancel();
      return true;
    }
  }
 else {
    return popup.dispatchKeyEvent(e);
  }
  return false;
}
