{
  if (event.getID() != MouseEvent.MOUSE_PRESSED) {
    return false;
  }
  if (myStack.isEmpty()) {
    return false;
  }
  AbstractPopup popup=(AbstractPopup)findPopup();
  final MouseEvent mouseEvent=((MouseEvent)event);
  Point point=(Point)mouseEvent.getPoint().clone();
  SwingUtilities.convertPointToScreen(point,mouseEvent.getComponent());
  while (true) {
    if (popup != null && !popup.isDisposed()) {
      final Component content=popup.getContent();
      if (!content.isShowing()) {
        popup.cancel();
        return false;
      }
      final Rectangle bounds=new Rectangle(content.getLocationOnScreen(),content.getSize());
      if (bounds.contains(point) || !popup.isCancelOnClickOutside()) {
        return false;
      }
      if (!popup.canClose()) {
        return false;
      }
      popup.cancel(mouseEvent);
    }
    if (myStack.isEmpty()) {
      return false;
    }
    popup=(AbstractPopup)myStack.peek();
    if (popup == null || popup.isDisposed()) {
      myStack.pop();
    }
  }
}
