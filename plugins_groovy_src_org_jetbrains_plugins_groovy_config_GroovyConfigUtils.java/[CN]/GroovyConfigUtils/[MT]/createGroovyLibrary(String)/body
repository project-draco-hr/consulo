{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      if (path.length() > 0) {
        String version=getGroovyVersion(path);
        String libName=generateNewGroovyLibName(version);
        Library groovyLibrary=createLibFirstTime(libName);
        Library.ModifiableModel model=groovyLibrary.getModifiableModel();
        removeOldRoots(model);
        File srcRoot=new File(path + "/src/main");
        if (srcRoot.exists()) {
          model.addRoot(VfsUtil.getUrlForLibraryRoot(srcRoot),OrderRootType.SOURCES);
        }
        File[] jars;
        File embeddableDir=new File(path + "/embeddable");
        if (embeddableDir.exists()) {
          jars=embeddableDir.listFiles();
        }
 else {
          jars=new File(path + "/lib").listFiles();
        }
        if (jars != null)         for (        File file : jars)         if (file.getName().endsWith(".jar"))         model.addRoot(VfsUtil.getUrlForLibraryRoot(file),OrderRootType.CLASSES);
        model.commit();
        saveGroovyVersion(version);
      }
    }
  }
);
}
