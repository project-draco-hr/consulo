{
  final PsiElement parent=getExpressionParent(expression);
  if (parent instanceof PsiReturnStatement || parent instanceof PsiResourceVariable) {
    return;
  }
  if (parent instanceof PsiExpressionList) {
    PsiElement grandParent=parent.getParent();
    if (grandParent instanceof PsiAnonymousClass) {
      grandParent=grandParent.getParent();
    }
    if (grandParent instanceof PsiNewExpression && isIOResource((PsiNewExpression)grandParent)) {
      return;
    }
  }
  final PsiVariable boundVariable=getVariable(parent);
  final PsiElement containingBlock=PsiTreeUtil.getParentOfType(expression,PsiCodeBlock.class);
  if (containingBlock == null) {
    return;
  }
  if (isArgumentOfResourceCreation(boundVariable,containingBlock)) {
    return;
  }
  if (isSafelyClosed(boundVariable,expression,insideTryAllowed)) {
    return;
  }
  if (isResourceEscapedFromMethod(boundVariable,expression)) {
    return;
  }
  registerError(expression,expression);
}
