{
  myUpdatePsiAlarm.cancelAllRequests();
  myUpdatePsiAlarm.addRequest(new Runnable(){
    public void run(){
      if (!isValid())       return;
      CommandProcessor.getInstance().runUndoTransparentAction(new Runnable(){
        public void run(){
          ApplicationManager.getApplication().runWriteAction(new Runnable(){
            public void run(){
              Project project=propertiesFile.getProject();
              PsiDocumentManager documentManager=PsiDocumentManager.getInstance(project);
              documentManager.commitDocument(document);
              Document propertiesFileDocument=documentManager.getDocument(propertiesFile);
              documentManager.commitDocument(propertiesFileDocument);
              if (!propertiesFile.isWritable() && !FileDocumentManager.fileForDocumentCheckedOutSuccessfully(propertiesFileDocument,project)) {
                uninstallDocumentListeners();
                try {
                  document.replaceString(0,document.getTextLength(),oldText);
                }
  finally {
                  installDocumentListeners();
                }
                return;
              }
              String propertyName=getSelectedPropertyName();
              if (propertyName == null)               return;
              updatePropertyValueFromDocument(propertyName,project,propertiesFile,text);
            }
          }
);
        }
      }
);
    }
  }
,300,ModalityState.stateForComponent(getComponent()));
}
