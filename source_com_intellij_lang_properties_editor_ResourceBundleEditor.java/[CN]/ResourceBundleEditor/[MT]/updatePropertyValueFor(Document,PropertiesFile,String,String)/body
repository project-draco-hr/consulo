{
  myAlarm.cancelAllRequests();
  myAlarm.addRequest(new Runnable(){
    public void run(){
      CommandProcessor.getInstance().runUndoTransparentAction(new Runnable(){
        public void run(){
          ApplicationManager.getApplication().runWriteAction(new Runnable(){
            public void run(){
              if (!CodeInsightUtil.prepareFileForWrite(propertiesFile)) {
                uninstallDocumentListeners();
                try {
                  document.replaceString(0,document.getTextLength(),oldText);
                }
  finally {
                  installDocumentListeners();
                }
                return;
              }
              String propertyName=getSelectedPropertyName();
              if (propertyName == null)               return;
              Property property=propertiesFile.findPropertyByKey(propertyName);
              Project project=propertiesFile.getProject();
              PsiDocumentManager documentManager=PsiDocumentManager.getInstance(project);
              documentManager.commitDocument(document);
              documentManager.commitDocument(documentManager.getDocument(propertiesFile));
              try {
                if (property == null) {
                  property=PropertiesElementFactory.createProperty(project,propertyName,text);
                  propertiesFile.add(property);
                }
 else {
                  property.setValue(text);
                }
              }
 catch (              IncorrectOperationException e) {
                LOG.error(e);
              }
            }
          }
);
        }
      }
);
    }
  }
,300);
}
