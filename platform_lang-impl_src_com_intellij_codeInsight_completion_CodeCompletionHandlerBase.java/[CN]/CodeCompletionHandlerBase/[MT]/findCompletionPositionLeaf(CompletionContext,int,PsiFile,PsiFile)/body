{
  final PsiElement insertedElement=newContext.file.findElementAt(offset);
  if (insertedElement == null) {
    LOG.error(LogMessageEx.createEvent("No element at insertion offset","offset=" + newContext.getStartOffset() + "\n"+ DebugUtil.currentStackTrace(),createFileTextAttachment(fileCopy,originalFile),createAstAttachment(fileCopy,originalFile)));
  }
  LOG.assertTrue(fileCopy.findElementAt(offset) == insertedElement,"wrong offset");
  final TextRange range=insertedElement.getTextRange();
  if (!range.substring(fileCopy.getText()).equals(insertedElement.getText())) {
    LOG.error(LogMessageEx.createEvent("Inconsistent completion tree","range=" + range + "\n"+ DebugUtil.currentStackTrace(),createFileTextAttachment(fileCopy,originalFile),createAstAttachment(fileCopy,originalFile),new Attachment("Element at caret",insertedElement.getText())));
  }
  return insertedElement;
}
