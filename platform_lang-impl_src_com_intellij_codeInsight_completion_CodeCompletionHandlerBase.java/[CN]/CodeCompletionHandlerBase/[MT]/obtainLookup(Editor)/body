{
  LookupImpl existing=(LookupImpl)LookupManager.getActiveLookup(editor);
  if (existing != null && existing.isCompletion()) {
    existing.markReused();
    if (!autopopup) {
      existing.setFocused(true);
      existing.setHintMode(false);
    }
    return existing;
  }
  LookupImpl lookup=(LookupImpl)LookupManager.getInstance(editor.getProject()).createLookup(editor,LookupElement.EMPTY_ARRAY,"",LookupArranger.DEFAULT);
  if (editor.isOneLineMode()) {
    lookup.setCancelOnClickOutside(true);
    lookup.setCancelOnOtherWindowOpen(true);
    lookup.setResizable(false);
    lookup.setForceLightweightPopup(false);
  }
  lookup.setFocused(!autopopup);
  return lookup;
}
