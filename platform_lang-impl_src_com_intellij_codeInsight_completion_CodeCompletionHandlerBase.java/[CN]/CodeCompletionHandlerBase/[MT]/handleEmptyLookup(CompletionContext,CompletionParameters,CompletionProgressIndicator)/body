{
  if (ApplicationManager.getApplication().isUnitTestMode())   return;
  Project project=context.project;
  Editor editor=context.editor;
  if (!ApplicationManager.getApplication().isUnitTestMode() && context.editor.getComponent().getRootPane() == null) {
    LOG.assertTrue(false,"null root pane");
  }
  for (  final CompletionContributor contributor : CompletionContributor.forParameters(parameters)) {
    final String text=contributor.handleEmptyLookup(parameters,editor);
    if (StringUtil.isNotEmpty(text)) {
      final EditorHintListener listener=new EditorHintListener(){
        public void hintShown(        final Project project,        final LightweightHint hint,        final int flags){
          indicator.liveAfterDeath(hint);
        }
      }
;
      final MessageBusConnection connection=context.project.getMessageBus().connect();
      connection.subscribe(EditorHintListener.TOPIC,listener);
      HintManager.getInstance().showErrorHint(editor,text);
      connection.disconnect();
      break;
    }
  }
  DaemonCodeAnalyzer codeAnalyzer=DaemonCodeAnalyzer.getInstance(project);
  if (codeAnalyzer != null) {
    codeAnalyzer.updateVisibleHighlighters(editor);
  }
}
