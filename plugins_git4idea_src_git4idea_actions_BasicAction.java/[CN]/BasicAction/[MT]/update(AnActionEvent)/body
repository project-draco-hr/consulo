{
  super.update(e);
  Presentation presentation=e.getPresentation();
  Project project=e.getData(CommonDataKeys.PROJECT);
  if (project == null) {
    presentation.setEnabled(false);
    presentation.setVisible(false);
    return;
  }
  VirtualFile[] vFiles=e.getData(PlatformDataKeys.VIRTUAL_FILE_ARRAY);
  if (vFiles == null || vFiles.length == 0) {
    presentation.setEnabled(false);
    presentation.setVisible(true);
    return;
  }
  GitVcs vcs=GitVcs.getInstance(project);
  boolean enabled=ProjectLevelVcsManager.getInstance(project).checkAllFilesAreUnder(vcs,vFiles) && isEnabled(project,vcs,vFiles);
  presentation.setEnabled(enabled);
  if (ActionPlaces.isPopupPlace(e.getPlace())) {
    presentation.setVisible(enabled);
  }
 else {
    presentation.setVisible(true);
  }
}
