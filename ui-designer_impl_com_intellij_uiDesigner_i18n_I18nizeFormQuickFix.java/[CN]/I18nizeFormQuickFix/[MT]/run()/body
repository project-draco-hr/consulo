{
  final StringDescriptor descriptor=getStringDescriptorValue();
  final Project project=myEditor.getProject();
  final I18nizeQuickFixDialog dialog=new I18nizeQuickFixDialog(project,null,descriptor.getValue(),false,false);
  dialog.show();
  if (!dialog.isOK()) {
    return;
  }
  if (!myEditor.ensureEditable()) {
    return;
  }
  final Collection<PropertiesFile> propertiesFiles=dialog.getAllPropertiesFiles(project);
  PropertiesFile aPropertiesFile=null;
  for (  PropertiesFile file : propertiesFiles) {
    if (!CodeInsightUtil.prepareFileForWrite(file))     return;
    if (aPropertiesFile == null) {
      aPropertiesFile=file;
    }
  }
  CommandProcessor.getInstance().executeCommand(project,new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          try {
            I18nizeQuickFix.createProperty(project,propertiesFiles,dialog.getKey(),dialog.getValue());
          }
 catch (          IncorrectOperationException e) {
            LOG.error(e);
          }
        }
      }
);
    }
  }
,CodeInsightBundle.message("quickfix.i18n.command.name"),project);
  if (aPropertiesFile != null) {
    final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
    String packageName=fileIndex.getPackageNameByDirectory(aPropertiesFile.getVirtualFile().getParent());
    if (packageName != null) {
      String bundleName=packageName + "." + aPropertiesFile.getResourceBundle().getBaseName();
      bundleName=bundleName.replace('.','/');
      try {
        setStringDescriptorValue(new StringDescriptor(bundleName,dialog.getKey()));
      }
 catch (      Exception e) {
        LOG.error(e);
      }
      myEditor.refreshAndSave(true);
    }
  }
}
