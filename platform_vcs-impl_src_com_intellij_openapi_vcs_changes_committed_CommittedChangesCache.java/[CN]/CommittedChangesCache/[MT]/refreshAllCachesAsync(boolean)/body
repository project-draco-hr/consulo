{
  final Runnable task=new Runnable(){
    public void run(){
      final List<ChangesCacheFile> files=myCachesHolder.getAllCaches();
      final RefreshResultConsumer notifyConsumer=new RefreshResultConsumer(){
        private VcsException myError=null;
        private int myCount=0;
        public void receivedChanges(        List<CommittedChangeList> changes){
          if (changes.size() > 0) {
            notifyReloadIncomingChanges();
          }
 else {
            myProject.getMessageBus().syncPublisher(CommittedChangesTreeBrowser.ITEMS_RELOADED).emptyRefresh();
          }
          checkDone();
        }
        public void receivedError(        VcsException ex){
          myError=ex;
          checkDone();
        }
        private void checkDone(){
          myCount++;
          if (myCount == files.size()) {
            notifyRefreshError(myError);
          }
        }
      }
;
      for (      ChangesCacheFile file : files) {
        refreshCacheAsync(file,initIfEmpty,notifyConsumer,false);
      }
    }
  }
;
  myTaskQueue.run(task);
}
