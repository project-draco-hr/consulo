{
  LOG.assertTrue(addedElement.getTreeParent() == parent,"addedElement must be added to parent");
  final PsiElement psiElement=parent.getPsi();
  final PsiFile containingFile=psiElement.getContainingFile();
  final FormattingModelBuilder builder=LanguageFormatting.INSTANCE.forContext(containingFile);
  if (builder != null) {
    final FormattingModel model=builder.createModel(containingFile,getSettings());
    FormatterEx.getInstanceEx().formatAroundRange(model,getSettings(),addedElement.getTextRange(),containingFile.getFileType());
  }
  adjustLineIndent(containingFile,addedElement.getTextRange());
}
