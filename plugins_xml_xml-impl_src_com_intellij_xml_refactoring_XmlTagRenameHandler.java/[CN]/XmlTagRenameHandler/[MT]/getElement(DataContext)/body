{
  if (context != null) {
    final Editor editor=getEditor(context);
    if (editor != null) {
      final int offset=editor.getCaretModel().getOffset();
      final PsiFile file=LangDataKeys.PSI_FILE.getData(context);
      if (file instanceof XmlFile) {
        return file.getViewProvider().findElementAt(offset);
      }
      if (file != null) {
        final Language language=PsiUtilBase.getLanguageAtOffset(file,offset);
        if (language != file.getLanguage()) {
          final PsiFile psiAtOffset=file.getViewProvider().getPsi(language);
          if (psiAtOffset instanceof XmlFile) {
            return psiAtOffset.findElementAt(offset);
          }
        }
      }
    }
  }
  return null;
}
