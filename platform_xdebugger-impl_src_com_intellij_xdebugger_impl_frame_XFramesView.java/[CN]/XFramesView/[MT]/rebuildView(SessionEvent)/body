{
  if (event == SessionEvent.BEFORE_RESUME)   return;
  if (event == SessionEvent.FRAME_CHANGED) {
    XStackFrame currentStackFrame=mySession.getCurrentStackFrame();
    if (currentStackFrame != null) {
      myFramesList.setSelectedValue(currentStackFrame,true);
    }
    return;
  }
  myListenersEnabled=false;
  for (  StackFramesListBuilder builder : myBuilders.values()) {
    builder.dispose();
  }
  myBuilders.clear();
  mySelectedStack=null;
  XSuspendContext suspendContext=mySession.getSuspendContext();
  if (suspendContext == null) {
    myThreadComboBox.removeAllItems();
    myFramesList.clear();
    myExecutionStacks.clear();
    return;
  }
  XExecutionStack[] executionStacks=suspendContext.getExecutionStacks();
  for (  XExecutionStack executionStack : executionStacks) {
    if (!myExecutionStacks.contains(executionStack)) {
      myThreadComboBox.addItem(executionStack);
      myExecutionStacks.add(executionStack);
    }
  }
  XExecutionStack activeExecutionStack=suspendContext.getActiveExecutionStack();
  myThreadComboBox.setSelectedItem(activeExecutionStack);
  myThreadsPanel.removeAll();
  myThreadsPanel.add(myToolbar.getComponent(),BorderLayout.EAST);
  final boolean invisible=executionStacks.length == 1 && StringUtil.isEmpty(executionStacks[0].getDisplayName());
  if (!invisible) {
    myThreadsPanel.add(myThreadComboBox,BorderLayout.CENTER);
  }
  myToolbar.setAddSeparatorFirst(!invisible);
  updateFrames(activeExecutionStack);
  myListenersEnabled=true;
}
