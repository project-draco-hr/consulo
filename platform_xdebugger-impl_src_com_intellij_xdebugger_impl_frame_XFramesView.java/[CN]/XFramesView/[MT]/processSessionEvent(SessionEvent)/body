{
  myRefresh=event == SessionEvent.SETTINGS_CHANGED;
  if (event == SessionEvent.BEFORE_RESUME) {
    return;
  }
  XDebugSession session=getSession(getMainPanel());
  if (event == SessionEvent.FRAME_CHANGED) {
    XStackFrame currentStackFrame=session == null ? null : session.getCurrentStackFrame();
    if (currentStackFrame != null) {
      myFramesList.setSelectedValue(currentStackFrame,true);
      mySelectedFrameIndex=myFramesList.getSelectedIndex();
    }
    return;
  }
  if (event != SessionEvent.SETTINGS_CHANGED) {
    mySelectedFrameIndex=0;
    mySelectedStack=null;
  }
  myListenersEnabled=false;
  for (  StackFramesListBuilder builder : myBuilders.values()) {
    builder.dispose();
  }
  myBuilders.clear();
  XSuspendContext suspendContext=session == null ? null : session.getSuspendContext();
  if (suspendContext == null) {
    requestClear();
    return;
  }
  if (event == SessionEvent.PAUSED) {
    cancelClear();
    clear();
  }
  XExecutionStack[] executionStacks=suspendContext.getExecutionStacks();
  addExecutionStacks(Arrays.asList(executionStacks));
  XExecutionStack activeExecutionStack=mySelectedStack != null ? mySelectedStack : suspendContext.getActiveExecutionStack();
  myThreadComboBox.setSelectedItem(activeExecutionStack);
  myThreadsPanel.removeAll();
  myThreadsPanel.add(myToolbar.getComponent(),BorderLayout.EAST);
  final boolean invisible=executionStacks.length == 1 && StringUtil.isEmpty(executionStacks[0].getDisplayName());
  if (!invisible) {
    myThreadsPanel.add(myThreadComboBox,BorderLayout.CENTER);
  }
  myToolbar.setAddSeparatorFirst(!invisible);
  updateFrames(activeExecutionStack,session);
}
