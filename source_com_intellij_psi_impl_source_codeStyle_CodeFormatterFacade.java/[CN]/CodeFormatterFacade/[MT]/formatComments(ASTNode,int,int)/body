{
  TextRange range=element.getTextRange();
  TextRange result=new TextRange(startOffset,endOffset);
  if (range.getStartOffset() >= startOffset && range.getEndOffset() <= endOffset) {
    myCommentFormatter.process(element);
    final TextRange newRange=element.getTextRange();
    result=new TextRange(startOffset,endOffset + newRange.getLength() - range.getLength());
  }
  if (element instanceof CompositeElement) {
    ChameleonTransforming.transformChildren(element);
    for (ASTNode elem=element.getFirstChildNode(); elem != null; elem=elem.getTreeNext()) {
      result=formatComments(elem,result.getStartOffset(),result.getEndOffset());
    }
  }
  return result;
}
