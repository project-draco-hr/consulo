{
  TextRange result=range;
  final PsiElement psi=element.getPsi();
  if (psi instanceof PsiDocCommentOwner) {
    final TextRange elementRange=element.getTextRange();
    if (range.contains(elementRange)) {
      myCommentFormatter.process(element);
      final TextRange newRange=element.getTextRange();
      result=new TextRange(range.getStartOffset(),range.getEndOffset() + newRange.getLength() - elementRange.getLength());
    }
  }
  if (element instanceof CompositeElement) {
    ChameleonTransforming.transformChildren(element);
    for (ASTNode elem=element.getFirstChildNode(); elem != null; elem=elem.getTreeNext()) {
      result=formatCommentsInner(elem,result);
    }
  }
  return result;
}
