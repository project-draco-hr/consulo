{
  TextRange fileRange=containingFile.getTextRange();
  if (element.getTextRange().equals(fileRange)) {
    if (startOffset == 0 && endOffset == fileRange.getEndOffset()) {
      return element;
    }
    PsiElement psi=element.getPsi();
    PsiElement elem=psi.findElementAt(startOffset);
    if (elem != null) {
      return TreeUtil.getFileElement((TreeElement)elem.getNode());
    }
    elem=psi.findElementAt(endOffset);
    if (elem != null) {
      return TreeUtil.getFileElement((TreeElement)elem.getNode());
    }
  }
  return TreeUtil.getFileElement((TreeElement)element);
}
