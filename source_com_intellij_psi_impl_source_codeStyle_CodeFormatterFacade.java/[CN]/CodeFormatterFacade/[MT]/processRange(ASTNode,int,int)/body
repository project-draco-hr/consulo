{
  FileType fileType=myHelper.getFileType();
  if (useNewFormatter(fileType)) {
    PseudoTextBuilder pseudoTextBuilder=((LanguageFileType)fileType).getLanguage().getFormatter();
    if (pseudoTextBuilder == null) {
      return element;
    }
 else {
      final long start=System.currentTimeMillis();
      try {
        PseudoText pseudoText=pseudoTextBuilder.build(myHelper.getProject(),mySettings,SourceTreeToPsiMap.treeElementToPsi(element));
        GeneralCodeFormatter.createSimpleInstance(pseudoText,mySettings,fileType,startOffset,endOffset).format();
      }
 catch (      Exception e) {
        LOG.error(e);
      }
      formatComments(element,startOffset,endOffset);
      return element;
    }
  }
  final TextRange range=element.getTextRange();
  final int elementStartOffset=range.getStartOffset();
  return processRange(element,new int[]{startOffset - elementStartOffset,endOffset - elementStartOffset});
}
