{
  return new Runnable(){
    public void run(){
      if (myDisposed || !myProject.isInitialized())       return;
      if (PowerSaveMode.isEnabled())       return;
      Editor activeEditor=FileEditorManager.getInstance(myProject).getSelectedTextEditor();
      Runnable runnable=new Runnable(){
        public void run(){
          PassExecutorService.log(myUpdateProgress,null,"Update Runnable. myUpdateByTimerEnabled:",myUpdateByTimerEnabled," something disposed:",PowerSaveMode.isEnabled() || myDisposed || !myProject.isInitialized()," activeEditors:",myProject.isDisposed() ? null : myDaemonListeners.getSelectedEditors());
          if (!myUpdateByTimerEnabled)           return;
          if (myDisposed)           return;
          ApplicationManager.getApplication().assertIsDispatchThread();
          final Collection<FileEditor> activeEditors=myDaemonListeners.getSelectedEditors();
          if (activeEditors.isEmpty())           return;
          ApplicationManager.getApplication().assertIsDispatchThread();
          if (ApplicationManager.getApplication().isWriteAccessAllowed()) {
            return;
          }
          PsiDocumentManager documentManager=PsiDocumentManager.getInstance(myProject);
          if (documentManager.hasUncommitedDocuments()) {
            if (ModalityState.current() == ModalityState.NON_MODAL) {
              ((PsiDocumentManagerImpl)documentManager).cancelAndRunWhenAllCommitted("restart daemon when all committed",this);
              return;
            }
 else {
              documentManager.commitAllDocuments();
            }
          }
          Map<FileEditor,HighlightingPass[]> passes=new THashMap<FileEditor,HighlightingPass[]>(activeEditors.size());
          for (          FileEditor fileEditor : activeEditors) {
            BackgroundEditorHighlighter highlighter=fileEditor.getBackgroundHighlighter();
            if (highlighter != null) {
              HighlightingPass[] highlightingPasses=highlighter.createPassesForEditor();
              passes.put(fileEditor,highlightingPasses);
            }
          }
          cancelUpdateProgress(true,"Cancel by alarm");
          myAlarm.cancelAllRequests();
          DaemonProgressIndicator progress=createUpdateProgress();
          myPassExecutorService.submitPasses(passes,progress,Job.DEFAULT_PRIORITY);
        }
      }
;
      if (activeEditor == null) {
        runnable.run();
      }
 else {
        ((PsiDocumentManagerImpl)PsiDocumentManager.getInstance(myProject)).cancelAndRunWhenAllCommitted("start daemon when all committed",runnable);
      }
    }
  }
;
}
