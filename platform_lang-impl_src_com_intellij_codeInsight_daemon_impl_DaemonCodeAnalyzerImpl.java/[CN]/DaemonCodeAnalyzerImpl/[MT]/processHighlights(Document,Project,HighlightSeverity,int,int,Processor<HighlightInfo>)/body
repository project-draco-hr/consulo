{
  LOG.assertTrue(ApplicationManager.getApplication().isReadAccessAllowed());
  final SeverityRegistrar severityRegistrar=SeverityRegistrar.getInstance(project);
  MarkupModelEx model=(MarkupModelEx)document.getMarkupModel(project);
  return model.processRangeHighlightersOverlappingWith(startOffset,endOffset,new Processor<RangeHighlighterEx>(){
    public boolean process(    RangeHighlighterEx marker){
      Object tt=marker.getErrorStripeTooltip();
      if (!(tt instanceof HighlightInfo))       return true;
      HighlightInfo info=(HighlightInfo)tt;
      return minSeverity != null && severityRegistrar.compare(info.getSeverity(),minSeverity) < 0 || info.highlighter == null || processor.process(info);
    }
  }
);
}
