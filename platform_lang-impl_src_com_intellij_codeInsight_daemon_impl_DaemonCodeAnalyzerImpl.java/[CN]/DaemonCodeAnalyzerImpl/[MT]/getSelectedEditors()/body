{
  List<Editor> editors=getActiveEditors();
  Collection<FileEditor> activeFileEditors=new THashSet<FileEditor>(editors.size());
  for (  Editor editor : editors) {
    TextEditor textEditor=TextEditorProvider.getInstance().getTextEditor(editor);
    activeFileEditors.add(textEditor);
  }
  if (ApplicationManager.getApplication().getCurrentModalityState() != ModalityState.NON_MODAL) {
    return activeFileEditors;
  }
  Collection<FileEditor> result=new THashSet<FileEditor>();
  Collection<Document> documents=new THashSet<Document>(activeFileEditors.size());
  final FileEditor[] tabEditors=FileEditorManager.getInstance(myProject).getSelectedEditors();
  for (  FileEditor tabEditor : tabEditors) {
    if (tabEditor instanceof TextEditor) {
      documents.add(((TextEditor)tabEditor).getEditor().getDocument());
    }
    result.add(tabEditor);
  }
  for (  FileEditor fileEditor : activeFileEditors) {
    if (fileEditor instanceof TextEditor && documents.contains(((TextEditor)fileEditor).getEditor().getDocument()))     continue;
    result.add(fileEditor);
  }
  return result;
}
