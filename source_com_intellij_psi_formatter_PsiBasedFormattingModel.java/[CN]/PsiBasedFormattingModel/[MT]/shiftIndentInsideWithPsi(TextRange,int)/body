{
  final int offset=textRange.getStartOffset();
  ASTNode leafElement=myTreeRoot.findLeafElementAt(offset);
  while (!leafElement.getTextRange().equals(textRange)) {
    leafElement=leafElement.getTreeParent();
    if (leafElement == null)     return textRange;
  }
  if (leafElement.getTextRange().equals(textRange) && Helper.mayShiftIndentInside(leafElement)) {
    return new Helper(StdFileTypes.JAVA,myProject).shiftIndentInside(leafElement,shift).getTextRange();
  }
 else {
    return textRange;
  }
}
