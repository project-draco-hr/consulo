{
  ASTNode elementContainingRangeStart=findElementContainingRangeStart(textRange);
  if (canReplaceWhiteSpaceInsideLeaf(elementContainingRangeStart,textRange)) {
    FormatterUtil.replaceTokenText(elementContainingRangeStart,whiteSpace,textRange);
  }
 else {
    ASTNode elementContainingRangeEnd=myTreeRoot.findLeafElementAt(textRange.getEndOffset());
    if (elementContainingRangeEnd == null) {
      changeLastWhiteSpace(whiteSpace);
    }
 else     if (canReplaceWhiteSpaceInsideLeaf(elementContainingRangeEnd,textRange)) {
      FormatterUtil.replaceTokenText(elementContainingRangeEnd,whiteSpace,textRange);
    }
 else     if (elementContainingRangeEnd.getTextRange().getStartOffset() == textRange.getEndOffset()) {
      LOG.assertTrue(elementContainingRangeEnd.getPsi().isValid());
      changeWhiteSpaceBeforeLeaf(whiteSpace,elementContainingRangeEnd,textRange);
    }
 else {
      LOG.assertTrue(false,myTreeRoot.getText());
    }
  }
}
