{
  if (myUseAllTrees) {
    final PsiElement psiElement=myASTNode.getPsi().findElementAt(offset);
    if (psiElement == null)     return null;
    if (psiElement.getTextRange().getStartOffset() != offset) {
      LOG.assertTrue(false);
    }
    return psiElement.getNode();
  }
 else {
    final ASTNode result=myASTNode.findLeafElementAt(offset);
    if (result == null)     return null;
    if (result.getTextRange().getStartOffset() != offset) {
      LOG.assertTrue(false);
    }
    return result;
  }
}
