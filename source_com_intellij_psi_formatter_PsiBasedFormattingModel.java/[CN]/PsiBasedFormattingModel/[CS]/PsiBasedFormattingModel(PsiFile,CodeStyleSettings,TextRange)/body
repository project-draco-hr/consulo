{
  mySettings=settings;
  myASTNode=SourceTreeToPsiMap.psiElementToTree(file);
  myProject=file.getProject();
  myElementToReformat=findElementToReformat(file,rangeToReformat);
  myPseudoPhysicalCopy=file.createPseudoPhysicalCopy();
  myDocument=PsiDocumentManager.getInstance(myProject).getDocument(myPseudoPhysicalCopy);
  if (myElementToReformat != null) {
    myWhiteSpaceToReformat=findWhiteSpaceBeforeRange(file,rangeToReformat);
    myRangeMarker=myDocument.createRangeMarker(rangeToReformat.getStartOffset(),rangeToReformat.getEndOffset());
    myRangeMarker.setGreedyToLeft(true);
    myRangeMarker.setGreedyToRight(true);
  }
 else {
    myWhiteSpaceToReformat=findWhiteSpaceBeforeRange(file,rangeToReformat);
    myRangeMarker=null;
  }
}
