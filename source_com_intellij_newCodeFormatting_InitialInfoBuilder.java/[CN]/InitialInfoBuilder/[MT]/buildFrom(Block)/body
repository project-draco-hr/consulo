{
  final TextRange textRange=rootBlock.getTextRange();
  final int blockStartOffset=textRange.getStartOffset();
  myCurrentWhiteSpace.append(blockStartOffset,myModel);
  final BlockWrapper info=new BlockWrapper(rootBlock,myCurrentWhiteSpace,myModel,myPreviousBlock);
  myResult.put(rootBlock,info);
  final List<Block> subBlocks=rootBlock.getSubBlocks();
  if (subBlocks.isEmpty()) {
    LOG.assertTrue(rootBlock.getTextRange().getLength() > 0);
    if (myPreviousBlock != null) {
      myPreviousBlock.setNextBlock(info);
    }
    if (myFirstTokenBlock == null) {
      myFirstTokenBlock=info;
    }
    myCurrentWhiteSpace=new WhiteSpace(textRange.getEndOffset(),textRange.getEndOffset(),0,0,false);
    myPreviousBlock=info;
  }
 else {
    for (Iterator<Block> iterator=subBlocks.iterator(); iterator.hasNext(); ) {
      buildFrom(iterator.next());
    }
  }
}
