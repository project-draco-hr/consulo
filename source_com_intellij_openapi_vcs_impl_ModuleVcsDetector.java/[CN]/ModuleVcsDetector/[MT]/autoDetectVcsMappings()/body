{
  Set<AbstractVcs> usedVcses=new HashSet<AbstractVcs>();
  Map<VirtualFile,AbstractVcs> vcsMap=new HashMap<VirtualFile,AbstractVcs>();
  for (  Module module : ModuleManager.getInstance(myProject).getModules()) {
    final VirtualFile[] files=ModuleRootManager.getInstance(module).getContentRoots();
    for (    VirtualFile file : files) {
      AbstractVcs contentRootVcs=myVcsManager.findVersioningVcs(file);
      if (contentRootVcs != null) {
        vcsMap.put(file,contentRootVcs);
      }
      usedVcses.add(contentRootVcs);
    }
  }
  if (usedVcses.size() == 1) {
    final AbstractVcs[] abstractVcses=usedVcses.toArray(new AbstractVcs[1]);
    if (abstractVcses[0] != null) {
      myVcsManager.setAutoDirectoryMapping("",abstractVcses[0].getName());
    }
  }
 else {
    for (    Map.Entry<VirtualFile,AbstractVcs> entry : vcsMap.entrySet()) {
      myVcsManager.setAutoDirectoryMapping(entry.getKey().getPath(),entry.getValue() == null ? "" : entry.getValue().getName());
    }
    myVcsManager.cleanupMappings();
  }
}
