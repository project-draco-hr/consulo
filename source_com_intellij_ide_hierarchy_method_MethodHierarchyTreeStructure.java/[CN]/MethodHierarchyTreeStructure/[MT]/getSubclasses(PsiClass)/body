{
  if (psiClass instanceof PsiAnonymousClass) {
    return PsiClass.EMPTY_ARRAY;
  }
  if (psiClass.hasModifierProperty(PsiModifier.FINAL)) {
    return PsiClass.EMPTY_ARRAY;
  }
  final PsiSearchHelper helper=PsiManager.getInstance(myProject).getSearchHelper();
  final ArrayList classes=new ArrayList(Arrays.asList(helper.findInheritors(psiClass,GlobalSearchScope.allScope(myProject),false)));
  final EjbClassRole role=J2EERolesUtil.getEjbRole(psiClass);
  if (role != null && role.isDeclarationRole()) {
    final PsiClass[] implementations=role.findImplementations();
    classes.addAll(Arrays.asList(implementations));
  }
  return (PsiClass[])classes.toArray(new PsiClass[classes.size()]);
}
