{
  if (!file.isWritable()) {
    Document document=PsiDocumentManager.getInstance(myProject).getDocument(file);
    if (!FileDocumentManager.fileForDocumentCheckedOutSuccessfully(document,myProject)) {
      Messages.showMessageDialog(myProject,CodeInsightBundle.message("error.dialog.readonly.file.message"),CodeInsightBundle.message("error.dialog.readonly.file.title"),Messages.getErrorIcon());
      return;
    }
  }
  final Runnable[] resultRunnable=new Runnable[1];
  Runnable readAction=new Runnable(){
    public void run(){
      if (!checkFileWritable(file))       return;
      try {
        resultRunnable[0]=preprocessFile(file);
      }
 catch (      IncorrectOperationException e) {
        LOG.error(e);
      }
    }
  }
;
  Runnable writeAction=new Runnable(){
    public void run(){
      if (resultRunnable[0] != null) {
        resultRunnable[0].run();
      }
    }
  }
;
  runLayoutCodeProcess(readAction,writeAction);
}
