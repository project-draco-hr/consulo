{
  final LookupElement delegate=getDelegate();
  final TailType tailType=computeTailType(context);
  if (delegate instanceof LookupItem && tailType != null) {
    final LookupItem lookupItem=(LookupItem)delegate;
    lookupItem.setTailType(TailType.NONE);
  }
  delegate.handleInsert(context);
  if (tailType != null) {
    PostprocessReformattingAspect.getInstance(context.getProject()).doPostponedFormatting();
    tailType.processTail(context.getEditor(),context.getTailOffset());
  }
}
