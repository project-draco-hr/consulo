{
  final List<VirtualFile> files=(List<VirtualFile>)e.getDataContext().getData(ChangesListView.UNVERSIONED_FILES_KEY);
  if (files == null)   return;
  ProgressManager.getInstance().runProcessWithProgressSynchronously(new Runnable(){
    public void run(){
      ChangesUtil.processVirtualFilesByVcs(myProject,files,new ChangesUtil.PerVcsProcessor<VirtualFile>(){
        public void process(        final AbstractVcs vcs,        final List<VirtualFile> items){
          final ChangeProvider provider=vcs.getChangeProvider();
          if (provider != null) {
            provider.scheduleUnversionedFilesForAddition(files);
          }
        }
      }
);
    }
  }
,"Adding files to VCS",true,myProject);
  for (  VirtualFile file : files) {
    VcsDirtyScopeManager.getInstance(myProject).fileDirty(file);
    FileStatusManager.getInstance(myProject).fileStatusChanged(file);
  }
  scheduleRefresh();
}
