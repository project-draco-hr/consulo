{
  ChangesUtil.processVirtualFilesByVcs(myProject,files,new ChangesUtil.PerVcsProcessor<VirtualFile>(){
    public void process(    final AbstractVcs vcs,    final List<VirtualFile> items){
      final ChangeProvider provider=vcs.getChangeProvider();
      if (provider != null) {
        provider.scheduleUnversionedFilesForAddition(files);
      }
    }
  }
);
  for (  VirtualFile file : files) {
    VcsDirtyScopeManager.getInstance(myProject).fileDirty(file);
    FileStatusManager.getInstance(myProject).fileStatusChanged(file);
  }
  if (!list.isDefault()) {
    ensureUpToDate(false);
    List<Change> changesToMove=new ArrayList<Change>();
    for (    Change change : getDefaultChangeList().getChanges()) {
      final ContentRevision afterRevision=change.getAfterRevision();
      if (afterRevision != null) {
        VirtualFile vFile=afterRevision.getFile().getVirtualFile();
        if (files.contains(vFile)) {
          changesToMove.add(change);
        }
      }
    }
    if (changesToMove.size() > 0) {
      moveChangesTo(list,changesToMove.toArray(new Change[changesToMove.size()]));
    }
  }
  ChangesViewManager.getInstance(myProject).scheduleRefresh();
}
