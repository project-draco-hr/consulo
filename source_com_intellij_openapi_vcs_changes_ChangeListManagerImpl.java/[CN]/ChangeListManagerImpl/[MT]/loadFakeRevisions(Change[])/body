{
  for (  Change change : changes) {
    final ContentRevision beforeRevision=change.getBeforeRevision();
    final ContentRevision afterRevision=change.getAfterRevision();
    if (beforeRevision instanceof FakeRevision) {
      VcsDirtyScopeManager.getInstance(myProject).fileDirty(beforeRevision.getFile());
    }
    if (afterRevision instanceof FakeRevision) {
      VcsDirtyScopeManager.getInstance(myProject).fileDirty(afterRevision.getFile());
    }
  }
  if (!ensureUpToDate(true)) {
    return null;
  }
  List<Change> matchingChanges=new ArrayList<Change>();
  for (  Change change : changes) {
    matchingChanges.addAll(getChangesIn(ChangesUtil.getFilePath(change)));
  }
  return matchingChanges.toArray(new Change[matchingChanges.size()]);
}
