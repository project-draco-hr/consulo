{
  for (  VirtualFile file : files) {
    if (indicator != null && indicator.isCanceled()) {
      break;
    }
    if (fileIndex != null && fileIndex.isIgnored(file)) {
      continue;
    }
    if (!file.isDirectory() && file.getName().equalsIgnoreCase(fileName)) {
      found.add(file);
      if (indicator != null) {
        indicator.setText2(file.getPath());
      }
      if (!lookForNested) {
        return found;
      }
    }
  }
  for (  VirtualFile file : files) {
    if (indicator != null && indicator.isCanceled()) {
      break;
    }
    if (fileIndex != null && fileIndex.isIgnored(file)) {
      continue;
    }
    if (file.isDirectory()) {
      findFilesByName(file.getChildren(),fileName,found,fileIndex,indicator,lookForNested);
    }
  }
  return found;
}
