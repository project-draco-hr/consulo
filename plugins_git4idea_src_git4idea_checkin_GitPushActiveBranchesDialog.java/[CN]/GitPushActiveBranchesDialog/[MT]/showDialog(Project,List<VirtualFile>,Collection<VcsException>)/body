{
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    public void run(){
      final List<Root> emptyRoots=loadRoots(project,vcsRoots,exceptions,false);
      if (!exceptions.isEmpty()) {
        exceptions.addAll(exceptions);
        return;
      }
      final GitPushActiveBranchesDialog dialog=new GitPushActiveBranchesDialog(project,vcsRoots,emptyRoots);
      dialog.refreshTree(true,null,false);
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        @Override public void run(){
          dialog.show();
          if (dialog.isOK()) {
            dialog.rebaseAndPush();
          }
          ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
            public void run(){
              for (              VirtualFile root : vcsRoots) {
                GitRepositoryManager.getInstance(project).updateRepository(root,GitRepository.TrackedTopic.ALL);
              }
            }
          }
);
        }
      }
);
    }
  }
);
}
