{
  if (equals(scope2))   return this;
  PsiElement[] elements1=getScope();
  PsiElement[] elements2=scope2.getScope();
  boolean[] united=new boolean[elements2.length];
  List<PsiElement> result=new ArrayList<PsiElement>();
  loop1:   for (  final PsiElement element1 : elements1) {
    for (int j=0; j < elements2.length; j++) {
      final PsiElement element2=elements2[j];
      final PsiElement unionElement=scopeElementsUnion(element1,element2);
      if (unionElement != null) {
        result.add(unionElement);
        united[j]=true;
        break loop1;
      }
    }
    result.add(element1);
  }
  for (int i=0; i < united.length; i++) {
    final boolean b=united[i];
    if (!b) {
      result.add(elements2[i]);
    }
  }
  return new LocalSearchScope(result.toArray(new PsiElement[result.size()]));
}
