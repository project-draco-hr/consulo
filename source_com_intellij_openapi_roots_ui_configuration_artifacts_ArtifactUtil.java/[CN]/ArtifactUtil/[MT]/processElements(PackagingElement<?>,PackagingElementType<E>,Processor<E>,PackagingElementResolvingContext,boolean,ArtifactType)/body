{
  if (type == null || element.getType().equals(type)) {
    if (!processor.process((E)element)) {
      return false;
    }
  }
  if (element instanceof CompositePackagingElement<?>) {
    return processElements(((CompositePackagingElement<?>)element).getChildren(),type,processor,resolvingContext,processSubstituions,artifactType);
  }
 else   if (element instanceof ComplexPackagingElement<?> && processSubstituions) {
    final List<? extends PackagingElement<?>> substitution=((ComplexPackagingElement<?>)element).getSubstitution(resolvingContext,artifactType);
    if (substitution != null) {
      return processElements(substitution,type,processor,resolvingContext,processSubstituions,artifactType);
    }
  }
  return true;
}
