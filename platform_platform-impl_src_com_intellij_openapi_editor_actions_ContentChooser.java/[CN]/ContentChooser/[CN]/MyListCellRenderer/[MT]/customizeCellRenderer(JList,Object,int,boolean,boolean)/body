{
  if (UIUtil.isUnderGTKLookAndFeel()) {
    final Color background=selected ? UIUtil.getTreeSelectionBackground() : UIUtil.getTreeTextBackground();
    UIUtil.changeBackGround(this,background);
  }
  setIcon(myListEntryIcon);
  if (myUseIdeaEditor) {
    int max=list.getModel().getSize();
    String indexString=String.valueOf(index + 1);
    int count=String.valueOf(max).length() - indexString.length();
    char[] spaces=new char[count];
    Arrays.fill(spaces,' ');
    String prefix=indexString + new String(spaces) + "  ";
    append(prefix,SimpleTextAttributes.GRAYED_ATTRIBUTES);
  }
  String text=(String)value;
  FontMetrics metrics=list.getFontMetrics(list.getFont());
  int charWidth=metrics.charWidth('m');
  int maxLength=list.getParent().getParent().getWidth() * 3 / charWidth / 2;
  text=StringUtil.first(text,maxLength,true);
  append(text,SimpleTextAttributes.REGULAR_ATTRIBUTES);
}
