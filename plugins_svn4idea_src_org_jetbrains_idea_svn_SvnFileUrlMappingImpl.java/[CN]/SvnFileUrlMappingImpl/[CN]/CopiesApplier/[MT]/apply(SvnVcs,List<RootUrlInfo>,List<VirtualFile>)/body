{
  final SvnMapping mapping=new SvnMapping();
  mapping.addAll(roots);
  mapping.reportLonelyRoots(lonelyRoots);
  final SvnMapping groupedMapping=new SvnMapping();
  final List<RootUrlInfo> filtered=new ArrayList<RootUrlInfo>();
  ForNestedRootChecker.filterOutSuperfluousChildren(vcs,roots,filtered);
  groupedMapping.addAll(filtered);
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    @Override public void run(){
      if (myProject.isDisposed())       return;
      boolean mappingsChanged=false;
synchronized (myMonitor) {
        mappingsChanged=!myMapping.equals(mapping);
        if (mappingsChanged) {
          mappingsChanged=!myMoreRealMapping.equals(groupedMapping);
        }
        myMapping.copyFrom(mapping);
        myMoreRealMapping.copyFrom(groupedMapping);
      }
      final MessageBus bus=myProject.getMessageBus();
      if (mappingsChanged || !myInitedReloaded) {
        myInitedReloaded=true;
        bus.syncPublisher(SvnVcs.ROOTS_RELOADED).consume(true);
        bus.syncPublisher(ProjectLevelVcsManager.VCS_CONFIGURATION_CHANGED_IN_PLUGIN).directoryMappingChanged();
      }
 else {
        bus.syncPublisher(SvnVcs.ROOTS_RELOADED).consume(false);
      }
    }
  }
);
}
