{
  String exec=System.getenv(GIT_EXECUTABLE_ENV);
  if (exec != null && new File(exec).exists()) {
    log("Using Git from GIT_EXECUTABLE_ENV: " + exec);
    return exec;
  }
  File pluginRoot=new File(PluginPathManager.getPluginHomePath("git4idea"));
  File dir=new File(pluginRoot,"tests/git4idea/tests/data/bin");
  File git=new File(dir,SystemInfo.isWindows ? "git.exe" : "git");
  if (!git.exists()) {
    throw new IllegalStateException("git executable not found");
  }
  log("Using Git from IDEA sources: " + git.getPath());
  return git.getPath();
}
