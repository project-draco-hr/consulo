{
  if (ourGitExecutable != null) {
    return ourGitExecutable;
  }
  String exec=System.getenv(GIT_EXECUTABLE_ENV);
  if (exec != null && new File(exec).canExecute()) {
    log("Using Git from IDEA_TEST_GIT_EXECUTABLE: " + exec);
    return exec;
  }
  exec=System.getenv(TEAMCITY_GIT_EXECUTABLE_ENV);
  if (exec != null && new File(exec).canExecute()) {
    log("Using Git from TEAMCITY_GIT_PATH: " + exec);
    return exec;
  }
  String path=System.getenv(SystemInfo.isWindows ? "Path" : "PATH");
  if (path != null) {
    String name=SystemInfo.isWindows ? "git.exe" : "git";
    for (    String dir : path.split(File.pathSeparator)) {
      File file=new File(dir,name);
      if (file.canExecute()) {
        log("Using Git from PATH: " + exec);
        return file.getPath();
      }
    }
  }
  throw new IllegalStateException("Git executable not found. " + "Please define IDEA_TEST_GIT_EXECUTABLE environment variable pointing to the Git executable.");
}
