{
  DataInputStream dataInput=new DataInputStream(socket.getInputStream());
  DataOutputStream out=new DataOutputStream(socket.getOutputStream());
  final String message=new String(readDataBlock(dataInput));
  int numOfChoices=dataInput.readInt();
  final Choice[] choices=new Choice[numOfChoices];
  for (int i=0; i < numOfChoices; i++) {
    String choice=new String(readDataBlock(dataInput));
    choices[i]=new Choice(choice);
  }
  int defaultChoiceInt=dataInput.readInt();
  final Choice defaultChoice=choices[defaultChoiceInt];
  final int[] index=new int[]{-1};
  try {
    EventQueue.invokeAndWait(new Runnable(){
      public void run(){
        Window parent=ApplicationManager.getApplication().getComponent(Window.class);
        index[0]=JOptionPane.showOptionDialog(parent,message,"hg4idea",JOptionPane.OK_CANCEL_OPTION,JOptionPane.QUESTION_MESSAGE,null,choices,defaultChoice);
      }
    }
);
    int chosen=index[0];
    if (chosen == JOptionPane.CLOSED_OPTION) {
      out.writeInt(-1);
    }
 else {
      out.writeInt(chosen);
    }
    return true;
  }
 catch (  InterruptedException e) {
    return true;
  }
catch (  InvocationTargetException e) {
    throw new RuntimeException(e);
  }
}
