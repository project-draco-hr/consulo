{
  DataInputStream dataInput=new DataInputStream(socket.getInputStream());
  final String message=new String(readDataBlock(dataInput));
  int numOfChoices=dataInput.readInt();
  final Choice[] choices=new Choice[numOfChoices];
  for (int i=0; i < numOfChoices; i++) {
    String choice=new String(readDataBlock(dataInput));
    choices[i]=new Choice(choice);
  }
  int defaultChoiceInt=dataInput.readInt();
  final Choice defaultChoice=choices[defaultChoiceInt];
  final int[] index=new int[]{-1};
  ApplicationManager.getApplication().invokeAndWait(new Runnable(){
    public void run(){
      Window parent=ApplicationManager.getApplication().getComponent(Window.class);
      index[0]=JOptionPane.showOptionDialog(parent,message,"hg4idea",JOptionPane.OK_CANCEL_OPTION,JOptionPane.QUESTION_MESSAGE,null,choices,defaultChoice);
    }
  }
,ModalityState.defaultModalityState());
  int chosen=index[0];
  DataOutputStream out=new DataOutputStream(socket.getOutputStream());
  if (chosen == JOptionPane.CLOSED_OPTION) {
    out.writeInt(-1);
  }
 else {
    out.writeInt(chosen);
  }
  return true;
}
