{
  if (targetMethod == null)   return PsiClassType.EMPTY_ARRAY;
  Set<PsiClassType> result=new HashSet<PsiClassType>();
  if (!targetMethod.getManager().isInProject(targetMethod)) {
    PsiClassType[] referencedTypes=targetMethod.getThrowsList().getReferencedTypes();
    for (    PsiClassType referencedType : referencedTypes) {
      PsiClass psiClass=referencedType.resolve();
      if (psiClass == null)       continue;
      for (      PsiClassType exception : unhandledExceptions) {
        if (referencedType.isAssignableFrom(exception))         result.add(exception);
      }
    }
  }
 else {
    PsiMethod[] superMethods=PsiSuperMethodUtil.findSuperMethods(targetMethod);
    for (    PsiMethod superMethod : superMethods) {
      PsiClassType[] classTypes=filterInProjectExceptions(unhandledExceptions,superMethod);
      result.addAll(Arrays.asList(classTypes));
    }
    if (superMethods.length == 0) {
      result.addAll(Arrays.asList(unhandledExceptions));
    }
  }
  return result.toArray(new PsiClassType[result.size()]);
}
