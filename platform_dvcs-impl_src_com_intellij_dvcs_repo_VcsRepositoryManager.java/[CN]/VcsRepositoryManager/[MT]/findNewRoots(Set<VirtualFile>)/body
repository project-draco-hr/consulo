{
  Map<VirtualFile,Repository> newRootsMap=ContainerUtil.newHashMap();
  for (  VcsRoot root : myVcsManager.getAllVcsRoots()) {
    VirtualFile rootPath=root.getPath();
    if (rootPath != null && !knownRoots.contains(rootPath)) {
      AbstractVcs vcs=root.getVcs();
      VcsRepositoryCreator repositoryCreator=getRepositoryCreator(vcs);
      if (repositoryCreator == null)       continue;
      Repository repository=repositoryCreator.createRepositoryIfValid(rootPath);
      if (repository != null) {
        newRootsMap.put(rootPath,repository);
      }
    }
  }
  return newRootsMap;
}
