{
  DefaultActionGroup group=new DefaultActionGroup();
  final TaskManager manager=TaskManager.getManager(project);
  group.add(new OpenTaskAction());
  group.addSeparator();
  LocalTask activeTask=manager.getActiveTask();
  LocalTask[] localTasks=manager.getLocalTasks();
  Arrays.sort(localTasks,TaskManagerImpl.TASK_UPDATE_COMPARATOR);
  ArrayList<LocalTask> temp=new ArrayList<LocalTask>();
  boolean vcsEnabled=manager.isVcsEnabled();
  for (  final LocalTask task : localTasks) {
    if (task == activeTask) {
      continue;
    }
    if (vcsEnabled && manager.getOpenChangelists(task).isEmpty()) {
      temp.add(task);
      continue;
    }
    group.add(createActivateTaskAction(manager,task,shiftPressed,false));
  }
  if (vcsEnabled && !temp.isEmpty()) {
    group.addSeparator();
    for (int i=0, tempSize=temp.size(); i < Math.min(tempSize,5); i++) {
      LocalTask task=temp.get(i);
      group.add(createActivateTaskAction(manager,task,shiftPressed,true));
    }
  }
  return group;
}
