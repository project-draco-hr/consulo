{
  final PsiReferenceExpression referenceExpression=(PsiReferenceExpression)location;
  final PsiField field=(PsiField)referenceExpression.resolve();
  if (field == null) {
    return null;
  }
  final boolean hasInitializer=field.hasInitializer();
  final boolean initializedInInitializer=isInitializedInInitializer(field);
  final boolean initializedInConstructors=isInitializedInConstructors(field);
  if (hasInitializer) {
    if (initializedInInitializer) {
      return null;
    }
    if (initializedInConstructors) {
      return null;
    }
  }
 else   if (initializedInInitializer) {
    if (initializedInConstructors) {
      return null;
    }
  }
 else   if (!initializedInConstructors) {
    return null;
  }
  final Query<PsiReference> query=ReferencesSearch.search(field);
  for (  PsiReference reference : query) {
    final PsiElement element=reference.getElement();
    if (!(element instanceof PsiExpression)) {
      continue;
    }
    final PsiExpression expression=(PsiExpression)element;
    if (!PsiUtil.isOnAssignmentLeftHand(expression)) {
      continue;
    }
    final PsiMethod method=PsiTreeUtil.getParentOfType(expression,PsiMethod.class);
    if (method != null && !method.isConstructor()) {
      return null;
    }
  }
  final String name=field.getName();
  return new MakeFieldFinalFix(name);
}
