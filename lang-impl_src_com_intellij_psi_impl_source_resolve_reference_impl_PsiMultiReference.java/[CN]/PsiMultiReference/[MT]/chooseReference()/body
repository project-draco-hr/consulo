{
  if (myChoosenOne != -1) {
    return myReferences[myChoosenOne];
  }
  boolean nonSoftFound=false;
  myChoosenOne=0;
  boolean strict=false;
  for (int i=0; i < myReferences.length; i++) {
    final PsiReference reference=myReferences[i];
    if (reference.isSoft() && nonSoftFound)     continue;
    if (!reference.isSoft() && !nonSoftFound) {
      myChoosenOne=i;
      nonSoftFound=true;
    }
    if (reference instanceof GenericReference) {
      if (((GenericReference)reference).getContext() != null) {
        myChoosenOne=i;
        strict=true;
      }
    }
    if (reference instanceof PsiPolyVariantReference && ((PsiPolyVariantReference)reference).multiResolve(false).length > 0 || reference.resolve() != null) {
      myChoosenOne=i;
      strict=true;
    }
    if (!strict) {
      final TextRange rangeInElement1=reference.getRangeInElement();
      final TextRange rangeInElement2=myReferences[myChoosenOne].getRangeInElement();
      if (rangeInElement1.getStartOffset() >= rangeInElement2.getStartOffset() && rangeInElement1.getEndOffset() <= rangeInElement2.getEndOffset()) {
        myChoosenOne=i;
      }
    }
  }
  return myReferences[myChoosenOne];
}
