{
  final String superclassName=dialog.getExtractedSuperName();
  final PsiDirectory targetDirectory=dialog.getTargetDirectory();
  final MemberInfo[] selectedMemberInfos=dialog.getSelectedMemberInfos();
  final DocCommentPolicy javaDocPolicy=new DocCommentPolicy(dialog.getJavaDocPolicy());
  LocalHistoryAction a=LocalHistory.getInstance().startAction(getCommandName(subclass,superclassName));
  try {
    PsiClass superclass=null;
    try {
      superclass=ExtractSuperClassUtil.extractSuperClass(project,targetDirectory,superclassName,subclass,selectedMemberInfos,javaDocPolicy);
    }
  finally {
      a.finish();
    }
    if (superclass != null) {
      ExtractClassUtil.askAndTurnRefsToSuper(project,subclass,superclass);
    }
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
}
