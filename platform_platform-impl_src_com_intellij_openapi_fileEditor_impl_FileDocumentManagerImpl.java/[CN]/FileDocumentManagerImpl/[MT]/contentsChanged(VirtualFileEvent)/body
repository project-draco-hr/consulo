{
  if (event.isFromSave())   return;
  final VirtualFile file=event.getFile();
  final Document document=getCachedDocument(file);
  if (document == null) {
    fireFileWithNoDocumentChanged(file);
    return;
  }
  if (isBinaryWithDecompiler(file)) {
    fireFileWithNoDocumentChanged(file);
  }
  long documentStamp=document.getModificationStamp();
  long oldFileStamp=event.getOldModificationStamp();
  if (documentStamp != oldFileStamp) {
    LOG.info("reaload from disk?");
    LOG.info("  documentStamp:" + documentStamp);
    LOG.info("  oldFileStamp:" + oldFileStamp);
    final boolean unitTestMode=ApplicationManager.getApplication().isUnitTestMode();
    Runnable askReloadRunnable=new Runnable(){
      public void run(){
        if (!unitTestMode)         IdeEventQueue.getInstance().removeIdleListener(this);
        if (!file.isValid())         return;
        if (askReloadFromDisk(file,document)) {
          reloadFromDisk(document);
        }
      }
    }
;
    if (unitTestMode) {
      askReloadRunnable.run();
    }
 else {
      IdeEventQueue.getInstance().addIdleListener(askReloadRunnable,2000);
    }
  }
 else {
    reloadFromDisk(document);
  }
}
