{
  ApplicationManager.getApplication().assertIsDispatchThread();
  final VirtualFile file=getFile(document);
  if (!fireBeforeFileContentReload(file,document)) {
    return;
  }
  final Project project=ProjectLocator.getInstance().guessProjectForFile(file);
  CommandProcessor.getInstance().executeCommand(project,new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new ExternalChangeAction.ExternalDocumentChange(document,project){
        @Override public void run(){
          boolean wasWritable=document.isWritable();
          DocumentEx documentEx=(DocumentEx)document;
          documentEx.setReadOnly(false);
          documentEx.replaceText(LoadTextUtil.loadText(file),file.getModificationStamp());
          documentEx.setReadOnly(!wasWritable);
        }
      }
);
    }
  }
,UIBundle.message("file.cache.conflict.action"),null);
  myUnsavedDocuments.remove(document);
  myMultiCaster.fileContentReloaded(file,document);
}
