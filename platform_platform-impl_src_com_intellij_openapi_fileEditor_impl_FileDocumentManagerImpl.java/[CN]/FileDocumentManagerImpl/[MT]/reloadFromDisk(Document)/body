{
  final VirtualFile file=getFile(document);
  try {
    fireBeforeFileContentReload(file,document);
  }
 catch (  VetoDocumentReloadException e) {
    return;
  }
catch (  Exception e) {
    LOG.error(e);
  }
  ApplicationManager.getApplication().runWriteAction(new ExternalChangeAction(){
    public void run(){
      boolean wasWritable=document.isWritable();
      DocumentEx documentEx=(DocumentEx)document;
      documentEx.setReadOnly(false);
      documentEx.replaceText(LoadTextUtil.loadText(file),file.getModificationStamp());
      documentEx.setReadOnly(!wasWritable);
    }
  }
);
  myUnsavedDocuments.remove(document);
  try {
    fireFileContentReloaded(file,document);
  }
 catch (  Exception e) {
    LOG.error(e);
  }
}
