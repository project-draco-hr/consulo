{
  final VirtualFile file=getInstance().getFile(document);
  if (project != null && file != null && file.isValid()) {
    if (file.getFileType().isBinary())     return false;
    return ReadonlyStatusHandler.ensureFilesWritable(project,file);
  }
  if (document.isWritable()) {
    return true;
  }
  document.fireReadOnlyModificationAttempt();
  return false;
}
