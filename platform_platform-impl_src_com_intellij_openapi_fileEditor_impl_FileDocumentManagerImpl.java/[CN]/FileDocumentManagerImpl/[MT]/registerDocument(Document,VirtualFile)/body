{
synchronized (lock) {
    virtualFile.putUserData(DOCUMENT_KEY,new SoftReference<Document>(document){
      @Override public Document get(){
        return document;
      }
    }
);
    document.putUserData(FILE_KEY,virtualFile);
  }
}
