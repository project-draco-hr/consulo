{
  ApplicationManager.getApplication().assertIsDispatchThread();
  myMultiCaster.beforeAllDocumentsSaving();
  if (myUnsavedDocuments.isEmpty())   return;
  final Map<Document,IOException> failedToSave=new HashMap<Document,IOException>();
  while (true) {
    int count=0;
    final AccessToken token=ApplicationManager.getApplication().acquireWriteActionLock(getClass());
    try {
      for (      Document document : myUnsavedDocuments) {
        if (failedToSave.containsKey(document))         continue;
        try {
          doSaveDocument(document);
        }
 catch (        IOException e) {
          failedToSave.put(document,e);
        }
        count++;
      }
    }
  finally {
      token.finish();
    }
    if (count == 0)     break;
  }
  if (!failedToSave.isEmpty()) {
    handleErrorsOnSave(failedToSave);
  }
}
