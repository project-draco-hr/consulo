{
  ApplicationManager.getApplication().assertIsDispatchThread();
  myMultiCaster.beforeAllDocumentsSaving();
  if (myUnsavedDocuments.isEmpty())   return;
  Set<Document> failedToSave=new THashSet<Document>();
  while (true) {
    final Document[] unsavedDocuments=getUnsavedDocuments();
    int count=0;
    for (    Document document : unsavedDocuments) {
      if (failedToSave.contains(document))       continue;
      saveDocument(document);
      count++;
      if (myUnsavedDocuments.contains(document)) {
        failedToSave.add(document);
      }
    }
    if (count == 0)     break;
  }
}
