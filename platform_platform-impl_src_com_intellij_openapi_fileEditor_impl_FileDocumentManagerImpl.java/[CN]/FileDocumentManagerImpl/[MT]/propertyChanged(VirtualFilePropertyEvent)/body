{
  final VirtualFile file=event.getFile();
  if (VirtualFile.PROP_WRITABLE.equals(event.getPropertyName())) {
    final Document document=getCachedDocument(file);
    if (document != null) {
      ApplicationManager.getApplication().runWriteAction(new ExternalChangeAction(){
        @Override public void run(){
          document.setReadOnly(!file.isWritable());
        }
      }
);
    }
  }
 else   if (VirtualFile.PROP_NAME.equals(event.getPropertyName())) {
    Document document=getCachedDocument(file);
    if (document != null) {
      FileType type=file.getFileType();
      if (type == UnknownFileType.INSTANCE) {
        FileTypeManager.getInstance().detectFileTypeFromContent(file);
      }
      if (isBinaryWithoutDecompiler(file)) {
        file.putUserData(DOCUMENT_KEY,null);
        document.putUserData(FILE_KEY,null);
      }
    }
  }
}
