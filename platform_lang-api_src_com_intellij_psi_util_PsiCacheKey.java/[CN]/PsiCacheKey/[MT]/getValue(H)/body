{
  while (true) {
    Pair<Long,T> data=h.getUserData(this);
    final long count=h.getManager().getModificationTracker().getJavaStructureModificationCount();
    if (data == null) {
      data=new Pair<Long,T>(count,myFunction.fun(h));
      data=((UserDataHolderEx)h).putUserDataIfAbsent(this,data);
    }
 else     if (data.getFirst() != count) {
      Pair<Long,T> newData=new Pair<Long,T>(count,myFunction.fun(h));
      if (((UserDataHolderEx)h).replace(this,data,newData)) {
        data=newData;
      }
 else {
        continue;
      }
    }
    return data.getSecond();
  }
}
