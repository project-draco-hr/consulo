{
  final PsiManager psiManager=PsiManager.getInstance(getProject());
  ProjectRootManager prm=ProjectRootManager.getInstance(getProject());
  ProjectFileIndex index=prm.getFileIndex();
  ArrayList<AbstractTreeNode> nodes=new ArrayList<AbstractTreeNode>();
  for (  VirtualFile root : prm.getContentRoots()) {
    VirtualFile parent=root.getParent();
    if (parent == null || !index.isInContent(parent)) {
      nodes.add(new PsiDirectoryNode(getProject(),psiManager.findDirectory(root),getSettings()));
    }
  }
  final VirtualFile baseDir=getProject().getBaseDir();
  if (baseDir == null)   return nodes;
  final VirtualFile[] files=baseDir.getChildren();
  for (  VirtualFile file : files) {
    if (ModuleUtil.findModuleForFile(file,getProject()) == null) {
      if (!file.isDirectory()) {
        nodes.add(new PsiFileNode(getProject(),psiManager.findFile(file),getSettings()));
      }
    }
  }
  if (getSettings().isShowLibraryContents()) {
    nodes.add(new ExternalLibrariesNode(getProject(),getSettings()));
  }
  return nodes;
}
