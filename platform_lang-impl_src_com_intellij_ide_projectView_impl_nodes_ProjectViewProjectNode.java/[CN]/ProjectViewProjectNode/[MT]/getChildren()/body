{
  List<VirtualFile> topLevelContentRoots=ProjectViewDirectoryHelper.getInstance(myProject).getTopLevelRoots();
  ArrayList<AbstractTreeNode> nodes=new ArrayList<AbstractTreeNode>();
  final PsiManager psiManager=PsiManager.getInstance(getProject());
  for (  VirtualFile root : reduceRoots(topLevelContentRoots)) {
    nodes.add(new PsiDirectoryNode(getProject(),psiManager.findDirectory(root),getSettings()));
  }
  final VirtualFile baseDir=getProject().getBaseDir();
  if (baseDir == null)   return nodes;
  final VirtualFile[] files=baseDir.getChildren();
  for (  VirtualFile file : files) {
    if (ModuleUtil.findModuleForFile(file,getProject()) == null) {
      if (!file.isDirectory()) {
        nodes.add(new PsiFileNode(getProject(),psiManager.findFile(file),getSettings()));
      }
    }
  }
  if (getSettings().isShowLibraryContents()) {
    nodes.add(new ExternalLibrariesNode(getProject(),getSettings()));
  }
  return nodes;
}
