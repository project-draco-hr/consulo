{
  final Sdk[] sdks=ProjectJdkTable.getInstance().getAllJdks();
  final List<Sdk> sdksList=Arrays.asList(sdks);
  final ProjectJdkImpl projectJdk;
  try {
    final String sdkName=customSdkSuggestedName == null ? createUniqueSdkName(sdkType,homeDir.getPath(),sdksList) : createUniqueSdkName(customSdkSuggestedName,sdksList);
    projectJdk=new ProjectJdkImpl(sdkName,sdkType);
    if (additionalData != null) {
      projectJdk.setSdkAdditionalData(additionalData);
    }
    projectJdk.setHomePath(homeDir.getPath());
    sdkType.setupSdkPaths(projectJdk);
  }
 catch (  Exception e) {
    if (!silent) {
      Messages.showErrorDialog("Error configuring SDK: " + e.getMessage() + ".\nPlease make sure that "+ FileUtil.toSystemDependentName(homeDir.getPath())+ " is a valid home path for this SDK type.","Error configuring SDK");
    }
    return null;
  }
  return ApplicationManager.getApplication().runWriteAction(new NullableComputable<Sdk>(){
    public Sdk compute(){
      ProjectJdkTable.getInstance().addJdk(projectJdk);
      return projectJdk;
    }
  }
);
}
