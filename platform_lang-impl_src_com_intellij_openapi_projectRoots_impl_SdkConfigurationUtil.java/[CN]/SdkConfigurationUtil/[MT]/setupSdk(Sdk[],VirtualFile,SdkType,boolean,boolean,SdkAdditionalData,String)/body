{
  final List<Sdk> sdksList=Arrays.asList(allSdks);
  final SdkImpl sdk;
  try {
    String sdkName=null;
    if (bundled) {
      sdkName=sdkType.getName() + " (bundled)";
    }
 else {
      sdkName=customSdkSuggestedName == null ? createUniqueSdkName(sdkType,homeDir.getPath(),sdksList) : createUniqueSdkName(customSdkSuggestedName,sdksList);
    }
    sdk=new SdkImpl(sdkName,sdkType);
    if (bundled) {
      sdk.setBundled();
    }
    if (additionalData != null) {
      sdk.setSdkAdditionalData(additionalData);
    }
    sdk.setHomePath(homeDir.getPath());
    sdkType.setupSdkPaths(sdk);
  }
 catch (  Exception e) {
    if (!silent) {
      Messages.showErrorDialog("Error configuring SDK: " + e.getMessage() + ".\nPlease make sure that "+ FileUtil.toSystemDependentName(homeDir.getPath())+ " is a valid home path for this SDK type.","Error Configuring SDK");
    }
    return null;
  }
  return sdk;
}
