{
  final SdkImpl sdk;
  try {
    String sdkPath=sdkType.sdkPath(homeDir);
    String sdkName=null;
    if (predefined) {
      sdkName=sdkType.getName() + PREDEFINED_PREFIX;
    }
 else {
      sdkName=customSdkSuggestedName == null ? createUniqueSdkName(sdkType,sdkPath,allSdks) : createUniqueSdkName(customSdkSuggestedName,allSdks);
    }
    sdk=new SdkImpl(sdkName,sdkType);
    sdk.setPredefined(predefined);
    if (additionalData != null) {
      sdk.setSdkAdditionalData(additionalData);
    }
    sdk.setHomePath(sdkPath);
    sdkType.setupSdkPaths(sdk);
  }
 catch (  Exception e) {
    if (!silent) {
      Messages.showErrorDialog("Error configuring SDK: " + e.getMessage() + ".\nPlease make sure that "+ FileUtil.toSystemDependentName(homeDir.getPath())+ " is a valid home path for this SDK type.","Error Configuring SDK");
    }
    return null;
  }
  return sdk;
}
