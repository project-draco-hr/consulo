{
  if (text.length() < path.length() || path.length() == 0) {
    return text;
  }
  boolean startsWith;
  if (caseSensitive) {
    startsWith=text.startsWith(path);
  }
 else {
    startsWith=StringUtil.startsWithIgnoreCase(text,path);
  }
  if (!startsWith)   return text;
  final StringBuilder newText=StringBuilderSpinAllocator.alloc();
  try {
    int endOfOccurrence=path.length();
    final boolean isWindowsRoot=path.endsWith(":/");
    if (!isWindowsRoot && endOfOccurrence < text.length() && text.charAt(endOfOccurrence) != '/' && !text.substring(endOfOccurrence).startsWith("!/")) {
      return text;
    }
    newText.append(macro);
    newText.append(text.substring(endOfOccurrence));
    return newText.toString();
  }
  finally {
    StringBuilderSpinAllocator.dispose(newText);
  }
}
