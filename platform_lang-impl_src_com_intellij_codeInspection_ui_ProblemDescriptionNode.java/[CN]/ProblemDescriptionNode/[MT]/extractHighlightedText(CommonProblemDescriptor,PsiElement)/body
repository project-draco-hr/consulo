{
  if (psiElement == null || !psiElement.isValid())   return "";
  String ref=psiElement.getText();
  if (descriptor instanceof ProblemDescriptorImpl) {
    TextRange textRange=((ProblemDescriptorImpl)descriptor).getTextRange();
    final TextRange elementRange=psiElement.getTextRange();
    if (textRange != null && elementRange != null) {
      textRange=textRange.shiftRight(-elementRange.getStartOffset());
      if (textRange.getStartOffset() >= 0 && textRange.getEndOffset() <= elementRange.getLength()) {
        ref=textRange.substring(ref);
      }
    }
  }
  ref=StringUtil.replaceChar(ref,'\n',' ').trim();
  ref=StringUtil.first(ref,100,true);
  return ref;
}
