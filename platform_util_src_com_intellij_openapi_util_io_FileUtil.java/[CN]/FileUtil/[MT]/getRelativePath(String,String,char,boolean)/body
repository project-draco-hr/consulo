{
  basePath=ensureEnds(basePath,separator);
  String basePathToCompare=caseSensitive ? basePath : basePath.toLowerCase();
  String filePathToCompare=caseSensitive ? filePath : filePath.toLowerCase();
  if (basePathToCompare.equals(ensureEnds(filePathToCompare,separator)))   return ".";
  int len=0;
  int lastSeparatorIndex=0;
  while (len < filePath.length() && len < basePath.length() && filePathToCompare.charAt(len) == basePathToCompare.charAt(len)) {
    if (basePath.charAt(len) == separator) {
      lastSeparatorIndex=len;
    }
    len++;
  }
  if (len == 0)   return null;
  StringBuilder relativePath=new StringBuilder();
  for (int i=len; i < basePath.length(); i++) {
    if (basePath.charAt(i) == separator) {
      relativePath.append("..");
      relativePath.append(separator);
    }
  }
  relativePath.append(filePath.substring(lastSeparatorIndex + 1));
  return relativePath.toString();
}
