{
  if (StringUtil.isEmptyOrSpaces(myMessage)) {
    throw new HgCommandException(HgVcsMessages.message("hg4idea.commit.error.messageEmpty"));
  }
  List<String> relativePaths=HgUtil.getRelativePathsByRepository(myFiles).get(myRoot);
  if (relativePaths == null) {
    return;
  }
  for (  List<String> chunk : VcsFileUtil.chunkRelativePaths(relativePaths)) {
    List<String> parameters=new LinkedList<String>();
    parameters.add("--logfile");
    parameters.add(saveCommitMessage().getAbsolutePath());
    parameters.addAll(chunk);
    ensureSuccess(new HgCommandExecutor(myProject).executeInCurrentThread(myRoot,"commit",parameters));
  }
  final MessageBus messageBus=myProject.getMessageBus();
  messageBus.syncPublisher(HgVcs.REMOTE_TOPIC).update(myProject,null);
  messageBus.syncPublisher(HgVcs.BRANCH_TOPIC).update(myProject,null);
}
