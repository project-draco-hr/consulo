{
  if (StringUtils.isBlank(message)) {
    throw new HgCommandException(HgVcsMessages.message("hg4idea.commit.error.messageEmpty"));
  }
  try {
    List<String> parameters=new LinkedList<String>();
    parameters.add("--logfile");
    parameters.add(saveCommitMessage().getAbsolutePath());
    for (    HgFile hgFile : files) {
      parameters.add(hgFile.getRelativePath());
    }
    ensureSuccess(new HgCommandExecutor(project).executeInCurrentThread(repo,"commit",parameters));
    final MessageBus messageBus=project.getMessageBus();
    messageBus.syncPublisher(HgVcs.REMOTE_TOPIC).update(project);
    messageBus.syncPublisher(HgVcs.BRANCH_TOPIC).update(project);
  }
 catch (  IOException e) {
    LOG.info(e);
  }
}
