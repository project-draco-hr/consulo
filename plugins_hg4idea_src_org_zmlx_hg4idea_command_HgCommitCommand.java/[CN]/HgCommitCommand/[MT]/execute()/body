{
  if (StringUtils.isBlank(myMessage)) {
    throw new HgCommandException(HgVcsMessages.message("hg4idea.commit.error.messageEmpty"));
  }
  List<String> parameters=new LinkedList<String>();
  parameters.add("--logfile");
  parameters.add(saveCommitMessage().getAbsolutePath());
  for (  HgFile hgFile : myFiles) {
    parameters.add(hgFile.getRelativePath());
  }
  parameters.add("--encoding");
  parameters.add(CharsetToolkit.UTF8);
  ensureSuccess(new HgCommandExecutor(myProject).executeInCurrentThread(myRoot,"commit",parameters));
  final MessageBus messageBus=myProject.getMessageBus();
  messageBus.syncPublisher(HgVcs.REMOTE_TOPIC).update(myProject);
  messageBus.syncPublisher(HgVcs.BRANCH_TOPIC).update(myProject);
}
