{
  if (StringUtil.isEmptyOrSpaces(myMessage)) {
    throw new HgCommandException(HgVcsMessages.message("hg4idea.commit.error.messageEmpty"));
  }
  if (myFiles.isEmpty()) {
    commitChunkFiles(Collections.<String>emptyList());
  }
 else {
    List<String> relativePaths=ContainerUtil.map2List(myFiles,new Function<HgFile,String>(){
      @Override public String fun(      HgFile file){
        return file.getRelativePath();
      }
    }
);
    for (    List<String> chunk : VcsFileUtil.chunkRelativePaths(relativePaths)) {
      commitChunkFiles(chunk);
    }
  }
  final MessageBus messageBus=myProject.getMessageBus();
  messageBus.syncPublisher(HgVcs.REMOTE_TOPIC).update(myProject,null);
  messageBus.syncPublisher(HgVcs.BRANCH_TOPIC).update(myProject,null);
}
