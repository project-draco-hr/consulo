{
  PsiBuilder.Marker refElement=builder.mark();
  if (annotations) {
    DeclarationParser.parseAnnotations(builder);
  }
  if (!expect(builder,JavaTokenType.IDENTIFIER)) {
    refElement.rollbackTo();
    if (isImport) {
      error(builder,JavaErrorMessages.message("expected.identifier"));
    }
    typeInfo.hasErrors=true;
    return null;
  }
  if (parameterList) {
    typeInfo.isParameterized=(builder.getTokenType() == JavaTokenType.LT);
    parseReferenceParameterList(builder,true,diamonds);
  }
 else {
    if (!isStaticImport || builder.getTokenType() == JavaTokenType.DOT) {
      emptyElement(builder,JavaElementType.REFERENCE_PARAMETER_LIST);
    }
  }
  boolean hasIdentifier;
  while (builder.getTokenType() == JavaTokenType.DOT) {
    refElement.done(JavaElementType.JAVA_CODE_REFERENCE);
    final PsiBuilder.Marker dotPos=builder.mark();
    builder.advanceLexer();
    if (expect(builder,JavaTokenType.IDENTIFIER)) {
      hasIdentifier=true;
    }
 else     if (isImport && expect(builder,JavaTokenType.ASTERISK)) {
      dotPos.drop();
      return refElement;
    }
 else {
      if (!eatLastDot) {
        dotPos.rollbackTo();
        return refElement;
      }
      hasIdentifier=false;
    }
    dotPos.drop();
    final PsiBuilder.Marker prevElement=refElement;
    refElement=refElement.precede();
    if (!hasIdentifier) {
      typeInfo.hasErrors=true;
      if (isImport) {
        error(builder,JavaErrorMessages.message("import.statement.identifier.or.asterisk.expected."));
        refElement.drop();
        return prevElement;
      }
 else {
        error(builder,JavaErrorMessages.message("expected.identifier"));
        emptyElement(builder,JavaElementType.REFERENCE_PARAMETER_LIST);
        break;
      }
    }
    if (parameterList) {
      typeInfo.isParameterized=(builder.getTokenType() == JavaTokenType.LT);
      parseReferenceParameterList(builder,true,diamonds);
    }
 else     if (!isStaticImport || builder.getTokenType() == JavaTokenType.DOT) {
      emptyElement(builder,JavaElementType.REFERENCE_PARAMETER_LIST);
    }
  }
  refElement.done(isStaticImport ? JavaElementType.IMPORT_STATIC_REFERENCE : JavaElementType.JAVA_CODE_REFERENCE);
  return refElement;
}
