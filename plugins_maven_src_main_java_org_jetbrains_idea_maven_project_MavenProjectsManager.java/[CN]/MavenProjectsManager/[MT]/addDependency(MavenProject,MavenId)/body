{
  final MavenArtifact[] artifact=new MavenArtifact[1];
  try {
    MavenProcess.run(myProject,"Downloading dependency...",new MavenProcess.MavenTask(){
      public void run(      MavenProcess process) throws MavenProcessCanceledException {
        artifact[0]=myProjectsTree.downloadArtifact(mavenProject,id,myEmbeddersManager,new SoutMavenConsole(),process);
      }
    }
);
  }
 catch (  MavenProcessCanceledException ignore) {
    return null;
  }
  VirtualFile file=mavenProject.getFile();
  PsiFile psiFile=PsiManager.getInstance(myProject).findFile(file);
  MavenDomDependency result=new WriteCommandAction<MavenDomDependency>(myProject,"Add Maven Dependency",psiFile){
    protected void run(    Result<MavenDomDependency> result) throws Throwable {
      result.setResult(mavenProject.addDependency(myProject,artifact[0]));
    }
  }
.execute().getResultObject();
  return result;
}
