{
  PsiElement psiElement=(PsiElement)this;
  Icon baseIcon=LastComputedIcon.get(psiElement,flags);
  if (baseIcon == null) {
    if (myBaseIcon == null) {
      myBaseIcon=new HashMap<Integer,Icon>(3);
    }
    if (!myBaseIcon.containsKey(flags)) {
      myBaseIcon.put(flags,computeBaseIcon(flags));
    }
    baseIcon=myBaseIcon.get(flags);
  }
  if (isToDeferIconLoading()) {
    return IconDeferrer.getInstance().defer(baseIcon,new ElementIconRequest(psiElement,flags),new Function<ElementIconRequest,Icon>(){
      public Icon fun(      ElementIconRequest request){
        return computeIconNow(request.getElement(),request.getFlags());
      }
    }
);
  }
 else {
    return computeIconNow(psiElement,flags);
  }
}
