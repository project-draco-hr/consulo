{
  PsiElement psiElement=(PsiElement)this;
  Icon baseIcon=psiElement.getUserData(Iconable.LAST_COMPUTED_ICON);
  if (baseIcon == null) {
    baseIcon=IconLoader.getIcon("/nodes/class.png");
  }
  return IconDeferrer.getInstance().defer(baseIcon,new ElementIconRequest(psiElement,flags),new Function<ElementIconRequest,Icon>(){
    public Icon fun(    ElementIconRequest request){
      if (!request.getElement().isValid())       return null;
      final Icon providersIcon=PsiIconUtil.getProvidersIcon(request.getElement(),request.getFlags());
      if (providersIcon != null) {
        return providersIcon instanceof RowIcon ? (RowIcon)providersIcon : createLayeredIcon(providersIcon,request.getFlags());
      }
      return getElementIcon(request.getFlags());
    }
  }
);
}
