{
  PsiElement psiElement=(PsiElement)this;
  Icon baseIcon=LastComputedIcon.get(psiElement,flags);
  if (baseIcon == null) {
    if (myBaseIcon == null) {
      myBaseIcon=new TIntObjectHashMap<Icon>(3);
    }
    if (!myBaseIcon.containsKey(flags)) {
      myBaseIcon.put(flags,computeBaseIcon(flags));
    }
    baseIcon=myBaseIcon.get(flags);
  }
  if (!psiElement.isValid())   return null;
  if (isToDeferIconLoading()) {
    return IconDeferrer.getInstance().defer(baseIcon,new ElementIconRequest(psiElement,flags),ICON_COMPUTE);
  }
 else {
    return computeIconNow(psiElement,flags);
  }
}
