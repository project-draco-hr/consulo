{
  final Collection<FilePath> rootsWithoutIntersections=getRootsWithoutIntersections(roots);
  setText(com.intellij.CvsBundle.message("progress.text.searching.for.cvs.root"));
  myManager.lockSynchronizationActions();
  mySuitableFiles=calcVirtualFilesUnderCvsIn(rootsWithoutIntersections) * 2;
  myProcessedFiels=0;
  try {
    ApplicationManager.getApplication().runReadAction(new Runnable(){
      public void run(){
        for (Iterator each=rootsWithoutIntersections.iterator(); each.hasNext(); ) {
          FilePath file=(FilePath)each.next();
          VirtualFile virtualFile=file.getVirtualFile();
          if (virtualFile != null) {
            myResult.add(virtualFile);
            process(virtualFile);
          }
 else {
            myResult.add(file.getVirtualFileParent());
          }
        }
      }
    }
);
  }
  finally {
    myManager.unlockSynchronizationActions();
  }
  return myResult;
}
