{
  final BufferedOutputStream outputStream=new BufferedOutputStream(new FileOutputStream(jarFile));
  final JarOutputStream jarOutputStream;
  if (manifestFile != null) {
    final InputStream manifestStream=manifestFile.getInputStream();
    try {
      jarOutputStream=new JarOutputStream(outputStream,new Manifest(manifestStream));
    }
  finally {
      manifestStream.close();
    }
  }
 else {
    jarOutputStream=new JarOutputStream(outputStream);
  }
  return jarOutputStream;
}
