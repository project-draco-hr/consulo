{
  return ApplicationManager.getApplication().runReadAction(new Computable<GenerationItem[]>(){
    @Override public GenerationItem[] compute(){
      final List<GenerationItem> items=new ArrayList<GenerationItem>();
      final Module[] modules=ModuleManager.getInstance(context.getProject()).getModules();
      for (      Module module : modules) {
        final AndroidFacet facet=AndroidFacet.getInstance(module);
        if (facet == null) {
          continue;
        }
        final VirtualFile resourcesDir=AndroidAptCompiler.getResourceDirForApkCompiler(facet);
        if (resourcesDir == null) {
          continue;
        }
        final AndroidPlatform platform=facet.getConfiguration().getAndroidPlatform();
        if (platform == null) {
          context.addMessage(CompilerMessageCategory.ERROR,AndroidBundle.message("android.compilation.error.specify.platform",module.getName()),null,-1,-1);
          continue;
        }
        final int platformToolsRevision=platform.getSdkData().getPlatformToolsRevision();
        if (platformToolsRevision > 0 && platformToolsRevision <= 7) {
          continue;
        }
        items.add(new MyItem(module,platform.getTarget(),resourcesDir));
      }
      return items.toArray(new GenerationItem[items.size()]);
    }
  }
);
}
