{
  final CommittedChangesCache cache=CommittedChangesCache.getInstance(myProject);
  if (!cache.hasCachesForAllRoots()) {
    CacheSettingsDialog dialog=new CacheSettingsDialog(myProject);
    dialog.show();
    if (!dialog.isOK()) {
      return;
    }
    cache.setInitialCount(dialog.getInitialCount());
  }
  final Ref<VcsException> refEx=new Ref<VcsException>();
  final Ref<List<CommittedChangeList>> changes=new Ref<List<CommittedChangeList>>();
  boolean completed=ProgressManager.getInstance().runProcessWithProgressSynchronously(new Runnable(){
    public void run(){
      try {
        if (myLocation == null) {
          changes.set(cache.getProjectChanges(mySettings,myMaxCount));
        }
 else {
          changes.set(myProvider.getCommittedChanges(mySettings,myLocation,myMaxCount));
        }
      }
 catch (      VcsException ex) {
        refEx.set(ex);
      }
    }
  }
,"Loading changes",true,myProject);
  if (!refEx.isNull()) {
    LOG.info(refEx.get());
    Messages.showErrorDialog(myProject,"Error refreshing view: " + StringUtil.join(refEx.get().getMessages(),"\n"),"Committed Changes");
  }
 else   if (completed) {
    myChangesFromProvider=changes.get();
    updateFilteredModel();
  }
}
