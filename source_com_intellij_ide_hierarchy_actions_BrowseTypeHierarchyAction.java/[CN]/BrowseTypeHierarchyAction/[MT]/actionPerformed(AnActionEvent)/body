{
  final DataContext dataContext=e.getDataContext();
  final Project project=DataKeys.PROJECT.getData(dataContext);
  if (project == null)   return;
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  final PsiClass psiClass=getPsiClass(dataContext);
  if (psiClass == null)   return;
  final TypeHierarchyBrowser hierarchyBrowser=new TypeHierarchyBrowser(project,psiClass);
  final Content content;
  final HierarchyBrowserManager hierarchyBrowserManager=project.getComponent(HierarchyBrowserManager.class);
  final ContentManager contentManager=hierarchyBrowserManager.getContentManager();
  final Content selectedContent=contentManager.getSelectedContent();
  if (selectedContent != null && !selectedContent.isPinned()) {
    content=selectedContent;
    final Component component=content.getComponent();
    if (component instanceof TypeHierarchyBrowser) {
      ((TypeHierarchyBrowser)component).dispose();
    }
    content.setComponent(hierarchyBrowser);
  }
 else {
    content=PeerFactory.getInstance().getContentFactory().createContent(hierarchyBrowser,null,true);
    contentManager.addContent(content);
    contentManager.addContentManagerListener(new ContentManagerAdapter(){
      public void contentRemoved(      final ContentManagerEvent event){
        final Content content=event.getContent();
        final Component component=content.getComponent();
        if (component instanceof TypeHierarchyBrowser) {
          ((TypeHierarchyBrowser)component).dispose();
          content.release();
        }
      }
    }
);
  }
  contentManager.setSelectedContent(content);
  hierarchyBrowser.setContent(content);
  final String name=psiClass.getName();
  content.setDisplayName(name);
  final Runnable runnable=new Runnable(){
    public void run(){
      final String typeName=psiClass.isInterface() ? SubtypesHierarchyTreeStructure.TYPE : TypeHierarchyTreeStructure.TYPE;
      hierarchyBrowser.changeView(typeName);
    }
  }
;
  ToolWindowManager.getInstance(project).getToolWindow(ToolWindowId.HIERARCHY).activate(runnable);
}
