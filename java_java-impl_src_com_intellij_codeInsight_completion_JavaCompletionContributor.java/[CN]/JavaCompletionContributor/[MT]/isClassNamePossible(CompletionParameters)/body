{
  boolean isSecondCompletion=parameters.getInvocationCount() >= 2;
  final PsiElement parent=parameters.getPosition().getParent();
  if (!(parent instanceof PsiJavaCodeReferenceElement))   return isSecondCompletion;
  if (((PsiJavaCodeReferenceElement)parent).getQualifier() != null)   return isSecondCompletion;
  if (parent instanceof PsiJavaCodeReferenceElementImpl && ((PsiJavaCodeReferenceElementImpl)parent).getKind() == PsiJavaCodeReferenceElementImpl.PACKAGE_NAME_KIND) {
    return false;
  }
  PsiElement grand=parent.getParent();
  if (grand instanceof PsiSwitchLabelStatement) {
    return false;
  }
  if (psiElement().inside(PsiImportStatement.class).accepts(parent)) {
    return isSecondCompletion;
  }
  if (grand instanceof PsiAnonymousClass) {
    grand=grand.getParent();
  }
  if (grand instanceof PsiNewExpression && ((PsiNewExpression)grand).getQualifier() != null) {
    return false;
  }
  if (JavaCompletionData.isAfterPrimitiveOrArrayType(parameters.getPosition())) {
    return false;
  }
  return true;
}
