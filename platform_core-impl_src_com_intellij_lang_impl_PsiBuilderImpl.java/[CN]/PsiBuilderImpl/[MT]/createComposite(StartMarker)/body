{
  final IElementType type=marker.myType;
  if (type == TokenType.ERROR_ELEMENT) {
    String message=marker.myDoneMarker instanceof DoneWithErrorMarker ? ((DoneWithErrorMarker)marker.myDoneMarker).myMessage : null;
    return Factory.createErrorElement(message);
  }
  if (type == null) {
    throw new RuntimeException(UNBALANCED_MESSAGE);
  }
  return ASTFactory.composite(type);
}
