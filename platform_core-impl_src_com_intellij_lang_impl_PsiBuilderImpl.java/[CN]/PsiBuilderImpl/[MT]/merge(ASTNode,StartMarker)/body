{
  DiffLog diffLog=new DiffLog();
  final ConvertFromTokensToASTBuilder builder=new ConvertFromTokensToASTBuilder(newRoot,diffLog);
  final MyTreeStructure treeStructure=new MyTreeStructure(newRoot,null);
  final MyComparator comparator=new MyComparator(getUserDataUnprotected(CUSTOM_COMPARATOR),treeStructure);
  final ProgressIndicatorProvider provider=ProgressIndicatorProvider.getInstance();
  final ProgressIndicator indicator=provider != null ? provider.getProgressIndicator() : null;
  BlockSupportImpl.diffTrees(oldRoot,builder,comparator,treeStructure,indicator);
  return diffLog;
}
