{
  DiffLog diffLog=new DiffLog();
  final ConvertFromTokensToASTBuilder builder=new ConvertFromTokensToASTBuilder(newRoot,diffLog);
  final MyTreeStructure treeStructure=new MyTreeStructure(newRoot,null);
  final MyComparator comparator=new MyComparator(getUserDataUnprotected(CUSTOM_COMPARATOR),treeStructure);
  final ProgressIndicator indicator=ProgressIndicatorProvider.getGlobalProgressIndicator();
  BlockSupportImpl.diffTrees(oldRoot,builder,comparator,treeStructure,indicator == null ? new EmptyProgressIndicator() : indicator);
  return diffLog;
}
