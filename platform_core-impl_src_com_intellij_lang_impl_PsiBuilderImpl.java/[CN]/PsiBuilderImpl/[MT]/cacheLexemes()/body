{
  int approxLexCount=Math.max(10,myText.length() / 5);
  myLexStarts=new int[approxLexCount];
  myLexTypes=new IElementType[approxLexCount];
  myLexer.start(myText);
  int i=0;
  int offset=0;
  while (true) {
    ProgressIndicatorProvider.checkCanceled();
    IElementType type=myLexer.getTokenType();
    if (type == null)     break;
    if (i >= myLexTypes.length - 1) {
      resizeLexemes(i * 3 / 2);
    }
    int tokenStart=myLexer.getTokenStart();
    if (tokenStart < offset) {
      LOG.error("Token sequence broken: '" + myLexer.getTokenText() + "'");
    }
    myLexStarts[i]=offset=tokenStart;
    myLexTypes[i]=type;
    i++;
    myLexer.advance();
  }
  myLexStarts[i]=myText.length();
  myLexemeCount=i;
}
