{
  final VirtualFile f=createFile("f.txt");
  setContent(f,"file");
  setDocumentTextFor(f,"doc1");
  CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
    public void run(){
      LocalHistoryAction a=LocalHistory.getInstance().startAction("action");
      setDocumentTextFor(f,"doc2");
      a.finish();
    }
  }
,"command",null);
  List<Revision> rr=getRevisionsFor(f);
  assertEquals(4,rr.size());
  assertEquals("command",rr.get(0).getChangeSetName());
  assertContent("doc2",rr.get(0).getEntry());
  assertContent("doc1",rr.get(1).getEntry());
  assertContent("file",rr.get(2).getEntry());
  assertContent("",rr.get(3).getEntry());
}
