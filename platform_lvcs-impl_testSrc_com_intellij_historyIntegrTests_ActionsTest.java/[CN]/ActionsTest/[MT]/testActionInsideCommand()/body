{
  final VirtualFile f=createFile("f.txt");
  setContent(f,"file");
  setDocumentTextFor(f,"doc1");
  CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
    public void run(){
      LocalHistoryAction a=LocalHistory.getInstance().startAction("action");
      setDocumentTextFor(f,"doc2");
      a.finish();
    }
  }
,"command",null);
  List<Revision> rr=getRevisionsFor(f);
  assertEquals(5,rr.size());
  assertContent("doc2",rr.get(0).findEntry());
  assertEquals("command",rr.get(1).getChangeSetName());
  assertContent("doc1",rr.get(1).findEntry());
  assertContent("file",rr.get(2).findEntry());
  assertContent("",rr.get(3).findEntry());
}
