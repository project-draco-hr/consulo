{
  if (insertedElement == null)   return "";
  final String text=insertedElement.getText();
  final ProgressIndicator indicator=ProgressManager.getInstance().getProgressIndicator();
  if (indicator != null)   indicator.checkCanceled();
  final int offsetInElement=offset - insertedElement.getTextRange().getStartOffset();
  int start=offsetInElement - 1;
  while (start >= 0) {
    if (!idPart.accepts(text.charAt(start)))     break;
    --start;
  }
  while (start + 1 < offsetInElement && !idStart.accepts(text.charAt(start + 1))) {
    start++;
  }
  return text.substring(start + 1,offsetInElement).trim();
}
