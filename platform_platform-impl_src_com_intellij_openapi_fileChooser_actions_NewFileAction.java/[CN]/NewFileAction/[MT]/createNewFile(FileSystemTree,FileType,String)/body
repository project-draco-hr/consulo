{
  final VirtualFile file=fileSystemTree.getNewFileParent();
  if (file == null || !file.isDirectory())   return;
  String newFileName;
  while (true) {
    newFileName=Messages.showInputDialog(UIBundle.message("create.new.file.enter.new.file.name.prompt.text"),UIBundle.message("new.file.dialog.title"),Messages.getQuestionIcon());
    if (newFileName == null) {
      return;
    }
    if ("".equals(newFileName.trim())) {
      Messages.showMessageDialog(UIBundle.message("create.new.file.file.name.cannot.be.empty.error.message"),UIBundle.message("error.dialog.title"),Messages.getErrorIcon());
      continue;
    }
    Exception failReason=((FileSystemTreeImpl)fileSystemTree).createNewFile(file,newFileName,fileType,initialContent);
    if (failReason != null) {
      Messages.showMessageDialog(UIBundle.message("create.new.file.could.not.create.file.error.message",newFileName),UIBundle.message("error.dialog.title"),Messages.getErrorIcon());
      continue;
    }
    return;
  }
}
