{
  final StringBuffer buf=new StringBuffer();
  final Runnable action=new Runnable(){
    public void run(){
      getComposer().compose(buf,refElement,descriptor);
    }
  }
;
  ApplicationManager.getApplication().runReadAction(action);
  uppercaseFirstLetter(buf);
  insertHeaderFooter(buf);
  return buf.toString();
}
