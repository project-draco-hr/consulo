{
  DataContext dataContext=e.getDataContext();
  IdeView view=LangDataKeys.IDE_VIEW.getData(dataContext);
  if (view == null) {
    return;
  }
  Project project=PlatformDataKeys.PROJECT.getData(dataContext);
  PsiDirectory dir=getTargetDirectory(dataContext,view);
  if (dir == null)   return;
  FileTemplate selectedTemplate=getTemplate(project,dir);
  if (selectedTemplate != null) {
    AnAction action=getReplacedAction(selectedTemplate);
    if (action != null) {
      action.actionPerformed(e);
    }
 else {
      FileTemplateManager.getInstance().addRecentName(selectedTemplate.getName());
      PsiElement createdElement=new CreateFromTemplateDialog(project,dir,selectedTemplate,getAttributesDefaults()).create();
      if (createdElement != null) {
        view.selectElement(createdElement);
      }
    }
  }
}
