{
  super(new BorderLayout());
  myElements=new PsiElement[elements.length];
  myIndex=0;
  FileDescriptor[] files=new FileDescriptor[myElements.length];
  for (int i=0; i < elements.length; i++) {
    myElements[i]=elements[i].getNavigationElement();
    files[i]=new FileDescriptor(myElements[i].getContainingFile().getVirtualFile());
  }
  final Project project=myElements[0].getProject();
  EditorFactory factory=EditorFactory.getInstance();
  Document doc=factory.createDocument("");
  doc.setReadOnly(true);
  myEditor=factory.createEditor(doc,project);
  EditorHighlighter highlighter=HighlighterFactory.createHighlighter(project,myElements[0].getContainingFile().getName());
  ((EditorEx)myEditor).setHighlighter(highlighter);
  ((EditorEx)myEditor).setBackgroundColor(EditorFragmentComponent.getBackgroundColor(myEditor));
  myEditor.getSettings().setAdditionalLinesCount(1);
  myEditor.getSettings().setAdditionalColumnsCount(1);
  myEditor.getSettings().setLineMarkerAreaShown(false);
  myEditor.getSettings().setLineNumbersShown(false);
  myEditor.getSettings().setFoldingOutlineShown(false);
  myBinarySwitch=new CardLayout();
  myViewingPanel=new JPanel(myBinarySwitch);
  myViewingPanel.add(myEditor.getComponent(),"Text");
  myBinaryPanel=new JPanel(new BorderLayout());
  myViewingPanel.add(myBinaryPanel,"Binary");
  add(myViewingPanel,BorderLayout.CENTER);
  final ActionToolbar toolbar=createToolbar();
  myLocationLabel=new JLabel();
  myCountLabel=new JLabel();
  JPanel header=new JPanel(new BorderLayout());
  header.setBorder(BorderFactory.createEmptyBorder(5,5,5,5));
  JPanel toolbarPanel=new JPanel(new FlowLayout());
  toolbarPanel.add(toolbar.getComponent());
  if (myElements.length > 1) {
    myFileChooser=new JComboBox(files);
    myFileChooser.setRenderer(new DefaultListCellRenderer(){
      public Component getListCellRendererComponent(      JList list,      Object value,      int index,      boolean isSelected,      boolean cellHasFocus){
        super.getListCellRendererComponent(list,value,index,isSelected,cellHasFocus);
        VirtualFile file=((FileDescriptor)value).myFile;
        setIcon(file.getIcon());
        setForeground(FileStatusManager.getInstance(project).getStatus(file).getColor());
        setText(file.getPresentableName());
        return this;
      }
    }
);
    myFileChooser.addActionListener(new ActionListener(){
      public void actionPerformed(      ActionEvent e){
        int index=myFileChooser.getSelectedIndex();
        if (myIndex != index) {
          myIndex=index;
          updateControls();
        }
      }
    }
);
    toolbarPanel.add(myFileChooser);
    toolbarPanel.add(myCountLabel);
  }
 else {
    final JLabel label=new JLabel();
    VirtualFile file=myElements[0].getContainingFile().getVirtualFile();
    label.setIcon(file.getIcon());
    label.setForeground(FileStatusManager.getInstance(project).getStatus(file).getColor());
    label.setText(file.getPresentableName());
    label.setBorder(new CompoundBorder(IdeBorderFactory.createBorder(),IdeBorderFactory.createEmptyBorder(0,0,0,5)));
    toolbarPanel.add(label);
  }
  header.add(toolbarPanel,BorderLayout.WEST);
  header.add(myLocationLabel,BorderLayout.EAST);
  add(header,BorderLayout.NORTH);
  setPreferredSize(new Dimension(600,400));
  updateControls();
  SwingUtilities.invokeLater(new Runnable(){
    public void run(){
      if (myFileChooser != null) {
        myFileChooser.requestFocusInWindow();
      }
 else {
        myViewingPanel.requestFocusInWindow();
      }
    }
  }
);
}
