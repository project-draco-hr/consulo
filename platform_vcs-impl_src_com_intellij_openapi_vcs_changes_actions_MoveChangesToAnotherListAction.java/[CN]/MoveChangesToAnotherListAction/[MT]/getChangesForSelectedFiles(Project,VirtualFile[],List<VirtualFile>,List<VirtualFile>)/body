{
  List<Change> changes=new ArrayList<>();
  ChangeListManager changeListManager=ChangeListManager.getInstance(project);
  for (  VirtualFile vFile : selectedFiles) {
    Change change=changeListManager.getChange(vFile);
    if (change == null) {
      FileStatus status=changeListManager.getStatus(vFile);
      if (FileStatus.UNKNOWN.equals(status)) {
        unversionedFiles.add(vFile);
        changedFiles.add(vFile);
      }
 else       if (FileStatus.NOT_CHANGED.equals(status) && vFile.isDirectory()) {
        addAllChangesUnderPath(changeListManager,VcsUtil.getFilePath(vFile),changes,changedFiles);
      }
    }
 else {
      FilePath afterPath=ChangesUtil.getAfterPath(change);
      if (afterPath != null && afterPath.isDirectory()) {
        addAllChangesUnderPath(changeListManager,afterPath,changes,changedFiles);
      }
 else {
        changes.add(change);
        changedFiles.add(vFile);
      }
    }
  }
  return changes;
}
