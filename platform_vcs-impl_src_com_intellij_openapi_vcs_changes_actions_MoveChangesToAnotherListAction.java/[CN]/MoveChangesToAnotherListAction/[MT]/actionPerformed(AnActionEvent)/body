{
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  if (project == null)   return;
  Change[] changes=e.getData(VcsDataKeys.CHANGES);
  List<VirtualFile> unversionedFiles=e.getData(ChangesListView.UNVERSIONED_FILES_DATA_KEY);
  final List<VirtualFile> changedFiles=new ArrayList<VirtualFile>();
  boolean activateChangesView=false;
  unversionedFiles=new ArrayList<VirtualFile>();
  final List<Change> changesList=new ArrayList<Change>();
  if (changes != null) {
    changesList.addAll(Arrays.asList(changes));
  }
 else {
    changes=new Change[0];
  }
  changesList.addAll(getChangesForSelectedFiles(project,unversionedFiles,changedFiles,e));
  activateChangesView=true;
  if (changesList.isEmpty() && unversionedFiles.isEmpty()) {
    VcsBalloonProblemNotifier.showOverChangesView(project,"Nothing is selected that can be moved",MessageType.INFO);
    return;
  }
  if (!askAndMove(project,changesList,unversionedFiles))   return;
  if (activateChangesView) {
    ToolWindow window=ToolWindowManager.getInstance(project).getToolWindow(ChangesViewContentManager.TOOLWINDOW_ID);
    if (!window.isVisible()) {
      window.activate(new Runnable(){
        public void run(){
          if (changedFiles.size() > 0) {
            ChangesViewManager.getInstance(project).selectFile(changedFiles.get(0));
          }
        }
      }
);
    }
  }
}
