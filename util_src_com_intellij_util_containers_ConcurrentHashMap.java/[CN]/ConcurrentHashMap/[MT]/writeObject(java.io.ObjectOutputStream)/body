{
  s.defaultWriteObject();
  for (int k=0; k < segments.length; ++k) {
    Segment seg=segments[k];
    seg.lock();
    try {
      HashEntry[] tab=seg.table;
      for (int i=0; i < tab.length; ++i) {
        for (HashEntry<K,V> e=(HashEntry<K,V>)tab[i]; e != null; e=e.next) {
          s.writeObject(e.key);
          s.writeObject(e.value);
        }
      }
    }
  finally {
      seg.unlock();
    }
  }
  s.writeObject(null);
  s.writeObject(null);
}
