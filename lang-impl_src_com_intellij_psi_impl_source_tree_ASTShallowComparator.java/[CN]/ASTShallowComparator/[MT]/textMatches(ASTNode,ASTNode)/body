{
  if (TreeUtil.isCollapsedChameleon(oldNode)) {
    return ((TreeElement)newNode).textMatches(oldNode.getText()) ? ThreeState.YES : ThreeState.UNSURE;
  }
  if (TreeUtil.isCollapsedChameleon(newNode)) {
    return ((TreeElement)oldNode).textMatches(newNode.getText()) ? ThreeState.YES : ThreeState.UNSURE;
  }
  if (oldNode instanceof LeafElement) {
    if (newNode instanceof LeafElement)     return ((LeafElement)oldNode).textMatches(newNode.getChars()) ? ThreeState.YES : ThreeState.NO;
    return ((LeafElement)oldNode).textMatches(newNode.getText()) ? ThreeState.YES : ThreeState.NO;
  }
  if (oldNode instanceof PsiErrorElement && newNode instanceof PsiErrorElement) {
    final PsiErrorElement e1=((PsiErrorElement)oldNode);
    final PsiErrorElement e2=((PsiErrorElement)newNode);
    if (!Comparing.equal(e1.getErrorDescription(),e2.getErrorDescription()))     return ThreeState.NO;
  }
  return ThreeState.UNSURE;
}
