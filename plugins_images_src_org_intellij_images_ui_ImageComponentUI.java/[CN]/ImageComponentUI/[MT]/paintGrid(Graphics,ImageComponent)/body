{
  Dimension size=ic.getSize();
  BufferedImage image=ic.getDocument().getValue();
  int canvasWidth=image.getWidth();
  int canvasHeight=image.getHeight();
  double zoomX=(double)size.width / (double)canvasWidth;
  double zoomY=(double)size.height / (double)canvasHeight;
  double zoomFactor=(zoomX + zoomY) / 2.0d;
  if (zoomFactor >= ic.getGridLineZoomFactor()) {
    g.setColor(ic.getGridLineColor());
    int ls=ic.getGridLineSpan();
    for (int dx=ls; dx < canvasWidth; dx+=ls) {
      g.drawLine((int)((double)dx * zoomX),0,(int)((double)dx * zoomX),size.height);
    }
    for (int dy=ls; dy < canvasHeight; dy+=ls) {
      g.drawLine(0,(int)((double)dy * zoomY),size.width,(int)((double)dy * zoomY));
    }
  }
}
