{
synchronized (PsiLock.LOCK) {
    if (element instanceof LeafElement) {
      final LeafElement leaf=(LeafElement)element;
      return leaf.textMatches(buffer,startOffset);
    }
 else {
      int curOffset=startOffset;
      for (ASTNode child=element.getFirstChildNode(); child != null; child=child.getTreeNext()) {
        curOffset=textMatches(child,buffer,curOffset,endOffset);
        if (curOffset == -1)         return -1;
      }
      return curOffset;
    }
  }
}
