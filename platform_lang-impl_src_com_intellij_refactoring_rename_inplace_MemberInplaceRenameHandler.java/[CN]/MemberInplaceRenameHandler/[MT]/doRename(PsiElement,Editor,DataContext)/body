{
  if (elementToRename instanceof PsiNameIdentifierOwner) {
    final RenamePsiElementProcessor processor=RenamePsiElementProcessor.forElement(elementToRename);
    if (processor.isInplaceRenameSupported()) {
      processor.substituteElementToRename(elementToRename,editor,new Pass<PsiElement>(){
        @Override public void pass(        PsiElement element){
          final MemberInplaceRenamer renamer=new MemberInplaceRenamer((PsiNameIdentifierOwner)elementToRename,element,editor);
          boolean startedRename=renamer.performInplaceRename();
          if (!startedRename) {
            performDialogRename(elementToRename,editor,dataContext);
          }
        }
      }
);
      return null;
    }
  }
  performDialogRename(elementToRename,editor,dataContext);
  return null;
}
