{
  if (elementToRename instanceof PsiNameIdentifierOwner) {
    RenamePsiElementProcessor.forElement(elementToRename).substituteElementToRename(elementToRename,editor,new Pass<PsiElement>(){
      @Override public void pass(      PsiElement element){
        final MemberInplaceRenamer renamer=new MemberInplaceRenamer((PsiNameIdentifierOwner)elementToRename,element,editor);
        boolean startedRename=renamer.performInplaceRename();
        if (!startedRename) {
          performDialogRename(elementToRename,editor,dataContext);
        }
      }
    }
);
  }
 else {
    performDialogRename(elementToRename,editor,dataContext);
  }
  return null;
}
