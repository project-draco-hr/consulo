{
  if (!isPhysical()) {
    final PsiElement root=findIncludedRoot();
    if (root != null) {
      final PsiAnchor anchor=root.getUserData(XmlUtil.ORIGINAL_ELEMENT);
      if (anchor != null) {
        final PsiElement original=anchor.retrieve();
        if (original != null) {
          final int endOffset=getTextRange().getEndOffset() + original.getTextRange().getStartOffset();
          PsiElement candidate=original.findElementAt(getTextRange().getStartOffset() - root.getTextRange().getStartOffset());
          while (candidate != null && candidate.getStartOffsetInParent() == 0 && candidate.getTextRange().getEndOffset() < endOffset) {
            candidate=candidate.getParent();
          }
          if (candidate != null && candidate.getTextRange().getEndOffset() == endOffset) {
            return candidate.getNavigationElement();
          }
        }
      }
    }
    final XmlElement including=getUserData(INCLUDING_ELEMENT);
    return including != null ? including : getAstParent().getNavigationElement();
  }
  return super.getNavigationElement();
}
