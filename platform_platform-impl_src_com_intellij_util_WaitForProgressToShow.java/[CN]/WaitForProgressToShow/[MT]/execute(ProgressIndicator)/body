{
  if ((pi.isModal() || (pi instanceof BackgroundableProcessIndicator && !((BackgroundableProcessIndicator)pi).isBackgrounded())) && pi instanceof ProgressWindow) {
    final long maxWait=3000;
    final long start=System.currentTimeMillis();
    while ((!((ProgressWindow)pi).isPopupWasShown()) && (pi.isRunning()) && (System.currentTimeMillis() - maxWait < start)) {
      final Object lock=new Object();
synchronized (lock) {
        try {
          lock.wait(100);
        }
 catch (        InterruptedException e) {
        }
      }
    }
    ProgressManager.checkCanceled();
  }
}
