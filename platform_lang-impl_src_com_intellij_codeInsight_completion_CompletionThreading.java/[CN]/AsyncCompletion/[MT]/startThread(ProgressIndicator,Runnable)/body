{
  final Semaphore startSemaphore=new Semaphore();
  startSemaphore.down();
  Future<?> future=ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    @Override public void run(){
      ProgressManager.getInstance().runProcess(new Runnable(){
        @Override public void run(){
          try {
            ApplicationManager.getApplication().runReadAction(new Runnable(){
              @Override public void run(){
                startSemaphore.up();
                ProgressManager.checkCanceled();
                runnable.run();
              }
            }
);
          }
 catch (          ProcessCanceledException ignored) {
          }
        }
      }
,progressIndicator);
    }
  }
);
  startSemaphore.waitFor();
  return future;
}
