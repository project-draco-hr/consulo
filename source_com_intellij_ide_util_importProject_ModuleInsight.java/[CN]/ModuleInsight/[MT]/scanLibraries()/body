{
  myProgress.pushState();
  try {
    try {
      for (      File root : myContentRoots) {
        myProgress.setText("Scanning for libraries " + root.getPath());
        scanRootForLibraries(root);
      }
    }
 catch (    ProcessCanceledException ignored) {
    }
    myProgress.setText("Building initial libraries layout...");
    final List<LibraryDescriptor> libraries=buildInitialLibrariesLayout(myJarToPackagesMap.keySet());
    for (    LibraryDescriptor library : libraries) {
      final Collection<File> libJars=library.getJars();
      final boolean renameLib=libJars.size() == 1;
      for (      File jar : libJars) {
        if (renameLib) {
          library.setName(jar.getName());
        }
      }
    }
    myLibraries=libraries;
  }
  finally {
    myProgress.popState();
  }
}
