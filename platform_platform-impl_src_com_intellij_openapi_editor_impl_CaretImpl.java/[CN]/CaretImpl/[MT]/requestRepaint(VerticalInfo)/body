{
  int lineHeight=myEditor.getLineHeight();
  Rectangle visibleArea=myEditor.getScrollingModel().getVisibleArea();
  final EditorGutterComponentEx gutter=myEditor.getGutterComponentEx();
  final EditorComponentImpl content=myEditor.getContentComponent();
  int updateWidth=myEditor.getScrollPane().getHorizontalScrollBar().getValue() + visibleArea.width;
  if (Math.abs(myCaretInfo.y - oldCaretInfo.y) <= 2 * lineHeight) {
    int minY=Math.min(oldCaretInfo.y,myCaretInfo.y);
    int maxY=Math.max(oldCaretInfo.y + oldCaretInfo.height,myCaretInfo.y + myCaretInfo.height);
    content.repaintEditorComponent(0,minY,updateWidth,maxY - minY);
    gutter.repaint(0,minY,gutter.getWidth(),maxY - minY);
  }
 else {
    content.repaintEditorComponent(0,oldCaretInfo.y,updateWidth,oldCaretInfo.height + lineHeight);
    gutter.repaint(0,oldCaretInfo.y,updateWidth,oldCaretInfo.height + lineHeight);
    content.repaintEditorComponent(0,myCaretInfo.y,updateWidth,myCaretInfo.height + lineHeight);
    gutter.repaint(0,myCaretInfo.y,updateWidth,myCaretInfo.height + lineHeight);
  }
}
