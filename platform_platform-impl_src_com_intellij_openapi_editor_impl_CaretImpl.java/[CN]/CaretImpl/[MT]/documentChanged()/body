{
  MyRangeMarker marker=mySelectionMarker;
  if (marker != null) {
    int endAfter;
    int startAfter;
    if (marker.isValid()) {
      startAfter=marker.getStartOffset();
      endAfter=marker.getEndOffset();
    }
 else {
      startAfter=endAfter=getOffset();
      marker.release();
      mySelectionMarker=null;
    }
    if (startBefore != startAfter || endBefore != endAfter) {
      myEditor.getSelectionModel().fireSelectionChanged(startBefore,endBefore,startAfter,endAfter);
    }
  }
}
