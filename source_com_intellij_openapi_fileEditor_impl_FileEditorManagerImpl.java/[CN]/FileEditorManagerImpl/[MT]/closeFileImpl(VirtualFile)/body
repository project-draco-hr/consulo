{
  if (file == null) {
    throw new IllegalArgumentException("file cannot be null");
  }
  FileEditorManagerImpl.assertThread();
  ++getSplitters().myInsideChange;
  try {
    final EditorWindow[] windows=getSplitters().findWindows(file);
    if (windows != null) {
      final VirtualFile nextFile=findNextFile(file);
      for (int i=0; i < windows.length; i++) {
        final EditorWindow window=windows[i];
        LOG.assertTrue(window.getSelectedEditor() != null);
        final EditorWithProviderComposite oldComposite=window.findFileComposite(file);
        if (oldComposite != null) {
          window.removeEditor(oldComposite);
        }
        if (nextFile != null) {
          if (window.getTabCount() == 0) {
            EditorWithProviderComposite newComposite=window.findFileComposite(nextFile);
            if (newComposite == null) {
              newComposite=newEditorComposite(nextFile,true,null);
            }
            window.setEditor(newComposite);
          }
        }
      }
    }
    fireFileClosed(file);
  }
  finally {
    --getSplitters().myInsideChange;
  }
}
