{
  if (file instanceof PsiBinaryFile)   return null;
  Document document=getCachedDocument(file);
  if (document != null) {
    if (!file.getViewProvider().isPhysical() && document.getUserData(HARD_REF_TO_PSI) == null) {
      cachePsi(document,file);
    }
    return document;
  }
  if (!file.getViewProvider().isEventSystemEnabled())   return null;
  document=FileDocumentManager.getInstance().getDocument(file.getViewProvider().getVirtualFile());
  if (!file.getViewProvider().isPhysical()) {
    cachePsi(document,file);
  }
  fireDocumentCreated(document,file);
  return document;
}
