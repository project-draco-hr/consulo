{
  final Document document=doc instanceof DocumentWindow ? ((DocumentWindow)doc).getDelegate() : doc;
  if (isUncommited(document)) {
    addRunOnCommit(document,action);
  }
 else {
    action.run();
  }
}
