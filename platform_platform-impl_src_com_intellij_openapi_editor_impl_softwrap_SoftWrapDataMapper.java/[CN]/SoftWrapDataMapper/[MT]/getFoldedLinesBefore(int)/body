{
  Document document=myEditor.getDocument();
  int line=document.getLineNumber(offset);
  int lineStartOffset=document.getLineStartOffset(line);
  int result=0;
  for (  FoldRegion foldRegion : myEditor.getFoldingModel().getAllFoldRegions()) {
    if (foldRegion.getStartOffset() >= lineStartOffset) {
      break;
    }
    if (foldRegion.isExpanded() || !foldRegion.isValid()) {
      continue;
    }
    int foldingStartLine=document.getLineNumber(foldRegion.getStartOffset());
    int foldingEndLine=document.getLineNumber(foldRegion.getEndOffset());
    result+=Math.min(line,foldingEndLine) - foldingStartLine;
  }
  return result;
}
