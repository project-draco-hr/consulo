{
  int result=0;
  List<? extends TextChange> softWraps=myStorage.getSoftWraps();
  int index=myStorage.getSoftWrapIndex(offset);
  if (index < 0) {
    index=-index - 1;
  }
  int max=Math.min(index,softWraps.size());
  for (int j=0; j < max; j++) {
    TextChange softWrap=softWraps.get(j);
    if (isVisible(softWrap)) {
      result+=StringUtil.countNewLines(softWrap.getText());
    }
  }
  return result;
}
