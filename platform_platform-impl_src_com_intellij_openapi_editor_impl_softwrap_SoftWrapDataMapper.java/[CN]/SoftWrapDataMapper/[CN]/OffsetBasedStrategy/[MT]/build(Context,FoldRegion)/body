{
  int startLine=myDocument.getLineNumber(region.getStartOffset());
  int endLine=myDocument.getLineNumber(myOffset);
  int lineFeeds=endLine - startLine;
  if (lineFeeds > 0) {
    context.logicalLine+=lineFeeds;
    context.foldedLines+=lineFeeds;
    context.onNewLine();
    int i=CharArrayUtil.shiftBackwardUntil(myDocument.getCharsSequence(),myOffset - 1,"\n");
    context.logicalColumn=myRepresentationHelper.toVisualColumnSymbolsNumber(myDocument.getCharsSequence(),i + 1,myOffset,0);
    context.foldingColumnDiff=context.visualColumn - context.logicalColumn;
  }
 else {
    int logicalColumns=myRepresentationHelper.toVisualColumnSymbolsNumber(myDocument.getCharsSequence(),region.getStartOffset(),myOffset,context.x);
    context.logicalColumn+=logicalColumns;
    context.foldingColumnDiff-=logicalColumns;
  }
  return context.build();
}
