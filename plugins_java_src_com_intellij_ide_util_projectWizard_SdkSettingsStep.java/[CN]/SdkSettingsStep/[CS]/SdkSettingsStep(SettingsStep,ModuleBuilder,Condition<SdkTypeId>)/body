{
  myModuleBuilder=moduleBuilder;
  myWizardContext=settingsStep.getContext();
  myModel=new ProjectSdksModel();
  Project project=myWizardContext.getProject();
  myModel.reset(project);
  mySdkComboBox=new SdkComboBox(myModel,sdkFilter,false);
  final PropertiesComponent component=project == null ? PropertiesComponent.getInstance() : PropertiesComponent.getInstance(project);
  final String selectedJdkProperty="jdk.selected";
  mySdkComboBox.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      Sdk jdk=mySdkComboBox.getSelectedSdk();
      if (jdk != null) {
        component.setValue(selectedJdkProperty,jdk.getName());
      }
    }
  }
);
  if (project != null) {
    Sdk sdk=ProjectRootManager.getInstance(project).getProjectSdk();
    if (sdk != null && moduleBuilder.isSuitableSdkType(sdk.getSdkType())) {
      return;
    }
  }
 else {
    Project defaultProject=ProjectManager.getInstance().getDefaultProject();
    Sdk sdk=ProjectRootManager.getInstance(defaultProject).getProjectSdk();
    if (sdk != null && sdkFilter.value(sdk.getSdkType())) {
      mySdkComboBox.setSelectedSdk(sdk);
    }
  }
  String value=component.getValue(selectedJdkProperty);
  if (value != null) {
    Sdk jdk=ProjectSdkTable.getInstance().findSdk(value);
    if (jdk != null) {
      mySdkComboBox.setSelectedSdk(jdk);
    }
  }
  JButton button=new JButton("Ne\u001Bw...");
  mySdkComboBox.setSetupButton(button,project,myModel,project == null ? new SdkComboBox.NoneSdkComboBoxItem() : new SdkComboBox.ProjectSdkComboBoxItem(),null,false);
  JPanel jdkPanel=new JPanel(new BorderLayout(4,0));
  jdkPanel.add(mySdkComboBox);
  jdkPanel.add(button,BorderLayout.EAST);
  settingsStep.addSettingsField((project == null ? "Project" : "Module") + " \u001BSDK:",jdkPanel);
}
