{
  if (!(value.getParent() instanceof XmlAttribute))   return;
  XmlAttribute attribute=(XmlAttribute)value.getParent();
  XmlTag tag=attribute.getParent();
  final XmlElementDescriptor elementDescriptor=tag.getDescriptor();
  if (elementDescriptor == null)   return;
  final XmlAttributeDescriptor attributeDescriptor=elementDescriptor.getAttributeDescriptor(attribute);
  if (attributeDescriptor == null)   return;
  String error=attributeDescriptor.validateValue(value,attribute.getValue());
  if (error != null) {
    myResult.add(HighlightInfo.createHighlightInfo(getTagProblemInfoType(tag),value,error));
    return;
  }
  if (myRefCountHolder != null && attributeDescriptor.hasIdType()) {
    String unquotedValue=getUnquotedValue(value,tag);
    final XmlTag xmlTag=myRefCountHolder.getTagById(unquotedValue);
    if (xmlTag == null || !xmlTag.isValid() || xmlTag == tag) {
      myRefCountHolder.registerTagWithId(unquotedValue,tag);
    }
 else {
      XmlAttribute anotherTagIdValue=xmlTag.getAttribute("id",null);
      if (anotherTagIdValue != null && getUnquotedValue(anotherTagIdValue.getValueElement(),xmlTag).equals(unquotedValue)) {
        myResult.add(HighlightInfo.createHighlightInfo(HighlightInfoType.WRONG_REF,value,"Duplicate id reference"));
        myResult.add(HighlightInfo.createHighlightInfo(HighlightInfoType.WRONG_REF,xmlTag.getAttribute("id",null).getValueElement(),"Duplicate id reference"));
        return;
      }
 else {
        myRefCountHolder.registerTagWithId(unquotedValue,tag);
      }
    }
  }
  QuickFixProvider quickFixProvider=QuickFixProvider.NULL;
  if (attributeDescriptor instanceof QuickFixProvider)   quickFixProvider=(QuickFixProvider)attributeDescriptor;
  checkReferences(value,quickFixProvider);
}
