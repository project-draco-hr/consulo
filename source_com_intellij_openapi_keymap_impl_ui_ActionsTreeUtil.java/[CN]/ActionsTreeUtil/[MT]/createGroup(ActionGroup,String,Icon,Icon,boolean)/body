{
  ActionManager actionManager=ActionManager.getInstance();
  Group group=new Group(groupName,actionManager.getId(actionGroup),icon,openIcon);
  AnAction[] children=actionGroup.getChildren(null);
  for (int i=0; i < children.length; i++) {
    AnAction action=children[i];
    if (action instanceof ActionGroup) {
      if (action instanceof DefaultActionGroup || action instanceof ToolWindowsGroup || action instanceof SimpleActionGroup) {
        Group subGroup=createGroup((ActionGroup)action,ignore);
        if (subGroup.getSize() > 0) {
          if (!ignore && !((ActionGroup)action).isPopup()) {
            group.addAll(subGroup);
          }
 else {
            group.addGroup(subGroup);
          }
        }
 else {
          group.addGroup(subGroup);
        }
      }
    }
 else     if (action instanceof Separator) {
      if (group.getSize() > 0 && i < children.length - 1 && !(group.getChildren().get(group.getSize() - 1) instanceof Separator)) {
        group.addSeparator();
      }
    }
 else {
      String id=actionManager.getId(action);
      if (id != null) {
        if (id.startsWith(TargetAction.ACTION_ID_PREFIX))         continue;
        if (id.startsWith(Tool.ACTION_ID_PREFIX))         continue;
        group.addActionId(id);
      }
    }
  }
  group.normalizeSeparators();
  return group;
}
