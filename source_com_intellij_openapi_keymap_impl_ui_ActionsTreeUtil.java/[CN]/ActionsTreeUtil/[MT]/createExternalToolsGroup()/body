{
  String[] ids=ActionManagerEx.getInstanceEx().getActionIds(Tool.ACTION_ID_PREFIX);
  Arrays.sort(ids);
  Group group=new Group(KeyMapBundle.message("actions.tree.external.tools.group"),TOOLS_ICON,TOOLS_OPEN_ICON);
  ToolManager toolManager=ToolManager.getInstance();
  com.intellij.util.containers.HashMap toolGroupNameToGroup=new com.intellij.util.containers.HashMap();
  for (int i=0; i < ids.length; i++) {
    String id=ids[i];
    String groupName=toolManager.getGroupByActionId(id);
    if (groupName != null && groupName.trim().length() == 0) {
      groupName=null;
    }
    Group subGroup=(Group)toolGroupNameToGroup.get(groupName);
    if (subGroup == null) {
      subGroup=new Group(groupName,null,null);
      toolGroupNameToGroup.put(groupName,subGroup);
      if (groupName != null) {
        group.addGroup(subGroup);
      }
    }
    subGroup.addActionId(id);
  }
  Group subGroup=(Group)toolGroupNameToGroup.get(null);
  if (subGroup != null) {
    group.addAll(subGroup);
  }
  return group;
}
