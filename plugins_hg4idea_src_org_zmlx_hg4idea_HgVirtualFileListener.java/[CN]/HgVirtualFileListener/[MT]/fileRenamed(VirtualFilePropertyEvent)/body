{
  String oldName=(String)event.getOldValue();
  VirtualFile oldParent=event.getParent();
  FilePath oldPath=VcsUtil.getFilePath(new File(new File(oldParent.getPath()),oldName));
  VirtualFile oldRepo=VcsUtil.getVcsRootFor(project,oldPath);
  boolean oldFileProcessable=oldRepo != null && VcsUtil.isFileForVcs(oldPath,project,vcs) && isFileProcessable(oldPath);
  VirtualFile newFile=event.getFile();
  FilePath newPath=getFilePath(newFile);
  VirtualFile newRepo=VcsUtil.getVcsRootFor(project,newFile);
  boolean newFileProcessable=newRepo != null && VcsUtil.isFileForVcs(newFile,project,vcs) && isFileProcessable(newFile);
  if (newFileProcessable && oldFileProcessable && oldRepo.equals(newRepo)) {
    renameFile(newRepo,oldPath,newPath);
  }
 else {
    if (oldFileProcessable) {
      deleteFile(oldRepo,oldPath,false);
    }
    if (newFileProcessable) {
      addFile(newRepo,newPath,false);
    }
  }
  markDirty(oldPath);
  markDirty(newPath);
}
