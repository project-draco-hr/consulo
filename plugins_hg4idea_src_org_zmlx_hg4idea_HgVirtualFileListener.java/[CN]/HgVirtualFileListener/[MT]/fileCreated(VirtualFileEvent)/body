{
  if (event.isFromRefresh()) {
    return;
  }
  final VirtualFile file=event.getFile();
  if (!VcsUtil.isFileForVcs(file,project,vcs)) {
    return;
  }
  if (!isFileProcessable(file) || file.isDirectory()) {
    return;
  }
  String title=HgVcsMessages.message("hg4idea.add.confirmation.title");
  String message=HgVcsMessages.message("hg4idea.add.confirmation.body",file.getPath());
  VcsShowConfirmationOption option=ProjectLevelVcsManager.getInstance(project).getStandardConfirmation(VcsConfiguration.StandardConfirmation.ADD,vcs);
  boolean processAdd=false;
  if (DO_ACTION_SILENTLY == option.getValue()) {
    processAdd=true;
  }
 else   if (SHOW_CONFIRMATION == option.getValue()) {
    AbstractVcsHelper helper=AbstractVcsHelper.getInstance(project);
    processAdd=null != helper.selectFilesToProcess(Arrays.asList(file),title,null,title,message,option);
  }
  VirtualFile repo=VcsUtil.getVcsRootFor(project,file);
  if (processAdd && repo != null) {
    new HgAddCommand(project).execute(new HgFile(repo,new File(file.getPath())));
  }
}
