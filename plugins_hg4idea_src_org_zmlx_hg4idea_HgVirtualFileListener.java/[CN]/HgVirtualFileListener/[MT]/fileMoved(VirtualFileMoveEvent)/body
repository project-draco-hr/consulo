{
  VirtualFile oldParent=event.getOldParent();
  String fileName=event.getFileName();
  FilePath oldPath=VcsUtil.getFilePath(new File(new File(oldParent.getPath()),fileName));
  VirtualFile oldRepo=VcsUtil.getVcsRootFor(project,oldPath);
  boolean oldFileProcessable=oldRepo != null && VcsUtil.isFileForVcs(oldPath,project,vcs) && isFileProcessable(oldPath);
  VirtualFile newFile=event.getFile();
  FilePath newPath=getFilePath(newFile);
  VirtualFile newRepo=VcsUtil.getVcsRootFor(project,newFile);
  boolean newFileProcessable=newRepo != null && VcsUtil.isFileForVcs(newFile,project,vcs) && isFileProcessable(newFile);
  if (newFileProcessable && oldFileProcessable && oldRepo.equals(newRepo)) {
    moveFile(oldRepo,newRepo,oldPath,newPath);
  }
 else {
    HgFileStatusEnum oldStatus=getStatus(oldRepo,oldPath);
    boolean silent=oldStatus != HgFileStatusEnum.UNVERSIONED;
    if (oldFileProcessable) {
      deleteFile(oldRepo,oldPath,silent);
    }
    if (newFileProcessable) {
      addFile(newRepo,newPath,silent);
    }
  }
  markDirty(oldPath);
  markDirty(newPath);
}
