{
  if (event.isFromRefresh()) {
    return;
  }
  final VirtualFile file=event.getFile();
  if (!VcsUtil.isFileForVcs(file,project,vcs)) {
    return;
  }
  if (!isFileProcessable(file)) {
    return;
  }
  VirtualFile newFile=event.getFile();
  VirtualFile oldFile=event.getOriginalFile();
  VirtualFile repo=VcsUtil.getVcsRootFor(project,file);
  if (repo == null) {
    return;
  }
  HgCopyCommand command=new HgCopyCommand(project);
  HgFile source=new HgFile(repo,new File(oldFile.getPath()));
  HgFile target=new HgFile(repo,new File(newFile.getPath()));
  command.execute(source,target);
}
