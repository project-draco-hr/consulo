{
  if (event.isFromRefresh()) {
    return;
  }
  final VirtualFile newFile=event.getFile();
  FilePath newPath=getFilePath(newFile);
  VirtualFile newRepo=VcsUtil.getVcsRootFor(project,newFile);
  boolean newFileProcessable=newRepo != null && VcsUtil.isFileForVcs(newFile,project,vcs) && isFileProcessable(newFile);
  final VirtualFile oldFile=event.getOriginalFile();
  FilePath oldPath=getFilePath(oldFile);
  VirtualFile oldRepo=VcsUtil.getVcsRootFor(project,oldFile);
  boolean oldFileProcessable=oldRepo != null && VcsUtil.isFileForVcs(oldFile,project,vcs) && isFileProcessable(oldFile);
  if (newFileProcessable && oldFileProcessable && oldRepo.equals(newRepo)) {
    copyFile(newRepo,oldPath,newPath);
    markDirty(newPath);
  }
 else   if (newFileProcessable) {
    addFile(newRepo,newPath,false);
    markDirty(newPath);
  }
}
