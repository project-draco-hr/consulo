{
  if (parent instanceof PsiDirectoryNode) {
    final VirtualFile vFile=((PsiDirectoryNode)parent).getVirtualFile();
    if (vFile != null && Comparing.equal(ProjectFileIndex.SERVICE.getInstance(myProject).getContentRootForFile(vFile),vFile)) {
      final Collection<AbstractTreeNode> moduleChildren=((PsiDirectoryNode)parent).getChildren();
      Collection<AbstractTreeNode> result=new ArrayList<AbstractTreeNode>();
      for (      AbstractTreeNode moduleChild : moduleChildren) {
        if (moduleChild instanceof PsiDirectoryNode) {
          final PsiDirectory value=((PsiDirectoryNode)moduleChild).getValue();
          if (value.getName().equals(Project.DIRECTORY_STORE_FOLDER) && Registry.is("projectView.hide.dot.idea")) {
            continue;
          }
        }
        result.add(moduleChild);
      }
      return result;
    }
  }
  return children;
}
