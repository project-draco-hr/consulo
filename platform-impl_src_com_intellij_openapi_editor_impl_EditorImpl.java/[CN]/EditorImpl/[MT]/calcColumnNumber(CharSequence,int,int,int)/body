{
  IterationState state=new IterationState(this,start,false);
  int fontType=state.getMergedAttributes().getFontType();
  int column=0;
  int x=0;
  int spaceSize=EditorUtil.getSpaceWidth(fontType,this);
  for (int i=start; i < offset; i++) {
    if (i >= state.getEndOffset()) {
      state.advance();
      fontType=state.getMergedAttributes().getFontType();
    }
    char c=text.charAt(i);
    if (c == '\t') {
      int prevX=x;
      x=EditorUtil.nextTabStop(x,this);
      column+=(x - prevX) / spaceSize;
    }
 else {
      x+=EditorUtil.charWidth(c,fontType,this);
      column++;
    }
  }
  return column;
}
