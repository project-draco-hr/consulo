{
  if (isReleased) {
    LOG.error("Double release. First released at:  =====\n" + myReleasedAt + "\n======");
  }
  final ByteArrayOutputStream buffer=new ByteArrayOutputStream();
  final PrintWriter printWriter=new PrintWriter(buffer);
  new Throwable().printStackTrace(printWriter);
  myReleasedAt=buffer.toString();
  isReleased=true;
  myDocument.removeDocumentListener(myHighlighter);
  myDocument.removeDocumentListener(myEditorDocumentAdapter);
  myDocument.removeDocumentListener(myFoldingModel);
  myDocument.removeDocumentListener(myCaretModel);
  myDocument.removeDocumentListener(mySelectionModel);
  MarkupModelEx markupModel=(MarkupModelEx)myDocument.getMarkupModel(myProject,false);
  if (markupModel instanceof MarkupModelImpl) {
    markupModel.removeMarkupModelListener(myMarkupModelListener);
  }
  myMarkupModel.dispose();
  myLineHeight=-1;
  myCharHeight=-1;
  myDescent=-1;
  myPlainFontMetrics=null;
  myScrollingModel.dispose();
  myGutterComponent.dispose();
  clearCaretThread();
}
