{
  if (ourIsUnitTestMode && getUserData(DO_DOCUMENT_UPDATE_TEST) == null) {
    return new Dimension(1,1);
  }
  final Dimension draft=getSizeWithoutCaret();
  final int additionalSpace=mySettings.getAdditionalColumnsCount() * getSpaceWidth(Font.PLAIN);
  if (!myDocument.isInBulkUpdate()) {
    int caretX=visualPositionToXY(getCaretModel().getVisualPosition()).x;
    draft.width=Math.max(caretX,draft.width) + additionalSpace;
  }
 else {
    draft.width+=additionalSpace;
  }
  return draft;
}
