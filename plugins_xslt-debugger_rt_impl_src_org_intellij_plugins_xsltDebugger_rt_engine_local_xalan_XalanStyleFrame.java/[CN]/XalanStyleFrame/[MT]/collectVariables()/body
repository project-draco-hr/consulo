{
  List<Debugger.Variable> variables=new ArrayList<Debugger.Variable>();
  @SuppressWarnings({"unchecked"}) final Vector<ElemVariable> globals=myTransformer.getStylesheet().getVariablesAndParamsComposed();
  for (  ElemVariable variable : globals) {
    addVariable(variable,true,variables);
  }
  ElemTemplateElement p=myCurrentElement;
  while (p != null) {
    ElemTemplateElement s=p;
    while ((s=s.getPreviousSiblingElem()) != null) {
      if (s instanceof ElemVariable) {
        final ElemVariable variable=(ElemVariable)s;
        if (variable.getIsTopLevel()) {
          continue;
        }
        addVariable(variable,false,variables);
      }
    }
    p=p.getParentElem();
  }
  Collections.sort(variables,VariableComparator.INSTANCE);
  return variables;
}
