{
  final PsiFile file=element.getContainingFile();
  if (element != file) {
    return new DocumentBasedFormattingModel(new AbstractBlock(element.getNode(),Wrap.createWrap(WrapType.NONE,false),Alignment.createAlignment()){
      protected List<Block> buildChildren(){
        return Collections.emptyList();
      }
      public Spacing getSpacing(      final Block child1,      final Block child2){
        return Spacing.getReadOnlySpacing();
      }
      public boolean isLeaf(){
        return true;
      }
    }
,element.getProject(),settings,file.getFileType(),file);
  }
  final TemplateLanguageFileViewProvider provider=(TemplateLanguageFileViewProvider)file.getViewProvider();
  final Language language=provider.getTemplateDataLanguage();
  FormattingModelBuilder builder=LanguageFormatting.INSTANCE.forLanguage(language);
  if (builder == null)   builder=LanguageFormatting.INSTANCE.forLanguage(PlainTextLanguage.INSTANCE);
  return builder.createModel(provider.getPsi(language),settings);
}
