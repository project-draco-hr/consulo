{
  int startOffset=fileText.indexOf(TestUtils.BEGIN_MARKER);
  fileText=TestUtils.removeBeginMarker(fileText);
  int endOffset=fileText.indexOf(TestUtils.END_MARKER);
  fileText=TestUtils.removeEndMarker(fileText);
  myFixture.configureByText(GroovyFileType.GROOVY_FILE_TYPE,fileText);
  final Editor myEditor=myFixture.getEditor();
  myEditor.getSelectionModel().setSelection(startOffset,endOffset);
  GroovyExtractMethodHandler handler=new GroovyExtractMethodHandler();
  boolean invoked=handler.invokeOnEditor(getProject(),myEditor,myFixture.getFile());
  String result=invoked ? myEditor.getDocument().getText() : "FAILED: " + handler.getInvokeResult();
  int caretOffset=myEditor.getCaretModel().getOffset();
  return invoked ? result.substring(0,caretOffset) + TestUtils.CARET_MARKER + result.substring(caretOffset) : result;
}
