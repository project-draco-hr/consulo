{
  if (LOG.isDebugEnabled()) {
    LOG.debug("enter: dispatchClosed(" + window + ")");
  }
synchronized (myLock) {
    final WindowInfo info=myWindow2Info.get(window);
    if (info != null) {
      final FocusWatcher focusWatcher=info.myFocusWatcherRef.get();
      if (focusWatcher != null) {
        focusWatcher.deinstall(window);
      }
      myWindow2Info.remove(window);
    }
  }
  if (myFocusedWindow == window) {
    if (LOG.isDebugEnabled()) {
      LOG.debug("currently active window should be closed");
    }
    myFocusedWindow=myFocusedWindow.getOwner();
    if (LOG.isDebugEnabled()) {
      LOG.debug("new active window is " + myFocusedWindow);
    }
  }
  for (Iterator i=myFocusedWindows.iterator(); i.hasNext(); ) {
    final Window activeWindow=(Window)i.next();
    if (activeWindow == window) {
      final Window newActiveWindow=activeWindow.getOwner();
      i.remove();
      if (newActiveWindow != null) {
        myFocusedWindows.add(newActiveWindow);
      }
      break;
    }
  }
  for (Iterator i=myWindow2Info.values().iterator(); i.hasNext(); ) {
    final WindowInfo info=(WindowInfo)i.next();
    if (info.myFocusWatcherRef.get() == null) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("remove collected info");
      }
      i.remove();
    }
  }
}
