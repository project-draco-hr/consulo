{
  if (files.size() == 1) {
    myShowFiles=true;
  }
  Runnable buildingRunnable=new Runnable(){
    @Override public void run(){
      for (      final PsiFile file : files) {
        if (file != null) {
          buildFileNode(file.getVirtualFile(),null);
        }
      }
    }
  }
;
  if (showProgress) {
    ProgressManager.getInstance().runProcessWithProgressSynchronously(buildingRunnable,AnalysisScopeBundle.message("package.dependencies.build.process.title"),false,myProject);
  }
 else {
    buildingRunnable.run();
  }
  TreeUtil.sort(myRoot,new DependencyNodeComparator());
  return new TreeModel(myRoot,myTotalFileCount,myMarkedFileCount);
}
