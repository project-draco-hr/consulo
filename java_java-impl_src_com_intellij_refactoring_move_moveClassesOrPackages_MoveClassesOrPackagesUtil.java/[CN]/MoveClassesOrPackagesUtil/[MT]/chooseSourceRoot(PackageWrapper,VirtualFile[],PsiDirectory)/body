{
  Project project=targetPackage.getManager().getProject();
  List<PsiDirectory> targetDirectories=new ArrayList<PsiDirectory>();
  Map<PsiDirectory,String> relativePathsToCreate=new HashMap<PsiDirectory,String>();
  buildDirectoryList(targetPackage,contentSourceRoots,targetDirectories,relativePathsToCreate);
  final PsiDirectory selectedDirectory=DirectoryChooserUtil.chooseDirectory(targetDirectories.toArray(new PsiDirectory[targetDirectories.size()]),initialDirectory,project,relativePathsToCreate);
  if (selectedDirectory == null)   return null;
  final VirtualFile virt=selectedDirectory.getVirtualFile();
  final VirtualFile sourceRootForFile=ProjectRootManager.getInstance(project).getFileIndex().getSourceRootForFile(virt);
  LOG.assertTrue(sourceRootForFile != null);
  return sourceRootForFile;
}
