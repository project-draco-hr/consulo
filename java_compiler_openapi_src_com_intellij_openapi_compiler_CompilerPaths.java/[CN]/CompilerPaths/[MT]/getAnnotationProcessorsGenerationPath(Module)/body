{
  final AnnotationProcessingConfiguration config=CompilerConfiguration.getInstance(module.getProject()).getAnnotationProcessingConfiguration(module);
  final String sourceDirName=config.getGeneratedSourcesDirectoryName(false);
  if (config.isOutputRelativeToContentRoot()) {
    final String[] roots=ModuleRootManager.getInstance(module).getContentRootUrls();
    if (roots.length == 0) {
      return null;
    }
    if (roots.length > 1) {
      Arrays.sort(roots,URLS_COMPARATOR);
    }
    return StringUtil.isEmpty(sourceDirName) ? VirtualFileManager.extractPath(roots[0]) : VirtualFileManager.extractPath(roots[0]) + "/" + sourceDirName;
  }
  final CompilerProjectExtension extension=CompilerProjectExtension.getInstance(module.getProject());
  if (extension == null) {
    return null;
  }
  final String url=extension.getCompilerOutputUrl();
  if (url == null) {
    return null;
  }
  return StringUtil.isEmpty(sourceDirName) ? VirtualFileManager.extractPath(url) : VirtualFileManager.extractPath(url) + "/" + sourceDirName;
}
