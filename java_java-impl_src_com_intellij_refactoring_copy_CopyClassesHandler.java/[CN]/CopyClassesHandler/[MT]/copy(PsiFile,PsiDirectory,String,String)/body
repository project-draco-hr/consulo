{
  final String fileName;
  if (name != null) {
    fileName=file instanceof PsiClassOwner ? name + "." + file.getViewProvider().getVirtualFile().getExtension() : name;
  }
 else {
    fileName=file.getName();
  }
  if (relativePath != null && !relativePath.isEmpty()) {
    return buildRelativeDir(directory,relativePath).findOrCreateTargetDirectory().copyFileFrom(fileName,file);
  }
  return directory.copyFileFrom(fileName,file);
}
