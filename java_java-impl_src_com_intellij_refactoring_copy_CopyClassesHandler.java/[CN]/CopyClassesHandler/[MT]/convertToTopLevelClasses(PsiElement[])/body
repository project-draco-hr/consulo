{
  final Map<PsiFile,PsiClass[]> result=new HashMap<PsiFile,PsiClass[]>();
  for (  PsiElement element : elements) {
    final PsiFile containingFile=element.getNavigationElement().getContainingFile();
    if (!CollectHighlightsUtil.isOutsideSourceRootJavaFile(containingFile)) {
      PsiClass[] topLevelClasses=getTopLevelClasses(element);
      if (topLevelClasses == null)       return null;
      PsiClass[] classes=result.get(containingFile);
      if (classes != null) {
        topLevelClasses=ArrayUtil.mergeArrays(classes,topLevelClasses,PsiClass.class);
      }
      result.put(containingFile,topLevelClasses);
    }
  }
  return result.isEmpty() ? null : result;
}
