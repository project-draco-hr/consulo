{
  GrCodeReferenceElement cur=(GrCodeReferenceElement)ref.copy();
  while (true) {
    final GrCodeReferenceElement qualifier=cur.getQualifier();
    if (qualifier == null) {
      return true;
    }
    if (!(qualifier.resolve() instanceof PsiClass)) {
      final PsiClass correctResolved=(PsiClass)cur.resolve();
      cur.setQualifier(null);
      final PsiClass rawResolved=(PsiClass)cur.resolve();
      return rawResolved == null || cur.getManager().areElementsEquivalent(correctResolved,rawResolved);
    }
    cur=qualifier;
  }
}
