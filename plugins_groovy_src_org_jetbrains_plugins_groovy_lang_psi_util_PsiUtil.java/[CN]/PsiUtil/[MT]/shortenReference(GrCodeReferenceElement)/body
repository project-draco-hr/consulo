{
  if (ref.getQualifier() != null && (PsiTreeUtil.getParentOfType(ref,GrDocMemberReference.class) != null || PsiTreeUtil.getParentOfType(ref,GrDocComment.class) == null) && PsiTreeUtil.getParentOfType(ref,GrImportStatement.class) == null && PsiTreeUtil.getParentOfType(ref,GroovyCodeFragment.class) == null) {
    final PsiElement resolved=ref.resolve();
    if (resolved instanceof PsiClass && mayShorten(ref)) {
      if (ref.getUserData(SHORTENING) != null) {
        LOG.error("Endless shortening. Ref=" + ref.getText() + "; parent="+ ref.getParent());
        return;
      }
      ref.setQualifier(null);
      ref.putUserData(SHORTENING,Boolean.TRUE);
      try {
        ref.bindToElement(resolved);
      }
 catch (      IncorrectOperationException e) {
        LOG.error(e);
      }
 finally {
        ref.putUserData(SHORTENING,null);
      }
    }
  }
}
