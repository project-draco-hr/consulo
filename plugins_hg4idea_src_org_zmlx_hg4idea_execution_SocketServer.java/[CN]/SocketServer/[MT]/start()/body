{
  serverSocket=new ServerSocket(0);
  int port=serverSocket.getLocalPort();
  serverThread=new Thread("hg4idea prompt server"){
    @Override public void run(){
      try {
        boolean _continue=true;
        while (_continue) {
          Socket socket=serverSocket.accept();
          try {
            _continue=protocol.handleConnection(socket);
          }
  finally {
            socket.close();
          }
        }
      }
 catch (      SocketException e) {
      }
catch (      IOException e) {
        throw new RuntimeException(e);
      }
    }
  }
;
  serverThread.start();
  return port;
}
