{
  myServerSocket=new ServerSocket(0);
  int port=myServerSocket.getLocalPort();
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    @Override public void run(){
      try {
        boolean _continue=true;
        while (_continue) {
          Socket socket=myServerSocket.accept();
          try {
            _continue=myProtocol.handleConnection(socket);
          }
  finally {
            socket.close();
          }
        }
      }
 catch (      SocketException e) {
      }
catch (      IOException e) {
        throw new RuntimeException(e);
      }
    }
  }
);
  return port;
}
