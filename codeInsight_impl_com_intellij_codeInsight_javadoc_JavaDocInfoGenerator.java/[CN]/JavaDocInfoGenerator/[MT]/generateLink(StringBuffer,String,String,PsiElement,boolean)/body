{
  if (label == null) {
    PsiManager manager=PsiManager.getInstance(myProject);
    label=JavaDocUtil.getLabelText(myProject,manager,refText,context);
  }
  LOG.assertTrue(refText != null,"refText appears to be null.");
  final PsiElement target=JavaDocUtil.findReferenceTarget(context.getManager(),refText,context);
  boolean isBrokenLink=target == null;
  if (isBrokenLink) {
    buffer.append("<font color=red>");
    buffer.append(label);
    buffer.append("</font>");
    return label.length();
  }
  JavaDocUtil.createHyperlink(buffer,JavaDocUtil.getReferenceText(myProject,target),label,plainLink);
  return label.length();
}
