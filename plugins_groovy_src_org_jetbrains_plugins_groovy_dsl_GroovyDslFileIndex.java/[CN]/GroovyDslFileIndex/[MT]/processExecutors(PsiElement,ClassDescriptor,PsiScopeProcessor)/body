{
  final PsiFile placeFile=place.getContainingFile().getOriginalFile();
  final VirtualFile placeVFile=placeFile.getVirtualFile();
  if (placeVFile == null) {
    return true;
  }
  int count=0;
  final LinkedBlockingQueue<Pair<GroovyFile,GroovyDslExecutor>> queue=new LinkedBlockingQueue<Pair<GroovyFile,GroovyDslExecutor>>();
  final Set<String> unusedPaths=new THashSet<String>(ourMapping.keySet());
  for (  final GroovyFile file : getDslFiles(place.getResolveScope())) {
    final VirtualFile vfile=file.getVirtualFile();
    if (vfile == null) {
      continue;
    }
    unusedPaths.remove(vfile.getUrl());
    if (vfile.equals(placeVFile)) {
      continue;
    }
    final long stamp=file.getModificationStamp();
    final GroovyDslExecutor cached=getCachedExecutor(vfile,stamp);
    if (cached == null) {
      final String text=file.getText();
      count++;
      scheduleParsing(queue,file,vfile,stamp,text);
    }
 else {
      if (!processExecutor(cached,descriptor,processor,file)) {
        return false;
      }
    }
  }
  for (  final String unusedPath : unusedPaths) {
    final VirtualFile file=VirtualFileManager.getInstance().findFileByUrl(unusedPath);
    if (file != null) {
      ourMapping.remove(unusedPath);
    }
  }
  try {
    while (count > 0) {
      ProgressManager.getInstance().checkCanceled();
      final Pair<GroovyFile,GroovyDslExecutor> pair=queue.poll(20,TimeUnit.MILLISECONDS);
      if (pair != null) {
        final GroovyDslExecutor executor=pair.second;
        final GroovyFile dslFile=pair.first;
        dslFile.putUserData(CACHED_ENHANCEMENTS,null);
        if (executor != null && !processExecutor(executor,descriptor,processor,dslFile)) {
          return false;
        }
        count--;
      }
    }
  }
 catch (  InterruptedException e) {
    LOG.error(e);
  }
  return true;
}
