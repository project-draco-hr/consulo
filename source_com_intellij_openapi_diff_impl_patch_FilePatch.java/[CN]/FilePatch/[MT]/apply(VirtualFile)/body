{
  if (isNewFile()) {
    VirtualFile newFile=fileToPatch.createChildData(this,getBeforeFileName());
    final Document document=FileDocumentManager.getInstance().getDocument(newFile);
    document.setText(myHunks.get(0).getText());
    FileDocumentManager.getInstance().saveDocument(document);
  }
 else   if (isDeletedFile()) {
    fileToPatch.delete(this);
  }
 else {
    byte[] fileContents=fileToPatch.contentsToByteArray();
    CharSequence text=LoadTextUtil.getTextByBinaryPresentation(fileContents,fileToPatch);
    String resultText=applyModifications(text);
    final Document document=FileDocumentManager.getInstance().getDocument(fileToPatch);
    document.setText(resultText);
    FileDocumentManager.getInstance().saveDocument(document);
  }
}
