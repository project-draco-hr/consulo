{
  String[] pathNameComponents=myBeforeName.split("/");
  VirtualFile fileToPatch=patchedDir;
  for (int i=skipTopDirs; i < pathNameComponents.length; i++) {
    fileToPatch=fileToPatch.findChild(pathNameComponents[i]);
    if (fileToPatch == null) {
      break;
    }
  }
  if (fileToPatch == null) {
    throw new ApplyPatchException("Cannot find file to patch: " + myBeforeName);
  }
  CharSequence text=LoadTextUtil.loadText(fileToPatch);
  List<String> lines=new ArrayList<String>();
  Collections.addAll(lines,LineTokenizer.tokenize(text,false));
  for (  PatchHunk hunk : myHunks) {
    hunk.apply(lines);
  }
  final Document document=FileDocumentManager.getInstance().getDocument(fileToPatch);
  document.setText(StringUtil.join(lines,"\n") + "\n");
  FileDocumentManager.getInstance().saveDocument(document);
}
