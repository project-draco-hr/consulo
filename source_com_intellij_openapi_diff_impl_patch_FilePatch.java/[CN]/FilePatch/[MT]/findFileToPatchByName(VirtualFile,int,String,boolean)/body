{
  String[] pathNameComponents=fileName.split("/");
  VirtualFile fileToPatch=patchedDir;
  int lastComponentToFind=isNewFile() ? pathNameComponents.length - 1 : pathNameComponents.length;
  for (int i=skipTopDirs; i < lastComponentToFind; i++) {
    VirtualFile nextChild=fileToPatch.findChild(pathNameComponents[i]);
    if (nextChild == null) {
      if (createDirectories) {
        try {
          nextChild=fileToPatch.createChildDirectory(this,pathNameComponents[i]);
        }
 catch (        IOException e) {
          return null;
        }
      }
 else {
        return null;
      }
    }
    fileToPatch=nextChild;
  }
  return fileToPatch;
}
