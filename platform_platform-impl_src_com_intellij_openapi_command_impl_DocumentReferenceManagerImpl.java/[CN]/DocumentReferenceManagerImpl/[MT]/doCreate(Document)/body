{
  final int hashCode=document.hashCode();
  Reference<Document> reference=new WeakReference<Document>(document){
    @Override public int hashCode(){
      return hashCode;
    }
    @Override public boolean equals(    Object obj){
      Document mydoc=get();
      return mydoc != null && obj instanceof Reference && ((Reference)obj).get() == mydoc;
    }
  }
;
  DocumentReference result=myDocToRef.get(reference);
  if (result == null) {
    result=new DocumentReferenceByDocument(document);
    myDocToRef.put(reference,result);
  }
  return result;
}
