{
  VirtualFileManager.getInstance().addVirtualFileListener(new VirtualFileAdapter(){
    @Override public void fileCreated(    VirtualFileEvent event){
      VirtualFile f=event.getFile();
      DocumentReference ref=myDeletedFilePathToRef.remove(new FilePath(f.getUrl()));
      if (ref != null) {
        myFileToRef.put(f,ref);
        ((DocumentReferenceByVirtualFile)ref).update(f);
      }
    }
    @Override public void fileDeleted(    VirtualFileEvent event){
      VirtualFile f=event.getFile();
      DocumentReference ref=myFileToRef.remove(f);
      if (ref != null) {
        myDeletedFilePathToRef.put(new FilePath(f.getUrl()),ref);
      }
    }
  }
);
}
