{
  if (myEvents.isEmpty() && myFinishRunnable == null)   return;
  final VirtualFileManagerEx manager=(VirtualFileManagerEx)VirtualFileManager.getInstance();
  manager.fireBeforeRefreshStart(myIsAsync);
  while (!myWorkQueue.isEmpty() || !myEvents.isEmpty()) {
    final List<VFileEvent> events=myEvents;
    myEvents=new ArrayList<VFileEvent>();
    ManagingFS.getInstance().processEvents(events);
    scan();
  }
  manager.fireAfterRefreshFinish(myIsAsync);
  if (myFinishRunnable != null) {
    myFinishRunnable.run();
  }
  notifyCacheUpdaters();
}
