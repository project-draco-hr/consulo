{
  addData();
  if (insideFolding) {
    myFoldedOffsets.add(offset);
    onNonSoftWrapSymbol(c);
    if (c == '\n') {
      foldedLines++;
    }
    foldingColumnDiff=foldingStartVisualColumn - logicalColumn;
    return;
  }
  if (virtualSpace) {
    mySoftWrapBuffer.append(c);
    if (c == '\n') {
      visualColumn++;
      addData(true);
      visualColumn++;
      addData(true);
      visualLine++;
      softWrapLinesOnCurrentLogical++;
      visualColumn=0;
      softWrapSymbolsOnCurrentVisualLine=0;
    }
 else {
      visualColumn++;
      softWrapSymbolsOnCurrentVisualLine++;
    }
    return;
  }
  onNonSoftWrapSymbol(c);
  if (c == '\n') {
    visualLine++;
    visualColumn=0;
    softWrapLinesBeforeCurrentLogical+=softWrapLinesOnCurrentLogical;
    softWrapLinesOnCurrentLogical=0;
    softWrapSymbolsOnCurrentVisualLine=0;
    foldingColumnDiff=0;
  }
 else {
    visualColumn++;
  }
}
