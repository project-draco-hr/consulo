{
  PsiDirectory realDirectory=directory;
  StringBuilder textBuilder=null;
  if (getSettings().isHideEmptyMiddlePackages()) {
    do {
      if (realDirectory.getFiles().length > 0)       break;
      PsiDirectory[] subdirectories=realDirectory.getSubdirectories();
      if (subdirectories.length != 1)       break;
      if (textBuilder == null) {
        textBuilder=new StringBuilder();
        textBuilder.append(realDirectory.getName());
      }
      realDirectory=subdirectories[0];
      textBuilder.append('.').append(realDirectory.getName());
    }
 while (true);
  }
  String presentableText=textBuilder == null ? directory.getName() : textBuilder.toString();
  return new AbstractFolderNode(getModule(),realDirectory,presentableText,myLocationMark,getSettings(),FOLDER){
    @Override protected void processNotDirectoryFile(    List<AbstractTreeNode> nodes,    PsiFile file){
      AbstractFolderNode.this.processNotDirectoryFile(nodes,file);
    }
    @Override protected AbstractTreeNode createClassNode(    GrTypeDefinition typeDefinition){
      return AbstractFolderNode.this.createClassNode(typeDefinition);
    }
  }
;
}
