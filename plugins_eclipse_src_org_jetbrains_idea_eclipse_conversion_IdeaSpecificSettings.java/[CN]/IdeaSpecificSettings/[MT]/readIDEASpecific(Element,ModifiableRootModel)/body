{
  PathMacroManager.getInstance(model.getModule()).expandPaths(root);
  model.getModuleExtension(LanguageLevelModuleExtension.class).readExternal(root);
  final CompilerModuleExtension compilerModuleExtension=model.getModuleExtension(CompilerModuleExtension.class);
  final Element testOutputElement=root.getChild(IdeaXml.OUTPUT_TEST_TAG);
  if (testOutputElement != null) {
    compilerModuleExtension.setCompilerOutputPathForTests(testOutputElement.getAttributeValue(IdeaXml.URL_ATTR));
  }
  final String inheritedOutput=root.getAttributeValue(IdeaXml.INHERIT_COMPILER_OUTPUT_ATTR);
  if (inheritedOutput != null && Boolean.valueOf(inheritedOutput).booleanValue()) {
    compilerModuleExtension.inheritCompilerOutputPath(true);
  }
  compilerModuleExtension.setExcludeOutput(root.getChild(IdeaXml.EXCLUDE_OUTPUT_TAG) != null);
  final List entriesElements=root.getChildren(IdeaXml.CONTENT_ENTRY_TAG);
  if (!entriesElements.isEmpty()) {
    for (    Object o : entriesElements) {
      readContentEntry((Element)o,model.addContentEntry(((Element)o).getAttributeValue(IdeaXml.URL_ATTR)));
    }
  }
 else {
    final ContentEntry[] entries=model.getContentEntries();
    if (entries.length > 0) {
      readContentEntry(root,entries[0]);
    }
  }
  for (  Object o : root.getChildren("lib")) {
    Element libElement=(Element)o;
    final String libName=libElement.getAttributeValue("name");
    Library libraryByName=model.getModuleLibraryTable().getLibraryByName(libName);
    if (libraryByName != null) {
      appendLibraryScope(model,libElement,libraryByName);
      final Library.ModifiableModel modifiableModel=libraryByName.getModifiableModel();
      replaceCollapsedByEclipseSourceRoots(libElement,modifiableModel);
      replaceModuleRelatedRoots(model.getProject(),modifiableModel,libElement,OrderRootType.SOURCES,RELATIVE_MODULE_SRC);
      replaceModuleRelatedRoots(model.getProject(),modifiableModel,libElement,OrderRootType.CLASSES,RELATIVE_MODULE_CLS);
      modifiableModel.commit();
    }
 else {
      libraryByName=EclipseClasspathReader.findLibraryByName(model.getProject(),libName);
      if (libraryByName != null) {
        appendLibraryScope(model,libElement,libraryByName);
      }
      final Library[] libraries=model.getModuleLibraryTable().getLibraries();
      for (      Library library : libraries) {
        final Library.ModifiableModel modifiableModel=library.getModifiableModel();
        replaceModuleRelatedRoots(model.getProject(),modifiableModel,libElement,OrderRootType.SOURCES,RELATIVE_MODULE_SRC);
        replaceModuleRelatedRoots(model.getProject(),modifiableModel,libElement,OrderRootType.CLASSES,RELATIVE_MODULE_CLS);
        modifiableModel.commit();
      }
    }
  }
}
