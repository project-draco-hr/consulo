{
  Presentation presentation=presentationFactory.getPresentation(group);
  AnActionEvent e=new AnActionEvent(null,context,place,presentation,actionManager,0);
  if (!doUpdate(group,e,presentation))   return;
  if (!presentation.isVisible()) {
    return;
  }
  AnAction[] children=group.getChildren(e);
  for (int i=0; i < children.length; i++) {
    AnAction child=children[i];
    if (child == null) {
      String groupId=ActionManager.getInstance().getId(group);
      LOG.error("action is null: i=" + i + " group="+ group+ " group id="+ groupId);
      continue;
    }
    presentation=presentationFactory.getPresentation(child);
    AnActionEvent e1=new AnActionEvent(null,context,place,presentation,actionManager,0);
    e1.setInjectedContext(child.isInInjectedContext());
    if (!doUpdate(child,e1,presentation))     continue;
    if (!presentation.isVisible()) {
      continue;
    }
    if (child instanceof ActionGroup) {
      ActionGroup actionGroup=(ActionGroup)child;
      if (actionGroup.isPopup()) {
        if (presentation.isEnabled()) {
          final boolean enabled=actionGroup.canBePerformed(context) || hasVisibleChildren(actionGroup,presentationFactory,context,place);
          presentation.setEnabled(enabled);
        }
        list.add(child);
      }
 else {
        expandActionGroup((ActionGroup)child,list,presentationFactory,context,place,actionManager);
      }
    }
 else     if (child instanceof Separator) {
      if (!list.isEmpty() && !(list.get(list.size() - 1) instanceof Separator)) {
        list.add(child);
      }
    }
 else {
      list.add(child);
    }
  }
}
