{
  if (isInTestMode()) {
    task.run(new EmptyProgressIndicator());
    task.onSuccess();
  }
 else   if (task.isConditionalModal() && !task.shouldStartInBackground()) {
    ProgressManager.getInstance().run(task);
  }
 else {
synchronized (myQueue) {
      final boolean hadActiveTask=myHasActiveTask;
      myQueue.offer(task);
      myHasActiveTask=true;
      if (!hadActiveTask) {
        runRunner();
      }
    }
  }
}
