{
synchronized (element) {
    List<Reference<ControlFlowContext>> refs=element.getUserData(CONTROL_FLOW_KEY);
    Pair<Integer,ControlFlow> result=findControlFlow(refs,element,policy,evaluateConstantIfCondition);
    ControlFlow flow=result == null ? null : result.getSecond();
    if (flow == null) {
      flow=new ControlFlowAnalyzer(element,policy,enableShortCircuit,evaluateConstantIfCondition).buildControlFlow();
      registerControlFlow(element,flow,evaluateConstantIfCondition,policy);
    }
    if (flow instanceof ControlFlowSubRange && LOG.isDebugEnabled()) {
      LOG.debug("CF optimization subrange works for " + element + "("+ (element.getText().length() > 40 ? element.getText().substring(0,40) : element.getText())+ ")");
    }
    return flow;
  }
}
