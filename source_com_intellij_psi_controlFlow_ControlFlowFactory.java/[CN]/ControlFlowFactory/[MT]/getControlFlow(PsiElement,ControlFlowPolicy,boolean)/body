{
  SoftReference<ControlFlowContext> ref=element.getUserData(CONTROL_FLOW_KEY);
  ControlFlowContext flows=ref == null ? null : ref.get();
  ControlFlowContext currentFlow=flows;
  final long modificationCount=element.getManager().getModificationTracker().getModificationCount();
  ControlFlow flow=null;
  while (currentFlow != null) {
    if (currentFlow.policy == policy && isValid(currentFlow,modificationCount)) {
      if (currentFlow.evaluateConstantIfCondition == evaluateConstantIfCondition || !currentFlow.flow.isConstantConditionOccurred()) {
        if (currentFlow.evaluateConstantIfCondition != evaluateConstantIfCondition) {
          LOG.debug("CF constant cond optimization works for " + element + "("+ (element.getText().length() > 40 ? element.getText().substring(0,40) : element.getText())+ ")");
        }
        flow=currentFlow.flow;
        break;
      }
    }
    currentFlow=currentFlow.next;
  }
  if (flow == null) {
    flow=new ControlFlowAnalyzer(element,policy,true,evaluateConstantIfCondition).buildControlFlow();
    registerControlFlow(element,flow,evaluateConstantIfCondition,policy);
  }
  if (flow instanceof ControlFlowSubRange) {
    LOG.debug("CF optimization subrange works for " + element + "("+ (element.getText().length() > 40 ? element.getText().substring(0,40) : element.getText())+ ")");
  }
  return flow;
}
