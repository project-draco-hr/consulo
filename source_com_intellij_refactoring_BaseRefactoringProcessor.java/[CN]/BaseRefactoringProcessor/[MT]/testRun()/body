{
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  prepareTestRun();
  UsageInfo[] usages=findUsages();
  UsageInfo[][] u=new UsageInfo[][]{usages};
  preprocessUsages(u);
  RefactoringListenerManagerImpl listenerManager=(RefactoringListenerManagerImpl)RefactoringListenerManager.getInstance(myProject);
  myTransaction=listenerManager.startTransaction();
  Set<PsiJavaFile> touchedJavaFiles=getTouchedJavaFiles(u[0]);
  performRefactoring(u[0]);
  removeRedundantImports(touchedJavaFiles);
  myTransaction.commit();
  performPsiSpoilingRefactoring();
}
