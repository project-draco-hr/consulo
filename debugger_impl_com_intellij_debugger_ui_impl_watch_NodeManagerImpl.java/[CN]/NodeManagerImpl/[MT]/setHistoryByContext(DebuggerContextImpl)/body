{
  final DebugProcessImpl debugProcess=context.getDebugProcess();
  final DescriptorHistoryManager descriptorHistoryManager=debugProcess.getDescriptorHistoryManager();
  descriptorHistoryManager.storeHistory(new DescriptorHistory(getCurrentHistoryTree(),myBreakpoints));
  final DescriptorHistory history=descriptorHistoryManager.restoreHistory(context);
  final DescriptorTree descriptorTree=(history != null) ? history.getDescriptorTree() : new DescriptorTree(true);
  deriveHistoryTree(descriptorTree,context);
  List<Pair<Breakpoint,Event>> eventDescriptors=DebuggerUtilsEx.getEventDescriptors(context.getSuspendContext());
  myBreakpoints=ContainerUtil.map(eventDescriptors,new Function<Pair<Breakpoint,Event>,Breakpoint>(){
    public Breakpoint fun(    Pair<Breakpoint,Event> o){
      return o.getFirst();
    }
  }
);
}
