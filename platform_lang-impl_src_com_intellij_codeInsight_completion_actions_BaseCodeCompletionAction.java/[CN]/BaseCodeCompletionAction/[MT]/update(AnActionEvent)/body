{
  DataContext dataContext=e.getDataContext();
  e.getPresentation().setEnabled(false);
  Project project=CommonDataKeys.PROJECT.getData(dataContext);
  if (project == null)   return;
  Editor editor=PlatformDataKeys.EDITOR.getData(dataContext);
  if (editor == null)   return;
  final PsiFile psiFile=PsiUtilBase.getPsiFileInEditor(editor,project);
  if (psiFile == null)   return;
  if (!ApplicationManager.getApplication().isUnitTestMode() && !editor.getContentComponent().isShowing())   return;
  e.getPresentation().setEnabled(true);
}
