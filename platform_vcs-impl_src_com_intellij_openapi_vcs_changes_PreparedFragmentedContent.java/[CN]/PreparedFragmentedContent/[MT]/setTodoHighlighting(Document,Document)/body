{
  final ContentRevisionCache cache=ProjectLevelVcsManager.getInstance(myProject).getContentRevisionCache();
  final List<Pair<TextRange,TextAttributes>> beforeTodoRanges=myBeforeNumber == null ? Collections.<Pair<TextRange,TextAttributes>>emptyList() : new TodoForBaseRevision(myProject,getBeforeFragments(),1,myFileName,oldDocument.getText(),true,myFileType,new Getter<Object>(){
    @Override public Object get(){
      return cache.getCustom(myFilePath,myBeforeNumber);
    }
  }
,new Consumer<Object>(){
    @Override public void consume(    Object items){
      cache.putCustom(myFilePath,myBeforeNumber,items);
    }
  }
).execute();
  final List<Pair<TextRange,TextAttributes>> afterTodoRanges=new TodoForExistingFile(myProject,getAfterFragments(),1,myFileName,document.getText(),false,myFileType,myFile).execute();
  setBeforeTodoRanges(beforeTodoRanges);
  setAfterTodoRanges(afterTodoRanges);
}
