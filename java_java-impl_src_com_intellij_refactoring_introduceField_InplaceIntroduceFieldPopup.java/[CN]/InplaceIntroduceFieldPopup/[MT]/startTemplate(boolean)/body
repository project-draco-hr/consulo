{
  CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
    public void run(){
      myTypeSelectorManager.setAllOccurences(replaceAllOccurrences);
      final PsiType defaultType=myTypeSelectorManager.getTypeSelector().getSelectedType();
      final SuggestedNameInfo suggestedNameInfo=IntroduceFieldDialog.createGenerator(myStatic,myLocalVariable,myInitializerExpression,myLocalVariable != null).getSuggestedNameInfo(defaultType);
      final PsiField field=createFieldToStartTemplateOn(suggestedNameInfo.names,defaultType);
      if (field != null) {
        myEditor.getCaretModel().moveToOffset(field.getTextOffset());
        final LinkedHashSet<String> nameSuggestions=new LinkedHashSet<String>();
        nameSuggestions.add(field.getName());
        nameSuggestions.addAll(Arrays.asList(suggestedNameInfo.names));
        final VariableInplaceRenamer renamer=new FieldInplaceIntroducer(field);
        renamer.performInplaceRename(false,nameSuggestions);
      }
    }
  }
,IntroduceFieldHandler.REFACTORING_NAME,null);
}
