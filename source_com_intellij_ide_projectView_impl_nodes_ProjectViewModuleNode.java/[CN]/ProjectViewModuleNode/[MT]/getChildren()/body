{
  ModuleRootManager rootManager=ModuleRootManager.getInstance(getValue());
  ModuleFileIndex moduleFileIndex=rootManager.getFileIndex();
  final VirtualFile[] contentRoots=rootManager.getContentRoots();
  final List<AbstractTreeNode> children=new ArrayList<AbstractTreeNode>(contentRoots.length + 1);
  final PsiManager psiManager=PsiManager.getInstance(getProject());
  for (int idx=0; idx < contentRoots.length; idx++) {
    final VirtualFile contentRoot=contentRoots[idx];
    LOG.assertTrue(contentRoot.isDirectory());
    if (!moduleFileIndex.isInContent(contentRoot))     continue;
    final PsiDirectory psiDirectory=psiManager.findDirectory(contentRoot);
    LOG.assertTrue(psiDirectory != null);
    children.add(new PsiDirectoryNode(getProject(),psiDirectory,getSettings()));
  }
  if (getSettings().isShowLibraryContents()) {
    children.add(new LibraryGroupNode(getProject(),new LibraryGroupElement(getValue()),getSettings()));
  }
  return children;
}
