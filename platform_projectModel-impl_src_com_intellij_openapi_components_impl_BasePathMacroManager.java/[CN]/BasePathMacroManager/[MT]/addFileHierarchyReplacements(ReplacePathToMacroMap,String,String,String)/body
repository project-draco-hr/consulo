{
  if (path == null)   return;
  String macro="$" + macroName + "$";
  VirtualFile dir=getLocalFileSystem().findFileByPath(path);
  boolean check=false;
  while (dir != null && dir.getParent() != null) {
    path=dir.getPath();
    if (DEBUG) {
      System.out.println("BasePathMacroManager.addFileHierarchyReplacements");
      System.out.println("path = " + path);
      System.out.println("macro = " + macro);
    }
    putIfAbsent(result,"file:" + path,"file:" + macro,check);
    putIfAbsent(result,"file:/" + path,"file:/" + macro,check);
    putIfAbsent(result,"file://" + path,"file://" + macro,check);
    putIfAbsent(result,"jar:" + path,"jar:" + macro,check);
    putIfAbsent(result,"jar:/" + path,"jar:/" + macro,check);
    putIfAbsent(result,"jar://" + path,"jar://" + macro,check);
    if (!path.equalsIgnoreCase("e:/") && !path.equalsIgnoreCase("r:/") && !path.equalsIgnoreCase("p:/")) {
      putIfAbsent(result,path,macro,check);
    }
    if (dir.getPath().equals(stopAt)) {
      break;
    }
    macro+="/..";
    check=true;
    dir=dir.getParent();
  }
}
