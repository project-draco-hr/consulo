{
  super(new BorderLayout());
  myProject=project;
  myDecorators=new LinkedList<CommittedChangeListDecorator>();
  myChangeLists=changeLists;
  myChangesTree=new ChangesBrowserTree();
  myChangesTree.setRootVisible(false);
  myChangesTree.setShowsRootHandles(true);
  myChangesTree.setCellRenderer(new CommittedChangeListRenderer(project,myDecorators));
  TreeUtil.expandAll(myChangesTree);
  myChangesView=new RepositoryChangesBrowser(project,changeLists);
  myChangesView.getListPanel().setBorder(null);
  myChangesTree.getSelectionModel().addTreeSelectionListener(new TreeSelectionListener(){
    public void valueChanged(    TreeSelectionEvent e){
      updateBySelectionChange();
    }
  }
);
  final TreeLinkMouseListener linkMouseListener=new TreeLinkMouseListener(new CommittedChangeListRenderer(project,myDecorators));
  linkMouseListener.install(myChangesTree);
  myLeftPanel=new JPanel(new BorderLayout());
  myToolbarPanel=new JPanel(new BorderLayout());
  myLeftPanel.add(myToolbarPanel,BorderLayout.NORTH);
  myFilterSplitter=new Splitter(false,0.5f);
  myFilterSplitter.setSecondComponent(new JScrollPane(myChangesTree));
  myLeftPanel.add(myFilterSplitter,BorderLayout.CENTER);
  final Splitter splitter=new Splitter(false,0.7f);
  splitter.setFirstComponent(myLeftPanel);
  splitter.setSecondComponent(myChangesView);
  add(splitter,BorderLayout.CENTER);
  myInnerSplitter=new WiseSplitter(new Runnable(){
    public void run(){
      myFilterSplitter.doLayout();
      updateModel();
    }
  }
,myFilterSplitter);
  mySplitterProportionsData.externalizeFromDimensionService("CommittedChanges.SplitterProportions");
  mySplitterProportionsData.restoreSplitterProportions(this);
  updateBySelectionChange();
  ActionManager.getInstance().getAction("CommittedChanges.Details").registerCustomShortcutSet(new CustomShortcutSet(KeymapManager.getInstance().getActiveKeymap().getShortcuts(IdeActions.ACTION_QUICK_JAVADOC)),this);
  myCopyProvider=new TreeCopyProvider(myChangesTree);
  myTreeExpander=new DefaultTreeExpander(myChangesTree);
  myChangesView.addToolbarAction(ActionManager.getInstance().getAction("Vcs.ShowTabbedFileHistory"));
  myHelpId=ourHelpId;
  myChangesView.getDiffAction().registerCustomShortcutSet(CommonShortcuts.getDiff(),myChangesTree);
  myConnection=myProject.getMessageBus().connect();
  myConnection.subscribe(ITEMS_RELOADED,new CommittedChangesReloadListener(){
    public void itemsReloaded(){
    }
    public void emptyRefresh(){
      updateGrouping();
    }
  }
);
}
