{
  boolean forceCheck=forceCheckParam;
  final Ref<Boolean> promptResult=new Ref<Boolean>();
  final Runnable prompt=new Runnable(){
    public void run(){
      promptResult.set(worker.promptForPassword());
    }
  }
;
  while (true) {
    final ThreeState state=worker.silentLogin(forceCheck);
    if (ThreeState.YES.equals(state))     return ThreeState.YES;
    if (ThreeState.NO.equals(state))     return state;
    UIUtil.invokeAndWaitIfNeeded(prompt);
    if (!Boolean.TRUE.equals(promptResult.get())) {
      return ThreeState.UNSURE;
    }
    forceCheck=true;
  }
}
