{
  VirtualFile virtualFile=psiFile.getVirtualFile();
  if (virtualFile == null) {
    PsiFile originalFile=psiFile.getOriginalFile();
    if (originalFile == null)     return null;
    virtualFile=originalFile.getVirtualFile();
    if (virtualFile == null)     return null;
  }
  final FileEditor[] editors=FileEditorManager.getInstance(psiFile.getProject()).getEditors(virtualFile);
  for (  FileEditor editor : editors) {
    if (editor instanceof TextEditor) {
      return ((TextEditor)editor).getEditor();
    }
  }
  return null;
}
