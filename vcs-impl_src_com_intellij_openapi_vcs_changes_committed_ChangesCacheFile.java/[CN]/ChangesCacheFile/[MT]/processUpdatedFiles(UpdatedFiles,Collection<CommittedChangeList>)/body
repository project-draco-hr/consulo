{
  boolean haveUnaccountedUpdatedFiles=false;
  openStreams();
  loadHeader();
  ReceivedChangeListTracker tracker=new ReceivedChangeListTracker();
  try {
    final List<IncomingChangeListData> incomingData=loadIncomingChangeListData();
    for (    FileGroup group : updatedFiles.getTopLevelGroups()) {
      haveUnaccountedUpdatedFiles|=processGroup(group,incomingData,tracker);
    }
    if (!haveUnaccountedUpdatedFiles) {
      for (      IncomingChangeListData data : incomingData) {
        saveIncoming(data);
      }
      writeHeader();
    }
  }
  finally {
    closeStreams();
  }
  receivedChanges.addAll(tracker.getChangeLists());
  return haveUnaccountedUpdatedFiles;
}
