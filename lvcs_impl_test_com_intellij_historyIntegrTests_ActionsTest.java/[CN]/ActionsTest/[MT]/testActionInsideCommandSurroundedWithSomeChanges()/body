{
  final VirtualFile f=root.createChildData(null,"f.java");
  CommandProcessor.getInstance().executeCommand(myProject,new RunnableAdapter(){
    @Override public void doRun() throws IOException {
      f.setBinaryContent(new byte[]{0});
      setDocumentTextFor(f,new byte[]{1});
      LocalHistoryAction a=LocalHistory.startAction(myProject,"action");
      setDocumentTextFor(f,new byte[]{2});
      a.finish();
      saveDocument(f);
      f.setBinaryContent(new byte[]{3});
    }
  }
,"command",null);
  List<Revision> rr=getVcsRevisionsFor(f);
  assertEquals(3,rr.size());
  assertEquals(3,contentOf(rr.get(0))[0]);
  assertEquals(1,contentOf(rr.get(1))[0]);
  assertTrue(contentOf(rr.get(2)).length == 0);
  assertEquals("command",rr.get(0).getCauseChangeName());
  assertNull(rr.get(1).getCauseChangeName());
  assertNull(rr.get(2).getCauseChangeName());
}
