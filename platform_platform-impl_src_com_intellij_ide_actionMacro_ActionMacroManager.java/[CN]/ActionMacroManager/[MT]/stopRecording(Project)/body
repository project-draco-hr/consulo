{
  LOG.assertTrue(myIsRecording);
  if (myWidget != null) {
    myWidget.delete();
    myWidget=null;
  }
  myIsRecording=false;
  myLastActionInputEvent.clear();
  String macroName;
  do {
    macroName=Messages.showInputDialog(project,IdeBundle.message("prompt.enter.macro.name"),IdeBundle.message("title.enter.macro.name"),Messages.getQuestionIcon());
    if (macroName == null) {
      myRecordingMacro=null;
      return;
    }
    if ("".equals(macroName))     macroName=null;
  }
 while (macroName != null && !checkCanCreateMacro(macroName));
  myLastMacro=myRecordingMacro;
  addRecordedMacroWithName(macroName);
  registerActions();
}
