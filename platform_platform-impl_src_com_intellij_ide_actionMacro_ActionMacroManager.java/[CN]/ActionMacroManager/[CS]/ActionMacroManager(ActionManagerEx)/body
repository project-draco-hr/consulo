{
  myActionManager=actionManagerEx;
  myActionManager.addAnActionListener(new AnActionListener(){
    public void beforeActionPerformed(    AnAction action,    DataContext dataContext,    AnActionEvent event){
      if (myIsRecording) {
        String id=myActionManager.getId(action);
        if (id != null && !"StartStopMacroRecording".equals(id)) {
          myRecordingMacro.appendAction(id);
        }
        if (id != null) {
          myLastActionInputEvent=event.getInputEvent();
        }
 else {
          myLastActionInputEvent=null;
        }
      }
    }
    public void beforeEditorTyping(    char c,    DataContext dataContext){
    }
    public void afterActionPerformed(    final AnAction action,    final DataContext dataContext,    final AnActionEvent event){
      IdeEventQueue.getInstance().doWhenReady(new Runnable(){
        @Override public void run(){
          if (myLastActionInputEvent != null && myLastActionInputEvent.equals(event.getInputEvent())) {
            myLastActionInputEvent=null;
          }
        }
      }
);
    }
  }
);
  myKeyProcessor=new MyKeyPostpocessor();
  IdeEventQueue.getInstance().addPostprocessor(myKeyProcessor,null);
}
