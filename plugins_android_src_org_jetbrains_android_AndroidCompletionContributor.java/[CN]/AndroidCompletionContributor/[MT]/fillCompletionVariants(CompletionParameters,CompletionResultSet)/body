{
  PsiElement position=parameters.getPosition();
  AndroidFacet facet=AndroidFacet.getInstance(position);
  if (facet == null) {
    return;
  }
  PsiElement parent=position.getParent();
  if (parent instanceof XmlTag) {
    XmlTag tag=(XmlTag)parent;
    if (tag.getParentTag() != null) {
      return;
    }
    final ASTNode startTagName=XmlChildRole.START_TAG_NAME_FINDER.findChild(tag.getNode());
    if (startTagName == null || startTagName.getPsi() != position) {
      return;
    }
    final PsiFile file=tag.getContainingFile();
    if (!(file instanceof XmlFile)) {
      return;
    }
    final PsiReference reference=file.findReferenceAt(parameters.getOffset());
    if (reference != null) {
      final PsiElement element=reference.getElement();
      if (element != null) {
        final int refOffset=element.getTextRange().getStartOffset() + reference.getRangeInElement().getStartOffset();
        if (refOffset != position.getTextRange().getStartOffset()) {
          return;
        }
      }
    }
    if (!completeTagNames(facet,(XmlFile)file,resultSet)) {
      resultSet.stopHere();
    }
  }
 else   if (parent instanceof XmlAttribute) {
    final ASTNode attrName=XmlChildRole.ATTRIBUTE_NAME_FINDER.findChild(parent.getNode());
    if (attrName == null || attrName.getPsi() != position || position.getText().startsWith("android:")) {
      return;
    }
    final PsiElement gp=parent.getParent();
    if (!(gp instanceof XmlTag)) {
      return;
    }
    final DomElement element=DomManager.getDomManager(gp.getProject()).getDomElement((XmlTag)gp);
    if (!(element instanceof LayoutElement) && !(element instanceof PreferenceElement)) {
      return;
    }
    final String prefix=((XmlTag)gp).getPrefixByNamespace(SdkConstants.NS_RESOURCES);
    if (prefix == null || prefix.length() < 3) {
      return;
    }
    final LookupElementBuilder e=LookupElementBuilder.create(prefix + ":").withTypeText("[Namespace Prefix]",true);
    resultSet.addElement(PrioritizedLookupElement.withPriority(e,Double.MAX_VALUE));
  }
}
