{
  final Object psiFile=dataProvider.getData(LangDataKeys.PSI_FILE.getName());
  if (psiFile instanceof PsiJavaFile) {
    return new JavaAnalysisScope((PsiJavaFile)psiFile);
  }
  Object psiTarget=dataProvider.getData(LangDataKeys.PSI_ELEMENT.getName());
  if (psiTarget instanceof PsiPackage) {
    PsiPackage pack=(PsiPackage)psiTarget;
    PsiManager manager=pack.getManager();
    if (!manager.isInProject(pack))     return null;
    PsiDirectory[] dirs=pack.getDirectories(GlobalSearchScope.projectScope(manager.getProject()));
    if (dirs.length == 0)     return null;
    return new JavaAnalysisScope(pack,(Module)dataProvider.getData(LangDataKeys.MODULE.getName()));
  }
  return null;
}
