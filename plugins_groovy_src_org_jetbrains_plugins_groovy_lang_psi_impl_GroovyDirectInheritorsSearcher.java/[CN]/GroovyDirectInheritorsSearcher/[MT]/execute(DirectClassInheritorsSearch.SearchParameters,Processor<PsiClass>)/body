{
  final PsiClass clazz=queryParameters.getClassToProcess();
  final SearchScope scope=queryParameters.getScope();
  if (scope instanceof GlobalSearchScope) {
    final GroovyCachesManager cachesManager=GroovyCachesManager.getInstance(clazz.getProject());
    return ApplicationManager.getApplication().runReadAction(new Computable<Boolean>(){
      public Boolean compute(){
        final PsiClass[] candidates=cachesManager.getDeriverCandidates(clazz,(GlobalSearchScope)scope);
        for (        PsiClass candidate : candidates) {
          if (candidate.isInheritor(clazz,false)) {
            if (!consumer.process(candidate))             return false;
          }
        }
        return true;
      }
    }
);
  }
  return true;
}
