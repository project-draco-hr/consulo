{
  final Module module=ModuleUtil.findModuleForPsiElement(file);
  if (module != null) {
    final String sdkHome=GantUtils.getSdkHomeFromClasspath(module);
    if (sdkHome != null) {
      return baseScope;
    }
  }
  final GradleSettings gantSettings=GradleSettings.getInstance(file.getProject());
  final VirtualFile home=gantSettings.getSdkHome();
  if (home == null) {
    return baseScope;
  }
  final List<VirtualFile> files=gantSettings.getClassRoots();
  if (files.isEmpty()) {
    return baseScope;
  }
  GlobalSearchScope result=baseScope;
  for (  final VirtualFile root : files) {
    result=result.uniteWith(new NonClasspathDirectoryScope(root));
  }
  return result;
}
