{
  final Module module=ModuleUtil.findModuleForPsiElement(file);
  if (module != null) {
    if (GradleLibraryManager.getSdkHomeFromClasspath(module) != null) {
      return baseScope;
    }
  }
  final GradleSettings gradleSettings=GradleSettings.getInstance(file.getProject());
  final VirtualFile home=gradleSettings.getSdkHome();
  if (home == null) {
    return baseScope;
  }
  final List<VirtualFile> files=gradleSettings.getClassRoots();
  if (files.isEmpty()) {
    return baseScope;
  }
  GlobalSearchScope result=baseScope;
  for (  final VirtualFile root : files) {
    result=result.uniteWith(new NonClasspathDirectoryScope(root));
  }
  return result;
}
