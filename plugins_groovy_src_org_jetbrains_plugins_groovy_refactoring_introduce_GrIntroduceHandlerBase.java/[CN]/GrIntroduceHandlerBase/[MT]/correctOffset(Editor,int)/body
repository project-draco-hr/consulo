{
  Document document=editor.getDocument();
  CharSequence text=document.getCharsSequence();
  int correctedOffset=offset;
  int textLength=document.getTextLength();
  if (offset >= textLength) {
    correctedOffset=textLength - 1;
  }
 else   if (!Character.isJavaIdentifierPart(text.charAt(offset))) {
    correctedOffset--;
  }
  if (correctedOffset < 0) {
    correctedOffset=offset;
  }
 else {
    final char c=text.charAt(correctedOffset);
    if (!Character.isJavaIdentifierPart(c)) {
      if (c == ';') {
        correctedOffset--;
      }
      if (c != ')' && c != ']' && c != '}' && c != '\'' && c != '"' && c != '/') {
        correctedOffset=offset;
      }
    }
  }
  return correctedOffset;
}
