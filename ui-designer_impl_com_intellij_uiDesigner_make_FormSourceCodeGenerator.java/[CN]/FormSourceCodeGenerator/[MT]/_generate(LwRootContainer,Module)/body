{
  myBuffer=new StringBuffer();
  myIsFirstParameterStack=new Stack<Boolean>();
  final HashMap<LwComponent,String> component2variable=new HashMap<LwComponent,String>();
  final TObjectIntHashMap<String> class2variableIndex=new TObjectIntHashMap<String>();
  final HashMap<String,LwComponent> id2component=new HashMap<String,LwComponent>();
  if (rootContainer.getComponentCount() != 1) {
    throw new CodeGenerationException(UIDesignerBundle.message("error.one.toplevel.component.required"));
  }
  final LwComponent topComponent=(LwComponent)rootContainer.getComponent(0);
  if (containsNotEmptyPanelsWithXYLayout(topComponent)) {
    throw new CodeGenerationException(UIDesignerBundle.message("error.nonempty.xy.panels.found"));
  }
  generateSetupCodeForComponent(topComponent,component2variable,class2variableIndex,id2component,module);
  generateComponentReferenceProperties(topComponent,component2variable,class2variableIndex,id2component);
  generateButtonGroups(rootContainer,component2variable,class2variableIndex,id2component);
  final String methodText=myBuffer.toString();
  final PsiManager psiManager=PsiManager.getInstance(module.getProject());
  final PsiElementFactory elementFactory=psiManager.getElementFactory();
  final PsiClass aClass=FormEditingUtil.findClassToBind(module,rootContainer.getClassToBind());
  if (aClass == null) {
    throw new ClassToBindNotFoundException(UIDesignerBundle.message("error.class.to.bind.not.found",rootContainer.getClassToBind()));
  }
  cleanup(aClass);
  final PsiClass fakeClass=elementFactory.createClassFromText("{\n" + "// GUI initializer generated by " + ApplicationNamesInfo.getInstance().getFullProductName() + " GUI Designer \n"+ "// >>> IMPORTANT!! <<<\n"+ "// DO NOT EDIT OR ADD ANY CODE HERE!\n"+ ""+ METHOD_NAME+ "();\n"+ "}\n"+ "\n"+ "/** Method generated by "+ ApplicationNamesInfo.getInstance().getFullProductName()+ " GUI Designer\n"+ " * >>> IMPORTANT!! <<<\n"+ " * DO NOT edit this method OR call it in your code!\t"+ " */\n"+ "private void "+ METHOD_NAME+ "()\n"+ "{\n"+ methodText+ "}\n",null);
  final PsiElement method=aClass.add(fakeClass.getMethods()[0]);
  final PsiElement initializer=aClass.addBefore(fakeClass.getInitializers()[0],method);
  PsiMethod grcMethod=null;
  PsiMethod[] grcMethods=aClass.findMethodsByName(AsmCodeGenerator.GET_ROOT_COMPONENT_METHOD_NAME,false);
  if (topComponent.getBinding() == null) {
    for (    PsiMethod oldGrcMethod : grcMethods) {
      oldGrcMethod.delete();
    }
  }
 else {
    grcMethod=elementFactory.createMethodFromText("public javax.swing.JComponent " + AsmCodeGenerator.GET_ROOT_COMPONENT_METHOD_NAME + "() { return "+ topComponent.getBinding()+ "; }",aClass);
    if (grcMethods.length > 0) {
      grcMethods[0].replace(grcMethod);
    }
 else {
      aClass.addAfter(grcMethod,method);
    }
  }
  final CodeStyleManager codeStyleManager=CodeStyleManager.getInstance(module.getProject());
  codeStyleManager.shortenClassReferences(method);
  codeStyleManager.reformat(method);
  codeStyleManager.shortenClassReferences(initializer);
  codeStyleManager.reformat(initializer);
  if (grcMethod != null) {
    codeStyleManager.shortenClassReferences(grcMethod);
    codeStyleManager.reformat(grcMethod);
  }
}
