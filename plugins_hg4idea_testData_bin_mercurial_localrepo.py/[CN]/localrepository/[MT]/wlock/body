def wlock(self, wait=True):
    'Lock the non-store parts of the repository (everything under\n        .hg except .hg/store) and return a weak reference to the lock.\n        Use this before modifying files in .hg.'
    l = (self._wlockref and self._wlockref())
    if ((l is not None) and l.held):
        l.lock()
        return l
    l = self._lock(self.join('wlock'), wait, self.dirstate.write, self.dirstate.invalidate, (_('working directory of %s') % self.origroot))
    self._wlockref = weakref.ref(l)
    return l
