def _readbranchcache(self):
    partial = {}
    try:
        f = self.opener('branchheads.cache')
        lines = f.read().split('\n')
        f.close()
    except (IOError, OSError):
        return ({}, nullid, nullrev)
    try:
        (last, lrev) = lines.pop(0).split(' ', 1)
        (last, lrev) = (bin(last), int(lrev))
        if ((lrev >= len(self)) or (self[lrev].node() != last)):
            raise ValueError('invalidating branch cache (tip differs)')
        for l in lines:
            if (not l):
                continue
            (node, label) = l.split(' ', 1)
            partial.setdefault(label.strip(), []).append(bin(node))
    except KeyboardInterrupt:
        raise
    except Exception as inst:
        if self.ui.debugflag:
            self.ui.warn(str(inst), '\n')
        (partial, last, lrev) = ({}, nullid, nullrev)
    return (partial, last, lrev)
