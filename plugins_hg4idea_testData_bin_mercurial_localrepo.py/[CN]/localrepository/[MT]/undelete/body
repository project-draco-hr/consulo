def undelete(self, list):
    manifests = [self.manifest.read(self.changelog.read(p)[0]) for p in self.dirstate.parents() if (p != nullid)]
    wlock = self.wlock()
    try:
        for f in list:
            if (self.dirstate[f] != 'r'):
                self.ui.warn((_('%s not removed!\n') % f))
            else:
                m = (((f in manifests[0]) and manifests[0]) or manifests[1])
                t = self.file(f).read(m[f])
                self.wwrite(f, t, m.flags(f))
                self.dirstate.normal(f)
    finally:
        wlock.release()
