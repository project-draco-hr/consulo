def copy(self, source, dest):
    p = self.wjoin(dest)
    if (not (os.path.exists(p) or os.path.islink(p))):
        self.ui.warn((_('%s does not exist!\n') % dest))
    elif (not (os.path.isfile(p) or os.path.islink(p))):
        self.ui.warn((_('copy failed: %s is not a file or a symbolic link\n') % dest))
    else:
        wlock = self.wlock()
        try:
            if (self.dirstate[dest] in '?r'):
                self.dirstate.add(dest)
            self.dirstate.copy(source, dest)
        finally:
            wlock.release()
