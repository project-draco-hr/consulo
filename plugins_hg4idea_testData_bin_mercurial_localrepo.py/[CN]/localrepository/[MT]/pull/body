def pull(self, remote, heads=None, force=False):
    lock = self.lock()
    try:
        (common, fetch, rheads) = self.findcommonincoming(remote, heads=heads, force=force)
        if (not fetch):
            self.ui.status(_('no changes found\n'))
            return 0
        if (fetch == [nullid]):
            self.ui.status(_('requesting all changes\n'))
        elif ((heads is None) and remote.capable('changegroupsubset')):
            heads = rheads
        if (heads is None):
            cg = remote.changegroup(fetch, 'pull')
        else:
            if (not remote.capable('changegroupsubset')):
                raise util.Abort(_("Partial pull cannot be done because other repository doesn't support changegroupsubset."))
            cg = remote.changegroupsubset(fetch, heads, 'pull')
        return self.addchangegroup(cg, 'pull', remote.url())
    finally:
        lock.release()
