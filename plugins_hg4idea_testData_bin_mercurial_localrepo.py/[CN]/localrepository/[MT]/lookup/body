def lookup(self, key):
    if isinstance(key, int):
        return self.changelog.node(key)
    elif (key == '.'):
        return self.dirstate.parents()[0]
    elif (key == 'null'):
        return nullid
    elif (key == 'tip'):
        return self.changelog.tip()
    n = self.changelog._match(key)
    if n:
        return n
    if (key in self.tags()):
        return self.tags()[key]
    if (key in self.branchtags()):
        return self.branchtags()[key]
    n = self.changelog._partialmatch(key)
    if n:
        return n
    if (key in self.dirstate.parents()):
        raise error.Abort((_("working directory has unknown parent '%s'!") % short(key)))
    try:
        if (len(key) == 20):
            key = hex(key)
    except:
        pass
    raise error.RepoLookupError((_("unknown revision '%s'") % key))
