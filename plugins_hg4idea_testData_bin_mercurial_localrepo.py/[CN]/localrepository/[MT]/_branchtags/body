def _branchtags(self, partial, lrev):
    tiprev = (len(self) - 1)
    if (lrev != tiprev):
        ctxgen = (self[r] for r in xrange((lrev + 1), (tiprev + 1)))
        self._updatebranchcache(partial, ctxgen)
        self._writebranchcache(partial, self.changelog.tip(), tiprev)
    return partial
