def lock(self, wait=True):
    'Lock the repository store (.hg/store) and return a weak reference\n        to the lock. Use this before modifying the store (e.g. committing or\n        stripping). If you are opening a transaction, get a lock as well.)'
    l = (self._lockref and self._lockref())
    if ((l is not None) and l.held):
        l.lock()
        return l
    l = self._lock(self.sjoin('lock'), wait, None, self.invalidate, (_('repository %s') % self.origroot))
    self._lockref = weakref.ref(l)
    return l
