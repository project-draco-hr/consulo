def changeset(web, req, tmpl):
    ctx = webutil.changectx(web.repo, req)
    showtags = webutil.showtag(web.repo, tmpl, 'changesettag', ctx.node())
    showbranch = webutil.nodebranchnodefault(ctx)
    files = []
    parity = paritygen(web.stripecount)
    for f in ctx.files():
        template = (((f in ctx) and 'filenodelink') or 'filenolink')
        files.append(tmpl(template, node=ctx.hex(), file=f, parity=parity.next()))
    parity = paritygen(web.stripecount)
    style = web.config('web', 'style', 'paper')
    if ('style' in req.form):
        style = req.form['style'][0]
    diffs = webutil.diffs(web.repo, tmpl, ctx, None, parity, style)
    return tmpl('changeset', diff=diffs, rev=ctx.rev(), node=ctx.hex(), parent=webutil.parents(ctx), child=webutil.children(ctx), changesettag=showtags, changesetbranch=showbranch, author=ctx.user(), desc=ctx.description(), date=ctx.date(), files=files, archives=web.archivelist(ctx.hex()), tags=webutil.nodetagsdict(web.repo, ctx.node()), branch=webutil.nodebranchnodefault(ctx), inbranch=webutil.nodeinbranch(web.repo, ctx), branches=webutil.nodebranchdict(web.repo, ctx))
