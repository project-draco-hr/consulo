{
  if (isPatternNegated(wildcardPattern)) {
    wildcardPattern=wildcardPattern.substring(1);
  }
  return wildcardPattern.replaceAll("\\\\!","!").replaceAll("\\.","\\\\.").replaceAll("\\*\\?",".+").replaceAll("\\?\\*",".+").replaceAll("\\*",".*").replaceAll("\\?",".").replaceAll("(?:\\.\\*)+",".*");
}
