{
  DataContext context=e.getDataContext();
  Editor editor=PlatformDataKeys.EDITOR.getData(context);
  PsiFile psiFile=LangDataKeys.PSI_FILE.getData(context);
  if (editor == null || psiFile == null)   return;
  PsiElement psiElement=psiFile.findElementAt(editor.getCaretModel().getOffset());
  if (psiElement == null)   psiElement=psiFile;
  List<GotoRelatedItem> items=new ArrayList<GotoRelatedItem>();
  for (  GotoRelatedProvider provider : Extensions.getExtensions(GotoRelatedProvider.EP_NAME)) {
    items.addAll(provider.getItems(psiElement));
  }
  if (items.isEmpty())   return;
  if (items.size() == 1) {
    items.get(0).navigate();
    return;
  }
  final JBList list=new JBList(new CollectionListModel(items));
  list.setCellRenderer(new ItemCellRenderer());
  JBPopupFactory.getInstance().createListPopupBuilder(list).setTitle("Goto Related").setItemChoosenCallback(new Runnable(){
    @Override public void run(){
      Object value=list.getSelectedValue();
      if (value instanceof GotoRelatedItem) {
        ((GotoRelatedItem)value).navigate();
      }
    }
  }
).createPopup().showInBestPositionFor(context);
}
