{
  @SuppressWarnings({"IOResourceOpenedButNotSafelyClosed"}) BufferedReader stdOutput=new BufferedReader(new InputStreamReader(psProcess.getInputStream()));
  BufferedReader stdError=new BufferedReader(new InputStreamReader(psProcess.getErrorStream()));
  try {
    String s;
    if (skipFirstLine) {
      stdOutput.readLine();
    }
    while ((s=stdOutput.readLine()) != null) {
      processor.process(s);
    }
    StringBuilder errorStr=new StringBuilder();
    while ((s=stdError.readLine()) != null) {
      if (s.contains("DYLD_ environment variables being ignored")) {
        continue;
      }
      errorStr.append(s).append("\n");
    }
    if (throwOnError && errorStr.length() > 0) {
      throw new IOException("Error reading ps output:" + errorStr.toString());
    }
  }
  finally {
    stdOutput.close();
    stdError.close();
  }
}
