{
  try {
    Process p=Runtime.getRuntime().exec(cmd);
    @SuppressWarnings({"IOResourceOpenedButNotSafelyClosed"}) BufferedReader stdOutput=new BufferedReader(new InputStreamReader(p.getInputStream()));
    BufferedReader stdError=new BufferedReader(new InputStreamReader(p.getErrorStream()));
    try {
      String s;
      stdOutput.readLine();
      while ((s=stdOutput.readLine()) != null) {
        processor.process(s);
      }
      StringBuilder errorStr=new StringBuilder();
      while ((s=stdError.readLine()) != null) {
        errorStr.append(s).append("\n");
      }
      if (errorStr.length() > 0) {
        throw new IllegalStateException("error:" + errorStr.toString());
      }
    }
  finally {
      stdOutput.close();
      stdError.close();
    }
  }
 catch (  IOException e) {
    throw new IllegalStateException(e);
  }
}
