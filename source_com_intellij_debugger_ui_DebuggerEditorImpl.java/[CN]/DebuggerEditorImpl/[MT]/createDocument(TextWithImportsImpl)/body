{
  LOG.assertTrue(myContext == null || myContext.isValid());
  if (item == null) {
    item=createText("");
  }
  PsiCodeFragment codeFragment=item.createCodeFragment(getContext(),getProject());
  if (myCurrentDocument != null) {
    for (Iterator<DocumentListener> iterator=myDocumentListeners.iterator(); iterator.hasNext(); ) {
      DocumentListener documentListener=iterator.next();
      myCurrentDocument.removeDocumentListener(documentListener);
    }
  }
  myCurrentDocument=PsiDocumentManager.getInstance(getProject()).getDocument(codeFragment);
  for (Iterator<DocumentListener> iterator=myDocumentListeners.iterator(); iterator.hasNext(); ) {
    DocumentListener documentListener=iterator.next();
    myCurrentDocument.addDocumentListener(documentListener);
  }
  return myCurrentDocument;
}
