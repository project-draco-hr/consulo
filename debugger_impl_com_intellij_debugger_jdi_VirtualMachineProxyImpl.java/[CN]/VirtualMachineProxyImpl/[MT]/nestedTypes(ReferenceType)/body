{
  List<ReferenceType> nestedTypes=myNestedClassesCache.get(refType);
  if (nestedTypes == null) {
    final List<ReferenceType> list=refType.nestedTypes();
    nestedTypes=new ArrayList<ReferenceType>(list.size());
    final ClassLoaderReference outerLoader=refType.classLoader();
    for (    ReferenceType type : list) {
      if (outerLoader == null ? type.classLoader() == null : outerLoader.equals(type.classLoader())) {
        nestedTypes.add(type);
      }
    }
    myNestedClassesCache.put(refType,nestedTypes);
  }
  return nestedTypes;
}
