{
  final RuntimeConfigurationProducer[] configurationProducers=ApplicationManager.getApplication().getExtensions(RuntimeConfigurationProducer.RUNTIME_CONFIGURATION_PRODUCER);
  final ArrayList<RuntimeConfigurationProducer> producers=new ArrayList<RuntimeConfigurationProducer>();
  for (  final RuntimeConfigurationProducer prototype : configurationProducers) {
    final RuntimeConfigurationProducer producer=prototype.createProducer(location,context);
    if (producer.getConfiguration() != null) {
      LOG.assertTrue(producer.getSourceElement() != null,producer);
      producers.add(producer);
    }
  }
  if (producers.isEmpty()) {
    final ConfigurationType[] factories=RunManager.getInstance(location.getProject()).getConfigurationTypes();
    for (    final ConfigurationType type : factories) {
      if (type instanceof LocatableConfigurationType) {
        final DefaultRuntimeConfigurationProducer prototype=new DefaultRuntimeConfigurationProducer(((LocatableConfigurationType)type));
        final RuntimeConfigurationProducer producer=prototype.createProducer(location,context);
        if (producer.getConfiguration() != null) {
          producers.add(producer);
        }
      }
    }
  }
  if (producers.isEmpty())   return null;
  Collections.sort(producers,RuntimeConfigurationProducer.COMPARATOR);
  final RuntimeConfigurationProducer first=producers.get(0);
  for (Iterator<RuntimeConfigurationProducer> it=producers.iterator(); it.hasNext(); ) {
    RuntimeConfigurationProducer producer=it.next();
    if (producer != first && RuntimeConfigurationProducer.COMPARATOR.compare(producer,first) >= 0) {
      it.remove();
    }
  }
  return producers;
}
