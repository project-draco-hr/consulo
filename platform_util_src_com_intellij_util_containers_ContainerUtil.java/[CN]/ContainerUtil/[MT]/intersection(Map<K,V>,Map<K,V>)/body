{
  final Map<K,V> res=newHashMap();
  final Set<K> keys=newHashSet();
  keys.addAll(map1.keySet());
  keys.addAll(map2.keySet());
  for (  K k : keys) {
    V v1=map1.get(k);
    V v2=map2.get(k);
    if (v1 == v2 || v1 != null && v1.equals(v2)) {
      res.put(k,v1);
    }
  }
  return res;
}
