{
  for (  ManagedLibrary existing : getUsedLibraries()) {
    if (existing.manager == manager) {
      @SuppressWarnings({"NonConstantStringShouldBeStringBuffer"}) String message="There is already a " + manager.getLibraryCategoryName() + " library";
      final String version=manager.getLibraryVersion(existing.library,myLibrariesContainer);
      if (StringUtil.isNotEmpty(version)) {
        message+=" of version " + version;
      }
      message+=".\n Do you want to replace the existing one?";
      final String replace="&Replace";
      final int result=Messages.showDialog(myComponent,message,"Library already exists",new String[]{replace,"&Add","&Cancel"},0,null);
      if (result == 2 || result < 0) {
        return;
      }
      if (result == 0) {
        doRemoveLibraries(new THashSet<Library>(Arrays.asList(existing.library)));
      }
    }
  }
  myEditorContext.getModifiableRootModel().addLibraryEntry(library);
}
