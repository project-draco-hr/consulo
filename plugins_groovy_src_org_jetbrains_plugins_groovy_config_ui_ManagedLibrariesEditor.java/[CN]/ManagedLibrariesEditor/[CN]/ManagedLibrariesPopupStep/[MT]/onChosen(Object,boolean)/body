{
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      if (selectedValue instanceof ManagedLibrary) {
        final ManagedLibrary managedLibrary=(ManagedLibrary)selectedValue;
        addLibraryCheckingExistings(managedLibrary.manager,managedLibrary.library);
      }
 else       if (selectedValue instanceof LibraryManager) {
        final LibraryManager manager=(LibraryManager)selectedValue;
        final Library library=new WriteAction<Library>(){
          protected void run(          Result<Library> result) throws Throwable {
            result.setResult(manager.createLibrary(myEditorContext));
          }
        }
.execute().getResultObject();
        if (library != null) {
          addLibraryCheckingExistings(manager,library);
        }
      }
      updateLibraryList();
    }
  }
,ModalityState.stateForComponent(myComponent));
  return FINAL_CHOICE;
}
