{
  return doFinalStep(new Runnable(){
    public void run(){
      if (selectedValue instanceof ManagedLibrary) {
        final ManagedLibrary managedLibrary=(ManagedLibrary)selectedValue;
        addLibraryCheckingExistings(managedLibrary.manager,managedLibrary.library);
      }
 else       if (selectedValue instanceof LibraryManager) {
        final LibraryManager manager=(LibraryManager)selectedValue;
        final Library library=manager.createLibrary(myEditorContext);
        if (library != null) {
          addLibraryCheckingExistings(manager,library);
        }
      }
      updateLibraryList();
    }
  }
);
}
