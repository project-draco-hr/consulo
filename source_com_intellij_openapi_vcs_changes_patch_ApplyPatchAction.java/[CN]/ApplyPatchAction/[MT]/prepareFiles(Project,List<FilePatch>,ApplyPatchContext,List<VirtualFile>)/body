{
  for (  FilePatch patch : patches) {
    VirtualFile fileToPatch;
    try {
      fileToPatch=patch.findFileToPatch(context.getPrepareContext());
    }
 catch (    IOException e) {
      Messages.showErrorDialog(project,"Error when searching for file to patch: " + patch.getBeforeName() + ": "+ e.getMessage(),VcsBundle.message("patch.apply.dialog.title"));
      return false;
    }
    if (fileToPatch != null && !ProjectRootManager.getInstance(project).getFileIndex().isInContent(fileToPatch) && ProjectLevelVcsManager.getInstance(project).getVcsRootFor(fileToPatch) == null) {
      Messages.showErrorDialog(project,"File to patch found outside content root: " + patch.getBeforeName(),VcsBundle.message("patch.apply.dialog.title"));
      return false;
    }
    if (fileToPatch != null && !fileToPatch.isDirectory()) {
      filesToMakeWritable.add(fileToPatch);
      FileType fileType=fileToPatch.getFileType();
      if (fileType == StdFileTypes.UNKNOWN) {
        fileType=FileTypeChooser.associateFileType(fileToPatch.getPresentableName());
        if (fileType == null) {
          return false;
        }
      }
    }
 else     if (patch.isNewFile()) {
      FileType fileType=FileTypeManager.getInstance().getFileTypeByFileName(patch.getBeforeFileName());
      if (fileType == StdFileTypes.UNKNOWN) {
        fileType=FileTypeChooser.associateFileType(patch.getBeforeFileName());
        if (fileType == null) {
          return false;
        }
      }
    }
  }
  return true;
}
