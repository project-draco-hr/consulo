{
  final Project project=e.getData(DataKeys.PROJECT);
  final ApplyPatchDialog dialog=new ApplyPatchDialog(project);
  final VirtualFile vFile=e.getData(DataKeys.VIRTUAL_FILE);
  if (vFile != null && vFile.getFileType() == StdFileTypes.PATCH) {
    dialog.setFileName(vFile.getPresentableUrl());
  }
  dialog.show();
  if (dialog.getExitCode() != DialogWrapper.OK_EXIT_CODE) {
    return;
  }
  applyPatch(project,dialog.getPatches(),dialog.getApplyPatchContext(),dialog.getSelectedChangeList());
}
