{
  for (  FilePatch patch : patches) {
    VirtualFile fileToPatch;
    try {
      fileToPatch=patch.findFileToPatch(baseDirectory,stripLeadingDirectories,false,false);
    }
 catch (    IOException e) {
      Messages.showErrorDialog(project,"Error when searching for file to patch: " + patch.getBeforeName() + ": "+ e.getMessage(),"Apply Patch");
      return false;
    }
    if (fileToPatch != null && !ProjectRootManager.getInstance(project).getFileIndex().isInContent(fileToPatch)) {
      Messages.showErrorDialog(project,"File to patch found outside content root: " + patch.getBeforeName(),"Apply Patch");
      return false;
    }
    if (fileToPatch != null && !fileToPatch.isDirectory()) {
      filesToMakeWritable.add(fileToPatch);
      FileType fileType=fileToPatch.getFileType();
      if (fileType == StdFileTypes.UNKNOWN) {
        fileType=FileTypeChooser.associateFileType(fileToPatch.getPresentableName());
        if (fileType == null) {
          return false;
        }
      }
    }
  }
  return true;
}
