{
  if (isSyncSearch()) {
    THashSet<PsiClass> classes=new THashSet<PsiClass>();
    boolean isJUnit4=ConfigurationUtil.findAllTestClasses(classFilter,classes);
    callback.found(classes,isJUnit4);
    return null;
  }
  final THashSet<PsiClass> classes=new THashSet<PsiClass>();
  final boolean[] isJunit4=new boolean[1];
  final MySearchForTestsTask task=new MySearchForTestsTask(classFilter,isJunit4,classes,callback);
  mySearchForTestsIndicator=new BackgroundableProcessIndicator(task){
    @Override public void cancel(){
      try {
        if (!myServerSocket.isClosed()) {
          new Socket(InetAddress.getLocalHost(),myServerSocket.getLocalPort());
        }
      }
 catch (      Throwable e) {
        LOG.info(e);
      }
      super.cancel();
    }
  }
;
  ProgressManagerImpl.runProcessWithProgressAsynchronously(task,mySearchForTestsIndicator);
  return task;
}
