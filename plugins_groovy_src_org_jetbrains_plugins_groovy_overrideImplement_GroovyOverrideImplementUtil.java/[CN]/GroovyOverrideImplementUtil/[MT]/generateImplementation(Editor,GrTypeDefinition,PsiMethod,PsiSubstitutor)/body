{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      final PsiElement anchor=findAnchor(aClass,editor);
      final GrMethod result=generateMethodPrototype(aClass,method,substitutor);
      final GrMethod addedMethod=aClass.addMemberDeclaration(result,anchor);
      PsiUtil.shortenReferences(addedMethod);
      PsiFile psiFile=aClass.getContainingFile();
      FileEditorManager fileEditorManager=FileEditorManager.getInstance(aClass.getProject());
      Editor editor=fileEditorManager.openTextEditor(new OpenFileDescriptor(psiFile.getProject(),psiFile.getVirtualFile()),false);
      if (editor == null)       return;
      GenerateMembersUtil.positionCaret(editor,addedMethod,true);
      editor.getScrollingModel().scrollToCaret(ScrollType.CENTER);
    }
  }
);
}
