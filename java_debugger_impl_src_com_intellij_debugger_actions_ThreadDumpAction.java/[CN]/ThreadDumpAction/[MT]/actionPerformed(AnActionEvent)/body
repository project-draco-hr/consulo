{
  final Project project=PlatformDataKeys.PROJECT.getData(e.getDataContext());
  if (project == null) {
    return;
  }
  DebuggerContextImpl context=(DebuggerManagerEx.getInstanceEx(project)).getContext();
  if (context.getDebuggerSession() != null) {
    final DebugProcessImpl process=context.getDebugProcess();
    process.getManagerThread().invoke(new DebuggerCommandImpl(){
      protected void action() throws Exception {
        final VirtualMachineProxyImpl vm=process.getVirtualMachineProxy();
        vm.suspend();
        try {
          final List<ThreadState> threads=buildThreadStates(vm);
          ApplicationManager.getApplication().invokeLater(new Runnable(){
            public void run(){
              UnscrambleDialog.addConsole(project,threads);
            }
          }
,ModalityState.NON_MODAL);
        }
  finally {
          vm.resume();
        }
      }
    }
);
  }
}
