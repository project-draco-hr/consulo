{
  final Object parent=WindowManager.getInstance().suggestParentWindow(project);
  logger.debug("suggested parent window=" + parent);
  final JDialog dialog=parent == null ? new JDialog() : (parent instanceof JDialog ? new JDialog((JDialog)parent) : new JDialog((JFrame)parent));
  final Container pane=dialog.getContentPane();
  final JLabel rearrangingLabel=new JLabel("Rearranging files, please wait...");
  final JPanel progressPanel=new JPanel(new GridBagLayout());
  final GridBagConstraints constraints=new GridBagConstraints();
  constraints.anchor=GridBagConstraints.NORTHWEST;
  constraints.gridx=0;
  constraints.gridy=0;
  constraints.fill=GridBagConstraints.NONE;
  constraints.gridwidth=GridBagConstraints.REMAINDER;
  constraints.gridheight=1;
  constraints.weightx=1;
  constraints.insets=new Insets(15,15,0,0);
  progressPanel.add(rearrangingLabel,constraints);
  constraints.gridwidth=1;
  constraints.gridy=1;
  bar.setMinimum(0);
  bar.setMaximum(max);
  bar.setPreferredSize(new Dimension(500,15));
  bar.setMinimumSize(new Dimension(500,15));
  bar.setStringPainted(true);
  constraints.insets=new Insets(15,15,5,15);
  progressPanel.add(bar,constraints);
  constraints.gridwidth=GridBagConstraints.REMAINDER;
  constraints.gridx=1;
  constraints.insets=new Insets(9,0,5,15);
  final JButton cancelButton=new JButton("Cancel");
  cancelButton.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      logger.debug("cancel button pressed");
      filename.setText("cancelling...");
      cancellableObject.setCancel();
    }
  }
);
  progressPanel.add(cancelButton,constraints);
  constraints.gridx=0;
  constraints.gridy=2;
  constraints.weighty=1;
  constraints.anchor=GridBagConstraints.NORTHWEST;
  constraints.gridheight=GridBagConstraints.REMAINDER;
  constraints.insets=new Insets(0,15,15,0);
  filename.setSize(500,15);
  filename.setPreferredSize(new Dimension(500,15));
  progressPanel.add(filename,constraints);
  pane.add(progressPanel,BorderLayout.CENTER);
  dialog.setTitle("Rearranger");
  dialog.addWindowListener(new WindowListener(){
    public void windowClosed(    final WindowEvent e){
    }
    public void windowActivated(    final WindowEvent e){
    }
    public void windowClosing(    final WindowEvent e){
      logger.debug("dialog closed, cancel Rearranger");
      filename.setText("cancelling...");
      cancellableObject.setCancel();
    }
    public void windowDeactivated(    final WindowEvent e){
    }
    public void windowDeiconified(    final WindowEvent e){
    }
    public void windowIconified(    final WindowEvent e){
    }
    public void windowOpened(    final WindowEvent e){
    }
  }
);
  dialog.pack();
  return dialog;
}
