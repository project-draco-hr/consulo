{
  Processor<ComponentItem> processor=new Processor<ComponentItem>(){
    public boolean process(    final ComponentItem selectedValue){
      if (selectedValue != null) {
        myLastCreatedComponent=selectedValue;
        editor.getMainProcessor().startInsertProcessor(selectedValue,getCreateLocation(editor,selection));
      }
      return true;
    }
  }
;
  PaletteListPopupStep step=new PaletteListPopupStep(editor,myLastCreatedComponent,processor,UIDesignerBundle.message("create.component.title"));
  final ListPopup listPopup=JBPopupFactory.getInstance().createListPopup(step);
  if (selection.size() > 0) {
    FormEditingUtil.showPopupUnderComponent(listPopup,selection.get(0));
  }
 else {
    listPopup.showInCenterOf(editor.getRootContainer().getDelegee());
  }
}
