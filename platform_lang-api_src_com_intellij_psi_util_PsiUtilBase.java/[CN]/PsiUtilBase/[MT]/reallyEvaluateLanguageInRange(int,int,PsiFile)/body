{
  Language lang=null;
  int curOffset=start;
  do {
    PsiElement elt=getElementAtOffset(file,curOffset);
    if (!(elt instanceof PsiWhiteSpace)) {
      final Language language=findLanguageFromElement(elt);
      if (lang == null) {
        lang=language;
      }
 else       if (lang != language) {
        return null;
      }
    }
    int endOffset=elt.getTextRange().getEndOffset();
    curOffset=endOffset <= curOffset ? curOffset + 1 : endOffset;
  }
 while (curOffset < end);
  return narrowLanguage(lang,file.getLanguage());
}
