{
  PsiFile psiFile=element.getContainingFile();
  if (psiFile == null) {
    return null;
  }
  VirtualFile virtualFile=psiFile.getOriginalFile().getVirtualFile();
  if (virtualFile == null) {
    return null;
  }
  VirtualFileSystem fileSystem=virtualFile.getFileSystem();
  if (fileSystem instanceof LocalFileSystem) {
    final FileEditor[] editors=FileEditorManager.getInstance(psiFile.getProject()).getEditors(virtualFile);
    for (    FileEditor editor : editors) {
      if (editor instanceof TextEditor) {
        return ((TextEditor)editor).getEditor();
      }
    }
  }
 else   if (SwingUtilities.isEventDispatchThread()) {
    AsyncResult<DataContext> asyncResult=DataManager.getInstance().getDataContextFromFocus();
    if (asyncResult.isDone()) {
      Editor editor=CommonDataKeys.EDITOR.getData(asyncResult.getResult());
      if (editor != null) {
        Document cachedDocument=PsiDocumentManager.getInstance(psiFile.getProject()).getCachedDocument(psiFile);
        if (cachedDocument == editor.getDocument()) {
          return editor;
        }
      }
    }
  }
  return null;
}
