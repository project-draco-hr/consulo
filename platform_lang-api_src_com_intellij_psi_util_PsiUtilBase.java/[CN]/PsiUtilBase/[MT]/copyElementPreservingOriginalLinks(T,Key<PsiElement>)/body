{
  final PsiElementVisitor originalVisitor=new PsiRecursiveElementWalkingVisitor(){
    public void visitElement(    final PsiElement element){
      element.putCopyableUserData(originalKey,element);
      super.visitElement(element);
    }
  }
;
  originalVisitor.visitElement(element);
  final PsiElement fileCopy=element.copy();
  final PsiElementVisitor copyVisitor=new PsiRecursiveElementWalkingVisitor(){
    public void visitElement(    final PsiElement element){
      final PsiElement originalElement=element.getCopyableUserData(originalKey);
      if (originalElement != null) {
        originalElement.putCopyableUserData(originalKey,null);
        element.putCopyableUserData(originalKey,null);
        element.putUserData(originalKey,originalElement);
      }
      super.visitElement(element);
    }
  }
;
  copyVisitor.visitElement(fileCopy);
  return (T)fileCopy;
}
