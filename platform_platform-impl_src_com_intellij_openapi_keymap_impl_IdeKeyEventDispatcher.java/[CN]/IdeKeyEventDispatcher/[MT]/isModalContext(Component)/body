{
  Window window=UIUtil.getWindow(component);
  if (window instanceof IdeFrameImpl) {
    final Component pane=((IdeFrameImpl)window).getGlassPane();
    if (pane instanceof IdeGlassPaneEx) {
      return ((IdeGlassPaneEx)pane).isInModalContext();
    }
  }
  if (window instanceof JDialog) {
    final JDialog dialog=(JDialog)window;
    if (!dialog.isModal()) {
      final Window owner=dialog.getOwner();
      return owner != null && isModalContext(owner);
    }
  }
  if (window instanceof JFrame) {
    return false;
  }
  boolean isMainFrame=window instanceof IdeFrameImpl;
  boolean isFloatingDecorator=window instanceof FloatingDecorator;
  boolean isPopup=!(component instanceof JFrame) && !(component instanceof JDialog);
  if (isPopup) {
    if (component instanceof JWindow) {
      JBPopup popup=(JBPopup)((JWindow)component).getRootPane().getClientProperty(JBPopup.KEY);
      if (popup != null) {
        return popup.isModalContext();
      }
    }
  }
  return !isMainFrame && !isFloatingDecorator;
}
