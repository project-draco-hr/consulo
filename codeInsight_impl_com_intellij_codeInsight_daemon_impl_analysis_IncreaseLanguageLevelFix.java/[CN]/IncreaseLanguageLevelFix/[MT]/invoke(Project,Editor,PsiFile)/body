{
  Module module=ModuleUtil.findModuleForFile(file.getVirtualFile(),project);
  LanguageLevel moduleLevel=module == null ? null : LanguageLevelModuleExtension.getInstance(module).getLanguageLevel();
  Sdk jdk=getRelevantJdk(project,module);
  if (moduleLevel != null && isJdkSupportsLevel(jdk)) {
    final ModifiableRootModel rootModel=ModuleRootManager.getInstance(module).getModifiableModel();
    rootModel.getModuleExtension(LanguageLevelModuleExtension.class).setLanguageLevel(myLevel);
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      public void run(){
        rootModel.commit();
      }
    }
);
  }
 else {
    LanguageLevelProjectExtension.getInstance(project).setLanguageLevel(myLevel);
  }
}
