{
  saveFiles(instanceFile,schemaFile);
  final MessageViewHelper helper=new MessageViewHelper(project,CONTENT_NAME,KEY);
  helper.openMessageView(new Runnable(){
    public void run(){
      doRun(project,instanceFile,schemaFile);
    }
  }
);
  final Future<?> future=ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        public void run(){
          final MessageViewHelper.ErrorHandler eh=helper.new ErrorHandler();
          instanceFile.putUserData(IN_PROGRESS_KEY,Boolean.TRUE);
          try {
            doValidation(instanceFile,schemaFile,eh);
          }
  finally {
            instanceFile.putUserData(IN_PROGRESS_KEY,null);
          }
          SwingUtilities.invokeLater(new Runnable(){
            public void run(){
              if (!eh.hadErrorOrWarning()) {
                SwingUtilities.invokeLater(new Runnable(){
                  public void run(){
                    helper.close();
                    WindowManager.getInstance().getStatusBar(project).setInfo("No errors detected");
                  }
                }
);
              }
            }
          }
);
        }
      }
);
    }
  }
);
  helper.setProcessController(new NewErrorTreeViewPanel.ProcessController(){
    public void stopProcess(){
      future.cancel(true);
    }
    public boolean isProcessStopped(){
      return future.isDone();
    }
  }
);
}
