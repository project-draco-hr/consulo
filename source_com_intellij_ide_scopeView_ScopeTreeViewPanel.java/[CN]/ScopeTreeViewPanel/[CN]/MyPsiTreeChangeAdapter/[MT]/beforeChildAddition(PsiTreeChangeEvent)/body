{
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      if (myProject.isDisposed())       return;
      final PsiElement element=event.getParent();
      myTreeExpansionMonitor.freeze();
      if (element instanceof PsiDirectory || element instanceof PsiPackage) {
        final PsiElement child=event.getChild();
        if (child instanceof PsiFile) {
          final PackageDependenciesNode rootToReload=myBuilder.addFileNode((PsiFile)child);
          final DefaultTreeModel treeModel=(DefaultTreeModel)myTree.getModel();
          if (rootToReload != null) {
            TreeUtil.sort(rootToReload,new DependencyNodeComparator());
            treeModel.reload(rootToReload);
            collapseExpand(rootToReload);
          }
 else {
            TreeUtil.sort(treeModel,new DependencyNodeComparator());
            treeModel.reload();
            selectCurrentScope();
          }
        }
      }
      myTreeExpansionMonitor.restore();
    }
  }
,ModalityState.NON_MMODAL);
}
