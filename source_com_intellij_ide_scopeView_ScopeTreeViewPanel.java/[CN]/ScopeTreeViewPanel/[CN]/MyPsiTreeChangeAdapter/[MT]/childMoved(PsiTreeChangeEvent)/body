{
  final PsiElement oldParent=event.getOldParent();
  final PsiElement newParent=event.getNewParent();
  final PsiElement child=event.getChild();
  if (oldParent instanceof PsiDirectory && newParent instanceof PsiDirectory) {
    if (child instanceof PsiFile) {
      final PsiFile file=(PsiFile)child;
      queueUpdate(new Runnable(){
        public void run(){
          collapseExpand(myBuilder.removeNode(child,(PsiDirectory)oldParent));
          final VirtualFile virtualFile=file.getVirtualFile();
          if (virtualFile != null) {
            final PsiFile newFile=file.isValid() ? file : PsiManager.getInstance(myProject).findFile(virtualFile);
            if (newFile != null) {
              collapseExpand(myBuilder.addFileNode(newFile));
            }
          }
        }
      }
,true);
    }
  }
}
