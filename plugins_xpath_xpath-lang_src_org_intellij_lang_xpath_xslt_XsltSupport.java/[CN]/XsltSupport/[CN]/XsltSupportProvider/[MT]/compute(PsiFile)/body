{
  if (psiFile instanceof PsiFileEx) {
    if (((PsiFileEx)psiFile).isContentsLoaded()) {
      final XmlDocument doc=((XmlFile)psiFile).getDocument();
      if (doc != null) {
        final XmlTag rootTag=doc.getRootTag();
        if (rootTag != null) {
          XmlAttribute v;
          XsltChecker.SupportLevel level;
          if (isXsltRootTag(rootTag)) {
            v=rootTag.getAttribute("version");
            level=v != null ? XsltChecker.getSupportLevel(v.getValue()) : XsltChecker.SupportLevel.NONE;
          }
 else {
            v=rootTag.getAttribute("version",XSLT_NS);
            level=v != null ? XsltChecker.getSupportLevel(v.getValue()) : XsltChecker.SupportLevel.NONE;
          }
          return CachedValueProvider.Result.create(level,rootTag);
        }
      }
    }
  }
  final XsltChecker xsltChecker=new XsltChecker();
  NanoXmlUtil.parseFile(psiFile,xsltChecker);
  return CachedValueProvider.Result.create(xsltChecker.getSupportLevel(),psiFile);
}
