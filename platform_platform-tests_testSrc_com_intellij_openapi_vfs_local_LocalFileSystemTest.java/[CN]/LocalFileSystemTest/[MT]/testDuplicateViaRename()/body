{
  new WriteAction(){
    @Override protected void run(    @NotNull Result result) throws Throwable {
      VirtualFile tempDir=myFS.refreshAndFindFileByIoFile(createTempDirectory());
      assertNotNull(tempDir);
      VirtualFile file1=tempDir.createChildData(this,"a.txt");
      FileUtil.delete(VfsUtilCore.virtualToIoFile(file1));
      VirtualFile file2=tempDir.createChildData(this,"b.txt");
      try {
        file2.rename(this,"a.txt");
        fail("duplicate file name should have been rejected");
      }
 catch (      IOException e) {
        assertEquals(VfsBundle.message("vfs.target.already.exists.error",file1.getPath()),e.getMessage());
      }
    }
  }
.execute();
}
