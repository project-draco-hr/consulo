{
  if (!SystemInfo.areSymLinksSupported) {
    System.err.println("Ignored: symlinks not supported");
    return;
  }
  File top=createTempDirectory(true);
  File target=IoTestUtil.createTestDir(top,"target");
  File link=IoTestUtil.createSymLink(target.getPath(),top.getPath() + "/link");
  VirtualFile vTop=myFS.refreshAndFindFileByIoFile(top);
  assertNotNull(vTop);
  assertTrue(vTop.isValid());
  VirtualFile vTarget=myFS.refreshAndFindFileByIoFile(target);
  assertNotNull(vTarget);
  assertTrue(vTarget.isValid());
  VirtualFile vLink=myFS.refreshAndFindFileByIoFile(link);
  assertNotNull(vLink);
  assertTrue(vLink.isValid());
  assertTrue(vLink.isDirectory());
  FileUtil.delete(target);
  vTop.refresh(false,true);
  assertFalse(vTarget.isValid());
  assertFalse(vLink.isValid());
  vLink=myFS.refreshAndFindFileByIoFile(link);
  assertNotNull(vLink);
  assertTrue(vLink.isValid());
  assertFalse(vLink.isDirectory());
  FileUtil.createDirectory(target);
  vTop.refresh(false,true);
  assertFalse(vLink.isValid());
  vLink=myFS.refreshAndFindFileByIoFile(link);
  assertNotNull(vLink);
  assertTrue(vLink.isValid());
  assertTrue(vLink.isDirectory());
}
