{
  if (!SystemInfo.isWindows) {
    System.err.println(getName() + " skipped: " + SystemInfo.OS_NAME);
    return;
  }
  File file=new File("C:\\Documents and Settings\\desktop.ini");
  if (!file.exists()) {
    System.err.println(getName() + " skipped: missing " + file);
    return;
  }
  String parent=FileUtil.toSystemIndependentName(file.getParent());
  VirtualDirectoryImpl.allowRootAccess(parent);
  try {
    VirtualFile virtualFile=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(file);
    assertNotNull(virtualFile);
    NewVirtualFileSystem fs=(NewVirtualFileSystem)virtualFile.getFileSystem();
    fs=PersistentFS.replaceWithNativeFS(fs);
    assertTrue(fs.exists(virtualFile));
    final FileAttributes attributes=fs.getAttributes(virtualFile);
    assertNotNull(attributes);
    assertEquals(FileAttributes.Type.FILE,attributes.type);
    assertEquals(FileAttributes.HIDDEN,attributes.flags);
  }
  finally {
    VirtualDirectoryImpl.disallowRootAccess(parent);
  }
}
