{
  if (myType == FILE) {
    myFilesSet=new HashSet<VirtualFile>(1);
    myFilesSet.add(((PsiFileSystemItem)myElement).getVirtualFile());
  }
 else   if (myType == DIRECTORY || myType == PROJECT || myType == MODULES || myType == MODULE || myType == CUSTOM) {
    myFilesSet=new HashSet<VirtualFile>();
    accept(createFileSearcher(),false);
  }
 else   if (myType == VIRTUAL_FILES) {
    myFilesSet=new HashSet<VirtualFile>();
    final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(myProject).getFileIndex();
    for (Iterator<VirtualFile> iterator=myVFiles.iterator(); iterator.hasNext(); ) {
      final VirtualFile vFile=iterator.next();
      VfsUtilCore.visitChildrenRecursively(vFile,new VirtualFileVisitor(){
        @NotNull @Override public Result visitFileEx(        @NotNull VirtualFile file){
          boolean ignored=fileIndex.isExcluded(file);
          if (!ignored && !file.isDirectory()) {
            myFilesSet.add(file);
          }
          return ignored ? SKIP_CHILDREN : CONTINUE;
        }
      }
);
      if (vFile.isDirectory()) {
        iterator.remove();
      }
    }
  }
}
