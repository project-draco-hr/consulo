{
  while (true) {
    final DumbService dumbService=DumbService.getInstance(project);
    dumbService.waitForSmartMode();
    boolean passed=PsiDocumentManager.getInstance(project).commitAndRunReadAction(new Computable<Boolean>(){
      @Override public Boolean compute(){
        if (dumbService.isDumb())         return false;
        runnable.run();
        return true;
      }
    }
);
    if (passed) {
      break;
    }
  }
}
