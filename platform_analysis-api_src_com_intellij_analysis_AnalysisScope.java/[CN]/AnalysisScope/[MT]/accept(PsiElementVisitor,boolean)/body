{
  final boolean needReadAction=!ApplicationManager.getApplication().isReadAccessAllowed();
  final PsiManager psiManager=PsiManager.getInstance(myProject);
  final FileIndex fileIndex=getFileIndex();
  accept(new Processor<VirtualFile>(){
    @Override public boolean process(    VirtualFile file){
      if (file.isDirectory())       return true;
      if (ProjectCoreUtil.isProjectOrWorkspaceFile(file))       return true;
      if (fileIndex.isInContent(file) && (myIncludeTestSource || !fileIndex.isInTestSourceContent(file)) && !isInGeneratedSources(file,myProject)) {
        return processFile(file,visitor,psiManager,needReadAction,clearResolveCache);
      }
      return true;
    }
  }
);
}
