{
  if (myFilesToRecompile.isEmpty()) {
    return Collections.emptyList();
  }
  final List<TranslatingCompiler.OutputItem> outputs=new ArrayList<TranslatingCompiler.OutputItem>();
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      final List<VirtualFile> packageInfoFiles=new ArrayList<VirtualFile>(myFilesToRecompile.size());
      for (      final VirtualFile file : myFilesToRecompile) {
        if (PACKAGE_ANNOTATION_FILE_NAME.equals(file.getName())) {
          packageInfoFiles.add(file);
        }
      }
      if (!packageInfoFiles.isEmpty()) {
        final Set<VirtualFile> badFiles=getFilesCompiledWithErrors();
        for (        final VirtualFile packageInfoFile : packageInfoFiles) {
          if (!badFiles.contains(packageInfoFile)) {
            outputs.add(new OutputItemImpl(packageInfoFile));
            myFilesToRecompile.remove(packageInfoFile);
          }
        }
      }
    }
  }
);
  return outputs;
}
