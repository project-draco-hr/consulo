{
  myDisposeInProgress=true;
  Project[] openProjects=ProjectManagerEx.getInstanceEx().getOpenProjects();
  final boolean[] canClose=new boolean[]{true};
  for (  final Project project : openProjects) {
    CommandProcessor commandProcessor=CommandProcessor.getInstance();
    commandProcessor.executeCommand(project,new Runnable(){
      public void run(){
        FileDocumentManager.getInstance().saveAllDocuments();
        canClose[0]=ProjectUtil.closeProject(project);
      }
    }
,ApplicationBundle.message("command.exit"),null);
    if (!canClose[0])     break;
  }
  if (canClose[0]) {
    fireApplicationExiting();
    disposeComponents();
  }
  ourThreadExecutorsService.shutdownNow();
  super.dispose();
}
