{
  if (isDispatchThread()) {
    LOG.error("invokeAndWait should not be called from event queue thread");
    runnable.run();
    return;
  }
  if (isExceptionalThreadWithReadAccess()) {
    LaterInvocator.invokeAndWait(runnable,modalityState);
    return;
  }
  if (myActionsLock.isReadLockAcquired(Thread.currentThread())) {
    @SuppressWarnings({"ThrowableInstanceNeverThrown"}) final Throwable stack=new Throwable();
    SwingUtilities.invokeLater(new Runnable(){
      public void run(){
        LOG.error("Calling invokeAndWait from read-action leads to possible deadlock.",stack);
      }
    }
);
    if (myIsWaitingForWriteAction)     return;
  }
  LaterInvocator.invokeAndWait(runnable,modalityState);
}
