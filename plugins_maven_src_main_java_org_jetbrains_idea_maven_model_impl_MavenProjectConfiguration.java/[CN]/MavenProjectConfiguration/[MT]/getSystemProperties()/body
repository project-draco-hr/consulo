{
  Properties res=ourSystemProperties;
  if (res == null) {
    res=new Properties();
    res.putAll(System.getProperties());
    for (Iterator<Object> itr=res.keySet().iterator(); itr.hasNext(); ) {
      final String propertyName=itr.next().toString();
      if (propertyName.startsWith("idea.")) {
        itr.remove();
      }
    }
    for (    Map.Entry<String,String> entry : System.getenv().entrySet()) {
      String key=entry.getKey();
      if (key.startsWith("=")) {
        continue;
      }
      if (SystemInfo.isWindows) {
        key=key.toUpperCase();
      }
      res.setProperty("env." + key,entry.getValue());
    }
    ourSystemProperties=res;
  }
  return res;
}
