{
  HashSet<VirtualFile> rc=new HashSet<VirtualFile>();
  for (  VirtualFile root : roots) {
    VirtualFile f=root;
    do {
      if (f.findFileByRelativePath(".git") != null) {
        rc.add(f);
        break;
      }
      f=f.getParent();
    }
 while (f != null);
  }
  return rc;
}
