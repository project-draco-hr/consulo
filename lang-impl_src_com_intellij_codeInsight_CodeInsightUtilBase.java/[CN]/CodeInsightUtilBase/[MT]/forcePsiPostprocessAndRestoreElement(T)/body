{
  final PsiFile psiFile=element.getContainingFile();
  final Document document=psiFile.getViewProvider().getDocument();
  if (document == null)   return element;
  Language language=element.getLanguage();
  LanguageDialect languageDialect=psiFile.getLanguageDialect();
  if (languageDialect != null) {
    language=languageDialect;
  }
  final PsiDocumentManager documentManager=PsiDocumentManager.getInstance(psiFile.getProject());
  final RangeMarker rangeMarker=document.createRangeMarker(element.getTextRange());
  documentManager.doPostponedOperationsAndUnblockDocument(document);
  documentManager.commitDocument(document);
  return findElementInRange(psiFile,rangeMarker.getStartOffset(),rangeMarker.getEndOffset(),(Class<? extends T>)element.getClass(),language);
}
