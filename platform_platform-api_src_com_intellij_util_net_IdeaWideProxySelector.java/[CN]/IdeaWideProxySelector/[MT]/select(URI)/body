{
  LOG.debug("IDEA-wide proxy selector asked for " + uri.toString());
  final String scheme=uri.getScheme();
  if (!("http".equals(scheme) || "https".equals(scheme))) {
    LOG.debug("IDEA-wide proxy selector returns no proxies: not http/https scheme: " + scheme);
    return CommonProxy.NO_PROXY_LIST;
  }
  if (myHttpConfigurable.USE_HTTP_PROXY) {
    if (isProxyException(uri)) {
      if (LOG.isDebugEnabled()) {
        LOG.debug("IDEA-wide proxy selector detected that uri matches proxy exceptions: uri: " + uri.toString() + ", proxy exceptions string: '"+ myHttpConfigurable.PROXY_EXCEPTIONS+ "'");
      }
      return CommonProxy.NO_PROXY_LIST;
    }
    final Proxy proxy=new Proxy(myHttpConfigurable.PROXY_TYPE_IS_SOCKS ? Proxy.Type.SOCKS : Proxy.Type.HTTP,new InetSocketAddress(myHttpConfigurable.PROXY_HOST,myHttpConfigurable.PROXY_PORT));
    LOG.debug("IDEA-wide proxy selector returns defined proxy: " + proxy);
    myHttpConfigurable.LAST_ERROR=null;
    return Collections.singletonList(proxy);
  }
 else   if (myHttpConfigurable.USE_PROXY_PAC) {
    ProxySelector pacProxySelector=myPacProxySelector.get();
    if (pacProxySelector == null) {
      final ProxySearch proxySearch=ProxySearch.getDefaultProxySearch();
      proxySearch.setPacCacheSettings(32,10 * 60 * 1000);
      pacProxySelector=proxySearch.getProxySelector();
      myPacProxySelector.lazySet(pacProxySelector);
    }
    if (pacProxySelector != null) {
      final List<Proxy> select=pacProxySelector.select(uri);
      LOG.debug("IDEA-wide proxy selector found autodetected proxies: " + select);
      return select;
    }
    LOG.debug("IDEA-wide proxy selector found no autodetected proxies");
  }
  return CommonProxy.NO_PROXY_LIST;
}
