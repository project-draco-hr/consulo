{
  final FileReference contextRef=getContextReference();
  ArrayList<PsiFileSystemItem> result=new ArrayList<PsiFileSystemItem>();
  if (contextRef == null) {
    Collection<PsiFileSystemItem> defaultContexts=myFileReferenceSet.getDefaultContexts();
    for (    PsiFileSystemItem context : defaultContexts) {
      if (context == null) {
        LOG.error(myFileReferenceSet.getClass() + " provided a null context");
      }
    }
    result.addAll(defaultContexts);
  }
 else {
    ResolveResult[] resolveResults=contextRef.multiResolve(false);
    for (    ResolveResult resolveResult : resolveResults) {
      if (resolveResult.getElement() != null) {
        result.add((PsiFileSystemItem)resolveResult.getElement());
      }
    }
  }
  result.addAll(myFileReferenceSet.getExtraContexts());
  return result;
}
