{
synchronized (LOCK) {
    final Project project=module.getProject();
    module.putUserData(WAIT_FOR_IMPORTING_DEPENDENCIES_KEY,Boolean.TRUE);
    if (project.getUserData(WAIT_FOR_IMPORTING_DEPENDENCIES_KEY) != Boolean.TRUE) {
      project.putUserData(WAIT_FOR_IMPORTING_DEPENDENCIES_KEY,Boolean.TRUE);
      StartupManager.getInstance(project).runWhenProjectIsInitialized(new Runnable(){
        @Override public void run(){
          if (module.isLoaded()) {
            importDependenciesForMarkedModules(project,updateBackwardDependencies);
          }
 else {
            final MessageBusConnection connection=module.getMessageBus().connect();
            connection.subscribe(ProjectTopics.MODULES,new ModuleAdapter(){
              @Override public void moduleAdded(              final Project project,              final Module addedModule){
                if (module.equals(addedModule)) {
                  connection.disconnect();
                  importDependenciesForMarkedModules(project,updateBackwardDependencies);
                }
              }
            }
);
          }
        }
      }
);
    }
  }
}
