{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      for (      JavaModuleSourceRoot sourceRootTrinity : sourceRoots) {
        final String path=sourceRootTrinity.getDirectory().getPath();
        final VirtualFile sourceRoot=LocalFileSystem.getInstance().refreshAndFindFileByPath(FileUtil.toSystemIndependentName(path));
        if (sourceRoot == null) {
          LOG.debug(new Exception("Cannot find source root " + path));
          continue;
        }
        final Module module=ModuleUtil.findModuleForFile(sourceRoot,project);
        if (module == null) {
          LOG.debug(new Exception("Cannot find module for file " + sourceRoot.getPath()));
          continue;
        }
        final ModifiableRootModel model=ModuleRootManager.getInstance(module).getModifiableModel();
        final ContentEntry[] entries=model.getContentEntries();
        if (entries.length > 0) {
          entries[0].addSourceFolder(sourceRoot,false,sourceRootTrinity.getPackagePrefix());
        }
 else {
          LOG.debug(new Exception("Module " + module.getName() + " has no content entries"));
        }
        model.commit();
      }
    }
  }
);
}
