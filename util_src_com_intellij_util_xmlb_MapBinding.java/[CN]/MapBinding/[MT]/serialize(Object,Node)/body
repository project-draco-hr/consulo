{
  Map map=(Map)o;
  Document ownerDocument=XmlSerializerImpl.getOwnerDocument(context);
  Element m;
  if (myMapAnnotation == null || myMapAnnotation.surroundWithTag()) {
    m=ownerDocument.createElement(Constants.MAP);
  }
 else {
    m=(Element)context;
  }
  for (  Object k : map.keySet()) {
    Object v=map.get(k);
    Element entry=ownerDocument.createElement(getEntryAttributeName());
    m.appendChild(entry);
    Node kNode=myKeyBinding.serialize(k,entry);
    Node vNode=myValueBinding.serialize(v,entry);
    if (kNode instanceof Text) {
      Text text=(Text)kNode;
      entry.setAttribute(getKeyAttributeValue(),text.getWholeText());
    }
 else {
      Element key=ownerDocument.createElement(getKeyAttributeValue());
      entry.appendChild(key);
      key.appendChild(kNode);
    }
    if (vNode instanceof Text) {
      Text text=(Text)vNode;
      entry.setAttribute(getValueAttributeName(),text.getWholeText());
    }
 else {
      Element value=ownerDocument.createElement(getValueAttributeName());
      entry.appendChild(value);
      value.appendChild(vNode);
    }
  }
  return m;
}
