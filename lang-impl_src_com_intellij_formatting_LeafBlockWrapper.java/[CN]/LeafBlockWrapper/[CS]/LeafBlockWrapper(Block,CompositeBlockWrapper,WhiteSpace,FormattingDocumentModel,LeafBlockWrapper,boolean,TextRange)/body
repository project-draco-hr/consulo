{
  super(block,whiteSpaceBefore,parent,textRange);
  myPreviousBlock=previousTokenBlock;
  final int lastLineNumber=model.getLineNumber(textRange.getEndOffset());
  int flagsValue=myFlags;
  final boolean containsLineFeeds=model.getLineNumber(textRange.getStartOffset()) != lastLineNumber;
  flagsValue|=containsLineFeeds ? CONTAIN_LINE_FEEDS : 0;
  mySymbolsAtTheLastLine=containsLineFeeds ? textRange.getEndOffset() - model.getLineStartOffset(lastLineNumber) : textRange.getLength();
  flagsValue|=isReadOnly ? READ_ONLY : 0;
  final boolean isLeaf=block.isLeaf();
  flagsValue|=isLeaf ? LEAF : 0;
  if (isLeaf && containsLineFeeds) {
    myLastLineIndent=IndentInside.getLastLineIndent(model.getText(textRange).toString());
  }
 else {
    myLastLineIndent=null;
  }
  myText=model.getText(getTextRange());
  myFlags=flagsValue;
}
