{
  mxLightweightLabel textRenderer=mxLightweightLabel.getSharedInstance();
  CellRendererPane rendererPane=canvas.getRendererPane();
  Rectangle rect=state.getLabelBounds().getRectangle();
  Graphics2D g=canvas.getGraphics();
  if (textRenderer != null && rendererPane != null && (g.getClipBounds() == null || g.getClipBounds().intersects(rect))) {
    double scale=canvas.getScale();
    int x=rect.x;
    int y=rect.y;
    int w=rect.width;
    int h=rect.height;
    if (!mxUtils.isTrue(style,mxConstants.STYLE_HORIZONTAL,true)) {
      g.rotate(-Math.PI / 2,x + w / 2,y + h / 2);
      g.translate(w / 2 - h / 2,h / 2 - w / 2);
      int tmp=w;
      w=h;
      h=tmp;
    }
    if (isReplaceHtmlLinefeeds()) {
      text=text.replaceAll("\n","<br>");
    }
    textRenderer.setText(createHtmlDocument(style,text));
    textRenderer.setFont(mxUtils.getFont(style,canvas.getScale()));
    g.scale(scale,scale);
    rendererPane.paintComponent(g,textRenderer,rendererPane,(int)(x / scale) + mxConstants.LABEL_INSET,(int)(y / scale) + mxConstants.LABEL_INSET,(int)(w / scale),(int)(h / scale),true);
  }
}
