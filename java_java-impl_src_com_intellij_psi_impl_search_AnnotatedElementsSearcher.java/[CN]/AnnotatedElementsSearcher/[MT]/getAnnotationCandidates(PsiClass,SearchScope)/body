{
  AccessToken token=ReadAction.start();
  try {
    if (useScope instanceof GlobalSearchScope) {
      return JavaAnnotationIndex.getInstance().get(annClass.getName(),annClass.getProject(),(GlobalSearchScope)useScope);
    }
    final ArrayList<PsiAnnotation> result=new ArrayList<PsiAnnotation>();
    for (    PsiElement element : ((LocalSearchScope)useScope).getScope()) {
      element.accept(new PsiRecursiveElementWalkingVisitor(){
        @Override public void visitElement(        PsiElement element){
          if (element instanceof PsiAnnotation) {
            result.add((PsiAnnotation)element);
          }
        }
      }
);
    }
    return result;
  }
  finally {
    token.finish();
  }
}
