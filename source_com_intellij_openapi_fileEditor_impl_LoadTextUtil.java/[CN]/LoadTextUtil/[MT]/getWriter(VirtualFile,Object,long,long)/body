{
  if (virtualFile instanceof MockVirtualFile) {
    final MockVirtualFile mockVirtualFile=(MockVirtualFile)virtualFile;
    return new CharArrayWriter(){
      public void close(){
        super.close();
        mockVirtualFile.myModStamp=newModificationStamp;
        mockVirtualFile.myContent=toString();
      }
    }
;
  }
 else {
    Charset charset=virtualFile.getCharset();
    OutputStream outputStream=virtualFile.getOutputStream(requestor,newModificationStamp,newTimeStamp);
    return new BufferedWriter(charset == null ? new OutputStreamWriter(outputStream) : new OutputStreamWriter(outputStream,charset));
  }
}
