{
  FileType fileType=FileTypeManager.getInstance().getFileTypeByFile(virtualFile);
  Charset charset=null;
  if (fileType instanceof XmlLikeFileType) {
    String name=XmlUtil.extractXmlEncodingFromProlog(text);
    if (name != null) {
      try {
        charset=Charset.forName(name);
      }
 catch (      IllegalCharsetNameException e) {
      }
catch (      UnsupportedCharsetException e) {
      }
    }
  }
  if (charset == null) {
    charset=virtualFile.getCharset();
  }
  return charset;
}
