{
  MavenProjectsManagerState state=myProjectsManager.getState();
  assertTrue(state.originalFiles.isEmpty());
  assertTrue(MavenWorkspaceSettingsComponent.getInstance(myProject).getSettings().enabledProfiles.isEmpty());
  assertTrue(state.ignoredFiles.isEmpty());
  assertTrue(state.ignoredPathMasks.isEmpty());
  VirtualFile p1=createModulePom("project1","<groupId>test</groupId>" + "<artifactId>project1</artifactId>" + "<version>1</version>");
  VirtualFile p2=createModulePom("project2","<groupId>test</groupId>" + "<artifactId>project2</artifactId>" + "<version>1</version>"+ "<packaging>pom</packaging>"+ "<modules>"+ "  <module>../project3</module>"+ "</modules>");
  VirtualFile p3=createModulePom("project3","<groupId>test</groupId>" + "<artifactId>project3</artifactId>" + "<version>1</version>");
  importProjects(p1,p2);
  myProjectsManager.setExplicitProfiles(Arrays.asList("one","two"));
  myProjectsManager.setIgnoredFilesPaths(Arrays.asList(p1.getPath()));
  myProjectsManager.setIgnoredFilesPatterns(Arrays.asList("*.xxx"));
  state=myProjectsManager.getState();
  assertUnorderedPathsAreEqual(state.originalFiles,Arrays.asList(p1.getPath(),p2.getPath()));
  assertUnorderedElementsAreEqual(MavenWorkspaceSettingsComponent.getInstance(myProject).getState().enabledProfiles,"one","two");
  assertUnorderedPathsAreEqual(state.ignoredFiles,Arrays.asList(p1.getPath()));
  assertUnorderedElementsAreEqual(state.ignoredPathMasks,"*.xxx");
  MavenProjectsManagerState newState=new MavenProjectsManagerState();
  newState.originalFiles=Arrays.asList(p1.getPath(),p3.getPath());
  MavenWorkspaceSettingsComponent.getInstance(myProject).getSettings().setEnabledProfiles(Arrays.asList("three"));
  newState.ignoredFiles=Collections.singleton(p1.getPath());
  newState.ignoredPathMasks=Arrays.asList("*.zzz");
  myProjectsManager.loadState(newState);
  assertUnorderedPathsAreEqual(myProjectsManager.getProjectsTreeForTests().getManagedFilesPaths(),Arrays.asList(p1.getPath(),p3.getPath()));
  assertUnorderedElementsAreEqual(myProjectsManager.getExplicitProfiles(),"three");
  assertUnorderedPathsAreEqual(myProjectsManager.getIgnoredFilesPaths(),Arrays.asList(p1.getPath()));
  assertUnorderedElementsAreEqual(myProjectsManager.getIgnoredFilesPatterns(),"*.zzz");
  waitForReadingCompletion();
  assertUnorderedElementsAreEqual(myProjectsManager.getProjectsTreeForTests().getRootProjectsFiles(),p1,p3);
}
