{
  importProject("<groupId>test</groupId>" + "<artifactId>project</artifactId>" + "<packaging>pom</packaging>"+ "<version>1</version>");
  createModulePom("dir/module","<groupId>test</groupId>" + "<artifactId>module</artifactId>" + "<version>1</version>");
  createProjectPom("<groupId>test</groupId>" + "<artifactId>project</artifactId>" + "<packaging>pom</packaging>"+ "<version>1</version>"+ "<modules>"+ "  <module>dir/module</module>"+ "</modules>");
  waitForReadingCompletion();
  assertEquals(2,MavenProjectsManager.getInstance(myProject).getProjects().size());
  final VirtualFile dir=myProjectRoot.findChild("dir");
  new WriteCommandAction.Simple(myProject){
    @Override protected void run() throws Throwable {
      dir.delete(null);
    }
  }
.execute().throwException();
  waitForReadingCompletion();
  assertEquals(1,MavenProjectsManager.getInstance(myProject).getProjects().size());
}
