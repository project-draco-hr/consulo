{
  final PsiElement element=descriptor.getPsiElement();
  final PsiMethod method=PsiTreeUtil.getParentOfType(element,PsiMethod.class);
  LOG.assertTrue(method != null);
  PsiParameter parameter=PsiTreeUtil.getParentOfType(element,PsiParameter.class,false);
  final PsiParameter[] parameters=method.getParameterList().getParameters();
  if (parameter == null) {
    for (    PsiParameter psiParameter : parameters) {
      if (Comparing.strEqual(psiParameter.getName(),myParameterName)) {
        parameter=psiParameter;
        break;
      }
    }
  }
  if (parameter == null)   return;
  if (!CommonRefactoringUtil.checkReadOnlyStatus(project,parameter))   return;
  final PsiExpression defToInline;
  try {
    defToInline=PsiManager.getInstance(project).getElementFactory().createExpressionFromText(myValue,parameter);
  }
 catch (  IncorrectOperationException e) {
    return;
  }
  final Collection<PsiReference> refsToInline=ReferencesSearch.search(parameter).findAll();
  final PsiParameter param=parameter;
  final Runnable runnable=new Runnable(){
    public void run(){
      try {
        PsiExpression[] exprs=new PsiExpression[refsToInline.size()];
        int idx=0;
        for (        PsiReference reference : refsToInline) {
          PsiJavaCodeReferenceElement refElement=(PsiJavaCodeReferenceElement)reference;
          exprs[idx++]=InlineUtil.inlineVariable(param,defToInline,refElement);
        }
        for (        final PsiExpression expr : exprs) {
          InlineUtil.tryToInlineArrayCreationForVarargs(expr);
        }
        final List<ParameterInfo> psiParameters=new ArrayList<ParameterInfo>();
        int paramIdx=0;
        final String paramName=param.getName();
        for (        PsiParameter param : parameters) {
          if (!Comparing.strEqual(paramName,param.getName())) {
            psiParameters.add(new ParameterInfo(paramIdx,param.getName(),param.getType()));
          }
          paramIdx++;
        }
        new ChangeSignatureProcessor(project,method,false,null,method.getName(),method.getReturnType(),psiParameters.toArray(new ParameterInfo[psiParameters.size()])).run();
      }
 catch (      IncorrectOperationException e) {
        LOG.error(e);
      }
    }
  }
;
  ApplicationManager.getApplication().runWriteAction(runnable);
}
