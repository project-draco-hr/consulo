{
  final Project project=event.getData(PlatformDataKeys.PROJECT);
  if (project == null) {
    return null;
  }
  PsiElement method=null;
  Document document=null;
  if (ActionPlaces.PROJECT_VIEW_POPUP.equals(event.getPlace()) || ActionPlaces.STRUCTURE_VIEW_POPUP.equals(event.getPlace()) || ActionPlaces.FAVORITES_VIEW_POPUP.equals(event.getPlace())) {
    final PsiElement psiElement=event.getData(LangDataKeys.PSI_ELEMENT);
    if (psiElement instanceof PsiMethod) {
      final PsiFile containingFile=psiElement.getContainingFile();
      if (containingFile != null) {
        method=psiElement;
        document=PsiDocumentManager.getInstance(project).getDocument(containingFile);
      }
    }
  }
 else {
    Editor editor=event.getData(PlatformDataKeys.EDITOR);
    if (editor == null) {
      editor=FileEditorManager.getInstance(project).getSelectedTextEditor();
    }
    if (editor != null) {
      document=editor.getDocument();
      PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(document);
      if (file != null) {
        final VirtualFile virtualFile=file.getVirtualFile();
        FileType fileType=virtualFile != null ? virtualFile.getFileType() : null;
        if (StdFileTypes.JAVA == fileType || StdFileTypes.CLASS == fileType) {
          method=findMethod(project,editor);
        }
      }
    }
  }
  if (method != null) {
    final PsiElement method1=method;
    final Document document1=document;
    return new PlaceInDocument(){
      public Document getDocument(){
        return document1;
      }
      public int getOffset(){
        return method1.getTextOffset();
      }
    }
;
  }
  return null;
}
