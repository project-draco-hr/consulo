{
  int attrsRecord=getRecords().getInt(fileId * RECORD_SIZE + ATTREF_OFFSET);
  boolean doSearch=true;
  if (attrsRecord == 0) {
    if (!createIfNotFound)     return 0;
    attrsRecord=getAttributes().createNewRecord();
    getRecords().putInt(fileId * RECORD_SIZE + ATTREF_OFFSET,attrsRecord);
    doSearch=false;
  }
  if (doSearch) {
    final DataInputStream attrRefs=getAttributes().readStream(attrsRecord);
    try {
      while (attrRefs.available() > 0) {
        final int attIdOnPage=attrRefs.readInt();
        final int attAddress=attrRefs.readInt();
        if (attIdOnPage == attributeId)         return attAddress;
      }
    }
  finally {
      attrRefs.close();
    }
  }
  if (createIfNotFound) {
    Storage.AppenderStream appender=getAttributes().appendStream(attrsRecord);
    appender.writeInt(attributeId);
    int attAddress=getAttributes().createNewRecord();
    appender.writeInt(attAddress);
    appender.close();
    return attAddress;
  }
  return 0;
}
