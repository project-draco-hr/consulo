{
synchronized (lock) {
    try {
      DbConnection.markDirty();
      final int free=DbConnection.getFreeRecord();
      if (free == 0) {
        final int filelength=(int)getRecords().length();
        LOG.assertTrue(filelength % RECORD_SIZE == 0);
        int newrecord=filelength / RECORD_SIZE;
        DbConnection.cleanRecord(newrecord);
        return newrecord;
      }
 else {
        DbConnection.cleanRecord(free);
        return free;
      }
    }
 catch (    IOException e) {
      throw DbConnection.handleError(e);
    }
  }
}
