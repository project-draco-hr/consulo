{
  Caret caret=c == null ? editor.getCaretModel().getPrimaryCaret() : c;
  TextRange wordSelectionRange=SelectWordUtil.getWordSelectionRange(editor.getDocument().getCharsSequence(),caret.getOffset(),SelectWordUtil.JAVA_IDENTIFIER_PART_CONDITION);
  boolean notFoundPreviously=getAndResetNotFoundStatus(editor);
  boolean wholeWordSearch=isWholeWordSearch(editor);
  if (caret.hasSelection()) {
    Project project=editor.getProject();
    String selectedText=caret.getSelectedText();
    if (project == null || selectedText == null) {
      return;
    }
    FindManager findManager=FindManager.getInstance(project);
    FindModel model=new FindModel();
    model.setStringToFind(caret.getSelectedText());
    model.setCaseSensitive(true);
    model.setWholeWordsOnly(wholeWordSearch);
    int searchStartOffset=notFoundPreviously ? 0 : caret.getSelectionEnd();
    FindResult findResult=findManager.findString(editor.getDocument().getCharsSequence(),searchStartOffset,model);
    if (findResult.isStringFound()) {
      int newCaretOffset=caret.getOffset() - caret.getSelectionStart() + findResult.getStartOffset();
      EditorActionUtil.makePositionVisible(editor,newCaretOffset);
      Caret newCaret=editor.getCaretModel().addCaret(editor.offsetToVisualPosition(newCaretOffset));
      if (newCaret == null) {
        if (notFoundPreviously) {
          setNotFoundStatus(editor);
        }
      }
 else {
        setSelection(editor,newCaret,findResult);
      }
    }
 else {
      setNotFoundStatus(editor);
      showHint(editor);
    }
  }
 else {
    if (wordSelectionRange == null) {
      return;
    }
    setSelection(editor,caret,wordSelectionRange);
    setWholeWordSearch(editor,true);
  }
  editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
}
