{
  List<TextRange> cachedChangedLines=getCachedChangedLines(project,file);
  if (cachedChangedLines != null) {
    return cachedChangedLines;
  }
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    String testContent=file.getUserData(TEST_REVISION_CONTENT);
    if (testContent != null) {
      return calculateChangedTextRanges(file.getProject(),file,testContent);
    }
  }
  Change change=ChangeListManager.getInstance(project).getChange(file.getVirtualFile());
  if (change == null) {
    return ContainerUtilRt.emptyList();
  }
  if (change.getType() == Change.Type.NEW) {
    return ContainerUtil.newArrayList(file.getTextRange());
  }
  String contentFromVcs=getRevisionedContentFrom(change);
  return contentFromVcs != null ? calculateChangedTextRanges(project,file,contentFromVcs) : ContainerUtil.<TextRange>emptyList();
}
