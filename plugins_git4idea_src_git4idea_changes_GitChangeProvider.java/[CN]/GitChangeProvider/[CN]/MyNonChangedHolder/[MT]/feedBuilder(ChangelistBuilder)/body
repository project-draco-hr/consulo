{
  final VcsKey gitKey=GitVcs.getKey();
  final ProjectLevelVcsManager vcsManager=ProjectLevelVcsManager.getInstance(myProject);
  final FileDocumentManager fileDocumentManager=FileDocumentManager.getInstance();
  for (  FilePath filePath : myDirty) {
    final VirtualFile vf=filePath.getVirtualFile();
    if (vf != null) {
      if ((!FileStatus.ADDED.equals(myAddGate.getStatus(vf))) && fileDocumentManager.isFileModifiedAndDocumentUnsaved(vf)) {
        final VirtualFile root=vcsManager.getVcsRootFor(vf);
        if (root != null) {
          final GitRevisionNumber beforeRevisionNumber=GitChangeUtils.loadRevision(myProject,root,"HEAD");
          builder.processChange(new Change(GitContentRevision.createRevision(vf,beforeRevisionNumber,myProject),GitContentRevision.createRevision(vf,null,myProject),FileStatus.MODIFIED),gitKey);
        }
      }
    }
  }
}
