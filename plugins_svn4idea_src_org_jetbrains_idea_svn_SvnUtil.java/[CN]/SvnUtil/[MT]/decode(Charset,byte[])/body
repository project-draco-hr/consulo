{
  if (charset != null && !CharsetToolkit.UTF8_CHARSET.equals(charset)) {
    final CharBuffer decoded=charset.decode(ByteBuffer.wrap(buffer));
    final ByteBuffer byteBuffer=CharsetToolkit.UTF8_CHARSET.encode(decoded);
    return ArrayUtil.realloc(byteBuffer.array(),byteBuffer.remaining());
  }
  return buffer;
}
