{
  if (charset != null && !CharsetToolkit.UTF8_CHARSET.equals(charset)) {
    return CharsetToolkit.UTF8_CHARSET.encode(charset.decode(ByteBuffer.wrap(buffer))).array();
  }
  return buffer;
}
