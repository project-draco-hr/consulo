{
  LockDialog dialog=new LockDialog(project,true);
  dialog.show();
  if (!dialog.isOK()) {
    return;
  }
  final String lockMessage=dialog.getComment();
  final boolean force=dialog.isForce();
  final SVNException[] exception=new SVNException[1];
  final Collection failedLocks=new ArrayList();
  final int[] count=new int[]{ioFiles.length};
  final ISVNEventHandler eventHandler=new ISVNEventHandler(){
    public void handleEvent(    SVNEvent event,    double progress){
      if (event.getAction() == SVNEventAction.LOCK_FAILED) {
        failedLocks.add(event.getErrorMessage() != null ? event.getErrorMessage() : event.getFile().getAbsolutePath());
        count[0]--;
      }
    }
    public void checkCancelled(){
    }
  }
;
  Runnable command=new Runnable(){
    public void run(){
      ProgressIndicator progress=ProgressManager.getInstance().getProgressIndicator();
      SVNWCClient wcClient;
      try {
        wcClient=activeVcs.createWCClient();
        wcClient.setEventHandler(eventHandler);
        if (progress != null) {
          progress.setText(SvnBundle.message("progress.text.locking.files"));
        }
        for (int i=0; i < ioFiles.length; i++) {
          if (progress != null) {
            progress.checkCanceled();
          }
          File file=ioFiles[i];
          if (progress != null) {
            progress.setText2(SvnBundle.message("progress.text2.processing.file",file.getName()));
          }
          wcClient.doLock(new File[]{file},force,lockMessage);
        }
      }
 catch (      SVNException e) {
        exception[0]=e;
      }
    }
  }
;
  ApplicationManager.getApplication().runProcessWithProgressSynchronously(command,SvnBundle.message("progress.title.lock.files"),false,project);
  if (!failedLocks.isEmpty() && helper != null) {
    String[] failedFiles=(String[])failedLocks.toArray(new String[failedLocks.size()]);
    List exceptions=new ArrayList();
    for (int i=0; i < failedFiles.length; i++) {
      String file=failedFiles[i];
      exceptions.add(new VcsException(SvnBundle.message("exception.text.locking.file.failed",file)));
    }
    helper.showErrors(exceptions,SvnBundle.message("message.title.lock.failures"));
  }
  WindowManager.getInstance().getStatusBar(project).setInfo(SvnBundle.message("message.text.files.locked",count[0]));
  if (exception[0] != null) {
    throw new VcsException(exception[0]);
  }
}
