{
  final Collection<File> result=new HashSet<File>();
  File parent=path.isFile() || !path.exists() ? path.getParentFile() : path;
  if (SVNWCUtil.isVersionedDirectory(parent)) {
    if (progress != null && progress.isCanceled()) {
      throw new ProcessCanceledException();
    }
    final Collection<File> pending=callback.handleWorkingCopyRoot(path,progress);
    if (progress != null && progress.isCanceled()) {
      throw new ProcessCanceledException();
    }
    for (    final File aPending : pending) {
      result.addAll(crawlWCRoots(aPending,callback,progress));
    }
    result.add(path);
  }
 else   if (path.isDirectory()) {
    if (progress != null && progress.isCanceled()) {
      throw new ProcessCanceledException();
    }
    File[] children=path.listFiles();
    for (int i=0; children != null && i < children.length; i++) {
      if (progress != null && progress.isCanceled()) {
        throw new ProcessCanceledException();
      }
      File child=children[i];
      if (child.isDirectory()) {
        result.addAll(crawlWCRoots(child,callback,progress));
      }
    }
  }
  return result;
}
