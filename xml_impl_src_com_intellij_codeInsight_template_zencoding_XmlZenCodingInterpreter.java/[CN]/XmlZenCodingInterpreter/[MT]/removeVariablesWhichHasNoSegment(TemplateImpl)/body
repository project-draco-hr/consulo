{
  Set<String> segments=new HashSet<String>();
  for (int i=0; i < template.getSegmentsCount(); i++) {
    segments.add(template.getSegmentName(i));
  }
  IntArrayList varsToRemove=new IntArrayList();
  for (int i=0; i < template.getVariableCount(); i++) {
    String varName=template.getVariableNameAt(i);
    if (!segments.contains(varName)) {
      varsToRemove.add(i);
    }
  }
  for (int i=0; i < varsToRemove.size(); i++) {
    template.removeVariable(varsToRemove.get(i));
  }
}
