{
  if (!isModuleAdded)   return;
  final Object requestor=event.getRequestor();
  if (MODULE_RENAMING_REQUESTOR.equals(requestor))   return;
  if (!VirtualFile.PROP_NAME.equals(event.getPropertyName()))   return;
  final VirtualFile parent=event.getParent();
  if (parent != null) {
    final String parentPath=parent.getPath();
    final String ancestorPath=parentPath + "/" + event.getOldValue();
    final String moduleFilePath=getModuleFilePath();
    if (VfsUtilCore.isAncestor(new File(ancestorPath),new File(moduleFilePath),true)) {
      final String newValue=(String)event.getNewValue();
      final String relativePath=FileUtil.getRelativePath(ancestorPath,moduleFilePath,'/');
      final String newFilePath=parentPath + "/" + newValue+ "/"+ relativePath;
      setModuleFilePath(moduleFilePath,newFilePath);
    }
  }
  final VirtualFile moduleFile=getModuleFile();
  if (moduleFile == null)   return;
  if (moduleFile.equals(event.getFile())) {
    myName=moduleNameByFileName(moduleFile.getName());
    ModuleManagerImpl.getInstanceImpl(getProject()).fireModuleRenamedByVfsEvent(ModuleImpl.this);
  }
}
