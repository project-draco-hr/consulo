{
  Element newElement=new Element(CODE_SCHEME);
  newElement.setAttribute(NAME,getName());
  if (getParentScheme() != null) {
    CodeStyleSchemeImpl parentScheme=(CodeStyleSchemeImpl)getParentScheme();
    while (parentScheme.getParentScheme() != null) {
      parentScheme=(CodeStyleSchemeImpl)parentScheme.getParentScheme();
    }
    newElement.setAttribute(PARENT,parentScheme.getName());
  }
  (this).writeExternal(newElement);
  String filePath=dir.getAbsolutePath() + File.separator + getName()+ XML_EXTENSION;
  try {
    JDOMUtil.writeDocument(new Document(newElement),filePath,getCodeStyleSettings().getLineSeparator());
  }
 catch (  IOException e) {
    Messages.showErrorDialog(PsiBundle.message("codestyle.cannot.save.scheme.file",filePath,e.getLocalizedMessage()),CommonBundle.getErrorTitle());
  }
}
