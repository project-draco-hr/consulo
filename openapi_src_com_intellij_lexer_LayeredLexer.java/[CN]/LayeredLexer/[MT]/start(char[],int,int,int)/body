{
  myBuffer=buffer;
  myBufferEnd=endOffset;
  myStateToReturn=initialState;
  final int layerIndex=initialState % (myLayerLexers.size() + 1);
  initialState/=(myLayerLexers.size() + 1);
  final int layerState=initialState % myMaxLayerStatesCount;
  initialState/=myMaxLayerStatesCount;
  myLastBaseState=initialState;
  if (layerIndex != 0) {
    myCurrentLayerLexer=myLayerLexers.get(layerIndex - 1);
    if (!mySelfStoppingLexers.contains(myCurrentLayerLexer)) {
      myBaseLexer.start(buffer,startOffset,endOffset,myLastBaseState);
      endOffset=myBaseLexer.getTokenEnd();
    }
    myCurrentLayerLexer.start(buffer,startOffset,endOffset,layerState);
  }
 else {
    LOG.assertTrue(layerState == 0);
    myCurrentLayerLexer=null;
    myBaseLexer.start(buffer,startOffset,endOffset,myLastBaseState);
    activateLayerIfNecessary();
  }
}
