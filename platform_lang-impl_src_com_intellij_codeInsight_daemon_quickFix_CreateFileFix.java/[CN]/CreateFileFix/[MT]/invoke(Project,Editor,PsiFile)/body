{
  myIsAvailableTimeStamp=0;
  try {
    if (myIsDirectory) {
      myDirectory.createSubdirectory(myNewFileName);
    }
 else {
      final PsiFile newFile=myDirectory.createFile(myNewFileName);
      String text=null;
      if (myText != null) {
        final PsiFile psiFile=PsiFileFactory.getInstance(project).createFileFromText("_" + myNewFileName,myText);
        final PsiElement psiElement=CodeStyleManager.getInstance(project).reformat(psiFile);
        text=psiElement.getText();
      }
      final FileEditorManager editorManager=FileEditorManager.getInstance(myDirectory.getProject());
      final FileEditor[] fileEditors=editorManager.openFile(newFile.getVirtualFile(),true);
      if (text != null) {
        for (        FileEditor fileEditor : fileEditors) {
          if (fileEditor instanceof TextEditor) {
            final Document document=((TextEditor)fileEditor).getEditor().getDocument();
            document.setText(text);
            if (ApplicationManager.getApplication().isUnitTestMode()) {
              FileDocumentManager.getInstance().saveDocument(document);
            }
            PsiDocumentManager.getInstance(project).commitDocument(document);
            break;
          }
        }
      }
    }
  }
 catch (  IncorrectOperationException e) {
    myIsAvailable=false;
  }
}
