{
  GlobalSearchScope allScope=project.getUserData(ALL_SCOPE_KEY);
  if (allScope == null) {
    final ProjectRootManager projectRootManager=ProjectRootManager.getInstance(project);
    allScope=projectRootManager == null ? new EverythingGlobalScope(project) : new ProjectAndLibrariesScope(project);
    allScope=((UserDataHolderEx)project).putUserDataIfAbsent(ALL_SCOPE_KEY,allScope);
  }
  return allScope;
}
