{
  if (file.isDirectory()) {
    final File[] children=file.listFiles();
    if (children != null) {
      for (      File child : children) {
        addFileToJar(child,rootDirectory,packRAndManifestClasses,files);
      }
    }
  }
 else   if (file.isFile()) {
    if (!FileUtil.getExtension(file.getName()).equals("class")) {
      return;
    }
    if (!packRAndManifestClasses && (R_PATTERN.matcher(file.getName()).matches() || MANIFEST_PATTERN.matcher(file.getName()).matches())) {
      return;
    }
    final String rootPath=rootDirectory.getAbsolutePath();
    String path=file.getAbsolutePath();
    path=FileUtil.toSystemIndependentName(path.substring(rootPath.length()));
    if (path.charAt(0) == '/') {
      path=path.substring(1);
    }
    files.add(new Pair<File,String>(file,path));
  }
}
