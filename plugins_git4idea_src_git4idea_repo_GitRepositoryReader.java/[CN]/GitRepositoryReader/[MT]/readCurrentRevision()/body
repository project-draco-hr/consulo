{
  final Head head=readHead();
  if (!head.isBranch) {
    return head.ref;
  }
  File branchFile=null;
  for (  Map.Entry<String,File> entry : getLocalBranches().entrySet()) {
    if (entry.getKey().equals(head.ref)) {
      branchFile=entry.getValue();
    }
  }
  if (branchFile != null) {
    return readBranchFile(branchFile);
  }
  return findBranchRevisionInPackedRefs(head.ref);
}
