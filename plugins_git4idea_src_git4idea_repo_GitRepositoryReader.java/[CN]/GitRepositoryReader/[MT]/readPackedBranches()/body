{
  final Set<GitBranch> localBranches=new HashSet<GitBranch>();
  final Set<GitBranch> remoteBranches=new HashSet<GitBranch>();
  if (!myPackedRefsFile.exists()) {
    return GitBranchesCollection.EMPTY;
  }
  final String content=tryLoadFile(myPackedRefsFile,calcEncoding(myPackedRefsFile));
  for (  String line : content.split("\n")) {
    parsePackedRefsLine(line,new PackedRefsLineResultHandler(){
      @Override public void handleResult(      @Nullable String hash,      @Nullable String branchName){
        if (hash == null || branchName == null) {
          return;
        }
        if (branchName.startsWith(REFS_HEADS_PREFIX)) {
          localBranches.add(new GitBranch(branchName.substring(REFS_HEADS_PREFIX.length()),hash,false,false));
        }
 else         if (branchName.startsWith(REFS_REMOTES_PREFIX)) {
          remoteBranches.add(new GitBranch(branchName.substring(REFS_REMOTES_PREFIX.length()),hash,false,true));
        }
      }
    }
);
  }
  return new GitBranchesCollection(localBranches,remoteBranches);
}
