{
  if (isMergeInProgress()) {
    return Repository.State.MERGING;
  }
  if (isRebaseInProgress()) {
    return Repository.State.REBASING;
  }
  Head head=readHead();
  if (!head.isBranch) {
    return Repository.State.DETACHED;
  }
  return Repository.State.NORMAL;
}
