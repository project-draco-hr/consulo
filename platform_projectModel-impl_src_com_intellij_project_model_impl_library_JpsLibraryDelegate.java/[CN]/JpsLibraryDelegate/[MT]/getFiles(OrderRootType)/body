{
  final VirtualFilePointerContainer container=myRoots.get(rootType);
  if (container == null)   return VirtualFile.EMPTY_ARRAY;
  final List<VirtualFile> expanded=new ArrayList<VirtualFile>();
  for (  JpsLibraryRoot root : myJpsLibrary.getRoots(getJpsRootType(rootType))) {
    final VirtualFilePointer pointer=container.findByUrl(root.getUrl());
    if (pointer == null)     continue;
    VirtualFile file=pointer.getFile();
    if (file == null)     continue;
    if (file.isDirectory() && root.getInclusionOptions() != JpsLibraryRoot.InclusionOptions.ROOT_ITSELF) {
      LibraryImpl.collectJarFiles(file,expanded,root.getInclusionOptions() == JpsLibraryRoot.InclusionOptions.ARCHIVES_UNDER_ROOT_RECURSIVELY);
      continue;
    }
    expanded.add(file);
  }
  return VfsUtilCore.toVirtualFileArray(expanded);
}
