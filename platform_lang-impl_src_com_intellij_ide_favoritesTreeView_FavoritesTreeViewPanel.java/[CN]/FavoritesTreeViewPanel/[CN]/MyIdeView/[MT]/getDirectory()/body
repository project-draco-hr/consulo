{
  if (myBuilder == null)   return null;
  final Object[] selectedNodeElements=getSelectedNodeElements();
  if (selectedNodeElements.length != 1)   return null;
  for (  FavoriteNodeProvider nodeProvider : Extensions.getExtensions(FavoriteNodeProvider.EP_NAME,myProject)) {
    final PsiElement psiElement=nodeProvider.getPsiElement(selectedNodeElements[0]);
    if (psiElement instanceof PsiDirectory) {
      return (PsiDirectory)psiElement;
    }
 else     if (psiElement instanceof PsiDirectoryContainer) {
      final String moduleName=nodeProvider.getElementModuleName(selectedNodeElements[0]);
      GlobalSearchScope searchScope=GlobalSearchScope.projectScope(myProject);
      if (moduleName != null) {
        final Module module=ModuleManager.getInstance(myProject).findModuleByName(moduleName);
        if (module != null) {
          searchScope=GlobalSearchScope.moduleScope(module);
        }
      }
      final PsiDirectory[] directories=((PsiDirectoryContainer)psiElement).getDirectories(searchScope);
      if (directories.length == 1)       return directories[0];
    }
  }
  return null;
}
