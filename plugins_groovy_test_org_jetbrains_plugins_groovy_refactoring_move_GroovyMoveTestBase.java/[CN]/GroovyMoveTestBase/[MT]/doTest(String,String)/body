{
  try {
    String root=PathManager.getHomePath().replace(File.separatorChar,'/') + getBasePath() + getTestName(true);
    String rootBefore=root + "/before";
    PsiTestUtil.removeAllRoots(myModule,JavaSdkImpl.getMockJdk17());
    ArrayList<File> filesToDelete=new ArrayList<File>();
    VirtualFile rootDir=PsiTestUtil.createTestProjectStructure(myFixture.getProject(),myModule,rootBefore,filesToDelete);
    perform(rootDir,destination,names);
    String rootAfter=root + "/after";
    VirtualFile rootDir2=LocalFileSystem.getInstance().findFileByPath(rootAfter.replace(File.separatorChar,'/'));
    PostprocessReformattingAspect.getInstance(myFixture.getProject()).doPostponedFormatting();
    PlatformTestUtil.assertDirectoriesEqual(rootDir2,rootDir,PlatformTestUtil.CVS_FILE_FILTER);
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
}
