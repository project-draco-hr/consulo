{
  if (processor instanceof ResolverProcessor)   ((ResolverProcessor)processor).setCurrentFileResolveContext(this);
  try {
    JavaPsiFacade facade=JavaPsiFacade.getInstance(getProject());
    if (isOnDemand()) {
      GrCodeReferenceElement ref=getImportReference();
      if (ref != null) {
        String qName=PsiUtil.getQualifiedReferenceText(ref);
        if (qName != null) {
          if (!isStatic()) {
            PsiPackage aPackage=facade.findPackage(qName);
            if (aPackage != null) {
              if (!aPackage.processDeclarations(processor,state,lastParent,place))               return false;
            }
          }
 else {
            final PsiElement resolved=ref.resolve();
            if (resolved instanceof PsiClass) {
              if (!processAllMembers(processor,(PsiClass)resolved))               return false;
            }
          }
        }
      }
    }
 else {
      String name=getImportedName();
      if (name != null) {
        NameHint nameHint=processor.getHint(NameHint.KEY);
        if (nameHint == null || name.equals(nameHint.getName(ResolveState.initial()))) {
          GrCodeReferenceElement ref=getImportReference();
          if (ref != null) {
            String qName=ref.getCanonicalText();
            if (qName != null && qName.indexOf('.') > 0) {
              if (!isStatic()) {
                PsiClass clazz=facade.findClass(qName,getResolveScope());
                if (clazz != null && !processor.execute(clazz,state))                 return false;
              }
 else {
                final int i=qName.lastIndexOf('.');
                if (i > 0) {
                  final String classQName=qName.substring(0,i);
                  PsiClass clazz=facade.findClass(classQName,getResolveScope());
                  if (clazz != null) {
                    final String refName=ref.getReferenceName();
                    final PsiField field=clazz.findFieldByName(refName,false);
                    if (field != null && field.hasModifierProperty(PsiModifier.STATIC) && !processor.execute(field,state))                     return false;
                    for (                    PsiMethod method : clazz.findMethodsByName(refName,false)) {
                      if (method.hasModifierProperty(PsiModifier.STATIC) && !processor.execute(method,state))                       return false;
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
    return true;
  }
  finally {
    if (processor instanceof ResolverProcessor)     ((ResolverProcessor)processor).setCurrentFileResolveContext(null);
  }
}
