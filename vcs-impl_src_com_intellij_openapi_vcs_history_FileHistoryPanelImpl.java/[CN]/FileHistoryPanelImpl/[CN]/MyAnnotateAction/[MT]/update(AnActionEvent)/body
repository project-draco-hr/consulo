{
  VirtualFile revVFile=e.getData(VcsDataKeys.VCS_VIRTUAL_FILE);
  VcsFileRevision revision=e.getData(VcsDataKeys.VCS_FILE_REVISION);
  FileType fileType=revVFile == null ? null : revVFile.getFileType();
  e.getPresentation().setEnabled(revision != null && revVFile != null && !fileType.isBinary() && myHistorySession.isContentAvailable(revision) && myAnnotationProvider != null && myAnnotationProvider.isAnnotationValid(revision));
}
