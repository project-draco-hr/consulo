{
  TemplateState templateState=TemplateManagerImpl.getTemplateState(editor);
  if (templateState != null) {
    TextRange range=templateState.getCurrentVariableRange();
    if (range != null && range.getLength() > 0) {
      int caret=editor.getCaretModel().getOffset();
      if (caret == range.getEndOffset()) {
        templateState.nextTab();
      }
 else       if (caret > range.getEndOffset()) {
        templateState.cancelTemplate();
      }
    }
  }
}
