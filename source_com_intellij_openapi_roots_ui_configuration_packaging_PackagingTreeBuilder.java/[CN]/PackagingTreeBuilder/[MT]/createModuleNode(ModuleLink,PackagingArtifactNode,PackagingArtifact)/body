{
  PackagingMethod method=moduleLink.getPackagingMethod();
  if (method == PackagingMethod.JAR_AND_COPY_FILE_AND_LINK_VIA_MANIFEST || method == PackagingMethod.JAR_AND_COPY_FILE) {
    String path=moduleLink.getURI();
    int i=path.lastIndexOf('/');
    String jarName=path.substring(i + 1);
    PackagingTreeNode parent=root;
    if (i != -1) {
      String parentPath=path.substring(0,i);
      if (method == PackagingMethod.JAR_AND_COPY_FILE) {
        parent=PackagingTreeNodeFactory.getOrCreateDirectoryNode(parentPath,root,owner);
      }
 else {
        parent=PackagingTreeNodeFactory.getOrCreateDirectoryNode(parentPath,root.getParent(),owner);
      }
    }
    return PackagingTreeNodeFactory.createPackedModuleOutputNode(moduleLink,jarName,parent,owner);
  }
  PackagingTreeNode parent=getOrCreateParentNode(moduleLink,root,owner);
  return PackagingTreeNodeFactory.createModuleOutputNode(moduleLink,parent,owner);
}
