{
  final Collection<BeforeAfter<AirContentRevision>> revisions;
  if (project != null) {
    revisions=revisionsConvertor(project,new ArrayList<Change>(changes));
  }
 else {
    revisions=new ArrayList<BeforeAfter<AirContentRevision>>(changes.size());
    for (    Change change : changes) {
      revisions.add(new BeforeAfter<AirContentRevision>(convertRevisionToAir(change.getBeforeRevision()),convertRevisionToAir(change.getAfterRevision())));
    }
  }
  return TextPatchBuilder.buildPatch(revisions,basePath,reversePatch,SystemInfo.isFileSystemCaseSensitive,new Runnable(){
    public void run(){
      ProgressManager.checkCanceled();
    }
  }
,includeBaseText);
}
