{
  final JPanel panel=new JPanel(new BorderLayout());
  myWorkingDirectoryField=new TextFieldWithBrowseButton(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      FileChooserDescriptor fileChooserDescriptor=FileChooserDescriptorFactory.createSingleFolderDescriptor();
      fileChooserDescriptor.setTitle(ExecutionBundle.message("select.working.directory.message"));
      fileChooserDescriptor.putUserData(LangDataKeys.MODULE_CONTEXT,myModule);
      VirtualFile[] files=FileChooser.chooseFiles(myWorkingDirectoryComponent,fileChooserDescriptor);
      if (files.length != 0) {
        setText(RunJavaConfiguration.WORKING_DIRECTORY_PROPERTY,files[0].getPresentableUrl());
      }
    }
  }
);
  panel.add(myWorkingDirectoryField,BorderLayout.CENTER);
  final FixedSizeButton button=new FixedSizeButton(myWorkingDirectoryField);
  button.setIcon(ICON);
  button.addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      final List<String> macros=new ArrayList<String>(PathMacros.getInstance().getUserMacroNames());
      macros.add("MODULE_DIR");
      final JList list=new JList(ArrayUtil.toStringArray(macros));
      final JBPopup popup=JBPopupFactory.getInstance().createListPopupBuilder(list).setItemChoosenCallback(new Runnable(){
        public void run(){
          final Object value=list.getSelectedValue();
          if (value instanceof String) {
            setText(RunJavaConfiguration.WORKING_DIRECTORY_PROPERTY,"$" + value + "$");
          }
        }
      }
).setMovable(false).setResizable(false).createPopup();
      popup.showUnderneathOf(button);
    }
  }
);
  panel.add(button,BorderLayout.EAST);
  myWorkingDirectoryComponent=LabeledComponent.create(panel,"&Working directory");
}
