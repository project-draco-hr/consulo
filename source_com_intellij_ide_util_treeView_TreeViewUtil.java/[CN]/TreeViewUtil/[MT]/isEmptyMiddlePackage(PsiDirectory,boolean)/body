{
  final VirtualFile[] files=dir.getVirtualFile().getChildren();
  if (files.length == 0) {
    return false;
  }
  PsiManager manager=dir.getManager();
  int subpackagesCount=0;
  int directoriesCount=0;
  for (  VirtualFile file : files) {
    if (FileTypeManager.getInstance().isFileIgnored(file.getName()))     continue;
    if (!file.isDirectory())     return false;
    PsiDirectory childDir=manager.findDirectory(file);
    if (childDir != null) {
      directoriesCount++;
      if (strictlyEmpty && directoriesCount > 1)       return false;
      if (JavaDirectoryService.getInstance().getPackage(childDir) != null) {
        subpackagesCount++;
      }
    }
  }
  return directoriesCount == subpackagesCount;
}
