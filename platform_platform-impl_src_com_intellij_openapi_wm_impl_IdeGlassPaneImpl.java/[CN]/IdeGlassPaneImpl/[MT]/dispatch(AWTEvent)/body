{
  if (e instanceof MouseEvent) {
    final MouseEvent me=(MouseEvent)e;
    Window eventWindow=me.getComponent() instanceof Window ? (Window)me.getComponent() : SwingUtilities.getWindowAncestor(me.getComponent());
    final Window thisGlassWindow=SwingUtilities.getWindowAncestor(myRootPane);
    if (eventWindow != thisGlassWindow)     return false;
  }
  boolean dispatched;
  if (e.getID() == MouseEvent.MOUSE_PRESSED || e.getID() == MouseEvent.MOUSE_RELEASED || e.getID() == MouseEvent.MOUSE_CLICKED) {
    dispatched=preprocess((MouseEvent)e,false);
  }
 else   if (e.getID() == MouseEvent.MOUSE_MOVED || e.getID() == MouseEvent.MOUSE_DRAGGED) {
    dispatched=preprocess((MouseEvent)e,true);
  }
 else   if (e.getID() == MouseEvent.MOUSE_EXITED || e.getID() == MouseEvent.MOUSE_ENTERED) {
    dispatched=preprocess((MouseEvent)e,false);
  }
 else {
    return false;
  }
  MouseEvent me=(MouseEvent)e;
  if (!dispatched && me.getComponent() != null) {
    int button1=MouseEvent.BUTTON1_MASK | MouseEvent.BUTTON1_DOWN_MASK;
    final boolean pureMouse1Event=(me.getModifiersEx() | button1) == button1;
    if (pureMouse1Event && me.getClickCount() == 1 && !me.isPopupTrigger()) {
      final Point point=SwingUtilities.convertPoint(me.getComponent(),me.getPoint(),myRootPane.getContentPane());
      if (myRootPane.getMenuBar() != null && myRootPane.getMenuBar().isVisible()) {
        point.y+=myRootPane.getMenuBar().getHeight();
      }
      final Component target=SwingUtilities.getDeepestComponentAt(myRootPane.getContentPane().getParent(),point.x,point.y);
      if (target instanceof DnDAware) {
        final Point targetPoint=SwingUtilities.convertPoint(myRootPane.getContentPane().getParent(),point.x,point.y,target);
        final boolean overSelection=((DnDAware)target).isOverSelection(targetPoint);
        if (overSelection) {
          final MouseListener[] listeners=target.getListeners(MouseListener.class);
          final MouseEvent mouseEvent=convertEvent(me,target);
switch (me.getID()) {
case MouseEvent.MOUSE_PRESSED:
            boolean consumed=false;
          if (target.isFocusable())           target.requestFocus();
        for (        final MouseListener listener : listeners) {
          final String className=listener.getClass().getName();
          if (className.indexOf("BasicTreeUI$") >= 0 || className.indexOf("MacTreeUI$") >= 0)           continue;
          fireMouseEvent(listener,mouseEvent);
          if (mouseEvent.isConsumed()) {
            consumed=true;
            break;
          }
        }
      if (!mouseEvent.isConsumed()) {
        final AWTEventListener[] eventListeners=Toolkit.getDefaultToolkit().getAWTEventListeners(MouseEvent.MOUSE_EVENT_MASK);
        if (eventListeners != null && eventListeners.length > 0) {
          for (          final AWTEventListener eventListener : eventListeners) {
            eventListener.eventDispatched(me);
            if (me.isConsumed())             break;
          }
          if (me.isConsumed()) {
            consumed=true;
            break;
          }
        }
      }
    if (!consumed) {
      myPrevPressEvent=mouseEvent;
    }
 else {
      me.consume();
    }
  dispatched=true;
break;
case MouseEvent.MOUSE_RELEASED:
if (myPrevPressEvent != null && myPrevPressEvent.getComponent() == target) {
for (final MouseListener listener : listeners) {
  final String className=listener.getClass().getName();
  if (className.indexOf("BasicTreeUI$") >= 0 || className.indexOf("MacTreeUI$") >= 0) {
    fireMouseEvent(listener,myPrevPressEvent);
    fireMouseEvent(listener,mouseEvent);
    if (mouseEvent.isConsumed()) {
      break;
    }
  }
  fireMouseEvent(listener,mouseEvent);
  if (mouseEvent.isConsumed()) {
    break;
  }
}
if (mouseEvent.isConsumed()) {
  me.consume();
}
myPrevPressEvent=null;
dispatched=true;
}
break;
default :
myPrevPressEvent=null;
break;
}
}
}
}
}
if (isVisible() && getComponentCount() == 0) {
boolean cursorSet=false;
if (me.getComponent() != null) {
final Point point=SwingUtilities.convertPoint(me.getComponent(),me.getPoint(),myRootPane.getContentPane());
if (myRootPane.getMenuBar() != null && myRootPane.getMenuBar().isVisible()) {
point.y+=myRootPane.getMenuBar().getHeight();
}
final Component target=SwingUtilities.getDeepestComponentAt(myRootPane.getContentPane().getParent(),point.x,point.y);
if (target != null) {
setCursor(target.getCursor());
cursorSet=true;
}
}
if (!cursorSet) {
setCursor(Cursor.getDefaultCursor());
}
}
return dispatched;
}
