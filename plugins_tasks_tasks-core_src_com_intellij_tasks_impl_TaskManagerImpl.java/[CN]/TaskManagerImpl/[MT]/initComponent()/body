{
  if (!ApplicationManager.getApplication().isUnitTestMode()) {
    myCacheRefreshTimer=UIUtil.createNamedTimer("TaskManager refresh",myConfig.updateInterval * 60 * 1000,new ActionListener(){
      public void actionPerformed(      ActionEvent e){
        if (myConfig.updateEnabled && !myUpdating) {
          updateIssues(null);
        }
      }
    }
);
    myCacheRefreshTimer.setInitialDelay(0);
    StartupManager.getInstance(myProject).registerPostStartupActivity(new Runnable(){
      public void run(){
        myCacheRefreshTimer.start();
      }
    }
);
  }
  LocalTask defaultTask=findTask(LocalTaskImpl.DEFAULT_TASK_ID);
  if (defaultTask == null) {
    defaultTask=createDefaultTask();
    addTask(defaultTask);
  }
  LocalTask activeTask=null;
  final List<LocalTask> tasks=getLocalTasks();
  Collections.sort(tasks,TASK_UPDATE_COMPARATOR);
  for (  LocalTask task : tasks) {
    if (activeTask == null) {
      if (task.isActive()) {
        activeTask=task;
      }
    }
 else {
      task.setActive(false);
    }
  }
  if (activeTask == null) {
    activeTask=defaultTask;
  }
  myActiveTask=activeTask;
  doActivate(myActiveTask,false);
  myDispatcher.getMulticaster().taskActivated(myActiveTask);
}
