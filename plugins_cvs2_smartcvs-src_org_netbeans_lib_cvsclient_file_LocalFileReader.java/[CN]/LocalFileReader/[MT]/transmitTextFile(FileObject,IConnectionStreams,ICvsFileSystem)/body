{
  final File file=cvsFileSystem.getLocalFileSystem().getFile(fileObject);
  if (!file.exists()) {
    throw new FileNotFoundException("File '" + file.getAbsolutePath() + "' does not exist.");
  }
  final File fileToSend=sendTextFilePreprocessor.getPreprocessedTextFile(file,connectionStreams.getWriterFactory());
  long length=fileToSend.length();
  writeLengthString(connectionStreams.getLoggedWriter(),length);
  BufferedInputStream bis=null;
  try {
    bis=new BufferedInputStream(new FileInputStream(fileToSend));
    final OutputStream outputStream=connectionStreams.getOutputStream();
    final byte[] chunk=new byte[CHUNK_SIZE];
    while (length > 0) {
      final int bytesToRead=(length >= CHUNK_SIZE) ? CHUNK_SIZE : (int)length;
      final int count=bis.read(chunk,0,bytesToRead);
      length-=count;
      outputStream.write(chunk,0,count);
    }
    outputStream.flush();
  }
  finally {
    if (bis != null) {
      try {
        bis.close();
      }
 catch (      IOException ex) {
      }
    }
    sendTextFilePreprocessor.cleanup(fileToSend);
  }
}
