{
  if (seq instanceof CharSequenceBackedByArray) {
    return ((CharSequenceBackedByArray)seq).getChars();
  }
  if (seq instanceof CharBuffer) {
    final CharBuffer buffer=(CharBuffer)seq;
    if (buffer.hasArray() && !buffer.isReadOnly() && buffer.arrayOffset() == 0) {
      return buffer.array();
    }
    char[] chars=new char[seq.length()];
    buffer.position(0);
    buffer.get(chars);
    buffer.position(0);
    return chars;
  }
  if (seq instanceof StringBuffer) {
    char[] chars=new char[seq.length()];
    ((StringBuffer)seq).getChars(0,seq.length(),chars,0);
    return chars;
  }
  if (seq instanceof StringBuilder) {
    char[] chars=new char[seq.length()];
    ((StringBuilder)seq).getChars(0,seq.length(),chars,0);
    return chars;
  }
  if (seq instanceof String) {
    char[] chars=new char[seq.length()];
    ((String)seq).getChars(0,seq.length(),chars,0);
    return chars;
  }
  return seq.toString().toCharArray();
}
