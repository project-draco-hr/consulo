{
  try {
    if (!needsDtdChecking() && !needsSchemaChecking() && !forceChecking) {
      return null;
    }
    SAXParserFactory factory=new SAXParserFactoryImpl();
    boolean schemaChecking=false;
    if (hasDtdDeclaration()) {
      factory.setValidating(true);
    }
    if (needsSchemaChecking()) {
      factory.setValidating(true);
      factory.setNamespaceAware(true);
      schemaChecking=true;
    }
    SAXParser parser=factory.newSAXParser();
    parser.setProperty("http://apache.org/xml/properties/internal/entity-resolver",myXmlResourceResolver);
    XMLGrammarPoolImpl grammarPool=myFile.getUserData(GRAMMAR_POOL_KEY);
    final Long grammarPoolTimeStamp=myFile.getUserData(GRAMMAR_POOL_TIME_STAMP_KEY);
    final long timeStamp=System.currentTimeMillis();
    if (forceChecking || grammarPool == null || (grammarPoolTimeStamp != null && (timeStamp - grammarPoolTimeStamp.longValue()) > 60 * 1000L)) {
      grammarPool=new XMLGrammarPoolImpl();
      myFile.putUserData(GRAMMAR_POOL_KEY,grammarPool);
      myFile.putUserData(GRAMMAR_POOL_TIME_STAMP_KEY,new Long(timeStamp));
    }
    parser.getXMLReader().setProperty(GRAMMAR_FEATURE_ID,grammarPool);
    if (schemaChecking) {
      parser.setProperty(JAXPConstants.JAXP_SCHEMA_LANGUAGE,JAXPConstants.W3C_XML_SCHEMA);
      parser.getXMLReader().setFeature(SCHEMA_FULL_CHECKING_FEATURE_ID,true);
    }
    return parser;
  }
 catch (  Exception e) {
    filterAppException(e);
  }
  return null;
}
