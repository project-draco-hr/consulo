{
  Charset result=CharsetToolkit.getDefaultSystemCharset();
  Application application=ApplicationManager.getApplication();
  if (application != null) {
    final ProjectManager projectManager=ProjectManager.getInstance();
    if (projectManager != null) {
      EncodingProjectManager encodingManager=ApplicationManager.getApplication().runReadAction(new Computable<EncodingProjectManager>(){
        public EncodingProjectManager compute(){
          return EncodingProjectManager.getInstance(projectManager.getDefaultProject());
        }
      }
);
      if (encodingManager != null) {
        result=encodingManager.getDefaultCharset();
      }
    }
  }
  return result;
}
