{
  final XDebugProcess debugProcess=session.getDebugProcess();
  ProcessHandler processHandler=debugProcess.getProcessHandler();
  myConsole=consoleView;
  myRunContentDescriptor=new RunContentDescriptor(myConsole,processHandler,myUi.getComponent(),mySessionName,myIcon);
  myUi.addContent(createFramesContent(session),0,PlaceInGrid.left,false);
  myUi.addContent(createVariablesContent(session),0,PlaceInGrid.center,false);
  myUi.addContent(createWatchesContent(session,sessionData),0,PlaceInGrid.right,false);
  final Content consoleContent=createConsoleContent();
  myUi.addContent(consoleContent,1,PlaceInGrid.bottom,false);
  attachNotificationTo(consoleContent);
  debugProcess.registerAdditionalContent(myUi);
  RunContentBuilder.addAdditionalConsoleEditorActions(myConsole,consoleContent);
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    return myRunContentDescriptor;
  }
  DefaultActionGroup leftToolbar=new DefaultActionGroup();
  final Executor executor=DefaultDebugExecutor.getDebugExecutorInstance();
  if (runner != null && env != null) {
    RestartAction restartAction=new RestartAction(executor,runner,myRunContentDescriptor.getProcessHandler(),XDebuggerUIConstants.DEBUG_AGAIN_ICON,myRunContentDescriptor,env);
    leftToolbar.add(restartAction);
    restartAction.registerShortcut(myUi.getComponent());
  }
  leftToolbar.addAll(getActionGroup(XDebuggerActions.TOOL_WINDOW_LEFT_TOOLBAR_GROUP));
  leftToolbar.addSeparator();
  leftToolbar.add(myUi.getOptions().getLayoutActions());
  final AnAction[] commonSettings=myUi.getOptions().getSettingsActionsList();
  final AnAction commonSettingsList=myUi.getOptions().getSettingsActions();
  final DefaultActionGroup settings=new DefaultActionGroup("DebuggerSettings",commonSettings.length > 0){
    @Override public void update(    AnActionEvent e){
      e.getPresentation().setText(ActionsBundle.message("group.XDebugger.settings.text"));
      e.getPresentation().setIcon(commonSettingsList.getTemplatePresentation().getIcon());
    }
    @Override public boolean isDumbAware(){
      return true;
    }
  }
;
  for (  AnAction each : commonSettings) {
    settings.add(each);
  }
  if (commonSettings.length > 0) {
    settings.addSeparator();
  }
  settings.add(new ToggleSortValuesAction(commonSettings.length == 0));
  leftToolbar.add(settings);
  leftToolbar.addSeparator();
  leftToolbar.add(PinToolwindowTabAction.getPinAction());
  leftToolbar.add(new CloseAction(executor,myRunContentDescriptor,getProject()));
  leftToolbar.add(new ContextHelpAction(executor.getHelpId()));
  DefaultActionGroup topToolbar=new DefaultActionGroup();
  topToolbar.addAll(getActionGroup(XDebuggerActions.TOOL_WINDOW_TOP_TOOLBAR_GROUP));
  session.getDebugProcess().registerAdditionalActions(leftToolbar,topToolbar);
  myUi.getOptions().setLeftToolbar(leftToolbar,ActionPlaces.DEBUGGER_TOOLBAR);
  myUi.getOptions().setTopToolbar(topToolbar,ActionPlaces.DEBUGGER_TOOLBAR);
  if (env != null) {
    final RunProfile runConfiguration=env.getRunProfile();
    registerFileMatcher(runConfiguration);
    initLogConsoles(runConfiguration,myRunContentDescriptor.getProcessHandler(),myConsole);
  }
  rebuildViews();
  return myRunContentDescriptor;
}
