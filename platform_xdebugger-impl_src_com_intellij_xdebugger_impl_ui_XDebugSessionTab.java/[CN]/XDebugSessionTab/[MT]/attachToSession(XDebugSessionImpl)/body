{
  for (  XDebugView view : myViews.values()) {
    attachViewToSession(session,view);
  }
  XDebugTabLayouter layouter=session.getDebugProcess().createTabLayouter();
  Content consoleContent=layouter.registerConsoleContent(myUi,myConsole);
  attachNotificationTo(consoleContent);
  layouter.registerAdditionalContent(myUi);
  RunContentBuilder.addAdditionalConsoleEditorActions(myConsole,consoleContent);
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    return;
  }
  DefaultActionGroup leftToolbar=new DefaultActionGroup();
  final Executor debugExecutor=DefaultDebugExecutor.getDebugExecutorInstance();
  if (myEnvironment != null) {
    leftToolbar.add(ActionManager.getInstance().getAction(IdeActions.ACTION_RERUN));
    List<AnAction> additionalRestartActions=session.getRestartActions();
    if (!additionalRestartActions.isEmpty()) {
      leftToolbar.addAll(additionalRestartActions);
      leftToolbar.addSeparator();
    }
    leftToolbar.addAll(session.getExtraActions());
  }
  leftToolbar.addAll(getCustomizedActionGroup(XDebuggerActions.TOOL_WINDOW_LEFT_TOOLBAR_GROUP));
  for (  AnAction action : session.getExtraStopActions()) {
    leftToolbar.add(action,new Constraints(Anchor.AFTER,IdeActions.ACTION_STOP_PROGRAM));
  }
  leftToolbar.addSeparator();
  leftToolbar.add(myUi.getOptions().getLayoutActions());
  final AnAction[] commonSettings=myUi.getOptions().getSettingsActionsList();
  DefaultActionGroup settings=new DefaultActionGroup(ActionsBundle.message("group.XDebugger.settings.text"),true);
  settings.getTemplatePresentation().setIcon(myUi.getOptions().getSettingsActions().getTemplatePresentation().getIcon());
  settings.addAll(commonSettings);
  leftToolbar.add(settings);
  leftToolbar.addSeparator();
  leftToolbar.add(PinToolwindowTabAction.getPinAction());
  leftToolbar.add(new CloseAction(myEnvironment != null ? myEnvironment.getExecutor() : debugExecutor,myRunContentDescriptor,myProject));
  leftToolbar.add(new ContextHelpAction(debugExecutor.getHelpId()));
  DefaultActionGroup topToolbar=new DefaultActionGroup();
  topToolbar.addAll(getCustomizedActionGroup(XDebuggerActions.TOOL_WINDOW_TOP_TOOLBAR_GROUP));
  session.getDebugProcess().registerAdditionalActions(leftToolbar,topToolbar,settings);
  myUi.getOptions().setLeftToolbar(leftToolbar,ActionPlaces.DEBUGGER_TOOLBAR);
  myUi.getOptions().setTopToolbar(topToolbar,ActionPlaces.DEBUGGER_TOOLBAR);
  if (myEnvironment != null) {
    initLogConsoles(myEnvironment.getRunProfile(),myRunContentDescriptor,myConsole);
  }
}
