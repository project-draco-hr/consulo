{
  int id=getFileId(file);
  String[] names;
  final int[] childrenIds;
  if (areChildrenLoaded(id)) {
    childrenIds=myRecords.list(id);
    names=new String[childrenIds.length];
    for (int i=0; i < childrenIds.length; i++) {
      names[i]=myRecords.getName(childrenIds[i]);
    }
  }
 else {
    names=myDelegate.list(file);
    childrenIds=new int[names.length];
    for (int i=0; i < names.length; i++) {
      int childId=myRecords.createRecord();
      VFileImpl fakeFile=new VFileImpl(names[i],file,myDelegate,childId);
      copyRecordFromDelegateFS(childId,id,fakeFile);
      childrenIds[i]=childId;
    }
    myRecords.updateList(id,childrenIds);
    int flags=myRecords.getFlags(id);
    myRecords.setFlags(id,flags | CHILDREN_CACHED_FLAG);
  }
  return names;
}
