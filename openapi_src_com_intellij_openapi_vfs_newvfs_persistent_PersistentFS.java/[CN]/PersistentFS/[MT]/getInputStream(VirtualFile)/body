{
  try {
    InputStream contentStream=FILE_CONTENT.readAttribute(file);
    if (contentStream == null) {
      final int len=(int)myDelegate.getLength(file);
      return new ReplicatorInputStream(myDelegate.getInputStream(file),new BufferedOutputStream(FILE_CONTENT.writeAttribute(file))){
        public void close() throws IOException {
          super.close();
          myRecords.setLength(getFileId(file),len);
        }
      }
;
    }
 else {
      return new BufferedInputStream(new LimitedInputStream(contentStream,myRecords.getLength(getFileId(file))));
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
