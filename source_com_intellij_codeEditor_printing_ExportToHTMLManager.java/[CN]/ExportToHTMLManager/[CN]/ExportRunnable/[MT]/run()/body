{
  ProgressIndicator progressIndicator=ProgressManager.getInstance().getProgressIndicator();
  final ArrayList filesList=new ArrayList();
  final boolean isRecursive=myExportToHTMLSettings.isIncludeSubdirectories();
  addToPsiFileList(myPsiDirectory,filesList,isRecursive);
  com.intellij.util.containers.HashMap filesMap=new com.intellij.util.containers.HashMap();
  for (int i=0; i < filesList.size(); i++) {
    PsiFile psiFile=(PsiFile)filesList.get(i);
    filesMap.put(psiFile,psiFile);
  }
  for (int i=0; i < filesList.size(); i++) {
    PsiFile psiFile=(PsiFile)filesList.get(i);
    if (progressIndicator.isCanceled()) {
      return;
    }
    progressIndicator.setText("Generating file: " + getHTMLFileName(psiFile));
    progressIndicator.setFraction(((double)i) / filesList.size());
    exportPsiFile(psiFile,myOutputDirectoryName,myProject,filesMap);
  }
  if (myExportToHTMLSettings.OPEN_IN_BROWSER) {
    String dirToShow=myExportToHTMLSettings.OUTPUT_DIRECTORY;
    if (!dirToShow.endsWith(File.separator)) {
      dirToShow+=File.separatorChar;
    }
    PsiPackage aPackage=myPsiDirectory.getPackage();
    if (aPackage != null) {
      dirToShow+=aPackage.getQualifiedName().replace('.',File.separatorChar);
    }
    BrowserUtil.launchBrowser(dirToShow);
  }
}
