{
  ProgressIndicator progressIndicator=ProgressManager.getInstance().getProgressIndicator();
  final ArrayList<PsiFile> filesList=new ArrayList<PsiFile>();
  final boolean isRecursive=myExportToHTMLSettings.isIncludeSubdirectories();
  try {
    addToPsiFileList(myPsiDirectory,filesList,isRecursive,myOutputDirectoryName);
  }
 catch (  FileNotFoundException e) {
    myLastException=e;
    return;
  }
  HashMap filesMap=new HashMap();
  for (int i=0; i < filesList.size(); i++) {
    PsiFile psiFile=filesList.get(i);
    filesMap.put(psiFile,psiFile);
  }
  for (int i=0; i < filesList.size(); i++) {
    PsiFile psiFile=filesList.get(i);
    if (progressIndicator.isCanceled()) {
      return;
    }
    progressIndicator.setText(CodeEditorBundle.message("export.to.html.generating.file.progress",getHTMLFileName(psiFile)));
    progressIndicator.setFraction(((double)i) / filesList.size());
    if (!exportPsiFile(psiFile,myOutputDirectoryName,myProject,filesMap)) {
      return;
    }
  }
  if (myExportToHTMLSettings.OPEN_IN_BROWSER) {
    String dirToShow=myExportToHTMLSettings.OUTPUT_DIRECTORY;
    if (!dirToShow.endsWith(File.separator)) {
      dirToShow+=File.separatorChar;
    }
    PsiPackage aPackage=myPsiDirectory.getPackage();
    if (aPackage != null) {
      dirToShow+=aPackage.getQualifiedName().replace('.',File.separatorChar);
    }
    BrowserUtil.launchBrowser(dirToShow);
  }
}
