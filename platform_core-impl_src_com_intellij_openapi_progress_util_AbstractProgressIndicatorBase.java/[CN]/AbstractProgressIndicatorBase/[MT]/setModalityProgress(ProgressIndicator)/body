{
  LOG.assertTrue(!isRunning());
  myModalityProgress=modalityProgress;
  ModalityState currentModality=ApplicationManager.getApplication().getCurrentModalityState();
  myModalityState=myModalityProgress != null ? ((ModalityStateEx)currentModality).appendProgress(myModalityProgress) : currentModality;
  if (modalityProgress != null) {
    ((TransactionGuardImpl)TransactionGuard.getInstance()).enteredModality(myModalityState);
  }
}
