{
  myBookmarkAtPlace=null;
  myFile=null;
  myLine=-1;
  BookmarkManager bookmarkManager=BookmarkManager.getInstance(myProject);
  if (ToolWindowManager.getInstance(myProject).isEditorComponentActive()) {
    Editor editor=PlatformDataKeys.EDITOR.getData(myDataContext);
    if (editor != null) {
      Document document=editor.getDocument();
      myLine=editor.getCaretModel().getLogicalPosition().line;
      myFile=FileDocumentManager.getInstance().getFile(document);
      myBookmarkAtPlace=bookmarkManager.findEditorBookmark(document,myLine);
    }
  }
  if (myFile == null) {
    myFile=PlatformDataKeys.VIRTUAL_FILE.getData(myDataContext);
    myLine=-1;
    if (myBookmarkAtPlace == null && myFile != null) {
      myBookmarkAtPlace=bookmarkManager.findFileBookmark(myFile);
    }
  }
  return this;
}
