{
  if (extension == null)   extension=StdFileTypes.JAVA.getDefaultExtension();
  final PsiFile psiFile=PsiManager.getInstance(project).getElementFactory().createFileFromText("myclass" + "." + extension,content);
  final PsiClass[] classes=psiFile instanceof PsiJavaFile ? ((PsiJavaFile)psiFile).getClasses() : PsiClass.EMPTY_ARRAY;
  if (classes.length == 0) {
    throw new IncorrectOperationException("This template did not produce Java class nor interface!");
  }
  PsiJavaFile psiJavaFile=(PsiJavaFile)psiFile;
  PsiClass createdClass=classes[0];
  if (reformat) {
    CodeStyleManager.getInstance(project).reformat(psiJavaFile);
  }
  String className=createdClass.getName();
  String fileName=className + "." + extension;
  if (createdClass.isInterface()) {
    directory.checkCreateInterface(className);
  }
 else {
    directory.checkCreateClass(className);
  }
  psiJavaFile=(PsiJavaFile)psiJavaFile.setName(fileName);
  psiJavaFile=(PsiJavaFile)directory.add(psiJavaFile);
  return psiJavaFile.getClasses()[0];
}
