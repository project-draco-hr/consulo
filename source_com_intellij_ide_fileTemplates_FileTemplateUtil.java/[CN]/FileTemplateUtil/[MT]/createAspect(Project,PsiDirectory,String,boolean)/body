{
  String extension=StdFileTypes.ASPECT.getDefaultExtension();
  PsiAspectFile file=(PsiAspectFile)PsiManager.getInstance(project).getElementFactory().createFileFromText("myaspect." + extension,content);
  PsiAspect[] aspects=file.getAspects();
  if (aspects == null || aspects.length == 0) {
    throw new IncorrectOperationException("This template did not produce an aspect!");
  }
  PsiAspect aspect=aspects[0];
  if (reformat) {
    CodeStyleManager.getInstance(project).reformat(file);
  }
  String fileName=aspect.getName() + "." + extension;
  directory.checkCreateFile(fileName);
  file=(PsiAspectFile)file.setName(fileName);
  file=(PsiAspectFile)directory.add(file);
  return file.getAspects()[0];
}
