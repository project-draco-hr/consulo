{
  final MessageBusConnection conn=project.getMessageBus().connect();
  myConnections.put(project,conn);
  conn.subscribe(ProjectTopics.PROJECT_ROOTS,new ModuleRootListener(){
    public void beforeRootsChange(    final ModuleRootEvent event){
      sendReloadRequest(project);
    }
    public void rootsChanged(    final ModuleRootEvent event){
      myTaskExecutor.submit(new Runnable(){
        public void run(){
          try {
            final CompileServerClient client=ensureServerRunningAndClientConnected(false);
            if (client != null) {
              sendSetupRequest(client);
            }
          }
 catch (          Throwable e) {
            LOG.info(e);
          }
        }
      }
);
    }
  }
);
}
