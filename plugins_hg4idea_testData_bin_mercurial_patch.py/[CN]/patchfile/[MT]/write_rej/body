def write_rej(self):
    if (not self.rej):
        return
    fname = (self.fname + '.rej')
    self.ui.warn((_('%d out of %d hunks FAILED -- saving rejects to file %s\n') % (len(self.rej), self.hunks, fname)))

    def rejlines():
        base = os.path.basename(self.fname)
        yield ('--- %s\n+++ %s\n' % (base, base))
        for x in self.rej:
            for l in x.hunk:
                yield l
                if (l[(-1)] != '\n'):
                    yield '\n\\ No newline at end of file\n'
    self.writelines(fname, rejlines())
