def writelines(self, fname, lines):
    islink = os.path.islink(fname)
    if islink:
        fp = cStringIO.StringIO()
    else:
        fp = self.opener(fname, 'w')
    try:
        if (self.eolmode == 'auto'):
            eol = self.eol
        elif (self.eolmode == 'crlf'):
            eol = '\r\n'
        else:
            eol = '\n'
        if ((self.eolmode != 'strict') and eol and (eol != '\n')):
            for l in lines:
                if (l and (l[(-1)] == '\n')):
                    l = (l[:(-1)] + eol)
                fp.write(l)
        else:
            fp.writelines(lines)
        if islink:
            self.opener.symlink(fp.getvalue(), fname)
    finally:
        fp.close()
