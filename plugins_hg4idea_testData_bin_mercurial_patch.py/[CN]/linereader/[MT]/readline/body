def readline(self):
    if self.buf:
        l = self.buf[0]
        del self.buf[0]
        return l
    l = self.fp.readline()
    if (not self.eol):
        if l.endswith('\r\n'):
            self.eol = '\r\n'
        elif l.endswith('\n'):
            self.eol = '\n'
    if (self.textmode and l.endswith('\r\n')):
        l = (l[:(-2)] + '\n')
    return l
