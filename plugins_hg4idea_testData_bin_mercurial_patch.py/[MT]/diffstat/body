def diffstat(lines, width=80, git=False):
    output = []
    stats = list(diffstatdata(lines))
    (maxtotal, maxname) = (0, 0)
    (totaladds, totalremoves) = (0, 0)
    hasbinary = False
    for (filename, adds, removes, isbinary) in stats:
        totaladds += adds
        totalremoves += removes
        maxname = max(maxname, len(filename))
        maxtotal = max(maxtotal, (adds + removes))
        if isbinary:
            hasbinary = True
    countwidth = len(str(maxtotal))
    if (hasbinary and (countwidth < 3)):
        countwidth = 3
    graphwidth = (((width - countwidth) - maxname) - 6)
    if (graphwidth < 10):
        graphwidth = 10

    def scale(i):
        if (maxtotal <= graphwidth):
            return i
        return max(((i * graphwidth) // maxtotal), int(bool(i)))
    for (filename, adds, removes, isbinary) in stats:
        if (git and isbinary):
            count = 'Bin'
        else:
            count = (adds + removes)
        pluses = ('+' * scale(adds))
        minuses = ('-' * scale(removes))
        output.append((' %-*s |  %*s %s%s\n' % (maxname, filename, countwidth, count, pluses, minuses)))
    if stats:
        output.append((_(' %d files changed, %d insertions(+), %d deletions(-)\n') % (len(stats), totaladds, totalremoves)))
    return ''.join(output)
