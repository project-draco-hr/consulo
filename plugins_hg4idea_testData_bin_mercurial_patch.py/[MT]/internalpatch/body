def internalpatch(patchobj, ui, strip, cwd, files=None, eolmode='strict'):
    'use builtin patch to apply <patchobj> to the working directory.\n    returns whether patch was applied with fuzz factor.'
    if (files is None):
        files = {}
    if (eolmode is None):
        eolmode = ui.config('patch', 'eol', 'strict')
    if (eolmode.lower() not in eolmodes):
        raise util.Abort((_('Unsupported line endings type: %s') % eolmode))
    eolmode = eolmode.lower()
    try:
        fp = open(patchobj, 'rb')
    except TypeError:
        fp = patchobj
    if cwd:
        curdir = os.getcwd()
        os.chdir(cwd)
    try:
        ret = applydiff(ui, fp, files, strip=strip, eolmode=eolmode)
    finally:
        if cwd:
            os.chdir(curdir)
        if (fp != patchobj):
            fp.close()
    if (ret < 0):
        raise PatchError
    return (ret > 0)
