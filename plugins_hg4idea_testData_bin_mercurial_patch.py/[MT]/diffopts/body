def diffopts(ui, opts=None, untrusted=False):

    def get(key, name=None, getter=ui.configbool):
        return ((opts and opts.get(key)) or getter('diff', (name or key), None, untrusted=untrusted))
    return mdiff.diffopts(text=(opts and opts.get('text')), git=get('git'), nodates=get('nodates'), showfunc=get('show_function', 'showfunc'), ignorews=get('ignore_all_space', 'ignorews'), ignorewsamount=get('ignore_space_change', 'ignorewsamount'), ignoreblanklines=get('ignore_blank_lines', 'ignoreblanklines'), context=get('unified', getter=ui.config))
