{
  DesignerEditorPanel designer=DesignerToolWindowManager.getInstance(myProject).getActiveDesigner();
  if (designer instanceof AndroidDesignerEditorPanel) {
    Module module=designer.getModule();
    Sdk prevSdk=myModule2Sdk.get(module);
    Sdk newSdk=ModuleRootManager.getInstance(module).getSdk();
    if (newSdk != null && (newSdk.getSdkType() instanceof AndroidSdkType || (prevSdk != null && prevSdk.getSdkType() instanceof AndroidSdkType)) && !newSdk.equals(prevSdk)) {
      AndroidSdkAdditionalData additionalData=(AndroidSdkAdditionalData)newSdk.getSdkAdditionalData();
      AndroidPlatform newPlatform=additionalData != null ? additionalData.getAndroidPlatform() : null;
      ((AndroidDesignerEditorPanel)designer).getProfileAction().getProfileManager().update(newPlatform);
    }
  }
  updateModules();
}
