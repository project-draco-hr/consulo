{
  String namePattern=getShortNamePattern(fullPattern);
  String qualifierPattern=getQualifierPattern(fullPattern);
  String newPattern=namePattern.startsWith("@") ? namePattern.substring(1) : namePattern;
  if (!nameMatches(newPattern,shortName))   return Collections.emptySet();
  List<Object> sameNameElements=new SmartList<Object>();
  final Object[] elements=myModel.getElementsByName(shortName,checkboxState,namePattern);
  Set<Object> result=new HashSet<Object>();
  if (elements.length == 1) {
    if (matchesQualifier(elements[0],qualifierPattern)) {
      result.add(elements[0]);
    }
    return result;
  }
  sameNameElements.clear();
  for (  final Object element : elements) {
    if (isCancelled.compute())     return result;
    if (matchesQualifier(element,qualifierPattern)) {
      sameNameElements.add(element);
    }
  }
  sortByProximity(sameNameElements);
  result.addAll(sameNameElements);
  return result;
}
