{
  PsiElement finalAnchorElement=null;
  if (destClass == parentClass) {
    for (finalAnchorElement=anchorElement; finalAnchorElement != null && finalAnchorElement.getParent() != destClass; finalAnchorElement=finalAnchorElement.getParent()) {
    }
  }
  PsiMember anchorMember=finalAnchorElement instanceof PsiMember ? (PsiMember)finalAnchorElement : null;
  if ((anchorMember instanceof PsiField) && anchorMember.hasModifierProperty(PsiModifier.STATIC) == psiField.hasModifierProperty(PsiModifier.STATIC)) {
    return (PsiField)destClass.addBefore(psiField,anchorMember);
  }
 else   if (anchorMember instanceof PsiClassInitializer) {
    PsiField field=(PsiField)destClass.addBefore(psiField,anchorMember);
    destClass.addBefore(CodeEditUtil.createLineFeed(field.getManager()),anchorMember);
    return field;
  }
 else {
    final PsiField forwardReference=checkForwardRefs(initializer,parentClass);
    if (forwardReference != null) {
      return (PsiField)destClass.addAfter(psiField,forwardReference);
    }
 else {
      return (PsiField)destClass.add(psiField);
    }
  }
}
