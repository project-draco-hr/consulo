{
  if (project != null && !project.isDisposed()) {
    UndoManagerImpl globalInstance=(UndoManagerImpl)UndoManager.getGlobalInstance();
    if (globalInstance != null) {
      globalInstance.dropHistoryInTests();
    }
    ((UndoManagerImpl)UndoManager.getInstance(project)).dropHistoryInTests();
    ((PsiManagerEx)PsiManager.getInstance(project)).getFileManager().cleanupForNextTest();
  }
  LocalFileSystemImpl localFileSystem=(LocalFileSystemImpl)LocalFileSystem.getInstance();
  if (localFileSystem != null) {
    localFileSystem.cleanupForNextTest();
  }
  LocalHistoryImpl.getInstanceImpl().cleanupForNextTest();
  PatchedWeakReference.clearAll();
}
