{
  if (project != null && !project.isDisposed()) {
    ((UndoManagerImpl)UndoManager.getInstance(project)).dropHistoryInTests();
    ((PsiManagerEx)PsiManager.getInstance(project)).getFileManager().cleanupForNextTest();
  }
  try {
    LocalFileSystemImpl localFileSystem=(LocalFileSystemImpl)LocalFileSystem.getInstance();
    if (localFileSystem != null) {
      localFileSystem.cleanupForNextTest(eternallyLivingFiles());
    }
  }
 catch (  IOException e) {
  }
  LocalHistoryImpl.getInstanceImpl().cleanupForNextTest();
  VirtualFilePointerManagerImpl virtualFilePointerManager=(VirtualFilePointerManagerImpl)VirtualFilePointerManager.getInstance();
  if (virtualFilePointerManager != null) {
    virtualFilePointerManager.cleanupForNextTest();
  }
  PatchedWeakReference.clearAll();
}
