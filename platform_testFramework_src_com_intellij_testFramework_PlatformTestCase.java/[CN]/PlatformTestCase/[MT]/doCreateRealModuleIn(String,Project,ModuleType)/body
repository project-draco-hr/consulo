{
  final VirtualFile baseDir=project.getBaseDir();
  assertNotNull(baseDir);
  final File moduleFile=new File(baseDir.getPath().replace('/',File.separatorChar),moduleName + ModuleFileType.DOT_DEFAULT_EXTENSION);
  FileUtil.createIfDoesntExist(moduleFile);
  myFilesToDelete.add(moduleFile);
  return new WriteAction<Module>(){
    @Override protected void run(    Result<Module> result) throws Throwable {
      final VirtualFile virtualFile=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(moduleFile);
      Module module=ModuleManager.getInstance(project).newModule(virtualFile.getPath(),moduleType.getId());
      module.getModuleFile();
      result.setResult(module);
    }
  }
.execute().getResultObject();
}
