def parse_dirstate(dmap, copymap, st):
    parents = [st[:20], st[20:40]]
    format = '>cllll'
    e_size = struct.calcsize(format)
    pos1 = 40
    l = len(st)
    while (pos1 < l):
        pos2 = (pos1 + e_size)
        e = _unpack('>cllll', st[pos1:pos2])
        pos1 = (pos2 + e[4])
        f = st[pos2:pos1]
        if ('\x00' in f):
            (f, c) = f.split('\x00')
            copymap[f] = c
        dmap[f] = e[:4]
    return parents
