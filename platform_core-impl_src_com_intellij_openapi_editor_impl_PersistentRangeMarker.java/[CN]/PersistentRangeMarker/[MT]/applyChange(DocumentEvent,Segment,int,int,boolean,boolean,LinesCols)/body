{
  final boolean shouldTranslateViaDiff=PersistentRangeMarkerUtil.shouldTranslateViaDiff(event,range.getStartOffset(),range.getEndOffset());
  Pair<TextRange,LinesCols> translated=null;
  if (shouldTranslateViaDiff) {
    translated=translateViaDiff((DocumentEventImpl)event,linesCols);
  }
  if (translated == null) {
    TextRange fallback=applyChange(event,intervalStart,intervalEnd,greedyLeft,greedyRight);
    if (fallback == null)     return null;
    LinesCols lc=storeLinesAndCols(event.getDocument(),fallback.getStartOffset(),fallback.getEndOffset());
    if (lc == null)     return null;
    translated=Pair.create(fallback,lc);
  }
  return translated;
}
