{
  DocumentEventImpl event=(DocumentEventImpl)e;
  final boolean shouldTranslateViaDiff=PersistentRangeMarkerUtil.shouldTranslateViaDiff(event,this);
  boolean wasTranslated=shouldTranslateViaDiff;
  if (shouldTranslateViaDiff) {
    wasTranslated=translateViaDiff(event);
  }
  if (!wasTranslated) {
    super.changedUpdateImpl(e);
    if (isValid()) {
      storeLinesAndCols(e);
    }
  }
  if (intervalEnd() < intervalStart() || intervalEnd() > getDocument().getTextLength() || myEndLine < myStartLine || myStartLine == myEndLine && myEndColumn < myStartColumn || getDocument().getLineCount() < myEndLine) {
    invalidate(e);
  }
}
