{
  final HgVcs vcs=HgVcs.getInstance(myProject);
  if (vcs == null) {
    return;
  }
  final HgGlobalSettings hgGlobalSettings=vcs.getGlobalSettings();
  @Nullable String rememberedLoginsForUrl=null;
  if (!StringUtils.isBlank(myURL)) {
    rememberedLoginsForUrl=hgGlobalSettings.getRememberedUserName(myURL);
  }
  String login=myProposedLogin;
  if (StringUtils.isBlank(login)) {
    login=rememberedLoginsForUrl;
  }
  String password=null;
  if (!StringUtils.isBlank(login) && myURL != null) {
    final String key=keyForUrlAndLogin(myURL,login);
    try {
      final PasswordSafeImpl passwordSafe=(PasswordSafeImpl)PasswordSafe.getInstance();
      password=passwordSafe.getMemoryProvider().getPassword(myProject,HgCommandAuthenticator.class,key);
      if (password == null && passwordSafe.getSettings().getProviderType().equals(PasswordSafeSettings.ProviderType.MASTER_PASSWORD)) {
        password=passwordSafe.getMasterKeyProvider().getPassword(myProject,HgCommandAuthenticator.class,key);
      }
    }
 catch (    PasswordSafeException e) {
      LOG.info("Couldn't get password for key [" + key + "]",e);
    }
  }
  if (!StringUtils.isBlank(password) && !StringUtils.isBlank(login)) {
    myUserName=login;
    myPassword=password;
    ok=true;
    return;
  }
  final HgUsernamePasswordDialog dialog=new HgUsernamePasswordDialog(myProject,myURL,login,password);
  dialog.show();
  if (dialog.isOK()) {
    myUserName=dialog.getUsername();
    myPassword=dialog.getPassword();
    myRememberPassword=dialog.isRememberPassword();
    ok=true;
  }
}
