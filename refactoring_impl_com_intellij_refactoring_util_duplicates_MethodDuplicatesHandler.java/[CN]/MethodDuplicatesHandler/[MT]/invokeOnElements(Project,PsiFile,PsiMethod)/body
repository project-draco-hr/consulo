{
  final ProgressIndicator progressIndicator=ProgressManager.getInstance().getProgressIndicator();
  if (progressIndicator != null && progressIndicator.isCanceled())   return false;
  final List<Match> duplicates=hasDuplicates(file,method);
  if (duplicates.isEmpty())   return false;
  final Runnable replaceRunnable=new Runnable(){
    public void run(){
      final VirtualFile virtualFile=file.getVirtualFile();
      if (virtualFile == null || !virtualFile.isValid())       return;
      if (!CommonRefactoringUtil.checkReadOnlyStatus(project,file))       return;
      final Editor editor=FileEditorManager.getInstance(project).openTextEditor(new OpenFileDescriptor(project,virtualFile),false);
      LOG.assertTrue(editor != null);
      final int duplicatesNo=duplicates.size();
      WindowManager.getInstance().getStatusBar(project).setInfo(getStatusMessage(duplicatesNo));
      CommandProcessor.getInstance().executeCommand(project,new Runnable(){
        public void run(){
          PostprocessReformattingAspect.getInstance(project).postponeFormattingInside(new Runnable(){
            public void run(){
              DuplicatesImpl.invoke(project,editor,new MethodDuplicatesMatchProvider(method,duplicates));
            }
          }
);
        }
      }
,REFACTORING_NAME,null);
      WindowManager.getInstance().getStatusBar(project).setInfo("");
    }
  }
;
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    replaceRunnable.run();
  }
 else {
    ApplicationManager.getApplication().invokeLater(replaceRunnable,ModalityState.NON_MODAL);
  }
  return true;
}
