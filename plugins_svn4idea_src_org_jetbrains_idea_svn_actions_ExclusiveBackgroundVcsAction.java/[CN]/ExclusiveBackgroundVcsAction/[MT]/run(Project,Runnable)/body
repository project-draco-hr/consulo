{
  final ProjectLevelVcsManager plVcsManager=ProjectLevelVcsManager.getInstance(project);
  plVcsManager.startBackgroundVcsOperation();
  try {
    action.run();
  }
  finally {
    final Application application=ApplicationManager.getApplication();
    if (application.isDispatchThread()) {
      application.executeOnPooledThread(new Runnable(){
        public void run(){
          plVcsManager.stopBackgroundVcsOperation();
        }
      }
);
    }
 else {
      plVcsManager.stopBackgroundVcsOperation();
    }
  }
}
