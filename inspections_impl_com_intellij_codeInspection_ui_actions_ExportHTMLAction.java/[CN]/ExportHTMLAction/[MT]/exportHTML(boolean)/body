{
  ExportToHTMLDialog exportToHTMLDialog=new ExportToHTMLDialog(myView.getProject(),exportToHTML);
  final ExportToHTMLSettings exportToHTMLSettings=ExportToHTMLSettings.getInstance(myView.getProject());
  if (exportToHTMLSettings.OUTPUT_DIRECTORY == null) {
    exportToHTMLSettings.OUTPUT_DIRECTORY=PathManager.getHomePath() + File.separator + "inspections";
  }
  exportToHTMLDialog.reset();
  exportToHTMLDialog.show();
  if (!exportToHTMLDialog.isOK()) {
    return;
  }
  exportToHTMLDialog.apply();
  final String outputDirectoryName=exportToHTMLSettings.OUTPUT_DIRECTORY;
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      final Runnable exportRunnable=new Runnable(){
        public void run(){
          if (!exportToHTML) {
            dupm2XML(outputDirectoryName);
          }
 else {
            HTMLExportFrameMaker maker=new HTMLExportFrameMaker(outputDirectoryName,myView.getProject());
            maker.start();
            try {
              exportHTML(maker);
            }
 catch (            ProcessCanceledException e) {
            }
            maker.done();
          }
        }
      }
;
      if (!ProgressManager.getInstance().runProcessWithProgressSynchronously(exportRunnable,exportToHTML ? InspectionsBundle.message("inspection.generating.html.progress.title") : InspectionsBundle.message("inspection.generating.xml.progress.title"),true,myView.getProject())) {
        return;
      }
      if (exportToHTML && exportToHTMLSettings.OPEN_IN_BROWSER) {
        BrowserUtil.launchBrowser(exportToHTMLSettings.OUTPUT_DIRECTORY + File.separator + "index.html");
      }
    }
  }
);
}
