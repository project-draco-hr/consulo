{
  final PsiClassType.ClassResolveResult resolveResult=classType.resolveGenerics();
  final PsiClass aClass=resolveResult.getElement();
  if (aClass == null) {
    LOG.assertTrue(classType instanceof PsiClassReferenceType);
    return new ClassReferenceTypePointer((PsiClassReferenceType)classType);
  }
  if (classType instanceof PsiClassReferenceType) {
    classType=((PsiClassReferenceType)classType).createImmediateCopy();
  }
  final PsiSubstitutor substitutor=resolveResult.getSubstitutor();
  final HashMap<SmartPsiElementPointer,SmartTypePointer> map=new HashMap<SmartPsiElementPointer,SmartTypePointer>();
  final Iterator<PsiTypeParameter> iterator=PsiUtil.typeParametersIterator(aClass);
  while (iterator.hasNext()) {
    PsiTypeParameter typeParameter=iterator.next();
    final PsiType substitutionResult=substitutor.substitute(typeParameter);
    if (substitutionResult != null) {
      final SmartPsiElementPointer pointer=createSmartPsiElementPointer(typeParameter);
      map.put(pointer,substitutionResult.accept(this));
    }
  }
  return new ClassTypePointer(classType,createSmartPsiElementPointer(aClass),map);
}
