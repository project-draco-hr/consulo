{
synchronized (file) {
    ArrayList<WeakReference<SmartPointerEx>> pointers=file.getUserData(SMART_POINTERS_IN_PSI_FILE_KEY);
    if (pointers == null)     return;
    int index=0;
    for (    WeakReference<SmartPointerEx> reference : pointers) {
      SmartPointerEx pointer=reference.get();
      if (pointer != null) {
        pointer.documentAndPsiInSync();
        pointers.set(index++,reference);
      }
    }
    int size=pointers.size();
    for (int i=size - 1; i >= index; i--) {
      pointers.remove(i);
    }
  }
}
