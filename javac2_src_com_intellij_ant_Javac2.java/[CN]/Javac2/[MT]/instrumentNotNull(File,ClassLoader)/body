{
  int instrumented=0;
  final File[] files=dir.listFiles();
  for (int i=0; i < files.length; i++) {
    File file=files[i];
    final String name=file.getName();
    if (name.endsWith(".class")) {
      final String path=file.getPath();
      log("Adding @NotNull assertions to " + path,Project.MSG_VERBOSE);
      try {
        final FileInputStream inputStream=new FileInputStream(file);
        try {
          ClassReader reader=new ClassReader(inputStream);
          ClassWriter writer=new AntClassWriter(ClassWriter.COMPUTE_FRAMES,loader);
          final NotNullVerifyingInstrumenter instrumenter=new NotNullVerifyingInstrumenter(writer);
          reader.accept(instrumenter,0);
          if (instrumenter.isModification()) {
            final FileOutputStream fileOutputStream=new FileOutputStream(path);
            try {
              fileOutputStream.write(writer.toByteArray());
              instrumented++;
            }
  finally {
              fileOutputStream.close();
            }
          }
        }
  finally {
          inputStream.close();
        }
      }
 catch (      IOException e) {
        log("Failed to instrument @NotNull assertion for " + path + ": "+ e.getMessage(),Project.MSG_WARN);
      }
    }
 else     if (file.isDirectory()) {
      instrumented+=instrumentNotNull(file,loader);
    }
  }
  return instrumented;
}
