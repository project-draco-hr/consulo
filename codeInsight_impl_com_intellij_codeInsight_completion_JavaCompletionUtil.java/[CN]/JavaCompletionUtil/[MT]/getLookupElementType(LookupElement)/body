{
  PsiType qualifierType=null;
  final TypedLookupItem typed=element.as(TypedLookupItem.class);
  if (typed != null) {
    return typed.getType();
  }
  final Object o=element.getObject();
  if (o instanceof PsiVariable) {
    qualifierType=((PsiVariable)o).getType();
  }
 else   if (o instanceof PsiMethod) {
    qualifierType=((PsiMethod)o).getReturnType();
  }
 else   if (o instanceof PsiExpression) {
    qualifierType=((PsiExpression)o).getType();
  }
  final LookupItem lookupItem=element.as(LookupItem.class);
  if (lookupItem != null) {
    final PsiSubstitutor substitutor=(PsiSubstitutor)lookupItem.getAttribute(LookupItem.SUBSTITUTOR);
    if (substitutor != null) {
      qualifierType=substitutor.substitute(qualifierType);
    }
  }
  return qualifierType;
}
