{
  final DataContext dataContext=e.getDataContext();
  final Module[] modules=LangDataKeys.MODULE_CONTEXT_ARRAY.getData(dataContext);
  final String[] newGroup;
  if (myModuleGroup != null) {
    String message=IdeBundle.message("prompt.specify.name.of.module.subgroup",myModuleGroup.presentableText(),whatToMove(modules));
    String subgroup=Messages.showInputDialog(message,IdeBundle.message("title.module.sub.group"),Messages.getQuestionIcon());
    if (subgroup == null || "".equals(subgroup.trim()))     return;
    newGroup=ArrayUtil.append(myModuleGroup.getGroupPath(),subgroup);
  }
 else {
    String message=IdeBundle.message("prompt.specify.module.group.name",whatToMove(modules));
    String group=Messages.showInputDialog(message,IdeBundle.message("title.module.group"),Messages.getQuestionIcon());
    if (group == null || "".equals(group.trim()))     return;
    newGroup=new String[]{group};
  }
  doMove(modules,new ModuleGroup(newGroup),dataContext);
}
