{
  myManager.getState().saveContextOnCommit=true;
  assertEquals(1,myManager.getLocalTasks().size());
  assertEquals(1,myChangeListManager.getChangeLists().size());
  myManager.getState().associateWithTaskForNewChangelist=false;
  LocalChangeList changeList=addChangeList("New Changelist","");
  myManager.getState().associateWithTaskForNewChangelist=true;
  assertEquals(1,myManager.getLocalTasks().size());
  assertEquals(2,myChangeListManager.getChangeLists().size());
  CommitChangeListDialog.commitChanges(getProject(),Collections.<Change>emptyList(),changeList,null,changeList.getName());
  assertEquals(2,myManager.getLocalTasks().size());
  assertEquals(2,myChangeListManager.getChangeLists().size());
  assertTrue(ContainerUtil.exists(myManager.getLocalTasks(),new Condition<LocalTask>(){
    @Override public boolean value(    final LocalTask task){
      return task.getSummary().equals("New Changelist");
    }
  }
));
}
