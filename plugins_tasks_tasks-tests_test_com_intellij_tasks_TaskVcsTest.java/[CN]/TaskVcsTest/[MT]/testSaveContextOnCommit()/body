{
  myTaskManager.getState().saveContextOnCommit=true;
  assertEquals(1,myTaskManager.getLocalTasks().size());
  assertEquals(1,myChangeListManager.getChangeListsCopy().size());
  LocalChangeList changeList=addChangeList("New Changelist","");
  assertEquals(1,myTaskManager.getLocalTasks().size());
  assertEquals(2,myChangeListManager.getChangeListsCopy().size());
  CommitChangeListDialog.commitChanges(getProject(),Collections.<Change>emptyList(),changeList,null,changeList.getName());
  assertEquals(2,myTaskManager.getLocalTasks().size());
  assertEquals(2,myChangeListManager.getChangeListsCopy().size());
  assertTrue(ContainerUtil.exists(myTaskManager.getLocalTasks(),new Condition<LocalTask>(){
    @Override public boolean value(    final LocalTask task){
      return task.getSummary().equals("New Changelist");
    }
  }
));
}
