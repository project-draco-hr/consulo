{
  super.setUp();
  myVcs=new MockAbstractVcs(getProject());
  AllVcses.getInstance(getProject()).registerManually(myVcs);
  myChangeListManager=ChangeListManager.getInstance(getProject());
  myChangeListManager.removeChangeListListener(myTaskManager.getChangeListListener());
  addChangeList(LocalChangeList.DEFAULT_NAME,"");
  final LocalChangeList defaultChangeList=myChangeListManager.findChangeList(LocalChangeList.DEFAULT_NAME);
  assertNotNull(defaultChangeList);
  setDefaultChangeList(defaultChangeList);
  for (  LocalChangeList changeList : myChangeListManager.getChangeLists()) {
    if (!changeList.isDefault())     removeChangeList(changeList);
  }
  myTaskManager.initComponent();
  ProjectLevelVcsManager.getInstance(getProject()).setDirectoryMapping("",myVcs.getName());
  ProjectLevelVcsManager.getInstance(getProject()).hasActiveVcss();
  myRepository=new TestRepository();
  myRepository.setTasks(new Task(){
    @NotNull @Override public String getId(){
      return "TEST-001";
    }
    @NotNull @Override public String getSummary(){
      return "Summary";
    }
    @Override public String getDescription(){
      return null;
    }
    @NotNull @Override public Comment[] getComments(){
      return new Comment[0];
    }
    @NotNull @Override public Icon getIcon(){
      return TasksIcons.Unknown;
    }
    @NotNull @Override public TaskType getType(){
      return TaskType.BUG;
    }
    @Override public Date getUpdated(){
      return null;
    }
    @Override public Date getCreated(){
      return null;
    }
    @Override public boolean isClosed(){
      return false;
    }
    @Override public boolean isIssue(){
      return true;
    }
    @Override public String getIssueUrl(){
      return null;
    }
    @Override public TaskRepository getRepository(){
      return myRepository;
    }
  }
);
  myTaskManager.setRepositories(Collections.singletonList(myRepository));
}
