{
  myManager.getState().saveContextOnCommit=true;
  assertEquals(1,myManager.getLocalTasks().length);
  Task task=myRepository.findTask("TEST-001");
  assertNotNull(task);
  myManager.activateTask(task,false,true);
  assertEquals(2,myManager.getLocalTasks().length);
  assertEquals(2,myChangeListManager.getChangeLists().size());
  LocalTask localTask=myManager.getActiveTask();
  List<ChangeListInfo> changelists=localTask.getChangeLists();
  ChangeListInfo info=changelists.get(0);
  LocalChangeList changeList=myChangeListManager.getChangeList(info.id);
  assertNotNull(changeList);
  CommitChangeListDialog.commitChanges(getProject(),Collections.<Change>emptyList(),changeList,null,changeList.getName());
  assertEquals(2,myManager.getLocalTasks().length);
  assertEquals(2,myChangeListManager.getChangeLists().size());
  assertEquals(localTask,myManager.getAssociatedTask(changeList));
}
