{
  final LocalTask defaultTask=myTaskManager.getLocalTasks().get(0);
  Task task=myRepository.findTask("TEST-001");
  assertNotNull(task);
  myTaskManager.activateTask(task,false,false);
  assertEquals(2,myTaskManager.getLocalTasks().size());
  LocalTask localTask=myTaskManager.getActiveTask();
  assertEquals(task,localTask);
  assertEquals(0,localTask.getChangeLists().size());
  assertEquals(1,defaultTask.getChangeLists().size());
  assertEquals(1,myChangeListManager.getChangeLists().size());
  assertEquals(defaultTask,myTaskManager.getAssociatedTask(myChangeListManager.getChangeLists().get(0)));
  myTaskManager.activateTask(defaultTask,false,false);
  assertEquals(0,localTask.getChangeLists().size());
  assertEquals(1,defaultTask.getChangeLists().size());
  assertEquals(1,myChangeListManager.getChangeLists().size());
  assertEquals(defaultTask,myTaskManager.getAssociatedTask(myChangeListManager.getChangeLists().get(0)));
  myTaskManager.activateTask(localTask,false,true);
  assertEquals(1,localTask.getChangeLists().size());
  assertEquals(1,defaultTask.getChangeLists().size());
  assertEquals(2,myChangeListManager.getChangeLists().size());
  LocalChangeList activeChangeList=myChangeListManager.getDefaultChangeList();
  LocalChangeList anotherChangeList=myChangeListManager.getChangeLists().get(1 - myChangeListManager.getChangeLists().indexOf(activeChangeList));
  assertEquals(localTask,myTaskManager.getAssociatedTask(activeChangeList));
  assertEquals(activeChangeList.getName(),"TEST-001 Summary");
  assertEquals(defaultTask,myTaskManager.getAssociatedTask(anotherChangeList));
  assertEquals(anotherChangeList.getName(),"Default");
  myTaskManager.activateTask(defaultTask,false,false);
  assertEquals(1,localTask.getChangeLists().size());
  assertEquals(1,defaultTask.getChangeLists().size());
  assertEquals(2,myChangeListManager.getChangeLists().size());
  activeChangeList=myChangeListManager.getDefaultChangeList();
  anotherChangeList=myChangeListManager.getChangeLists().get(1 - myChangeListManager.getChangeLists().indexOf(activeChangeList));
  assertEquals(defaultTask,myTaskManager.getAssociatedTask(activeChangeList));
  assertEquals(activeChangeList.getName(),"Default");
  assertEquals(localTask,myTaskManager.getAssociatedTask(anotherChangeList));
  assertEquals(anotherChangeList.getName(),"TEST-001 Summary");
}
