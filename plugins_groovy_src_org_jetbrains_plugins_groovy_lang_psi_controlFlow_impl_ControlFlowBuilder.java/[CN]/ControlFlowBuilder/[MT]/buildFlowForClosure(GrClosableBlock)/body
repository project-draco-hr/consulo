{
  for (  GrParameter parameter : closure.getParameters()) {
    addNode(new ReadWriteVariableInstructionImpl(parameter,myInstructionNumber++));
  }
  final Set<String> names=new LinkedHashSet<String>();
  closure.accept(new GroovyRecursiveElementVisitor(){
    public void visitReferenceExpression(    GrReferenceExpression refExpr){
      super.visitReferenceExpression(refExpr);
      if (refExpr.getQualifierExpression() == null && !PsiUtil.isLValue(refExpr)) {
        if (!(refExpr.getParent() instanceof GrCall)) {
          final String refName=refExpr.getReferenceName();
          PropertyResolverProcessor processor=new PropertyResolverProcessor(refName,refExpr,false);
          ResolveUtil.treeWalkUp(refExpr,processor,closure.getParent());
          if (!processor.hasCandidates()) {
            names.add(refName);
          }
        }
      }
    }
  }
);
  names.add("owner");
  for (  String name : names) {
    addNode(new ReadWriteVariableInstructionImpl(name,closure.getLBrace(),myInstructionNumber++,true));
  }
  PsiElement child=closure.getFirstChild();
  while (child != null) {
    if (child instanceof GroovyPsiElement) {
      ((GroovyPsiElement)child).accept(this);
    }
    child=child.getNextSibling();
  }
}
