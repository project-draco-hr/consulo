{
  InstructionImpl ifInstruction=startNode(ifStatement);
  final InstructionImpl head=myHead;
  final GrCondition condition=ifStatement.getCondition();
  final GrStatement thenBranch=ifStatement.getThenBranch();
  final GrStatement elseBranch=ifStatement.getElseBranch();
  InstructionImpl conditionEnd=null;
  InstructionImpl thenEnd=null;
  InstructionImpl elseEnd=null;
  ConditionInstruction conditionStart=null;
  if (condition != null) {
    conditionStart=addNodeAndCheckPending(new ConditionInstruction(condition,myInstructionNumber++));
    registerCondition(conditionStart);
    condition.accept(this);
    conditionEnd=myHead;
  }
  if (thenBranch != null) {
    thenBranch.accept(this);
    handlePossibleReturn(thenBranch);
    thenEnd=myHead;
    interruptFlow();
  }
  if (condition != null) {
    myHead=conditionEnd;
    myNegatingStack.push(addNode(new NegatingGotoInstruction(condition,myInstructionNumber++,conditionStart)));
  }
 else {
    myHead=head;
  }
  if (elseBranch != null) {
    elseBranch.accept(this);
    handlePossibleReturn(elseBranch);
    elseEnd=myHead;
  }
  if (thenBranch != null || elseBranch != null) {
    final InstructionImpl end=new IfEndInstruction(ifStatement,myInstructionNumber++);
    addNode(end);
    if (thenEnd != null)     addEdge(thenEnd,end);
    if (elseEnd != null)     addEdge(elseEnd,end);
  }
  finishNode(ifInstruction);
}
