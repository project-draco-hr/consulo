{
  myInstructions=new ArrayList<InstructionImpl>();
  myProcessingStack=new Stack<InstructionImpl>();
  myCatchedExceptionInfos=new Stack<ExceptionInfo>();
  myPending=new ArrayList<Pair<InstructionImpl,GroovyPsiElement>>();
  myInstructionNumber=0;
  myStartInScope=startInScope;
  myEndInScope=endInScope;
  myIsInScope=startInScope == null;
  final InstructionImpl first=startNode(null);
  if (scope instanceof GrClosableBlock) {
    buildFlowForClosure((GrClosableBlock)scope);
  }
  scope.accept(this);
  if (myHead == first) {
    flowAbrupted();
  }
  final InstructionImpl end=startNode(null);
  checkPending(end);
  return myInstructions.toArray(new Instruction[myInstructions.size()]);
}
