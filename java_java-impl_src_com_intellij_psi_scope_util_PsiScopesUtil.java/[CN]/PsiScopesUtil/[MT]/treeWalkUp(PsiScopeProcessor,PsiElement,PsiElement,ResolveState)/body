{
  PsiElement prevParent=entrance;
  PsiElement scope=entrance;
  while (scope != null) {
    ProgressIndicatorProvider.checkCanceled();
    if (scope instanceof PsiClass) {
      processor.handleEvent(JavaScopeProcessorEvent.SET_CURRENT_FILE_CONTEXT,scope);
    }
    if (!scope.processDeclarations(processor,state,prevParent,entrance)) {
      return false;
    }
    if (scope instanceof PsiModifierListOwner && !(scope instanceof PsiParameter)) {
      PsiModifierList modifierList=((PsiModifierListOwner)scope).getModifierList();
      if (modifierList != null && modifierList.hasModifierProperty(PsiModifier.STATIC)) {
        processor.handleEvent(JavaScopeProcessorEvent.START_STATIC,null);
      }
    }
    if (scope == maxScope)     break;
    prevParent=scope;
    scope=prevParent.getContext();
    processor.handleEvent(JavaScopeProcessorEvent.CHANGE_LEVEL,null);
  }
  return true;
}
