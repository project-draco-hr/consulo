{
  if (element instanceof PsiField) {
    new RenameJavaVariableProcessor().renameElement(element,newName,usages,listener);
  }
 else {
    if (element instanceof PsiNamedElement) {
      super.renameElement(element,newName,usages,listener);
      if (element instanceof PsiFile) {
        VirtualFile virtualFile=((PsiFile)element).getVirtualFile();
        if (virtualFile != null && !LocalHistory.getInstance().isUnderControl(virtualFile)) {
          DocumentReference ref=DocumentReferenceManager.getInstance().create(virtualFile);
          UndoManager.getInstance(element.getProject()).nonundoableActionPerformed(ref,false);
        }
      }
    }
 else     if (element instanceof XmlAttributeValue) {
      new RenameXmlAttributeProcessor().renameElement(element,newName,usages,listener);
    }
  }
}
