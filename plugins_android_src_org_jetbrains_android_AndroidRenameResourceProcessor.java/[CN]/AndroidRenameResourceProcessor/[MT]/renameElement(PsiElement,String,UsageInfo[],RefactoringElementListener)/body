{
  if (element instanceof PsiField) {
    new RenameJavaVariableProcessor().renameElement(element,newName,usages,listener);
  }
 else {
    super.renameElement(element,newName,usages,listener);
    if (element instanceof PsiFile) {
      VirtualFile virtualFile=((PsiFile)element).getVirtualFile();
      if (!LocalHistory.getInstance().isUnderControl(virtualFile)) {
        DocumentReference ref=DocumentReferenceManager.getInstance().create(virtualFile);
        UndoManager.getInstance(element.getProject()).nonundoableActionPerformed(ref,false);
      }
    }
  }
}
