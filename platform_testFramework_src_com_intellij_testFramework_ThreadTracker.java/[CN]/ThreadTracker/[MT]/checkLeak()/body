{
  try {
    if (myDefaultProjectInitialized != ((ProjectManagerImpl)ProjectManager.getInstance()).isDefaultProjectInitialized())     return;
    Collection<Thread> after=new THashSet<Thread>(getThreads());
    after.removeAll(before);
    for (    Thread thread : after) {
      if (thread == Thread.currentThread())       continue;
      ThreadGroup group=thread.getThreadGroup();
      if (group != null && "system".equals(group.getName()))       continue;
      String name=thread.getName();
      if (name.startsWith("AWT-EventQueue-0"))       continue;
      if (name.startsWith("JobScheduler pool "))       continue;
      if (wellKnownOffenders.contains(name))       continue;
      String trace="Thread leaked: " + thread + ": "+ name+ ";\n ";
      for (      final StackTraceElement stackTraceElement : thread.getStackTrace()) {
        trace+=" at " + stackTraceElement + "\n";
      }
      Assert.fail(trace);
    }
  }
  finally {
    before.clear();
  }
}
