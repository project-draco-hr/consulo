{
  if (javadocPath != null) {
    Element child=new Element(EclipseXml.ATTRIBUTES_TAG);
    element.addContent(child);
    Element attrElement=child.getChild(EclipseXml.ATTRIBUTE_TAG);
    if (attrElement == null) {
      attrElement=new Element(EclipseXml.ATTRIBUTE_TAG);
      child.addContent(attrElement);
    }
    attrElement.setAttribute("name","javadoc_location");
    final String protocol=VirtualFileManager.extractProtocol(javadocPath);
    if (!Comparing.strEqual(protocol,HttpFileSystem.getInstance().getProtocol())) {
      final String path=VfsUtil.urlToPath(javadocPath);
      final VirtualFile contentRoot=getContentRoot();
      final Project project=myModel.getModule().getProject();
      final VirtualFile baseDir=contentRoot != null ? contentRoot.getParent() : project.getBaseDir();
      if (Comparing.strEqual(protocol,JarFileSystem.getInstance().getProtocol())) {
        final VirtualFile javadocFile=JarFileSystem.getInstance().getVirtualFileForJar(VirtualFileManager.getInstance().findFileByUrl(javadocPath));
        if (javadocFile != null) {
          String relativeUrl=relativeToOtherModulePath(project,javadocFile);
          if (relativeUrl == null && VfsUtil.isAncestor(baseDir,javadocFile,false)) {
            relativeUrl="/" + VfsUtil.getRelativePath(javadocFile,baseDir,'/');
          }
          if (relativeUrl != null) {
            if (javadocPath.indexOf(JarFileSystem.JAR_SEPARATOR) == -1) {
              javadocPath=StringUtil.trimEnd(javadocPath,"/") + JarFileSystem.JAR_SEPARATOR;
            }
            javadocPath=EclipseXml.JAR_PREFIX + EclipseXml.PLATFORM_PROTOCOL + "resource"+ relativeUrl+ javadocPath.substring(javadocFile.getUrl().length() - 1);
          }
 else {
            javadocPath=EclipseXml.JAR_PREFIX + EclipseXml.FILE_PROTOCOL + StringUtil.trimStart(path,"/");
          }
        }
 else {
          javadocPath=EclipseXml.JAR_PREFIX + EclipseXml.FILE_PROTOCOL + StringUtil.trimStart(path,"/");
        }
      }
 else       if (new File(path).exists()) {
        javadocPath=EclipseXml.FILE_PROTOCOL + StringUtil.trimStart(path,"/");
      }
    }
    attrElement.setAttribute("value",javadocPath);
  }
}
