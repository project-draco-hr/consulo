{
  if (javadocPath != null) {
    Element child=new Element(EclipseXml.ATTRIBUTES_TAG);
    element.addContent(child);
    Element attrElement=child.getChild(EclipseXml.ATTRIBUTE_TAG);
    if (attrElement == null) {
      attrElement=new Element(EclipseXml.ATTRIBUTE_TAG);
      child.addContent(attrElement);
    }
    attrElement.setAttribute("name","javadoc_location");
    final String protocol=VirtualFileManager.extractProtocol(javadocPath);
    if (!Comparing.strEqual(protocol,HttpFileSystem.getInstance().getProtocol())) {
      final String path=VfsUtil.urlToPath(javadocPath);
      final VirtualFile contentRoot=getContentRoot();
      final VirtualFile baseDir=contentRoot != null ? contentRoot.getParent() : myModel.getModule().getProject().getBaseDir();
      if (Comparing.strEqual(protocol,JarFileSystem.getInstance().getProtocol())) {
        final VirtualFile javadocFile=JarFileSystem.getInstance().getVirtualFileForJar(VirtualFileManager.getInstance().findFileByUrl(javadocPath));
        if (javadocFile != null && VfsUtil.isAncestor(baseDir,javadocFile,false)) {
          if (javadocPath.indexOf(JarFileSystem.JAR_SEPARATOR) == -1) {
            javadocPath=StringUtil.trimEnd(javadocPath,"/") + JarFileSystem.JAR_SEPARATOR;
          }
          javadocPath=EclipseXml.JAR_PREFIX + EclipseXml.PLATFORM_PROTOCOL + "resource/"+ VfsUtil.getRelativePath(javadocFile,baseDir,'/')+ javadocPath.substring(javadocFile.getUrl().length() - 1);
        }
 else {
          javadocPath=EclipseXml.JAR_PREFIX + EclipseXml.FILE_PROTOCOL + StringUtil.trimStart(path,"/");
        }
      }
 else       if (new File(path).exists()) {
        javadocPath=EclipseXml.FILE_PROTOCOL + StringUtil.trimStart(path,"/");
      }
    }
    attrElement.setAttribute("value",javadocPath);
  }
}
