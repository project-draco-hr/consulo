{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      CommandProcessor.getInstance().executeCommand(callback.getProject(),new Runnable(){
        public void run(){
          EditorModificationUtil.deleteSelectedText(callback.getEditor());
          PsiDocumentManager.getInstance(callback.getProject()).commitAllDocuments();
          callback.fixInitialState();
          expand(abbreviation,callback,selection);
          if (listener != null) {
            listener.finished();
          }
        }
      }
,CodeInsightBundle.message("insert.code.template.command"),null);
    }
  }
);
}
