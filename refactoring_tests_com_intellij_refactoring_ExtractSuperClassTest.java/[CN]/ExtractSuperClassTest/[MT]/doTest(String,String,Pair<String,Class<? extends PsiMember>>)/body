{
  String rootBefore=getRoot() + "/before";
  PsiTestUtil.removeAllRoots(myModule,JavaSdkImpl.getMockJdk("java 1.4"));
  final VirtualFile rootDir=PsiTestUtil.createTestProjectStructure(myProject,myModule,rootBefore,myFilesToDelete);
  PsiClass psiClass=myPsiManager.findClass(className,ProjectScope.getAllScope(myProject));
  assertNotNull(psiClass);
  final MemberInfo[] members=PullUpTest.findMembers(psiClass,membersToFind);
  ExtractSuperClassProcessor processor=new ExtractSuperClassProcessor(myProject,psiClass.getContainingFile().getContainingDirectory(),newClassName,psiClass,members,false,new JavaDocPolicy(JavaDocPolicy.ASIS));
  processor.run();
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  FileDocumentManager.getInstance().saveAllDocuments();
  String rootAfter=getRoot() + "/after";
  VirtualFile rootDir2=LocalFileSystem.getInstance().findFileByPath(rootAfter.replace(File.separatorChar,'/'));
  myProject.getComponent(PostprocessReformattingAspect.class).doPostponedFormatting();
  IdeaTestUtil.assertDirectoriesEqual(rootDir2,rootDir,MultiFileTestCase.CVS_FILE_FILTER);
}
