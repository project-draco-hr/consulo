{
  ProgramRunner runner=getRunner(executor.getId(),configuration);
  if (runner == null) {
    LOG.error("Runner MUST not be null! Cannot find runner for " + executor.getId() + " and "+ configuration.getConfiguration().getFactory().getName());
    return;
  }
  if (ExecutorRegistry.getInstance().isStarting(project,executor.getId(),runner.getRunnerId())) {
    return;
  }
  if (!RunManagerImpl.canRunConfiguration(configuration,executor) || (showSettings && RunManagerImpl.isEditBeforeRun(configuration))) {
    final boolean result=RunDialog.editConfiguration(project,configuration,"Edit configuration",executor.getActionName(),executor.getIcon());
    if (!result) {
      return;
    }
    while (!RunManagerImpl.canRunConfiguration(configuration,executor)) {
      if (0 == Messages.showYesNoDialog(project,"Configuration is still wrong. Do you want to edit it again?","Change Configuration Settings",Messages.getErrorIcon())) {
        final boolean result2=RunDialog.editConfiguration(project,configuration,"Edit configuration",executor.getActionName(),executor.getIcon());
        if (!result2) {
          return;
        }
      }
 else {
        break;
      }
    }
  }
  final ConfigurationType configurationType=configuration.getType();
  if (configurationType != null) {
    UsageTrigger.trigger("execute." + ConvertUsagesUtil.ensureProperKey(configurationType.getId()) + "."+ executor.getId());
  }
  try {
    runner.execute(executor,new ExecutionEnvironment(runner,configuration,project));
  }
 catch (  ExecutionException e) {
    ExecutionUtil.handleExecutionError(project,executor.getToolWindowId(),configuration.getConfiguration(),e);
  }
}
