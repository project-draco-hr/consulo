{
  if (handler == null)   return null;
  FindUsagesOptions findUsagesOptions=handler.getFindUsagesOptions(DataManager.getInstance().getDataContext());
  PsiElement element=handler.getPsiElement();
  LOG.assertTrue(element.isValid());
  final UsageInfoToUsageConverter.TargetElementsDescriptor descriptor=new UsageInfoToUsageConverter.TargetElementsDescriptor(handler.getPrimaryElements(),handler.getSecondaryElements());
  UsageViewPresentation presentation=createPresentation(element,findUsagesOptions,myToOpenInNewTab);
  final UsageSearcher usageSearcher=createUsageSearcher(descriptor,handler,findUsagesOptions,null);
  final boolean[] canceled={false};
  final AtomicInteger usageCount=new AtomicInteger();
  Task task=new Task.Modal(myProject,UsageViewManagerImpl.getProgressTitle(presentation),true){
    @Override public void run(    @NotNull final ProgressIndicator indicator){
      usageSearcher.generate(new Processor<Usage>(){
        @Override public boolean process(        final Usage usage){
          usageCount.incrementAndGet();
          return processor.process(usage);
        }
      }
);
    }
    @Override @Nullable public NotificationInfo getNotificationInfo(){
      return new NotificationInfo("Find Usages","Find Usages Finished",usageCount.get() + " Usage(s) Found");
    }
    @Override public void onCancel(){
      canceled[0]=true;
    }
  }
;
  ProgressManager.getInstance().run(task);
  if (canceled[0])   return null;
  return presentation;
}
