{
  final FindUsagesHandler handler=getFindUsagesHandler(psiElement,false);
  if (handler == null)   return;
  boolean singleFile=scopeFile != null;
  final AbstractFindUsagesDialog dialog=handler.getFindUsagesDialog(singleFile,shouldOpenInNewTab(),mustOpenInNewTab());
  if (!singleFile) {
    dialog.show();
    if (!dialog.isOK())     return;
  }
 else {
    dialog.close(DialogWrapper.OK_EXIT_CODE);
  }
  setOpenInNewTab(dialog.isShowInSeparateWindow());
  FindUsagesOptions findUsagesOptions=dialog.calcFindUsagesOptions();
  clearFindingNextUsageInFile();
  LOG.assertTrue(handler.getPsiElement().isValid());
  PsiElement[] primaryElements=handler.getPrimaryElements();
  checkNotNull(primaryElements,handler,"getPrimaryElements()");
  PsiElement[] secondaryElements=handler.getSecondaryElements();
  checkNotNull(secondaryElements,handler,"getSecondaryElements()");
  UsageInfoToUsageConverter.TargetElementsDescriptor descriptor=new UsageInfoToUsageConverter.TargetElementsDescriptor(primaryElements,secondaryElements);
  if (singleFile) {
    findUsagesOptions=(FindUsagesOptions)findUsagesOptions.clone();
    editor.putUserData(KEY_START_USAGE_AGAIN,null);
    findUsagesInEditor(descriptor,handler,scopeFile,FileSearchScope.FROM_START,findUsagesOptions,editor);
  }
 else {
    findUsages(descriptor,handler,dialog.isSkipResultsWhenOneUsage(),dialog.isShowInSeparateWindow(),findUsagesOptions);
  }
}
