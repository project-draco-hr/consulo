{
  final CommitFilesOperation operation=new CommitFilesOperation(commitMessage,makeNewFilesReadOnly);
  if (selectedFiles != null) {
    for (    FilePath selectedFile : selectedFiles) {
      operation.addFile(selectedFile.getIOFile());
    }
  }
  if (!dirsToPrune.isEmpty()) {
    operation.addFinishAction(new Runnable(){
      @Override public void run(){
        final IOFilesBasedDirectoryPruner pruner=new IOFilesBasedDirectoryPruner(null);
        for (        File dir : dirsToPrune) {
          pruner.addFile(dir);
        }
        pruner.execute();
      }
    }
);
  }
  final CommandCvsHandler result=new CommandCvsHandler(title,operation,FileSetToBeUpdated.selectedFiles(selectedFiles));
  if (tagFilesAfterCommit) {
    result.addOperation(new TagOperation(selectedFiles,tagName,CvsConfiguration.getInstance(project).OVERRIDE_EXISTING_TAG_FOR_PROJECT));
  }
  return result;
}
