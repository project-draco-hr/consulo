{
  AddFilesOperation operation=new AddFilesOperation();
  ArrayList<AddedFileInfo> addedFileInfo=new ArrayList<AddedFileInfo>();
  for (  final AddedFileInfo info : addedRoots) {
    info.clearAllCvsAdminDirectoriesInIncludedDirectories();
    addedFileInfo.addAll(info.collectAllIncludedFiles());
  }
  ArrayList<VirtualFile> addedFiles=new ArrayList<VirtualFile>();
  for (  AddedFileInfo info : addedFileInfo) {
    addedFiles.add(info.getFile());
    operation.addFile(info.getFile(),info.getKeywordSubstitution());
  }
  return new CommandCvsHandler(CvsBundle.message("action.name.add"),operation,FileSetToBeUpdated.selectedFiles(addedFiles.toArray(new VirtualFile[addedFiles.size()])),VcsConfiguration.getInstance(project).getAddRemoveOption());
}
