{
  if (!getRootModel().isWritable()) {
    return myLibrary;
  }
  if (ApplicationManager.getApplication().isUnitTestMode())   return myLibrary;
  final Project project=getRootModel().getModule().getProject();
  final StructureConfigrableContext context=ProjectStructureConfigurable.getInstance(project).getContext();
  Library library=null;
  if (myLibrary == null) {
    if (myLibraryName != null) {
      library=context.getLibrary(myLibraryName,myLibraryLevel);
    }
  }
 else {
    library=context.getLibrary(myLibrary.getName(),myLibrary.getTable().getTableLevel());
  }
  if (library != null) {
    return library;
  }
  if (myLibrary != null) {
    myLibraryName=myLibrary.getName();
    myLibraryLevel=myLibrary.getTable().getTableLevel();
  }
  myLibrary=null;
  return null;
}
