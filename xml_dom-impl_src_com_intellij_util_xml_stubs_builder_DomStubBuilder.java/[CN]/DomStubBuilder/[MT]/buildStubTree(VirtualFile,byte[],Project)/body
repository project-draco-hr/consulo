{
  PsiFile psiFile=PsiManager.getInstance(project).findFile(file);
  if (!(psiFile instanceof XmlFile))   return null;
  XmlFile xmlFile=(XmlFile)psiFile;
  DomManager manager=DomManager.getDomManager(project);
  try {
    xmlFile.putUserData(BUILDING_DOM_STUBS,Boolean.TRUE);
    DomFileElement<? extends DomElement> fileElement=manager.getFileElement(xmlFile);
    if (fileElement == null || !fileElement.getFileDescription().hasStubs())     return null;
    FileStub fileStub=new FileStub(NanoXmlUtil.parseHeader(new ByteArrayInputStream(content)));
    DomStubBuilderVisitor visitor=new DomStubBuilderVisitor(fileStub);
    visitor.visitDomElement(fileElement.getRootElement());
    return fileStub;
  }
  finally {
    xmlFile.putUserData(BUILDING_DOM_STUBS,null);
  }
}
