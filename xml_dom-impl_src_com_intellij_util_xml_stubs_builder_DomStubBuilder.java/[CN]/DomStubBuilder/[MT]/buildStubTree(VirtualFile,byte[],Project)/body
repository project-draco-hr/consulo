{
  PsiFile psiFile=PsiManager.getInstance(project).findFile(file);
  if (!(psiFile instanceof XmlFile))   return null;
  XmlFile xmlFile=(XmlFile)psiFile;
  DomManager manager=DomManager.getDomManager(project);
  try {
    xmlFile.putUserData(XmlUtil.BUILDING_DOM_STUBS,Boolean.TRUE);
    DomFileElement<? extends DomElement> fileElement=manager.getFileElement(xmlFile);
    if (fileElement == null || !fileElement.getFileDescription().hasStubs())     return null;
    XmlFileHeader header=DomService.getInstance().getXmlFileHeader(xmlFile);
    if (header.getRootTagLocalName() == null) {
      LOG.error("null root tag for " + fileElement + " for "+ file);
    }
    FileStub fileStub=new FileStub(header);
    DomStubBuilderVisitor visitor=new DomStubBuilderVisitor(fileStub);
    visitor.visitDomElement(fileElement.getRootElement());
    return fileStub;
  }
  finally {
    xmlFile.putUserData(XmlUtil.BUILDING_DOM_STUBS,null);
  }
}
