{
  myParentComponent=parentComponent;
  LOG.assertTrue(myParentComponent != null);
  myFocusBackComponent=focusBackComponent;
  LOG.assertTrue(myParentComponent.isShowing());
  myEscListener=new MyEscListener();
  myComponent.registerKeyboardAction(myEscListener,KeyStroke.getKeyStroke(KeyEvent.VK_ESCAPE,0),JComponent.WHEN_ANCESTOR_OF_FOCUSED_COMPONENT);
  final JLayeredPane layeredPane=parentComponent.getRootPane().getLayeredPane();
  if (fitsLayeredPane(layeredPane,myComponent,new RelativePoint(parentComponent,new Point(x,y)))) {
    final Dimension preferredSize=myComponent.getPreferredSize();
    final Point layeredPanePoint=SwingUtilities.convertPoint(parentComponent,x,y,layeredPane);
    myComponent.setBounds(layeredPanePoint.x,layeredPanePoint.y,preferredSize.width,preferredSize.height);
    layeredPane.add(myComponent,new Integer(250 + layeredPane.getComponentCount()));
    myComponent.validate();
    myComponent.repaint();
  }
 else {
    myIsRealPopup=true;
    myPopup=JBPopupFactory.getInstance().createComponentPopup(myComponent,focusBackComponent,false);
    myPopup.show(new RelativePoint(myParentComponent,new Point(x,y)));
  }
}
