{
  ProgressIndicator indicator=ProgressManager.getInstance().getProgressIndicator();
  if (indicator != null) {
    indicator.pushState();
    indicator.setText(IdeBundle.message("progress.scanning.files"));
    if (!myIsCancelable) {
      indicator.startNonCancelableSection();
    }
  }
  try {
    final SyncSession syncSession=new SyncSession(myUpdaters);
    myUpdaters=null;
    if (indicator != null) {
      indicator.popState();
    }
    if (syncSession.getFilesToUpdate().size() == 0) {
      syncSession.updatingDone();
    }
    return syncSession;
  }
  finally {
    if (indicator != null && !myIsCancelable) {
      indicator.finishNonCancelableSection();
    }
  }
}
