{
  final GrIfStatement ifStatement=(GrIfStatement)element.getParent();
  final PsiElement thenBranch=skipBlock(ifStatement.getThenBranch());
  final PsiElement elseBranch=skipBlock(ifStatement.getElseBranch());
  if (thenBranch instanceof GrAssignmentExpression && elseBranch instanceof GrAssignmentExpression) {
    final GrAssignmentExpression assignment=(GrAssignmentExpression)GroovyPsiElementFactory.getInstance(project).createStatementFromText("a = b ? c : d");
    assignment.getLValue().replaceWithExpression(((GrAssignmentExpression)thenBranch).getLValue(),true);
    final GrConditionalExpression conditional=(GrConditionalExpression)assignment.getRValue();
    replaceConditional(conditional,ifStatement.getCondition(),((GrAssignmentExpression)thenBranch).getRValue(),((GrAssignmentExpression)elseBranch).getRValue());
    ifStatement.replaceWithStatement(assignment);
  }
  if (thenBranch instanceof GrReturnStatement && elseBranch instanceof GrReturnStatement) {
    final GrReturnStatement returnSt=(GrReturnStatement)GroovyPsiElementFactory.getInstance(project).createStatementFromText("return a ? b : c");
    final GrConditionalExpression conditional=(GrConditionalExpression)returnSt.getReturnValue();
    replaceConditional(conditional,ifStatement.getCondition(),((GrReturnStatement)thenBranch).getReturnValue(),((GrReturnStatement)elseBranch).getReturnValue());
    ifStatement.replaceWithStatement(returnSt);
  }
}
