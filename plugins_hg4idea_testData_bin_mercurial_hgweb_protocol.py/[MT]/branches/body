def branches(repo, req):
    nodes = []
    if ('nodes' in req.form):
        nodes = map(bin, req.form['nodes'][0].split(' '))
    resp = cStringIO.StringIO()
    for b in repo.branches(nodes):
        resp.write((' '.join(map(hex, b)) + '\n'))
    resp = resp.getvalue()
    req.respond(HTTP_OK, HGTYPE, length=len(resp))
    yield resp
