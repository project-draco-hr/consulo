{
  if (myPreferredSize == null) {
    int maxLineLength=0;
    int linesCount=0;
    for (LineTokenizer lt=new LineTokenizer(myRawText); !lt.atEnd(); lt.advance()) {
      maxLineLength=Math.max(maxLineLength,lt.getLength());
      linesCount++;
    }
    FontMetrics fontMetrics=((EditorImpl)myEditor).getFontMetrics(myTextAttributes != null ? myTextAttributes.getFontType() : Font.PLAIN);
    int preferredHeight=myEditor.getLineHeight() * Math.max(1,linesCount);
    int preferredWidth=fontMetrics.charWidth('m') * maxLineLength;
    Insets insets=getInsets();
    if (insets != null) {
      preferredHeight+=insets.top + insets.bottom;
      preferredWidth+=insets.left + insets.right;
    }
    myPreferredSize=new Dimension(preferredWidth,preferredHeight);
  }
  return myPreferredSize;
}
