{
  String text=getText(table,value,row,column);
  MyPanel panel=getEditorPanel(table);
  EditorEx editor=panel.editor;
  int tableFontSize=table.getFont().getSize();
  if (editor.getColorsScheme().getEditorFontSize() != tableFontSize) {
    editor.getColorsScheme().setEditorFontSize(tableFontSize);
  }
  setText(editor,text);
  if (isSelected) {
    ((EditorImpl)editor).setPaintSelection(true);
    editor.getColorsScheme().setColor(EditorColors.SELECTION_BACKGROUND_COLOR,table.getSelectionBackground());
    editor.getColorsScheme().setColor(EditorColors.SELECTION_FOREGROUND_COLOR,table.getSelectionForeground());
    editor.getSelectionModel().setSelection(0,editor.getDocument().getTextLength());
    editor.setBackgroundColor(table.getSelectionBackground());
  }
 else {
    ((EditorImpl)editor).setPaintSelection(false);
    editor.getSelectionModel().setSelection(0,0);
    boolean selectedRow=table.getSelectedRowCount() > 0 && table.getSelectedRows()[table.getSelectedRowCount() - 1] == row;
    editor.setBackgroundColor(!selectedRow ? table.getBackground() : getColorScheme().getColor(EditorColors.CARET_ROW_COLOR));
  }
  customizeEditor(editor,value,isSelected,row,column);
  return panel;
}
