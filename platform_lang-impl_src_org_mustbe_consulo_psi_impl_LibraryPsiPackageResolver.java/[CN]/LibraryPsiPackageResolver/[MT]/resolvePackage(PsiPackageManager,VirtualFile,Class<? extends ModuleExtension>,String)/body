{
  ProjectFileIndex fileIndexFacade=ProjectFileIndex.SERVICE.getInstance(packageManager.getProject());
  PsiManager psiManager=PsiManager.getInstance(packageManager.getProject());
  if (fileIndexFacade.isInLibraryClasses(virtualFile)) {
    List<OrderEntry> orderEntriesForFile=fileIndexFacade.getOrderEntriesForFile(virtualFile);
    for (    OrderEntry orderEntry : orderEntriesForFile) {
      Module ownerModule=orderEntry.getOwnerModule();
      ModuleExtension extension=ModuleUtilCore.getExtension(ownerModule,extensionClass);
      if (extension != null) {
        for (        PsiPackageSupportProvider p : PsiPackageSupportProvider.EP_NAME.getExtensions()) {
          if (p.isSupported(extension)) {
            return p.createPackage(psiManager,packageManager,extensionClass,qualifiedName);
          }
        }
      }
    }
  }
  return null;
}
