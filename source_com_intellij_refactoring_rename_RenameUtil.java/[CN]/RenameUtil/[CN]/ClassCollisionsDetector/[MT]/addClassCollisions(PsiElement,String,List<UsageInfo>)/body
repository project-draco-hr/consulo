{
  final PsiClass renamedClass=myRenamedClass;
  final PsiResolveHelper resolveHelper=referenceElement.getManager().getResolveHelper();
  final PsiSearchHelper searchHelper=referenceElement.getManager().getSearchHelper();
  final PsiClass aClass=resolveHelper.resolveReferencedClass(newName,referenceElement);
  if (aClass == null)   return;
  final PsiFile containingFile=referenceElement.getContainingFile();
  final String text=referenceElement.getText();
  if (Comparing.equal(myRenamedClassQualifiedName,removeSpaces(text)))   return;
  if (myProcessedFiles.contains(containingFile))   return;
  final PsiReference[] references=searchHelper.findReferences(aClass,new LocalSearchScope(containingFile),false);
  for (int i=0; i < references.length; i++) {
    PsiReference reference=references[i];
    final PsiElement collisionReferenceElement=reference.getElement();
    if (collisionReferenceElement instanceof PsiJavaCodeReferenceElement) {
      final PsiElement parent=collisionReferenceElement.getParent();
      if (!(parent instanceof PsiImportStatement)) {
        if (aClass.getQualifiedName() != null) {
          results.add(new ClassHidesImportedClassUsageInfo((PsiJavaCodeReferenceElement)collisionReferenceElement,renamedClass,aClass));
        }
 else {
          results.add(new ClassHidesUnqualifiableClassUsageInfo((PsiJavaCodeReferenceElement)collisionReferenceElement,renamedClass,aClass));
        }
      }
 else {
        results.add(new CollidingClassImportUsageInfo((PsiImportStatement)parent,renamedClass));
      }
    }
  }
  myProcessedFiles.add(containingFile);
}
