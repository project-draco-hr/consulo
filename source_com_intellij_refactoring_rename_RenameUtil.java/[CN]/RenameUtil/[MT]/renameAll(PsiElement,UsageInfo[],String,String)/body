{
  if (newName.equals(originalName))   return;
  final PsiSearchHelper searchHelper=originalElement.getManager().getSearchHelper();
  Queue<PsiReference> queue=new Queue<PsiReference>(infos.length);
  if (ourRenameXmlAttributeValuesInReverseOrder) {
    LOG.assertTrue(ApplicationManager.getApplication().isUnitTestMode());
    ArrayList<UsageInfo> tmp=new ArrayList<UsageInfo>(Arrays.asList(infos));
    Collections.reverse(tmp);
    infos=tmp.toArray(new UsageInfo[tmp.size()]);
  }
  for (  UsageInfo info : infos) {
    if (info.getElement() == null || !info.getElement().isValid())     continue;
    PsiReference ref=((MoveRenameUsageInfo)info).reference;
    if (ref == null)     continue;
    queue.addLast(ref);
  }
  while (!queue.isEmpty()) {
    final PsiReference reference=queue.pullFirst();
    final PsiElement oldElement=reference.getElement();
    if (!oldElement.isValid())     continue;
    final PsiElement newElement=reference.handleElementRename(newName);
    if (!oldElement.isValid()) {
      final PsiReference[] references=searchHelper.findReferences(originalElement,new LocalSearchScope(newElement),false);
      for (      PsiReference psiReference : references) {
        queue.addLast(psiReference);
      }
    }
  }
}
