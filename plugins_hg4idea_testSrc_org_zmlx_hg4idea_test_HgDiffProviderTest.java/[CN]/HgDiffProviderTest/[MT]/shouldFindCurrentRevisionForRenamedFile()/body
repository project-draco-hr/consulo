{
  fillFile(myProjectDir,new String[]{AFILE},INITIAL_FILE_CONTENT);
  addAll();
  commitAll("initial content");
  fillFile(myProjectDir,new String[]{AFILE},UPDATED_FILE_CONTENT);
  commitAll("updated content");
  runHgOnProjectRepo("rename",AFILE,BFILE);
  LocalFileSystem.getInstance().refresh(false);
  ChangeListManager.getInstance(myProject).ensureUpToDate(false);
  HgDiffProvider diffProvider=new HgDiffProvider(myProject);
  VirtualFile child=myWorkingCopyDir.findChild(BFILE);
  ContentRevision fileContent=diffProvider.createFileContent(diffProvider.getCurrentRevision(child),child);
  assertNotNull(fileContent);
  assertEquals(fileContent.getContent(),UPDATED_FILE_CONTENT);
}
