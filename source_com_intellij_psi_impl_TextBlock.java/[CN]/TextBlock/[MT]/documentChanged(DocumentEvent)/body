{
  final int offset=e.getOffset();
  if (isEmpty()) {
    myStartOffset=offset;
    myTextEndOffset=offset + e.getNewLength();
    myPsiEndOffset=offset + e.getOldLength();
  }
 else {
    int shift=offset + e.getOldLength() - myTextEndOffset;
    if (shift > 0) {
      myPsiEndOffset+=shift;
      myTextEndOffset=offset + e.getNewLength();
    }
 else {
      int sizeDelta=e.getNewLength() - e.getOldLength();
      myTextEndOffset+=sizeDelta;
    }
    myStartOffset=Math.min(myStartOffset,offset);
  }
}
