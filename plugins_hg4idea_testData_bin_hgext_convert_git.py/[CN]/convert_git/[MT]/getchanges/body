def getchanges(self, version):
    self.modecache = {}
    fh = self.gitopen(('git diff-tree -z --root -m -r %s' % version))
    changes = []
    seen = set()
    entry = None
    for l in fh.read().split('\x00'):
        if (not entry):
            if (not l.startswith(':')):
                continue
            entry = l
            continue
        f = l
        if (f not in seen):
            seen.add(f)
            entry = entry.split()
            h = entry[3]
            p = (entry[1] == '100755')
            s = (entry[1] == '120000')
            self.modecache[(f, h)] = ((p and 'x') or (s and 'l') or '')
            changes.append((f, h))
        entry = None
    if fh.close():
        raise util.Abort((_('cannot read changes in %s') % version))
    return (changes, {})
