{
  DataContext dataContext=e.getDataContext();
  Project project=(Project)dataContext.getData(DataConstants.PROJECT);
  final Editor editor=(Editor)dataContext.getData(DataConstants.EDITOR);
  final FileEditor fileEditor=(FileEditor)dataContext.getData(DataConstants.FILE_EDITOR);
  if (editor == null)   return;
  if (fileEditor == null)   return;
  PsiFile psiFile=PsiDocumentManager.getInstance(project).getPsiFile(editor.getDocument());
  if (psiFile == null)   return;
  PsiDocumentManager.getInstance(project).commitDocument(editor.getDocument());
  FeatureUsageTracker.getInstance().triggerFeatureUsed("navigation.popup.file.structure");
  final StructureViewBuilder structureViewBuilder=AntFileStructureList.canShowFor(psiFile) ? null : fileEditor.getStructureViewBuilder();
  Navigatable navigatable=(Navigatable)dataContext.getData(DataConstants.NAVIGATABLE);
  DialogWrapper dialog=createDialog(psiFile,structureViewBuilder,editor,project,navigatable,fileEditor);
  if (dialog != null) {
    final VirtualFile virtualFile=psiFile.getVirtualFile();
    if (virtualFile != null) {
      dialog.setTitle(virtualFile.getPresentableUrl());
    }
    dialog.show();
  }
}
