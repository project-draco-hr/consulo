{
  try {
    myControlFlow=ControlFlowFactory.getInstance(project).getControlFlow(codeFragment,new LocalsControlFlowPolicy(codeFragment),false,false);
  }
 catch (  AnalysisCanceledException e) {
    throw new PrepareFailedException(RefactoringBundle.message("extract.method.control.flow.analysis.failed"),e.getErrorElement());
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug(myControlFlow.toString());
  }
  myFlowStart=-1;
  int index=0;
  while (index < elements.length) {
    myFlowStart=myControlFlow.getStartOffset(elements[index]);
    if (myFlowStart >= 0)     break;
    index++;
  }
  if (myFlowStart < 0) {
    myFlowStart=0;
    myFlowEnd=0;
  }
 else {
    index=elements.length - 1;
    while (true) {
      myFlowEnd=myControlFlow.getEndOffset(elements[index]);
      if (myFlowEnd >= 0)       break;
      index--;
    }
  }
  if (LOG.isDebugEnabled()) {
    LOG.debug("start offset:" + myFlowStart);
    LOG.debug("end offset:" + myFlowEnd);
  }
}
