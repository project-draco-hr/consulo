{
  LOG.assertTrue(anchor.isPhysical());
  myFile=anchor.getContainingFile();
  TextRange range=anchor.getTextRange();
  final PsiDocumentManager documentManager=PsiDocumentManager.getInstance(myFile.getProject());
  Document document=documentManager.getDocument(myFile);
  if (documentManager.isUncommited(document)) {
    mySyncMarkerIsValid=false;
    myMarker=document.createRangeMarker(0,0,false);
  }
 else {
    myMarker=document.createRangeMarker(range.getStartOffset(),range.getEndOffset(),true);
    range=getPersistentAnchorRange(anchor,document);
    mySyncStartOffset=range.getStartOffset();
    mySyncEndOffset=range.getEndOffset();
    mySyncMarkerIsValid=true;
    myType=anchor.getClass();
  }
}
