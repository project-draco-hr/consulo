{
  if (myElement != null && !myElement.isValid()) {
    if (myElementInfo == null) {
      myElement=null;
    }
 else {
      PsiElement restored=myElementInfo.restoreElement();
      if (restored != null && (!areElementKindEqual(restored,myElement) || !restored.isValid())) {
        restored=null;
      }
      myElement=(E)restored;
    }
  }
  if (myElementInfo != null && myElement != null) {
    Document document=myElementInfo.getDocumentToSynchronize();
    if (document != null && PsiDocumentManager.getInstance(myProject).isUncommited(document))     return myElement;
  }
  return myElement;
}
