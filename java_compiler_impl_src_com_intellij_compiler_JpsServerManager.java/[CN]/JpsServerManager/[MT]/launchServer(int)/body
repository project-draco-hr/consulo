{
  final Sdk projectJdk=JavaAwareProjectJdkTableImpl.getInstanceEx().getInternalJdk();
  final GeneralCommandLine cmdLine=new GeneralCommandLine();
  cmdLine.setExePath(((JavaSdkType)projectJdk.getSdkType()).getVMExecutablePath(projectJdk));
  cmdLine.addParameter("-ea");
  cmdLine.addParameter("-XX:+HeapDumpOnOutOfMemoryError");
  cmdLine.addParameter("-Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=5008");
  cmdLine.addParameter("-Xmx1024m");
  cmdLine.addParameter("-classpath");
  final List<File> cp=ClasspathBootstrap.getApplicationClasspath();
  final JavaCompiler systemCompiler=ToolProvider.getSystemJavaCompiler();
  if (systemCompiler == null) {
    throw new ExecutionException("No system java compiler is provided by the JRE. Make sure tools.jar is present in IntelliJ IDEA classpath.");
  }
  try {
    cp.add(ClasspathBootstrap.getResourcePath(systemCompiler.getClass()));
  }
 catch (  Throwable ignored) {
  }
  cmdLine.addParameter(classpathToString(cp));
  cmdLine.addParameter(org.jetbrains.jps.server.Server.class.getName());
  cmdLine.addParameter(Integer.toString(port));
  final File workDirectory=new File(mySystemDirectory,COMPILE_SERVER_SYSTEM_ROOT);
  workDirectory.mkdirs();
  cmdLine.addParameter(FileUtil.toSystemIndependentName(workDirectory.getPath()));
  cmdLine.setWorkDirectory(workDirectory);
  return cmdLine.createProcess();
}
