{
  final Ref<RequestFuture> futureRef=new Ref<RequestFuture>(null);
  final RunnableFuture future=myTaskExecutor.submit(new Runnable(){
    public void run(){
      try {
        ensureServerRunningAndClientConnected();
        final RequestFuture requestFuture=myClient.sendCompileRequest(projectId,modules,rebuild,handler);
        futureRef.set(requestFuture);
      }
 catch (      Throwable e) {
        try {
          handler.handleFailure(ProtoUtil.createFailure(e.getMessage(),e));
        }
  finally {
          handler.sessionTerminated();
        }
      }
    }
  }
);
  try {
    future.get();
  }
 catch (  Throwable e) {
    LOG.info(e);
  }
  return futureRef.get();
}
