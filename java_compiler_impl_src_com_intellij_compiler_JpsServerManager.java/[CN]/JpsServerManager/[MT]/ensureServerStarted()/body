{
  if (myProcessHandler != null) {
    return true;
  }
  if (!myStartupFailed) {
    try {
      final int port=NetUtils.findAvailableSocketPort();
      final Process process=launchServer(port);
      final OSProcessHandler processHandler=new OSProcessHandler(process,null);
      processHandler.startNotify();
      myServerClient=new Client();
      if (myServerClient.connect(NetUtils.getLocalHostString(),port)) {
        final PathMacros pathVars=PathMacros.getInstance();
        final Map<String,String> data=new HashMap<String,String>();
        for (        String name : pathVars.getAllMacroNames()) {
          final String path=pathVars.getValue(name);
          if (path != null) {
            data.put(name,FileUtil.toSystemIndependentName(path));
          }
        }
        final List<GlobalLibrary> globals=new ArrayList<GlobalLibrary>();
        fillSdks(globals);
        fillGlobalLibraries(globals);
        myServerClient.sendSetupRequest(data,globals);
      }
      myProcessHandler=processHandler;
      return true;
    }
 catch (    Throwable e) {
      myStartupFailed=true;
      LOG.error(e);
    }
  }
  return false;
}
