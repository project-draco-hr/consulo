{
  MyRangeMarker marker=mySelectionMarker.get();
  VisualPosition caretPosition=myEditor.getCaretModel().getVisualPosition();
  if (marker == null) {
    return caretPosition;
  }
  VisualPosition startPosition=marker.getStartPosition();
  VisualPosition endPosition=marker.getEndPosition();
  if (startPosition == null || endPosition == null) {
    return caretPosition;
  }
  return marker.isEndPositionIsLead() ? endPosition : startPosition;
}
