{
  validateContext(false);
  if (hasSelection()) {
    MyRangeMarker marker=mySelectionMarker.get();
    if (marker != null) {
      return marker.getEndOffset();
    }
  }
  return myEditor.getCaretModel().getOffset();
}
