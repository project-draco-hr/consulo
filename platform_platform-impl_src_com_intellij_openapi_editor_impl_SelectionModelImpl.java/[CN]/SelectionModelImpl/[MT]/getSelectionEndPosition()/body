{
  VisualPosition defaultPosition=myEditor.offsetToVisualPosition(getSelectionEnd());
  if (!hasSelection()) {
    return defaultPosition;
  }
  MyRangeMarker marker=mySelectionMarker.get();
  if (marker == null) {
    return defaultPosition;
  }
  VisualPosition result=marker.getEndPosition();
  return result == null ? defaultPosition : result;
}
