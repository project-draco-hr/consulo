{
  if (myIsInUpdate == event) {
    myIsInUpdate=null;
    MyRangeMarker marker=mySelectionMarker;
    if (marker != null) {
      int endAfter;
      int startAfter;
      if (marker.isValid()) {
        startAfter=marker.getStartOffset();
        endAfter=marker.getEndOffset();
      }
 else {
        myLastSelectionStart=myEditor.getCaretModel().getOffset();
        marker.release();
        mySelectionMarker=null;
        startAfter=endAfter=myLastSelectionStart;
      }
      if (startBefore != startAfter || endBefore != endAfter) {
        fireSelectionChanged(startBefore,endBefore,startAfter,endAfter);
      }
    }
  }
}
