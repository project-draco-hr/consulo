{
  removeSelection();
  int oldStartLine=0;
  int oldEndLine=0;
  if (hasBlockSelection()) {
    oldStartLine=myBlockStart.line;
    oldEndLine=myBlockEnd.line;
    if (oldStartLine > oldEndLine) {
      int t=oldStartLine;
      oldStartLine=oldEndLine;
      oldEndLine=t;
    }
  }
  int newStartLine=blockStart.line;
  int newEndLine=blockEnd.line;
  if (newStartLine > newEndLine) {
    int t=newStartLine;
    newStartLine=newEndLine;
    newEndLine=t;
  }
  myEditor.repaintLines(Math.min(oldStartLine,newStartLine),Math.max(newEndLine,oldEndLine));
  final int[] oldStarts=getBlockSelectionStarts();
  final int[] oldEnds=getBlockSelectionEnds();
  myBlockStart=blockStart;
  myBlockEnd=blockEnd;
  recalculateBlockOffsets();
  final int[] newStarts=getBlockSelectionStarts();
  final int[] newEnds=getBlockSelectionEnds();
  broadcastSelectionEvent(new SelectionEvent(myEditor,oldStarts,oldEnds,newStarts,newEnds));
}
