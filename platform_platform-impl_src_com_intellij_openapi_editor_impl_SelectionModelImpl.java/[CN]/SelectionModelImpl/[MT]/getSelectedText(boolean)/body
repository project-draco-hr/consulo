{
  validateContext(false);
  if (myEditor.getCaretModel().supportsMultipleCarets() && allCarets) {
    final StringBuilder buf=new StringBuilder();
    String separator="";
    for (    Caret caret : myEditor.getCaretModel().getAllCarets()) {
      buf.append(separator);
      String caretSelectedText=caret.getSelectedText();
      if (caretSelectedText != null) {
        buf.append(caretSelectedText);
      }
      separator="\n";
    }
    return buf.toString();
  }
 else {
    return myEditor.getCaretModel().getCurrentCaret().getSelectedText();
  }
}
