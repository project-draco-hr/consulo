{
  Editor editorTab=myOpenedFiles.get(virtualFile.getUrl());
  if (editorTab != null) {
    final int index=getWidgetIndex(editorTab);
    selectTab(index);
    if (offset != -1) {
      editorTab.setCaretOffset(offset);
    }
    return;
  }
  GwtUtil.rpc().getContent(virtualFile.getUrl(),new ReportableCallable<String>(){
    @Override public void onSuccess(    String result){
      if (result == null) {
        return;
      }
      final Editor editor=new Editor(EditorTabPanel.this,virtualFile.getUrl(),result);
      final HorizontalPanel tabHeader=new HorizontalPanel();
      tabHeader.add(GwtUIUtil.icon(virtualFile.getIconLayers()));
      InlineHTML span=new InlineHTML(virtualFile.getName());
      span.setStyleName("textAfterIcon18");
      tabHeader.add(span);
      Image closeImage=new Image("/icons/actions/closeNew.png");
      tabHeader.add(closeImage);
      add(editor,tabHeader);
      int index=myOpenedFiles.size();
      selectTab(index);
      if (offset != -1) {
        editor.focusOffset(offset);
      }
      myOpenedFiles.put(virtualFile.getUrl(),editor);
      closeImage.addClickHandler(new ClickHandler(){
        @Override public void onClick(        ClickEvent event){
          Editor tabInfo=myOpenedFiles.remove(virtualFile.getUrl());
          if (tabInfo != null) {
            tabInfo.dispose();
          }
          remove(editor);
          int size=myOpenedFiles.size();
          if (size > 0) {
            selectTab(size - 1);
          }
        }
      }
);
    }
  }
);
}
