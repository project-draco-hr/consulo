{
  Map<String,String> result=myCachedExternalProperties;
  if (result == null) {
synchronized (myOptionsLock) {
      result=myCachedExternalProperties;
      if (result == null) {
        result=new HashMap<String,String>();
        final DataContext context=SimpleDataContext.getProjectContext(myProject);
        final MacroManager macroManager=MacroManager.getInstance();
        Iterator<BuildFileProperty> properties=ANT_PROPERTIES.getIterator(myAllOptions);
        while (properties.hasNext()) {
          BuildFileProperty property=properties.next();
          try {
            String value=property.getPropertyValue();
            value=macroManager.expandSilentMarcos(value,true,context);
            value=macroManager.expandSilentMarcos(value,false,context);
            result.put(property.getPropertyName(),value);
          }
 catch (          Macro.ExecutionCancelledException e) {
            LOG.debug(e);
          }
        }
        myCachedExternalProperties=result;
      }
    }
  }
  return result;
}
