{
  myLayeredPane=new MyLayeredPane();
  mySurfaceArea=new ComponentEditableArea(myLayeredPane){
    @Override protected void fireSelectionChanged(){
      super.fireSelectionChanged();
      myLayeredPane.revalidate();
      myLayeredPane.repaint();
    }
    @Override public void scrollToSelection(){
      List<RadComponent> selection=getSelection();
      if (selection.size() == 1) {
        Rectangle bounds=selection.get(0).getBounds(myLayeredPane);
        if (bounds != null) {
          myLayeredPane.scrollRectToVisible(bounds);
        }
      }
    }
    @Override public RadComponent findTarget(    int x,    int y,    @Nullable ComponentTargetFilter filter){
      return DesignerEditorPanel.this.findTarget(x,y,filter);
    }
    @Override public InputTool findTargetTool(    int x,    int y){
      return myDecorationLayer.findTargetTool(x,y);
    }
    @Override public void showSelection(    boolean value){
      myDecorationLayer.showSelection(value);
    }
    @Override public ComponentDecorator getRootSelectionDecorator(){
      return DesignerEditorPanel.this.getRootSelectionDecorator();
    }
    @Nullable public EditOperation processRootOperation(    OperationContext context){
      return DesignerEditorPanel.this.processRootOperation(context);
    }
    @Override public FeedbackLayer getFeedbackLayer(){
      return myFeedbackLayer;
    }
    @Override public RadComponent getRootComponent(){
      return myRootComponent;
    }
    @Override public ActionGroup getPopupActions(){
      return myActionPanel.getPopupActions(this);
    }
    @Override public String getPopupPlace(){
      return ActionPlaces.GUI_DESIGNER_EDITOR_POPUP;
    }
  }
;
  myToolProvider=new ToolProvider(){
    @Override public void loadDefaultTool(){
      setActiveTool(createDefaultTool());
    }
    @Override public void setActiveTool(    InputTool tool){
      if (getActiveTool() instanceof CreationTool && !(tool instanceof CreationTool)) {
        PaletteToolWindowManager.getInstance(getProject()).clearActiveItem();
      }
      if (!(tool instanceof SelectionTool)) {
        hideInspections();
      }
      super.setActiveTool(tool);
    }
    @Override public boolean execute(    final ThrowableRunnable<Exception> operation,    String command,    final boolean updateProperties){
      final boolean[] is={true};
      CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
        public void run(){
          is[0]=DesignerEditorPanel.this.execute(operation,updateProperties);
        }
      }
,command,null);
      return is[0];
    }
    @Override public void executeWithReparse(    final ThrowableRunnable<Exception> operation,    String command){
      CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
        public void run(){
          DesignerEditorPanel.this.executeWithReparse(operation);
        }
      }
,command,null);
    }
    @Override public void execute(    final List<EditOperation> operations,    String command){
      CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
        public void run(){
          DesignerEditorPanel.this.execute(operations);
        }
      }
,command,null);
    }
    @Override public void startInplaceEditing(    @Nullable InplaceContext inplaceContext){
      myInplaceEditingLayer.startEditing(inplaceContext);
    }
    @Override public void hideInspections(){
      myQuickFixManager.hideHint();
    }
    @Override public void showError(    @NonNls String message,    Throwable e){
      DesignerEditorPanel.this.showError(message,e);
    }
  }
;
  myGlassLayer=new GlassLayer(myToolProvider,mySurfaceArea);
  myLayeredPane.add(myGlassLayer,LAYER_GLASS);
  myDecorationLayer=new DecorationLayer(this,mySurfaceArea);
  myLayeredPane.add(myDecorationLayer,LAYER_DECORATION);
  myFeedbackLayer=new FeedbackLayer();
  myLayeredPane.add(myFeedbackLayer,LAYER_FEEDBACK);
  myInplaceEditingLayer=new InplaceEditingLayer(this);
  myLayeredPane.add(myInplaceEditingLayer,LAYER_INPLACE_EDITING);
  JPanel content=new JPanel(new GridBagLayout());
  GridBagConstraints gbc=new GridBagConstraints();
  gbc.gridx=0;
  gbc.gridy=1;
  gbc.fill=GridBagConstraints.VERTICAL;
  myVerticalCaption=new CaptionPanel(this,false);
  content.add(myVerticalCaption,gbc);
  gbc.gridx=1;
  gbc.gridy=0;
  gbc.fill=GridBagConstraints.HORIZONTAL;
  myHorizontalCaption=new CaptionPanel(this,true);
  content.add(myHorizontalCaption,gbc);
  gbc.gridx=1;
  gbc.gridy=1;
  gbc.weightx=1;
  gbc.weighty=1;
  gbc.fill=GridBagConstraints.BOTH;
  myScrollPane=ScrollPaneFactory.createScrollPane(myLayeredPane);
  myScrollPane.setBackground(new JBColor(Color.WHITE,UIUtil.getListBackground()));
  content.add(myScrollPane,gbc);
  myHorizontalCaption.attachToScrollPane(myScrollPane);
  myVerticalCaption.attachToScrollPane(myScrollPane);
  myQuickFixManager=new QuickFixManager(this,myGlassLayer,myScrollPane.getViewport());
  myActionPanel=createActionPanel();
  myWarnAction=new FixableMessageAction();
  add(myActionPanel.getToolbarComponent());
  add(myPanel);
  myDesignerCard=content;
  myPanel.add(myDesignerCard,DESIGNER_CARD);
  mySurfaceArea.addSelectionListener(new ComponentSelectionListener(){
    @Override public void selectionChanged(    EditableArea area){
      storeSourceSelectionState();
    }
  }
);
}
