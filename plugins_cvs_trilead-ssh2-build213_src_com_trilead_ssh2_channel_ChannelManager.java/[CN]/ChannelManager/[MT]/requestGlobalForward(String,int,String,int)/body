{
  RemoteForwardingData rfd=new RemoteForwardingData();
  rfd.bindAddress=bindAddress;
  rfd.bindPort=bindPort;
  rfd.targetAddress=targetAddress;
  rfd.targetPort=targetPort;
synchronized (remoteForwardings) {
    Integer key=new Integer(bindPort);
    if (remoteForwardings.get(key) != null) {
      throw new IOException("There is already a forwarding for remote port " + bindPort);
    }
    remoteForwardings.put(key,rfd);
  }
synchronized (channels) {
    globalSuccessCounter=globalFailedCounter=0;
  }
  PacketGlobalForwardRequest pgf=new PacketGlobalForwardRequest(true,bindAddress,bindPort);
  tm.sendMessage(pgf.getPayload());
  if (log.isEnabled())   log.log(50,"Requesting a remote forwarding ('" + bindAddress + "', "+ bindPort+ ")");
  try {
    if (waitForGlobalRequestResult() == false)     throw new IOException("The server denied the request (did you enable port forwarding?)");
  }
 catch (  IOException e) {
synchronized (remoteForwardings) {
      remoteForwardings.remove(rfd);
    }
    throw e;
  }
  return bindPort;
}
