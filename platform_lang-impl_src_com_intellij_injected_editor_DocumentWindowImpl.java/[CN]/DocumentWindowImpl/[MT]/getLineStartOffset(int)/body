{
  LOG.assertTrue(line >= 0,line);
  if (line == 0)   return 0;
  String hostText=myDelegate.getText();
  int[] pos=new int[2];
synchronized (myLock) {
    for (    PsiLanguageInjectionHost.Shred shred : myShreds) {
      Segment hostRange=shred.getHostRangeMarker();
      if (hostRange == null)       continue;
      int found=countNewLinesIn(shred.getPrefix(),pos,line);
      if (found != -1)       return found;
      CharSequence text=hostText.subSequence(hostRange.getStartOffset(),hostRange.getEndOffset());
      found=countNewLinesIn(text,pos,line);
      if (found != -1)       return found;
      found=countNewLinesIn(shred.getSuffix(),pos,line);
      if (found != -1)       return found;
    }
  }
  return pos[1];
}
