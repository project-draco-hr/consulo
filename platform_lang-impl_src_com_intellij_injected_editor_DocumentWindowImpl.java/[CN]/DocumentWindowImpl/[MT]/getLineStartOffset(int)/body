{
  LOG.assertTrue(line >= 0,line);
  if (line == 0)   return 0;
  String hostText=myDelegate.getText();
  int[] pos=new int[2];
synchronized (myLock) {
    for (    PsiLanguageInjectionHost.Shred shred : myShreds) {
      RangeMarker hostRange=shred.getHostRangeMarker();
      if (!hostRange.isValid())       continue;
      int found=countNewLinesIn(shred.prefix,pos,line);
      if (found != -1)       return found;
      String text=hostText.substring(hostRange.getStartOffset(),hostRange.getEndOffset());
      found=countNewLinesIn(text,pos,line);
      if (found != -1)       return found;
      found=countNewLinesIn(shred.suffix,pos,line);
      if (found != -1)       return found;
    }
  }
  return pos[1];
}
