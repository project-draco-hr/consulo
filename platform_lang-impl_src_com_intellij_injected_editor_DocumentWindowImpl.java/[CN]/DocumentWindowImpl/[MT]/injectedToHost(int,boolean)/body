{
synchronized (myLock) {
    if (offset < myShreds.get(0).prefix.length())     return myShreds.get(0).getHostRangeMarker().getStartOffset();
    int prevEnd=0;
    for (int i=0; i < myShreds.size(); i++) {
      RangeMarker currentRange=myShreds.get(i).getHostRangeMarker();
      offset-=myShreds.get(i).prefix.length();
      int length=currentRange.getEndOffset() - currentRange.getStartOffset();
      if (offset < 0) {
        return preferLeftFragment ? prevEnd : currentRange.getStartOffset() - 1;
      }
      if (offset == 0) {
        return preferLeftFragment && i != 0 ? prevEnd : currentRange.getStartOffset();
      }
      if (offset < length || offset == length && preferLeftFragment) {
        return currentRange.getStartOffset() + offset;
      }
      offset-=length;
      offset-=myShreds.get(i).suffix.length();
      prevEnd=currentRange.getEndOffset();
    }
    return myShreds.get(myShreds.size() - 1).getHostRangeMarker().getEndOffset();
  }
}
