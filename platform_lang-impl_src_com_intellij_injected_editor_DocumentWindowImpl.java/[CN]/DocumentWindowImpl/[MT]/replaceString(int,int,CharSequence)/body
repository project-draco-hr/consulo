{
  if (isOneLine()) {
    s=StringUtil.replace(s.toString(),"\n","");
  }
  final CharSequence chars=getCharsSequence();
  CharSequence toDelete=chars.subSequence(startOffset,endOffset);
  int perfixLength=StringUtil.commonPrefixLength(s,toDelete);
  int suffixLength=StringUtil.commonSuffixLength(toDelete.subSequence(perfixLength,toDelete.length()),s.subSequence(perfixLength,s.length()));
  startOffset+=perfixLength;
  endOffset-=suffixLength;
  s=s.subSequence(perfixLength,s.length() - suffixLength);
  doReplaceString(startOffset,endOffset,s);
}
