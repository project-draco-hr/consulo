{
  final CompilerManager manager=CompilerManager.getInstance(project);
  final CompileScope compileScope=manager.createProjectCompileScope(project);
  if (!manager.isUpToDate(compileScope)) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        final int result=Messages.showYesNoDialog(project,AndroidBundle.message("android.export.signed.package.make.question"),AndroidBundle.message("android.export.signed.package.action.text"),Messages.getQuestionIcon());
        if (result == 0) {
          manager.make(compileScope,new CompileStatusNotification(){
            public void finished(            boolean aborted,            int errors,            int warnings,            CompileContext compileContext){
              if (!aborted && errors == 0) {
                afterAction.run();
              }
            }
          }
);
        }
 else {
          afterAction.run();
        }
      }
    }
);
  }
 else {
    ApplicationManager.getApplication().invokeLater(afterAction);
  }
}
