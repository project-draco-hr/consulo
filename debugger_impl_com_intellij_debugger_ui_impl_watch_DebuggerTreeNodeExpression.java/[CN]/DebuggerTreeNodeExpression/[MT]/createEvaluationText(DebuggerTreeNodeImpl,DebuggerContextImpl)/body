{
  final EvaluateException[] ex=new EvaluateException[]{null};
  final TextWithImports textWithImports=PsiDocumentManager.getInstance(context.getProject()).commitAndRunReadAction(new Computable<TextWithImports>(){
    public TextWithImports compute(){
      try {
        final PsiExpression expressionText=getEvaluationExpression(node,context);
        if (expressionText != null) {
          return new TextWithImportsImpl(expressionText);
        }
      }
 catch (      EvaluateException e) {
        ex[0]=e;
      }
      return null;
    }
  }
);
  if (ex[0] != null) {
    throw ex[0];
  }
  return textWithImports;
}
