{
  myContext=context;
  mySet.addAll(restrictedNames);
  PropertyResolverProcessor processor=new PropertyResolverProcessor(null,myContext);
  ResolveUtil.treeWalkUp(myContext,processor,true);
  final GroovyResolveResult[] results=processor.getCandidates();
  for (  GroovyResolveResult result : results) {
    final PsiElement element=result.getElement();
    if (element instanceof PsiNamedElement && (includeFields || !(element instanceof PsiField))) {
      mySet.add(((PsiNamedElement)element).getName());
    }
  }
  GroovyPsiElement scope=PsiTreeUtil.getParentOfType(context,GrControlFlowOwner.class,GrMember.class);
  if (scope == null)   scope=context;
  scope.accept(new GroovyRecursiveElementVisitor(){
    @Override public void visitVariable(    GrVariable variable){
      if (includeFields || !(variable instanceof PsiField)) {
        mySet.add(variable.getName());
      }
      super.visitVariable(variable);
    }
    @Override public void visitClosure(    GrClosableBlock closure){
      if (checkIntoInner) {
        super.visitClosure(closure);
      }
    }
    @Override public void visitTypeDefinition(    GrTypeDefinition typeDefinition){
      if (checkIntoInner && !typeDefinition.hasModifierProperty(PsiModifier.STATIC)) {
        super.visitTypeDefinition(typeDefinition);
      }
    }
  }
);
}
