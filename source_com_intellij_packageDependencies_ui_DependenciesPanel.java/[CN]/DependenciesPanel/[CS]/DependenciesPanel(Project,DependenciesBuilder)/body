{
  super(new BorderLayout());
  myDependencies=builder.getDependencies();
  myBuilder=builder;
  myIllegalDependencies=myBuilder.getIllegalDependencies();
  myProject=project;
  myUsagesPanel=new UsagesPanel(myProject,myBuilder);
  Splitter treeSplitter=new Splitter();
  treeSplitter.setFirstComponent(ScrollPaneFactory.createScrollPane(myLeftTree));
  treeSplitter.setSecondComponent(ScrollPaneFactory.createScrollPane(myRightTree));
  Splitter splitter=new Splitter(true);
  splitter.setFirstComponent(treeSplitter);
  splitter.setSecondComponent(myUsagesPanel);
  add(splitter,BorderLayout.CENTER);
  add(createToolbar(),BorderLayout.NORTH);
  myRightTreeExpantionMonitor=TreeExpantionMonitor.install(myRightTree,myProject);
  myLeftTreeExpantionMonitor=TreeExpantionMonitor.install(myLeftTree,myProject);
  myRightTreeMarker=new TreeModelBuilder.Marker(){
    public boolean isMarked(    PsiFile file){
      return myIllegalsInRightTree.contains(file);
    }
  }
;
  myLeftTreeMarker=new TreeModelBuilder.Marker(){
    public boolean isMarked(    PsiFile file){
      return myIllegalDependencies.containsKey(file);
    }
  }
;
  updateLeftTreeModel();
  updateRightTreeModel();
  myLeftTree.getSelectionModel().addTreeSelectionListener(new TreeSelectionListener(){
    public void valueChanged(    TreeSelectionEvent e){
      updateRightTreeModel();
      final StringBuffer denyRules=new StringBuffer();
      final StringBuffer allowRules=new StringBuffer();
      final TreePath selectionPath=myLeftTree.getSelectionPath();
      if (selectionPath == null) {
        return;
      }
      PackageDependenciesNode selectedNode=(PackageDependenciesNode)selectionPath.getLastPathComponent();
      traverseToLeaves(selectedNode,denyRules,allowRules);
      final StatusBar statusBar=WindowManager.getInstance().getStatusBar(myProject);
      if (denyRules.length() + allowRules.length() > 0) {
        statusBar.setInfo("The following rule" + ((denyRules.length() == 0 || allowRules.length() == 0) ? " is " : "s are ") + "violated: "+ (denyRules.length() > 0 ? denyRules.toString() + (allowRules.length() > 0 ? "; " : "") : " ")+ (allowRules.length() > 0 ? allowRules.toString() : " "));
      }
 else {
        statusBar.setInfo("No rules are violated");
      }
    }
  }
);
  myRightTree.getSelectionModel().addTreeSelectionListener(new TreeSelectionListener(){
    public void valueChanged(    TreeSelectionEvent e){
      SwingUtilities.invokeLater(new Runnable(){
        public void run(){
          Set<PsiFile> searchIn=getSelectedScope(myLeftTree);
          Set<PsiFile> searchFor=getSelectedScope(myRightTree);
          if (searchIn.isEmpty() || searchFor.isEmpty()) {
            myUsagesPanel.setToInitialPosition();
          }
 else {
            myUsagesPanel.findUsages(searchIn,searchFor);
          }
        }
      }
);
    }
  }
);
  initTree(myLeftTree,false);
  initTree(myRightTree,true);
  AnalysisScope scope=builder.getScope();
  if (scope.getScopeType() == AnalysisScope.FILE) {
    Set<PsiFile> oneFileSet=myDependencies.keySet();
    if (oneFileSet.size() == 1) {
      selectElementInLeftTree(oneFileSet.iterator().next());
    }
  }
}
