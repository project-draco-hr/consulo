{
  PsiClassType[] unhandledExceptions=null;
  if (element instanceof PsiCallExpression) {
    PsiCallExpression expression=(PsiCallExpression)element;
    unhandledExceptions=getUnhandledExceptions(expression,topElement,checkThrowsClause);
  }
 else   if (element instanceof PsiThrowStatement) {
    PsiThrowStatement statement=(PsiThrowStatement)element;
    unhandledExceptions=getUnhandledExceptions(statement,topElement,checkThrowsClause);
  }
 else   if (element instanceof PsiCodeBlock && element.getParent() instanceof PsiMethod && ((PsiMethod)element.getParent()).isConstructor()&& !firstStatementIsConstructorCall((PsiCodeBlock)element)) {
    final PsiMethod constructor=(PsiMethod)element.getParent();
    final PsiClass aClass=constructor.getContainingClass();
    final PsiClass superClass=aClass == null ? null : aClass.getSuperClass();
    final PsiMethod[] superConstructors=superClass == null ? PsiMethod.EMPTY_ARRAY : superClass.getConstructors();
    Set<PsiClassType> unhandled=new HashSet<PsiClassType>();
    for (    PsiMethod superConstructor : superConstructors) {
      if (!superConstructor.hasModifierProperty(PsiModifier.PRIVATE) && superConstructor.getParameterList().getParametersCount() == 0) {
        final PsiClassType[] exceptionTypes=superConstructor.getThrowsList().getReferencedTypes();
        for (        PsiClassType exceptionType : exceptionTypes) {
          if (!isUncheckedException(exceptionType) && !isHandled(element,exceptionType,topElement,checkThrowsClause)) {
            unhandled.add(exceptionType);
          }
        }
        break;
      }
    }
    if (aClass != null) {
      final PsiClassInitializer[] initializers=aClass.getInitializers();
      final Set<PsiClassType> thrownByInitializer=new THashSet<PsiClassType>();
      for (      PsiClassInitializer initializer : initializers) {
        if (initializer.hasModifierProperty(PsiModifier.STATIC))         continue;
        thrownByInitializer.clear();
        collectUnhandledExceptions(initializer.getBody(),initializer,thrownByInitializer,true);
        for (        PsiClassType thrown : thrownByInitializer) {
          if (!isHandled(constructor.getBody(),thrown,topElement,checkThrowsClause)) {
            unhandled.add(thrown);
          }
        }
      }
    }
    unhandledExceptions=unhandled.toArray(new PsiClassType[unhandled.size()]);
  }
  if (unhandledExceptions != null) {
    if (foundExceptions == null) {
      foundExceptions=new HashSet<PsiClassType>();
    }
    for (    PsiClassType unhandledException : unhandledExceptions) {
      foundExceptions.add(unhandledException);
    }
  }
  for (PsiElement child=element.getFirstChild(); child != null; child=child.getNextSibling()) {
    foundExceptions=collectUnhandledExceptions(child,topElement,foundExceptions,true);
  }
  return foundExceptions;
}
