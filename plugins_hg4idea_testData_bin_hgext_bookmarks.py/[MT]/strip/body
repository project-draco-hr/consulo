def strip(oldstrip, ui, repo, node, backup='all'):
    'Strip bookmarks if revisions are stripped using\n    the mercurial.strip method. This usually happens during\n    qpush and qpop'
    revisions = _revstostrip(repo.changelog, node)
    marks = repo._bookmarks
    update = []
    for (mark, n) in marks.iteritems():
        if (repo.changelog.rev(n) in revisions):
            update.append(mark)
    oldstrip(ui, repo, node, backup)
    if (len(update) > 0):
        for m in update:
            marks[m] = repo.changectx('.').node()
        write(repo)
