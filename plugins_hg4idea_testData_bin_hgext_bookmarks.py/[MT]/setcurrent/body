def setcurrent(repo, mark):
    'Set the name of the bookmark that we are currently on\n\n    Set the name of the bookmark that we are on (hg update <bookmark>).\n    The name is recorded in .hg/bookmarks.current\n    '
    current = repo._bookmarkcurrent
    if (current == mark):
        return
    refs = repo._bookmarks
    if (mark and (mark not in refs) and current and (refs[current] == repo.changectx('.').node())):
        return
    if (mark not in refs):
        mark = ''
    wlock = repo.wlock()
    try:
        file = repo.opener('bookmarks.current', 'w', atomictemp=True)
        file.write(mark)
        file.rename()
    finally:
        wlock.release()
    repo._bookmarkcurrent = mark
