{
  int endSegmentNumber=myTemplate.getEndSegmentNumber();
  int offset=myTemplateRange.getEndOffset();
  if (endSegmentNumber >= 0) {
    offset=mySegments.getSegmentStart(endSegmentNumber);
  }
  myEditor.getCaretModel().moveToOffset(offset);
  myEditor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
  myEditor.getSelectionModel().removeSelection();
  int selStart=myTemplate.getSelectionStartSegmentNumber();
  int selEnd=myTemplate.getSelectionEndSegmentNumber();
  if (selStart >= 0 && selEnd >= 0) {
    myEditor.getSelectionModel().setSelection(mySegments.getSegmentStart(selStart),mySegments.getSegmentStart(selEnd));
  }
  fireTemplateFinished();
  myListeners.clear();
  setCurrentVariableNumber(-1);
  myProject=null;
}
