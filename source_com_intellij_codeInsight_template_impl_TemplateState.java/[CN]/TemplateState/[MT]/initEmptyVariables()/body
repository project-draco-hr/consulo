{
  int endSegmentNumber=myTemplate.getEndSegmentNumber();
  int selStart=myTemplate.getSelectionStartSegmentNumber();
  int selEnd=myTemplate.getSelectionEndSegmentNumber();
  toProcessChangedUpdate=false;
  IntArrayList indices=new IntArrayList();
  for (int i=0; i < myTemplate.getSegmentsCount(); i++) {
    int length=mySegments.getSegmentEnd(i) - mySegments.getSegmentStart(i);
    if (length != 0)     continue;
    if (i == endSegmentNumber || i == selStart || i == selEnd)     continue;
    String name=myTemplate.getSegmentName(i);
    for (int j=0; j < myTemplate.getVariableCount(); j++) {
      if (myTemplate.getVariableNameAt(j).equals(name)) {
        Expression e=myTemplate.getExpressionAt(j);
        String marker="a";
        if (e instanceof MacroCallNode) {
          marker=((MacroCallNode)e).getMacro().getDefaultValue();
        }
        int start=mySegments.getSegmentStart(i);
        myDocument.insertString(start,marker);
        mySegments.replaceSegmentAt(i,start,start + marker.length());
        indices.add(i);
        break;
      }
    }
  }
  toProcessChangedUpdate=true;
  return indices;
}
