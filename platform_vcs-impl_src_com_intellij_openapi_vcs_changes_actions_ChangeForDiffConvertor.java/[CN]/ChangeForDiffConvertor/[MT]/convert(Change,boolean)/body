{
  if (ch.hasOtherLayers() && myRecursive) {
    return new MultipleDiffRequestPresentable(myProject,ch);
  }
  if (ChangesUtil.isTextConflictingChange(ch)) {
    final AbstractVcs vcs=ChangesUtil.getVcsForChange(ch,myProject);
    final MergeProvider mergeProvider=vcs.getMergeProvider();
    if (mergeProvider == null)     return null;
    final FilePath path=ChangesUtil.getFilePath(ch);
    VirtualFile vf=path.getVirtualFile();
    if (vf == null) {
      path.hardRefresh();
      vf=path.getVirtualFile();
    }
    if (vf == null)     return null;
    return new ConflictedDiffRequestPresentable(myProject,vf,ch);
  }
 else {
    final ChangeDiffRequestPresentable presentable=new ChangeDiffRequestPresentable(myProject,ch);
    if (forceText) {
      presentable.setIgnoreDirectoryFlag(true);
    }
    return presentable;
  }
}
