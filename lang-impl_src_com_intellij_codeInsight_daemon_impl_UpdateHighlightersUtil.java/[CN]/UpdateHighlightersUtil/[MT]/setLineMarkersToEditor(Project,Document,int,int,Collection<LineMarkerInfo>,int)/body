{
  ApplicationManager.getApplication().assertIsDispatchThread();
  List<LineMarkerInfo> array=new ArrayList<LineMarkerInfo>();
  List<LineMarkerInfo> oldMarkers=DaemonCodeAnalyzerImpl.getLineMarkers(document,project);
  MarkupModel markupModel=document.getMarkupModel(project);
  if (oldMarkers != null) {
    for (    LineMarkerInfo info : oldMarkers) {
      RangeHighlighter highlighter=info.highlighter;
      boolean toRemove=!highlighter.isValid() || info.updatePass == group && startOffset <= highlighter.getStartOffset() && highlighter.getEndOffset() < endOffset;
      if (toRemove) {
        markupModel.removeHighlighter(highlighter);
      }
 else {
        array.add(info);
      }
    }
  }
  final EditorColorsScheme colorsScheme=EditorColorsManager.getInstance().getGlobalScheme();
  for (  LineMarkerInfo info : markers) {
    PsiElement element=info.getElement();
    TextRange elementRange=InjectedLanguageManager.getInstance(project).injectedToHost(element,element.getTextRange());
    if (startOffset > elementRange.getEndOffset() || elementRange.getStartOffset() > endOffset)     continue;
    RangeHighlighter marker=markupModel.addRangeHighlighter(info.startOffset,info.endOffset,HighlighterLayer.ADDITIONAL_SYNTAX,info.textAttributesKey != null ? colorsScheme.getAttributes(info.textAttributesKey) : null,HighlighterTargetArea.EXACT_RANGE);
    marker.setGutterIconRenderer(info.createGutterRenderer());
    marker.setLineSeparatorColor(info.separatorColor);
    marker.setLineSeparatorPlacement(info.separatorPlacement);
    info.highlighter=marker;
    array.add(info);
  }
  DaemonCodeAnalyzerImpl.setLineMarkers(document,array,project);
}
