{
  final CodeInsightSettings settings=CodeInsightSettings.getInstance();
  boolean insertRightParenth=!settings.INSERT_SINGLE_PARENTH || (settings.INSERT_DOUBLE_PARENTH_WHEN_NO_ARGS && !hasParams) || myLookupItem.getAttribute(LookupItem.GENERATE_ANONYMOUS_BODY_ATTR) != null || (tailType != TailType.NONE && tailType != TailType.LPARENTH);
  if (needParenth) {
    if (myContext.lparenthOffset >= 0) {
      myState.tailOffset=myContext.argListEndOffset;
      if (myContext.rparenthOffset < 0 && insertRightParenth) {
        myDocument.insertString(myState.tailOffset,")");
        myState.tailOffset+=1;
        myContext.argListEndOffset=myState.tailOffset;
      }
      if (hasParams) {
        myState.caretOffset=myContext.lparenthOffset + 1;
      }
 else {
        myState.caretOffset=myContext.argListEndOffset;
      }
    }
 else {
      final CodeStyleSettings styleSettings=CodeStyleSettingsManager.getSettings(myProject);
      myState.tailOffset=myContext.selectionEndOffset;
      myState.caretOffset=myContext.selectionEndOffset;
      if (styleSettings.SPACE_BEFORE_METHOD_CALL_PARENTHESES) {
        myDocument.insertString(myState.tailOffset++," ");
        myState.caretOffset++;
      }
      if (insertRightParenth) {
        myDocument.insertString(myState.tailOffset,"()");
        myState.tailOffset+=2;
        if (hasParams) {
          myState.caretOffset++;
        }
 else {
          myState.caretOffset+=2;
        }
      }
 else {
        myDocument.insertString(myState.tailOffset++,"(");
        myState.caretOffset++;
      }
      if (hasParams && styleSettings.SPACE_WITHIN_METHOD_CALL_PARENTHESES) {
        myDocument.insertString(myState.caretOffset++," ");
        myState.tailOffset++;
      }
    }
  }
}
