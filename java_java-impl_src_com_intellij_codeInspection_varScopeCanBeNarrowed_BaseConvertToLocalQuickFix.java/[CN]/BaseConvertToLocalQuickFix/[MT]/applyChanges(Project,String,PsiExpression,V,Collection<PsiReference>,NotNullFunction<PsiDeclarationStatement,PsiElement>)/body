{
  final PsiElementFactory elementFactory=JavaPsiFacade.getElementFactory(project);
  return ApplicationManager.getApplication().runWriteAction(new Computable<PsiElement>(){
    @Override public PsiElement compute(){
      final PsiDeclarationStatement declaration=elementFactory.createVariableDeclarationStatement(localName,variable.getType(),initializer);
      final PsiElement newDeclaration=action.fun(declaration);
      retargetReferences(elementFactory,localName,references);
      beforeDelete(project,variable,newDeclaration);
      variable.normalizeDeclaration();
      variable.delete();
      return newDeclaration;
    }
  }
);
}
