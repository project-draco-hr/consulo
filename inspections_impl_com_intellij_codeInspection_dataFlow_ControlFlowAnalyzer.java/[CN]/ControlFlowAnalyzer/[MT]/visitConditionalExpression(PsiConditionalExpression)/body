{
  startElement(expression);
  DfaValue dfaValue=myFactory.create(expression);
  if (dfaValue != null) {
    addInstruction(myInstructionFactory.createPushInstruction(dfaValue,expression));
  }
 else {
    PsiExpression condition=expression.getCondition();
    PsiExpression thenExpression=expression.getThenExpression();
    PsiExpression elseExpression=expression.getElseExpression();
    final int elseOffset=elseExpression == null ? getEndOffset(expression) - 1 : getStartOffset(elseExpression);
    if (thenExpression != null) {
      condition.accept(this);
      generateBoxingUnboxingInstructionFor(condition,PsiType.BOOLEAN);
      PsiType type=expression.getType();
      addInstruction(myInstructionFactory.createConditionalGotoInstruction(elseOffset,true,condition));
      thenExpression.accept(this);
      generateBoxingUnboxingInstructionFor(thenExpression,type);
      addInstruction(myInstructionFactory.createGotoInstruction(getEndOffset(expression)));
      if (elseExpression != null) {
        elseExpression.accept(this);
        generateBoxingUnboxingInstructionFor(elseExpression,type);
      }
 else {
        pushUnknown();
      }
    }
 else {
      pushUnknown();
    }
  }
  finishElement(expression);
}
