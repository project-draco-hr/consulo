{
  startElement(expression);
  DfaValue dfaValue=myFactory.create(expression);
  if (dfaValue != null) {
    addInstruction(new PushInstruction(dfaValue));
  }
 else {
    PsiExpression condition=expression.getCondition();
    PsiExpression thenExpression=expression.getThenExpression();
    PsiExpression elseExpression=expression.getElseExpression();
    if (thenExpression != null && elseExpression != null) {
      condition.accept(this);
      generateUnboxingInstructionFor(condition);
      PsiType type=expression.getType();
      boolean shouldUnboxArgs=TypeConversionUtil.isPrimitiveAndNotNull(type);
      addInstruction(new ConditionalGotoInstruction(getStartOffset(elseExpression),true,condition));
      thenExpression.accept(this);
      if (shouldUnboxArgs) {
        generateUnboxingInstructionFor(thenExpression);
      }
      addInstruction(new GotoInstruction(getEndOffset(expression)));
      elseExpression.accept(this);
      if (shouldUnboxArgs) {
        generateUnboxingInstructionFor(elseExpression);
      }
    }
 else {
      pushUnknown();
    }
  }
  finishElement(expression);
}
