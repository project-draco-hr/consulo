{
  if (element != null && !canRename(element,project)) {
    return;
  }
  FeatureUsageTracker.getInstance().triggerFeatureUsed("refactoring.rename");
  if (element instanceof PsiFile) {
    renameFileOrDirectory(element,project);
  }
 else   if (element instanceof PsiDirectory) {
    PsiDirectory psiDirectory=(PsiDirectory)element;
    PsiPackage aPackage=psiDirectory.getPackage();
    final String qualifiedName=aPackage != null ? aPackage.getQualifiedName() : "";
    if (aPackage == null || qualifiedName.length() == 0) {
      renameFileOrDirectory(element,project);
    }
 else {
      PsiDirectory[] directories=aPackage.getDirectories();
      final VirtualFile[] virtualFiles=aPackage.occursInPackagePrefixes();
      if (virtualFiles.length == 0 && directories.length == 1) {
        rename(aPackage,project,nameSuggestionContext);
      }
 else {
        StringBuffer message=new StringBuffer();
        RenameUtil.buildPackagePrefixChangedMessage(virtualFiles,message,qualifiedName);
        RenameUtil.buildMultipleDirectoriesInPackageMessage(message,aPackage,directories);
        message.append("\n\nAll these directories and all references to package \n");
        message.append(qualifiedName);
        message.append("\nwill be renamed.");
        message.append("\nDo you wish to continue?");
        int ret=Messages.showYesNoDialog(project,message.toString(),"Warning",Messages.getWarningIcon());
        if (ret != 0) {
          return;
        }
        rename(aPackage,project,nameSuggestionContext);
      }
    }
  }
 else {
    rename(element,project,nameSuggestionContext);
  }
}
