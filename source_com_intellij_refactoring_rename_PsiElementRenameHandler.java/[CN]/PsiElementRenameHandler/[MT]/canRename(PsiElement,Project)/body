{
  if (element instanceof XmlAttributeValue) {
    XmlAttribute value=(XmlAttribute)element.getParent();
    if (XmlUtil.isAntTargetDefinition(value) || XmlUtil.isAntPropertyDefinition(value)) {
      if (!element.isWritable()) {
        if (!RefactoringMessageUtil.checkReadOnlyStatus(project,element))         return false;
      }
      return true;
    }
  }
  final String REFACTORING_NAME=RefactoringBundle.message("rename.title");
  if (element == null || !(element instanceof PsiFile || element instanceof PsiPointcutDef || element instanceof PsiPackage|| element instanceof PsiDirectory|| element instanceof PsiClass|| element instanceof PsiVariable|| element instanceof PsiMethod|| element instanceof PsiNamedElement|| element instanceof XmlAttributeValue)) {
    String message=RefactoringBundle.getCannotRefactorMessage(RefactoringBundle.message("error.wrong.caret.position.symbol"));
    RefactoringMessageUtil.showErrorMessage(REFACTORING_NAME,message,null,project);
    return false;
  }
  if (!PsiManager.getInstance(project).isInProject(element)) {
    String message=RefactoringBundle.getCannotRefactorMessage(RefactoringBundle.message("error.out.of.project.element",UsageViewUtil.getType(element)));
    RefactoringMessageUtil.showErrorMessage(REFACTORING_NAME,message,null,project);
    return false;
  }
  if (!PsiManager.getInstance(project).isInProject(element)) {
    String message="Cannot perform the refactoring.\n" + "Selected " + UsageViewUtil.getType(element) + " is not located inside the project.";
    RefactoringMessageUtil.showErrorMessage(REFACTORING_NAME,message,null,project);
    return false;
  }
  if (!element.isWritable()) {
    if (!RefactoringMessageUtil.checkReadOnlyStatus(project,element))     return false;
  }
  return true;
}
