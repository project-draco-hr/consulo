{
  final DataContext dataContext=e.getDataContext();
  final Presentation presentation=e.getPresentation();
  final Project project=PlatformDataKeys.PROJECT.getData(dataContext);
  if (project == null) {
    disable(presentation);
    return;
  }
  final VirtualFile file=PlatformDataKeys.VIRTUAL_FILE.getData(dataContext);
  if (file == null) {
    disable(presentation);
    return;
  }
  final PsiFile psiFile=PsiManager.getInstance(project).findFile(file);
  if (!(psiFile instanceof XmlFile)) {
    disable(presentation);
    return;
  }
  final XmlFile xmlFile=(XmlFile)psiFile;
  final XmlDocument document=xmlFile.getDocument();
  if (document == null) {
    disable(presentation);
    return;
  }
  final XmlTag rootTag=document.getRootTag();
  if (rootTag == null) {
    disable(presentation);
    return;
  }
  if (!"project".equals(rootTag.getName())) {
    disable(presentation);
    return;
  }
  for (  final AntBuildFile buildFile : AntConfiguration.getInstance(project).getBuildFiles()) {
    if (file.equals(buildFile.getVirtualFile())) {
      disable(presentation);
      return;
    }
  }
  enable(presentation);
}
