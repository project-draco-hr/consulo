{
  final DataContext dataContext=e.getDataContext();
  final Presentation presentation=e.getPresentation();
  final Project project=CommonDataKeys.PROJECT.getData(dataContext);
  if (project == null) {
    disable(presentation);
    return;
  }
  final VirtualFile file=PlatformDataKeys.VIRTUAL_FILE.getData(dataContext);
  if (file == null) {
    disable(presentation);
    return;
  }
  final PsiFile psiFile=PsiManager.getInstance(project).findFile(file);
  if (!(psiFile instanceof XmlFile)) {
    disable(presentation);
    return;
  }
  final XmlFile xmlFile=(XmlFile)psiFile;
  final XmlDocument document=xmlFile.getDocument();
  if (document == null) {
    disable(presentation);
    return;
  }
  final XmlTag rootTag=document.getRootTag();
  if (rootTag == null) {
    disable(presentation);
    return;
  }
  if (!"project".equals(rootTag.getName())) {
    disable(presentation);
    return;
  }
  if (AntConfigurationBase.getInstance(project).getAntBuildFile(psiFile) != null) {
    disable(presentation);
    return;
  }
  enable(presentation);
}
