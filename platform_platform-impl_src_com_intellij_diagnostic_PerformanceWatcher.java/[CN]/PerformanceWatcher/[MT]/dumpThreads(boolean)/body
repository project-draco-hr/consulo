{
  final String suffix=millis ? "-" + String.valueOf(System.currentTimeMillis()) : "";
  myCurHangLogDir.mkdirs();
  File f=new File(myCurHangLogDir,"threadDump-" + myDateFormat.format(new Date()) + suffix+ ".txt");
  FileOutputStream fos;
  try {
    fos=new FileOutputStream(f);
  }
 catch (  FileNotFoundException e) {
    return;
  }
  OutputStreamWriter writer=new OutputStreamWriter(fos);
  try {
    final StackTraceElement[] edtStack=ThreadDumper.dumpThreadsToFile(myThreadMXBean,writer);
    if (edtStack != null) {
      if (myStacktraceCommonPart == null) {
        myStacktraceCommonPart=new ArrayList<StackTraceElement>();
        Collections.addAll(myStacktraceCommonPart,edtStack);
      }
 else {
        updateStacktraceCommonPart(edtStack);
      }
    }
  }
  finally {
    try {
      writer.close();
    }
 catch (    IOException e) {
    }
  }
}
