{
  if (shallNotWatch())   return;
  final String threshold=System.getProperty("performance.watcher.threshold");
  if (threshold != null) {
    try {
      UNRESPONSIVE_THRESHOLD=Integer.parseInt(threshold);
    }
 catch (    NumberFormatException e) {
    }
  }
  if (UNRESPONSIVE_THRESHOLD == 0) {
    return;
  }
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    public void run(){
      deleteOldThreadDumps();
    }
  }
);
  myLogDir=new File(PathManager.getLogPath() + "/threadDumps-" + myDateFormat.format(new Date())+ "-"+ ApplicationInfo.getInstance().getBuild().asString());
  myLogDir.mkdirs();
  myCurHangLogDir=myLogDir;
  myThreadMXBean=ManagementFactory.getThreadMXBean();
  try {
    myDumpAllThreadsMethod=ThreadMXBean.class.getMethod("dumpAllThreads",boolean.class,boolean.class);
  }
 catch (  NoSuchMethodException e) {
    myDumpAllThreadsMethod=null;
  }
  try {
    myShutdownSemaphore.acquire();
  }
 catch (  InterruptedException e) {
  }
  myThread=new Thread(new Runnable(){
    public void run(){
      checkEDTResponsiveness();
    }
  }
,"Performance watcher");
  myThread.setPriority(Thread.MIN_PRIORITY);
  myThread.start();
}
