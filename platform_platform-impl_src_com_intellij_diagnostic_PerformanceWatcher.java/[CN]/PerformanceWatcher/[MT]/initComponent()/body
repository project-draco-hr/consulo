{
  myThreadMXBean=ManagementFactory.getThreadMXBean();
  if (shallNotWatch())   return;
  final String threshold=System.getProperty("performance.watcher.threshold");
  if (threshold != null) {
    try {
      UNRESPONSIVE_THRESHOLD=Integer.parseInt(threshold);
    }
 catch (    NumberFormatException e) {
    }
  }
  final String interval=System.getProperty("performance.watcher.interval");
  if (interval != null) {
    try {
      UNRESPONSIVE_INTERVAL=Integer.parseInt(interval);
    }
 catch (    NumberFormatException e) {
    }
  }
  if (UNRESPONSIVE_THRESHOLD == 0 || UNRESPONSIVE_INTERVAL == 0) {
    return;
  }
  ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
    public void run(){
      deleteOldThreadDumps();
    }
  }
);
  myLogDir=new File(PathManager.getLogPath() + "/threadDumps-" + myDateFormat.format(new Date())+ "-"+ ApplicationInfo.getInstance().getBuild().asString());
  myCurHangLogDir=myLogDir;
  try {
    myShutdownSemaphore.acquire();
  }
 catch (  InterruptedException e) {
  }
  myThread=new Thread(new Runnable(){
    public void run(){
      checkEDTResponsiveness();
    }
  }
,"Performance watcher");
  myThread.setPriority(Thread.MIN_PRIORITY);
  myThread.start();
}
