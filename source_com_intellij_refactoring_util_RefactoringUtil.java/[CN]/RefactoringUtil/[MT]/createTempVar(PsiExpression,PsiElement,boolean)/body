{
  PsiElement anchorStatement=getParentStatement(context,true);
  LOG.assertTrue(anchorStatement != null && anchorStatement.getParent() != null);
  Project project=expr.getProject();
  String[] suggestedNames=CodeStyleManager.getInstance(project).suggestVariableName(VariableKind.LOCAL_VARIABLE,null,expr,null).names;
  final String prefix=suggestedNames[0];
  final String id=CodeStyleManager.getInstance(project).suggestUniqueVariableName(prefix,context,true);
  PsiElementFactory factory=expr.getManager().getElementFactory();
  if (expr instanceof PsiParenthesizedExpression) {
    PsiExpression expr1=((PsiParenthesizedExpression)expr).getExpression();
    if (expr1 != null) {
      expr=expr1;
    }
  }
  PsiDeclarationStatement decl=factory.createVariableDeclarationStatement(id,expr.getType(),expr);
  if (declareFinal) {
    ((PsiLocalVariable)decl.getDeclaredElements()[0]).getModifierList().setModifierProperty(PsiModifier.FINAL,true);
  }
  anchorStatement.getParent().addBefore(decl,anchorStatement);
  return id;
}
