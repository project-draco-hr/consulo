{
  VirtualFileManager.getInstance().addVirtualFileListener(myVfsListener);
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    myIsInitialized=true;
    markEverythingDirty();
  }
 else {
    StartupManager.getInstance(myProject).registerPostStartupActivity(new Runnable(){
      public void run(){
        myIsInitialized=true;
        markEverythingDirty();
      }
    }
);
  }
  myConnection=myProject.getMessageBus().connect();
  myConnection.subscribe(ProjectTopics.PROJECT_ROOTS,new ModuleRootListener(){
    public void beforeRootsChange(    ModuleRootEvent event){
    }
    public void rootsChanged(    ModuleRootEvent event){
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          markEverythingDirty();
        }
      }
,ModalityState.NON_MODAL);
    }
  }
);
}
