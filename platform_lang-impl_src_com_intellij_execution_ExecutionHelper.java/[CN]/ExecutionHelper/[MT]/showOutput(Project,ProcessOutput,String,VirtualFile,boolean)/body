{
  final String stdout=output.getStdout();
  final String stderr=output.getStderr();
  if (ApplicationManager.getApplication().isUnitTestMode() && !(stdout.isEmpty() || stderr.isEmpty())) {
    throw new RuntimeException("STDOUT:\n" + stdout + "\nSTDERR:\n"+ stderr);
  }
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    @Override public void run(){
      if (myProject.isDisposed())       return;
      final String stdOutTitle="[Stdout]:";
      final String stderrTitle="[Stderr]:";
      final ErrorViewPanel errorTreeView=new ErrorViewPanel(myProject);
      try {
        openMessagesView(errorTreeView,myProject,tabDisplayName);
      }
 catch (      NullPointerException e) {
        final StringBuilder builder=new StringBuilder();
        builder.append(stdOutTitle).append("\n").append(stdout != null ? stdout : "<empty>").append("\n");
        builder.append(stderrTitle).append("\n").append(stderr != null ? stderr : "<empty>");
        Messages.showErrorDialog(builder.toString(),"Process Output");
        return;
      }
      if (!StringUtil.isEmpty(stdout)) {
        final String[] stdoutLines=StringUtil.splitByLines(stdout);
        if (stdoutLines.length > 0) {
          if (StringUtil.isEmpty(stderr)) {
            errorTreeView.addMessage(MessageCategory.SIMPLE,stdoutLines,file,-1,-1,null);
          }
 else {
            if (file == null) {
              errorTreeView.addMessage(MessageCategory.SIMPLE,stdoutLines,stdOutTitle,new FakeNavigatable(),null,null,null);
            }
 else {
              errorTreeView.addMessage(MessageCategory.SIMPLE,new String[]{stdOutTitle},file,-1,-1,null);
              errorTreeView.addMessage(MessageCategory.SIMPLE,new String[]{""},file,-1,-1,null);
              errorTreeView.addMessage(MessageCategory.SIMPLE,stdoutLines,file,-1,-1,null);
            }
          }
        }
      }
      if (!StringUtil.isEmpty(stderr)) {
        final String[] stderrLines=StringUtil.splitByLines(stderr);
        if (stderrLines.length > 0) {
          if (file == null) {
            errorTreeView.addMessage(MessageCategory.SIMPLE,stderrLines,stderrTitle,new FakeNavigatable(),null,null,null);
          }
 else {
            errorTreeView.addMessage(MessageCategory.SIMPLE,new String[]{stderrTitle},file,-1,-1,null);
            errorTreeView.addMessage(MessageCategory.SIMPLE,ArrayUtil.EMPTY_STRING_ARRAY,file,-1,-1,null);
            errorTreeView.addMessage(MessageCategory.SIMPLE,stderrLines,file,-1,-1,null);
          }
        }
      }
      errorTreeView.addMessage(MessageCategory.SIMPLE,new String[]{"Process finished with exit code " + output.getExitCode()},null,-1,-1,null);
      if (activateWindow) {
        ToolWindowManager.getInstance(myProject).getToolWindow(ToolWindowId.MESSAGES_WINDOW).activate(null);
      }
    }
  }
);
}
