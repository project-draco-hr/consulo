{
  final DebugProcessImpl debugProcess=context.getDebugProcess();
  if (LOG_ENABLED || LOG_EXPRESSION_ENABLED) {
    final StringBuilder buf=StringBuilderSpinAllocator.alloc();
    try {
      if (LOG_ENABLED) {
        buf.append(getEventMessage(event));
        buf.append("\n");
      }
      final TextWithImports expressionToEvaluate=getLogMessage();
      if (LOG_EXPRESSION_ENABLED && expressionToEvaluate != null && !"".equals(expressionToEvaluate.getText())) {
        if (!debugProcess.isAttached()) {
          return;
        }
        try {
          ExpressionEvaluator evaluator=DebuggerInvocationUtil.commitAndRunReadAction(getProject(),new EvaluatingComputable<ExpressionEvaluator>(){
            public ExpressionEvaluator compute() throws EvaluateException {
              return EvaluatorBuilderImpl.build(expressionToEvaluate,ContextUtil.getContextElement(context),ContextUtil.getSourcePosition(context));
            }
          }
);
          final Value eval=evaluator.evaluate(context);
          final String result=eval instanceof VoidValue ? "void" : DebuggerUtils.getValueAsString(context,eval);
          buf.append(result);
        }
 catch (        EvaluateException e) {
          buf.append(DebuggerBundle.message("error.unable.to.evaluate.expression"));
          buf.append(" \"");
          buf.append(expressionToEvaluate);
          buf.append("\"");
          buf.append(" : ");
          buf.append(e.getMessage());
        }
        buf.append("\n");
      }
      if (buf.length() > 0) {
        debugProcess.printToConsole(buf.toString());
      }
    }
  finally {
      StringBuilderSpinAllocator.dispose(buf);
    }
  }
  if (REMOVE_AFTER_HIT) {
    debugProcess.addDebugProcessListener(new DebugProcessAdapter(){
      @Override public void resumed(      SuspendContext suspendContext){
        DebuggerUIUtil.invokeOnEventDispatch(new Runnable(){
          @Override public void run(){
            DebuggerManagerEx.getInstanceEx(myProject).getBreakpointManager().removeBreakpoint(Breakpoint.this);
          }
        }
);
        debugProcess.removeDebugProcessListener(this);
      }
    }
);
  }
}
