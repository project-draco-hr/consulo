{
  if (LOG_ENABLED || LOG_EXPRESSION_ENABLED) {
    final StringBuilder buf=StringBuilderSpinAllocator.alloc();
    try {
      if (LOG_ENABLED) {
        buf.append(getEventMessage(event));
        buf.append("\n");
      }
      final DebugProcessImpl debugProcess=context.getDebugProcess();
      final TextWithImports expressionToEvaluate=getLogMessage();
      if (LOG_EXPRESSION_ENABLED && expressionToEvaluate != null && !"".equals(expressionToEvaluate.getText())) {
        if (!debugProcess.isAttached()) {
          return;
        }
        try {
          ExpressionEvaluator evaluator=DebuggerInvocationUtil.commitAndRunReadAction(getProject(),new EvaluatingComputable<ExpressionEvaluator>(){
            public ExpressionEvaluator compute() throws EvaluateException {
              return EvaluatorBuilderImpl.getInstance().build(expressionToEvaluate,ContextUtil.getContextElement(context),ContextUtil.getSourcePosition(context));
            }
          }
);
          final String result=DebuggerUtils.getValueAsString(context,evaluator.evaluate(context));
          buf.append(result);
        }
 catch (        EvaluateException e) {
          buf.append(DebuggerBundle.message("error.unable.to.evaluate.expression"));
          buf.append(" \"");
          buf.append(expressionToEvaluate);
          buf.append("\"");
          buf.append(" : ");
          buf.append(e.getMessage());
        }
        buf.append("\n");
      }
      if (buf.length() > 0) {
        debugProcess.printToConsole(buf.toString());
      }
    }
  finally {
      StringBuilderSpinAllocator.dispose(buf);
    }
  }
}
