def colorchurn(orig, ui, repo, *pats, **opts):
    'run the churn command with colored output'
    if (not opts.get('diffstat')):
        return orig(ui, repo, *pats, **opts)
    oldwrite = extensions.wrapfunction(ui, 'write', colordiffstat)
    try:
        orig(ui, repo, *pats, **opts)
    finally:
        ui.write = oldwrite
