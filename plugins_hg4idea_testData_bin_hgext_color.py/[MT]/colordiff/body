def colordiff(orig, ui, repo, *pats, **opts):
    'run the diff command with colored output'
    if opts.get('stat'):
        wrapper = colordiffstat
    else:
        wrapper = colorwrap
    oldwrite = extensions.wrapfunction(ui, 'write', wrapper)
    try:
        orig(ui, repo, *pats, **opts)
    finally:
        ui.write = oldwrite
