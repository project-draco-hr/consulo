def colorwrap(orig, *args):
    'wrap ui.write for colored diff output'

    def _colorize(s):
        lines = s.split('\n')
        for (i, line) in enumerate(lines):
            stripline = line
            if (line and (line[0] in '+-')):
                stripline = line.rstrip()
            for (prefix, style) in _diff_prefixes:
                if stripline.startswith(prefix):
                    lines[i] = render_effects(stripline, _diff_effects[style])
                    break
            if (line != stripline):
                lines[i] += render_effects(line[len(stripline):], _diff_effects['trailingwhitespace'])
        return '\n'.join(lines)
    orig(*[_colorize(s) for s in args])
