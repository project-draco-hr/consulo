def extsetup(ui):
    'Initialize the extension.'
    _setupcmd(ui, 'diff', commands.table, colordiff, _diff_effects)
    _setupcmd(ui, 'incoming', commands.table, None, _diff_effects)
    _setupcmd(ui, 'log', commands.table, None, _diff_effects)
    _setupcmd(ui, 'outgoing', commands.table, None, _diff_effects)
    _setupcmd(ui, 'tip', commands.table, None, _diff_effects)
    _setupcmd(ui, 'status', commands.table, colorstatus, _status_effects)
    _setupcmd(ui, 'resolve', commands.table, colorresolve, _resolve_effects)
    try:
        mq = extensions.find('mq')
        _setupcmd(ui, 'qdiff', mq.cmdtable, colordiff, _diff_effects)
        _setupcmd(ui, 'qseries', mq.cmdtable, colorqseries, _patch_effects)
    except KeyError:
        mq = None
    try:
        rec = extensions.find('record')
        _setupcmd(ui, 'record', rec.cmdtable, colordiff, _diff_effects)
    except KeyError:
        rec = None
    if (mq and rec):
        _setupcmd(ui, 'qrecord', rec.cmdtable, colordiff, _diff_effects)
    try:
        churn = extensions.find('churn')
        _setupcmd(ui, 'churn', churn.cmdtable, colorchurn, _diff_effects)
    except KeyError:
        churn = None
    try:
        bookmarks = extensions.find('bookmarks')
        _setupcmd(ui, 'bookmarks', bookmarks.cmdtable, colorbookmarks, _bookmark_effects)
    except KeyError:
        pass
