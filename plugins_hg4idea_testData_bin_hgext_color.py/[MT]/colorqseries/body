def colorqseries(orig, ui, repo, *dummy, **opts):
    'run the qseries command with colored output'
    ui.pushbuffer()
    retval = orig(ui, repo, **opts)
    patchlines = ui.popbuffer().splitlines()
    patchnames = repo.mq.series
    for (patch, patchname) in zip(patchlines, patchnames):
        if opts['missing']:
            effects = _patch_effects['missing']
        elif [applied for applied in repo.mq.applied if (patchname == applied.name)]:
            effects = _patch_effects['applied']
        else:
            effects = _patch_effects['unapplied']
        patch = patch.replace(patchname, render_effects(patchname, effects), 1)
        ui.write((patch + '\n'))
    return retval
