{
  VfsUtilCore.visitChildrenRecursively(root,new VirtualFileVisitor(){
    @Override public boolean visitFile(    @NotNull VirtualFile file){
      if (file.isDirectory()) {
        if (!all && !result.isEmpty()) {
          return false;
        }
      }
 else       if (file.getBOM() != null) {
        result.add(file);
      }
      return true;
    }
  }
);
}
