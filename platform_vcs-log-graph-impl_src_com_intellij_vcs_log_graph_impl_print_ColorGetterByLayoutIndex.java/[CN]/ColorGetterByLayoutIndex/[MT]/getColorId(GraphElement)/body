{
  int upNodeIndex, downNodeIndex;
  if (element instanceof GraphNode) {
    upNodeIndex=((GraphNode)element).getNodeIndex();
    downNodeIndex=upNodeIndex;
  }
 else {
    GraphEdge edge=(GraphEdge)element;
    NormalEdge normalEdge=LinearGraphUtils.asNormalEdge(edge);
    if (normalEdge != null) {
      upNodeIndex=normalEdge.up;
      downNodeIndex=normalEdge.down;
    }
 else {
      upNodeIndex=LinearGraphUtils.getNotNullNodeIndex(edge);
      downNodeIndex=upNodeIndex;
    }
  }
  int upLayoutIndex=getLayoutIndex(upNodeIndex);
  int downLayoutIndex=getLayoutIndex(downNodeIndex);
  CommitId headCommitId=getOneOfHeads(upNodeIndex);
  if (upLayoutIndex != downLayoutIndex) {
    return myColorManager.getColorOfFragment(headCommitId,Math.max(upLayoutIndex,downLayoutIndex));
  }
  if (upLayoutIndex == myPermanentGraphInfo.getPermanentGraphLayout().getLayoutIndex(getHeadNodeId(upNodeIndex))) {
    return myColorManager.getColorOfBranch(headCommitId);
  }
 else {
    return myColorManager.getColorOfFragment(headCommitId,upLayoutIndex);
  }
}
