{
  initSerializers();
  try {
    final StubSerializer serializer=getSerializer(rootStub);
    DataInputOutputUtil.writeINT(stream,getClassId(serializer));
    serializer.serialize(rootStub,stream);
    final List<StubElement> children=rootStub.getChildrenStubs();
    final int childrenSize=children.size();
    DataInputOutputUtil.writeINT(stream,childrenSize);
    for (int i=0; i < childrenSize; ++i) {
      doSerialize(children.get(i),stream);
    }
  }
 catch (  IOException e) {
    LOG.info(e);
    myNameStorageCrashed.set(true);
  }
}
