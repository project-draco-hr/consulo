{
  myFile.getParentFile().mkdirs();
  try {
    myNameStorage=new PersistentStringEnumerator(myFile,true);
    myStubSerializationHelper=new StubSerializationHelper(myNameStorage);
  }
 catch (  IOException e) {
    nameStorageCrashed();
    LOG.info(e);
    repairNameStorage();
    nameStorageCrashed();
  }
 finally {
    registerSerializer(PsiFileStubImpl.TYPE);
    ShutDownTracker.getInstance().registerShutdownTask(new Runnable(){
      @Override public void run(){
        performShutdown();
      }
    }
);
  }
}
