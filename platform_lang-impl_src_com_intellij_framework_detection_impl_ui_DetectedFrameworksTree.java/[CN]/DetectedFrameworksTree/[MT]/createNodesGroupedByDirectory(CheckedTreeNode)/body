{
  Map<VirtualFile,FrameworkDirectoryNode> nodes=new HashMap<VirtualFile,FrameworkDirectoryNode>();
  List<DetectedFrameworkNode> externalNodes=new ArrayList<DetectedFrameworkNode>();
  for (  DetectedFrameworkDescription framework : myDetectedFrameworks) {
    VirtualFile parent=VfsUtil.getCommonAncestor(framework.getRelatedFiles());
    if (parent != null && !parent.isDirectory()) {
      parent=parent.getParent();
    }
    final DetectedFrameworkNode frameworkNode=new DetectedFrameworkNode(framework,myContext);
    if (parent != null) {
      createDirectoryNodes(parent,nodes).add(frameworkNode);
    }
 else {
      externalNodes.add(frameworkNode);
    }
  }
  for (  FrameworkDirectoryNode directoryNode : nodes.values()) {
    if (directoryNode.getParent() == null) {
      root.add(collapseDirectoryNode(directoryNode));
    }
  }
  for (  DetectedFrameworkNode node : externalNodes) {
    root.add(node);
  }
}
