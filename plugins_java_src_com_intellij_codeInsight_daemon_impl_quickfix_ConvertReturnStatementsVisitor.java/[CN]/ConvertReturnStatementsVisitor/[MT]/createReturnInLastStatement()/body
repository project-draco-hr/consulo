{
  return ApplicationManager.getApplication().runWriteAction(new Computable<PsiReturnStatement>(){
    @Override public PsiReturnStatement compute(){
      PsiCodeBlock body=myMethod.getBody();
      PsiJavaToken rBrace=body.getRBrace();
      if (rBrace == null)       return null;
      final String value=generateValue(rBrace);
      PsiReturnStatement returnStatement=(PsiReturnStatement)myFactory.createStatementFromText("return " + value + ";",myMethod);
      return (PsiReturnStatement)body.addBefore(returnStatement,rBrace);
    }
  }
);
}
