{
  try {
    URL url=new URL(dtdUrl);
    HttpURLConnection urlConnection=(HttpURLConnection)url.openConnection();
    urlConnection.addRequestProperty("accept","text/xml,application/xml,text/html,*/*");
    int contentLength=urlConnection.getContentLength();
    int bytesRead=0;
    ByteArrayOutputStream out=new ByteArrayOutputStream();
    InputStream in=urlConnection.getInputStream();
    String contentType=urlConnection.getContentType();
    byte[] buffer=new byte[256];
    while (true) {
      int read=in.read(buffer);
      if (read < 0)       break;
      out.write(buffer,0,read);
      bytesRead+=read;
      indicator.setFraction((double)bytesRead / (double)contentLength);
    }
    in.close();
    out.close();
    FetchResult result=new FetchResult();
    result.bytes=out.toByteArray();
    result.contentType=contentType;
    return result;
  }
 catch (  MalformedURLException e) {
    if (!ApplicationManager.getApplication().isUnitTestMode()) {
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          Messages.showMessageDialog(project,QuickFixBundle.message("invalid.uril.message",dtdUrl),QuickFixBundle.message("invalid.url.title"),Messages.getErrorIcon());
        }
      }
,indicator.getModalityState());
    }
  }
  return null;
}
