{
  SwingUtilities.invokeLater(new Runnable(){
    public void run(){
      indicator.setText(QuickFixBundle.message("fetching.progress.indicator",resourceUrl));
    }
  }
);
  byte[] bytes=fetchData(project,resourceUrl,indicator);
  if (bytes == null)   return null;
  int slashIndex=resourceUrl.lastIndexOf('/');
  String resPath=extResourcesPath + File.separatorChar;
  if (refname != null) {
    resPath+=refname;
    int refnameSlashIndex=resPath.lastIndexOf('/');
    if (refnameSlashIndex != -1) {
      new File(resPath.substring(0,refnameSlashIndex)).mkdirs();
    }
  }
 else {
    resPath+=Integer.toHexString(resourceUrl.hashCode()) + "_" + resourceUrl.substring(slashIndex + 1);
  }
  if (resourceUrl.indexOf('.',slashIndex) == -1) {
    resPath+="." + StdFileTypes.XML.getDefaultExtension();
  }
  File res=new File(resPath);
  FileOutputStream out=new FileOutputStream(res);
  try {
    out.write(bytes);
  }
  finally {
    out.close();
  }
  return resPath;
}
