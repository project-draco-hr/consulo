{
  registrar.extend(CompletionType.BASIC,psiElement(PsiIdentifier.class).andNot(INSIDE_TYPE_PARAMS_PATTERN).withParent(or(psiElement(PsiLocalVariable.class),psiElement(PsiParameter.class))),new CompletionProvider<LookupElement,CompletionParameters>(){
    public void addCompletions(    @NotNull final CompletionParameters parameters,    final ProcessingContext matchingContext,    @NotNull final CompletionResultSet<LookupElement> result){
      final Set<LookupItem> lookupSet=new THashSet<LookupItem>();
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        public void run(){
          JavaCompletionUtil.completeLocalVariableName(lookupSet,result.getPrefixMatcher(),(PsiVariable)parameters.getPosition().getParent());
        }
      }
);
      for (      final LookupItem item : lookupSet) {
        result.addElement(item);
      }
    }
  }
);
  registrar.extend(CompletionType.BASIC,psiElement(PsiIdentifier.class).withParent(PsiField.class),new CompletionProvider<LookupElement,CompletionParameters>(){
    public void addCompletions(    @NotNull final CompletionParameters parameters,    final ProcessingContext matchingContext,    @NotNull final CompletionResultSet<LookupElement> result){
      final Set<LookupItem> lookupSet=new THashSet<LookupItem>();
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        public void run(){
          final PsiVariable variable=(PsiVariable)parameters.getPosition().getParent();
          JavaCompletionUtil.completeFieldName(lookupSet,variable,result.getPrefixMatcher());
          JavaCompletionUtil.completeMethodName(lookupSet,variable,result.getPrefixMatcher());
        }
      }
);
      for (      final LookupItem item : lookupSet) {
        result.addElement(item);
      }
    }
  }
);
  registrar.extend(CompletionType.BASIC,PsiJavaPatterns.psiElement().nameIdentifierOf(PsiJavaPatterns.psiMethod().withParent(PsiClass.class)),new CompletionProvider<LookupElement,CompletionParameters>(){
    public void addCompletions(    @NotNull final CompletionParameters parameters,    final ProcessingContext matchingContext,    @NotNull final CompletionResultSet<LookupElement> result){
      final Set<LookupItem> lookupSet=new THashSet<LookupItem>();
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        public void run(){
          JavaCompletionUtil.completeMethodName(lookupSet,parameters.getPosition().getParent(),result.getPrefixMatcher());
        }
      }
);
      for (      final LookupItem item : lookupSet) {
        result.addElement(item);
      }
    }
  }
);
}
