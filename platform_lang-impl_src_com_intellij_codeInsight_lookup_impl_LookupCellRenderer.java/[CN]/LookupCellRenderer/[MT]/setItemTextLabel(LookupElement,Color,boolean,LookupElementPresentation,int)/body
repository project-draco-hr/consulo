{
  boolean bold=presentation.isItemTextBold();
  myNameComponent.setFont(bold ? BOLD_FONT : NORMAL_FONT);
  int style=bold ? SimpleTextAttributes.STYLE_BOLD : SimpleTextAttributes.STYLE_PLAIN;
  if (presentation.isStrikeout()) {
    style|=SimpleTextAttributes.STYLE_STRIKEOUT;
  }
  final FontMetrics metrics=bold ? myBoldMetrics : myNormalMetrics;
  final String name=trimLabelText(presentation.getItemText(),allowedWidth,metrics);
  int used=RealLookupElementPresentation.getStringWidth(name,metrics);
  final SimpleTextAttributes baseAttrs=new SimpleTextAttributes(style,foreground);
  final String prefix=item.getPrefixMatcher().getPrefix();
  if (prefix.length() > 0) {
    final int i=StringUtil.indexOfIgnoreCase(name,prefix,0);
    if (i > 0) {
      myNameComponent.append(name.substring(0,i),baseAttrs);
      myNameComponent.append(name.substring(i,i + prefix.length()),new SimpleTextAttributes(style,selected ? SELECTED_PREFIX_FOREGROUND_COLOR : PREFIX_FOREGROUND_COLOR));
      myNameComponent.append(name.substring(i + prefix.length()),baseAttrs);
      return used;
    }
  }
  myNameComponent.append(name,baseAttrs);
  return used;
}
