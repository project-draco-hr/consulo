{
  final String givenText=presentation.getTypeText();
  final String labelText=trimLabelText(StringUtil.isEmpty(givenText) ? "" : " " + givenText,allowedWidth,myNormalMetrics);
  int used=RealLookupElementPresentation.getStringWidth(labelText,myNormalMetrics);
  final Icon icon=presentation.getTypeIcon();
  if (icon != null) {
    myTypeLabel.setIcon(icon);
    used+=icon.getIconWidth();
  }
  Color sampleBackground=background;
  Object o=item.isValid() ? item.getObject() : null;
  if (o instanceof LookupValueWithUIHint && StringUtil.isEmpty(labelText)) {
    Color proposedBackground=((LookupValueWithUIHint)o).getColorHint();
    if (proposedBackground != null) {
      sampleBackground=proposedBackground;
    }
    myTypeLabel.append("  ");
    used+=myNormalMetrics.stringWidth("WW");
  }
 else {
    myTypeLabel.append(labelText);
  }
  myTypeLabel.setBackground(sampleBackground);
  myTypeLabel.setForeground(presentation.isTypeGrayed() ? getGrayedForeground(selected) : item instanceof EmptyLookupItem ? JBColor.foreground : foreground);
  return used;
}
