{
  final String givenText=presentation.getTypeText();
  final String labelText=trimLabelText(StringUtil.isEmpty(givenText) ? "" : " " + givenText,allowedWidth,normalMetrics);
  int used=RealLookupElementPresentation.getStringWidth(labelText,normalMetrics);
  final Icon icon=presentation.getTypeIcon();
  if (icon != null) {
    myTypeLabel.setIcon(icon);
    used+=icon.getIconWidth();
  }
  Color sampleBackground=background;
  Object o=item.isValid() ? item.getObject() : null;
  if (o instanceof LookupValueWithUIHint && StringUtil.isEmpty(labelText)) {
    Color proposedBackground=((LookupValueWithUIHint)o).getColorHint();
    if (proposedBackground != null) {
      sampleBackground=proposedBackground;
    }
    myTypeLabel.append("  ");
    used+=normalMetrics.stringWidth("WW");
  }
 else {
    myTypeLabel.append(labelText);
  }
  myTypeLabel.setBackground(sampleBackground);
  myTypeLabel.setForeground(getTypeTextColor(item,foreground,presentation,selected,nonFocusedSelection));
  return used;
}
