{
  if (!myLookup.isFocused()) {
    isSelected=false;
  }
  final LookupElement item=(LookupElement)value;
  final Color foreground=isSelected ? SELECTED_FOREGROUND_COLOR : FOREGROUND_COLOR;
  final Color background=getItemBackground(list,index,isSelected);
  int allowedWidth=list.getWidth() - AFTER_TAIL - AFTER_TYPE- getIconIndent();
  final LookupElementPresentation presentation=new RealLookupElementPresentation(allowedWidth,myNormalMetrics,myBoldMetrics,myLookup);
  item.renderElement(presentation);
  myNameComponent.clear();
  myNameComponent.setIcon(augmentIcon(presentation.getIcon(),myEmptyIcon));
  myNameComponent.setBackground(background);
  allowedWidth-=setItemTextLabel(item,presentation.getItemTextForeground(),isSelected,presentation,allowedWidth);
  myTypeLabel.clear();
  if (allowedWidth > 0) {
    allowedWidth-=setTypeTextLabel(item,background,foreground,presentation,allowedWidth,isSelected);
  }
  myTailComponent.clear();
  myTailComponent.setBackground(background);
  if (allowedWidth >= 0) {
    setTailTextLabel(isSelected,presentation,foreground,allowedWidth);
  }
  return myPanel;
}
