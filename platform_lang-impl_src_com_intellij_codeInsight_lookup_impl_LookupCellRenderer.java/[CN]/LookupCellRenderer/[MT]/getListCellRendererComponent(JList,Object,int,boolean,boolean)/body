{
  final LookupElement item=(LookupElement)value;
  final Color foreground=isSelected ? SELECTED_FOREGROUND_COLOR : FOREGROUND_COLOR;
  final Color background=getItemBackground(list,index,isSelected);
  int allowedWidth=list.getFixedCellWidth() - getCommonIconWidth();
  final LookupElementPresentation presentation=new RealLookupElementPresentation(allowedWidth,myNormalMetrics,myBoldMetrics);
  item.renderElement(presentation);
  myNameComponent.clear();
  myNameComponent.setIcon(getIcon(presentation.getIcon()));
  myNameComponent.setBackground(background);
  allowedWidth-=setItemTextLabel(item,foreground,isSelected,presentation,allowedWidth);
  myTypeLabel.clear();
  if (allowedWidth > 0) {
    allowedWidth-=setTypeTextLabel(item,background,foreground,presentation,allowedWidth);
  }
  myTailComponent.clear();
  myTailComponent.setBackground(background);
  if (allowedWidth >= 0) {
    setTailTextLabel(isSelected,presentation,foreground,allowedWidth);
  }
  myArrowLabel.setIcon(myLookup.getActionsFor(item).isEmpty() ? PopupIcons.EMPTY_ICON : PopupIcons.HAS_NEXT_ICON_GRAYED);
  myArrowLabel.setBackground(background);
  myArrowLabel.setForeground(foreground);
  return myPanel;
}
