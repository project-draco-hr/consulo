{
  if (!myLookup.isFocused()) {
    isSelected=false;
  }
  final LookupElement item=(LookupElement)value;
  final Color foreground=isSelected ? SELECTED_FOREGROUND_COLOR : FOREGROUND_COLOR;
  final Color background=getItemBackground(list,index,isSelected);
  int allowedWidth=list.getWidth() - AFTER_TAIL - AFTER_TYPE- getIconIndent();
  final LookupElementPresentation presentation=new RealLookupElementPresentation(myFullSize ? getMaxWidth() : allowedWidth,myNormalMetrics,myBoldMetrics,myLookup);
  if (item.isValid()) {
    item.renderElement(presentation);
  }
 else {
    presentation.setItemTextForeground(Color.RED);
    presentation.setItemText("Invalid");
  }
  myNameComponent.clear();
  myNameComponent.setIcon(augmentIcon(presentation.getIcon(),myEmptyIcon));
  myNameComponent.setBackground(background);
  allowedWidth-=setItemTextLabel(item,isSelected ? SELECTED_FOREGROUND_COLOR : presentation.getItemTextForeground(),isSelected,presentation,allowedWidth);
  myTypeLabel.clear();
  if (allowedWidth > 0) {
    allowedWidth-=setTypeTextLabel(item,background,foreground,presentation,myFullSize ? getMaxWidth() : allowedWidth,isSelected);
  }
  myTailComponent.clear();
  myTailComponent.setBackground(background);
  if (myFullSize || allowedWidth >= 0) {
    setTailTextLabel(isSelected,presentation,foreground,myFullSize ? getMaxWidth() : allowedWidth);
  }
  return myPanel;
}
