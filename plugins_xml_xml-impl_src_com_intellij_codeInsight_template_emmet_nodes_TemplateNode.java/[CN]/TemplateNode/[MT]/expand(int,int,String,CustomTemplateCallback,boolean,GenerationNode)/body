{
  TemplateToken templateToken=myTemplateToken;
  String templateKey=templateToken.getKey();
  if (myGenerator != null && StringUtil.containsChar(templateKey,'$') && callback.findApplicableTemplate(templateKey) == null) {
    String newTemplateKey=ZenCodingUtil.replaceMarkers(templateKey,numberInIteration,totalIterations,surroundedText);
    TemplateToken newTemplateToken=new TemplateToken(newTemplateKey,templateToken.getAttribute2Value());
    TemplateImpl template=myGenerator.createTemplateByKey(newTemplateKey);
    if (template != null) {
      newTemplateToken.setTemplate(template,callback);
      templateToken=newTemplateToken;
    }
  }
  GenerationNode node=new GenerationNode(templateToken,numberInIteration,totalIterations,surroundedText,insertSurroundedTextAtTheEnd,parent);
  return Arrays.asList(node);
}
