{
  myFileTypeManager=fileTypeManager;
  myProjectRootManager=projectRootManager;
  myProjectFileIndex=myProjectRootManager.getFileIndex();
  myManager=(PsiManagerImpl)psiManager;
  myFileManager=(FileManagerImpl)myManager.getFileManager();
  myConnection=psiManager.getProject().getMessageBus().connect(psiManager.getProject());
  startupManager.registerPreStartupActivity(new Runnable(){
    @Override public void run(){
      myConnection.subscribe(VirtualFileManager.VFS_CHANGES,new BulkVirtualFileListenerAdapter(PsiVFSListener.this));
      myConnection.subscribe(ProjectTopics.PROJECT_ROOTS,new MyModuleRootListener());
      myConnection.subscribe(FileTypeManager.TOPIC,new FileTypeListener(){
        public void beforeFileTypesChanged(        FileTypeEvent event){
        }
        public void fileTypesChanged(        FileTypeEvent e){
          myFileManager.processFileTypesChanged();
        }
      }
);
    }
  }
);
}
