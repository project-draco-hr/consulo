{
  if (javaReference instanceof PsiReferenceExpression) {
    final PsiReferenceExpression refExpr=(PsiReferenceExpression)javaReference;
    final PsiExpression qualifier=refExpr.getQualifierExpression();
    if (qualifier != null) {
      final Project project=qualifier.getProject();
      final PsiType type=GuessManager.getInstance(project).getDataFlowCastedExpressionType(qualifier);
      if (type != null) {
        processor.clear();
        final String newText="((" + type.getCanonicalText() + ") "+ qualifier.getText()+ ")."+ refExpr.getReferenceName();
        final PsiExpression newRef=JavaPsiFacade.getElementFactory(project).createExpressionFromText(newText,refExpr);
        ((PsiReferenceExpression)newRef).processVariants(processor);
        final LookupElement castItem=PsiTypeLookupItem.createLookupItem(type);
        for (        CompletionElement completionElement : processor.getResults()) {
          final LookupElement item=createLookupElement(completionElement,type);
          if (item != null) {
            set.add(highlightIfNeeded(type,castQualifier(project,item,castItem)));
          }
        }
        return type;
      }
    }
  }
  return null;
}
