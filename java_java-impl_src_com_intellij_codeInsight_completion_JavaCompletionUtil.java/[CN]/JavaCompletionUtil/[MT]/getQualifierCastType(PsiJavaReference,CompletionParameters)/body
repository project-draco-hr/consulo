{
  if (javaReference instanceof PsiReferenceExpression) {
    final PsiReferenceExpression refExpr=(PsiReferenceExpression)javaReference;
    final PsiExpression qualifier=refExpr.getQualifierExpression();
    if (qualifier != null) {
      final Project project=qualifier.getProject();
      PsiType type=null;
      final PairFunction<PsiExpression,CompletionParameters,PsiType> evaluator=refExpr.getContainingFile().getCopyableUserData(DYNAMIC_TYPE_EVALUATOR);
      if (evaluator != null) {
        type=evaluator.fun(qualifier,parameters);
      }
      if (type == null) {
        type=GuessManager.getInstance(project).getControlFlowExpressionType(qualifier);
      }
      return type;
    }
  }
  return null;
}
