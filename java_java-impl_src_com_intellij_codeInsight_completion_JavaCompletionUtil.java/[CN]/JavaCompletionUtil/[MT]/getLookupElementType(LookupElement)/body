{
  final TypedLookupItem typed=element.as(TypedLookupItem.class);
  if (typed != null) {
    return typed.getType();
  }
  final PsiType qualifierType=getPsiType(element.getObject());
  final LookupItem lookupItem=element.as(LookupItem.class);
  if (lookupItem != null) {
    final PsiSubstitutor substitutor=(PsiSubstitutor)lookupItem.getAttribute(LookupItem.SUBSTITUTOR);
    if (substitutor != null) {
      return substitutor.substitute(qualifierType);
    }
  }
  return qualifierType;
}
