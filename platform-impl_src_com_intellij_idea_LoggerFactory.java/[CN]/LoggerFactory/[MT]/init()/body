{
  try {
    System.setProperty("log4j.defaultInitOverride","true");
    String fileName=PathManager.getBinPath() + File.separator + "log.xml";
    File logXmlFile=new File(fileName);
    if (!logXmlFile.exists()) {
      throw new RuntimeException("log.xml file does not exist! Path: [" + fileName + "]");
    }
    String text=new String(FileUtil.loadFileText(logXmlFile));
    text=StringUtil.replace(text,SYSTEM_MACRO,StringUtil.replace(PathManager.getSystemPath(),"\\","\\\\"));
    text=StringUtil.replace(text,APPLICATION_MACRO,StringUtil.replace(PathManager.getHomePath(),"\\","\\\\"));
    text=StringUtil.replace(text,LOGDIR_MACRO,StringUtil.replace(LOG_DIR,"\\","\\\\"));
    if ("true".equals(System.getProperty("idea.test.test_mode"))) {
      text=commentTestModeLines(text);
    }
    File file=new File(new File(PathManager.getSystemPath()),LOG_DIR);
    file.mkdirs();
    DOMConfigurator domConfigurator=new DOMConfigurator();
    try {
      domConfigurator.doConfigure(new StringReader(text),LogManager.getLoggerRepository());
    }
 catch (    ClassCastException e) {
      System.out.println("log.xml content:\n" + text);
      throw e;
    }
    myInitialized=true;
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
}
