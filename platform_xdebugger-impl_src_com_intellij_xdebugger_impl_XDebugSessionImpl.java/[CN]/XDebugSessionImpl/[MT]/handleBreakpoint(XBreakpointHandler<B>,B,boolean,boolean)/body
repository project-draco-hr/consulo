{
  if (register) {
    boolean active=ApplicationManager.getApplication().runReadAction(new Computable<Boolean>(){
      @Override public Boolean compute(){
        return isBreakpointActive(b);
      }
    }
);
    if (active) {
synchronized (myRegisteredBreakpoints) {
        myRegisteredBreakpoints.put(b,new CustomizedBreakpointPresentation());
      }
      handler.registerBreakpoint(b);
    }
  }
 else {
    boolean removed;
synchronized (myRegisteredBreakpoints) {
      removed=myRegisteredBreakpoints.remove(b) != null;
    }
    if (removed) {
      handler.unregisterBreakpoint(b,temporary);
    }
  }
}
