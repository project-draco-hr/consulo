{
  Project project=PlatformDataKeys.PROJECT.getData(dc);
  ShelvedChangeList[] changeLists=ShelvedChangesViewManager.SHELVED_CHANGELIST_KEY.getData(dc);
  if (changeLists == null) {
    changeLists=ShelvedChangesViewManager.SHELVED_RECYCLED_CHANGELIST_KEY.getData(dc);
  }
  List<ShelvedChange> shelvedChanges=ShelvedChangesViewManager.SHELVED_CHANGE_KEY.getData(dc);
  if (changeLists == null)   return;
  Change toSelect=null;
  final List<ShelvedChange> changesFromFirstList=changeLists[0].getChanges();
  if (shelvedChanges != null) {
    for (    final ShelvedChange fromList : changesFromFirstList) {
      for (      ShelvedChange shelvedChange : shelvedChanges) {
        if (fromList.equals(shelvedChange)) {
          toSelect=fromList.getChange(project);
          break;
        }
      }
      if (toSelect != null)       break;
    }
  }
  final Change[] changes=new Change[changesFromFirstList.size()];
  for (int i=0; i < changesFromFirstList.size(); i++) {
    final ShelvedChange shelvedChange=changesFromFirstList.get(i);
    changes[i]=shelvedChange.getChange(project);
  }
  Arrays.sort(changes,ChangesComparator.getInstance());
  int toSelectIdx=0;
  for (int i=0; i < changes.length; i++) {
    if (toSelect == changes[i]) {
      toSelectIdx=i;
    }
  }
  ShowDiffAction.showDiffForChange(changes,toSelectIdx,project);
}
