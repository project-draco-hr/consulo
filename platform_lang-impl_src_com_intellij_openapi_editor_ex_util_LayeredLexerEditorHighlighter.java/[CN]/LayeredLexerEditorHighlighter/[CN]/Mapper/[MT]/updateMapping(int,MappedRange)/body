{
  CharSequence tokenText=getTokenText(tokenIndex);
  final int start=oldMapping.range.getStartOffset();
  final int end=oldMapping.range.getEndOffset();
  if (Comparing.equal(doc.getCharsSequence().subSequence(start,end),tokenText))   return;
  doc.replaceString(start,end,tokenText);
  final int newEnd=start + tokenText.length();
  if (oldMapping.range.getStartOffset() != start || oldMapping.range.getEndOffset() != newEnd) {
    oldMapping.range.dispose();
    oldMapping.range=doc.createRangeMarker(start,newEnd);
  }
}
