{
  if (myCompiled) {
    myHighlights=Collections.emptyList();
    return;
  }
  List<HighlightInfo> highlights=new ArrayList<HighlightInfo>();
  final FileViewProvider viewProvider=myFile.getViewProvider();
  final Set<Language> relevantLanguages=viewProvider.getRelevantLanguages();
  for (  Language language : relevantLanguages) {
    PsiElement psiRoot=viewProvider.getPsi(language);
    if (!HighlightUtil.isRootHighlighted(psiRoot))     continue;
    List<PsiElement> elements=CodeInsightUtil.getElementsInRange(psiRoot,myStartOffset,myEndOffset);
    collectHighlights(elements,highlights);
  }
  PsiNamedElement[] unusedDcls=myRefCountHolder.getUnusedDcls();
  for (  PsiNamedElement unusedDcl : unusedDcls) {
    String dclType=UsageViewUtil.capitalize(UsageViewUtil.getType(unusedDcl));
    if (dclType == null || dclType.length() == 0)     dclType=LangBundle.message("java.terms.symbol");
    String message=MessageFormat.format(SYMBOL_IS_NOT_USED,dclType,unusedDcl.getName());
    HighlightInfo highlightInfo=createUnusedSymbolInfo(unusedDcl.getNavigationElement(),message);
    highlights.add(highlightInfo);
  }
  myHighlights=highlights;
}
