{
  if (updatedFiles.contains(n.getFile()))   return;
  p.checkCanceled();
  p.setText(ProjectBundle.message("maven.reading",n.getPath()));
  List<Node> oldModules=n.mySubProjects;
  List<Node> newModules=new ArrayList<Node>();
  if (!isNew)   myProjectIdToFileMapping.remove(n.getProjectId());
  n.read(reader,myProfiles);
  myProjectIdToFileMapping.put(n.getProjectId(),n.getFile());
  if (isNew) {
    fireAdded(n);
  }
 else {
    fireUpdated(n);
  }
  for (  VirtualFile each : n.getExistingModuleFiles()) {
    Node child=findProject(each);
    boolean isNewChild=child == null;
    if (isNewChild) {
      child=new Node(each,null);
    }
    doUpdate(child,reader,isNewChild,updatedFiles,p);
    newModules.add(child);
    myRootProjects.remove(child);
  }
  oldModules.removeAll(newModules);
  for (  Node each : oldModules) {
    doRemove(each);
  }
  n.mySubProjects=newModules;
}
