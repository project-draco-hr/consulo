{
  MavenEmbedder embedder=MavenEmbedderFactory.createEmbedderForResolve(coreSettings,myProjectIdToFileMapping);
  try {
    List<Node> projects=getProjects();
    List<Artifact> allArtifacts=new ArrayList<Artifact>();
    MavenProjectReader projectReader=new MavenProjectReader(embedder);
    for (    Node each : projects) {
      p.checkCanceled();
      p.setText(ProjectBundle.message("maven.resolving.pom",FileUtil.toSystemDependentName(each.getPath())));
      p.setText2("");
      each.resolve(projectReader);
    }
    for (    Node each : projects) {
      p.checkCanceled();
      p.setText(ProjectBundle.message("maven.generating.sources.pom",FileUtil.toSystemDependentName(each.getPath())));
      p.setText2("");
      each.generateSources(projectReader);
    }
    refreshResolvedArtifacts(allArtifacts);
    MavenArtifactDownloader d=new MavenArtifactDownloader(artifactSettings,embedder,p);
    d.download(project,projects,false);
  }
  finally {
    MavenEmbedderFactory.releaseEmbedder(embedder);
  }
}
