{
  if (parameters.getCompletionType() != CompletionType.SMART)   return;
  Collection<?> variants=ApplicationManager.getApplication().runReadAction(new Computable<Collection<?>>(){
    @Override public Collection<?> compute(){
      return getVariants(parameters);
    }
  }
);
  for (  Object each : variants) {
    LookupElement e;
    if (each instanceof LookupElement) {
      e=(LookupElement)each;
    }
 else     if (each instanceof String) {
      e=LookupElementBuilder.create((String)each);
    }
 else     if (each instanceof PsiNamedElement) {
      e=LookupElementBuilder.create((PsiNamedElement)each);
    }
 else {
      e=LookupElementBuilder.create(each,String.valueOf(each));
    }
    result.addElement(e);
  }
}
