{
  int line=myEditor.yPositionToLogicalLine((int)p.getY());
  if (line >= myEditor.getDocument().getLineCount())   return -1;
  int startOffset=myEditor.getDocument().getLineStartOffset(line);
  final FoldRegion region=myEditor.getFoldingModel().getCollapsedRegionAtOffset(startOffset);
  if (region != null) {
    line=myEditor.getDocument().getLineNumber(region.getEndOffset());
    if (line >= myEditor.getDocument().getLineCount())     return -1;
  }
  return line;
}
