{
  if (!foldRange.isValid()) {
    return;
  }
  int startOffset=foldRange.getStartOffset();
  final int endOffset=getEndOffset(foldRange);
  if (!isFoldingPossible(startOffset,endOffset)) {
    return;
  }
  int foldStart=offsetToVisualLine(startOffset);
  int y=myEditor.visibleLineToY(foldStart) + myEditor.getLineHeight() - myEditor.getDescent() - width;
  int height=width + 2;
  final FoldingGroup group=foldRange.getGroup();
  final boolean drawTop=group == null || ((FoldingModelImpl)myEditor.getFoldingModel()).getFirstRegion(group,foldRange) == foldRange;
  if (!foldRange.isExpanded()) {
    if (y <= clip.y + clip.height && y + height >= clip.y) {
      if (drawTop) {
        drawSquareWithPlus(g,anchorX,y,width,active,paintBackground);
      }
    }
  }
 else {
    int foldEnd=offsetToVisualLine(endOffset);
    int endY=myEditor.visibleLineToY(foldEnd) + myEditor.getLineHeight() - myEditor.getDescent();
    if (y <= clip.y + clip.height && y + height >= clip.y) {
      if (drawTop) {
        drawDirectedBox(g,anchorX,y,width,height,width - 2,active,paintBackground);
      }
    }
    if (endY - height <= clip.y + clip.height && endY >= clip.y) {
      drawDirectedBox(g,anchorX,endY,width,-height,-width + 2,active,paintBackground);
    }
  }
}
