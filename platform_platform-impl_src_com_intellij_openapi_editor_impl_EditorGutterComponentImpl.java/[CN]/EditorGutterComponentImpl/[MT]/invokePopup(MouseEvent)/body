{
  final ActionManager actionManager=ActionManager.getInstance();
  if (myEditor.getMouseEventArea(e) == EditorMouseEventArea.ANNOTATIONS_AREA) {
    DefaultActionGroup actionGroup=new DefaultActionGroup(EditorBundle.message("editor.annotations.action.group.name"),true);
    actionGroup.add(new CloseAnnotationsAction());
    final List<AnAction> addActions=new ArrayList<AnAction>();
    final Point p=e.getPoint();
    int line=myEditor.yPositionToLogicalLine((int)p.getY());
    if (line >= myEditor.getDocument().getLineCount())     return;
    for (    TextAnnotationGutterProvider gutterProvider : myTextAnnotationGutters) {
      final List<AnAction> list=gutterProvider.getPopupActions(line,myEditor);
      if (list != null) {
        for (        AnAction action : list) {
          if (!addActions.contains(action)) {
            addActions.add(action);
          }
        }
      }
    }
    for (    AnAction addAction : addActions) {
      actionGroup.add(addAction);
    }
    JPopupMenu menu=actionManager.createActionPopupMenu("",actionGroup).getComponent();
    menu.show(this,e.getX(),e.getY());
  }
 else {
    GutterIconRenderer renderer=getGutterRenderer(e);
    if (renderer != null) {
      ActionGroup actionGroup=renderer.getPopupMenuActions();
      if (actionGroup != null) {
        ActionPopupMenu popupMenu=actionManager.createActionPopupMenu(ActionPlaces.UNKNOWN,actionGroup);
        popupMenu.getComponent().show(this,e.getX(),e.getY());
        e.consume();
      }
    }
 else {
      if (myShowDefaultGutterPopup) {
        ActionGroup group=(ActionGroup)CustomActionsSchema.getInstance().getCorrectedAction(IdeActions.GROUP_EDITOR_GUTTER);
        ActionPopupMenu popupMenu=actionManager.createActionPopupMenu(ActionPlaces.UNKNOWN,group);
        popupMenu.getComponent().show(this,e.getX(),e.getY());
      }
      e.consume();
    }
  }
}
