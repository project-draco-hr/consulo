{
  final GlobalInspectionContextImpl context=getContext();
  Set<String> packages=packageContents.keySet();
  for (  String p : packages) {
    InspectionPackageNode pNode=new InspectionPackageNode(p);
    Set<RefElement> elements=packageContents.get(p);
    for (    RefElement refElement : elements) {
      if (context != null && context.getUIOptions().SHOW_ONLY_DIFF && getElementStatus(refElement) == FileStatus.NOT_CHANGED)       continue;
      if (packageContents != myPackageContents) {
        final Set<RefElement> currentElements=myPackageContents.get(p);
        if (currentElements != null) {
          Set<RefEntity> currentEntities=new HashSet<RefEntity>(currentElements);
          if (contains(refElement,currentEntities))           continue;
        }
      }
      addNodeToParent(refElement,pNode);
    }
    if (pNode.getChildCount() > 0)     content.add(pNode);
  }
}
