{
  if (!CodeInsightUtil.prepareFileForWrite(myMethod.getContainingFile()))   return;
  PsiJavaCodeReferenceElement[] referenceElements=myMethod.getThrowsList().getReferenceElements();
  boolean alreadyThrows=false;
  try {
    for (    PsiJavaCodeReferenceElement referenceElement : referenceElements) {
      if (referenceElement.getCanonicalText().equals(myThrowsClassType.getCanonicalText())) {
        alreadyThrows=true;
        if (!myShouldThrow) {
          referenceElement.delete();
          break;
        }
      }
    }
    if (myShouldThrow && !alreadyThrows) {
      myMethod.getThrowsList().add(myMethod.getManager().getElementFactory().createReferenceElementByType(myThrowsClassType));
    }
    QuickFixAction.markDocumentForUndo(file);
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
}
