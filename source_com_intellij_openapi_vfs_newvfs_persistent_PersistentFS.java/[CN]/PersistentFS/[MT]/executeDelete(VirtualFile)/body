{
  if (!file.exists()) {
    LOG.error("Deleting a file, which does not exist: " + file.getPath());
  }
 else {
    final int id=getFileId(file);
    final VirtualFile parent=file.getParent();
    final int parentId=parent != null ? getFileId(parent) : 0;
    myRecords.deleteRecordRecursively(id);
    if (parentId != 0) {
      removeIdFromParentList(parentId,id);
      ((VirtualDirectoryImpl)file.getParent()).removeChild(file);
    }
 else {
synchronized (LOCK) {
        myRoots.remove(file.getUrl());
        try {
          myRecords.deleteRootRecord(id);
        }
 catch (        IOException e) {
          throw new RuntimeException(e);
        }
      }
    }
    invalidateSubtree(file);
  }
}
