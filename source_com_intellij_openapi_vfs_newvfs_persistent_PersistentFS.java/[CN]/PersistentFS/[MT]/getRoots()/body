{
  List<NewVirtualFile> roots;
synchronized (LOCK) {
    roots=new ArrayList<NewVirtualFile>(myRoots.values());
  }
  Collections.sort(roots,new Comparator<NewVirtualFile>(){
    public int compare(    final NewVirtualFile f1,    final NewVirtualFile f2){
      final NewVirtualFileSystem fs1=f1.getFileSystem();
      final NewVirtualFileSystem fs2=f2.getFileSystem();
      return fs1.getRank() - fs2.getRank();
    }
  }
);
  return roots.toArray(new VirtualFile[roots.size()]);
}
