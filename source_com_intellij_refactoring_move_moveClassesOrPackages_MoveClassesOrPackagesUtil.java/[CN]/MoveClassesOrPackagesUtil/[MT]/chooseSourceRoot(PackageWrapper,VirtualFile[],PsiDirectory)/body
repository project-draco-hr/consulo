{
  Project project=targetPackage.getManager().getProject();
  List<PsiDirectory> targetDirectories=new ArrayList<PsiDirectory>();
  Map<PsiDirectory,String> relativePathsToCreate=new HashMap<PsiDirectory,String>();
  buildDirectoryList(targetPackage,contentSourceRoots,targetDirectories,relativePathsToCreate);
  final DirectoryChooser chooser=new DirectoryChooser(project,new DirectoryChooserModuleTreeView(project));
  chooser.setTitle("Choose Destination Directory");
  chooser.fillList(targetDirectories.toArray(new PsiDirectory[targetDirectories.size()]),initialDirectory,project,relativePathsToCreate);
  chooser.show();
  if (!chooser.isOK())   return null;
  final PsiDirectory selectedDirectory=chooser.getSelectedDirectory();
  final VirtualFile virt=selectedDirectory.getVirtualFile();
  final VirtualFile sourceRootForFile=ProjectRootManager.getInstance(project).getFileIndex().getSourceRootForFile(virt);
  LOG.assertTrue(sourceRootForFile != null);
  return sourceRootForFile;
}
