{
  VirtualFile file=content.getVirtualFile();
  boolean isValid=file.isValid() && !file.isDirectory();
  while (true) {
    Pair<CacheUpdater,Collection<VirtualFile>> pair=getPair(file);
    if (pair == null)     return;
    CacheUpdater eachUpdater=pair.getFirst();
    Collection<VirtualFile> eachFiles=pair.getSecond();
    try {
      if (isValid && !Boolean.TRUE.equals(file.getUserData(FAILED_TO_INDEX))) {
        eachUpdater.processFile(content);
      }
    }
 catch (    ProcessCanceledException e) {
      throw e;
    }
catch (    Throwable e) {
      LOG.error("Error while indexing " + file.getPresentableUrl() + "\n"+ "To reindex this file IDEA has to be restarted",e);
      file.putUserData(FAILED_TO_INDEX,Boolean.TRUE);
    }
    removeFile(file,eachUpdater,eachFiles);
  }
}
