{
  PsiFile fileCopy;
  VirtualFile vFile=psiFile.getVirtualFile();
  if (psiFile instanceof ClsFileImpl) {
    ClsFileImpl implFile=(ClsFileImpl)psiFile;
    if (implFile.isContentsLoaded()) {
      fileCopy=implFile;
    }
 else {
      fileCopy=new ClsFileImpl((PsiManagerImpl)psiFile.getManager(),vFile);
      ((ClsFileImpl)fileCopy).setRepositoryId(-1);
    }
  }
 else   if (psiFile instanceof PsiFileImpl) {
    PsiFileImpl implFile=(PsiFileImpl)psiFile;
    if (implFile.isContentsLoaded()) {
      fileCopy=implFile;
    }
 else {
      CharSequence text;
      if (content == null) {
        Document document=FileDocumentManager.getInstance().getDocument(vFile);
        text=document.getCharsSequence();
      }
 else {
        try {
          text=LoadTextUtil.loadText(content.getBytes(),new String[1]);
        }
 catch (        IOException e) {
          text=new CharArrayCharSequence(new char[0]);
        }
      }
      FileType fileType=psiFile.getFileType();
      PsiElementFactoryImpl factory=(PsiElementFactoryImpl)psiFile.getManager().getElementFactory();
      char[] chars=CharArrayUtil.fromSequence(text);
      fileCopy=factory.createDummyFileFromText(fileType,chars,0,text.length());
    }
    fileCopy.setModificationStamp(psiFile.getModificationStamp());
  }
 else {
    fileCopy=psiFile;
  }
  return fileCopy;
}
