{
  final FileManagerContext context=new FileManagerContext(compileContext,outConsumer,outputSink);
  for (  File outputDir : outputDirToRoots.keySet()) {
    outputDir.mkdirs();
  }
  final JavacFileManager fileManager=new JavacFileManager(context);
  fileManager.handleOption("-bootclasspath",Collections.singleton("").iterator());
  fileManager.handleOption("-extdirs",Collections.singleton("").iterator());
  fileManager.setOutputDirectories(outputDirToRoots);
  if (!classpath.isEmpty()) {
    if (!fileManager.setLocation(StandardLocation.CLASS_PATH,classpath)) {
      return false;
    }
  }
  if (!platformClasspath.isEmpty()) {
    if (!fileManager.setLocation(StandardLocation.PLATFORM_CLASS_PATH,platformClasspath)) {
      return false;
    }
  }
  if (!sourcePath.isEmpty()) {
    if (!fileManager.setLocation(StandardLocation.SOURCE_PATH,sourcePath)) {
      return false;
    }
  }
  final LineOutputWriter out=new LineOutputWriter(){
    protected void lineAvailable(    String line){
      outConsumer.outputLineAvailable(line);
    }
  }
;
  try {
    final JavaCompiler.CompilationTask task=myCompiler.getTask(out,fileManager,outConsumer,filterOptionList(options),null,fileManager.toJavaFileObjects(sources));
    return task.call();
  }
  finally {
    context.ensurePendingTasksCompleted();
    fileManager.cleanupResources();
  }
}
