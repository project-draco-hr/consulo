{
  ASTNode child=myNode.getFirstChildNode();
  ASTNode prevChild=null;
  int state=BEFORE_FIRST;
  while (child != null) {
    if (!FormatterUtil.containsWhiteSpacesOnly(child) && child.getTextLength() > 0) {
      final Indent indent=calcIndent(child,state);
      myIndentsBefore.add(calcIndentBefore(child,state));
      state=calcNewState(child,state);
      if (prevChild != null && myNode.getElementType() == JavaElementType.METHOD && ElementType.JAVA_COMMENT_BIT_SET.contains(prevChild.getElementType()) && !ElementType.JAVA_COMMENT_BIT_SET.contains(child.getElementType())) {
        prevChild=child;
        child=composeCodeBlock(result,child,Indent.getNoneIndent(),0,null);
      }
 else {
        prevChild=child;
        child=processChild(result,child,childAlignment,childWrap,indent);
      }
      for (int i=myIndentsBefore.size(); i < result.size(); i++) {
        myIndentsBefore.add(Indent.getContinuationIndent(myIndentSettings.USE_RELATIVE_INDENTS));
      }
    }
    if (child != null) {
      child=child.getTreeNext();
    }
  }
}
