{
  int numParams=ref.getTypeParameters().length;
  if (numParams == 0)   return;
  final PsiElementFactory factory=JavaPsiFacade.getInstance(ref.getProject()).getElementFactory();
  final Set<String> typeParamNames=new HashSet<String>();
  for (  PsiType type : ref.getTypeParameters()) {
    final PsiClass psiClass=PsiUtil.resolveClassInType(type);
    if (psiClass instanceof PsiTypeParameter) {
      typeParamNames.add(psiClass.getName());
    }
  }
  int idx=0;
  for (  PsiType type : ref.getTypeParameters()) {
    final PsiClass psiClass=PsiUtil.resolveClassInType(type);
    if (psiClass instanceof PsiTypeParameter) {
      targetClass.getTypeParameterList().add(factory.createTypeParameterFromText(psiClass.getName(),null));
    }
 else {
      while (true) {
        final String paramName=idx > 0 ? "T" + idx : "T";
        if (!typeParamNames.contains(paramName)) {
          targetClass.getTypeParameterList().add(factory.createTypeParameterFromText(paramName,null));
          break;
        }
        idx++;
      }
    }
  }
}
