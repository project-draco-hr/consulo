{
  if (entry == null || entry.getRevision() == null || entry.isAddedFile() || entry.isRemoved()) {
    throw new IllegalArgumentException("File does not have an Entry or Entry is invalid!");
  }
  final File file=cvsFileSystem.getAdminFileSystem().getFile(fileObject);
  final File baserevFile=new File(file.getParentFile(),"CVS/Baserev");
  final File backupFile=new File(baserevFile.getAbsolutePath() + '~');
  BufferedReader reader=null;
  BufferedWriter writer=null;
  boolean append=true;
  boolean writeFailed=true;
  final String entryStart='B' + file.getName() + '/';
  try {
    writer=new BufferedWriter(new FileWriter(backupFile));
    writeFailed=false;
    reader=new BufferedReader(new FileReader(baserevFile));
    for (String line=reader.readLine(); line != null; line=reader.readLine()) {
      if (line.startsWith(entryStart)) {
        append=false;
      }
      writeFailed=true;
      writer.write(line);
      writer.newLine();
      writeFailed=false;
    }
  }
 catch (  IOException ex) {
    if (writeFailed) {
      throw ex;
    }
  }
 finally {
    if (reader != null) {
      try {
        reader.close();
      }
 catch (      IOException ex) {
      }
    }
    if (writer != null) {
      if (append && !writeFailed) {
        writer.write(entryStart + entry.getRevision() + '/');
        writer.newLine();
      }
      try {
        writer.close();
      }
 catch (      IOException ex) {
      }
    }
  }
  baserevFile.delete();
  FileUtil.rename(backupFile,baserevFile);
}
