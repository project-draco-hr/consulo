{
  myLoadCounter=0;
  myProject=project;
  myVcsManager=vcsManager;
  myStatusProvider=statusProvider;
  myApplication=application;
  myFileEditorManager=fileEditorManager;
  myLineStatusTrackers=new HashMap<Document,TrackerData>();
  myPartner=new QueueProcessorRemovePartner<Document,BaseRevisionLoader>(myProject,new Consumer<BaseRevisionLoader>(){
    @Override public void consume(    BaseRevisionLoader baseRevisionLoader){
      baseRevisionLoader.run();
    }
  }
);
  MessageBusConnection busConnection=project.getMessageBus().connect();
  busConnection.subscribe(DocumentBulkUpdateListener.TOPIC,new DocumentBulkUpdateListener.Adapter(){
    @Override public void updateStarted(    @NotNull final Document doc){
      final LineStatusTracker tracker=getLineStatusTracker(doc);
      if (tracker != null)       tracker.startBulkUpdate();
    }
    @Override public void updateFinished(    @NotNull final Document doc){
      final LineStatusTracker tracker=getLineStatusTracker(doc);
      if (tracker != null)       tracker.finishBulkUpdate();
    }
  }
);
  busConnection.subscribe(LineStatusTrackerSettingListener.TOPIC,new LineStatusTrackerSettingListener(){
    @Override public void settingsUpdated(){
synchronized (myLock) {
        LineStatusTracker.Mode mode=getMode();
        for (        TrackerData data : myLineStatusTrackers.values()) {
          data.tracker.setMode(mode);
        }
      }
    }
  }
);
  myDisposable=new Disposable(){
    @Override public void dispose(){
synchronized (myLock) {
        for (        final TrackerData data : myLineStatusTrackers.values()) {
          data.tracker.release();
        }
        myLineStatusTrackers.clear();
        myPartner.clear();
      }
    }
  }
;
  Disposer.register(myProject,myDisposable);
}
