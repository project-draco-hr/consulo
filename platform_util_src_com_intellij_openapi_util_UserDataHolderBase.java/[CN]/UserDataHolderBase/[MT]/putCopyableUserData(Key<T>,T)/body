{
  while (true) {
    KeyFMap map=myUserMap;
    KeyFMap copyableMap=map.get(COPYABLE_USER_MAP_KEY);
    if (copyableMap == null) {
      copyableMap=KeyFMap.EMPTY_MAP;
    }
    KeyFMap newCopyableMap=value == null ? copyableMap.minus(key) : copyableMap.plus(key,value);
    KeyFMap newMap=newCopyableMap.isEmpty() ? map.minus(COPYABLE_USER_MAP_KEY) : map.plus(COPYABLE_USER_MAP_KEY,newCopyableMap);
    if (newMap == map || updater.compareAndSet(this,map,newMap)) {
      return;
    }
  }
}
