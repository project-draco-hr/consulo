{
  PsiDirectory psiDir=myVFileToPsiDirMap.get(vFile);
  if (psiDir != null)   return psiDir;
  if (Registry.is("ide.hide.excluded.files")) {
    if (myFileIndex.isExcludedFile(vFile))     return null;
  }
 else {
    if (myFileIndex.isUnderIgnored(vFile))     return null;
  }
  VirtualFile parent=vFile.getParent();
  if (parent != null) {
    findDirectoryImpl(parent);
  }
  psiDir=new PsiDirectoryImpl(myManager,vFile);
  return ConcurrencyUtil.cacheOrGet(myVFileToPsiDirMap,vFile,psiDir);
}
