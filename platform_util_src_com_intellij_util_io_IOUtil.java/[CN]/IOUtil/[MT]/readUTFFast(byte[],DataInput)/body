{
  int len=0xFF & (int)storage.readByte();
  if (len == 0xFF) {
    String result=storage.readUTF();
    if (LONGER_THAN_64K_MARKER.equals(result)) {
      return readString(storage);
    }
    return result;
  }
  if (len == 0)   return "";
  storage.readFully(buffer,0,len);
  SoftReference<char[]> reference=spareBufferLocal.get();
  char[] chars=reference != null ? reference.get() : null;
  if (chars == null) {
    chars=new char[STRING_LENGTH_THRESHOLD];
    spareBufferLocal.set(new SoftReference<char[]>(chars));
  }
  for (int i=0; i < len; ++i)   chars[i]=(char)(buffer[i] & 0xFF);
  return new String(chars,0,len);
}
