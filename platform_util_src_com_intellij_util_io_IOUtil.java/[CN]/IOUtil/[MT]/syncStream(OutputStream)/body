{
  stream.flush();
  try {
    Field outField=FilterOutputStream.class.getDeclaredField("out");
    outField.setAccessible(true);
    while (stream instanceof FilterOutputStream) {
      Object o=outField.get(stream);
      if (o instanceof OutputStream) {
        stream=(OutputStream)o;
      }
 else {
        break;
      }
    }
    if (stream instanceof FileOutputStream) {
      ((FileOutputStream)stream).getFD().sync();
    }
  }
 catch (  NoSuchFieldException e) {
    throw new RuntimeException(e);
  }
catch (  IllegalAccessException e) {
    throw new RuntimeException(e);
  }
}
