{
  final String canonicalFilePath=getCanonicalFileName(file);
  if (!canonicalFilePath.startsWith(canonicalRootDirectoryName)) {
    throw new OutOfFileSystemException(canonicalFilePath,canonicalRootDirectoryName);
  }
  final String filePath=file.getAbsolutePath();
  int beginIndex=canonicalRootDirectoryName.length();
  if (filePath.length() > beginIndex) {
    beginIndex++;
  }
  return '/' + filePath.substring(beginIndex).replace('\\','/');
}
