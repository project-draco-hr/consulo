{
  String mark=String.valueOf(new Random().nextInt());
  File script;
  if (SystemInfo.isWindows) {
    script=ExecUtil.createTempExecutableScript("path with spaces 'and quotes' ?? ???????????????? ",".cmd","@echo " + mark + "\n");
  }
 else {
    script=ExecUtil.createTempExecutableScript("path with spaces 'and quotes' ?? ???????????????? ",".sh","#!/bin/sh\n" + "echo " + mark + "\n");
  }
  try {
    GeneralCommandLine commandLine=new GeneralCommandLine(script.getPath());
    String output=execAndGetOutput(commandLine,null);
    assertEquals(mark + "\n",StringUtil.convertLineSeparators(output));
  }
  finally {
    FileUtil.delete(script);
  }
}
