{
  Rectangle nodeBounds=new Rectangle(event.getPoint());
  TreePath pathForLocation=getPathForLocation(event.getX(),event.getY());
  if (pathForLocation != null) {
    nodeBounds=getPathBounds(pathForLocation);
  }
  Rectangle contentRect=getVisibleRect();
  int x, y;
  int vgap=nodeBounds.height;
  int height;
  int width=Math.min(tipContentSize.width,contentRect.width);
  if (event.getY() > contentRect.y + contentRect.height / 2) {
    y=Math.max(contentRect.y,nodeBounds.y - tipContentSize.height - vgap);
    height=Math.min(tipContentSize.height,nodeBounds.y - contentRect.y - vgap);
  }
 else {
    y=nodeBounds.y + nodeBounds.height + vgap;
    height=Math.min(tipContentSize.height,contentRect.height - y);
  }
  final Dimension tipSize=new Dimension(width,height);
  x=event.getX() - width / 2;
  if (x < contentRect.x) {
    x=contentRect.x;
  }
  if (x + width > contentRect.x + contentRect.width) {
    x=contentRect.x + contentRect.width - width;
  }
  return new Rectangle(new Point(x,y),tipSize);
}
