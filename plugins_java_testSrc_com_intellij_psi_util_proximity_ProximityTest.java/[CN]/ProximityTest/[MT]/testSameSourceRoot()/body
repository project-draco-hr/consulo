{
  final TempDirTestFixture root1=IdeaTestFixtureFactory.getFixtureFactory().createTempDirTestFixture();
  final TempDirTestFixture root2=IdeaTestFixtureFactory.getFixtureFactory().createTempDirTestFixture();
  root1.setUp();
  root2.setUp();
  try {
    new WriteCommandAction(getProject()){
      @Override protected void run(      Result result) throws Throwable {
        PsiTestUtil.addSourceContentToRoots(myModule,root1.getFile(""));
        PsiTestUtil.addSourceContentToRoots(myModule,root2.getFile(""));
      }
    }
.execute();
    final VirtualFile file1=root1.createFile("buy.txt","");
    final VirtualFile file2=root2.createFile("buy.txt","");
    final VirtualFile ctx=root2.createFile("ctx.txt","");
    final PsiProximityComparator comparator=new PsiProximityComparator(getPsiManager().findFile(ctx));
    assertTrue(comparator.compare(getPsiManager().findFile(file1),getPsiManager().findFile(file2)) > 0);
    assertTrue(comparator.compare(getPsiManager().findFile(file2),getPsiManager().findFile(file1)) < 0);
  }
  finally {
    root1.tearDown();
    root2.tearDown();
  }
}
