{
  final Set<HgChange> changes=new HashSet<HgChange>();
  HgChange previous=null;
  if (result == null) {
    return changes;
  }
  for (  String line : result.getOutputLines()) {
    if (StringUtils.isBlank(line) || line.length() < ITEM_COUNT) {
      LOG.warn("Unexpected line in status '" + line + '\'');
      continue;
    }
    char statusChar=line.charAt(STATUS_INDEX);
    HgFileStatusEnum status=HgFileStatusEnum.parse(statusChar);
    if (status == null) {
      LOG.error("Unknown status [" + statusChar + "] in line ["+ line+ "]");
      continue;
    }
    File ioFile=new File(repo.getPath(),line.substring(2));
    if (HgFileStatusEnum.COPY == status && previous != null && previous.getStatus() == HgFileStatusEnum.ADDED) {
      previous.setStatus(HgFileStatusEnum.COPY);
      previous.setBeforeFile(new HgFile(repo,ioFile));
      previous=null;
    }
 else {
      previous=new HgChange(new HgFile(repo,ioFile),status);
      changes.add(previous);
    }
  }
  return changes;
}
