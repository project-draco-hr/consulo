{
  PatchInfo patch=newVersion.findPatchFor(ApplicationInfo.getInstance().getBuildNumber().trim());
  if (patch == null)   throw new IOException("No patch is available for current version");
  String fileName="idea_" + patch.getFromBuild() + "_"+ patch.getToBuild()+ ".patch";
  URLConnection connection=null;
  InputStream in=null;
  OutputStream out=null;
  try {
    File file=FileUtil.createTempFile(fileName,null);
    connection=new URL(new URL(getPatchesUrl()),fileName).openConnection();
    in=UrlConnectionUtil.getConnectionInputStreamWithException(connection,i);
    out=new BufferedOutputStream(new FileOutputStream(file,false));
    StreamUtil.copyStreamContent(in,out);
  }
  finally {
    if (out != null)     out.close();
    if (in != null)     in.close();
    if (connection instanceof HttpURLConnection)     ((HttpURLConnection)connection).disconnect();
  }
  return true;
}
