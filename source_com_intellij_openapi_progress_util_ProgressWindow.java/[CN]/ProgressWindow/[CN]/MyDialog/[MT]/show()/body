{
  if (ApplicationManager.getApplication().isHeadlessEnvironment())   return;
  if (myPopup != null) {
    myPopup.cancel();
  }
  myPopup=JBPopupFactory.getInstance().createComponentPopupBuilder(myPanel,myCancelButton).setForceHeavyweight(true).setRequestFocus(true).setCancelCallback(new Computable<Boolean>(){
    public Boolean compute(){
      return isCanceled() || !isRunning() || ProgressWindow.this.myBackgrounded;
    }
  }
).createPopup();
  myPopup.showInCenterOf(myParentWindow);
  StackingPopupDispatcher.onPopupHidden(myPopup);
  SwingUtilities.invokeLater(new Runnable(){
    public void run(){
      myCancelButton.requestFocus();
    }
  }
);
}
