{
  final JavaParameters params=new JavaParameters();
  params.setupEnvs(getEnvs(),PASS_PARENT_ENVS);
  final int classPathType=JavaParametersUtil.getClasspathType(getConfigurationModule(),MAIN_CLASS_NAME,false);
  JavaParametersUtil.configureModule(getConfigurationModule(),params,classPathType,ALTERNATIVE_JRE_PATH_ENABLED ? ALTERNATIVE_JRE_PATH : null);
  JavaParametersUtil.configureConfiguration(params,ApplicationConfiguration.this);
  params.setMainClass(MAIN_CLASS_NAME);
  for (  RunConfigurationExtension ext : Extensions.getExtensions(RunConfigurationExtension.EP_NAME)) {
    if (ext instanceof JavaRunConfigurationExtension) {
      ((JavaRunConfigurationExtension)ext).updateJavaParameters(ApplicationConfiguration.this,params);
    }
  }
  if ((!(getRunnerSettings().getData() instanceof DebuggingRunnerData) || getCoverageRunner() instanceof IDEACoverageRunner) && isCoverageEnabled()) {
    final CoverageDataManager coverageDataManager=CoverageDataManager.getInstance(getProject());
    myCurrentCoverageSuite=coverageDataManager.addCoverageSuite(ApplicationConfiguration.this);
    appendCoverageArgument(params);
  }
  return params;
}
