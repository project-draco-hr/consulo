{
  if (isReferenceTo(element))   return this;
  if (element instanceof PsiClass) {
    final String newName=((PsiClass)element).getName();
    handleElementRename(newName);
    if (isReferenceTo(element))     return this;
    final GroovyFileBase file=(GroovyFileBase)getContainingFile();
    final PsiClass clazz=(PsiClass)element;
    final String qName=clazz.getQualifiedName();
    if (qName != null) {
      final GrImportStatement added=file.addImportForClass(clazz);
      if (!bindsCorrectly(element)) {
        file.removeImport(added);
        final GrCodeReferenceElement qualifiedRef=GroovyPsiElementFactory.getInstance(getProject()).createTypeOrPackageReference(qName);
        getNode().getTreeParent().replaceChild(getNode(),qualifiedRef.getNode());
        return qualifiedRef;
      }
      return this;
    }
  }
 else   if (element instanceof PsiPackage) {
    final String qName=((PsiPackage)element).getQualifiedName();
    final GrCodeReferenceElement qualifiedRef=GroovyPsiElementFactory.getInstance(getProject()).createTypeOrPackageReference(qName);
    getNode().getTreeParent().replaceChild(getNode(),qualifiedRef.getNode());
    return qualifiedRef;
  }
  throw new IncorrectOperationException("Cannot bind");
}
