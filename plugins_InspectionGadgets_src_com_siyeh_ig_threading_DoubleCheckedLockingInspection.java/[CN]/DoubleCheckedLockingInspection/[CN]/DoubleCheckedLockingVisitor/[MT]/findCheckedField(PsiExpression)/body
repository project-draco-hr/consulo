{
  if (expression instanceof PsiReferenceExpression) {
    final PsiReferenceExpression referenceExpression=(PsiReferenceExpression)expression;
    final PsiElement target=referenceExpression.resolve();
    if (!(target instanceof PsiField)) {
      return null;
    }
    return (PsiField)target;
  }
 else   if (expression instanceof PsiBinaryExpression) {
    final PsiBinaryExpression binaryExpression=(PsiBinaryExpression)expression;
    final IElementType tokenType=binaryExpression.getOperationTokenType();
    if (!JavaTokenType.EQEQ.equals(tokenType) && !JavaTokenType.NE.equals(tokenType)) {
      return null;
    }
    final PsiExpression lhs=binaryExpression.getLOperand();
    final PsiExpression rhs=binaryExpression.getROperand();
    final PsiField field=findCheckedField(lhs);
    if (field != null) {
      return field;
    }
    return findCheckedField(rhs);
  }
 else   if (expression instanceof PsiPrefixExpression) {
    final PsiPrefixExpression prefixExpression=(PsiPrefixExpression)expression;
    final IElementType tokenType=prefixExpression.getOperationTokenType();
    if (!JavaTokenType.EXCL.equals(tokenType)) {
      return null;
    }
    return findCheckedField(prefixExpression.getOperand());
  }
 else {
    return null;
  }
}
