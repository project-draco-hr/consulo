{
  if (myZoomToFit) {
    final Dimension panelSize=getParent().getSize();
    if (myImage.getWidth() <= panelSize.width && myImage.getHeight() <= panelSize.height) {
      return new Dimension(myImage.getWidth(),myImage.getHeight());
    }
    if (myImage.getWidth() <= panelSize.width) {
      final double f=panelSize.getHeight() / myImage.getHeight();
      return new Dimension((int)(myImage.getWidth() * f),(int)(myImage.getHeight() * f));
    }
 else     if (myImage.getHeight() <= panelSize.height) {
      final double f=panelSize.getWidth() / myImage.getWidth();
      return new Dimension((int)(myImage.getWidth() * f),(int)(myImage.getHeight() * f));
    }
    double f=panelSize.getWidth() / myImage.getWidth();
    int candidateWidth=(int)(myImage.getWidth() * f);
    int candidateHeight=(int)(myImage.getHeight() * f);
    if (candidateWidth <= panelSize.getWidth() && candidateHeight <= panelSize.getHeight()) {
      return new Dimension(candidateWidth,candidateHeight);
    }
    f=panelSize.getHeight() / myImage.getHeight();
    return new Dimension((int)(myImage.getWidth() * f),(int)(myImage.getHeight() * f));
  }
  return new Dimension((int)(myImage.getWidth() * myZoomFactor),(int)(myImage.getHeight() * myZoomFactor));
}
