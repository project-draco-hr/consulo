{
  if (usages == null && usageTargets == null) {
    return null;
  }
  final Set<VirtualFile> result=new THashSet<VirtualFile>();
  if (usages != null) {
    for (    Usage usage : usages) {
      if (usage.isValid()) {
        if (usage instanceof UsageInFile) {
          result.add(((UsageInFile)usage).getFile());
        }
        if (usage instanceof UsageInFiles) {
          result.addAll(Arrays.asList(((UsageInFiles)usage).getFiles()));
        }
      }
    }
  }
  if (usageTargets != null) {
    for (    UsageTarget usageTarget : usageTargets) {
      if (usageTarget.isValid()) {
        final VirtualFile[] files=usageTarget.getFiles();
        if (files != null) {
          result.addAll(Arrays.asList(files));
        }
      }
    }
  }
  return VfsUtil.toVirtualFileArray(result);
}
