{
  Set<Usage> usages=getReadOnlyUsages();
  Set<VirtualFile> result=new THashSet<>();
  for (  Usage usage : usages) {
    if (usage instanceof UsageInFile) {
      UsageInFile usageInFile=(UsageInFile)usage;
      VirtualFile file=usageInFile.getFile();
      if (file != null && file.isValid())       result.add(file);
    }
    if (usage instanceof UsageInFiles) {
      UsageInFiles usageInFiles=(UsageInFiles)usage;
      ContainerUtil.addAll(result,usageInFiles.getFiles());
    }
  }
  for (  UsageTarget target : myTargets) {
    VirtualFile[] files=target.getFiles();
    if (files == null)     continue;
    ContainerUtil.addAll(result,files);
  }
  return result;
}
