{
  boolean shouldCheckChildren=true;
  if (myTree.isCollapsed(path)) {
    if (node instanceof Node) {
      ((Node)node).markNeedUpdate();
    }
    shouldCheckChildren=false;
  }
  if (shouldCheckChildren) {
    for (int i=0; i < node.getChildCount(); i++) {
      TreeNode child=node.getChildAt(i);
      checkNodeValidity(child,path.pathByAddingChild(child));
    }
  }
  if (node instanceof Node && node != getModelRoot()) {
    ((Node)node).update(this);
  }
}
