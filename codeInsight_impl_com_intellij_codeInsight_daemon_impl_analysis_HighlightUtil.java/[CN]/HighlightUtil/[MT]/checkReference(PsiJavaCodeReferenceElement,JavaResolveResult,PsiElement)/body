{
  PsiElement refName=ref.getReferenceNameElement();
  if (!(refName instanceof PsiIdentifier) && !(refName instanceof PsiKeyword))   return null;
  HighlightInfo highlightInfo=checkMemberReferencedBeforeConstructorCalled(ref);
  if (highlightInfo != null)   return highlightInfo;
  PsiElement refParent=ref.getParent();
  if (!(refParent instanceof PsiMethodCallExpression)) {
    if (resolved == null) {
      if (isInsidePackageStatement(refName))       return null;
      if (result.isPackagePrefixPackageReference())       return null;
      String description=JavaErrorMessages.message("cannot.resolve.symbol",refName.getText());
      HighlightInfoType type=HighlightInfoType.WRONG_REF;
      if (PsiUtil.isInsideJavadocComment(ref))       return null;
      HighlightInfo info=HighlightInfo.createHighlightInfo(type,refName,description);
      QuickFixAction.registerQuickFixAction(info,new ImportClassFix(ref));
      QuickFixAction.registerQuickFixAction(info,SetupJDKFix.getInstnace());
      OrderEntryFix.registerFixes(info,ref);
      if (ref instanceof PsiReferenceExpression) {
        TextRange fixRange=HighlightMethodUtil.getFixRange(ref);
        PsiReferenceExpression refExpr=(PsiReferenceExpression)ref;
        QuickFixAction.registerQuickFixAction(info,fixRange,new CreateEnumConstantFromUsageFix(refExpr),null);
        QuickFixAction.registerQuickFixAction(info,fixRange,new CreateConstantFieldFromUsageFix(refExpr),null);
        QuickFixAction.registerQuickFixAction(info,fixRange,new CreateFieldFromUsageFix(refExpr),null);
        QuickFixAction.registerQuickFixAction(info,new RenameWrongRefFix(refExpr));
        if (!ref.isQualified()) {
          QuickFixAction.registerQuickFixAction(info,fixRange,new BringVariableIntoScopeFix(refExpr),null);
          QuickFixAction.registerQuickFixAction(info,fixRange,new CreateLocalFromUsageFix(refExpr),null);
          QuickFixAction.registerQuickFixAction(info,fixRange,new CreateParameterFromUsageFix(refExpr),null);
        }
      }
      QuickFixAction.registerQuickFixAction(info,new CreateClassFromUsageFix(ref,CreateClassKind.INTERFACE));
      QuickFixAction.registerQuickFixAction(info,new CreateClassFromUsageFix(ref,CreateClassKind.ENUM));
      PsiElement parent=PsiTreeUtil.getParentOfType(ref,PsiNewExpression.class,PsiMethod.class);
      if (parent instanceof PsiNewExpression && !(ref.getParent() instanceof PsiTypeElement)) {
        QuickFixAction.registerQuickFixAction(info,new CreateClassFromNewFix((PsiNewExpression)parent));
        QuickFixAction.registerQuickFixAction(info,new CreateInnerClassFromNewFix((PsiNewExpression)parent));
      }
 else {
        QuickFixAction.registerQuickFixAction(info,new CreateClassFromUsageFix(ref,CreateClassKind.CLASS));
        QuickFixAction.registerQuickFixAction(info,new CreateInnerClassFromUsageFix(ref,CreateClassKind.CLASS));
      }
      return info;
    }
    if (!result.isValidResult() && !PsiUtil.isInsideJavadocComment(ref)) {
      if (!result.isAccessible()) {
        String description=buildProblemWithAccessDescription(ref,result);
        HighlightInfo info=HighlightInfo.createHighlightInfo(HighlightInfoType.WRONG_REF,ref.getReferenceNameElement(),description);
        if (result.isStaticsScopeCorrect()) {
          registerAccessQuickFixAction((PsiMember)resolved,ref,info,result.getCurrentFileResolveScope());
          if (ref instanceof PsiReferenceExpression) {
            QuickFixAction.registerQuickFixAction(info,new RenameWrongRefFix((PsiReferenceExpression)ref));
          }
        }
        return info;
      }
      if (!result.isStaticsScopeCorrect()) {
        String description=buildProblemWithStaticDescription(resolved);
        HighlightInfo info=HighlightInfo.createHighlightInfo(HighlightInfoType.WRONG_REF,ref.getReferenceNameElement(),description);
        registerStaticProblemQuickFixAction(resolved,info,ref);
        if (ref instanceof PsiReferenceExpression) {
          QuickFixAction.registerQuickFixAction(info,new RenameWrongRefFix((PsiReferenceExpression)ref));
        }
        return info;
      }
    }
    if ((resolved instanceof PsiLocalVariable || resolved instanceof PsiParameter) && !(resolved instanceof ImplicitVariable)) {
      highlightInfo=HighlightControlFlowUtil.checkVariableMustBeFinal((PsiVariable)resolved,ref);
    }
  }
  return highlightInfo;
}
