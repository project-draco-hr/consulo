{
  PsiElement refName=ref.getReferenceNameElement();
  if (!(refName instanceof PsiIdentifier) && !(refName instanceof PsiKeyword))   return null;
  HighlightInfo highlightInfo=checkMemberReferencedBeforeConstructorCalled(ref);
  if (highlightInfo != null)   return highlightInfo;
  PsiElement refParent=ref.getParent();
  if (!(refParent instanceof PsiMethodCallExpression)) {
    if (resolved == null) {
      if (isInsidePackageStatement(refName))       return null;
      if (result.isPackagePrefixPackageReference())       return null;
      String description=JavaErrorMessages.message("cannot.resolve.symbol",refName.getText());
      HighlightInfoType type=HighlightInfoType.WRONG_REF;
      if (PsiTreeUtil.getParentOfType(ref,PsiDocComment.class) != null) {
        return null;
      }
      HighlightInfo info=HighlightInfo.createHighlightInfo(type,refName,description);
      QuickFixAction.registerQuickFixAction(info,new ImportClassAction(ref));
      QuickFixAction.registerQuickFixAction(info,SetupJDKFix.getInstnace());
      OrderEntryFix.registerFixes(info,ref);
      if (ref instanceof PsiReferenceExpression) {
        TextRange fixRange=HighlightMethodUtil.getFixRange(ref);
        PsiReferenceExpression refExpr=(PsiReferenceExpression)ref;
        QuickFixAction.registerQuickFixAction(info,fixRange,new CreateEnumConstantFromUsageAction(refExpr),null,null);
        QuickFixAction.registerQuickFixAction(info,fixRange,new CreateConstantFieldFromUsageAction(refExpr),null,null);
        QuickFixAction.registerQuickFixAction(info,fixRange,new CreateFieldFromUsageAction(refExpr),null,null);
        QuickFixAction.registerQuickFixAction(info,new RenameWrongRefAction(refExpr));
        if (!ref.isQualified()) {
          QuickFixAction.registerQuickFixAction(info,fixRange,new BringVariableIntoScopeAction(refExpr),null,null);
          QuickFixAction.registerQuickFixAction(info,fixRange,new CreateLocalFromUsageAction(refExpr),null,null);
          QuickFixAction.registerQuickFixAction(info,fixRange,new CreateParameterFromUsageAction(refExpr),null,null);
        }
      }
      QuickFixAction.registerQuickFixAction(info,new CreateClassFromUsageAction(ref,CreateClassKind.CLASS));
      QuickFixAction.registerQuickFixAction(info,new CreateClassFromUsageAction(ref,CreateClassKind.INTERFACE));
      QuickFixAction.registerQuickFixAction(info,new CreateClassFromUsageAction(ref,CreateClassKind.ENUM));
      PsiElement parent=PsiTreeUtil.getParentOfType(ref,PsiNewExpression.class,PsiMethod.class);
      if (parent instanceof PsiNewExpression) {
        QuickFixAction.registerQuickFixAction(info,new CreateClassFromNewAction((PsiNewExpression)parent));
      }
      return info;
    }
    if (!result.isValidResult()) {
      if (!result.isAccessible()) {
        String description=buildProblemWithAccessDescription(ref,result);
        HighlightInfo info=HighlightInfo.createHighlightInfo(HighlightInfoType.WRONG_REF,ref.getReferenceNameElement(),description);
        if (result.isStaticsScopeCorrect()) {
          registerAccessQuickFixAction((PsiMember)resolved,ref,info,result.getCurrentFileResolveScope());
          if (ref instanceof PsiReferenceExpression) {
            QuickFixAction.registerQuickFixAction(info,new RenameWrongRefAction((PsiReferenceExpression)ref));
          }
        }
        return info;
      }
      if (!result.isStaticsScopeCorrect()) {
        String description=buildProblemWithStaticDescription(resolved);
        HighlightInfo info=HighlightInfo.createHighlightInfo(HighlightInfoType.WRONG_REF,ref.getReferenceNameElement(),description);
        registerStaticProblemQuickFixAction(resolved,info,ref);
        if (ref instanceof PsiReferenceExpression) {
          QuickFixAction.registerQuickFixAction(info,new RenameWrongRefAction((PsiReferenceExpression)ref));
        }
        return info;
      }
    }
    if ((resolved instanceof PsiLocalVariable || resolved instanceof PsiParameter) && !(resolved instanceof ImplicitVariable)) {
      highlightInfo=HighlightControlFlowUtil.checkVariableMustBeFinal((PsiVariable)resolved,ref);
      if (highlightInfo != null)       return highlightInfo;
    }
  }
  return highlightInfo;
}
