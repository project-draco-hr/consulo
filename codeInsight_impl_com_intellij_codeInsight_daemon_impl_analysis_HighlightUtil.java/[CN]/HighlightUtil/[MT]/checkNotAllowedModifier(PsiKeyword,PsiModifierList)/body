{
  PsiElement modifierOwner=modifierList.getParent();
  if (modifierOwner == null)   return null;
  if (PsiUtil.hasErrorElementChild(modifierOwner))   return null;
  String modifier=keyword.getText();
  final Map<String,Set<String>> incompatibleModifierMap=getIncompatibleModifierMap(modifierList);
  if (incompatibleModifierMap == null)   return null;
  Set<String> incompatibles=incompatibleModifierMap.get(modifier);
  boolean isAllowed=true;
  PsiElement modifierOwnerParent=modifierOwner.getParent();
  if (modifierOwner instanceof PsiClass) {
    PsiClass aClass=(PsiClass)modifierOwner;
    if (aClass.isInterface()) {
      if (PsiModifier.STATIC.equals(modifier) || PsiModifier.PRIVATE.equals(modifier) || PsiModifier.PROTECTED.equals(modifier)|| PsiModifier.PACKAGE_LOCAL.equals(modifier)) {
        isAllowed=modifierOwnerParent instanceof PsiClass;
      }
    }
 else {
      if (PsiModifier.PUBLIC.equals(modifier)) {
        isAllowed=modifierOwnerParent instanceof PsiJavaFile || modifierOwnerParent instanceof PsiClass;
      }
 else       if (PsiModifier.STATIC.equals(modifier) || PsiModifier.PRIVATE.equals(modifier) || PsiModifier.PROTECTED.equals(modifier)|| PsiModifier.PACKAGE_LOCAL.equals(modifier)) {
        isAllowed=modifierOwnerParent instanceof PsiClass;
      }
      if (aClass.isEnum()) {
        isAllowed&=!(PsiModifier.FINAL.equals(modifier) || PsiModifier.ABSTRACT.equals(modifier));
      }
    }
  }
 else   if (modifierOwner instanceof PsiMethod) {
    PsiMethod method=(PsiMethod)modifierOwner;
    isAllowed=!(method.isConstructor() && ourConstructorNotAllowedModifiers.contains(modifier));
    if ((method.hasModifierProperty(PsiModifier.PUBLIC) || method.hasModifierProperty(PsiModifier.PROTECTED)) && method.isConstructor() && method.getContainingClass() != null && method.getContainingClass().isEnum()) {
      isAllowed=false;
    }
    if (PsiModifier.PRIVATE.equals(modifier) || PsiModifier.PROTECTED.equals(modifier) || PsiModifier.TRANSIENT.equals(modifier)|| PsiModifier.STRICTFP.equals(modifier)|| PsiModifier.SYNCHRONIZED.equals(modifier)) {
      boolean notInterface=modifierOwnerParent instanceof PsiClass && !((PsiClass)modifierOwnerParent).isInterface();
      isAllowed&=notInterface & !(modifierOwner instanceof PsiIntertypeMethod && PsiModifier.PROTECTED.equals(modifier));
    }
  }
 else   if (modifierOwner instanceof PsiField) {
    if (PsiModifier.PRIVATE.equals(modifier) || PsiModifier.PROTECTED.equals(modifier) || PsiModifier.TRANSIENT.equals(modifier)|| PsiModifier.STRICTFP.equals(modifier)|| PsiModifier.SYNCHRONIZED.equals(modifier)) {
      boolean isInterface=modifierOwnerParent instanceof PsiClass && !((PsiClass)modifierOwnerParent).isInterface();
      isAllowed=isInterface & !(modifierOwner instanceof PsiIntertypeField && PsiModifier.PROTECTED.equals(modifier));
    }
  }
 else   if (modifierOwner instanceof PsiClassInitializer) {
    isAllowed=PsiModifier.STATIC.equals(modifier);
  }
 else   if (modifierOwner instanceof PsiLocalVariable || modifierOwner instanceof PsiParameter) {
    isAllowed=PsiModifier.FINAL.equals(modifier);
  }
 else   if (modifierOwner instanceof PsiPointcutDef) {
    isAllowed=PsiModifier.FINAL.equals(modifier) || PsiModifier.ABSTRACT.equals(modifier) || PsiModifier.PUBLIC.equals(modifier)|| PsiModifier.PRIVATE.equals(modifier)|| PsiModifier.PACKAGE_LOCAL.equals(modifier);
  }
  isAllowed&=incompatibles != null;
  if (!isAllowed) {
    String message=JavaErrorMessages.message("modifier.not.allowed",modifier);
    HighlightInfo highlightInfo=HighlightInfo.createHighlightInfo(HighlightInfoType.ERROR,keyword,message);
    QuickFixAction.registerQuickFixAction(highlightInfo,QUICK_FIX_FACTORY.createModifierListFix(modifierList,modifier,false,false),null);
    return highlightInfo;
  }
  return null;
}
