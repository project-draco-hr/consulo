{
  final Document doc=editor.getDocument();
  Project project=PlatformDataKeys.PROJECT.getData(dataContext);
  if (project == null || editor.isOneLineMode()) {
    plainEnter(editor,dataContext);
    return;
  }
  final int caretOffset=editor.getCaretModel().getOffset();
  if (isInPreceedingBlanks(editor)) {
    final int caretLine=doc.getLineNumber(caretOffset);
    if (caretLine > 0) {
      int prevLineEnd=doc.getLineEndOffset(caretLine - 1);
      editor.getCaretModel().moveToOffset(prevLineEnd);
    }
    EditorActionHandler enterHandler=EditorActionManager.getInstance().getActionHandler(IdeActions.ACTION_EDITOR_ENTER);
    enterHandler.execute(editor,dataContext);
    return;
  }
  PsiFile psiFile=PsiUtilBase.getPsiFileInEditor(editor,project);
  if (psiFile == null) {
    plainEnter(editor,dataContext);
    return;
  }
  if (EnterAfterUnmatchedBraceHandler.isAfterUnmatchedLBrace(editor,caretOffset,psiFile.getFileType())) {
    EditorActionHandler enterHandler=EditorActionManager.getInstance().getActionHandler(IdeActions.ACTION_EDITOR_ENTER);
    enterHandler.execute(editor,dataContext);
    return;
  }
  final Language language=PsiUtilBase.getLanguageInEditor(editor,project);
  boolean processed=false;
  if (language != null) {
    final List<SmartEnterProcessor> processors=SmartEnterProcessors.INSTANCE.forKey(language);
    if (!processors.isEmpty()) {
      for (      SmartEnterProcessor processor : processors) {
        if (processor.process(project,editor,psiFile)) {
          processed=true;
          break;
        }
      }
    }
  }
  if (!processed) {
    plainEnter(editor,dataContext);
  }
}
