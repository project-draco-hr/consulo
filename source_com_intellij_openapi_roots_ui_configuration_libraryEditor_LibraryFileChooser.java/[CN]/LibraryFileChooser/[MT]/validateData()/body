{
  JComponent componentToFocus=null;
  try {
    final VirtualFile[] chosenFiles=getSelectedFiles();
    if (chosenFiles != null && chosenFiles.length > 0) {
      if (myInputName) {
        final String name=getName();
        if (name == null) {
          Messages.showErrorDialog(myNameField,"Please enter library name","Library Name Not Specified");
          componentToFocus=myNameField;
          return false;
        }
        if (myParentEditor.libraryAlreadyExists(name)) {
          Messages.showErrorDialog(myNameField,"Library \"" + name + "\" already exists","Library Already Exists");
          componentToFocus=myNameField;
          return false;
        }
      }
    }
 else {
      Messages.showErrorDialog("Please select files or directories to be added to the library","Library Files Not Selected");
      componentToFocus=myFileSystemTree.getTree();
      return false;
    }
    return true;
  }
  finally {
    if (componentToFocus != null) {
      final JComponent _componentToFocus=componentToFocus;
      SwingUtilities.invokeLater(new Runnable(){
        public void run(){
          _componentToFocus.requestFocus();
        }
      }
);
    }
  }
}
