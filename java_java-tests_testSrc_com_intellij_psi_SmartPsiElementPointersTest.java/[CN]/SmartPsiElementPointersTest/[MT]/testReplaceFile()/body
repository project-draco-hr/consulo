{
  VirtualFile vfile=myRoot.createChildData(this,"X.java");
  VfsUtil.saveText(vfile,"public class X { public int X; }");
  PsiClass aClass=myJavaFacade.findClass("X",GlobalSearchScope.allScope(getProject()));
  assertNotNull(aClass);
  assertTrue(aClass.isValid());
  SmartPsiElementPointer classp=SmartPointerManager.getInstance(myProject).createSmartPsiElementPointer(aClass);
  SmartPsiElementPointer filep=SmartPointerManager.getInstance(myProject).createSmartPsiElementPointer(aClass.getContainingFile());
  FileContentUtil.reparseFiles(myProject,Collections.<VirtualFile>singleton(vfile),true);
  PsiDocumentManager.getInstance(myProject).commitAllDocuments();
  assertFalse(aClass.isValid());
  PsiElement element=classp.getElement();
  assertNotNull(element);
  assertTrue(element instanceof PsiClass);
  assertTrue(element.isValid());
  assertEquals(vfile,element.getContainingFile().getVirtualFile());
  element=filep.getElement();
  assertNotNull(element);
  assertTrue(element instanceof PsiFile);
  assertTrue(element.isValid());
  assertEquals(vfile,element.getContainingFile().getVirtualFile());
}
