{
  final StringWriter stringWriter=new StringWriter();
  try {
    Velocity.evaluate(context,stringWriter,"",templateContent);
  }
 catch (  final VelocityException e) {
    LOG.info("Error evaluating template:\n" + templateContent,e);
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        Messages.showErrorDialog(IdeBundle.message("error.parsing.file.template",e.getMessage()),IdeBundle.message("title.velocity.error"));
      }
    }
);
  }
  final String result=stringWriter.toString();
  if (useSystemLineSeparators) {
    final String newSeparator=CodeStyleSettingsManager.getSettings(ProjectManagerEx.getInstanceEx().getDefaultProject()).getLineSeparator();
    if (!"\n".equals(newSeparator)) {
      return StringUtil.convertLineSeparators(result,newSeparator);
    }
  }
  return result;
}
