{
  configureByFile(BASE_PATH + getTestName(false) + ".dtd");
  doDoTest(true,false);
  final String text=myEditor.getDocument().getText();
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      myEditor.getSelectionModel().setSelection(0,myEditor.getDocument().getTextLength());
    }
  }
);
  AnAction action=ActionManager.getInstance().getAction(IdeActions.ACTION_COMMENT_BLOCK);
  action.actionPerformed(new AnActionEvent(null,DataManager.getInstance().getDataContext(),"",action.getTemplatePresentation(),ActionManager.getInstance(),0));
  assertNotSame(text,myEditor.getDocument().getText());
  PsiDocumentManager.getInstance(myProject).commitDocument(myEditor.getDocument());
  Collection<HighlightInfo> infos=doHighlighting();
  assertEquals(0,infos.size());
  action.actionPerformed(new AnActionEvent(null,DataManager.getInstance().getDataContext(),"",action.getTemplatePresentation(),ActionManager.getInstance(),0));
  assertEquals(text,myEditor.getDocument().getText().trim());
  PsiDocumentManager.getInstance(myProject).commitDocument(myEditor.getDocument());
  infos=doHighlighting();
  assertEquals(0,infos.size());
}
