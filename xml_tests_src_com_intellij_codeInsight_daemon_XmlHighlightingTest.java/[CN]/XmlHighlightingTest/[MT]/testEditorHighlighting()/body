{
  String text="<html></html>";
  EditorHighlighter xmlHighlighter=XmlHighlighterFactory.createXMLHighlighter(EditorColorsManager.getInstance().getGlobalScheme());
  xmlHighlighter.setText(text);
  HighlighterIterator iterator=xmlHighlighter.createIterator(1);
  assertSame("Xml tag name",iterator.getTokenType(),XmlTokenType.XML_TAG_NAME);
  iterator=xmlHighlighter.createIterator(8);
  assertSame("Xml tag name at end of tag",iterator.getTokenType(),XmlTokenType.XML_TAG_NAME);
  text="<a:xxx /> <a:xxx attr = \"1111\"/>";
  xmlHighlighter.setText(text);
  iterator=xmlHighlighter.createIterator(6);
  assertEquals(XmlTokenType.TAG_WHITE_SPACE,iterator.getTokenType());
  iterator=xmlHighlighter.createIterator(21);
  assertEquals(XmlTokenType.TAG_WHITE_SPACE,iterator.getTokenType());
  iterator=xmlHighlighter.createIterator(23);
  assertEquals(XmlTokenType.TAG_WHITE_SPACE,iterator.getTokenType());
  iterator=xmlHighlighter.createIterator(9);
  assertEquals(XmlTokenType.XML_REAL_WHITE_SPACE,iterator.getTokenType());
  text="<!DOCTYPE schema [ <!ENTITY RelativeURL  \"[^:#/\\?]*(:{0,0}|[#/\\?].*)\">";
  xmlHighlighter.setText(text);
  iterator=xmlHighlighter.createIterator(53);
  assertSame("Xml attribute value",iterator.getTokenType(),XmlTokenType.XML_DATA_CHARACTERS);
  assertEquals(iterator.getStart(),41);
  assertEquals(iterator.getEnd(),70);
  text="<a name='$'/>";
  xmlHighlighter.setText(text);
  iterator=xmlHighlighter.createIterator(9);
  assertEquals("$ in attr value",XmlTokenType.XML_ATTRIBUTE_VALUE_TOKEN,iterator.getTokenType());
  iterator=xmlHighlighter.createIterator(10);
  assertEquals("' after $ in attr value",XmlTokenType.XML_ATTRIBUTE_VALUE_END_DELIMITER,iterator.getTokenType());
  text="<project><jar file=\"${\"> </jar><jar file=\"${}\"/></project> ";
  xmlHighlighter.setText(text);
  iterator=xmlHighlighter.createIterator(22);
  assertEquals("${ in attr value",XmlTokenType.XML_ATTRIBUTE_VALUE_END_DELIMITER,iterator.getTokenType());
  text="<!--&nbsp; &aaa;-->";
  xmlHighlighter.setText(text);
  iterator=xmlHighlighter.createIterator(5);
  assertEquals("char entity in comment",XmlTokenType.XML_COMMENT_CHARACTERS,iterator.getTokenType());
  iterator=xmlHighlighter.createIterator(12);
  assertEquals("entity ref in comment",XmlTokenType.XML_COMMENT_CHARACTERS,iterator.getTokenType());
  text="<!-- -- -->";
  xmlHighlighter.setText(text);
  iterator=xmlHighlighter.createIterator(5);
  assertEquals("double -- in xml comment",XmlTokenType.XML_BAD_CHARACTER,iterator.getTokenType());
}
