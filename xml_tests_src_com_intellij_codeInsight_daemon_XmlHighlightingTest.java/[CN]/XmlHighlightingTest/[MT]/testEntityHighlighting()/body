{
  doTest();
  final XmlTag rootTag=((XmlFile)myFile).getDocument().getRootTag();
  final List<XmlEntityRef> refs=new ArrayList<XmlEntityRef>();
  XmlUtil.processXmlElements(rootTag,new PsiElementProcessor(){
    @Override public boolean execute(    @NotNull final PsiElement element){
      if (element instanceof XmlEntityRef) {
        refs.add((XmlEntityRef)element);
      }
      return true;
    }
  }
,true);
  assertEquals("Should be 2 entity refs",2,refs.size());
  PsiReference[] entityRefs=refs.get(0).getReferences();
  assertTrue(entityRefs.length == 1 && entityRefs[0].resolve() == null);
  entityRefs=refs.get(1).getReferences();
  assertTrue(entityRefs.length == 1 && entityRefs[0].resolve() != null);
  doTest(getFullRelativeTestName("2.xml"),false,false);
}
