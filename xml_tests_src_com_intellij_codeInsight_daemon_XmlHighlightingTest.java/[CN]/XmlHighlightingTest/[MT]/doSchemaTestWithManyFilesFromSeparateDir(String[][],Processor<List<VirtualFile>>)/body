{
  try {
    List<VirtualFile> files=new ArrayList<VirtualFile>(6);
    files.add(getVirtualFile(BASE_PATH + getTestName(false) + ".xml"));
    final Set<VirtualFile> usedFiles=new THashSet<VirtualFile>();
    final String base=BASE_PATH + getTestName(false) + "Schemas/";
    for (    String[] pair : urls) {
      final String url=pair[0];
      final String filename=pair.length > 1 ? pair[1] : url.substring(url.lastIndexOf('/') + 1) + (url.endsWith(".xsd") ? "" : ".xsd");
      final VirtualFile virtualFile=getVirtualFile(base + filename);
      usedFiles.add(virtualFile);
      if (url != null)       ExternalResourceManagerImpl.registerResourceTemporarily(url,virtualFile.getPath(),getTestRootDisposable());
      files.add(virtualFile);
    }
    for (    VirtualFile file : LocalFileSystem.getInstance().findFileByPath(getTestDataPath() + base.substring(0,base.length() - 1)).getChildren()) {
      if (!usedFiles.contains(file)) {
        files.add(file);
      }
    }
    doTest(VfsUtil.toVirtualFileArray(files),true,false);
    if (additionalTestingProcessor != null)     additionalTestingProcessor.process(files);
  }
  finally {
    unregisterResources(urls);
  }
}
