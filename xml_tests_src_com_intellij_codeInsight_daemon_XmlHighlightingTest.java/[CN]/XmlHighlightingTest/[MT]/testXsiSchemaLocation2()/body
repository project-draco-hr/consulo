{
  doTest(new VirtualFile[]{getVirtualFile(getFullRelativeTestName()),getVirtualFile(BASE_PATH + getTestName(false) + "_1.xsd"),getVirtualFile(BASE_PATH + getTestName(false) + "_2.xsd"),getVirtualFile(BASE_PATH + getTestName(false) + "_3.xsd")},false,false);
  XmlTag rootTag=((XmlFile)myFile).getDocument().getRootTag();
  checkOneTagForSchemaAttribute(rootTag,"xmlns:test2",getTestName(false) + "_2.xsd");
  configureByFiles(null,getVirtualFile(BASE_PATH + getTestName(false) + "_2.xsd"),getVirtualFile(BASE_PATH + getTestName(false) + "_3.xsd"));
  rootTag=((XmlFile)myFile).getDocument().getRootTag();
  final List<XmlTag> tags=new ArrayList<XmlTag>();
  XmlUtil.processXmlElements(rootTag,new PsiElementProcessor(){
    @Override public boolean execute(    @NotNull final PsiElement element){
      if (element instanceof XmlTag && (((XmlTag)element).getName().equals("xs:element") || ((XmlTag)element).getName().equals("xs:attribute") || ((XmlTag)element).getName().equals("xs:restriction")|| ((XmlTag)element).getName().equals("xs:group")|| ((XmlTag)element).getName().equals("xs:attributeGroup")) && (((XmlTag)element).getAttributeValue("type") != null || ((XmlTag)element).getAttributeValue("ref") != null || ((XmlTag)element).getAttributeValue("base") != null)) {
        tags.add((XmlTag)element);
      }
      return true;
    }
  }
,true);
  assertEquals("Should be adequate number of tags",11,tags.size());
  final String resolveFileName=getTestName(false) + "_3.xsd";
  checkOneTagForSchemaAttribute(tags.get(1),"type",resolveFileName);
  checkOneTagForSchemaAttribute(tags.get(0),"ref",resolveFileName);
  checkOneTagForSchemaAttribute(tags.get(3),"type",resolveFileName);
  checkOneTagForSchemaAttribute(tags.get(4),"base",resolveFileName);
  final String schemaFile="XMLSchema.xsd";
  checkOneTagForSchemaAttribute(tags.get(5),"base",schemaFile);
  checkOneTagForSchemaAttribute(rootTag,"xmlns:xs",schemaFile);
  checkOneTagForSchemaAttribute(tags.get(6),"ref",resolveFileName);
  checkOneTagForSchemaAttribute(tags.get(7),"ref",resolveFileName);
  checkOneTagForSchemaAttribute(rootTag,"xmlns:test2",getTestName(false) + "_2.xsd");
  checkOneTagForSchemaAttribute(tags.get(8),"type",schemaFile);
  checkOneTagForSchemaAttribute(tags.get(9),"ref",schemaFile);
  checkOneTagForSchemaAttribute(tags.get(10),"ref",resolveFileName);
}
