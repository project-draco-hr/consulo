{
  final SourceFileInfo srcInfo=preloadedInfo != null ? preloadedInfo : loadSourceInfo(srcFile);
  final boolean alreadyMarked;
synchronized (myDataLock) {
    TIntHashSet set=mySourcesToRecompile.get(projectId);
    if (set == null) {
      set=new TIntHashSet();
      mySourcesToRecompile.put(projectId,set);
    }
    alreadyMarked=!set.add(Math.abs(getFileId(srcFile)));
    if (!alreadyMarked && (LOG.isDebugEnabled() || ourDebugMode)) {
      final String message="Scheduled recompilation " + srcFile.getPresentableUrl();
      LOG.debug(message);
      if (ourDebugMode) {
        System.out.println(message);
      }
    }
  }
  if (!alreadyMarked && srcInfo != null) {
    srcInfo.updateTimestamp(projectId,-1L);
    srcInfo.processOutputPaths(projectId,new ScheduleOutputsForDeletionProc(srcFile.getUrl()));
    saveSourceInfo(srcFile,srcInfo);
  }
}
