{
  GrTypeElement typeElement=getTypeElementGroovy();
  if (typeElement != null) {
    PsiType type=typeElement.getType();
    if (!isVarArgs()) {
      return type;
    }
 else {
      return new PsiEllipsisType(type);
    }
  }
  if (isVarArgs()) {
    PsiClassType type=getManager().getElementFactory().createTypeByFQClassName("java.lang.Object",getResolveScope());
    return new PsiEllipsisType(type);
  }
  PsiElement parent=getParent();
  if (parent instanceof GrForInClause) {
    GrExpression iteratedExpression=((GrForInClause)parent).getIteratedExpression();
    if (iteratedExpression instanceof GrRangeExpression) {
      return getManager().getElementFactory().createTypeByFQClassName("java.lang.Integer",getResolveScope());
    }
 else     if (iteratedExpression != null) {
      PsiType iterType=iteratedExpression.getType();
      if (iterType instanceof PsiArrayType)       return ((PsiArrayType)iterType).getComponentType();
      if (iterType instanceof PsiClassType) {
        PsiClassType.ClassResolveResult result=((PsiClassType)iterType).resolveGenerics();
        PsiClass clazz=result.getElement();
        if (clazz != null) {
          PsiManagerEx manager=getManager();
          PsiClass collectionClass=manager.findClass("java.util.Collection",getResolveScope());
          if (collectionClass != null && collectionClass.getTypeParameters().length == 1) {
            PsiSubstitutor substitutor=TypeConversionUtil.getClassSubstitutor(collectionClass,clazz,result.getSubstitutor());
            if (substitutor != null) {
              PsiType substed=substitutor.substitute(collectionClass.getTypeParameters()[0]);
              if (substed != null) {
                return substed;
              }
            }
          }
          if ("java.lang.String".equals(clazz.getQualifiedName())) {
            return manager.getElementFactory().createTypeByFQClassName("java.lang.Character",getResolveScope());
          }
        }
      }
    }
  }
  return null;
}
