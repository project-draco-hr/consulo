{
  GrTypeElement typeElement=getTypeElementGroovy();
  if (typeElement != null)   return typeElement.getType();
  PsiElement parent=getParent();
  if (parent instanceof GrForInClause) {
    GrExpression iteratedExpression=((GrForInClause)parent).getIteratedExpression();
    if (iteratedExpression instanceof GrRangeExpression) {
      return getManager().getElementFactory().createTypeByFQClassName("java.lang.Integer",getResolveScope());
    }
 else {
      PsiType iterType=iteratedExpression.getType();
      if (iterType instanceof PsiArrayType)       return ((PsiArrayType)iterType).getComponentType();
      if (iterType instanceof PsiClassType) {
        PsiClassType.ClassResolveResult result=((PsiClassType)iterType).resolveGenerics();
        PsiClass clazz=result.getElement();
        if (clazz != null) {
          PsiManagerEx manager=getManager();
          PsiClass collectionClass=manager.findClass("java.util.Collection",getResolveScope());
          if (collectionClass != null && collectionClass.getTypeParameters().length == 1) {
            PsiSubstitutor substitutor=TypeConversionUtil.getClassSubstitutor(collectionClass,clazz,result.getSubstitutor());
            if (substitutor != null) {
              PsiType substed=substitutor.substitute(collectionClass.getTypeParameters()[0]);
              if (substed != null) {
                return substed;
              }
            }
          }
        }
      }
    }
  }
  return null;
}
