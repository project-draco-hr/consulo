{
  final FileEditorManagerImpl editorManager=getManager();
  editorManager.runChange(new FileEditorManagerChange(){
    public void run(    EditorsSplitters splitters){
      final List<EditorWithProviderComposite> editors=myOwner.findEditorComposites(file);
      if (editors.isEmpty())       return;
      try {
        final EditorWithProviderComposite editor=findFileComposite(file);
        final FileEditorManagerListener.Before beforePublisher=editorManager.getProject().getMessageBus().syncPublisher(FileEditorManagerListener.Before.FILE_EDITOR_MANAGER);
        beforePublisher.beforeFileClosed(editorManager,file);
        if (myTabbedPane != null && editor != null) {
          final int componentIndex=findComponentIndex(editor.getComponent());
          if (componentIndex >= 0) {
            final int indexToSelect=calcIndexToSelect(file,componentIndex);
            final ActionCallback removeTab=myTabbedPane.removeTabAt(componentIndex,indexToSelect,transferFocus);
            final Runnable disposer=new Runnable(){
              public void run(){
                editorManager.disposeComposite(editor);
              }
            }
;
            disposer.run();
          }
        }
 else {
          myPanel.removeAll();
          editorManager.disposeComposite(editor);
        }
        if (unsplit && getTabCount() == 0) {
          unsplit(true);
        }
        myPanel.revalidate();
        if (myTabbedPane == null) {
          myPanel.repaint();
        }
      }
  finally {
        editorManager.removeSelectionRecord(file,EditorWindow.this);
        final FileEditorManagerListener afterPublisher=editorManager.getProject().getMessageBus().syncPublisher(FileEditorManagerListener.FILE_EDITOR_MANAGER);
        IdeFocusManager.getInstance(editorManager.getProject()).doWhenFocusSettlesDown(new ExpirableRunnable.ForProject(editorManager.getProject()){
          @Override public void run(){
            afterPublisher.fileClosed(editorManager,file);
          }
        }
);
        myOwner.afterFileClosed(file);
      }
    }
  }
);
}
