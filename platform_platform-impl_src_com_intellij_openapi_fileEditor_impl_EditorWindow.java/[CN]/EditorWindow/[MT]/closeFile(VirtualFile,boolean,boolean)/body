{
  final FileEditorManagerImpl editorManager=getManager();
  editorManager.runChange(new Runnable(){
    public void run(){
      try {
        final List<EditorWithProviderComposite> editors=editorManager.getEditorComposites(file);
        if (editors.isEmpty())         return;
        final EditorWithProviderComposite editor=findFileComposite(file);
        final FileEditorManagerListener.Before beforePublisher=editorManager.getProject().getMessageBus().syncPublisher(FileEditorManagerListener.Before.FILE_EDITOR_MANAGER);
        beforePublisher.beforeFileClosed(editorManager,file);
        if (myTabbedPane != null) {
          final int componentIndex=findComponentIndex(editor.getComponent());
          if (componentIndex >= 0) {
            final int indexToSelect=calcIndexToSelect(file,componentIndex);
            myTabbedPane.removeTabAt(componentIndex,indexToSelect,transferFocus).doWhenDone(new Runnable(){
              public void run(){
                editorManager.disposeComposite(editor);
              }
            }
);
          }
        }
 else {
          myPanel.removeAll();
          editorManager.disposeComposite(editor);
        }
        if (unsplit && getTabCount() == 0) {
          unsplit(true);
        }
        myPanel.revalidate();
        if (myTabbedPane == null) {
          myPanel.repaint();
        }
      }
  finally {
        final FileEditorManagerListener afterPublisher=editorManager.getProject().getMessageBus().syncPublisher(FileEditorManagerListener.FILE_EDITOR_MANAGER);
        afterPublisher.fileClosed(editorManager,file);
      }
    }
  }
);
}
