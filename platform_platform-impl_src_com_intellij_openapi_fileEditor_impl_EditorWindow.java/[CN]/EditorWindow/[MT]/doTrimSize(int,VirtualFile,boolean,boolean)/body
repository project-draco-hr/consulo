{
  LinkedHashSet<VirtualFile> closingOrder=getTabClosingOrder(closeNonModifiedFilesFirst);
  VirtualFile selectedFile=getSelectedFile();
  if (shouldCloseSelected()) {
    defaultCloseFile(selectedFile,transferFocus);
    closingOrder.remove(selectedFile);
  }
  for (  VirtualFile file : closingOrder) {
    if (myTabbedPane.getTabCount() <= limit || myTabbedPane.getTabCount() == 0 || areAllTabsPinned(fileToIgnore)) {
      return;
    }
    if (fileCanBeClosed(file,fileToIgnore)) {
      defaultCloseFile(file,transferFocus);
    }
  }
}
