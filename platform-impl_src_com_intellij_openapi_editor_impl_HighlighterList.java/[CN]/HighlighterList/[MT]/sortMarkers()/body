{
  myLongestHighlighterLength=0;
  mySegmentHighlighters.clear();
  Iterator<RangeHighlighter> iterator=myHighlightersSet.iterator();
  while (iterator.hasNext()) {
    RangeHighlighter rangeHighlighter=iterator.next();
    if (rangeHighlighter.isValid()) {
      mySegmentHighlighters.add((RangeHighlighterImpl)rangeHighlighter);
      myLongestHighlighterLength=Math.max(myLongestHighlighterLength,rangeHighlighter.getEndOffset() - rangeHighlighter.getStartOffset());
    }
 else {
      iterator.remove();
    }
  }
  Collections.sort(mySegmentHighlighters,MY_RANGE_COMPARATOR);
  myIsDirtied=false;
}
