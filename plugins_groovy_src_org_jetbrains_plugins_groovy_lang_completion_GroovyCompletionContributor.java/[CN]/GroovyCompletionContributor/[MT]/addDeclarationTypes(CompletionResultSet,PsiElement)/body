{
  ResolverProcessor processor=CompletionProcessor.createClassCompletionProcessor(position);
  ResolveUtil.treeWalkUp((GrVariable)position.getParent(),processor,false);
  for (  Object variant : GroovyCompletionUtil.getCompletionVariants(processor.getCandidates())) {
    if (variant instanceof LookupElement) {
      result.addElement((LookupElement)variant);
      continue;
    }
    final String lookupString=variant.toString();
    if (lookupString == null)     continue;
    LookupElementBuilder builder=LookupElementBuilder.create(variant,lookupString);
    if (variant instanceof Iconable) {
      builder=builder.setIcon(((Iconable)variant).getIcon(Iconable.ICON_FLAG_VISIBILITY));
    }
    result.addElement(builder.setInsertHandler(GroovyInsertHandler.INSTANCE));
  }
}
