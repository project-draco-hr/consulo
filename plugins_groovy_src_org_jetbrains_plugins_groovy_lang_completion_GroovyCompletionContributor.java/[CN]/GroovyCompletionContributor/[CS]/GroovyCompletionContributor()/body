{
  extend(CompletionType.SMART,AFTER_NEW,new CompletionProvider<CompletionParameters>(false){
    public void addCompletions(    @NotNull final CompletionParameters parameters,    final ProcessingContext matchingContext,    @NotNull final CompletionResultSet result){
      final PsiElement identifierCopy=parameters.getPosition();
      final PsiFile file=parameters.getOriginalFile();
      final List<PsiClassType> expectedClassTypes=new SmartList<PsiClassType>();
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        public void run(){
          PsiType psiType=((GrVariable)identifierCopy.getParent().getParent().getParent()).getTypeGroovy();
          if (psiType instanceof PsiClassType) {
            PsiType type=JavaCompletionUtil.eliminateWildcards(JavaCompletionUtil.originalize(psiType));
            final PsiClassType classType=(PsiClassType)type;
            if (classType.resolve() != null) {
              expectedClassTypes.add(classType);
            }
          }
        }
      }
);
      JavaSmartCompletionContributor.processInheritors(parameters,identifierCopy,file,expectedClassTypes,new Consumer<PsiType>(){
        public void consume(        final PsiType type){
          addExpectedType(result,type,identifierCopy);
        }
      }
,result.getPrefixMatcher());
    }
  }
);
}
