{
  startElement(expression);
  try {
    PsiExpression lExpr=expression.getLExpression();
    PsiExpression rExpr=expression.getRExpression();
    if (lExpr == null || rExpr == null) {
      pushUnknown();
      return;
    }
    lExpr.accept(this);
    IElementType op=expression.getOperationSign().getTokenType();
    boolean isBoolean=expression.getType() == PsiType.BOOLEAN;
    if (op == JavaTokenType.EQ) {
      rExpr.accept(this);
    }
 else     if (op == JavaTokenType.ANDEQ) {
      if (isBoolean) {
        generateAndExpression(lExpr,rExpr);
      }
 else {
        generateDefaultBinop(lExpr,rExpr);
      }
    }
 else     if (op == JavaTokenType.OREQ) {
      if (isBoolean) {
        generateOrExpression(lExpr,rExpr);
      }
 else {
        generateDefaultBinop(lExpr,rExpr);
      }
    }
 else     if (op == JavaTokenType.XOREQ) {
      if (isBoolean) {
        generateXorExpression(expression,lExpr,rExpr);
      }
 else {
        generateDefaultBinop(lExpr,rExpr);
      }
    }
 else {
      generateDefaultBinop(lExpr,rExpr);
    }
    if (lExpr instanceof PsiReferenceExpression) {
      PsiReferenceExpression psiDestReference=(PsiReferenceExpression)lExpr;
      PsiVariable psiDestVariable=DfaValueFactory.resolveVariable(psiDestReference);
      if (psiDestVariable != null) {
        addInstruction(new AssignInstruction());
        lExpr.accept(this);
        return;
      }
    }
    addInstruction(new PopInstruction());
    addInstruction(new PopInstruction());
    lExpr.accept(this);
  }
  finally {
    finishElement(expression);
  }
}
