{
  myEventDispatcher=new EventDispatcher(myVcs,myGateway);
  myFileContentProvider=new FileContentProvider(){
    public VirtualFile[] getCoveredDirectories(){
      return myRootManager.getContentRoots();
    }
    @Nullable public ProvidedContent getProvidedContent(    VirtualFile f){
      return getProvidedContentFor(f);
    }
    public VirtualFileListener getVirtualFileListener(){
      return myEventDispatcher;
    }
  }
;
  myCommandProcessor.addCommandListener(myEventDispatcher);
  myFileManager.addVirtualFileManagerListener(myEventDispatcher);
  myFileManager.registerFileContentProvider(myFileContentProvider);
}
