{
  if (data == null)   return;
  final Component last=DnDManager.getInstance().getLastDropHandler();
  if (last != null && !(last instanceof EditorComponentImpl))   return;
  final EditorImpl editor=getEditor(source);
  if (action == MOVE && !editor.isViewer() && editor.myDraggedRange != null) {
    if (!FileDocumentManager.getInstance().requestWriting(editor.getDocument(),editor.getProject())) {
      return;
    }
    CommandProcessor.getInstance().executeCommand(editor.myProject,new Runnable(){
      @Override public void run(){
        ApplicationManager.getApplication().runWriteAction(new Runnable(){
          @Override public void run(){
            Document doc=editor.getDocument();
            doc.startGuardedBlockChecking();
            try {
              doc.deleteString(editor.myDraggedRange.getStartOffset(),editor.myDraggedRange.getEndOffset());
            }
 catch (            ReadOnlyFragmentModificationException e) {
              EditorActionManager.getInstance().getReadonlyFragmentModificationHandler(doc).handle(e);
            }
 finally {
              doc.stopGuardedBlockChecking();
            }
          }
        }
);
      }
    }
,EditorBundle.message("move.selection.command.name"),DND_COMMAND_KEY,UndoConfirmationPolicy.DEFAULT,editor.getDocument());
  }
  editor.clearDraggedRange();
}
