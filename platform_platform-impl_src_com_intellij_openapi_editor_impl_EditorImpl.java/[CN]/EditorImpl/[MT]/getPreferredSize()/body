{
  if (ourIsUnitTestMode && getUserData(DO_DOCUMENT_UPDATE_TEST) == null) {
    return new Dimension(1,1);
  }
  final Dimension draft=getSizeWithoutCaret();
  final int additionalSpace=mySoftWrapModel.isRespectAdditionalColumns() ? mySettings.getAdditionalColumnsCount() * EditorUtil.getSpaceWidth(Font.PLAIN,this) : 0;
  if (!myDocument.isInBulkUpdate() && getCaretModel().isUpToDate()) {
    int caretX=visualPositionToXY(getCaretModel().getVisualPosition()).x;
    draft.width=Math.max(caretX,draft.width) + additionalSpace;
  }
 else {
    draft.width+=additionalSpace;
  }
  return draft;
}
