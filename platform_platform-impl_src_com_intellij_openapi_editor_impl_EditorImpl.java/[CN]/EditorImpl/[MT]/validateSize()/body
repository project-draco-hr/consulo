{
  Dimension dim=getPreferredSize();
  if (!dim.equals(myPreferredSize) && !myDocument.isInBulkUpdate()) {
    myPreferredSize=dim;
    stopOptimizedScrolling();
    int lineNum=Math.max(1,getDocument().getLineCount());
    myGutterComponent.setLineNumberAreaWidth(getFontMetrics(Font.PLAIN).stringWidth(Integer.toString(lineNum + 2)) + 6);
    myEditorComponent.setSize(dim);
    myEditorComponent.fireResized();
    myMarkupModel.repaint(0,myDocument.getTextLength());
  }
}
