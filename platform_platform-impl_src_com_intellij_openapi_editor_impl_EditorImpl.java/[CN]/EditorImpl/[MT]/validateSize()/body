{
  Dimension dim=getPreferredSize();
  if (!dim.equals(myPreferredSize) && !myDocument.isInBulkUpdate()) {
    dim=mySizeAdjustmentStrategy.adjust(dim,myPreferredSize,this);
    if (dim == null) {
      return;
    }
    myPreferredSize=dim;
    stopOptimizedScrolling();
    myGutterComponent.setLineNumberAreaWidth(new Convertor<Integer,Integer>(){
      @NotNull @Override public Integer convert(      Integer lineNumber){
        return getFontMetrics(Font.PLAIN).stringWidth(Integer.toString(lineNumber + 2)) + 6;
      }
    }
);
    myEditorComponent.setSize(dim);
    myEditorComponent.fireResized();
    myMarkupModel.recalcEditorDimensions();
    myMarkupModel.repaint(-1,-1);
  }
}
