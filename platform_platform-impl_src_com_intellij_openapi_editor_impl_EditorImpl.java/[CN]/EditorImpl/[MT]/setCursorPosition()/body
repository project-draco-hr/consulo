{
  if (myCaretModel.supportsMultipleCarets()) {
    final List<CaretRectangle> caretPoints=new ArrayList<CaretRectangle>();
    for (    Caret caret : getCaretModel().getAllCarets()) {
      VisualPosition caretPosition=caret.getVisualPosition();
      Point pos1=visualPositionToXY(caretPosition);
      Point pos2=visualPositionToXY(new VisualPosition(caretPosition.line,caretPosition.column + 1));
      caretPoints.add(new CaretRectangle(pos1,pos2.x - pos1.x,caret));
    }
    myCaretCursor.setPositions(caretPoints.toArray(new CaretRectangle[caretPoints.size()]));
  }
 else {
    VisualPosition caretPosition=getCaretModel().getVisualPosition();
    Point pos1=visualPositionToXY(caretPosition);
    Point pos2=visualPositionToXY(new VisualPosition(caretPosition.line,caretPosition.column + 1));
    myCaretCursor.setPosition(pos1,pos2.x - pos1.x);
  }
}
