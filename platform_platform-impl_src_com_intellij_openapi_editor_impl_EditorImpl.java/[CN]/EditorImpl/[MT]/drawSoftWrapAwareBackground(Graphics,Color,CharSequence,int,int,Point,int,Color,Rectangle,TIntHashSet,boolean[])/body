{
  int startToUse=start;
  int softWrapRetrievalEndOffset=end;
  if (end > start) {
    softWrapRetrievalEndOffset--;
  }
  List<? extends SoftWrap> softWraps=getSoftWrapModel().getSoftWrapsForRange(start,softWrapRetrievalEndOffset);
  for (  SoftWrap softWrap : softWraps) {
    int softWrapStart=softWrap.getStart();
    if (softWrapsToSkip.contains(softWrapStart)) {
      continue;
    }
    if (startToUse < softWrapStart) {
      position.x=drawBackground(g,backColor,text.subSequence(startToUse,softWrapStart),position,fontType,defaultBackground,clip);
    }
    boolean drawCustomBackgroundAtSoftWrapVirtualSpace=backColor != defaultBackground && (softWrapStart > start || myLastBackgroundColor == backColor);
    drawSoftWrap(g,softWrap,position,fontType,backColor,drawCustomBackgroundAtSoftWrapVirtualSpace,defaultBackground,clip,caretRowPainted);
    startToUse=softWrapStart;
  }
  if (startToUse < end) {
    position.x=drawBackground(g,backColor,text.subSequence(startToUse,end),position,fontType,defaultBackground,clip);
  }
  return position.x;
}
