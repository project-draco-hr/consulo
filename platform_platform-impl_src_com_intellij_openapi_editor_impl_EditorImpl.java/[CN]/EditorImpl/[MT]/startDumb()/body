{
  if (ApplicationManager.getApplication().isUnitTestMode())   return;
  final JComponent component=getContentComponent();
  final JComponent viewPort=(JComponent)component.getParent();
  final Rectangle rect=viewPort.getVisibleRect();
  BufferedImage image=new BufferedImage(rect.width,rect.height,BufferedImage.TYPE_INT_RGB);
  final Graphics2D graphics=image.createGraphics();
  UISettings.setupAntialiasing(graphics);
  graphics.translate(-rect.x,-rect.y);
  graphics.setClip(rect.x,rect.y,rect.width,rect.height);
  paint(graphics);
  graphics.translate(rect.x,rect.y);
  graphics.dispose();
  putUserData(BUFFER,image);
}
