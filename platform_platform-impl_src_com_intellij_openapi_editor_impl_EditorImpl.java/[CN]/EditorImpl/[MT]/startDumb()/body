{
  if (ApplicationManager.getApplication().isUnitTestMode())   return;
  final JComponent component=getContentComponent();
  final Rectangle rect=((JViewport)component.getParent()).getViewRect();
  BufferedImage image=UIUtil.createImage(rect.width,rect.height,BufferedImage.TYPE_INT_RGB);
  final Graphics2D graphics=image.createGraphics();
  UISettings.setupAntialiasing(graphics);
  graphics.translate(-rect.x,-rect.y);
  graphics.setClip(rect.x,rect.y,rect.width,rect.height);
  paint(graphics);
  graphics.dispose();
  putUserData(BUFFER,image);
}
