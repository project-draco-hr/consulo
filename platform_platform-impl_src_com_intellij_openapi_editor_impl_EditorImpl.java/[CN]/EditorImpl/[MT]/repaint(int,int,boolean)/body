{
  if (myDocument.isInBulkUpdate()) {
    return;
  }
  if (myUseNewRendering) {
    assertIsDispatchThread();
    endOffset=Math.min(endOffset,myDocument.getTextLength());
    if (invalidateTextLayout) {
      myView.invalidateRange(startOffset,endOffset);
    }
    if (!isShowing()) {
      return;
    }
  }
 else {
    if (!isShowing()) {
      return;
    }
    endOffset=Math.min(endOffset,myDocument.getTextLength());
    assertIsDispatchThread();
  }
  if (startOffset <= endOffset) {
    int startLine=myDocument.getLineNumber(startOffset);
    int endLine=myDocument.getLineNumber(endOffset);
    repaintLines(startLine,endLine);
  }
}
