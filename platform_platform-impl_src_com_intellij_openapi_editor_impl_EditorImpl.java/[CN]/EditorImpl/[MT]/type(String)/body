{
  final ActionCallback result=new ActionCallback();
  Application app=ApplicationManager.getApplication();
  if (!app.isWriteAccessAllowed()) {
    result.setRejected();
  }
 else {
    app.runWriteAction(new Runnable(){
      public void run(){
        for (int i=0; i < text.length(); i++) {
          if (!processKeyTyped(text.charAt(i))) {
            result.setRejected();
            return;
          }
        }
        result.setDone();
      }
    }
);
  }
  return result;
}
