{
  assertIsDispatchThread();
  if (isReleased) {
    VirtualFile file=FileDocumentManager.getInstance().getFile(myDocument);
    String hint=file != null ? file.getPath() : myDocument.getText(TextRange.create(0,Math.min(100,myDocument.getTextLength())));
    LOG.error("Double release:\n" + hint + "\n"+ "First released at:  =====\n"+ myReleasedAt+ "\n======");
  }
  myReleasedAt=StringUtil.getThrowableText(new Throwable());
  isReleased=true;
  myDocument.removeDocumentListener(myHighlighter);
  myFoldingModel.removeListener(mySoftWrapModel);
  myFoldingModel.dispose();
  mySoftWrapModel.release();
  myMarkupModel.dispose();
  myLineHeight=-1;
  myCharHeight=-1;
  myDescent=-1;
  myPlainFontMetrics=null;
  myScrollingModel.dispose();
  myGutterComponent.dispose();
  myMousePressedEvent=null;
  myMouseMovedEvent=null;
  Disposer.dispose(myCaretModel);
  clearCaretThread();
  myFocusListeners.clear();
  if (myConnection != null) {
    myConnection.disconnect();
  }
}
