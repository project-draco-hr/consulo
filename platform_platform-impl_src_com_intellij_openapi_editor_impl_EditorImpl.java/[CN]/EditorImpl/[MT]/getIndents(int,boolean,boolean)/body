{
  if (line <= 0 || line >= myDocument.getLineCount())   return 0;
  int lineStart=myDocument.getLineStartOffset(line);
  int lineEnd=myDocument.getLineEndOffset(line);
  CharSequence chars=myDocument.getCharsNoThreadCheck();
  int nonWhitespaceOffset=CharArrayUtil.shiftForward(chars,lineStart," \t");
  if (nonWhitespaceOffset < lineEnd) {
    final int columnNumber=calcColumnNumber(nonWhitespaceOffset,line);
    final int indentSize=getIndentSize();
    return indentSize != 0 ? columnNumber / indentSize : columnNumber;
  }
 else {
    int upIndent=goUp ? getIndents(line - 1,true,false) : 100;
    int downIndent=goDown ? getIndents(line + 1,false,true) : 100;
    return Math.min(upIndent,downIndent);
  }
}
