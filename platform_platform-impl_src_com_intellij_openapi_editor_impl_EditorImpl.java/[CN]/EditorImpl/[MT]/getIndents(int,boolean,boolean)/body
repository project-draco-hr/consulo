{
  if (line <= 0 || line >= myDocument.getLineCount())   return 0;
  int lineStart=myDocument.getLineStartOffset(line);
  int lineEnd=myDocument.getLineEndOffset(line);
  CharSequence chars=myDocument.getCharsNoThreadCheck();
  int nonWhitespaceOffset=CharArrayUtil.shiftForward(chars,lineStart," \t");
  if (nonWhitespaceOffset < lineEnd) {
    return calcColumnNumber(nonWhitespaceOffset,line) / getIndentSize();
  }
 else {
    int upIndent=goUp ? getIndents(line - 1,true,false) : 0;
    int downIndent=goDown ? getIndents(line + 1,false,true) : 0;
    return Math.max(upIndent,downIndent);
  }
}
