{
  if (mySettings.isIndentGuidesShown()) {
    int x=0;
    int y=clip.y;
    int line=xyToLogicalPosition(new Point(0,y)).line;
    final int indentSize=getIndentSize();
    int gapWidth=EditorUtil.getSpaceWidth(Font.PLAIN,this) * indentSize;
    final CharSequence chars=myDocument.getCharsNoThreadCheck();
    int prevIndent=-1;
    do {
      final int indents=getIndents(line);
      y=logicalLineToY(line);
      if (y > clip.y + clip.height)       break;
      for (int n=1; n < indents; n++) {
        x=n * gapWidth + 1;
        drawSegment(g,x,y,chars,false);
      }
      line++;
      prevIndent=indents;
    }
 while (true);
    if (myCaretIndentGuide != null) {
      x=myCaretIndentGuide.indentLevel * gapWidth + 1;
      for (int i=myCaretIndentGuide.startLine; i <= myCaretIndentGuide.endLine; i++) {
        drawSegment(g,x,logicalLineToY(i),chars,true);
      }
    }
  }
}
