{
  myDocumentChangeInProgress=true;
  if (isStickySelection()) {
    setStickySelection(false);
  }
  if (myDocument.isInBulkUpdate()) {
    return;
  }
  saveCaretRelativePosition();
  if (!mySoftWrapModel.isSoftWrappingEnabled() && !myUseNewRendering) {
    mySizeContainer.beforeChange(e);
  }
  if (isZeroLatencyTypingEnabled() && myImmediateEditingInProgress && canPaintImmediately(e)) {
    int offset=e.getOffset();
    int length=e.getOldLength();
    myOldArea=lineRectangleBetween(offset,offset + length);
    myOldTailArea=lineRectangleBetween(offset + length,myDocument.getLineEndOffset(myDocument.getLineNumber(offset)));
    if (myOldTailArea.isEmpty()) {
      myOldTailArea.width+=EditorUtil.getSpaceWidth(Font.PLAIN,this);
    }
  }
}
