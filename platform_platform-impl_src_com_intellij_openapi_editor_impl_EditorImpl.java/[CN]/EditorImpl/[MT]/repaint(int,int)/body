{
  if (!isShowing() || myScrollPane == null || myDocument.isInBulkUpdate()) {
    return;
  }
  int startOffsetToUse=startOffset;
  int endOffsetToUse=endOffset;
  assertIsDispatchThread();
  if (endOffsetToUse > myDocument.getTextLength()) {
    endOffsetToUse=myDocument.getTextLength();
  }
  for (  EditorRepaintStrategy repaintStrategy : Extensions.getExtensions(EditorRepaintStrategy.EP_NAME)) {
    final TextRange range=repaintStrategy.adjustHighlighterRegion(this,startOffsetToUse,endOffsetToUse);
    if (range == null) {
      return;
    }
    startOffsetToUse=range.getStartOffset();
    endOffsetToUse=range.getEndOffset();
  }
  if (startOffsetToUse <= endOffsetToUse) {
    int startLine=myDocument.getLineNumber(startOffsetToUse);
    int endLine=myDocument.getLineNumber(endOffsetToUse);
    repaintLines(startLine,endLine);
  }
}
