{
  dependencyMapping=new Mappings(this);
  backendCallback=dependencyMapping.getCallback();
  affectedFiles=new HashSet<StringCache.S>();
  myProject=new Project(binding == null ? new GantBinding() : binding);
  myProjectBuilder=myProject.getBuilder();
  final File prjFile=new File(prjDir);
  final boolean dirBased=!(prjFile.isFile() && prjDir.endsWith(".ipr"));
  myRoot=dirBased ? getCanonicalPath(prjDir) : getCanonicalPath(prjFile.getParent());
  final String loadPath=dirBased ? getAbsolutePath(myIDEADir) : prjDir;
  myProjectSnapshot=myHomeDir + File.separator + myJPSDir+ File.separator+ myRoot.replace(File.separatorChar,myFileSeparatorReplacement);
  if (pathVariables == null) {
    IdeaProjectLoader.loadFromPath(myProject,loadPath,setupScript);
  }
 else {
    IdeaProjectLoader.loadFromPath(myProject,loadPath,pathVariables,setupScript);
  }
  for (  Module m : myProject.getModules().values()) {
    myModules.put(m.getName(),new ModuleWrapper(m));
  }
  for (  Library l : myProject.getLibraries().values()) {
    myLibraries.put(l.getName(),new LibraryWrapper(l));
  }
  myHistory=loadHistory ? loadSnapshot(dependencyMapping,affectedFiles) : null;
}
