{
  for (  File root : root2Facets.keySet()) {
    ModuleInfo moduleInfo=new ModuleInfo(moduleDescriptor,root);
    Map<FacetInfo,DetectedFacetInfo> facetInfos=new HashMap<FacetInfo,DetectedFacetInfo>();
    for (    Pair<FacetInfo,VirtualFile> pair : root2Facets.get(root)) {
      DetectedFacetInfo parent=null;
      FacetInfo underlyingFacet=pair.getFirst().getUnderlyingFacet();
      if (underlyingFacet != null) {
        parent=facetInfos.get(underlyingFacet);
      }
      String relativePath=getRelativePath(root,pair.getSecond());
      DetectedFacetInfo detectedFacet=new DetectedFacetInfo(pair.getFirst(),relativePath,parent);
      facetInfos.put(pair.getFirst(),detectedFacet);
      if (parent == null) {
        moduleInfo.addRootFacet(detectedFacet);
      }
    }
    myModuleInfos.add(moduleInfo);
  }
}
