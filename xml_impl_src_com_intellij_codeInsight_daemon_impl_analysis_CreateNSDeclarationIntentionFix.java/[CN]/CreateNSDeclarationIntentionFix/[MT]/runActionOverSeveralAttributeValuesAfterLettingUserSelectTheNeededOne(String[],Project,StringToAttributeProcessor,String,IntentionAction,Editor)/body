{
  if (namespacesToChooseFrom.length > 1 && !ApplicationManager.getApplication().isUnitTestMode()) {
    final JList list=new JBList(namespacesToChooseFrom);
    list.setCellRenderer(XmlNSRenderer.INSTANCE);
    Runnable runnable=new Runnable(){
      @Override public void run(){
        final int index=list.getSelectedIndex();
        if (index < 0)         return;
        PsiDocumentManager.getInstance(project).commitAllDocuments();
        CommandProcessor.getInstance().executeCommand(project,new Runnable(){
          @Override public void run(){
            ApplicationManager.getApplication().runWriteAction(new Runnable(){
              @Override public void run(){
                try {
                  onSelection.doSomethingWithGivenStringToProduceXmlAttributeNowPlease(namespacesToChooseFrom[index]);
                }
 catch (                IncorrectOperationException ex) {
                  throw new RuntimeException(ex);
                }
              }
            }
);
          }
        }
,requestor.getText(),requestor.getFamilyName());
      }
    }
;
    new PopupChooserBuilder(list).setTitle(title).setItemChoosenCallback(runnable).createPopup().showInBestPositionFor(editor);
  }
 else {
    onSelection.doSomethingWithGivenStringToProduceXmlAttributeNowPlease(namespacesToChooseFrom.length == 0 ? "" : namespacesToChooseFrom[0]);
  }
}
