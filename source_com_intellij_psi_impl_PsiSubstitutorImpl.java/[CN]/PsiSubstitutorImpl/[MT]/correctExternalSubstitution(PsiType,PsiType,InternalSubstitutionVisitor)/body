{
  if (original == null)   return null;
  if (substituted == null) {
    return original.accept(new PsiTypeVisitor<PsiType>(){
      public PsiType visitArrayType(      PsiArrayType arrayType){
        return new PsiArrayType(arrayType.getComponentType().accept(this));
      }
      public PsiType visitEllipsisType(      PsiEllipsisType ellipsisType){
        return new PsiEllipsisType(ellipsisType.getComponentType().accept(this));
      }
      public PsiType visitClassType(      PsiClassType classType){
        PsiClass aClass=classType.resolve();
        return rawTypeForTypeParameter((PsiTypeParameter)aClass);
      }
      public PsiType visitType(      PsiType type){
        LOG.assertTrue(false);
        return null;
      }
    }
);
  }
  return substituted;
}
