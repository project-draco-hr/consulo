{
  final PsiClassType.ClassResolveResult resolveResult=classType.resolveGenerics();
  final PsiClass aClass=resolveResult.getElement();
  if (aClass == null)   return classType;
  if (aClass instanceof PsiTypeParameter) {
    final PsiTypeParameter typeParameter=((PsiTypeParameter)aClass);
    if (!mySubstitutionMap.containsKey(typeParameter)) {
      return classType;
    }
 else {
      return substituteTypeParameter(typeParameter);
    }
  }
  final Map<PsiTypeParameter,PsiType> hashMap=new HashMap<PsiTypeParameter,PsiType>(2);
  if (!processClass(aClass,resolveResult.getSubstitutor(),hashMap)) {
    return null;
  }
  return aClass.getManager().getElementFactory().createType(aClass,createSubstitutor(hashMap),classType.getLanguageLevel());
}
