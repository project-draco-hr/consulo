{
  fileName=checkAppendExtension(fileName,template);
  if (FileTypeManager.getInstance().isFileIgnored(fileName)) {
    throw new IncorrectOperationException("This filename is ignored (Settings | File Types | Ignore files and folders)");
  }
  directory.checkCreateFile(fileName);
  FileType type=FileTypeRegistry.getInstance().getFileTypeByFileName(fileName);
  PsiFile file=PsiFileFactory.getInstance(project).createFileFromText(fileName,type,templateText);
  if (template.isReformatCode()) {
    CodeStyleManager.getInstance(project).reformat(file);
  }
  file=(PsiFile)directory.add(file);
  return file;
}
