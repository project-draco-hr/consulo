{
  super.visitTypeCastExpression(expression);
  final PsiExpression operand=expression.getOperand();
  if (operand == null) {
    return;
  }
  final PsiType operandType=operand.getType();
  if (operandType == null) {
    return;
  }
  final PsiType type=expression.getType();
  if (type == null) {
    return;
  }
  final PsiType expectedType=ExpectedTypeUtils.findExpectedType(expression,true);
  if (expectedType == null) {
    return;
  }
  if (expectedType.equals(type)) {
    return;
  }
  final String expectedTypeText=expectedType.getCanonicalText();
  if ("_Dummy_.__Array__".equals(expectedTypeText)) {
    return;
  }
  if (expectedType.isAssignableFrom(operandType)) {
    return;
  }
  if (isTypeParameter(expectedType)) {
    return;
  }
  if (expectedType instanceof PsiArrayType) {
    final PsiArrayType arrayType=(PsiArrayType)expectedType;
    final PsiType componentType=arrayType.getDeepComponentType();
    if (isTypeParameter(componentType)) {
      return;
    }
  }
  if (ClassUtils.isPrimitiveNumericType(type) || ClassUtils.isPrimitiveNumericType(expectedType)) {
    return;
  }
  final String typeText=type.getCanonicalText();
  if (TypeConversionUtil.isPrimitiveWrapper(typeText) || TypeConversionUtil.isPrimitiveWrapper(expectedTypeText)) {
    return;
  }
  final PsiTypeElement castTypeElement=expression.getCastType();
  registerError(castTypeElement);
}
