{
  String url=virtualFile.getPresentableUrl();
  if (project == null) {
    return url;
  }
  VirtualFile root=ProjectFileIndex.SERVICE.getInstance(project).getContentRootForFile(virtualFile);
  if (root != null) {
    return root.getName() + File.separatorChar + VfsUtilCore.getRelativePath(virtualFile,root,File.separatorChar);
  }
  final VirtualFile baseDir=project.getBaseDir();
  if (baseDir != null) {
    final String projectHomeUrl=baseDir.getPresentableUrl();
    if (url.startsWith(projectHomeUrl)) {
      final String cont=url.substring(projectHomeUrl.length());
      if (cont.length() == 0)       return null;
      url="..." + cont;
    }
  }
  return url;
}
