{
  myIsShutdownHookRunning=true;
  while (!myShutdownTasks.isEmpty()) {
    final Runnable task=myShutdownTasks.removeLast();
    try {
      task.run();
    }
 catch (    Throwable e) {
      LOG.error(e);
    }
  }
  Thread[] threads=getStopperThreads();
  while (threads.length > 0) {
    Thread thread=threads[0];
    if (!thread.isAlive()) {
      if (isRegistered(thread)) {
        LOG.error("Thread '" + thread.getName() + "' did not unregister itself from ShutDownTracker.");
        unregisterStopperThread(thread);
      }
    }
 else {
      try {
        thread.join(100);
      }
 catch (      InterruptedException e) {
      }
    }
    threads=getStopperThreads();
  }
  for (int idx=myShutdownThreads.size() - 1; idx >= 0; idx--) {
    final Thread thread=myShutdownThreads.remove(idx);
    thread.start();
    try {
      thread.join();
    }
 catch (    InterruptedException e) {
    }
  }
}
