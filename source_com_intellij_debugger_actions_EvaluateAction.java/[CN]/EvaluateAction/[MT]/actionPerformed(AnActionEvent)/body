{
  DataContext dataContext=e.getDataContext();
  final Project project=(Project)dataContext.getData(DataConstants.PROJECT);
  final DebuggerContextImpl context=DebuggerAction.getDebuggerContext(dataContext);
  if (project == null || context == null) {
    return;
  }
  final Editor editor=(Editor)dataContext.getData(DataConstants.EDITOR);
  TextWithImportsImpl editorText=DebuggerUtilsEx.getEditorText(editor);
  if (editorText == null) {
    final DebuggerTreeNodeImpl selectedNode=DebuggerAction.getSelectedNode(dataContext);
    if (selectedNode != null && selectedNode.getDescriptor() instanceof ValueDescriptorImpl) {
      context.getDebugProcess().getManagerThread().invokeLater(new DebuggerContextCommandImpl(context){
        public void threadAction(){
          final TextWithImportsImpl evaluationText=DebuggerTreeNodeExpression.createEvaluationText(selectedNode,context);
          DebuggerInvocationUtil.invokeLater(project,new Runnable(){
            public void run(){
              showEvaluationDialog(project,evaluationText);
            }
          }
);
        }
        protected void commandCancelled(){
          DebuggerInvocationUtil.invokeLater(project,new Runnable(){
            public void run(){
              if (selectedNode.getDescriptor() instanceof WatchItemDescriptor) {
                TextWithImportsImpl editorText=DebuggerTreeNodeExpression.createEvaluationText(selectedNode,context);
                showEvaluationDialog(project,editorText);
              }
            }
          }
);
        }
      }
);
      return;
    }
  }
  showEvaluationDialog(project,editorText);
}
