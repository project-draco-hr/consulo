{
  super(useCombo ? new JComboBox() : new JBComboBoxTableCellEditorComponent(),null);
  myProject=project;
  final JComponent component=getChildComponent();
  if (component instanceof JComboBox) {
    component.setBorder(null);
  }
  if (enableBrowseButton) {
    addActionListener(new ActionListener(){
      public void actionPerformed(      ActionEvent e){
        final NamedScope scope;
        if (component instanceof JComboBox) {
          scope=(NamedScope)((JComboBox)component).getSelectedItem();
        }
 else {
          scope=(NamedScope)((JBComboBoxTableCellEditorComponent)component).getEditorValue();
        }
        if (scope instanceof NamedScope.UnnamedScope) {
          @SuppressWarnings({"MismatchedQueryAndUpdateOfCollection"}) final Map<String,PackageSet> unnamedScopes=DependencyValidationManager.getInstance(myProject).getUnnamedScopes();
          final EditUnnamedScopesDialog dlg=new EditUnnamedScopesDialog(scope);
          dlg.show();
          if (dlg.isOK()) {
            final PackageSet packageSet=scope.getValue();
            LOG.assertTrue(packageSet != null);
            unnamedScopes.remove(packageSet.getText());
            final PackageSet editedScope=dlg.getScope();
            if (editedScope != null) {
              unnamedScopes.put(editedScope.getText(),editedScope);
            }
            rebuild();
            if (editedScope != null) {
              selectScope(editedScope.getText());
            }
          }
        }
 else {
          final ScopeChooserConfigurable configurable=ScopeChooserConfigurable.getInstance(myProject);
          final EditScopesDialog dlg=EditScopesDialog.editConfigurable(myProject,new Runnable(){
            public void run(){
              configurable.selectNodeInTree(scope.getName());
            }
          }
,true);
          if (dlg.isOK()) {
            rebuild();
            final NamedScope namedScope=dlg.getSelectedScope();
            if (namedScope != null) {
              selectScope(namedScope.getName());
            }
          }
        }
      }
    }
);
  }
 else {
    getButton().setVisible(false);
  }
  if (component instanceof JComboBox) {
    ((JComboBox)component).setRenderer(new ListCellRendererWrapper<NamedScope>(((JComboBox)component).getRenderer()){
      @Override public void customize(      JList list,      NamedScope value,      int index,      boolean selected,      boolean hasFocus){
        setText(value == null ? "" : value.getName());
      }
    }
);
  }
 else {
    ((JBComboBoxTableCellEditorComponent)component).setToString(new Function<Object,String>(){
      @Override public String fun(      Object o){
        return o == null ? "" : ((NamedScope)o).getName();
      }
    }
);
  }
  rebuild();
  selectScope(preselect);
}
