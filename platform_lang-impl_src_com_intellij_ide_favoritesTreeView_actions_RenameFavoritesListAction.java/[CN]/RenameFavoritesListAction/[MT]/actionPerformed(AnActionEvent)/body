{
  final DataContext dataContext=e.getDataContext();
  final Project project=PlatformDataKeys.PROJECT.getData(dataContext);
  if (project == null) {
    return;
  }
  final FavoritesManager favoritesManager=FavoritesManager.getInstance(project);
  String listName=FavoritesTreeViewPanel.FAVORITES_LIST_NAME_DATA_KEY.getData(dataContext);
  if (!isFavoritesListReadWrite(project,listName))   return;
  final String newName=Messages.showInputDialog(project,IdeBundle.message("prompt.input.favorites.list.new.name"),IdeBundle.message("title.rename.favorites.list"),Messages.getInformationIcon(),listName,new InputValidator(){
    public boolean checkInput(    String inputString){
      return inputString != null && inputString.trim().length() > 0;
    }
    public boolean canClose(    String inputString){
      String[] lists=favoritesManager.getAvailableFavoritesListNames();
      final boolean isNew=ArrayUtil.find(lists,inputString.trim()) == -1;
      if (!isNew) {
        Messages.showErrorDialog(project,IdeBundle.message("error.favorites.list.already.exists",inputString.trim()),IdeBundle.message("title.unable.to.add.favorites.list"));
        return false;
      }
      return inputString.trim().length() > 0;
    }
  }
);
  if (listName != null && newName != null) {
    favoritesManager.renameFavoritesList(listName,newName);
  }
}
