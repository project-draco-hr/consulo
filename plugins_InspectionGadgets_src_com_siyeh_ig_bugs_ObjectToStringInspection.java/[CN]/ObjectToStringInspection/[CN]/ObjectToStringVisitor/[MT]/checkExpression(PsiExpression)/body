{
  if (expression == null) {
    return;
  }
  final PsiType type=expression.getType();
  if (type == null) {
    return;
  }
  if (type instanceof PsiArrayType) {
    registerError(expression);
    return;
  }
  if (!(type instanceof PsiClassType)) {
    return;
  }
  final PsiClassType classType=(PsiClassType)type;
  if (type.equalsToText(CommonClassNames.JAVA_LANG_OBJECT)) {
    return;
  }
  final PsiClass referencedClass=classType.resolve();
  if (referencedClass == null || referencedClass instanceof PsiTypeParameter) {
    return;
  }
  if (referencedClass.isEnum() || referencedClass.isInterface()) {
    return;
  }
  if (hasGoodToString(referencedClass,new HashSet<PsiClass>())) {
    return;
  }
  registerError(expression);
}
