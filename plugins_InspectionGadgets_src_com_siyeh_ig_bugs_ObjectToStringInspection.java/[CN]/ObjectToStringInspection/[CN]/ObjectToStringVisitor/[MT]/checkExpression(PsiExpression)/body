{
  if (expression == null) {
    return;
  }
  final PsiType type=expression.getType();
  if (type == null) {
    return;
  }
  if (type instanceof PsiArrayType) {
    registerError(expression);
    return;
  }
  if (!(type instanceof PsiClassType)) {
    return;
  }
  final PsiClassType classType=(PsiClassType)type;
  if (type.equalsToText("java.lang.Object")) {
    return;
  }
  final PsiClass referencedClass=classType.resolve();
  if (referencedClass == null) {
    return;
  }
  if (referencedClass.isEnum() || referencedClass.isInterface()) {
    return;
  }
  if (!hasGoodToString(referencedClass,new HashSet<PsiClass>())) {
    registerError(expression);
  }
}
