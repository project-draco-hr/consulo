{
  changeNodeState(node,checked);
  if (!checked) {
    TreeNode parent=node.getParent();
    while (parent != null) {
      if (parent instanceof CheckedTreeNode) {
        changeNodeState((CheckedTreeNode)parent,false);
      }
      parent=parent.getParent();
    }
    uncheckChildren(node);
  }
 else {
    checkChildren(node);
  }
  repaint();
}
