{
  FileDocumentManager.getInstance().saveAllDocuments();
  ExecutionResult executionResult;
  boolean shouldAddDefaultActions=true;
  if (state instanceof JavaCommandLine) {
    final JavaParameters parameters=((JavaCommandLine)state).getJavaParameters();
    patch(parameters,state.getRunnerSettings(),true);
    final ProcessProxy proxy=ProcessProxyFactory.getInstance().createCommandLineProxy((JavaCommandLine)state);
    executionResult=state.execute(executor,this);
    if (proxy != null && executionResult != null) {
      proxy.attach(executionResult.getProcessHandler());
    }
    if (state instanceof JavaCommandLineState && !((JavaCommandLineState)state).shouldAddJavaProgramRunnerActions()) {
      shouldAddDefaultActions=false;
    }
  }
 else {
    executionResult=state.execute(executor,this);
  }
  if (executionResult == null) {
    return null;
  }
  onProcessStarted(env.getRunnerSettings(),executionResult);
  final RunContentBuilder contentBuilder=new RunContentBuilder(project,this,executor);
  Disposer.register(project,contentBuilder);
  contentBuilder.setExecutionResult(executionResult);
  contentBuilder.setEnvironment(env);
  if (shouldAddDefaultActions) {
    addDefaultActions(contentBuilder);
  }
  RunContentDescriptor runContent=contentBuilder.showRunContent(contentToReuse);
  AnAction[] actions=createActions(contentBuilder.getExecutionResult());
  for (  AnAction action : actions) {
    contentBuilder.addAction(action);
  }
  return runContent;
}
