{
  if (ourNeedToCheckCancel) {
    ourNeedToCheckCancel=false;
    final ProgressIndicator progress=getProgressIndicator();
    if (progress != null) {
      try {
        progress.checkCanceled();
      }
 catch (      ProcessCanceledException e) {
        if (!Thread.holdsLock(PsiLock.LOCK)) {
          ourLockedCheckCounter=0;
          progress.checkCanceled();
        }
 else {
          ourLockedCheckCounter++;
          if (ourLockedCheckCounter > 10) {
            ourLockedCheckCounter=0;
            ourNeedToCheckCancel=true;
          }
        }
      }
    }
  }
}
