{
  releaseAll();
  final TextRange textRange;
  if (file instanceof VirtualFileWindowImpl) {
    DocumentWindow documentWindow=((VirtualFileWindowImpl)file).getDocumentWindow();
    textRange=documentWindow.injectedToHost(new TextRange(startOffset,endOffset));
    file=((VirtualFileWindow)file).getDelegate();
  }
 else {
    textRange=new TextRange(startOffset,endOffset);
  }
  openEditor(file,endOffset);
  final Editor editor=openEditor(file,textRange.getStartOffset());
  SwingUtilities.invokeLater(new Runnable(){
    public void run(){
      if (editor != null && !editor.isDisposed()) {
        doSelect(toUseNormalSelection,editor,toSelectLine,textRange);
      }
    }
  }
);
}
