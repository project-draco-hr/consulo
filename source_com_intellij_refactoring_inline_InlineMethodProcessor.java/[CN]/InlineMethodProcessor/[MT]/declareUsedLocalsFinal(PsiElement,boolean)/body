{
  if (expr instanceof PsiReferenceExpression) {
    PsiElement refElement=((PsiReferenceExpression)expr).resolve();
    if (refElement instanceof PsiLocalVariable || refElement instanceof PsiParameter) {
      if (strictlyFinal || RefactoringUtil.canBeDeclaredFinal((PsiVariable)refElement)) {
        ((PsiVariable)refElement).getModifierList().setModifierProperty(PsiModifier.FINAL,true);
      }
    }
  }
  PsiElement[] children=expr.getChildren();
  for (int i=0; i < children.length; i++) {
    declareUsedLocalsFinal(children[i],strictlyFinal);
  }
}
