{
  final AndroidFacet facet=AndroidFacet.getInstance(myProfile.getModule());
  if (facet == null) {
    done.run();
    return;
  }
  List<ThemeData> projectThemes=new ArrayList<ThemeData>();
  collectThemesFromManifest(facet,projectThemes,true);
  collectProjectThemes(facet,projectThemes);
  if (projectThemes.size() > 0) {
    myThemes.add(PROJECT);
    myThemes.addAll(projectThemes);
  }
  AndroidTargetData targetData=null;
  AndroidPlatform androidPlatform=AndroidPlatform.getInstance(myProfile.getModule());
  if (androidPlatform != null) {
    IAndroidTarget target=myProfile.getSelectedTarget();
    if (target == null) {
      target=androidPlatform.getTarget();
    }
    targetData=androidPlatform.getSdkData().getTargetData(target);
  }
  if (targetData == null || targetData.areThemesCached()) {
    collectFrameworkThemes(facet,targetData);
    done.run();
  }
 else {
    final AndroidTargetData finalTargetData=targetData;
    ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
      @Override public void run(){
        collectFrameworkThemes(facet,finalTargetData);
        ApplicationManager.getApplication().invokeLater(new Runnable(){
          @Override public void run(){
            done.run();
          }
        }
);
      }
    }
);
  }
}
