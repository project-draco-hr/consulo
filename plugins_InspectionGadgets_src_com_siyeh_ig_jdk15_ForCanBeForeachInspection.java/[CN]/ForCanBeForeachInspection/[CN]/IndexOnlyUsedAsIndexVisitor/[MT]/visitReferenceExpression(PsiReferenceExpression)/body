{
  if (!indexVariableUsedOnlyAsIndex) {
    return;
  }
  super.visitReferenceExpression(reference);
  final PsiElement element=reference.resolve();
  if (!indexVariable.equals(element)) {
    return;
  }
  final PsiElement parent=reference.getParent();
  if (!(parent instanceof PsiArrayAccessExpression)) {
    indexVariableUsedOnlyAsIndex=false;
    return;
  }
  final PsiArrayAccessExpression arrayAccess=(PsiArrayAccessExpression)parent;
  final PsiExpression arrayExpression=arrayAccess.getArrayExpression();
  final String text=arrayExpression.getText();
  if (!text.equals(arrayName)) {
    indexVariableUsedOnlyAsIndex=false;
    return;
  }
  final PsiElement arrayExpressionContext=arrayAccess.getParent();
  if (arrayExpressionContext instanceof PsiAssignmentExpression) {
    final PsiAssignmentExpression assignment=(PsiAssignmentExpression)arrayExpressionContext;
    final PsiExpression lhs=assignment.getLExpression();
    if (lhs.equals(arrayAccess)) {
      indexVariableUsedOnlyAsIndex=false;
    }
  }
}
