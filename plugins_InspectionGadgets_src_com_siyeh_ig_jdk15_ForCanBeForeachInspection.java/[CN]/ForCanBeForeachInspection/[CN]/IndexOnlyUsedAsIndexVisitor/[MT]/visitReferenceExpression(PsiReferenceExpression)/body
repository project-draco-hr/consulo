{
  if (!indexVariableUsedOnlyAsIndex) {
    return;
  }
  super.visitReferenceExpression(ref);
  final PsiElement element=ref.resolve();
  if (!indexVariable.equals(element)) {
    return;
  }
  final PsiElement parent=ref.getParent();
  if (!(parent instanceof PsiArrayAccessExpression)) {
    indexVariableUsedOnlyAsIndex=false;
    return;
  }
  final PsiArrayAccessExpression arrayAccess=(PsiArrayAccessExpression)parent;
  final PsiExpression arrayExpression=arrayAccess.getArrayExpression();
  if (arrayExpression == null) {
    return;
  }
  if (!arrayExpression.getText().equals(arrayName)) {
    indexVariableUsedOnlyAsIndex=false;
    return;
  }
  final PsiElement arrayExpressionContext=arrayAccess.getParent();
  if (arrayExpressionContext instanceof PsiAssignmentExpression) {
    final PsiAssignmentExpression assignment=(PsiAssignmentExpression)arrayExpressionContext;
    final PsiExpression lhs=assignment.getLExpression();
    if (lhs.equals(arrayAccess)) {
      indexVariableUsedOnlyAsIndex=false;
    }
  }
}
