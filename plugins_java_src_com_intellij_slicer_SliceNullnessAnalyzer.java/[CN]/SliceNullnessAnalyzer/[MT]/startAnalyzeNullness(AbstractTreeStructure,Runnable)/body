{
  final SliceRootNode root=(SliceRootNode)treeStructure.getRootElement();
  final Ref<NullAnalysisResult> leafExpressions=Ref.create(null);
  final Map<SliceNode,NullAnalysisResult> map=createMap();
  ProgressManager.getInstance().run(new Task.Backgroundable(root.getProject(),"Expanding all nodes... (may very well take the whole day)",true){
    @Override public void run(    @NotNull final ProgressIndicator indicator){
      NullAnalysisResult l=calcNullableLeaves(root,treeStructure,map);
      leafExpressions.set(l);
    }
    @Override public void onCancel(){
      finish.run();
    }
    @Override public void onSuccess(){
      try {
        NullAnalysisResult leaves=leafExpressions.get();
        if (leaves == null)         return;
        groupByNullness(leaves,root,map);
      }
  finally {
        finish.run();
      }
    }
  }
);
}
