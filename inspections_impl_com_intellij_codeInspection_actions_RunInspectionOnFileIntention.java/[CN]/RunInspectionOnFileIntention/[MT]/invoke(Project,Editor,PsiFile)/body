{
  final InspectionManagerEx managerEx=((InspectionManagerEx)InspectionManagerEx.getInstance(project));
  final InspectionProfileImpl profile=new InspectionProfileImpl(InspectionProjectProfileManager.getInstance(project).getProfileName(file));
  final ModifiableModel model=profile.getModifiableModel();
  final InspectionProfileEntry[] profileEntries=model.getInspectionTools();
  for (  InspectionProfileEntry entry : profileEntries) {
    model.disableTool(entry.getShortName());
  }
  model.enableTool(myTool.getShortName());
  model.setEditable(false);
  managerEx.setExternalProfile((InspectionProfile)model);
  managerEx.RUN_WITH_EDITOR_PROFILE=false;
  managerEx.doInspections(new AnalysisScope(file));
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      managerEx.setExternalProfile(null);
    }
  }
);
}
