{
  final VirtualFile f=root.createChildData(null,"file.java");
  f.setBinaryContent("before".getBytes());
  performAllPendingJobs();
  ContentChangesListener l=new ContentChangesListener(f);
  addFileListenerDuring(l,new Callable(){
    public Object call() throws Exception {
      changeContentExternally(f.getPath(),"after");
      forceRefreshVFS(false);
      return null;
    }
  }
);
  assertEquals("before",l.getContentBefore());
  assertEquals("after",l.getContentAfter());
}
