{
  T[] result=myExtensionsCache;
  if (result == null) {
synchronized (this) {
      result=myExtensionsCache;
      if (result == null) {
        processAdapters();
        final Class<T> extensionClass=getExtensionClass();
        result=myExtensions.toArray((T[])Array.newInstance(extensionClass,myExtensions.size()));
        for (int i=result.length - 1; i >= 0; i--) {
          T t=result[i];
          if (i > 0 && result[i] == result[i - 1]) {
            LOG.error("Duplicate extension found: " + t + "; "+ " Result:      "+ Arrays.toString(result)+ ";\n"+ " extensions: "+ myExtensions+ ";\n"+ " getExtensionClass(): "+ extensionClass+ ";\n"+ " size:"+ myExtensions.size()+ ";"+ result.length);
          }
          if (!extensionClass.isAssignableFrom(t.getClass())) {
            LOG.error("Extension '" + t.getClass() + "' must be an instance of '"+ extensionClass+ "'",new ExtensionException(t.getClass()));
            result=ArrayUtil.remove(result,i);
          }
        }
        myExtensionsCache=result;
      }
    }
  }
  return result;
}
