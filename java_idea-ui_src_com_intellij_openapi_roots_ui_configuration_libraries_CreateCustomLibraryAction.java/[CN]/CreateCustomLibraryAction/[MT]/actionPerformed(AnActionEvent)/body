{
  final Tree parentComponent=ModuleStructureConfigurable.getInstance(myContext.getProject()).getTree();
  final NewLibraryConfiguration libraryConfiguration=myCreator.getDescription().createNewLibrary(parentComponent,null);
  if (libraryConfiguration == null) {
    return;
  }
  final NewLibraryEditor libraryEditor=new NewLibraryEditor(libraryConfiguration.getLibraryType(),libraryConfiguration.getProperties());
  libraryEditor.setName(libraryConfiguration.getDefaultLibraryName());
  libraryConfiguration.addRoots(libraryEditor);
  LibraryTablesRegistrar registrar=LibraryTablesRegistrar.getInstance();
  final Project project=myContext.getProject();
  final List<LibraryTable> tables=Arrays.asList(registrar.getLibraryTable(project),registrar.getLibraryTable());
  final CreateNewLibraryDialog dialog=new CreateNewLibraryDialog(parentComponent,myContext,libraryEditor,tables,0);
  dialog.show();
  if (dialog.isOK()) {
    final Library library=dialog.createLibrary();
    final ModifiableRootModel rootModel=myContext.getModulesConfigurator().getOrCreateModuleEditor(myModule).getModifiableRootModelProxy();
    if (!askAndRemoveDuplicatedLibraryEntry(myCreator.getDescription(),rootModel)) {
      return;
    }
    final LibraryOrderEntry orderEntry=rootModel.addLibraryEntry(library);
    myProjectStructureConfigurable.selectOrderEntry(myModule,orderEntry);
  }
}
