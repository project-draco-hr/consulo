{
  if (!isWithinBounds(range)) {
    return null;
  }
  DefaultArrangementEntry current=getCurrent();
  JavaElementArrangementEntry entry;
  if (canArrange) {
    TextRange expandedRange=ArrangementUtil.expandToLine(range,myDocument.getCharsSequence());
    TextRange rangeToUse=expandedRange == null ? range : expandedRange;
    entry=new JavaElementArrangementEntry(current,rangeToUse,type,name,expandedRange != null);
  }
 else {
    entry=new JavaElementArrangementEntry(current,range,type,name,false);
  }
  if (current == null) {
    myRootEntries.add(entry);
  }
 else {
    current.addChild(entry);
  }
  return entry;
}
