{
  String result=text;
  int index=text.indexOf(COMMENT_LINE_FOR_TEST_MODE_MACRO);
  if (index != -1) {
    String str1=result.substring(0,index);
    String str2=result.substring(index);
    int firstLineChar=Math.max(str1.lastIndexOf('\n'),str1.lastIndexOf('\r'));
    int lastLineChar=str2.indexOf('\n');
    int lastLineChar2=str2.indexOf('\r');
    if (lastLineChar == -1) {
      lastLineChar=lastLineChar2;
    }
 else     if (lastLineChar2 != -1) {
      lastLineChar=Math.min(lastLineChar,lastLineChar2);
    }
    if (firstLineChar != -1) {
      str1=str1.substring(0,firstLineChar);
    }
    if (lastLineChar != -1) {
      str2=str2.substring(lastLineChar);
    }
    result=commentTestModeLines(str1) + commentTestModeLines(str2);
  }
  return result;
}
