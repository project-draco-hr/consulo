{
  final ThreadReferenceProxyImpl threadToSelect=getDebuggerContext().getThreadProxy();
  if (threadToSelect == null)   return;
  final java.util.List<ThreadDescriptorImpl> threadItems=getThreadList();
  SuspendContextImpl threadContext=SuspendManagerUtil.getSuspendContextForThread(getDebuggerContext().getSuspendContext(),threadToSelect);
  getDebuggerContext().getDebugProcess().getManagerThread().invokeLater(new RefreshFramesListCommand(getDebuggerContext(),threadContext));
  DebuggerInvocationUtil.invokeLater(getProject(),new Runnable(){
    public void run(){
      try {
        myThreadsListener.setEnabled(false);
        myThreadsCombo.removeAllItems();
        for (Iterator<ThreadDescriptorImpl> iterator=threadItems.iterator(); iterator.hasNext(); ) {
          myThreadsCombo.addItem(iterator.next());
        }
        selectThread(threadToSelect);
      }
  finally {
        myThreadsListener.setEnabled(true);
      }
    }
  }
);
}
