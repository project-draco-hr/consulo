{
  if (findAppRoot(module) == null && module.getUserData(CREATE_APP_STRUCTURE) == Boolean.TRUE) {
    while (ModuleRootManager.getInstance(module).getSdk() == null) {
      if (Messages.showYesNoDialog(module.getProject(),"Cannot generate " + getDisplayName() + " project structure because JDK is not specified for module \""+ module.getName()+ "\".\n"+ getDisplayName()+ " project will not be created if you don't specify JDK.\nDo you want to specify JDK?","Error",Messages.getErrorIcon()) == 1) {
        return;
      }
      ProjectSettingsService.getInstance(module.getProject()).showModuleConfigurationDialog(module.getName(),ClasspathEditor.NAME,false);
    }
    module.putUserData(CREATE_APP_STRUCTURE,null);
    final int result=Messages.showYesNoCancelDialog(module.getProject(),"Create default " + getDisplayName() + " directory structure in module '"+ module.getName()+ "'?","Create " + getDisplayName() + " application","Run 'create-&app'","Run 'create-&plugin'","&Cancel",getIcon());
    if (result < 0 || result > 1) {
      return;
    }
    final ProcessBuilder pb=createCommandAndShowErrors(null,module,true,result == 0 ? "create-app" : "create-plugin");
    if (pb == null)     return;
    MvcConsole.getInstance(module.getProject()).executeProcess(module,pb,new Runnable(){
      public void run(){
        if (module.isDisposed())         return;
        VirtualFile root=findAppRoot(module);
        if (root == null)         return;
        PsiDirectory psiDir=PsiManager.getInstance(module.getProject()).findDirectory(root);
        IdeView ide=LangDataKeys.IDE_VIEW.getData(DataManager.getInstance().getDataContext());
        if (ide != null)         ide.selectElement(psiDir);
      }
    }
,true);
  }
}
