{
  try {
    ProcessBuilder builder=new ProcessBuilder(CommandLineBuilder.createFromJavaParameters(params).getCommands());
    Map<String,String> env=params.getEnv();
    if (env != null) {
      builder.environment().putAll(env);
    }
    String workDir=params.getWorkingDirectory();
    if (workDir != null) {
      builder.directory(new File(workDir));
    }
    return builder;
  }
 catch (  CantRunException e) {
    throw new RuntimeException(e);
  }
}
