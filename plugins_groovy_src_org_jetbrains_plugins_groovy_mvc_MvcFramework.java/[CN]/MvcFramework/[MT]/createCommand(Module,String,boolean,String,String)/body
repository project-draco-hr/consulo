{
  final JavaParameters params=createJavaParameters(module,forCreation,false,true,command,args);
  addJavaHome(params,module);
  if (!StringUtil.isEmpty(vmOptions)) {
    params.getVMParametersList().addParametersString(vmOptions);
  }
  final ProcessBuilder builder=createProcessBuilder(params);
  final VirtualFile griffonHome=getSdkRoot(module);
  if (griffonHome != null) {
    builder.environment().put(getSdkHomePropertyName(),FileUtil.toSystemDependentName(griffonHome.getPath()));
  }
  final VirtualFile root=findAppRoot(module);
  final File ioRoot=root != null ? VfsUtil.virtualToIoFile(root) : new File(module.getModuleFilePath()).getParentFile();
  builder.directory(forCreation ? ioRoot.getParentFile() : ioRoot);
  return builder;
}
