{
  LOG.assertTrue(myCurrentMergeCommand != null);
  if (change.isResolved(side))   return;
  if (!change.isChange(side)) {
    markChangeResolved(change);
    return;
  }
  ThreeSide sourceSide=side.select(ThreeSide.LEFT,ThreeSide.RIGHT);
  ThreeSide oppositeSide=side.select(ThreeSide.RIGHT,ThreeSide.LEFT);
  ThreeSide outputSide=ThreeSide.BASE;
  int outputStartLine=change.getStartLine(outputSide);
  int outputEndLine=change.getEndLine(outputSide);
  int sourceStartLine=change.getStartLine(sourceSide);
  int sourceEndLine=change.getEndLine(sourceSide);
  enterBulkChangeUpdateBlock();
  try {
    if (change.isConflict()) {
      boolean append=change.isOnesideAppliedConflict();
      int actualOutputStartLine=append ? outputEndLine : outputStartLine;
      DiffUtil.applyModification(getContent(outputSide).getDocument(),actualOutputStartLine,outputEndLine,getContent(sourceSide).getDocument(),sourceStartLine,sourceEndLine);
      if (outputStartLine == outputEndLine || append) {
        int newOutputEndLine=actualOutputStartLine + (sourceEndLine - sourceStartLine);
        moveChangesAfterInsertion(change,outputStartLine,newOutputEndLine);
      }
      if (modifier || change.getStartLine(oppositeSide) == change.getEndLine(oppositeSide)) {
        markChangeResolved(change);
      }
 else {
        change.markOnesideAppliedConflict();
        markChangeResolved(change,side);
      }
    }
 else {
      DiffUtil.applyModification(getContent(outputSide).getDocument(),outputStartLine,outputEndLine,getContent(sourceSide).getDocument(),sourceStartLine,sourceEndLine);
      if (outputStartLine == outputEndLine) {
        int newOutputEndLine=outputStartLine + (sourceEndLine - sourceStartLine);
        moveChangesAfterInsertion(change,outputStartLine,newOutputEndLine);
      }
      markChangeResolved(change);
    }
  }
  finally {
    exitBulkChangeUpdateBlock();
  }
}
