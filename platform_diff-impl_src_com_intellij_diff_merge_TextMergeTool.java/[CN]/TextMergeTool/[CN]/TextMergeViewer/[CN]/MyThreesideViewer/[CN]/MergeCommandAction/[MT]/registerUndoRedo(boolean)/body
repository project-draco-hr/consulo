{
  if (myUndoManager == null)   return;
  List<TextMergeChange> affectedChanges=getAffectedChanges();
  final List<TextMergeChange.State> states=new ArrayList<TextMergeChange.State>(affectedChanges.size());
  for (  TextMergeChange change : affectedChanges) {
    states.add(change.storeState());
  }
  myUndoManager.undoableActionPerformed(new BasicUndoableAction(myDocument){
    @Override public void undo() throws UnexpectedUndoException {
      if (undo)       restoreStates(states);
    }
    @Override public void redo() throws UnexpectedUndoException {
      if (!undo)       restoreStates(states);
    }
  }
);
}
