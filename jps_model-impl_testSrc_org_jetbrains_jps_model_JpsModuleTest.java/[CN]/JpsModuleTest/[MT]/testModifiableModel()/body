{
  final JpsModule module=myModel.getProject().addModule("m",JpsJavaModuleType.INSTANCE);
  final JpsModuleSourceRoot root0=module.addSourceRoot("url1",JavaSourceRootType.SOURCE);
  myDispatcher.clear();
  final JpsModel modifiableModel=myModel.createModifiableModel(new TestJpsEventDispatcher());
  final JpsModule modifiableModule=assertOneElement(modifiableModel.getProject().getModules());
  modifiableModule.addSourceRoot("url2",JavaSourceRootType.TEST_SOURCE);
  modifiableModel.commit();
  assertEmpty(myDispatcher.retrieveAdded(JpsModule.class));
  assertEmpty(myDispatcher.retrieveRemoved(JpsModule.class));
  final List<? extends JpsModuleSourceRoot> roots=module.getSourceRoots();
  assertEquals(2,roots.size());
  assertSame(root0,roots.get(0));
  final JpsModuleSourceRoot root1=roots.get(1);
  assertEquals("url2",root1.getUrl());
  assertOrderedEquals(myDispatcher.retrieveAdded(JpsModuleSourceRoot.class),root1);
  assertEmpty(myDispatcher.retrieveChanged(JpsModuleSourceRoot.class));
}
