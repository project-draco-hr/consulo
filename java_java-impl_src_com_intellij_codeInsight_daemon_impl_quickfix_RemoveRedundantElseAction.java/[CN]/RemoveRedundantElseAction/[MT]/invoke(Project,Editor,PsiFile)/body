{
  if (!CodeInsightUtilBase.prepareFileForWrite(file))   return;
  PsiElement elementAt=file.findElementAt(editor.getCaretModel().getOffset());
  PsiIfStatement ifStatement=(PsiIfStatement)elementAt.getParent();
  LOG.assertTrue(ifStatement != null && ifStatement.getElseBranch() != null);
  PsiStatement elseBranch=ifStatement.getElseBranch();
  if (elseBranch instanceof PsiBlockStatement) {
    PsiElement[] statements=((PsiBlockStatement)elseBranch).getCodeBlock().getStatements();
    if (statements.length > 0) {
      ifStatement.getParent().addRangeAfter(statements[0],statements[statements.length - 1],ifStatement);
    }
  }
 else {
    ifStatement.getParent().addAfter(elseBranch,ifStatement);
  }
  ifStatement.getElseBranch().delete();
}
