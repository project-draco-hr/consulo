{
  final List<ASTNode> parents=new ArrayList<ASTNode>(20);
  while (node != null) {
    ASTNode nodeTreeParent=node.getTreeParent();
    if (nodeTreeParent == null)     break;
    if (!index.contains(node)) {
      ASTNode current=nodeTreeParent.getFirstChildNode();
      int rootIndex=0;
      while (current != null) {
        index.put(current,rootIndex);
        current=current.getTreeNext();
        rootIndex++;
      }
    }
    parents.add(node);
    node=nodeTreeParent;
  }
  final int[] root=new int[parents.size()];
  for (int i=0; i < root.length; i++) {
    final ASTNode parent=parents.get(root.length - i - 1);
    root[i]=index.get(parent);
  }
  return root;
}
