{
  if (myChangedInOrderNew == null) {
    myChangedInOrderNew=new ArrayList<ASTNode>(myChangedElements.keySet());
    Collections.sort(myChangedInOrderNew,new Comparator<ASTNode>(){
      final Map<ASTNode,int[]> routeMap=new THashMap<ASTNode,int[]>(myChangedElements.size());
      final TObjectIntHashMap<ASTNode> nodeIndex=new TObjectIntHashMap<ASTNode>(myChangedElements.size());
      @Override public int compare(      ASTNode o1,      ASTNode o2){
        int[] route=routeMap.get(o1);
        if (route == null)         routeMap.put(o1,route=getRoute(o1,nodeIndex));
        int[] route2=routeMap.get(o2);
        if (route2 == null)         routeMap.put(o2,route2=getRoute(o2,nodeIndex));
        return compareRoutes(route,route2);
      }
    }
);
    int size=myChangedInOrderNew.size();
    if (size == myChangedInOrder.size()) {
      for (int i=0; i < size; ++i) {
        if (myChangedInOrderNew.get(i) != myChangedInOrder.get(i)) {
          LoggerFactory.getInstance().getLoggerInstance(getClass().getName()).error("Unexpected changed elements difference");
          return myChangedInOrder.toArray(new ASTNode[myChangedInOrder.size()]);
        }
      }
    }
 else {
      LoggerFactory.getInstance().getLoggerInstance(getClass().getName()).error("Unexpected changed elements difference");
      return myChangedInOrder.toArray(new ASTNode[myChangedInOrder.size()]);
    }
  }
  return myChangedInOrderNew.toArray(new ASTNode[myChangedInOrderNew.size()]);
}
