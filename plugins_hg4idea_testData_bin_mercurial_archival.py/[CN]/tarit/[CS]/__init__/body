def __init__(self, dest, prefix, mtime, kind=''):
    self.prefix = tidyprefix(dest, prefix, ['.tar', '.tar.bz2', '.tar.gz', '.tgz', '.tbz2'])
    self.mtime = mtime

    def taropen(name, mode, fileobj=None):
        if (kind == 'gz'):
            mode = mode[0]
            if (not fileobj):
                fileobj = open(name, (mode + 'b'))
            gzfileobj = self.GzipFileWithTime(name, (mode + 'b'), zlib.Z_BEST_COMPRESSION, fileobj, timestamp=mtime)
            return tarfile.TarFile.taropen(name, mode, gzfileobj)
        else:
            return tarfile.open(name, (mode + kind), fileobj)
    if isinstance(dest, str):
        self.z = taropen(dest, mode='w:')
    else:
        self.z = taropen(name='', mode='w|', fileobj=dest)
