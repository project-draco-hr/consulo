def addfile(self, name, mode, islink, data):
    if islink:
        self.opener.symlink(data, name)
        return
    f = self.opener(name, 'w', atomictemp=True)
    f.write(data)
    f.rename()
    destfile = os.path.join(self.basedir, name)
    os.chmod(destfile, mode)
