{
  final Project project=location.getProject();
  final PsiElement element=location.getPsiElement();
  myPackage=checkPackage(element);
  if (myPackage == null)   return null;
  final JavaPsiFacade facade=JavaPsiFacade.getInstance(project);
  boolean junitJarFound=false;
  final Module locationModule=location.getModule();
  if (locationModule != null) {
    junitJarFound=facade.findClass(JUnitUtil.TESTCASE_CLASS,GlobalSearchScope.moduleWithDependenciesAndLibrariesScope(locationModule,true)) != null;
  }
 else {
    for (    PsiDirectory directory : myPackage.getDirectories()) {
      final Module module=ModuleUtil.findModuleForFile(directory.getVirtualFile(),project);
      if (module != null) {
        if (facade.findClass(JUnitUtil.TESTCASE_CLASS,GlobalSearchScope.moduleWithDependenciesAndLibrariesScope(module,true)) != null) {
          junitJarFound=true;
          break;
        }
      }
    }
  }
  if (!junitJarFound)   return null;
  RunnerAndConfigurationSettings settings=cloneTemplateConfiguration(project,context);
  final JUnitConfiguration configuration=(JUnitConfiguration)settings.getConfiguration();
  final JUnitConfiguration.Data data=configuration.getPersistentData();
  data.PACKAGE_NAME=myPackage.getQualifiedName();
  data.TEST_OBJECT=JUnitConfiguration.TEST_PACKAGE;
  data.setScope(setupPackageConfiguration(context,project,configuration,data.getScope()));
  configuration.setGeneratedName();
  JavaRunConfigurationExtensionManager.getInstance().extendCreatedConfiguration(configuration,location);
  return settings;
}
