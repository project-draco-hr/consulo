{
  final CompilerModuleExtension compilerModuleExtension=rootModel.getModuleExtension(CompilerModuleExtension.class);
  compilerModuleExtension.setExcludeOutput(true);
  if (myJdk != null) {
    rootModel.setSdk(myJdk);
  }
 else {
    rootModel.inheritSdk();
  }
  ContentEntry contentEntry=doAddContentEntry(rootModel);
  if (contentEntry != null) {
    final List<Pair<String,String>> sourcePaths=getSourcePaths();
    if (sourcePaths != null) {
      for (      final Pair<String,String> sourcePath : sourcePaths) {
        final VirtualFile sourceRoot=LocalFileSystem.getInstance().refreshAndFindFileByPath(FileUtil.toSystemIndependentName(sourcePath.first));
        if (sourceRoot != null) {
          contentEntry.addSourceFolder(sourceRoot,false,sourcePath.second);
        }
      }
    }
  }
  if (myCompilerOutputPath != null) {
    String canonicalPath;
    try {
      canonicalPath=FileUtil.resolveShortWindowsName(myCompilerOutputPath);
    }
 catch (    IOException e) {
      canonicalPath=myCompilerOutputPath;
    }
    compilerModuleExtension.setCompilerOutputPath(VfsUtil.pathToUrl(FileUtil.toSystemIndependentName(canonicalPath)));
  }
 else {
    compilerModuleExtension.inheritCompilerOutputPath(true);
  }
  LibraryTable libraryTable=rootModel.getModuleLibraryTable();
  for (  Pair<String,String> libInfo : myModuleLibraries) {
    final String moduleLibraryPath=libInfo.first;
    final String sourceLibraryPath=libInfo.second;
    Library library=libraryTable.createLibrary();
    Library.ModifiableModel modifiableModel=library.getModifiableModel();
    modifiableModel.addRoot(getUrlByPath(moduleLibraryPath),OrderRootType.CLASSES);
    if (sourceLibraryPath != null) {
      modifiableModel.addRoot(getUrlByPath(sourceLibraryPath),OrderRootType.SOURCES);
    }
    modifiableModel.commit();
  }
}
