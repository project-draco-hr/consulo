{
  if (!myUpdateNeeded)   return;
  myAlarm.cancelAllRequests();
  myAlarm.addRequest(new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          int selected=myTreeTable.getSelectedRow();
          if (selected < 0 || selected >= myTemplates.size()) {
            myEditor.getDocument().replaceString(0,myEditor.getDocument().getTextLength(),"");
          }
 else {
            TemplateKey templateKey=getTemplateKey(selected);
            if (templateKey != null) {
              TemplateImpl template=myTemplates.get(templateKey);
              String text=template.getString();
              myEditor.getDocument().replaceString(0,myEditor.getDocument().getTextLength(),text);
              TemplateEditorUtil.setHighlighter(myEditor,template.getTemplateContext());
            }
 else {
              myEditor.getDocument().replaceString(0,myEditor.getDocument().getTextLength(),"");
            }
          }
        }
      }
);
    }
  }
,100);
}
