{
  LOG.assertTrue(object != null,"Lookup item can't be null!");
  if (object instanceof PsiType) {
    PsiType psiType=(PsiType)object;
    for (Iterator iterator=set.iterator(); iterator.hasNext(); ) {
      LookupItem lookupItem=(LookupItem)iterator.next();
      Object o=lookupItem.getObject();
      if (o.equals(psiType)) {
        return lookupItem;
      }
    }
  }
  LookupItem item=LookupItemUtil.objectToLookupItem(object);
  String text=item.getLookupString();
  for (  Object o : set) {
    if (o instanceof LookupItem) {
      final LookupItem lookupItem=(LookupItem)o;
      if (lookupItem.getObject().equals(o))       return null;
    }
  }
  if (CompletionUtil.startsWith(text,prefix)) {
    item.setLookupString(text);
    if (tailType >= 0) {
      item.setAttribute(CompletionUtil.TAIL_TYPE_ATTR,new Integer(tailType));
    }
    return set.add(item) ? item : null;
  }
 else {
    return null;
  }
}
