{
  writer=new BufferedWriter(writer);
  try {
    if (fileNameToEntryMap.size() == 0) {
      writer.write(DIRECTORY_PREFIX);
      writer.write(lineSeparator);
    }
 else {
      final Entry[] entryArray=new Entry[fileNameToEntryMap.size()];
      fileNameToEntryMap.values().toArray(entryArray);
      Arrays.sort(entryArray,new EntriesComparator());
      for (int i=0; i < entryArray.length; i++) {
        final Entry entry=entryArray[i];
        writer.write(entry.toString());
        writer.write(lineSeparator);
      }
    }
  }
  finally {
    writer.close();
  }
}
