{
  final AndroidLayoutPreviewToolWindowSettings.GlobalState state=mySettings.getGlobalState();
  if (myResetFlag) {
    final LayoutDevice selectedDevice=getSelectedDevice();
    if (selectedDevice != null) {
      state.setDevice(selectedDevice.getName());
    }
    final LayoutDeviceConfiguration deviceConfig=getSelectedDeviceConfiguration();
    final VirtualFile vFile=getVirtualFile();
    if (deviceConfig != null && vFile != null) {
      final LayoutDeviceConfiguration defaultConfig=getDefaultDeviceConfigForFile(vFile);
      final String defaultConfigName=defaultConfig != null ? defaultConfig.getName() : null;
      final String deviceConfigName=deviceConfig.getName();
      if (Comparing.equal(deviceConfigName,defaultConfigName)) {
        mySettings.removeDeviceConfiguration(vFile);
      }
 else {
        mySettings.setDeviceConfiguration(vFile,deviceConfigName);
      }
    }
    final UiMode dockMode=getSelectedDockMode();
    if (dockMode != null) {
      state.setDockMode(dockMode.getResourceValue());
    }
    final NightMode nightMode=getSelectedNightMode();
    if (nightMode != null) {
      state.setNightMode(nightMode.getResourceValue());
    }
    final LocaleData localeData=getSelectedLocaleData();
    if (localeData != null) {
      state.setLocaleLanguage(localeData.getLanguage());
      state.setLocaleRegion(localeData.getRegion());
    }
    final IAndroidTarget target=getSelectedTarget();
    if (target != null) {
      state.setTargetHashString(target.hashString());
    }
  }
  if (myThemesResetFlag) {
    final ThemeData theme=getSelectedTheme();
    if (theme != null) {
      state.setTheme(theme.getName());
    }
  }
}
