{
  final Manifest manifest=facet.getManifest();
  if (manifest == null) {
    return;
  }
  final Application application=manifest.getApplication();
  if (application == null) {
    return;
  }
  final List<ThemeData> activityThemesList=new ArrayList<ThemeData>();
  final XmlTag applicationTag=application.getXmlTag();
  ThemeData preferredTheme=null;
  if (applicationTag != null) {
    final String applicationThemeRef=applicationTag.getAttributeValue("theme",SdkConstants.NS_RESOURCES);
    if (applicationThemeRef != null) {
      preferredTheme=getThemeByRef(applicationThemeRef);
    }
  }
  if (preferredTheme == null) {
    final AndroidPlatform platform=AndroidPlatform.getInstance(facet.getModule());
    final IAndroidTarget target=platform != null ? platform.getTarget() : null;
    final IAndroidTarget renderingTarget=getSelectedTarget();
    final LayoutDeviceConfiguration configuration=getSelectedDeviceConfiguration();
    final ScreenSizeQualifier screenSizeQualifier=configuration != null ? configuration.getConfiguration().getScreenSizeQualifier() : null;
    final ScreenSize screenSize=screenSizeQualifier != null ? screenSizeQualifier.getValue() : null;
    preferredTheme=getThemeByRef(getDefaultTheme(target,renderingTarget,screenSize));
  }
  if (!addedThemes.contains(preferredTheme) && fromProject == preferredTheme.isProjectTheme()) {
    addedThemes.add(preferredTheme);
    resultList.add(preferredTheme);
  }
  for (  Activity activity : application.getActivities()) {
    final XmlTag activityTag=activity.getXmlTag();
    if (activityTag != null) {
      final String activityThemeRef=activityTag.getAttributeValue("theme",SdkConstants.NS_RESOURCES);
      if (activityThemeRef != null) {
        final ThemeData activityTheme=getThemeByRef(activityThemeRef);
        if (!addedThemes.contains(activityTheme) && fromProject == activityTheme.isProjectTheme()) {
          addedThemes.add(activityTheme);
          activityThemesList.add(activityTheme);
        }
      }
    }
  }
  Collections.sort(activityThemesList);
  resultList.addAll(activityThemesList);
}
