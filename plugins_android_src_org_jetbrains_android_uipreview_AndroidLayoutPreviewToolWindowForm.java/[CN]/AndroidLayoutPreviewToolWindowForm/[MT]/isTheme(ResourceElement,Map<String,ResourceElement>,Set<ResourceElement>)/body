{
  if (!visitedElements.add(resElement)) {
    return false;
  }
  if (!(resElement instanceof Style)) {
    return false;
  }
  final String styleName=resElement.getName().getValue();
  if (styleName == null) {
    return false;
  }
  final ResourceValue parentStyleRef=((Style)resElement).getParentStyle().getValue();
  String parentStyleName=null;
  boolean frameworkStyle=false;
  if (parentStyleRef != null) {
    final String s=parentStyleRef.getResourceName();
    if (s != null) {
      parentStyleName=s;
      frameworkStyle=AndroidUtils.SYSTEM_RESOURCE_PACKAGE.equals(parentStyleRef.getPackage());
    }
  }
  if (parentStyleRef == null) {
    final int index=styleName.indexOf('.');
    if (index >= 0) {
      parentStyleName=styleName.substring(0,index);
    }
  }
  if (parentStyleRef != null) {
    if (frameworkStyle) {
      return parentStyleName.equals("Theme") || parentStyleName.startsWith("Theme.");
    }
 else {
      final ResourceElement parentStyle=styleMap.get(parentStyleName);
      if (parentStyle != null) {
        return isTheme(parentStyle,styleMap,visitedElements);
      }
    }
  }
  return false;
}
