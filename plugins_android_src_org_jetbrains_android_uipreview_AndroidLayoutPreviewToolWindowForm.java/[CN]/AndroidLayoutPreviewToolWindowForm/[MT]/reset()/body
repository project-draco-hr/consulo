{
  final AndroidLayoutPreviewToolWindowSettings.GlobalState state=mySettings.getGlobalState();
  final String savedDeviceName=state.getDevice();
  if (savedDeviceName != null) {
    Device savedDevice=null;
    for (    Device device : myDevices) {
      if (savedDeviceName.equals(device.getName())) {
        savedDevice=device;
        break;
      }
    }
    if (savedDevice != null) {
      myDevicesCombo.setSelectedItem(savedDevice);
    }
  }
  final VirtualFile vFile=getVirtualFile();
  if (vFile != null) {
    final String savedDeviceConfigName=mySettings.getDeviceConfiguration(vFile);
    if (savedDeviceConfigName != null) {
      State savedDeviceConfig=null;
      for (      State config : myDeviceConfigurations) {
        if (savedDeviceConfigName.equals(config.getName())) {
          savedDeviceConfig=config;
          break;
        }
      }
      if (savedDeviceConfig != null) {
        myDeviceConfigurationsCombo.setSelectedItem(savedDeviceConfig);
      }
    }
 else {
      final State defaultConfig=getDefaultDeviceConfigForFile(vFile);
      if (defaultConfig != null) {
        myDeviceConfigurationsCombo.setSelectedItem(defaultConfig);
      }
    }
  }
  final String savedTargetHashString=state.getTargetHashString();
  if (savedTargetHashString != null) {
    IAndroidTarget savedTarget=null;
    for (    IAndroidTarget target : myTargets) {
      if (savedTargetHashString.equals(target.hashString())) {
        savedTarget=target;
        break;
      }
    }
    if (savedTarget != null) {
      myTargetCombo.setSelectedItem(savedTarget);
    }
  }
  final String savedLocaleLanguage=state.getLocaleLanguage();
  final String savedLocaleRegion=state.getLocaleRegion();
  if (savedLocaleLanguage != null || savedLocaleRegion != null) {
    LocaleData savedLocale=null;
    LocaleData savedLocaleCandidate=null;
    for (    LocaleData locale : myLocales) {
      if (Comparing.equal(locale.getLanguage(),savedLocaleLanguage)) {
        if (Comparing.equal(locale.getRegion(),savedLocaleRegion)) {
          savedLocale=locale;
          break;
        }
 else         if (savedLocaleCandidate == null) {
          savedLocaleCandidate=locale;
        }
      }
    }
    if (savedLocale == null) {
      savedLocale=savedLocaleCandidate;
    }
    if (savedLocale != null) {
      myLocaleCombo.setSelectedItem(savedLocale);
    }
  }
  if (state.getDockMode() != null) {
    final UiMode savedDockMode=UiMode.getEnum(state.getDockMode());
    if (savedDockMode != null) {
      myDockModeCombo.setSelectedItem(savedDockMode);
    }
  }
  if (state.getNightMode() != null) {
    final NightMode savedNightMode=NightMode.getEnum(state.getNightMode());
    if (savedNightMode != null) {
      myNightCombo.setSelectedItem(savedNightMode);
    }
  }
}
