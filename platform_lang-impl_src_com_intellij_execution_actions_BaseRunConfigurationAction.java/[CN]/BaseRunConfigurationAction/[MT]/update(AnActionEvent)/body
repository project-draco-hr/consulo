{
  final ConfigurationContext context=ConfigurationContext.getFromContext(event.getDataContext());
  final Presentation presentation=event.getPresentation();
  final RunnerAndConfigurationSettings existing=context.findExisting();
  RunnerAndConfigurationSettings configuration=existing;
  if (configuration == null) {
    configuration=context.getConfiguration();
  }
  if (configuration == null) {
    presentation.setEnabled(false);
    presentation.setVisible(false);
  }
 else {
    presentation.setEnabled(true);
    presentation.setVisible(true);
    final List<RuntimeConfigurationProducer> producers=getEnabledProducers(context);
    if (existing == null && !producers.isEmpty()) {
      context.updateConfiguration(producers.get(0));
    }
    final String name=suggestRunActionName((LocatableConfiguration)configuration.getConfiguration());
    updatePresentation(presentation,existing != null || producers.size() <= 1 ? " " + name : "",context);
  }
}
