{
  myIndicator=indicator;
  final ProjectManager projectManager=ProjectManager.getInstance();
  projectManager.addProjectManagerListener(myProject,myCloseListener=new CloseListener());
  final Semaphore semaphore=((CompilerManagerImpl)CompilerManager.getInstance(myProject)).getCompilationSemaphore();
  try {
    while (!semaphore.tryAcquire(500,TimeUnit.MILLISECONDS)) {
      if (indicator.isCanceled()) {
        break;
      }
    }
  }
 catch (  InterruptedException ignored) {
  }
  try {
    if (!isHeadless()) {
      addIndicatorDelegate();
    }
    myCompileWork.run();
  }
  finally {
    indicator.stop();
    projectManager.removeProjectManagerListener(myProject,myCloseListener);
    semaphore.release();
  }
}
