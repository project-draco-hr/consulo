{
  myIndicator=indicator;
  final ProjectManager projectManager=ProjectManager.getInstance();
  projectManager.addProjectManagerListener(myProject,myCloseListener=new CloseListener());
  final Semaphore semaphore=((CompilerManagerImpl)CompilerManager.getInstance(myProject)).getCompilationSemaphore();
  semaphore.acquireUninterruptibly();
  try {
    if (!isHeadless()) {
      addIndicatorDelegate();
    }
    myCompileWork.run();
  }
  finally {
    indicator.stop();
    projectManager.removeProjectManagerListener(myProject,myCloseListener);
    semaphore.release();
  }
}
