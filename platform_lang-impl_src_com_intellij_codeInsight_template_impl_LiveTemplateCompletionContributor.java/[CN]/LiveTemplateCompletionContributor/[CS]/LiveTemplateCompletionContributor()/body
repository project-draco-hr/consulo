{
  extend(CompletionType.BASIC,PlatformPatterns.psiElement(),new CompletionProvider<CompletionParameters>(){
    @Override protected void addCompletions(    @NotNull CompletionParameters parameters,    ProcessingContext context,    @NotNull CompletionResultSet result){
      if (parameters.getInvocationCount() > 0)       return;
      final PsiFile file=parameters.getOriginalFile();
      final int offset=parameters.getOffset();
      final String prefix=result.getPrefixMatcher().getPrefix();
      for (      final TemplateImpl template : TemplateSettings.getInstance().getTemplates()) {
        final String key=template.getKey();
        if (prefix.equals(key)) {
          if (!template.isDeactivated() && !template.isSelectionTemplate() && TemplateManagerImpl.isApplicable(file,offset,template)) {
            result.addElement(LookupElementBuilder.create(key).setTypeText(template.getDescription()).setInsertHandler(new InsertHandler<LookupElement>(){
              @Override public void handleInsert(              InsertionContext context,              LookupElement item){
                context.getDocument().deleteString(context.getStartOffset(),context.getTailOffset());
                context.setAddCompletionChar(false);
                TemplateManager.getInstance(context.getProject()).startTemplate(context.getEditor(),template);
              }
            }
));
          }
        }
      }
    }
  }
);
}
