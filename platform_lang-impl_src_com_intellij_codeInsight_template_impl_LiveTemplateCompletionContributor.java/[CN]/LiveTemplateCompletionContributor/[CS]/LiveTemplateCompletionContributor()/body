{
  extend(CompletionType.BASIC,PlatformPatterns.psiElement(),new CompletionProvider<CompletionParameters>(){
    @Override protected void addCompletions(    @NotNull CompletionParameters parameters,    ProcessingContext context,    @NotNull CompletionResultSet result){
      if (parameters.getInvocationCount() > 0)       return;
      final PsiFile file=parameters.getOriginalFile();
      final int offset=parameters.getOffset();
      final String prefix=result.getPrefixMatcher().getPrefix();
      final TemplateImpl template=findApplicableTemplate(file,offset,prefix);
      if (template != null) {
        result.addElement(LookupElementBuilder.create(prefix).setTypeText(template.getDescription()).setInsertHandler(new InsertHandler<LookupElement>(){
          @Override public void handleInsert(          InsertionContext context,          LookupElement item){
            context.getDocument().deleteString(context.getStartOffset(),context.getTailOffset());
            context.setAddCompletionChar(false);
            TemplateManager.getInstance(context.getProject()).startTemplate(context.getEditor(),template);
          }
        }
));
      }
 else {
        for (        final TemplateImpl possible : listApplicableTemplates(file,offset)) {
          result.restartCompletionOnPrefixChange(possible.getKey());
        }
      }
    }
  }
);
}
