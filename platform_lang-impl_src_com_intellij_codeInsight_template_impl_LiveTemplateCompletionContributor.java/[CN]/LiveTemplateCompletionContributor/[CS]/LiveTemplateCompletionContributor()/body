{
  extend(CompletionType.BASIC,PlatformPatterns.psiElement(),new CompletionProvider<CompletionParameters>(){
    @Override protected void addCompletions(    @NotNull CompletionParameters parameters,    ProcessingContext context,    @NotNull CompletionResultSet result){
      if (parameters.getInvocationCount() > 0)       return;
      final PsiFile file=parameters.getOriginalFile();
      final int offset=parameters.getOffset();
      if (Registry.is("show.live.templates.in.completion")) {
        for (        final TemplateImpl possible : listApplicableTemplates(file,offset)) {
          result.addElement(new LiveTemplateLookupElement(possible.getKey(),possible));
        }
        return;
      }
      final String prefix=result.getPrefixMatcher().getPrefix();
      final TemplateImpl template=findApplicableTemplate(file,offset,prefix);
      if (template != null) {
        result.addElement(new LiveTemplateLookupElement(prefix,template));
      }
 else {
        for (        final TemplateImpl possible : listApplicableTemplates(file,offset)) {
          result.restartCompletionOnPrefixChange(possible.getKey());
        }
      }
    }
  }
);
}
