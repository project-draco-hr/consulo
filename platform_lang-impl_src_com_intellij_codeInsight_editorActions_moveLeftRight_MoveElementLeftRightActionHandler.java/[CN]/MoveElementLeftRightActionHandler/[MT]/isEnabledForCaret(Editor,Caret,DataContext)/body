{
  Project project=editor.getProject();
  if (project == null)   return false;
  Document document=editor.getDocument();
  if (!(document instanceof DocumentEx))   return false;
  PsiDocumentManager psiDocumentManager=PsiDocumentManager.getInstance(project);
  psiDocumentManager.commitDocument(document);
  PsiFile file=psiDocumentManager.getPsiFile(document);
  if (file == null || !file.isValid())   return false;
  PsiElement[] elementList=getElementList(file,caret.getSelectionStart(),caret.getSelectionEnd());
  return elementList != null;
}
