{
  visited.add(sourceFolder);
  final CompilerManager compilerManager=CompilerManager.getInstance(project);
  for (  VirtualFile child : sourceFolder.getChildren()) {
    if (child.exists()) {
      if (child.isDirectory()) {
        if (!visited.contains(child) && JavaResourceFilter.checkFolderForPackaging(child.getName()) && !compilerManager.isExcludedFromCompilation(child)) {
          writeStandardSourceFolderResources(project,jarBuilder,sourceRoot,child,visited,added);
        }
      }
 else       if (checkFileForPackaging(child) && !compilerManager.isExcludedFromCompilation(child)) {
        String relativePath=FileUtil.toSystemIndependentName(VfsUtil.getRelativePath(child,sourceRoot,File.separatorChar));
        if (relativePath != null && !added.contains(relativePath)) {
          File file=toIoFile(child);
          jarBuilder.writeFile(file,FileUtil.toSystemIndependentName(relativePath));
          added.add(relativePath);
        }
      }
    }
  }
}
