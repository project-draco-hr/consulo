{
  List<Library> addedLibraries=new ArrayList<Library>();
  List<FrameworkSupportSettings> selectedFrameworks=getFrameworksSettingsList(true);
  for (  FrameworkSupportSettings settings : selectedFrameworks) {
    FrameworkSupportConfigurable configurable=settings.getConfigurable();
    LibraryCompositionSettings compositionSettings=settings.getLibraryCompositionSettings();
    Library library=compositionSettings.createLibrary(rootModel);
    if (library != null) {
      addedLibraries.add(library);
      if (compositionSettings.getLibraryLevel() != LibrariesContainer.LibraryLevel.MODULE) {
        rootModel.addLibraryEntry(library);
      }
    }
    for (    Library usedLibrary : compositionSettings.getUsedLibraries()) {
      addedLibraries.add(usedLibrary);
      rootModel.addLibraryEntry(usedLibrary);
    }
    configurable.addSupport(module,rootModel,library);
  }
  for (  FrameworkSupportSettings settings : selectedFrameworks) {
    FrameworkSupportProvider provider=settings.myProvider;
    if (provider instanceof FacetTypeFrameworkSupportProvider) {
      ((FacetTypeFrameworkSupportProvider)provider).processAddedLibraries(module,addedLibraries);
    }
  }
}
