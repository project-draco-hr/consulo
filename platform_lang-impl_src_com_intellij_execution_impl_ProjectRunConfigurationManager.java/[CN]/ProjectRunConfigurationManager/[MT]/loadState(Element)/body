{
  if (myUnloadedElements != null) {
    myUnloadedElements.clear();
  }
  Set<String> existing=new THashSet<String>();
  for (Iterator<Element> iterator=state.getChildren().iterator(); iterator.hasNext(); ) {
    Element child=iterator.next();
    RunnerAndConfigurationSettings configuration=myManager.loadConfiguration(child,true);
    if (configuration != null) {
      existing.add(configuration.getUniqueID());
    }
 else     if (child.getName().equals(RunManagerImpl.CONFIGURATION)) {
      if (myUnloadedElements == null) {
        myUnloadedElements=new SmartList<Element>();
      }
      iterator.remove();
      myUnloadedElements.add(child);
    }
  }
  myManager.removeNotExistingSharedConfigurations(existing);
  if (myManager.getSelectedConfiguration() == null) {
    final List<RunConfiguration> allConfigurations=myManager.getAllConfigurationsList();
    for (    final RunConfiguration configuration : allConfigurations) {
      final RunnerAndConfigurationSettings settings=myManager.getSettings(allConfigurations.get(0));
      if (!(configuration instanceof UnknownRunConfiguration)) {
        myManager.setSelectedConfiguration(settings);
        break;
      }
    }
  }
  myManager.setOrdered(false);
  myManager.getSortedConfigurations();
}
