{
  if (psiBlock.getParent() instanceof PsiMethod) {
    final PsiClass containingClass=((PsiMethod)psiBlock.getParent()).getContainingClass();
    if (containingClass != null && PsiUtil.isLocalOrAnonymousClass(containingClass)) {
      final PsiElement parent=containingClass.getParent();
      final PsiCodeBlock block=DfaUtil.getTopmostBlockInSameClass(parent);
      if ((parent instanceof PsiNewExpression || parent instanceof PsiDeclarationStatement) && block != null) {
        final EnvironmentalInstructionVisitor envVisitor=new EnvironmentalInstructionVisitor(visitor,parent);
        final RunnerResult result=analyzeMethod(block,envVisitor);
        if (result == RunnerResult.OK) {
          final Collection<DfaMemoryState> closureStates=envVisitor.getClosureStates();
          if (!closureStates.isEmpty()) {
            return closureStates;
          }
        }
        return null;
      }
    }
  }
  return Arrays.asList(createMemoryState());
}
