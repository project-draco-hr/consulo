{
  final ProblemsHolder holder=new ProblemsHolder(manager);
  final PsiElementVisitor customVisitor=myTool.buildVisitor(holder,false);
  LOG.assertTrue(!(customVisitor instanceof PsiRecursiveElementVisitor),"The visitor returned from LocalInspectionTool.buildVisitor() must not be recursive");
  file.accept(new PsiRecursiveElementVisitor(){
    public void visitElement(    PsiElement element){
      element.accept(customVisitor);
      super.visitElement(element);
    }
    public void visitReferenceExpression(    PsiReferenceExpression expression){
      visitElement(expression);
    }
  }
);
  addProblemDescriptors(holder.getResults(),filterSuppressed);
}
