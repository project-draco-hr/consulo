{
  Runnable refresh=null;
  final VirtualFile vf=getVirtualFile();
  if (vf == null) {
    final LocalHistoryAction action=startLocalHistoryAction(revision);
    final VirtualFile vp=getVirtualParent();
    if (vp != null) {
      refresh=new Runnable(){
        public void run(){
          vp.refresh(false,true,new Runnable(){
            public void run(){
              myFilePath.refresh();
              action.finish();
            }
          }
);
        }
      }
;
    }
  }
 else {
    refresh=new Runnable(){
      public void run(){
        vf.refresh(false,false);
      }
    }
;
  }
  if (refresh != null) {
    ProgressManager.getInstance().runProcessWithProgressSynchronously(refresh,"Refreshing files...",false,myProject);
  }
}
