{
  mxGraphHierarchyModel model=layout.getModel();
  currentXDelta=0.0;
  initialCoords(layout.getGraph(),model);
  if (fineTuning) {
    minNode(model);
  }
  double bestXDelta=100000000.0;
  if (fineTuning) {
    for (int i=0; i < maxIterations; i++) {
      if (i != 0) {
        medianPos(i,model);
        minNode(model);
      }
      if (currentXDelta < bestXDelta) {
        for (int j=0; j < model.ranks.size(); j++) {
          mxGraphHierarchyRank rank=model.ranks.get(new Integer(j));
          Iterator<mxGraphAbstractHierarchyCell> iter=rank.iterator();
          while (iter.hasNext()) {
            mxGraphAbstractHierarchyCell cell=iter.next();
            cell.setX(j,cell.getGeneralPurposeVariable(j));
          }
        }
        bestXDelta=currentXDelta;
      }
 else {
        for (int j=0; j < model.ranks.size(); j++) {
          mxGraphHierarchyRank rank=model.ranks.get(new Integer(j));
          Iterator<mxGraphAbstractHierarchyCell> iter=rank.iterator();
          while (iter.hasNext()) {
            mxGraphAbstractHierarchyCell cell=iter.next();
            cell.setGeneralPurposeVariable(j,(int)cell.getX(j));
          }
        }
      }
      minPath(model);
      currentXDelta=0;
    }
  }
  setCellLocations(layout.getGraph(),model);
}
