{
  if (file != null && file.getFileSystem() instanceof DummyFileSystem) {
    return new VirtualFilePointerImpl(file,myVirtualFileManager);
  }
  String path=VfsUtil.urlToPath(url);
  VirtualFilePointer pointer=myUrlToPointerMap.get(path);
  final boolean notexists=pointer == null;
  if (notexists) {
    pointer=file == null ? new VirtualFilePointerImpl(url,myVirtualFileManager) : new VirtualFilePointerImpl(file,myVirtualFileManager);
    myUrlToPointerMap.put(path,pointer);
  }
  if (listener != null) {
    Set<VirtualFilePointer> pointerSet=myListenerToPointersMap.get(listener);
    if (pointerSet == null) {
      pointerSet=new THashSet<VirtualFilePointer>();
      myListenerToPointersMap.put(listener,pointerSet);
    }
    pointerSet.add(pointer);
  }
  return pointer;
}
