{
  if (file != null && file.getFileSystem() instanceof DummyFileSystem) {
    return new VirtualFilePointerImpl(file,file.getUrl(),myVirtualFileManager,listener,parentDisposable);
  }
  TreeMap<String,VirtualFilePointerImpl> pathToPointer=getPathToPointerMap(listener);
  url=FileUtil.toSystemIndependentName(url);
  String path=urlToPath(url);
  VirtualFilePointerImpl pointer=pathToPointer.get(path);
  final boolean notexists=pointer == null;
  if (notexists) {
    pointer=new VirtualFilePointerImpl(file,url,myVirtualFileManager,listener,parentDisposable);
    pathToPointer.put(path,pointer);
  }
  int newCount=pointer.incrementUsageCount();
  if (newCount == 1) {
    Disposer.register(parentDisposable,pointer);
  }
 else {
    final VirtualFilePointerImpl pointer1=pointer;
    Disposer.register(parentDisposable,new Disposable(){
      public void dispose(){
        pointer1.dispose();
      }
    }
);
  }
  return pointer;
}
