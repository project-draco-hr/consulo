{
  if (file != null && file.getFileSystem() instanceof DummyFileSystem) {
    return new VirtualFilePointerImpl(file,file.getUrl(),myVirtualFileManager,listener,parentDisposable);
  }
  url=FileUtil.toSystemIndependentName(url);
  String protocol=VirtualFileManager.extractProtocol(url);
  VirtualFileSystem fileSystem=myVirtualFileManager.getFileSystem(protocol);
  if (fileSystem == null) {
    return new NullVirtualFilePointer(url);
  }
  url=stripTrailingPathSeparator(url,protocol);
  String path=urlToPath(url);
  VirtualFilePointerImpl pointer=getOrCreate(file,url,parentDisposable,listener,path);
  int newCount=pointer.incrementUsageCount();
  if (newCount == 1) {
    Disposer.register(parentDisposable,pointer);
  }
 else {
    Disposer.register(parentDisposable,new DelegatingDisposable(pointer));
  }
  return pointer;
}
