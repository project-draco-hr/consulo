{
  cleanContainerCaches();
  List<VirtualFilePointer> toFireEvents=new ArrayList<VirtualFilePointer>();
  List<String> toUpdateUrl=new ArrayList<String>();
  for (  VFileEvent event : events) {
    if (event instanceof VFileDeleteEvent) {
      final VFileDeleteEvent deleteEvent=(VFileDeleteEvent)event;
      String url=deleteEvent.getFile().getPath();
      toFireEvents.addAll(getPointersUnder(url));
    }
 else     if (event instanceof VFileCreateEvent) {
      final VFileCreateEvent createEvent=(VFileCreateEvent)event;
      String url=createEvent.getPath();
      toFireEvents.addAll(getPointersUnder(url));
    }
 else     if (event instanceof VFileCopyEvent) {
      final VFileCopyEvent copyEvent=(VFileCopyEvent)event;
      String url=copyEvent.getNewParent().getPath() + "/" + copyEvent.getFile().getName();
      toFireEvents.addAll(getPointersUnder(url));
    }
 else     if (event instanceof VFileMoveEvent) {
      final VFileMoveEvent moveEvent=(VFileMoveEvent)event;
      List<VirtualFilePointer> pointers=getPointersUnder(moveEvent.getFile().getPath());
      for (      VirtualFilePointer pointer : pointers) {
        VirtualFile file=pointer.getFile();
        if (file != null) {
          toUpdateUrl.add(file.getPath());
        }
      }
    }
 else     if (event instanceof VFilePropertyChangeEvent) {
      final VFilePropertyChangeEvent change=(VFilePropertyChangeEvent)event;
      if (VirtualFile.PROP_NAME.equals(change.getPropertyName())) {
        List<VirtualFilePointer> pointers=getPointersUnder(change.getFile().getPath());
        for (        VirtualFilePointer pointer : pointers) {
          VirtualFile file=pointer.getFile();
          if (file != null) {
            toUpdateUrl.add(file.getPath());
          }
        }
      }
    }
  }
  myEvents=new ArrayList<EventDescriptor>();
  for (  VirtualFilePointerListener listener : myListenerToPointersMap.keySet()) {
    EventDescriptor event=new EventDescriptor(listener,toFireEvents);
    myEvents.add(event);
    event.fireBefore();
  }
  myPointersToUdate=toFireEvents;
  myUrlsToUpdate=toUpdateUrl;
}
