{
  if (registry.isEmpty()) {
    return null;
  }
  List<FakeRerunAction> candidates=new ArrayList<FakeRerunAction>(registry);
  Collections.sort(candidates,new Comparator<FakeRerunAction>(){
    @Override public int compare(    @NotNull FakeRerunAction action1,    @NotNull FakeRerunAction action2){
      boolean isActive1=action1.isEnabled(event);
      if (isActive1 != action2.isEnabled(event)) {
        return isActive1 ? -1 : 1;
      }
      JComponent component1=action1.getRunComponent(event);
      JComponent component2=action2.getRunComponent(event);
      Window window1=component1 == null ? null : SwingUtilities.windowForComponent(component1);
      Window window2=component2 == null ? null : SwingUtilities.windowForComponent(component2);
      if (window1 == null) {
        return 1;
      }
      if (window2 == null) {
        return -1;
      }
      boolean showing1=component1.isShowing();
      boolean showing2=component2.isShowing();
      if (showing1 && !showing2) {
        return -1;
      }
      if (showing2 && !showing1) {
        return 1;
      }
      return (window1.isActive() ? -1 : 1);
    }
  }
);
  return candidates.get(0);
}
