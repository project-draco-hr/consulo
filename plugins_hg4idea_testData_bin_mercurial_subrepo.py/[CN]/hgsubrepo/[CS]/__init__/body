def __init__(self, ctx, path, state):
    self._path = path
    self._state = state
    r = ctx._repo
    root = r.wjoin(path)
    create = False
    if (not os.path.exists(os.path.join(root, '.hg'))):
        create = True
        util.makedirs(root)
    self._repo = hg.repository(r.ui, root, create=create)
    self._repo._subparent = r
    self._repo._subsource = state[0]
    if create:
        fp = self._repo.opener('hgrc', 'w', text=True)
        fp.write('[paths]\n')

        def addpathconfig(key, value):
            fp.write(('%s = %s\n' % (key, value)))
            self._repo.ui.setconfig('paths', key, value)
        defpath = _abssource(self._repo)
        defpushpath = _abssource(self._repo, True)
        addpathconfig('default', defpath)
        if (defpath != defpushpath):
            addpathconfig('default-push', defpushpath)
        fp.close()
