def subrepo(ctx, path):
    global hg
    import hg as h
    hg = h
    util.path_auditor(ctx._repo.root)(path)
    state = ctx.substate.get(path, nullstate)
    if (state[2] not in types):
        raise util.Abort((_('unknown subrepo type %s') % state[2]))
    return types[state[2]](ctx, path, state[:2])
