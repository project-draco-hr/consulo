{
  final String substitutedPath=genOptions.subsitutePathWithMacros(path);
  if (!substitutedPath.equals(path)) {
    return substitutedPath;
  }
  if (baseDir != null) {
    final String relativepath=FileUtil.getRelativePath(baseDir,new File(path));
    if (relativepath != null) {
      final boolean shouldUseAbsolutePath=useAbsolutePathsForOuterPaths && relativepath.indexOf("..") >= 0;
      if (!shouldUseAbsolutePath) {
        final String _relativePath=relativepath.replace(File.separatorChar,'/');
        final String root=BuildProperties.propertyRef(baseDirPropertyName);
        return ".".equals(_relativePath) ? root : root + "/" + _relativePath;
      }
    }
  }
  return substitutedPath;
}
