{
  TextEditorHighlightingPassRegistrarEx registrar=TextEditorHighlightingPassRegistrarEx.getInstanceEx(file.getProject());
  final List<TextEditorHighlightingPass> passes=registrar.instantiatePasses(file,editor,toIgnore);
  final ProgressIndicator progress=new DaemonProgressIndicator();
  ProgressManager.getInstance().runProcess(new Runnable(){
    public void run(){
      for (      TextEditorHighlightingPass pass : passes) {
        pass.collectInformation(progress);
      }
      for (      TextEditorHighlightingPass pass : passes) {
        pass.applyInformationToEditor();
      }
    }
  }
,progress);
  List<HighlightInfo> infos=DaemonCodeAnalyzerImpl.getHighlights(editor.getDocument(),file.getProject());
  return infos == null ? Collections.<HighlightInfo>emptyList() : new ArrayList<HighlightInfo>(infos);
}
