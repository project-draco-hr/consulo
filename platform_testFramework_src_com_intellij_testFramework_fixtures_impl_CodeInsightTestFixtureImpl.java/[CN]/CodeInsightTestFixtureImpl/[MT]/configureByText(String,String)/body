{
  assertInitialized();
  final VirtualFile vFile;
  if (myTempDirFixture instanceof LightTempDirTestFixtureImpl) {
    final VirtualFile root=LightPlatformTestCase.getSourceRoot();
    root.refresh(false,false);
    vFile=root.findOrCreateChildData(this,fileName);
  }
 else {
    String prefix=StringUtil.getPackageName(fileName);
    if (prefix.length() < 3) {
      prefix+="___";
    }
    final File tempFile=File.createTempFile(prefix,"." + StringUtil.getShortName(fileName),new File(getTempDirPath()));
    vFile=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(tempFile);
  }
  VfsUtil.saveText(vFile,text);
  configureInner(vFile,SelectionAndCaretMarkupLoader.fromFile(vFile,getProject()));
  return myFile;
}
