{
  assertInitialized();
  myEmptyLookup=false;
  UIUtil.invokeAndWaitIfNeeded(new Runnable(){
    @Override public void run(){
      CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
        @Override public void run(){
          final CodeCompletionHandlerBase handler=new CodeCompletionHandlerBase(type){
            @Override protected void completionFinished(            int offset1,            int offset2,            CompletionProgressIndicator indicator,            LookupElement[] items,            boolean hasModifiers){
              myEmptyLookup=items.length == 0;
              super.completionFinished(offset1,offset2,indicator,items,hasModifiers);
            }
          }
;
          Editor editor=getCompletionEditor();
          handler.invokeCompletion(getProject(),editor,invocationCount);
          PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
        }
      }
,null,null);
    }
  }
);
  return getLookupElements();
}
