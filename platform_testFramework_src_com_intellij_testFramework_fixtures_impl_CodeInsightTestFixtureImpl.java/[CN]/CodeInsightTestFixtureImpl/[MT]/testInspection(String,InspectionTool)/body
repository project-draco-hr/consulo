{
  VirtualFile sourceDir=copyDirectoryToProject(new File(testDir,"src").getPath(),"src");
  AnalysisScope scope=new AnalysisScope(getPsiManager().findDirectory(sourceDir));
  InspectionManagerEx inspectionManager=(InspectionManagerEx)InspectionManager.getInstance(getProject());
  final GlobalInspectionContextImpl globalContext=inspectionManager.createNewGlobalContext(!(myProjectFixture instanceof LightIdeaTestFixture));
  globalContext.setCurrentScope(scope);
  scope.invalidate();
  InspectionTestUtil.runTool(tool,scope,globalContext,inspectionManager);
  InspectionTestUtil.compareToolResults(tool,false,new File(getTestDataPath(),testDir).getPath());
}
