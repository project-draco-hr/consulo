{
  final Project project=myProjectFixture.getProject();
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  return ApplicationManager.getApplication().runReadAction(new Computable<List<HighlightInfo>>(){
    public List<HighlightInfo> compute(){
      final List<TextEditorHighlightingPass> passes=TextEditorHighlightingPassRegistrarEx.getInstanceEx(getProject()).instantiatePasses(getFile(),getEditor(),ArrayUtil.EMPTY_INT_ARRAY);
      final ProgressIndicator progress=new DaemonProgressIndicator();
      ProgressManager.getInstance().runProcess(new Runnable(){
        public void run(){
          for (          TextEditorHighlightingPass pass : passes) {
            pass.collectInformation(progress);
          }
          for (          TextEditorHighlightingPass pass : passes) {
            pass.applyInformationToEditor();
          }
        }
      }
,progress);
      List<HighlightInfo> infos=DaemonCodeAnalyzerImpl.getHighlights(getEditor().getDocument(),getProject());
      return infos == null ? Collections.<HighlightInfo>emptyList() : new ArrayList<HighlightInfo>(infos);
    }
  }
);
}
