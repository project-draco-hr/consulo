{
  final Project project=getProject();
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  PsiFile file=getFile();
  Editor editor=getEditor();
  if (editor instanceof EditorWindow) {
    editor=((EditorWindow)editor).getDelegate();
    file=InjectedLanguageUtil.getTopLevelFile(file);
  }
  return instantiateAndRun(file,editor,ArrayUtil.EMPTY_INT_ARRAY,myAllowDirt);
}
