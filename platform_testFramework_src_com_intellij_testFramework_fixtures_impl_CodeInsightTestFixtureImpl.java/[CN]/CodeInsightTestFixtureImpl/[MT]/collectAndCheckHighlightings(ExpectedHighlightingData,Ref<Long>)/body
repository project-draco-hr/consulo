{
  final Project project=getProject();
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  ((PsiFileImpl)myFile).calcTreeElement();
  if (!DumbService.isDumb(project)) {
    CacheManager.SERVICE.getInstance(project).getFilesWithWord(XXX,UsageSearchContext.IN_COMMENTS,GlobalSearchScope.allScope(project),true);
  }
  List<HighlightInfo> infos;
  try {
    ((PsiManagerImpl)PsiManager.getInstance(project)).setAssertOnFileLoadingFilter(myJavaFilesFilter);
    final long start=System.currentTimeMillis();
    infos=doHighlighting();
    removeDuplicatedRangesForInjected(infos);
    final long elapsed=System.currentTimeMillis() - start;
    duration.set(duration.isNull() ? elapsed : duration.get().longValue() + elapsed);
  }
  finally {
    ((PsiManagerImpl)PsiManager.getInstance(project)).setAssertOnFileLoadingFilter(VirtualFileFilter.NONE);
  }
  data.checkResult(infos,myEditor.getDocument().getText());
}
