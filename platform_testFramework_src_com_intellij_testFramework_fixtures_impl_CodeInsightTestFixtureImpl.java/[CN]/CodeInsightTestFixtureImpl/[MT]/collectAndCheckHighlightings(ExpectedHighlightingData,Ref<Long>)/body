{
  final Project project=getProject();
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  ((PsiFileImpl)myFile).calcTreeElement();
  myPsiManager.getCacheManager().getFilesWithWord(XXX,UsageSearchContext.IN_COMMENTS,GlobalSearchScope.allScope(project),true);
  VirtualFileFilter javaFilesFilter=new VirtualFileFilter(){
    public boolean accept(    VirtualFile file){
      if (myAddedClasses.contains(file))       return false;
      FileType fileType=FileTypeManager.getInstance().getFileTypeByFile(file);
      return fileType == StdFileTypes.JAVA || fileType == StdFileTypes.CLASS;
    }
  }
;
  ((PsiManagerImpl)PsiManager.getInstance(project)).setAssertOnFileLoadingFilter(javaFilesFilter);
  final long start=System.currentTimeMillis();
  Collection<HighlightInfo> infos=doHighlighting();
  final long elapsed=System.currentTimeMillis() - start;
  duration.set(duration.isNull() ? elapsed : duration.get().longValue() + elapsed);
  ((PsiManagerImpl)PsiManager.getInstance(project)).setAssertOnFileLoadingFilter(VirtualFileFilter.NONE);
  data.checkResult(infos,myEditor.getDocument().getText());
}
