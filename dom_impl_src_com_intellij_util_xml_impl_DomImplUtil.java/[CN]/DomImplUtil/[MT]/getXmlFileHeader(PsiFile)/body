{
  final VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile instanceof LightVirtualFile && file instanceof XmlFile && FileDocumentManager.getInstance().getCachedDocument(virtualFile) == null) {
    final XmlDocument document=((XmlFile)file).getDocument();
    if (document != null) {
      String publicId=null;
      String systemId=null;
      final XmlProlog prolog=document.getProlog();
      if (prolog != null) {
        final XmlDoctype doctype=prolog.getDoctype();
        if (doctype != null) {
          publicId=doctype.getPublicId();
          systemId=doctype.getSystemId();
        }
      }
      final XmlTag tag=document.getRootTag();
      if (tag != null) {
        return new XmlFileHeader(tag.getLocalName(),tag.getNamespace(),publicId,systemId);
      }
    }
    return XmlFileHeader.EMPTY;
  }
  if (!file.isValid())   return XmlFileHeader.EMPTY;
  return NanoXmlUtil.parseHeader(file);
}
