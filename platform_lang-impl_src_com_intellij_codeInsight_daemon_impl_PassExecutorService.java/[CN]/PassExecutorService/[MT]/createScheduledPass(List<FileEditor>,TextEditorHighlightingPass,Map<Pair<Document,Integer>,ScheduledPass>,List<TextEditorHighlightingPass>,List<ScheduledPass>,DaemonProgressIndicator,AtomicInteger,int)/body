{
  int passId=pass.getId();
  Document document=pass.getDocument();
  Pair<Document,Integer> key=Pair.create(document,passId);
  ScheduledPass scheduledPass=toBeSubmitted.get(key);
  if (scheduledPass != null)   return scheduledPass;
  scheduledPass=new ScheduledPass(fileEditors,pass,updateProgress,threadsToStartCountdown,jobPriority);
  toBeSubmitted.put(key,scheduledPass);
  for (  int predecessorId : pass.getCompletionPredecessorIds()) {
    ScheduledPass predecessor=findOrCreatePredecessorPass(fileEditors,document,toBeSubmitted,textEditorHighlightingPasses,freePasses,updateProgress,threadsToStartCountdown,jobPriority,predecessorId,passId);
    if (predecessor != null) {
      predecessor.mySuccessorsOnCompletion.add(scheduledPass);
      scheduledPass.myRunningPredecessorsCount.incrementAndGet();
    }
  }
  for (  int predecessorId : pass.getStartingPredecessorIds()) {
    ScheduledPass predecessor=findOrCreatePredecessorPass(fileEditors,document,toBeSubmitted,textEditorHighlightingPasses,freePasses,updateProgress,threadsToStartCountdown,jobPriority,predecessorId,passId);
    if (predecessor != null) {
      predecessor.mySuccessorsOnSubmit.add(scheduledPass);
      scheduledPass.myRunningPredecessorsCount.incrementAndGet();
    }
  }
  if (scheduledPass.myRunningPredecessorsCount.get() == 0 && !freePasses.contains(scheduledPass)) {
    freePasses.add(scheduledPass);
  }
  return scheduledPass;
}
