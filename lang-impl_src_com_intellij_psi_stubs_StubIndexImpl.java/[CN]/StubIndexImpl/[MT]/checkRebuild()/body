{
  if (myRebuildStatus.compareAndSet(NEED_REBUILD,REBUILD_IN_PROGRESS)) {
    StubUpdatingIndex.scheduleStubIndicesRebuild(new Runnable(){
      public void run(){
        myRebuildStatus.compareAndSet(REBUILD_IN_PROGRESS,OK);
      }
    }
);
  }
  if (myRebuildStatus.get() == REBUILD_IN_PROGRESS) {
    throw new ProcessCanceledException();
  }
}
