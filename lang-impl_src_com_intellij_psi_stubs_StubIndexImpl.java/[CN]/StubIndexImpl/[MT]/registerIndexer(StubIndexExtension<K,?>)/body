{
  final StubIndexKey name=extension.getKey();
  final int version=extension.getVersion();
  myIndexIdToVersionMap.put(name,version);
  final File versionFile=IndexInfrastructure.getVersionFile(name);
  if (IndexInfrastructure.versionDiffers(versionFile,version)) {
    FileUtil.delete(IndexInfrastructure.getIndexRootDir(name));
    IndexInfrastructure.rewriteVersion(versionFile,version);
  }
  for (int attempt=0; attempt < 2; attempt++) {
    try {
      final MapIndexStorage<K,Integer> storage=new MapIndexStorage<K,Integer>(IndexInfrastructure.getStorageFile(name),extension.getKeyDescriptor(),new StubIdExternalizer());
      final MemoryIndexStorage<K,Integer> memStorage=new MemoryIndexStorage<K,Integer>(storage);
      final MyIndex index=createIndex(extension,memStorage);
      myIndicies.put(name,index);
      break;
    }
 catch (    IOException e) {
      FileUtil.delete(IndexInfrastructure.getIndexRootDir(name));
      IndexInfrastructure.rewriteVersion(versionFile,version);
    }
  }
}
