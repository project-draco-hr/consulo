{
  final String message=event.getThrowable().getMessage();
  final String option=message != null && message.indexOf("PermGen") >= 0 ? "-XX:MaxPermSize" : "-Xmx";
  ourOomOccured=true;
  event.getThrowable().printStackTrace();
  SwingUtilities.invokeAndWait(new Runnable(){
    public void run(){
      String message="There's not enough memory to perform the requested operation.\n" + "Please shutdown IDEA and increase " + option + " setting in "+ getSettingsFilePath();
      if (JOptionPane.showOptionDialog(JOptionPane.getRootFrame(),message,"Out of Memory",JOptionPane.DEFAULT_OPTION,JOptionPane.ERROR_MESSAGE,null,new Object[]{"Shutdown","Ignore"},"Shutdown") == 0) {
        try {
          ApplicationManager.getApplication().exit();
        }
 catch (        Throwable e) {
          System.exit(0);
        }
      }
    }
  }
);
}
