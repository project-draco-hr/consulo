{
  final List<VirtualFile> filteredRoots=new ArrayList<VirtualFile>(roots.length);
  final CompilerConfigurationImpl compilerConfiguration=(CompilerConfigurationImpl)CompilerConfiguration.getInstance(project);
  for (  final VirtualFile root : roots) {
    if (mySourcesFilter != ALL_SOURCES) {
      if (myContext.isInTestSourceContent(root)) {
        if ((mySourcesFilter & TEST_SOURCES) == 0) {
          continue;
        }
      }
 else {
        if ((mySourcesFilter & SOURCES) == 0) {
          continue;
        }
      }
    }
    if (compilerConfiguration.isExcludedFromCompilation(root)) {
      continue;
    }
    filteredRoots.add(root);
  }
  return VfsUtil.toVirtualFileArray(filteredRoots);
}
