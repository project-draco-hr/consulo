{
  PsiElement element=getPsiElement(region);
  if (element == null)   return null;
  PsiFile containingFile=element.getContainingFile();
  InjectedLanguageManager injectedManager=InjectedLanguageManager.getInstance(containingFile.getProject());
  boolean isInjected=injectedManager.isInjectedFragment(containingFile);
  TextRange range=element.getTextRange();
  if (isInjected) {
    range=injectedManager.injectedToHost(element,range);
  }
  return range;
}
