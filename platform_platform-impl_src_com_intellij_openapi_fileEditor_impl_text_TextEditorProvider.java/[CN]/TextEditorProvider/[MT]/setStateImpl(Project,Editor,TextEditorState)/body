{
  if (state.CARETS != null && state.CARETS.length > 0) {
    if (editor.getCaretModel().supportsMultipleCarets()) {
      CaretModel caretModel=editor.getCaretModel();
      List<CaretState> states=new ArrayList<CaretState>(state.CARETS.length);
      for (      TextEditorState.CaretState caretState : state.CARETS) {
        states.add(new CaretState(new LogicalPosition(caretState.LINE,caretState.COLUMN),new LogicalPosition(caretState.SELECTION_START_LINE,caretState.SELECTION_START_COLUMN),new LogicalPosition(caretState.SELECTION_END_LINE,caretState.SELECTION_END_COLUMN)));
      }
      caretModel.setCaretsAndSelections(states,false);
    }
 else {
      TextEditorState.CaretState caretState=state.CARETS[0];
      LogicalPosition pos=new LogicalPosition(caretState.LINE,caretState.COLUMN);
      editor.getCaretModel().moveToLogicalPosition(pos);
      int startOffset=editor.logicalPositionToOffset(new LogicalPosition(caretState.SELECTION_START_LINE,caretState.SELECTION_START_COLUMN));
      int endOffset=editor.logicalPositionToOffset(new LogicalPosition(caretState.SELECTION_END_LINE,caretState.SELECTION_END_COLUMN));
      if (startOffset == endOffset) {
        editor.getSelectionModel().removeSelection();
      }
 else {
        editor.getSelectionModel().setSelection(startOffset,endOffset);
      }
    }
  }
  final int relativeCaretPosition=state.RELATIVE_CARET_POSITION;
  UiNotifyConnector.doWhenFirstShown(editor.getContentComponent(),new Runnable(){
    @Override public void run(){
      if (!editor.isDisposed()) {
        editor.getScrollingModel().disableAnimation();
        if (relativeCaretPosition != Integer.MAX_VALUE) {
          EditorUtil.setRelativeCaretPosition(editor,relativeCaretPosition);
        }
        editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
        editor.getScrollingModel().enableAnimation();
      }
    }
  }
);
}
