{
  TextEditorState state=new TextEditorState();
  state.LINE=editor.getCaretModel().getLogicalPosition().line;
  state.COLUMN=editor.getCaretModel().getLogicalPosition().column;
  state.SELECTION_START=editor.getSelectionModel().getSelectionStart();
  state.SELECTION_END=editor.getSelectionModel().getSelectionEnd();
  state.VERTICAL_SCROLL_PROPORTION=level == FileEditorStateLevel.UNDO ? -1 : EditorUtil.calcVerticalScrollProportion(editor);
  return state;
}
