{
  final Semaphore semaphore=new Semaphore();
  semaphore.down();
  final Ref<Boolean> connectorIsReady=Ref.create(false);
  myDebugProcessDispatcher.addListener(new DebugProcessAdapter(){
    public void connectorIsReady(){
      connectorIsReady.set(true);
      semaphore.up();
      myDebugProcessDispatcher.removeListener(this);
    }
  }
);
  this.getManagerThread().schedule(new DebuggerCommandImpl(){
    protected void action(){
      VirtualMachine vm=null;
      try {
        final long time=System.currentTimeMillis();
        while (System.currentTimeMillis() - time < LOCAL_START_TIMEOUT) {
          try {
            vm=createVirtualMachineInt();
            break;
          }
 catch (          final ExecutionException e) {
            if (pollConnection && !myConnection.isServerMode() && e.getCause() instanceof IOException) {
synchronized (this) {
                try {
                  wait(500);
                }
 catch (                InterruptedException ie) {
                  break;
                }
              }
            }
 else {
              fail();
              if (myExecutionResult != null || !connectorIsReady.get()) {
                SwingUtilities.invokeLater(new Runnable(){
                  public void run(){
                    ExecutionUtil.handleExecutionError(myProject,state.getRunnerSettings().getRunProfile(),e);
                  }
                }
);
              }
              break;
            }
          }
        }
      }
  finally {
        semaphore.up();
      }
      if (vm != null) {
        final VirtualMachine vm1=vm;
        afterProcessStarted(new Runnable(){
          public void run(){
            getManagerThread().schedule(new DebuggerCommandImpl(){
              protected void action() throws Exception {
                commitVM(vm1);
              }
            }
);
          }
        }
);
      }
    }
    protected void commandCancelled(){
      try {
        super.commandCancelled();
      }
  finally {
        semaphore.up();
      }
    }
  }
);
  semaphore.waitFor();
}
