{
  PsiType iterType=qualifier.getType();
  if (iterType == null)   return null;
  if (iterType instanceof PsiArrayType) {
    return TypesUtil.boxPrimitiveType(((PsiArrayType)iterType).getComponentType(),context.getManager(),context.getResolveScope());
  }
  if (iterType instanceof GrTupleType) {
    PsiType[] types=((GrTupleType)iterType).getParameters();
    return types.length == 1 ? types[0] : null;
  }
  if (iterType instanceof GrRangeType) {
    return ((GrRangeType)iterType).getIterationType();
  }
  if (InheritanceUtil.isInheritor(iterType,GroovyCommonClassNames.GROOVY_LANG_INT_RANGE)) {
    return TypesUtil.createTypeByFQClassName(CommonClassNames.JAVA_LANG_INTEGER,context);
  }
  if (InheritanceUtil.isInheritor(iterType,GroovyCommonClassNames.GROOVY_LANG_OBJECT_RANGE)) {
    PsiElement element=qualifier;
    element=skipParentheses(element,false);
    if (element instanceof GrReferenceExpression) {
      GrReferenceExpression ref=(GrReferenceExpression)element;
      element=skipParentheses(ref.resolve(),false);
    }
    if (element instanceof GrRangeExpression) {
      return getRangeElementType((GrRangeExpression)element);
    }
    return null;
  }
  PsiType res=PsiUtil.extractIterableTypeParameter(iterType,true);
  if (res != null) {
    return res;
  }
  if (TypesUtil.isClassType(iterType,CommonClassNames.JAVA_LANG_STRING) || TypesUtil.isClassType(iterType,JAVA_IO_FILE)) {
    return TypesUtil.createTypeByFQClassName(CommonClassNames.JAVA_LANG_STRING,context);
  }
  if (InheritanceUtil.isInheritor(iterType,CommonClassNames.JAVA_UTIL_MAP)) {
    return getEntryForMap(iterType,context);
  }
  return null;
}
