{
  super(project,projectsManager,repository,eventsHandler);
  if (ApplicationManager.getApplication().isUnitTestMode())   return;
  tree=new SimpleTree(){
    private JLabel myLabel=new JLabel(ProjectBundle.message("maven.please.reimport"));
    @Override protected void paintComponent(    Graphics g){
      super.paintComponent(g);
      if (MavenProjectsManager.getInstance(project).isMavenProject())       return;
      myLabel.setFont(getFont());
      myLabel.setBackground(getBackground());
      myLabel.setForeground(getForeground());
      Rectangle bounds=getBounds();
      Dimension size=myLabel.getPreferredSize();
      myLabel.setBounds(0,0,size.width,size.height);
      int x=(bounds.width - size.width) / 2;
      Graphics g2=g.create(bounds.x + x,bounds.y + 20,bounds.width,bounds.height);
      try {
        myLabel.paint(g2);
      }
  finally {
        g2.dispose();
      }
    }
  }
;
  tree.setRootVisible(false);
  tree.setShowsRootHandles(true);
  tree.getSelectionModel().setSelectionMode(TreeSelectionModel.DISCONTIGUOUS_TREE_SELECTION);
  treeBuilder=new SimpleTreeBuilder(tree,(DefaultTreeModel)tree.getModel(),this,null);
  treeBuilder.initRoot();
  Disposer.register(project,treeBuilder);
  myProjectsManager.addListener(new MavenProjectsManager.Listener(){
    public void activate(){
      MavenProjectNavigator.LOG.assertTrue(fileToNode.isEmpty());
      for (      VirtualFile file : myProjectsManager.getFiles()) {
        fileToNode.put(file,new PomNode(file));
      }
      updateFromRoot(true,true);
    }
    public void setIgnored(    VirtualFile file,    boolean on){
      final PomNode pomNode=fileToNode.get(file);
      if (pomNode != null) {
        pomNode.setIgnored(on);
      }
    }
    public void setProfiles(    VirtualFile file,    @NotNull Collection<String> profiles){
      final PomNode pomNode=fileToNode.get(file);
      if (pomNode != null) {
        pomNode.setProfiles(profiles);
      }
    }
    public void attachPlugins(    final VirtualFile file,    @NotNull final Collection<MavenId> plugins){
      final PomNode pomNode=fileToNode.get(file);
      if (pomNode != null) {
        pomNode.attachPlugins(plugins);
      }
    }
    public void detachPlugins(    final VirtualFile file,    @NotNull final Collection<MavenId> plugins){
      final PomNode pomNode=fileToNode.get(file);
      if (pomNode != null) {
        pomNode.detachPlugins(plugins);
      }
    }
  }
);
  myProjectsManager.getMavenProjectModel().addListener(new MavenProjectModel.Listener(){
    public void projectAdded(    VirtualFile f){
      final PomNode newNode=new PomNode(f);
      fileToNode.put(f,newNode);
      root.addToStructure(newNode);
      updateFromRoot(true,true);
    }
    public void projectUpdated(    VirtualFile f){
      final PomNode pomNode=fileToNode.get(f);
      if (pomNode != null) {
        pomNode.onFileUpdate();
      }
 else {
        projectAdded(f);
      }
    }
    public void projectRemoved(    VirtualFile f){
      final PomNode pomNode=fileToNode.get(f);
      if (pomNode != null) {
        fileToNode.remove(f);
        pomNode.removeFromParent();
      }
    }
  }
);
  myEventsHandler.addListener(new MavenEventsHandler.Listener(){
    public void updateShortcuts(    @Nullable String actionId){
      for (      PomNode pomNode : fileToNode.values()) {
        pomNode.updateShortcuts(actionId);
      }
    }
  }
);
  myEventsHandler.installTaskSelector(new MavenEventsHandler.TaskSelector(){
    SelectMavenGoalDialog dialog;
    public boolean select(    final Project project,    @Nullable final String pomPath,    @Nullable final String goal,    @NotNull final String title){
      dialog=new SelectMavenGoalDialog(project,pomPath,goal,title);
      dialog.show();
      return dialog.isOK();
    }
    public String getSelectedPomPath(){
      return dialog.getSelectedPomPath();
    }
    public String getSelectedGoal(){
      return dialog.getSelectedGoal();
    }
  }
);
  IdeaAPIHelper.installCheckboxRenderer(tree,new IdeaAPIHelper.CheckboxHandler(){
    public void toggle(    final TreePath treePath,    final InputEvent e){
      final SimpleNode node=tree.getNodeFor(treePath);
      if (node != null) {
        node.handleDoubleClickOrEnter(tree,e);
      }
    }
    public boolean isVisible(    final Object userObject){
      return userObject instanceof ProfileNode;
    }
    public boolean isSelected(    final Object userObject){
      return ((ProfileNode)userObject).isActive();
    }
  }
);
}
