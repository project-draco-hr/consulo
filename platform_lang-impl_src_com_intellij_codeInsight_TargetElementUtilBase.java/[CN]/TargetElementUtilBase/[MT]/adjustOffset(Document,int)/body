{
  CharSequence text=document.getCharsSequence();
  int correctedOffset=offset;
  int textLength=document.getTextLength();
  if (offset >= textLength) {
    correctedOffset=textLength - 1;
  }
 else   if (!Character.isJavaIdentifierPart(text.charAt(offset))) {
    correctedOffset--;
  }
  if (correctedOffset < 0 || !Character.isJavaIdentifierPart(text.charAt(correctedOffset)))   return offset;
  return correctedOffset;
}
