{
  final int length=stream.readInt();
  if (length == -1) {
    return null;
  }
  if (length == 0) {
    return "";
  }
  char[] chars=new char[length];
  int charsRead=0;
  while (charsRead < length) {
synchronized (BUFF) {
      final int bytesRead=Math.min((length - charsRead) * 2,BUFF.length);
      stream.readFully(BUFF,0,bytesRead);
      for (int i=0; i < bytesRead; i+=2) {
        chars[charsRead++]=(char)((BUFF[i] << 8) + BUFF[i + 1]);
      }
    }
  }
  return StringFactory.createStringFromConstantArray(chars);
}
