{
  boolean enable=false;
  Icon icon=getTemplatePresentation().getIcon();
  String description=getTemplatePresentation().getDescription();
  final Presentation presentation=e.getPresentation();
  if (ActionPlaces.MAIN_MENU.equals(e.getPlace())) {
    enable=!getCancellableProcesses(e.getProject()).isEmpty() || !getActiveDescriptors(e.getDataContext()).isEmpty();
  }
 else {
    final ProcessHandler processHandler=getHandler(e.getDataContext());
    if (processHandler != null && !processHandler.isProcessTerminated()) {
      if (!processHandler.isProcessTerminating()) {
        enable=true;
      }
 else       if (processHandler instanceof KillableProcess && ((KillableProcess)processHandler).canKillProcess()) {
        enable=true;
        icon=AllIcons.Debugger.KillProcess;
        description="Kill process";
      }
    }
  }
  presentation.setEnabled(enable);
  presentation.setIcon(icon);
  presentation.setDescription(description);
}
