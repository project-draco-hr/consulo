{
  boolean enable=false;
  Icon icon=getTemplatePresentation().getIcon();
  String description=getTemplatePresentation().getDescription();
  final Presentation presentation=e.getPresentation();
  if (ActionPlaces.MAIN_MENU.equals(e.getPlace())) {
    final List<RunContentDescriptor> descriptors=getActiveDescriptors(e.getDataContext());
    for (    RunContentDescriptor descriptor : descriptors) {
      final ProcessHandler handler=descriptor.getProcessHandler();
      if (handler != null && !handler.isProcessTerminated()) {
        enable=true;
        break;
      }
    }
  }
 else {
    final ProcessHandler processHandler=getHandler(e.getDataContext());
    if (processHandler != null && !processHandler.isProcessTerminated()) {
      if (!processHandler.isProcessTerminating()) {
        enable=true;
      }
 else       if (processHandler instanceof KillableProcess && ((KillableProcess)processHandler).canKillProcess()) {
        enable=true;
        icon=KILL_PROCESS_ICON;
        description="Kill process";
      }
    }
  }
  presentation.setEnabled(enable);
  presentation.setIcon(icon);
  presentation.setDescription(description);
}
