{
  final DataContext dataContext=e.getDataContext();
  ProcessHandler processHandler=getHandler(dataContext);
  if ((processHandler == null || processHandler.isProcessTerminated()) && ActionPlaces.MAIN_MENU.equals(e.getPlace())) {
    final Collection<HandlerItem> handlerItems=getItemsList(getActiveDescriptors(dataContext));
    if (!handlerItems.isEmpty()) {
      final JBList list=new JBList(handlerItems);
      list.installCellRenderer(new NotNullFunction<HandlerItem,JComponent>(){
        final JLabel label=new JLabel();
        @NotNull public JComponent fun(        HandlerItem item){
          label.setIcon(item.icon);
          label.setIconTextGap(6);
          label.setText(item.displayName);
          return label;
        }
      }
);
      final PopupChooserBuilder builder=JBPopupFactory.getInstance().createListPopupBuilder(list);
      final String title=handlerItems.size() == 1 ? "Confirm process stop" : "Select process to stop";
      final JBPopup popup=builder.setTitle(title).setItemChoosenCallback(new Runnable(){
        public void run(){
          final HandlerItem item=(HandlerItem)list.getSelectedValue();
          if (item != null) {
            performAction(item.handler);
          }
        }
      }
).setRequestFocus(true).createPopup();
      popup.showInBestPositionFor(dataContext);
    }
  }
  if (processHandler != null) {
    performAction(processHandler);
  }
}
