{
  for (  PsiSearchRequest primitive : request.getConstituents()) {
    if (primitive instanceof PsiSearchRequest.CustomRequest) {
      customs.add((PsiSearchRequest.CustomRequest)primitive);
    }
 else {
      final PsiSearchRequest.SingleRequest single=(PsiSearchRequest.SingleRequest)primitive;
      final SearchScope scope=single.searchScope;
      if (scope instanceof LocalSearchScope) {
        customs.add(PsiSearchRequest.custom(new Computable<Boolean>(){
          public Boolean compute(){
            return processSingleRequest(single);
          }
        }
));
      }
 else {
        final List<String> words=StringUtil.getWordsIn(single.word);
        final Set<IdIndexEntry> key=new HashSet<IdIndexEntry>(words.size());
        for (        String word : words) {
          key.add(new IdIndexEntry(word,single.caseSensitive));
        }
        singles.putValue(key,single);
      }
    }
  }
}
