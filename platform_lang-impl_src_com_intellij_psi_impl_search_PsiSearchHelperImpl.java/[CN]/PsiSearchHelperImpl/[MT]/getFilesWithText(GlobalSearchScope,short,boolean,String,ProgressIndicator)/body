{
  myManager.startBatchFilesProcessingMode();
  try {
    final List<VirtualFile> result=new ArrayList<VirtualFile>();
    boolean success=processFilesWithText(scope,searchContext,caseSensitively,text,new Processor<PsiFile>(){
      @Override public boolean process(      PsiFile file){
        result.add(file.getViewProvider().getVirtualFile());
        return true;
      }
    }
,progress);
    LOG.assertTrue(success);
    return result;
  }
  finally {
    myManager.finishBatchFilesProcessingMode();
  }
}
