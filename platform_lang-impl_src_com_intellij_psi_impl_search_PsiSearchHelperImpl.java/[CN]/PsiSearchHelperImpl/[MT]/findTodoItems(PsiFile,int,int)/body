{
  final Collection<IndexPatternOccurrence> occurrences=IndexPatternSearch.search(file,TodoIndexPatternProvider.getInstance()).findAll();
  if (occurrences.isEmpty()) {
    return EMPTY_TODO_ITEMS;
  }
  List<TodoItem> items=new ArrayList<TodoItem>(occurrences.size());
  TextRange textRange=new TextRange(startOffset,endOffset);
  for (  IndexPatternOccurrence occurrence : occurrences) {
    TextRange occurrenceRange=occurrence.getTextRange();
    if (textRange.contains(occurrenceRange)) {
      items.add(new TodoItemImpl(occurrence.getFile(),occurrenceRange.getStartOffset(),occurrenceRange.getEndOffset(),mapPattern(occurrence.getPattern())));
    }
  }
  return items.toArray(new TodoItem[items.size()]);
}
