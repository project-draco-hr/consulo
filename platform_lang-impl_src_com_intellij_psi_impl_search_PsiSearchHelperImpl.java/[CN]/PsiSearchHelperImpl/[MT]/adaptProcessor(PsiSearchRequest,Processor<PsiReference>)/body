{
  final SearchScope searchScope=singleRequest.searchScope;
  final boolean ignoreInjectedPsi=searchScope instanceof LocalSearchScope && ((LocalSearchScope)searchScope).isIgnoreInjectedPsi();
  final RequestResultProcessor wrapped=singleRequest.processor;
  return new TextOccurenceProcessor(){
    @Override public boolean execute(    PsiElement element,    int offsetInElement){
      if (ignoreInjectedPsi && element instanceof PsiLanguageInjectionHost)       return true;
      return wrapped.processTextOccurrence(element,offsetInElement,consumer);
    }
  }
;
}
