{
  final FileIndexFacade index=FileIndexFacade.getInstance(myManager.getProject());
  final MultiMap<VirtualFile,RequestWithProcessor> result=createMultiMap();
  for (  Set<IdIndexEntry> key : singles.keySet()) {
    if (key.isEmpty()) {
      continue;
    }
    final Collection<RequestWithProcessor> data=singles.get(key);
    GlobalSearchScope commonScope=uniteScopes(data);
    MultiMap<VirtualFile,RequestWithProcessor> intersection=null;
    boolean first=true;
    for (    IdIndexEntry entry : key) {
      final MultiMap<VirtualFile,RequestWithProcessor> local=findFilesWithIndexEntry(entry,index,data,commonScope,progress);
      if (first) {
        intersection=local;
        first=false;
      }
 else {
        intersection.keySet().retainAll(local.keySet());
        for (        VirtualFile file : intersection.keySet()) {
          intersection.get(file).retainAll(local.get(file));
        }
      }
    }
    result.putAllValues(intersection);
  }
  return result;
}
