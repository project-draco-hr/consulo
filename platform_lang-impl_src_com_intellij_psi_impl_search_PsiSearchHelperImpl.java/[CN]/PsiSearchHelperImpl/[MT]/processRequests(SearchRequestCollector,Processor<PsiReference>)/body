{
  Map<SearchRequestCollector,Processor<PsiReference>> collectors=new HashMap<SearchRequestCollector,Processor<PsiReference>>();
  collectors.put(collector,processor);
  appendCollectorsFromQueryRequests(collectors);
  do {
    final MultiMap<Set<IdIndexEntry>,RequestWithProcessor> singles=new MultiMap<Set<IdIndexEntry>,RequestWithProcessor>();
    final List<Computable<Boolean>> customs=new ArrayList<Computable<Boolean>>();
    distributePrimitives(collectors,singles,customs);
    if (!processRequestsOptimized(singles)) {
      return false;
    }
    for (    Computable<Boolean> custom : customs) {
      if (!custom.compute()) {
        return false;
      }
    }
  }
 while (appendCollectorsFromQueryRequests(collectors));
  return true;
}
