{
  for (  PsiSearchRequest primitive : request.getConstituents()) {
    if (primitive instanceof PsiSearchRequest.CustomRequest) {
      customs.add((PsiSearchRequest.CustomRequest)primitive);
    }
 else {
      final PsiSearchRequest.SingleRequest single=(PsiSearchRequest.SingleRequest)primitive;
      final SearchScope scope=single.searchScope;
      if (scope instanceof LocalSearchScope) {
        customs.add(PsiSearchRequest.custom(new Runnable(){
          public void run(){
            processSingleRequest(single);
          }
        }
));
      }
 else {
        singles.putValue(new IdIndexEntry(single.word,single.caseSensitive),single);
      }
    }
  }
}
