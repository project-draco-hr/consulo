{
  final MultiMap<VirtualFile,RequestWithProcessor> local=new MultiMap<VirtualFile,RequestWithProcessor>();
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      ProgressManager.checkCanceled();
      FileBasedIndex.getInstance().processValues(IdIndex.NAME,entry,null,new FileBasedIndex.ValueProcessor<Integer>(){
        public boolean process(        VirtualFile file,        Integer value){
          ProgressManager.checkCanceled();
          if (!IndexCacheManagerImpl.shouldBeFound(file,index)) {
            return true;
          }
          int mask=value.intValue();
          for (          RequestWithProcessor single : data) {
            final PsiSearchRequest request=single.request;
            if ((mask & request.searchContext) != 0 && ((GlobalSearchScope)request.searchScope).contains(file)) {
              local.putValue(file,single);
            }
          }
          return true;
        }
      }
,commonScope);
    }
  }
);
  return local;
}
