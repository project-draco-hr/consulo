{
  myUpdatePsiAlarm.cancelAllRequests();
  myUpdatePsiAlarm.addRequest(new Runnable(){
    @Override public void run(){
      if (!isValid())       return;
      CommandProcessor.getInstance().runUndoTransparentAction(new Runnable(){
        @Override public void run(){
          ApplicationManager.getApplication().runWriteAction(new Runnable(){
            @Override public void run(){
              Project project=propertiesFile.getProject();
              PsiDocumentManager documentManager=PsiDocumentManager.getInstance(project);
              documentManager.commitDocument(document);
              Document propertiesFileDocument=documentManager.getDocument(propertiesFile.getContainingFile());
              if (propertiesFileDocument == null) {
                return;
              }
              documentManager.commitDocument(propertiesFileDocument);
              if (!FileDocumentManager.getInstance().requestWriting(document,project)) {
                uninstallDocumentListeners();
                try {
                  document.replaceString(0,document.getTextLength(),oldText);
                }
  finally {
                  installDocumentListeners();
                }
                return;
              }
              String propertyName=getSelectedPropertyName();
              if (propertyName == null)               return;
              updatePropertyValueFromDocument(propertyName,propertiesFile,text);
            }
          }
);
        }
      }
);
    }
  }
,300,ModalityState.stateForComponent(getComponent()));
}
