{
  if (myChildren == null) {
    final Node node=new Node(childName);
    myChildren=node;
    return node;
  }
  if (myChildren instanceof String) {
    final Node node=new Node(childName);
    myChildren=new Pair(myChildren,node);
    return node;
  }
  final Map<String,Node> map;
  if (myChildren instanceof Map) {
    map=(Map<String,Node>)myChildren;
  }
 else   if (myChildren instanceof Node) {
    final Node existingChild=(Node)myChildren;
    myChildren=map=new HashMap<String,Node>();
    map.put(existingChild.getName(),existingChild);
  }
 else {
    Object children=((Pair)myChildren).second;
    if (children instanceof Map) {
      map=(Map<String,Node>)children;
    }
 else {
      final Node existingChild=(Node)children;
      myChildren=new Pair(((Pair)myChildren).first,map=new HashMap<String,Node>());
      map.put(existingChild.getName(),existingChild);
    }
  }
  Node node=map.get(childName);
  if (node == null) {
    map.put(childName,node=new Node(childName));
  }
  return node;
}
