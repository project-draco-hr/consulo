{
  boolean significant=charTyped == '"' || charTyped == '\'' || charTyped == '[' || charTyped == '(' || charTyped == ']' || charTyped == ')' || charTyped == '{' || charTyped == '}' || charTyped == '.';
  if (!significant) {
    return editor;
  }
  int offset=editor.getCaretModel().getOffset();
  for (  DocumentWindow documentWindow : InjectedLanguageUtil.getCachedInjectedDocuments(oldFile)) {
    if (documentWindow.isValid() && documentWindow.containsRange(offset,offset)) {
      PsiFile injectedFile=PsiDocumentManager.getInstance(oldFile.getProject()).getPsiFile(documentWindow);
      final Editor injectedEditor=InjectedLanguageUtil.getInjectedEditorForInjectedFile(editor,injectedFile);
      if (injectedEditor.getCaretModel().getOffset() == injectedEditor.getDocument().getTextLength() && charTyped == editor.getDocument().getCharsSequence().charAt(offset)) {
        return editor;
      }
      return injectedEditor;
    }
  }
  return editor;
}
