{
  ProgressIndicator oldIndicator=myThreadIndicator.get();
  if (progress != null)   myThreadIndicator.set(progress);
  final boolean modal=progress != null && progress.isModal();
  if (modal)   myCurrentModalProgressCount.incrementAndGet();
  if (progress == null || progress instanceof ProgressWindow)   myCurrentUnsafeProgressCount.incrementAndGet();
  try {
    process.run();
  }
  finally {
    myThreadIndicator.set(oldIndicator);
    if (modal)     myCurrentModalProgressCount.decrementAndGet();
    if (progress == null || progress instanceof ProgressWindow)     myCurrentUnsafeProgressCount.decrementAndGet();
    if (progress != null) {
synchronized (progress) {
        progress.notifyAll();
      }
    }
  }
}
