{
  final ProgressIndicator progress=getProgressIndicator();
  if (progress != null) {
    try {
      progress.checkCanceled();
    }
 catch (    ProcessCanceledException e) {
      if (Thread.holdsLock(PsiLock.LOCK)) {
        ourLockedCheckCounter++;
        if (ourLockedCheckCounter > 10) {
          ourLockedCheckCounter=0;
          ourNeedToCheckCancel=true;
        }
      }
 else {
        ourLockedCheckCounter=0;
        throw e;
      }
    }
  }
}
