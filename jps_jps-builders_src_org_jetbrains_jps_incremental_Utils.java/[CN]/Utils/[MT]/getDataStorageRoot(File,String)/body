{
  projectPath=FileUtil.toCanonicalPath(projectPath);
  if (projectPath == null) {
    return null;
  }
  String name;
  final int locationHash;
  final File rootFile=new File(projectPath);
  if (!rootFile.isDirectory() && projectPath.endsWith(".ipr")) {
    name=StringUtil.trimEnd(rootFile.getName(),".ipr");
    locationHash=projectPath.hashCode();
  }
 else {
    File directoryBased=null;
    if (".idea".equals(rootFile.getName())) {
      directoryBased=rootFile;
    }
 else {
      File child=new File(rootFile,".idea");
      if (child.exists()) {
        directoryBased=child;
      }
    }
    if (directoryBased == null) {
      return null;
    }
    name=JpsProjectLoader.getDirectoryBaseProjectName(directoryBased);
    locationHash=directoryBased.getPath().hashCode();
  }
  return new File(systemRoot,name.toLowerCase(Locale.US) + "_" + Integer.toHexString(locationHash));
}
