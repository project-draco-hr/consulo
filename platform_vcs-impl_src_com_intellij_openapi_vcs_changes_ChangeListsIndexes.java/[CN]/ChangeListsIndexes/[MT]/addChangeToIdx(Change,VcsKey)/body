{
  final ContentRevision afterRevision=change.getAfterRevision();
  final ContentRevision beforeRevision=change.getBeforeRevision();
  if (afterRevision != null) {
    add(afterRevision.getFile(),change.getFileStatus(),key,beforeRevision == null ? VcsRevisionNumber.NULL : beforeRevision.getRevisionNumber());
  }
  if (beforeRevision != null) {
    if (afterRevision != null) {
      if (!Comparing.equal(beforeRevision.getFile(),afterRevision.getFile())) {
        add(beforeRevision.getFile(),FileStatus.DELETED,key,beforeRevision.getRevisionNumber());
      }
    }
 else {
      add(beforeRevision.getFile(),change.getFileStatus(),key,beforeRevision.getRevisionNumber());
    }
  }
}
