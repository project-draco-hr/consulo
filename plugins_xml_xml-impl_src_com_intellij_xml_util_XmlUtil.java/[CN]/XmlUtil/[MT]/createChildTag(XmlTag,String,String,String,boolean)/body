{
  String qname;
  final String prefix=xmlTag.getPrefixByNamespace(namespace);
  if (prefix != null && !prefix.isEmpty()) {
    qname=prefix + ":" + localName;
  }
 else {
    qname=localName;
  }
  try {
    String tagStart=qname + (!StringUtil.isEmpty(namespace) && xmlTag.getPrefixByNamespace(namespace) == null && !(StringUtil.isEmpty(xmlTag.getNamespacePrefix()) && namespace.equals(xmlTag.getNamespace())) ? " xmlns=\"" + namespace + "\"" : "");
    Language language=xmlTag.getLanguage();
    if (!(language instanceof HTMLLanguage))     language=StdFileTypes.XML.getLanguage();
    XmlTag retTag;
    if (bodyText != null) {
      retTag=XmlElementFactory.getInstance(xmlTag.getProject()).createTagFromText("<" + tagStart + ">"+ bodyText+ "</"+ qname+ ">",language);
      if (enforceNamespacesDeep) {
        retTag.acceptChildren(new XmlRecursiveElementVisitor(){
          @Override public void visitXmlTag(          XmlTag tag){
            final String namespacePrefix=tag.getNamespacePrefix();
            if (namespacePrefix.isEmpty()) {
              String qname;
              if (prefix != null && !prefix.isEmpty()) {
                qname=prefix + ":" + tag.getLocalName();
              }
 else {
                qname=tag.getLocalName();
              }
              try {
                tag.setName(qname);
              }
 catch (              IncorrectOperationException e) {
                LOG.error(e);
              }
            }
            super.visitXmlTag(tag);
          }
        }
);
      }
    }
 else {
      retTag=XmlElementFactory.getInstance(xmlTag.getProject()).createTagFromText("<" + tagStart + "/>",language);
    }
    return retTag;
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
  return null;
}
