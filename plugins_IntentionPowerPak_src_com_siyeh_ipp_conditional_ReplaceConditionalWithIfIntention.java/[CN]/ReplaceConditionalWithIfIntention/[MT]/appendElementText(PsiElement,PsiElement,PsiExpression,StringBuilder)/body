{
  if (element.equals(elementToReplace)) {
    final String replacementText=(replacementExpression == null) ? "" : replacementExpression.getText();
    out.append(replacementText);
    return;
  }
  final PsiElement[] children=element.getChildren();
  if (children.length == 0) {
    out.append(element.getText());
    if (element instanceof PsiComment) {
      final PsiComment comment=(PsiComment)element;
      final IElementType tokenType=comment.getTokenType();
      if (tokenType == JavaTokenType.END_OF_LINE_COMMENT) {
        out.append('\n');
      }
    }
    return;
  }
  for (  PsiElement child : children) {
    appendElementText(child,elementToReplace,replacementExpression,out);
  }
}
