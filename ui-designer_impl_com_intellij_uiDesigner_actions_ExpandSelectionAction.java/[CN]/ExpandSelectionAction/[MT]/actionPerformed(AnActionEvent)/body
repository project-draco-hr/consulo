{
  final GuiEditor editor=GuiEditorUtil.getEditorFromContext(e.getDataContext());
  final SelectionState selectionState=editor.getSelectionState();
  selectionState.setInsideChange(true);
  final Stack<ComponentPtr[]> history=selectionState.getSelectionHistory();
  try {
    final ComponentPtr[] ptrs=history.peek();
    for (int i=ptrs.length - 1; i >= 0; i--) {
      final ComponentPtr ptr=ptrs[i];
      ptr.validate();
      if (!ptr.isValid()) {
        continue;
      }
      final RadComponent component=ptr.getComponent();
      final RadContainer parent=component.getParent();
      if (parent == null) {
        continue;
      }
      boolean shouldSelectParent=true;
      for (int j=parent.getComponentCount() - 1; j >= 0; j--) {
        final RadComponent sibling=parent.getComponent(j);
        if (!sibling.isSelected()) {
          shouldSelectParent=false;
          sibling.setSelected(true);
        }
      }
      if (shouldSelectParent) {
        parent.setSelected(true);
      }
    }
    history.push(SelectionState.getPtrs(editor));
  }
  finally {
    selectionState.setInsideChange(false);
  }
}
