{
  ModifiableRootModel m=ModuleRootManager.getInstance(getModule(moduleName)).getModifiableModel();
  File file=new File(myDir,"mockJdk");
  file.mkdirs();
  String oldValue=System.setProperty("idea.testingFramework.mockJDK",file.getPath());
  Sdk sdk;
  try {
    sdk=JavaSdkImpl.getMockJdk("java 1.5");
  }
  finally {
    if (oldValue == null) {
      System.clearProperty("idea.testingFramework.mockJDK");
    }
 else {
      System.setProperty("idea.testingFramework.mockJDK",oldValue);
    }
  }
  m.setSdk(sdk);
  m.commit();
  return sdk;
}
