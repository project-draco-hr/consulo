{
  List<Module> modules=new ArrayList<Module>();
  for (  String each : moduleNames) {
    setupJdkForModule(each);
    modules.add(getModule(each));
  }
  CompilerWorkspaceConfiguration.getInstance(myProject).CLEAR_OUTPUT_DIRECTORY=true;
  CompilerManagerImpl.testSetup();
  List<VirtualFile> roots=Arrays.asList(ProjectRootManager.getInstance(myProject).getContentRoots());
  TranslatingCompilerFilesMonitor.getInstance().scanSourceContent(myProject,roots,roots.size(),true);
  CompileScope scope=new ModuleCompileScope(myProject,modules.toArray(new Module[modules.size()]),false);
  CompilerManager.getInstance(myProject).make(scope,new CompileStatusNotification(){
    @Override public void finished(    boolean aborted,    int errors,    int warnings,    CompileContext compileContext){
      assertFalse(aborted);
      assertEquals(collectMessages(compileContext,CompilerMessageCategory.ERROR),0,errors);
      assertEquals(collectMessages(compileContext,CompilerMessageCategory.WARNING),0,warnings);
    }
  }
);
}
