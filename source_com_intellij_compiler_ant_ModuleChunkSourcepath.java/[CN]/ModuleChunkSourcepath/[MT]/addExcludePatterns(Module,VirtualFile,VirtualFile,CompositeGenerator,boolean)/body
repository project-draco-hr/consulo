{
  if (FileTypeManager.getInstance().isFileIgnored(dir.getName())) {
    return;
  }
  final boolean isIncluded=ModuleRootManager.getInstance(module).getFileIndex().isInContent(dir);
  if (isIncluded != parentIncluded) {
    final String relativePath=VfsUtil.getRelativePath(dir,root,'/');
    if (isIncluded) {
      generator.add(new Include(relativePath + "/**"));
    }
 else {
      if (!isExcludedByDefault(dir.getName())) {
        generator.add(new Exclude(relativePath + "/**"));
      }
    }
  }
  final VirtualFile[] children=dir.getChildren();
  for (int idx=0; idx < children.length; idx++) {
    VirtualFile child=children[idx];
    if (child.isDirectory()) {
      addExcludePatterns(module,root,child,generator,isIncluded);
    }
  }
}
