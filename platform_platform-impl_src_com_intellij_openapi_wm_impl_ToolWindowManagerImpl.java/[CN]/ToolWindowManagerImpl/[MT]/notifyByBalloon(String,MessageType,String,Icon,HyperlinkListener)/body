{
  checkId(toolWindowId);
  final Stripe stripe=myToolWindowsPane.getStripeFor(toolWindowId);
  final ToolWindowImpl window=getInternalDecorator(toolWindowId).getToolWindow();
  if (!window.isAvailable()) {
    window.setPlaceholderMode(true);
    stripe.updateState();
    stripe.revalidate();
    stripe.repaint();
  }
  final ToolWindowAnchor anchor=getInfo(toolWindowId).getAnchor();
  final Ref<Balloon.Position> position=Ref.create(Balloon.Position.below);
  if (ToolWindowAnchor.TOP == anchor) {
    position.set(Balloon.Position.below);
  }
 else   if (ToolWindowAnchor.BOTTOM == anchor) {
    position.set(Balloon.Position.above);
  }
 else   if (ToolWindowAnchor.LEFT == anchor) {
    position.set(Balloon.Position.atRight);
  }
 else   if (ToolWindowAnchor.RIGHT == anchor) {
    position.set(Balloon.Position.atLeft);
  }
  Icon actualIcon=icon != null ? icon : type.getDefaultIcon();
  final Balloon balloon=JBPopupFactory.getInstance().createHtmlTextBalloonBuilder(text.replace("\n","<br>"),actualIcon,type.getPopupBackground(),listener).createBalloon();
  Disposer.register(balloon,new Disposable(){
    public void dispose(){
      window.setPlaceholderMode(false);
      stripe.updateState();
      stripe.revalidate();
      stripe.repaint();
    }
  }
);
  final StripeButton button=stripe.getButtonFor(toolWindowId);
  if (button == null)   return;
  final Runnable show=new Runnable(){
    public void run(){
      if (button.isShowing()) {
        final Point point=new Point(button.getBounds().width / 2,button.getHeight() / 2 - 2);
        balloon.show(new RelativePoint(button,point),position.get());
      }
 else {
        final Rectangle bounds=myToolWindowsPane.getBounds();
        final Point target=UIUtil.getCenterPoint(bounds,new Dimension(1,1));
        if (ToolWindowAnchor.TOP == anchor) {
          target.y=0;
        }
 else         if (ToolWindowAnchor.BOTTOM == anchor) {
          target.y=bounds.height - 3;
        }
 else         if (ToolWindowAnchor.LEFT == anchor) {
          target.x=0;
        }
 else         if (ToolWindowAnchor.RIGHT == anchor) {
          target.x=bounds.width;
        }
        balloon.show(new RelativePoint(myToolWindowsPane,target),position.get());
      }
    }
  }
;
  if (!button.isValid()) {
    SwingUtilities.invokeLater(new Runnable(){
      public void run(){
        show.run();
      }
    }
);
  }
 else {
    show.run();
  }
}
