{
  if (e.getKeyCode() != KeyEvent.VK_CONTROL && e.getKeyCode() != KeyEvent.VK_ALT && e.getKeyCode() != KeyEvent.VK_SHIFT && e.getKeyCode() != KeyEvent.VK_META) {
    if (e.getModifiers() == 0) {
      resetHoldState();
    }
    return false;
  }
  if (e.getID() != KeyEvent.KEY_PRESSED && e.getID() != KeyEvent.KEY_RELEASED)   return false;
  Component parent=UIUtil.findUltimateParent(e.getComponent());
  if (parent instanceof IdeFrame) {
    if (((IdeFrame)parent).getProject() != myProject) {
      resetHoldState();
      return false;
    }
  }
  Set<Integer> vks=getActivateToolWindowVKs();
  if (vks.size() == 0) {
    resetHoldState();
    return false;
  }
  if (vks.contains(e.getKeyCode())) {
    boolean pressed=e.getID() == KeyEvent.KEY_PRESSED;
    int modifiers=e.getModifiers();
    int mouseMask=InputEvent.BUTTON1_DOWN_MASK | InputEvent.BUTTON2_DOWN_MASK | InputEvent.BUTTON3_DOWN_MASK;
    if ((e.getModifiersEx() & mouseMask) == 0) {
      if (SwitchManager.areAllModifiersPressed(modifiers,vks) || !pressed) {
        processState(pressed);
      }
 else {
        resetHoldState();
      }
    }
  }
  return false;
}
