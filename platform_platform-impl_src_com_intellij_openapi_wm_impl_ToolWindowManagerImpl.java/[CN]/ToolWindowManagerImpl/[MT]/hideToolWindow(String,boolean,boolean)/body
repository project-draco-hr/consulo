{
  ApplicationManager.getApplication().assertIsDispatchThread();
  checkId(id);
  final WindowInfoImpl info=getInfo(id);
  if (!info.isVisible())   return;
  final ArrayList<FinalizableCommand> commandList=new ArrayList<FinalizableCommand>();
  final boolean wasActive=info.isActive();
  deactivateToolWindowImpl(id,true,commandList);
  if (hideSide && !info.isFloating()) {
    final List<String> ids=myLayout.getVisibleIdsOn(info.getAnchor(),this);
    for (    String each : ids) {
      myActiveStack.remove(each,true);
    }
    while (!mySideStack.isEmpty(info.getAnchor())) {
      mySideStack.pop(info.getAnchor());
    }
    final String[] all=getToolWindowIds();
    for (    String eachId : all) {
      final WindowInfoImpl eachInfo=getInfo(eachId);
      if (eachInfo.isVisible() && eachInfo.getAnchor() == info.getAnchor()) {
        deactivateToolWindowImpl(eachId,true,commandList);
      }
    }
    activateEditorComponentImpl(getSplittersFromFocus(),commandList,true);
  }
 else   if (isStackEnabled()) {
    WindowInfoImpl info2=null;
    while (!mySideStack.isEmpty(info.getAnchor())) {
      final WindowInfoImpl storedInfo=mySideStack.pop(info.getAnchor());
      if (storedInfo.isSplit() != info.isSplit()) {
        continue;
      }
      final WindowInfoImpl currentInfo=getInfo(storedInfo.getId());
      LOG.assertTrue(currentInfo != null);
      if (storedInfo.getAnchor() == currentInfo.getAnchor() && storedInfo.getType() == currentInfo.getType() && storedInfo.isAutoHide() == currentInfo.isAutoHide()) {
        info2=storedInfo;
        break;
      }
    }
    if (info2 != null) {
      showToolWindowImpl(info2.getId(),false,commandList);
    }
    myActiveStack.remove(id,false);
    if (wasActive && moveFocus) {
      if (myActiveStack.isEmpty()) {
        if (hasOpenEditorFiles()) {
          activateEditorComponentImpl(getSplittersFromFocus(),commandList,false);
        }
 else {
          focusToolWinowByDefault(id);
        }
      }
 else {
        final String toBeActivatedId=myActiveStack.pop();
        if (toBeActivatedId != null && (getInfo(toBeActivatedId).isVisible() || isStackEnabled())) {
          activateToolWindowImpl(toBeActivatedId,commandList,false,true);
        }
 else {
          focusToolWinowByDefault(id);
        }
      }
    }
  }
  if (SystemInfo.isJavaVersionAtLeast("1.7")) {
    if (hasOpenEditorFiles()) {
      activateEditorComponentImpl(getSplittersFromFocus(),commandList,false);
    }
 else {
      focusToolWinowByDefault(id);
    }
  }
  execute(commandList);
}
