{
  ApplicationManager.getApplication().assertIsDispatchThread();
  final ArrayList<FinalizableCommand> commandList=new ArrayList<FinalizableCommand>();
  final WindowInfoImpl[] currentInfos=myLayout.getInfos();
  for (  final WindowInfoImpl currentInfo : currentInfos) {
    final WindowInfoImpl info=layout.getInfo(currentInfo.getId(),false);
    if (info == null) {
      continue;
    }
    if (currentInfo.isVisible() && !info.isVisible()) {
      deactivateToolWindowImpl(currentInfo.getId(),true,commandList);
    }
  }
  for (  final WindowInfoImpl currentInfo : currentInfos) {
    final WindowInfoImpl info=layout.getInfo(currentInfo.getId(),false);
    if (info == null) {
      continue;
    }
    if (currentInfo.getAnchor() != info.getAnchor() || currentInfo.getOrder() != info.getOrder()) {
      setToolWindowAnchorImpl(currentInfo.getId(),info.getAnchor(),info.getOrder(),commandList);
    }
  }
  for (  final WindowInfoImpl currentInfo : currentInfos) {
    final WindowInfoImpl info=layout.getInfo(currentInfo.getId(),false);
    if (info == null) {
      continue;
    }
    if (currentInfo.getType() != info.getType()) {
      setToolWindowTypeImpl(currentInfo.getId(),info.getType(),commandList);
    }
  }
  for (  final WindowInfoImpl currentInfo : currentInfos) {
    final WindowInfoImpl info=layout.getInfo(currentInfo.getId(),false);
    if (info == null) {
      continue;
    }
    if (currentInfo.isAutoHide() != info.isAutoHide()) {
      setToolWindowAutoHideImpl(currentInfo.getId(),info.isAutoHide(),commandList);
    }
  }
  for (  final WindowInfoImpl currentInfo : currentInfos) {
    final WindowInfoImpl info=layout.getInfo(currentInfo.getId(),false);
    if (info == null) {
      continue;
    }
    if (info.isVisible()) {
      showToolWindowImpl(currentInfo.getId(),false,commandList);
    }
  }
  if (!myEditorWasActive && getActiveToolWindowId() == null) {
    activateEditorComponentImpl(commandList,true);
  }
  execute(commandList);
}
