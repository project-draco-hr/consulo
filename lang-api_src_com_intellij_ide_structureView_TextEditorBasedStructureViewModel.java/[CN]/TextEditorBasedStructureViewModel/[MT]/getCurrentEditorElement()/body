{
  if (myEditor == null)   return null;
  final int offset=myEditor.getCaretModel().getOffset();
  final PsiFile file=getPsiFile();
  FileViewProvider viewProvider=file.getViewProvider();
  PsiElement element=viewProvider.findElementAt(offset,file.getLanguage());
  if (element == null) {
    final LanguageDialect languageDialect=file.getLanguageDialect();
    if (languageDialect != null)     element=viewProvider.findElementAt(offset,languageDialect);
  }
  while (element != null && !(element instanceof PsiFile)) {
    if (isSuitable(element))     return element;
    element=element.getParent();
  }
  return null;
}
