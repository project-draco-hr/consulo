{
  final JTree tree=getCurrentTree();
  if (tree == null) {
    return new HierarchyNodeDescriptor[0];
  }
  final TreePath[] paths=tree.getSelectionPaths();
  if (paths == null) {
    return new HierarchyNodeDescriptor[0];
  }
  final ArrayList<HierarchyNodeDescriptor> list=new ArrayList<HierarchyNodeDescriptor>(paths.length);
  for (  final TreePath path : paths) {
    final Object lastPathComponent=path.getLastPathComponent();
    if (lastPathComponent instanceof DefaultMutableTreeNode) {
      final DefaultMutableTreeNode node=(DefaultMutableTreeNode)lastPathComponent;
      final Object userObject=node.getUserObject();
      if (userObject instanceof HierarchyNodeDescriptor) {
        list.add((HierarchyNodeDescriptor)userObject);
      }
    }
  }
  return list.toArray(new HierarchyNodeDescriptor[list.size()]);
}
