{
  final Editor editor=lookup.getEditor();
  final int offset=editor.getCaretModel().getOffset();
  CharSequence seq=editor.getDocument().getCharsSequence();
  if (seq.length() <= offset) {
    myOriginalHandler.execute(editor,context);
    return;
  }
  char c=seq.charAt(offset);
  CharFilter.Result lookupAction=TypedHandler.getLookupAction(c,lookup);
  if (DEBUG) {
    System.out.println("LookupActionHandler$RightHandler.executeInLookup");
    System.out.println("c = '" + c + "'");
    System.out.println("lookupAction = " + lookupAction);
  }
  if (lookupAction != CharFilter.Result.ADD_TO_PREFIX || Character.isWhitespace(c)) {
    myOriginalHandler.execute(editor,context);
    return;
  }
  if (DEBUG) {
    System.out.println("LookupActionHandler$RightHandler.executeInLookup2");
  }
  lookup.performGuardedChange(new Runnable(){
    @Override public void run(){
      editor.getSelectionModel().removeSelection();
      editor.getCaretModel().moveToOffset(offset + 1);
    }
  }
);
  lookup.appendPrefix(c);
  final CompletionProgressIndicator completion=CompletionServiceImpl.getCompletionService().getCurrentCompletion();
  if (completion != null) {
    completion.prefixUpdated();
  }
}
