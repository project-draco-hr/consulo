def changectx(repo, req):
    changeid = 'tip'
    if ('node' in req.form):
        changeid = req.form['node'][0]
    elif ('manifest' in req.form):
        changeid = req.form['manifest'][0]
    try:
        ctx = repo[changeid]
    except error.RepoError:
        man = repo.manifest
        ctx = repo[man.linkrev(man.rev(man.lookup(changeid)))]
    return ctx
