{
  final FilePatch curPatch;
  curPatch=new FilePatch();
  curPatch.setBeforeName(extractFileName(curLine));
  myLineIndex++;
  curLine=myLines[myLineIndex];
  String secondNamePrefix=myDiffFormat == DiffFormat.UNIFIED ? "+++ " : "--- ";
  if (!curLine.startsWith(secondNamePrefix)) {
    throw new PatchSyntaxException(myLineIndex,"Second file name expected");
  }
  curPatch.setAfterName(extractFileName(curLine));
  myLineIndex++;
  while (myLineIndex < myLines.length) {
    PatchHunk hunk;
    if (myDiffFormat == DiffFormat.UNIFIED) {
      hunk=readNextHunkUnified();
    }
 else {
      hunk=readNextHunkContext();
    }
    if (hunk == null)     break;
    curPatch.addHunk(hunk);
  }
  return curPatch;
}
