{
  final String namespacePrefix=XmlUtil.findPrefixByQualifiedName(text);
  final String namespaceByPrefix=tag.getNamespaceByPrefix(namespacePrefix);
  if (namespaceByPrefix.length() > 0)   return namespaceByPrefix;
  final XmlTag rootTag=((XmlFile)tag.getContainingFile()).getDocument().getRootTag();
  if (rootTag != null && "schema".equals(rootTag.getLocalName()) && XmlUtil.ourSchemaUrisList.indexOf(rootTag.getNamespace()) != -1) {
    final String targetNS=rootTag.getAttributeValue(TARGET_NAMESPACE);
    if (targetNS != null) {
      final String targetNsPrefix=rootTag.getPrefixByNamespace(targetNS);
      if (namespacePrefix.equals(targetNsPrefix) || (namespaceByPrefix.length() == 0 && targetNsPrefix == null)) {
        return targetNS;
      }
    }
  }
  return namespaceByPrefix;
}
