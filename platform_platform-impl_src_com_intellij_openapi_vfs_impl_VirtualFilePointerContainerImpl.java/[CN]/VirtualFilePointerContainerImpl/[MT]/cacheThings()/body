{
  myTimeStampOfCachedThings=myVirtualFilePointerManager.getModificationCount();
  if (myList.isEmpty()) {
    myCachedDirectories=VirtualFile.EMPTY_ARRAY;
    myCachedFiles=VirtualFile.EMPTY_ARRAY;
    myCachedUrls=ArrayUtil.EMPTY_STRING_ARRAY;
    return EMPTY;
  }
  VirtualFilePointer[] vf=myList.toArray(new VirtualFilePointer[myList.size()]);
  List<VirtualFile> cachedFiles=new ArrayList<VirtualFile>(vf.length);
  List<String> cachedUrls=new ArrayList<String>(vf.length);
  List<VirtualFile> cachedDirectories=new ArrayList<VirtualFile>(vf.length / 3);
  for (  VirtualFilePointer v : vf) {
    Pair<VirtualFile,String> pair=v instanceof VirtualFilePointerImpl ? ((VirtualFilePointerImpl)v).update() : Pair.create(v.getFile(),v.getUrl());
    if (pair == null)     continue;
    VirtualFile file=pair.first;
    String url=pair.second;
    if (url == null)     url=file.getUrl();
    cachedUrls.add(url);
    if (file != null) {
      cachedFiles.add(file);
      if (file.isDirectory()) {
        cachedDirectories.add(file);
      }
    }
  }
  VirtualFile[] directories=VfsUtilCore.toVirtualFileArray(cachedDirectories);
  myCachedDirectories=directories;
  VirtualFile[] filesArray;
  myCachedFiles=filesArray=VfsUtilCore.toVirtualFileArray(cachedFiles);
  String[] urlsArray;
  myCachedUrls=urlsArray=ArrayUtil.toStringArray(cachedUrls);
  return Trinity.create(urlsArray,filesArray,directories);
}
