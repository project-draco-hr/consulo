{
  if (myList.isEmpty()) {
    myTimeStampOfCachedThings=myVirtualFilePointerManager.getModificationCount();
    myCachedDirectories=VirtualFile.EMPTY_ARRAY;
    myCachedFiles=VirtualFile.EMPTY_ARRAY;
    myCachedUrls=ArrayUtil.EMPTY_STRING_ARRAY;
    return EMPTY;
  }
  Object[] vf=myList.toArray();
  List<VirtualFile> cachedFiles=new ArrayList<VirtualFile>(vf.length);
  List<String> cachedUrls=new ArrayList<String>(vf.length);
  List<VirtualFile> cachedDirectories=new ArrayList<VirtualFile>(vf.length / 3);
  for (  Object v : vf) {
    Pair<VirtualFile,String> pair=v instanceof VirtualFilePointerImpl ? ((VirtualFilePointerImpl)v).update() : Pair.create(((VirtualFilePointer)v).getFile(),((VirtualFilePointer)v).getUrl());
    if (pair == null)     continue;
    VirtualFile file=pair.first;
    String url=pair.second;
    if (url == null)     url=file.getUrl();
    cachedUrls.add(url);
    if (file != null) {
      cachedFiles.add(file);
      if (file.isDirectory()) {
        cachedDirectories.add(file);
      }
    }
  }
  VirtualFile[] directories=VfsUtil.toVirtualFileArray(cachedDirectories);
  myCachedDirectories=directories;
  VirtualFile[] filesArray;
  myCachedFiles=filesArray=VfsUtil.toVirtualFileArray(cachedFiles);
  String[] urlsArray;
  myCachedUrls=urlsArray=ArrayUtil.toStringArray(cachedUrls);
  return Trinity.create(urlsArray,filesArray,directories);
}
