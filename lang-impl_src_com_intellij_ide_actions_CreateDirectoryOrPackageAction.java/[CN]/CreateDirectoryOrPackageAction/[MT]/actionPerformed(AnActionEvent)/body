{
  DataContext dataContext=e.getDataContext();
  IdeView view=LangDataKeys.IDE_VIEW.getData(dataContext);
  Project project=PlatformDataKeys.PROJECT.getData(dataContext);
  PsiDirectory directory=DirectoryChooserUtil.getOrChooseDirectory(view);
  if (directory == null)   return;
  final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  boolean isDirectory=fileIndex.getPackageNameByDirectory(directory.getVirtualFile()) == null;
  MyInputValidator validator=new MyInputValidator(project,directory,isDirectory);
  Messages.showInputDialog(project,isDirectory ? IdeBundle.message("prompt.enter.new.directory.name") : IdeBundle.message("prompt.enter.new.package.name"),isDirectory ? IdeBundle.message("title.new.directory") : IdeBundle.message("title.new.package"),Messages.getQuestionIcon(),"",validator);
  if (validator.myCreatedElement == null)   return;
  view.selectElement(validator.myCreatedElement);
}
