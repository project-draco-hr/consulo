{
  Matcher matcher=PATTERN.matcher(text);
  StringBuffer buff=new StringBuffer();
  while (matcher.find()) {
    String propName=matcher.group(1);
    String resolved=resolveProperty(propName,n,additionalProperties);
    if (resolved == null)     resolved=matcher.group();
    matcher.appendReplacement(buff,Matcher.quoteReplacement(resolved));
  }
  matcher.appendTail(buff);
  return buff.toString();
}
