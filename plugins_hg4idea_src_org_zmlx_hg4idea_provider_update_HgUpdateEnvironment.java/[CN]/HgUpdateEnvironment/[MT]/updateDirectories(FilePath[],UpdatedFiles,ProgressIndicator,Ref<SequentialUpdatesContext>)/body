{
  List<VcsException> exceptions=new LinkedList<VcsException>();
  boolean result=true;
  for (  FilePath contentRoot : contentRoots) {
    if (indicator != null && indicator.isCanceled()) {
      throw new ProcessCanceledException();
    }
    if (indicator != null) {
      indicator.startNonCancelableSection();
    }
    VirtualFile repository=ProjectLevelVcsManager.getInstance(project).getVcsRootFor(contentRoot);
    if (repository == null) {
      continue;
    }
    try {
      HgUpdater updater=hgUpdaterFactory.buildUpdater(repository,updateConfiguration);
      result&=updater.update(updatedFiles,indicator,exceptions);
    }
 catch (    VcsException e) {
      exceptions.add(e);
    }
    if (indicator != null) {
      indicator.finishNonCancelableSection();
    }
  }
  return new UpdateSessionAdapter(exceptions,!result);
}
