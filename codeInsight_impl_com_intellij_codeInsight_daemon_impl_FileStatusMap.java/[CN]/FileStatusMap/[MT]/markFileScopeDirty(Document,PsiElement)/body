{
synchronized (myDocumentToStatusMap) {
    FileStatus status=myDocumentToStatusMap.get(document);
    if (status == null)     return;
    if (status.defensivelyMarked) {
      status.defensivelyMarked=false;
    }
    final PsiElement combined1=combineScopes(status.dirtyScope,scope);
    status.dirtyScope=combined1 == null ? PsiDocumentManager.getInstance(myProject).getPsiFile(document) : combined1;
    final PsiElement combined2=combineScopes(status.localInspectionsDirtyScope,scope);
    status.localInspectionsDirtyScope=combined2 == null ? PsiDocumentManager.getInstance(myProject).getPsiFile(document) : combined2;
    status.overridenDirtyScope=combineScopes(status.overridenDirtyScope,scope);
    status.externalDirtyScope=combineScopes(status.externalDirtyScope,scope);
  }
}
