{
  RefCountHolder refCountHolder=file.getUserData(REF_COUND_HOLDER_IN_FILE_KEY);
  UserDataHolderEx holder=(UserDataHolderEx)file;
  if (refCountHolder != null && !refCountHolder.isValid()) {
    holder.replace(REF_COUND_HOLDER_IN_FILE_KEY,refCountHolder,null);
    refCountHolder=null;
  }
  if (refCountHolder == null) {
    refCountHolder=holder.putUserDataIfAbsent(REF_COUND_HOLDER_IN_FILE_KEY,new RefCountHolder(file,myClearModificationCount));
  }
  refCountHolder.setLocked(lockunlock);
  return refCountHolder;
}
