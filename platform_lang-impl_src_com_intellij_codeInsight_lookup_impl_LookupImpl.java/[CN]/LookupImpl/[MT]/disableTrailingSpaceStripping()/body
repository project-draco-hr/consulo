{
  final DocumentEx document=(DocumentEx)myEditor.getDocument();
  final boolean oldStrip=document.isStripTrailingSpacesEnabled();
  document.setStripTrailingSpacesEnabled(false);
  Disposer.register(this,new Disposable(){
    @Override public void dispose(){
      document.setStripTrailingSpacesEnabled(oldStrip);
      if (!myEditor.isDisposed()) {
        int caretLine=myEditor.getCaretModel().getLogicalPosition().line;
        if (caretLine < document.getLineCount()) {
          document.markLineModified(caretLine);
        }
      }
    }
  }
);
}
