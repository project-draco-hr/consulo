{
  String lookupString=item.getLookupString();
  if (item.isCaseSensitive()) {
    return lookupString;
  }
  final String prefix=itemPattern(item);
  final int length=prefix.length();
  if (length == 0 || !StringUtil.startsWithIgnoreCase(lookupString,prefix))   return lookupString;
  boolean isAllLower=true;
  boolean isAllUpper=true;
  boolean sameCase=true;
  for (int i=0; i < length && (isAllLower || isAllUpper || sameCase); i++) {
    final char c=prefix.charAt(i);
    boolean isLower=Character.isLowerCase(c);
    boolean isUpper=Character.isUpperCase(c);
    if (!isLower && !isUpper)     continue;
    isAllLower=isAllLower && isLower;
    isAllUpper=isAllUpper && isUpper;
    sameCase=sameCase && isLower == Character.isLowerCase(lookupString.charAt(i));
  }
  if (sameCase)   return lookupString;
  if (isAllLower)   return lookupString.toLowerCase();
  if (isAllUpper)   return StringUtilRt.toUpperCase(lookupString);
  return lookupString;
}
