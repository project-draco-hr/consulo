{
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      if (myEditor.isDisposed() || myProject.isDisposed())       return;
      if (!myInitialOffset.isValid() || !myInitialSelection.isValid()) {
        hide();
        return;
      }
      final SelectionModel selectionModel=myEditor.getSelectionModel();
      if (selectionModel.hasSelection()) {
        if (myInitialSelection.getStartOffset() != selectionModel.getSelectionStart() || myInitialSelection.getEndOffset() != selectionModel.getSelectionEnd()) {
          hide();
          return;
        }
      }
 else {
        if (myEditor.getCaretModel().getOffset() != myInitialOffset.getStartOffset() + myAdditionalPrefix.length()) {
          hide();
          return;
        }
      }
      if (myShouldUpdateBounds) {
        myShouldUpdateBounds=false;
        refreshUi();
      }
    }
  }
);
}
