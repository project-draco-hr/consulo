{
  final boolean reused=mayCheckReused && checkReused();
  if (reused) {
    myOffsets.clearAdditionalPrefix();
  }
  boolean selectionVisible=isSelectionVisible();
  boolean itemsChanged=updateList(onExplicitAction || reused);
  if (isVisible()) {
    LOG.assertTrue(!ApplicationManager.getApplication().isUnitTestMode());
    if (myEditor.getComponent().getRootPane() == null) {
      LOG.error("Null root pane");
    }
    updateScrollbarVisibility();
    if (myResizePending || itemsChanged) {
      myMaximumHeight=Integer.MAX_VALUE;
    }
    Rectangle rectangle=calculatePosition();
    myMaximumHeight=rectangle.height;
    if (myResizePending || itemsChanged) {
      myResizePending=false;
      pack();
    }
    HintManagerImpl.updateLocation(this,myEditor,rectangle.getLocation());
    if (reused || selectionVisible || onExplicitAction) {
      ensureSelectionVisible();
    }
  }
}
