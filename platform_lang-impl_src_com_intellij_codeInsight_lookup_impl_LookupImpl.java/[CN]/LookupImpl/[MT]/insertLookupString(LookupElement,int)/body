{
  final String lookupString=getCaseCorrectedLookupString(item);
  final Editor hostEditor=InjectedLanguageUtil.getTopLevelEditor(myEditor);
  hostEditor.getCaretModel().runForEachCaret(new CaretAction(){
    @Override public void perform(    Caret caret){
      EditorModificationUtil.deleteSelectedText(hostEditor);
      final int caretOffset=hostEditor.getCaretModel().getOffset();
      int lookupStart=Math.min(caretOffset,Math.max(caretOffset - prefix,0));
      int len=hostEditor.getDocument().getTextLength();
      LOG.assertTrue(lookupStart >= 0 && lookupStart <= len,"ls: " + lookupStart + " caret: "+ caretOffset+ " prefix:"+ prefix+ " doc: "+ len);
      LOG.assertTrue(caretOffset >= 0 && caretOffset <= len,"co: " + caretOffset + " doc: "+ len);
      hostEditor.getDocument().replaceString(lookupStart,caretOffset,lookupString);
      int offset=lookupStart + lookupString.length();
      hostEditor.getCaretModel().moveToOffset(offset);
      hostEditor.getSelectionModel().removeSelection();
    }
  }
);
  myEditor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
}
