{
  PrefixMatcher matcher=itemMatcher(item);
  String lookupString=item.getLookupString();
  if (!item.isCaseSensitive() && matcher.prefixMatches(item) && StringUtil.startsWithIgnoreCase(lookupString,prefix)) {
    lookupString=handleCaseInsensitiveVariant(prefix,lookupString);
  }
  EditorModificationUtil.deleteSelectedText(myEditor);
  final int caretOffset=myEditor.getCaretModel().getOffset();
  int lookupStart=caretOffset - prefix.length();
  int len=myEditor.getDocument().getTextLength();
  LOG.assertTrue(lookupStart >= 0 && lookupStart <= len,"ls: " + lookupStart + "caret: "+ caretOffset+ " prefix:"+ prefix+ " doc: "+ len);
  LOG.assertTrue(caretOffset >= 0 && caretOffset <= len,"co: " + caretOffset + " doc: "+ len);
  myEditor.getDocument().replaceString(lookupStart,caretOffset,lookupString);
  int offset=lookupStart + lookupString.length();
  myEditor.getCaretModel().moveToOffset(offset);
  myEditor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
  myEditor.getSelectionModel().removeSelection();
}
