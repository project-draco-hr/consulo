{
  for (  LookupElement item : myFrozenItems) {
    if (prefixMatches(item) && firstItems.add(item)) {
      model.addElement(item);
    }
  }
  if (firstItems.size() > MAX_PREFERRED_COUNT)   return;
  for (  final List<LookupElement> elements : sortedItems) {
    final List<LookupElement> suitable=new SmartList<LookupElement>();
    for (    final LookupElement item : elements) {
      if (!firstItems.contains(item) && prefixMatches(item)) {
        suitable.add(item);
      }
    }
    if (firstItems.size() + suitable.size() > MAX_PREFERRED_COUNT)     break;
    for (    final LookupElement item : suitable) {
      firstItems.add(item);
      model.addElement(item);
      myFrozenItems.add(item);
    }
  }
}
