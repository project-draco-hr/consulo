{
  if (oldSelected != null) {
    if (oldSelected.isValid()) {
      myList.setSelectedValue(oldSelected,false);
      if (myList.getSelectedValue() == oldSelected) {
        return;
      }
    }
    if (oldInvariant != null) {
      for (      LookupElement element : getItems()) {
        if (oldInvariant.equals(myPresentableModel.getItemPresentationInvariant(element))) {
          myList.setSelectedValue(element,false);
          if (myList.getSelectedValue() == element) {
            return;
          }
        }
      }
    }
  }
  LookupElement preselected=myPresentableModel.preselectedItem;
  if (choosePreselectedItem) {
    myList.setSelectedValue(preselected,false);
  }
 else {
    myList.setSelectedIndex(doSelectMostPreferableItem(getItems(),groups));
  }
  if (preselected != null && myShown) {
    myPresentableModel.preselectedItem=getCurrentItem();
  }
}
