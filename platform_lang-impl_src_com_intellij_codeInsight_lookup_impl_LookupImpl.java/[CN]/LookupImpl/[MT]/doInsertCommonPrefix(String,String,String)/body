{
  EditorModificationUtil.deleteSelectedText(myEditor);
  int offset=myEditor.getCaretModel().getOffset();
  if (beforeCaret != null) {
    final int start=offset - presentPrefix.length();
    myAdditionalPrefix="";
    myEditor.getDocument().replaceString(start,offset,beforeCaret);
    presentPrefix=beforeCaret;
  }
  offset=myEditor.getCaretModel().getOffset();
  myEditor.getDocument().insertString(offset,afterCaret);
  final String newPrefix=presentPrefix + afterCaret;
  Map<LookupElement,PrefixMatcher> newItems=myModel.retainMatchingItems(newPrefix,this);
  myMatchers.clear();
  myMatchers.putAll(newItems);
  myAdditionalPrefix="";
  offset+=afterCaret.length();
  myEditor.getCaretModel().moveToOffset(offset);
  refreshUi();
}
