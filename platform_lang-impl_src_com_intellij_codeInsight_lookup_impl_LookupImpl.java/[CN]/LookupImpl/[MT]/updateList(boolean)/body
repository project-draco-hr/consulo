{
  if (!ApplicationManager.getApplication().isUnitTestMode()) {
    ApplicationManager.getApplication().assertIsDispatchThread();
  }
  checkValid();
  DefaultListModel listModel=(DefaultListModel)myList.getModel();
synchronized (myList) {
    Pair<List<LookupElement>,Integer> pair=myPresentableArranger.arrangeItems(this,onExplicitAction);
    List<LookupElement> items=pair.first;
    Integer toSelect=pair.second;
    if (toSelect == null || toSelect < 0 || items.size() > 0 && toSelect >= items.size()) {
      LOG.error("Arranger " + myPresentableArranger + " returned invalid selection index="+ toSelect+ "; items="+ items);
    }
    checkMinPrefixLengthChanges(items);
    Object[] oldModel=listModel.toArray();
    listModel.clear();
    if (!items.isEmpty()) {
      for (      LookupElement element : items) {
        listModel.addElement(element);
      }
    }
 else {
      addEmptyItem(listModel);
    }
    updateListHeight(listModel);
    myList.setSelectedIndex(toSelect);
    return Arrays.equals(oldModel,items.toArray());
  }
}
