{
  PsiFile hostFile=PsiDocumentManager.getInstance(myProject).getPsiFile(myEditor.getDocument());
  if (hostFile != null) {
    int offset=myEditor.getCaretModel().getOffset();
    for (    DocumentWindow documentWindow : InjectedLanguageUtil.getCachedInjectedDocuments(hostFile)) {
      if (documentWindow.isValid() && documentWindow.containsRange(offset,offset)) {
        PsiFile injectedFile=PsiDocumentManager.getInstance(myProject).getPsiFile(documentWindow);
        return InjectedLanguageUtil.getInjectedEditorForInjectedFile(myEditor,injectedFile);
      }
    }
  }
  return myEditor;
}
