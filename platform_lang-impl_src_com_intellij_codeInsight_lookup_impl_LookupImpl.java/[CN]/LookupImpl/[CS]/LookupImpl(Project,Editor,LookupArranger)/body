{
  super(new JPanel(new BorderLayout()));
  setForceShowAsPopup(true);
  myProject=project;
  myEditor=editor;
  myArranger=arranger;
  myItems=new ArrayList<LookupElement>();
  setInitialOffset(myEditor.getCaretModel().getOffset(),myEditor.getSelectionModel().getSelectionStart(),myEditor.getSelectionModel().getSelectionEnd());
  myProcessIcon=new AsyncProcessIcon("Completion progress");
  myProcessIcon.setVisible(false);
  myList=new JBList(new DefaultListModel());
  myCellRenderer=new LookupCellRenderer(this);
  myList.setCellRenderer(myCellRenderer);
  myList.setFocusable(false);
  myList.setSelectionMode(ListSelectionModel.SINGLE_SELECTION);
  myList.setBackground(LookupCellRenderer.BACKGROUND_COLOR);
  JScrollPane scrollPane=ScrollPaneFactory.createScrollPane(myList);
  scrollPane.setViewportBorder(new EmptyBorder(0,0,0,0));
  scrollPane.setHorizontalScrollBarPolicy(ScrollPaneConstants.HORIZONTAL_SCROLLBAR_NEVER);
  getComponent().add(scrollPane,BorderLayout.NORTH);
  scrollPane.setBorder(null);
  JPanel bottomPanel=new JPanel(new BorderLayout());
  bottomPanel.add(myProcessIcon,BorderLayout.EAST);
  myAdComponent=HintUtil.createAdComponent(null);
  bottomPanel.add(myAdComponent,BorderLayout.CENTER);
  getComponent().add(bottomPanel,BorderLayout.SOUTH);
  getComponent().setBorder(new BegPopupMenuBorder());
  final ListModel model=myList.getModel();
  addEmptyItem((DefaultListModel)model);
  updateListHeight(model);
}
