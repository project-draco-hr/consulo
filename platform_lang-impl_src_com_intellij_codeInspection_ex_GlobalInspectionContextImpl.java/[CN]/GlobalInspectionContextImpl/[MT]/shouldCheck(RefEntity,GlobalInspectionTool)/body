{
  if (entity instanceof RefElementImpl) {
    final RefElementImpl refElement=(RefElementImpl)entity;
    if (refElement.isSuppressed(tool.getShortName()))     return false;
    final PsiFile file=refElement.getContainingFile();
    if (file == null)     return false;
    final Project project=file.getProject();
    final Tools tools=myTools.get(tool.getShortName());
    if (tools != null) {
      for (      ScopeToolState state : tools.getTools()) {
        final NamedScope namedScope=state.getScope(project);
        if (namedScope == null || namedScope.getValue().contains(file,getCurrentProfile().getProfileManager().getScopesManager())) {
          return state.isEnabled() && ((GlobalInspectionToolWrapper)state.getTool()).getTool() == tool;
        }
      }
    }
    return false;
  }
  return true;
}
