{
  if (entity instanceof RefElementImpl) {
    final RefElementImpl refElement=(RefElementImpl)entity;
    if (refElement.isSuppressed(tool.getShortName()))     return false;
    final PsiFile file=refElement.getContainingFile();
    if (file == null)     return false;
    final Tools tools=myTools.get(tool.getShortName());
    for (    ScopeToolState state : tools.getTools()) {
      final NamedScope namedScope=state.getScope();
      if (namedScope == null || namedScope.getValue().contains(file,getCurrentProfile().getProfileManager().getScopesManager())) {
        return state.isEnabled() && ((GlobalInspectionToolWrapper)state.getTool()).getTool() == tool;
      }
    }
    return false;
  }
  return true;
}
