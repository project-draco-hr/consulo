{
  final VirtualFile f=root.createChildData(null,"file.java");
  f.setBinaryContent("before".getBytes());
  performAllPendingJobs();
  ContentChangesListener l=new ContentChangesListener(f);
  addFileListenerDuring(l,new RunnableAdapter(){
    @Override public void doRun() throws IOException {
      changeFileExternally(f.getPath(),"after");
      refreshVFS();
    }
  }
);
  assertEquals("before",l.getContentBefore());
  assertEquals("after",l.getContentAfter());
}
