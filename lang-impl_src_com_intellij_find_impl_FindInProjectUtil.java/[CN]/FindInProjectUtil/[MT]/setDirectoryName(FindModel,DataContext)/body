{
  PsiElement psiElement=LangDataKeys.PSI_ELEMENT.getData(dataContext);
  String directoryName=null;
  if (psiElement instanceof PsiDirectory) {
    directoryName=((PsiDirectory)psiElement).getVirtualFile().getPresentableUrl();
  }
 else {
    final PsiFile psiFile=LangDataKeys.PSI_FILE.getData(dataContext);
    if (psiFile != null) {
      PsiDirectory psiDirectory=psiFile.getContainingDirectory();
      if (psiDirectory != null) {
        directoryName=psiDirectory.getVirtualFile().getPresentableUrl();
      }
    }
  }
  if (directoryName == null && psiElement instanceof PsiDirectoryContainer) {
    final PsiDirectory[] directories=((PsiDirectoryContainer)psiElement).getDirectories();
    directoryName=directories.length == 1 ? directories[0].getVirtualFile().getPresentableUrl() : null;
  }
  Module module=LangDataKeys.MODULE_CONTEXT.getData(dataContext);
  if (module != null) {
    model.setModuleName(module.getName());
  }
  if (model.getModuleName() == null || dataContext.getData(DataConstants.EDITOR) == null) {
    model.setDirectoryName(directoryName);
    model.setProjectScope(directoryName == null && module == null && model.getCustomScopeName() == null || dataContext.getData(DataConstants.EDITOR) != null);
  }
}
