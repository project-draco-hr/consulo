{
  ConnectionSettingsImpl connectionSettings=new ConnectionSettingsImpl(settings.HOST,settings.PORT,proxySettings.USE_PROXY,proxySettings.PROXY_HOST,proxySettings.PROXY_PORT,timeout,proxySettings.getType(),proxySettings.getLogin(),proxySettings.getPassword());
  final ConnectionPoolI pool=SshConnectionPool.getInstance();
  final SshAuthentication authentication;
  if (sshConfiguration.USE_PPK) {
    authentication=new SshPublicKeyAuthentication(new File(sshConfiguration.PATH_TO_PPK),sshPasswordProvider.getPPKPasswordForCvsRoot(settings.getCvsRootAsString()),settings.USER);
  }
 else {
    authentication=new SshPasswordAuthentication(settings.USER,sshPasswordProvider.getPasswordForCvsRoot(settings.getCvsRootAsString()));
  }
  return pool.getConnection(settings.REPOSITORY,connectionSettings,authentication);
}
