{
  DefaultActionGroup group=new DefaultActionGroup();
  List<Charset> favorites=new ArrayList<Charset>(EncodingManager.getInstance().getFavorites());
  Collections.sort(favorites);
  Charset current=myVirtualFile == null ? null : myVirtualFile.getCharset();
  favorites.remove(current);
  if (showClear) {
    group.add(new ClearThisFileEncodingAction(myVirtualFile));
  }
  if (favorites.isEmpty() && !showClear) {
    fillCharsetActions(group,myVirtualFile,Arrays.asList(CharsetToolkit.getAvailableCharsets()));
  }
 else {
    fillCharsetActions(group,myVirtualFile,favorites);
    DefaultActionGroup more=new DefaultActionGroup("more",true);
    group.add(more);
    fillCharsetActions(more,myVirtualFile,Arrays.asList(CharsetToolkit.getAvailableCharsets()));
  }
  return group;
}
