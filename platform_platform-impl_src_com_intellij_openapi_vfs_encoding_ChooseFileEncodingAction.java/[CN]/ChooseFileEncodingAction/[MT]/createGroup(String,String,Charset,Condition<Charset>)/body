{
  DefaultActionGroup group=new DefaultActionGroup();
  List<Charset> favorites=new ArrayList<Charset>(EncodingManager.getInstance().getFavorites());
  Collections.sort(favorites);
  Charset current=myVirtualFile == null ? null : myVirtualFile.getCharset();
  favorites.remove(current);
  favorites.remove(alreadySelected);
  if (clearItemText != null) {
    group.add(new ClearThisFileEncodingAction(myVirtualFile,clearItemText));
  }
  if (favorites.isEmpty() && clearItemText == null) {
    fillCharsetActions(group,myVirtualFile,Arrays.asList(CharsetToolkit.getAvailableCharsets()),charsetFilter,pattern);
  }
 else {
    fillCharsetActions(group,myVirtualFile,favorites,charsetFilter,pattern);
    DefaultActionGroup more=new DefaultActionGroup("more",true);
    group.add(more);
    fillCharsetActions(more,myVirtualFile,Arrays.asList(CharsetToolkit.getAvailableCharsets()),charsetFilter,pattern);
  }
  return group;
}
