{
  final FileDocumentManager fileDocumentManager=FileDocumentManager.getInstance();
  final Document[] unsavedDocuments=fileDocumentManager.getUnsavedDocuments();
  for (  Document unsavedDocument : unsavedDocuments) {
    final VirtualFile file=fileDocumentManager.getFile(unsavedDocument);
    if (file != null && dirtyScope.belongsTo(new FilePathImpl(file)) && fileDocumentManager.isFileModified(file)) {
      final FileStatus status=addGate.getStatus(file);
      if (status == null || FileStatus.NOT_CHANGED.equals(status)) {
        context.addModifiedNotSavedChange(file);
      }
    }
  }
}
