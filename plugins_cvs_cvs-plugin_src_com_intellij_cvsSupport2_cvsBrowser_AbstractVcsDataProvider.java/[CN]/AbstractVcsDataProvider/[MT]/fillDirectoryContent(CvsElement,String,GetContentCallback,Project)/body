{
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    executeCommand(createDirectoryContentProvider(path),callback,parent,project);
  }
 else {
    final GetDirectoriesListViaUpdateOperation provider=new GetDirectoriesListViaUpdateOperation(myEnvironment,path);
    final MyBufferedConsumer consumer=new MyBufferedConsumer(new Consumer<DirectoryContent>(){
      public void consume(      final DirectoryContent directoryContent){
        final ArrayList<CvsElement> elements=directoryContentToElements(directoryContent,parent,project);
        if (!elements.isEmpty()) {
          callback.appendDirectoryContent(elements);
        }
      }
    }
);
    provider.setStepByStepListener(consumer);
    executeCommand(provider,callback,parent,project);
    consumer.flush();
  }
}
