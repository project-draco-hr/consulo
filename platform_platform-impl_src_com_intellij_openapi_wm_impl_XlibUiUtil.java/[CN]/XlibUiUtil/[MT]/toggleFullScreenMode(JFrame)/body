{
  if (!initialized)   return;
  try {
    long event=unsafe.allocateMemory(128);
    awtLock.invoke(null);
    try {
      unsafe.setMemory(event,128,(byte)0);
      @SuppressWarnings("deprecation") ComponentPeer peer=frame.getPeer();
      long window=(Long)getWindow.invoke(peer);
      long screen=(Long)getScreenNumber.invoke(peer);
      long rootWindow=(Long)RootWindow.invoke(null,display,screen);
      unsafe.putInt(event,CLIENT_MESSAGE);
      if (!SystemInfo.is64Bit) {
        unsafe.putInt(event + 8,True);
        unsafe.putInt(event + 16,(int)window);
        unsafe.putInt(event + 20,(int)wmStateAtom);
        unsafe.putInt(event + 24,LONG_FORMAT);
        unsafe.putInt(event + 28,(int)NET_WM_STATE_TOGGLE);
        unsafe.putInt(event + 32,(int)wmFullScreenStateAtom);
      }
 else {
        unsafe.putInt(event + 16,True);
        unsafe.putLong(event + 32,window);
        unsafe.putLong(event + 40,wmStateAtom);
        unsafe.putInt(event + 48,LONG_FORMAT);
        unsafe.putLong(event + 56,NET_WM_STATE_TOGGLE);
        unsafe.putLong(event + 64,wmFullScreenStateAtom);
      }
      XSendEvent.invoke(null,display,rootWindow,false,EVENT_MASK,event);
    }
  finally {
      awtUnlock.invoke(null);
      unsafe.freeMemory(event);
    }
  }
 catch (  Throwable t) {
    LOG.info("cannot toggle mode",t);
  }
}
