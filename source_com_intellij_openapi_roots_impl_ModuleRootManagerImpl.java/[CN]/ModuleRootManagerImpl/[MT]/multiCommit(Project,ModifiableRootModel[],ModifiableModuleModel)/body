{
  ApplicationManager.getApplication().assertWriteAccessAllowed();
  final List<RootModelImpl> modelsToCommit=getSortedChangedModels(_rootModels,moduleModel);
  final List<ModifiableRootModel> modelsToDispose=new ArrayList<ModifiableRootModel>(Arrays.asList(_rootModels));
  modelsToDispose.removeAll(modelsToCommit);
  Runnable runnable=new Runnable(){
    public void run(){
      for (int i=0; i < modelsToCommit.size(); i++) {
        RootModelImpl rootModel=modelsToCommit.get(i);
        rootModel.myModuleRootManager.commitModelWithoutEvents(rootModel);
      }
      for (int i=0; i < modelsToDispose.size(); i++) {
        ModifiableRootModel model=modelsToDispose.get(i);
        model.dispose();
      }
    }
  }
;
  ((ModuleManagerImpl)ModuleManager.getInstance(project)).commitModelWithRunnable(moduleModel,runnable);
}
