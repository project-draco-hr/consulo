{
  if (!visited.add(facet)) {
    return;
  }
  CompilerModuleExtension extension=CompilerModuleExtension.getInstance(facet.getModule());
  String thisPackage=null;
  if (extension != null) {
    VirtualFile outputDir=extension.getCompilerOutputPath();
    if (outputDir != null) {
      HashSet<String> packages=new HashSet<String>(parentPackages);
      thisPackage=collectPackages(facet,packages,new HashSet<AndroidFacet>());
      collectRClassFiles(outputDir,result,packages);
    }
  }
  for (  AndroidFacet depFacet : AndroidUtils.getAndroidDependencies(facet.getModule(),false)) {
    boolean added=false;
    if (thisPackage != null) {
      added=parentPackages.add(thisPackage);
    }
    collectRClassFiles(depFacet,result,visited,parentPackages);
    if (added) {
      parentPackages.remove(thisPackage);
    }
  }
}
