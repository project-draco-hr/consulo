{
  final JpsRemoteProto.Message message=(JpsRemoteProto.Message)e.getMessage();
  final JpsRemoteProto.Message.Builder responseBuilder=JpsRemoteProto.Message.newBuilder();
  responseBuilder.setMessageUuid(message.getMessageUuid());
  if (message.getKind() != JpsRemoteProto.Message.Kind.REQUEST) {
    responseBuilder.setKind(JpsRemoteProto.Message.Kind.FAILURE).setFailure(JpsProtoUtil.createFailure("Cannot handle message " + message.toString()));
  }
 else   if (!message.hasRequest()) {
    responseBuilder.setKind(JpsRemoteProto.Message.Kind.FAILURE).setFailure(JpsProtoUtil.createFailure("No request in message: " + message.toString()));
  }
 else {
    final JpsRemoteProto.Message.Request request=message.getRequest();
    if (request.hasCompileRequest()) {
      responseBuilder.setKind(JpsRemoteProto.Message.Kind.RESPONSE).setResponse(startBuild(request.getCompileRequest()));
    }
 else     if (request.hasStatusRequest()) {
      responseBuilder.setKind(JpsRemoteProto.Message.Kind.RESPONSE).setResponse(getBuildStatus(request.getStatusRequest()));
    }
 else {
      responseBuilder.setKind(JpsRemoteProto.Message.Kind.FAILURE).setFailure(JpsProtoUtil.createFailure("Unknown request: " + message));
    }
  }
  Channels.write(ctx,e.getFuture(),responseBuilder.build());
}
