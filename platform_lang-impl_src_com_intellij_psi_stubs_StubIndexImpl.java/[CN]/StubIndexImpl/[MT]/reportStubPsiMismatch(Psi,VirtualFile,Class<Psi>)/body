{
  if (file == null) {
    super.reportStubPsiMismatch(psi,file,requiredClass);
    return;
  }
  String msg="Invalid stub element type in index: " + file;
  msg+="; found: " + psi;
  msg+="; expected: " + requiredClass;
  msg+="\nfile stamp: " + file.getModificationStamp();
  msg+="; file size: " + file.getLength();
  msg+="; file modCount: " + file.getModificationCount();
  Document document=FileDocumentManager.getInstance().getCachedDocument(file);
  if (document != null) {
    msg+="\nsaved: " + !FileDocumentManager.getInstance().isDocumentUnsaved(document);
    msg+="; doc stamp: " + document.getModificationStamp();
    msg+="; doc size: " + document.getTextLength();
    msg+="; committed: " + PsiDocumentManager.getInstance(psi.getProject()).isCommitted(document);
  }
  PsiFile psiFile=psi.getManager().findFile(file);
  if (psiFile != null) {
    msg+="\npsiFile size: " + psiFile.getTextLength();
    msg+="; viewProvider stamp: " + psiFile.getViewProvider().getModificationStamp();
    if (psiFile instanceof PsiFileImpl) {
      StubTree stub=((PsiFileImpl)psiFile).getStubTree();
      if (stub == null) {
        FileElement treeElement=((PsiFileImpl)psiFile).getTreeElement();
        msg+="; ast loaded: " + (treeElement != null);
        if (treeElement != null) {
          msg+="; ast parsed: " + treeElement.isParsed();
          msg+="; ast size: " + treeElement.getTextLength();
        }
      }
 else {
        msg+="\nstub info=" + stub.getDebugInfo();
      }
    }
  }
  msg+="\nindexing info: " + StubUpdatingIndex.getIndexingStampInfo(file);
  LOG.error(msg);
}
