{
  final FileBasedIndexImpl fileBasedIndex=(FileBasedIndexImpl)FileBasedIndex.getInstance();
  fileBasedIndex.ensureUpToDate(StubUpdatingIndex.INDEX_ID,project,scope);
  final MyIndex<Key> index=(MyIndex<Key>)getAsyncState().myIndices.get(indexKey);
  try {
    myAccessValidator.checkAccessingIndexDuringOtherIndexProcessing(indexKey);
    try {
      FileBasedIndexImpl.disableUpToDateCheckForCurrentThread();
      index.getReadLock().lock();
      myAccessValidator.startedProcessingActivityForIndex(indexKey);
      return index.getData(key).forEach(action);
    }
  finally {
      myAccessValidator.stoppedProcessingActivityForIndex(indexKey);
      index.getReadLock().unlock();
      FileBasedIndexImpl.enableUpToDateCheckForCurrentThread();
    }
  }
 catch (  StorageException e) {
    forceRebuild(e);
  }
catch (  RuntimeException e) {
    final Throwable cause=FileBasedIndexImpl.getCauseToRebuildIndex(e);
    if (cause != null) {
      forceRebuild(cause);
    }
 else {
      throw e;
    }
  }
catch (  AssertionError ae) {
    forceRebuild(ae);
  }
  return true;
}
