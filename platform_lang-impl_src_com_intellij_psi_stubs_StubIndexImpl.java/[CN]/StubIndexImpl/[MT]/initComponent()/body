{
  try {
    final boolean forceClean=Boolean.TRUE == ourForcedClean.getAndSet(Boolean.FALSE);
    final StubIndexExtension<?,?>[] extensions=Extensions.getExtensions(StubIndexExtension.EP_NAME);
    boolean needRebuild=false;
    for (    StubIndexExtension extension : extensions) {
      needRebuild|=registerIndexer(extension,forceClean);
    }
    if (needRebuild) {
      if (ApplicationManager.getApplication().isUnitTestMode()) {
        requestRebuild();
      }
 else {
        forceRebuild(new Throwable());
      }
    }
    dropUnregisteredIndices();
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
