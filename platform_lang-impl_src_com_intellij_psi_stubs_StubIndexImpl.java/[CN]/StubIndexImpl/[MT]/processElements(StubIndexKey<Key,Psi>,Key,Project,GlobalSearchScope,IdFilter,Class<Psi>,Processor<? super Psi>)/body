{
  return doProcessStubs(indexKey,key,project,scope,new StubIdListContainerAction(idFilter,project){
    final PersistentFS fs=(PersistentFS)ManagingFS.getInstance();
    @Override protected boolean process(    int id,    StubIdList value){
      final VirtualFile file=IndexInfrastructure.findFileByIdIfCached(fs,id);
      if (file == null || scope != null && !scope.contains(file)) {
        return true;
      }
      return myStubProcessingHelper.processStubsInFile(project,file,value,processor,requiredClass);
    }
  }
);
}
