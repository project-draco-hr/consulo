{
  VirtualFile faultyContainer=PsiUtilCore.getVirtualFile(psi);
  if (faultyContainer != null) {
    Document document=FileDocumentManager.getInstance().getDocument(file);
    PsiFile psiFile=psi.getManager().findFile(file);
    String msg="Invalid stub element type in index: " + file;
    msg+="; found: " + psi;
    msg+="; file stamp: " + file.getModificationStamp();
    msg+="; file modCount: " + file.getModificationCount();
    if (document != null) {
      msg+="; unsaved: " + FileDocumentManager.getInstance().isDocumentUnsaved(document);
      msg+="; doc stamp: " + document.getModificationStamp();
      msg+="; committed: " + PsiDocumentManager.getInstance(psi.getProject()).isCommitted(document);
    }
    if (psiFile != null) {
      msg+="; psi stamp: " + psiFile.getModificationStamp();
      msg+="; viewProvider stamp: " + psiFile.getViewProvider().getModificationStamp();
    }
    LOG.error(msg);
    return;
  }
  super.reportStubPsiMismatch(psi,file);
}
