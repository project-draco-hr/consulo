{
  final boolean forceClean=Boolean.TRUE == ourForcedClean.getAndSet(Boolean.FALSE);
  StubIndexExtension<?,?>[] extensions=Extensions.getExtensions(StubIndexExtension.EP_NAME);
  StringBuilder updated=new StringBuilder();
  for (  StubIndexExtension extension : extensions) {
    @SuppressWarnings("unchecked") boolean rebuildRequested=registerIndexer(extension,forceClean);
    if (rebuildRequested) {
      updated.append(extension).append(' ');
    }
  }
  if (updated.length() > 0) {
    if (ApplicationManager.getApplication().isUnitTestMode()) {
      requestRebuild();
    }
 else {
      final Throwable e=new Throwable(updated.toString());
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        @Override public void run(){
          forceRebuild(e);
        }
      }
,ModalityState.NON_MODAL);
    }
  }
  dropUnregisteredIndices();
  myStubProcessingHelper=new StubProcessingHelper(fileBasedIndex);
}
