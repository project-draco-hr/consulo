def catcommit(ui, repo, n, prefix, ctx=None):
    nlprefix = ('\n' + prefix)
    if (ctx is None):
        ctx = repo[n]
    ui.write(('tree %s\n' % short(ctx.changeset()[0])))
    for p in ctx.parents():
        ui.write(('parent %s\n' % p))
    date = ctx.date()
    description = ctx.description().replace('\x00', '')
    lines = description.splitlines()
    if (lines and lines[(-1)].startswith('committer:')):
        committer = lines[(-1)].split(': ')[1].rstrip()
    else:
        committer = ctx.user()
    ui.write(('author %s %s %s\n' % (ctx.user(), int(date[0]), date[1])))
    ui.write(('committer %s %s %s\n' % (committer, int(date[0]), date[1])))
    ui.write(('revision %d\n' % ctx.rev()))
    ui.write(('branch %s\n\n' % ctx.branch()))
    if (prefix != ''):
        ui.write(('%s%s\n' % (prefix, description.replace('\n', nlprefix).strip())))
    else:
        ui.write((description + '\n'))
    if prefix:
        ui.write('\x00')
