{
  VirtualFile[] selectedFiles=context.getSelectedFiles();
  if (selectedFiles == null)   return false;
  if (selectedFiles.length != 1)   return false;
  VirtualFile file=selectedFiles[0];
  if (file.isDirectory())   return false;
  Project project=context.getProject();
  if (project == null || project.isDisposed())   return false;
  final ProjectLevelVcsManager plVcsManager=ProjectLevelVcsManager.getInstance(project);
  final BackgroundableActionEnabledHandler handler=((ProjectLevelVcsManagerImpl)plVcsManager).getBackgroundableActionHandler(VcsBackgroundableActions.ANNOTATE);
  if (handler.isInProgress(file.getPath()))   return false;
  AbstractVcs vcs=plVcsManager.getVcsFor(file);
  if (vcs == null)   return false;
  final AnnotationProvider annotationProvider=vcs.getAnnotationProvider();
  if (annotationProvider == null)   return false;
  final FileStatus fileStatus=FileStatusManager.getInstance(project).getStatus(file);
  if (fileStatus == FileStatus.UNKNOWN || fileStatus == FileStatus.ADDED || fileStatus == FileStatus.IGNORED) {
    return false;
  }
  return hasTextEditor(file);
}
