{
  if (myInlineThisOnly) {
    return new UsageInfo[]{new UsageInfo(myCallToInline)};
  }
  final Collection<PsiReference> refCollection=ReferencesSearch.search(myClass).findAll();
  Set<UsageInfo> usages=new HashSet<UsageInfo>();
  for (  PsiReference reference : refCollection) {
    usages.add(new UsageInfo(reference.getElement()));
  }
  final String qName=myClass.getQualifiedName();
  if (qName != null) {
    List<UsageInfo> nonCodeUsages=new ArrayList<UsageInfo>();
    if (mySearchInComments) {
      RefactoringUtil.addUsagesInStringsAndComments(myClass,qName,nonCodeUsages,new NonCodeUsageInfoFactory(myClass,qName));
    }
    if (mySearchInNonJavaFiles) {
      GlobalSearchScope projectScope=GlobalSearchScope.projectScope(myClass.getProject());
      TextOccurrencesUtil.addTextOccurences(myClass,qName,projectScope,nonCodeUsages,new NonCodeUsageInfoFactory(myClass,qName));
    }
    usages.addAll(nonCodeUsages);
  }
  return usages.toArray(new UsageInfo[usages.size()]);
}
