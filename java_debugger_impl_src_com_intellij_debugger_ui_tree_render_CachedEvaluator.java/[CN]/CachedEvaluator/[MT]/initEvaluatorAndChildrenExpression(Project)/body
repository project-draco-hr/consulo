{
  final Cache cache=new Cache();
  try {
    final PsiClass contextClass=DebuggerUtils.findClass(getClassName(),project,GlobalSearchScope.allScope(project));
    if (contextClass == null) {
      throw EvaluateExceptionUtil.CANNOT_FIND_SOURCE_CLASS;
    }
    final PsiType contextType=DebuggerUtils.getType(getClassName(),project);
    cache.myPsiChildrenExpression=null;
    JavaCodeFragment codeFragment=myDefaultFragmentFactory.createCodeFragment(myReferenceExpression,contextClass,project);
    codeFragment.forceResolveScope(GlobalSearchScope.allScope(project));
    codeFragment.setThisType(contextType);
    DebuggerUtils.checkSyntax(codeFragment);
    cache.myPsiChildrenExpression=((PsiExpressionCodeFragment)codeFragment).getExpression();
    cache.myEvaluator=((DebuggerUtilsEx)DebuggerUtils.getInstance()).getEvaluatorBuilder().build(cache.myPsiChildrenExpression,null);
  }
 catch (  EvaluateException e) {
    cache.myException=e;
  }
  myCache=new SoftReference<Cache>(cache);
  return cache;
}
