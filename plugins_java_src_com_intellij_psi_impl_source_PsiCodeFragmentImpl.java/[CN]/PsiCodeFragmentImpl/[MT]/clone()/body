{
  final PsiCodeFragmentImpl clone=(PsiCodeFragmentImpl)cloneImpl((FileElement)calcTreeElement().clone());
  clone.myPhysical=false;
  clone.myOriginalFile=this;
  clone.myPseudoImports=new LinkedHashMap<String,String>(myPseudoImports);
  FileManager fileManager=((PsiManagerEx)getManager()).getFileManager();
  SingleRootFileViewProvider cloneViewProvider=(SingleRootFileViewProvider)fileManager.createFileViewProvider(new LightVirtualFile(getName(),getLanguage(),getText()),false);
  cloneViewProvider.forceCachedPsi(clone);
  clone.myViewProvider=cloneViewProvider;
  return clone;
}
