{
  final String qname=((PsiJavaFile)PsiFileFactory.getInstance(getPsiManager().getProject()).createFileFromText("a.java",text)).getClasses()[0].getQualifiedName();
  final VirtualFile[] files=ModuleRootManager.getInstance(myModule).getSourceRoots();
  File dir;
  if (files.length > 0) {
    dir=VfsUtil.virtualToIoFile(files[0]);
  }
 else {
    dir=createTempDir("unitTest");
    addSourceContentToRoots(myModule,LocalFileSystem.getInstance().refreshAndFindFileByPath(dir.getCanonicalPath().replace(File.separatorChar,'/')));
  }
  File file=new File(dir,qname.replace('.','/') + ".java");
  file.getParentFile().mkdirs();
  file.createNewFile();
  VirtualFile vFile=LocalFileSystem.getInstance().refreshAndFindFileByPath(file.getCanonicalPath().replace(File.separatorChar,'/'));
  VfsUtil.saveText(vFile,text);
  return ((PsiJavaFile)myPsiManager.findFile(vFile)).getClasses()[0];
}
