{
  myApp=app;
  myActive=new BusyObject.Impl(){
    @Override public boolean isReady(){
      return myApp.isActive();
    }
  }
;
  myShouldSynchronize=false;
  mySyncAlarm=new Alarm();
  app.getMessageBus().connect().subscribe(ApplicationActivationListener.TOPIC,new ApplicationActivationListener.Adapter(){
    @Override public void applicationActivated(    IdeFrame ideFrame){
      myActive.onReady();
      mySyncAlarm.cancelAllRequests();
      if (myShouldSynchronize) {
        myShouldSynchronize=false;
        fireActivationEvent();
      }
    }
    @Override public void applicationDeactivated(    IdeFrame ideFrame){
      mySyncAlarm.cancelAllRequests();
      mySyncAlarm.addRequest(new Runnable(){
        @Override public void run(){
          if (!app.isActive()) {
            myShouldSynchronize=true;
            fireDeactivationEvent();
          }
        }
      }
,200);
    }
  }
);
}
