{
  final Project project=getEventProject(e);
  final VirtualFile[] files=e.getData(PlatformDataKeys.VIRTUAL_FILE_ARRAY);
  if (project == null || files == null || files.length == 0)   return Collections.emptyList();
  final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  List<VirtualFile> archives=new ArrayList<VirtualFile>();
  for (  VirtualFile file : files) {
    addJarRoot(archives,file,fileIndex);
    if (file.isDirectory()) {
      for (      VirtualFile child : file.getChildren()) {
        addJarRoot(archives,child,fileIndex);
      }
    }
  }
  return archives;
}
