{
  LOG.assertTrue(!ProgressManager.getInstance().hasProgressIndicator(),"Password should not be accessed under modal progress");
  try {
    if (passwordChanged && !masterPasswordRefused) {
      PasswordSafe.getInstance().storePassword(null,GithubSettings.class,GITHUB_SETTINGS_PASSWORD_KEY,getPassword());
    }
  }
 catch (  MasterPasswordUnavailableException e) {
    LOG.info("Couldn't store password for key [" + GITHUB_SETTINGS_PASSWORD_KEY + "]",e);
    masterPasswordRefused=true;
  }
catch (  Exception e) {
    Messages.showErrorDialog("Error happened while storing password for github","Error");
    LOG.info("Couldn't get password for key [" + GITHUB_SETTINGS_PASSWORD_KEY + "]",e);
  }
  passwordChanged=false;
  final Element element=new Element(GITHUB_SETTINGS_TAG);
  element.setAttribute(LOGIN,getLogin());
  element.setAttribute(HOST,getHost());
  element.setAttribute(ANONIMOUS_GIST,String.valueOf(isAnonymous()));
  element.setAttribute(PRIVATE_GIST,String.valueOf(isPrivateGist()));
  element.setAttribute(OPEN_IN_BROWSER_GIST,String.valueOf(isOpenInBrowserGist()));
  Element trustedHosts=new Element(TRUSTED_HOSTS);
  for (  String host : myTrustedHosts) {
    Element hostEl=new Element(TRUSTED_HOST);
    hostEl.setAttribute(TRUSTED_URL,host);
    trustedHosts.addContent(hostEl);
  }
  element.addContent(trustedHosts);
  return element;
}
