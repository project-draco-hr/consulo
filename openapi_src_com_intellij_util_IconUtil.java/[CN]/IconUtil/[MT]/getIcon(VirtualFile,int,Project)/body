{
  Icon icon=getBaseIcon(file,flags,project);
  Icon excludedIcon=null;
  if (project != null) {
    final ProjectFileIndex projectFileIndex=ProjectRootManager.getInstance(project).getFileIndex();
    if (projectFileIndex.isInSource(file) && CompilerManager.getInstance(project).isExcludedFromCompilation(file)) {
      excludedIcon=Icons.EXCLUDED_FROM_COMPILE_ICON;
    }
  }
  Icon lockedIcon=null;
  if ((flags & Iconable.ICON_FLAG_READ_STATUS) != 0 && !file.isWritable()) {
    lockedIcon=Icons.LOCKED_ICON;
  }
  if (excludedIcon != null || lockedIcon != null) {
    LayeredIcon layeredIcon=new LayeredIcon(1 + (lockedIcon != null ? 1 : 0) + (excludedIcon != null ? 1 : 0));
    int layer=0;
    layeredIcon.setIcon(icon,layer++);
    if (lockedIcon != null) {
      layeredIcon.setIcon(lockedIcon,layer++);
    }
    if (excludedIcon != null) {
      layeredIcon.setIcon(excludedIcon,layer);
    }
    icon=layeredIcon;
  }
  return icon;
}
