{
  Icon providersIcon=getProvidersIcon(file,flags,project);
  Icon icon=providersIcon == null ? file.getIcon() : providersIcon;
  if (project != null) {
    final ProjectFileIndex projectFileIndex=ProjectRootManager.getInstance(project).getFileIndex();
    final boolean isUnderSource=projectFileIndex.isJavaSourceFile(file);
    FileType fileType=FileTypeManager.getInstance().getFileTypeByFile(file);
    if (fileType == StdFileTypes.JAVA) {
      if (!isUnderSource) {
        icon=Icons.JAVA_OUTSIDE_SOURCE_ICON;
      }
 else {
        PsiFile psiFile=PsiManager.getInstance(project).findFile(file);
        if (psiFile instanceof PsiClassOwner) {
          PsiClass[] classes=((PsiClassOwner)psiFile).getClasses();
          if (classes.length > 0) {
            final String fileName=file.getNameWithoutExtension();
            Icon classIcon=null;
            for (            PsiClass aClass : classes) {
              if (Comparing.strEqual(aClass.getName(),fileName)) {
                classIcon=aClass.getIcon(flags);
                break;
              }
            }
            if (classIcon == null)             classIcon=classes[classes.length - 1].getIcon(flags);
            icon=classIcon;
          }
        }
      }
    }
  }
  return icon;
}
