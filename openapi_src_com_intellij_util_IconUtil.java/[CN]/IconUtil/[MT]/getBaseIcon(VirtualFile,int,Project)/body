{
  Icon providersIcon=getProvidersIcon(file,flags,project);
  Icon icon=providersIcon == null ? file.getIcon() : providersIcon;
  if (project != null) {
    final ProjectFileIndex projectFileIndex=ProjectRootManager.getInstance(project).getFileIndex();
    final boolean isUnderSource=projectFileIndex.isJavaSourceFile(file);
    FileType fileType=FileTypeManager.getInstance().getFileTypeByFile(file);
    if (fileType == StdFileTypes.JAVA) {
      if (!isUnderSource) {
        icon=Icons.JAVA_OUTSIDE_SOURCE_ICON;
      }
 else {
        PsiFile psiFile=PsiManager.getInstance(project).findFile(file);
        if (psiFile instanceof PsiJavaFile) {
          PsiClass[] classes=((PsiJavaFile)psiFile).getClasses();
          if (classes.length != 0) {
            final String fileName=file.getNameWithoutExtension();
            for (            PsiClass aClass : classes) {
              icon=aClass.getIcon(flags);
              if (Comparing.strEqual(aClass.getName(),fileName))               break;
            }
          }
        }
      }
    }
  }
  return icon;
}
