{
  ExitCode exitCode=ExitCode.NOTHING_DONE;
  final ProjectDescriptor pd=context.getProjectDescriptor();
  final boolean addNotNullAssertions=JpsJavaExtensionService.getInstance().getOrCreateCompilerConfiguration(pd.getProject()).isAddNotNullAssertions();
  if (addNotNullAssertions) {
    final ProjectPaths paths=context.getProjectPaths();
    final Collection<File> classpath=paths.getCompilationClasspath(chunk,false);
    final Collection<File> platformCp=paths.getPlatformCompilationClasspath(chunk,false);
    final InstrumentationClassFinder finder=createInstrumentationClassFinder(platformCp,classpath,outputConsumer);
    try {
      try {
        context.processMessage(new ProgressMessage("Adding NotNull assertions [" + chunk.getName() + "]"));
        exitCode=instrumentNotNull(context,outputConsumer,finder);
      }
  finally {
        context.processMessage(new ProgressMessage("Finished adding NotNull assertions [" + chunk.getName() + "]"));
      }
    }
  finally {
      finder.releaseResources();
    }
  }
  return exitCode;
}
