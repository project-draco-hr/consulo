{
  if (myExpr.equals(assignment.getRExpression())) {
    PsiExpression lExpr=assignment.getLExpression();
    PsiType type=lExpr.getType();
    if (type != null) {
      TailType tailType=TailType.NONE;
      if (assignment.getParent() instanceof PsiExpressionStatement) {
        if (!(assignment.getParent().getParent() instanceof PsiForStatement)) {
          tailType=TailType.SEMICOLON;
        }
 else {
          PsiForStatement forStatement=(PsiForStatement)assignment.getParent().getParent();
          if (!assignment.getParent().equals(forStatement.getUpdate())) {
            tailType=TailType.SEMICOLON;
          }
        }
      }
      ExpectedTypeInfoImpl info=createInfoImpl(type,ExpectedTypeInfo.TYPE_OR_SUBTYPE,type,tailType);
      if (lExpr instanceof PsiReferenceExpression) {
        PsiElement refElement=((PsiReferenceExpression)lExpr).resolve();
        if (refElement instanceof PsiVariable) {
          info.expectedName=getPropertyName((PsiVariable)refElement);
        }
      }
      myResult=new ExpectedTypeInfo[]{info};
    }
 else {
      myResult=ExpectedTypeInfo.EMPTY_ARRAY;
    }
  }
 else {
    if (myForCompletion) {
      myExpr=(PsiExpression)myExpr.getParent();
      assignment.getParent().accept(this);
      return;
    }
    PsiExpression rExpr=assignment.getRExpression();
    if (rExpr != null) {
      PsiType type=rExpr.getType();
      if (type != null) {
        if (type instanceof PsiClassType) {
          final PsiClass resolved=((PsiClassType)type).resolve();
          if (resolved instanceof PsiAnonymousClass) {
            type=((PsiAnonymousClass)resolved).getBaseClassType();
          }
        }
        ExpectedTypeInfoImpl info=createInfoImpl(type,ExpectedTypeInfo.TYPE_OR_SUPERTYPE,type,TailType.NONE);
        myResult=new ExpectedTypeInfo[]{info};
        return;
      }
    }
    myResult=ExpectedTypeInfo.EMPTY_ARRAY;
  }
}
