{
  if (myForCompletion) {
    myExpr=(PsiExpression)myExpr.getParent();
    expr.getParent().accept(this);
    for (    final ExpectedTypeInfo info : myResult) {
      ((ExpectedTypeInfoImpl)info).myTailType=TailType.NONE;
    }
    return;
  }
  if (myExpr.equals(expr.getIndexExpression())) {
    ExpectedTypeInfoImpl info=createInfoImpl(PsiType.INT,ExpectedTypeInfo.TYPE_OR_SUBTYPE,PsiType.INT,TailType.NONE);
    myResult=new ExpectedTypeInfo[]{info};
  }
 else   if (myExpr.equals(expr.getArrayExpression())) {
    PsiElement parent=expr.getParent();
    MyParentVisitor visitor=new MyParentVisitor(expr,myForCompletion,myClassProvider);
    myExpr=(PsiExpression)myExpr.getParent();
    parent.accept(visitor);
    ExpectedTypeInfo[] componentTypeInfo=visitor.getResult();
    if (componentTypeInfo.length == 0) {
      myResult=anyArrayType();
    }
 else {
      myResult=new ExpectedTypeInfoImpl[componentTypeInfo.length];
      for (int i=0; i < componentTypeInfo.length; i++) {
        ExpectedTypeInfo compInfo=componentTypeInfo[i];
        PsiType expectedArrayType=compInfo.getType().createArrayType();
        myResult[i]=createInfoImpl(expectedArrayType,ExpectedTypeInfo.TYPE_OR_SUBTYPE,expectedArrayType,TailType.NONE);
      }
    }
  }
}
