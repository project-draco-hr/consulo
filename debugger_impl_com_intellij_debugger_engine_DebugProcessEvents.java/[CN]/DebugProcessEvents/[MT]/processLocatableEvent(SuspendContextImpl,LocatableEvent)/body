{
  if (myReturnValueWatcher != null && event instanceof MethodExitEvent) {
    if (myReturnValueWatcher.processMethodExitEvent(((MethodExitEvent)event))) {
      return;
    }
  }
  ThreadReference thread=event.thread();
  LOG.assertTrue(thread.isSuspended());
  preprocessEvent(suspendContext,thread);
  getManagerThread().invokeLater(new SuspendContextCommandImpl(suspendContext){
    public void contextAction() throws Exception {
      final SuspendManager suspendManager=getSuspendManager();
      SuspendContextImpl evaluatingContext=SuspendManagerUtil.getEvaluatingContext(suspendManager,getSuspendContext().getThread());
      if (evaluatingContext != null) {
        suspendManager.voteResume(suspendContext);
        return;
      }
      LocatableEventRequestor requestor=(LocatableEventRequestor)getRequestsManager().findRequestor(event.request());
      final boolean requestorAsksResume=(requestor == null) || requestor.processLocatableEvent(this,event);
      final boolean userWantsResume=(requestor instanceof Breakpoint) && DebuggerSettings.SUSPEND_NONE.equals(((Breakpoint)requestor).SUSPEND_POLICY);
      if (requestor instanceof Breakpoint && !requestorAsksResume) {
        myBreakpointManager.processBreakpointHit((Breakpoint)requestor);
      }
      if (requestorAsksResume || userWantsResume) {
        suspendManager.voteResume(suspendContext);
      }
 else {
        if (myReturnValueWatcher != null) {
          myReturnValueWatcher.setTrackingEnabled(false);
        }
        if (suspendContext.getSuspendPolicy() == EventRequest.SUSPEND_ALL) {
          myBreakpointManager.applyThreadFilter(DebugProcessEvents.this,event.thread());
        }
        suspendManager.voteSuspend(suspendContext);
        showStatusText(DebugProcessEvents.this,event);
      }
    }
  }
);
}
