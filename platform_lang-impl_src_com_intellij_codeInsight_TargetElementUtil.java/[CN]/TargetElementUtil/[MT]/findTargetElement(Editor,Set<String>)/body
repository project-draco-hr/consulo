{
  ApplicationManager.getApplication().assertIsDispatchThread();
  final PsiElement result=findTargetElement(editor,flags,editor.getCaretModel().getOffset());
  if (result != null) {
    return result;
  }
  final Integer offset=editor.getUserData(EditorActionUtil.EXPECTED_CARET_OFFSET);
  if (offset != null) {
    return findTargetElement(editor,flags,offset);
  }
  return result;
}
