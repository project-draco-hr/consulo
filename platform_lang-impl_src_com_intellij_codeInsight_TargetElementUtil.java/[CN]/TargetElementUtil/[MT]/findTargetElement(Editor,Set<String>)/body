{
  ApplicationManager.getApplication().assertIsDispatchThread();
  int offset=editor.getCaretModel().getOffset();
  final PsiElement result=findTargetElement(editor,flags,offset);
  if (result != null)   return result;
  int expectedCaretOffset=editor instanceof EditorEx ? ((EditorEx)editor).getExpectedCaretOffset() : offset;
  if (expectedCaretOffset != offset) {
    return findTargetElement(editor,flags,expectedCaretOffset);
  }
  return null;
}
