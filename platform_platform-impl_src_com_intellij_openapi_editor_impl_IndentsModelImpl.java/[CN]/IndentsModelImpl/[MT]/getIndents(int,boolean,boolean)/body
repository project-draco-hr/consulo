{
  DocumentImpl myDocument=(DocumentImpl)myEditor.getDocument();
  if (line <= 0 || line >= myDocument.getLineCount())   return 0;
  int lineStart=myDocument.getLineStartOffset(line);
  int lineEnd=myDocument.getLineEndOffset(line);
  CharSequence chars=myDocument.getCharsNoThreadCheck();
  int nonWhitespaceOffset=CharArrayUtil.shiftForward(chars,lineStart," \t");
  if (nonWhitespaceOffset < lineEnd) {
    return myEditor.calcColumnNumber(nonWhitespaceOffset,line) / getIndentSize();
  }
 else {
    int upIndent=goUp ? getIndents(line - 1,true,false) : 100;
    int downIndent=goDown ? getIndents(line + 1,false,true) : 100;
    return Math.min(upIndent,downIndent);
  }
}
