{
  byte[] typeSignature=new byte[4];
  typeSignature[0]=(byte)type.charAt(0);
  typeSignature[1]=(byte)type.charAt(1);
  typeSignature[2]=(byte)type.charAt(2);
  typeSignature[3]=(byte)type.charAt(3);
  dos.flush();
  baos.flush();
  byte[] data=baos.toByteArray();
  int len=data.length;
  output.writeInt(len);
  output.write(typeSignature);
  output.write(data,0,len);
  int crc=0xffffffff;
  crc=CRC.updateCRC(crc,typeSignature,0,4);
  crc=CRC.updateCRC(crc,data,0,len);
  output.writeInt(crc ^ 0xffffffff);
}
