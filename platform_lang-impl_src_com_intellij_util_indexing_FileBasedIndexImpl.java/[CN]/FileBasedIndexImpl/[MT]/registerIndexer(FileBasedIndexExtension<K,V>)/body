{
  final ID<K,V> name=extension.getName();
  final int version=extension.getVersion();
  final File versionFile=IndexInfrastructure.getVersionFile(name);
  final boolean versionFileExisted=versionFile.exists();
  boolean versionChanged=false;
  if (IndexingStamp.versionDiffers(versionFile,version)) {
    if (versionFileExisted) {
      versionChanged=true;
      LOG.info("Version has changed for index " + name + ". The index will be rebuilt.");
    }
    if (extension.hasSnapshotMapping() && versionChanged) {
      FileUtil.deleteWithRenaming(IndexInfrastructure.getPersistentIndexRootDir(name));
    }
    File rootDir=IndexInfrastructure.getIndexRootDir(name);
    if (versionFileExisted)     FileUtil.deleteWithRenaming(rootDir);
    IndexingStamp.rewriteVersion(versionFile,version);
  }
  initIndexStorage(extension,version,versionFile);
  return versionChanged;
}
