{
  if (project.isDisposed()) {
    return;
  }
  final ProjectFileIndex projectFileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  projectFileIndex.iterateContent(processor);
  if (project.isDisposed()) {
    return;
  }
  Set<VirtualFile> visitedRoots=new THashSet<VirtualFile>();
  for (  IndexableSetContributor provider : IndexableSetContributor.EP_NAME.getExtensions()) {
    if (project.isDisposed()) {
      return;
    }
    for (    VirtualFile root : provider.getAdditionalRootsToIndex()) {
      if (visitedRoots.add(root)) {
        iterateRecursively(root,processor,indicator,visitedRoots,null);
      }
    }
    for (    VirtualFile root : provider.getAdditionalProjectRootsToIndex(project)) {
      if (visitedRoots.add(root)) {
        iterateRecursively(root,processor,indicator,visitedRoots,null);
      }
    }
  }
  if (project.isDisposed()) {
    return;
  }
  for (  Module module : ModuleManager.getInstance(project).getModules()) {
    if (module.isDisposed()) {
      return;
    }
    OrderEntry[] orderEntries=ModuleRootManager.getInstance(module).getOrderEntries();
    for (    OrderEntry orderEntry : orderEntries) {
      if (orderEntry instanceof OrderEntryWithTracking) {
        if (orderEntry.isValid()) {
          final VirtualFile[] libSources=orderEntry.getFiles(SourcesOrderRootType.getInstance());
          final VirtualFile[] libClasses=orderEntry.getFiles(BinariesOrderRootType.getInstance());
          for (          VirtualFile[] roots : new VirtualFile[][]{libSources,libClasses}) {
            for (            VirtualFile root : roots) {
              if (visitedRoots.add(root)) {
                iterateRecursively(root,processor,indicator,null,projectFileIndex);
              }
            }
          }
        }
      }
    }
  }
}
