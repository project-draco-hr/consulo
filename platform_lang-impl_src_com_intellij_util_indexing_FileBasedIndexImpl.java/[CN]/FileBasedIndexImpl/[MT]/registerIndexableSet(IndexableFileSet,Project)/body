{
  myIndexableSets.add(set);
  myIndexableSetToProjectMap.put(set,project);
  if (project != null) {
    ((PsiManagerImpl)PsiManager.getInstance(project)).addTreeChangePreprocessor(new PsiTreeChangePreprocessor(){
      @Override public void treeChanged(      @NotNull PsiTreeChangeEventImpl event){
        if (event.isGenericChange() && event.getCode() == PsiTreeChangeEventImpl.PsiEventType.CHILDREN_CHANGED) {
          PsiFile file=event.getFile();
          if (file != null) {
            VirtualFile virtualFile=file.getVirtualFile();
            if (virtualFile instanceof VirtualFileWithId) {
              boolean wasIndexed=false;
              for (              ID<?,?> psiBackedIndex : myPsiDependentIndices) {
                if (isFileIndexed(virtualFile,psiBackedIndex)) {
                  IndexingStamp.update(virtualFile,psiBackedIndex,IndexInfrastructure.INVALID_STAMP2);
                  wasIndexed=true;
                }
              }
              if (wasIndexed) {
                myChangedFilesCollector.scheduleForUpdate(virtualFile);
                IndexingStamp.flushCache(virtualFile);
              }
            }
          }
        }
      }
    }
);
  }
}
