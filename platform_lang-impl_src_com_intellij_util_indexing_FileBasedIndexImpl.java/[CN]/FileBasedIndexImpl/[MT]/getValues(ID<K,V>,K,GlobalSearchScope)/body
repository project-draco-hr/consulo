{
  final List<V> values=new SmartList<V>();
  VirtualFile restrictToFile=null;
  if (filter instanceof Iterable) {
    final Iterator<VirtualFile> virtualFileIterator=((Iterable<VirtualFile>)filter).iterator();
    if (virtualFileIterator.hasNext()) {
      VirtualFile restrictToFileCandidate=virtualFileIterator.next();
      if (!virtualFileIterator.hasNext()) {
        restrictToFile=restrictToFileCandidate;
      }
    }
  }
  processValuesImpl(indexId,dataKey,true,restrictToFile,new ValueProcessor<V>(){
    @Override public boolean process(    final VirtualFile file,    final V value){
      values.add(value);
      return true;
    }
  }
,filter,null);
  return values;
}
