{
  if (ApplicationManager.getApplication().isDisposed()) {
    return;
  }
  final File registeredIndicesFile=new File(PathManager.getIndexRoot(),"registered");
  final Set<String> result=new THashSet<String>();
  try {
    final DataInputStream in=new DataInputStream(new BufferedInputStream(new FileInputStream(registeredIndicesFile)));
    try {
      final int size=in.readInt();
      for (int idx=0; idx < size; idx++) {
        result.add(IOUtil.readString(in));
      }
    }
  finally {
      in.close();
    }
  }
 catch (  IOException ignored1) {
  }
  final Set<String> indicesToDrop=result;
  for (  ID<?,?> key : ids) {
    indicesToDrop.remove(key.toString());
  }
  if (!indicesToDrop.isEmpty()) {
    LOG.info("Dropping indices:" + StringUtil.join(indicesToDrop,","));
    for (    String s : indicesToDrop) {
      FileUtil.deleteWithRenaming(IndexInfrastructure.getIndexRootDir(ID.create(s)));
    }
  }
  try {
    FileUtil.createIfDoesntExist(registeredIndicesFile);
    final DataOutputStream os=new DataOutputStream(new BufferedOutputStream(new FileOutputStream(registeredIndicesFile)));
    try {
      os.writeInt(ids.size());
      for (      ID<?,?> id : ids) {
        IOUtil.writeString(id.toString(),os);
      }
    }
  finally {
      os.close();
    }
  }
 catch (  IOException ignored) {
  }
}
