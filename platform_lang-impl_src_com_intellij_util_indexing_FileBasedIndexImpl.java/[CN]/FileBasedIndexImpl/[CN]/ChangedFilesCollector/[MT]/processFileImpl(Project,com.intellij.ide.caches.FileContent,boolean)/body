{
  final VirtualFile file=fileContent.getVirtualFile();
  final boolean reallyRemoved=myFilesToUpdate.remove(file);
  if (reallyRemoved && file.isValid()) {
    try {
      if (onlyRemoveOutdatedData || isTooLarge(file)) {
        final List<ID<?,?>> affected=new ArrayList<ID<?,?>>();
        for (        final ID<?,?> indexId : getAffectedIndexCandidates(file)) {
          if (needsFileContentLoading(indexId) && getInputFilter(indexId).acceptInput(project,file)) {
            affected.add(indexId);
          }
        }
        removeFileDataFromIndices(affected,file);
      }
 else {
        indexFileContent(project,fileContent);
      }
    }
  finally {
      IndexingStamp.flushCache(file);
    }
  }
}
