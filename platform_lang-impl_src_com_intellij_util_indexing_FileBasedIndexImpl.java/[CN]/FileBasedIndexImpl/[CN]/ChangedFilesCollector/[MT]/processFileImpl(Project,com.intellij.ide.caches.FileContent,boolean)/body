{
  final VirtualFile file=fileContent.getVirtualFile();
  final boolean reallyRemoved=myFilesToUpdate.remove(file);
  if (reallyRemoved && file.isValid()) {
    try {
      if (onlyRemoveOutdatedData || isTooLarge(file)) {
        removeFileDataFromIndices(calculateAffectedContentIndices(project,file),file);
        if (onlyRemoveOutdatedData && file instanceof VirtualFileSystemEntry) {
          ((VirtualFileSystemEntry)file).setFileIndexed(false);
        }
      }
 else {
        doIndexFileContent(project,fileContent);
      }
    }
  finally {
      IndexingStamp.flushCache(file);
    }
  }
}
