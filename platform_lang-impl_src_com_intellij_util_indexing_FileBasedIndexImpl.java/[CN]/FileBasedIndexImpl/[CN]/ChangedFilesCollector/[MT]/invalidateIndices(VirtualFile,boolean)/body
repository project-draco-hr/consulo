{
  VfsUtilCore.visitChildrenRecursively(file,new VirtualFileVisitor(){
    @Override public boolean visitFile(    @NotNull VirtualFile file){
      if (isUnderConfigOrSystem(file)) {
        return false;
      }
      if (file.isDirectory()) {
        invalidateIndicesForFile(file,markForReindex);
        if (!isMock(file) && !myManagingFS.wereChildrenAccessed(file)) {
          return false;
        }
      }
 else {
        invalidateIndicesForFile(file,markForReindex);
      }
      return true;
    }
    @Override public Iterable<VirtualFile> getChildrenIterable(    @NotNull VirtualFile file){
      return file instanceof NewVirtualFile ? ((NewVirtualFile)file).iterInDbChildren() : null;
    }
  }
);
}
