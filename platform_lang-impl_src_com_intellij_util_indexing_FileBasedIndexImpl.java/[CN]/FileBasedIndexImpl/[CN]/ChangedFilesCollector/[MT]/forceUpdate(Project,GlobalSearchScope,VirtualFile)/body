{
  myChangedFilesCollector.tryToEnsureAllInvalidateTasksCompleted();
  Collection<VirtualFile> allFilesToUpdate=getAllFilesToUpdate();
  if (!allFilesToUpdate.isEmpty()) {
    boolean includeFilesFromOtherProjects=restrictedTo == null && (myForceUpdateRequests.incrementAndGet() & 0x3F) == 0;
    List<VirtualFile> virtualFilesToBeUpdatedForProject=ContainerUtil.filter(allFilesToUpdate,new ProjectFilesCondition(projectIndexableFiles(project),filter,restrictedTo,includeFilesFromOtherProjects));
    if (!virtualFilesToBeUpdatedForProject.isEmpty()) {
      myForceUpdateTask.processAll(virtualFilesToBeUpdatedForProject,project);
    }
  }
}
