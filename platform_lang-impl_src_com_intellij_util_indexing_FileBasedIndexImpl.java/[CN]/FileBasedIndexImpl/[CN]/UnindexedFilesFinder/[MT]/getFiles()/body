{
  List<VirtualFile> files;
synchronized (myFiles) {
    files=myFiles;
  }
  BitSet usedFileIds=new BitSet(files.size());
  List<VirtualFile> localFileSystemFiles=new ArrayList<VirtualFile>(files.size() / 2);
  List<VirtualFile> archiveFiles=new ArrayList<VirtualFile>(files.size() / 2);
  for (  VirtualFile file : files) {
    int fileId=((VirtualFileWithId)file).getId();
    if (fileId > 0) {
      if (usedFileIds.get(fileId))       continue;
      usedFileIds.set(fileId);
    }
    if (file.getFileSystem() instanceof LocalFileSystem) {
      localFileSystemFiles.add(file);
    }
 else {
      archiveFiles.add(file);
    }
  }
  localFileSystemFiles.addAll(archiveFiles);
  return localFileSystemFiles;
}
