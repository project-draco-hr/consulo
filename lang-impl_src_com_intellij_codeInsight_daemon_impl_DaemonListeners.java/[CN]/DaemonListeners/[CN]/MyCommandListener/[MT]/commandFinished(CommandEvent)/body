{
  Document affectedDocument=extractDocumentFromCommand(event);
  if (!worthBothering(affectedDocument)) {
    return;
  }
  if (myEscPressed) {
    myEscPressed=false;
    if (affectedDocument != null) {
      if (!myDaemonCodeAnalyzer.getFileStatusMap().allDirtyScopesAreNull(affectedDocument)) {
        stopDaemon(true);
      }
    }
  }
 else   if (!myDaemonCodeAnalyzer.getUpdateProgress().isRunning()) {
    stopDaemon(true);
  }
}
