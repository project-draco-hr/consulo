{
  newClass.accept(new PsiRecursiveElementVisitor(){
    public void visitReferenceElement(    final PsiJavaCodeReferenceElement reference){
      PsiElement element=reference.resolve();
      if (element instanceof PsiClass && PsiTreeUtil.isAncestor(classToMove,element,false)) {
        PsiClass newInnerClass=findMatchingClass(classToMove,newClass,(PsiClass)element);
        try {
          reference.bindToElement(newInnerClass);
        }
 catch (        IncorrectOperationException ex) {
          LOG.error(ex);
        }
      }
 else {
        super.visitReferenceElement(reference);
      }
    }
  }
);
}
