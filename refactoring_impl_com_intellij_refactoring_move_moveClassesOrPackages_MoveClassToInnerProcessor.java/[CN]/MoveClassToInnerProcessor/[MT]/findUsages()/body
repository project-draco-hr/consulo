{
  MoveClassUsageCollector collector=new MoveClassUsageCollector(new PsiElement[]{myClassToMove},mySearchInComments,mySearchInNonJavaFiles){
    protected String getNewName(    final PsiElement element){
      return myTargetClass.getQualifiedName() + "." + ((PsiClass)element).getName();
    }
  }
;
  List<UsageInfo> usages=collector.collectUsages();
  for (Iterator<UsageInfo> iterator=usages.iterator(); iterator.hasNext(); ) {
    UsageInfo usageInfo=iterator.next();
    if (!(usageInfo instanceof NonCodeUsageInfo) && PsiTreeUtil.isAncestor(myClassToMove,usageInfo.getElement(),false)) {
      iterator.remove();
    }
  }
  return usages.toArray(new UsageInfo[usages.size()]);
}
