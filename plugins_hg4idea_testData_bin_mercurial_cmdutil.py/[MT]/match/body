def match(repo, pats=[], opts={}, globbed=False, default='relpath'):
    if ((not globbed) and (default == 'relpath')):
        pats = expandpats((pats or []))
    m = _match.match(repo.root, repo.getcwd(), pats, opts.get('include'), opts.get('exclude'), default)

    def badfn(f, msg):
        repo.ui.warn(('%s: %s\n' % (m.rel(f), msg)))
    m.bad = badfn
    return m
