def commit(ui, repo, commitfunc, pats, opts):
    'commit the specified files or all outstanding changes'
    date = opts.get('date')
    if date:
        opts['date'] = util.parsedate(date)
    message = logmessage(opts)
    if opts.get('addremove'):
        addremove(repo, pats, opts)
    return commitfunc(ui, repo, message, match(repo, pats, opts), opts)
