def remoteui(src, opts):
    'build a remote ui from ui or repo and opts'
    if hasattr(src, 'baseui'):
        dst = src.baseui.copy()
        src = src.ui
    else:
        dst = src.copy()
    for o in ('ssh', 'remotecmd'):
        v = (opts.get(o) or src.config('ui', o))
        if v:
            dst.setconfig('ui', o, v)
    r = src.config('bundle', 'mainreporoot')
    if r:
        dst.setconfig('bundle', 'mainreporoot', r)
    for sect in ('auth', 'http_proxy'):
        for (key, val) in src.configitems(sect):
            dst.setconfig(sect, key, val)
    return dst
