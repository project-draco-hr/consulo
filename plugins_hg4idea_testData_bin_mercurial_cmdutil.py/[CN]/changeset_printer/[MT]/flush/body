def flush(self, rev):
    if (rev in self.header):
        h = self.header[rev]
        if (h != self.lastheader):
            self.lastheader = h
            self.ui.write(h)
        del self.header[rev]
    if (rev in self.hunk):
        self.ui.write(self.hunk[rev])
        del self.hunk[rev]
        return 1
    return 0
