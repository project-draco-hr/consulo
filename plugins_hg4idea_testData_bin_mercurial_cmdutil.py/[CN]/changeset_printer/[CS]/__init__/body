def __init__(self, ui, repo, patch, diffopts, buffered):
    self.ui = ui
    self.repo = repo
    self.buffered = buffered
    self.patch = patch
    self.diffopts = diffopts
    self.header = {}
    self.hunk = {}
    self.lastheader = None
    self.footer = None
