{
  if (!editor.getSelectionModel().hasSelection()) {
    final TemplateState templateState=TemplateManagerImpl.getTemplateState(editor);
    if (templateState != null && !templateState.isFinished()) {
      CommandProcessor.getInstance().setCurrentCommandName(CodeInsightBundle.message("finish.template.command"));
      templateState.gotoEnd();
      return;
    }
  }
  myOriginalHandler.execute(editor,dataContext);
}
