{
  Presentation presentation=event.getPresentation();
  DataContext dataContext=event.getDataContext();
  FileEditor editor=(FileEditor)dataContext.getData(DataConstants.FILE_EDITOR);
  if (editor == null && dataContext.getData(DataConstants.IS_MODAL_CONTEXT) == Boolean.TRUE) {
    presentation.setEnabled(false);
    return;
  }
  final Project project=getProject(editor,dataContext);
  UndoManager undoManager=project != null ? UndoManager.getInstance(project) : UndoManager.getGlobalInstance();
  boolean b=undoManager.isUndoAvailable(editor);
  presentation.setEnabled(b);
}
