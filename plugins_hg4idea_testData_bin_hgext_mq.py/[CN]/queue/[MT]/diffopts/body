def diffopts(self, opts={}, patchfn=None):
    diffopts = patch.diffopts(self.ui, opts)
    if (self.gitmode == 'auto'):
        diffopts.upgrade = True
    elif (self.gitmode == 'keep'):
        pass
    elif (self.gitmode in ('yes', 'no')):
        diffopts.git = (self.gitmode == 'yes')
    else:
        raise util.Abort((_('mq.git option can be auto/keep/yes/no got %s') % self.gitmode))
    if patchfn:
        diffopts = self.patchopts(diffopts, patchfn)
    return diffopts
