def qparents(self, repo, rev=None):
    if (rev is None):
        (p1, p2) = repo.dirstate.parents()
        if (p2 == nullid):
            return p1
        if (len(self.applied) == 0):
            return None
        return bin(self.applied[(-1)].rev)
    pp = repo.changelog.parents(rev)
    if (pp[1] != nullid):
        arevs = [x.rev for x in self.applied]
        p0 = hex(pp[0])
        p1 = hex(pp[1])
        if (p0 in arevs):
            return pp[0]
        if (p1 in arevs):
            return pp[1]
    return pp[0]
