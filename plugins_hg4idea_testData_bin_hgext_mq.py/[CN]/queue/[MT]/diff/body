def diff(self, repo, pats, opts):
    (top, patch) = self.check_toppatch(repo)
    if (not top):
        self.ui.write(_('no patches applied\n'))
        return
    qp = self.qparents(repo, top)
    if opts.get('reverse'):
        (node1, node2) = (None, qp)
    else:
        (node1, node2) = (qp, None)
    diffopts = self.diffopts(opts, patch)
    self.printdiff(repo, diffopts, node1, node2, files=pats, opts=opts)
