def __init__(self, ui, path, patchdir=None):
    self.basepath = path
    self.path = (patchdir or os.path.join(path, 'patches'))
    self.opener = util.opener(self.path)
    self.ui = ui
    self.applied_dirty = 0
    self.series_dirty = 0
    self.series_path = 'series'
    self.status_path = 'status'
    self.guards_path = 'guards'
    self.active_guards = None
    self.guards_dirty = False
    try:
        gitmode = ui.configbool('mq', 'git', None)
        if (gitmode is None):
            raise error.ConfigError()
        self.gitmode = ((gitmode and 'yes') or 'no')
    except error.ConfigError:
        self.gitmode = ui.config('mq', 'git', 'auto').lower()
    self.plainmode = ui.configbool('mq', 'plain', False)
