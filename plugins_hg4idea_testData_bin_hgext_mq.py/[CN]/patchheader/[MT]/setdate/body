def setdate(self, date):
    if (not self.updateheader(['Date: ', '# Date '], date)):
        try:
            patchheaderat = self.comments.index('# HG changeset patch')
            self.comments.insert((patchheaderat + 1), ('# Date ' + date))
        except ValueError:
            if (self.plainmode or self._hasheader(['From: '])):
                self.comments = ([('Date: ' + date)] + self.comments)
            else:
                tmp = ['# HG changeset patch', ('# Date ' + date), '']
                self.comments = (tmp + self.comments)
    self.date = date
