def setuser(self, user):
    if (not self.updateheader(['From: ', '# User '], user)):
        try:
            patchheaderat = self.comments.index('# HG changeset patch')
            self.comments.insert((patchheaderat + 1), ('# User ' + user))
        except ValueError:
            if (self.plainmode or self._hasheader(['Date: '])):
                self.comments = ([('From: ' + user)] + self.comments)
            else:
                tmp = ['# HG changeset patch', ('# User ' + user), '']
                self.comments = (tmp + self.comments)
    self.user = user
