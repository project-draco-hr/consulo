def pop(ui, repo, patch=None, **opts):
    'pop the current patch off the stack\n\n    By default, pops off the top of the patch stack. If given a patch\n    name, keeps popping off patches until the named patch is at the\n    top of the stack.\n    '
    localupdate = True
    if opts['name']:
        q = queue(ui, repo.join(''), repo.join(opts['name']))
        ui.warn((_('using patch queue: %s\n') % q.path))
        localupdate = False
    else:
        q = repo.mq
    ret = q.pop(repo, patch, force=opts['force'], update=localupdate, all=opts['all'])
    q.save_dirty()
    return ret
