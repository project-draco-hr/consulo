def finish(ui, repo, *revrange, **opts):
    'move applied patches into repository history\n\n    Finishes the specified revisions (corresponding to applied\n    patches) by moving them out of mq control into regular repository\n    history.\n\n    Accepts a revision range or the -a/--applied option. If --applied\n    is specified, all applied mq revisions are removed from mq\n    control. Otherwise, the given revisions must be at the base of the\n    stack of applied patches.\n\n    This can be especially useful if your changes have been applied to\n    an upstream repository, or if you are about to push your changes\n    to upstream.\n    '
    if ((not opts['applied']) and (not revrange)):
        raise util.Abort(_('no revisions specified'))
    elif opts['applied']:
        revrange = (('qbase:qtip',) + revrange)
    q = repo.mq
    if (not q.applied):
        ui.status(_('no patches applied\n'))
        return 0
    revs = cmdutil.revrange(repo, revrange)
    q.finish(repo, revs)
    q.save_dirty()
    return 0
