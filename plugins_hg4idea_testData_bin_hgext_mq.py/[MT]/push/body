def push(ui, repo, patch=None, **opts):
    'push the next patch onto the stack\n\n    When -f/--force is applied, all local changes in patched files\n    will be lost.\n    '
    q = repo.mq
    mergeq = None
    if opts['merge']:
        if opts['name']:
            newpath = repo.join(opts['name'])
        else:
            (newpath, i) = lastsavename(q.path)
        if (not newpath):
            ui.warn(_('no saved queues found, please use -n\n'))
            return 1
        mergeq = queue(ui, repo.join(''), newpath)
        ui.warn((_('merging with queue at: %s\n') % mergeq.path))
    ret = q.push(repo, patch, force=opts['force'], list=opts['list'], mergeq=mergeq, all=opts.get('all'))
    return ret
