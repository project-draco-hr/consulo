def unapplied(ui, repo, patch=None, **opts):
    'print the patches not yet applied'
    q = repo.mq
    if patch:
        if (patch not in q.series):
            raise util.Abort((_('patch %s is not in series file') % patch))
        start = (q.series.index(patch) + 1)
    else:
        start = q.series_end(True)
    if ((start == len(q.series)) and opts.get('first')):
        ui.write(_('all patches applied\n'))
        return 1
    length = ((opts.get('first') and 1) or None)
    return q.qseries(repo, start=start, length=length, status='U', summary=opts.get('summary'))
