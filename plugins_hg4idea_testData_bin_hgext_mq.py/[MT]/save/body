def save(ui, repo, **opts):
    'save current queue state (DEPRECATED)\n\n    This command is deprecated, use rebase --mq instead.'
    q = repo.mq
    message = cmdutil.logmessage(opts)
    ret = q.save(repo, msg=message)
    if ret:
        return ret
    q.save_dirty()
    if opts['copy']:
        path = q.path
        if opts['name']:
            newpath = os.path.join(q.basepath, opts['name'])
            if os.path.exists(newpath):
                if (not os.path.isdir(newpath)):
                    raise util.Abort((_('destination %s exists and is not a directory') % newpath))
                if (not opts['force']):
                    raise util.Abort((_('destination %s exists, use -f to force') % newpath))
        else:
            newpath = savename(path)
        ui.warn((_('copy %s to %s\n') % (path, newpath)))
        util.copyfiles(path, newpath)
    if opts['empty']:
        try:
            os.unlink(q.join(q.status_path))
        except:
            pass
    return 0
