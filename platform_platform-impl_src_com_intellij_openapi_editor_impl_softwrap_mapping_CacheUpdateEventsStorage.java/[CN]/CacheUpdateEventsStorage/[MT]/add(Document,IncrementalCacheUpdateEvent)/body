{
  if (myEvents.isEmpty()) {
    myEvents.add(event);
    return;
  }
  int i=findIndex(event);
  if (i < 0) {
    i=-i - 1;
  }
  if (event.getExactOffsetsDiff() != 0) {
    if (i >= myEvents.size()) {
      myEvents.add(event);
    }
 else {
      myEvents.add(i,event);
    }
    return;
  }
  boolean shouldAdd=true;
  if (i > 0) {
    IncrementalCacheUpdateEvent previous=myEvents.get(i - 1);
    if (previous.getExactOffsetsDiff() == 0 && previous.getOldEndOffset() == event.getOldStartOffset() - 1) {
      myEvents.set(i - 1,new IncrementalCacheUpdateEvent(document,previous.getOldStartOffset(),event.getOldEndOffset()));
      shouldAdd=false;
    }
  }
  if (i < myEvents.size()) {
    IncrementalCacheUpdateEvent next=myEvents.get(i);
    if (next.getExactOffsetsDiff() == 0 && next.getOldStartOffset() == event.getOldEndOffset() + 1) {
      if (shouldAdd) {
        myEvents.set(i,new IncrementalCacheUpdateEvent(document,event.getOldStartOffset(),next.getOldEndOffset()));
      }
 else {
        IncrementalCacheUpdateEvent previous=myEvents.get(i - 1);
        myEvents.set(i - 1,new IncrementalCacheUpdateEvent(document,previous.getOldStartOffset(),next.getOldEndOffset()));
        myEvents.remove(i);
      }
      shouldAdd=false;
    }
  }
  if (shouldAdd) {
    myEvents.add(i,event);
  }
}
