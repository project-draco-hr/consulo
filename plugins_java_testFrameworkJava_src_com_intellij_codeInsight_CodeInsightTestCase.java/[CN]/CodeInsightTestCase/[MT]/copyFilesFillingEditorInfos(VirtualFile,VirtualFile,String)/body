{
  LinkedHashMap<VirtualFile,EditorInfo> editorInfos=new LinkedHashMap<VirtualFile,EditorInfo>();
  List<OutputStream> streamsToClose=new ArrayList<OutputStream>();
  for (  String relativePath : relativePaths) {
    if (relativePath.startsWith("/")) {
      relativePath=relativePath.substring(1);
    }
    final VirtualFile fromFile=fromDir.findFileByRelativePath(relativePath);
    assertNotNull(fromDir.getPath() + "/" + relativePath,fromFile);
    VirtualFile toFile=toDir.findFileByRelativePath(relativePath);
    if (toFile == null) {
      final File file=new File(toDir.getPath(),relativePath);
      FileUtil.createIfDoesntExist(file);
      toFile=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(file);
      assertNotNull(file.getCanonicalPath(),toFile);
    }
    toFile.putUserData(VfsTestUtil.TEST_DATA_FILE_PATH,FileUtil.toSystemDependentName(fromFile.getPath()));
    editorInfos.put(toFile,copyContent(fromFile,toFile,streamsToClose));
  }
  for (int i=streamsToClose.size() - 1; i >= 0; --i) {
    streamsToClose.get(i).close();
  }
  return editorInfos;
}
