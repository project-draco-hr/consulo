{
  PsiFile file=event.getFile();
  if (file == null)   file=child.getContainingFile();
  if (file == null) {
    myFileStatusMap.markAllFilesDirty();
    return;
  }
  if (!child.isValid())   return;
  if (file.getViewProvider().getVirtualFile() instanceof LightVirtualFile) {
    return;
  }
  Document document=PsiDocumentManager.getInstance(myProject).getCachedDocument(file);
  if (document != null) {
    List<Pair<PsiElement,Boolean>> toUpdate=changedElements.get(document);
    if (toUpdate == null) {
      toUpdate=new SmartList<Pair<PsiElement,Boolean>>();
      changedElements.put(document,toUpdate);
    }
    toUpdate.add(Pair.create(child,whitespaceOptimizationAllowed));
  }
}
