{
  try {
    int restartCode=getRestartCode();
    if (restartCode != 0) {
      runCommand(beforeRestart);
      return restartCode;
    }
 else     if (SystemInfo.isWindows) {
      restartOnWindows(beforeRestart);
      return 0;
    }
 else     if (SystemInfo.isMac) {
      restartOnMac(beforeRestart);
      return 0;
    }
  }
 catch (  Throwable t) {
    throw new IOException("Cannot restart application: " + t.getMessage(),t);
  }
  runCommand(beforeRestart);
  throw new IOException("Cannot restart application: not supported.");
}
