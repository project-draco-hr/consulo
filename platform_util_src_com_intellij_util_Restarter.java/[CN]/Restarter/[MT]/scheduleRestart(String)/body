{
  int restartCode=getRestartCode();
  if (restartCode != 0) {
    try {
      Process process=Runtime.getRuntime().exec(beforeRestart);
      Thread outThread=new Thread(new StreamRedirector(process.getInputStream(),System.out));
      Thread errThread=new Thread(new StreamRedirector(process.getErrorStream(),System.err));
      outThread.start();
      errThread.start();
      try {
        process.waitFor();
      }
  finally {
        outThread.join();
        errThread.join();
      }
    }
 catch (    InterruptedException ignore) {
    }
    return restartCode;
  }
 else   if (SystemInfo.isWindows) {
    restartOnWindows(beforeRestart);
    return 0;
  }
 else   if (SystemInfo.isMac) {
    restartOnMac(beforeRestart);
    return 0;
  }
  throw new IOException("Cannot restart application: not supported.");
}
