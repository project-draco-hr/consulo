{
  unregisterEditor(editor);
  final Window window=windowByEditor(editor);
  if (window == null)   return;
  myEditorToWindowMap.put(editor,window);
  List<Editor> list=myWindowToEditorsMap.get(window);
  if (list == null) {
    list=new ArrayList<>();
    myWindowToEditorsMap.put(window,list);
    if (!(window instanceof IdeFrameImpl)) {
      WindowAdapter listener=new WindowAdapter(){
        @Override public void windowGainedFocus(        WindowEvent e){
          if (LOG.isDebugEnabled()) {
            LOG.debug("windowGainedFocus:" + window);
          }
          setActiveWindow(window);
        }
        @Override public void windowLostFocus(        WindowEvent e){
          if (LOG.isDebugEnabled()) {
            LOG.debug("windowLostFocus:" + window);
          }
          setActiveWindow(null);
        }
        @Override public void windowClosed(        WindowEvent event){
          if (LOG.isDebugEnabled()) {
            LOG.debug("windowClosed:" + window);
          }
          setActiveWindow(null);
        }
      }
;
      myWindowToWindowFocusListenerMap.put(window,listener);
      window.addWindowFocusListener(listener);
      window.addWindowListener(listener);
      if (window.isFocused()) {
        setActiveWindow(window);
      }
    }
  }
  list.add(editor);
  if (myActiveWindow == window) {
    setActiveWindow(window);
  }
}
