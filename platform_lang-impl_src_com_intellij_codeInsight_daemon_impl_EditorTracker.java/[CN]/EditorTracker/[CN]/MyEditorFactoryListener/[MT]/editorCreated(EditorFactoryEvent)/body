{
  final Editor editor=event.getEditor();
  if (editor.getProject() != null && editor.getProject() != myProject)   return;
  PsiFile psiFile=PsiDocumentManager.getInstance(myProject).getPsiFile(editor.getDocument());
  if (psiFile == null)   return;
  final JComponent component=editor.getComponent();
  final JComponent contentComponent=editor.getContentComponent();
  final HierarchyListener hierarchyListener=new HierarchyListener(){
    @Override public void hierarchyChanged(    HierarchyEvent e){
      registerEditor(editor);
    }
  }
;
  component.addHierarchyListener(hierarchyListener);
  final FocusListener focusListener=new FocusListener(){
    @Override public void focusGained(    FocusEvent e){
      editorFocused(editor);
    }
    @Override public void focusLost(    FocusEvent e){
    }
  }
;
  contentComponent.addFocusListener(focusListener);
  myExecuteOnEditorRelease.put(event.getEditor(),new Runnable(){
    @Override public void run(){
      component.removeHierarchyListener(hierarchyListener);
      contentComponent.removeFocusListener(focusListener);
    }
  }
);
}
