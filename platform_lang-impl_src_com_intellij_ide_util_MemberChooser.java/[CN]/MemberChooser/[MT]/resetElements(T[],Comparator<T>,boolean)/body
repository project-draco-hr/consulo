{
  final List<T> selectedElements=restoreSelectedElements && mySelectedElements != null ? new ArrayList<T>(mySelectedElements) : null;
  myElements=elements;
  if (sortComparator != null) {
    myComparator=new ElementNodeComparatorWrapper(sortComparator);
  }
  mySelectedNodes.clear();
  myNodeToParentMap.clear();
  myElementToNodeMap.clear();
  myContainerNodes.clear();
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    @Override public void run(){
      myTreeModel=buildModel();
    }
  }
);
  myTree.setModel(myTreeModel);
  myTree.setRootVisible(false);
  doSort();
  defaultExpandTree();
  if (myOptionControls == null) {
    myCopyJavadocCheckbox=new NonFocusableCheckBox(IdeBundle.message("checkbox.copy.javadoc"));
    if (myIsInsertOverrideVisible) {
      myInsertOverrideAnnotationCheckbox=new NonFocusableCheckBox(IdeBundle.message("checkbox.insert.at.override"));
      myOptionControls=new JCheckBox[]{myCopyJavadocCheckbox,myInsertOverrideAnnotationCheckbox};
    }
 else {
      myOptionControls=new JCheckBox[]{myCopyJavadocCheckbox};
    }
  }
  myTree.doLayout();
  setOKActionEnabled(myAllowEmptySelection || myElements != null && myElements.length > 0);
  if (selectedElements != null) {
    selectElements(selectedElements.toArray(new ClassMember[selectedElements.size()]));
  }
  if (mySelectedElements == null || mySelectedElements.isEmpty()) {
    expandFirst();
  }
}
