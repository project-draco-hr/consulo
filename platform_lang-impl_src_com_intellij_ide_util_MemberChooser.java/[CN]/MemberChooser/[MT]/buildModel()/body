{
  final DefaultMutableTreeNode rootNode=new DefaultMutableTreeNode();
  final Ref<Integer> count=new Ref<Integer>(0);
  final FactoryMap<MemberChooserObject,ParentNode> map=new FactoryMap<MemberChooserObject,ParentNode>(){
    protected ParentNode create(    final MemberChooserObject key){
      ParentNode node=null;
      if (key instanceof PsiElementMemberChooserObject) {
        final ContainerNode containerNode=new ContainerNode(rootNode,key,count);
        node=containerNode;
        myContainerNodes.add(containerNode);
      }
      if (node == null) {
        node=new ParentNode(rootNode,key,count);
      }
      return node;
    }
  }
;
  for (  T object : myElements) {
    final ParentNode parentNode=map.get(object.getParentNodeDelegate());
    final MemberNode elementNode=new MemberNode(parentNode,object,count);
    myNodeToParentMap.put(elementNode,parentNode);
    myElementToNodeMap.put(object,elementNode);
  }
  return new DefaultTreeModel(rootNode);
}
