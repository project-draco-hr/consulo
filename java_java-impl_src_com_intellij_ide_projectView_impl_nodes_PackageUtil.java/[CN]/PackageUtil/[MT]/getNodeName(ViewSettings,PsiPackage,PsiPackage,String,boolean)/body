{
  final String name;
  if (isFQNameShown) {
    name=settings.isAbbreviatePackageNames() ? TreeViewUtil.calcAbbreviatedPackageFQName(aPackage) : aPackage.getQualifiedName();
  }
 else   if (parentPackageInTree != null) {
    PsiPackage parentPackage=aPackage.getParentPackage();
    final StringBuilder buf=new StringBuilder();
    buf.append(aPackage.getName());
    while (parentPackage != null && !parentPackage.equals(parentPackageInTree)) {
      final String parentPackageName=parentPackage.getName();
      if (parentPackageName == null || "".equals(parentPackageName)) {
        break;
      }
      buf.insert(0,".");
      buf.insert(0,parentPackageName);
      parentPackage=parentPackage.getParentPackage();
    }
    name=buf.toString();
  }
 else {
    name=defaultShortName;
  }
  return name;
}
