def __init__(self, ui, source, dest, revmapfile, opts):
    self.source = source
    self.dest = dest
    self.ui = ui
    self.opts = opts
    self.commitcache = {}
    self.authors = {}
    self.authorfile = None
    self.map = mapfile(ui, revmapfile)
    authorfile = self.dest.authorfile()
    if (authorfile and os.path.exists(authorfile)):
        self.readauthormap(authorfile)
    if opts.get('authors'):
        self.readauthormap(opts.get('authors'))
        self.authorfile = self.dest.authorfile()
    self.splicemap = mapfile(ui, opts.get('splicemap'))
    self.branchmap = mapfile(ui, opts.get('branchmap'))
