def convertsource(ui, path, type, rev):
    exceptions = []
    if (type and (type not in [s[0] for s in source_converters])):
        raise util.Abort((_('%s: invalid source repository type') % type))
    for (name, source, sortmode) in source_converters:
        try:
            if ((not type) or (name == type)):
                return (source(ui, path, rev), sortmode)
        except (NoRepo, MissingTool) as inst:
            exceptions.append(inst)
    if (not ui.quiet):
        for inst in exceptions:
            ui.write(('%s\n' % inst))
    raise util.Abort((_('%s: missing or unsupported repository') % path))
