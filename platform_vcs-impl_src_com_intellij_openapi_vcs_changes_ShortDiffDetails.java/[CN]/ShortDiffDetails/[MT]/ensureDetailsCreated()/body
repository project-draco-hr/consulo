{
  if (myDetailsConsumer != null)   return;
  myDetailsPanel=new DetailsPanel();
  final PairConsumer<Change,Pair<RefreshablePanel,Disposable>> cacheConsumer=new PairConsumer<Change,Pair<RefreshablePanel,Disposable>>(){
    @Override public void consume(    Change change,    Pair<RefreshablePanel,Disposable> pair){
      final FilePath filePath=ChangesUtil.getFilePath(change);
      final Pair<RefreshablePanel,Disposable> old=myDetailsCache.get(filePath);
      if (old == null) {
        myDetailsCache.put(filePath,pair);
      }
 else       if (old != pair) {
        if (pair.getSecond() != null) {
          Disposer.dispose(pair.getSecond());
        }
      }
    }
  }
;
  myDetailsConsumer=new PairConsumer<Change,Pair<RefreshablePanel,Disposable>>(){
    @Override public void consume(    Change change,    Pair<RefreshablePanel,Disposable> pair){
      cacheConsumer.consume(change,pair);
      pair.getFirst().refresh();
      myDetailsPanel.data(pair.getFirst().getPanel());
      myDetailsPanel.layout();
    }
  }
;
  myDetailsLoader=new GenericDetailsLoader<Change,Pair<RefreshablePanel,Disposable>>(new Consumer<Change>(){
    @Override public void consume(    Change change){
      final FilePath filePath=ChangesUtil.getFilePath(change);
      Pair<RefreshablePanel,Disposable> details=myDetailsCache.get(filePath);
      if (details != null) {
        myDetailsConsumer.consume(change,details);
      }
 else       if (myVcsChangeDetailsManager.getPanel(change,myDetailsLoader)) {
        myDetailsPanel.loading();
        myDetailsPanel.layout();
      }
    }
  }
,myDetailsConsumer);
  myDetailsLoader.setCacheConsumer(cacheConsumer);
}
