{
  if (typeInfo == NULL) {
    dataStream.writeByte(NULL_FLAGS);
    return;
  }
  boolean hasEllipsis=typeInfo.isEllipsis;
  String text=typeInfo.text.getString();
  byte arrayCount=typeInfo.arrayCount;
  int frequentIndex=ourFrequentTypeIndex.get(text);
  List<PsiAnnotationStub> annotations=typeInfo.myAnnotationStubs;
  boolean hasAnnotations=!annotations.isEmpty();
  int flags=(hasEllipsis ? HAS_ELLIPSIS : 0) | (arrayCount != 0 ? HAS_ARRAY_COUNT : 0) | (hasAnnotations ? HAS_ANNOTATIONS : 0)| frequentIndex;
  dataStream.writeByte(flags);
  if (arrayCount != 0) {
    dataStream.writeByte(arrayCount);
  }
  if (frequentIndex == 0) {
    dataStream.writeName(text);
  }
  if (hasAnnotations) {
    LOG.assertTrue(annotations.size() < 256,annotations.size());
    dataStream.writeByte(annotations.size());
    for (    PsiAnnotationStub annotation : annotations) {
      dataStream.writeUTFFast(annotation.getText());
    }
  }
}
