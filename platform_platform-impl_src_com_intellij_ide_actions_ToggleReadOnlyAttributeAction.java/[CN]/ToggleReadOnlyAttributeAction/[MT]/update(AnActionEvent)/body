{
  VirtualFile[] files=getFiles(e.getDataContext());
  e.getPresentation().setEnabled(files.length > 0);
  if (files.length > 0) {
    boolean allReadOnly=true;
    boolean allWritable=true;
    for (    VirtualFile file : files) {
      if (file.isWritable()) {
        allReadOnly=false;
      }
 else {
        allWritable=false;
      }
    }
    if (allReadOnly) {
      e.getPresentation().setText(files.length > 1 ? "Make Files Writable" : "Make File Writable");
    }
 else     if (allWritable) {
      e.getPresentation().setText(files.length > 1 ? "Make Files Read-only" : "Make File Read-only");
    }
 else {
      e.getPresentation().setText("Toggle Read-only Attribute");
    }
  }
}
