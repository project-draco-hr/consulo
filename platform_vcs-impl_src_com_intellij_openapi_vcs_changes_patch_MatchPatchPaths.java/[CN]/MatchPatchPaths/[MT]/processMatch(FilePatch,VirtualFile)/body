{
  final String beforeName=patch.getBeforeName();
  final Pair<VirtualFile,Integer> pair=compareNames(beforeName,file);
  if (pair == null)   return null;
  final VirtualFile parent=pair.getFirst();
  if (parent == null)   return null;
  final AbstractFilePatchInProgress result=createPatchInProgress(patch,parent);
  if (result != null) {
    processStipUp(result,pair.getSecond());
  }
  return result;
}
