{
  for (  final TextFilePatch patch : list) {
    final String fileName=patch.getBeforeFileName();
    if (patch.isNewFile() || (patch.getBeforeName() == null)) {
      newOrWithoutMatches.add(patch);
      continue;
    }
    final Collection<VirtualFile> files=application.runReadAction(new Computable<Collection<VirtualFile>>(){
      public Collection<VirtualFile> compute(){
        return directoryDetector.findFiles(fileName);
      }
    }
);
    if (patch.getBeforeName() != null && patch.getBeforeName().startsWith("..")) {
      final VirtualFile relativeFile=VfsUtil.findRelativeFile(myBaseDir,patch.getBeforeName().replace('\\','/').split("/"));
      if (relativeFile != null) {
        files.add(relativeFile);
      }
    }
    if (files.isEmpty()) {
      newOrWithoutMatches.add(patch);
    }
 else {
      final List<FilePatchInProgress> variants=ObjectsConvertor.convert(files,new Convertor<VirtualFile,FilePatchInProgress>(){
        @Override public FilePatchInProgress convert(        VirtualFile o){
          return processMatch(patch,o);
        }
      }
,ObjectsConvertor.NOT_NULL);
      if (variants.isEmpty()) {
        newOrWithoutMatches.add(patch);
      }
 else {
        candidates.add(new PatchAndVariants(patch,variants));
      }
    }
  }
}
