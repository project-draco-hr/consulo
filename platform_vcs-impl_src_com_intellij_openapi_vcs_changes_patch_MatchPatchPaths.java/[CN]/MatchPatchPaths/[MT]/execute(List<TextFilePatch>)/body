{
  final PatchBaseDirectoryDetector directoryDetector=PatchBaseDirectoryDetector.getInstance(myProject);
  final Application application=ApplicationManager.getApplication();
  final List<PatchAndVariants> candidates=new ArrayList<PatchAndVariants>(list.size());
  final List<TextFilePatch> newOrWithoutMatches=new ArrayList<TextFilePatch>();
  findCandidates(list,directoryDetector,application,candidates,newOrWithoutMatches);
  final MultiMap<VirtualFile,FilePatchInProgress> result=new MultiMap<VirtualFile,FilePatchInProgress>();
  filterExactMatches(candidates,result);
  selectByContext(candidates,result);
  workWithNotExisting(directoryDetector,newOrWithoutMatches,result);
  return new ArrayList<FilePatchInProgress>(result.values());
}
