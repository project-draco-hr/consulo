{
  final String beforeName=patch.getBeforeName();
  final Pair<VirtualFile,Integer> pair=compareNames(beforeName,file);
  if (pair == null)   return null;
  final VirtualFile parent=pair.getFirst();
  if (parent != null) {
    final FilePatchInProgress result=new FilePatchInProgress(patch,null,myBaseDir);
    result.setNewBase(parent);
    int numDown=pair.getSecond();
    for (int i=0; i < numDown; i++) {
      result.up();
    }
    return result;
  }
  return null;
}
