{
  VirtualFile dir=psiDirectory.getVirtualFile();
  if (myIndex.getInfoForDirectory(dir) != null) {
    return psiDirectory.getChildren();
  }
  PsiManager manager=psiDirectory.getManager();
  Set<PsiElement> directoriesOnTheWayToContentRoots=new THashSet<PsiElement>();
  for (  VirtualFile root : getTopLevelRoots()) {
    VirtualFile current=root;
    while (current != null) {
      VirtualFile parent=current.getParent();
      if (parent == dir) {
        final PsiDirectory psi=manager.findDirectory(current);
        if (psi != null) {
          directoriesOnTheWayToContentRoots.add(psi);
        }
      }
      current=parent;
    }
  }
  return directoriesOnTheWayToContentRoots.toArray(new PsiElement[directoriesOnTheWayToContentRoots.size()]);
}
