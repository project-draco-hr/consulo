{
  VirtualFile dir=psiDirectory.getVirtualFile();
  if (myIndex.getInfoForDirectory(dir) != null) {
    return psiDirectory.getChildren();
  }
  Set<VirtualFile> directoriesOnTheWayToContentRoots=new THashSet<VirtualFile>();
  for (  VirtualFile root : getTopLevelRoots()) {
    VirtualFile current=root;
    while (current != null) {
      VirtualFile parent=current.getParent();
      if (parent == dir) {
        directoriesOnTheWayToContentRoots.add(current);
      }
      current=parent;
    }
  }
  PsiManager manager=psiDirectory.getManager();
  PsiElement[] answer=new PsiElement[directoriesOnTheWayToContentRoots.size()];
  int i=0;
  for (  VirtualFile directory : directoriesOnTheWayToContentRoots) {
    answer[i++]=manager.findDirectory(directory);
  }
  return answer;
}
