{
  final PsiDirectory sourceDir=psiClass.getContainingFile().getContainingDirectory();
  final PsiPackage aPackage=JavaDirectoryService.getInstance().getPackage(sourceDir);
  final CreateClassDialog dialog=new CreateClassDialog(psiClass.getProject(),getTitle(psiClass),psiClass.getName() + IMPL_SUFFIX,aPackage != null ? aPackage.getQualifiedName() : "",CreateClassKind.CLASS,true,ModuleUtil.findModuleForPsiElement(psiClass)){
    @Override protected PsiDirectory getBaseDir(    String packageName){
      return sourceDir;
    }
    @Override protected boolean reportBaseInTestSelectionInSource(){
      return true;
    }
  }
;
  dialog.show();
  if (!dialog.isOK())   return null;
  final PsiDirectory targetDirectory=dialog.getTargetDirectory();
  if (targetDirectory == null)   return null;
  return dialog;
}
