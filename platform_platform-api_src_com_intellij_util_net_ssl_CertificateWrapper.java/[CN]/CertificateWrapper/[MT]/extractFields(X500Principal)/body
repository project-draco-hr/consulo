{
  Map<String,String> fields=new HashMap<String,String>();
  for (  String field : principal.getName().split("(?<!\\\\),")) {
    String[] parts=field.trim().split("=",2);
    if (parts.length != 2) {
      continue;
    }
    fields.put(parts[0],parts[1].replaceAll("\\\\,",","));
  }
  return Collections.unmodifiableMap(fields);
}
