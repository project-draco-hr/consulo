{
  if (isMovedFromOutside(e) && isMovedToOutside(e))   return;
  if (isMovedFromOutside(e)) {
    if (notAllowedOrNotUnderContentRoot(e))     return;
    getState().create(e.getFile());
    return;
  }
  VirtualFile oldFile=new ReparentedVirtualFile(e.getOldParent(),e.getFile());
  if (isMovedToOutside(e)) {
    boolean wasInContent=myVcs.hasEntry(oldFile.getPath());
    if (wasInContent)     getState().delete(oldFile);
    return;
  }
  if (notAllowedOrNotUnderContentRoot(e))   return;
  getState().move(oldFile,e.getNewParent());
}
