{
  final String path=file.getPath();
  final long stamp=file.getModificationStamp();
  Pair<Long,Icon> iconInfo=iconsCache.get(path);
  if (iconInfo == null || iconInfo.getFirst() < stamp) {
    try {
      final Icon icon=new ImageIcon(file.contentsToByteArray());
      iconInfo=new Pair<Long,Icon>(stamp,hasProperSize(icon) ? icon : null);
      iconsCache.put(file.getPath(),iconInfo);
    }
 catch (    Exception e) {
      iconInfo=null;
      iconsCache.remove(path);
    }
  }
  return iconInfo == null ? null : iconInfo.getSecond();
}
