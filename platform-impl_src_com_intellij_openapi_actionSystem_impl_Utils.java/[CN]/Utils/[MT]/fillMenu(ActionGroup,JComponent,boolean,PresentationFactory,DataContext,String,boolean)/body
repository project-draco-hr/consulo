{
  ArrayList<AnAction> list=new ArrayList<AnAction>();
  expandActionGroup(group,list,presentationFactory,context,place,ActionManager.getInstance());
  final boolean fixMacScreenMenu=SystemInfo.isMacSystemMenu && isWindowMenu && Registry.is("actionSystem.mac.screenMenuNotUpdatedFix");
  final ArrayList<ActionMenuItem> menuItems=new ArrayList<ActionMenuItem>();
  for (int i=0; i < list.size(); i++) {
    AnAction action=list.get(i);
    if (action instanceof Separator) {
      if (i > 0 && i < list.size() - 1) {
        component.add(new JPopupMenu.Separator());
      }
    }
 else     if (action instanceof ActionGroup) {
      component.add(new ActionMenu(context,place,(ActionGroup)action,presentationFactory,enableMnemonics));
    }
 else {
      final ActionMenuItem each=new ActionMenuItem(action,presentationFactory.getPresentation(action),place,context,enableMnemonics,!fixMacScreenMenu);
      component.add(each);
      menuItems.add(each);
    }
  }
  if (list.isEmpty()) {
    final ActionMenuItem each=new ActionMenuItem(EMPTY_MENU_FILLER,presentationFactory.getPresentation(EMPTY_MENU_FILLER),place,context,enableMnemonics,!fixMacScreenMenu);
    component.add(each);
    menuItems.add(each);
  }
  if (fixMacScreenMenu) {
    SwingUtilities.invokeLater(new Runnable(){
      public void run(){
        for (        ActionMenuItem each : menuItems) {
          if (each.getParent() != null) {
            each.prepare();
          }
        }
      }
    }
);
  }
}
