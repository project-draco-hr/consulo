{
  String loaded=new String(bytes,charset);
  String separator=FileDocumentManager.getInstance().getLineSeparator(virtualFile,null);
  String toSave=StringUtil.convertLineSeparators(loaded,separator);
  byte[] bom=virtualFile.getBOM();
  bom=bom == null ? ArrayUtil.EMPTY_BYTE_ARRAY : bom;
  byte[] bytesToSave;
  try {
    bytesToSave=toSave.getBytes(charset);
  }
 catch (  UnsupportedOperationException e) {
    return false;
  }
  if (!ArrayUtil.startsWith(bytesToSave,bom)) {
    bytesToSave=ArrayUtil.mergeArrays(bom,bytesToSave);
  }
  return Arrays.equals(bytesToSave,bytes);
}
