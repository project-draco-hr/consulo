{
  Pair<Document,String> pair=checkEnabled(myFile);
  if (pair == null)   return;
  final Document document=pair.first;
  final Editor editor=e.getData(PlatformDataKeys.EDITOR);
  DefaultActionGroup group=new ChooseFileEncodingAction(myFile){
    @Override public void update(    final AnActionEvent e){
    }
    @NotNull @Override protected DefaultActionGroup createPopupActionGroup(    JComponent button){
      return createGroup(null,ReloadFileInOtherEncodingAction.this,"Reload file ''{0}'' in''{1}''",myFile.getCharset());
    }
    @Override protected void chosen(    @Nullable VirtualFile virtualFile,    @NotNull Charset charset){
      if (virtualFile != null) {
        ReloadFileInOtherEncodingAction.this.chosen(document,editor,virtualFile,charset);
      }
    }
  }
.createPopupActionGroup(null);
  final ListPopup popup=JBPopupFactory.getInstance().createActionGroupPopup(text,group,e.getDataContext(),JBPopupFactory.ActionSelectionAid.SPEEDSEARCH,false);
  popup.showInBestPositionFor(e.getDataContext());
}
