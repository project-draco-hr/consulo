{
  if (getParent() instanceof ASTDelegatePsiElement) {
    final ASTDelegatePsiElement parentElement=(ASTDelegatePsiElement)getParent();
    CheckUtil.checkWritable(this);
    TreeElement elementCopy=ChangeUtil.copyToElement(newElement);
    parentElement.replaceChildInternal(this,elementCopy);
    elementCopy=ChangeUtil.decodeInformation(elementCopy);
    return SourceTreeToPsiMap.treeElementToPsi(elementCopy);
  }
  return super.replace(newElement);
}
