{
  if (myShowWarning && myMigrationRoots.size() > 10 && !ApplicationManager.getApplication().isUnitTestMode()) {
    final MigrateException[] ex=new MigrateException[1];
    try {
      SwingUtilities.invokeAndWait(new Runnable(){
        public void run(){
          if (Messages.showYesNoCancelDialog("Found more than 10 roots to migrate. Do you want to preview?","Type Migration",Messages.getWarningIcon()) == DialogWrapper.OK_EXIT_CODE) {
            ex[0]=new MigrateException();
          }
        }
      }
);
    }
 catch (    Exception e) {
    }
    if (ex[0] != null)     throw ex[0];
    myShowWarning=false;
  }
  rememberRootTrace(usageInfo,type,place,alreadyProcessed);
  if (!alreadyProcessed && !getTypeEvaluator().setType(usageInfo,type)) {
    alreadyProcessed=true;
  }
  if (!alreadyProcessed)   myMigrationRoots.addFirst(new Pair<TypeMigrationUsageInfo,PsiType>(usageInfo,type));
  return alreadyProcessed;
}
