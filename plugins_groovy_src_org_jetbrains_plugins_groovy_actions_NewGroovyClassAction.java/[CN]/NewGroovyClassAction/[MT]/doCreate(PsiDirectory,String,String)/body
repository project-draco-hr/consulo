{
  final String fileName=className + NewGroovyActionBase.GROOVY_EXTENSION;
  final PsiFile fromTemplate=GroovyTemplatesFactory.createFromTemplate(dir,className,fileName,templateName);
  if (fromTemplate instanceof GroovyFile) {
    CodeStyleManager.getInstance(fromTemplate.getManager()).reformat(fromTemplate);
    return ((GroovyFile)fromTemplate).getTypeDefinitions()[0];
  }
  final String description=fromTemplate.getFileType().getDescription();
  throw new IncorrectOperationException(GroovyBundle.message("groovy.file.extension.is.not.mapped.to.groovy.file.type",description));
}
