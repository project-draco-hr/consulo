{
  final DownloadPatchResult[] result=new DownloadPatchResult[]{DownloadPatchResult.CANCELED};
  if (!ProgressManager.getInstance().runProcessWithProgressSynchronously(new Runnable(){
    public void run(){
      try {
        doDownloadAndInstallPatch(newVersion,ProgressManager.getInstance().getProgressIndicator());
        result[0]=DownloadPatchResult.SUCCESS;
      }
 catch (      final IOException e) {
        LOG.info(e);
        result[0]=DownloadPatchResult.FAILED;
        SwingUtilities.invokeLater(new Runnable(){
          public void run(){
            Notifications.Bus.notify(new Notification("Updater","Failed to download patch file",e.getMessage(),NotificationType.ERROR));
          }
        }
);
      }
    }
  }
,IdeBundle.message("update.downloading.patch.progress.title"),true,null)) {
    return DownloadPatchResult.CANCELED;
  }
  return result[0];
}
