{
  if (!makeWritable(myProject,myDocument)) {
    VirtualFile file=FileDocumentManager.getInstance().getFile(myDocument);
    LOG.warn("Document is read-only" + (file != null ? ": " + file.getPresentableName() : ""));
    return;
  }
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
        @Override public void run(){
          if (myUnderBulkUpdate) {
            DocumentUtil.executeInBulk(myDocument,true,new Runnable(){
              @Override public void run(){
                execute();
              }
            }
);
          }
 else {
            execute();
          }
        }
      }
,myCommandName,myCommandGroupId,myConfirmationPolicy,myDocument);
    }
  }
);
}
