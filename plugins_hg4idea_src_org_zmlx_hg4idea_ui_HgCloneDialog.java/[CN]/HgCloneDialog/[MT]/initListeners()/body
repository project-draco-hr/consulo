{
  FileChooserDescriptor fcd=FileChooserDescriptorFactory.createSingleFolderDescriptor();
  fcd.setShowFileSystemRoots(true);
  fcd.setTitle(HgVcsMessages.message("hg4idea.clone.parent.directory.title"));
  fcd.setDescription(HgVcsMessages.message("hg4idea.clone.parent.directory.description"));
  fcd.setHideIgnored(false);
  parentDirectory.addActionListener(new ComponentWithBrowseButton.BrowseFolderActionListener<JTextField>(fcd.getTitle(),fcd.getDescription(),parentDirectory,project,fcd,TextComponentAccessor.TEXT_FIELD_WHOLE_TEXT){
    @Override protected VirtualFile getInitialFile(){
      String text=getComponentText();
      if (text.length() == 0) {
        VirtualFile file=project.getBaseDir();
        if (file != null) {
          return file;
        }
      }
      return super.getInitialFile();
    }
  }
);
  final DocumentListener updateOkButtonListener=new DocumentListener(){
    public void insertUpdate(    final DocumentEvent e){
      updateCloneButton();
    }
    public void removeUpdate(    final DocumentEvent e){
      updateCloneButton();
    }
    public void changedUpdate(    final DocumentEvent e){
      updateCloneButton();
    }
  }
;
  parentDirectory.getChildComponent().getDocument().addDocumentListener(updateOkButtonListener);
  directoryName.getDocument().addDocumentListener(updateOkButtonListener);
  repositoryURL.getDocument().addDocumentListener(new DocumentListener(){
    public void insertUpdate(    final DocumentEvent e){
      changed();
    }
    public void removeUpdate(    final DocumentEvent e){
      changed();
    }
    public void changedUpdate(    final DocumentEvent e){
      changed();
    }
    private void changed(){
      final String url=repositoryURL.getText();
      testButton.setEnabled(url.length() != 0);
      if (defaultDirectoryName.equals(directoryName.getText()) || directoryName.getText().length() == 0) {
        defaultDirectoryName=defaultDirectoryName(url);
        directoryName.setText(defaultDirectoryName);
      }
      updateCloneButton();
    }
  }
);
  testButton.addActionListener(new ActionListener(){
    public void actionPerformed(    final ActionEvent e){
      testURL=repositoryURL.getText();
      ProgressManager.getInstance().run(new Task.Backgroundable(project,HgVcsMessages.message("hg4idea.clone.test.progress",testURL),true){
        @Override public void run(        @NotNull ProgressIndicator indicator){
          testResult=testRepository(project,testURL);
          ApplicationManager.getApplication().invokeLater(new Runnable(){
            @Override public void run(){
              if (testResult && testButton.getParent().isShowing()) {
                Messages.showInfoMessage(testButton,HgVcsMessages.message("hg4idea.clone.test.success.message",testURL),HgVcsMessages.message("hg4idea.clone.test.success"));
              }
              updateCloneButton();
            }
          }
);
        }
      }
);
    }
  }
);
  setOKActionEnabled(false);
}
