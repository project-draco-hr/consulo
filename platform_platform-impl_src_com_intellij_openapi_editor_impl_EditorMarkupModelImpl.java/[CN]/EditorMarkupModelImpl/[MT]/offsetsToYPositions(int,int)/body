{
  if (!dimensionsAreValid) {
    recalcEditorDimensions();
  }
  Document document=myEditor.getDocument();
  int startLineNumber=offsetToLine(start,document);
  int startY;
  int lineCount;
  if (myEditorSourceHeight < myEditorTargetHeight) {
    lineCount=0;
    startY=myEditorScrollbarTop + startLineNumber * myEditor.getLineHeight();
  }
 else {
    lineCount=myEditorSourceHeight / myEditor.getLineHeight();
    startY=myEditorScrollbarTop + (int)((float)startLineNumber / lineCount * myEditorTargetHeight);
  }
  int endY;
  if (start == end || document.getLineNumber(start) == document.getLineNumber(end)) {
    endY=startY;
  }
 else {
    int endLineNumber=offsetToLine(end,document);
    if (myEditorSourceHeight < myEditorTargetHeight) {
      endY=myEditorScrollbarTop + endLineNumber * myEditor.getLineHeight();
    }
 else {
      endY=myEditorScrollbarTop + (int)((float)endLineNumber / lineCount * myEditorTargetHeight);
    }
    if (endY < startY)     endY=startY;
  }
  return new ProperTextRange(startY,endY);
}
