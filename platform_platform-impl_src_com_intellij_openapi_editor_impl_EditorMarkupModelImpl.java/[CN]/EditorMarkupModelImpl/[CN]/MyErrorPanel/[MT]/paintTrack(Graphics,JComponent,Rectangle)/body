{
  Rectangle clip=g.getClipBounds().intersection(bounds);
  if (clip.height == 0)   return;
  Rectangle componentBounds=c.getBounds();
  ProperTextRange docRange=ProperTextRange.create(0,(int)componentBounds.getHeight());
  if (myCachedTrack == null || myCachedTrack.getHeight() != componentBounds.getHeight()) {
    myCachedTrack=new BufferedImage(componentBounds.width,componentBounds.height,BufferedImage.TYPE_INT_ARGB);
    myDirtyYPositions=docRange;
    paintTrackBasement(myCachedTrack.getGraphics(),new Rectangle(0,0,componentBounds.width,componentBounds.height));
  }
  if (myDirtyYPositions != null) {
    final Graphics2D imageGraphics=myCachedTrack.createGraphics();
    ((ApplicationImpl)ApplicationManager.getApplication()).editorPaintStart();
    try {
      myDirtyYPositions=myDirtyYPositions.intersection(docRange);
      if (myDirtyYPositions == null)       myDirtyYPositions=docRange;
      repaint(imageGraphics,componentBounds.width,ERROR_ICON_WIDTH - 1,myDirtyYPositions);
      myDirtyYPositions=null;
    }
  finally {
      ((ApplicationImpl)ApplicationManager.getApplication()).editorPaintFinish();
    }
  }
  ((Graphics2D)g).drawImage(myCachedTrack,null,0,0);
}
