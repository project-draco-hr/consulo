{
  Rectangle clip=g.getClipBounds().intersection(bounds);
  if (clip.height == 0)   return;
  final Rectangle componentBounds=c.getBounds();
  final TextRange docRange=TextRange.create(0,getEditor().getDocument().getTextLength());
  if (myCachedTrack == null || myCachedTrack.getHeight() != componentBounds.getHeight()) {
    myCachedTrack=new BufferedImage(componentBounds.width,componentBounds.height,BufferedImage.TYPE_INT_ARGB);
    myDirtyRange=docRange;
    paintTrackBasement(myCachedTrack.getGraphics(),new Rectangle(0,0,componentBounds.width,componentBounds.height));
  }
  if (myDirtyRange != null) {
    final Graphics2D imageGraphics=myCachedTrack.createGraphics();
    ((ApplicationImpl)ApplicationManager.getApplication()).editorPaintStart();
    try {
      myDirtyRange=myDirtyRange.intersection(docRange);
      repaint(imageGraphics,componentBounds.width,ERROR_ICON_WIDTH - 1,myDirtyRange.getStartOffset(),myDirtyRange.getEndOffset());
      myDirtyRange=null;
    }
  finally {
      ((ApplicationImpl)ApplicationManager.getApplication()).editorPaintFinish();
    }
  }
  ((Graphics2D)g).drawImage(myCachedTrack,null,0,0);
}
