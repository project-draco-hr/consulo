{
  final Set<Module> modules=new HashSet<Module>();
  final PackagingElementResolvingContext context=ArtifactManager.getInstance(project).getResolvingContext();
  ArtifactUtil.processPackagingElements(artifact,ModuleOutputElementType.MODULE_OUTPUT_ELEMENT_TYPE,new Processor<ModuleOutputPackagingElement>(){
    public boolean process(    ModuleOutputPackagingElement moduleOutputPackagingElement){
      final Module module=moduleOutputPackagingElement.findModule(context);
      if (module != null) {
        modules.add(module);
      }
      return true;
    }
  }
,context,true);
  final ModuleCompileScope scope=new ModuleCompileScope(project,modules.toArray(new Module[modules.size()]),true);
  scope.putUserData(ARTIFACTS_KEY,new Artifact[]{artifact});
  return scope;
}
