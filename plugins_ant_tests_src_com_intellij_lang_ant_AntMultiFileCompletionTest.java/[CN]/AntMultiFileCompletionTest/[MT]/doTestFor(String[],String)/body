{
  final IdeaTestFixtureFactory fixtureFactory=IdeaTestFixtureFactory.getFixtureFactory();
  final TestFixtureBuilder<IdeaProjectTestFixture> testFixtureBuilder=fixtureFactory.createFixtureBuilder();
  final CodeInsightTestFixture codeInsightFixture=fixtureFactory.createCodeInsightFixture(testFixtureBuilder.getFixture());
  codeInsightFixture.setUp();
  String initialTest=fileNames[0];
  for (int i=0; i < fileNames.length; ++i) {
    if (fileNames[i].indexOf('.') == -1)     fileNames[i]+="." + ext;
  }
  codeInsightFixture.setTestDataPath(getTestDataPath());
  try {
    codeInsightFixture.testCompletion(fileNames,initialTest + "_after." + ext);
  }
  finally {
    codeInsightFixture.tearDown();
  }
}
