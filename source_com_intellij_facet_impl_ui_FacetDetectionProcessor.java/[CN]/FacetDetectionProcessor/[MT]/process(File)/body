{
  VirtualFile virtualFile=LocalFileSystem.getInstance().findFileByIoFile(root);
  if (virtualFile == null)   return;
  for (int i=0; i < myDetectors.size(); i++) {
    MultiValuesMap<FileType,MyFacetDetectorWrapper> map=myDetectors.get(i);
    if (i > 0) {
      List<MyFacetDetectorWrapper> toRemove=new ArrayList<MyFacetDetectorWrapper>();
      for (      MyFacetDetectorWrapper detector : map.values()) {
        FacetTypeId typeId=detector.getFacetType().getUnderlyingFacetType();
        LOG.assertTrue(typeId != null);
        List<FacetConfiguration> list=myDetectedConfigurations.get(typeId);
        if (list == null || list.isEmpty()) {
          toRemove.add(detector);
        }
      }
      for (      MyFacetDetectorWrapper detectorWrapper : toRemove) {
        map.remove(detectorWrapper.getFileType(),detectorWrapper);
      }
    }
    if (map.isEmpty())     break;
    process(virtualFile,map);
  }
}
