{
  final JavaCodeFragmentFactory factory=JavaCodeFragmentFactory.getInstance(getProject());
  final PsiCodeFragment fragment=factory.createCodeBlockCodeFragment("a=1;int b=2;",null,true);
  final PsiElement[] result=new PsiElement[1];
  CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          try {
            result[0]=CodeStyleManager.getInstance(getProject()).reformat(fragment);
          }
 catch (          IncorrectOperationException e) {
            fail(e.getLocalizedMessage());
          }
        }
      }
);
    }
  }
,null,null);
  assertEquals("a = 1;\n" + "int b = 2;",result[0].getText());
}
