{
  HttpClient client=login(getLoginMethod());
  PostMethod method=new PostMethod(getUrl() + "/api.asp");
  method.addParameter("token",token);
  method.addParameter("cmd","search");
  method.addParameter("q",q);
  method.addParameter("cols","sTitle,fOpen,dtOpened,dtLastUpdated,ixCategory");
  int status=client.executeMethod(method);
  if (status != 200) {
    throw new Exception("Error listing cases: " + method.getStatusLine());
  }
  Document document=new SAXBuilder(false).build(method.getResponseBodyAsStream()).getDocument();
  XPath path=XPath.newInstance("/response/cases/case");
  final XPath commentPath=XPath.newInstance("events/event");
  @SuppressWarnings("unchecked") final List<Element> nodes=(List<Element>)path.selectNodes(document);
  List<Task> tasks=ContainerUtil.mapNotNull(nodes,new NotNullFunction<Element,Task>(){
    @NotNull @Override public Task fun(    Element element){
      return createCase(element,commentPath);
    }
  }
);
  return tasks.toArray(new Task[tasks.size()]);
}
