{
  if (ApplicationManager.getApplication().isUnitTestMode())   return null;
  Window window=findWindowForBalloon(project);
  if (window instanceof IdeFrameImpl) {
    final ProjectManager projectManager=ProjectManager.getInstance();
    boolean noProjects=projectManager.getOpenProjects().length == 0;
    boolean sticky=NotificationDisplayType.STICKY_BALLOON == displayType || noProjects;
    final Balloon balloon=createBalloon(notification,false,!sticky,!sticky);
    Disposer.register(project != null ? project : ApplicationManager.getApplication(),balloon);
    ((IdeFrameImpl)window).getBalloonLayout().add(balloon);
    if (noProjects && NotificationDisplayType.BALLOON == displayType) {
      projectManager.addProjectManagerListener(new ProjectManagerAdapter(){
        @Override public void projectOpened(        Project project){
          projectManager.removeProjectManagerListener(this);
          if (!balloon.isDisposed()) {
            ((BalloonImpl)balloon).startFadeoutTimer(300);
          }
        }
      }
);
    }
    return balloon;
  }
  return null;
}
