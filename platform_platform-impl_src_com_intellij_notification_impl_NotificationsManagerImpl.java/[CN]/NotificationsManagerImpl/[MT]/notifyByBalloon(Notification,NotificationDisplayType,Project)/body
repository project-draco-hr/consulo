{
  final JEditorPane text=new JEditorPane();
  text.setEditorKit(UIUtil.getHTMLEditorKit());
  final HyperlinkListener listener=NotificationsUtil.wrapListener(notification);
  if (listener != null) {
    text.addHyperlinkListener(listener);
  }
  text.setText(NotificationsUtil.buildHtml(notification));
  final JLabel label=new JLabel(text.getText());
  final Dimension size=label.getPreferredSize();
  text.setEditable(false);
  text.setOpaque(false);
  text.setBorder(null);
  text.setPreferredSize(size);
  final JPanel content=new NonOpaquePanel(new BorderLayout((int)(label.getIconTextGap() * 1.5),(int)(label.getIconTextGap() * 1.5)));
  final NonOpaquePanel textWrapper=new NonOpaquePanel(new GridBagLayout());
  textWrapper.add(text);
  content.add(textWrapper,BorderLayout.CENTER);
  final NonOpaquePanel north=new NonOpaquePanel(new BorderLayout());
  north.add(new JLabel(NotificationsUtil.getIcon(notification)),BorderLayout.NORTH);
  content.add(north,BorderLayout.WEST);
  content.setBorder(new EmptyBorder(2,4,2,4));
  final BalloonBuilder builder=JBPopupFactory.getInstance().createBalloonBuilder(content);
  builder.setFillColor(NotificationsUtil.getBackground(notification)).setCloseButtonEnabled(true).setShowCallout(false).setHideOnClickOutside(NotificationDisplayType.BALLOON == displayType).setHideOnKeyOutside(NotificationDisplayType.BALLOON == displayType).setHideOnFrameResize(false);
  if (NotificationDisplayType.BALLOON == displayType) {
    builder.setFadeoutTime(3000);
  }
  final Balloon balloon=builder.createBalloon();
  final Runnable show=new Runnable(){
    public void run(){
      Window window=null;
      if (project != null) {
        window=WindowManager.getInstance().getFrame(project);
      }
      if (window == null) {
        window=JOptionPane.getRootFrame();
      }
      if (window instanceof IdeFrameImpl) {
        final BalloonLayout balloonLayout=((IdeFrameImpl)window).getBalloonLayout();
        balloonLayout.add(balloon);
      }
    }
  }
;
  SwingUtilities.invokeLater(new Runnable(){
    public void run(){
      show.run();
    }
  }
);
}
