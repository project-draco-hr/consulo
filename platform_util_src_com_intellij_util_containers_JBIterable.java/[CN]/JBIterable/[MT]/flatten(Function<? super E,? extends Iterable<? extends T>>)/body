{
  return intercept(new Function<Iterator<E>,Iterator<T>>(){
    @Override public Iterator<T> fun(    final Iterator<E> iterator){
      final Function<? super E,? extends Iterable<? extends T>> fun=Stateful.copy(function);
      return new JBIterator<T>(){
        Iterator<? extends T> cur;
        @Override public T nextImpl(){
          while ((cur == null || !cur.hasNext()) && iterator.hasNext()) {
            cur=fun.fun(iterator.next()).iterator();
          }
          if (cur == null || !cur.hasNext())           return stop();
          return cur.next();
        }
        @Override public void remove(){
          cur.remove();
        }
      }
;
    }
  }
);
}
