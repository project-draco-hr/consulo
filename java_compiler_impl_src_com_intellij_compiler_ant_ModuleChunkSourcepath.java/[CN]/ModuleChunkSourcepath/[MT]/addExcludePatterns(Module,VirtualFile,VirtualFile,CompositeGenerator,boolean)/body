{
  if (FileTypeManager.getInstance().isFileIgnored(dir)) {
    return;
  }
  final boolean isIncluded=ModuleRootManager.getInstance(module).getFileIndex().isInContent(dir);
  if (isIncluded != parentIncluded) {
    final String relativePath=VfsUtilCore.getRelativePath(dir,root,'/');
    if (isIncluded) {
      generator.add(new Include(relativePath + "/**"));
    }
 else {
      if (!isExcludedByDefault(dir.getName())) {
        generator.add(new Exclude(relativePath + "/**"));
      }
    }
  }
  final VirtualFile[] children=dir.getChildren();
  for (  VirtualFile child : children) {
    if (child.isDirectory()) {
      addExcludePatterns(module,root,child,generator,isIncluded);
    }
  }
}
