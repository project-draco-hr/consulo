{
  if (e == null)   return EMPTY_ARRAY;
  VirtualFile virtualFile=e.getData(PlatformDataKeys.VIRTUAL_FILE);
  if (virtualFile == null || !virtualFile.isInLocalFileSystem()) {
    return EMPTY_ARRAY;
  }
  List<Charset> charsets=new ArrayList<Charset>(EncodingManager.getInstance().getFavorites());
  Collections.sort(charsets);
  Charset current=virtualFile.getCharset();
  charsets.remove(current);
  List<AnAction> children=new ArrayList<AnAction>(charsets.size());
  for (  Charset charset : charsets) {
    ChangeFileEncodingTo action=new ChangeFileEncodingTo(virtualFile,charset);
    children.add(action);
  }
  children.add(new More(virtualFile));
  children.add(new Separator());
  return children.toArray(new AnAction[children.size()]);
}
