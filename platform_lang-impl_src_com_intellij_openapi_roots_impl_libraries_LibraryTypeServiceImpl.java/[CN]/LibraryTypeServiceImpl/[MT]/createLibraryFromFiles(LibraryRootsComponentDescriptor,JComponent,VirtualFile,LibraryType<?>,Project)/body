{
  final List<? extends RootDetector> rootDetectors=descriptor.getRootDetectors();
  final List<OrderRoot> roots;
  if (!rootDetectors.isEmpty()) {
    final FileChooserDescriptor chooserDescriptor=descriptor.createAttachFilesChooserDescriptor();
    chooserDescriptor.setTitle("Select Library Files");
    final VirtualFile[] rootCandidates=FileChooser.chooseFiles(parentComponent,chooserDescriptor,contextDirectory);
    if (rootCandidates.length == 0) {
      return null;
    }
    roots=RootDetectionUtil.detectRoots(Arrays.asList(rootCandidates),parentComponent,project,rootDetectors,true);
    if (roots.isEmpty())     return null;
  }
 else {
    roots=Collections.emptyList();
  }
  String name=suggestLibraryName(roots);
  return doCreate(type,name,roots);
}
