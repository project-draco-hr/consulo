{
  getJavaFacade().setAssertOnFileLoadingFilter(VirtualFileFilter.ALL);
  PsiClass aClass=myJavaFacade.findClass("Test",GlobalSearchScope.allScope(myProject));
  assertNotNull(aClass);
  final PsiAnnotation[] annotations=aClass.getModifierList().getAnnotations();
  assertEquals(1,annotations.length);
  assertEquals("A",annotations[0].getNameReferenceElement().getReferenceName());
  final PsiAnnotation newAnnotation=myJavaFacade.getElementFactory().createAnnotationFromText("@B",null);
  getJavaFacade().setAssertOnFileLoadingFilter(VirtualFileFilter.NONE);
  CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
    public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          try {
            annotations[0].replace(newAnnotation);
          }
 catch (          IncorrectOperationException e) {
            LOG.error(e);
          }
        }
      }
);
    }
  }
,null,null);
  assertEquals("@B",aClass.getModifierList().getText());
}
