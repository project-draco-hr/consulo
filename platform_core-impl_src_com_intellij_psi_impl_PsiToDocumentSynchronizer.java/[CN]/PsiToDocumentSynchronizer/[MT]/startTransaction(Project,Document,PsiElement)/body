{
  LOG.assertTrue(!project.isDisposed());
  Pair<DocumentChangeTransaction,Integer> pair=myTransactionsMap.get(doc);
  if (pair == null) {
    final PsiFile psiFile=scope.getContainingFile();
    pair=new Pair<DocumentChangeTransaction,Integer>(new DocumentChangeTransaction(doc,psiFile),0);
    myBus.syncPublisher(PsiDocumentTransactionListener.TOPIC).transactionStarted(doc,psiFile);
  }
 else {
    pair=new Pair<DocumentChangeTransaction,Integer>(pair.getFirst(),pair.getSecond().intValue() + 1);
  }
  myTransactionsMap.put(doc,pair);
}
