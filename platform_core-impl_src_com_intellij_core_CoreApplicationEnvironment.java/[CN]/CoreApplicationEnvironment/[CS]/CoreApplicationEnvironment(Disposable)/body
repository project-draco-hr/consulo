{
  myParentDisposable=parentDisposable;
  Extensions.cleanRootArea(myParentDisposable);
  myFileTypeRegistry=new CoreFileTypeRegistry();
  myEncodingRegistry=new CoreEncodingRegistry();
  myApplication=createApplication(myParentDisposable);
  ApplicationManager.setApplication(myApplication,new StaticGetter<FileTypeRegistry>(myFileTypeRegistry),new StaticGetter<EncodingRegistry>(myEncodingRegistry),myParentDisposable);
  myLocalFileSystem=createLocalFileSystem();
  myJarFileSystem=createJarFileSystem();
  Extensions.registerAreaClass(ExtensionAreas.IDEA_PROJECT,null);
  final MutablePicoContainer appContainer=myApplication.getPicoContainer();
  registerComponentInstance(appContainer,FileDocumentManager.class,new MockFileDocumentManagerImpl(new Function<CharSequence,Document>(){
    @Override public Document fun(    CharSequence charSequence){
      return new DocumentImpl(charSequence);
    }
  }
,null));
  IVirtualFileSystem[] fs={myLocalFileSystem,myJarFileSystem};
  VirtualFileManagerImpl virtualFileManager=new VirtualFileManagerImpl(fs,new MessageBusImpl(myApplication,null));
  registerComponentInstance(appContainer,VirtualFileManager.class,virtualFileManager);
  myApplication.registerService(VirtualFilePointerManager.class,createVirtualFilePointerManager());
  myApplication.registerService(PsiBuilderFactory.class,new PsiBuilderFactoryImpl());
  myApplication.registerService(ReferenceProvidersRegistry.class,new MockReferenceProvidersRegistry());
  myApplication.registerService(StubTreeLoader.class,new CoreStubTreeLoader());
  myApplication.registerService(PsiReferenceService.class,new PsiReferenceServiceImpl());
  myApplication.registerService(ProgressManager.class,createProgressIndicatorProvider());
  registerApplicationExtensionPoint(ContentBasedFileSubstitutor.EP_NAME,ContentBasedFileSubstitutor.class);
  registerExtensionPoint(Extensions.getRootArea(),BinaryFileStubBuilders.EP_NAME,FileTypeExtensionPoint.class);
  registerExtensionPoint(Extensions.getRootArea(),ASTLazyFactory.EP.getExtensionPointName(),ASTLazyFactory.class);
  registerExtensionPoint(Extensions.getRootArea(),ASTCompositeFactory.EP.getExtensionPointName(),ASTCompositeFactory.class);
  registerExtensionPoint(Extensions.getRootArea(),ASTLeafFactory.EP.getExtensionPointName(),ASTLeafFactory.class);
  registerExtensionPoint(Extensions.getRootArea(),PsiElementFactory.EP.getExtensionPointName(),PsiElementFactory.class);
  addExtension(ASTLazyFactory.EP.getExtensionPointName(),new DefaultASTLazyFactory(),LoadingOrder.LAST);
  addExtension(ASTLeafFactory.EP.getExtensionPointName(),new DefaultASTLeafFactory(),LoadingOrder.LAST);
  addExtension(ASTCompositeFactory.EP.getExtensionPointName(),new DefaultASTCompositeFactory(),LoadingOrder.LAST);
  addExtension(PsiElementFactory.EP.getExtensionPointName(),new DefaultPsiElementFactory(),LoadingOrder.LAST);
  registerFileType(ZipArchiveFileType.INSTANCE,"zip");
  myApplication.registerService(JobLauncher.class,createJobLauncher());
}
