{
  if (ourHomePath != null)   return ourHomePath;
  String fromProperty=System.getProperty(PROPERTY_HOME_PATH);
  if (fromProperty != null) {
    ourHomePath=getAbsolutePath(fromProperty);
    if (!new File(ourHomePath).isDirectory()) {
      throw new RuntimeException("Invalid home path '" + ourHomePath + "'");
    }
  }
 else {
    ourHomePath=getHomePathFor(PathManager.class);
    if (ourHomePath == null) {
      String advice=SystemInfo.isMac ? "reinstall the software." : "make sure bin/idea.properties is present in the installation directory.";
      throw new RuntimeException("Could not find installation home path. Please " + advice);
    }
  }
  if (SystemInfo.isWindows) {
    try {
      ourHomePath=new File(ourHomePath).getCanonicalPath();
    }
 catch (    IOException ignored) {
    }
  }
  return ourHomePath;
}
