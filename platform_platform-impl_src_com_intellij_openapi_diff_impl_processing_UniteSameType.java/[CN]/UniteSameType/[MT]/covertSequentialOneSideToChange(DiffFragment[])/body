{
  if (fragments.length < 2)   return fragments;
  DiffCorrection.FragmentsCollector collector=new DiffCorrection.FragmentsCollector();
  DiffFragment previous=null;
  for (int i=0; i < fragments.length; i++) {
    DiffFragment fragment=fragments[i];
    if (fragment.isOneSide()) {
      if (previous == null)       previous=fragment;
 else {
        FragmentSide side=FragmentSide.chooseSide(fragment);
        String previousText=side.getText(previous);
        if (previousText == null)         previousText="";
        previous=side.createFragment(previousText + side.getText(fragment),side.getOtherText(previous),true);
      }
    }
 else {
      if (previous != null)       collector.add(previous);
      previous=null;
      collector.add(fragment);
    }
  }
  if (previous != null)   collector.add(previous);
  return collector.toArray();
}
