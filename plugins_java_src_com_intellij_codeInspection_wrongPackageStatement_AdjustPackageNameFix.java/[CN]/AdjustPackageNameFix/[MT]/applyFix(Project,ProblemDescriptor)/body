{
  PsiElement element=descriptor.getPsiElement();
  if (element == null)   return;
  PsiFile myFile=element.getContainingFile();
  if (!FileModificationService.getInstance().prepareFileForWrite(myFile))   return;
  PsiDirectory directory=myFile.getContainingDirectory();
  if (directory == null)   return;
  PsiPackage myTargetPackage=JavaDirectoryService.getInstance().getPackage(directory);
  if (myTargetPackage == null)   return;
  try {
    PsiElementFactory factory=JavaPsiFacade.getInstance(myFile.getProject()).getElementFactory();
    PsiPackageStatement myStatement=((PsiJavaFile)myFile).getPackageStatement();
    if (myTargetPackage.getQualifiedName().length() == 0) {
      if (myStatement != null) {
        myStatement.delete();
      }
    }
 else {
      final PsiPackageStatement packageStatement=factory.createPackageStatement(myTargetPackage.getQualifiedName());
      if (myStatement != null) {
        myStatement.getPackageReference().replace(packageStatement.getPackageReference());
      }
 else {
        myFile.addAfter(packageStatement,null);
      }
    }
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
  }
}
