{
  final VirtualFile virtualFile=getVirtualFile();
  if (virtualFile == null) {
    final PsiFile originalFile=getOriginalFile();
    if (originalFile instanceof PsiJavaFile && originalFile != this)     return ((PsiJavaFile)originalFile).getLanguageLevel();
    return getManager().getEffectiveLanguageLevel();
  }
  final Project project=getProject();
  final Module module=ProjectRootManager.getInstance(project).getFileIndex().getModuleForFile(virtualFile);
  if (module != null) {
    return module.getEffectiveLanguageLevel();
  }
 else {
    final PsiFile originalFile=getOriginalFile();
    if (originalFile instanceof PsiJavaFile && originalFile != this)     return ((PsiJavaFile)originalFile).getLanguageLevel();
  }
  return PsiManager.getInstance(project).getEffectiveLanguageLevel();
}
