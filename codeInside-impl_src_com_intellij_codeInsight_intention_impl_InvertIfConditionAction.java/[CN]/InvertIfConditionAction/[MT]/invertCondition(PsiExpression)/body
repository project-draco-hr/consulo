{
  PsiElementFactory factory=condition.getManager().getElementFactory();
  if (condition instanceof PsiBinaryExpression) {
    PsiBinaryExpression expression=(PsiBinaryExpression)condition;
    PsiJavaToken operationSign=expression.getOperationSign();
    for (int i=0; i < ourTokenMap.length; i++) {
      IElementType tokenType=ourTokenMap[i];
      if (operationSign.getTokenType() == tokenType) {
        expression=(PsiBinaryExpression)expression.copy();
        expression.getOperationSign().replace(createOperationToken(factory,ourTokenMap[i + (i % 2 == 0 ? 1 : -1)]));
        if (tokenType == JavaTokenType.OROR || tokenType == JavaTokenType.ANDAND) {
          expression.getLOperand().replace(invertCondition(expression.getLOperand()));
          expression.getROperand().replace(invertCondition(expression.getROperand()));
        }
        return expression;
      }
    }
  }
 else   if (condition instanceof PsiPrefixExpression) {
    PsiPrefixExpression expression=(PsiPrefixExpression)condition;
    PsiJavaToken operationSign=expression.getOperationSign();
    if (operationSign.getTokenType() == JavaTokenType.EXCL) {
      PsiExpression operand=expression.getOperand();
      if (operand instanceof PsiParenthesizedExpression) {
        operand=((PsiParenthesizedExpression)operand).getExpression();
      }
      return operand;
    }
  }
  if (condition instanceof PsiParenthesizedExpression) {
    PsiExpression operand=((PsiParenthesizedExpression)condition).getExpression();
    operand.replace(invertCondition(operand));
    return condition;
  }
  PsiPrefixExpression result=(PsiPrefixExpression)factory.createExpressionFromText("!(a)",null);
  if (!(condition instanceof PsiBinaryExpression)) {
    result.getOperand().replace(condition);
  }
 else {
    PsiParenthesizedExpression e=(PsiParenthesizedExpression)result.getOperand();
    e.getExpression().replace(condition);
  }
  return result;
}
