{
  final Module moduleA=createModule("a.iml");
  final Module moduleB=createModule("b.iml");
  assertEventsCount(2);
  final Sdk jdk=IdeaTestUtil.getMockJdk17("AAA");
  ProjectSdkTable.getInstance().addSdk(jdk);
  assertEventsCount(0);
  final Sdk jdkBBB=IdeaTestUtil.getMockJdk17("BBB");
  ProjectSdkTable.getInstance().addSdk(jdk);
  assertEventsCount(0);
  ProjectRootManager.getInstance(myProject).setProjectSdk(jdkBBB);
  assertEventsCount(0);
  final ModifiableRootModel rootModelA=ModuleRootManager.getInstance(moduleA).getModifiableModel();
  final ModifiableRootModel rootModelB=ModuleRootManager.getInstance(moduleB).getModifiableModel();
  rootModelA.inheritSdk();
  rootModelB.inheritSdk();
  ModifiableRootModel[] rootModels=new ModifiableRootModel[]{rootModelA,rootModelB};
  if (rootModels.length > 0) {
    ModifiableModelCommitter.multiCommit(rootModels,ModuleManager.getInstance(rootModels[0].getProject()).getModifiableModel());
  }
  assertEventsCount(1);
  ProjectRootManager.getInstance(myProject).setProjectSdk(jdk);
  assertEventsCount(1);
  final SdkModificator sdkModificator=jdk.getSdkModificator();
  sdkModificator.addRoot(getVirtualFile(createTempDirectory()),OrderRootType.CLASSES);
  sdkModificator.commitChanges();
  assertEventsCount(1);
  ProjectSdkTable.getInstance().removeSdk(jdk);
  assertEventsCount(1);
}
