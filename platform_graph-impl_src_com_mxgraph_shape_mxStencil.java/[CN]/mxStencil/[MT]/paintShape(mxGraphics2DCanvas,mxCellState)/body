{
  Map<String,Object> style=state.getStyle();
  mxGraphicsCanvas2D canvas=createCanvas(gc);
  double rotation=mxUtils.getDouble(style,mxConstants.STYLE_ROTATION,0);
  String direction=mxUtils.getString(style,mxConstants.STYLE_DIRECTION,null);
  if (direction != null) {
    if (direction.equals("north")) {
      rotation+=270;
    }
 else     if (direction.equals("west")) {
      rotation+=180;
    }
 else     if (direction.equals("south")) {
      rotation+=90;
    }
  }
  boolean flipH=mxUtils.isTrue(style,mxConstants.STYLE_STENCIL_FLIPH,false);
  boolean flipV=mxUtils.isTrue(style,mxConstants.STYLE_STENCIL_FLIPV,false);
  if (flipH && flipV) {
    rotation+=180;
    flipH=false;
    flipV=false;
  }
  canvas.save();
  rotation=rotation % 360;
  if (rotation != 0 || flipH || flipV) {
    canvas.rotate(rotation,flipH,flipV,state.getCenterX(),state.getCenterY());
  }
  double scale=state.getView().getScale();
  double sw=mxUtils.getDouble(style,mxConstants.STYLE_STROKEWIDTH,1) * scale;
  canvas.setStrokeWidth(sw);
  double alpha=mxUtils.getDouble(style,mxConstants.STYLE_OPACITY,100) / 100;
  String gradientColor=mxUtils.getString(style,mxConstants.STYLE_GRADIENTCOLOR,null);
  if (gradientColor != null && gradientColor.equals(mxConstants.NONE)) {
    gradientColor=null;
  }
  String fillColor=mxUtils.getString(style,mxConstants.STYLE_FILLCOLOR,null);
  if (fillColor != null && fillColor.equals(mxConstants.NONE)) {
    fillColor=null;
  }
  String strokeColor=mxUtils.getString(style,mxConstants.STYLE_STROKECOLOR,null);
  if (strokeColor != null && strokeColor.equals(mxConstants.NONE)) {
    strokeColor=null;
  }
  if (mxUtils.isTrue(style,mxConstants.STYLE_SHADOW,false)) {
    drawShadow(canvas,state,rotation,flipH,flipV,state,alpha,fillColor != null);
  }
  canvas.setAlpha(alpha);
  if (mxUtils.isTrue(style,mxConstants.STYLE_DASHED,false)) {
    canvas.setDashed(true);
  }
  if (strokeColor != null || fillColor != null) {
    if (strokeColor != null) {
      canvas.setStrokeColor(strokeColor);
    }
    if (fillColor != null) {
      if (gradientColor != null && !gradientColor.equals("transparent")) {
        canvas.setGradient(fillColor,gradientColor,state.getX(),state.getY(),state.getWidth(),state.getHeight(),direction,1,1);
      }
 else {
        canvas.setFillColor(fillColor);
      }
    }
    drawShape(canvas,state,state,true);
    drawShape(canvas,state,state,false);
  }
}
