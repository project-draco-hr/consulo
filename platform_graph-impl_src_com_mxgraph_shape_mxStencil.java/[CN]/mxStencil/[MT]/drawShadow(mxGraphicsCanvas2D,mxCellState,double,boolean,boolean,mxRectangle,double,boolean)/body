{
  double rad=rotation * Math.PI / 180;
  double cos=Math.cos(-rad);
  double sin=Math.sin(-rad);
  mxPoint offset=mxUtils.getRotatedPoint(new mxPoint(mxConstants.SHADOW_OFFSETX,mxConstants.SHADOW_OFFSETY),cos,sin);
  if (flipH) {
    offset.setX(offset.getX() * -1);
  }
  if (flipV) {
    offset.setY(offset.getY() * -1);
  }
  canvas.translate(offset.getX(),offset.getY());
  if (drawShape(canvas,state,bounds,true)) {
    canvas.setAlpha(mxConstants.STENCIL_SHADOW_OPACITY * alpha);
  }
  canvas.translate(-offset.getX(),-offset.getY());
}
