{
  GrVariable var=null;
  if (element instanceof GrVariable) {
    var=(GrVariable)element;
  }
 else   if (element instanceof GrReferenceExpression) {
    final PsiElement resolved=((GrReferenceExpression)element).resolve();
    if (resolved instanceof GrVariable)     var=(GrVariable)resolved;
  }
  if (var != null) {
    final GroovyPsiElement scope=ControlFlowUtils.findControlFlowOwner(var);
    if (scope == null) {
      PsiFile file=var.getContainingFile();
      if (file == null) {
        LogMessageEx.error(LOG,"no file??? var of type" + var.getClass().getCanonicalName());
        return false;
      }
 else {
        TextRange range=var.getTextRange();
        LogMessageEx.error(LOG,"var: " + var.getName() + ", offset:"+ (range != null ? range.getStartOffset() : -1),file.getText());
        return false;
      }
    }
    return ReferencesSearch.search(var,new LocalSearchScope(scope)).forEach(new Processor<PsiReference>(){
      public boolean process(      PsiReference ref){
        return ControlFlowUtils.findControlFlowOwner(ref.getElement()) == scope;
      }
    }
);
  }
  return true;
}
