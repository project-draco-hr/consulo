{
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  int offset=editor.getCaretModel().getOffset();
  PsiElement element=findTargetElement(project,editor,offset);
  if (element == null) {
    FeatureUsageTracker.getInstance().triggerFeatureUsed("navigation.goto.declaration");
    chooseAmbiguousTarget(editor,offset);
    return;
  }
  FeatureUsageTracker.getInstance().triggerFeatureUsed("navigation.goto.declaration");
  PsiElement navElement=element.getNavigationElement();
  navElement=TargetElementUtilBase.getInstance().getGotoDeclarationTarget(element,navElement);
  if (navElement instanceof Navigatable) {
    if (((Navigatable)navElement).canNavigate()) {
      ((Navigatable)navElement).navigate(true);
    }
  }
 else   if (navElement != null) {
    int navOffset=navElement.getTextOffset();
    VirtualFile virtualFile=PsiUtilBase.getVirtualFile(navElement);
    if (virtualFile != null) {
      new OpenFileDescriptor(project,virtualFile,navOffset).navigate(true);
    }
  }
}
