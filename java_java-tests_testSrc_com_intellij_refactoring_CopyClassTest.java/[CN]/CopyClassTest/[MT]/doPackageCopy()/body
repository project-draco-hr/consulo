{
  String root=JavaTestUtil.getJavaTestDataPath() + "/refactoring/copyClass/multifile/" + getTestName(true);
  String rootBefore=root + "/before";
  PsiTestUtil.removeAllRoots(myModule,JavaSdkImpl.getMockJdk17());
  VirtualFile rootDir=PsiTestUtil.createTestProjectStructure(myProject,myModule,rootBefore,myFilesToDelete);
  final VirtualFile targetVDir=rootDir.findChild("p2");
  final PsiDirectory sourceP1Dir=myPsiManager.findDirectory(rootDir.findChild("p1"));
  final PsiDirectory targetP2Dir=myPsiManager.findDirectory(targetVDir);
  new CopyClassesHandler().doCopy(new PsiElement[]{sourceP1Dir},targetP2Dir);
  String rootAfter=root + "/after";
  VirtualFile rootDir2=LocalFileSystem.getInstance().findFileByPath(rootAfter.replace(File.separatorChar,'/'));
  myProject.getComponent(PostprocessReformattingAspect.class).doPostponedFormatting();
  PlatformTestUtil.assertDirectoriesEqual(rootDir2,rootDir,PlatformTestUtil.CVS_FILE_FILTER);
}
