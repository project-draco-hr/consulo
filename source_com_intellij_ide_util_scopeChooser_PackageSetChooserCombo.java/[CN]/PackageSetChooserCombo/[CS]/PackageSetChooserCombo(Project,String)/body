{
  final JComboBox combo=getComboBox();
  myProject=project;
  addActionListener(new ActionListener(){
    public void actionPerformed(    ActionEvent e){
      final NamedScope scope=(NamedScope)combo.getSelectedItem();
      final ScopeChooserConfigurable configurable=ScopeChooserConfigurable.getInstance(myProject);
      final EditScopesDialog dlg=EditScopesDialog.editConfigurable(myProject,new Runnable(){
        public void run(){
          configurable.selectNodeInTree(scope.getName());
        }
      }
,true);
      if (dlg.isOK()) {
        rebuild();
        final NamedScope namedScope=dlg.getSelectedScope();
        if (namedScope != null) {
          selectScope(namedScope.getName());
        }
      }
    }
  }
);
  combo.setRenderer(new DefaultListCellRenderer(){
    public Component getListCellRendererComponent(    JList list,    Object value,    int index,    boolean isSelected,    boolean cellHasFocus){
      super.getListCellRendererComponent(list,value,index,isSelected,cellHasFocus);
      setText(value == null ? "" : ((NamedScope)value).getName());
      return this;
    }
  }
);
  rebuild();
  selectScope(preselect);
}
