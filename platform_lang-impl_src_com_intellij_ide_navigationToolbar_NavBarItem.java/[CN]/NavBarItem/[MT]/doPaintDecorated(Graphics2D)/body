{
  setPaintFocusBorder(false);
  Icon icon=myIcon;
  final Color bg=getBackground();
  g.setPaint(bg);
  int w=getWidth();
  int h=getHeight();
  if (!UIUtil.isUnderAquaLookAndFeel() || myPanel.isInFloatingMode() || (isSelected() && myPanel.hasFocus())) {
    g.fillRect(0,0,w - (isLastElement() ? 0 : getDecorationOffset()),h);
  }
  final int offset=isFirstElement() ? getFirstElementLeftOffset() : 0;
  final int iconOffset=myPadding.left + offset;
  icon.paintIcon(this,g,iconOffset,(h - icon.getIconHeight()) / 2);
  final int textOffset=icon.getIconWidth() + myPadding.width() + offset;
  int x=doPaintText(g,textOffset,false);
  g.setRenderingHint(RenderingHints.KEY_ANTIALIASING,RenderingHints.VALUE_ANTIALIAS_ON);
  g.translate(x,0);
  Path2D.Double path=new Path2D.Double();
  int off=getDecorationOffset();
  if (isFocused()) {
    if (isSelected() && !myPanel.isNodePopupShowing() && !isLastElement()) {
      g.translate(1,0);
      path.moveTo(0,0);
      path.lineTo(off,h / 2);
      path.lineTo(0,h);
      path.lineTo(0,0);
      g.setPaint(UIUtil.getListSelectionBackground());
      g.fill(path);
      g.translate(-1,0);
    }
    if (!UIUtil.isUnderAquaLookAndFeel() || myPanel.isInFloatingMode() || (isNextSelected() && myPanel.hasFocus())) {
      if (!isLastElement() && !myPanel.isNodePopupShowing()) {
        path.moveTo(0,0);
        path.lineTo(off,h / 2);
        path.lineTo(0,h);
        path.lineTo(off + 2,h);
        path.lineTo(off + 2,0);
        path.lineTo(0,0);
        g.setPaint(isNextSelected() ? UIUtil.getListSelectionBackground() : getBackground());
        if (UIUtil.isUnderAquaLookAndFeel() && isNextSelected() || !UIUtil.isUnderAquaLookAndFeel()) {
          g.fill(path);
        }
      }
    }
  }
  if (!isLastElement() && ((!isSelected() && !isNextSelected()) || !myPanel.hasFocus())) {
    Image img;
    if (UIUtil.isUnderAquaLookAndFeel()) {
      img=SEPARATOR_PASSIVE;
    }
 else {
      img=!myPanel.isNodePopupShowing() || !myPanel.isInFloatingMode() ? SEPARATOR_ACTIVE : SEPARATOR_PASSIVE;
    }
    g.drawImage(img,null,null);
  }
}
