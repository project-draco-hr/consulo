{
  final PsiFile file=lookup.getPsiFile();
  if (file == null) {
    return null;
  }
  final LookupElement item=lookup.getCurrentItem();
  if (item != null && item.getObject() instanceof PsiFileSystemItem) {
    if ('.' == c)     return Result.ADD_TO_PREFIX;
    final PsiReference reference=file.findReferenceAt(lookup.getEditor().getCaretModel().getOffset());
    if (reference instanceof FileReference)     return Result.HIDE_LOOKUP;
    if (reference instanceof PsiMultiReference) {
      for (      PsiReference psiReference : ((PsiMultiReference)reference).getReferences()) {
        if (psiReference instanceof FileReference)         return Result.HIDE_LOOKUP;
      }
    }
  }
  return null;
}
