{
  if (!cacheValue)   return entityDecl.parse(targetFile,type,entityRef);
  CachedValue<PsiElement> value=entityRef.getUserData(PARSED_DECL_KEY);
  if (value == null) {
    value=entityDecl.getManager().getCachedValuesManager().createCachedValue(new CachedValueProvider<PsiElement>(){
      public CachedValueProvider.Result<PsiElement> compute(){
        final PsiElement res=entityDecl.parse(targetFile,type,entityRef);
        if (res == null)         return new Result<PsiElement>(res,new Object[]{targetFile});
        return new CachedValueProvider.Result<PsiElement>(res,new Object[]{res.getUserData(XmlElement.DEPENDING_ELEMENT),entityDecl,targetFile,entityRef});
      }
    }
,false);
    entityRef.putUserData(PARSED_DECL_KEY,value);
  }
  return value.getValue();
}
