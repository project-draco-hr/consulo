{
  byte[] bytes;
  try {
    bytes=file.contentsToByteArray();
  }
 catch (  IOException e) {
    return null;
  }
  int start=0;
  if (CharsetToolkit.hasUTF8Bom(bytes)) {
    start=CharsetToolkit.UTF8_BOM.length;
  }
  if (start + ENCODING_XML_PROLOG_BYTES.length >= bytes.length)   return null;
  int i;
  for (i=0; i < ENCODING_XML_PROLOG_BYTES.length; i++) {
    if (bytes[start + i] != ENCODING_XML_PROLOG_BYTES[i]) {
      return null;
    }
  }
  StringBuilder encoding=StringBuilderSpinAllocator.alloc();
  try {
    while (true) {
      if (start + i >= bytes.length)       return null;
      byte b=bytes[start + i];
      if (b == '\"') {
        break;
      }
      encoding.append((char)b);
      i++;
    }
    return encoding.toString();
  }
  finally {
    StringBuilderSpinAllocator.dispose(encoding);
  }
}
