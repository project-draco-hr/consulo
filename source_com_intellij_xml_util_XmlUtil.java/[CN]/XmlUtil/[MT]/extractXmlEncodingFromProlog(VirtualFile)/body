{
  byte[] bytes;
  try {
    bytes=file.contentsToByteArray();
  }
 catch (  IOException e) {
    return null;
  }
  int start=0;
  if (CharsetToolkit.hasUTF8Bom(bytes)) {
    start=CharsetToolkit.UTF8_BOM.length;
  }
  if (start >= bytes.length)   return null;
  int i;
  for (i=0; i < ENCODING_XML_PROLOG.length; i++) {
    if (bytes[start + i] != ENCODING_XML_PROLOG[i]) {
      return null;
    }
  }
  StringBuffer encoding=new StringBuffer();
  while (true) {
    if (start + i >= bytes.length)     return null;
    byte b=bytes[start + i];
    if (b == '\"') {
      break;
    }
    encoding.append((char)b);
    i++;
  }
  return encoding.toString();
}
