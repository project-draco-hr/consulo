{
  PsiFile result=null;
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    String data=base.getUserData(TEST_PATH);
    if (data == null && base.getOriginalFile() != null) {
      data=base.getOriginalFile().getUserData(TEST_PATH);
    }
    if (data != null) {
      String filePath=data + "/" + uri;
      final VirtualFile path=LocalFileSystem.getInstance().findFileByPath(filePath.replace(File.separatorChar,'/'));
      if (path != null) {
        result=base.getManager().findFile(path);
      }
    }
  }
  if (result == null) {
    result=PsiUtil.findRelativeFile(uri,base);
  }
  if (result == null && base instanceof JspFile) {
    result=JspManager.getInstance(base.getProject()).getTldFileByUri(uri,(JspFile)base);
  }
  if (result instanceof XmlFile) {
    XmlFile xmlFile=(XmlFile)result;
    return xmlFile;
  }
  if (base instanceof JspFile)   return JspManager.getInstance(base.getProject()).getTldFileByUri(uri,(JspFile)base);
  return null;
}
