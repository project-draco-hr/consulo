{
  if (tag == null) {
    return;
  }
  final String tagName=tag.getName();
{
    List<MyAttributeInfo> list=attributesMap.get(tagName);
    if (list == null) {
      list=new ArrayList<MyAttributeInfo>();
      final XmlAttribute[] attributes=tag.getAttributes();
      for (int i=0; i < attributes.length; i++) {
        final XmlAttribute attribute=attributes[i];
        list.add(new MyAttributeInfo(attribute.getName()));
      }
    }
 else {
      final XmlAttribute[] attributes=tag.getAttributes();
      Collections.sort((List)list);
      Arrays.sort(attributes,new Comparator(){
        public int compare(        Object o1,        Object o2){
          return ((XmlAttribute)o1).getName().compareTo(((XmlAttribute)o2).getName());
        }
      }
);
      final Iterator<MyAttributeInfo> iter=list.iterator();
      int index=0;
      list=new ArrayList<MyAttributeInfo>();
      while (iter.hasNext()) {
        final MyAttributeInfo info=iter.next();
        boolean requiredFlag=false;
        while (attributes.length > index) {
          if (info.compareTo(attributes[index]) != 0) {
            if (info.compareTo(attributes[index]) < 0) {
              break;
            }
            if (attributes[index].getValue() != null)             list.add(new MyAttributeInfo(attributes[index].getName(),false));
            index++;
          }
 else {
            requiredFlag=true;
            index++;
            break;
          }
        }
        info.myRequired&=requiredFlag;
        list.add(info);
      }
      while (attributes.length > index) {
        if (attributes[index].getValue() != null) {
          list.add(new MyAttributeInfo(attributes[index++].getName(),false));
        }
 else {
          index++;
        }
      }
    }
    attributesMap.put(tagName,list);
  }
{
    final List<String> tags=tagsMap.get(tagName) != null ? tagsMap.get(tagName) : new ArrayList<String>();
    tagsMap.put(tagName,tags);
    tag.processElements(new FilterElementProcessor(new ClassFilter(XmlTag.class)){
      public void add(      PsiElement element){
        XmlTag tag=(XmlTag)element;
        if (!tags.contains(tag.getName())) {
          tags.add(tag.getName());
        }
        computeTag(tag,tagsMap,attributesMap);
      }
    }
,tag);
  }
}
