{
  if (deepFlag)   if (!processor.execute(element))   return false;
  PsiElement startFrom=element.getFirstChild();
  if (element instanceof XmlEntityRef) {
    XmlEntityRef ref=(XmlEntityRef)element;
    PsiElement newElement=parseEntityRef(targetFile,ref,true);
    if (newElement == null) {
      newElement=parseEntityRef(targetFile,ref,true);
    }
    if (newElement == null)     return true;
    while (newElement != null) {
      if (!processElement(newElement,deepFlag,wideFlag))       return false;
      newElement=newElement.getNextSibling();
    }
    return true;
  }
 else   if (element instanceof XmlConditionalSection) {
    XmlConditionalSection xmlConditionalSection=((XmlConditionalSection)element);
    if (!xmlConditionalSection.isIncluded())     return true;
    startFrom=xmlConditionalSection.getBodyStart();
  }
  for (PsiElement child=startFrom; child != null; child=child.getNextSibling()) {
    if (!processElement(child,deepFlag,wideFlag) && !wideFlag)     return false;
  }
  if (element instanceof XmlEntityDecl) {
    XmlEntityDecl xmlEntityDecl=(XmlEntityDecl)element;
    XmlEntityRefImpl.cacheParticularEntity(element.getContainingFile(),xmlEntityDecl);
  }
  return true;
}
