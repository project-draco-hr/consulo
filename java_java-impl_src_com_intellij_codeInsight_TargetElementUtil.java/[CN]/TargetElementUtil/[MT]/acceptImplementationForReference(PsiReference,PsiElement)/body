{
  if (reference instanceof PsiReferenceExpression && element instanceof PsiMember) {
    return ApplicationManager.getApplication().runReadAction(new Computable<Boolean>(){
      @Override public Boolean compute(){
        PsiClass containingClass=((PsiMember)element).getContainingClass();
        final PsiExpression expression=((PsiReferenceExpression)reference).getQualifierExpression();
        PsiClass psiClass;
        if (expression != null) {
          psiClass=PsiUtil.resolveClassInType(expression.getType());
        }
 else {
          if (element instanceof PsiClass) {
            psiClass=(PsiClass)element;
            final PsiElement resolve=reference.resolve();
            if (resolve instanceof PsiClass) {
              containingClass=(PsiClass)resolve;
            }
          }
 else {
            psiClass=PsiTreeUtil.getParentOfType((PsiReferenceExpression)reference,PsiClass.class);
          }
        }
        if (containingClass == null && psiClass == null)         return true;
        if (containingClass != null) {
          while (psiClass != null) {
            if (InheritanceUtil.isInheritorOrSelf(containingClass,psiClass,true) || InheritanceUtil.isInheritorOrSelf(psiClass,containingClass,true)) {
              return true;
            }
            psiClass=psiClass.getContainingClass();
          }
        }
        return false;
      }
    }
);
  }
  return super.acceptImplementationForReference(reference,element);
}
