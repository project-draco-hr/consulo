{
  int curLine=0;
  int curOffset=0;
  while (true) {
    if (offset <= curOffset) {
      return curLine;
    }
    if (curOffset == text.length())     return -1;
    char c=text.charAt(curOffset);
    if (c == '\n') {
      curLine++;
    }
 else     if (c == '\r') {
      curLine++;
      if (curOffset < text.length() - 1 && text.charAt(curOffset + 1) == '\n') {
        curOffset++;
      }
    }
    curOffset++;
  }
}
