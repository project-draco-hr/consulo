{
  boolean old=CodeInsightSettings.getInstance().OPTIMIZE_IMPORTS_ON_THE_FLY;
  try {
    CodeInsightSettings.getInstance().OPTIMIZE_IMPORTS_ON_THE_FLY=false;
    IntentionAction action=findActionWithText(text);
    if (action == null && actionShouldBeAvailable) {
      fail("Action with text '" + text + "' is not available in test "+ testFullPath);
    }
    if (action != null && actionShouldBeAvailable) {
      action.invoke(getProject(),getEditor(),getFile());
      assertTrue(CodeInsightSettings.getInstance().OPTIMIZE_IMPORTS_ON_THE_FLY);
    }
  }
  finally {
    CodeInsightSettings.getInstance().OPTIMIZE_IMPORTS_ON_THE_FLY=old;
  }
}
