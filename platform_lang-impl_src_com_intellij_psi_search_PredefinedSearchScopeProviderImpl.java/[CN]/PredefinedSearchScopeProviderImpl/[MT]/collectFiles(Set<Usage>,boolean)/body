{
  final Set<VirtualFile> files=new HashSet<VirtualFile>();
  for (  Usage usage : usages) {
    if (usage instanceof PsiElementUsage) {
      PsiElement psiElement=((PsiElementUsage)usage).getElement();
      if (psiElement != null && psiElement.isValid()) {
        PsiFile psiFile=psiElement.getContainingFile();
        if (psiFile != null) {
          VirtualFile file=psiFile.getVirtualFile();
          if (file != null) {
            files.add(file);
            if (findFirst)             return files;
          }
        }
      }
    }
  }
  return files;
}
