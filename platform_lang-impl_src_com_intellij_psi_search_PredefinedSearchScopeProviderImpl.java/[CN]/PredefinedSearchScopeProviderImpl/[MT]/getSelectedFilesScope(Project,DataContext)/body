{
  final VirtualFile[] filesOrDirs=dataContext == null ? null : CommonDataKeys.VIRTUAL_FILE_ARRAY.getData(dataContext);
  if (filesOrDirs != null) {
    final List<VirtualFile> selectedFiles=ContainerUtil.filter(filesOrDirs,new Condition<VirtualFile>(){
      @Override public boolean value(      VirtualFile file){
        return !file.isDirectory();
      }
    }
);
    if (!selectedFiles.isEmpty()) {
      return GlobalSearchScope.filesScope(project,selectedFiles,"Selected Files");
    }
  }
  return null;
}
