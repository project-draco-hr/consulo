{
  if (myExistingConfiguration != null)   return myExistingConfiguration.get();
  myExistingConfiguration=new Ref<RunnerAndConfigurationSettings>();
  if (myLocation == null) {
    return null;
  }
  final PsiElement psiElement=myLocation.getPsiElement();
  if (!psiElement.isValid()) {
    return null;
  }
  final List<RuntimeConfigurationProducer> producers=findPreferredProducers();
  if (producers == null)   return null;
  if (myRuntimeConfiguration != null) {
    for (    RuntimeConfigurationProducer producer : producers) {
      final RunnerAndConfigurationSettings configuration=producer.findExistingConfiguration(myLocation,this);
      if (configuration != null && configuration.getConfiguration() == myRuntimeConfiguration) {
        myExistingConfiguration.set(configuration);
      }
    }
  }
  for (  RuntimeConfigurationProducer producer : producers) {
    final RunnerAndConfigurationSettings configuration=producer.findExistingConfiguration(myLocation,this);
    if (configuration != null) {
      myExistingConfiguration.set(configuration);
    }
  }
  return myExistingConfiguration.get();
}
