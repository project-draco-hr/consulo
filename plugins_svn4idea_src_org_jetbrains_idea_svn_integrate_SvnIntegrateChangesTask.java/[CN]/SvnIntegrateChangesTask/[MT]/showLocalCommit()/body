{
  final Collection<FilePath> files=gatherChangedPaths();
  final ChangeListManager clManager=ChangeListManager.getInstance(myProject);
  clManager.invokeAfterUpdate(new Runnable(){
    public void run(){
      final Collection<Change> changes=new ArrayList<Change>();
      for (      FilePath file : files) {
        final Change change=clManager.getChange(file);
        if (change != null) {
          changes.add(change);
        }
      }
      CommitChangeListDialog.commitChanges(myProject,changes,null,null,myMerger.getComment());
      prepareAndShowResults();
    }
  }
,InvokeAfterUpdateMode.SYNCHRONOUS_CANCELLABLE,myTitle,new Consumer<VcsDirtyScopeManager>(){
    public void consume(    final VcsDirtyScopeManager vcsDirtyScopeManager){
      vcsDirtyScopeManager.filePathsDirty(files,null);
    }
  }
,null);
}
