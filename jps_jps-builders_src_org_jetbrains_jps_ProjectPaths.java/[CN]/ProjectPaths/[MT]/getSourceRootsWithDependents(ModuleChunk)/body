{
  final boolean includeTests=chunk.containsTests();
  final Map<File,String> result=new LinkedHashMap<File,String>();
  processModulesRecursively(chunk,JpsJavaClasspathKind.compile(includeTests),new Consumer<JpsModule>(){
    @Override public void consume(    JpsModule module){
      for (      JpsModuleSourceRoot root : module.getSourceRoots()) {
        if (root.getRootType().equals(JavaSourceRootType.SOURCE) || includeTests && root.getRootType().equals(JavaSourceRootType.TEST_SOURCE)) {
          JavaSourceRootProperties properties=(JavaSourceRootProperties)((JpsSimpleElement<?>)root.getProperties()).getData();
          String prefix=properties.getPackagePrefix();
          if (!prefix.isEmpty()) {
            prefix=prefix.replace('.','/');
            if (!prefix.endsWith("/")) {
              prefix+="/";
            }
          }
 else {
            prefix=null;
          }
          result.put(JpsPathUtil.urlToFile(root.getUrl()),prefix);
        }
      }
    }
  }
);
  return result;
}
