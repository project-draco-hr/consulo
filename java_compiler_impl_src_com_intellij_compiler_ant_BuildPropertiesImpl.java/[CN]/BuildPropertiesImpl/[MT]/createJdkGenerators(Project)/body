{
  final Sdk[] jdks=getUsedJdks(project);
  if (jdks.length > 0) {
    add(new Comment(CompilerBundle.message("generated.ant.build.jdk.definitions.comment")),1);
    for (    final Sdk jdk : jdks) {
      if (jdk.getHomeDirectory() == null) {
        continue;
      }
      final SdkType sdkType=jdk.getSdkType();
      if (!(sdkType instanceof JavaSdkType) || ((JavaSdkType)sdkType).getBinPath(jdk) == null) {
        continue;
      }
      final File home=VfsUtil.virtualToIoFile(jdk.getHomeDirectory());
      File homeDir;
      try {
        homeDir=home.getCanonicalFile();
      }
 catch (      IOException e) {
        homeDir=home;
      }
      final String jdkName=jdk.getName();
      final String jdkHomeProperty=getJdkHomeProperty(jdkName);
      final FileSet fileSet=new FileSet(propertyRef(jdkHomeProperty));
      final String[] urls=jdk.getRootProvider().getUrls(OrderRootType.CLASSES);
      for (      String url : urls) {
        final String path=GenerationUtils.trimJarSeparator(VirtualFileManager.extractPath(url));
        final File pathElement=new File(path);
        final String relativePath=FileUtil.getRelativePath(homeDir,pathElement);
        if (relativePath != null) {
          fileSet.add(new Include(relativePath.replace(File.separatorChar,'/')));
        }
      }
      final File binPath=toCanonicalFile(new File(((JavaSdkType)sdkType).getBinPath(jdk)));
      final String relativePath=FileUtil.getRelativePath(homeDir,binPath);
      if (relativePath != null) {
        add(new Property(BuildProperties.getJdkBinProperty(jdkName),propertyRef(jdkHomeProperty) + "/" + FileUtil.toSystemIndependentName(relativePath)),1);
      }
 else {
        add(new Property(BuildProperties.getJdkBinProperty(jdkName),FileUtil.toSystemIndependentName(binPath.getPath())),1);
      }
      final Path jdkPath=new Path(getJdkPathId(jdkName));
      jdkPath.add(fileSet);
      add(jdkPath);
    }
  }
  final Sdk projectJdk=ProjectRootManager.getInstance(project).getProjectSdk();
  add(new Property(PROPERTY_PROJECT_JDK_HOME,projectJdk != null ? propertyRef(getJdkHomeProperty(projectJdk.getName())) : ""),1);
  add(new Property(PROPERTY_PROJECT_JDK_BIN,projectJdk != null ? propertyRef(getJdkBinProperty(projectJdk.getName())) : ""));
  add(new Property(PROPERTY_PROJECT_JDK_CLASSPATH,projectJdk != null ? getJdkPathId(projectJdk.getName()) : ""));
}
