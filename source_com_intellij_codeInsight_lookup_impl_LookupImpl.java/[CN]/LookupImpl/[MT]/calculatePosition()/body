{
  Dimension dim=getComponent().getPreferredSize();
  int lookupStart=myLookupStartMarker.getStartOffset();
  LogicalPosition pos=myEditor.offsetToLogicalPosition(lookupStart);
  Point location=myEditor.logicalPositionToXY(pos);
  location.y+=myEditor.getLineHeight();
  JComponent editorComponent=myEditor.getComponent();
  JComponent internalComponent=myEditor.getContentComponent();
  JLayeredPane layeredPane=editorComponent.getRootPane().getLayeredPane();
  Point layeredPanePoint=SwingUtilities.convertPoint(internalComponent,location,layeredPane);
  layeredPanePoint.x=layeredPanePoint.x - myCellRenderer.ICON_WIDTH - 5;
  if (dim.width > layeredPane.getWidth()) {
    dim.width=layeredPane.getWidth();
  }
  int wshift=layeredPane.getWidth() - (layeredPanePoint.x + dim.width);
  if (wshift < 0) {
    layeredPanePoint.x+=wshift;
  }
  if (myPositionedAbove == null) {
    int hshift=layeredPane.getHeight() - (layeredPanePoint.y + dim.height);
    myPositionedAbove=hshift < 0 ? Boolean.TRUE : Boolean.FALSE;
  }
  if (myPositionedAbove.booleanValue()) {
    layeredPanePoint.y-=dim.height + myEditor.getLineHeight();
  }
  return layeredPanePoint;
}
