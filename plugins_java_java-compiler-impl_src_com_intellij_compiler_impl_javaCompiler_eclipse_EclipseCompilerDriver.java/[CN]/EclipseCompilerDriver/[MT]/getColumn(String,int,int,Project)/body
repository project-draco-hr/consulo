{
  if (sourceStart == 0)   return 0;
  return ApplicationManager.getApplication().runReadAction(new Computable<Integer>(){
    public Integer compute(){
      VirtualFile file=VirtualFileManager.getInstance().findFileByUrl(url);
      if (file == null)       return 0;
      Document document=FileDocumentManager.getInstance().getDocument(file);
      if (document == null)       return 0;
      int lineStartOffset=document.getLineStartOffset(lineNumber - 1);
      String lineSeparator=FileDocumentManager.getInstance().getLineSeparator(file,project);
      int offsetInVirtualFile=sourceStart - (lineNumber - 1) * (lineSeparator.length() - 1);
      return offsetInVirtualFile - lineStartOffset + 1;
    }
  }
).intValue();
}
