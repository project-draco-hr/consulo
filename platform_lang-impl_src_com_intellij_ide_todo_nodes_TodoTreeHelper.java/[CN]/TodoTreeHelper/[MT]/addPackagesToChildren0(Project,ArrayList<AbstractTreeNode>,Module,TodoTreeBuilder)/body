{
  final List<VirtualFile> roots=new ArrayList<VirtualFile>();
  final List<VirtualFile> sourceRoots=new ArrayList<VirtualFile>();
  final PsiManager psiManager=PsiManager.getInstance(project);
  if (module == null) {
    final ProjectRootManager projectRootManager=ProjectRootManager.getInstance(project);
    ContainerUtil.addAll(roots,projectRootManager.getContentRoots());
    ContainerUtil.addAll(sourceRoots,projectRootManager.getContentSourceRoots());
  }
 else {
    ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(module);
    ContainerUtil.addAll(roots,moduleRootManager.getContentRoots());
    ContainerUtil.addAll(sourceRoots,moduleRootManager.getContentFolderFiles(ContentFolderScopes.productionAndTest()));
  }
  roots.removeAll(sourceRoots);
  for (  VirtualFile dir : roots) {
    final PsiDirectory directory=psiManager.findDirectory(dir);
    if (directory == null) {
      continue;
    }
    final Iterator<PsiFile> files=builder.getFiles(directory);
    if (!files.hasNext())     continue;
    TodoDirNode dirNode=new TodoDirNode(project,directory,builder);
    if (!children.contains(dirNode)) {
      children.add(dirNode);
    }
  }
}
