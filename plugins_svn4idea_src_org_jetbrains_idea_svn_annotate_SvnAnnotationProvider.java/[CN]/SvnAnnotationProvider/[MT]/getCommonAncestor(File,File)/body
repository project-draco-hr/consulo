{
  if (FileUtil.filesEqual(file1,file2))   return file1;
  final File can1=file1.getCanonicalFile();
  final File can2=file2.getCanonicalFile();
  final List<String> parts1=StringUtil.split(can1.getPath(),File.separator,true);
  final List<String> parts2=StringUtil.split(can2.getPath(),File.separator,true);
  int cnt=0;
  while (parts1.size() > cnt && parts2.size() > cnt) {
    if (!parts1.get(cnt).equals(parts2.get(cnt))) {
      if (cnt > 0) {
        return new File(StringUtil.join(parts1.subList(0,cnt),File.separator));
      }
 else {
        return null;
      }
    }
    ++cnt;
  }
  if (parts1.size() > parts2.size()) {
    return file2;
  }
 else {
    return file1;
  }
}
