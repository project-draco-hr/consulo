{
  if (myRegisteredPasses == null || psiFile == null) {
    return;
  }
  for (  TextEditorHighlightingPassFactory factory : myRegisteredPasses.keySet()) {
    final TextEditorHighlightingPass editorHighlightingPass=factory.createHighlightingPass(psiFile,editor);
    if (editorHighlightingPass == null)     continue;
    final Pair<Anchor,Integer> location=myRegisteredPasses.get(factory);
    final Anchor anchor=location.first;
    if (anchor == Anchor.FIRST) {
      passes.add(0,editorHighlightingPass);
    }
 else     if (anchor == Anchor.LAST) {
      passes.add(editorHighlightingPass);
    }
 else {
      final int passId=location.second.intValue();
      int anchorPassIdx=-1;
      for (int idx=0; idx < passes.size(); idx++) {
        final TextEditorHighlightingPass highlightingPass=passes.get(idx);
        if (highlightingPass.getPassId() == passId) {
          anchorPassIdx=idx;
          break;
        }
      }
      if (anchorPassIdx == -1) {
        passes.add(editorHighlightingPass);
      }
 else {
        if (anchor == Anchor.BEFORE) {
          passes.add(Math.max(0,anchorPassIdx - 1),editorHighlightingPass);
        }
 else {
          passes.add(anchorPassIdx + 1,editorHighlightingPass);
        }
      }
    }
  }
}
