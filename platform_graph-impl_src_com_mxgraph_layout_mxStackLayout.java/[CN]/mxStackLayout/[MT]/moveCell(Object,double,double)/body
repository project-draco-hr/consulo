{
  mxIGraphModel model=graph.getModel();
  Object parent=model.getParent(cell);
  boolean horizontal=isHorizontal();
  if (cell instanceof mxICell && parent instanceof mxICell) {
    int i=0;
    double last=0;
    int childCount=model.getChildCount(parent);
    double value=(horizontal) ? x : y;
    mxCellState pstate=graph.getView().getState(parent);
    if (pstate != null) {
      value-=(horizontal) ? pstate.getX() : pstate.getY();
    }
    for (i=0; i < childCount; i++) {
      Object child=model.getChildAt(parent,i);
      if (child != cell) {
        mxGeometry bounds=model.getGeometry(child);
        if (bounds != null) {
          double tmp=(horizontal) ? bounds.getX() + bounds.getWidth() / 2 : bounds.getY() + bounds.getHeight() / 2;
          if (last < value && tmp > value) {
            break;
          }
          last=tmp;
        }
      }
    }
    int idx=((mxICell)parent).getIndex((mxICell)cell);
    idx=Math.max(0,i - ((i > idx) ? 1 : 0));
    model.add(parent,cell,idx);
  }
}
