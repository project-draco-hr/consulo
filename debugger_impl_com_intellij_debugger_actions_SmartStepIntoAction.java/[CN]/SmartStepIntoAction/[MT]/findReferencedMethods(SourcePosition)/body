{
  final PsiFile file=position.getFile();
  final Document doc=FileDocumentManager.getInstance().getDocument(file.getVirtualFile());
  final int line=position.getLine();
  final int startOffset=doc.getLineStartOffset(line);
  final TextRange lineRange=new TextRange(startOffset,doc.getLineEndOffset(line));
  final int offset=CharArrayUtil.shiftForward(doc.getCharsSequence(),startOffset," \t");
  PsiElement element=file.findElementAt(offset);
  if (element != null) {
    do {
      final PsiElement parent=element.getParent();
      if (parent == null || (parent.getTextOffset() < lineRange.getStartOffset())) {
        break;
      }
      element=parent;
    }
 while (true);
    final List<PsiMethod> methods=new OrderedSet<PsiMethod>(TObjectHashingStrategy.CANONICAL);
    final PsiRecursiveElementVisitor methodCollector=new PsiRecursiveElementVisitor(){
      public void visitAnonymousClass(      PsiAnonymousClass aClass){
      }
      public void visitMethodCallExpression(      PsiMethodCallExpression expression){
        final PsiMethod psiMethod=expression.resolveMethod();
        if (psiMethod != null) {
          methods.add(psiMethod);
        }
        super.visitMethodCallExpression(expression);
      }
    }
;
    element.accept(methodCollector);
    for (PsiElement sibling=element.getNextSibling(); sibling != null; sibling=sibling.getNextSibling()) {
      if (!lineRange.intersects(sibling.getTextRange())) {
        break;
      }
      sibling.accept(methodCollector);
    }
    return methods;
  }
  return Collections.emptyList();
}
