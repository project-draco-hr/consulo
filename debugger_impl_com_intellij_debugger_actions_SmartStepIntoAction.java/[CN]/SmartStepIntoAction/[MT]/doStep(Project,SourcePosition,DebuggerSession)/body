{
  final VirtualFile file=position.getFile().getVirtualFile();
  final FileEditor fileEditor=file != null ? FileEditorManager.getInstance(project).getSelectedEditor(file) : null;
  if (fileEditor instanceof TextEditor) {
    final List<PsiMethod> methods=findReferencedMethods(position);
    if (methods.size() > 0) {
      if (methods.size() == 1) {
        session.stepInto(false,createSmartStepFilter(methods.get(0),session));
      }
 else {
        final PsiMethodListPopupStep popupStep=new PsiMethodListPopupStep(methods,new PsiMethodListPopupStep.OnChooseRunnable(){
          public void execute(          PsiMethod chosenMethod){
            session.stepInto(false,createSmartStepFilter(chosenMethod,session));
          }
        }
);
        final ListPopup popup=JBPopupFactory.getInstance().createListPopup(popupStep);
        final RelativePoint point=calcPopupLocation(((TextEditor)fileEditor).getEditor(),position);
        popup.show(point);
      }
      return;
    }
  }
  session.stepInto(false,null);
}
