{
  final VirtualFile groovyJar=findGroovyJar(module);
  if (groovyJar != null) {
    params.getClassPath().add(groovyJar);
  }
  setToolsJar(params);
  final String groovyHome=FileUtil.toSystemDependentName(ObjectUtils.assertNotNull(LibrariesUtil.getGroovyHomePath(module)));
  setGroovyHome(params,groovyHome);
  final String confPath=getConfPath(module);
  params.getVMParametersList().add("-Dgroovy.starter.conf=" + confPath);
  params.getVMParametersList().addParametersString(configuration.vmParams);
  params.setMainClass("org.codehaus.groovy.tools.GroovyStarter");
  params.getProgramParametersList().add("--conf");
  params.getProgramParametersList().add(confPath);
  params.getProgramParametersList().add("--classpath");
  params.getProgramParametersList().add(getClearClasspath(module,tests));
  params.getProgramParametersList().add("--main");
  params.getProgramParametersList().add("groovy.ui.GroovyMain");
  params.getProgramParametersList().add(FileUtil.toSystemDependentName(configuration.scriptPath));
  params.getProgramParametersList().addParametersString(configuration.scriptParams);
  addScriptEncodingSettings(params,script,module);
}
