{
  final FileEditorManagerImpl editorManager=getManager();
  editorManager.mySplitters.myInsideChange++;
  try {
    final List<EditorWithProviderComposite> editors=editorManager.getEditorComposites(file);
    LOG.assertTrue(!editors.isEmpty());
    final EditorWithProviderComposite editor=findFileComposite(file);
    if (myTabbedPane != null) {
      final int componentIndex=findComponentIndex(editor.getComponent());
      if (componentIndex >= 0) {
        int indexToSelect=calcIndexToSelect(file,componentIndex);
        if (indexToSelect >= 0 && indexToSelect < myTabbedPane.getTabCount()) {
          myTabbedPane.setSelectedIndex(indexToSelect);
        }
        myTabbedPane.removeTabAt(componentIndex).doWhenDone(new Runnable(){
          public void run(){
            editorManager.disposeComposite(editor);
          }
        }
);
      }
    }
 else {
      myPanel.removeAll();
      editorManager.disposeComposite(editor);
    }
    if (unsplit && getTabCount() == 0) {
      unsplit();
    }
    myPanel.revalidate();
    if (myTabbedPane == null) {
      myPanel.repaint();
    }
  }
  finally {
    editorManager.mySplitters.myInsideChange--;
    final FileEditorManagerListener publisher=editorManager.getProject().getMessageBus().syncPublisher(FileEditorManagerListener.FILE_EDITOR_MANAGER);
    publisher.fileClosed(editorManager,file);
  }
}
