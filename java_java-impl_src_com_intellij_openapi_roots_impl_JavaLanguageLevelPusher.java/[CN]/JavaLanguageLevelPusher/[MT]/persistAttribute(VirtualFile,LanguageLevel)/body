{
  final DataInputStream iStream=PERSISTENCE.readAttribute(fileOrDir);
  if (iStream != null) {
    try {
      final int oldLevelOrdinal=DataInputOutputUtil.readINT(iStream);
      if (oldLevelOrdinal == level.ordinal())       return;
    }
  finally {
      iStream.close();
    }
  }
  final DataOutputStream oStream=PERSISTENCE.writeAttribute(fileOrDir);
  DataInputOutputUtil.writeINT(oStream,level.ordinal());
  oStream.close();
  for (  VirtualFile child : fileOrDir.getChildren()) {
    if (!child.isDirectory() && StdFileTypes.JAVA.equals(child.getFileType())) {
      FileBasedIndex.getInstance().requestReindex(child);
    }
  }
}
