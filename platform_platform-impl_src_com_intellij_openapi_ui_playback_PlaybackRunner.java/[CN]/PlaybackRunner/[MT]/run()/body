{
  myStopRequested=false;
  myRegistryValues.clear();
  final UiActivityMonitor activityMonitor=UiActivityMonitor.getInstance();
  activityMonitor.clear();
  activityMonitor.setActive(true);
  myCurrentStageDepth.clear();
  myPassedStages.clear();
  myContextTimestamp++;
  ApplicationManager.getApplication().getMessageBus().connect(myOnStop).subscribe(ApplicationActivationListener.TOPIC,myAppListener);
  try {
    myActionCallback=new ActionCallback();
    myActionCallback.doWhenProcessed(new Runnable(){
      @Override public void run(){
        stop();
        SwingUtilities.invokeLater(new Runnable(){
          @Override public void run(){
            activityMonitor.setActive(false);
            restoreRegistryValues();
          }
        }
);
      }
    }
);
    myRobot=new Robot();
    parse();
    new Thread(){
      @Override public void run(){
        if (myUseDirectActionCall) {
          executeFrom(0,getScriptDir());
        }
 else {
          IdeEventQueue.getInstance().doWhenReady(new Runnable(){
            public void run(){
              executeFrom(0,getScriptDir());
            }
          }
);
        }
      }
    }
.start();
  }
 catch (  AWTException e) {
    LOG.error(e);
  }
  return myActionCallback;
}
