{
  super.setUp();
  final LocalInspectionTool[] tools=configureLocalInspectionTools();
  for (  LocalInspectionTool tool : tools) {
    enableInspectionTool(tool);
  }
  final InspectionProfileImpl profile=new InspectionProfileImpl(LightPlatformTestCase.PROFILE){
    @Override @NotNull public ModifiableModel getModifiableModel(){
      mySource=this;
      return this;
    }
    @Override @NotNull public InspectionToolWrapper[] getInspectionTools(    PsiElement element){
      Collection<InspectionToolWrapper> values=myAvailableTools.values();
      return values.toArray(new InspectionToolWrapper[values.size()]);
    }
    @NotNull @Override public List<Tools> getAllEnabledInspectionTools(    Project project){
      List<Tools> result=new ArrayList<Tools>();
      for (      InspectionToolWrapper toolWrapper : getInspectionTools(null)) {
        result.add(new ToolsImpl(toolWrapper,toolWrapper.getDefaultLevel(),true));
      }
      return result;
    }
    @Override public boolean isToolEnabled(    HighlightDisplayKey key,    PsiElement element){
      return key != null && myAvailableTools.containsKey(key.toString());
    }
    @Override public HighlightDisplayLevel getErrorLevel(    @NotNull HighlightDisplayKey key,    PsiElement element){
      final InspectionToolWrapper localInspectionTool=myAvailableTools.get(key.toString());
      return localInspectionTool != null ? localInspectionTool.getDefaultLevel() : HighlightDisplayLevel.WARNING;
    }
    @Override public InspectionToolWrapper getInspectionTool(    @NotNull String shortName,    @NotNull PsiElement element){
      return myAvailableTools.get(shortName);
    }
  }
;
  final InspectionProfileManager inspectionProfileManager=InspectionProfileManager.getInstance();
  inspectionProfileManager.addProfile(profile);
  inspectionProfileManager.setRootProfile(LightPlatformTestCase.PROFILE);
  Disposer.register(getProject(),new Disposable(){
    @Override public void dispose(){
      inspectionProfileManager.deleteProfile(LightPlatformTestCase.PROFILE);
    }
  }
);
  InspectionProjectProfileManager.getInstance(getProject()).updateProfile(profile);
  InspectionProjectProfileManager.getInstance(getProject()).setProjectProfile(profile.getName());
  DaemonCodeAnalyzerImpl daemonCodeAnalyzer=(DaemonCodeAnalyzerImpl)DaemonCodeAnalyzer.getInstance(getProject());
  daemonCodeAnalyzer.prepareForTest();
  final StartupManagerImpl startupManager=(StartupManagerImpl)StartupManagerEx.getInstanceEx(getProject());
  startupManager.runStartupActivities();
  startupManager.startCacheUpdate();
  startupManager.runPostStartupActivities();
  DaemonCodeAnalyzerSettings.getInstance().setImportHintEnabled(false);
  if (isPerformanceTest()) {
    IntentionManager.getInstance().getAvailableIntentionActions();
    PathManagerEx.getTestDataPath();
    ReferenceProvidersRegistry.getInstance();
    InjectedLanguageManager.getInstance(getProject());
    LanguageAnnotators.INSTANCE.allForLanguage(JavaLanguage.INSTANCE);
    LanguageAnnotators.INSTANCE.allForLanguage(StdLanguages.XML);
    ProblemHighlightFilter.EP_NAME.getExtensions();
    Extensions.getExtensions(ImplicitUsageProvider.EP_NAME);
    Extensions.getExtensions(XmlSchemaProvider.EP_NAME);
    Extensions.getExtensions(XmlFileNSInfoProvider.EP_NAME);
    Extensions.getExtensions(ExternalAnnotatorsFilter.EXTENSION_POINT_NAME);
    Extensions.getExtensions(IndexPatternBuilder.EP_NAME);
  }
}
