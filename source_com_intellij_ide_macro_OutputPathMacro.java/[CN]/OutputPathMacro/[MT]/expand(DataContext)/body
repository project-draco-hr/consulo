{
  Project project=DataKeys.PROJECT.getData(dataContext);
  if (project == null) {
    return null;
  }
  VirtualFile file=DataKeys.VIRTUAL_FILE.getData(dataContext);
  if (file != null) {
    ProjectFileIndex projectFileIndex=ProjectRootManager.getInstance(project).getFileIndex();
    Module module=projectFileIndex.getModuleForFile(file);
    if (module != null) {
      boolean isTest=projectFileIndex.isInTestSourceContent(file);
      ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(module);
      String outputPathUrl=isTest ? moduleRootManager.getCompilerOutputPathForTestsUrl() : moduleRootManager.getCompilerOutputPathUrl();
      if (outputPathUrl == null)       return null;
      return VirtualFileManager.extractPath(outputPathUrl).replace('/',File.separatorChar);
    }
  }
  Module[] allModules=ModuleManager.getInstance(project).getSortedModules();
  if (allModules.length == 0) {
    return null;
  }
  String[] paths=CompilerPathsEx.getOutputPaths(allModules);
  final StringBuffer outputPath=new StringBuffer();
  for (int idx=0; idx < paths.length; idx++) {
    String path=paths[idx];
    if (idx > 0) {
      outputPath.append(File.pathSeparator);
    }
    outputPath.append(path);
  }
  return outputPath.toString();
}
