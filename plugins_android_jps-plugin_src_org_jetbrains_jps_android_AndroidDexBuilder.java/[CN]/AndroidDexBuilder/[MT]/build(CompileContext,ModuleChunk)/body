{
  if (context.isCompilingTests() || !AndroidJpsUtil.containsAndroidFacet(chunk)) {
    return ModuleLevelBuilder.ExitCode.OK;
  }
  context.processMessage(new ProgressMessage("Executing DEX"));
  try {
    return doBuild(context,chunk);
  }
 catch (  Exception e) {
    String message=e.getMessage();
    if (message == null) {
      final ByteArrayOutputStream out=new ByteArrayOutputStream();
      e.printStackTrace(new PrintStream(out));
      message="Internal error: \n" + out.toString();
    }
    context.processMessage(new CompilerMessage(BUILDER_NAME,BuildMessage.Kind.ERROR,message));
    throw new ProjectBuildException(message,e);
  }
}
