{
  final File[] files=pluginsHome.listFiles();
  if (files != null) {
    int i=result.size();
    for (    File file : files) {
      final IdeaPluginDescriptorImpl descriptor=loadDescriptor(file,PLUGIN_XML);
      if (descriptor == null)       continue;
      if (progress != null) {
        progress.showProgress(descriptor.getName(),PLUGINS_PROGRESS_MAX_VALUE * ((float)++i / pluginsCount));
      }
      int oldIndex=result.indexOf(descriptor);
      if (oldIndex >= 0) {
        final IdeaPluginDescriptorImpl oldDescriptor=result.get(oldIndex);
        if (StringUtil.compareVersionNumbers(oldDescriptor.getVersion(),descriptor.getVersion()) < 0) {
          result.set(oldIndex,descriptor);
        }
      }
 else {
        result.add(descriptor);
      }
    }
  }
}
