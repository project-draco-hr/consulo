{
synchronized (LOCK) {
    if (ourForcedFlushQueue.size() > 0) {
      final RunnableInfo toRun=ourForcedFlushQueue.get(0);
      ourForcedFlushQueue.remove(0);
      return toRun.runnable;
    }
    ModalityStateEx currentModality=(ModalityStateEx)(ourModalEntities.size() > 0 ? new ModalityStateEx(ourModalEntities.toArray(ArrayUtil.EMPTY_OBJECT_ARRAY)) : ApplicationManager.getApplication().getNoneModalityState());
    while (ourQueueSkipCount < ourQueue.size()) {
      RunnableInfo info=ourQueue.get(ourQueueSkipCount);
      if (!currentModality.dominates(info.modalityState)) {
        ourQueue.remove(ourQueueSkipCount);
        return info.runnable;
      }
      ourQueueSkipCount++;
    }
    return null;
  }
}
