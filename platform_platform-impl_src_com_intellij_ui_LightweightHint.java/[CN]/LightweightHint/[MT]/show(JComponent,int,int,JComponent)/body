{
  myParentComponent=parentComponent;
  myFocusBackComponent=focusBackComponent;
  LOG.assertTrue(myParentComponent.isShowing());
  myEscListener=new MyEscListener();
  myComponent.registerKeyboardAction(myEscListener,KeyStroke.getKeyStroke(KeyEvent.VK_ESCAPE,0),JComponent.WHEN_IN_FOCUSED_WINDOW);
  final JLayeredPane layeredPane=parentComponent.getRootPane().getLayeredPane();
  if (!myForceShowAsPopup && (myForceLightweightPopup || fitsLayeredPane(layeredPane,myComponent,new RelativePoint(parentComponent,new Point(x,y))))) {
    beforeShow();
    final Dimension preferredSize=myComponent.getPreferredSize();
    final Point layeredPanePoint=SwingUtilities.convertPoint(parentComponent,x,y,layeredPane);
    myComponent.setBounds(layeredPanePoint.x,layeredPanePoint.y,preferredSize.width,preferredSize.height);
    layeredPane.add(myComponent,Integer.valueOf(250 + layeredPane.getComponentCount()));
    myComponent.validate();
    myComponent.repaint();
  }
 else {
    myIsRealPopup=true;
    myPopup=JBPopupFactory.getInstance().createComponentPopupBuilder(myComponent,null).setRequestFocus(false).setResizable(myForceShowAsPopup).setMovable(myForceShowAsPopup).setTitle(myTitle).setShowShadow(false).createPopup();
    beforeShow();
    myPopup.show(new RelativePoint(myParentComponent,new Point(x,y)));
  }
}
