{
  final Document doc=editor.getDocument();
  CharSequence chars=doc.getCharsSequence();
  int offset=CharArrayUtil.shiftBackward(chars,caret - 1," \t");
  if (doc.getLineNumber(offset) < doc.getLineNumber(caret)) {
    offset=CharArrayUtil.shiftForward(chars,caret," \t");
  }
  PsiElement atCaret=psiFile.findElementAt(offset);
  if (atCaret instanceof PsiWhiteSpace)   return null;
  if (atCaret instanceof PsiJavaToken && "}".equals(atCaret.getText()))   return null;
  PsiElement statementAtCaret=PsiTreeUtil.getParentOfType(atCaret,new Class[]{PsiStatement.class,PsiCodeBlock.class,PsiMember.class,PsiComment.class},false);
  if (statementAtCaret instanceof PsiBlockStatement)   return null;
  if (statementAtCaret != null && statementAtCaret.getParent() instanceof PsiForStatement)   statementAtCaret=statementAtCaret.getParent();
  return statementAtCaret instanceof PsiStatement || statementAtCaret instanceof PsiMember ? statementAtCaret : null;
}
