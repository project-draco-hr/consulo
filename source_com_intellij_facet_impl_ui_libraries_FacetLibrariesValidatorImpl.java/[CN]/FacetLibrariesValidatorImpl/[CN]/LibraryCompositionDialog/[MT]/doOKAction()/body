{
  myPanel.apply();
  LibraryCompositionSettings settings=myPanel.getLibraryCompositionSettings();
  LibrariesContainer librariesContainer=myContext.getLibrariesContainer();
  if (settings.downloadFiles(myMirrorsMap,librariesContainer,myPanel.getMainPanel())) {
    ModifiableRootModel rootModel=myContext.getModifiableRootModel();
    if (rootModel == null) {
      final ModifiableRootModel model=ModuleRootManager.getInstance(myContext.getModule()).getModifiableModel();
      settings.addLibraries(model,myAddedLibraries,librariesContainer);
      new WriteAction(){
        protected void run(        final Result result){
          model.commit();
        }
      }
.execute();
    }
 else {
      settings.addLibraries(rootModel,myAddedLibraries,librariesContainer);
    }
    super.doOKAction();
  }
}
