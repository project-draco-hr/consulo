{
  for (  final VirtualFile appRoot : ModuleRootManager.getInstance(structure.myModule).getContentRoots()) {
    appRoot.refresh(false,false);
  }
  List<Consumer<ModifiableRootModel>> actions=CollectionFactory.arrayList();
  removeInvalidSourceRoots(actions,structure);
  cleanupDefaultLibrary(structure.myModule,actions,appRoots,structure.getUserLibraryName());
  moveupLibrariesFromMavenPlugin(structure.myModule,actions);
  List<VirtualFile> rootsToFacetSetup=new ArrayList<VirtualFile>(appRoots.size());
  for (  VirtualFile appRoot : appRoots) {
    if (checkValidity(appRoot)) {
      ContainerUtil.addIfNotNull(addSourceRootsAndLibDirectory(appRoot,structure),actions);
      rootsToFacetSetup.add(appRoot);
    }
  }
  structure.setupFacets(actions,rootsToFacetSetup);
  return actions;
}
