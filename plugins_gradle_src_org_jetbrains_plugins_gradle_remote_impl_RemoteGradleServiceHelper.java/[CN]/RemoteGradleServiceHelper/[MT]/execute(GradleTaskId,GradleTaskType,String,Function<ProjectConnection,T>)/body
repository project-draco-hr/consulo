{
  Set<GradleTaskId> ids=myTasksInProgress.get(type);
  if (ids == null) {
    myTasksInProgress.putIfAbsent(type,new ConcurrentHashSet<GradleTaskId>());
    ids=myTasksInProgress.get(type);
  }
  ids.add(id);
  ProjectConnection connection=getConnection(projectPath);
  try {
    return f.fun(connection);
  }
 catch (  Throwable e) {
    throw new GradleApiException(e);
  }
 finally {
    try {
      connection.close();
    }
 catch (    Throwable e) {
    }
  }
}
