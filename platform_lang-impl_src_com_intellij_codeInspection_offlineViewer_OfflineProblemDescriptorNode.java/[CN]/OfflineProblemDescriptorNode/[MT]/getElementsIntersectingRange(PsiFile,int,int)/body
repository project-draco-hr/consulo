{
  final FileViewProvider viewProvider=file.getViewProvider();
  final Set<PsiElement> result=new LinkedHashSet<PsiElement>();
  for (  Language language : viewProvider.getLanguages()) {
    final PsiFile psiRoot=viewProvider.getPsi(language);
    if (HighlightingLevelManager.getInstance(file.getProject()).shouldInspect(psiRoot)) {
      result.addAll(CollectHighlightsUtil.getElementsInRange(psiRoot,startOffset,endOffset,true));
    }
  }
  return PsiUtilCore.toPsiElementArray(result);
}
