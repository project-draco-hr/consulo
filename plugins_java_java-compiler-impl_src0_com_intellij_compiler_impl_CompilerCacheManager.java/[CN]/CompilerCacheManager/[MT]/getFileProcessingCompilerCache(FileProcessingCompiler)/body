{
  Object cache=myCompilerToCacheMap.get(compiler);
  if (cache == null) {
    final File compilerRootDir=getCompilerRootDir(compiler);
    final FileProcessingCompilerStateCache stateCache=new FileProcessingCompilerStateCache(compilerRootDir,compiler);
    myCompilerToCacheMap.put(compiler,stateCache);
    myCacheDisposables.add(new Disposable(){
      public void dispose(){
        if (LOG.isDebugEnabled()) {
          LOG.debug("Closing cache for compiler " + compiler.getDescription() + "; cache root dir: "+ compilerRootDir);
        }
        stateCache.close();
      }
    }
);
    cache=stateCache;
  }
 else {
    LOG.assertTrue(cache instanceof FileProcessingCompilerStateCache);
  }
  return (FileProcessingCompilerStateCache)cache;
}
