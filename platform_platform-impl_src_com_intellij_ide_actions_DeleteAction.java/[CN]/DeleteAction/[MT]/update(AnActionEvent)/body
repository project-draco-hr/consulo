{
  String place=event.getPlace();
  Presentation presentation=event.getPresentation();
  if (ActionPlaces.PROJECT_VIEW_POPUP.equals(place) || ActionPlaces.COMMANDER_POPUP.equals(place))   presentation.setText(IdeBundle.message("action.delete.ellipsis"));
 else   presentation.setText(IdeBundle.message("action.delete"));
  DataContext dataContext=event.getDataContext();
  Project project=PlatformDataKeys.PROJECT.getData(dataContext);
  if (project == null) {
    presentation.setEnabled(false);
    return;
  }
  DeleteProvider provider=getDeleteProvider(dataContext);
  if (event.getInputEvent() instanceof KeyEvent) {
    KeyEvent keyEvent=(KeyEvent)event.getInputEvent();
    Object component=PlatformDataKeys.CONTEXT_COMPONENT.getData(dataContext);
    if (component instanceof JTextComponent)     provider=null;
    if (keyEvent.getKeyCode() == KeyEvent.VK_BACK_SPACE) {
      if (component instanceof JComponent) {
        SpeedSearchSupply searchSupply=SpeedSearchSupply.getSupply((JComponent)component);
        if (searchSupply != null)         provider=null;
      }
      String activeSpeedSearchFilter=SpeedSearchSupply.SPEED_SEARCH_CURRENT_QUERY.getData(dataContext);
      if (!StringUtil.isEmpty(activeSpeedSearchFilter)) {
        provider=null;
      }
    }
  }
  if (provider instanceof TitledHandler) {
    presentation.setText(((TitledHandler)provider).getActionTitle());
  }
  final boolean canDelete=provider != null && provider.canDeleteElement(dataContext);
  if (ActionPlaces.isPopupPlace(event.getPlace())) {
    presentation.setVisible(canDelete);
  }
 else {
    presentation.setEnabled(canDelete);
  }
}
