{
  final String newValue;
  final String value=text.getValue();
  if (range.equals(getRangeInElement(text))) {
    newValue=newContent;
  }
 else {
    final StringBuilder replacement=new StringBuilder(value);
    replacement.replace(range.getStartOffset(),range.getEndOffset(),newContent);
    newValue=replacement.toString();
  }
  if (Comparing.equal(value,newValue))   return text;
  if (newValue.length() > 0) {
    text.setValue(newValue);
  }
 else {
    text.deleteChildRange(text.getFirstChild(),text.getLastChild());
  }
  return text;
}
