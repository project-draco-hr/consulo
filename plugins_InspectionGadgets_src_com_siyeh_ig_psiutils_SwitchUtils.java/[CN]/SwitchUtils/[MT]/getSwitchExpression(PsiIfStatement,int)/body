{
  final PsiExpression condition=statement.getCondition();
  final LanguageLevel languageLevel=PsiUtil.getLanguageLevel(statement);
  final PsiExpression possibleSwitchExpression=determinePossibleSwitchExpressions(condition,languageLevel);
  if (possibleSwitchExpression == null) {
    return null;
  }
  if (SideEffectChecker.mayHaveSideEffects(possibleSwitchExpression)) {
    return null;
  }
  int branchCount=0;
  while (true) {
    branchCount++;
    final PsiExpression caseCondition=statement.getCondition();
    if (!canBeMadeIntoCase(caseCondition,possibleSwitchExpression,languageLevel)) {
      break;
    }
    final PsiStatement elseBranch=statement.getElseBranch();
    if (!(elseBranch instanceof PsiIfStatement)) {
      if (elseBranch != null) {
        branchCount++;
      }
      if (branchCount < minimumBranches) {
        return null;
      }
      return possibleSwitchExpression;
    }
    statement=(PsiIfStatement)elseBranch;
  }
  return null;
}
