{
  if (element instanceof PsiDirectory)   return ((PsiDirectory)element).getLanguageLevel();
  final PsiFile file=element.getContainingFile();
  if (file == null || file instanceof PsiCompiledElement)   return element.getManager().getEffectiveLanguageLevel();
  final LanguageLevel forcedLanguageLevel=file.getUserData(FILE_LANGUAGE_LEVEL_KEY);
  if (forcedLanguageLevel != null)   return forcedLanguageLevel;
  if (!(file instanceof PsiJavaFile)) {
    final PsiElement context=file.getContext();
    if (context != null)     return getLanguageLevel(context);
    return element.getManager().getEffectiveLanguageLevel();
  }
  return ((PsiJavaFile)file).getLanguageLevel();
}
