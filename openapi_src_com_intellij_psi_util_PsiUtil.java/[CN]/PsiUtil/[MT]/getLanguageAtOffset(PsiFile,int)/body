{
  final PsiElement elt=file.findElementAt(offset);
  if (elt == null)   return file.getLanguage();
  if (elt instanceof PsiWhiteSpace) {
    final int decremented=elt.getTextRange().getStartOffset() - 1;
    if (decremented >= 0) {
      return getLanguageAtOffset(file,decremented);
    }
  }
  return findLanguageFromElement(elt,file);
}
