{
  final PsiElement elt=file.findElementAt(offset);
  if (elt == null)   return file.getLanguage();
  if (elt instanceof PsiWhiteSpace) {
    return getLanguageAtOffset(file,elt.getTextRange().getStartOffset() - 1);
  }
  return findLanguageFromElement(elt,file);
}
