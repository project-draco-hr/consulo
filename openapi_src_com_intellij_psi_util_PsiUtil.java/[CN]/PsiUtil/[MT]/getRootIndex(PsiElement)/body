{
  ASTNode node=root.getNode();
  while (node != null && node.getTreeParent() != null) {
    node=node.getTreeParent();
  }
  if (node != null)   root=node.getPsi();
  final PsiFile containingFile=root.getContainingFile();
  final PsiFile[] psiRoots=containingFile.getPsiRoots();
  for (int i=0; i < psiRoots.length; i++) {
    if (root == psiRoots[i])     return i;
  }
  throw new RuntimeException("invalid element");
}
