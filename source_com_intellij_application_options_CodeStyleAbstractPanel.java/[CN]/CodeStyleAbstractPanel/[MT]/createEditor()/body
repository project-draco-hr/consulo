{
  EditorFactory editorFactory=EditorFactory.getInstance();
  myTextToReformat=getPreviewText();
  Document editorDocument=editorFactory.createDocument(myTextToReformat);
  EditorEx editor=(EditorEx)editorFactory.createEditor(editorDocument);
  myLastDocumentModificationStamp=editor.getDocument().getModificationStamp();
  EditorSettings editorSettings=editor.getSettings();
  editorSettings.setWhitespacesShown(true);
  editorSettings.setLineMarkerAreaShown(false);
  editorSettings.setLineNumbersShown(false);
  editorSettings.setFoldingOutlineShown(false);
  editorSettings.setAdditionalColumnsCount(0);
  editorSettings.setAdditionalLinesCount(1);
  editorSettings.setRightMargin(getRightMargin());
  EditorColorsScheme scheme=editor.getColorsScheme();
  scheme.setColor(EditorColors.CARET_ROW_COLOR,null);
  editor.setHighlighter(HighlighterFactory.createXMLHighlighter(scheme));
  return editor;
}
