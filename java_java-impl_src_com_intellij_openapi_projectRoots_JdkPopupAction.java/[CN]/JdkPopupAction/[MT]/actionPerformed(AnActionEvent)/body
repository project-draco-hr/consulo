{
  final JComponent component;
  final boolean showInMiddle;
  InputEvent inputEvent=e.getInputEvent();
  Object source=inputEvent != null ? inputEvent.getSource() : null;
  if (source instanceof JComponent) {
    component=(JComponent)source;
    showInMiddle=false;
  }
 else {
    Component c=e.getData(PlatformDataKeys.CONTEXT_COMPONENT);
    component=c instanceof JComponent ? (JComponent)c : null;
    showInMiddle=true;
  }
  if (!isEnabledInCurrentOS() || component == null)   return;
  ProgressManager.getInstance().runProcessWithProgressSynchronously(new Runnable(){
    @Override public void run(){
      final ArrayList<Pair<File,String>> jdkLocations=retrieveJDKLocations();
      if (jdkLocations.isEmpty()) {
        return;
      }
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        @Override public void run(){
          showPopupMenu(e,jdkLocations,showInMiddle,component);
        }
      }
);
    }
  }
,"Looking for JDK locations...",false,e.getProject(),component);
}
