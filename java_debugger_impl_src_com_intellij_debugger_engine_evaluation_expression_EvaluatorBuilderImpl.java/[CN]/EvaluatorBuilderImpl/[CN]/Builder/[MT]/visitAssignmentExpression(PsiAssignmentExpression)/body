{
  final PsiExpression rExpression=expression.getRExpression();
  if (rExpression == null) {
    throw new EvaluateRuntimeException(EvaluateExceptionUtil.createEvaluateException(DebuggerBundle.message("evaluation.error.invalid.expression",expression.getText())));
  }
  rExpression.accept(this);
  Evaluator rEvaluator=myResult;
  if (expression.getOperationSign().getTokenType() != JavaTokenType.EQ) {
    throw new EvaluateRuntimeException(EvaluateExceptionUtil.createEvaluateException(DebuggerBundle.message("evaluation.error.operation.not.supported",expression.getOperationSign().getText())));
  }
  final PsiExpression lExpression=expression.getLExpression();
  final PsiType lType=lExpression.getType();
  if (lType == null) {
    throw new EvaluateRuntimeException(EvaluateExceptionUtil.createEvaluateException(DebuggerBundle.message("evaluation.error.unknown.expression.type",lExpression.getText())));
  }
  if (!TypeConversionUtil.areTypesAssignmentCompatible(lType,rExpression)) {
    throw new EvaluateRuntimeException(EvaluateExceptionUtil.createEvaluateException(DebuggerBundle.message("evaluation.error.incompatible.types",expression.getOperationSign().getText())));
  }
  lExpression.accept(this);
  Evaluator lEvaluator=myResult;
  rEvaluator=handleAssignmentBoxingAndPrimitiveTypeConversions(lType,rExpression.getType(),rEvaluator);
  myResult=new AssignmentEvaluator(lEvaluator,rEvaluator);
}
