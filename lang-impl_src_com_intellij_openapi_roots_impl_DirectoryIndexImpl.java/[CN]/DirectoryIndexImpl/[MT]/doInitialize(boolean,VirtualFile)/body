{
  ProgressIndicator progress=ProgressManager.getInstance().getProgressIndicator();
  if (progress == null)   progress=new EmptyProgressIndicator();
  progress.pushState();
  progress.checkCanceled();
  progress.setText(ProjectBundle.message("project.index.scanning.files.progress"));
  if (forDir == null)   cleapAllMaps();
 else   createMapsFor(forDir);
  Module[] modules=ModuleManager.getInstance(myProject).getModules();
  if (reverseAllSets)   modules=ArrayUtil.reverseArray(modules);
  initExcludedDirMap(modules,progress);
  for (  Module module : modules) {
    initModuleContents(module,forDir,reverseAllSets,progress);
    initModuleSources(module,forDir,reverseAllSets,progress);
    initLibrarySources(module,forDir,progress);
    initLibraryClasses(module,forDir,progress);
  }
  progress.checkCanceled();
  progress.setText2("");
  for (  Module module : modules) {
    initOrderEntries(module,forDir);
  }
  progress.popState();
}
