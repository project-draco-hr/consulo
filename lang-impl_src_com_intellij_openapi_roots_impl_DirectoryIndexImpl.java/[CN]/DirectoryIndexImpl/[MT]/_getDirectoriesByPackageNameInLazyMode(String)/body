{
  ArrayList<VirtualFile> list=new ArrayList<VirtualFile>();
  Module[] modules=ModuleManager.getInstance(myProject).getModules();
  for (  Module module : modules) {
    ModuleRootManager rootManager=ModuleRootManager.getInstance(module);
    ContentEntry[] contentEntries=rootManager.getContentEntries();
    for (    ContentEntry contentEntry : contentEntries) {
      SourceFolder[] sourceFolders=contentEntry.getSourceFolders();
      for (      SourceFolder sourceFolder : sourceFolders) {
        VirtualFile sourceRoot=sourceFolder.getFile();
        if (sourceRoot != null) {
          findAndAddDirByPackageName(list,sourceRoot,packageName);
        }
      }
    }
    OrderEntry[] orderEntries=rootManager.getOrderEntries();
    for (    OrderEntry orderEntry : orderEntries) {
      if (orderEntry instanceof LibraryOrderEntry || orderEntry instanceof JdkOrderEntry) {
        VirtualFile[] libRoots=orderEntry.getFiles(OrderRootType.CLASSES);
        for (        VirtualFile libRoot : libRoots) {
          findAndAddDirByPackageName(list,libRoot,packageName);
        }
        VirtualFile[] libSourceRoots=orderEntry.getFiles(OrderRootType.SOURCES);
        for (        VirtualFile libSourceRoot : libSourceRoots) {
          findAndAddDirByPackageName(list,libSourceRoot,packageName);
        }
      }
    }
  }
  return list.toArray(new VirtualFile[list.size()]);
}
