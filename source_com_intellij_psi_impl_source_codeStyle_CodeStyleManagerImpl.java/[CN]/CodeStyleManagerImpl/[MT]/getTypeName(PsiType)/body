{
  type=type.getDeepComponentType();
  if (type instanceof PsiClassType) {
    final PsiClassType classType=(PsiClassType)type;
    final String className=classType.getClassName();
    if (className != null) {
      return className;
    }
 else {
      final PsiClass aClass=classType.resolve();
      if (aClass instanceof PsiAnonymousClass) {
        return ((PsiAnonymousClass)aClass).getBaseClassType().getClassName();
      }
 else {
        return null;
      }
    }
  }
 else {
    if (type instanceof PsiPrimitiveType) {
      return type.getPresentableText();
    }
 else     if (type instanceof PsiWildcardType) {
      return getTypeName(((PsiWildcardType)type).getExtendsBound());
    }
 else     if (type instanceof PsiIntersectionType) {
      return getTypeName(((PsiIntersectionType)type).getRepresentative());
    }
 else     if (type instanceof PsiCapturedWildcardType) {
      return getTypeName(((PsiCapturedWildcardType)type).getWildcard());
    }
 else {
      LOG.error("Unknown type:" + type);
      return null;
    }
  }
}
