{
  final ASTNode elementAtOffset=SourceTreeToPsiMap.psiElementToTree(file.findElementAt(offset));
  if (file instanceof PsiJavaFile) {
    ASTNode current=elementAtOffset;
    while (current != null && !(current.getPsi() instanceof PsiBinaryExpression || current.getPsi() instanceof PsiConditionalExpression)) {
      current=current.getTreeParent();
    }
    if (current == null) {
      return elementAtOffset.getTextRange();
    }
 else {
      return current.getTextRange();
    }
  }
 else {
    return elementAtOffset.getTextRange();
  }
}
