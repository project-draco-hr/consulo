{
  LOG.assertTrue(addedElement.getTreeParent() == parent,"addedElement must be added to parent");
  final PsiElement psiElement=parent.getPsi();
  final FormattingModelBuilder builder=psiElement.getContainingFile().getLanguage().getFormattingModelBuilder();
  if (builder != null) {
    final PsiFile containingFile=psiElement.getContainingFile();
    final FormattingModel model=builder.createModel(containingFile,getSettings());
    FormatterEx.getInstanceEx().formatAroundRange(model,getSettings(),addedElement.getTextRange(),containingFile.getFileType());
  }
  adjustLineIndent(psiElement.getContainingFile(),addedElement.getTextRange());
}
