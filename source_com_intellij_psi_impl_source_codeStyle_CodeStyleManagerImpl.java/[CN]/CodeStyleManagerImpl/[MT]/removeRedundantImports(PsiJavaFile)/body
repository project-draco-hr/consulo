{
  if (file instanceof JspFile)   return;
  final PsiImportStatementBase[] imports=file.getImportList().getAllImportStatements();
  if (imports.length == 0) {
    return;
  }
  final Set<PsiImportStatementBase> redundants=new HashSet<PsiImportStatementBase>(Arrays.asList(imports));
  final PsiElement[] roots=file.getPsiRoots();
  for (  PsiElement root : roots) {
    root.accept(new PsiRecursiveElementVisitor(){
      public void visitReferenceElement(      PsiJavaCodeReferenceElement reference){
        if (!reference.isQualified()) {
          final JavaResolveResult resolveResult=reference.advancedResolve(false);
          final PsiElement resolveScope=resolveResult.getCurrentFileResolveScope();
          if (resolveScope instanceof PsiImportStatementBase) {
            redundants.remove(resolveScope);
          }
        }
        super.visitReferenceElement(reference);
      }
    }
);
  }
  for (  final PsiImportStatementBase importStatement : redundants) {
    final PsiJavaCodeReferenceElement ref=importStatement.getImportReference();
    if (ref == null || ref.resolve() == null) {
      continue;
    }
    importStatement.delete();
  }
}
