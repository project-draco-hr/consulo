{
  if (PsiUtil.isInJspFile(file))   return;
  final PsiImportList importList=file.getImportList();
  if (importList == null)   return;
  final PsiImportStatementBase[] imports=importList.getAllImportStatements();
  if (imports.length == 0)   return;
  final Collection<PsiImportStatementBase> redundants=new THashSet<PsiImportStatementBase>(Arrays.asList(imports));
  final PsiElement[] roots=file.getPsiRoots();
  for (  PsiElement root : roots) {
    root.accept(new PsiRecursiveElementVisitor(){
      public void visitReferenceElement(      PsiJavaCodeReferenceElement reference){
        if (!reference.isQualified()) {
          final JavaResolveResult resolveResult=reference.advancedResolve(false);
          final PsiElement resolveScope=resolveResult.getCurrentFileResolveScope();
          if (resolveScope instanceof PsiImportStatementBase) {
            final PsiImportStatementBase importStatementBase=(PsiImportStatementBase)resolveScope;
            redundants.remove(importStatementBase);
          }
        }
        super.visitReferenceElement(reference);
      }
    }
);
  }
  for (  final PsiImportStatementBase importStatement : redundants) {
    final PsiJavaCodeReferenceElement ref=importStatement.getImportReference();
    if (ref == null || ref.resolve() == null) {
      continue;
    }
    importStatement.delete();
  }
}
