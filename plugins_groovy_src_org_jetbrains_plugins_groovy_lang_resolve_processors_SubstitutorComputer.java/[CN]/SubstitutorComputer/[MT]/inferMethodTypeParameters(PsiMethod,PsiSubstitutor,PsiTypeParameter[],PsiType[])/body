{
  if (typeParameters.length == 0 || myArgumentTypes == null)   return partialSubstitutor;
  final GrClosureSignature erasedSignature=GrClosureSignatureUtil.createSignatureWithErasedParameterTypes(method);
  final GrClosureSignature signature=GrClosureSignatureUtil.createSignature(method,partialSubstitutor);
  final GrClosureParameter[] params=signature.getParameters();
  final GrClosureSignatureUtil.ArgInfo<PsiType>[] argInfos=GrClosureSignatureUtil.mapArgTypesToParameters(erasedSignature,argTypes,myPlace,myAllVariants);
  if (argInfos == null)   return partialSubstitutor;
  int max=Math.max(params.length,argTypes.length);
  PsiType[] parameterTypes=new PsiType[max];
  PsiType[] argumentTypes=new PsiType[max];
  int i=0;
  for (int paramIndex=0; paramIndex < argInfos.length; paramIndex++) {
    PsiType paramType=params[paramIndex].getType();
    GrClosureSignatureUtil.ArgInfo<PsiType> argInfo=argInfos[paramIndex];
    if (argInfo != null) {
      if (argInfo.isMultiArg) {
        if (paramType instanceof PsiArrayType)         paramType=((PsiArrayType)paramType).getComponentType();
      }
      for (      PsiType type : argInfo.args) {
        argumentTypes[i]=handleConversion(paramType,type);
        parameterTypes[i]=paramType;
        i++;
      }
    }
 else {
      parameterTypes[i]=paramType;
      argumentTypes[i]=PsiType.NULL;
      i++;
    }
  }
  final PsiResolveHelper helper=JavaPsiFacade.getInstance(method.getProject()).getResolveHelper();
  PsiSubstitutor substitutor=helper.inferTypeArguments(typeParameters,parameterTypes,argumentTypes,LanguageLevel.HIGHEST);
  for (  PsiTypeParameter typeParameter : typeParameters) {
    if (!substitutor.getSubstitutionMap().containsKey(typeParameter)) {
      substitutor=inferFromContext(typeParameter,PsiUtil.getSmartReturnType(method),substitutor,helper);
      if (!substitutor.getSubstitutionMap().containsKey(typeParameter)) {
        substitutor=substitutor.put(typeParameter,null);
      }
    }
  }
  return partialSubstitutor.putAll(substitutor);
}
