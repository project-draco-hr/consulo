{
  final Module module=configurationModule.getModule();
  if (module == null)   throw CantRunException.noModuleConfigured(configurationModule.getModuleName());
  final PsiClass psiClass=ExecutionUtil.findMainClass(module,mainClassName);
  if (psiClass == null) {
    if (!classMustHaveSource)     return JavaParameters.JDK_AND_CLASSES_AND_TESTS;
    throw CantRunException.classNotFound(mainClassName,module);
  }
  final PsiFile psiFile=psiClass.getContainingFile();
  if (psiFile == null)   throw CantRunException.classNotFound(mainClassName,module);
  final VirtualFile virtualFile=psiFile.getVirtualFile();
  if (virtualFile == null)   throw CantRunException.classNotFound(mainClassName,module);
  Module classModule=new JUnitUtil.ModuleOfClass().convert(psiClass);
  if (classModule == null)   classModule=module;
  return ModuleRootManager.getInstance(classModule).getFileIndex().isInTestSourceContent(virtualFile) ? JavaParameters.JDK_AND_CLASSES_AND_TESTS : JavaParameters.JDK_AND_CLASSES;
}
