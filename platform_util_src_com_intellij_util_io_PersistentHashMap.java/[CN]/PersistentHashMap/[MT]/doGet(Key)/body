{
  myEnumerator.lockStorage();
  try {
    myAppendCache.remove(key);
    final int id=tryEnumerate(key);
    if (id == PersistentEnumerator.NULL_ID) {
      return null;
    }
    final long oldHeader=readValueId(id);
    if (oldHeader == PersistentEnumerator.NULL_ID) {
      return null;
    }
    PersistentHashMapValueStorage.ReadResult readResult=myValueStorage.readBytes(oldHeader);
    if (readResult.offset != oldHeader) {
      myEnumerator.markDirty(true);
      updateValueId(id,readResult.offset,oldHeader,key,0);
      myLiveAndGarbageKeysCounter++;
      myReadCompactionGarbageSize+=readResult.buffer.length;
    }
    final DataInputStream input=new DataInputStream(new UnsyncByteArrayInputStream(readResult.buffer));
    try {
      return myValueExternalizer.read(input);
    }
  finally {
      input.close();
    }
  }
  finally {
    myEnumerator.unlockStorage();
  }
}
