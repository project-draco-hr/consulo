{
  final URL url=getClass().getClassLoader().getResource("com/intellij/execution/EnvPassingTest.class");
  assertNotNull(url);
  final File testClass=new File(url.getFile());
  final String javaHome=System.getenv("JAVA_HOME");
  final GeneralCommandLine commandLine=new GeneralCommandLine();
  commandLine.setExePath(javaHome != null ? javaHome + "/bin/java" : "java");
  commandLine.addParameter("-cp");
  commandLine.addParameter(testClass.getParentFile().getParentFile().getParentFile().getParentFile().getAbsolutePath());
  commandLine.addParameter("com.intellij.execution." + testClass.getName().replace(".class",""));
  commandLine.setRedirectErrorStream(true);
  final Map<String,String> testEnv=new HashMap<String,String>();
  testEnv.put("VALUE_1","some value");
  testEnv.put("VALUE_2","another\n\"value\"");
  checkEnvPassing(commandLine,testEnv,true);
  checkEnvPassing(commandLine,testEnv,false);
}
