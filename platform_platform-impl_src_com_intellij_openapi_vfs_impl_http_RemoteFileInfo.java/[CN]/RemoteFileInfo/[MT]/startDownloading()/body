{
  LOG.debug("Downloading requested");
  File localFile;
  FileDownloadingListener[] listeners;
synchronized (myLock) {
    if (myState != RemoteFileState.DOWNLOADING_NOT_STARTED) {
      LOG.debug("File already downloaded: file = " + myLocalVirtualFile + ", state = "+ myState);
      return;
    }
    myState=RemoteFileState.DOWNLOADING_IN_PROGRESS;
    try {
      myLocalFile=myManager.getStorage().createLocalFile(myUrl);
      LOG.debug("Local file created: " + myLocalFile.getAbsolutePath());
    }
 catch (    IOException e) {
      LOG.info(e);
      errorOccurred(VfsBundle.message("cannot.create.local.file",e.getMessage()),false);
      return;
    }
    myCancelled.set(false);
    localFile=myLocalFile;
    listeners=myListeners.toArray(new FileDownloadingListener[myListeners.size()]);
  }
  for (  FileDownloadingListener listener : listeners) {
    listener.downloadingStarted();
  }
  if (myContentProvider == null) {
    myContentProvider=HttpFileSystemImpl.getInstanceImpl().findContentProvider(myUrl);
  }
  myContentProvider.saveContent(myUrl,localFile,this);
}
