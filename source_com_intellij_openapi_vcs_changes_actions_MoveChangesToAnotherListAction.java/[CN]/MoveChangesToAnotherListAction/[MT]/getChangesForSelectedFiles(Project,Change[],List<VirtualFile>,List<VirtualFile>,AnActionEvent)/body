{
  if (ProjectLevelVcsManager.getInstance(project).getAllActiveVcss().length == 0) {
    return null;
  }
  VirtualFile[] virtualFiles=e.getData(DataKeys.VIRTUAL_FILE_ARRAY);
  if (virtualFiles != null) {
    List<Change> changesInFiles=new ArrayList<Change>();
    for (    VirtualFile vFile : virtualFiles) {
      Change change=ChangeListManager.getInstance(project).getChange(vFile);
      if (change == null)       continue;
      if (change.getFileStatus().equals(FileStatus.UNKNOWN)) {
        unversionedFiles.add(vFile);
        if (changedFiles != null)         changedFiles.add(vFile);
      }
 else {
        changesInFiles.add(change);
        if (changedFiles != null)         changedFiles.add(vFile);
      }
    }
    if (changesInFiles.size() > 0 || unversionedFiles.size() > 0) {
      changes=changesInFiles.toArray(new Change[changesInFiles.size()]);
    }
  }
  return changes;
}
