{
  Project project=e.getData(DataKeys.PROJECT);
  Change[] changes=e.getData(DataKeys.CHANGES);
  List<VirtualFile> unversionedFiles=e.getData(ChangesListView.UNVERSIONED_FILES_DATA_KEY);
  if (project != null && changes == null && unversionedFiles == null) {
    unversionedFiles=new ArrayList<VirtualFile>();
    changes=getChangesForSelectedFiles(project,changes,unversionedFiles,null,e);
  }
  final boolean isEnabled=project != null && (changes != null && changes.length > 0) || (unversionedFiles != null && unversionedFiles.size() > 0);
  if (ActionPlaces.isPopupPlace(e.getPlace())) {
    e.getPresentation().setVisible(isEnabled);
  }
 else {
    e.getPresentation().setEnabled(isEnabled);
  }
}
