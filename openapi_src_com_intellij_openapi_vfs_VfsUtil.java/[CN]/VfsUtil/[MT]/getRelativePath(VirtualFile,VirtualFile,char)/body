{
  if (!file.getFileSystem().equals(ancestor.getFileSystem()))   return null;
  int length=0;
  VirtualFile parent=file;
  while (true) {
    if (parent == null)     return null;
    if (parent.equals(ancestor))     break;
    if (length > 0) {
      length++;
    }
    length+=parent.getName().length();
    parent=parent.getParent();
  }
  char[] chars=new char[length];
  int index=chars.length;
  parent=file;
  while (true) {
    if (parent.equals(ancestor))     break;
    if (index < length) {
      chars[--index]=separator;
    }
    String name=parent.getName();
    for (int i=name.length() - 1; i >= 0; i--) {
      chars[--index]=name.charAt(i);
    }
    parent=parent.getParent();
  }
  return new String(chars);
}
