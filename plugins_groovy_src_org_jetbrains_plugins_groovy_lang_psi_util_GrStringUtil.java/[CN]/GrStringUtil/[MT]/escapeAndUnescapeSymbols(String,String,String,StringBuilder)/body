{
  boolean escaped=false;
  for (int i=0; i < s.length(); i++) {
    final char ch=s.charAt(i);
    if (escaped) {
      if (toUnescape.indexOf(ch) < 0) {
        builder.append('\\');
        builder.append(ch);
      }
 else {
        if (ch == 'n')         builder.append('\n');
 else         if (ch == 'b')         builder.append('\b');
 else         if (ch == 't')         builder.append('\t');
 else         if (ch == 'f')         builder.append('\r');
 else         builder.append(ch);
      }
      escaped=false;
      continue;
    }
    if (ch == '\\') {
      escaped=true;
      continue;
    }
    if (toEscape.indexOf(ch) >= 0) {
      builder.append('\\');
    }
    if (ch == '\n' && toEscape.indexOf('n') >= 0) {
      builder.append("\\n");
    }
 else {
      builder.append(ch);
    }
  }
  return builder.toString();
}
