{
  boolean escaped=false;
  for (int i=0; i < s.length(); i++) {
    final char ch=s.charAt(i);
    if (escaped) {
      if (toUnescape.indexOf(ch) < 0) {
        builder.append('\\');
      }
      builder.append(ch);
      escaped=false;
      continue;
    }
    if (ch == '\\') {
      escaped=true;
      continue;
    }
    if (toEscape.indexOf(ch) >= 0) {
      builder.append('\\');
    }
    builder.append(ch);
  }
  return builder.toString();
}
