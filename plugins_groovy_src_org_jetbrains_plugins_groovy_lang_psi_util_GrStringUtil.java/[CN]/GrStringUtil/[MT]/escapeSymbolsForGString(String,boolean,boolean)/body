{
  StringBuilder b=new StringBuilder();
  escapeStringCharacters(s.length(),s,escapeDoubleQuotes ? "$\"" : "$",forInjection,true,b);
  if (!forInjection) {
    unescapeCharacters(b,escapeDoubleQuotes ? "'" : "'\"",true);
  }
  return b.toString();
}
