{
  return new ProjectRootsTraversing.RootTraversePolicy.Visit<T>(){
    public void visit(    T entry,    ProjectRootsTraversing.TraverseState state,    RootPolicy<ProjectRootsTraversing.TraverseState> policy){
      Module ownerModule=entry.getOwnerModule();
      if (ignoredDependencyModules && originalModule != ownerModule && manager.findProject(ownerModule) != null)       return;
      if (originalModule != ownerModule && entry instanceof ModuleSourceOrderEntry) {
        MavenProject project=manager.findProject(originalModule);
        MavenProject depProject=manager.findProject(ownerModule);
        if (project == null || depProject == null) {
          original.visit(entry,state,policy);
          return;
        }
        for (        MavenArtifact each : project.findDependencies(depProject)) {
          if (MavenConstants.SCOPE_PROVIDEED.equals(each.getScope()))           continue;
          if (original == ProjectClasspathTraversing.ALL_OUTPUTS || !MavenConstants.SCOPE_TEST.equals(each.getScope())) {
            addOutput(ownerModule,MavenConstants.TYPE_TEST_JAR.equals(each.getType()),state);
          }
        }
      }
 else {
        if (entry instanceof ExportableOrderEntry && ((ExportableOrderEntry)entry).getScope() == DependencyScope.PROVIDED)         return;
        original.visit(entry,state,policy);
      }
    }
  }
;
}
