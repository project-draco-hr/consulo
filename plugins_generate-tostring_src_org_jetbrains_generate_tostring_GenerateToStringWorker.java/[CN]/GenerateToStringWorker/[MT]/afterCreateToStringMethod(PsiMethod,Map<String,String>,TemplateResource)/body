{
  PsiFile containingFile=clazz.getContainingFile();
  if (containingFile instanceof PsiJavaFile) {
    final PsiJavaFile javaFile=(PsiJavaFile)containingFile;
    String javaCode=method.getText();
    if (javaCode.indexOf("Arrays.") > 0 && !(PsiAdapter.hasImportStatement(javaFile,"java.util.*") || PsiAdapter.hasImportStatement(javaFile,"java.util.Arrays"))) {
      PsiAdapter.addImportStatement(javaFile,"java.util.*");
    }
    if (javaCode.indexOf("Field[]") > 0 && !(PsiAdapter.hasImportStatement(javaFile,"java.lang.reflect.*") || PsiAdapter.hasImportStatement(javaFile,"java.lang.reflect.Field"))) {
      PsiAdapter.addImportStatement(javaFile,"java.lang.reflect.*");
    }
    if (params.get("autoImportPackages") != null) {
      autoImportPackages(javaFile,params.get("autoImportPackages"));
    }
  }
  codeStyleManager.reformat(method);
  if (config.isJumpToMethod() && editor != null) {
    PsiMethod newMethod=PsiAdapter.findMethodByName(clazz,template.getTargetMethodName());
    if (newMethod != null) {
      int offset=newMethod.getTextOffset();
      if (offset > 2) {
        VisualPosition vp=editor.offsetToVisualPosition(offset);
        if (logger.isDebugEnabled())         logger.debug("Moving/Scrolling caret to " + vp + " (offset="+ offset+ ")");
        editor.getCaretModel().moveToVisualPosition(vp);
        editor.getScrollingModel().scrollToCaret(ScrollType.CENTER_DOWN);
      }
    }
  }
}
