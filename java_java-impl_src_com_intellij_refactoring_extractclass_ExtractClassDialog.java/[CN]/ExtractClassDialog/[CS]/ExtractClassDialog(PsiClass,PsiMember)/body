{
  super(sourceClass.getProject(),true);
  setModal(true);
  setTitle(RefactorJBundle.message("extract.class.title"));
  myVisibilityPanel=new JavaVisibilityPanel(true,true);
  myVisibilityPanel.setVisibility(null);
  this.sourceClass=sourceClass;
  final DocumentListener docListener=new DocumentAdapter(){
    protected void textChanged(    final DocumentEvent e){
      validateButtons();
    }
  }
;
  classNameField=new JTextField();
  final PsiFile file=sourceClass.getContainingFile();
  final String text=file instanceof PsiJavaFile ? ((PsiJavaFile)file).getPackageName() : "";
  packageTextField=new PackageNameReferenceEditorCombo(text,myProject,"ExtractClass.RECENTS_KEY",RefactorJBundle.message("choose.destination.package.label"));
  packageTextField.getChildComponent().getDocument().addDocumentListener(new com.intellij.openapi.editor.event.DocumentAdapter(){
    @Override public void documentChanged(    com.intellij.openapi.editor.event.DocumentEvent e){
      validateButtons();
    }
  }
);
  myDestinationFolderComboBox=new DestinationFolderComboBox(){
    @Override public String getTargetPackage(){
      return getPackageName();
    }
  }
;
  myDestinationFolderComboBox.setData(myProject,sourceClass.getContainingFile().getContainingDirectory(),packageTextField.getChildComponent());
  classNameField.getDocument().addDocumentListener(docListener);
  final MemberInfo.Filter<PsiMember> filter=new MemberInfo.Filter<PsiMember>(){
    public boolean includeMember(    PsiMember element){
      if (element instanceof PsiMethod) {
        return !((PsiMethod)element).isConstructor() && ((PsiMethod)element).getBody() != null;
      }
 else       if (element instanceof PsiField) {
        return true;
      }
 else       if (element instanceof PsiClass) {
        return PsiTreeUtil.isAncestor(ExtractClassDialog.this.sourceClass,element,true);
      }
      return false;
    }
  }
;
  memberInfo=MemberInfo.extractClassMembers(this.sourceClass,filter,false);
  extractAsEnum=new JCheckBox("Extract as enum");
  boolean hasConstants=false;
  for (  MemberInfo info : memberInfo) {
    final PsiMember member=info.getMember();
    if (member.equals(selectedMember)) {
      info.setChecked(true);
    }
    if (!hasConstants && member instanceof PsiField && member.hasModifierProperty(PsiModifier.FINAL)&& member.hasModifierProperty(PsiModifier.STATIC)) {
      hasConstants=true;
    }
  }
  if (!hasConstants) {
    extractAsEnum.setVisible(false);
  }
  super.init();
  validateButtons();
}
