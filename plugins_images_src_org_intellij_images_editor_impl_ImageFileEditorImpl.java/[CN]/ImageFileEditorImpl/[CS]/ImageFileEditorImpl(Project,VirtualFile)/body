{
  ImageEditorManager imageEditorManager=getImageEditorManager();
  imageEditor=imageEditorManager.createImageEditor(project,file);
  BufferedImage image=imageEditor.getDocument().getValue();
  VirtualFileManager.getInstance().addVirtualFileListener(imageEditor);
  Options options=OptionsManager.getInstance().getOptions();
  EditorOptions editorOptions=options.getEditorOptions();
  ImageZoomModel zoomModel=imageEditor.getZoomModel();
  GridOptions gridOptions=editorOptions.getGridOptions();
  TransparencyChessboardOptions transparencyChessboardOptions=editorOptions.getTransparencyChessboardOptions();
  imageEditor.setGridVisible(gridOptions.isShowDefault());
  imageEditor.setTransparencyChessboardVisible(transparencyChessboardOptions.isShowDefault());
  ZoomOptions zoomOptions=editorOptions.getZoomOptions();
  if (zoomOptions.isSmartZooming()) {
    Dimension prefferedSize=zoomOptions.getPrefferedSize();
    if (prefferedSize.width > image.getWidth() && prefferedSize.height > image.getHeight()) {
      double factor=(prefferedSize.getWidth() / (double)image.getWidth() + prefferedSize.getHeight() / (double)image.getHeight()) / 2.0d;
      zoomModel.setZoomFactor(Math.ceil(factor));
    }
  }
 else {
    zoomModel.setZoomFactor(1.0d);
  }
}
