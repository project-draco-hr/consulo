{
  XDebugSession session=getSession(getPanel());
  XStackFrame stackFrame=session == null ? null : session.getCurrentStackFrame();
  XDebuggerTree tree=getTree();
  if (event == SessionEvent.BEFORE_RESUME || event == SessionEvent.SETTINGS_CHANGED) {
    saveCurrentTreeState(stackFrame);
    if (event == SessionEvent.BEFORE_RESUME) {
      return;
    }
  }
  tree.markNodesObsolete();
  if (stackFrame != null) {
    cancelClear();
    buildTreeAndRestoreState(stackFrame);
  }
 else {
    requestClear();
  }
}
