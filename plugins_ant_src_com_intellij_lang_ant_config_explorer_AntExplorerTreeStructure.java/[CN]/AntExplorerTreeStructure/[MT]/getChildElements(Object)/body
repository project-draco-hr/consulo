{
  final AntConfiguration configuration=AntConfiguration.getInstance(myProject);
  if (element == myRoot) {
    if (!configuration.isInitialized()) {
      return new Object[]{AntBundle.message("loading.ant.config.progress")};
    }
    final AntBuildFile[] buildFiles=configuration.getBuildFiles();
    return (buildFiles.length != 0) ? buildFiles : new Object[]{AntBundle.message("ant.tree.structure.no.build.files.message")};
  }
  if (element instanceof AntBuildFile) {
    final AntBuildFile buildFile=(AntBuildFile)element;
    final AntBuildModel model=buildFile.getModel();
    final List<AntBuildTarget> targets=new ArrayList<AntBuildTarget>(Arrays.asList(myFilteredTargets ? model.getFilteredTargets() : model.getTargets()));
    Collections.sort(targets,ourTargetComparator);
    final List<AntBuildTarget> metaTargets=Arrays.asList(configuration.getMetaTargets(buildFile));
    Collections.sort(metaTargets,ourTargetComparator);
    targets.addAll(metaTargets);
    return targets.toArray(new AntBuildTargetBase[targets.size()]);
  }
  if (element instanceof AntBuildTarget) {
    return ArrayUtil.EMPTY_OBJECT_ARRAY;
  }
  return ArrayUtil.EMPTY_OBJECT_ARRAY;
}
