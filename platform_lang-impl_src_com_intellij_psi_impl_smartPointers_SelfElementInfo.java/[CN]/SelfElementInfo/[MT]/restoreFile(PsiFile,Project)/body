{
  if (file == null)   return null;
  if (file.isValid())   return file;
  VirtualFile virtualFile=file.getVirtualFile();
  if (virtualFile == null)   return null;
  VirtualFile vParent=virtualFile.getParent();
  if (vParent == null || !vParent.isDirectory())   return null;
  String name=file.getName();
  VirtualFile child=vParent.findChild(name);
  if (child == null)   return null;
  file=PsiManager.getInstance(project).findFile(child);
  if (file == null || !file.isValid())   return null;
  return file;
}
