{
  if (!mySyncMarkerIsValid)   return null;
  PsiFile file=restoreFileFromVirtual(myVirtualFile,myProject);
  if (file == null || !file.isValid())   return null;
  final int syncStartOffset=getSyncStartOffset();
  final int syncEndOffset=getSyncEndOffset();
  PsiElement anchor=file.getViewProvider().findElementAt(syncStartOffset,file.getLanguage());
  if (anchor == null)   return null;
  TextRange range=anchor.getTextRange();
  if (range.getStartOffset() != syncStartOffset)   return null;
  while (range.getEndOffset() < syncEndOffset) {
    anchor=anchor.getParent();
    if (anchor == null || anchor.getTextRange() == null)     break;
    range=anchor.getTextRange();
  }
  while (range.getEndOffset() == syncEndOffset && anchor != null && !myType.equals(anchor.getClass())) {
    anchor=anchor.getParent();
    if (anchor == null || anchor.getTextRange() == null)     break;
    range=anchor.getTextRange();
  }
  if (range.getEndOffset() == syncEndOffset)   return anchor;
  return null;
}
