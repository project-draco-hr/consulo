{
  LOG.assertTrue(anchor.isPhysical());
  myFile=anchor.getContainingFile();
  TextRange range=anchor.getTextRange();
  LOG.assertTrue(range != null,anchor);
  myProject=myFile.getProject();
  final PsiDocumentManager documentManager=PsiDocumentManager.getInstance(myProject);
  Document document=documentManager.getDocument(myFile);
  LOG.assertTrue(document != null,myFile.getName());
  if (documentManager.isUncommited(document)) {
    mySyncMarkerIsValid=false;
    myMarker=document.createRangeMarker(0,0,false);
  }
 else {
    myMarker=document.createRangeMarker(range.getStartOffset(),range.getEndOffset(),true);
    range=getPersistentAnchorRange(anchor,document);
    mySyncStartOffset=range.getStartOffset();
    mySyncEndOffset=range.getEndOffset();
    mySyncMarkerIsValid=true;
    myType=anchor.getClass();
  }
}
