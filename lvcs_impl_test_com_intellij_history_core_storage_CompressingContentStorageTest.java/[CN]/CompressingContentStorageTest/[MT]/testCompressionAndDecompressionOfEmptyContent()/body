{
  final byte[][] compressed=new byte[1][];
  IContentStorage mock=createMock(IContentStorage.class);
  expect(mock.store((byte[])anyObject())).andAnswer(new IAnswer<Integer>(){
    public Integer answer() throws Throwable {
      compressed[0]=(byte[])getCurrentArguments()[0];
      return 1;
    }
  }
);
  expect(mock.load(anyInt())).andAnswer(new IAnswer<byte[]>(){
    public byte[] answer() throws Throwable {
      return compressed[0];
    }
  }
);
  replay(mock);
  CompressingContentStorage s=new CompressingContentStorage(mock);
  s.store(new byte[0]);
  assertArrayEquals(new byte[0],s.load(1));
}
