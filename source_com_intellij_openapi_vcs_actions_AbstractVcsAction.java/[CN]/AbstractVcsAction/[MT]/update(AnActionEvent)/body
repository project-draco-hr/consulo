{
  if (requiresEventDispatchThreadUpdate()) {
    beforeActionPerformedUpdate(e);
  }
 else {
    final VcsContext context=VcsContextWrapper.createCachedInstanceOn(e);
    final Presentation originalPresentation=e.getPresentation();
    final Presentation presentation=(Presentation)originalPresentation.clone();
    ourAsyncUpdateExecutor.submit(new Runnable(){
      public void run(){
        ApplicationManager.getApplication().runReadAction(new Runnable(){
          public void run(){
            update(context,presentation);
            SwingUtilities.invokeLater(new Runnable(){
              public void run(){
                originalPresentation.copyFrom(presentation);
              }
            }
);
          }
        }
);
      }
    }
);
    presentation.setVisible(true);
    presentation.setEnabled(false);
  }
}
