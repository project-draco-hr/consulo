{
  if (isKeepTreeElementByHardReference()) {
    return treeElement;
  }
  return myManager.isBatchFilesProcessingMode() ? new PatchedWeakReference<ASTNode>(treeElement) : new PatchedSoftReference<ASTNode>(treeElement);
}
