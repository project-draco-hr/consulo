{
  FileViewProvider viewProvider=getViewProvider();
  FileViewProvider providerCopy=viewProvider.clone();
  final Language language=getLanguage();
  if (providerCopy == null) {
    throw new AssertionError("Unable to clone the view provider: " + viewProvider + "; "+ language);
  }
  PsiFileImpl clone=BlockSupportImpl.getFileCopy(this,providerCopy);
  if (clone == null) {
    throw new AssertionError("Cannot find psi file with: " + language + "."+ " Original viewprovider: "+ viewProvider+ "; languages: "+ viewProvider.getLanguages()+ "; copied viewprovider: "+ providerCopy+ "; languages: "+ providerCopy.getLanguages()+ "; Original virtual file: "+ getVirtualFile()+ "; copied virtual file: "+ providerCopy.getVirtualFile()+ "; its.getOriginal(): "+ (providerCopy.getVirtualFile() instanceof LightVirtualFile ? ((LightVirtualFile)providerCopy.getVirtualFile()).getOriginalFile() : null));
  }
  copyCopyableDataTo(clone);
  if (getTreeElement() != null) {
    final FileElement treeClone=(FileElement)calcTreeElement().clone();
    clone.myTreeElementPointer=treeClone;
    treeClone.setPsi(clone);
  }
  if (viewProvider.isEventSystemEnabled()) {
    clone.myOriginalFile=this;
  }
 else   if (myOriginalFile != null) {
    clone.myOriginalFile=myOriginalFile;
  }
  return clone;
}
