{
  final Project project=DataKeys.PROJECT.getData(e.getDataContext());
  final DebuggerContextImpl debuggerContext=getDebuggerContext(e.getDataContext());
  final DebuggerTreeNodeImpl node=getSelectedNode(e.getDataContext());
  final Presentation presentation=e.getPresentation();
  presentation.setEnabled(true);
  DebuggerInvocationUtil.invokeLater(project,new Runnable(){
    public void run(){
      presentation.setEnabled(false);
    }
  }
);
  if (debuggerContext != null && debuggerContext.getDebugProcess() != null) {
    debuggerContext.getDebugProcess().getManagerThread().invokeLater(new DebuggerContextCommandImpl(debuggerContext){
      public void threadAction(){
        final SourcePosition position=getSourcePosition(node,debuggerContext);
        if (position != null) {
          DebuggerInvocationUtil.invokeLater(project,new Runnable(){
            public void run(){
              presentation.setEnabled(true);
            }
          }
);
        }
      }
    }
);
  }
  e.getPresentation().setText(ActionManager.getInstance().getAction(IdeActions.ACTION_EDIT_SOURCE).getTemplatePresentation().getText());
}
