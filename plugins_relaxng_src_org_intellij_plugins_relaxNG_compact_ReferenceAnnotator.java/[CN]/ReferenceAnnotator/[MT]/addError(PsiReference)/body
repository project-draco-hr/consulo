{
  final TextRange rangeInElement=reference.getRangeInElement();
  final TextRange range=TextRange.from(reference.getElement().getTextRange().getStartOffset() + rangeInElement.getStartOffset(),rangeInElement.getLength());
  final Annotation annotation;
  if (reference instanceof EmptyResolveMessageProvider) {
    final String s=((EmptyResolveMessageProvider)reference).getUnresolvedMessagePattern();
    annotation=myHolder.createErrorAnnotation(range,MessageFormat.format(s,reference.getCanonicalText()));
  }
 else {
    annotation=myHolder.createErrorAnnotation(range,"Cannot resolve symbol");
  }
  annotation.setHighlightType(ProblemHighlightType.LIKE_UNKNOWN_SYMBOL);
  if (reference instanceof QuickFixProvider) {
    HighlightInfo info=HighlightInfo.newHighlightInfo(HighlightInfoType.WRONG_REF).range(annotation.getStartOffset(),annotation.getEndOffset()).create();
    ((QuickFixProvider)reference).registerQuickfix(info,reference);
    List<Pair<HighlightInfo.IntentionActionDescriptor,TextRange>> ranges=info.quickFixActionRanges;
    if (ranges != null) {
      for (      Pair<HighlightInfo.IntentionActionDescriptor,TextRange> pair : ranges) {
        annotation.registerFix(pair.first.getAction(),pair.second);
      }
    }
  }
}
