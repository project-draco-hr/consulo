{
  if (t instanceof PluginException) {
    return ((PluginException)t).getPluginId();
  }
  StackTraceElement[] elements=t.getStackTrace();
  for (  StackTraceElement element : elements) {
    String className=element.getClassName();
    if (PluginManager.isPluginClass(className)) {
      return PluginManager.getPluginByClassName(className);
    }
  }
  if (t instanceof NoSuchMethodException) {
    if (t.getMessage() != null) {
      String className="";
      StringTokenizer tok=new StringTokenizer(t.getMessage(),".");
      while (tok.hasMoreTokens()) {
        String token=tok.nextToken();
        if (token.length() > 0 && Character.isJavaIdentifierStart(token.charAt(0))) {
          className+=token;
        }
      }
      if (PluginManager.isPluginClass(className)) {
        return PluginManager.getPluginByClassName(className);
      }
    }
  }
 else   if (t instanceof ClassNotFoundException) {
    if (t.getMessage() != null) {
      String className=t.getMessage();
      if (PluginManager.isPluginClass(className)) {
        return PluginManager.getPluginByClassName(className);
      }
    }
  }
 else   if (t instanceof AbstractMethodError && t.getMessage() != null) {
    String s=t.getMessage();
    int pos=s.indexOf('(');
    if (pos >= 0) {
      s=s.substring(0,pos);
      pos=s.lastIndexOf('.');
      if (pos >= 0) {
        s=s.substring(0,pos);
        if (PluginManager.isPluginClass(s)) {
          return PluginManager.getPluginByClassName(s);
        }
      }
    }
  }
  return null;
}
