{
  PsiClass aClass=field.getContainingClass();
  PsiMethod[] constructors=aClass.getConstructors();
  PsiStatement assignment=createAssignment(local,field.getName(),factory);
  boolean added=false;
  for (  PsiMethod constructor : constructors) {
    if (constructor == enclosingConstructor)     continue;
    PsiCodeBlock body=constructor.getBody();
    if (body == null)     continue;
    PsiStatement[] statements=body.getStatements();
    if (statements.length > 0) {
      PsiStatement first=statements[0];
      if (first instanceof PsiExpressionStatement) {
        PsiExpression expression=((PsiExpressionStatement)first).getExpression();
        if (expression instanceof PsiMethodCallExpression) {
          @NonNls String text=((PsiMethodCallExpression)expression).getMethodExpression().getText();
          if ("this".equals(text)) {
            continue;
          }
          if ("super".equals(text) && enclosingConstructor == null && PsiTreeUtil.isAncestor(constructor,local,false)) {
            local.delete();
            return (PsiStatement)body.addAfter(assignment,first);
          }
        }
      }
      if (enclosingConstructor == null && PsiTreeUtil.isAncestor(constructor,local,false)) {
        local.delete();
        return (PsiStatement)body.addBefore(assignment,first);
      }
    }
    assignment=(PsiStatement)body.add(assignment);
    added=true;
  }
  if (!added && enclosingConstructor == null) {
    if (aClass instanceof PsiAnonymousClass) {
      final PsiClassInitializer classInitializer=(PsiClassInitializer)aClass.addAfter(factory.createClassInitializer(),field);
      assignment=(PsiStatement)classInitializer.getBody().add(assignment);
    }
 else {
      PsiMethod constructor=(PsiMethod)aClass.add(factory.createConstructor());
      assignment=(PsiStatement)constructor.getBody().add(assignment);
    }
  }
  if (enclosingConstructor == null)   local.delete();
  return assignment;
}
