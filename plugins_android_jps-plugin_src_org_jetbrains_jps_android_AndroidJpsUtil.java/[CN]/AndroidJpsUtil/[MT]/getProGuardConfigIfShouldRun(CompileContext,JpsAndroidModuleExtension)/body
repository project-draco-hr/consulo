{
  if (extension.isRunProguard()) {
    return new ProGuardOptions(extension.getProguardConfigFile(),extension.isIncludeSystemProguardCfgFile());
  }
  final String cfgPathFromContext=context.getBuilderParameter(AndroidCommonUtils.PROGUARD_CFG_PATH_OPTION);
  if (cfgPathFromContext != null) {
    final String includeSystemProGuardFile=context.getBuilderParameter(AndroidCommonUtils.INCLUDE_SYSTEM_PROGUARD_FILE_OPTION);
    return new ProGuardOptions(new File(cfgPathFromContext),Boolean.parseBoolean(includeSystemProGuardFile));
  }
  for (  JpsArtifact artifact : getAndroidArtifactsToBuild(context)) {
    final JpsElement props=artifact.getProperties();
    if (props instanceof JpsAndroidApplicationArtifactProperties) {
      final JpsAndroidApplicationArtifactProperties androidProps=(JpsAndroidApplicationArtifactProperties)props;
      if (androidProps.isRunProGuard()) {
        final String cfgFileUrl=androidProps.getProGuardCfgFileUrl();
        final String cfgPath=cfgFileUrl != null ? JpsPathUtil.urlToPath(cfgFileUrl) : null;
        return new ProGuardOptions(new File(cfgPath),androidProps.isIncludeSystemProGuardCfgFile());
      }
    }
  }
  return null;
}
