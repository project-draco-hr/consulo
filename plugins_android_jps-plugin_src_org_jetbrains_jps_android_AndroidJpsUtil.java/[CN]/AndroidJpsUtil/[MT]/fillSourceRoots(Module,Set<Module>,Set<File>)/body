{
  visited.add(module);
  final AndroidFacet facet=getFacet(module);
  File resDir=null;
  File resDirForCompilation=null;
  if (facet != null) {
    resDir=facet.getResourceDir();
    resDirForCompilation=facet.getResourceDirForCompilation();
  }
  for (  String sourceRootPath : module.getSourceRoots()) {
    final File sourceRoot=new File(sourceRootPath).getCanonicalFile();
    if (!sourceRoot.equals(resDir) && !sourceRoot.equals(resDirForCompilation)) {
      result.add(sourceRoot);
    }
  }
  if (facet != null && facet.isPackTestCode()) {
    for (    String testRootPath : module.getTestRoots()) {
      final File testRoot=new File(testRootPath).getCanonicalFile();
      if (!testRoot.equals(resDir) && !testRoot.equals(resDirForCompilation)) {
        result.add(testRoot);
      }
    }
  }
  for (  ClasspathItem classpathItem : module.getClasspath(ClasspathKind.PRODUCTION_RUNTIME)) {
    if (classpathItem instanceof Module) {
      final Module depModule=(Module)classpathItem;
      if (!visited.contains(depModule)) {
        fillSourceRoots(depModule,visited,result);
      }
    }
  }
}
