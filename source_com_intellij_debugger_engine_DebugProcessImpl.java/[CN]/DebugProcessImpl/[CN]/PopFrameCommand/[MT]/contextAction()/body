{
  final ThreadReferenceProxyImpl thread=myStackFrame.threadProxy();
  if (!getSuspendManager().isSuspended(thread)) {
    notifyCancelled();
    return;
  }
  final SuspendContextImpl suspendContext=getSuspendContext();
  if (!suspendContext.suspends(thread)) {
    SuspendManagerUtil.postponeCommand(suspendContext,this);
    return;
  }
  if (myStackFrame.isBottom()) {
    DebuggerInvocationUtil.invokeLater(myProject,new Runnable(){
      public void run(){
        Messages.showMessageDialog(myProject,DebuggerBundle.message("error.pop.bottom.stackframe"),ActionsBundle.actionText(DebuggerActions.POP_FRAME),Messages.getErrorIcon());
      }
    }
);
    return;
  }
  try {
    thread.popFrames(myStackFrame);
  }
 catch (  EvaluateException e) {
    LOG.error(e);
  }
  getSuspendManager().popFrame(suspendContext);
}
