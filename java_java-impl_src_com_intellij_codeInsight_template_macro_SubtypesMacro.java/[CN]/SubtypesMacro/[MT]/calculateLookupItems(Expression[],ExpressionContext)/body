{
  if (params.length == 0)   return LookupItem.EMPTY_ARRAY;
  Result paramResult=params[0].calculateQuickResult(context);
  if (paramResult instanceof PsiTypeResult) {
    final PsiType type=((PsiTypeResult)paramResult).getType();
    Set<PsiType> types=new HashSet<PsiType>();
    types.add(type);
    final PsiFile file=PsiDocumentManager.getInstance(context.getProject()).getPsiFile(context.getEditor().getDocument());
    final PsiElement element=file.findElementAt(context.getStartOffset());
    types.addAll(CodeInsightUtil.addSubtypes(type,element,false,Condition.TRUE));
    final Set<LookupItem> set=new LinkedHashSet<LookupItem>();
    for (    PsiType t : types) {
      JavaTemplateUtil.addTypeLookupItem(set,t);
    }
    return set.toArray(new LookupItem[set.size()]);
  }
  return LookupItem.EMPTY_ARRAY;
}
