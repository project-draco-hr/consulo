{
  final VirtualFile virtualFile=(VirtualFile)dataProvider.getData(PlatformDataKeys.VIRTUAL_FILE.getName());
  if (virtualFile == null) {
    return null;
  }
  final FileType fileType=virtualFile.getFileType();
  if (fileType.isBinary() || fileType.isReadOnly()) {
    return null;
  }
  final Project project=(Project)dataProvider.getData(PlatformDataKeys.PROJECT.getName());
  if (project == null) {
    return null;
  }
  final Document document=FileDocumentManager.getInstance().getDocument(virtualFile);
  if (document == null) {
    return null;
  }
  return document.getText();
}
