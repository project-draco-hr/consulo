{
  int n=startNumberingFrom;
  AnAction[] actions=actionGroup.getChildren(new AnActionEvent(null,dataContext,ActionPlaces.UNKNOWN,getPresentation(actionGroup,action2presentation),ActionManager.getInstance(),0));
  int maxWidth=-1;
  int maxHeight=-1;
  for (  AnAction action : actions) {
    if (action == null)     continue;
    Icon icon=action.getTemplatePresentation().getIcon();
    if (icon != null) {
      final int width=icon.getIconWidth();
      final int height=icon.getIconHeight();
      if (maxWidth < width) {
        maxWidth=width;
      }
      if (maxHeight < height) {
        maxHeight=height;
      }
    }
  }
  Icon emptyIcon=maxHeight != -1 && maxWidth != -1 ? new EmptyIcon(maxWidth,maxHeight) : null;
  String sepText=separatorText;
  for (  AnAction action : actions) {
    if (action instanceof Separator) {
      prependWithSeparator=true;
      sepText=((Separator)action).getText();
    }
 else {
      if (action instanceof ActionGroup) {
        ActionGroup group=(ActionGroup)action;
        n=group.isPopup() ? appendAction(group,action2presentation,dataContext,showDisabled,showNumbers,n,listModel,emptyIcon,prependWithSeparator,sepText,honorActionMnemonics) : fillModel(listModel,group,dataContext,showNumbers,showDisabled,action2presentation,n,prependWithSeparator,separatorText,honorActionMnemonics);
      }
 else {
        n=appendAction(action,action2presentation,dataContext,showDisabled,showNumbers,n,listModel,emptyIcon,prependWithSeparator,sepText,honorActionMnemonics);
      }
      prependWithSeparator=false;
      separatorText=null;
    }
  }
  return n;
}
