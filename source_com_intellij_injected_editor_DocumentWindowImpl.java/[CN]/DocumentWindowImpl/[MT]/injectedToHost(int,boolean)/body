{
  if (offset < myPrefixes[0].length())   return myRelevantRangesInHostDocument[0].getStartOffset();
  for (int i=0; i < myRelevantRangesInHostDocument.length; i++) {
    RangeMarker currentRange=myRelevantRangesInHostDocument[i];
    offset-=myPrefixes[i].length();
    int length=currentRange.getEndOffset() - currentRange.getStartOffset();
    if (offset < length || !strict && offset == length) {
      return currentRange.getStartOffset() + offset;
    }
    offset-=length;
    offset-=mySuffixes[i].length();
  }
  return myRelevantRangesInHostDocument[myRelevantRangesInHostDocument.length - 1].getEndOffset();
}
