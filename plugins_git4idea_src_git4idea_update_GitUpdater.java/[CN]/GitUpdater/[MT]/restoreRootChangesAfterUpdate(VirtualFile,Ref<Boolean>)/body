{
  final Ref<Throwable> ex=new Ref<Throwable>();
  if (new File(root.getPath(),"MERGE_HEAD").exists()) {
    mergeFiles(root,cancelled,ex,false);
    if (ex.get() != null) {
      myExceptions.add(GitUtil.rethrowVcsException(ex.get()));
    }
  }
  if (stashCreated && getUpdatePolicy() == GitVcsSettings.UpdateChangesPolicy.STASH) {
    myProgressIndicator.setText(GitHandlerUtil.formatOperationName("Unstashing changes to",root));
    unstash(root);
    mergeFiles(root,cancelled,ex,true);
    if (ex.get() != null) {
      myExceptions.add(GitUtil.rethrowVcsException(ex.get()));
    }
  }
}
