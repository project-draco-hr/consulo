{
  final PsiElement prevLeaf=PsiTreeUtil.prevLeaf(insertedElement);
  final PsiElement prevPrevLeaf=prevLeaf != null ? PsiTreeUtil.prevLeaf(prevLeaf) : null;
  String prefix=super.findPrefix(insertedElement,offset);
  if (prevLeaf != null) {
    final String prevLeafText=prevLeaf.getText();
    if ("#".equals(prevLeafText)) {
      prefix="#" + prefix;
    }
 else     if ("!".equals(prevLeafText) && prevPrevLeaf != null && "<".equals(prevPrevLeaf.getText())) {
      prefix="<!" + prefix;
    }
  }
  return prefix;
}
