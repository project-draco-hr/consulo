{
  try {
    myRootToModuleMap.put(root,module);
    Set<VirtualFile> set=myModuleToRootsMap.get(module);
    if (set == null) {
      set=new HashSet<VirtualFile>();
      myModuleToRootsMap.put(module,set);
    }
    set.add(root);
    if (isTestSource) {
      myGeneratedTestRoots.add(root);
    }
    if (compiler instanceof SourceGeneratingCompiler) {
      myOutputRootToSourceGeneratorMap.put(root,new Pair<SourceGeneratingCompiler,Module>((SourceGeneratingCompiler)compiler,module));
    }
  }
  finally {
    myModuleToRootsCache.remove(module);
  }
}
