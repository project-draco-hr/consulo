{
  GotoImplementationHandler handler=new GotoImplementationHandler(){
    protected PsiElement[] filterElements(    Editor editor,    PsiFile file,    PsiElement element,    PsiElement[] targetElements,    final int offset){
      Set<PsiElement> unique=new LinkedHashSet<PsiElement>(Arrays.asList(targetElements));
      for (      PsiElement elt : targetElements) {
        PsiFile psiFile=elt.getContainingFile();
        final PsiFile originalFile=psiFile.getOriginalFile();
        if (originalFile != null)         psiFile=originalFile;
        if (psiFile.getVirtualFile() == null)         unique.remove(elt);
      }
      return unique.toArray(new PsiElement[unique.size()]);
    }
  }
;
  int offset=editor == null ? 0 : editor.getCaretModel().getOffset();
  final PsiElement[] handlerImplementations=handler.searchImplementations(editor,file,element,offset,true,true);
  if (handlerImplementations.length > 0)   return handlerImplementations;
  PsiFile psiFile=element.getContainingFile();
  if (psiFile == null) {
    element=element.getNavigationElement();
    psiFile=element.getContainingFile();
    if (psiFile == null)     return PsiElement.EMPTY_ARRAY;
  }
  return psiFile.getVirtualFile() != null ? new PsiElement[]{element} : PsiElement.EMPTY_ARRAY;
}
