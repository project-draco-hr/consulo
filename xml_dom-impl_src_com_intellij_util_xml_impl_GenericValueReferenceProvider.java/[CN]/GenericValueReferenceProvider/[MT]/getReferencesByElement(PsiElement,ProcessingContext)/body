{
  final DomManager domManager=DomManager.getDomManager(psiElement.getProject());
  final DomElement domElement;
  if (psiElement instanceof XmlTag) {
    domElement=domManager.getDomElement((XmlTag)psiElement);
  }
 else   if (psiElement instanceof XmlAttributeValue && psiElement.getParent() instanceof XmlAttribute) {
    domElement=domManager.getDomElement((XmlAttribute)psiElement.getParent());
  }
 else {
    return PsiReference.EMPTY_ARRAY;
  }
  if (!(domElement instanceof GenericDomValue)) {
    return PsiReference.EMPTY_ARRAY;
  }
  if (psiElement instanceof XmlTag) {
    for (    XmlText text : ((XmlTag)psiElement).getValue().getTextElements()) {
      if (InjectedLanguageUtil.hasInjections((PsiLanguageInjectionHost)text))       return PsiReference.EMPTY_ARRAY;
    }
  }
 else {
    if (InjectedLanguageUtil.hasInjections((PsiLanguageInjectionHost)psiElement))     return PsiReference.EMPTY_ARRAY;
  }
  final GenericDomValue domValue=(GenericDomValue)domElement;
  final Referencing referencing=domValue.getAnnotation(Referencing.class);
  final Object converter;
  if (referencing == null) {
    converter=WrappingConverter.getDeepestConverter(domValue.getConverter(),domValue);
  }
 else {
    Class<? extends CustomReferenceConverter> clazz=referencing.value();
    converter=((ConverterManagerImpl)domManager.getConverterManager()).getInstance(clazz);
  }
  PsiReference[] references=createReferences(domValue,(XmlElement)psiElement,converter);
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    for (    PsiReference reference : references) {
      if (!reference.isSoft()) {
        LOG.error("dom reference should be soft: " + reference + " (created by "+ converter+ ")");
      }
    }
  }
  return references;
}
