{
  if (myIsInLoading)   return;
  myIsInLoading=true;
synchronized (myCachedContents) {
    final VcsFileRevision[] revisionsToLoad=revisionsNeededToBeLoaded(revisions);
    ApplicationManager.getApplication().runProcessWithProgressSynchronously(new Runnable(){
      public void run(){
        ProgressIndicator progressIndicator=ProgressManager.getInstance().getProgressIndicator();
        progressIndicator.pushState();
        try {
          for (int i=0; i < revisionsToLoad.length; i++) {
            final VcsFileRevision vcsFileRevision=revisionsToLoad[i];
            progressIndicator.setText2("Loading revision " + vcsFileRevision.getRevisionNumber());
            progressIndicator.setFraction((double)i / (double)revisionsToLoad.length);
            if (!myCachedContents.containsKey(vcsFileRevision)) {
              try {
                vcsFileRevision.loadContent();
              }
 catch (              final VcsException e) {
                ApplicationManager.getApplication().invokeLater(new Runnable(){
                  public void run(){
                    Messages.showErrorDialog("Load Version","Cannot load version " + vcsFileRevision.getRevisionNumber() + ":"+ e.getLocalizedMessage());
                  }
                }
);
              }
catch (              ProcessCanceledException ex) {
                return;
              }
              String content=null;
              try {
                content=new String(vcsFileRevision.getContent(),myFile.getCharset().name());
              }
 catch (              IOException e) {
                LOG.error(e);
              }
              myCachedContents.put(vcsFileRevision,content);
            }
          }
        }
  finally {
          myIsInLoading=false;
          progressIndicator.popState();
        }
      }
    }
,"Loading Contents",false,myProject);
  }
}
