{
  LOG.debug("remove mapping: " + mapping.getDirectory());
  final Ref<LocalFileSystem.WatchRequest> request=new Ref<LocalFileSystem.WatchRequest>();
  keepActiveVcs(new Runnable(){
    public void run(){
      if (removeVcsFromMap(mapping,mapping.getVcs())) {
        sortedMappingsByMap();
        request.set(myDirectoryMappingWatches.remove(mapping));
      }
    }
  }
);
  if (!request.isNull()) {
    LocalFileSystem.getInstance().removeWatchedRoot(request.get());
  }
  mappingsChanged();
}
