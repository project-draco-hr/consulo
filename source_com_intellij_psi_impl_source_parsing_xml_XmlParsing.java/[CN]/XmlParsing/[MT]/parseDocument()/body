{
  final PsiBuilder.Marker document=mark();
  while (token() == XML_COMMENT_START) {
    parseComment();
  }
  parseProlog();
  int rootTagCount=0;
  PsiBuilder.Marker error=null;
  while (!eof()) {
    final IElementType tt=token();
    if (tt == XML_START_TAG_START) {
      error=flushError(error);
      rootTagCount++;
      parseTag(rootTagCount > 1);
    }
 else     if (tt == XML_COMMENT_START) {
      error=flushError(error);
      parseComment();
    }
 else     if (tt == XML_PI_START) {
      error=flushError(error);
      parseProcessingInstruction();
    }
 else     if (tt == XML_REAL_WHITE_SPACE) {
      error=flushError(error);
      advance();
    }
 else {
      if (error == null)       error=mark();
      advance();
    }
  }
  if (error != null) {
    error.error("Top element is not completed");
    error=null;
  }
  if (rootTagCount == 0) {
    final PsiBuilder.Marker rootTag=mark();
    error=mark();
    error.error("Valid XML document must have a root tag");
    rootTag.done(XML_TAG);
  }
  document.done(XML_DOCUMENT);
}
