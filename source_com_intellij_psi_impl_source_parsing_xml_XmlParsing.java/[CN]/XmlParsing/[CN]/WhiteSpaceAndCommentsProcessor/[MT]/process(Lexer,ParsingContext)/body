{
  TreeElement first=null;
  TreeElement last=null;
  while (isTokenValid(lexer.getTokenType())) {
    TreeElement tokenElement;
    IElementType type=lexer.getTokenType();
    if (!XML_WHITE_SPACE_OR_COMMENT_BIT_SET.isInSet(type)) {
      LOG.assertTrue(false,"Missed token should be white space or comment:" + type);
      throw new RuntimeException();
    }
    if (lexer.getTokenType() == XML_COMMENT_START) {
      tokenElement=parseComment(lexer,context);
    }
 else {
      tokenElement=ParseUtil.createTokenElement(lexer,context.getCharTable());
      lexer.advance();
    }
    if (last != null) {
      last.setTreeNext(tokenElement);
      tokenElement.setTreePrev(last);
      last=tokenElement;
    }
 else {
      first=last=tokenElement;
    }
  }
  return first;
}
