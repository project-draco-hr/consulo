{
  final MyElement element=createElement("<a><child-element/><child-element><child/></child-element></a>");
  final MyElement parent=element.getChildElements().get(1);
  final MyElement child=parent.getChild();
  final MyElement copy=(MyElement)child.createStableCopy();
  new WriteCommandAction(getProject()){
    @Override protected void run(    Result result) throws Throwable {
      parent.undefine();
      element.addChildElement().getChild().ensureXmlElementExists();
    }
  }
.execute();
  assertFalse(child.isValid());
  assertTrue(copy.isValid());
}
