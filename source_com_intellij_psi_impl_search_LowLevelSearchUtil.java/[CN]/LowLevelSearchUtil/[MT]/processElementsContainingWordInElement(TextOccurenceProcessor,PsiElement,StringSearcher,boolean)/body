{
  ProgressManager.getInstance().checkCanceled();
  final CharSequence buffer=scope instanceof PsiFile ? ((PsiFile)scope).getViewProvider().getContents() : new CharArrayCharSequence(scope.textToCharArray());
  int startOffset=0;
  int endOffset=buffer.length();
  do {
    startOffset=searchWord(buffer,startOffset,endOffset,searcher);
    if (startOffset < 0) {
      return true;
    }
    if (CachesBasedRefSearcher.DEBUG) {
      System.out.println(">>>>>>>>>>>>>>>>>>> found word:" + startOffset + " in "+ scope+ ","+ scope.getContainingFile().getName());
    }
    if (!processTreeUp(processor,scope,searcher,startOffset,ignoreInjectedPsi))     return false;
    startOffset++;
  }
 while (startOffset < endOffset);
  return true;
}
