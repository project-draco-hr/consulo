{
  final WeakReference<V> reference=myMap.get(key);
  if (reference != null) {
    final V v=reference.get();
    if (v != null) {
      return v == FactoryMap.NULL ? null : v;
    }
  }
  final V value=create(key);
  WeakReference<V> valueRef=new WeakReference<V>(value == null ? (V)FactoryMap.NULL : value);
  WeakReference<V> prevRef=myMap.putIfAbsent(key,valueRef);
  V prev=prevRef == null ? null : prevRef.get();
  return prev == null || prev == FactoryMap.NULL ? value : prev;
}
