{
  final SingleConfigurationConfigurable<RunConfiguration> configuration=getSelectedConfiguration();
  LOG.assertTrue(configuration != null);
  try {
    final DefaultMutableTreeNode typeNode=getSelectedConfigurationTypeNode();
    final RunnerAndConfigurationSettings settings=configuration.getSnapshot();
    final String copyName=createUniqueName(typeNode,configuration.getNameText());
    settings.setName(copyName);
    final ConfigurationFactory factory=settings.getFactory();
    if (factory instanceof ConfigurationFactoryEx) {
      ((ConfigurationFactoryEx)factory).onConfigurationCopied(settings.getConfiguration());
    }
    final SingleConfigurationConfigurable<RunConfiguration> configurable=createNewConfiguration(settings,typeNode);
    IdeFocusManager.getInstance(myProject).requestFocus(configurable.getNameTextField(),true);
    configurable.getNameTextField().setSelectionStart(0);
    configurable.getNameTextField().setSelectionEnd(copyName.length());
  }
 catch (  ConfigurationException e1) {
    Messages.showErrorDialog(myToolbarDecorator.getPanel(),e1.getMessage(),e1.getTitle());
  }
}
