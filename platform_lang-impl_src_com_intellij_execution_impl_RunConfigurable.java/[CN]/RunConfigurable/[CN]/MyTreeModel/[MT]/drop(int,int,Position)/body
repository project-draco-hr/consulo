{
  DefaultMutableTreeNode oldNode=(DefaultMutableTreeNode)myTree.getPathForRow(oldIndex).getLastPathComponent();
  DefaultMutableTreeNode newNode=(DefaultMutableTreeNode)myTree.getPathForRow(newIndex).getLastPathComponent();
  DefaultMutableTreeNode newParent=(DefaultMutableTreeNode)newNode.getParent();
  NodeKind oldKind=getKind(oldNode);
  boolean wasExpanded=myTree.isExpanded(new TreePath(oldNode.getPath()));
  if (isDropInto(myTree,oldIndex,newIndex)) {
    removeNodeFromParent(oldNode);
    int index=newNode.getChildCount();
    if (oldKind == CONFIGURATION) {
      for (int i=0; i < newNode.getChildCount(); i++) {
        if (getKind((DefaultMutableTreeNode)newNode.getChildAt(i)) == TEMPORARY_CONFIGURATION) {
          index=i;
          break;
        }
      }
    }
    insertNodeInto(oldNode,newNode,index);
    myTree.expandPath(new TreePath(newNode.getPath()));
  }
 else {
    removeNodeFromParent(oldNode);
    int index=newParent.getIndex(newNode);
    if (position == BELOW)     index++;
    insertNodeInto(oldNode,newParent,index);
  }
  TreePath treePath=new TreePath(oldNode.getPath());
  myTree.setSelectionPath(treePath);
  if (wasExpanded) {
    myTree.expandPath(treePath);
  }
}
