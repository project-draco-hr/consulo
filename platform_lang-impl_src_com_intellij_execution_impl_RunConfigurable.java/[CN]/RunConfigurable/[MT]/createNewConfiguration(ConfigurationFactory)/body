{
  DefaultMutableTreeNode node=null;
  DefaultMutableTreeNode selectedNode=null;
  TreePath selectionPath=myTree.getSelectionPath();
  if (selectionPath != null) {
    selectedNode=(DefaultMutableTreeNode)selectionPath.getLastPathComponent();
  }
  DefaultMutableTreeNode typeNode=getConfigurationTypeNode(factory.getType());
  if (typeNode == null) {
    typeNode=new DefaultMutableTreeNode(factory.getType());
    myRoot.add(typeNode);
    sortTopLevelBranches();
    ((DefaultTreeModel)myTree.getModel()).reload();
  }
  node=typeNode;
  if (selectedNode != null && typeNode.isNodeDescendant(selectedNode)) {
    node=selectedNode;
    if (getKind(node).isConfiguration()) {
      node=(DefaultMutableTreeNode)node.getParent();
    }
  }
  final RunnerAndConfigurationSettings settings=getRunManager().createConfiguration(createUniqueName(typeNode,null,CONFIGURATION,TEMPORARY_CONFIGURATION),factory);
  if (factory instanceof ConfigurationFactoryEx) {
    ((ConfigurationFactoryEx)factory).onNewConfigurationCreated(settings.getConfiguration());
  }
  createNewConfiguration(settings,node);
}
