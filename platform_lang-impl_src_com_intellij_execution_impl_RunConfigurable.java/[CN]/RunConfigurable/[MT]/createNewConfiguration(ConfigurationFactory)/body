{
  DefaultMutableTreeNode node=null;
  DefaultMutableTreeNode selectedNode=null;
  TreePath selectionPath=myTree.getSelectionPath();
  if (selectionPath != null) {
    selectedNode=(DefaultMutableTreeNode)selectionPath.getLastPathComponent();
    if (getKind(selectedNode) != FOLDER) {
      selectedNode=null;
    }
  }
  for (int i=0; i < myRoot.getChildCount(); i++) {
    final DefaultMutableTreeNode treeNode=(DefaultMutableTreeNode)myRoot.getChildAt(i);
    if (treeNode.getUserObject() == factory.getType()) {
      node=treeNode;
      if (selectedNode != null && selectedNode.getParent() == node) {
        node=selectedNode;
      }
      break;
    }
  }
  if (node == null) {
    node=new DefaultMutableTreeNode(factory.getType());
    myRoot.add(node);
    sortTopLevelBranches();
    ((DefaultTreeModel)myTree.getModel()).reload();
  }
  final RunnerAndConfigurationSettings settings=getRunManager().createConfiguration(createUniqueName(node,null),factory);
  if (factory instanceof ConfigurationFactoryEx) {
    ((ConfigurationFactoryEx)factory).onNewConfigurationCreated(settings.getConfiguration());
  }
  createNewConfiguration(settings,node);
}
