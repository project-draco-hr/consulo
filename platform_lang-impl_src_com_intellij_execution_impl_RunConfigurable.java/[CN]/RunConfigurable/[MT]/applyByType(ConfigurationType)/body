{
  DefaultMutableTreeNode typeNode=getConfigurationTypeNode(type);
  final RunManagerImpl manager=getRunManager();
  final ArrayList<RunConfigurationBean> stableConfigurations=new ArrayList<RunConfigurationBean>();
  if (typeNode != null) {
    final Set<String> names=new HashSet<String>();
    for (int i=0; i < typeNode.getChildCount(); i++) {
      final DefaultMutableTreeNode node=(DefaultMutableTreeNode)typeNode.getChildAt(i);
      final Object userObject=node.getUserObject();
      RunConfigurationBean configurationBean=null;
      if (userObject instanceof SingleConfigurationConfigurable) {
        final SingleConfigurationConfigurable configurable=(SingleConfigurationConfigurable)userObject;
        final RunnerAndConfigurationSettings settings=(RunnerAndConfigurationSettings)configurable.getSettings();
        if (manager.isTemporary(settings)) {
          applyConfiguration(typeNode,configurable);
        }
        configurationBean=new RunConfigurationBean(configurable);
      }
 else       if (userObject instanceof RunnerAndConfigurationSettingsImpl) {
        RunnerAndConfigurationSettings settings=(RunnerAndConfigurationSettings)userObject;
        configurationBean=new RunConfigurationBean(settings,manager.isConfigurationShared(settings),manager.getBeforeRunTasks(settings.getConfiguration()));
      }
      if (configurationBean != null) {
        final String nameText=configurationBean.getConfigurable().getNameText();
        if (!names.add(nameText)) {
          TreeUtil.selectNode(myTree,node);
          throw new ConfigurationException("Configuration with name \'" + nameText + "\' already exist");
        }
        stableConfigurations.add(configurationBean);
      }
    }
  }
  for (  RunConfigurationBean bean : stableConfigurations) {
    final SingleConfigurationConfigurable configurable=bean.getConfigurable();
    if (configurable != null) {
      applyConfiguration(typeNode,configurable);
    }
  }
  manager.removeConfigurations(type);
  for (  final RunConfigurationBean stableConfiguration : stableConfigurations) {
    manager.addConfiguration(stableConfiguration.getSettings(),stableConfiguration.isShared(),stableConfiguration.getStepsBeforeLaunch());
  }
}
