{
  FeatureUsageTracker.getInstance().triggerFeatureUsed("navigation.popup.file");
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  final ChooseByNamePopup popup=ChooseByNamePopup.createPopup(project,new GotoFileModel(project),getPsiContext(e));
  popup.invoke(new ChooseByNamePopupComponent.Callback(){
    public void onClose(){
      if (GotoFileAction.class.equals(myInAction))       myInAction=null;
    }
    public void elementChosen(    Object element){
      final PsiFile file=(PsiFile)element;
      if (file == null)       return;
      ApplicationManager.getApplication().invokeLater(new Runnable(){
        public void run(){
          final OpenFileDescriptor descriptor=new OpenFileDescriptor(project,file.getVirtualFile(),popup.getLinePosition(),popup.getColumnPosition());
          if (descriptor.canNavigate()) {
            descriptor.navigate(true);
          }
        }
      }
,ModalityState.NON_MODAL);
    }
  }
,ModalityState.current(),true);
}
