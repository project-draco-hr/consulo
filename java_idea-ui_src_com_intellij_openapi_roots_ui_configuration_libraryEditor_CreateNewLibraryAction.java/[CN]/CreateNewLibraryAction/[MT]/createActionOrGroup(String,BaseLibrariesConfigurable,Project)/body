{
  final LibraryType<?>[] extensions=LibraryType.EP_NAME.getExtensions();
  List<LibraryType<?>> suitableTypes=new ArrayList<LibraryType<?>>();
  if (project != null && librariesConfigurable instanceof ProjectLibrariesConfigurable) {
    final ModuleStructureConfigurable configurable=ModuleStructureConfigurable.getInstance(project);
    for (    LibraryType<?> extension : extensions) {
      if (!getSuitableModules(configurable,extension).isEmpty()) {
        suitableTypes.add(extension);
      }
    }
  }
 else {
    Collections.addAll(suitableTypes,extensions);
  }
  if (suitableTypes.isEmpty()) {
    return new AnAction[]{new CreateNewLibraryAction(text,Icons.LIBRARY_ICON,null,librariesConfigurable,project)};
  }
  List<AnAction> actions=new ArrayList<AnAction>();
  actions.add(new CreateNewLibraryAction(IdeBundle.message("create.default.library.type.action.name"),Icons.LIBRARY_ICON,null,librariesConfigurable,project));
  for (  LibraryType<?> type : suitableTypes) {
    actions.add(new CreateNewLibraryAction(type.getCreateActionName(),type.getIcon(),type,librariesConfigurable,project));
  }
  return actions.toArray(new AnAction[actions.size()]);
}
