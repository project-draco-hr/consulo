{
  final NewLibraryConfiguration configuration=createNewLibraryConfiguration(type,parentComponent,project);
  if (configuration == null)   return null;
  final Library library=modifiableModel.createLibrary(LibraryEditingUtil.suggestNewLibraryName(modifiableModel,configuration.getDefaultLibraryName()),configuration.getLibraryType().getKind());
  final NewLibraryEditor editor=new NewLibraryEditor(configuration.getLibraryType(),configuration.getProperties());
  configuration.addRoots(editor);
  final Library.ModifiableModel model=library.getModifiableModel();
  editor.applyTo((LibraryEx.ModifiableModelEx)model);
  AccessToken token=WriteAction.start();
  try {
    model.commit();
  }
  finally {
    token.finish();
  }
  return library;
}
