{
  final LibrariesModifiableModel modifiableModel=myLibrariesConfigurable.getModelProvider().getModifiableModel();
  final Library library=modifiableModel.createLibrary(LibraryEditingUtil.suggestNewLibraryName(modifiableModel),myType);
  if (myProject != null) {
    final BaseLibrariesConfigurable rootConfigurable=ProjectStructureConfigurable.getInstance(myProject).getConfigurableFor(library);
    final ExistingLibraryEditor libraryEditor=modifiableModel.getLibraryEditor(library);
    if (libraryEditor.hasChanges()) {
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        public void run(){
          libraryEditor.commit();
        }
      }
);
    }
    final DefaultMutableTreeNode libraryNode=MasterDetailsComponent.findNodeByObject((TreeNode)rootConfigurable.getTree().getModel().getRoot(),library);
    rootConfigurable.selectNodeInTree(libraryNode);
    appendLibraryToModules(ModuleStructureConfigurable.getInstance(myProject),library);
  }
}
