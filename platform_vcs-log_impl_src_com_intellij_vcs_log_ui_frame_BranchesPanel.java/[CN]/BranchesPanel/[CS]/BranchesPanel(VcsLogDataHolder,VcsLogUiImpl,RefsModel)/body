{
  myDataHolder=dataHolder;
  myUI=UI;
  myRefGroups=getRefsToDisplayOnPanel(initialRefsModel);
  myRefPainter=new RefPainter(myUI.getColorManager(),true);
  setPreferredSize(new Dimension(-1,HEIGHT_CELL + UIUtil.DEFAULT_VGAP));
  addMouseListener(new MouseAdapter(){
    @Override public void mouseClicked(    MouseEvent e){
      if (!myUI.getMainFrame().areGraphActionsEnabled()) {
        return;
      }
      final RefGroup group=findRef(e);
      if (group == null) {
        return;
      }
      if (group.getRefs().size() == 1) {
        VcsRef ref=group.getRefs().iterator().next();
        myUI.jumpToCommit(ref.getCommitHash());
      }
 else {
        final RefPopupComponent view=new RefPopupComponent(group,myUI,myRefPainter);
        JBPopup popup=view.getPopup();
        popup.show(new RelativePoint(BranchesPanel.this,new Point(e.getX(),BranchesPanel.this.getHeight())));
      }
    }
  }
);
  Project project=dataHolder.getProject();
  project.getMessageBus().connect(project).subscribe(VcsLogDataHolder.REFRESH_COMPLETED,new VcsLogRefreshListener(){
    @Override public void refresh(    @NotNull DataPack dataPack){
      rebuild(dataPack.getRefsModel());
    }
  }
);
}
