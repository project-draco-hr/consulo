{
  Collection<VcsRef> allRefs=myDataHolder.getDataPack().getRefsModel().getBranches();
  List<RefGroup> groups=ContainerUtil.newArrayList();
  for (  Map.Entry<VirtualFile,Collection<VcsRef>> entry : VcsLogUtil.groupRefsByRoot(allRefs).entrySet()) {
    VirtualFile root=entry.getKey();
    Collection<VcsRef> refs=entry.getValue();
    VcsLogProvider provider=myDataHolder.getLogProvider(root);
    VcsLogRefManager refManager=provider.getReferenceManager();
    groups.addAll(expandExpandableGroups(refManager.group(refs)));
  }
  return groups;
}
