{
  GraphicsEnvironment env=GraphicsEnvironment.getLocalGraphicsEnvironment();
  if (env.isHeadlessInstance()) {
    return key + ".headless";
  }
  JFrame frame=null;
  final Component owner=IdeFocusManager.findInstance().getFocusOwner();
  if (owner != null) {
    frame=UIUtil.getParentOfType(JFrame.class,owner);
  }
  if (frame == null) {
    frame=WindowManager.getInstance().findVisibleFrame();
  }
  if (project != null && (frame == null || (frame instanceof IdeFrame && project != ((IdeFrame)frame).getProject()))) {
    frame=WindowManager.getInstance().getFrame(project);
  }
  Rectangle screen=new Rectangle(0,0,0,0);
  if (frame != null) {
    final Point topLeft=frame.getLocation();
    Point center=new Point(topLeft.x + frame.getWidth() / 2,topLeft.y + frame.getHeight() / 2);
    for (    GraphicsDevice device : env.getScreenDevices()) {
      Rectangle bounds=device.getDefaultConfiguration().getBounds();
      if (bounds.contains(center)) {
        screen=bounds;
        break;
      }
    }
  }
 else {
    GraphicsConfiguration gc=env.getScreenDevices()[0].getDefaultConfiguration();
    screen=gc.getBounds();
  }
  String realKey=key + '.' + screen.x+ '.'+ screen.y+ '.'+ screen.width+ '.'+ screen.height;
  if (JBUI.isHiDPI()) {
    realKey+="@" + (((int)(96 * JBUI.scale(1f)))) + "dpi";
  }
  return realKey;
}
