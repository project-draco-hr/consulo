{
  if (myAlarm.getActiveRequestCount() == 0) {
    myInitialFocusedWindow=(Window)e.getOldValue();
    final MenuElement[] selectedPath=MenuSelectionManager.defaultManager().getSelectedPath();
    if (selectedPath.length == 0) {
      return;
    }
    Component firstComponent=null;
    for (    final MenuElement menuElement : selectedPath) {
      final Component component=menuElement.getComponent();
      if (component instanceof JMenuBar) {
        firstComponent=component;
        break;
      }
 else       if (component instanceof JPopupMenu) {
        firstComponent=((JPopupMenu)component).getInvoker();
        break;
      }
    }
    if (firstComponent == null) {
      return;
    }
    final Window window=SwingUtilities.getWindowAncestor(firstComponent);
    if (window != myInitialFocusedWindow) {
      return;
    }
  }
  myLastFocusedWindow=(Window)e.getNewValue();
  myAlarm.cancelAllRequests();
  myAlarm.addRequest(myClearSelectedPathRunnable,150);
}
