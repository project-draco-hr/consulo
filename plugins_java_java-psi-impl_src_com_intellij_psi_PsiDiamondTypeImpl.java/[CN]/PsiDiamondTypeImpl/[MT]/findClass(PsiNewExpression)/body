{
  final PsiJavaCodeReferenceElement classReference=newExpression.getClassOrAnonymousClassReference();
  if (classReference != null) {
    final String text=classReference.getReferenceName();
    if (text != null) {
      final Project project=newExpression.getProject();
      final JavaPsiFacade facade=JavaPsiFacade.getInstance(project);
      final PsiResolveHelper resolveHelper=facade.getResolveHelper();
      final PsiExpression newExpressionQualifier=newExpression.getQualifier();
      final PsiElement qualifierElement=classReference.getQualifier();
      final String qualifier=qualifierElement != null ? qualifierElement.getText() : "";
      final String qualifiedName=StringUtil.getQualifiedName(qualifier,text);
      if (newExpressionQualifier != null) {
        final PsiClass aClass=PsiUtil.resolveClassInClassTypeOnly(newExpressionQualifier.getType());
        if (aClass != null) {
          return aClass.findInnerClassByName(qualifiedName,false);
        }
      }
      return resolveHelper.resolveReferencedClass(qualifiedName,newExpression);
    }
 else {
      return null;
    }
  }
  return null;
}
