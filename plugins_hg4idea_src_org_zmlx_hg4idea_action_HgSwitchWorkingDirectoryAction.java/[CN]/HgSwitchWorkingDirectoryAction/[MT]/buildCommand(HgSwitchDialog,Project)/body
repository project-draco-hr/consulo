{
  return new HgGlobalCommand(){
    public VirtualFile getRepo(){
      return dialog.getRepository();
    }
    public void execute(){
      final HgUpdateCommand command=new HgUpdateCommand(project,dialog.getRepository());
      command.setClean(dialog.isRemoveLocalChanges());
      if (dialog.isRevisionSelected()) {
        command.setRevision(dialog.getRevision());
      }
      if (dialog.isBranchSelected()) {
        command.setBranch(dialog.getBranch().getName());
      }
      if (dialog.isTagSelected()) {
        command.setRevision(dialog.getTag().getName());
      }
      ApplicationManager.getApplication().executeOnPooledThread(new Runnable(){
        @Override public void run(){
          HgCommandResult result=command.execute();
          new HgCommandResultNotifier(project).process(result,null,null);
          project.getMessageBus().syncPublisher(Topics.BRANCH_TOPIC).update(project);
        }
      }
);
    }
  }
;
}
