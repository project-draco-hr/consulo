{
  final HgSwitchDialog dialog=new HgSwitchDialog(project);
  dialog.setRoots(repos,branchesForRepos);
  dialog.show();
  if (dialog.isOK()) {
    new Task.Backgroundable(project,HgVcsMessages.message("action.hg4idea.switch.description")){
      @Override public void run(      @NotNull ProgressIndicator indicator){
        updateTo(dialog,project);
        markDirtyAndHandleErrors(project,dialog.getRepository());
      }
    }
.queue();
  }
}
