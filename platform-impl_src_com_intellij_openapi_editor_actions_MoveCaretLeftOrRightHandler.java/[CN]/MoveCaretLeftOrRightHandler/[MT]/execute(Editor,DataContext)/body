{
  final SelectionModel selectionModel=editor.getSelectionModel();
  final CaretModel caretModel=editor.getCaretModel();
  ScrollingModel scrollingModel=editor.getScrollingModel();
  if (selectionModel.hasSelection()) {
    int start=selectionModel.getSelectionStart();
    int end=selectionModel.getSelectionEnd();
    int leftGuard=start + (myDirection == Direction.LEFT ? 1 : 0);
    int rightGuard=end - (myDirection == Direction.RIGHT ? 1 : 0);
    if (TextRange.from(leftGuard,rightGuard - leftGuard + 1).contains(caretModel.getOffset())) {
      selectionModel.removeSelection();
      caretModel.moveToOffset(myDirection == Direction.RIGHT ? end : start);
      scrollingModel.scrollToCaret(ScrollType.RELATIVE);
      return;
    }
  }
  caretModel.moveCaretRelatively(myDirection == Direction.RIGHT ? 1 : -1,0,false,false,true);
}
