{
  LOG.assertTrue(element.isValid());
  if (element instanceof PsiCompiledElement || element instanceof NonSlaveRepositoryPsiElement) {
    myElement=element;
  }
 else {
    myElement=null;
    myFile=element.getContainingFile();
    if (myFile == null) {
      myElement=element;
      return;
    }
    final FileViewProvider viewProvider=myFile.getViewProvider();
    final Set<Language> languages=viewProvider.getRelevantLanguages();
    for (    Language language : languages) {
      if (PsiTreeUtil.isAncestor(viewProvider.getPsi(language),element,false)) {
        myLanguage=language;
        break;
      }
    }
    if (myLanguage == null)     myLanguage=element.getLanguage();
    myClass=element.getClass();
    TextRange textRange=element.getTextRange();
    if (textRange != null) {
      myStartOffset=textRange.getStartOffset();
      myEndOffset=textRange.getEndOffset();
    }
  }
}
