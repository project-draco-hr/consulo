{
  PsiElement target=getElement();
  if (file instanceof PsiCompiledFile)   file=((PsiCompiledFile)file).getDecompiledPsiFile();
  Project project=target.getProject();
  final FindUsagesManager findUsagesManager=((FindManagerImpl)FindManager.getInstance(project)).getFindUsagesManager();
  final FindUsagesHandler handler=findUsagesManager.getFindUsagesHandler(target,true);
  PsiFile context=InjectedLanguageManager.getInstance(project).getTopLevelFile(file);
  SearchScope searchScope=new LocalSearchScope(context);
  Collection<PsiReference> refs=handler == null ? ReferencesSearch.search(target,searchScope,false).findAll() : handler.findReferencesToHighlight(target,searchScope);
  new HighlightUsagesHandler.DoHighlightRunnable(new ArrayList<PsiReference>(refs),project,target,editor,context,clearHighlights).run();
}
