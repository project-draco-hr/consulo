{
  PsiElement target=getElement();
  if (file instanceof PsiCompiledFile)   file=((PsiCompiledFile)file).getDecompiledPsiFile();
  final FindUsagesManager findUsagesManager=((FindManagerImpl)FindManager.getInstance(target.getProject())).getFindUsagesManager();
  final FindUsagesHandler handler=findUsagesManager.getFindUsagesHandler(target,true);
  PsiFile context=InjectedLanguageUtil.getTopLevelFile(file);
  SearchScope searchScope=new LocalSearchScope(context);
  Collection<PsiReference> refs=handler == null ? ReferencesSearch.search(target,searchScope,false).findAll() : handler.findReferencesToHighlight(target,searchScope);
  new HighlightUsagesHandler.DoHighlightRunnable(new ArrayList<PsiReference>(refs),target.getProject(),target,editor,context,clearHighlights).run();
}
