{
  myEventCount++;
  if (!myPopupManager.isPopupActive()) {
    if (e instanceof KeyEvent) {
      if (mySuspendMode) {
        return;
      }
 else {
        if (peekEvent(WindowEvent.WINDOW_OPENED) != null) {
          enterSuspendMode();
          return;
        }
      }
    }
  }
  if ((e instanceof KeyEvent) || (e instanceof MouseEvent)) {
synchronized (myLock) {
      myIdleRequestsAlarm.cancelAllRequests();
      for (int i=0; i < myIdleListeners.size(); i++) {
        final Runnable runnable=(Runnable)myIdleListeners.get(i);
        final MyFireIdleRequest request=(MyFireIdleRequest)myListener2Request.get(runnable);
        LOG.assertTrue(request != null,"There is no request for " + runnable);
        final Integer timeout=(Integer)myListener2Timeout.get(runnable);
        LOG.assertTrue(timeout != null);
        myIdleRequestsAlarm.addRequest(request,timeout.intValue(),ModalityState.NON_MMODAL);
      }
      if (KeyEvent.KEY_PRESSED == e.getID() || KeyEvent.KEY_TYPED == e.getID() || MouseEvent.MOUSE_PRESSED == e.getID() || MouseEvent.MOUSE_RELEASED == e.getID() || MouseEvent.MOUSE_CLICKED == e.getID()) {
        addIdleTimeCounterRequest();
        for (int i=0; i < myActivityListeners.size(); i++) {
          final Runnable runnable=(Runnable)myActivityListeners.get(i);
          runnable.run();
        }
      }
    }
  }
  if (myPopupManager.isPopupActive() && myPopupManager.dispatch(e)) {
    return;
  }
  if (myDispatcher != null && myDispatcher.dispatch(e)) {
    return;
  }
  if ((e instanceof InputEvent) && Patches.SPECIAL_WINPUT_METHOD_PROCESSING) {
    final InputEvent inputEvent=(InputEvent)e;
    if (!inputEvent.getComponent().isShowing()) {
      return;
    }
  }
  if (e instanceof ComponentEvent) {
    WindowManagerEx.getInstanceEx().dispatchComponentEvent((ComponentEvent)e);
  }
  if (e instanceof KeyEvent) {
    if (!myKeyEventDispatcher.dispatchKeyEvent((KeyEvent)e)) {
      defaultDispatchEvent(e);
    }
 else {
      ((KeyEvent)e).consume();
      defaultDispatchEvent(e);
    }
  }
 else   if (e instanceof MouseEvent) {
    if (!myMouseEventDispatcher.dispatchMouseEvent((MouseEvent)e)) {
      defaultDispatchEvent(e);
    }
  }
 else {
    defaultDispatchEvent(e);
  }
}
