{
  if (ApplicationManager.getApplication().isUnitTestMode())   return;
  final ContentManager contentManager=getContentManagerForRunner(info);
  RunContentDescriptor oldDescriptor=chooseReuseContentForDescriptor(contentManager,descriptor);
  final Content content;
  if (oldDescriptor != null) {
    content=oldDescriptor.getAttachedContent();
    myEventDispatcher.getMulticaster().contentRemoved(oldDescriptor,info.getToolWindowId());
    oldDescriptor.dispose();
  }
 else {
    content=createNewContent(contentManager,descriptor,info.getToolWindowId());
    content.setIcon(info.getToolWindowIcon());
  }
  content.setComponent(descriptor.getComponent());
  content.putUserData(DESCRIPTOR_KEY,descriptor);
  final ProcessHandler processHandler=descriptor.getProcessHandler();
  if (processHandler != null) {
    final ProcessAdapter processAdapter=new ProcessAdapter(){
      public void startNotified(      final ProcessEvent event){
        content.setIcon(info.getEnabledIcon());
      }
      public void processTerminated(      final ProcessEvent event){
        content.setIcon(info.getDisabledIcon());
      }
    }
;
    processHandler.addProcessListener(processAdapter);
    final Disposable disposer=content.getDisposer();
    if (disposer != null) {
      Disposer.register(disposer,new Disposable(){
        public void dispose(){
          processHandler.removeProcessListener(processAdapter);
        }
      }
);
    }
  }
  content.setDisplayName(descriptor.getDisplayName());
  descriptor.setAttachedContent(content);
  content.getManager().setSelectedContent(content);
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      final ToolWindow toolWindow=ToolWindowManager.getInstance(myProject).getToolWindow(info.getToolWindowId());
      toolWindow.activate(null);
    }
  }
);
}
