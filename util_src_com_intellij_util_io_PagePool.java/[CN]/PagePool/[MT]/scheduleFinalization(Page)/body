{
  boolean wakeUpFinalizer=false;
synchronized (lock) {
    if (page.isDirty()) {
      if (myFinalizerThread == null) {
        myFinalizerThread=new Thread(new FinalizationThreadWorker(),FINALIZER_THREAD_NAME);
        myFinalizerThread.start();
      }
      final int curFinalizationId=++finalizationId;
      page.setFinalizationId(curFinalizationId);
      final FinalizationRequest request=new FinalizationRequest(page,curFinalizationId);
      myFinalizationQueue.put(keyForPage(page),request);
      if (myFinalizationQueue.size() > 5000) {
        flushFinalizationQueue();
      }
 else {
        wakeUpFinalizer=true;
      }
    }
 else {
      page.recycle();
    }
  }
  if (wakeUpFinalizer) {
synchronized (finalizationLock) {
      finalizationLock.notifyAll();
    }
  }
}
