{
  final int curFinalizationId;
synchronized (lock) {
    curFinalizationId=++finalizationId;
  }
  final FinalizationRequest request=page.prepareForFinalization(curFinalizationId);
  if (request == null)   return;
  boolean flushQueueNow=false;
synchronized (lock) {
    if (myFinalizerThread == null) {
      myFinalizerThread=new Thread(new FinalizationThreadWorker(),FINALIZER_THREAD_NAME);
      myFinalizerThread.start();
    }
    myFinalizationQueue.put(keyForPage(page),request);
    if (myFinalizationQueue.size() > 5000) {
      flushQueueNow=true;
    }
  }
  if (flushQueueNow) {
    flushFinalizationQueue(4000);
  }
 else {
synchronized (finalizationMonitor) {
      finalizationMonitor.notifyAll();
    }
  }
}
