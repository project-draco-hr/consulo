{
  boolean wakeUpFinalizer=false;
synchronized (lock) {
    if (page.isDirty()) {
      if (myFinalizerThread == null) {
        myFinalizerThread=new Thread(new FinalizationThreadWorker(),"Disk cache finalization queue");
        myFinalizerThread.start();
      }
      final long curFinalizationId=++finalizationId;
      page.setFinalizationId(curFinalizationId);
      wakeUpFinalizer=true;
      myFinalizationQueue.put(keyForPage(page),new FinalizationRequest(page,curFinalizationId));
    }
 else {
      page.recycle();
    }
  }
  if (wakeUpFinalizer) {
synchronized (myFinalizationQueue) {
      myFinalizationQueue.notifyAll();
    }
  }
}
