{
  CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
    @Override public void run(){
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          BlockSupport blockSupport=ServiceManager.getService(myProject,BlockSupport.class);
          try {
            blockSupport.reparseRange(myDummyFile,myInsertOffset - length,myInsertOffset,s);
            String foundStructure=DebugUtil.treeToString(SourceTreeToPsiMap.psiElementToTree(myDummyFile),false);
            final PsiFile psiFile=createDummyFile(getName() + "." + myFileType.getDefaultExtension(),expectedNewText);
            String expectedStructure=DebugUtil.treeToString(SourceTreeToPsiMap.psiElementToTree(psiFile),false);
            if (!expectedStructure.equals(foundStructure)) {
              System.out.println("expected: ");
              System.out.println(expectedStructure);
              System.out.println("found: ");
              System.out.println(foundStructure);
              assertEquals(expectedStructure,foundStructure);
            }
            assertEquals("Reparse tree should be equal to the document",expectedNewText,myDummyFile.getText());
          }
 catch (          IncorrectOperationException e) {
            LOG.error(e);
          }
        }
      }
);
    }
  }
,"asd",null);
}
