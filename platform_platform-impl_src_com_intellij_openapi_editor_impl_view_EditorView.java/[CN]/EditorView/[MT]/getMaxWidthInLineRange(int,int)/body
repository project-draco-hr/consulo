{
  int maxWidth=0;
  for (int i=startVisualLine; i <= endVisualLine; i++) {
    LogicalPosition startPosition=visualToLogicalPosition(new VisualPosition(i,0));
    if (startPosition.line >= myDocument.getLineCount())     break;
    int startOffset=logicalPositionToOffset(startPosition);
    float x=0;
    int maxOffset=0;
    for (    VisualLineFragmentsIterator.Fragment fragment : VisualLineFragmentsIterator.create(this,startOffset,false)) {
      x=fragment.getEndX();
      maxOffset=Math.max(maxOffset,fragment.getMaxOffset());
    }
    if (myEditor.getSoftWrapModel().getSoftWrap(maxOffset) != null) {
      x+=myEditor.getSoftWrapModel().getMinDrawingWidthInPixels(SoftWrapDrawingType.BEFORE_SOFT_WRAP_LINE_FEED);
    }
    maxWidth=Math.max(maxWidth,(int)x);
  }
  return maxWidth;
}
