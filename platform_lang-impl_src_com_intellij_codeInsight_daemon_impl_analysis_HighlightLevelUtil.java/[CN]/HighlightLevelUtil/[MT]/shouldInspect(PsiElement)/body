{
  if (ApplicationManager.getApplication().isUnitTestMode())   return true;
  if (!shouldHighlight(psiRoot))   return false;
  final Project project=psiRoot.getProject();
  final VirtualFile virtualFile=psiRoot.getContainingFile().getVirtualFile();
  if (virtualFile == null || !virtualFile.isValid())   return false;
  if (ProjectCoreUtil.isProjectOrWorkspaceFile(virtualFile))   return false;
  final ProjectFileIndex fileIndex=ProjectRootManager.getInstance(project).getFileIndex();
  if (ProjectScope.getLibrariesScope(project).contains(virtualFile) && !fileIndex.isInContent(virtualFile))   return false;
  final HighlightingSettingsPerFile component=HighlightingSettingsPerFile.getInstance(project);
  if (component == null)   return true;
  final FileHighlighingSetting settingForRoot=component.getHighlightingSettingForRoot(psiRoot);
  return settingForRoot != FileHighlighingSetting.SKIP_INSPECTION;
}
