{
  PsiElement parent=extendRef.getParent();
  if (!(parent instanceof PsiReferenceList)) {
    return null;
  }
  if (!(parent.getParent() instanceof PsiClass && ((PsiClass)parent.getParent()).getExtendsList() == parent)) {
    return null;
  }
  if (!(resolved instanceof PsiClass)) {
    return HighlightInfo.createHighlightInfo(HighlightInfoType.ERROR,extendRef,"Class name expected");
  }
  PsiClass base=(PsiClass)resolved;
  if (!PsiUtil.isInnerClass(base))   return null;
  PsiClass baseClass=(PsiClass)base.getParent();
  PsiClass aClass=(PsiClass)parent.getParent();
  if (!hasEnclosingInstanceInScope(baseClass,extendRef,true) && !qualifiedNewCalledInConstructors(aClass,baseClass)) {
    String description=MessageFormat.format("No enclosing instance of type ''{0}'' is in scope",new Object[]{HighlightUtil.formatClass(baseClass)});
    return HighlightInfo.createHighlightInfo(HighlightInfoType.ERROR,extendRef,description);
  }
  return null;
}
