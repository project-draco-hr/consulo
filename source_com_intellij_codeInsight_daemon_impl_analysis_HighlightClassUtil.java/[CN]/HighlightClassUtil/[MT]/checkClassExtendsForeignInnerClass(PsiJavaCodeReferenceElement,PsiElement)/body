{
  if (!(extendRef.getParent() instanceof PsiReferenceList)) {
    return null;
  }
  if (!(extendRef.getParent().getParent() instanceof PsiClass && ((PsiClass)extendRef.getParent().getParent()).getExtendsList() == extendRef.getParent())) {
    return null;
  }
  if (!(resolved instanceof PsiClass)) {
    return HighlightInfo.createHighlightInfo(HighlightInfoType.ERROR,extendRef,"Class name expected");
  }
  final PsiClass base=(PsiClass)resolved;
  if (!PsiUtil.isInnerClass(base))   return null;
  PsiClass baseOuter=(PsiClass)base.getParent();
  if (!hasEnclosedInstanceInScope(baseOuter,extendRef)) {
    String description=MessageFormat.format("No enclosing instance of type ''{0}'' is in scope",new Object[]{HighlightUtil.formatClass(baseOuter)});
    return HighlightInfo.createHighlightInfo(HighlightInfoType.ERROR,extendRef,description);
  }
  return null;
}
