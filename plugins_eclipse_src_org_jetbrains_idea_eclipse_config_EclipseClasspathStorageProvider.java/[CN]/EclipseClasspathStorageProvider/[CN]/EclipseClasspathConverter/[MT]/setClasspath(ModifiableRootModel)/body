{
  try {
    final Element classpathElement=new Element(EclipseXml.CLASSPATH_TAG);
    final EclipseClasspathWriter classpathWriter=new EclipseClasspathWriter(model);
    final CachedXmlDocumentSet fileSet=getFileSet();
    Element element;
    try {
      element=fileSet.read(EclipseXml.CLASSPATH_FILE).getRootElement();
    }
 catch (    Exception e) {
      element=null;
    }
    if (element != null || model.getSourceRoots().length > 0) {
      classpathWriter.writeClasspath(classpathElement,element);
      fileSet.write(new Document(classpathElement),EclipseXml.CLASSPATH_FILE);
    }
    try {
      fileSet.read(EclipseXml.PROJECT_FILE);
    }
 catch (    Exception e) {
      DotProjectFileHelper.saveDotProjectFile(module,fileSet.getParent(EclipseXml.PROJECT_FILE));
    }
    final Element ideaSpecific=new Element(IdeaXml.COMPONENT_TAG);
    final String emlFilename=model.getModule().getName() + EclipseXml.IDEA_SETTINGS_POSTFIX;
    if (IdeaSpecificSettings.writeIDEASpecificClasspath(ideaSpecific,model)) {
      fileSet.write(new Document(ideaSpecific),emlFilename);
    }
 else {
      fileSet.delete(emlFilename);
    }
  }
 catch (  ConversionException e) {
    throw new WriteExternalException(e.getMessage());
  }
}
