{
  try {
    final Element classpathElement=new Element(EclipseXml.CLASSPATH_TAG);
    final EclipseClasspathWriter classpathWriter=new EclipseClasspathWriter(model);
    final CachedXmlDocumentSet fileSet=getFileSet();
    if (model.getSourceRoots().length > 0) {
      Element element;
      try {
        element=fileSet.read(EclipseXml.CLASSPATH_FILE).getRootElement();
      }
 catch (      Exception e) {
        element=null;
      }
      classpathWriter.writeClasspath(classpathElement,element);
      fileSet.write(new Document(classpathElement),EclipseXml.CLASSPATH_FILE);
    }
 else {
      fileSet.delete(EclipseXml.CLASSPATH_FILE);
    }
    final Element ideaSpecific=new Element(IdeaXml.COMPONENT_TAG);
    final String emlFilename=model.getModule().getName() + EclipseXml.IDEA_SETTINGS_POSTFIX;
    if (classpathWriter.writeIDEASpecificClasspath(ideaSpecific)) {
      fileSet.write(new Document(ideaSpecific),emlFilename);
    }
 else {
      fileSet.delete(emlFilename);
    }
  }
 catch (  ConversionException e) {
    throw new WriteExternalException(e.getMessage());
  }
}
