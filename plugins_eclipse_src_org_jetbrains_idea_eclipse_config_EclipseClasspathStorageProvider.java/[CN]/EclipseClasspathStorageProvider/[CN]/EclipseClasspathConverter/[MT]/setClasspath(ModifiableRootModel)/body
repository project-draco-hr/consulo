{
  try {
    final Element classpathElement=new Element(EclipseXml.CLASSPATH_TAG);
    final EclipseClasspathWriter classpathWriter=new EclipseClasspathWriter(model);
    final CachedXmlDocumentSet fileSet=getFileSet();
    classpathWriter.writeClasspath(classpathElement,fileSet.read(EclipseXml.CLASSPATH_FILE).getRootElement());
    fileSet.write(new Document(classpathElement),EclipseXml.CLASSPATH_FILE);
    final Element ideaSpecific=new Element(IdeaXml.COMPONENT_TAG);
    if (classpathWriter.writeIDEASpecificClasspath(ideaSpecific)) {
      fileSet.write(new Document(ideaSpecific),model.getModule().getName() + EclipseXml.IDEA_SETTINGS_POSTFIX);
    }
    fileSet.commit();
  }
 catch (  ConversionException e) {
    throw new WriteExternalException(e.getMessage());
  }
catch (  JDOMException e) {
    throw new WriteExternalException(e.getMessage());
  }
}
