{
  try {
    final HashSet<String> usedVariables=new HashSet<String>();
    final CachedXmlDocumentSet documentSet=getFileSet();
    final VirtualFile vFile=documentSet.getVFile(EclipseXml.PROJECT_FILE);
    final String path=vFile.getParent().getPath();
    final EclipseClasspathReader classpathReader=new EclipseClasspathReader(path,module.getProject());
    classpathReader.init(model);
    if (documentSet.exists(EclipseXml.CLASSPATH_FILE)) {
      final String eml=model.getModule().getName() + EclipseXml.IDEA_SETTINGS_POSTFIX;
      if (documentSet.exists(eml)) {
        EclipseClasspathReader.readIDEASpecific(documentSet.read(eml).getRootElement(),model);
      }
      classpathReader.readClasspath(model,new ArrayList<String>(),new ArrayList<String>(),usedVariables,new HashSet<String>(),null,documentSet.read(EclipseXml.CLASSPATH_FILE).getRootElement());
    }
    ((RootModelImpl)model).writeExternal(element);
    return usedVariables;
  }
 catch (  ConversionException e) {
    throw new InvalidDataException(e);
  }
catch (  WriteExternalException e) {
    throw new InvalidDataException(e);
  }
catch (  JDOMException e) {
    throw new InvalidDataException(e);
  }
}
