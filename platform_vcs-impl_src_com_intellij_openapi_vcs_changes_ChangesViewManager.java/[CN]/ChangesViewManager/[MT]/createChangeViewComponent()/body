{
  SimpleToolWindowPanel panel=new SimpleToolWindowPanel(false,true);
  DefaultActionGroup group=(DefaultActionGroup)ActionManager.getInstance().getAction("ChangesViewToolbar");
  ActionManager.getInstance().getAction("ChangesView.Refresh").registerCustomShortcutSet(CommonShortcuts.getRerun(),panel);
  ActionManager.getInstance().getAction("ChangesView.NewChangeList").registerCustomShortcutSet(CommonShortcuts.getNew(),panel);
  ActionManager.getInstance().getAction("ChangesView.RemoveChangeList").registerCustomShortcutSet(CommonShortcuts.DELETE,panel);
  ActionManager.getInstance().getAction("ChangesView.Move").registerCustomShortcutSet(CommonShortcuts.getMove(),panel);
  ActionManager.getInstance().getAction("ChangesView.Rename").registerCustomShortcutSet(CommonShortcuts.getRename(),panel);
  final CustomShortcutSet diffShortcut=new CustomShortcutSet(KeyStroke.getKeyStroke(KeyEvent.VK_D,SystemInfo.isMac ? InputEvent.META_DOWN_MASK : InputEvent.CTRL_DOWN_MASK));
  ActionManager.getInstance().getAction("ChangesView.Diff").registerCustomShortcutSet(diffShortcut,panel);
  JPanel toolbarPanel=new JPanel(new BorderLayout());
  toolbarPanel.add(createToolbarComponent(group),BorderLayout.WEST);
  DefaultActionGroup visualActionsGroup=new DefaultActionGroup();
  final Expander expander=new Expander();
  visualActionsGroup.add(CommonActionsManager.getInstance().createExpandAllAction(expander,panel));
  visualActionsGroup.add(CommonActionsManager.getInstance().createCollapseAllAction(expander,panel));
  ToggleShowFlattenAction showFlattenAction=new ToggleShowFlattenAction();
  showFlattenAction.registerCustomShortcutSet(new CustomShortcutSet(KeyStroke.getKeyStroke(KeyEvent.VK_P,SystemInfo.isMac ? InputEvent.META_DOWN_MASK : InputEvent.CTRL_DOWN_MASK)),panel);
  visualActionsGroup.add(showFlattenAction);
  visualActionsGroup.add(ActionManager.getInstance().getAction(IdeActions.ACTION_COPY));
  visualActionsGroup.add(new ToggleShowIgnoredAction());
  visualActionsGroup.add(new IgnoredSettingsAction());
  visualActionsGroup.add(new ContextHelpAction(ChangesListView.ourHelpId));
  toolbarPanel.add(createToolbarComponent(visualActionsGroup),BorderLayout.CENTER);
  DefaultActionGroup menuGroup=(DefaultActionGroup)ActionManager.getInstance().getAction("ChangesViewPopupMenu");
  myView.setMenuActions(menuGroup);
  myView.setShowFlatten(SHOW_FLATTEN_MODE);
  myProgressLabel=new JLabel();
  panel.setToolbar(toolbarPanel);
  final JPanel content=new JPanel(new BorderLayout());
  content.add(new JScrollPane(myView),BorderLayout.CENTER);
  content.add(myProgressLabel,BorderLayout.SOUTH);
  panel.setContent(content);
  myView.installDndSupport(ChangeListManagerImpl.getInstanceImpl(myProject));
  return panel;
}
