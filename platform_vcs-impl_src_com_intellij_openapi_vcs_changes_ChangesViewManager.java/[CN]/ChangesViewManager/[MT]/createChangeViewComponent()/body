{
  SimpleToolWindowPanel panel=new SimpleToolWindowPanel(false,true);
  DefaultActionGroup group=(DefaultActionGroup)ActionManager.getInstance().getAction("ChangesViewToolbar");
  ActionManager.getInstance().getAction("ChangesView.Refresh").registerCustomShortcutSet(CommonShortcuts.getRerun(),panel);
  ActionManager.getInstance().getAction("ChangesView.NewChangeList").registerCustomShortcutSet(CommonShortcuts.getNew(),panel);
  ActionManager.getInstance().getAction("ChangesView.RemoveChangeList").registerCustomShortcutSet(CommonShortcuts.DELETE,panel);
  ActionManager.getInstance().getAction("ChangesView.Move").registerCustomShortcutSet(CommonShortcuts.getMove(),panel);
  ActionManager.getInstance().getAction("ChangesView.Rename").registerCustomShortcutSet(CommonShortcuts.getRename(),panel);
  ActionManager.getInstance().getAction("ChangesView.SetDefault").registerCustomShortcutSet(new CustomShortcutSet(KeyStroke.getKeyStroke(KeyEvent.VK_U,KeyEvent.ALT_DOWN_MASK | ctrlMask())),panel);
  final CustomShortcutSet diffShortcut=new CustomShortcutSet(KeyStroke.getKeyStroke(KeyEvent.VK_D,ctrlMask()));
  ActionManager.getInstance().getAction("ChangesView.Diff").registerCustomShortcutSet(diffShortcut,panel);
  JPanel toolbarPanel=new JPanel(new BorderLayout());
  ActionToolbar toolbar=ActionManager.getInstance().createActionToolbar(ActionPlaces.CHANGES_VIEW_TOOLBAR,group,false);
  toolbar.setTargetComponent(myView);
  JComponent toolbarComponent=toolbar.getComponent();
  toolbarPanel.add(toolbarComponent,BorderLayout.WEST);
  DefaultActionGroup visualActionsGroup=new DefaultActionGroup();
  final Expander expander=new Expander();
  visualActionsGroup.add(CommonActionsManager.getInstance().createExpandAllAction(expander,panel));
  visualActionsGroup.add(CommonActionsManager.getInstance().createCollapseAllAction(expander,panel));
  ToggleShowFlattenAction showFlattenAction=new ToggleShowFlattenAction();
  showFlattenAction.registerCustomShortcutSet(new CustomShortcutSet(KeyStroke.getKeyStroke(KeyEvent.VK_P,ctrlMask())),panel);
  visualActionsGroup.add(showFlattenAction);
  visualActionsGroup.add(ActionManager.getInstance().getAction(IdeActions.ACTION_COPY));
  visualActionsGroup.add(new ToggleShowIgnoredAction());
  visualActionsGroup.add(new IgnoredSettingsAction());
  myToggleDetailsAction=new ToggleDetailsAction();
  visualActionsGroup.add(myToggleDetailsAction);
  visualActionsGroup.add(new ContextHelpAction(ChangesListView.ourHelpId));
  toolbarPanel.add(ActionManager.getInstance().createActionToolbar(ActionPlaces.CHANGES_VIEW_TOOLBAR,visualActionsGroup,false).getComponent(),BorderLayout.CENTER);
  DefaultActionGroup menuGroup=(DefaultActionGroup)ActionManager.getInstance().getAction("ChangesViewPopupMenu");
  myView.setMenuActions(menuGroup);
  myView.setShowFlatten(SHOW_FLATTEN_MODE);
  myProgressLabel=new JPanel(new BorderLayout());
  panel.setToolbar(toolbarPanel);
  final JPanel content=new JPanel(new BorderLayout());
  String value=PropertiesComponent.getInstance().getValue(DETAILS_SPLITTER_PROPORTION);
  float f=0.5f;
  if (!StringUtil.isEmptyOrSpaces(value)) {
    try {
      f=Float.parseFloat(value);
    }
 catch (    NumberFormatException e) {
    }
  }
  mySplitter=new Splitter(false,f);
  mySplitter.setHonorComponentsMinimumSize(false);
  final JScrollPane scrollPane=ScrollPaneFactory.createScrollPane(myView);
  final JPanel wrapper=new JPanel(new BorderLayout());
  wrapper.add(scrollPane,BorderLayout.CENTER);
  mySplitter.setFirstComponent(wrapper);
  content.add(mySplitter,BorderLayout.CENTER);
  content.add(myProgressLabel,BorderLayout.SOUTH);
  panel.setContent(content);
  myDiffDetails.getPanel();
  myView.installDndSupport(ChangeListManagerImpl.getInstanceImpl(myProject));
  myView.addTreeSelectionListener(myTsl);
  return panel;
}
