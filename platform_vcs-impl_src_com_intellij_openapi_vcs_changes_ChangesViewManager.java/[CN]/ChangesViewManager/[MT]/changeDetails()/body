{
  if (!myDetailsOn) {
    setChangeDetailsPanel(null);
  }
 else {
    final Change[] selectedChanges=myView.getSelectedChanges();
    if (selectedChanges.length == 0) {
      setChangeDetailsPanel(myNothingSelected);
    }
 else {
      final String freezed=ChangeListManager.getInstance(myProject).isFreezed();
      if (freezed != null) {
        setChangeDetailsPanel(UIVcsUtil.errorPanel(freezed,false));
        return;
      }
      Pair<JPanel,Disposable> details=null;
      FilePath filePath=null;
      for (      Change change : selectedChanges) {
        if (change.getBeforeRevision() instanceof FakeRevision || change.getAfterRevision() instanceof FakeRevision) {
          setChangeDetailsPanel(myNotLoadedYet);
          return;
        }
        filePath=ChangesUtil.getFilePath(change);
        details=myDetailsCache.get(filePath);
        if (details != null)         break;
        details=myVcsChangeDetailsManager.getPanel(change);
        if (details != null) {
          myDetailsCache.put(filePath,details);
          break;
        }
      }
      final JPanel panel;
      if (details == null) {
        panel=myNoDetailsPanel;
      }
 else {
        myDetailsFilePath=filePath;
        panel=details.getFirst();
      }
      setChangeDetailsPanel(panel);
    }
  }
}
