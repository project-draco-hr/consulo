{
  if (itemPreferencePolicy == null) {
    return -1;
  }
 else {
    LookupElement prefItem=null;
    int prefItemIndex=-1;
    for (int i=0; i < items.length; i++) {
      LookupElement item=(LookupElement)items[i];
      final Object obj=item.getObject();
      if (obj instanceof PsiElement && !((PsiElement)obj).isValid())       continue;
      if (prefItem == null) {
        prefItem=item;
        prefItemIndex=i;
      }
 else {
        int d=itemPreferencePolicy.compare(item,prefItem);
        if (d < 0) {
          prefItem=item;
          prefItemIndex=i;
        }
      }
    }
    return prefItem != null ? prefItemIndex : -1;
  }
}
