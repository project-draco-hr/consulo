{
  ListModel listModel=myList.getModel();
  String commonPrefix=null;
  String subprefix=null;
  boolean isStrict=false;
  for (int i=0; i < listModel.getSize(); i++) {
    LookupItem item=(LookupItem)listModel.getElementAt(i);
    if (item.getAttribute(EMPTY_ITEM_ATTRIBUTE) != null)     return false;
    String string=item.getLookupString();
    String string1=string.substring(0,myPrefix.length());
    String string2=string.substring(myPrefix.length());
    if (commonPrefix == null) {
      commonPrefix=string2;
      subprefix=string1;
    }
 else {
      while (commonPrefix.length() > 0) {
        if (string2.startsWith(commonPrefix)) {
          if (string2.length() > commonPrefix.length()) {
            isStrict=true;
          }
          if (!string1.equals(subprefix)) {
            subprefix=null;
          }
          break;
        }
        commonPrefix=commonPrefix.substring(0,commonPrefix.length() - 1);
      }
      if (commonPrefix.length() == 0)       return false;
    }
  }
  if (!isStrict && !toCompleteUniqueName)   return false;
  final String _subprefix=subprefix;
  final String _commonPrefix=commonPrefix;
  CommandProcessor.getInstance().executeCommand(myProject,new Runnable(){
    public void run(){
      if (_subprefix != null) {
        int lookupStart=getLookupStart();
        myEditor.getDocument().replaceString(lookupStart,lookupStart + _subprefix.length(),_subprefix);
      }
      myPrefix+=_commonPrefix;
      EditorModificationUtil.insertStringAtCaret(myEditor,_commonPrefix);
    }
  }
,null,null);
  myList.repaint();
  return true;
}
