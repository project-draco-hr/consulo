{
  configureFromFileText("a.java","class A { String s = \"\"; }");
  assertEmpty(filter(doHighlighting(),HighlightSeverity.ERROR));
  PsiField field=((PsiJavaFile)getFile()).getClasses()[0].getFields()[0];
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
  final PsiExpression literal=JavaPsiFacade.getElementFactory(getProject()).createExpressionFromText("\"xxx\"",field);
  final PsiBinaryExpression binary=(PsiBinaryExpression)JavaPsiFacade.getElementFactory(getProject()).createExpressionFromText("a+b",field);
  for (int i=0; i < 2000; i++) {
    final PsiExpression expression=field.getInitializer();
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      public void run(){
        binary.getLOperand().replace(expression);
        binary.getROperand().replace(literal);
        expression.replace(binary);
        PostprocessReformattingAspect.getInstance(getProject()).clear();
      }
    }
);
    UIUtil.dispatchAllInvocationEvents();
  }
  field.getInitializer().getType();
}
