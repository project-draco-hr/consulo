{
  LogicalPosition caretPosition=editor.getCaretModel().getLogicalPosition();
  final Document document=editor.getDocument();
  final CharSequence chars=document.getCharsSequence();
  int offset=editor.getCaretModel().getOffset();
  int lineStart=document.getLineStartOffset(document.getLineNumber(offset));
  final CharSequence beforeCaret=chars.subSequence(lineStart,offset);
  if (CharArrayUtil.containsOnlyWhiteSpaces(beforeCaret)) {
    String strToInsert="";
    if (beforeCaret != null) {
      strToInsert+=beforeCaret.toString();
    }
    strToInsert+="\n";
    document.insertString(lineStart,strToInsert);
    editor.getCaretModel().moveToOffset(offset);
  }
 else {
    getEnterHandler().execute(editor,dataContext);
    editor.getCaretModel().moveToLogicalPosition(caretPosition);
    editor.getScrollingModel().scrollToCaret(ScrollType.RELATIVE);
  }
}
