{
  for (  VirtualFile f : dir.getChildren()) {
    if (notAllowed(f))     continue;
    Entry e=entry.findChild(f.getName());
    if (e == null) {
      createRecursively(f);
    }
 else     if (!sameKind(e,f)) {
      myVcs.delete(e.getPath());
      createRecursively(f);
    }
 else {
      if (!e.getName().equals(f.getName())) {
        myVcs.rename(e.getPath(),f.getName());
      }
      if (f.isDirectory()) {
        updateRecursively(e,f);
      }
 else {
        boolean isFileRO=!f.isWritable();
        if (e.isReadOnly() != isFileRO) {
          myVcs.changeROStatus(f.getPath(),isFileRO);
        }
        if (e.isOutdated(f.getTimeStamp())) {
          myProcessor.addFileToUpdate(f);
        }
      }
    }
  }
  deleteObsoleteFiles(entry,dir);
}
