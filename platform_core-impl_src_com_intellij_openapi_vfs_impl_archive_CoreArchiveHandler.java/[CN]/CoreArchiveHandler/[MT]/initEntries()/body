{
synchronized (lock) {
    Map<String,ArchiveHandlerEntry> map=myRelPathsToEntries != null ? myRelPathsToEntries.get() : null;
    if (map == null) {
      final ArchiveFile zip=getArchiveFile();
      map=new THashMap<String,ArchiveHandlerEntry>();
      if (zip != null) {
        map.put("",new ArchiveHandlerEntry("",null,true));
        final Iterator<? extends ArchiveEntry> entries=zip.entries();
        while (entries.hasNext()) {
          ArchiveEntry entry=entries.next();
          final String name=entry.getName();
          final boolean isDirectory=StringUtil.endsWithChar(name,'/');
          getOrCreate(isDirectory ? name.substring(0,name.length() - 1) : name,isDirectory,map);
        }
        myRelPathsToEntries=new SoftReference<Map<String,ArchiveHandlerEntry>>(map);
      }
    }
    return map;
  }
}
