{
  Project project=vcsContext.getProject();
  if (project != null) {
    String actionName=getCompleteActionName(vcsContext);
    if (myActionInfo.showOptions(project) || OptionsDialog.shiftIsPressed(vcsContext.getModifiers())) {
      actionName+="...";
    }
    presentation.setText(actionName);
    presentation.setVisible(true);
    presentation.setEnabled(true);
    if (supportingVcsesAreEmpty(vcsContext.getProject(),myActionInfo)) {
      presentation.setVisible(false);
      presentation.setEnabled(false);
    }
    if (filterRootsBeforeAction()) {
      FilePath[] roots=filterRoots(myScopeInfo.getRoots(vcsContext,myActionInfo),vcsContext);
      if (roots.length == 0) {
        presentation.setVisible(false);
        presentation.setEnabled(false);
      }
    }
    if (presentation.isVisible() && presentation.isEnabled() && ProjectLevelVcsManager.getInstance(project).isBackgroundVcsOperationRunning()) {
      presentation.setEnabled(false);
    }
  }
 else {
    presentation.setVisible(false);
    presentation.setEnabled(false);
  }
}
