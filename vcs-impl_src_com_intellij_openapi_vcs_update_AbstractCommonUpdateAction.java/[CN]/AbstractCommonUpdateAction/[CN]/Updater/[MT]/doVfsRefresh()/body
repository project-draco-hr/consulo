{
  final LocalHistoryAction action=LocalHistory.startAction(myProject,VcsBundle.message("local.history.update.from.vcs"));
  try {
    final Semaphore semaphore=new Semaphore();
    semaphore.down();
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        VcsUtil.refreshFiles(myRoots,new Runnable(){
          public void run(){
            semaphore.up();
          }
        }
);
      }
    }
);
    semaphore.waitFor();
  }
  finally {
    action.finish();
  }
}
