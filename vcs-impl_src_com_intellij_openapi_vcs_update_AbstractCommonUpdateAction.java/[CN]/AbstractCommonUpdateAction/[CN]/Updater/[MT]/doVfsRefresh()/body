{
  final String actionName=VcsBundle.message("local.history.update.from.vcs");
  final LocalHistoryAction action=LocalHistory.startAction(myProject,actionName);
  try {
    final Semaphore semaphore=new Semaphore();
    semaphore.down();
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        LOG.info("Calling refresh files after update for roots: " + Arrays.toString(myRoots));
        VcsUtil.refreshFiles(myRoots,new Runnable(){
          public void run(){
            semaphore.up();
          }
        }
);
      }
    }
);
    semaphore.waitFor();
  }
  finally {
    action.finish();
    LocalHistory.putSystemLabel(myProject,actionName);
  }
}
