{
  RestoreUpdateTree restoreUpdateTree=RestoreUpdateTree.getInstance(myProject);
  restoreUpdateTree.registerUpdateInformation(myUpdatedFiles,myActionInfo);
  final String text=getTemplatePresentation().getText() + ((willBeContinued || (myUpdateNumber > 1)) ? ("#" + myUpdateNumber) : "");
  final UpdateInfoTree updateInfoTree=myProjectLevelVcsManager.showUpdateProjectInfo(myUpdatedFiles,text,myActionInfo);
  updateInfoTree.setBefore(myBefore);
  updateInfoTree.setAfter(myAfter);
  if (updateInfoTree != null) {
    updateInfoTree.setCanGroupByChangeList(canGroupByChangelist(myVcsToVirtualFiles.keySet()));
    final MessageBusConnection messageBusConnection=myProject.getMessageBus().connect();
    messageBusConnection.subscribe(CommittedChangesCache.COMMITTED_TOPIC,new CommittedChangesAdapter(){
      public void incomingChangesUpdated(      final List<CommittedChangeList> receivedChanges){
        if (receivedChanges != null) {
          ApplicationManager.getApplication().invokeLater(new Runnable(){
            public void run(){
              updateInfoTree.setChangeLists(receivedChanges);
            }
          }
,myProject.getDisposed());
          messageBusConnection.disconnect();
        }
      }
    }
);
  }
}
