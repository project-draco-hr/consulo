{
  final Set<InspectionTreeNode> children=new HashSet<InspectionTreeNode>();
  TreeUtil.traverseDepth(packageNode,new TreeUtil.Traverse(){
    public boolean accept(    Object node){
      children.add((InspectionTreeNode)node);
      return true;
    }
  }
);
  RefElementNode nodeToAdd=new RefElementNode(refElement,this);
  boolean firstLevel=true;
  RefElementNode prevNode=null;
  while (true) {
    RefElementNode currentNode=firstLevel ? nodeToAdd : new RefElementNode(refElement,this);
    for (    InspectionTreeNode node : children) {
      if (node instanceof RefElementNode) {
        final RefElementNode refElementNode=(RefElementNode)node;
        if (Comparing.equal(refElementNode.getElement(),refElement)) {
          if (firstLevel) {
            return refElementNode;
          }
 else {
            refElementNode.add(prevNode);
            return nodeToAdd;
          }
        }
      }
    }
    if (!firstLevel) {
      currentNode.add(prevNode);
    }
    RefEntity owner=refElement.getOwner();
    if (!(owner instanceof RefElement)) {
      packageNode.add(currentNode);
      return nodeToAdd;
    }
    refElement=(RefElement)owner;
    prevNode=currentNode;
    firstLevel=false;
  }
}
