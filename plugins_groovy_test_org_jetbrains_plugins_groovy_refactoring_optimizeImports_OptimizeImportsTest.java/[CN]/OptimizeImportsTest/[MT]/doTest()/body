{
  CodeStyleSettings settings=CodeStyleSettingsManager.getSettings(getProject()).clone();
  CodeStyleSettingsManager.getInstance(getProject()).setTemporarySettings(settings);
  settings.CLASS_COUNT_TO_USE_IMPORT_ON_DEMAND=3;
  try {
    myFixture.configureByFile(getTestName(false) + ".groovy");
    final String oldText=myFixture.getEditor().getDocument().getText();
    doOptimizeImports();
    PostprocessReformattingAspect.getInstance(getProject()).doPostponedFormatting();
    ((DocumentEx)myFixture.getEditor().getDocument()).stripTrailingSpaces(false);
    myFixture.checkResultByFile(getTestName(false) + "_after.groovy");
    final String newText=myFixture.getEditor().getDocument().getText();
    if (oldText.equals(newText)) {
      myFixture.doHighlighting();
      assertEmpty(GroovyImportsTracker.getInstance(getProject()).getUnusedImportStatements((GroovyFile)myFixture.getFile()));
    }
  }
  finally {
    CodeStyleSettingsManager.getInstance(getProject()).dropTemporarySettings();
  }
}
