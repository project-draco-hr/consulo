{
  CodeStyleSettings settings=CodeStyleSettingsManager.getSettings(getProject()).clone();
  CodeStyleSettingsManager.getInstance(getProject()).setTemporarySettings(settings);
  settings.CLASS_COUNT_TO_USE_IMPORT_ON_DEMAND=3;
  try {
    myFixture.configureByFile(filePath);
    GroovyImportOptimizer optimizer=new GroovyImportOptimizer();
    final Runnable runnable=optimizer.processFile(myFixture.getFile());
    CommandProcessor.getInstance().executeCommand(getProject(),new Runnable(){
      public void run(){
        ApplicationManager.getApplication().runWriteAction(runnable);
      }
    }
,"Optimize imports",null);
    myFixture.checkResultByFile("result.test");
  }
  finally {
    CodeStyleSettingsManager.getInstance(getProject()).dropTemporarySettings();
  }
}
