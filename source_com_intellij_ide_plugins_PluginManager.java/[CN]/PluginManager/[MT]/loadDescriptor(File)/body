{
  PluginDescriptor descriptor=null;
  if (file.isDirectory()) {
    File descriptorFile=new File(file,"META-INF" + File.separator + "plugin.xml");
    if (descriptorFile.exists()) {
      descriptor=new PluginDescriptor(file);
      try {
        descriptor.readExternal(JDOMUtil.loadDocument(descriptorFile).getRootElement());
      }
 catch (      Exception e) {
        System.err.println("Cannot load: " + descriptorFile.getAbsolutePath());
        e.printStackTrace();
      }
    }
 else {
      File libDir=new File(file,"lib");
      if (!libDir.isDirectory()) {
        return null;
      }
      final File[] files=libDir.listFiles();
      if (files == null || files.length == 0) {
        return null;
      }
      for (int i=0; i < files.length; i++) {
        final File f=files[i];
        if (!f.isFile()) {
          continue;
        }
        final String lowercasedName=f.getName().toLowerCase();
        if (lowercasedName.endsWith(".jar") || lowercasedName.endsWith(".zip")) {
          PluginDescriptor descriptor1=loadDescriptorFromJar(f);
          if (descriptor1 != null) {
            if (descriptor != null) {
              getLogger().info("Cannot load " + file + " because two or more plugin.xml's detected");
              return null;
            }
            descriptor=descriptor1;
            descriptor.setPath(file);
          }
        }
      }
    }
  }
 else   if (file.getName().endsWith(".jar")) {
    descriptor=loadDescriptorFromJar(file);
  }
  return descriptor;
}
