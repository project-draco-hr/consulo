{
  PathManager.loadProperties();
  try {
    addParentClasspath(classpathElements);
    addIDEALibraries(classpathElements);
    addAdditionalClassPath(classpathElements);
  }
 catch (  IllegalArgumentException e) {
    JOptionPane.showMessageDialog(JOptionPane.getRootFrame(),e.getMessage(),CommonBundle.getErrorTitle(),JOptionPane.INFORMATION_MESSAGE);
    System.exit(1);
  }
catch (  MalformedURLException e) {
    JOptionPane.showMessageDialog(JOptionPane.getRootFrame(),e.getMessage(),CommonBundle.getErrorTitle(),JOptionPane.INFORMATION_MESSAGE);
    System.exit(1);
  }
  IdeaClassLoader newClassLoader=null;
  try {
    newClassLoader=new IdeaClassLoader(classpathElements,null);
    if (!isLoadingOfExternalPluginsDisabled()) {
      PluginInstaller.initPluginClasses();
      StartupActionScriptManager.executeActionScript();
    }
    Thread.currentThread().setContextClassLoader(newClassLoader);
  }
 catch (  Exception e) {
    Logger logger=getLogger();
    if (logger == null) {
      e.printStackTrace(System.err);
    }
 else {
      logger.error(e);
    }
  }
  return newClassLoader;
}
