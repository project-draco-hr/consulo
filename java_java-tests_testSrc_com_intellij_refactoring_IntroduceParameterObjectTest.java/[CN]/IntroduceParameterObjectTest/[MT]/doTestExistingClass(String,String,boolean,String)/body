{
  doTest(new PerformAction(){
    @Override public void performAction(    final VirtualFile rootDir,    final VirtualFile rootAfter) throws Exception {
      PsiClass aClass=myJavaFacade.findClass("Test",GlobalSearchScope.projectScope(getProject()));
      if (aClass == null) {
        aClass=myJavaFacade.findClass("p2.Test",GlobalSearchScope.projectScope(getProject()));
      }
      assertNotNull("Class Test not found",aClass);
      final PsiMethod method=aClass.findMethodsByName("foo",false)[0];
      IntroduceParameterObjectProcessor processor=new IntroduceParameterObjectProcessor(existingClassName,existingClassPackage,method,generateParams(method),false,true,false,newVisibility,generateAccessors);
      processor.run();
      LocalFileSystem.getInstance().refresh(false);
      FileDocumentManager.getInstance().saveAllDocuments();
    }
  }
);
}
