{
  Module dep=new WriteCommandAction<Module>(getProject()){
    @Override protected void run(    Result<Module> result) throws Throwable {
      final ModifiableModuleModel moduleModel=ModuleManager.getInstance(getProject()).getModifiableModel();
      moduleModel.newModule("dependent/dependent.iml",StdModuleTypes.JAVA);
      moduleModel.commit();
      final Module dep=ModuleManager.getInstance(getProject()).findModuleByName("dependent");
      final ModifiableRootModel model=ModuleRootManager.getInstance(dep).getModifiableModel();
      model.addModuleOrderEntry(myModule);
      final VirtualFile depRoot=myFixture.getTempDirFixture().getFile("dependent");
      final ContentEntry entry=model.addContentEntry(depRoot);
      entry.addSourceFolder(depRoot,false);
      model.setSdk(ModuleRootManager.getInstance(myModule).getSdk());
      model.commit();
      result.setResult(dep);
    }
  }
.execute().getResultObject();
  return dep;
}
