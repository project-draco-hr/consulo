{
  final AbstractVcs vcs=ProjectLevelVcsManager.getInstance(project).findVcsByName(vcsKey.getName());
  if (vcs == null)   return;
  final String title=VcsBundle.message("paths.affected.in.revision",revision instanceof ShortVcsRevisionNumber ? ((ShortVcsRevisionNumber)revision).toShortString() : revision.asString());
  final CommittedChangeList[] list=new CommittedChangeList[1];
  final VcsException[] exc=new VcsException[1];
  ProgressManager.getInstance().run(new Task.Backgroundable(project,title,true,BackgroundFromStartOption.getInstance()){
    @Override public void run(    @NotNull ProgressIndicator indicator){
      try {
        final Pair<CommittedChangeList,FilePath> pair=vcs.getCommittedChangesProvider().getOneList(virtualFile,revision);
        if (pair != null) {
          list[0]=pair.getFirst();
        }
      }
 catch (      VcsException e) {
        exc[0]=e;
      }
    }
    @Override public void onSuccess(){
      final AbstractVcsHelper instance=AbstractVcsHelper.getInstance(project);
      if (exc[0] != null) {
        instance.showError(exc[0],failedText(virtualFile,revision));
      }
 else       if (list[0] == null) {
        Messages.showErrorDialog(project,failedText(virtualFile,revision),getTitle());
      }
 else {
        instance.showChangesListBrowser(list[0],virtualFile,title);
      }
    }
  }
);
}
