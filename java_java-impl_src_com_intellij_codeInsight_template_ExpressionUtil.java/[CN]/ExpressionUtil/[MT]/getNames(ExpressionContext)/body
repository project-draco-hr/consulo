{
  final Project project=context.getProject();
  final int offset=context.getStartOffset();
  PsiDocumentManager.getInstance(project).commitAllDocuments();
  String[] names=null;
  PsiFile file=PsiDocumentManager.getInstance(project).getPsiFile(context.getEditor().getDocument());
  PsiElement element=file.findElementAt(offset);
  if (element instanceof PsiIdentifier) {
    names=getNamesForIdentifier(project,(PsiIdentifier)element);
  }
 else {
    final PsiFile fileCopy=(PsiFile)file.copy();
    ApplicationManager.getApplication().runWriteAction(new Runnable(){
      public void run(){
        BlockSupport blockSupport=ServiceManager.getService(project,BlockSupport.class);
        CodeStyleManagerImpl.setSequentialProcessingAllowed(false);
        try {
          blockSupport.reparseRange(fileCopy,offset,offset,"xxx");
        }
 catch (        IncorrectOperationException e) {
          LOG.error(e);
        }
      }
    }
);
    PsiElement identifierCopy=fileCopy.findElementAt(offset);
    if (identifierCopy instanceof PsiIdentifier) {
      names=getNamesForIdentifier(project,(PsiIdentifier)identifierCopy);
    }
  }
  return names;
}
