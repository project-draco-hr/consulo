{
  final VirtualFile oldParent=myCurrent.getParent();
  final VirtualFile afterFile;
  if (myNewParent.equals(oldParent)) {
    afterFile=myCurrent;
  }
 else {
    myCurrent.move(PatchApplier.class,myNewParent);
    afterFile=myCurrent;
  }
  if (!Comparing.equal(myCurrent.getName(),myNewName)) {
    afterFile.rename(PatchApplier.class,myNewName);
  }
  return afterFile;
}
