{
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  final ChangeRequestChain chain=e.getData(VcsDataKeys.DIFF_REQUEST_CHAIN);
  if ((project == null) || (chain == null) || (!chain.canMoveBack())) {
    return;
  }
  final DiffViewer diffViewer=e.getData(PlatformDataKeys.DIFF_VIEWER);
  if (diffViewer == null)   return;
  final DiffRequest request=chain.moveBack();
  if (request != null) {
    if (diffViewer.getContentsNumber() == request.getContents().length) {
      diffViewer.setDiffRequest(request);
    }
 else {
      final Window window=KeyboardFocusManager.getCurrentKeyboardFocusManager().getActiveWindow();
      window.setVisible(false);
      DiffManager.getInstance().getDiffTool().show(request);
    }
  }
}
