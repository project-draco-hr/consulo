{
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  final ChangeRequestChain chain=e.getData(VcsDataKeys.DIFF_REQUEST_CHAIN);
  if ((project == null) || (chain == null) || (!chain.canMoveBack())) {
    return;
  }
  DiffViewer diffViewer=e.getData(PlatformDataKeys.COMPOSITE_DIFF_VIEWER);
  if (diffViewer == null) {
    diffViewer=e.getData(PlatformDataKeys.DIFF_VIEWER);
  }
  if (diffViewer == null)   return;
  final DiffRequest request=chain.moveBack();
  if (request != null) {
    if (diffViewer.acceptsType(request.getType())) {
      diffViewer.setDiffRequest(request);
    }
 else {
      final Window window=KeyboardFocusManager.getCurrentKeyboardFocusManager().getActiveWindow();
      if (window != null) {
        window.setVisible(false);
      }
 else {
        JComponent current=(JComponent)diffViewer;
        final Window windowAncestor=SwingUtilities.getWindowAncestor(current);
        if (windowAncestor != null) {
          windowAncestor.setVisible(false);
        }
      }
      DiffManager.getInstance().getDiffTool().show(request);
    }
  }
}
