{
  if (ApplicationManager.getApplication().isUnitTestMode()) {
    return;
  }
  Runnable task=new Runnable(){
    @SuppressWarnings("unchecked") @Override public void run(){
      for (      ExternalSystemManager<?,?,?,?,?> manager : ExternalSystemApiUtil.getAllManagers()) {
        if (manager instanceof StartupActivity) {
          ((StartupActivity)manager).runActivity(project);
        }
      }
      if (project.getUserData(ExternalSystemDataKeys.NEWLY_IMPORTED_PROJECT) != Boolean.TRUE) {
        for (        ExternalSystemManager manager : ExternalSystemManager.EP_NAME.getExtensions()) {
          ExternalSystemUtil.refreshProjects(project,manager.getSystemId(),false);
        }
      }
      ExternalSystemAutoImporter.letTheMagicBegin(project);
      ExternalToolWindowManager.handle(project);
      ExternalSystemVcsRegistrar.handle(project);
      ProjectRenameAware.beAware(project);
    }
  }
;
  if (project.isInitialized()) {
    task.run();
  }
 else {
    StartupManager.getInstance(project).registerPostStartupActivity(task);
  }
}
