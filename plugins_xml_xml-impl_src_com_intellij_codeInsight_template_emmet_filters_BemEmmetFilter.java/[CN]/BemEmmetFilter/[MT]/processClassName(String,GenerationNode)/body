{
  className=fillWithBemElements(className,node);
  className=fillWithBemModifiers(className,node);
  BemState nodeBemState=BEM_STATE.get(node);
  BemState bemState=extractBemStateFromClassName(className);
  List<String> result=newLinkedList();
  if (!bemState.isEmpty()) {
    String block=bemState.getBlock();
    if (isNullOrEmpty(block)) {
      block=nullToEmpty(nodeBemState != null ? nodeBemState.getBlock() : null);
      bemState.setBlock(block);
    }
    String prefix=block;
    String element=bemState.getElement();
    if (!isNullOrEmpty(element)) {
      prefix+=ELEMENT_SEPARATOR + element;
    }
    result.add(prefix);
    String modifier=bemState.getModifier();
    if (!isNullOrEmpty(modifier)) {
      result.add(prefix + MODIFIER_SEPARATOR + modifier);
    }
    BEM_STATE.set(node,bemState.copy());
  }
 else {
    result.add(className);
  }
  return result;
}
