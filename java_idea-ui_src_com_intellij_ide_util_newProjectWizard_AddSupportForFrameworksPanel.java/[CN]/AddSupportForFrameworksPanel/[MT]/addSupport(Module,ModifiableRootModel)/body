{
  List<Library> addedLibraries=new ArrayList<Library>();
  List<FrameworkSupportNode> selectedFrameworks=getFrameworkNodes(true);
  sortFrameworks(selectedFrameworks);
  for (  FrameworkSupportNode node : selectedFrameworks) {
    FrameworkSupportConfigurable configurable=node.getConfigurable();
    final LibraryCompositionSettings settings=node.getLibraryCompositionSettings();
    Library library=settings != null ? settings.addLibraries(rootModel,addedLibraries) : null;
    configurable.addSupport(module,rootModel,library);
  }
  for (  FrameworkSupportNode node : selectedFrameworks) {
    FrameworkSupportProvider provider=node.getProvider();
    if (provider instanceof FacetBasedFrameworkSupportProvider && !addedLibraries.isEmpty()) {
      ((FacetBasedFrameworkSupportProvider)provider).processAddedLibraries(module,addedLibraries);
    }
  }
}
