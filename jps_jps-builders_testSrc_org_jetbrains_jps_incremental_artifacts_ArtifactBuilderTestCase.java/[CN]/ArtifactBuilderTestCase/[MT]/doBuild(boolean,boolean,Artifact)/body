{
  if (myDescriptor == null) {
    myDescriptor=createProjectDescriptor();
    myDescriptor.incUsageCounter();
  }
  myArtifactBuilderLogger.clear();
  IncProjectBuilder builder=new IncProjectBuilder(myDescriptor,BuilderRegistry.getInstance(),Collections.<String,String>emptyMap(),CanceledStatus.NULL);
  final Ref<BuildMessage> errorMessage=Ref.create(null);
  builder.addMessageHandler(new MessageHandler(){
    @Override public void processMessage(    BuildMessage msg){
      if (msg.getKind() == BuildMessage.Kind.ERROR && errorMessage.isNull()) {
        errorMessage.set(msg);
      }
    }
  }
);
  builder.build(new AllProjectScope(myDescriptor.project,new HashSet<Artifact>(Arrays.asList(artifacts)),force),!force,false);
  if (shouldFail) {
    assertFalse("Build not failed as expected",errorMessage.isNull());
  }
 else {
    assertNull("Build failed: " + errorMessage.get(),errorMessage.get());
  }
}
