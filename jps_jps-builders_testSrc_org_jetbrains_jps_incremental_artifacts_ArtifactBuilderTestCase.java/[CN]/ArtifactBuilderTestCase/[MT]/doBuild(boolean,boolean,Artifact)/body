{
  if (myDescriptor == null) {
    myDescriptor=createProjectDescriptor();
    myDescriptor.incUsageCounter();
  }
  myArtifactBuilderLogger.clear();
  final Timestamps timestamps=myDescriptor.timestamps.getStorage();
  IncProjectBuilder builder=new IncProjectBuilder(myDescriptor,BuilderRegistry.getInstance(),timestamps,Collections.<String,String>emptyMap(),CanceledStatus.NULL,null);
  final List<BuildMessage> errorMessages=new ArrayList<BuildMessage>();
  final List<BuildMessage> infoMessages=new ArrayList<BuildMessage>();
  builder.addMessageHandler(new MessageHandler(){
    @Override public void processMessage(    BuildMessage msg){
      if (msg.getKind() == BuildMessage.Kind.ERROR) {
        errorMessages.add(msg);
      }
 else {
        infoMessages.add(msg);
      }
    }
  }
);
  try {
    builder.build(new AllProjectScope(myDescriptor.project,new HashSet<Artifact>(Arrays.asList(artifacts)),force),!force,false,false);
  }
 catch (  RebuildRequestedException e) {
    fail(e.getMessage());
  }
  if (shouldFail) {
    assertFalse("Build not failed as expected",errorMessages.isEmpty());
  }
 else {
    assertTrue("Build failed. \nErrors:\n" + errorMessages + "\nInfo messages:\n"+ infoMessages,errorMessages.isEmpty());
  }
}
