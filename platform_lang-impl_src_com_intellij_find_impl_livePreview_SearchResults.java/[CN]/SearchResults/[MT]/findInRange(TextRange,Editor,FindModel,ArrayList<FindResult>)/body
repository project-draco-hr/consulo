{
  VirtualFile virtualFile=FileDocumentManager.getInstance().getFile(editor.getDocument());
  CharSequence charSequence=editor.getDocument().getCharsSequence();
  int offset=r.getStartOffset();
  int maxOffset=Math.min(r.getEndOffset(),charSequence.length());
  FindManager findManager=FindManager.getInstance(getProject());
  while (true) {
    FindResult result;
    try {
      CharSequence bombedCharSequence=StringUtil.newBombedCharSequence(charSequence,3000);
      result=findManager.findString(bombedCharSequence,offset,findModel,virtualFile);
    }
 catch (    PatternSyntaxException e) {
      result=null;
    }
catch (    ProcessCanceledException e) {
      result=null;
    }
    if (result == null || !result.isStringFound())     break;
    int newOffset=result.getEndOffset();
    if (result.getEndOffset() > maxOffset)     break;
    if (offset == newOffset) {
      if (offset < maxOffset - 1) {
        offset++;
      }
 else {
        results.add(result);
        break;
      }
    }
 else {
      offset=newOffset;
    }
    results.add(result);
  }
}
