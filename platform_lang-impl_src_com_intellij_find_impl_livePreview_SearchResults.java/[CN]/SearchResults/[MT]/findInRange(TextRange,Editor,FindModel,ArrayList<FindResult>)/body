{
  VirtualFile virtualFile=FileDocumentManager.getInstance().getFile(editor.getDocument());
  int offset=r.getStartOffset();
  while (true) {
    FindManager findManager=FindManager.getInstance(editor.getProject());
    FindResult result;
    try {
      BombedCharSequence bombedCharSequence=new BombedCharSequence(editor.getDocument().getCharsSequence(),System.currentTimeMillis() + 3000);
      result=findManager.findString(bombedCharSequence,offset,findModel,virtualFile);
    }
 catch (    PatternSyntaxException e) {
      result=null;
    }
catch (    ProcessCanceledException e) {
      result=null;
    }
    if (result == null || !result.isStringFound())     break;
    int newOffset=result.getEndOffset();
    if (offset == newOffset || result.getEndOffset() > r.getEndOffset())     break;
    offset=newOffset;
    results.add(result);
    if (results.size() > myMatchesLimit)     break;
  }
}
