{
  for (  VirtualFile root : extractRoots(changes)) {
    HgCommitCommand command=new HgCommitCommand(project,root,commitMessage);
    try {
      command.execute();
      VcsUtil.showStatusMessage(project,HgVcsMessages.message("hg4idea.commit.success",root.getPath()));
      HgUtil.markDirectoryDirty(project,root);
      root.refresh(true,true);
    }
 catch (    HgCommandException e) {
      VcsUtil.showErrorMessage(project,e.getMessage(),"Error");
    }
catch (    VcsException e) {
      VcsUtil.showErrorMessage(project,e.getMessage(),"Error");
    }
  }
}
