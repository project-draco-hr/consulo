{
  final PsiFile targetFile=targetClass.getContainingFile();
  final Editor newEditor=positionCursor(project,targetFile,field);
  if (newEditor == null)   return;
  Template template=CreateFieldFromUsageHelper.setupTemplate(field,expectedTypes,targetClass,newEditor,context,createConstantField);
  startTemplate(newEditor,template,project,new TemplateEditingAdapter(){
    @Override public void templateFinished(    Template template,    boolean brokenOff){
      PsiDocumentManager.getInstance(project).commitDocument(newEditor.getDocument());
      final int offset=newEditor.getCaretModel().getOffset();
      final PsiField psiField=PsiTreeUtil.findElementOfClassAtOffset(targetFile,offset,PsiField.class,false);
      if (psiField != null) {
        ApplicationManager.getApplication().runWriteAction(new Runnable(){
          @Override public void run(){
            CodeStyleManager.getInstance(project).reformat(psiField);
          }
        }
);
        newEditor.getCaretModel().moveToOffset(psiField.getTextRange().getEndOffset() - 1);
      }
    }
  }
);
}
