{
  Class marker=isMaven3 ? MavenArtifactResolvedM3RtMarker.class : MavenArtifactResolvedM2RtMarker.class;
  File classDirOrJar=new File(PathUtil.getJarPathForClass(marker));
  if (!classDirOrJar.isDirectory()) {
    return classDirOrJar.getAbsolutePath();
  }
  File tempFile=FileUtil.createTempFile("idea-","-artifactResolver.jar");
  tempFile.deleteOnExit();
  ZipOutputStream zipOutput=new ZipOutputStream(new FileOutputStream(tempFile));
  try {
    ZipUtil.addDirToZipRecursively(zipOutput,null,classDirOrJar,"",null,null);
    if (isMaven3) {
      File m2Module=new File(PathUtil.getJarPathForClass(MavenModuleMap.class));
      String commonClassesPath=MavenModuleMap.class.getPackage().getName().replace('.','/');
      ZipUtil.addDirToZipRecursively(zipOutput,null,new File(m2Module,commonClassesPath),commonClassesPath,null,null);
    }
  }
  finally {
    zipOutput.close();
  }
  return tempFile.getAbsolutePath();
}
