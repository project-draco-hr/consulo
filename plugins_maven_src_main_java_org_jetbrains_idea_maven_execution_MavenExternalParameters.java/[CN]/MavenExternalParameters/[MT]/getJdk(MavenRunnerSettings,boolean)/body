{
  String name=runnerSettings.getJreName();
  if (name.equals(MavenRunnerSettings.USE_INTERNAL_JAVA)) {
    return JavaAwareProjectJdkTableImpl.getInstanceEx().getInternalJdk();
  }
  if (name.equals(MavenRunnerSettings.USE_JAVA_HOME)) {
    final String javaHome=System.getenv(JAVA_HOME);
    if (StringUtil.isEmptyOrSpaces(javaHome)) {
      throw new ExecutionException(RunnerBundle.message("maven.java.home.undefined"));
    }
    final Sdk jdk=JavaSdk.getInstance().createJdk("",javaHome);
    if (jdk == null) {
      throw new ExecutionException(RunnerBundle.message("maven.java.home.invalid",javaHome));
    }
    return jdk;
  }
  for (  Sdk projectJdk : ProjectJdkTable.getInstance().getAllJdks()) {
    if (projectJdk.getName().equals(name)) {
      return projectJdk;
    }
  }
  if (isGlobalRunnerSettings) {
    throw new ExecutionException(RunnerBundle.message("maven.java.not.found.default.config",name));
  }
 else {
    throw new ExecutionException(RunnerBundle.message("maven.java.not.found",name));
  }
}
