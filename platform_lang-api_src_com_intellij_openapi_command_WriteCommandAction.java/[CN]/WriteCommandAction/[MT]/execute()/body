{
  if (!ApplicationManager.getApplication().isDispatchThread() && ApplicationManager.getApplication().isReadAccessAllowed()) {
    LOG.error("Must not start write action from within read action in the other thread - deadlock is coming");
  }
  final RunResult<T> result=new RunResult<T>(this);
  try {
    Runnable runnable=new Runnable(){
      @Override public void run(){
        performWriteCommandAction(result);
      }
    }
;
    Application application=ApplicationManager.getApplication();
    if (application.isDispatchThread()) {
      runnable.run();
    }
 else     if (application.isReadAccessAllowed()) {
      LOG.error("Calling write command from read-action leads to deadlock.");
    }
 else {
      SwingUtilities.invokeAndWait(runnable);
    }
  }
 catch (  InvocationTargetException e) {
    throw new RuntimeException(e.getCause());
  }
catch (  InterruptedException ignored) {
  }
  return result;
}
