{
  if (configuration.isResourceFile(file)) {
    return false;
  }
  final FileType fileType=file.getFileType();
  if (fileType == GroovyFileType.GROOVY_FILE_TYPE) {
    AccessToken accessToken=ApplicationManager.getApplication().acquireReadActionLock();
    try {
      PsiFile psiFile=manager.findFile(file);
      if (psiFile instanceof GroovyFile && ((GroovyFile)psiFile).isScript()) {
        final GroovyScriptType scriptType=GroovyScriptTypeDetector.getScriptType((GroovyFile)psiFile);
        return scriptType.shouldBeCompiled((GroovyFile)psiFile);
      }
      return true;
    }
  finally {
      accessToken.finish();
    }
  }
  return fileType == StdFileTypes.JAVA;
}
