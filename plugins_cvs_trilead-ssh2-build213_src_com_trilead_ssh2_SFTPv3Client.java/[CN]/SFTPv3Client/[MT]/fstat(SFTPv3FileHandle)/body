{
  checkHandleValidAndOpen(handle);
  int req_id=generateNextRequestID();
  TypesWriter tw=new TypesWriter();
  tw.writeString(handle.fileHandle,0,handle.fileHandle.length);
  if (debug != null) {
    debug.println("Sending SSH_FXP_FSTAT...");
    debug.flush();
  }
  sendMessage(Packet.SSH_FXP_FSTAT,req_id,tw.getBytes());
  byte[] resp=receiveMessage(34000);
  if (debug != null) {
    debug.println("Got REPLY.");
    debug.flush();
  }
  TypesReader tr=new TypesReader(resp);
  int t=tr.readByte();
  int rep_id=tr.readUINT32();
  if (rep_id != req_id)   throw new IOException("The server sent an invalid id field.");
  if (t == Packet.SSH_FXP_ATTRS) {
    return readAttrs(tr);
  }
  if (t != Packet.SSH_FXP_STATUS)   throw new IOException("The SFTP server sent an unexpected packet type (" + t + ")");
  int errorCode=tr.readUINT32();
  throw new SFTPException(tr.readString(),errorCode);
}
