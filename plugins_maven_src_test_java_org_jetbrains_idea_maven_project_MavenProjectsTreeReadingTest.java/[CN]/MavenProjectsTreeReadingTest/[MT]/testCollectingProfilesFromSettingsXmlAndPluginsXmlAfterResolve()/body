{
  createProjectPom("<groupId>test</groupId>" + "<artifactId>project</artifactId>" + "<version>1</version>"+ "<profiles>"+ "  <profile>"+ "    <id>one</id>"+ "  </profile>"+ "</profiles>");
  createProfilesXml("<profile>" + "  <id>two</id>" + "</profile>");
  updateSettingsXml("<profiles>" + "  <profile>" + "    <id>three</id>"+ "  </profile>"+ "</profiles>");
  updateAll(myProjectPom);
  MavenEmbeddersManager embeddersManager=new MavenEmbeddersManager(myProject);
  try {
    myTree.resolve(myProject,myTree.getRootProjects().get(0),getMavenGeneralSettings(),embeddersManager,NULL_MAVEN_CONSOLE,EMPTY_MAVEN_PROCESS);
  }
  finally {
    embeddersManager.releaseInTests();
  }
  assertUnorderedElementsAreEqual(myTree.getAvailableProfiles(),"one","two","three");
}
