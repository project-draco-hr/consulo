{
  final int len=getTextLength();
  char[] buffer=new char[len];
  final int endOffset;
  try {
    endOffset=AstBufferUtil.toBuffer(this,buffer,0);
  }
 catch (  ArrayIndexOutOfBoundsException e) {
    String msg="Underestimated text length: " + len;
    msg+=diagnoseTextInconsistency(new String(buffer));
    try {
      int length=AstBufferUtil.toBuffer(this,new char[len],0);
      msg+=";\n repetition gives success (" + length + ")";
    }
 catch (    ArrayIndexOutOfBoundsException e1) {
      msg+=";\n repetition fails as well";
    }
    throw new RuntimeException(msg,e);
  }
  if (endOffset != len) {
    String msg="len=" + len + ";\n endOffset="+ endOffset;
    msg+=diagnoseTextInconsistency(new String(buffer,0,endOffset));
    throw new AssertionError(msg);
  }
  return buffer;
}
