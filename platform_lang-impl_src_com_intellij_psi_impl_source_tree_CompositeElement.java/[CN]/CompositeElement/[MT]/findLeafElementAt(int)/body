{
  TreeElement child=getFirstChildNode();
  while (child != null) {
    final int textLength=child.getTextLength();
    if (textLength > offset) {
      if (child instanceof ForeignLeafPsiElement) {
        child=child.getTreeNext();
        continue;
      }
      return child.findLeafElementAt(offset);
    }
    offset-=textLength;
    child=child.getTreeNext();
  }
  return null;
}
