{
synchronized (PsiLock.LOCK) {
    CompositeElement compositeElement=this;
    while (compositeElement != null) {
      compositeElement.clearCaches();
      if (!(compositeElement instanceof PsiElement)) {
        final PsiElement psi=compositeElement.myWrapper;
        if (psi instanceof ASTDelegatePsiElement) {
          ((ASTDelegatePsiElement)psi).subtreeChanged();
        }
 else         if (psi instanceof PsiFile) {
          ((PsiFile)psi).subtreeChanged();
        }
      }
      compositeElement=compositeElement.getTreeParent();
    }
  }
}
