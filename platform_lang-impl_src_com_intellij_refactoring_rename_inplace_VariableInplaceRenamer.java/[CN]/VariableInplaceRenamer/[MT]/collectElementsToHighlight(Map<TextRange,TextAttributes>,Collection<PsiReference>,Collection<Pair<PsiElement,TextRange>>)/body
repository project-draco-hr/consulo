{
  EditorColorsManager colorsManager=EditorColorsManager.getInstance();
  PsiElement nameIdentifier=getNameIdentifier();
  if (nameIdentifier != null) {
    final TextRange textRange=nameIdentifier.getTextRange();
    LOG.assertTrue(textRange != null,nameIdentifier);
    TextRange range=InjectedLanguageManager.getInstance(myProject).injectedToHost(nameIdentifier,textRange);
    rangesToHighlight.put(range,colorsManager.getGlobalScheme().getAttributes(EditorColors.WRITE_SEARCH_RESULT_ATTRIBUTES));
  }
  for (  PsiReference ref : refs) {
    final PsiElement element=ref.getElement();
    TextRange range=ref.getRangeInElement().shiftRight(InjectedLanguageManager.getInstance(element.getProject()).injectedToHost(element,element.getTextRange().getStartOffset()));
    ReadWriteAccessDetector writeAccessDetector=ReadWriteAccessDetector.findDetector(element);
    boolean isForWrite=writeAccessDetector != null && ReadWriteAccessDetector.Access.Write == writeAccessDetector.getExpressionAccess(element);
    TextAttributes attributes=colorsManager.getGlobalScheme().getAttributes(isForWrite ? EditorColors.WRITE_SEARCH_RESULT_ATTRIBUTES : EditorColors.SEARCH_RESULT_ATTRIBUTES);
    rangesToHighlight.put(range,attributes);
  }
  collectAdditionalRangesToHighlight(rangesToHighlight,stringUsages,colorsManager);
}
