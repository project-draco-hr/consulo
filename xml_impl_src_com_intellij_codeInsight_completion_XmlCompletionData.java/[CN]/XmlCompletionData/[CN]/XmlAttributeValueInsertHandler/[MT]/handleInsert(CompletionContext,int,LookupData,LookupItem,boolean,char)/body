{
  super.handleInsert(context,startOffset,data,item,signatureSelected,completionChar);
  final PsiElement current=context.file.findElementAt(context.startOffset);
  final String text=current.getText();
  final CaretModel caretModel=context.editor.getCaretModel();
  int localOffset=caretModel.getOffset() - current.getTextRange().getStartOffset() - 1;
  startOffset=localOffset;
  while (localOffset > 0 && localOffset < text.length()) {
    final char cur=text.charAt(localOffset--);
    if (cur == '}')     break;
    if (cur == '{') {
      if (localOffset >= 0 && text.charAt(localOffset) == '$') {
        if (startOffset >= text.length() - 1 || text.charAt(startOffset + 1) != '}') {
          context.editor.getDocument().insertString(caretModel.getOffset(),"}");
        }
        caretModel.moveToOffset(caretModel.getOffset() + 1);
      }
      break;
    }
  }
}
