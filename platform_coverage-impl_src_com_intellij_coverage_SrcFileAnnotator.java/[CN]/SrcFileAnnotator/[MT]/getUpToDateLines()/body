{
  final Ref<String[]> linesRef=new Ref<String[]>();
  final Runnable runnable=new Runnable(){
    public void run(){
      final int lineCount=myDocument.getLineCount();
      final String[] lines=new String[lineCount];
      final CharSequence chars=myDocument.getCharsSequence();
      for (int i=0; i < lineCount; i++) {
        lines[i]=chars.subSequence(myDocument.getLineStartOffset(i),myDocument.getLineEndOffset(i)).toString();
      }
      linesRef.set(lines);
    }
  }
;
  ApplicationManager.getApplication().runReadAction(runnable);
  return linesRef.get();
}
