{
  String sdkPath=myWizard.getFacet().getConfiguration().getSdkPath();
  String zipAlignPath=sdkPath + File.separatorChar + AndroidUtils.toolPath(SdkConstants.FN_ZIPALIGN);
  File zipalign=new File(zipAlignPath);
  final boolean runZipAlign=zipalign.isFile();
  File destFile=null;
  try {
    destFile=runZipAlign ? FileUtil.createTempFile("android",".apk") : new File(apkPath);
    createApk(destFile);
  }
 catch (  Exception e) {
    showErrorInDispatchThread(e.getMessage());
  }
  if (destFile == null)   return;
  if (runZipAlign) {
    File realDestFile=new File(apkPath);
    final String message=executeZipAlign(zipAlignPath,destFile,realDestFile);
    if (message != null) {
      showErrorInDispatchThread(message);
      return;
    }
  }
  ApplicationManager.getApplication().invokeLater(new Runnable(){
    public void run(){
      String title=AndroidBundle.message("android.export.package.wizard.title");
      if (!runZipAlign) {
        Messages.showWarningDialog(myWizard.getProject(),"The zipalign tool was not found in the SDK.\n\n" + "Please update to the latest SDK and re-export your application\n" + "or run zipalign manually.\n\n"+ "Aligning applications allows Android to use application resources\n"+ "more efficiently.",title);
      }
      Messages.showInfoMessage(myWizard.getProject(),AndroidBundle.message("android.export.package.success.message",apkPath),title);
    }
  }
);
}
