{
  PsiElement[] psiElements=LangDataKeys.PSI_ELEMENT_ARRAY.getData(dataProvider);
  if (psiElements != null) {
    for (    PsiElement elem : psiElements) {
      VirtualFile virtualFile=PsiUtilBase.getVirtualFile(elem);
      if (virtualFile != null)       return virtualFile;
    }
  }
  VirtualFile[] virtualFiles=PlatformDataKeys.VIRTUAL_FILE_ARRAY.getData(dataProvider);
  if (virtualFiles != null && virtualFiles.length == 1) {
    return virtualFiles[0];
  }
  PsiFile psiFile=LangDataKeys.PSI_FILE.getData(dataProvider);
  if (psiFile != null) {
    return psiFile.getVirtualFile();
  }
  PsiElement elem=LangDataKeys.PSI_ELEMENT.getData(dataProvider);
  if (elem == null) {
    return null;
  }
  return PsiUtilBase.getVirtualFile(elem);
}
