{
  StringBuilder buf=new StringBuilder();
  removeAll();
  String[] lines=UIUtil.splitText(text,getFontMetrics(BOLD_FONT),myWidthLimit,',');
  myOneLineComponents=new OneLineComponent[lines.length];
  int lineOffset=0;
  for (int i=0; i < lines.length; i++) {
    String line=escapeString(lines[i]);
    myOneLineComponents[i]=new OneLineComponent();
    TextRange range=null;
    if (highlightStartOffset >= 0 && highlightEndOffset > lineOffset && highlightStartOffset < lineOffset + line.length()) {
      int startOffset=Math.max(highlightStartOffset - lineOffset,0);
      int endOffset=Math.min(highlightEndOffset - lineOffset,line.length());
      range=TextRange.create(startOffset,endOffset);
    }
    buf.append(myOneLineComponents[i].setup(line,isDisabled,strikeout,background,range));
    if (isDisabledBeforeHighlight) {
      if (highlightStartOffset < 0 || highlightEndOffset > lineOffset) {
        myOneLineComponents[i].setDisabledBeforeHighlight();
      }
    }
    add(myOneLineComponents[i],new GridBagConstraints(0,i,1,1,1,0,GridBagConstraints.WEST,GridBagConstraints.HORIZONTAL,new Insets(0,0,0,0),0,0));
    lineOffset+=line.length();
  }
  return buf.toString();
}
