{
  if (file instanceof VirtualFilePathWrapper) {
    return includeFilePath ? ((VirtualFilePathWrapper)file).getPresentablePath() : file.getName();
  }
  String url=includeFilePath ? file.getPresentableUrl() : file.getName();
  if (project == null) {
    return url;
  }
 else {
    final VirtualFile baseDir=project.getBaseDir();
    if (baseDir != null && includeFilePath) {
      final String projectHomeUrl=baseDir.getPresentableUrl();
      if (url.startsWith(projectHomeUrl)) {
        url="..." + url.substring(projectHomeUrl.length());
      }
    }
    final Module module=ModuleUtil.findModuleForFile(file,project);
    if (module == null)     return url;
    return SystemInfo.isMac ? new StringBuffer().append(url).append(" - [").append(module.getName()).append("]").toString() : new StringBuffer().append("[").append(module.getName()).append("] - ").append(url).toString();
  }
}
