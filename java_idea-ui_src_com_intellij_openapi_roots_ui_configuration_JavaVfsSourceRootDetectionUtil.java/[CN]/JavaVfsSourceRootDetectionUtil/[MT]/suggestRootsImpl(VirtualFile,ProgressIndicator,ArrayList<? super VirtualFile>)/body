{
  if (!dir.isDirectory()) {
    return;
  }
  FileTypeManager typeManager=FileTypeManager.getInstance();
  final String dirName=dir.getName();
  if (typeManager.isFileIgnored(dir) || StringUtil.startsWithIgnoreCase(dirName,"testdata")) {
    return;
  }
  if (progressIndicator.isCanceled()) {
    return;
  }
  progressIndicator.setText2(dir.getPath());
  VirtualFile[] list=dir.getChildren();
  if (list == null || list.length == 0) {
    return;
  }
  for (  VirtualFile child : list) {
    if (!child.isDirectory()) {
      FileType type=typeManager.getFileTypeByFileName(child.getName());
      if (StdFileTypes.JAVA == type) {
        if (progressIndicator.isCanceled()) {
          return;
        }
        VirtualFile root=suggestRootForJavaFile(child);
        if (root != null) {
          foundDirectories.add(root);
          throw new PathFoundException(root);
        }
 else {
          return;
        }
      }
    }
  }
  for (  VirtualFile child : list) {
    if (child.isDirectory()) {
      try {
        suggestRootsImpl(child,progressIndicator,foundDirectories);
      }
 catch (      PathFoundException found) {
        if (!found.myDirectory.equals(child)) {
          throw found;
        }
      }
    }
  }
}
