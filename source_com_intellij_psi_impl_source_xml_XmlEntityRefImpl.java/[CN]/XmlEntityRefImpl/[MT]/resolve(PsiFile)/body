{
  String text=getText();
  if (text.equals("&gt;") || text.equals("&quot;"))   return null;
  final String entityName=text.substring(1,text.length() - 1);
  final PsiElement targetElement=targetFile != null ? (PsiElement)targetFile : this;
  Map<String,CachedValue<XmlEntityDecl>> map=targetElement.getUserData(XML_ENTITY_DECL_MAP);
  if (map == null) {
    map=new HashMap<String,CachedValue<XmlEntityDecl>>();
    targetElement.putUserData(XML_ENTITY_DECL_MAP,map);
  }
  CachedValue<XmlEntityDecl> value=map.get(entityName);
  if (value == null) {
    if (getManager() == null) {
      return resolveEntity(targetElement,entityName).getValue();
    }
    value=getManager().getCachedValuesManager().createCachedValue(new CachedValueProvider<XmlEntityDecl>(){
      public CachedValueProvider.Result<XmlEntityDecl> compute(){
        return resolveEntity(targetElement,entityName);
      }
    }
);
    map.put(entityName,value);
  }
  return value.getValue();
}
