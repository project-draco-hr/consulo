{
  final String entityName=text.substring(1,text.length() - 1);
  if (PsiUtil.isInJspFile(targetFile)) {
    targetFile=(PsiUtil.getJspFile(targetFile)).getBaseLanguageRoot();
  }
  final PsiElement targetElement=targetFile != null ? (PsiElement)targetFile : element;
  Map<String,CachedValue<XmlEntityDecl>> map=getCachingMap(targetElement);
  CachedValue<XmlEntityDecl> value=map.get(entityName);
  if (value == null) {
    final PsiManager manager=element.getManager();
    if (manager == null) {
      return resolveEntity(targetElement,entityName).getValue();
    }
    value=manager.getCachedValuesManager().createCachedValue(new CachedValueProvider<XmlEntityDecl>(){
      public Result<XmlEntityDecl> compute(){
        return resolveEntity(targetElement,entityName);
      }
    }
);
    map.put(entityName,value);
  }
  return value.getValue();
}
