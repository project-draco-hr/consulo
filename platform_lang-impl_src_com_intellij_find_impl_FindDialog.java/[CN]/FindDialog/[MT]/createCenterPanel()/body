{
  JPanel optionsPanel=new JPanel();
  optionsPanel.setLayout(new GridBagLayout());
  GridBagConstraints gbConstraints=new GridBagConstraints();
  gbConstraints.weightx=1;
  gbConstraints.weighty=1;
  gbConstraints.fill=GridBagConstraints.BOTH;
  gbConstraints.gridwidth=GridBagConstraints.REMAINDER;
  JPanel topOptionsPanel=new JPanel();
  topOptionsPanel.setLayout(new GridLayout(1,2,UIUtil.DEFAULT_HGAP,0));
  topOptionsPanel.add(createFindOptionsPanel());
  optionsPanel.add(topOptionsPanel,gbConstraints);
  JPanel resultsOptionPanel=null;
  if (myModel.isMultipleFiles()) {
    optionsPanel.add(createGlobalScopePanel(),gbConstraints);
    gbConstraints.weightx=1;
    gbConstraints.weighty=1;
    gbConstraints.fill=GridBagConstraints.HORIZONTAL;
    gbConstraints.gridwidth=GridBagConstraints.REMAINDER;
    optionsPanel.add(createFilterPanel(),gbConstraints);
    myCbToSkipResultsWhenOneUsage=createCheckbox(FindSettings.getInstance().isSkipResultsWithOneUsage(),FindBundle.message("find.options.skip.results.tab.with.one.occurrence.checkbox"));
    resultsOptionPanel=createResultsOptionPanel(optionsPanel,gbConstraints);
    resultsOptionPanel.add(myCbToSkipResultsWhenOneUsage);
    myCbToSkipResultsWhenOneUsage.setVisible(!myModel.isReplaceState());
    if (haveResultsPreview()) {
      final JBTable table=new JBTable(){
        @Override public Dimension getPreferredSize(){
          return new Dimension(myInputComboBox.getWidth(),super.getPreferredSize().height);
        }
      }
;
      table.setShowColumns(false);
      table.setShowGrid(false);
      new NavigateToSourceListener().installOn(table);
      Splitter previewSplitter=new Splitter(true,0.5f,0.1f,0.9f);
      myUsagePreviewPanel=new UsagePreviewPanel(myProject,new UsageViewPresentation());
      myResultsPreviewTable=table;
      myResultsPreviewTable.getSelectionModel().addListSelectionListener(new ListSelectionListener(){
        @Override public void valueChanged(        ListSelectionEvent e){
          if (e.getValueIsAdjusting())           return;
          int index=myResultsPreviewTable.getSelectionModel().getLeadSelectionIndex();
          if (index != -1) {
            UsageInfo usageInfo=((UsageInfo2UsageAdapter)myResultsPreviewTable.getModel().getValueAt(index,0)).getUsageInfo();
            myUsagePreviewPanel.updateLayout(Collections.singletonList(usageInfo));
          }
 else {
            myUsagePreviewPanel.updateLayout(null);
          }
        }
      }
);
      mySearchRescheduleOnCancellationsAlarm=new Alarm();
      previewSplitter.setFirstComponent(new JBScrollPane(myResultsPreviewTable));
      previewSplitter.setSecondComponent(myUsagePreviewPanel.createComponent());
      myPreviewSplitter=previewSplitter;
    }
  }
 else {
    JPanel leftOptionsPanel=new JPanel();
    leftOptionsPanel.setLayout(new GridLayout(3,1,0,4));
    leftOptionsPanel.add(createDirectionPanel());
    leftOptionsPanel.add(createOriginPanel());
    leftOptionsPanel.add(createScopePanel());
    topOptionsPanel.add(leftOptionsPanel);
  }
  if (myModel.isOpenInNewTabVisible()) {
    myCbToOpenInNewTab=new JCheckBox(FindBundle.message("find.open.in.new.tab.checkbox"));
    myCbToOpenInNewTab.setFocusable(false);
    myCbToOpenInNewTab.setSelected(myModel.isOpenInNewTab());
    myCbToOpenInNewTab.setEnabled(myModel.isOpenInNewTabEnabled());
    if (resultsOptionPanel == null)     resultsOptionPanel=createResultsOptionPanel(optionsPanel,gbConstraints);
    resultsOptionPanel.add(myCbToOpenInNewTab);
  }
  if (myPreviewSplitter != null) {
    TabbedPane pane=new JBTabsPaneImpl(myProject,SwingConstants.TOP,myDisposable);
    pane.insertTab("Options",null,optionsPanel,null,0);
    pane.insertTab(PREVIEW_TITLE,null,myPreviewSplitter,null,RESULTS_PREVIEW_TAB_INDEX);
    myContent=pane;
    final AnAction anAction=new DumbAwareAction(){
      @RequiredDispatchThread @Override public void actionPerformed(      AnActionEvent e){
        int selectedIndex=myContent.getSelectedIndex();
        myContent.setSelectedIndex(1 - selectedIndex);
      }
    }
;
    final ShortcutSet shortcutSet=ActionManager.getInstance().getAction(IdeActions.ACTION_SWITCHER).getShortcutSet();
    anAction.registerCustomShortcutSet(shortcutSet,getRootPane(),myDisposable);
    if (myPreviewResultsTabWasSelected)     myContent.setSelectedIndex(RESULTS_PREVIEW_TAB_INDEX);
    return pane.getComponent();
  }
  return optionsPanel;
}
