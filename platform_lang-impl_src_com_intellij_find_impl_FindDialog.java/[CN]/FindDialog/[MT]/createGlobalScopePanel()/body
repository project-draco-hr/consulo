{
  JPanel scopePanel=new JPanel();
  scopePanel.setLayout(new GridBagLayout());
  scopePanel.setBorder(IdeBorderFactory.createTitledBorder(FindBundle.message("find.scope.group"),true));
  GridBagConstraints gbConstraints=new GridBagConstraints();
  gbConstraints.fill=GridBagConstraints.HORIZONTAL;
  gbConstraints.anchor=GridBagConstraints.WEST;
  gbConstraints.gridx=0;
  gbConstraints.gridy=0;
  gbConstraints.gridwidth=3;
  gbConstraints.weightx=1;
  final boolean canAttach=ProjectAttachProcessor.canAttachToProject();
  myRbProject=new JRadioButton(canAttach ? FindBundle.message("find.scope.all.projects.radio") : FindBundle.message("find.scope.whole.project.radio"),true);
  scopePanel.add(myRbProject,gbConstraints);
  gbConstraints.gridx=0;
  gbConstraints.gridy++;
  gbConstraints.weightx=0;
  gbConstraints.gridwidth=1;
  myRbModule=new JRadioButton(canAttach ? FindBundle.message("find.scope.project.radio") : FindBundle.message("find.scope.module.radio"),false);
  scopePanel.add(myRbModule,gbConstraints);
  gbConstraints.gridx=1;
  gbConstraints.gridwidth=2;
  gbConstraints.weightx=1;
  Module[] modules=ModuleManager.getInstance(myProject).getModules();
  String[] names=new String[modules.length];
  for (int i=0; i < modules.length; i++) {
    names[i]=modules[i].getName();
  }
  Arrays.sort(names,String.CASE_INSENSITIVE_ORDER);
  myModuleComboBox=new ComboBox(names,-1);
  scopePanel.add(myModuleComboBox,gbConstraints);
  if (modules.length == 1) {
    myModuleComboBox.setVisible(false);
    myRbModule.setVisible(false);
  }
  gbConstraints.gridx=0;
  gbConstraints.gridy++;
  gbConstraints.weightx=0;
  gbConstraints.gridwidth=1;
  myRbDirectory=new JRadioButton(FindBundle.message("find.scope.directory.radio"),false);
  scopePanel.add(myRbDirectory,gbConstraints);
  gbConstraints.gridx=1;
  gbConstraints.weightx=1;
  myDirectoryComboBox=new ComboBox(200);
  Component editorComponent=myDirectoryComboBox.getEditor().getEditorComponent();
  if (editorComponent instanceof JTextField) {
    JTextField field=(JTextField)editorComponent;
    field.setColumns(40);
  }
  initCombobox(myDirectoryComboBox);
  scopePanel.add(myDirectoryComboBox,gbConstraints);
  gbConstraints.weightx=0;
  gbConstraints.gridx=2;
  mySelectDirectoryButton=new FixedSizeButton(myDirectoryComboBox);
  TextFieldWithBrowseButton.MyDoClickAction.addTo(mySelectDirectoryButton,myDirectoryComboBox);
  mySelectDirectoryButton.setMargin(new Insets(0,0,0,0));
  scopePanel.add(mySelectDirectoryButton,gbConstraints);
  gbConstraints.gridx=0;
  gbConstraints.gridy++;
  gbConstraints.weightx=1;
  gbConstraints.gridwidth=3;
  gbConstraints.insets=new Insets(0,16,0,0);
  myCbWithSubdirectories=createCheckbox(true,FindBundle.message("find.scope.directory.recursive.checkbox"));
  myCbWithSubdirectories.setSelected(true);
  scopePanel.add(myCbWithSubdirectories,gbConstraints);
  gbConstraints.gridx=0;
  gbConstraints.gridy++;
  gbConstraints.weightx=0;
  gbConstraints.gridwidth=1;
  gbConstraints.insets=new Insets(0,0,0,0);
  myRbCustomScope=new JRadioButton(FindBundle.message("find.scope.custom.radio"),false);
  scopePanel.add(myRbCustomScope,gbConstraints);
  gbConstraints.gridx++;
  gbConstraints.weightx=1;
  gbConstraints.gridwidth=2;
  myScopeCombo=new ScopeChooserCombo(myProject,true,true,FindSettings.getInstance().getDefaultScopeName());
  Disposer.register(myDisposable,myScopeCombo);
  scopePanel.add(myScopeCombo,gbConstraints);
  ButtonGroup bgScope=new ButtonGroup();
  bgScope.add(myRbDirectory);
  bgScope.add(myRbProject);
  bgScope.add(myRbModule);
  bgScope.add(myRbCustomScope);
  myRbProject.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      validateScopeControls();
      validateFindButton();
    }
  }
);
  myRbCustomScope.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      validateScopeControls();
      validateFindButton();
    }
  }
);
  myRbDirectory.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      validateScopeControls();
      validateFindButton();
      myDirectoryComboBox.getEditor().getEditorComponent().requestFocusInWindow();
    }
  }
);
  myRbModule.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      validateScopeControls();
      validateFindButton();
      myModuleComboBox.requestFocusInWindow();
    }
  }
);
  mySelectDirectoryButton.addActionListener(new ActionListener(){
    @Override public void actionPerformed(    ActionEvent e){
      FileChooserDescriptor descriptor=FileChooserDescriptorFactory.createSingleFolderDescriptor();
      FileChooser.chooseFiles(descriptor,myProject,null,new Consumer<List<VirtualFile>>(){
        @Override public void consume(        final List<VirtualFile> files){
          myDirectoryComboBox.setSelectedItem(files.get(0).getPresentableUrl());
        }
      }
);
    }
  }
);
  return scopePanel;
}
