{
  final AbstractTreeNode alreadySelected=alreadySelectedNode(element);
  final Runnable onDone=new Runnable(){
    @Override public void run(){
      if (requestFocus && virtualSelectTarget == null && getUi().isReady()) {
        focusRequestor.requestFocus(getTree(),true);
      }
      result.setDone();
    }
  }
;
  final Condition<AbstractTreeNode> condition=new Condition<AbstractTreeNode>(){
    @Override public boolean value(    AbstractTreeNode abstractTreeNode){
      if (result.isProcessed())       return false;
      return nonStopCondition.value(abstractTreeNode);
    }
  }
;
  if (alreadySelected == null) {
    expandPathTo(file,(AbstractTreeNode)getTreeStructure().getRootElement(),element,condition,indicator,virtualSelectTarget).doWhenDone(new AsyncResult.Handler<AbstractTreeNode>(){
      @Override public void run(      AbstractTreeNode node){
        if (virtualSelectTarget == null) {
          select(node,onDone);
        }
 else         if (onDone != null) {
          onDone.run();
        }
      }
    }
).doWhenRejected(new Runnable(){
      @Override public void run(){
        if (isSecondAttempt) {
          result.setRejected();
        }
 else {
          _select(file,file,requestFocus,nonStopCondition,result,indicator,virtualSelectTarget,focusRequestor,true);
        }
      }
    }
);
  }
 else {
    if (virtualSelectTarget == null && getTree().getSelectionPaths().length == 1) {
      select(alreadySelected,onDone);
    }
 else     if (onDone != null) {
      onDone.run();
    }
  }
}
