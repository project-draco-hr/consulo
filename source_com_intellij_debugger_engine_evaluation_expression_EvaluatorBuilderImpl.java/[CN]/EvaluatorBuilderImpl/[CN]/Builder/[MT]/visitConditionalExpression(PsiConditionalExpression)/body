{
  if (LOG.isDebugEnabled()) {
    LOG.debug("visitConditionalExpression " + expression);
  }
  final PsiExpression thenExpression=expression.getThenExpression();
  final PsiExpression elseExpression=expression.getElseExpression();
  if (thenExpression == null || elseExpression == null) {
    throw new EvaluateRuntimeException(EvaluateExceptionUtil.INVALID_EXPRESSION(expression.getText()));
  }
  PsiExpression condition=expression.getCondition();
  condition.accept(this);
  if (myResult == null) {
    throw new EvaluateRuntimeException(EvaluateExceptionUtil.INVALID_EXPRESSION(condition.getText()));
  }
  Evaluator conditionEvaluator=myResult;
  thenExpression.accept(this);
  if (myResult == null) {
    throw new EvaluateRuntimeException(EvaluateExceptionUtil.INVALID_EXPRESSION(thenExpression.getText()));
  }
  Evaluator thenEvaluator=myResult;
  elseExpression.accept(this);
  if (myResult == null) {
    throw new EvaluateRuntimeException(EvaluateExceptionUtil.INVALID_EXPRESSION(elseExpression.getText()));
  }
  Evaluator elseEvaluator=myResult;
  myResult=new ConditionalExpressionEvaluator(conditionEvaluator,thenEvaluator,elseEvaluator);
}
