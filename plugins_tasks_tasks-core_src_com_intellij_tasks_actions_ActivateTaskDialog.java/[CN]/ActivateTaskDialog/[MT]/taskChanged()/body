{
  TaskManagerImpl taskManager=(TaskManagerImpl)TaskManager.getManager(myProject);
  Task task=getSelectedTask();
  myMarkAsInProgressBox.setVisible(false);
  for (  TaskRepository repository : taskManager.getAllRepositories()) {
    if (repository.getRepositoryType().getPossibleTaskStates().contains(TaskState.IN_PROGRESS)) {
      myMarkAsInProgressBox.setVisible(true);
      break;
    }
  }
  if (myMarkAsInProgressBox.isVisible()) {
    myMarkAsInProgressBox.setEnabled(false);
    if (task != null) {
      TaskRepository repository=task.getRepository();
      if (repository != null && repository.getRepositoryType().getPossibleTaskStates().contains(TaskState.IN_PROGRESS)) {
        myMarkAsInProgressBox.setEnabled(true);
      }
    }
  }
  myMarkAsInProgressBox.setSelected(myMarkAsInProgress);
  ChangeListManager changeListManager=ChangeListManager.getInstance(myProject);
  for (Iterator<ChangeListInfo> it=taskManager.getOpenChangelists(task).iterator(); it.hasNext(); ) {
    ChangeListInfo changeListInfo=it.next();
    if (changeListManager.getChangeList(changeListInfo.id) == null) {
      it.remove();
    }
  }
  if (!myVcsEnabled) {
    myCreateChangelist.setEnabled(false);
    myCreateChangelist.setSelected(false);
  }
 else   if (task != null && !taskManager.getOpenChangelists(task).isEmpty()) {
    myCreateChangelist.setSelected(true);
    myCreateChangelist.setEnabled(false);
  }
 else {
    myCreateChangelist.setSelected(taskManager.getState().createChangelist);
    myCreateChangelist.setEnabled(true);
  }
  setOKActionEnabled(isOKActionEnabled());
}
