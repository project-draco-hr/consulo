{
  final Project project=context.getProject();
  final Editor editor=context.getEditor();
  final Document document=editor.getDocument();
  PsiDocumentManager.getInstance(project).commitDocument(document);
  TailType tailType=getTailType(completionChar,item);
  InsertHandlerState state=new InsertHandlerState(context.getSelectionEndOffset(),context.getSelectionEndOffset());
  if (completionChar == Lookup.REPLACE_SELECT_CHAR) {
    removeEndOfIdentifier(context);
  }
 else   if (context.getOffsetMap().getOffset(CompletionInitializationContext.IDENTIFIER_END_OFFSET) != context.getSelectionEndOffset()) {
    JavaCompletionUtil.resetParensInfo(context.getOffsetMap());
  }
  handleParentheses(false,false,tailType,context,state);
  context.setTailOffset(state.tailOffset);
  state.caretOffset=processTail(tailType,state.caretOffset,state.tailOffset,editor);
  editor.getSelectionModel().removeSelection();
  if (tailType == TailType.DOT || context.getCompletionChar() == '.') {
    AutoPopupController.getInstance(project).autoPopupMemberLookup(editor,null);
  }
}
