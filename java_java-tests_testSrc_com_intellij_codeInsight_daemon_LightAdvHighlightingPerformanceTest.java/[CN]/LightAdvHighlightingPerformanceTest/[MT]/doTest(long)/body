{
  @NonNls String filePath=LightAdvHighlightingTest.BASE_PATH + "/" + getTestName(false)+ ".java";
  configureByFile(filePath);
  PsiDocumentManager.getInstance(getProject()).commitAllDocuments();
  getFile().getText();
  CodeInsightTestFixtureImpl.ensureIndexesUpToDate(getProject());
  final List<HighlightInfo> infos=new ArrayList<HighlightInfo>();
  PlatformTestUtil.assertTiming("Performance failed",maxMillis,new Runnable(){
    @Override public void run(){
      infos.clear();
      DaemonCodeAnalyzer.getInstance(getProject()).restart();
      List<HighlightInfo> h=doHighlighting();
      infos.addAll(h);
    }
  }
);
  return DaemonAnalyzerTestCase.filter(infos,HighlightSeverity.ERROR);
}
