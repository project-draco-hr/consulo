{
  final Ref<List<MavenArtifact>> result=new Ref<List<MavenArtifact>>();
  MavenEmbeddersManager manager=MavenProjectsManager.getInstance(project).getEmbeddersManager();
  MavenEmbedderWrapper embedder=manager.getEmbedder(MavenEmbeddersManager.FOR_DOWNLOAD);
  try {
    embedder.customizeForResolve(new SoutMavenConsole(),new MavenProgressIndicator(indicator));
    result.set(embedder.resolveTransitively(artifacts,convertRepositories(getDefaultRepositories())));
  }
 catch (  MavenProcessCanceledException e) {
    return;
  }
 finally {
    manager.release(embedder);
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        resultProcessor.process(result.get());
      }
    }
);
  }
}
