{
  MavenService.getInstance(project);
  final RepositoryAttachDialog dialog=new RepositoryAttachDialog(project,false);
  dialog.setTitle(getLongName());
  dialog.show();
  if (dialog.getExitCode() == DialogWrapper.OK_EXIT_CODE) {
    final ActionCallback callback=new ActionCallback();
    final String copyTo=dialog.getDirectoryPath();
    final String coord=dialog.getCoordinateText();
    final boolean attachJavaDoc=dialog.getAttachJavaDoc();
    final boolean attachSources=dialog.getAttachSources();
    final SmartList<MavenExtraArtifactType> extraTypes=new SmartList<MavenExtraArtifactType>();
    if (attachSources)     extraTypes.add(MavenExtraArtifactType.SOURCES);
    if (attachJavaDoc)     extraTypes.add(MavenExtraArtifactType.DOCS);
    resolveLibrary(project,coord,extraTypes,dialog.getRepositories(),true,new Processor<List<MavenArtifact>>(){
      public boolean process(      final List<MavenArtifact> artifacts){
        ApplicationManager.getApplication().runWriteAction(new Runnable(){
          public void run(){
            replaceLibraryData(project,libraryEditor,artifacts,copyTo);
            callback.setDone();
          }
        }
);
        final boolean nothingRetrieved=artifacts.isEmpty();
        final StringBuilder sb=new StringBuilder();
        if (nothingRetrieved) {
          sb.append("No files were downloaded for ").append(coord);
        }
 else {
          sb.append("The following files were downloaded:<br>");
          sb.append("<ol>");
          for (          MavenArtifact each : artifacts) {
            sb.append("<li>");
            sb.append(each.getFile().getName());
            sb.append("</li>");
          }
          sb.append("</ol>");
        }
        final String title="Attach Jars From Repository";
        if (nothingRetrieved && ModalityState.current().dominates(ModalityState.NON_MODAL)) {
          Messages.showErrorDialog(project,sb.toString(),title);
        }
 else {
          Notifications.Bus.notify(new Notification("Repository",sb.toString(),title,nothingRetrieved ? NotificationType.WARNING : NotificationType.INFORMATION),NotificationDisplayType.STICKY_BALLOON,project);
        }
        return true;
      }
    }
);
    return callback;
  }
  return new ActionCallback.Rejected();
}
