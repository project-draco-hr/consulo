{
  final Ref<List<MavenArtifact>> result=new Ref<List<MavenArtifact>>();
  MavenEmbeddersManager manager=MavenProjectsManager.getInstance(project).getEmbeddersManager();
  MavenEmbedderWrapper embedder=manager.getEmbedder(MavenEmbeddersManager.FOR_DOWNLOAD);
  try {
    embedder.customizeForResolve(new SoutMavenConsole(),new MavenProgressIndicator(indicator));
    List<MavenArtifact> resolved=embedder.resolveTransitively(Collections.singletonList(artifact),convertRepositories(repositories));
    result.set(ContainerUtil.findAll(resolved,new Condition<MavenArtifact>(){
      public boolean value(      MavenArtifact mavenArtifact){
        return mavenArtifact.isResolved();
      }
    }
));
  }
 catch (  MavenProcessCanceledException e) {
    return;
  }
 finally {
    manager.release(embedder);
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        resultProcessor.process(result.get());
      }
    }
);
  }
}
