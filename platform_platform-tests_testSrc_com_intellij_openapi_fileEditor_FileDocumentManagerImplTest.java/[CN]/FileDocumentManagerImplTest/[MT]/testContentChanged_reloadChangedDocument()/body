{
  final MockVirtualFile file=new MockVirtualFile("test.txt","test\rtest");
  file.setListener(myDocumentManager);
  Document document=myDocumentManager.getDocument(file);
  assertNotNull(file.toString(),document);
  document.insertString(0,"zzz");
  myDocumentManager.myReloadFromDisk=Boolean.TRUE;
  try {
    file.setContent(null,"xxx",true);
    assertEquals("xxx",document.getText());
    assertEquals(file.getModificationStamp(),document.getModificationStamp());
    assertEquals(0,myDocumentManager.getUnsavedDocuments().length);
  }
  finally {
    myDocumentManager.myReloadFromDisk=null;
  }
}
