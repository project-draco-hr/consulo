{
  final VirtualFile file=createFile();
  final Document document=myDocumentManager.getDocument(file);
  assertNotNull(file.toString(),document);
  WriteCommandAction.runWriteCommandAction(myProject,new Runnable(){
    @Override public void run(){
      document.insertString(0,"zzz");
    }
  }
);
  myReloadFromDisk=Boolean.TRUE;
  setContent(file,"xxx");
  assertEquals("xxx",document.getText());
  assertEquals(file.getModificationStamp(),document.getModificationStamp());
  assertEquals(0,myDocumentManager.getUnsavedDocuments().length);
}
