{
  final MockVirtualFile file=newTextFile();
  file.setListener(myDocumentManager);
  Document document=myDocumentManager.getDocument(file);
  assertNotNull(file.toString(),document);
  document.insertString(0,"zzz");
  myDocumentManager.myReloadFromDisk=Boolean.FALSE;
  try {
    long oldDocumentStamp=document.getModificationStamp();
    file.setContent(null,"xxx",true);
    assertEquals("zzztest",document.getText());
    assertEquals(oldDocumentStamp,document.getModificationStamp());
  }
  finally {
    myDocumentManager.myReloadFromDisk=null;
  }
}
