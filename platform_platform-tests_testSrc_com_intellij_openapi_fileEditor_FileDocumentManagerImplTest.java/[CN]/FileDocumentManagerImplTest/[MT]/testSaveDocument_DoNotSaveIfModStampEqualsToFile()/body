{
  final VirtualFile file=createFile();
  final DocumentEx document=(DocumentEx)myDocumentManager.getDocument(file);
  assertNotNull(file.toString(),document);
  WriteCommandAction.runWriteCommandAction(myProject,new Runnable(){
    @Override public void run(){
      document.insertString(0,"zzz");
      document.setModificationStamp(file.getModificationStamp());
    }
  }
);
  getProject().getMessageBus().connect(getTestRootDisposable()).subscribe(AppTopics.FILE_DOCUMENT_SYNC,new FileDocumentManagerAdapter(){
    @Override public void beforeDocumentSaving(    @NotNull Document documentToSave){
      assertNotSame(document,documentToSave);
    }
  }
);
  myDocumentManager.saveDocument(document);
}
