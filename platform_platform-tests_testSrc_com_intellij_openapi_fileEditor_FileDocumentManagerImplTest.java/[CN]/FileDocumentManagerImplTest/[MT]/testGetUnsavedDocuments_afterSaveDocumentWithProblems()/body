{
  final VirtualFile file=new MockVirtualFile("test.txt","test"){
    @Override @NotNull public OutputStream getOutputStream(    Object requestor,    long newModificationStamp,    long newTimeStamp) throws IOException {
      throw new IOException("");
    }
  }
;
  Document document=myDocumentManager.getDocument(file);
  assertNotNull(file.toString(),document);
  document.insertString(0,"xxx");
  myDocumentManager.saveDocument(document);
  assertNotNull(myDocumentManager.myExceptionOnSave);
  final Document[] unsavedDocuments=myDocumentManager.getUnsavedDocuments();
  assertEquals(1,unsavedDocuments.length);
  assertSame(document,unsavedDocuments[0]);
  assertTrue(Arrays.equals("test".getBytes(),file.contentsToByteArray()));
}
