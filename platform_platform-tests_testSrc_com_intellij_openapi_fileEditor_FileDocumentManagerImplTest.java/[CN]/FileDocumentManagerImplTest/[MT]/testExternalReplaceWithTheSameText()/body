{
  final long[] modificationStamp=new long[1];
  modificationStamp[0]=1;
  final VirtualFile file=new MockVirtualFile("test.txt","test"){
    @NotNull @Override public OutputStream getOutputStream(    Object requestor,    long newModificationStamp,    long newTimeStamp) throws IOException {
      fail();
      throw new IOException();
    }
    @Override public long getModificationStamp(){
      return modificationStamp[0];
    }
    @Override public void refresh(    boolean asynchronous,    boolean recursive,    Runnable postRunnable){
      myDocumentManager.contentsChanged(new VirtualFileEvent(null,this,null,1,2));
    }
  }
;
  DocumentEx document=(DocumentEx)myDocumentManager.getDocument(file);
  modificationStamp[0]=2;
  file.refresh(false,false);
  assertEquals(2,document.getModificationStamp());
}
