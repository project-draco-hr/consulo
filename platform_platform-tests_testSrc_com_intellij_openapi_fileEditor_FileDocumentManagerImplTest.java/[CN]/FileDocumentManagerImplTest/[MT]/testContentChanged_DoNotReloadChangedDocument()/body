{
  final VirtualFile file=createFile();
  final Document document=myDocumentManager.getDocument(file);
  assertNotNull(file.toString(),document);
  WriteCommandAction.runWriteCommandAction(myProject,new Runnable(){
    @Override public void run(){
      document.insertString(0,"old ");
    }
  }
);
  myReloadFromDisk=Boolean.FALSE;
  long oldDocumentStamp=document.getModificationStamp();
  file.setBinaryContent("xxx".getBytes(CharsetToolkit.UTF8_CHARSET));
  assertEquals("old test",document.getText());
  assertEquals(oldDocumentStamp,document.getModificationStamp());
}
