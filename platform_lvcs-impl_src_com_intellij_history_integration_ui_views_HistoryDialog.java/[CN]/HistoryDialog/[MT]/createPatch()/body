{
  try {
    if (!myModel.canPerformCreatePatch()) {
      showError(message("message.cannot.create.patch.because.of.unavailable.content"));
      return;
    }
    CreatePatchConfigurationPanel p=new CreatePatchConfigurationPanel(myProject);
    p.setFileName(getDefaultPatchFile());
    p.setCommonParentPath(ChangesUtil.findCommonAncestor(myModel.getChanges()));
    if (!showAsDialog(p))     return;
    myModel.createPatch(p.getFileName(),p.getBaseDirName(),p.isReversePatch(),p.getEncoding());
    showNotification(LocalHistoryBundle.message("message.patch.created"));
    ShowFilePathAction.openFile(new File(p.getFileName()));
  }
 catch (  VcsException e) {
    showError(message("message.error.during.create.patch",e));
  }
catch (  IOException e) {
    showError(message("message.error.during.create.patch",e));
  }
}
