{
  final Ref<ContentDiffRequest> requestRef=new Ref<ContentDiffRequest>();
  new Task.Modal(myProject,message("message.processing.revisions"),false){
    public void run(    @NotNull final ProgressIndicator i){
      ApplicationManager.getApplication().runReadAction(new Runnable(){
        @Override public void run(){
          RevisionProcessingProgressAdapter p=new RevisionProcessingProgressAdapter(i);
          p.processingLeftRevision();
          DiffContent left=m.getLeftDiffContent(p);
          p.processingRightRevision();
          DiffContent right=m.getRightDiffContent(p);
          requestRef.set(new SimpleDiffRequest(m.getTitle(),left,right,m.getLeftTitle(p),m.getRightTitle(p)));
        }
      }
);
    }
  }
.queue();
  return requestRef.get();
}
