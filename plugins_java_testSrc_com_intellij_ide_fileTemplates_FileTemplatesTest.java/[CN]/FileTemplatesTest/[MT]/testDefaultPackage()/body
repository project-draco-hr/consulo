{
  String name="myclass";
  FileTemplate template=FileTemplateManager.getInstance().addInternal(name,"java");
  try {
    template.setText("package ${PACKAGE_NAME}; public class ${NAME} {}");
    File temp=FileUtil.createTempDirectory(getTestName(true),"");
    myFilesToDelete.add(temp);
    final VirtualFile tempDir=LocalFileSystem.getInstance().refreshAndFindFileByIoFile(temp);
    PsiTestUtil.addSourceRoot(getModule(),tempDir);
    VirtualFile sourceRoot=ModuleRootManager.getInstance(getModule()).getSourceRoots()[0];
    PsiDirectory psiDirectory=PsiManager.getInstance(getProject()).findDirectory(sourceRoot);
    PsiClass psiClass=JavaDirectoryService.getInstance().createClass(psiDirectory,"XXX",name);
    assertNotNull(psiClass);
    assertEquals("public class XXX {\n}",psiClass.getContainingFile().getText());
  }
  finally {
    FileTemplateManager.getInstance().removeTemplate(template);
  }
}
