{
  for (int i=0; i < files.length; i++) {
    final VirtualFile file=files[i];
    for (Iterator<ContentEntry> it=myEntryToEditorMap.keySet().iterator(); it.hasNext(); ) {
      final ContentEntry contentEntry=it.next();
      final VirtualFile contentEntryFile=contentEntry.getFile();
      if (contentEntryFile == null) {
        continue;
      }
      if (contentEntryFile.equals(file)) {
        throw new Exception("Content root \"" + file.getPresentableUrl() + "\" already exists");
      }
      if (VfsUtil.isAncestor(contentEntryFile,file,true)) {
        throw new Exception("Content root being added \"" + file.getPresentableUrl() + "\"\nis located below existing content root \""+ contentEntryFile.getPresentableUrl()+ "\".\nContent entries should not intersect.");
      }
      if (VfsUtil.isAncestor(file,contentEntryFile,true)) {
        throw new Exception("Content root being added \"" + file.getPresentableUrl() + "\"\ndominates existing content root \""+ contentEntryFile.getPresentableUrl()+ "\".\nContent entries should not intersect.");
      }
    }
    final Module[] modules=myModulesProvider.getModules();
    for (int j=0; j < modules.length; j++) {
      final Module module=modules[j];
      if (myModuleName.equals(module.getName())) {
        continue;
      }
      ModuleRootModel rootModel=myModulesProvider.getRootModel(module);
      LOG.assertTrue(rootModel != null);
      final VirtualFile[] moduleContentRoots=rootModel.getContentRoots();
      for (int k=0; k < moduleContentRoots.length; k++) {
        VirtualFile moduleContentRoot=moduleContentRoots[k];
        if (file.equals(moduleContentRoot)) {
          throw new Exception("Content root \"" + file.getPresentableUrl() + "\" already defined for module \""+ module.getName()+ "\".\nTwo modules in a project cannot share the same content root.");
        }
      }
    }
  }
}
