{
  final Map<BuildRootDescriptor,Set<File>> data=getSourcesToRecompile(context,target);
  JpsProject project=context.getProjectDescriptor().jpsProject;
  final JpsCompilerExcludes excludes=JpsJavaExtensionService.getInstance().getOrCreateCompilerConfiguration(project).getCompilerExcludes();
  final CompileScope scope=context.getScope();
synchronized (data) {
    for (    Map.Entry<BuildRootDescriptor,Set<File>> entry : data.entrySet()) {
      File rootFile=entry.getKey().getRootFile();
      final String rootPath=FileUtil.toSystemIndependentName(rootFile.getPath());
      for (      File file : entry.getValue()) {
        if (!scope.isAffected(target,file)) {
          continue;
        }
        if (excludes.isExcluded(file)) {
          continue;
        }
        if (!processor.apply(target,file,rootPath)) {
          return false;
        }
      }
    }
  }
  return true;
}
