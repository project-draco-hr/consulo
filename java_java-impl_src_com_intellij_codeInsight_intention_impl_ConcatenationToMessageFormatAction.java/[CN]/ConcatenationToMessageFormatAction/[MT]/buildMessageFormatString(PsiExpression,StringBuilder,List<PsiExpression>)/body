{
  if (expression instanceof PsiBinaryExpression) {
    final PsiType type=expression.getType();
    if (type != null && type.equalsToText("java.lang.String") && ((PsiBinaryExpression)expression).getOperationTokenType() == JavaTokenType.PLUS) {
      buildMessageFormatString(((PsiBinaryExpression)expression).getLOperand(),formatString,args);
      final PsiExpression rhs=((PsiBinaryExpression)expression).getROperand();
      if (rhs != null) {
        buildMessageFormatString(rhs,formatString,args);
      }
    }
 else {
      appendArgument(args,expression,formatString);
    }
  }
 else   if (expression instanceof PsiLiteralExpression) {
    final String text=String.valueOf(((PsiLiteralExpression)expression).getValue());
    formatString.append(StringUtil.escapeStringCharacters(text).replace("'","''").replace("{","'{'"));
  }
 else {
    appendArgument(args,expression,formatString);
  }
}
