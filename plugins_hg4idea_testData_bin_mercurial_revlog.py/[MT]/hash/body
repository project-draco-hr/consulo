def hash(text, p1, p2):
    'generate a hash from the given text and its parent hashes\n\n    This hash combines both the current file contents and its history\n    in a manner that makes it easy to distinguish nodes with the same\n    content in the revision graph.\n    '
    if (p2 == nullid):
        s = nullhash.copy()
        s.update(p1)
    else:
        l = [p1, p2]
        l.sort()
        s = _sha(l[0])
        s.update(l[1])
    s.update(text)
    return s.digest()
