def loadmap(self):
    '\n        during a commit, we need to make sure the rev being added is\n        not a duplicate.  This requires loading the entire index,\n        which is fairly slow.  loadmap can load up just the node map,\n        which takes much less time.\n        '
    if self.allmap:
        return
    end = self.datasize
    self.allmap = 1
    cur = 0
    count = 0
    blocksize = (self.s * 256)
    self.dataf.seek(0)
    while (cur < end):
        data = self.dataf.read(blocksize)
        off = 0
        for x in xrange(256):
            n = data[(off + ngshaoffset):((off + ngshaoffset) + 20)]
            self.map[n] = count
            count += 1
            if (count >= self.l):
                break
            off += self.s
        cur += blocksize
