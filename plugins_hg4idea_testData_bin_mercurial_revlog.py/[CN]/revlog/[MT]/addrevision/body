def addrevision(self, text, transaction, link, p1, p2, d=None):
    'add a revision to the log\n\n        text - the revision data to add\n        transaction - the transaction object used for rollback\n        link - the linkrev data to add\n        p1, p2 - the parent nodeids of the revision\n        d - an optional precomputed delta\n        '
    dfh = None
    if (not self._inline):
        dfh = self.opener(self.datafile, 'a')
    ifh = self.opener(self.indexfile, 'a+')
    try:
        return self._addrevision(text, transaction, link, p1, p2, d, ifh, dfh)
    finally:
        if dfh:
            dfh.close()
        ifh.close()
