{
  final File localFile=fileSystem.getFile(fileObject);
  localFile.getParentFile().mkdirs();
  if (localFile.exists()) {
    deleteFile(localFile,fileReadOnlyHandler);
  }
 else {
    FileUtil.createIfDoesntExist(localFile);
  }
  final File tempFile=File.createTempFile(RECEIVING_TMP_FILE_NAME,null);
  try {
    writeFile(tempFile,length,inputStream);
    receiveTextFilePreprocessor.copyTextFileToLocation(tempFile,localFile,readerFactory,charSet);
    setModifiedDateAndMode(localFile,fileReadOnlyHandler);
  }
  finally {
    FileUtil.delete(tempFile);
  }
  fileReadOnlyHandler.setFileReadOnly(localFile,readOnly);
}
