{
  myTree=new Tree();
  myTreeBuilder=new CertificateTreeBuilder(myTree);
  myCheckHostname.setVisible(false);
  myCheckValidityPeriod.setVisible(false);
  myTrustManager=CertificateManager.getInstance().getCustomTrustManager();
  myTrustManager.addListener(this);
  myTree.getEmptyText().setText("No certificates");
  myTree.getSelectionModel().setSelectionMode(TreeSelectionModel.SINGLE_TREE_SELECTION);
  myTree.setRootVisible(false);
  ToolbarDecorator decorator=ToolbarDecorator.createDecorator(myTree).disableUpDownActions();
  decorator.setAddAction(new AnActionButtonRunnable(){
    @Override public void run(    AnActionButton button){
      FileChooser.chooseFile(CERTIFICATE_DESCRIPTOR,null,null,new Consumer<VirtualFile>(){
        @Override public void consume(        VirtualFile file){
          String path=file.getPath();
          X509Certificate certificate=CertificateUtil.loadX509Certificate(path);
          if (certificate == null) {
            Messages.showErrorDialog(myRootPanel,"Malformed X509 server certificate","Not Imported");
          }
 else           if (myCertificates.contains(certificate)) {
            Messages.showWarningDialog(myRootPanel,"Certificate already exists","Not Imported");
          }
 else {
            myCertificates.add(certificate);
            myTreeBuilder.addCertificate(certificate);
            addCertificatePanel(certificate);
            myTreeBuilder.selectCertificate(certificate);
          }
        }
      }
);
    }
  }
).setRemoveAction(new AnActionButtonRunnable(){
    @Override public void run(    AnActionButton button){
      for (      X509Certificate certificate : myTreeBuilder.getSelectedCertificates(true)) {
        myCertificates.remove(certificate);
        myTreeBuilder.removeCertificate(certificate);
      }
      if (myCertificates.isEmpty()) {
        showCard(EMPTY_PANEL);
      }
 else {
        myTreeBuilder.selectFirstCertificate();
      }
    }
  }
);
  myTree.addTreeSelectionListener(new TreeSelectionListener(){
    @Override public void valueChanged(    TreeSelectionEvent e){
      X509Certificate certificate=myTreeBuilder.getFirstSelectedCertificate(true);
      if (certificate != null) {
        showCard(getCardName(certificate));
      }
    }
  }
);
  myCertificatesListPanel.add(decorator.createPanel(),BorderLayout.CENTER);
}
