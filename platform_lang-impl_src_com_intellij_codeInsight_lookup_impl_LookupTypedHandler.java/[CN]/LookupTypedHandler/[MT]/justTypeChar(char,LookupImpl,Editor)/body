{
  final LinkedList<EditorChangeAction> events=new LinkedList<EditorChangeAction>();
  final DocumentAdapter listener=new DocumentAdapter(){
    @Override public void documentChanged(    DocumentEvent e){
      events.addFirst(new EditorChangeAction(e));
    }
  }
;
  editor.getDocument().addDocumentListener(listener);
  CommandProcessor.getInstance().executeCommand(editor.getProject(),new Runnable(){
    @Override public void run(){
      lookup.performGuardedChange(new Runnable(){
        public void run(){
          EditorModificationUtil.typeInStringAtCaretHonorBlockSelection(editor,String.valueOf(charTyped),true);
        }
      }
);
    }
  }
,null,"Just insert the completion char");
  editor.getDocument().removeDocumentListener(listener);
  return events;
}
