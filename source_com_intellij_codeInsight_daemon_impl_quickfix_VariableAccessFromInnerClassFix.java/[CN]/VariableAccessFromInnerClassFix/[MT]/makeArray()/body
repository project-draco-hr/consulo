{
  PsiType type=myVariable.getType();
  final PsiElementFactory factory=myClass.getManager().getElementFactory();
  final PsiType newType=type.createArrayType();
  final PsiDeclarationStatement variableDeclarationStatement;
  if (myVariable.hasInitializer()) {
    final PsiExpression init=factory.createExpressionFromText("new " + newType.getCanonicalText() + " { "+ myVariable.getInitializer().getText()+ " }",myVariable);
    variableDeclarationStatement=factory.createVariableDeclarationStatement(myVariable.getName(),newType,init);
  }
 else {
    String expression="[1]";
    while (type instanceof PsiArrayType) {
      expression+="[1]";
      type=((PsiArrayType)type).getComponentType();
    }
    final PsiExpression init=factory.createExpressionFromText("new " + type.getCanonicalText() + expression,myVariable);
    variableDeclarationStatement=factory.createVariableDeclarationStatement(myVariable.getName(),newType,init);
  }
  PsiVariable newVariable;
  newVariable=(PsiVariable)variableDeclarationStatement.getDeclaredElements()[0];
  newVariable.getModifierList().setModifierProperty(PsiModifier.FINAL,true);
  PsiElement newExpression=factory.createExpressionFromText(myVariable.getName() + "[0]",myVariable);
  PsiElement outerCodeBlock=PsiUtil.getVariableCodeBlock(myVariable,null);
  if (outerCodeBlock == null)   return;
  List<PsiReferenceExpression> outerReferences=new ArrayList<PsiReferenceExpression>();
  collectReferences(outerCodeBlock,myVariable,outerReferences);
  replaceReferences(outerReferences,newExpression);
  myVariable.replace(newVariable);
}
