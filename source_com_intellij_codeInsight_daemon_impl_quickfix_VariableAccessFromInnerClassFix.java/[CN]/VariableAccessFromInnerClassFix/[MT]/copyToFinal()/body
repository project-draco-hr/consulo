{
  PsiManager psiManager=myClass.getManager();
  final PsiElementFactory factory=psiManager.getElementFactory();
  final PsiExpression initializer=factory.createExpressionFromText(myVariable.getName(),myClass);
  final String newName=suggestNewName(psiManager.getProject(),myVariable);
  final PsiType type=myVariable.getType();
  final PsiDeclarationStatement copyDecl=factory.createVariableDeclarationStatement(newName,type,initializer);
  PsiVariable newVariable=((PsiVariable)copyDecl.getDeclaredElements()[0]);
  newVariable.getModifierList().setModifierProperty(PsiModifier.FINAL,true);
  PsiElement statement=PsiUtil.getEnclosingStatement(myClass);
  if (statement != null && statement.getParent() != null) {
    statement.getParent().addBefore(copyDecl,statement);
    PsiExpression newExpression=factory.createExpressionFromText(newName,myVariable);
    replaceReferences(myClass,myVariable,newExpression);
  }
}
