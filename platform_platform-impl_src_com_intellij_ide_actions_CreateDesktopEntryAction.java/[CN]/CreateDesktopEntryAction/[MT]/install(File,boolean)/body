{
  try {
    if (globalEntry) {
      final String source="#!/bin/sh\n" + "xdg-desktop-menu install --mode system \"" + entryFile.getAbsolutePath() + "\"";
      final File script=ExecUtil.createTempExecutableScript("sudo",".sh",source);
      script.deleteOnExit();
      final int result=ExecUtil.sudoAndGetResult(script.getAbsolutePath(),ApplicationBundle.message("desktop.entry.sudo.prompt"));
      if (result != 0)       throw new RuntimeException("'" + script.getAbsolutePath() + "' : "+ result);
    }
 else {
      final int result=ExecUtil.execAndGetResult("xdg-desktop-menu","install","--mode","user",entryFile.getAbsolutePath());
      if (result != 0)       throw new RuntimeException("'" + entryFile.getAbsolutePath() + "' : "+ result);
    }
  }
  finally {
    if (!entryFile.delete())     LOG.error("Failed to delete temp file '" + entryFile + "'");
  }
}
