{
  try {
    final int result;
    if (globalEntry) {
      final String source="#!/bin/sh\n" + "xdg-desktop-menu install --mode system \"" + entryFile.getAbsolutePath() + "\"";
      final File script=ExecUtil.createTempExecutableScript("sudo",".sh",source);
      result=ExecUtil.sudoAndGetResult(script.getAbsolutePath(),ApplicationBundle.message("desktop.entry.sudo.prompt"));
    }
 else {
      result=ExecUtil.execAndGetResult("xdg-desktop-menu","install","--mode","user",entryFile.getAbsolutePath());
    }
    if (result != 0)     throw new RuntimeException("'" + entryFile.getAbsolutePath() + "' : "+ result);
  }
  finally {
    if (!entryFile.delete())     LOG.error("Failed to delete temp file '" + entryFile + "'");
  }
}
