{
  CompositeElement variableElement=(CompositeElement)SourceTreeToPsiMap.psiElementToTree(variable);
  ASTNode type=variableElement.findChildByRole(ChildRole.TYPE);
  LOG.assertTrue(type.getTreeParent() == variableElement);
  ASTNode name=variableElement.findChildByRole(ChildRole.NAME);
  ASTNode firstBracket=null;
  ASTNode lastBracket=null;
  int arrayCount=0;
  ASTNode element=name;
  while (element != null) {
    element=TreeUtil.skipElements(element.getTreeNext(),StdTokenSets.WHITE_SPACE_OR_COMMENT_BIT_SET);
    if (element == null || element.getElementType() != JavaTokenType.LBRACKET)     break;
    if (firstBracket == null)     firstBracket=element;
    lastBracket=element;
    arrayCount++;
    element=TreeUtil.skipElements(element.getTreeNext(),StdTokenSets.WHITE_SPACE_OR_COMMENT_BIT_SET);
    if (element == null || element.getElementType() != JavaTokenType.RBRACKET)     break;
    lastBracket=element;
  }
  if (firstBracket != null) {
    element=firstBracket;
    while (true) {
      ASTNode next=element.getTreeNext();
      variableElement.removeChild(element);
      if (element == lastBracket)       break;
      element=next;
    }
    CompositeElement newType=(CompositeElement)type.clone();
    final CharTable treeCharTable=SharedImplUtil.findCharTableByTree(type);
    for (int i=0; i < arrayCount; i++) {
      CompositeElement newType1=ASTFactory.composite(JavaElementType.TYPE);
      newType1.rawAddChildren(newType);
      newType1.rawAddChildren(ASTFactory.leaf(JavaTokenType.LBRACKET,"["));
      newType1.rawAddChildren(ASTFactory.leaf(JavaTokenType.RBRACKET,"]"));
      newType=newType1;
      newType.acceptTree(new GeneratedMarkerVisitor());
    }
    newType.putUserData(CharTable.CHAR_TABLE_KEY,SharedImplUtil.findCharTableByTree(type));
    variableElement.replaceChild(type,newType);
  }
}
