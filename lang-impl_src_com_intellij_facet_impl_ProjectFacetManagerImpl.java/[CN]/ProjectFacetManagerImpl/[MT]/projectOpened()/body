{
  if (!myFacetLoadingErrors.isEmpty()) {
    Application application=ApplicationManager.getApplication();
    if (application.isHeadlessEnvironment()) {
      throw new RuntimeException(myFacetLoadingErrors.get(0).getDescription());
    }
    Runnable runnable=new Runnable(){
      public void run(){
        List<FacetLoadingErrorDescription> errorDescriptions=new ArrayList<FacetLoadingErrorDescription>();
        for (        FacetLoadingErrorDescription errorDescription : myFacetLoadingErrors) {
          if (!errorDescription.getModule().isDisposed()) {
            errorDescriptions.add(errorDescription);
          }
        }
        myFacetLoadingErrors.clear();
        if (!errorDescriptions.isEmpty()) {
          Collection<FacetLoadingErrorDescription> toRemove=RemoveInvalidElementsDialog.showDialog(myProject,ProjectBundle.message("dialog.title.cannot.load.facets"),ProjectBundle.message("error.message.cannot.load.facets"),ProjectBundle.message("confirmation.message.would.you.like.to.remove.facet"),errorDescriptions);
          for (          FacetLoadingErrorDescription errorDescription : toRemove) {
            FacetManagerImpl manager=(FacetManagerImpl)FacetManagerImpl.getInstance(errorDescription.getModule());
            manager.removeInvalidFacet(errorDescription.getUnderlyingFacet(),errorDescription.getState());
          }
        }
      }
    }
;
    application.invokeLater(runnable,ModalityState.NON_MODAL);
  }
}
