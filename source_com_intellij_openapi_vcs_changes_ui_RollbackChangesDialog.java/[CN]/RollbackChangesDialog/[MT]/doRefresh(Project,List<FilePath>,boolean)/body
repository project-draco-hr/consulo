{
  final LocalHistoryAction action=LocalHistory.startAction(project,VcsBundle.message("changes.action.rollback.text"));
  RefreshSession session=RefreshQueue.getInstance().createSession(asynchronous,true,new Runnable(){
    public void run(){
      action.finish();
      if (!project.isDisposed()) {
        for (        FilePath path : pathsToRefresh) {
          if (path.isDirectory()) {
            VcsDirtyScopeManager.getInstance(project).dirDirtyRecursively(path);
          }
 else {
            VcsDirtyScopeManager.getInstance(project).fileDirty(path);
          }
        }
      }
    }
  }
);
  for (  FilePath path : pathsToRefresh) {
    VirtualFile vFile=path.getVirtualFile();
    if (vFile == null) {
      vFile=path.getVirtualFileParent();
    }
    if (vFile != null) {
      session.addFile(vFile);
    }
  }
  session.launch();
}
