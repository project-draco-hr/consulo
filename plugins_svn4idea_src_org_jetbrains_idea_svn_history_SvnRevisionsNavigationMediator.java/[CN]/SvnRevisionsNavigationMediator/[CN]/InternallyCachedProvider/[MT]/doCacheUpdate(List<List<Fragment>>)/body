{
  final List<CommittedChangeList> lists=new ArrayList<CommittedChangeList>();
  Integer bindAddress=null;
  boolean consistent=false;
  if (myHolesDetected) {
    boolean liveMet=false;
    for (int i=0; i < fragmentsListList.size(); i++) {
      final List<Fragment> fragmentList=fragmentsListList.get(i);
      for (int j=0; j < fragmentList.size(); j++) {
        final Fragment fragment=fragmentList.get(j);
        liveMet|=Origin.LIVE.equals(fragment.getOrigin());
        if (Origin.INTERNAL.equals(fragment.getOrigin())) {
          bindAddress=((InternallyCachedChangesBunch)fragment.getOriginBunch()).getPreviousAddress();
          if ((i == (fragmentsListList.size() - 1)) && (j == (fragmentList.size() - 1))) {
            lists.addAll(fragment.getOriginBunch().getList());
            consistent=fragment.getOriginBunch().isConsistentWithPrevious();
            break;
          }
        }
        lists.addAll(fragment.getList());
      }
    }
    if (!liveMet) {
      return;
    }
  }
 else {
    for (    List<Fragment> fragmentList : fragmentsListList) {
      for (      Fragment fragment : fragmentList) {
        if (Origin.INTERNAL.equals(fragment.getOrigin())) {
          bindAddress=((InternallyCachedChangesBunch)fragment.getOriginBunch()).getSelfAddress();
          consistent=true;
          break;
        }
        lists.addAll(fragment.getList());
      }
    }
  }
  if (bindAddress == null) {
    if (myAlreadyReaded != null) {
      bindAddress=((InternallyCachedChangesBunch)myAlreadyReaded).getSelfAddress();
    }
  }
  if (!lists.isEmpty()) {
    LoadedRevisionsCacheManager.getInstance(myProject).put(lists,consistent,bindAddress,null);
  }
}
