{
  try {
    if (!CodeInsightUtilBase.preparePsiElementForWrite(psiClass))     return null;
    PsiManager manager=psiClass.getManager();
    PsiElementFactory elementFactory=JavaPsiFacade.getInstance(manager.getProject()).getElementFactory();
    PsiClass result=classKind == INTERFACE ? elementFactory.createInterface(name) : classKind == CLASS ? elementFactory.createClass(name) : elementFactory.createEnum(name);
    CreateFromUsageBaseFix.setupGenericParameters(result,referenceElement);
    result=(PsiClass)manager.getCodeStyleManager().reformat(result);
    return (PsiClass)psiClass.add(result);
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
    return null;
  }
}
