{
  try {
    if (!FileModificationService.getInstance().preparePsiElementForWrite(psiClass))     return null;
    PsiManager manager=psiClass.getManager();
    PsiElementFactory elementFactory=JavaPsiFacade.getInstance(manager.getProject()).getElementFactory();
    PsiClass result=classKind == CreateClassKind.INTERFACE ? elementFactory.createInterface(name) : classKind == CreateClassKind.CLASS ? elementFactory.createClass(name) : classKind == CreateClassKind.ANNOTATION ? elementFactory.createAnnotationType(name) : elementFactory.createEnum(name);
    CreateFromUsageBaseFix.setupGenericParameters(result,referenceElement);
    result=(PsiClass)CodeStyleManager.getInstance(manager.getProject()).reformat(result);
    return (PsiClass)psiClass.add(result);
  }
 catch (  IncorrectOperationException e) {
    LOG.error(e);
    return null;
  }
}
