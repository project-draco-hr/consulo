{
  StartupManager.getInstance(myProject).runWhenProjectIsInitialized(new DumbAwareRunnable(){
    public void run(){
      AppUIUtil.invokeLaterIfProjectAlive(myProject,new DumbAwareRunnable(){
        @Override public void run(){
          VirtualFile file=ProjectBaseDirectory.getInstance(myProject).getBaseDir(myProject.getBaseDir());
          if (myVcsManager.needAutodetectMappings()) {
            AbstractVcs vcs=myVcsManager.findVersioningVcs(file);
            if (vcs != null && vcs != myVcsManager.getVcsFor(file)) {
              myVcsManager.removeDirectoryMapping(new VcsDirectoryMapping("",""));
              myVcsManager.setAutoDirectoryMapping(file.getPath(),vcs.getName());
              myVcsManager.cleanupMappings();
              myVcsManager.updateActiveVcss();
            }
          }
        }
      }
);
    }
  }
);
}
