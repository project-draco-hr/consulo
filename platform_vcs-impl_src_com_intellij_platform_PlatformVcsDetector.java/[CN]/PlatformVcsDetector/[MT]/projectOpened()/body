{
  StartupManager.getInstance(myProject).runWhenProjectIsInitialized(new DumbAwareRunnable(){
    @Override public void run(){
      final DumbAwareRunnable runnable=new DumbAwareRunnable(){
        @Override public void run(){
          VirtualFile file=ProjectBaseDirectory.getInstance(myProject).getBaseDir(myProject.getBaseDir());
          if (myVcsManager.needAutodetectMappings()) {
            AbstractVcs vcs=myVcsManager.findVersioningVcs(file);
            if (vcs != null && vcs != myVcsManager.getVcsFor(file)) {
              myVcsManager.removeDirectoryMapping(new VcsDirectoryMapping("",""));
              myVcsManager.setAutoDirectoryMapping(file.getPath(),vcs.getName());
              myVcsManager.cleanupMappings();
              myVcsManager.updateActiveVcss();
            }
          }
        }
      }
;
      ApplicationManager.getApplication().invokeLater(runnable,new Condition(){
        @Override public boolean value(        Object o){
          return (!myProject.isOpen()) || myProject.isDisposed();
        }
      }
);
    }
  }
);
}
