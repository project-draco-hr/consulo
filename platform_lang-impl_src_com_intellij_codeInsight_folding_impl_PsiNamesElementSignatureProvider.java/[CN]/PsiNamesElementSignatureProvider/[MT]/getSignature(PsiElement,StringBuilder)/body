{
  if (element instanceof PsiNamedElement) {
    PsiNamedElement named=(PsiNamedElement)element;
    final String name=named.getName();
    if (StringUtil.isEmpty(name)) {
      return null;
    }
    int index=getChildIndex(named,element.getParent(),name,(Class<PsiNamedElement>)named.getClass());
    StringBuilder bufferToUse=buffer;
    if (bufferToUse == null) {
      bufferToUse=new StringBuilder();
    }
    bufferToUse.append(TYPE_MARKER).append(ELEMENT_TOKENS_SEPARATOR).append(name).append(ELEMENT_TOKENS_SEPARATOR).append(index);
    return bufferToUse;
  }
 else   if (element instanceof PsiComment) {
    PsiElement parent=element.getParent();
    boolean nestedComment=false;
    if (parent instanceof PsiComment && parent.getTextRange().equals(element.getTextRange())) {
      parent=parent.getParent();
      nestedComment=true;
    }
    if (parent instanceof PsiNamedElement && (nestedComment || parent.getFirstChild() == element)) {
      StringBuilder bufferToUse=buffer;
      if (bufferToUse == null) {
        bufferToUse=new StringBuilder();
      }
      bufferToUse.append(TYPE_MARKER).append(ELEMENT_TOKENS_SEPARATOR).append(DOC_COMMENT_MARKER);
      return bufferToUse;
    }
  }
  PsiElement parent=element.getParent();
  if (parent instanceof PsiNamedElement && !(parent instanceof PsiFile)) {
    PsiElement firstChild=element.getFirstChild();
    PsiElement lastChild=element.getLastChild();
    if (firstChild != null && "{".equals(firstChild.getText()) && lastChild != null && "}".equals(lastChild.getText())) {
      StringBuilder bufferToUse=buffer;
      if (bufferToUse == null) {
        bufferToUse=new StringBuilder();
      }
      bufferToUse.append(TYPE_MARKER).append(ELEMENT_TOKENS_SEPARATOR).append(CODE_BLOCK_MARKER);
      return bufferToUse;
    }
  }
  return null;
}
