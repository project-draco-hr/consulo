{
  int offset=editor.getCaretModel().getOffset();
  PsiElement element=file.findElementAt(offset);
  if (element == null)   return null;
  PsiInstanceOfExpression expression=PsiTreeUtil.getParentOfType(element,PsiInstanceOfExpression.class);
  if (expression != null) {
    return expression;
  }
  PsiStatement statement=PsiTreeUtil.getParentOfType(element,PsiIfStatement.class,PsiWhileStatement.class);
  if (statement instanceof PsiIfStatement) {
    PsiExpression condition=((PsiIfStatement)statement).getCondition();
    if (condition instanceof PsiInstanceOfExpression) {
      if (atSameLine(condition,editor) || insideEmptyBlockOfStatement(statement,element)) {
        return (PsiInstanceOfExpression)condition;
      }
    }
  }
 else   if (statement instanceof PsiWhileStatement) {
    PsiExpression condition=((PsiWhileStatement)statement).getCondition();
    if (condition instanceof PsiInstanceOfExpression) {
      if (atSameLine(condition,editor) || insideEmptyBlockOfStatement(statement,element)) {
        return (PsiInstanceOfExpression)condition;
      }
    }
  }
  return null;
}
