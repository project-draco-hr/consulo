{
  final Set<XmlName> result=new HashSet<XmlName>();
  final Pair<AntDomMacroDef,AntDomScriptDef> contextMacroOrScriptDef=getContextMacroOrScriptDef(parentElement);
  final AntDomMacroDef restrictToMacroDef=contextMacroOrScriptDef != null ? contextMacroOrScriptDef.getFirst() : null;
  final AntDomScriptDef restrictToScriptDef=contextMacroOrScriptDef != null ? contextMacroOrScriptDef.getSecond() : null;
  for (  XmlName xmlName : myCustomElements.keySet()) {
    final AntDomNamedElement declaringElement=myDeclarations.get(xmlName);
    if (declaringElement instanceof AntDomMacrodefElement) {
      if (restrictToMacroDef == null || !restrictToMacroDef.equals(declaringElement.getParentOfType(AntDomMacroDef.class,true))) {
        continue;
      }
    }
 else     if (declaringElement instanceof AntDomScriptdefElement) {
      if (restrictToScriptDef == null || !restrictToScriptDef.equals(declaringElement.getParentOfType(AntDomScriptDef.class,true))) {
        continue;
      }
    }
    result.add(xmlName);
  }
  return result;
}
