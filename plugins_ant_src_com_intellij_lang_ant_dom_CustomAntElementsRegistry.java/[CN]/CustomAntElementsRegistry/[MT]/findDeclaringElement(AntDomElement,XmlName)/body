{
  final AntDomElement declaration=myDeclarations.get(customElementName);
  if (declaration == null) {
    return null;
  }
  if (declaration instanceof AntDomMacrodefElement) {
    final Pair<AntDomMacroDef,AntDomScriptDef> contextMacroOrScriptDef=getContextMacroOrScriptDef(parentElement);
    final AntDomMacroDef macrodefUsed=contextMacroOrScriptDef != null ? contextMacroOrScriptDef.getFirst() : null;
    if (macrodefUsed == null || !macrodefUsed.equals(declaration.getParentOfType(AntDomMacroDef.class,true))) {
      return null;
    }
  }
 else   if (declaration instanceof AntDomScriptdefElement) {
    final Pair<AntDomMacroDef,AntDomScriptDef> contextMacroOrScriptDef=getContextMacroOrScriptDef(parentElement);
    final AntDomScriptDef scriptDefUsed=contextMacroOrScriptDef != null ? contextMacroOrScriptDef.getSecond() : null;
    if (scriptDefUsed == null || !scriptDefUsed.equals(declaration.getParentOfType(AntDomScriptDef.class,true))) {
      return null;
    }
  }
  return declaration;
}
