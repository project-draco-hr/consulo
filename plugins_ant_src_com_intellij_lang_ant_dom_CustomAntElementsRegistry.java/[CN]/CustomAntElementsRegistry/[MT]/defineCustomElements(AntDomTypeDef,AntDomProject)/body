{
  final String uri=typedef.getUri().getStringValue();
  final String customTagName=typedef.getName().getStringValue();
  final String classname=typedef.getClassName().getStringValue();
  if (classname != null && customTagName != null) {
    registerElement(typedef,customTagName,uri,classname,getClassLoader(typedef,antProject));
  }
 else {
    final XmlElement xmlElement=antProject.getXmlElement();
    final Project project=xmlElement != null ? xmlElement.getProject() : null;
    if (project != null) {
      final String resource=typedef.getResource().getStringValue();
      if (resource != null) {
        final ClassLoader loader=getClassLoader(typedef,antProject);
        if (loader != null) {
          final InputStream stream=loader.getResourceAsStream(resource);
          if (stream != null) {
            loadFromStream(typedef,uri,resource,loader,stream,project);
          }
        }
      }
 else {
        final PsiFileSystemItem file=typedef.getFile().getValue();
        if (file instanceof PsiFile) {
          final VirtualFile vf=file.getVirtualFile();
          if (vf != null) {
            try {
              final InputStream stream=vf.getInputStream();
              if (stream != null) {
                loadFromStream(typedef,uri,file.getName(),getClassLoader(typedef,antProject),stream,project);
              }
            }
 catch (            IOException e) {
              LOG.info(e);
            }
          }
        }
      }
    }
  }
}
