{
  final String uri=typedef.getUri().getStringValue();
  final String nsPrefix=(uri == null) ? null : typedef.getXmlTag().getPrefixByNamespace(uri);
  final String customTagName=typedef.getName().getStringValue();
  final String classname=typedef.getClassName().getStringValue();
  if (classname != null && customTagName != null) {
    registerElement(typedef,customTagName,nsPrefix,classname,getClassLoader(collectUrls(typedef),antProject));
  }
 else {
    final XmlElement xmlElement=antProject.getXmlElement();
    final Project project=xmlElement != null ? xmlElement.getProject() : null;
    if (project != null) {
      final String resource=typedef.getResource().getStringValue();
      if (resource != null) {
        final ClassLoader loader=getClassLoader(collectUrls(typedef),antProject);
        if (loader != null) {
          final InputStream stream=loader.getResourceAsStream(resource);
          if (stream != null) {
            loadFromStream(typedef,nsPrefix,resource,loader,stream,project);
          }
        }
      }
 else {
        final PsiFileSystemItem file=typedef.getFile().getValue();
        if (file instanceof PsiFile) {
          final VirtualFile vf=file.getVirtualFile();
          if (vf != null) {
            try {
              final InputStream stream=vf.getInputStream();
              if (stream != null) {
                loadFromStream(typedef,nsPrefix,file.getName(),getClassLoader(collectUrls(typedef),antProject),stream,project);
              }
            }
 catch (            IOException e) {
              LOG.info(e);
            }
          }
        }
      }
    }
  }
}
