{
  final String customTagName=scriptdef.getName().getStringValue();
  if (customTagName != null) {
    final String nsUri=scriptdef.getUri().getStringValue();
    final ClassLoader classLoader=getClassLoader(scriptdef,myAntProject);
    addCustomDefinition(scriptdef,customTagName,nsUri,ClassProvider.EMPTY);
    ReflectedProject reflectedProject=null;
    for (    AntDomScriptdefElement element : scriptdef.getScriptdefElements()) {
      final String customSubTagName=element.getName().getStringValue();
      if (customSubTagName != null) {
        final String classname=element.getClassname().getStringValue();
        if (classname != null) {
          addCustomDefinition(element,customTagName,nsUri,ClassProvider.create(classname,classLoader));
        }
 else {
          Class clazz=null;
          final String typeName=element.getElementType().getStringValue();
          if (typeName != null) {
            clazz=lookupClass(new XmlName(typeName));
            if (clazz == null) {
              if (reflectedProject == null) {
                reflectedProject=ReflectedProject.getProject(myAntProject.getClassLoader());
              }
              final Hashtable<String,Class> coreTasks=reflectedProject.getTaskDefinitions();
              if (coreTasks != null) {
                clazz=coreTasks.get(typeName);
              }
              if (clazz == null) {
                final Hashtable<String,Class> coreTypes=reflectedProject.getDataTypeDefinitions();
                if (coreTypes != null) {
                  clazz=coreTypes.get(typeName);
                }
              }
            }
          }
          addCustomDefinition(element,customSubTagName,nsUri,ClassProvider.create(clazz));
        }
      }
    }
  }
}
