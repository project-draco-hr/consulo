{
  final GenericAttributeValue<String> name=scriptdef.getName();
  final String customTagName=name != null ? name.getStringValue() : null;
  if (customTagName != null) {
    final String nsUri=scriptdef.getUri().getStringValue();
    final ClassLoader classLoader=getClassLoader(scriptdef,myAntProject);
    addCustomDefinition(scriptdef,customTagName,nsUri,null,null);
    ReflectedProject reflectedProject=null;
    for (    AntDomScriptdefElement element : scriptdef.getScriptdefElements()) {
      final GenericAttributeValue<String> elemName=element.getName();
      if (elemName != null) {
        final String customSubTagName=elemName.getStringValue();
        final GenericAttributeValue<String> clsName=element.getClassname();
        final String classname=clsName != null ? clsName.getStringValue() : null;
        if (classname != null) {
          registerElement(element,customTagName,nsUri,classname,classLoader);
        }
 else {
          Class clazz=null;
          final GenericAttributeValue<String> elemType=element.getElementType();
          String typeName=elemType != null ? elemType.getStringValue() : null;
          if (typeName != null) {
            clazz=myCustomElements.get(new XmlName(typeName));
            if (clazz == null) {
              if (reflectedProject == null) {
                reflectedProject=ReflectedProject.getProject(myAntProject.getClassLoader());
              }
              final Hashtable<String,Class> coreTasks=reflectedProject.getTaskDefinitions();
              if (coreTasks != null) {
                clazz=coreTasks.get(typeName);
              }
              if (clazz == null) {
                final Hashtable<String,Class> coreTypes=reflectedProject.getDataTypeDefinitions();
                if (coreTypes != null) {
                  clazz=coreTypes.get(typeName);
                }
              }
            }
          }
          addCustomDefinition(element,customSubTagName,nsUri,clazz,null);
        }
      }
    }
  }
}
