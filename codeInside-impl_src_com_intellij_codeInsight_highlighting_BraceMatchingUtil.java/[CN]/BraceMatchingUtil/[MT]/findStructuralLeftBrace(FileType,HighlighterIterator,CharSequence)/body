{
  ourBraceStack.clear();
  ourTagNameStack.clear();
  while (!iterator.atEnd()) {
    if (isStructuralBraceToken(fileType,iterator,fileText)) {
      if (isRBraceToken(iterator,fileText,fileType)) {
        ourBraceStack.push(getToken(iterator));
        ourTagNameStack.push(getTagName(fileText,iterator));
      }
      if (isLBraceToken(iterator,fileText,fileType)) {
        if (ourBraceStack.size() == 0)         return true;
        final int group=getTokenGroup(getToken(iterator),fileType);
        final IElementType topTokenType=ourBraceStack.pop();
        final IElementType tokenType=getToken(iterator);
        boolean isStrict=isStrictTagMatching(fileType,group);
        boolean isCaseSensitive=areTagsCaseSensitive(fileType,group);
        String topTagName=null;
        String tagName=null;
        if (isStrict) {
          topTagName=ourTagNameStack.pop();
          tagName=getTagName(fileText,iterator);
        }
        if (!isPairBraces(topTokenType,tokenType,fileType) || isStrict && !Comparing.equal(topTagName,tagName,isCaseSensitive)) {
          return false;
        }
      }
    }
    iterator.retreat();
  }
  return false;
}
