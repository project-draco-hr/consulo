{
  final ModuleFileIndex moduleFileIndex=ModuleRootManager.getInstance(module).getFileIndex();
  final PsiManager manager=PsiManager.getInstance(module.getProject());
  String nameToMatch=packageName;
  while (true) {
    VirtualFile[] vFiles=moduleFileIndex.getDirectoriesByPackageName(nameToMatch,false);
    PsiDirectory directory=getWritableDirectory(vFiles,manager);
    if (directory != null)     return directory.getPackage();
    int lastDotIndex=nameToMatch.lastIndexOf(".");
    if (lastDotIndex >= 0) {
      nameToMatch=nameToMatch.substring(0,lastDotIndex);
    }
 else {
      return null;
    }
  }
}
