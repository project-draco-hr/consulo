{
  final DefaultActionGroup group=new DefaultActionGroup();
  final AnAction globalShowNextAction=ActionManager.getInstance().getAction("VcsShowNextChangeMarker");
  final AnAction globalShowPrevAction=ActionManager.getInstance().getAction("VcsShowPrevChangeMarker");
  final ShowPrevChangeMarkerAction localShowPrevAction=new ShowPrevChangeMarkerAction(tracker.getPrevRange(range),tracker,editor);
  final ShowNextChangeMarkerAction localShowNextAction=new ShowNextChangeMarkerAction(tracker.getNextRange(range),tracker,editor);
  final JComponent editorComponent=editor.getComponent();
  localShowNextAction.registerCustomShortcutSet(localShowNextAction.getShortcutSet(),editorComponent);
  localShowPrevAction.registerCustomShortcutSet(localShowPrevAction.getShortcutSet(),editorComponent);
  group.add(localShowPrevAction);
  group.add(localShowNextAction);
  localShowNextAction.copyFrom(globalShowNextAction);
  localShowPrevAction.copyFrom(globalShowPrevAction);
  group.add(new RollbackLineStatusRangeAction(tracker,range,editor));
  group.add(new ShowLineStatusRangeDiffAction(tracker,range,editor));
  group.add(new CopyLineStatusRangeAction(tracker,range));
  final java.util.List<AnAction> actionList=(java.util.List<AnAction>)editorComponent.getClientProperty(AnAction.ourClientProperty);
  actionList.remove(globalShowPrevAction);
  actionList.remove(globalShowNextAction);
  final JComponent toolbar=ActionManager.getInstance().createActionToolbar(ActionPlaces.FILEHISTORY_VIEW_TOOLBAR,group,true).getComponent();
  final Color background=((EditorEx)editor).getBackgroundColor();
  final Color foreground=editor.getColorsScheme().getColor(EditorColors.CARET_COLOR);
  toolbar.setBackground(background);
  toolbar.setBorder(new ColoredSideBorder(foreground,foreground,(range.getType() != Range.INSERTED) ? null : foreground,foreground,1));
  final JPanel component=new JPanel(new BorderLayout());
  component.setOpaque(false);
  final JPanel toolbarPanel=new JPanel(new BorderLayout());
  toolbarPanel.setOpaque(false);
  toolbarPanel.add(toolbar,BorderLayout.WEST);
  component.add(toolbarPanel,BorderLayout.NORTH);
  if (range.getType() != Range.INSERTED) {
    final DocumentEx doc=(DocumentEx)tracker.getUpToDateDocument();
    final EditorEx uEditor=(EditorEx)EditorFactory.getInstance().createViewer(doc,tracker.getProject());
    final EditorHighlighter highlighter=EditorHighlighterFactory.getInstance().createEditorHighlighter(tracker.getProject(),getFileName(tracker.getDocument()));
    uEditor.setHighlighter(highlighter);
    final EditorFragmentComponent editorFragmentComponent=EditorFragmentComponent.createEditorFragmentComponent(uEditor,range.getUOffset1(),range.getUOffset2(),false,false);
    component.add(editorFragmentComponent,BorderLayout.CENTER);
    EditorFactory.getInstance().releaseEditor(uEditor);
  }
  final LightweightHint lightweightHint=new LightweightHint(component);
  lightweightHint.addHintListener(new HintListener(){
    public void hintHidden(    final EventObject event){
      actionList.remove(localShowPrevAction);
      actionList.remove(localShowNextAction);
      actionList.add(globalShowPrevAction);
      actionList.add(globalShowNextAction);
    }
  }
);
  HintManagerImpl.getInstanceImpl().showEditorHint(lightweightHint,editor,point,HintManagerImpl.HIDE_BY_ANY_KEY | HintManagerImpl.HIDE_BY_TEXT_CHANGE | HintManagerImpl.HIDE_BY_OTHER_HINT| HintManagerImpl.HIDE_BY_SCROLLING,-1,false);
}
