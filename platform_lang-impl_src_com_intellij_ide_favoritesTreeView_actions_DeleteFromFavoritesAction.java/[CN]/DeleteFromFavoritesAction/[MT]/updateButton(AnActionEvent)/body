{
  final DataContext dataContext=e.getDataContext();
  Project project=PlatformDataKeys.PROJECT.getData(dataContext);
  if (project == null) {
    e.getPresentation().setEnabled(false);
    return;
  }
  FavoritesTreeNodeDescriptor[] roots=FavoritesTreeViewPanel.CONTEXT_FAVORITES_ROOTS_DATA_KEY.getData(dataContext);
  if (roots == null || roots.length == 0) {
    e.getPresentation().setEnabled(false);
    return;
  }
  final FavoritesManager fm=FavoritesManager.getInstance(project);
  for (  FavoritesTreeNodeDescriptor root : roots) {
    if (!FavoritesTreeUtil.extractParentList(root).isAllowsTree()) {
      if (!(root.getElement() instanceof FavoritesListNode) && root.getParentDescriptor() != null && (!(root.getParentDescriptor().getElement() instanceof FavoritesListNode))) {
        e.getPresentation().setEnabled(false);
        return;
      }
    }
  }
  if (roots.length == 1 && roots[0].getElement() instanceof FavoritesListNode && fm.isReadOnly(((FavoritesListNode)roots[0].getElement()).getName())) {
    e.getPresentation().setEnabled(false);
    return;
  }
  e.getPresentation().setEnabled(true);
}
