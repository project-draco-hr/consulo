{
  if (duplicates.size() > 0) {
    final String message="IDEA has found fragments that can be replaced with include directive\n" + "Do you want to review them?";
    final int exitCode=Messages.showYesNoDialog(project,message,REFACTORING_NAME,Messages.getInformationIcon());
    if (exitCode == DialogWrapper.OK_EXIT_CODE) {
      CommandProcessor.getInstance().executeCommand(project,new Runnable(){
        public void run(){
          boolean replaceAll=false;
          for (Iterator<Pair<PsiElement,PsiElement>> it=duplicates.iterator(); it.hasNext(); ) {
            Pair<PsiElement,PsiElement> pair=it.next();
            if (!replaceAll) {
              highlightInEditor(project,pair,editor);
              ReplacePromptDialog promptDialog=new ReplacePromptDialog(false,"Replace Fragment",project);
              promptDialog.show();
              final int promptResult=promptDialog.getExitCode();
              if (promptResult == ReplacePromptDialog.PromptResult.SKIP)               continue;
              if (promptResult == ReplacePromptDialog.PromptResult.CANCEL)               break;
              if (promptResult == ReplacePromptDialog.PromptResult.OK) {
                doReplaceRange(includePath,((XmlTagChild)pair.getFirst()),(XmlTagChild)pair.getSecond());
              }
 else               if (promptResult == ReplacePromptDialog.PromptResult.ALL) {
                doReplaceRange(includePath,((XmlTagChild)pair.getFirst()),(XmlTagChild)pair.getSecond());
                replaceAll=true;
              }
 else {
                LOG.error("Unknown return status");
              }
            }
 else {
              doReplaceRange(includePath,((XmlTagChild)pair.getFirst()),(XmlTagChild)pair.getSecond());
            }
          }
        }
      }
,"Remove Duplicates",null);
    }
  }
}
