{
  Pair<PsiElement,PsiElement> psiRange=getElementRange(editor,file,range);
  if (psiRange == null)   return null;
  final PsiElement parent=PsiTreeUtil.findCommonParent(psiRange.getFirst(),psiRange.getSecond());
  Pair<PsiElement,PsiElement> elementRange=getElementRange(parent,psiRange.getFirst(),psiRange.getSecond());
  if (elementRange == null)   return null;
  int endOffset=elementRange.getSecond().getTextRange().getEndOffset();
  int endLine;
  if (endOffset == editor.getDocument().getTextLength()) {
    endLine=editor.getDocument().getLineCount();
  }
 else {
    endLine=editor.offsetToLogicalPosition(endOffset).line;
  }
  int startLine=Math.min(range.startLine,editor.offsetToLogicalPosition(elementRange.getFirst().getTextOffset()).line);
  endLine=Math.max(endLine,range.endLine);
  return new LineRange(startLine,endLine);
}
