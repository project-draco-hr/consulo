{
  final int offset=editor.getCaretModel().getOffset();
  PsiElement elementAt=file.findElementAt(offset);
  if (elementAt == null)   return false;
  final Class[] classes=new Class[]{PsiMethod.class,PsiClassInitializer.class,PsiClass.class,PsiComment.class};
  final PsiElement guard=PsiTreeUtil.getParentOfType(elementAt,classes);
  final int insertOffset=calcInsertOffset(editor,result.startLine,result.endLine,isDown);
  elementAt=file.findElementAt(insertOffset);
  final PsiElement newGuard=PsiTreeUtil.getParentOfType(elementAt,classes);
  if (newGuard == guard && isInside(insertOffset,newGuard) == isInside(offset,guard))   return true;
  if (guard instanceof PsiClass && guard.getParent() instanceof PsiClass)   return true;
  if (newGuard instanceof PsiClass && newGuard.getParent() instanceof PsiClass)   return true;
  return false;
}
