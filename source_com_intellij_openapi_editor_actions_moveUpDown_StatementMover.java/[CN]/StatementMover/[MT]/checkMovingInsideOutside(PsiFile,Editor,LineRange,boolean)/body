{
  final int offset=editor.getCaretModel().getOffset();
  final Class[] classes={PsiMethod.class,PsiClassInitializer.class,PsiClass.class,PsiComment.class};
  PsiElement guard=file.findElementAt(offset);
  if (guard == null)   return false;
  do {
    guard=PsiTreeUtil.<PsiElement>getParentOfType(guard,classes);
  }
 while (guard instanceof PsiAnonymousClass);
  calcInsertOffset(editor,file,result);
  PsiElement newGuard=file.findElementAt(insertOffset);
  do {
    newGuard=PsiTreeUtil.<PsiElement>getParentOfType(newGuard,classes);
  }
 while (newGuard instanceof PsiAnonymousClass);
  if (newGuard == guard && isInside(insertOffset,newGuard) == isInside(offset,guard))   return true;
  if (guard instanceof PsiClass && guard.getParent() instanceof PsiClass)   return true;
  if (newGuard instanceof PsiClass && newGuard.getParent() instanceof PsiClass)   return true;
  return false;
}
