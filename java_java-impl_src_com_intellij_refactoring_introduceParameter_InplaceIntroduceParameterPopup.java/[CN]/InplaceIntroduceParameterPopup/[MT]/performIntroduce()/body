{
  boolean isDeleteLocalVariable=false;
  PsiExpression parameterInitializer=myExpr;
  if (myLocalVar != null) {
    if (myPanel.isUseInitializer()) {
      parameterInitializer=myLocalVar.getInitializer();
    }
    isDeleteLocalVariable=myPanel.isDeleteLocalVariable();
  }
  final TIntArrayList parametersToRemove=myPanel.getParametersToRemove();
  final IntroduceParameterProcessor processor=new IntroduceParameterProcessor(myProject,myMethod,myMethodToSearchFor,parameterInitializer,myExpr,myLocalVar,isDeleteLocalVariable,getInputName(),myPanel.isReplaceAllOccurences(),myPanel.getReplaceFieldsWithGetters(),myMustBeFinal || myPanel.isGenerateFinal(),myPanel.isGenerateDelegate(),myTypePointer.getType(),parametersToRemove);
  final Runnable runnable=new Runnable(){
    public void run(){
      final Runnable performRefactoring=new Runnable(){
        public void run(){
          final boolean[] conflictsFound=new boolean[]{true};
          processor.setPrepareSuccessfulSwingThreadCallback(new Runnable(){
            @Override public void run(){
              conflictsFound[0]=processor.hasConflicts();
            }
          }
);
          processor.run();
          normalizeParameterIdxAccordingToRemovedParams(parametersToRemove);
          InplaceIntroduceParameterPopup.super.moveOffsetAfter(!conflictsFound[0]);
          InplaceIntroduceParameterPopup.super.saveSettings(getParameter());
        }
      }
;
      if (ApplicationManager.getApplication().isUnitTestMode()) {
        performRefactoring.run();
      }
 else {
        ApplicationManager.getApplication().invokeLater(performRefactoring);
      }
    }
  }
;
  CommandProcessor.getInstance().executeCommand(myProject,runnable,getCommandName(),null);
}
