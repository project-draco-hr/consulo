{
  Reference<RefCountHolder> ref=file.getUserData(REF_COUNT_HOLDER_IN_FILE_KEY);
  RefCountHolder holder=ref == null ? null : ref.get();
  if (holder == null) {
    holder=new RefCountHolder(file);
    while (true) {
      boolean replaced=((UserDataHolderEx)file).replace(REF_COUNT_HOLDER_IN_FILE_KEY,ref,new SoftReference<RefCountHolder>(holder));
      if (replaced)       break;
      ref=file.getUserData(REF_COUNT_HOLDER_IN_FILE_KEY);
      RefCountHolder newHolder=ref == null ? null : ref.get();
      if (newHolder != null) {
        holder=newHolder;
        break;
      }
    }
  }
  return holder;
}
