{
  final List<PackagingSourceItem> items=mySourceItemsTree.getSelectedItems();
  ParentElementsInfo parentsInfo=findParentAndGrandParent(myArtifactEditor.getArtifact());
  if (parentsInfo == null) {
    return;
  }
  final Artifact artifact=parentsInfo.getGrandparentArtifact();
  final PackagingEditorContext context=myArtifactEditor.getContext();
  context.ensureRootIsWritable(artifact);
  context.ensureRootIsWritable(parentsInfo.getParentArtifact());
  parentsInfo=findParentAndGrandParent(myArtifactEditor.getArtifact());
  if (parentsInfo == null) {
    return;
  }
  final CompositePackagingElement<?> grandParent=parentsInfo.getGrandparentElement();
  List<String> classpath=new ArrayList<String>();
  for (  PackagingSourceItem item : items) {
    final List<? extends PackagingElement<?>> elements=item.createElements(context);
    grandParent.addOrFindChildren(elements);
    classpath.addAll(ManifestFileUtil.getClasspathForElements(elements,context,artifact.getArtifactType()));
  }
  final ArtifactEditor parentArtifactEditor=context.getOrCreateEditor(parentsInfo.getParentArtifact());
  parentArtifactEditor.addToClasspath(parentsInfo.getParentElement(),classpath);
  ((ArtifactEditorImpl)context.getOrCreateEditor(parentsInfo.getGrandparentArtifact())).rebuildTries();
}
