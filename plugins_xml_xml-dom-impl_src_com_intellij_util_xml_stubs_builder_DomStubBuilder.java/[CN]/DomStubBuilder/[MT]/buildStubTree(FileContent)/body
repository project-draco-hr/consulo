{
  VirtualFile file=fileContent.getFile();
  Project project=fileContent.getProject();
  PsiFile psiFile=PsiManager.getInstance(project).findFile(file);
  if (!(psiFile instanceof XmlFile))   return null;
  XmlFile xmlFile=(XmlFile)psiFile;
  try {
    XmlUtil.BUILDING_DOM_STUBS.set(Boolean.TRUE);
    psiFile.putUserData(CONTENT_FOR_DOM_STUBS,fileContent);
    DomFileElement<? extends DomElement> fileElement=DomManager.getDomManager(project).getFileElement(xmlFile);
    if (fileElement == null || !fileElement.getFileDescription().hasStubs())     return null;
    XmlFileHeader header=DomService.getInstance().getXmlFileHeader(xmlFile);
    if (header.getRootTagLocalName() == null) {
      LOG.error("null root tag for " + fileElement + " for "+ file);
    }
    FileStub fileStub=new FileStub(header);
    DomStubBuilderVisitor visitor=new DomStubBuilderVisitor(fileStub);
    visitor.visitDomElement(fileElement.getRootElement());
    return fileStub;
  }
  finally {
    XmlUtil.BUILDING_DOM_STUBS.set(Boolean.FALSE);
    psiFile.putUserData(CONTENT_FOR_DOM_STUBS,null);
  }
}
