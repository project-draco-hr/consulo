{
  if (progress != null)   progress.checkCanceled();
  PsiFile file=scope.getContainingFile();
  final CharSequence buffer=file.getViewProvider().getContents();
  TextRange range=scope.getTextRange();
  int scopeStart=range.getStartOffset();
  int startOffset=scopeStart;
  int endOffset=range.getEndOffset();
  do {
    if (progress != null)     progress.checkCanceled();
    startOffset=searchWord(buffer,startOffset,endOffset,searcher,progress);
    if (startOffset < 0) {
      return true;
    }
    if (!processTreeUp(processor,scope,searcher,startOffset - scopeStart,ignoreInjectedPsi,progress))     return false;
    startOffset++;
  }
 while (startOffset < endOffset);
  return true;
}
