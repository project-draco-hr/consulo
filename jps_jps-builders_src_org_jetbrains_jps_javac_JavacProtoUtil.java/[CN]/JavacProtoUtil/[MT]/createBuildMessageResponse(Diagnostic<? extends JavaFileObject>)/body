{
  final JavacRemoteProto.Message.Response.CompileMessage.Builder msgBuilder=JavacRemoteProto.Message.Response.CompileMessage.newBuilder();
  msgBuilder.setKind(convertKind(diagnostic.getKind()));
  msgBuilder.setText(diagnostic.getMessage(Locale.US));
  final JavaFileObject source=diagnostic.getSource();
  final URI srcUri=source != null ? source.toUri() : null;
  if (srcUri != null) {
    msgBuilder.setSourceUri(srcUri.toString());
  }
  msgBuilder.setLine(diagnostic.getLineNumber());
  msgBuilder.setColumn(diagnostic.getColumnNumber());
  msgBuilder.setProblemBeginOffset(diagnostic.getStartPosition());
  msgBuilder.setProblemEndOffset(diagnostic.getEndPosition());
  msgBuilder.setProblemLocationOffset(diagnostic.getPosition());
  final JavacRemoteProto.Message.Response.Builder builder=JavacRemoteProto.Message.Response.newBuilder();
  builder.setResponseType(JavacRemoteProto.Message.Response.Type.BUILD_MESSAGE).setCompileMessage(msgBuilder.build());
  return builder.build();
}
