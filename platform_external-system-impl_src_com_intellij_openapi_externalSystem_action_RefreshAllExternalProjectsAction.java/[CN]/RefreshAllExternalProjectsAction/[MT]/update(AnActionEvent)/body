{
  ProjectSystemId externalSystemId=ExternalSystemDataKeys.EXTERNAL_SYSTEM_ID.getData(e.getDataContext());
  if (externalSystemId == null) {
    e.getPresentation().setEnabled(false);
    return;
  }
  String name=externalSystemId.getReadableName();
  e.getPresentation().setText(ExternalSystemBundle.message("action.refresh.all.projects.text",name));
  e.getPresentation().setDescription(ExternalSystemBundle.message("action.refresh.all.projects.description",name));
  Project project=CommonDataKeys.PROJECT.getData(e.getDataContext());
  if (project == null) {
    e.getPresentation().setEnabled(false);
    return;
  }
  ExternalSystemProcessingManager processingManager=ServiceManager.getService(ExternalSystemProcessingManager.class);
  e.getPresentation().setEnabled(!processingManager.hasTaskOfTypeInProgress(ExternalSystemTaskType.RESOLVE_PROJECT,project));
}
