{
  super.updateLayoutState();
  if (list.getLayoutOrientation() == JList.HORIZONTAL_WRAP) {
    Insets insets=list.getInsets();
    int listWidth=list.getWidth() - (insets.left + insets.right);
    if (listWidth >= cellWidth) {
      int columnCount=listWidth / cellWidth;
      cellWidth=(columnCount == 0) ? 1 : listWidth / columnCount;
    }
  }
}
