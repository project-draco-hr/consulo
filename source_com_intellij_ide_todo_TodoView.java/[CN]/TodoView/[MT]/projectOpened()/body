{
  myPropertyChangeListener=new MyPropertyChangeListener();
  TodoConfiguration.getInstance().addPropertyChangeListener(myPropertyChangeListener);
  myConnection=myProject.getMessageBus().connectStrongly();
  myConnection.subscribe(FileTypeManager.FILE_TYPES,new MyFileTypeListener());
  StartupManager startupManager=StartupManager.getInstance(myProject);
  startupManager.registerPostStartupActivity(new Runnable(){
    public void run(){
      Content allTodosContent=PeerFactory.getInstance().getContentFactory().createContent(null,IdeBundle.message("title.project"),false);
      myAllTodos=new TodoPanel(myProject,myAllPanelSettings,false,allTodosContent){
        protected TodoTreeBuilder createTreeBuilder(        JTree tree,        DefaultTreeModel treeModel,        Project project){
          AllTodosTreeBuilder builder=new AllTodosTreeBuilder(tree,treeModel,project);
          builder.init();
          return builder;
        }
      }
;
      allTodosContent.setComponent(myAllTodos);
      Content currentFileTodosContent=PeerFactory.getInstance().getContentFactory().createContent(null,IdeBundle.message("title.todo.current.file"),false);
      myCurrentFileTodos=new CurrentFileTodosPanel(myProject,myCurrentPanelSettings,currentFileTodosContent){
        protected TodoTreeBuilder createTreeBuilder(        JTree tree,        DefaultTreeModel treeModel,        Project project){
          CurrentFileTodosTreeBuilder builder=new CurrentFileTodosTreeBuilder(tree,treeModel,project);
          builder.init();
          return builder;
        }
      }
;
      currentFileTodosContent.setComponent(myCurrentFileTodos);
      myContentManager=PeerFactory.getInstance().getContentFactory().createContentManager(new TabbedPaneContentUI(),false,myProject);
      myContentManager.addContent(allTodosContent);
      myContentManager.addContent(currentFileTodosContent);
      Content content=myContentManager.getContent(mySelectedIndex);
      myContentManager.setSelectedContent(content);
      ToolWindowManager toolWindowManager=ToolWindowManager.getInstance(myProject);
      ToolWindow toolWindow=toolWindowManager.registerToolWindow(ToolWindowId.TODO_VIEW,myContentManager.getComponent(),ToolWindowAnchor.BOTTOM);
      toolWindow.setIcon(IconLoader.getIcon("/general/toolWindowTodo.png"));
      new TodoContentManagerWatcher(toolWindow,myContentManager);
    }
  }
);
}
