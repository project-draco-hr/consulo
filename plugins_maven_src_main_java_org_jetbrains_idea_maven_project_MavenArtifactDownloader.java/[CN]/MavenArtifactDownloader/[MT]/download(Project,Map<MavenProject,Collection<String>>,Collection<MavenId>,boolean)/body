{
  final MavenProjectsState projectsState=project.getComponent(MavenProjectsState.class);
  final Map<MavenId,Set<ArtifactRepository>> libraryArtifacts=collectLibraryArtifacts(projectsState,mavenProjects.keySet(),mappedToModules);
  if (myProgressIndicator != null && myProgressIndicator.isCanceled())   return;
  if (isEnabled(myPreferences.getDownloadSources(),demand)) {
    download(libraryArtifacts,MavenToIdeaConverter.SOURCES_CLASSIFIER);
  }
  if (myProgressIndicator != null && myProgressIndicator.isCanceled())   return;
  if (isEnabled(myPreferences.getDownloadJavadoc(),demand)) {
    download(libraryArtifacts,MavenToIdeaConverter.JAVADOC_CLASSIFIER);
  }
  if (myProgressIndicator != null && myProgressIndicator.isCanceled())   return;
  if (isEnabled(myPreferences.getDownloadPlugins(),demand)) {
    final Map<Plugin,MavenProject> plugins=ProjectUtil.collectPlugins(mavenProjects);
    collectAttachedPlugins(projectsState,plugins);
    downloadPlugins(plugins);
    projectsState.updateAllFiles();
  }
  if (myProgressIndicator != null && myProgressIndicator.isCanceled())   return;
  if (isEnabled(myPreferences.getGenerateSources(),demand)) {
    generateSources(project,createGenerateCommand(mavenProjects));
  }
}
