{
  final MavenProjectsManager manager=MavenProjectsManager.getInstance(project);
  final MavenEmbedder e=EmbedderFactory.createEmbedderForExecute(MavenCore.getInstance(project).getState());
  try {
    MavenProcess.run(project,ProjectBundle.message("maven.downloading"),new MavenProcess.MavenTask(){
      public void run(      MavenProcess p) throws CanceledException {
        new MavenArtifactDownloader(manager.getArtifactSettings(),e,p).download(project,manager.getExistingProjects(),true);
      }
    }
);
  }
  finally {
    EmbedderFactory.releaseEmbedder(e);
  }
  VirtualFileManager.getInstance().refresh(false);
}
