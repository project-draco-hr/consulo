{
  final Map<Plugin,MavenProject> plugins=new HashMap<Plugin,MavenProject>();
  for (  Map.Entry<MavenProject,Collection<String>> entry : mavenProjects.entrySet()) {
    final MavenProject mavenProject=entry.getKey();
    final Collection<String> profiles=entry.getValue();
    collectPlugins(mavenProject,mavenProject.getBuild(),plugins);
    for (    Profile profile : (List<Profile>)mavenProject.getModel().getProfiles()) {
      if (profiles.contains(profile.getId())) {
        collectPlugins(mavenProject,profile.getBuild(),plugins);
      }
    }
  }
  return plugins;
}
