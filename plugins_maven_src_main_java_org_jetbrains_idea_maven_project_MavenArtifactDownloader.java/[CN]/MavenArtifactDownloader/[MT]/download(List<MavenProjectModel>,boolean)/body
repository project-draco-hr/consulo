{
  Map<MavenId,Set<ArtifactRepository>> libraryArtifacts=collectLibraryArtifacts(mavenProjects);
  List<File> downloadedFiles=new ArrayList<File>();
  try {
    if (isEnabled(mySettings.getDownloadSources(),demand)) {
      download(libraryArtifacts,MavenConstants.SOURCES_CLASSIFIER,downloadedFiles);
    }
    if (isEnabled(mySettings.getDownloadJavadoc(),demand)) {
      download(libraryArtifacts,MavenConstants.JAVADOC_CLASSIFIER,downloadedFiles);
    }
    if (isEnabled(mySettings.getDownloadPlugins(),demand)) {
      downloadPlugins(mavenProjects);
    }
  }
  finally {
    scheduleFilesRefresh(downloadedFiles);
  }
}
