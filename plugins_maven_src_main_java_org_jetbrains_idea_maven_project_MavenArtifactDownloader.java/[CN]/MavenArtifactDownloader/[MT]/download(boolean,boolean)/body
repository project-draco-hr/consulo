{
  List<File> downloadedFiles=new ArrayList<File>();
  try {
    List<MavenExtraArtifactType> types=new ArrayList<MavenExtraArtifactType>(2);
    if (downloadSources)     types.add(MavenExtraArtifactType.SOURCES);
    if (downloadDocs)     types.add(MavenExtraArtifactType.DOCS);
    String caption=downloadSources && downloadDocs ? ProjectBundle.message("maven.downloading") : (downloadSources ? ProjectBundle.message("maven.downloading.sources") : ProjectBundle.message("maven.downloading.docs"));
    myProgress.setText(caption);
    Map<MavenId,DownloadData> artifacts=collectArtifactsToDownload(types);
    return download(artifacts,downloadedFiles);
  }
  finally {
    boolean isAsync=!ApplicationManager.getApplication().isUnitTestMode();
    LocalFileSystem.getInstance().refreshIoFiles(downloadedFiles,isAsync,false,null);
  }
}
