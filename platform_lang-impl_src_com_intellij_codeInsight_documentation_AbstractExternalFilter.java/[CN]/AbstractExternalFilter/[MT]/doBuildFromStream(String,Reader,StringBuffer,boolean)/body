{
  BufferedReader buf=new BufferedReader(input);
  Matcher anchorMatcher=ourAnchorsuffix.matcher(surl);
  @NonNls String startSection="<!-- ======== START OF CLASS DATA ======== -->";
  @NonNls String endSection="SUMMARY ========";
  @NonNls String greatestEndSection="<!-- ========= END OF CLASS DATA ========= -->";
  boolean isClassDoc=true;
  if (anchorMatcher.find()) {
    isClassDoc=false;
    startSection="<A NAME=\"" + anchorMatcher.group(1).toUpperCase() + "\"";
    endSection="<A NAME=";
  }
  data.append(HTML);
  String read;
  String contentEncoding=null;
  do {
    read=buf.readLine();
    if (read != null && search4Encoding && read.contains("charset")) {
      String foundEncoding=parseContentEncoding(read);
      if (foundEncoding != null) {
        contentEncoding=foundEncoding;
      }
    }
  }
 while (read != null && read.toUpperCase().indexOf(startSection) == -1);
  if (input instanceof MyReader && contentEncoding != null) {
    if (contentEncoding != null && !contentEncoding.equals("UTF-8") && !contentEncoding.equals(((MyReader)input).getEncoding())) {
      Reader stream;
      try {
        stream=getReaderByUrl(surl,myHttpConfigurable,new ProgressIndicatorBase());
      }
 catch (      ProcessCanceledException e) {
        return;
      }
      data.delete(0,data.length());
      doBuildFromStream(surl,new MyReader(((MyReader)stream).getInputStream(),contentEncoding),data,false);
      return;
    }
  }
  if (read == null) {
    data.delete(0,data.length());
    return;
  }
  appendLine(data,read);
  if (isClassDoc) {
    boolean skip=false;
    while (((read=buf.readLine()) != null) && !read.toUpperCase().trim().equals(DL)) {
      if (read.toUpperCase().indexOf(H2) != -1) {
        data.append(H2);
        skip=true;
      }
 else       if (!skip) {
        appendLine(data,read);
      }
    }
    data.append(DL);
    StringBuffer classDetails=new StringBuffer();
    while (((read=buf.readLine()) != null) && !read.toUpperCase().equals(HR) && !read.toUpperCase().equals(P)) {
      appendLine(classDetails,read);
    }
    while (((read=buf.readLine()) != null) && !read.toUpperCase().equals(P) && !read.toUpperCase().equals(HR)) {
      appendLine(data,read.replaceAll(DT,DT + BR));
    }
    data.append(classDetails);
    data.append(P);
  }
  while (((read=buf.readLine()) != null) && StringUtil.indexOfIgnoreCase(read,endSection,0) == -1 && StringUtil.indexOfIgnoreCase(read,greatestEndSection,0) == -1) {
    if (read.toUpperCase().indexOf(HR) == -1) {
      appendLine(data,read);
    }
  }
  data.append(HTML_CLOSE);
}
