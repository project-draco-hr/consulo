{
  BufferedReader buf=new BufferedReader(input);
  Matcher anchorMatcher=ourAnchorsuffix.matcher(surl);
  @NonNls String startSection="<!-- ======== START OF CLASS DATA ======== -->";
  @NonNls String endSection="SUMMARY ========";
  @NonNls String greatestEndSection="<!-- ========= END OF CLASS DATA ========= -->";
  boolean isClassDoc=true;
  if (anchorMatcher.find()) {
    isClassDoc=false;
    startSection="<A NAME=\"" + anchorMatcher.group(1).toUpperCase() + "\"";
    endSection="<A NAME=";
  }
  data.append(HTML);
  String read;
  String charset=null;
  do {
    read=buf.readLine();
  }
 while (read != null && read.toUpperCase().indexOf(startSection) == -1);
  if (input instanceof MyReader && charset != null) {
    String contentEncoding=parseContentEncoding(charset);
    if (contentEncoding != null) {
      input=new MyReader(((MyReader)input).getInputStream(),contentEncoding);
      buf=new BufferedReader(input);
    }
  }
  if (read == null) {
    data.delete(0,data.length());
    return;
  }
  appendLine(data,read);
  if (isClassDoc) {
    boolean skip=false;
    while (((read=buf.readLine()) != null) && !read.toUpperCase().trim().equals(DL)) {
      if (read.toUpperCase().indexOf(H2) != -1) {
        data.append(H2);
        skip=true;
      }
 else       if (!skip) {
        appendLine(data,read);
      }
    }
    data.append(DL);
    StringBuffer classDetails=new StringBuffer();
    while (((read=buf.readLine()) != null) && !read.toUpperCase().equals(HR) && !read.toUpperCase().equals(P)) {
      appendLine(classDetails,read);
    }
    while (((read=buf.readLine()) != null) && !read.toUpperCase().equals(P) && !read.toUpperCase().equals(HR)) {
      appendLine(data,read.replaceAll(DT,DT + BR));
    }
    data.append(classDetails);
    data.append(P);
  }
  while (((read=buf.readLine()) != null) && read.indexOf(endSection) == -1 && read.indexOf(greatestEndSection) == -1) {
    if (read.toUpperCase().indexOf(HR) == -1) {
      appendLine(data,read);
    }
  }
  data.append(HTML_CLOSE);
}
