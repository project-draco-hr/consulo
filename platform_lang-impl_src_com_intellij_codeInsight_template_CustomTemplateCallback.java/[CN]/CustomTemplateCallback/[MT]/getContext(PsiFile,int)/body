{
  PsiElement element=null;
  if (!InjectedLanguageManager.getInstance(file.getProject()).isInjectedFragment(file)) {
    element=InjectedLanguageUtil.findInjectedElementNoCommit(file,offset);
  }
  if (element == null) {
    element=file.findElementAt(offset);
    if (element == null) {
      element=file;
    }
  }
  return element;
}
