{
  if (wrapping) {
    return editor.getSelectionModel().getSelectionStart();
  }
 else {
    int caretOffset=editor.getCaretModel().getOffset();
    return caretOffset > 0 ? caretOffset - 1 : 0;
  }
}
