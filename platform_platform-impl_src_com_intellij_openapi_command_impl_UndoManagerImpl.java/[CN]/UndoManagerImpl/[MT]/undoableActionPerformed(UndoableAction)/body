{
  ApplicationManager.getApplication().assertIsDispatchThread();
  if (myCurrentOperationState != NONE)   return;
  if (myCommandLevel == 0) {
    LOG.assertTrue(action instanceof NonUndoableAction,"Undoable actions allowed inside commands only (see com.intellij.openapi.command.CommandProcessor.executeCommand())");
    commandStarted(UndoConfirmationPolicy.DEFAULT);
    myCurrentMerger.addAction(action,false);
    commandFinished("",null);
    return;
  }
  myCurrentMerger.addAction(action,CommandProcessor.getInstance().isUndoTransparentActionInProgress());
}
