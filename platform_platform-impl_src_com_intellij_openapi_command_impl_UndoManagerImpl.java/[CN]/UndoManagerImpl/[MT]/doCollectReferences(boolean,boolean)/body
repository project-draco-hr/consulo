{
  Set<DocumentReference> result=new THashSet<DocumentReference>();
  result.addAll(myUndoStacksHolder.getAffectedDocuments());
  result.addAll(myUndoStacksHolder.getGlobalStackAffectedDocuments());
  if (collectRedo) {
    result.addAll(myRedoStacksHolder.getAffectedDocuments());
    result.addAll(myRedoStacksHolder.getGlobalStackAffectedDocuments());
  }
  if (collectMergers) {
    if (myMerger != null)     result.addAll(myMerger.getAffectedDocuments());
    if (myCurrentMerger != null)     result.addAll(myCurrentMerger.getAffectedDocuments());
  }
  return result;
}
