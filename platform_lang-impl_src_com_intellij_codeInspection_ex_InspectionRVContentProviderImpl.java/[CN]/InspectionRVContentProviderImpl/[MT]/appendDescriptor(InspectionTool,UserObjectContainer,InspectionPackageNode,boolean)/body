{
  final GlobalInspectionContextImpl context=tool.getContext();
  final RefElementContainer refElementDescriptor=((RefElementContainer)container);
  final RefEntity refElement=refElementDescriptor.getUserObject();
  if (context.getUIOptions().SHOW_ONLY_DIFF && tool.getElementStatus(refElement) == FileStatus.NOT_CHANGED)   return;
  if (tool instanceof DescriptorProviderInspection && !(tool instanceof CommonInspectionToolWrapper)) {
    final DescriptorProviderInspection descriptorProviderInspection=(DescriptorProviderInspection)tool;
    final CommonProblemDescriptor[] problems=refElementDescriptor.getProblemDescriptors();
    if (problems != null) {
      final RefElementNode elemNode=addNodeToParent(container,tool,pNode);
      for (      CommonProblemDescriptor problem : problems) {
        if (context.getUIOptions().SHOW_ONLY_DIFF && descriptorProviderInspection.getProblemStatus(problem) == FileStatus.NOT_CHANGED) {
          continue;
        }
        elemNode.add(new ProblemDescriptionNode(refElement,problem,descriptorProviderInspection));
        if (problems.length == 1) {
          elemNode.setProblem(problems[0]);
        }
      }
    }
  }
 else {
    if (canPackageRepeat) {
      final Set<RefEntity> currentElements=tool.getContent().get(pNode.getPackageName());
      if (currentElements != null) {
        final Set<RefEntity> currentEntities=new HashSet<RefEntity>(currentElements);
        if (InspectionTool.contains(refElement,currentEntities))         return;
      }
    }
    addNodeToParent(container,tool,pNode);
  }
}
