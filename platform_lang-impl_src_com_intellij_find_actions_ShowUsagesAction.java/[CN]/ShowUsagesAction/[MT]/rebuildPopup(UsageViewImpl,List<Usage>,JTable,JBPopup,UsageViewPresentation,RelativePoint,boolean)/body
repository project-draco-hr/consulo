{
  ApplicationManager.getApplication().assertIsDispatchThread();
  if (popup.isDisposed())   return;
  final List<UsageNode> nodes=new ArrayList<UsageNode>();
  int filtered;
  String fullTitle;
synchronized (usages) {
    if (!popup.isVisible() && (usages.size() <= 1 || !showPopupIfNeedTo(popup,popupPosition))) {
      return;
    }
    addUsageNodes(usageView.getRoot(),usageView,nodes);
    boolean shouldShowMoreSeparator=usages.contains(MORE_USAGES_SEPARATOR);
    if (shouldShowMoreSeparator) {
      nodes.add(MORE_USAGES_SEPARATOR_NODE);
    }
    filtered=filtered(usages,usageView);
    String title=presentation.getTabText();
    fullTitle=getFullTitle(usages,title,shouldShowMoreSeparator,nodes.size() - (shouldShowMoreSeparator ? 1 : 0),findUsagesInProgress);
  }
  ((AbstractPopup)popup).setCaption(fullTitle);
  JComponent content=popup.getContent();
  Window window=SwingUtilities.windowForComponent(content);
  Dimension d=window.getSize();
  Vector<Object> data=new Vector<Object>();
  int width=setTableModel(table,nodes,usageView,data,filtered,presentation);
  width=(int)Math.max(d.getWidth(),width);
  Dimension headerSize=((AbstractPopup)popup).getHeaderPreferredSize();
  width=Math.max((int)headerSize.getWidth(),width);
  width=Math.max(myWidth,width);
  if (myWidth == -1)   myWidth=width;
  int newWidth=Math.max(width,d.width + width - myWidth);
  myWidth=newWidth;
  int rowsToShow=Math.min(30,data.size());
  Dimension dimension=new Dimension(newWidth,table.getRowHeight() * rowsToShow);
  Rectangle rectangle=fitToScreen(dimension,popupPosition,table);
  dimension=rectangle.getSize();
  Point location=window.getLocation();
  if (!location.equals(rectangle.getLocation())) {
    window.setLocation(rectangle.getLocation());
  }
  if (!data.isEmpty()) {
    TableScrollingUtil.ensureSelectionExists(table);
  }
  table.setSize(dimension);
  Dimension footerSize=((AbstractPopup)popup).getFooterPreferredSize();
  int newHeight=(int)(dimension.height + headerSize.getHeight() + footerSize.getHeight()) + 4;
  Dimension newDim=new Dimension(dimension.width,newHeight);
  window.setSize(newDim);
  window.setMinimumSize(newDim);
  window.setMaximumSize(newDim);
  window.validate();
  window.repaint();
  table.revalidate();
  table.repaint();
}
