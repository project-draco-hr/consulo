{
  JComponent content=popup.getContent();
  Window window=SwingUtilities.windowForComponent(content);
  Dimension d=window.getSize();
  int width=calcMaxWidth(table);
  width=(int)Math.max(d.getWidth(),width);
  Dimension headerSize=((AbstractPopup)popup).getHeaderPreferredSize();
  width=Math.max((int)headerSize.getWidth(),width);
  width=Math.max(myWidth,width);
  if (myWidth == -1)   myWidth=width;
  int newWidth=Math.max(width,d.width + width - myWidth);
  myWidth=newWidth;
  int rowsToShow=Math.min(30,data.size());
  Dimension dimension=new Dimension(newWidth,table.getRowHeight() * rowsToShow);
  Rectangle rectangle=fitToScreen(dimension,popupPosition,table);
  if (!data.isEmpty()) {
    ScrollingUtil.ensureSelectionExists(table);
  }
  table.setSize(rectangle.getSize());
  Dimension footerSize=((AbstractPopup)popup).getFooterPreferredSize();
  int footer=footerSize.height;
  int footerBorder=footer == 0 ? 0 : 1;
  Insets insets=((AbstractPopup)popup).getPopupBorder().getBorderInsets(content);
  rectangle.height+=headerSize.height + footer + footerBorder+ insets.top+ insets.bottom;
  ScreenUtil.fitToScreen(rectangle);
  Dimension newDim=rectangle.getSize();
  window.setBounds(rectangle);
  window.setMinimumSize(newDim);
  window.setMaximumSize(newDim);
  window.validate();
  window.repaint();
}
