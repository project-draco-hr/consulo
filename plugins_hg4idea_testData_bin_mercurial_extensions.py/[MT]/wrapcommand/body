def wrapcommand(table, command, wrapper):
    (aliases, entry) = cmdutil.findcmd(command, table)
    for (alias, e) in table.iteritems():
        if (e is entry):
            key = alias
            break
    origfn = entry[0]

    def wrap(*args, **kwargs):
        return util.checksignature(wrapper)(util.checksignature(origfn), *args, **kwargs)
    wrap.__doc__ = getattr(origfn, '__doc__')
    wrap.__module__ = getattr(origfn, '__module__')
    newentry = list(entry)
    newentry[0] = wrap
    table[key] = tuple(newentry)
    return entry
