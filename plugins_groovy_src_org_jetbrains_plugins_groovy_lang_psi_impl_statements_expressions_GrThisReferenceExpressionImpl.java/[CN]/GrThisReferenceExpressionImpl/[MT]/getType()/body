{
  final GrReferenceExpression qualifier=getQualifier();
  if (qualifier == null) {
    GroovyPsiElement context=PsiTreeUtil.getParentOfType(this,GrTypeDefinition.class,GroovyFile.class);
    if (context instanceof GrTypeDefinition) {
      return JavaPsiFacade.getInstance(getProject()).getElementFactory().createType((PsiClass)context);
    }
 else     if (context instanceof GroovyFile) {
      final PsiClass scriptClass=((GroovyFile)context).getScriptClass();
      if (scriptClass != null)       return JavaPsiFacade.getInstance(getProject()).getElementFactory().createType(scriptClass);
    }
  }
 else {
    final PsiElement resolved=qualifier.resolve();
    if (resolved instanceof PsiClass) {
      return new PsiImmediateClassType((PsiClass)resolved,PsiSubstitutor.EMPTY);
    }
 else {
      try {
        return JavaPsiFacade.getElementFactory(getProject()).createTypeFromText(qualifier.getText(),this);
      }
 catch (      IncorrectOperationException e) {
        return null;
      }
    }
  }
  return null;
}
