{
  if (isPatternNegated(wildcardPattern)) {
    wildcardPattern=wildcardPattern.substring(1);
  }
  wildcardPattern=StringUtil.replace(wildcardPattern,"\\!","!");
  wildcardPattern=StringUtil.replace(wildcardPattern,".","\\.");
  wildcardPattern=StringUtil.replace(wildcardPattern,"*?",".+");
  wildcardPattern=StringUtil.replace(wildcardPattern,"?*",".+");
  wildcardPattern=StringUtil.replace(wildcardPattern,"*",".*");
  wildcardPattern=StringUtil.replace(wildcardPattern,"?",".");
  return wildcardPattern.replaceAll("(?:\\.\\*)+",".*");
}
