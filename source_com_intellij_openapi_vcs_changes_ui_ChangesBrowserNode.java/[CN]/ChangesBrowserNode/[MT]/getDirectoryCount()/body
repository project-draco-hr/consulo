{
  if (myDirectoryCount == -1) {
    if (userObject instanceof Change && ChangesUtil.getFilePath((Change)userObject).isDirectory()) {
      myDirectoryCount=1;
    }
 else     if (userObject instanceof FilePath && ((FilePath)userObject).isDirectory() && isLeaf()) {
      myDirectoryCount=1;
    }
 else     if (userObject instanceof VirtualFile && ((VirtualFile)userObject).isDirectory() && FileStatusManager.getInstance(myProject).getStatus((VirtualFile)userObject) != FileStatus.NOT_CHANGED) {
      myDirectoryCount=1;
    }
 else {
      myDirectoryCount=0;
    }
    final Enumeration nodes=children();
    while (nodes.hasMoreElements()) {
      ChangesBrowserNode child=(ChangesBrowserNode)nodes.nextElement();
      myDirectoryCount+=child.getDirectoryCount();
    }
  }
  return myDirectoryCount;
}
