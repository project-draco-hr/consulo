{
  final int oldModelSize=size();
  final List<Object> oldModel=new ArrayList<Object>();
  for (int i=0; i < oldModelSize; i++) {
    oldModel.add(getElement(i));
  }
  removeAllElements();
  addElement(myProject);
  final Set<VirtualFile> roots=new HashSet<VirtualFile>();
  final ProjectRootManager projectRootManager=ProjectRootManager.getInstance(myProject);
  Module module=ModuleUtil.findModuleForPsiElement(psiElement);
  final ProjectFileIndex projectFileIndex=projectRootManager.getFileIndex();
  if (module != null) {
    VirtualFile vFile=PsiUtilBase.getVirtualFile(psiElement);
    if (vFile != null && (projectFileIndex.isInLibrarySource(vFile) || projectFileIndex.isInLibraryClasses(vFile))) {
      module=null;
    }
  }
  if (module == null) {
    roots.addAll(Arrays.asList(projectRootManager.getContentRoots()));
  }
 else {
    ModuleRootManager moduleRootManager=ModuleRootManager.getInstance(module);
    roots.addAll(Arrays.asList(moduleRootManager.getContentRoots()));
    addElement(module);
  }
  ApplicationManager.getApplication().runReadAction(new Runnable(){
    public void run(){
      traverseToRoot(psiElement,roots);
    }
  }
);
  if (oldModelSize == size()) {
    for (int i=0; i < oldModelSize; i++) {
      if (!Comparing.equal(oldModel.get(i),getElement(i)))       return true;
    }
    return false;
  }
 else {
    return true;
  }
}
