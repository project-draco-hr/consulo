{
  Object cell=(state != null) ? state.getCell() : null;
  if (cell != null && cell != view.getCurrentRoot() && cell != model.getRoot() && (model.isVertex(cell) || model.isEdge(cell))) {
    Object obj=canvas.drawCell(state);
    Object lab=null;
    Shape clip=null;
    Rectangle newClip=state.getRectangle();
    mxICanvas clippedCanvas=(isLabelClipped(state.getCell())) ? canvas : null;
    if (clippedCanvas instanceof mxImageCanvas) {
      clippedCanvas=((mxImageCanvas)clippedCanvas).getGraphicsCanvas();
    }
    if (clippedCanvas instanceof mxGraphics2DCanvas) {
      Graphics g=((mxGraphics2DCanvas)clippedCanvas).getGraphics();
      clip=g.getClip();
      if (clip instanceof Rectangle) {
        g.setClip(newClip.intersection((Rectangle)clip));
      }
 else {
        g.setClip(newClip);
      }
    }
    if (drawLabel) {
      String label=state.getLabel();
      if (label != null && state.getLabelBounds() != null) {
        lab=canvas.drawLabel(label,state,isHtmlLabel(cell));
      }
    }
    if (clippedCanvas instanceof mxGraphics2DCanvas) {
      ((mxGraphics2DCanvas)clippedCanvas).getGraphics().setClip(clip);
    }
    if (obj != null) {
      cellDrawn(canvas,state,obj,lab);
    }
  }
}
