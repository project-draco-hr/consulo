{
  if (edge != null) {
    model.beginUpdate();
    try {
      Object previous=model.getTerminal(edge,source);
      setConnectionConstraint(edge,terminal,source,constraint);
      String id=null;
      if (isPort(terminal) && terminal instanceof mxICell) {
        id=((mxICell)terminal).getId();
        terminal=getTerminalForPort(terminal,source);
      }
      String key=(source) ? mxConstants.STYLE_SOURCE_PORT : mxConstants.STYLE_TARGET_PORT;
      setCellStyles(key,id,new Object[]{edge});
      model.setTerminal(edge,terminal,source);
      if (isResetEdgesOnConnect()) {
        resetEdge(edge);
      }
      fireEvent(new mxEventObject(mxEvent.CELL_CONNECTED,"edge",edge,"terminal",terminal,"source",source,"previous",previous));
    }
  finally {
      model.endUpdate();
    }
  }
}
