{
  if (vertex != null && visitor != null) {
    if (visited == null) {
      visited=new HashSet<Object>();
    }
    if (!visited.contains(vertex)) {
      visited.add(vertex);
      if (visitor.visit(vertex,edge)) {
        int edgeCount=model.getEdgeCount(vertex);
        if (edgeCount > 0) {
          for (int i=0; i < edgeCount; i++) {
            Object e=model.getEdgeAt(vertex,i);
            boolean isSource=model.getTerminal(e,true) == vertex;
            if (!directed || isSource) {
              Object next=model.getTerminal(e,!isSource);
              traverse(next,directed,visitor,e,visited);
            }
          }
        }
      }
    }
  }
}
