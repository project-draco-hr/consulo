{
  final PsiElement psiElement=node.getPsi();
  XmlDocument xmlDocument=null;
  if (psiElement instanceof XmlFile) {
    XmlFile file=(XmlFile)psiElement;
    xmlDocument=file.getDocument();
  }
 else   if (psiElement instanceof XmlDocument) {
    xmlDocument=(XmlDocument)psiElement;
  }
  XmlElement rootTag=xmlDocument == null ? null : xmlDocument.getRootTag();
  if (rootTag == null) {
    rootTag=xmlDocument;
  }
  List<FoldingDescriptor> foldings=null;
  if (rootTag != null) {
    foldings=new ArrayList<FoldingDescriptor>();
    if (rootTag instanceof XmlTag) {
      addElementsToFold(foldings,rootTag,document);
      for (PsiElement sibling=rootTag.getNextSibling(); sibling != null; sibling=sibling.getNextSibling()) {
        if (sibling instanceof XmlTag)         addElementsToFold(foldings,(XmlElement)sibling,document);
      }
    }
 else {
      doAddForChildren(xmlDocument,foldings,document);
    }
  }
  return foldings != null ? foldings.toArray(new FoldingDescriptor[foldings.size()]) : FoldingDescriptor.EMPTY;
}
