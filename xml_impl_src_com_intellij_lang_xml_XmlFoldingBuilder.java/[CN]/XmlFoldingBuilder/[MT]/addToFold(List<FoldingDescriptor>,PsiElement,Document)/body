{
  LOG.assertTrue(elementToFold.isValid());
  TextRange range=getRangeToFold(elementToFold);
  if (range == null)   return false;
  if (range.getStartOffset() >= 0 && range.getEndOffset() <= elementToFold.getContainingFile().getTextRange().getEndOffset() && range.getEndOffset() <= document.getTextLength()) {
    int startLine=document.getLineNumber(range.getStartOffset());
    int endLine=document.getLineNumber(range.getEndOffset() - 1);
    if (startLine < endLine || elementToFold instanceof XmlAttribute) {
      if (range.getStartOffset() + MIN_TEXT_RANGE_LENGTH < range.getEndOffset()) {
        foldings.add(new FoldingDescriptor(elementToFold.getNode(),range));
        return true;
      }
    }
  }
  return false;
}
