{
  final Project project=e.getData(PlatformDataKeys.PROJECT);
  if (project == null) {
    return;
  }
  PlaceInDocument place=getPlace(e);
  if (place == null) {
    return;
  }
  Document document=place.getDocument();
  int line=document.getLineNumber(place.getOffset());
  VirtualFile file=FileDocumentManager.getInstance().getFile(document);
  for (  XLineBreakpointType<?> type : XDebuggerUtil.getInstance().getLineBreakpointTypes()) {
    if (type.canPutAt(file,line)) {
      XDebuggerUtil.getInstance().toggleLineBreakpoint(project,type,file,line);
      return;
    }
  }
  DebuggerManagerEx debugManager=DebuggerManagerEx.getInstanceEx(project);
  if (debugManager == null) {
    return;
  }
  BreakpointManager manager=debugManager.getBreakpointManager();
  final Breakpoint breakpoint=manager.findBreakpoint(document,place.getOffset(),LineBreakpoint.CATEGORY);
  if (breakpoint == null) {
    LineBreakpoint lineBreakpoint=manager.addLineBreakpoint(document,line);
    if (lineBreakpoint != null) {
      RequestManagerImpl.createRequests(lineBreakpoint);
    }
  }
 else {
    manager.removeBreakpoint(breakpoint);
  }
}
