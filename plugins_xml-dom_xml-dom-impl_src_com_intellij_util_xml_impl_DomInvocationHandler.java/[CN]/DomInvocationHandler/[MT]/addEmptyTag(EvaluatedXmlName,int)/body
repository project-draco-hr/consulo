{
  final XmlTag tag=ensureTagExists();
  final List<XmlTag> subTags=DomImplUtil.findSubTags(tag,tagName,getFile());
  if (subTags.size() < index) {
    index=subTags.size();
  }
  final boolean changing=myManager.setChanging(true);
  try {
    XmlTag newTag=createChildTag(tagName);
    if (index == 0) {
      if (subTags.isEmpty()) {
        return (XmlTag)tag.add(newTag);
      }
      return (XmlTag)tag.addBefore(newTag,subTags.get(0));
    }
    return (XmlTag)tag.addAfter(newTag,subTags.get(index - 1));
  }
  finally {
    myManager.setChanging(changing);
  }
}
