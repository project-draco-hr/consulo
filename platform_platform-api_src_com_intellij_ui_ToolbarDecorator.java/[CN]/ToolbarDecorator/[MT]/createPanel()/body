{
  final CommonActionsPanel.Buttons[] buttons=getButtons();
  final JComponent contextComponent=getComponent();
  myActionsPanel=new CommonActionsPanel(this,contextComponent,myToolbarPosition == ActionToolbarPosition.TOP || myToolbarPosition == ActionToolbarPosition.BOTTOM,myExtraActions.toArray(new AnActionButton[myExtraActions.size()]),myButtonComparator,myAddName,myRemoveName,myMoveUpName,myMoveDownName,myEditName,myAddIcon,buttons);
  final JScrollPane scrollPane=ScrollPaneFactory.createScrollPane(contextComponent,true);
  if (myPreferredSize != null) {
    scrollPane.setPreferredSize(myPreferredSize);
  }
  final JPanel panel=new JPanel(new BorderLayout()){
    @Override public void addNotify(){
      super.addNotify();
      updateButtons();
    }
  }
;
  panel.add(scrollPane,BorderLayout.CENTER);
  panel.add(myActionsPanel,getPlacement());
  installUpdaters();
  updateButtons();
  installDnD();
  panel.putClientProperty(ActionToolbar.ACTION_TOOLBAR_PROPERTY_KEY,myActionsPanel.getComponent(0));
  DataManager.registerDataProvider(panel,this);
  if (myAsUsualTopToolbar) {
    scrollPane.setBorder(IdeBorderFactory.createBorder(SideBorder.ALL));
  }
 else {
    myActionsPanel.setBorder(myActionsPanelBorder);
    panel.setBorder(IdeBorderFactory.createBorder(SideBorder.ALL));
  }
  return panel;
}
