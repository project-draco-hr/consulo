{
synchronized (LayeredLexerEditorHighlighter.this) {
    super.insert(segmentArray,startIndex);
    final int newCount=segmentArray.getSegmentCount();
    final MappedRange[] newRanges=new MappedRange[newCount];
    myRanges=insert(myRanges,newRanges,startIndex,newCount);
    int endIndex=startIndex + segmentArray.getSegmentCount();
    TokenProcessor processor=createTokenProcessor(startIndex);
    for (int i=startIndex; i < endIndex; i++) {
      final short data=getSegmentData(i);
      final IElementType token=unpackToken(data);
      processor.addToken(i,getSegmentStart(i),getSegmentEnd(i),data,token);
    }
    processor.finish();
  }
}
