{
  final SecurityManager sm=System.getSecurityManager();
  if (sm != null) {
    final String name=cls.getName();
    final int i=name.lastIndexOf('.');
    if (i != -1) {
      AccessController.doPrivileged(new PrivilegedAction(){
        public Object run(){
          sm.checkPackageAccess(name.substring(0,i));
          return null;
        }
      }
,new AccessControlContext(new ProtectionDomain[]{pd}));
    }
  }
  domains.add(pd);
}
