{
  List<OrderEntry> existingEntries=new ArrayList<OrderEntry>();
  for (  OrderEntry entry : rootModel.getOrderEntries()) {
    if (!(entry instanceof LibraryOrderEntry))     continue;
    final Library library=((LibraryOrderEntry)entry).getLibrary();
    if (library == null)     continue;
    final VirtualFile[] files=myContext.getLibraryFiles(library,OrderRootType.CLASSES);
    if (description.getSuitableLibraryCondition().value(Arrays.asList(files))) {
      existingEntries.add(entry);
    }
  }
  if (!existingEntries.isEmpty()) {
    String message;
    if (existingEntries.size() > 1) {
      message="There are already " + existingEntries.size() + " "+ myCreator.getDisplayName()+ " libraries.\n Do you want to replace they?";
    }
 else {
      final String name=existingEntries.get(0).getPresentableName();
      message="There is already a " + myCreator.getDisplayName() + " library '"+ name+ "'.\n Do you want to replace it?";
    }
    final int result=Messages.showDialog(rootModel.getProject(),message,"Library Already Exists",new String[]{"&Replace","&Add","&Cancel"},0,null);
    if (result == 0) {
      for (      OrderEntry entry : existingEntries) {
        rootModel.removeOrderEntry(entry);
      }
    }
 else     if (result != 1) {
      return false;
    }
  }
  return true;
}
