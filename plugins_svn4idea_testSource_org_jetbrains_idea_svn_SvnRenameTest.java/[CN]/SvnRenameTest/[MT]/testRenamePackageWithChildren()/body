{
  final VirtualFile child=prepareDirectoriesForRename();
  renameFileInCommand(child,"childnew");
  final ProcessOutput result=runSvn("status");
  verify(result,"D child","D child\\grandChild","D child\\grandChild\\b.txt","D child\\a.txt","A + childnew");
  LocalFileSystem.getInstance().refresh(false);
  final ChangeListManager changeListManager=ChangeListManager.getInstance(myProject);
  changeListManager.ensureUpToDate(false);
  List<Change> changes=new ArrayList<Change>(changeListManager.getDefaultChangeList().getChanges());
  Assert.assertEquals(4,changes.size());
  sortChanges(changes);
  verifyChange(changes.get(0),"child","childnew");
  verifyChange(changes.get(1),"child\\a.txt","childnew\\a.txt");
  verifyChange(changes.get(2),"child\\grandChild","childnew\\grandChild");
  verifyChange(changes.get(3),"child\\grandChild\\b.txt","childnew\\grandChild\\b.txt");
  VirtualFile oldChild=myWorkingCopyDir.findChild("child");
  Assert.assertEquals(FileStatus.DELETED,changeListManager.getStatus(oldChild));
}
