{
  final TestDialog oldTestDialog=Messages.setTestDialog(new TestDialog(){
    public int show(    final String message){
      return 0;
    }
  }
);
  try {
    enableSilentOperation(VcsConfiguration.StandardConfirmation.ADD);
    final VirtualFile parent1=createDirInCommand(myWorkingCopyDir,"parent1");
    final VirtualFile parent2=createDirInCommand(myWorkingCopyDir,"parent2");
    final VirtualFile child=createDirInCommand(parent1,"child");
    createFileInCommand(child,"a.txt","a");
    checkin();
    moveFileInCommand(child,parent2);
    UndoManager.getInstance(myProject).undo(null);
    final File childPath=new File(parent1.getPath(),"child");
    Assert.assertTrue(childPath.exists());
    Assert.assertTrue(new File(childPath,"a.txt").exists());
  }
  finally {
    Messages.setTestDialog(oldTestDialog);
  }
}
