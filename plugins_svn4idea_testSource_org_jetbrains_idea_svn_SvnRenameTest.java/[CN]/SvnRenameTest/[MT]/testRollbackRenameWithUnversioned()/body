{
  enableSilentOperation(VcsConfiguration.StandardConfirmation.ADD);
  final VirtualFile child=createDirInCommand(myWorkingCopyDir,"child");
  createFileInCommand(child,"a.txt","a");
  checkin();
  disableSilentOperation(VcsConfiguration.StandardConfirmation.ADD);
  final VirtualFile unversioned=createFileInCommand(child,"u.txt","u");
  final ChangeListManager changeListManager=ChangeListManager.getInstance(myProject);
  changeListManager.ensureUpToDate(false);
  Assert.assertEquals(FileStatus.UNKNOWN,changeListManager.getStatus(unversioned));
  renameFileInCommand(child,"newchild");
  File newChildPath=new File(myWorkingCopyDir.getPath(),"newchild");
  Assert.assertTrue(new File(newChildPath,"a.txt").exists());
  Assert.assertTrue(new File(newChildPath,"u.txt").exists());
  changeListManager.ensureUpToDate(false);
  Change c=changeListManager.getChange(myWorkingCopyDir.findChild("newchild"));
  Assert.assertTrue(c != null && c.getBeforeRevision() != null && c.getAfterRevision() != null);
  SvnVcs.getInstance(myProject).getRollbackEnvironment().rollbackChanges(Collections.singletonList(c));
  File childPath=new File(myWorkingCopyDir.getPath(),"child");
  Assert.assertTrue(new File(childPath,"a.txt").exists());
  Assert.assertTrue(new File(childPath,"u.txt").exists());
}
