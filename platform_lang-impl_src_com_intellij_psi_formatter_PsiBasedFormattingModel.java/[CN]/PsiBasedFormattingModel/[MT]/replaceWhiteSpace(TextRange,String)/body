{
  String whiteSpaceToUse=myDocumentModel.adjustWhiteSpaceIfNecessary(whiteSpace,textRange.getStartOffset(),textRange.getEndOffset()).toString();
  boolean sameText=CharArrayUtil.regionMatches(myDocumentModel.getDocument().getCharsSequence(),textRange.getStartOffset(),textRange.getEndOffset(),whiteSpaceToUse);
  if (whiteSpaceToUse.isEmpty() && textRange.getLength() > 0) {
    sameText=false;
  }
  if (sameText) {
    return textRange;
  }
  final String wsReplaced=replaceWithPSI(textRange,whiteSpaceToUse);
  if (wsReplaced != null) {
    return new TextRange(textRange.getStartOffset(),textRange.getStartOffset() + wsReplaced.length());
  }
 else {
    return textRange;
  }
}
