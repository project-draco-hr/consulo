{
  if (files == null || files.length == 0) {
    return VirtualFile.EMPTY_ARRAY;
  }
  final Set<VirtualFile> chosenFilesSet=new HashSet<VirtualFile>(Arrays.asList(files));
  final Set<VirtualFile> alreadyAdded=new HashSet<VirtualFile>();
  final Library[] libraries=myLibraryTable.getLibraries();
  for (  Library library : libraries) {
    final VirtualFile[] libraryFiles=library.getFiles(OrderRootType.CLASSES);
    for (    VirtualFile libraryFile : libraryFiles) {
      alreadyAdded.add(libraryFile);
    }
  }
  chosenFilesSet.removeAll(alreadyAdded);
  return chosenFilesSet.toArray(new VirtualFile[chosenFilesSet.size()]);
}
