{
  if (myLastChosen == null) {
    return Collections.EMPTY_LIST;
  }
  final VirtualFile[] files=filterAlreadyAdded(myLastChosen.getSecond());
  if (files.length == 0) {
    return Collections.EMPTY_LIST;
  }
  final LibraryTable.ModifiableModel modifiableModel=myLibraryTable.getModifiableModel();
  final List<Library> addedLibraries=new ArrayList<Library>(files.length);
  for (  VirtualFile file : files) {
    final Library library=modifiableModel.createLibrary(null);
    final Library.ModifiableModel libModel=library.getModifiableModel();
    libModel.addRoot(file,OrderRootType.CLASSES);
    libModel.commit();
    addedLibraries.add(library);
  }
  modifiableModel.commit();
  return addedLibraries;
}
