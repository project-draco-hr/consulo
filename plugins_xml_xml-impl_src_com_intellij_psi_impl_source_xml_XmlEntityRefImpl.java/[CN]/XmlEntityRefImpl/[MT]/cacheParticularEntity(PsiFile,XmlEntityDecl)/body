{
synchronized (PsiLock.LOCK) {
    final Map<String,CachedValue<XmlEntityDecl>> cachingMap=getCachingMap(file);
    final String name=decl.getName();
    if (cachingMap.containsKey(name))     return;
    final SmartPsiElementPointer declPointer=SmartPointerManager.getInstance(file.getProject()).createSmartPsiElementPointer(decl);
    cachingMap.put(name,CachedValuesManager.getManager(file.getProject()).createCachedValue(new CachedValueProvider<XmlEntityDecl>(){
      public Result<XmlEntityDecl> compute(){
        PsiElement declElement=declPointer.getElement();
        if (declElement instanceof XmlEntityDecl && declElement.isValid() && name.equals(((XmlEntityDecl)declElement).getName()))         return new Result<XmlEntityDecl>((XmlEntityDecl)declElement,declElement);
        cachingMap.put(name,null);
        return new Result<XmlEntityDecl>(null,null);
      }
    }
,false));
  }
}
