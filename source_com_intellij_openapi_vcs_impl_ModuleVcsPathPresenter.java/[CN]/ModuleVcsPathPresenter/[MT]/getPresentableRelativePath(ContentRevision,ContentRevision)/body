{
  final VirtualFile oldFile=fromRevision.getFile().getParentPath().getVirtualFile();
  final VirtualFile newFile=toRevision.getFile().getParentPath().getVirtualFile();
  if (oldFile != null && newFile != null) {
    Module oldModule=ModuleUtil.findModuleForFile(oldFile,myProject);
    Module newModule=ModuleUtil.findModuleForFile(newFile,myProject);
    if (oldModule != newModule) {
      return getPresentableRelativePathFor(oldFile);
    }
  }
  final RelativePathCalculator calculator=new RelativePathCalculator(toRevision.getFile().getIOFile().getAbsolutePath(),fromRevision.getFile().getIOFile().getAbsolutePath());
  calculator.execute();
  final String result=calculator.getResult();
  return (result == null) ? null : result.replace("/",File.separator);
}
