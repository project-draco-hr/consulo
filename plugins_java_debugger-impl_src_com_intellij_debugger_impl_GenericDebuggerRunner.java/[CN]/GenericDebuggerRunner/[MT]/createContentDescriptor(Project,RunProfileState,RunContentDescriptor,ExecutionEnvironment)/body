{
  if (state instanceof JavaCommandLine) {
    final JavaParameters parameters=((JavaCommandLine)state).getJavaParameters();
    runCustomPatchers(parameters,env.getExecutor(),env.getRunProfile());
    RemoteConnection connection=DebuggerManagerImpl.createDebugParameters(parameters,true,DebuggerSettings.getInstance().DEBUGGER_TRANSPORT,"",false);
    return attachVirtualMachine(project,state,contentToReuse,env,connection,true);
  }
  if (state instanceof PatchedRunnableState) {
    final RemoteConnection connection=doPatch(new JavaParameters(),env.getRunnerSettings());
    return attachVirtualMachine(project,state,contentToReuse,env,connection,true);
  }
  if (state instanceof RemoteState) {
    final RemoteConnection connection=createRemoteDebugConnection((RemoteState)state,env.getRunnerSettings());
    return attachVirtualMachine(project,state,contentToReuse,env,connection,false);
  }
  return null;
}
