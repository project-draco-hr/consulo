def updatereqenv(self, env):

    def splitnetloc(netloc):
        if (':' in netloc):
            return netloc.split(':', 1)
        else:
            return (netloc, None)
    if (self._baseurl is not None):
        urlcomp = urlparse.urlparse(self._baseurl)
        (host, port) = splitnetloc(urlcomp[1])
        path = urlcomp[2]
        env['SERVER_NAME'] = host
        if port:
            env['SERVER_PORT'] = port
        env['SCRIPT_NAME'] = path
