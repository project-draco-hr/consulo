{
  while (!myQueue.isEmpty()) {
    final VirtualFile current=myQueue.removeFirst();
    if (!process(current))     return false;
    if (current.isDirectory()) {
      final VirtualFile[] files=current.getChildren();
      if (myDirectoryFilter != null && !myDirectoryFilter.process(current,files))       continue;
      for (      VirtualFile child : files) {
        if (myRootPresentFilter != null && (!myRootPresentFilter.accept(child)))         continue;
        if (isExcluded(myExcludedFileIndex,child))         continue;
        myQueue.add(child);
      }
    }
  }
  return true;
}
