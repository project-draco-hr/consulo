{
  final Module[] modules=ModuleManager.getInstance(psiPackage.getProject()).getModules();
  List<ModifiableRootModel> modelsToCommit=new ArrayList<ModifiableRootModel>();
  for (  final Module module : modules) {
    boolean anyChange=false;
    final ModifiableRootModel rootModel=ModuleRootManager.getInstance(module).getModifiableModel();
    final ContentEntry[] contentEntries=rootModel.getContentEntries();
    for (    final ContentEntry contentEntry : contentEntries) {
      final SourceFolder[] sourceFolders=contentEntry.getSourceFolders();
      for (      final SourceFolder sourceFolder : sourceFolders) {
        final String packagePrefix=sourceFolder.getPackagePrefix();
        if (packagePrefix.startsWith(oldQualifiedName)) {
          sourceFolder.setPackagePrefix(newQualifiedName + packagePrefix.substring(oldQualifiedName.length()));
          anyChange=true;
        }
      }
    }
    if (anyChange) {
      modelsToCommit.add(rootModel);
    }
 else {
      rootModel.dispose();
    }
  }
  if (!modelsToCommit.isEmpty()) {
    ModifiableRootModel[] rootModels=modelsToCommit.toArray(new ModifiableRootModel[modelsToCommit.size()]);
    if (rootModels.length > 0) {
      ModuleRootManagerImpl.multiCommit(rootModels,ModuleManager.getInstance(rootModels[0].getProject()).getModifiableModel());
    }
    return true;
  }
 else {
    return false;
  }
}
