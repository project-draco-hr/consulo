{
  final Project project=DataKeys.PROJECT.getData(dataContext);
  final FileEditor editor=DataKeys.FILE_EDITOR.getData(dataContext);
  if (project == null || editor == null) {
    return null;
  }
  VirtualFile file=FileEditorManagerEx.getInstanceEx(project).getFile(editor);
  if (file == null) {
    return null;
  }
  final PsiFile psiFile=PsiManager.getInstance(project).findFile(file);
  if (psiFile == null) {
    return null;
  }
  if (editor instanceof TextEditor) {
    return new TextEditorContext((TextEditor)editor,psiFile);
  }
 else {
    return new SimpleSelectInContext(psiFile);
  }
}
