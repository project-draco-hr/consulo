{
  if (virtualFile.isDirectory()) {
    return "file is a directory";
  }
  String reason=LoadTextUtil.wasCharsetDetectedFromBytes(virtualFile);
  if (reason == null) {
    return null;
  }
  String failReason=null;
  Charset charsetFromContent=((EncodingManagerImpl)EncodingManager.getInstance()).computeCharsetFromContent(virtualFile);
  if (charsetFromContent != null) {
    failReason="hard coded in text, encoding: {0}";
  }
 else {
    Pair<Charset,String> check=ChooseFileEncodingAction.checkFileType(virtualFile);
    if (check.second != null) {
      failReason=check.second;
    }
  }
  if (failReason != null) {
    return MessageFormat.format(failReason,charsetFromContent == null ? "" : charsetFromContent.displayName());
  }
  return null;
}
