{
  if (ApplicationManager.getApplication().isUnitTestMode())   return null;
  int startLine=editor.offsetToLogicalPosition(range.getStartOffset()).line;
  int endLine=Math.min(editor.offsetToLogicalPosition(range.getEndOffset()).line + 1,editor.getDocument().getLineCount() - 1);
  if (startLine >= endLine)   return null;
  EditorFragmentComponent fragmentComponent=createEditorFragmentComponent(editor,startLine,endLine,showFolding,true);
  if (showUpward) {
    y-=fragmentComponent.getPreferredSize().height + 10;
    y=Math.max(0,y);
  }
  Point p=new Point(x,y);
  LightweightHint hint=new MyComponentHint(fragmentComponent);
  HintManagerImpl.getInstanceImpl().showEditorHint(hint,editor,p,(hideByAnyKey ? HintManager.HIDE_BY_ANY_KEY : 0) | HintManager.HIDE_BY_TEXT_CHANGE | HintManager.HIDE_BY_MOUSEOVER,0,false,new HintHint(editor,p));
  return hint;
}
