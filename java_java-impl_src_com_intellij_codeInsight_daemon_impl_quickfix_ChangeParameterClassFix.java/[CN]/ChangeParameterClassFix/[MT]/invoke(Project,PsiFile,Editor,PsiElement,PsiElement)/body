{
  final PsiClass myClass=(PsiClass)startElement;
  if (!FileModificationService.getInstance().prepareFileForWrite(file))   return;
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    @Override public void run(){
      invokeImpl(myClass);
    }
  }
);
  final Editor editor1=CodeInsightUtil.positionCursor(project,myClass.getContainingFile(),myClass);
  if (editor1 == null)   return;
  final Collection<CandidateInfo> toImplement=OverrideImplementUtil.getMethodsToOverrideImplement(myClass,true);
  if (!toImplement.isEmpty()) {
    if (ApplicationManager.getApplication().isUnitTestMode()) {
      ApplicationManager.getApplication().runWriteAction(new Runnable(){
        @Override public void run(){
          Collection<PsiMethodMember> members=ContainerUtil.map2List(toImplement,new Function<CandidateInfo,PsiMethodMember>(){
            @Override public PsiMethodMember fun(            final CandidateInfo s){
              return new PsiMethodMember(s);
            }
          }
);
          OverrideImplementUtil.overrideOrImplementMethodsInRightPlace(editor1,myClass,members,false);
        }
      }
);
    }
 else {
      editor1.getCaretModel().moveToOffset(myClass.getTextRange().getStartOffset());
      OverrideImplementUtil.chooseAndImplementMethods(project,editor1,myClass);
    }
  }
  UndoUtil.markPsiFileForUndo(file);
}
