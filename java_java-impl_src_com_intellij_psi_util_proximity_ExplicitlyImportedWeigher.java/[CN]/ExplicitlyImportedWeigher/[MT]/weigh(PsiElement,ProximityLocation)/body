{
  final PsiElement position=location.getPosition();
  if (position == null) {
    return null;
  }
  final PsiFile elementFile=element.getContainingFile();
  final PsiFile positionFile=position.getContainingFile();
  if (positionFile != null && elementFile != null && positionFile.getOriginalFile().equals(elementFile.getOriginalFile())) {
    return true;
  }
  if (element instanceof PsiClass) {
    final String qname=((PsiClass)element).getQualifiedName();
    if (qname != null) {
      final PsiJavaFile psiJavaFile=PsiTreeUtil.getContextOfType(position,PsiJavaFile.class,false);
      if (psiJavaFile != null) {
        final PsiImportList importList=psiJavaFile.getImportList();
        if (importList != null) {
          for (          final PsiImportStatement importStatement : importList.getImportStatements()) {
            final boolean onDemand=importStatement.isOnDemand();
            final String imported=importStatement.getQualifiedName();
            if (onDemand && qname.startsWith(imported + ".") || !onDemand && qname.equals(imported)) {
              return true;
            }
          }
        }
      }
    }
  }
  if (element instanceof PsiMember) {
    final PsiPackage placePackage=PLACE_PACKAGE.getValue(location);
    if (placePackage == null) {
      return false;
    }
    Module elementModule=ModuleUtil.findModuleForPsiElement(element);
    return location.getPositionModule() == elementModule && placePackage.equals(PsiTreeUtil.getContextOfType(element,PsiPackage.class,false));
  }
  return false;
}
