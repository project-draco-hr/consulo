{
  List<String> commandLine=ContainerUtil.newArrayListWithExpectedSize(parameters.size() + 1);
  commandLine.add(FileUtil.toSystemDependentName(command));
  boolean winShell=SystemInfo.isWindows && ("cmd".equalsIgnoreCase(command) || "cmd.exe".equalsIgnoreCase(command)) && parameters.size() > 1 && "/c".equalsIgnoreCase(parameters.get(0));
  for (  String parameter : parameters) {
    if (SystemInfo.isWindows) {
      if (parameter.contains("\"")) {
        parameter=StringUtil.replace(parameter,"\"","\\\"");
      }
 else       if (parameter.length() == 0) {
        parameter="\"\"";
      }
    }
    if (winShell && StringUtil.containsAnyChar(parameter,WIN_SHELL_SPECIALS)) {
      parameter=quote(parameter,SPECIAL_QUOTE);
    }
    if (isQuoted(parameter,SPECIAL_QUOTE)) {
      parameter=quote(parameter.substring(1,parameter.length() - 1),'"');
    }
    commandLine.add(parameter);
  }
  return commandLine;
}
