{
  Object nodeElement=myElement.getValue();
  if (nodeElement instanceof SmartPsiElementPointer) {
    nodeElement=((SmartPsiElementPointer)nodeElement).getElement();
  }
  if (nodeElement instanceof PsiElement) {
    if (nodeElement instanceof PsiClass) {
      return ClassPresentationUtil.getNameForClass((PsiClass)nodeElement,true);
    }
    if (nodeElement instanceof PsiDirectory) {
      return ((PsiDirectory)nodeElement).getVirtualFile().getPresentableUrl();
    }
    final PsiElement parent=((PsiElement)nodeElement).getParent();
    if (parent instanceof PsiClass) {
      return ClassPresentationUtil.getNameForClass((PsiClass)parent,true);
    }
    if (parent == null)     return "";
    final PsiFile containingFile=nodeElement instanceof PsiFile ? (PsiFile)nodeElement : parent.getContainingFile();
    return containingFile != null ? containingFile.getVirtualFile().getPresentableUrl() : "";
  }
  if (nodeElement instanceof PackageElement) {
    final PackageElement packageElement=((PackageElement)nodeElement);
    final Module module=packageElement.getModule();
    return (module != null ? (module.getName() + ":") : "") + packageElement.getPackage().getQualifiedName();
  }
  if (nodeElement instanceof LibraryGroupElement) {
    return ((LibraryGroupElement)nodeElement).getModule().getName();
  }
  if (nodeElement instanceof NamedLibraryElement) {
    final NamedLibraryElement namedLibraryElement=((NamedLibraryElement)nodeElement);
    final LibraryGroupElement parent=namedLibraryElement.getParent();
    return parent.getModule().getName() + ":" + namedLibraryElement.getOrderEntry().getPresentableName();
  }
  final FavoriteNodeProvider[] nodeProviders=Extensions.getExtensions(FavoriteNodeProvider.EP_NAME);
  for (  FavoriteNodeProvider provider : nodeProviders) {
    String location=provider.getElementLocation(nodeElement);
    if (location != null)     return location;
  }
  return null;
}
