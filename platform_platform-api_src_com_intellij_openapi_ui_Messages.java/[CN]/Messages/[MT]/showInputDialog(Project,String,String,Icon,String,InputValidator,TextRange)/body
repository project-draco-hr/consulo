{
  if (isApplicationInUnitTestOrHeadless()) {
    return ourTestInputImplementation.show(message);
  }
 else {
    InputDialog dialog=new InputDialog(project,message,title,icon,initialValue,validator);
    final JTextComponent field=dialog.getTextField();
    if (selection != null) {
      field.select(selection.getStartOffset(),selection.getEndOffset());
    }
 else {
      final int length=field.getDocument().getLength();
      field.select(length,length);
    }
    field.putClientProperty(DialogWrapperPeer.HAVE_INITIAL_SELECTION,true);
    dialog.show();
    return dialog.getInputString();
  }
}
