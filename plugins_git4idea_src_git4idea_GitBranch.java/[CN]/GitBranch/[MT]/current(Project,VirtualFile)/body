{
  GitSimpleHandler h=new GitSimpleHandler(project,root,GitCommand.BRANCH);
  h.setNoSSH(true);
  h.setSilent(true);
  h.addParameters("--no-color");
  String output=h.run();
  for (StringTokenizer lines=new StringTokenizer(output,"\n"); lines.hasMoreTokens(); ) {
    String line=lines.nextToken();
    if (line != null && line.startsWith("*")) {
      if (line.endsWith(NO_BRANCH_NAME)) {
        return null;
      }
 else {
        return new GitBranch(line.substring(2),true,false);
      }
    }
  }
  if (output.trim().length() == 0) {
    String text;
    try {
      text=new String(FileUtil.loadFileText(new File(root.getPath(),".git/HEAD"),GitUtil.UTF8_ENCODING)).trim();
    }
 catch (    IOException e) {
      return null;
    }
    String prefix="ref: refs/heads/";
    if (text.startsWith(prefix)) {
      return new GitBranch(text.substring(prefix.length()),true,false);
    }
  }
  return null;
}
