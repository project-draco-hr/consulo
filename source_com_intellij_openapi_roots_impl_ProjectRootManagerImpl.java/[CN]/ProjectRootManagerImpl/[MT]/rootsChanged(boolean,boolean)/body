{
  ApplicationManager.getApplication().assertWriteAccessAllowed();
  myRootsChangeCounter--;
  if (myRootsChangeCounter > 0)   return;
  if (myProject.isDisposed())   return;
  Module[] modules=ModuleManager.getInstance(myProject).getModules();
  for (  Module module : modules) {
    ((ModuleRootManagerImpl)ModuleRootManager.getInstance(module)).dropCaches();
    ((ModuleImpl)module).clearScopesCache();
  }
  myJdkScopes.clear();
  myLibraryScopes.clear();
  myModuleRootEventDispatcher.getMulticaster().rootsChanged(new ModuleRootEventImpl(myProject,filetypes));
  for (  Module module : modules) {
    ((ModuleImpl)module).clearScopesCache();
  }
  if (synchronize)   doSynchronize();
  addRootsToWatch();
  myModificationCount++;
}
