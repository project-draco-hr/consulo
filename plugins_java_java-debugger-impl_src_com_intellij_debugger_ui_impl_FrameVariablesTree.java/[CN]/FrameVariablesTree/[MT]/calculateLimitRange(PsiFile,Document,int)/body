{
  final int offset=doc.getLineStartOffset(line);
  if (offset > 0) {
    for (PsiElement elem=file.findElementAt(offset); elem != null; elem=elem.getParent()) {
      if (elem instanceof PsiMethod) {
        final TextRange elemRange=elem.getTextRange();
        return new TextRange(doc.getLineNumber(elemRange.getStartOffset()),doc.getLineNumber(elemRange.getEndOffset()));
      }
    }
  }
  return new TextRange(0,doc.getLineCount() - 1);
}
