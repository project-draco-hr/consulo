{
  PsiClass containingClass=myMember.getContainingClass();
  if (mySettings.isMakeClassParameter()) {
    PsiType type=factory.createType(containingClass,PsiSubstitutor.EMPTY);
    final String classParameterName=mySettings.getClassParameterName();
    final String fieldName=convertToFieldName(classParameterName);
    myMember.add(factory.createField(fieldName,type));
  }
  if (mySettings.isMakeFieldParameters()) {
    List<Settings.FieldParameter> parameters=mySettings.getParameterOrderList();
    for (    Settings.FieldParameter fieldParameter : parameters) {
      final PsiType type=fieldParameter.type;
      final PsiField field=factory.createField(convertToFieldName(fieldParameter.name),type);
      myMember.add(field);
    }
  }
  PsiMethod[] constructors=myMember.getConstructors();
  if (constructors.length == 0) {
    final PsiMethod defConstructor=(PsiMethod)myMember.add(factory.createConstructor());
    constructors=new PsiMethod[]{defConstructor};
  }
  boolean generateFinalParams=CodeStyleSettingsManager.getSettings(myProject).GENERATE_FINAL_PARAMETERS;
  for (  PsiMethod constructor : constructors) {
    final MethodJavaDocHelper javaDocHelper=new MethodJavaDocHelper(constructor);
    PsiParameterList paramList=constructor.getParameterList();
    PsiElement addParameterAfter=null;
    PsiDocTag anchor=null;
    if (mySettings.isMakeClassParameter()) {
      PsiType parameterType=factory.createType(containingClass,PsiSubstitutor.EMPTY);
      final String classParameterName=mySettings.getClassParameterName();
      PsiParameter parameter=factory.createParameter(classParameterName,parameterType);
      PsiUtil.setModifierProperty(parameter,PsiModifier.FINAL,makeClassParameterFinal(usages) || generateFinalParams);
      addParameterAfter=paramList.addAfter(parameter,null);
      anchor=javaDocHelper.addParameterAfter(classParameterName,anchor);
      addAssignmentToField(classParameterName,constructor);
    }
    if (mySettings.isMakeFieldParameters()) {
      List<Settings.FieldParameter> parameters=mySettings.getParameterOrderList();
      for (      Settings.FieldParameter fieldParameter : parameters) {
        final PsiType fieldParameterType=fieldParameter.field.getType();
        final PsiParameter parameter=factory.createParameter(fieldParameter.name,fieldParameterType);
        PsiUtil.setModifierProperty(parameter,PsiModifier.FINAL,makeFieldParameterFinal(fieldParameter.field,usages) || generateFinalParams);
        addParameterAfter=paramList.addAfter(parameter,addParameterAfter);
        anchor=javaDocHelper.addParameterAfter(fieldParameter.name,anchor);
        addAssignmentToField(fieldParameter.name,constructor);
      }
      for (      UsageInfo usage : usages) {
        if (usage instanceof InternalUsageInfo) {
          final PsiElement element=usage.getElement();
          final PsiElement referencedElement=((InternalUsageInfo)usage).getReferencedElement();
          if (referencedElement instanceof PsiField && mySettings.getNameForField((PsiField)referencedElement) != null) {
            final PsiField field=PsiTreeUtil.getParentOfType(element,PsiField.class);
            if (field != null) {
              moveInitializerToConstructor(factory,constructor,field);
            }
          }
        }
      }
    }
  }
  setupTypeParameterList();
  final PsiModifierList modifierList=myMember.getModifierList();
  modifierList.setModifierProperty(PsiModifier.STATIC,true);
  modifierList.setModifierProperty(PsiModifier.FINAL,false);
}
