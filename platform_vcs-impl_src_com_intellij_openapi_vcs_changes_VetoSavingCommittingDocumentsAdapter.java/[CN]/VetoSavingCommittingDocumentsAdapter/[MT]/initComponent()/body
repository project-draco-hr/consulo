{
  myFileDocumentManager.addFileDocumentSynchronizationVetoer(this);
  ApplicationManager.getApplication().getMessageBus().connect().subscribe(AppTopics.FILE_DOCUMENT_SYNC,new FileDocumentManagerAdapter(){
    @Override public void beforeAllDocumentsSaving(){
      List<Document> documentsToWarn=new ArrayList<Document>();
      final Document[] unsavedDocuments=myFileDocumentManager.getUnsavedDocuments();
      Project commitOwnerProject=null;
      for (      Document unsavedDocument : unsavedDocuments) {
        final Object data=unsavedDocument.getUserData(ChangeListManagerImpl.DOCUMENT_BEING_COMMITTED_KEY);
        if (data instanceof Project) {
          commitOwnerProject=(Project)data;
          documentsToWarn.add(unsavedDocument);
        }
      }
      if (!documentsToWarn.isEmpty()) {
        boolean allowSave=showAllowSaveDialog(commitOwnerProject,documentsToWarn);
        for (        Document document : documentsToWarn) {
          document.putUserData(ChangeListManagerImpl.DOCUMENT_BEING_COMMITTED_KEY,allowSave ? null : SAVE_DENIED);
        }
      }
    }
  }
);
}
