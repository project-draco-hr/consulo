{
  if (myXmlFormattingPolicy.processJsp() && (child.getElementType() == JspElementType.JSP_XML_TEXT || child.getPsi() instanceof OuterLanguageElement)) {
    final Pair<PsiElement,Language> root=JspTextBlock.findPsiRootAt(child,myXmlFormattingPolicy.processJavaTree());
    if (root != null) {
      createJspTextNode(result,child,indent);
      return;
    }
  }
  if (isXmlTag(child)) {
    result.add(new XmlTagBlock(child,wrap,alignment,myXmlFormattingPolicy,indent != null ? indent : Indent.getNoneIndent()));
  }
 else   if (child.getElementType() == XmlElementType.XML_DOCTYPE) {
    result.add(new XmlBlock(child,wrap,alignment,myXmlFormattingPolicy,indent,null){
      protected Wrap getDefaultWrap(      final ASTNode node){
        final IElementType type=node.getElementType();
        return type == XmlElementType.XML_ATTRIBUTE_VALUE_TOKEN ? Wrap.createWrap(getWrapType(myXmlFormattingPolicy.getAttributesWrap()),false) : null;
      }
    }
);
  }
 else {
    result.add(new XmlBlock(child,wrap,alignment,myXmlFormattingPolicy,indent,null));
  }
}
