{
  if (!myProcessDocumentEvents)   return;
  final Document document=event.getDocument();
  final PsiFile file=getCachedPsiFile(document);
  if (file == null)   return;
  if (file instanceof PsiFileImpl) {
    myIsCommitInProgress=true;
    try {
      PsiFileImpl psiFile=(PsiFileImpl)file;
      document.putUserData(TEMP_TREE_IN_DOCUMENT_KEY,psiFile.calcTreeElement());
      ((SingleRootFileViewProvider)psiFile.getViewProvider()).beforeDocumentChanged();
    }
  finally {
      myIsCommitInProgress=false;
    }
  }
  if (mySmartPointerManager != null) {
    mySmartPointerManager.fastenBelts(file);
  }
}
