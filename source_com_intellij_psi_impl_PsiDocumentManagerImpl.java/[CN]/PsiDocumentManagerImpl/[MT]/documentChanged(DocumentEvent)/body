{
  final Document document=event.getDocument();
  if (!processDocEvents(document))   return;
  final PsiFile file=getCachedPsiFile(document);
  if (file == null || (file instanceof SrcRepositoryPsiElement && ((SrcRepositoryPsiElement)file).getTreeElement() == null))   return;
  if (mySmartPointerManager != null) {
    mySmartPointerManager.unfastenBelts(file);
  }
  getTextBlock(document).documentChanged(event);
  myUncommittedDocuments.add(document);
  if (ApplicationManager.getApplication().getCurrentWriteAction(PsiExternalChangeAction.class) != null) {
    commitDocument(document);
  }
}
