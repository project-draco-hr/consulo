{
  ApplicationManager.getApplication().runWriteAction(new CommitToPsiFileAction(){
    public void run(){
      if (!isUncommited(document))       return;
      final PsiFile file=getCachedPsiFile(document);
      if (file == null || !file.isValid()) {
        myUncommittedDocuments.remove(document);
        return;
      }
      commit(document,file);
      myUncommittedDocuments.remove(document);
    }
  }
);
}
