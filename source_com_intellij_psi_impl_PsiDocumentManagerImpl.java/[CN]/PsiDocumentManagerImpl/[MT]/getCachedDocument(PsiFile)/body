{
  VirtualFile vFile=file.getVirtualFile();
  if (vFile != null) {
    return FileDocumentManager.getInstance().getCachedDocument(vFile);
  }
 else {
    WeakReference<Document> reference=file.getUserData(KEY_DOCUMENT);
    if (reference == null)     return null;
    return reference.get();
  }
}
