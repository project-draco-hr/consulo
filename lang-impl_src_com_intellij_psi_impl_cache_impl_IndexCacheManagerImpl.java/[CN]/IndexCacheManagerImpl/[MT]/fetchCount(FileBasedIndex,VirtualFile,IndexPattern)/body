{
  final int[] count=new int[]{0};
  fileBasedIndex.processValues(TodoIndex.NAME,new TodoIndexEntry(indexPattern.getPatternString(),indexPattern.isCaseSensitive()),file,new FileBasedIndex.ValueProcessor<Integer>(){
    public boolean process(    final VirtualFile file,    final Integer value){
      count[0]+=value.intValue();
      return true;
    }
  }
,VirtualFileFilter.ALL);
  return count[0];
}
