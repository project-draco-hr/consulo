{
  ProjectImpl.UnableToSaveProjectNotification[] notifications=NotificationsManager.getNotificationsManager().getNotificationsOfType(ProjectImpl.UnableToSaveProjectNotification.class,myProject);
  if (notifications.length > 0) {
    throw new SaveCancelledException();
  }
  beforeSave(readonlyFiles);
  super.save(readonlyFiles);
  if (!readonlyFiles.isEmpty()) {
    ReadonlyStatusHandler.OperationStatus status;
    AccessToken token=ReadAction.start();
    try {
      status=ReadonlyStatusHandler.getInstance(myProject).ensureFilesWritable(getFilesList(readonlyFiles));
    }
  finally {
      token.finish();
    }
    if (status.hasReadonlyFiles()) {
      ProjectImpl.dropUnableToSaveProjectNotification(myProject,status.getReadonlyFiles());
      throw new SaveCancelledException();
    }
 else {
      readonlyFiles.clear();
      for (      Pair<StateStorageManager.SaveSession,VirtualFile> entry : readonlyFiles) {
        executeSave(entry.first,readonlyFiles);
      }
      if (!readonlyFiles.isEmpty()) {
        ProjectImpl.dropUnableToSaveProjectNotification(myProject,getFilesList(readonlyFiles));
        throw new SaveCancelledException();
      }
    }
  }
  return this;
}
