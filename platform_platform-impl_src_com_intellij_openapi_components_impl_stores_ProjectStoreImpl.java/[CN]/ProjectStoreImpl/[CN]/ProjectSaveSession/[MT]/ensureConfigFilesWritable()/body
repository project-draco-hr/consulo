{
  return ApplicationManager.getApplication().runReadAction(new Computable<ReadonlyStatusHandler.OperationStatus>(){
    public ReadonlyStatusHandler.OperationStatus compute(){
      final List<IFile> filesToSave;
      try {
        filesToSave=getAllStorageFilesToSave(true);
      }
 catch (      IOException e) {
        LOG.error(e);
        return null;
      }
      List<VirtualFile> readonlyFiles=new ArrayList<VirtualFile>();
      for (      IFile file : filesToSave) {
        final VirtualFile virtualFile=LocalFileSystem.getInstance().findFileByIoFile(file);
        if (virtualFile != null) {
          virtualFile.refresh(false,false);
          if (virtualFile.isValid() && !virtualFile.isWritable())           readonlyFiles.add(virtualFile);
        }
      }
      return ReadonlyStatusHandler.getInstance(myProject).ensureFilesWritable(readonlyFiles);
    }
  }
);
}
