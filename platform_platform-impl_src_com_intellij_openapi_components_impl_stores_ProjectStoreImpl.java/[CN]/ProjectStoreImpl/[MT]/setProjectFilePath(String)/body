{
  if (filePath == null) {
    return;
  }
  final StateStorageManager stateStorageManager=getStateStorageManager();
  final File file=new File(filePath);
  if (!isIprPath(file)) {
    final File dirStore=file.isDirectory() ? new File(file,Project.DIRECTORY_STORE_FOLDER) : new File(file.getParentFile(),Project.DIRECTORY_STORE_FOLDER);
    FileBasedStorage.syncRefreshPathRecursively(dirStore.getPath(),null);
    myScheme=StorageScheme.DIRECTORY_BASED;
    stateStorageManager.addMacro(PROJECT_FILE_MACRO,new File(dirStore,"misc.xml").getPath());
    final File ws=new File(dirStore,"workspace.xml");
    stateStorageManager.addMacro(WS_FILE_MACRO,ws.getPath());
    if (!ws.exists() && !file.isDirectory()) {
      useOldWsContent(filePath,ws);
    }
    stateStorageManager.addMacro(PROJECT_CONFIG_DIR,dirStore.getPath());
  }
 else {
    LocalFileSystem.getInstance().refreshAndFindFileByPath(filePath);
    myScheme=StorageScheme.DEFAULT;
    stateStorageManager.addMacro(PROJECT_FILE_MACRO,filePath);
    final String workspacePath=composeWsPath(filePath);
    LocalFileSystem.getInstance().refreshAndFindFileByPath(workspacePath);
    stateStorageManager.addMacro(WS_FILE_MACRO,workspacePath);
  }
  myCachedLocation=null;
  myPresentableUrl=null;
}
