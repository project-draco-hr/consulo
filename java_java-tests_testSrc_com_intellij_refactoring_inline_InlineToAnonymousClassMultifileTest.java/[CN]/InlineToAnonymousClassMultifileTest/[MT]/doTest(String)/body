{
  String rootBefore=getRoot() + "/before";
  PsiTestUtil.removeAllRoots(myModule,JavaSdkImpl.getMockJdk("java 1.4"));
  final VirtualFile rootDir=PsiTestUtil.createTestProjectStructure(myProject,myModule,rootBefore,myFilesToDelete);
  PsiClass classToInline=myJavaFacade.findClass(className,ProjectScope.getAllScope(myProject));
  assertEquals(null,InlineToAnonymousClassHandler.getCannotInlineMessage(classToInline));
  InlineToAnonymousClassProcessor processor=new InlineToAnonymousClassProcessor(myProject,classToInline,null,false,false,false);
  UsageInfo[] usages=processor.findUsages();
  ArrayList<String> conflicts=processor.getConflicts(usages);
  assertEquals(0,conflicts.size());
  processor.run();
  String rootAfter=getRoot() + "/after";
  VirtualFile rootDir2=LocalFileSystem.getInstance().findFileByPath(rootAfter.replace(File.separatorChar,'/'));
  myProject.getComponent(PostprocessReformattingAspect.class).doPostponedFormatting();
  IdeaTestUtil.assertDirectoriesEqual(rootDir2,rootDir,IdeaTestUtil.CVS_FILE_FILTER);
}
