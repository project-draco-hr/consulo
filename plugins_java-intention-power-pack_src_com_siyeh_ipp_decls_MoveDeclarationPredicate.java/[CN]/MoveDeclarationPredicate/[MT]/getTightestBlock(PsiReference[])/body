{
  PsiCodeBlock commonParentBlock=null;
  for (  PsiReference reference : references) {
    final PsiElement referenceElement=reference.getElement();
    final PsiCodeBlock block=PsiTreeUtil.getParentOfType(referenceElement,PsiCodeBlock.class);
    if (block == null) {
      return commonParentBlock;
    }
    if (commonParentBlock != null && !commonParentBlock.equals(block)) {
      final PsiElement commonParent=PsiTreeUtil.findCommonParent(commonParentBlock,block);
      if (commonParent instanceof PsiCodeBlock) {
        commonParentBlock=(PsiCodeBlock)commonParent;
      }
 else {
        commonParentBlock=PsiTreeUtil.getParentOfType(commonParent,PsiCodeBlock.class);
      }
    }
 else {
      commonParentBlock=block;
    }
  }
  return commonParentBlock;
}
