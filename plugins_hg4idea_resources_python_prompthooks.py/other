import urllib2
from mercurial import ui, util
import struct, socket
from mercurial.i18n import _
try:
    from mercurial.url import passwordmgr
except:
    from mercurial.httprepo import passwordmgr
if getattr(ui.ui, 'promptchoice', None):

    @monkeypatch_method(ui.ui)
    def promptchoice(self, msg, choices=None, default=0):
        return sendchoicestoidea(self, msg, choices, default)
else:

    @monkeypatch_method(ui.ui)
    def prompt(self, msg, choices=None, default='y'):
        resps = [s[(s.index('&') + 1)].lower() for s in choices]
        defaultIndex = resps.index(default)
        responseIndex = sendchoicestoidea(self, msg, choices, defaultIndex)
        return resps[responseIndex]
original_warn = ui.ui.warn
original_retrievepass = passwordmgr.find_user_password
