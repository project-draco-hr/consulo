def retrieve_pass_from_server(ui, uri, path, proposed_user):
    port = int(ui.config('hg4ideapass', 'port', None, True))
    if (port is None):
        raise util.Abort('No port was specified')
    client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    ui.debug('connecting ...')
    client.connect(('127.0.0.1', port))
    ui.debug('connected, sending data ...')
    send(client, 'getpass')
    send(client, uri)
    send(client, path)
    send(client, proposed_user)
    user = receiveWithMessage(client, 'http authorization required')
    password = receiveWithMessage(client, 'http authorization required')
    return (user, password)
