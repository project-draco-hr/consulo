{
  UsageSearcher usageSearcher=mySearcherFactory.create();
  usageSearcher.generate(new Processor<Usage>(){
    public boolean process(    final Usage usage){
      checkSearchCanceled();
      boolean incrementCounter=true;
      final int i=myUsageCountWithoutDefinition.get();
      if (mySearchFor.length == 1 && usage instanceof PsiElementUsage && mySearchFor[0] instanceof PsiElementUsageTarget) {
        final PsiElement element=((PsiElementUsage)usage).getElement();
        if (element != null && element.getParent() == ((PsiElementUsageTarget)mySearchFor[0]).getElement()) {
          incrementCounter=false;
        }
      }
      int usageCount=incrementCounter ? myUsageCountWithoutDefinition.incrementAndGet() : i;
      if (usageCount == 1 && !myProcessPresentation.isShowPanelIfOnlyOneUsage()) {
        myFirstUsage.compareAndSet(null,usage);
      }
      UsageViewImpl usageView=getUsageView();
      if (usageView != null) {
        usageView.appendUsageLater(usage);
      }
      final ProgressIndicator indicator=ProgressManager.getInstance().getProgressIndicator();
      return indicator == null || !indicator.isCanceled();
    }
  }
);
  if (getUsageView() != null) {
    ApplicationManager.getApplication().invokeLater(new Runnable(){
      public void run(){
        showToolWindow(true);
      }
    }
,myProject.getDisposed());
  }
}
