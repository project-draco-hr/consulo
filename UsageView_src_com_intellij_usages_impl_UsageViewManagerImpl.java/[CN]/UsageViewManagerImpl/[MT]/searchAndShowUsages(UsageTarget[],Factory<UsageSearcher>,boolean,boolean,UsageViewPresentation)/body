{
  final UsageViewImpl[] usageView=new UsageViewImpl[]{null};
  final Application application=ApplicationManager.getApplication();
  application.runProcessWithProgressSynchronously(new Runnable(){
    private int myUsageCount=0;
    private Usage myFirstUsage=null;
    private void activateView(){
      if (usageView[0] != null)       return;
      usageView[0]=new UsageViewImpl(presentation,searchFor,searcherFactory,myProject);
      SwingUtilities.invokeLater(new Runnable(){
        public void run(){
          addContent(usageView[0],presentation);
          activateToolwindow();
        }
      }
);
    }
    public void run(){
      if (!showNotFoundMessage)       activateView();
      UsageSearcher usageSearcher=searcherFactory.create();
      usageSearcher.generate(new Processor<Usage>(){
        public boolean process(        final Usage usage){
          myUsageCount++;
          if (myUsageCount == 1 && !showPanelIfOnlyOneUsage) {
            myFirstUsage=usage;
          }
          if (myUsageCount == 2 || (showPanelIfOnlyOneUsage && myUsageCount == 1)) {
            activateView();
            if (myFirstUsage != null) {
              usageView[0].appendUsageLater(myFirstUsage);
            }
            usageView[0].appendUsageLater(usage);
          }
 else           if (myUsageCount > 2) {
            usageView[0].appendUsageLater(usage);
          }
          ProgressIndicator indicator=ProgressManager.getInstance().getProgressIndicator();
          return indicator != null ? !indicator.isCanceled() : true;
        }
      }
);
      if (myUsageCount == 0 && showNotFoundMessage) {
        application.invokeLater(new Runnable(){
          public void run(){
            Messages.showMessageDialog(myProject,"No " + presentation.getUsagesString() + " found in "+ presentation.getScopeText(),"Information",Messages.getInformationIcon());
          }
        }
,ModalityState.NON_MMODAL);
      }
 else       if (myUsageCount == 1 && !showPanelIfOnlyOneUsage) {
        SwingUtilities.invokeLater(new Runnable(){
          public void run(){
            if (myFirstUsage.canNavigate()) {
              myFirstUsage.navigate(true);
            }
          }
        }
);
      }
 else {
        usageView[0].setSearchInProgress(false);
      }
    }
  }
,getProgressTitile(presentation),true,myProject);
  return usageView[0];
}
