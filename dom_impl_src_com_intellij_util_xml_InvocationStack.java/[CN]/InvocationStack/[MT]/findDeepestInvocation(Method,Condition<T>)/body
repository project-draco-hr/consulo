{
  final Stack<Pair<JavaMethodSignature,T>> stack=myCallStacks.get();
  JavaMethodSignature signature=JavaMethodSignature.getSignature(method);
  for (int i=stack.size() - 2; i >= 0; i--) {
    final Pair<JavaMethodSignature,T> pair=stack.get(i);
    if (stopAt.value(pair.second)) {
      return stack.get(i + 1).second;
    }
    if (pair.first != signature) {
      return null;
    }
  }
  return stack.isEmpty() ? null : stack.get(0).second;
}
