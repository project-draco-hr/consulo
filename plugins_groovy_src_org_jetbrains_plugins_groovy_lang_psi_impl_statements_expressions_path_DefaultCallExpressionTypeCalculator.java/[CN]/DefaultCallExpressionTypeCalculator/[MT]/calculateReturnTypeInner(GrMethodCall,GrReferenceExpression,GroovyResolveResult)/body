{
  PsiElement resolved=resolveResult.getElement();
  PsiType returnType=null;
  if (resolved instanceof PsiMethod) {
    PsiMethod method=(PsiMethod)resolved;
    if (resolveResult.isInvokedOnProperty()) {
      final PsiType propertyType=PsiUtil.getSmartReturnType(method);
      returnType=extractReturnTypeFromType(propertyType,true,callExpression);
    }
 else {
      returnType=getClosureMethodsReturnType(callExpression,refExpr,method);
      if (returnType == null) {
        returnType=PsiUtil.getSmartReturnType(method);
      }
    }
  }
 else   if (resolved instanceof GrVariable) {
    PsiType refType=refExpr.getType();
    final PsiType type=refType == null ? ((GrVariable)resolved).getTypeGroovy() : refType;
    returnType=extractReturnTypeFromType(type,false,callExpression);
  }
  return returnType;
}
