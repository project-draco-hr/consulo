{
  GrExpression invoked=callExpression.getInvokedExpression();
  if (invoked instanceof GrReferenceExpression) {
    GrReferenceExpression refExpr=(GrReferenceExpression)invoked;
    PsiManager manager=callExpression.getManager();
    PsiType result=null;
    for (    GroovyResolveResult resolveResult : resolveResults) {
      PsiElement resolved=resolveResult.getElement();
      PsiType returnType=null;
      if (resolved instanceof PsiMethod) {
        PsiMethod method=(PsiMethod)resolved;
        if (resolveResult.isInvokedOnProperty()) {
          final PsiType propertyType=PsiUtil.getSmartReturnType(method);
          returnType=extractReturnTypeFromType(propertyType,true,callExpression);
        }
 else {
          returnType=getClosureMethodsReturnType(callExpression,refExpr,method);
          if (returnType == null) {
            returnType=PsiUtil.getSmartReturnType(method);
          }
        }
      }
 else       if (resolved instanceof GrVariable) {
        PsiType refType=refExpr.getType();
        final PsiType type=refType == null ? ((GrVariable)resolved).getTypeGroovy() : refType;
        returnType=extractReturnTypeFromType(type,false,callExpression);
      }
      if (returnType == null)       return null;
      if (!(returnType instanceof GrLiteralClassType)) {
        returnType=TypesUtil.substituteBoxAndNormalizeType(returnType,resolveResult.getSubstitutor(),callExpression);
        LOG.assertTrue(returnType != null);
      }
      if (result == null || returnType.isAssignableFrom(result))       result=returnType;
 else       if (!result.isAssignableFrom(returnType))       result=TypesUtil.getLeastUpperBound(result,returnType,manager);
    }
    if (result == null)     return null;
    if (refExpr.getDotTokenType() != GroovyTokenTypes.mSPREAD_DOT) {
      return result;
    }
 else {
      return ResolveUtil.getListTypeForSpreadOperator(refExpr,result);
    }
  }
 else {
    return extractReturnTypeFromType(invoked.getType(),false,callExpression);
  }
}
